index,text
420,an optimal design of in situ bioremediation system for contaminated aquifer sites mainly depends on the injection extraction well locations and their pumping rates previous studies have used discretization approaches such as finite difference method fdm or finite element method fem to solve the equations of groundwater flow and contaminant transport gfct that characterize the bioremediation processes in these numerical models well locations can only lie at the grid nodes and therefore the locations other than the grid nodes remain unexplored for the optimal in situ bioremediation to explore such locations in this study a meshless simulation model called bioefgm is developed using the element free galerkin method efgm and coupled with the particle swarm optimization pso bioefgm model provides flexibility in adding injection extraction wells anywhere in the computational domain during the entire optimization procedure however fdm fem requires meshing and re meshing of the computational domain for each set of wells and it increases the computational efforts significantly for solving the optimization problem in this paper the proposed bioefgm pso simulation optimization s o model is first applied to a well known bioremediation problem and then to a field type large aquifer problem the simulation results of bioefgm are verified with those from the rt3d simulations the estimated bioremediation cost from the bioefgm pso model for the first problem is found to be lesser in comparison to the same calculated with different s o models in the previous studies the results of this problem also show that optimized in situ bioremediation system designed by proposed s o model takes less remediation time and also favor effective biodegradation of contaminants for both the problems bioefgm pso identified optimal well locations at positions other than that of discretized nodes and it leads to efficient bioremediation it indicates the effectiveness of the bioefgm pso model and therefore can be applied for designing the better optimized in situ bioremediation systems for field problems keywords bioefgm pso element free galerkin method groundwater contamination in situ bioremediation meshless simulation 1 introduction groundwater resources store large part of the world s fresh water and act as a vital source of drinking water fan 2015 because these resources are located underneath the earth s top crust therefore are poorly managed and over exploited zaporozec 1981 worldwide many groundwater sites are facing a serious problem of contamination the contamination through petroleum products is one of the major issues the large number of underground storage tanks ust s are used to store petroleum products such as gasoline diesel fuel kerosene oil etc and their leakage from ust s result in contamination of the groundwater resources the petroleum hydrocarbons contain toxic organic chemicals such as benzene toluene ethylbenzene and xylenes btex bedient et al 1994 the presence of such organic contaminants even in small amount in groundwater can deteriorate aquifer health and make it unfit for supplying drinking water to public the natural attenuation processes can clean btex contaminated aquifers up to a certain limit it includes the processes of hydrodynamic dispersion sorption and volatilization which reduces contaminant concentration in the groundwater and biodegradation that reduces mass of contaminants wiedemeier et al 1999 for btex contaminated aquifers biodegradation is the most suitable attenuation process since it reduces actual mass of btex compounds by consuming the available oxygen in the groundwater usepa 2004 in groundwater sites with large btex concentration biodegradation process results in depletion of oxygen in the core of the plume and thereby it stops further degradation of btex compounds to stimulate the biodegradation of these petroleum hydrocarbons in situ bioremediation is the most preferred cleaning technique in situ groundwater bioremediation is a technique that promotes the growth and reproduction of indigenous microorganisms to increase the biodegradation rate of organic compounds in the saturated region usepa 2004 this is achieved by supplying electron acceptors such as oxygen and nitrate and nutrients such as nitrogen and phosphorus to the microorganisms in the contaminated region in situ bioremediation employs the use of both injection and extraction wells in the polluted groundwater site the injection wells are used to transport electron acceptors and nutrients to the microorganisms the extraction wells are used to increase the hydraulic gradient control the plume movement and remove the contaminants from the aquifer system this remediation approach can effectively degrade dissolved and adsorbed organic compounds in the groundwater and soil respectively schreiber and bahr 2002 designing an optimal in situ bioremediation system is an important exercise for groundwater scientists and is mainly dependent on the wells location and their injection extraction rates it can be designed using the different s o models which couple gfct based bioremediation simulations with the optimization algorithms over the last few decades several studies on in situ groundwater bioremediation have been reported yoon and shoemaker 1999 used the bio2d model proposed by taylor 1993 for bioremediation simulations and applied different optimization algorithms to find out the fastest algorithm for designing the optimized in situ bioremediation system later yoon and shoemaker 2001 used a real coded genetic algorithm rga for the optimal in situ bioremediation shieh and peralta 2005 coupled the bioplume ii model proposed by rifai et al 1987 with a hybrid algorithm combining genetic algorithm ga and simulated annealing sa for the optimal design of in situ bioremediation system prasad and mathur 2008 used the artificial neural network ann as a proxy simulator of bioplume iii rifai et al 1997 and presented a technique based on ann and monte carlo approach for identifying the potential well locations for an optimal in situ bioremediation sudheer et al 2013 trained the support vector machine svm with biofdm simulations and combined it with the pso for scheduling the optimum pumping policy for in situ bioremediation yadav et al 2016 used the extreme learning machine elm as a proxy simulator of bioplume ii and combined it with pso for finding the optimal strategy for in situ groundwater bioremediation in most of the aforementioned studies the case study of shieh and peralta 2005 is solved using different s o models and the optimal well locations were determined from the limited preselected locations prasad and mathur 2008 sudheer et al 2013 yadav et al 2016 however raei et al 2017 used all the grid nodes in the same study area as a search space to find out the optimal well locations using this approach and calling bioplume iii simulations within nsga ii they found that bioremediation cost decreases by 20 to 40 of costs estimated in studies with predefined well locations in the optimal design of groundwater bioremediation system well locations are the important decision variables in the past several studies the mesh based methods fdm fem have been mostly used for running the gfct simulations of the bioremediation mechanism yoon and shoemaker 1999 2001 shieh and peralta 2005 prasad and mathur 2008 sudheer et al 2013 yadav et al 2016 raei et al 2017 the mesh based simulation models provide optimal well locations only at the grid nodes in the optimized bioremediation system however optimal well locations can also lie at the locations other than the grid nodes in such cases meshless methods provide advantages over the mesh based methods and can be used to locate optimal well coordinates anywhere inside the problem domain these methods are recently emerged as better alternative of fem fdm and are independent of remeshing procedure unlike fdm fem a meshless method uses scattered field nodes to represent problem domain and its boundaries the governing equations are then discretized using the field variable values at the scattered nodes in the recent decade different meshless models namely element free galerkin method efgm point collocation method pcm meshless local petrov galerkin method mlpg have been successfully applied over the real field gfct problems meenal and eldho 2011 first developed a meshless pcm based groundwater flow model and subsequently they also developed a pcm based contaminant transport model for the unconfined flow meenal and eldho 2012 swathi and eldho 2014 presented a mlpg based model for the unconfined groundwater flow problems and later on they developed the mlpg based model for the contaminant transport problems boddula and eldho 2017 pathania et al 2019 proposed a efgm based groundwater model for the unconfined aquifers and demonstrated its suitability to field aquifers with surface water groundwater interactions among the meshless gfct models pcm has also been used for the in situ bioremediation simulations by mategaonkar and eldho 2012 they coupled the pcm simulations with the pso algorithm for proposing an optimized bioremediation strategy recently seyedpour et al 2019 used the meshless rpcm based gfct simulations and ga for the optimal design of groundwater remediation efgm is a robust meshless method and therefore it has been applied in many practical engineering problems liu and gu 2005 efgm uses moving least squares mls approximation in the galerkin weak form to produce a set of algebraic equations belytschko et al 1994 in efgm mls approximation provides stability in function approximation and the galerkin approach construct a discretized global system equations that gives a stable solution liu and gu 2005 the integral operator in efgm helps to smooth the error due to function approximations however differential operator in meshless collocation methods tend to increase this error liu and gu 2005 efgm possess high accuracy and convergence rate than the fem fdm since it uses more support nodes for constructing the shape functions liu and gu 2005 the irregular arrangement of the nodes also does not influence efgm performance belytschko et al 1994 moreover the meshless feature of the efgm offers convenience to add remove well at any location during the entire optimization process and thus provides more search space to explore the optimal well locations within the problem domain therefore this study first develops the efgm based new simulation model called bioefgm for the bioremediation simulations in the recent years pso has been successfully applied with different simulation models for the optimal in situ groundwater bioremediation of aquifers mategaonkar and eldho 2012 sudheer et al 2013 yadav et al 2016 therefore in this study pso algorithm is used to design the optimal bioremediation system in the present study we propose bioefgm pso based a new s o model for the optimal design of in situ groundwater bioremediation system the proposed model finds optimal well locations and pumping rates by coupling the efgm based bioremediation simulations with the pso bioefgm is free from meshing and remeshing procedure unlike fdm fem and therefore can easily accommodate a set of new wells in the simulation domain at each iteration of an optimizer it also reduces a lot of computational efforts required in solving optimization problems in this study the proposed s o model is first applied to a well known bioremediation problem of shieh and peralta 2005 and it has also been solved using different s o models in the similar previous studies sudheer et al 2013 yadav et al 2016 raei et al 2017 further the proposed s o model is used to design an optimized bioremediation system for a hypothetical field type large aquifer system in the past only simple hypothetical aquifers have been considered and the present study also considers a hypothetical field type large aquifer with irregular boundaries the proposed s o model is very useful and can save costs associated with highly expensive bioremediation technique by finding optimal injection extraction locations at those points otherwise remains unexplored locations with mesh based methods for the similar nodal configuration of the problem domain 2 bioefgm simulation model development in this section a two dimensional efgm model called bioefgm is presented for the simulation of biodegradation of organic contaminants within the groundwater in bioefgm efgm technique is used to discretize the governing gfct equations which represent the bioremediation process in efgm the weak integral of the governing equation weighted with mls based shape functions is made zero efgm shape functions are derived using the mls approximation and details are given in park and leap 2000 in this study the weighting function used is cubic spline for calculating the efgm shape functions and its expression can also be seen in park and leap 2000 the governing equation for the two dimensional groundwater flow in a confined aquifer is represented as bear 1979 1 s h t x t x h x y t y h y q w q f here h is the hydraulic head m tx and ty are the transmissivities in the x and y directions m2 d s is the storage coefficient qw denotes the source sink term m d qf is the inflow rate m d and t is time d the weak integral representation of eq 1 for groundwater flow through the homogeneous and anisotropic soil weighted with efgm shape functions is given as 2 ω t x 2 h x 2 t y 2 h y 2 q w q f s h t φ d ω 0 where vector φ consists of efgm shape function at n local nodes inside the influence domain and expressed as liu and gu 2005 3 φ ϕ 1 ϕ 2 ϕ 3 ϕ n t the complete efgm procedure for deriving the system of equations for unknown heads is given in pathania et al 2019 and its final matrix form can be written as 4 k 1 k 2 1 δ t p h j t δ t f j 1 δ t p h j t where h j t δ t is a column vector of unknown heads for time t δ t the elements of the different global matrices in eq 4 are calculated as 5a k i j 1 ω t x i ϕ i x y x ϕ j x y x d ω 5b k i j 2 ω t y i ϕ i x y y ϕ j x y y d ω 5c p i j s ω ϕ i x y ϕ j x y d ω 5d f i ω ϕ i x y ϕ j x y q f j d ω ω ϕ i x y ϕ j x y q w j d ω where i j 1 2 3 n n is the total nodes used to represent the entire aquifer system the governing transport equations for the migration of biodegradable contaminant and oxygen in the two dimensional aquifer are respectively expressed as rifai et al 1997 6 c b t 1 r b x i d i j c b x j v i c b x i q c b b θ 7 c o t x i d i j c o x j v i c o x i q c o b θ here i j 1 2 x and y directions vi is the groundwater velocity in ith direction m d dij denotes the hydrodynamic dispersion tensor m2 d cb and c 0 are the concentration of biodegradable contaminant and oxygen respectively in the flow region mg l and c b and c 0 are their respective concentrations in source sink liquid mg l q represents the volumetric flux at source sink location m d rb is the retardation factor for biodegradable contaminant b denotes the saturated thickness of an aquifer and θ is the effective porosity in this study constant oxygen concentration equal to the initial oxygen concentration in the groundwater system is imposed on the upstream boundary and the remaining boundaries are assumed as the free boundaries in eqs 6 and 7 v 1 v x v 2 v y d 11 d x x d 22 d y y and for i j d i j 0 are assumed for this study the groundwater velocities in the x and y directions are calculated using the darcy law and expressed as 8 v x k x θ h x v y k y θ h y where kx and ky are the hydraulic conductivities in the x and y directions m d the stoichiometry expressions for the aerobic degradation of different btex components indicate that oxygen required for the oxidization of 1 mg l benzene 1 mg l toluene 1 mg l ethylbenzene and 1 mg l xylene are 3 08 mg l 3 13 mg l 3 17 mg l and 3 17 mg l respectively rifai et al 1997 however in this study btex contaminants are considered as a single contaminant and the utilization factor u discussed later for btex degradation and oxygen consumption is taken as 3 08 as that of the benzene which is least degradable among all the components the weak integral representation of eq 6 weighted with efgm shape functions is given as 9 ω x d x x c b x y d y y c b y v x c b x v y c b y r b q c b b θ r b c b t φ d ω 0 on applying the property of green s theorem to the first two terms in eq 9 it modifies to 10 γ e d x x c b x n x φ d γ ω d x x c b x φ x d ω γ e d y y c b y n y φ d γ ω d y y c b y φ y d ω ω v x c b x φ d ω ω v y c b y φ d ω ω r b q c b b θ φ d ω ω r b c b t φ d ω 0 where nx and ny are the x and y components of a unit vector normal to the boundary respectively in above eq 10 φ x and φ y are the vectors of first derivative of shape function with respect to x and y respectively at n local nodes liu and gu 2005 and are expressed as 11 φ x ϕ 1 x ϕ 2 x ϕ 3 x ϕ n x t 12 φ y ϕ 1 y ϕ 2 y ϕ 3 y ϕ n y t eq 10 can be rearranged into following form 13 ω d x x c b x φ x d ω ω d y y c b y φ y d ω ω v x c b x φ d ω ω v y c b y φ d ω ω r b q c b b θ φ d ω ω r b c b t φ d ω γ e d x x c b x n x φ d γ γ e d y y c b y n y φ d γ in efgm the trial solution used for the contaminant concentration is expressed as praveen kumar and dodagoudar 2010 14 c b x y t j 1 n c b j t ϕ j x y the time derivative term in eq 13 can be discretized as given below pinder and gray 1977 wang and anderson 1982 15 c b j t c b j t δ t c b j t δ t where c b j t and c b j t δ t are the contaminant concentration at node j at time t and t δ t respectively on using eqs 3 11 12 14 and 15 in eq 13 it gives 16 ω d x x i ϕ i x y x ϕ j x y x c b j t δ t d ω ω d y y i ϕ i x y y ϕ j x y y c b j t δ t d ω ω v x i ϕ i x y ϕ j x y x c b j t δ t d ω ω v y i ϕ i x y ϕ j x y y c b j t δ t d ω ω r b ϕ i x y ϕ j x y c b j t δ t c b j t δ t d ω g 1 γ e ϕ i x y d γ ω r b b θ ϕ i x y ϕ j x y q j c b j d ω where i j 1 2 3 n and g 1 is used here to represent the given dispersive flux normal to the boundary in eq 16 all the integral terms are based on the local numbering system and on transforming it to the global numbering system gives following matrix form 17 m 1 m 2 m 3 m 4 r b δ t m 5 c b j t δ t f j 1 r b δ t m 5 c b j t in eq 17 the column vector c b j t δ t provides the nodal contaminant concentrations at time t δ t and the elements of its global matrices are calculated as 18a m i j 1 ω d x x i ϕ i x y x ϕ j x y x d ω 18b m i j 2 ω d y y i ϕ i x y y ϕ j x y y d ω 18c m i j 3 ω v x i ϕ i x y ϕ j x y x d ω 18d m i j 4 ω v y i ϕ i x y ϕ j x y y d ω 18e m i j 5 ω ϕ i x y ϕ j x y d ω 18f f i 1 g 1 γ e ϕ i x y d γ r b b θ ω ϕ i x y ϕ j x y q j c b j d ω where i j 1 2 3 n the shape functions in efgm do not follow the kronecker delta function property therefore dirichlet boundaries are provided in eq 17 using the simple and computationally cheapest penalty method zhu and atluri 1998 eq 17 is then solved to obtain the contaminant concentration at all the discretized nodes in the simulation domain at time t δ t on applying the above efgm approach also to eq 7 for the oxygen transport through an aquifer yields the following global matrix expression 19 m 1 m 2 m 3 m 4 1 δ t m 5 c o j t δ t f j 2 1 δ t m 5 c o j t where the elements of global vector f 2 are calculated as 20 f i 2 g 2 γ e ϕ i x y d γ 1 b θ ω ϕ i x y ϕ j x y q j c o j d ω where g 2 is the given normal boundary flux for eq 7 on solving eq 19 c o j t δ t gives oxygen concentration at all the nodes in the simulation domain at time t δ t in the proposed bioefgm model eqs 17 and 19 are solved first to obtain the contaminant and oxygen concentrations in the aquifer and then these are used to simulate the biodegradation of organic contaminants by means of instantaneous reaction model developed by borden and bedient 1986 the instantaneous reaction model assumes that the consumption of organic contaminants and oxygen by the microorganism can be simulated as an instantaneous reaction between both of them the instantaneous reaction is simulated by combining both contaminant and oxygen plumes using the principle of superposition and the change in their respective concentrations are calculated as 21a δ c b o c o u c o 0 if c b c o u 21b δ c o b c b u c b 0 if c o c b u where δcbo and δcob are the reduction in contaminant and oxygen concentrations respectively during the biodegradation operation u is the ratio of oxygen used to contaminant degraded and known as utilization factor 3 particle swarm optimization the particle swarm optimization pso is a well known metaheuristic optimizer proposed by kennedy and eberhart 1995 and mimics the social behavior of birds flocking the pso initially assume a population of random possible solutions termed as particles and assign each particle both the random location and velocity the particle location represents the possible value of decision variables in one dimensional array and the velocity component drives a particle to move and search the optimal solution in pso during the course of iterations each particle moves in the problem search space using the information of its own premier location and the premier particle location in the swarm the premier location is determined on the basis of fitness calculated from the objective function value the mathematical model used to update the current location and velocity of the each particle in pso and make necessary movements iteratively in the search space is expressed as 22 x i k 1 x i k v i k 1 where the particle velocity is calculated as 23 v i k 1 w v i k c 1 r 1 p i k x i k c 2 r 2 p g k x i k where x and v denote the location and velocity of the particle respectively i and k represent particle and iteration numbers respectively pi stores the premier location of the ith particle pg stores the location of the premier particle in the swarm v i k 1 represents the new velocity acquired by a particle in the next iteration w denotes inertia weight c 1 and c 2 are the cognitive and social parameters respectively and r 1 and r 2 take random values within 0 and 1 4 mathematical model for optimal in situ bioremediation cost the mathematical expression for the objective function used to determine optimal in situ bioremediation cost is given by shieh and peralta 2005 this objective function includes well installation cost pumping treatment cost and facility capital cost and mathematically expressed as 24 m i n i m i z e r t 1 t p 1 1 d r t l p w 1 w c f w q w t w 1 w c s w i w m a x c i w 1 w i q w t t 1 t p m a x c t w 1 w e q w t t 1 t p the eq 24 is subjected to the following constraints 1 the residual contamination in the study region after the total remediation period should satisfy 25 0 c b t k 0 c m a x k 0 k 0 φ 2 in the monitoring wells contaminant concentration should not exceed the assumed concentration limit also the selected injection rates should hold the contamination within the simulation domain therefore 26 0 c b t k 0 c m a x k 0 t 1 2 t p k 0 ψ 3 during the entire remediation period the aquifer head should always lie between the selected minimum and maximum head values this is to ensure that the assumed pumping rates do not dilute the contaminant in the groundwater and lower down the concentration to desired limits within short duration 27 h m i n t k 0 h t k 0 h m a x t k 0 t 1 2 t p k 0 φ 4 both the injection and extraction wells can operate only up to their maximum capacities therefore the selected injection extraction rates should satisfy 28a 0 q i t q i m a x t t 1 2 t p 28b 0 q e t q e m a x t t 1 2 t p where r total cost associated with the in situ bioremediation process dr discount rate t total bioremediation time years tp no of time periods in total remediation time lp duration of single time period year w well locations in the aquifer i w integer with zero or one value for defining the feasibility of the wells at possible locations wi total number of injection wells we total number of extraction wells w w i w e total number of wells q w pumping rates at well location w l s cf cost coefficient for injection including oxygen nutrient and pumping costs or extraction including treatment and pumping operation cost per l s cs cost for installing the injection or extraction wells for the remediation purpose c i w 1 w i q w t facility capital cost for delivering the oxygen and nutrients to the contaminated groundwater site and it varies with the total injection rate c t w 1 w e q w t facility capital cost for treating the extracted groundwater and it varies with the total extraction rate h i t k 0 hydraulic head at node k 0 for time period t m h min t k 0 minimum acceptable hydraulic head at node k 0 for time period t m h max t k 0 maximum acceptable hydraulic head at node k 0 for time period t m q i t injection rate for time period t l s q e t extraction rate for time period t l s q i m a x t maximum acceptable injection rate for time period t l s q e m a x t maximum acceptable extraction rate for time period t l s c b t k 0 contaminant concentration at node k 0 at time period t mg l c b t k 0 reduced contaminant concentration at node k 0 after bioremediation operation completely ends mg l cmax k0 maximum acceptable limit for the residual contaminant concentration at node k 0 after stopping the in situ bioremediation operation mg l ψ array with locations of monitoring wells in the aquifer φ array with locations of all field nodes in the aquifer 5 bioefgm pso model development in the proposed bioefgm pso model the bioefgm model developed in the section 2 is coupled with the pso for designing the optimized in situ bioremediation systems in this study bioefgm code is written in matlab and coupled with its pso solver in bioefgm head values are calculated first from the efgm flow model and then these values are used to compute the groundwater velocities using the darcy law thereafter these velocities are supplied to the efgm based transport models for oxygen and contaminant in efgm models the integral expressions are calculated using gauss quadrature scheme and it uses background cells for evaluating them each background cell is assumed to have 4 4 gauss points in this study in the developed s o model pso in its each iteration provides improved value of decision variables well locations and pumping rates to bioefgm model and thereby finds optimal solution for the in situ bioremediation problem the steps involved in finding the optimal solution using the proposed s o model are as given below 1 input the flow and transport parameters to the bioefgm model and these are hydraulic conductivity storage coefficient aquifer thickness effective porosity retardation factor longitudinal and transverse dispersivity 2 approximate the entire problem domain with suitable number of nodes and select the size of the influence domain i e d m α i nodal spacing 3 calculate the efgm shape functions and their derivatives at local nodes within the influence domain of a gauss point 4 compute the local matrices using the above computed shape function and their derivatives values and assemble local matrices into their respective global matrices 5 repeat steps 3 and 4 for all the remaining gauss points within the computational domain to include the contribution of all the local matrices into the respective global matrices 6 define in situ bioremediation cost objective function and the problem constraints in the pso model 7 select the lower and upper bounds of the decision variables i e well coordinates and pumping rates and couple pso algorithm with the bioefgm model 8 run bioefgm pso model pso provides random values of well coordinates and pumping rates to bioefgm model from their lower and upper bound values 9 slightly modify the above computed global matrices in each iteration of pso by replacing the local contribution of those influence domains which now also surrounds newly inserted well locations 10 solve eq 4 to forecast the groundwater levels in the aquifer system and then use them to calculate the groundwater velocities in that system 11 solve eqs 17 and 19 independently for each time step to first estimate the unconsumed contaminant and oxygen concentration values these concentrations are then superimposed using the instantaneous reaction model eqs 21a and 21b and it gives the change in their respective concentrations 12 finally pso checks if stopping criteria is satisfied or not it stops if it is satisfied otherwise pso repeats the above procedure for the next iteration the flowchart for the proposed bioefgm pso model is shown in fig 1 it was demonstrated in the previous studies that the time varying pumping policy in the groundwater bioremediation is less expensive than the steady state pumping policy shieh and peralta 2005 sudheer et al 2013 therefore the present study considers time varying pumping policy for the in situ bioremediation of groundwater the decision variables in the optimization of the bioremediation system varies with total number of wells w well coordinates 2 w and the pumping rate at each well for different management periods w tp hence for a scenario with w wells and tp management periods the decision variables are equal to w 2 t p the population size in pso algorithm is taken 10 times the decision variable in the present study 6 case study 1 in this case study a hypothetical confined groundwater site of 701 5 m 518 5 m size with initial concentration distribution of btex contaminant similar to the study given by shieh and peralta 2005 is selected for designing the optimal in situ bioremediation system using proposed s o model fig 2 a here no constant concentrations are imposed to generate the btex plume this problem is also investigated by other researchers sudheer et al 2013 yadav et al 2016 raei et al 2017 for estimating the optimal bioremediation cost with different s o models the maximum btex concentration in the groundwater is 40 mg l the selected site has constant head boundaries on the eastern and western sides with head values of 31 4 m and 27 7 m respectively and both northern and southern sides are no flow boundaries the groundwater is in steady state condition and it flows from west to east side with an initial hydraulic gradient of 0 004 this site is also surrounded by monitoring wells in all the four directions to monitor the groundwater contamination the oxygen concentration is 0 mg l in btex contaminated region and it is 5 mg l in the remaining area for the bioefgm simulations the problem domain is discretized into 432 nodes 24 18 as shown in fig 2b the model parameters for running the bioremediation simulations using bioefgm model are given in table 1 also the value of α i 1 is taken for the size of influence domain as discussed in pathania et al 2019 initially the natural biodegradation of btex hydrocarbons is simulated by bioefgm model for a period of 5 years and the predicted btex distribution in the site is shown in fig 3 this degradation process is also simulated by rt3d clement 1997 for the validation of the proposed model it can be seen in fig 3 that both the bioefgm and rt3d simulated plumes make a good match also the btex concentration along the central longitudinal axis simulated with bioefgm and rt3d models for three different years are shown in fig 4 a and are matching closely fig 3 also shows that the btex compounds are found in groundwater in the monitoring wells on the eastern side after 5 years according to shieh and peralta 2005 the btex concentration in the monitoring wells should not exceed 1 mg l therefore bioremediation is necessary for this contaminated site here the bioremediation technique is assumed to be applied for 2 5 years with an objective to minimize the in situ bioremediation cost and achieve the residual btex concentration value less than the permissible concentration limit cmax of 1 mg l with in the study area for this case the lower and upper limits set on the pumping rates for both injection and extraction wells are 0 and 1 26 l s respectively the allowable minimum and maximum hydraulic head values for the injection wells are 27 7 m and 33 5 respectively and are 24 4 m and 30 5 m for the extraction wells respectively the maximum concentration of oxygen to be injected through injected wells is 8 mg l to identify the optimal bioremediation strategy two plans first with one injection and one extraction wells and the second with two injection and one extraction wells are considered in this study here the total remediation time of 2 5 years is divided into 5 management periods each of six months duration and the time varying pumping policy is selected for the bioremediation operation the proposed bioefgm pso model is applied to both the plans and the obtained bioremediation costs are given in table 2 the plan 1 with one injection and one extraction wells provided the least bioremediation cost and hence is the best plan for the bioremediation of selected aquifer site the percentages of btex mass biodegraded and extracted with both the plans are also shown in table 2 the comparison of the optimized bioremediation cost from the presented model with those estimated in the past similar studies is shown in table 3 it is clear that the proposed model is more efficient as it gives minimum cost for designing the bioremediation system for this case study moreover the acceptable btex concentration after bioremediation is 1 mg l in the current study unlike in previous similar studies where it is taken as 5 mg l furthermore total remediation time taken is 2 5 years and it is taken 3 years in other studies sudheer et al 2013 yadav et al 2016 raei et al 2017 in fig 5 it can be seen that for both the plans the designed systems reduce btex concentration below the acceptable limit it indicates that the concentration constraint on reduced btex concentration after the total remediation period is satisfied in both the plans the maximum residual concentration is found to be 1 mg l in both the plans the optimal well locations found in the study area for both the plans 1 and 2 are also shown in figs 5a and 5b respectively it can be noticed that these locations do not coincide with the predefined meshless nodes and thus the bioefgm pso model is highly efficient and saves significant amount by exploring such locations the optimal pumping patterns estimated by the proposed model for both the plans are shown in fig 6 for the plan 1 the depletion of btex concentration estimated by the proposed model at the end of 5 management periods are shown in fig 7 the concentration contours for oxygen at the end of 5 management periods are also shown in fig 7 the estimated hydraulic heads at the end of all the management periods are shown in 8 from fig 8 it is clear that hydraulic head constraints were also satisfied in the designed bioremediation system the optimum pumping policy presented in fig 6 shows that for the first four management periods only extraction well was active for remediation and for the last period both injection and extraction wells were active from fig 7 it can be seen that as the time progresses btex plume is contracting towards the wells and oxygen starts occupying the clear regions the total volume of water injected and extracted and the bioremediation cost for the plan 1 in the present study is also compared with their counterparts in previous studies and are presented in table 4 this case study shows the effectiveness of the proposed bioefgm pso model 6 1 node convergence study and optimal costs the optimal in situ bioremediation system designed above is based on the 432 24 18 nodes in the problem domain here the internodal spacing is 30 5 m in the x and y directions and it is equivalent to the size of the grid cells 30 5m 30 5m in the past studies for comparing the in situ bioremediation costs shieh and peralta 2005 sudheer et al 2013 yadav et al 2016 raei et al 2017 in this study node convergence study is also conducted using the three other finer nodal arrangements for this uniformly spaced and successively increasing finer nodes with 588 28 21 910 35 26 and 1645 47 35 nodes are assumed in the study area for all these arrangements the natural biodegradation process is simulated with bioefgm as well as with rt3d for the verification purpose the model parameters are similar to the previous section table 1 the influence domain sizes and grid cell sizes for these arrangements are 25 98 m 25 93 20 63 m 20 74 m and 15 25 m 15 25 m respectively for all the finer nodes btex concentration profiles along the central longitudinal axis at the end of three different years are shown in figs 4b 4c and 4d it can be seen that bioefgm results are nearly equivalent to the rt3d results in all the three arrangements from fig 4 it can be noticed that the node and grid convergences for bioefgm and rt3d models respectively takes place with 1645 nodes and 1564 46 34 grids bioefgm results with 588 and 910 nodes are also close to the convergent solution with 1645 nodes figs 4b 4c and 4d the computational times for the matlab code to simulate the natural biodegradation for a period of 5 years with all nodal arrangements are also calculated on a computer with an intel r core tm i7 4790 3 60 ghz processor and 8 gb ram the computational times calculated with 432 588 910 and 1645 nodes and time step δt of 1 day in bioefgm are 7 97s 10 85s 16 50s and 35 16s respectively on simulating the same degradation process using the above total nodes and δ t 5 days the bioefgm solutions remain almost same and respective computational times decrease to 3 52s 4 42s and 7 42s and 15 44s respectively the higher δt values such as 9 125 days 18 25 days and 36 5 days are also tested in bioefgm and it has provided the close results for the above configurations this feature makes the proposed bioefgm pso model computationally more efficient for designing the optimal strategies for in situ bioremediation the proposed s o model is also applied to find the optimal well locations and in situ bioremediation costs with aforementioned finer nodes in the study area the optimal well locations percentages of btex masses biodegraded and extracted and in situ bioremediation costs with varying total nodes are given in table 5 it can be noticed from table 5 that in situ bioremediation cost decreased to 109 013 with 910 nodes in comparison to 120 032 and 118 058 with 432 and 588 nodes respectively in the problem domain moreover optimal locations of the wells are different than the grid nodes table 5 and it indicates the application potential of the developed s o model the optimal pumping schedules with 588 and 910 nodes in the study area are presented in fig 9 7 case study 2 this case study deals with the designing of an optimal in situ bioremediation system for a field type hypothetical large aquifer system contaminated with btex hydrocarbons most of the previous studies have considered small aquifer systems with regular boundaries here a hypothetical large aquifer with initial btex plume as shown in fig 10 a is considered for finding an optimal strategy for in situ bioremediation using the bioefgm pso model the aquifer is a confined aquifer and of 6 93 km2 area the western and eastern head boundaries of the aquifer are 50 m and 30 m respectively and the northern and southern sides are no flow boundaries for the bioefgm simulations the problem domain is approximated with 758 meshless nodes as shown in fig 10b and α i 1 is assumed for setting the influence domain size the model parameters for this case study are given in table 1 the initial btex plume presented in fig 10a is also simulated using the given boundary conditions and model parameters an ust leaking btex contaminants at location shown fig 10a is assumed as a source of contamination it is assumed that btex contaminants with concentration of 20000 mg l are released at the rate of 1 m3 d for two years this transport process is simulated with bioefgm for five years and the final concentration values less than 5 mg l are made zero to get the initial configuration of the plume fig 10a the maximum btex concentration is 34 mg l in the groundwater the initial oxygen concentration is assumed as 8 mg l in the entire site except the contaminated region where it is 0 mg l for this problem efgm based flow model is first applied to simulate steady state groundwater levels in the aquifer and these are similar to modflow harbaugh 2005 simulated levels as shown in fig 11 a the natural biodegradation of btex contaminants is then simulated with both bioefgm and rt3d models for a period of 5 years the simulated btex plumes from both the models are shown in fig 11b and their similar shapes verify the bioefgm solution for this problem the btex plume joins monitoring wells on the western side of the aquifer after 5 years as shown in fig 11b and this situation is considered as undesirable to prevent it from happening the proposed bioefgm pso model is tested with three different plans given in table 6 for finding the best one for optimal bioremediation of btex contamination here the total bioremediation period is assumed as 3 years and it is divided into three management periods each of 1 year duration the allowable btex concentration after the completion of bioremediation operation is set as 3 mg l the pumping limits on the injection and extraction wells are 0 and 1 26 l s the upper and lower limits on the head values for the injection wells are 50 m and 35 respectively and are 47 m and 30 m for the extraction wells respectively the oxygen concentration injected through each injection well is considered as 12 mg l the values of the different cost coefficients for this case are also taken from shieh and peralta 2005 on testing the different plans in bioefgm pso model the estimated different cost components and the total bioremediation costs for all the three plans are presented in table 7 it indicates that the plan 1 with 2 injection and 3 extraction wells is the best plan the optimal well locations for all the plans are given in table 8 and these are different from locations of 758 nodes in fig 10b and it represents the importance of the proposed s o model the percentages of btex mass biodegraded and extracted with all the three plans are also shown in table 8 the magnified picture of the abcd region fig 10b with optimal well locations and the remaining btex concentrations for plan 1 and plan 2 are shown in fig 12 this figure also shows that the residual concentration is less than acceptable limit for both the plans and for the last plan this constraint was also satisfied the optimal pumping rates given by the developed s o model for all the assumed plans are shown in fig 13 for the plan 1 the changing configuration of the btex plume and oxygen concentration distribution within the abcd portion of fig 10b for 3 management periods during in situ bioremediation operation are shown in fig 14 from figs 14 it is can be seen that on the right half of the abcd portion btex plume is shrinking and oxygen concentration is increasing after each management period however on its left half both btex and oxygen concentrations decrease with the time this case study shows the effectiveness of the proposed bioefgm pso model for the optimal bioremediation of large field type aquifer systems 8 discussion in the present study efgm based bioefgm model is presented first to solve the governing gfct equations in the bioremediation model in the past studies fdm fem based numerical models were used for running the bioremediation simulations in the optimal design of in situ bioremediation system which can provide optimal well locations only at the grid nodes however in the proposed bioefgm pso model bioefgm allows pso to check anywhere in the flow domain for the optimality of the well locations because of its meshless nature in the efgm based models efgm shape functions disagree with the kronecker delta function property due to the use of mls approximation therefore simpler and computationally efficient penalty method is used to implement the dirichlet boundary conditions in the bioefgm model also for the current study the developed matlab code for bioefgm pso model is optimized by storing the global matrices computed using the discretized field nodes and then replacing the contribution of the few local matrices with similar new matrices in respective global matrices for all the particles at each pso iteration for a pso particle the new local matrices are calculated using the shape function and its derivatives values at well locations stored in it and the discretized nodes participated in computing the corresponding old local matrices therefore in the proposed s o model it is computationally easier to test a well location anywhere in the simulation domain for the optimized in situ groundwater bioremediation however to carry out the similar task with fdm fem they require remeshing of the simulation domain for all the particles at each pso iteration and overall it becomes a computationally expensive task in the optimization problems the fine meshing of the computational domain in fdm fem can increase the search space for the optimal locations however the large size of the global matrices is computationally not good for optimization problems on groundwater bioremediation in both the case studies presented in this paper bioefgm model is first validated with rt3d model and then coupled with the pso the proposed bioefgm pso model is applied to both of them for the optimal design of in situ bioremediation system for btex contaminated groundwater according to belytschko et al 1994 the irregularity of nodes does not affect efgm performance and hence same caused due to addition of well locations by pso during the search operation does not influence the bioefgm results the first case study from shieh and peralta 2005 has been used in several past studies to demonstrate the benefits of the developed s o model in the previous studies the acceptable btex concentration limit for this problem is 5 mg l however this limit is set as 1 mg l in this study also the total remediation period is selected lesser than that in the previous studies on applying the developed s o model to this problem it provided the best optimal in situ bioremediation system design proposed till date in the second case study an attempt is made for the first time to design an optimized groundwater bioremediation system for a contaminated large aquifer system the proposed s o model worked effectively for this problem also in both the case studies we found that optimal well locations estimated by the developed s o model were not the grid nodes it indicates that the coupling of a meshless model with pso is an effective technique for increasing the search space for optimal well locations and designing a better optimal in situ bioremediation system though in this study only two dimensional problems are considered the proposed s o model can potentially be modified to simulate in situ bioremediation processes in three dimensions 9 conclusions in this study a new s o model called bioefgm pso is developed for the optimal design of in situ bioremediation system in the proposed s o model meshless bioefgm allows pso to search all the possible locations including both discretized nodes as well as remaining area for the optimal well locations in the aquifer system for the studied problems bioefgm model results are found closer to rt3d results and hence it can be used as an alternate numerical model for bioremediation simulations the developed bioefgm pso model was used to design optimal in situ bioremediation system first for a well known case study and then for a contaminated large aquifer system the results of the first case study demonstrate the advantages of the proposed s o model in comparison to the existing s o models it was found that the estimated optimal bioremediation cost from the bioefgm pso is less than the same evaluated using different s o models in the past studies bioefgm pso designed optimal bioremediation system has the potential to increase the degradation of btex contaminants in the groundwater sites this is because the maximum acceptable btex limit was set to 1 mg l in the first case study in contrast to 5 mg l in the past studies also the optimal strategy from the proposed s o model made remediation process faster in the groundwater bioremediation the proposed model can be more useful in designing the optimized bioremediation systems for large aquifers as illustrated in the second case study presented in both the presented case studies the optimal well locations identified by the bioefgm pso model were not located at the field nodes and hence it reduces the bioremediation cost by exploring these positions by means of the meshless property of the efgm therefore the proposed s o model is an effective tool for designing the optimal strategy for in situ bioremediation of groundwater contamination in an aquifer system author contributions 1 tinesh pathania conceived the idea and developed a simulation optimization model s o for the optimal design of an in situ bioremediation system 2 t i eldho provided the important feedbacks in developing the s o model and helped in applying it to the aquifer problems 3 tinesh pathania and t i eldho prepared the draft paper and finally andrea bottacin busolin revised the manuscript critically for intellectual content declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper supplementary material supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103707 appendix a supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
420,an optimal design of in situ bioremediation system for contaminated aquifer sites mainly depends on the injection extraction well locations and their pumping rates previous studies have used discretization approaches such as finite difference method fdm or finite element method fem to solve the equations of groundwater flow and contaminant transport gfct that characterize the bioremediation processes in these numerical models well locations can only lie at the grid nodes and therefore the locations other than the grid nodes remain unexplored for the optimal in situ bioremediation to explore such locations in this study a meshless simulation model called bioefgm is developed using the element free galerkin method efgm and coupled with the particle swarm optimization pso bioefgm model provides flexibility in adding injection extraction wells anywhere in the computational domain during the entire optimization procedure however fdm fem requires meshing and re meshing of the computational domain for each set of wells and it increases the computational efforts significantly for solving the optimization problem in this paper the proposed bioefgm pso simulation optimization s o model is first applied to a well known bioremediation problem and then to a field type large aquifer problem the simulation results of bioefgm are verified with those from the rt3d simulations the estimated bioremediation cost from the bioefgm pso model for the first problem is found to be lesser in comparison to the same calculated with different s o models in the previous studies the results of this problem also show that optimized in situ bioremediation system designed by proposed s o model takes less remediation time and also favor effective biodegradation of contaminants for both the problems bioefgm pso identified optimal well locations at positions other than that of discretized nodes and it leads to efficient bioremediation it indicates the effectiveness of the bioefgm pso model and therefore can be applied for designing the better optimized in situ bioremediation systems for field problems keywords bioefgm pso element free galerkin method groundwater contamination in situ bioremediation meshless simulation 1 introduction groundwater resources store large part of the world s fresh water and act as a vital source of drinking water fan 2015 because these resources are located underneath the earth s top crust therefore are poorly managed and over exploited zaporozec 1981 worldwide many groundwater sites are facing a serious problem of contamination the contamination through petroleum products is one of the major issues the large number of underground storage tanks ust s are used to store petroleum products such as gasoline diesel fuel kerosene oil etc and their leakage from ust s result in contamination of the groundwater resources the petroleum hydrocarbons contain toxic organic chemicals such as benzene toluene ethylbenzene and xylenes btex bedient et al 1994 the presence of such organic contaminants even in small amount in groundwater can deteriorate aquifer health and make it unfit for supplying drinking water to public the natural attenuation processes can clean btex contaminated aquifers up to a certain limit it includes the processes of hydrodynamic dispersion sorption and volatilization which reduces contaminant concentration in the groundwater and biodegradation that reduces mass of contaminants wiedemeier et al 1999 for btex contaminated aquifers biodegradation is the most suitable attenuation process since it reduces actual mass of btex compounds by consuming the available oxygen in the groundwater usepa 2004 in groundwater sites with large btex concentration biodegradation process results in depletion of oxygen in the core of the plume and thereby it stops further degradation of btex compounds to stimulate the biodegradation of these petroleum hydrocarbons in situ bioremediation is the most preferred cleaning technique in situ groundwater bioremediation is a technique that promotes the growth and reproduction of indigenous microorganisms to increase the biodegradation rate of organic compounds in the saturated region usepa 2004 this is achieved by supplying electron acceptors such as oxygen and nitrate and nutrients such as nitrogen and phosphorus to the microorganisms in the contaminated region in situ bioremediation employs the use of both injection and extraction wells in the polluted groundwater site the injection wells are used to transport electron acceptors and nutrients to the microorganisms the extraction wells are used to increase the hydraulic gradient control the plume movement and remove the contaminants from the aquifer system this remediation approach can effectively degrade dissolved and adsorbed organic compounds in the groundwater and soil respectively schreiber and bahr 2002 designing an optimal in situ bioremediation system is an important exercise for groundwater scientists and is mainly dependent on the wells location and their injection extraction rates it can be designed using the different s o models which couple gfct based bioremediation simulations with the optimization algorithms over the last few decades several studies on in situ groundwater bioremediation have been reported yoon and shoemaker 1999 used the bio2d model proposed by taylor 1993 for bioremediation simulations and applied different optimization algorithms to find out the fastest algorithm for designing the optimized in situ bioremediation system later yoon and shoemaker 2001 used a real coded genetic algorithm rga for the optimal in situ bioremediation shieh and peralta 2005 coupled the bioplume ii model proposed by rifai et al 1987 with a hybrid algorithm combining genetic algorithm ga and simulated annealing sa for the optimal design of in situ bioremediation system prasad and mathur 2008 used the artificial neural network ann as a proxy simulator of bioplume iii rifai et al 1997 and presented a technique based on ann and monte carlo approach for identifying the potential well locations for an optimal in situ bioremediation sudheer et al 2013 trained the support vector machine svm with biofdm simulations and combined it with the pso for scheduling the optimum pumping policy for in situ bioremediation yadav et al 2016 used the extreme learning machine elm as a proxy simulator of bioplume ii and combined it with pso for finding the optimal strategy for in situ groundwater bioremediation in most of the aforementioned studies the case study of shieh and peralta 2005 is solved using different s o models and the optimal well locations were determined from the limited preselected locations prasad and mathur 2008 sudheer et al 2013 yadav et al 2016 however raei et al 2017 used all the grid nodes in the same study area as a search space to find out the optimal well locations using this approach and calling bioplume iii simulations within nsga ii they found that bioremediation cost decreases by 20 to 40 of costs estimated in studies with predefined well locations in the optimal design of groundwater bioremediation system well locations are the important decision variables in the past several studies the mesh based methods fdm fem have been mostly used for running the gfct simulations of the bioremediation mechanism yoon and shoemaker 1999 2001 shieh and peralta 2005 prasad and mathur 2008 sudheer et al 2013 yadav et al 2016 raei et al 2017 the mesh based simulation models provide optimal well locations only at the grid nodes in the optimized bioremediation system however optimal well locations can also lie at the locations other than the grid nodes in such cases meshless methods provide advantages over the mesh based methods and can be used to locate optimal well coordinates anywhere inside the problem domain these methods are recently emerged as better alternative of fem fdm and are independent of remeshing procedure unlike fdm fem a meshless method uses scattered field nodes to represent problem domain and its boundaries the governing equations are then discretized using the field variable values at the scattered nodes in the recent decade different meshless models namely element free galerkin method efgm point collocation method pcm meshless local petrov galerkin method mlpg have been successfully applied over the real field gfct problems meenal and eldho 2011 first developed a meshless pcm based groundwater flow model and subsequently they also developed a pcm based contaminant transport model for the unconfined flow meenal and eldho 2012 swathi and eldho 2014 presented a mlpg based model for the unconfined groundwater flow problems and later on they developed the mlpg based model for the contaminant transport problems boddula and eldho 2017 pathania et al 2019 proposed a efgm based groundwater model for the unconfined aquifers and demonstrated its suitability to field aquifers with surface water groundwater interactions among the meshless gfct models pcm has also been used for the in situ bioremediation simulations by mategaonkar and eldho 2012 they coupled the pcm simulations with the pso algorithm for proposing an optimized bioremediation strategy recently seyedpour et al 2019 used the meshless rpcm based gfct simulations and ga for the optimal design of groundwater remediation efgm is a robust meshless method and therefore it has been applied in many practical engineering problems liu and gu 2005 efgm uses moving least squares mls approximation in the galerkin weak form to produce a set of algebraic equations belytschko et al 1994 in efgm mls approximation provides stability in function approximation and the galerkin approach construct a discretized global system equations that gives a stable solution liu and gu 2005 the integral operator in efgm helps to smooth the error due to function approximations however differential operator in meshless collocation methods tend to increase this error liu and gu 2005 efgm possess high accuracy and convergence rate than the fem fdm since it uses more support nodes for constructing the shape functions liu and gu 2005 the irregular arrangement of the nodes also does not influence efgm performance belytschko et al 1994 moreover the meshless feature of the efgm offers convenience to add remove well at any location during the entire optimization process and thus provides more search space to explore the optimal well locations within the problem domain therefore this study first develops the efgm based new simulation model called bioefgm for the bioremediation simulations in the recent years pso has been successfully applied with different simulation models for the optimal in situ groundwater bioremediation of aquifers mategaonkar and eldho 2012 sudheer et al 2013 yadav et al 2016 therefore in this study pso algorithm is used to design the optimal bioremediation system in the present study we propose bioefgm pso based a new s o model for the optimal design of in situ groundwater bioremediation system the proposed model finds optimal well locations and pumping rates by coupling the efgm based bioremediation simulations with the pso bioefgm is free from meshing and remeshing procedure unlike fdm fem and therefore can easily accommodate a set of new wells in the simulation domain at each iteration of an optimizer it also reduces a lot of computational efforts required in solving optimization problems in this study the proposed s o model is first applied to a well known bioremediation problem of shieh and peralta 2005 and it has also been solved using different s o models in the similar previous studies sudheer et al 2013 yadav et al 2016 raei et al 2017 further the proposed s o model is used to design an optimized bioremediation system for a hypothetical field type large aquifer system in the past only simple hypothetical aquifers have been considered and the present study also considers a hypothetical field type large aquifer with irregular boundaries the proposed s o model is very useful and can save costs associated with highly expensive bioremediation technique by finding optimal injection extraction locations at those points otherwise remains unexplored locations with mesh based methods for the similar nodal configuration of the problem domain 2 bioefgm simulation model development in this section a two dimensional efgm model called bioefgm is presented for the simulation of biodegradation of organic contaminants within the groundwater in bioefgm efgm technique is used to discretize the governing gfct equations which represent the bioremediation process in efgm the weak integral of the governing equation weighted with mls based shape functions is made zero efgm shape functions are derived using the mls approximation and details are given in park and leap 2000 in this study the weighting function used is cubic spline for calculating the efgm shape functions and its expression can also be seen in park and leap 2000 the governing equation for the two dimensional groundwater flow in a confined aquifer is represented as bear 1979 1 s h t x t x h x y t y h y q w q f here h is the hydraulic head m tx and ty are the transmissivities in the x and y directions m2 d s is the storage coefficient qw denotes the source sink term m d qf is the inflow rate m d and t is time d the weak integral representation of eq 1 for groundwater flow through the homogeneous and anisotropic soil weighted with efgm shape functions is given as 2 ω t x 2 h x 2 t y 2 h y 2 q w q f s h t φ d ω 0 where vector φ consists of efgm shape function at n local nodes inside the influence domain and expressed as liu and gu 2005 3 φ ϕ 1 ϕ 2 ϕ 3 ϕ n t the complete efgm procedure for deriving the system of equations for unknown heads is given in pathania et al 2019 and its final matrix form can be written as 4 k 1 k 2 1 δ t p h j t δ t f j 1 δ t p h j t where h j t δ t is a column vector of unknown heads for time t δ t the elements of the different global matrices in eq 4 are calculated as 5a k i j 1 ω t x i ϕ i x y x ϕ j x y x d ω 5b k i j 2 ω t y i ϕ i x y y ϕ j x y y d ω 5c p i j s ω ϕ i x y ϕ j x y d ω 5d f i ω ϕ i x y ϕ j x y q f j d ω ω ϕ i x y ϕ j x y q w j d ω where i j 1 2 3 n n is the total nodes used to represent the entire aquifer system the governing transport equations for the migration of biodegradable contaminant and oxygen in the two dimensional aquifer are respectively expressed as rifai et al 1997 6 c b t 1 r b x i d i j c b x j v i c b x i q c b b θ 7 c o t x i d i j c o x j v i c o x i q c o b θ here i j 1 2 x and y directions vi is the groundwater velocity in ith direction m d dij denotes the hydrodynamic dispersion tensor m2 d cb and c 0 are the concentration of biodegradable contaminant and oxygen respectively in the flow region mg l and c b and c 0 are their respective concentrations in source sink liquid mg l q represents the volumetric flux at source sink location m d rb is the retardation factor for biodegradable contaminant b denotes the saturated thickness of an aquifer and θ is the effective porosity in this study constant oxygen concentration equal to the initial oxygen concentration in the groundwater system is imposed on the upstream boundary and the remaining boundaries are assumed as the free boundaries in eqs 6 and 7 v 1 v x v 2 v y d 11 d x x d 22 d y y and for i j d i j 0 are assumed for this study the groundwater velocities in the x and y directions are calculated using the darcy law and expressed as 8 v x k x θ h x v y k y θ h y where kx and ky are the hydraulic conductivities in the x and y directions m d the stoichiometry expressions for the aerobic degradation of different btex components indicate that oxygen required for the oxidization of 1 mg l benzene 1 mg l toluene 1 mg l ethylbenzene and 1 mg l xylene are 3 08 mg l 3 13 mg l 3 17 mg l and 3 17 mg l respectively rifai et al 1997 however in this study btex contaminants are considered as a single contaminant and the utilization factor u discussed later for btex degradation and oxygen consumption is taken as 3 08 as that of the benzene which is least degradable among all the components the weak integral representation of eq 6 weighted with efgm shape functions is given as 9 ω x d x x c b x y d y y c b y v x c b x v y c b y r b q c b b θ r b c b t φ d ω 0 on applying the property of green s theorem to the first two terms in eq 9 it modifies to 10 γ e d x x c b x n x φ d γ ω d x x c b x φ x d ω γ e d y y c b y n y φ d γ ω d y y c b y φ y d ω ω v x c b x φ d ω ω v y c b y φ d ω ω r b q c b b θ φ d ω ω r b c b t φ d ω 0 where nx and ny are the x and y components of a unit vector normal to the boundary respectively in above eq 10 φ x and φ y are the vectors of first derivative of shape function with respect to x and y respectively at n local nodes liu and gu 2005 and are expressed as 11 φ x ϕ 1 x ϕ 2 x ϕ 3 x ϕ n x t 12 φ y ϕ 1 y ϕ 2 y ϕ 3 y ϕ n y t eq 10 can be rearranged into following form 13 ω d x x c b x φ x d ω ω d y y c b y φ y d ω ω v x c b x φ d ω ω v y c b y φ d ω ω r b q c b b θ φ d ω ω r b c b t φ d ω γ e d x x c b x n x φ d γ γ e d y y c b y n y φ d γ in efgm the trial solution used for the contaminant concentration is expressed as praveen kumar and dodagoudar 2010 14 c b x y t j 1 n c b j t ϕ j x y the time derivative term in eq 13 can be discretized as given below pinder and gray 1977 wang and anderson 1982 15 c b j t c b j t δ t c b j t δ t where c b j t and c b j t δ t are the contaminant concentration at node j at time t and t δ t respectively on using eqs 3 11 12 14 and 15 in eq 13 it gives 16 ω d x x i ϕ i x y x ϕ j x y x c b j t δ t d ω ω d y y i ϕ i x y y ϕ j x y y c b j t δ t d ω ω v x i ϕ i x y ϕ j x y x c b j t δ t d ω ω v y i ϕ i x y ϕ j x y y c b j t δ t d ω ω r b ϕ i x y ϕ j x y c b j t δ t c b j t δ t d ω g 1 γ e ϕ i x y d γ ω r b b θ ϕ i x y ϕ j x y q j c b j d ω where i j 1 2 3 n and g 1 is used here to represent the given dispersive flux normal to the boundary in eq 16 all the integral terms are based on the local numbering system and on transforming it to the global numbering system gives following matrix form 17 m 1 m 2 m 3 m 4 r b δ t m 5 c b j t δ t f j 1 r b δ t m 5 c b j t in eq 17 the column vector c b j t δ t provides the nodal contaminant concentrations at time t δ t and the elements of its global matrices are calculated as 18a m i j 1 ω d x x i ϕ i x y x ϕ j x y x d ω 18b m i j 2 ω d y y i ϕ i x y y ϕ j x y y d ω 18c m i j 3 ω v x i ϕ i x y ϕ j x y x d ω 18d m i j 4 ω v y i ϕ i x y ϕ j x y y d ω 18e m i j 5 ω ϕ i x y ϕ j x y d ω 18f f i 1 g 1 γ e ϕ i x y d γ r b b θ ω ϕ i x y ϕ j x y q j c b j d ω where i j 1 2 3 n the shape functions in efgm do not follow the kronecker delta function property therefore dirichlet boundaries are provided in eq 17 using the simple and computationally cheapest penalty method zhu and atluri 1998 eq 17 is then solved to obtain the contaminant concentration at all the discretized nodes in the simulation domain at time t δ t on applying the above efgm approach also to eq 7 for the oxygen transport through an aquifer yields the following global matrix expression 19 m 1 m 2 m 3 m 4 1 δ t m 5 c o j t δ t f j 2 1 δ t m 5 c o j t where the elements of global vector f 2 are calculated as 20 f i 2 g 2 γ e ϕ i x y d γ 1 b θ ω ϕ i x y ϕ j x y q j c o j d ω where g 2 is the given normal boundary flux for eq 7 on solving eq 19 c o j t δ t gives oxygen concentration at all the nodes in the simulation domain at time t δ t in the proposed bioefgm model eqs 17 and 19 are solved first to obtain the contaminant and oxygen concentrations in the aquifer and then these are used to simulate the biodegradation of organic contaminants by means of instantaneous reaction model developed by borden and bedient 1986 the instantaneous reaction model assumes that the consumption of organic contaminants and oxygen by the microorganism can be simulated as an instantaneous reaction between both of them the instantaneous reaction is simulated by combining both contaminant and oxygen plumes using the principle of superposition and the change in their respective concentrations are calculated as 21a δ c b o c o u c o 0 if c b c o u 21b δ c o b c b u c b 0 if c o c b u where δcbo and δcob are the reduction in contaminant and oxygen concentrations respectively during the biodegradation operation u is the ratio of oxygen used to contaminant degraded and known as utilization factor 3 particle swarm optimization the particle swarm optimization pso is a well known metaheuristic optimizer proposed by kennedy and eberhart 1995 and mimics the social behavior of birds flocking the pso initially assume a population of random possible solutions termed as particles and assign each particle both the random location and velocity the particle location represents the possible value of decision variables in one dimensional array and the velocity component drives a particle to move and search the optimal solution in pso during the course of iterations each particle moves in the problem search space using the information of its own premier location and the premier particle location in the swarm the premier location is determined on the basis of fitness calculated from the objective function value the mathematical model used to update the current location and velocity of the each particle in pso and make necessary movements iteratively in the search space is expressed as 22 x i k 1 x i k v i k 1 where the particle velocity is calculated as 23 v i k 1 w v i k c 1 r 1 p i k x i k c 2 r 2 p g k x i k where x and v denote the location and velocity of the particle respectively i and k represent particle and iteration numbers respectively pi stores the premier location of the ith particle pg stores the location of the premier particle in the swarm v i k 1 represents the new velocity acquired by a particle in the next iteration w denotes inertia weight c 1 and c 2 are the cognitive and social parameters respectively and r 1 and r 2 take random values within 0 and 1 4 mathematical model for optimal in situ bioremediation cost the mathematical expression for the objective function used to determine optimal in situ bioremediation cost is given by shieh and peralta 2005 this objective function includes well installation cost pumping treatment cost and facility capital cost and mathematically expressed as 24 m i n i m i z e r t 1 t p 1 1 d r t l p w 1 w c f w q w t w 1 w c s w i w m a x c i w 1 w i q w t t 1 t p m a x c t w 1 w e q w t t 1 t p the eq 24 is subjected to the following constraints 1 the residual contamination in the study region after the total remediation period should satisfy 25 0 c b t k 0 c m a x k 0 k 0 φ 2 in the monitoring wells contaminant concentration should not exceed the assumed concentration limit also the selected injection rates should hold the contamination within the simulation domain therefore 26 0 c b t k 0 c m a x k 0 t 1 2 t p k 0 ψ 3 during the entire remediation period the aquifer head should always lie between the selected minimum and maximum head values this is to ensure that the assumed pumping rates do not dilute the contaminant in the groundwater and lower down the concentration to desired limits within short duration 27 h m i n t k 0 h t k 0 h m a x t k 0 t 1 2 t p k 0 φ 4 both the injection and extraction wells can operate only up to their maximum capacities therefore the selected injection extraction rates should satisfy 28a 0 q i t q i m a x t t 1 2 t p 28b 0 q e t q e m a x t t 1 2 t p where r total cost associated with the in situ bioremediation process dr discount rate t total bioremediation time years tp no of time periods in total remediation time lp duration of single time period year w well locations in the aquifer i w integer with zero or one value for defining the feasibility of the wells at possible locations wi total number of injection wells we total number of extraction wells w w i w e total number of wells q w pumping rates at well location w l s cf cost coefficient for injection including oxygen nutrient and pumping costs or extraction including treatment and pumping operation cost per l s cs cost for installing the injection or extraction wells for the remediation purpose c i w 1 w i q w t facility capital cost for delivering the oxygen and nutrients to the contaminated groundwater site and it varies with the total injection rate c t w 1 w e q w t facility capital cost for treating the extracted groundwater and it varies with the total extraction rate h i t k 0 hydraulic head at node k 0 for time period t m h min t k 0 minimum acceptable hydraulic head at node k 0 for time period t m h max t k 0 maximum acceptable hydraulic head at node k 0 for time period t m q i t injection rate for time period t l s q e t extraction rate for time period t l s q i m a x t maximum acceptable injection rate for time period t l s q e m a x t maximum acceptable extraction rate for time period t l s c b t k 0 contaminant concentration at node k 0 at time period t mg l c b t k 0 reduced contaminant concentration at node k 0 after bioremediation operation completely ends mg l cmax k0 maximum acceptable limit for the residual contaminant concentration at node k 0 after stopping the in situ bioremediation operation mg l ψ array with locations of monitoring wells in the aquifer φ array with locations of all field nodes in the aquifer 5 bioefgm pso model development in the proposed bioefgm pso model the bioefgm model developed in the section 2 is coupled with the pso for designing the optimized in situ bioremediation systems in this study bioefgm code is written in matlab and coupled with its pso solver in bioefgm head values are calculated first from the efgm flow model and then these values are used to compute the groundwater velocities using the darcy law thereafter these velocities are supplied to the efgm based transport models for oxygen and contaminant in efgm models the integral expressions are calculated using gauss quadrature scheme and it uses background cells for evaluating them each background cell is assumed to have 4 4 gauss points in this study in the developed s o model pso in its each iteration provides improved value of decision variables well locations and pumping rates to bioefgm model and thereby finds optimal solution for the in situ bioremediation problem the steps involved in finding the optimal solution using the proposed s o model are as given below 1 input the flow and transport parameters to the bioefgm model and these are hydraulic conductivity storage coefficient aquifer thickness effective porosity retardation factor longitudinal and transverse dispersivity 2 approximate the entire problem domain with suitable number of nodes and select the size of the influence domain i e d m α i nodal spacing 3 calculate the efgm shape functions and their derivatives at local nodes within the influence domain of a gauss point 4 compute the local matrices using the above computed shape function and their derivatives values and assemble local matrices into their respective global matrices 5 repeat steps 3 and 4 for all the remaining gauss points within the computational domain to include the contribution of all the local matrices into the respective global matrices 6 define in situ bioremediation cost objective function and the problem constraints in the pso model 7 select the lower and upper bounds of the decision variables i e well coordinates and pumping rates and couple pso algorithm with the bioefgm model 8 run bioefgm pso model pso provides random values of well coordinates and pumping rates to bioefgm model from their lower and upper bound values 9 slightly modify the above computed global matrices in each iteration of pso by replacing the local contribution of those influence domains which now also surrounds newly inserted well locations 10 solve eq 4 to forecast the groundwater levels in the aquifer system and then use them to calculate the groundwater velocities in that system 11 solve eqs 17 and 19 independently for each time step to first estimate the unconsumed contaminant and oxygen concentration values these concentrations are then superimposed using the instantaneous reaction model eqs 21a and 21b and it gives the change in their respective concentrations 12 finally pso checks if stopping criteria is satisfied or not it stops if it is satisfied otherwise pso repeats the above procedure for the next iteration the flowchart for the proposed bioefgm pso model is shown in fig 1 it was demonstrated in the previous studies that the time varying pumping policy in the groundwater bioremediation is less expensive than the steady state pumping policy shieh and peralta 2005 sudheer et al 2013 therefore the present study considers time varying pumping policy for the in situ bioremediation of groundwater the decision variables in the optimization of the bioremediation system varies with total number of wells w well coordinates 2 w and the pumping rate at each well for different management periods w tp hence for a scenario with w wells and tp management periods the decision variables are equal to w 2 t p the population size in pso algorithm is taken 10 times the decision variable in the present study 6 case study 1 in this case study a hypothetical confined groundwater site of 701 5 m 518 5 m size with initial concentration distribution of btex contaminant similar to the study given by shieh and peralta 2005 is selected for designing the optimal in situ bioremediation system using proposed s o model fig 2 a here no constant concentrations are imposed to generate the btex plume this problem is also investigated by other researchers sudheer et al 2013 yadav et al 2016 raei et al 2017 for estimating the optimal bioremediation cost with different s o models the maximum btex concentration in the groundwater is 40 mg l the selected site has constant head boundaries on the eastern and western sides with head values of 31 4 m and 27 7 m respectively and both northern and southern sides are no flow boundaries the groundwater is in steady state condition and it flows from west to east side with an initial hydraulic gradient of 0 004 this site is also surrounded by monitoring wells in all the four directions to monitor the groundwater contamination the oxygen concentration is 0 mg l in btex contaminated region and it is 5 mg l in the remaining area for the bioefgm simulations the problem domain is discretized into 432 nodes 24 18 as shown in fig 2b the model parameters for running the bioremediation simulations using bioefgm model are given in table 1 also the value of α i 1 is taken for the size of influence domain as discussed in pathania et al 2019 initially the natural biodegradation of btex hydrocarbons is simulated by bioefgm model for a period of 5 years and the predicted btex distribution in the site is shown in fig 3 this degradation process is also simulated by rt3d clement 1997 for the validation of the proposed model it can be seen in fig 3 that both the bioefgm and rt3d simulated plumes make a good match also the btex concentration along the central longitudinal axis simulated with bioefgm and rt3d models for three different years are shown in fig 4 a and are matching closely fig 3 also shows that the btex compounds are found in groundwater in the monitoring wells on the eastern side after 5 years according to shieh and peralta 2005 the btex concentration in the monitoring wells should not exceed 1 mg l therefore bioremediation is necessary for this contaminated site here the bioremediation technique is assumed to be applied for 2 5 years with an objective to minimize the in situ bioremediation cost and achieve the residual btex concentration value less than the permissible concentration limit cmax of 1 mg l with in the study area for this case the lower and upper limits set on the pumping rates for both injection and extraction wells are 0 and 1 26 l s respectively the allowable minimum and maximum hydraulic head values for the injection wells are 27 7 m and 33 5 respectively and are 24 4 m and 30 5 m for the extraction wells respectively the maximum concentration of oxygen to be injected through injected wells is 8 mg l to identify the optimal bioremediation strategy two plans first with one injection and one extraction wells and the second with two injection and one extraction wells are considered in this study here the total remediation time of 2 5 years is divided into 5 management periods each of six months duration and the time varying pumping policy is selected for the bioremediation operation the proposed bioefgm pso model is applied to both the plans and the obtained bioremediation costs are given in table 2 the plan 1 with one injection and one extraction wells provided the least bioremediation cost and hence is the best plan for the bioremediation of selected aquifer site the percentages of btex mass biodegraded and extracted with both the plans are also shown in table 2 the comparison of the optimized bioremediation cost from the presented model with those estimated in the past similar studies is shown in table 3 it is clear that the proposed model is more efficient as it gives minimum cost for designing the bioremediation system for this case study moreover the acceptable btex concentration after bioremediation is 1 mg l in the current study unlike in previous similar studies where it is taken as 5 mg l furthermore total remediation time taken is 2 5 years and it is taken 3 years in other studies sudheer et al 2013 yadav et al 2016 raei et al 2017 in fig 5 it can be seen that for both the plans the designed systems reduce btex concentration below the acceptable limit it indicates that the concentration constraint on reduced btex concentration after the total remediation period is satisfied in both the plans the maximum residual concentration is found to be 1 mg l in both the plans the optimal well locations found in the study area for both the plans 1 and 2 are also shown in figs 5a and 5b respectively it can be noticed that these locations do not coincide with the predefined meshless nodes and thus the bioefgm pso model is highly efficient and saves significant amount by exploring such locations the optimal pumping patterns estimated by the proposed model for both the plans are shown in fig 6 for the plan 1 the depletion of btex concentration estimated by the proposed model at the end of 5 management periods are shown in fig 7 the concentration contours for oxygen at the end of 5 management periods are also shown in fig 7 the estimated hydraulic heads at the end of all the management periods are shown in 8 from fig 8 it is clear that hydraulic head constraints were also satisfied in the designed bioremediation system the optimum pumping policy presented in fig 6 shows that for the first four management periods only extraction well was active for remediation and for the last period both injection and extraction wells were active from fig 7 it can be seen that as the time progresses btex plume is contracting towards the wells and oxygen starts occupying the clear regions the total volume of water injected and extracted and the bioremediation cost for the plan 1 in the present study is also compared with their counterparts in previous studies and are presented in table 4 this case study shows the effectiveness of the proposed bioefgm pso model 6 1 node convergence study and optimal costs the optimal in situ bioremediation system designed above is based on the 432 24 18 nodes in the problem domain here the internodal spacing is 30 5 m in the x and y directions and it is equivalent to the size of the grid cells 30 5m 30 5m in the past studies for comparing the in situ bioremediation costs shieh and peralta 2005 sudheer et al 2013 yadav et al 2016 raei et al 2017 in this study node convergence study is also conducted using the three other finer nodal arrangements for this uniformly spaced and successively increasing finer nodes with 588 28 21 910 35 26 and 1645 47 35 nodes are assumed in the study area for all these arrangements the natural biodegradation process is simulated with bioefgm as well as with rt3d for the verification purpose the model parameters are similar to the previous section table 1 the influence domain sizes and grid cell sizes for these arrangements are 25 98 m 25 93 20 63 m 20 74 m and 15 25 m 15 25 m respectively for all the finer nodes btex concentration profiles along the central longitudinal axis at the end of three different years are shown in figs 4b 4c and 4d it can be seen that bioefgm results are nearly equivalent to the rt3d results in all the three arrangements from fig 4 it can be noticed that the node and grid convergences for bioefgm and rt3d models respectively takes place with 1645 nodes and 1564 46 34 grids bioefgm results with 588 and 910 nodes are also close to the convergent solution with 1645 nodes figs 4b 4c and 4d the computational times for the matlab code to simulate the natural biodegradation for a period of 5 years with all nodal arrangements are also calculated on a computer with an intel r core tm i7 4790 3 60 ghz processor and 8 gb ram the computational times calculated with 432 588 910 and 1645 nodes and time step δt of 1 day in bioefgm are 7 97s 10 85s 16 50s and 35 16s respectively on simulating the same degradation process using the above total nodes and δ t 5 days the bioefgm solutions remain almost same and respective computational times decrease to 3 52s 4 42s and 7 42s and 15 44s respectively the higher δt values such as 9 125 days 18 25 days and 36 5 days are also tested in bioefgm and it has provided the close results for the above configurations this feature makes the proposed bioefgm pso model computationally more efficient for designing the optimal strategies for in situ bioremediation the proposed s o model is also applied to find the optimal well locations and in situ bioremediation costs with aforementioned finer nodes in the study area the optimal well locations percentages of btex masses biodegraded and extracted and in situ bioremediation costs with varying total nodes are given in table 5 it can be noticed from table 5 that in situ bioremediation cost decreased to 109 013 with 910 nodes in comparison to 120 032 and 118 058 with 432 and 588 nodes respectively in the problem domain moreover optimal locations of the wells are different than the grid nodes table 5 and it indicates the application potential of the developed s o model the optimal pumping schedules with 588 and 910 nodes in the study area are presented in fig 9 7 case study 2 this case study deals with the designing of an optimal in situ bioremediation system for a field type hypothetical large aquifer system contaminated with btex hydrocarbons most of the previous studies have considered small aquifer systems with regular boundaries here a hypothetical large aquifer with initial btex plume as shown in fig 10 a is considered for finding an optimal strategy for in situ bioremediation using the bioefgm pso model the aquifer is a confined aquifer and of 6 93 km2 area the western and eastern head boundaries of the aquifer are 50 m and 30 m respectively and the northern and southern sides are no flow boundaries for the bioefgm simulations the problem domain is approximated with 758 meshless nodes as shown in fig 10b and α i 1 is assumed for setting the influence domain size the model parameters for this case study are given in table 1 the initial btex plume presented in fig 10a is also simulated using the given boundary conditions and model parameters an ust leaking btex contaminants at location shown fig 10a is assumed as a source of contamination it is assumed that btex contaminants with concentration of 20000 mg l are released at the rate of 1 m3 d for two years this transport process is simulated with bioefgm for five years and the final concentration values less than 5 mg l are made zero to get the initial configuration of the plume fig 10a the maximum btex concentration is 34 mg l in the groundwater the initial oxygen concentration is assumed as 8 mg l in the entire site except the contaminated region where it is 0 mg l for this problem efgm based flow model is first applied to simulate steady state groundwater levels in the aquifer and these are similar to modflow harbaugh 2005 simulated levels as shown in fig 11 a the natural biodegradation of btex contaminants is then simulated with both bioefgm and rt3d models for a period of 5 years the simulated btex plumes from both the models are shown in fig 11b and their similar shapes verify the bioefgm solution for this problem the btex plume joins monitoring wells on the western side of the aquifer after 5 years as shown in fig 11b and this situation is considered as undesirable to prevent it from happening the proposed bioefgm pso model is tested with three different plans given in table 6 for finding the best one for optimal bioremediation of btex contamination here the total bioremediation period is assumed as 3 years and it is divided into three management periods each of 1 year duration the allowable btex concentration after the completion of bioremediation operation is set as 3 mg l the pumping limits on the injection and extraction wells are 0 and 1 26 l s the upper and lower limits on the head values for the injection wells are 50 m and 35 respectively and are 47 m and 30 m for the extraction wells respectively the oxygen concentration injected through each injection well is considered as 12 mg l the values of the different cost coefficients for this case are also taken from shieh and peralta 2005 on testing the different plans in bioefgm pso model the estimated different cost components and the total bioremediation costs for all the three plans are presented in table 7 it indicates that the plan 1 with 2 injection and 3 extraction wells is the best plan the optimal well locations for all the plans are given in table 8 and these are different from locations of 758 nodes in fig 10b and it represents the importance of the proposed s o model the percentages of btex mass biodegraded and extracted with all the three plans are also shown in table 8 the magnified picture of the abcd region fig 10b with optimal well locations and the remaining btex concentrations for plan 1 and plan 2 are shown in fig 12 this figure also shows that the residual concentration is less than acceptable limit for both the plans and for the last plan this constraint was also satisfied the optimal pumping rates given by the developed s o model for all the assumed plans are shown in fig 13 for the plan 1 the changing configuration of the btex plume and oxygen concentration distribution within the abcd portion of fig 10b for 3 management periods during in situ bioremediation operation are shown in fig 14 from figs 14 it is can be seen that on the right half of the abcd portion btex plume is shrinking and oxygen concentration is increasing after each management period however on its left half both btex and oxygen concentrations decrease with the time this case study shows the effectiveness of the proposed bioefgm pso model for the optimal bioremediation of large field type aquifer systems 8 discussion in the present study efgm based bioefgm model is presented first to solve the governing gfct equations in the bioremediation model in the past studies fdm fem based numerical models were used for running the bioremediation simulations in the optimal design of in situ bioremediation system which can provide optimal well locations only at the grid nodes however in the proposed bioefgm pso model bioefgm allows pso to check anywhere in the flow domain for the optimality of the well locations because of its meshless nature in the efgm based models efgm shape functions disagree with the kronecker delta function property due to the use of mls approximation therefore simpler and computationally efficient penalty method is used to implement the dirichlet boundary conditions in the bioefgm model also for the current study the developed matlab code for bioefgm pso model is optimized by storing the global matrices computed using the discretized field nodes and then replacing the contribution of the few local matrices with similar new matrices in respective global matrices for all the particles at each pso iteration for a pso particle the new local matrices are calculated using the shape function and its derivatives values at well locations stored in it and the discretized nodes participated in computing the corresponding old local matrices therefore in the proposed s o model it is computationally easier to test a well location anywhere in the simulation domain for the optimized in situ groundwater bioremediation however to carry out the similar task with fdm fem they require remeshing of the simulation domain for all the particles at each pso iteration and overall it becomes a computationally expensive task in the optimization problems the fine meshing of the computational domain in fdm fem can increase the search space for the optimal locations however the large size of the global matrices is computationally not good for optimization problems on groundwater bioremediation in both the case studies presented in this paper bioefgm model is first validated with rt3d model and then coupled with the pso the proposed bioefgm pso model is applied to both of them for the optimal design of in situ bioremediation system for btex contaminated groundwater according to belytschko et al 1994 the irregularity of nodes does not affect efgm performance and hence same caused due to addition of well locations by pso during the search operation does not influence the bioefgm results the first case study from shieh and peralta 2005 has been used in several past studies to demonstrate the benefits of the developed s o model in the previous studies the acceptable btex concentration limit for this problem is 5 mg l however this limit is set as 1 mg l in this study also the total remediation period is selected lesser than that in the previous studies on applying the developed s o model to this problem it provided the best optimal in situ bioremediation system design proposed till date in the second case study an attempt is made for the first time to design an optimized groundwater bioremediation system for a contaminated large aquifer system the proposed s o model worked effectively for this problem also in both the case studies we found that optimal well locations estimated by the developed s o model were not the grid nodes it indicates that the coupling of a meshless model with pso is an effective technique for increasing the search space for optimal well locations and designing a better optimal in situ bioremediation system though in this study only two dimensional problems are considered the proposed s o model can potentially be modified to simulate in situ bioremediation processes in three dimensions 9 conclusions in this study a new s o model called bioefgm pso is developed for the optimal design of in situ bioremediation system in the proposed s o model meshless bioefgm allows pso to search all the possible locations including both discretized nodes as well as remaining area for the optimal well locations in the aquifer system for the studied problems bioefgm model results are found closer to rt3d results and hence it can be used as an alternate numerical model for bioremediation simulations the developed bioefgm pso model was used to design optimal in situ bioremediation system first for a well known case study and then for a contaminated large aquifer system the results of the first case study demonstrate the advantages of the proposed s o model in comparison to the existing s o models it was found that the estimated optimal bioremediation cost from the bioefgm pso is less than the same evaluated using different s o models in the past studies bioefgm pso designed optimal bioremediation system has the potential to increase the degradation of btex contaminants in the groundwater sites this is because the maximum acceptable btex limit was set to 1 mg l in the first case study in contrast to 5 mg l in the past studies also the optimal strategy from the proposed s o model made remediation process faster in the groundwater bioremediation the proposed model can be more useful in designing the optimized bioremediation systems for large aquifers as illustrated in the second case study presented in both the presented case studies the optimal well locations identified by the bioefgm pso model were not located at the field nodes and hence it reduces the bioremediation cost by exploring these positions by means of the meshless property of the efgm therefore the proposed s o model is an effective tool for designing the optimal strategy for in situ bioremediation of groundwater contamination in an aquifer system author contributions 1 tinesh pathania conceived the idea and developed a simulation optimization model s o for the optimal design of an in situ bioremediation system 2 t i eldho provided the important feedbacks in developing the s o model and helped in applying it to the aquifer problems 3 tinesh pathania and t i eldho prepared the draft paper and finally andrea bottacin busolin revised the manuscript critically for intellectual content declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper supplementary material supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103707 appendix a supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
421,a procedure combining experiments and deep learning is demonstrated to acquire pore scale images of oil and water wet surfaces over a large field of view in microfluidic devices and to classify wettability based upon these pore scale images deep learning supplants the manual time consuming error prone investigation and categorization of such images image datasets were obtained by visualizing the distribution of immiscible phases n decane and water within in house fabricated micromodels containing sandstone type and carbonate type pore structures the reference dataset consists of 6400 color images binned into four classes for sandstone water or oil wet surfaces and carbonate water or oil wet surfaces pore network patterns there are 1600 images per class during 10 sequential training and testing runs of the deep learning algorithm 3000 100 and 100 images were randomly assigned per each rock pattern as the training validation and test sets respectively we trained and optimized both a fully connected neural network fcn and convolutional neural network convnet using the image data the convnet performs better as 5 and 8 layers are implemented as expected the fcn shows an average test set accuracy for binary surface wettability classification of 87 4 for sandstone rock type and 98 7 for carbonate rock type pore networks distinctive heterogeneity in the carbonate rock type and its relevant phase saturation profile resulted in a better prediction accuracy the best convnet models shows an average test set accuracy of binary surface wettability classification of 99 4 0 1 for both sandstone type and carbonate pore networks heterogenous pore sizes and an abundance of small pores amplify the effects of wetting and aid identification overall the test set accuracy for the simultaneous classification of four classes including both sandstone water or oil wet and carbonate rock pattern water or oil wet is 98 5 with an 8 layer convnet performance of the deep learning model is further interpreted using saliency maps that indicate the degree to which each pixel in the image affects the classification score pixels at and adjacent to interfaces are most important to classification keywords oil brine rock interactions microfluidics wettability deep learning nomenclature acronyms fov field of view ccs carbon capture and storage eor enhanced oil recovery ssl semi supervised learning fcn fully connected neural network convnet convolutional neural network twpw rate in which true t label is water wet w and predicted p label is water wet w twpo rate in which true t label is water wet w and predicted p label is oil wet o topw rate in which true t label is oil wet o and predicted p label is water wet w topo rate in which true t label is oil wet o and predicted p label is oil wet o lsfm laser scanning fluorescence microscope hmds hexamethyldisilazane dimensionless numbers ca capillary number english letters lavg average cross entropy loss n number of observations or images mc number of classes sandstone oil wet sandstone water wet carbo oil wet carbo water wet yi binary indicator 0 or 1 y i 1 if class label c is the correct classification for observation i p y i c predicted probability observation i is of class c sc i class score function from deep learning algorithm for a given image i i rgb data from a given image c class or label for a given image i w c t weight vector for class score function sc i bc a bias for class score function sc i 1 introduction coupled physical mechanisms resulting from viscous capillary and surface forces make the description of multiphase flow in porous media challenging at the pore scale the interplay of pore network geometry connectivity and surface wettability play an important role in the distribution of fluid phases improved understanding of subsurface fluid flows and specifically the pore scale is required to facilitate critical processes in the context of water and energy resources including recovery of spilled hydrocarbons enhanced oil recovery and geological carbon sequestration critical understanding of multiphase flow has been enabled by microfluidic devices known as micromodels advanced imaging technologies and improved computational power armstrong et al 2016 micromodels contain microlevel representations of rock structure and are often made of silicon e g buchgraber et al 2012a glass or hdms the strength of microfluidics for characterization of multiphase flow effects in porous media include reproducibility and control over pore structures optical access to pore scale events high resolution images and pore scale controls of fluid flow in the context of subsurface water and energy resources micromodels reveal mechanisms controlling multiphase flow and transport phenomena in the pore space of geological porous media sinton 2014 for instance understanding fluid flow through dual porosity carbonate rock is complex due to its heterogeneous pore network across multiple length scales a typical dual porosity carbonate pore network consists of a wide size range of pores 1 200 µm and minerals mixed with micro and macroscale fractures and particles of varying size yun et al 2017 micromodels are often criticized for their lack of reproduction of solid fluid chemistry whereas the effect of wettability i e the affinity of fluid for a pore wall on fluid movement can be studied and visualized particularly well in the pore space of micromodels zhao et al 2016 a typical etched silicon micromodel has uniform silicon dioxide pore surfaces after manufacture accordingly recent papers have emphasized the functionalization of micromodels with clay minerals and calcite song et al 2018 song and kovscek 2015 yun et al 2020 as well as construction of micromodels out of calcite song et al 2014 other studies have focused on the understanding of how chemicals alter the arrangement of fluids at pore scale howe et al 2015 yun et al 2020 the accurate and rapid characterization of trapping processes the arrangement of fluids at pore scale and the impact of trapping on multiphase displacement in micromodels remains a challenge in short it is not yet currently feasible to perform quick and thorough interrogation of a large number of sample images of rock and its pore space at high resolution over a large field of view fov thus full characterization of the interactions between aqueous phases organic phases and rock is limited we believe that pore to darcy scale observation of displacement processes in complex and realistic porous media e g sandstone type and carbonate type systems can be achieved by fast monitoring using a large number of microscopic images of pores existing in porous media motivated by advances in related fields that use microfluidics riordon et al 2019 we explore machine learning for the rapid and accurate categorization of pore scale images we place special emphasis on the fluids that wet pore walls because of the importance of wettability to multiphase flow blunt et al 2013 and the various industrially relevant methods employed to change wettability at the pore scale lu et al 2014 hirasaki et al 2008 image analysis to quantify the volume fraction of pore space filled by aqueous organic and solid phases is relatively easy to automate but the interpretation of the fluids that wet solid surfaces remains painstaking and laborious hence the main objective of this manuscript is to explore the application of deep learning to enable automatic categorization of wettability using pore scale images we contribute here to understanding of multiphase flow through aiding the experimentalist toward this purpose this paper proceeds with a literature review including wettability microfluidics for multiphase flow applications and applications of machine learning to porous media images then the methodologies for image acquisition and the training of deep learning models to classify wettability using fully connected layer networks fcn and convolutional neural networks convnet are discussed image classification results follow including a saliency analysis that illustrates qualitatively and quantitatively the role of each pixel on image classification 2 literature review this section discusses the importance of understanding the impact of wettability of the porous system where multiple phases oil water and gas coexist micromodels as a means of understanding wettability and flow mechanisms are also discussed then recent studies employing machine learning for accelerating data analysis are presented 2 1 relevance of wettability the importance of wettability in many natural and industrial processes such as oil recovery co2 sequestration coating and printing cannot be overstated in the particular case of immiscible phase displacement in porous media the affinity of the solid for liquid phases so called wettability is a critical parameter determining the remobilization of oil phases jadhunandan et al 1995 wettability plays an important role during immiscible fluid flow in porous media it is a direct consequence of complex pore level physics including thin films that coat pore walls kovscek et al 1993 the sequence of pores invaded is a function of pore size distribution the pore level distribution of water and oil wet surfaces and the ratio of viscous to capillary forces zhao et al 2016 holtzman 2016 avendaño et al 2019 displacement at pore scale often occurs in a piston like regime in which one phase is displaced by the other typically the displaced liquid leaves a thin film on the wall if the capillary forces are strong enough and sufficient wetting liquid is available the thin film attached to the wall may form a liquid collar and break up the continuity of the displacing phase by snap off roof 1970 the wettability characteristics of pore spaces are usually not uniform throughout a rock or soil thereby increasing the complexity of oil displacement by water injection traditional wettability quantification methods such as contact angle do not account for three dimensional pore topology pore size distribution and control of variables such as mineralogy recently significant progress has been made to measure the distribution of contact angles within rock and found a variety of angles andrew et al 2014 alhammadi et al 2017 systems with average contact angle around 90 displayed the greatest displacement efficiencies increasing the contact angle minimizes the trapping and fingering effect additionally the interplay between displacement efficiency and pore size disorder is reduced as the degree of water wetness decreases holtzman 2016 rock and soil surfaces that have been contacted by crude oil typically have altered wettability and become weakly water wet mixed wet or oil wet kovscek et al 1993 oil wet and mixed wet systems typically display less trapping of the oil phase than water wet media at the pore scale the oil phase remains connected along the solid surface thus displacement of the continuous oil phase is more efficient and results in lesser residual phase saturation sor if sufficient water is injected salathiel 1973 the relationship between wettability alteration and residual phase saturation is complex tanino and blunt 2013 tanino and blunt 2013 observed a mixed wet system with different initial oil phase saturation soi they showed both monotonic and nonmonotonic trends between sor and soi for oil wet and mixed wet media sor decreased as soi increased where soi 0 5 outside of this range the greater the soi the greater is the sor in this work only soi greater than 0 5 formed stable layers thereby preventing snap off reducing oil phase trapping and increasing oil recovery for the core system tanino and blunt 2013 it has been found that wettability driven capillary trapping has a significant role in the efficiency of eor and ccs alyafei and blunt 2016 residual trapping driven by capillary forces increases storage security for ccs and residual oil sor in pore spaces that limits oil recovery capillary trapping is mainly controlled by pore geometry and wettability therefore advances in the study of the interplay of wettability and complex pore structure leads to improved application ccs and eor further alyafei and blunt 2016 investigated water wet rock showing that the residual nonwetting oil saturation snwr increases monotonically as initial nonwetting saturation snwi increases the snap off mechanism leads to a greater volume of nonwetting phase immobilized lake 2010 2 2 microfluidics microfluidics has been used since at least the1960 s to gain understanding of the configuration of multiple phases as they flow through porous media mattax and kyte 1961 microfluidics as applied to energy has surged in recent time as miniaturized devices have become more sophisticated incorporating realistic pore geometries accurate pore size dimensions representative mineralogy and clay content buchgraber et al 2012a yun et al 2017 song et al 2014 song and kovscek 2015 thus micromodel experiments are a powerful methodology to understand qualitatively and quantitatively multiphase flow and its relevant transport phenomena at pore scale visualization tools microscopes and cameras have enabled real time imaging and the collection of image data at resolutions of 100 to 200x across microfluidic devices that have macroscopic dimensions on the order of cm the range of applications and an assessment of the state of the art are reviewed by sinton 2014 specifically etched silicon micromodels with anodically bonded glass coverplates offer realistic representation of pore network geometries superior multiscale imaging opportunities and the ability to functionalize solid surfaces with clay or calcite song and kovscek 2016 wang et al 2017 surface functionalized microfluidic devices provide both representative pore geometry and surface mineral heterogeneities such microfluidic devices are useful for understanding the response of surfaces and fluids to low salinity brine and carbonated water mahzari et al 2018 buchgraber et al 2012a b describe a process whereby silicon microfluidic devices are created with pore scale geometry that is similar to real rocks using real rock thin section images obtained with a scanning electron microscope such images are binarized and used to create a pore network mask suitable for etching into silicon in an extension yun et al 2017 describe how thin section images and image analysis are used to add multiple etch depths to a micromodel to more realistically represent pores in three dimensions the devices in this work follow these existing fabrication protocols buchgraber et al 2012a yun et al 2017 2 3 automated image processing for microfluidics visual investigation of multiphase fluid flow using microfluidic devices has served as a useful tool for direct evidence of unique fluid transport mechanisms in porous media and characterizing important factors directly advanced imaging techniques and cutting edge image processing analysis algorithms have been an active research area to produce more reliable and accurate experimental outcomes from a micromodel experiment application and development of appropriate image processing analysis algorithms are essential to successful assessment of the variables of interest such as fluid saturation and other morphological features from microfluidic experiments for instance mahmoodi et al 2018 applied successfully various machine learning algorithms to enable an automated image based computational statistical analysis for better assessment of micromodel experimental results understanding the mechanisms of the formation of residual nonwetting phases is significant to developing better recovery methods the formation of residual oil is directly related to the complex interplay between pore structure wettability pore body throat ratio and pore size distribution machine learning methods in recent years have been widely used in subsurface engineering to improve efficiency and ensure objectivity zhao et al 2017 proposed the application of machine learning tools especially for the automated analysis of micromodel experiments zhao et al 2017 used the conventional machine learning method called a seeded k means semisupervised learning ssl to classify automatically remaining oil at the micropore scale by training on the images of the remaining oil in the high water cut stage from 2d etched glass micromodel experiments zhao et al 2017 showed that the k means semi supervised learning ssl method classified automatically remaining oil into four types oil film throat retained oil heterogeneous multipores oil and clustered oil 2 4 deep learning applied to porous media in contrast to conventional machine learning techniques that typically require manual feature extraction deep learning methods allow machines to work effectively with the raw input and automatically extract features needed for the learning tasks such as classification or regression a typical deep learning model consists of layers with linear and non linear transformations by stacking many such layers a deep neural network is theoretically capable of approximating any complex non linear function deep learning models such as convolutional neural networks are very good at discovering intrinsic structures in data such as images and are therefore very successful at machine learning tasks such as pattern recognition and image classification goodfellow et al 2016 there are many different architectures for deep neural networks and each of them is suitable for different inputs in a fully connected neural network fcn neurons at each layer are connected to all neurons in the previous layer fcn models work well for input with a relatively small number of features because the number of parameters in fcn models scale directly with the input dimension unlike an fcn the neurons within each layer of a convolutional neural network convnet are only connected to a small region of the previous layer this difference helps to reduce the number of parameters in a convnet significantly a convnet preserves image dimensions including width height and depth e g color channels the output from every layer of a convnet preserves the 3d volume structure this makes the learning of spatial correlation of the input images more effective on the other hand it also makes the forward evaluation in a convnet more efficient to implement a typical convnet consists of mainly convolutional layers and pooling layers at each convolutional layer multiple filters with a relatively small spatial size are applied to obtain neurons in the next layer these neurons are connected to local patches of the feature maps from the previous layer all the neurons share the same set of filters these filters scan through the input feature maps to extract local features at every location the insight behind this design lies in the fact that for input data such as images values of a local region of pixels are often times highly correlated and the local features in images are typically irrelevant to location therefore it is effective to use the same set of filters to extract local features at different locations the result of this local filtering is passed through a non linear activation layer such as a relu f z m a x z 0 to add nonlinearity to each layer and improve the expressiveness of the convnet a pooling layer locally summarizes the activation from a convolutional layer it reduces the spatial dimension of input increase the reception field size and helps the deeper layers learn larger scale features for image classification tasks the output from the final convolutional layer is converted to a vector and then fed through fully connected layers to obtain the final output of probabilities for different categories successfully applying deep learning requires appropriate specification of hyperparameters such as network architecture activation functions and learning rates determining optimal hyperparameter values is important to obtain the best performance of a deep learning algorithm in addition to feed forward convnet and hyperparameter tuning such as a deeper network more advanced architectures such as residual layers he et al 2016 may help to mitigate gradient vanishing in deep neural works and implementing skip connections ronneberger et al 2015 helps small scale features in shallow layers to propagate through a deep architecture alqahtani et al 2018 recently used deep learning models to predict properties of porous media from unprocessed image data alqahtani et al 2018 proposed the application of a convnet to study pore scale transport phenomena from high resolution micro computed tomography micro ct imaging of digital rocks the convnet is trained to learn rapidly from 2d greyscale microcomputed tomography images and predict several porous media properties porosity coordination number and average pore size the deep learning based analysis ensured that petrophysical analysis of digital rocks can be conducted without the need for user biased image processing algorithms and expensive numerical simulations 3 data acquisition an experimental procedure to fabricate microfluidic devices with strong oil and water wet surface wetting conditions is presented importantly laser scanning fluoresence microscopy lsfm is used to collect many pore scale images image processing post image acquisition and details of the data structure for images are also presented in this section to document the use of microfluidic image data and deep learning 3 1 creation of oil and water wet surfaces micromodels are designed in house and manufactured in the stanford nanofabrication facility snf using standard photolithography techniques following the procedure outlined by buchgraber et al 2012b 4 inch silicon wafers were etched with a pore network to a depth of about 20 µm as a final fabrication step a glass cover plate was attached to the top of the etched wafer using anodic bonding hence a closed system capable of holding fluids under pressure is created during bonding the wafer surface is oxidized and is water wet subsquently the surface was modified to oil wet using a silane treatment process employing hmds grate et al 2013 kisler et al 2003 reported that the stability of hydrophobic surface coatings via hmds treatment persisted in aqueous solutions for about 7 days the micromodels used in this paper have either sandstone type or carbonate type pore networks and the wettability of both rock patterns is either strongly oil wet or water wet fig 1 illustrates the outcome of micromodel fabrication and wettability alteration at pore scale in a sandstone type pore network false coloring has been applied such that water is shaded green and oil is shaded red fig 1 a demonstrates grains that are clearly water wet as water coats the grain surfaces even when surrounded by oil on the other hand fig 1 b displays oil wettability in that oil coats grain surfaces and inhabits the smallest pore spaces that have not been invaded by water this figures also displays some emulsification of water within the oil phase 3 2 micromodel experimental setup real time visualization of flow and or transport in the micromodel is critical for a successful microfluidic experimental setup thus a basic microfluidic setup consists of a pump microfluidic device pressure controllers and visualization system in figs 2 and 3 syringe pumps inject the fluid into the chip pattern through the inlet tube where it displaces interacts with resident fluid in the micromodel in this work we inject a total of about 1 pore volume of fluid at a flow rate of 0 001 ml min ca of about 10 6 pressure transducers heating chambers and the microscope are equipped for both controls of experimental condition and qualitative quantitative measurements fig 3 provides details on how secure seals are made with micromodels to permit fluid injection and production 3 3 pore and whole micromodel imaging two different phases i e decane dyed with nilered and water dyed green with fluorescein were the injectants into the experimental setup shown in fig 2 saturation profiles of decane and water in the complex sandstone and carbonate type pore networks were documented using images to visualize the entire micromodel pore network 1400 microscopic images were stitched together as illustrated for a sandstone type micromodel in fig 4 the image acquisition was conducted using a laser scanning fluorescence microscope with a 100x objective the field of view of a single image with a 100x objective is about 800µm by 800µm and the acquisition time is 0 6 s at 100x the overall ganglia pattern and details of the phase wetting the solid are readily apparent we believe that characterizing the morphology of phases within the pore space gives more holistic details for micromodels in comparison to contact angle measurement because the topology of a phase in the depth direction which is important to contact angel determination is difficult to image the final size of the fov from the images are varied during the training phase of deep learning due to the importance of spatial resolution for wettability classification more details about the variation of spatial resolution are discussed in the next section each raw pixel from image 200 200 3 pixels has a corresponding pixel wise fluorescence emission intensity for the range of wavelength from 450 to 700 nm the emission data from nilered and fluorescein dyed phases was used for post processing and for phase segmentation for decane and water phases respectively then the decane water and grains in the images were identified and labeled a total of 1600 images from each rock pattern for both oil and water wet conditions were prepared the images were assigned manually to their classes as shown in fig 5 4 training spatial resolution is important for wettability classification hence we explain the selection criteria for the 6400 images with different fovs for all classes this section discusses our methodology using fully connected neural networks and convolutional neural network models in detail its also details the evaluation criteria 4 1 image data with varying spatial resolution figs 6 and 7 display image data from the four classes with different spatial resolutions note that fig 6 is a sandstone type geometry whereas fig 7 is carbonate type the original 100x images are examined at four different spatial resolutions 0 6x zoom 1x zoom 2x zoom and 3x zoom relative to the baseline 800µm by 800µm image 0 6x zoom increases the size of fov whereas and 2x and 3x zoom decrease the size of fov hence 0 6x zoom images are particularly useful because they give an overview of the distribution and macrolevel configuration of the phases in the large domain of the pore network these images however do not give enough resolution to show thin film corner fluids surrounding grains pore level wettability is understood more clearly by studying the role of thin films in porous media kovscek et al 1993 in this regard 3x zoom images are high resolution and capture details of thin films and the shape of interfacial curvature and contact angles such details are significant aspects for pore scale wettability classification because the training image data set combines four different spatial resolutions it is expected to be helpful to evaluate the accuracy of our deep learning algorithms the varying spatial resolution of the carbonate type pore network results in a significant degree of heterogeneity in pore and grain size distribution i e dual porosity in contrast to the sandstone type network that has relatively uniformly distributed pore size and grain dimensions the greater heterogeneity is expected to aid image classification from the carbonate type networks the data structure for training has the same number of images for each class the dataset has 6400 rgb images 200 pixel by 200 pixel with 3 rgb channels in 4 classes including oil wet sandstone water wet sandstone oil wet carbonate and water wet carbonate there are 1600 images per class the 3200 sandstone images are used for sandstone wettability classification we randomly chose 3000 images as the training set 100 images as the evaluation set and 100 images as the test set to decrease the variance of test error estimation we use 10 different random seeds to generate 10 different splits of training evaluation and test sets we train each network 10 times each time on a different training set and estimate test error on the corresponding test set the average test error is used for comparing different networks similarly the 3200 carbonate images are used for carbonate wettability classification we apply the same strategy for splitting the dataset and estimating test errors finally all 6400 images are used for simultaneous classification of rock types and wettability following the same strategy of splitting the dataset and estimating test errors here each training set has 6000 images each evaluation set and test set has 200 images this training and testing strategy gives an objective assessment of the performance of the models 4 2 model architecture we consider two types of neural network architectures fully connected neural networks and convolutional neural networks recall that an fcn is the most basic form of a neural network and in a convnet each neuron is only connected to a local region of neurons in the previous layer this local connectivity makes convnet more effective at capturing the local features presented in image data we describe the architectures of fcn and convnet used in this study and compare their performances in both cases recommended values of hyper parameters were used without optimization for the fcn the input image originally of size 200 200 3 is reshaped to a vector of size 120000 1 it is then fed through four hidden layers each with 512 256 128 and 128 neurons respectively each hidden layer is followed by a batch normalization layer and then a relu nonlinear activation layer the output layer of the fcn first outputs a score vector of size of mc 1 where mc is the number of classes then a softmax activation function is applied to convert the class scores into class probabilities the major layers in the fcn are shown in table 1 the number of parameters to be trained in this fcn model is 61 623 554 we experimented with two architectures of convnet the first convnet is relatively shallow consisting of 3 convolutional layers and 2 dense layers we refer to this net as the 5 layer convnet each convolutional layer has 3 convolutional filters of size 3 3 followed by a relu nonlinear activation layer and a maxpool layer that down samples the input by a factor of 2 along each spatial dimension the output from the last convolutional layer is flattened to a vector and then fed through 2 fully connected layers to output the score vectors again the softmax activation function is applied to obtain the class probabilities the major layers in the convnet are shown in table 2 the total number of parameters is 939 254 that is around 65 times less than that in the fcn model the second convnet is relatively deep and contains more filters there are 6 convolutional layer and 2 dense layers we refer to this net as the 8 layer convnet each convolutional layer has a varying number of filters max pooling is performed after every other convolutional layer the architecture of the 8 layer convnet is shown in table 3 the total number of parameters is 2 513 402 that is around 2 5 times less than that in the fcn model both fcn and convnet use a cross entropy loss log loss function that is relevant to the distance between the output distribution from the trained model and the original distribution from the dataset cross entropy loss log loss function is an ideal loss function for our neural network architecture that have an activation function softmax applied to the scores in our model s output layer thus soft max activation with cross entropy loss trains a model architecture to output a probability over the mc classes for each image goodfellow et al 2016 more specifically minimizing cross entropy is equivalent to a direct indication of the increase in the predictive power of our model average cross entropy loss lavg is expressed as 1 l a v g 1 n i 1 n y i c ln p y i c 1 y i c ln 1 p y i c m c 2 1 n i 1 n c 1 m c y i c ln p y i c m c 2 where mc is the number of classes sandstone oil wet sandstone water wet carbo oil wet carbo water wet n is number of observations y i c is binary indicator 0 or 1 y i c 1 if class label c is the correct classification for observation i and p y i c is predicted probability observation i of class c to train the neural networks the training set is divided into mini batches of size b s 50 then an extension of the stochastic gradient descent optimization algorithms called rmsprop is applied ruder 2016 with a learning rate of l r 0 001 for a total of 20 epochs here one epoch means iterating through all the mini batches once 5 results and discussion the wettability and morphology of pores strongly influences the ganglia shape and pore scale configuration of oil and water phases this section presents the predictions of wettability strong oil wetting or strong water wetting and illustrates the interplay between the oil phase water phase and grain surfaces 5 1 the effect of spatial variation the role of spatial variation on training performance was investigated first for the sandstone case as summarized in table 4 the accuracy of the validation set is 0 87 and the test set accuracy is 0 86 for the fcn using 1500 sandstone images with 1x and 2x zoom increasing the number 3100 of training set images for the fcn with variation of spatial resolution 0 6x 1x 2x and 3x zoom resulted in a validation set accuracy that increased to 0 93 the test set accuracy however is 0 82 and so no enhancement is obtained compared to the accuracy with 1500 images of sandstone only 1x and 2x zoom the lack of enhancement in this case is attributed to the fact that it is challenging to evaluate wettability in the zoomed out 0 6x test set images that is it is difficult to recognize a distinctive oil and water configuration in the sandstone geometry due to its relatively homogeneous size distribution the role of spatial variation on training performance could be evaluated in the future using results from the carbonate type images because the carbonate rock type has a more heterogeneous pore size distribution 5 2 evaluation of classifiers to evaluate fully the effectiveness of the models we examined both average precision and average accuracy on the test set from 10 training runs recall that we trained each model 10 times with 10 different random splits of training evaluation and test sets all test data sets have a roughly balanced number of images between water wet and oil wet where the ratio is around 50 50 hence accuracy and precision are objective evaluation tools for the approximately balanced datasets we also tabulated average confusion matrix in tables 5 and 6 to obtain more detailed measures of accuracy and precision the confusion matrix constructed here has four elements as follows twpw rate in which true t label is water wet w and predicted p label is water wet w twpo rate in which true t label is water wet w and predicted p label is oil wet o topw rate in which true t label is oil wet o and predicted p label is water wet w topo rate in which true t label is oil wet o and predicted p label is oil wet o the values of average precision and average accuracy are computed from a confusion matrix as 2 a c c u r a c y b a l t w p w t o p o t w p w t w p o t o p w t o p o 3 p r e c i s i o n w t w p w t w p w t o p w 4 p r e c i s i o n o t o p o t w p o t o p o where accuracy b a l is the measurement of the weighted percentage of correct decisions the classifier makes for oil and water wet cases precision w is the percentage of water wet identifications being correct and precision o is the percentage of oil wet identifications being correct table 7 tabulates the accuracy and precision values for oil wet and water wet calculated from all values in the confusion matrix overall trained models performed binary classification very well showing accuracy b a l greater than 95 except for the performance of fcn for sandstone rock type as expected convnet performs better comparing all aspects accuracy b a l precision o precision w in table 7 regardless of the type of rock patterns convnet substantially preserves the relationship between the neighbor pixels thus the pore level details of the spatial arrangement of rock thin films and interface angles are captured better the 8 layer convnet model achieves further improvement on top of the 5 layer convnet model consistent with the general observation in the computer vision community the deeper architecture and larger number of filters help improve the performance of the convnet in image classification interestingly improvement of classification performance from fcn to convnet is more substantial and profound for sandstone than for carbonate networks for instance accuracy b a l increased from 87 4 by fcn to 99 5 by 8 layer convnet for the sandstone rock type giving 12 1 improvement as opposed to 0 6 increase for the carbonate rock type the relatively heterogeneous pore size distribution in carbonate porous media promotes more distinctive capillary force contrast throughout the pore spaces than that of homogeneous sized pores in sandstone consequently images from carbonate rock have more profound saturation profiles and provide additional features for the classifier model to determine wettability accuracy b a l of the 8 layer convnet for all four classes is 98 5 this promising result indicates that the classifier performs satisfactorily to classify wettability and grain shape distribution simultaneously 5 3 image specific saliency map generating an image specific saliency map simonyan et al 2014 allows us to rank the pixels of a given test image based on their influence on the classification score for oil and water wet surfaces image specific class saliency demonstrates the class score derivative with respect to each pixel of the image hence the saliency map highlights the pixels that affect the class score the most simonyan et al 2014 generally such pixels correspond to particular object locations within images for the object detection classification within an image the influence of pixels of i 0 on the top 1 class score sc i 0 is computed for a given an image i 0 a class c and a classification convnet with the class score function sc i as described in simonyan et al 2014 for example we compute the linear score for the class c for a given image i 5 s c i w c t i b c i bc and wc are the image in the vectorized one dimensional form the bias of the model and the weight vector respectively the magnitude of an element weight vector w c i j indicates the significance of the corresponding pixels of i for determining the class c as described in simonyan et al 2014 the class saliency map m r m n of an image i 0 with m rows and n columns and a class c is obtained by computing the derivative w using back propagation and rearranging the elements of the vector w in the present work we use the multichannel e g rgb color image with weight w h i j z where the index h i j z represents the color channel z of the pixel in the i th row and j th column of image i the greatest absolute value of w across all color channels m i j max z w h i j z was used to obtain a single class saliency value for each pixel i j from a convnet trained on the image labels the saliency map for a single class of a specific image is computed quickly by a single back propagation pass using tensorflow tf gradients sc i 0 i 0 an image specific saliency map is computed using the gradient of the class score with respect to the input image generated the saliency map addresses the visualization of our wettability classification models learned using convnet or fcn the saliency map shown in fig 8 illustrates the importance of each pixel and its effect on the classification score for the top 1 class for that image we use the 8 layer convnet and the first random split of dataset for generating the saliency maps to analyze quantitatively the spatial distribution of high saliency pixels we did the following we first extract the rock fluid interface from the images as shown in fig 8 d and then calculate the euclidean distance in number of pixels to the closest rock fluid interface for all pixels as shown in fig 8 e for convenience we refer to this distance as p2i pixel to interface distance for each image we use the average p2i distance from all pixels each image has a total of 40 000 pixels as a reference value then we compute the average p2i distance from the top 0 1 0 2 0 5 and 1 pixels with the largest saliency values the statistics of the average p2i distance from all pixels and top saliency pixels are summarized in table 8 for sandstone the average p2i distance from top saliency pixels are significantly smaller than the average p2i distance from all pixels this indicates pixels near rock fluid interfaces are most important for the 8 layer convnet to classify wettability for sandstone for carbonate the average p2i distance from top saliency pixels is only slightly smaller than the average p2i distance from all pixels this means that the 8 layer convnet considers wider regions compared to sandstone for classifying wettability of carbonate the image specific class saliency map topo in fig 8 highlights the areas of the given image identified with respect to the given class top 1 class as oil wet in this case as can be seen in fig 8b and c pixels in pore throats and near interface of phases are the most important for the model s prediction of the oil wet class quantitatively fig 8 f illustrates that the top 0 1 saliency pixels have smaller p2i distances and close proximity to the rock surface fig 8 c combines test image fig 8a and saliency map fig 8b for a better localization of the pixels that have more impact on the oil wet classification significantly fig 8 c demonstrates the bright highlighted regions where the trained model focuses on the interface area between rock water oil and pore throats occupied by the wetting phase water for its prediction of oil wetness another image specific class saliency map topo in fig 9 for the image of very low non wetting phase water saturation is presented clearly compared to pixels of grain and dominant wetting phase decane in red we see that the pixels of the water ganglia green interface and dominant wetting phase surrounding the grain surface in the image affect significantly the model s prediction of the oil wet class saliency maps twpw for images of water wet carbonate with large fov display the importance of identifying the particular phase that occupies large versus small sized pores in a dual porosity medium fig 10 the images contain overall saturation profiles in both micro and macropore regions but few fine details of contact angle and the interface between two phases the model predicts the correct class we see that fig 10c highlights the pixels of water green in the macropore larger size pore space region and water phase located close to the grain surface for its prediction of the oil wet class compared to the sandstone case where the top 0 1 saliency pixels are located near the rock surface the prediction on carbonate pore networks produces the saliency map showing the wide range of p2i distance from top 0 1 saliency pixels fig 10f the heterogeneous nature of the carbonate pore network requires the trained algorithm to perform multi level observations near surface and overall phase saturation profile for the wettability classification fig 11 addresses the case of small fov where small pore space is occupied by single phase water in green the convnet model successfully predicts the water wet class for the image even though the image has no oil phase training using images that are either homogeneously water wet or oil wet is important to identify regions of pore space filled with a single phase and their wetting fluid occupancy because heterogeneous micromodels have a distribution of pore sizes the wetting fluid is preferentially found in the smallest pore space where nonwetting fluid has not had sufficient capillary pressure to invade these regions are important for wettability classification the class saliency map topo in fig 11c shows the model s strong emphasis on the body of gain and the region of the interface between grain and water the central body of water green ganglia has less impact on the model s class prediction 5 4 versatility of trained deep learning algorithm the trained algorithm with a 5 layer network was applied to a water and surfactant flooding experiment conducted by yun chang cogswell eichmann gizzatov thomas al hazza abdel fattah wang 2020 the object of the experiment was to evaluate the efficacy of aqueous surfactant solution to mobilize trapped nonwetting phase fig 12 summarizes microscopic images of the microfluidic chip after the water flooding fig 12 a and after the surfactant flooding fig 12 b the microscopic images were not used for training the convnet and the network has never seen this particular pore network pattern the microfluidic chip is commercially available micronit microtechnologies netherlands with a pore volume of 2 4 μl and 60 matrix porosity the object of this test is to evaluate whether the trained algorithm is applicable to determine the initial wettability during the water flooding stage and to detect the alteration of wettability after 1 pv injection of aqueous surfactant solution the trained convnet predicts the oil wet conditions for all three oil wet images fig 12 a 1 a 2 and a 3 regardless of the increase in water wetness of pore surface in fig 12b the trained algorithm strongly relies on the dominant region with the occupancy of wetting phase oil near surface for its wettability prediction a partially water wet surface is seen in fig 13 b however the trained algorithm predicts fig 12b 1 b 2 and b 3 as the oil wet conditions as shown in fig 13b 1 6 summary and future work this work presented and evaluated a methodology for automated classification of images from microfluidic devices micromodels with water and oil wet surface wettability fluid injection experiments using micromodels with two different pore network patterns were conducted to prepare pore level images that were used as a data set to train two deep learning algorithms the first is a three layer fully connected neural network fcn and the second is a convolutional neural network convnet both models successfully classified test set images according to wettability the convnet was the most accurate classifier with an average test set accuracy of 99 5 1 for sandstone pore networks 99 3 1 for carbonate pore networks and 98 5 1 for all two pore networks deep learning significantly sped up and enhanced the accuracy of interpretation of images from micromodel experiments interestingly construction of saliency maps for both types of pore networks with various occupancy of pore spaces by oil and water showed that the deep learning algorithms focused on solid fluid interfaces and the fluid phase occupancy of the smallest dimension pore spaces such as pore throats to classify wettability these are the same features used in the manual classification of the images that formed the training data set there are numerous possibilities for further work from the studies of the effect of spatial variation we may enhance the data quality by adding more levels of image magnification consistent with the difference in pore size distribution and pore sizes for carbonate type and sandstone type pore networks more images with greater magnification such as 4x or 5x zoom of base images for both the sandstone type network will give greater weight to thin film thickness on the grain surface and thereby aid wettability classification additionally the images used for training had surfaces that were uniformly wetting to water or to oil we demonstrated briefly that our trained algorithm failed to detect the onset point of the mixed wet condition thus enlarging the study to a greater range of wettability including mixed wettability where water wet and oil wet surfaces are found in the same pore spaces would be of great interest such images might also provide the opportunity to quantify the fraction of the pore space wet by each fluid if a crude oil is used to establish mixed wettabiity the trained model enables wettability classification resulting from the precipitation of crude oil components asphaltenes from locally trapped crude oil it would be very interesting to try to incorporate dynamic effects by examining target areas of the image where the relative wettability changes depending on preferential dynamics of flow stagnant flow areas would make a useful comparison to areas of substantial flow including the leading edge of displacement fronts to understand if wettability alteration proceeds at different rates in these differently swept areas the long term stability of hmds coating grate et al 2013 is limited under aqueous conditions this loss of hydrophobicity over time 7 8 days could be used to create micromodel surfaces with more or less uniform intermediate wetting conditions an image data set with intermediate wetting adds an additional class for deep learning models that could be a great benefit for the precise classification of possible wetting scenarios hence proper training of the deep learning algorithm for different wetting conditions would serve as a tool to monitor the progress of mixed wettability caused by different pore level scenarios in oil reservoirs or in soils where oil has been spilled future applications of deep learning in microfluidics may also be to connect initial and injection conditions to the outcomes of wettability or desaturation of pore space documented in images for example deep learning may be used to choose the rate conditions of an experiment or the properties of a chemical to be injected to achieve the outcome desired in this way the hit or miss nature of screening of injectants may be altered and more time focused on understanding how to obtain optimal outcomes credit authorship contribution statement wonjin yun conceptualization methodology software writing original draft yimin liu conceptualization methodology software writing original draft anthony r kovscek conceptualization supervision funding acquisition writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgment the support of the supri a industrial affiliates is acknowledged gratefully 
421,a procedure combining experiments and deep learning is demonstrated to acquire pore scale images of oil and water wet surfaces over a large field of view in microfluidic devices and to classify wettability based upon these pore scale images deep learning supplants the manual time consuming error prone investigation and categorization of such images image datasets were obtained by visualizing the distribution of immiscible phases n decane and water within in house fabricated micromodels containing sandstone type and carbonate type pore structures the reference dataset consists of 6400 color images binned into four classes for sandstone water or oil wet surfaces and carbonate water or oil wet surfaces pore network patterns there are 1600 images per class during 10 sequential training and testing runs of the deep learning algorithm 3000 100 and 100 images were randomly assigned per each rock pattern as the training validation and test sets respectively we trained and optimized both a fully connected neural network fcn and convolutional neural network convnet using the image data the convnet performs better as 5 and 8 layers are implemented as expected the fcn shows an average test set accuracy for binary surface wettability classification of 87 4 for sandstone rock type and 98 7 for carbonate rock type pore networks distinctive heterogeneity in the carbonate rock type and its relevant phase saturation profile resulted in a better prediction accuracy the best convnet models shows an average test set accuracy of binary surface wettability classification of 99 4 0 1 for both sandstone type and carbonate pore networks heterogenous pore sizes and an abundance of small pores amplify the effects of wetting and aid identification overall the test set accuracy for the simultaneous classification of four classes including both sandstone water or oil wet and carbonate rock pattern water or oil wet is 98 5 with an 8 layer convnet performance of the deep learning model is further interpreted using saliency maps that indicate the degree to which each pixel in the image affects the classification score pixels at and adjacent to interfaces are most important to classification keywords oil brine rock interactions microfluidics wettability deep learning nomenclature acronyms fov field of view ccs carbon capture and storage eor enhanced oil recovery ssl semi supervised learning fcn fully connected neural network convnet convolutional neural network twpw rate in which true t label is water wet w and predicted p label is water wet w twpo rate in which true t label is water wet w and predicted p label is oil wet o topw rate in which true t label is oil wet o and predicted p label is water wet w topo rate in which true t label is oil wet o and predicted p label is oil wet o lsfm laser scanning fluorescence microscope hmds hexamethyldisilazane dimensionless numbers ca capillary number english letters lavg average cross entropy loss n number of observations or images mc number of classes sandstone oil wet sandstone water wet carbo oil wet carbo water wet yi binary indicator 0 or 1 y i 1 if class label c is the correct classification for observation i p y i c predicted probability observation i is of class c sc i class score function from deep learning algorithm for a given image i i rgb data from a given image c class or label for a given image i w c t weight vector for class score function sc i bc a bias for class score function sc i 1 introduction coupled physical mechanisms resulting from viscous capillary and surface forces make the description of multiphase flow in porous media challenging at the pore scale the interplay of pore network geometry connectivity and surface wettability play an important role in the distribution of fluid phases improved understanding of subsurface fluid flows and specifically the pore scale is required to facilitate critical processes in the context of water and energy resources including recovery of spilled hydrocarbons enhanced oil recovery and geological carbon sequestration critical understanding of multiphase flow has been enabled by microfluidic devices known as micromodels advanced imaging technologies and improved computational power armstrong et al 2016 micromodels contain microlevel representations of rock structure and are often made of silicon e g buchgraber et al 2012a glass or hdms the strength of microfluidics for characterization of multiphase flow effects in porous media include reproducibility and control over pore structures optical access to pore scale events high resolution images and pore scale controls of fluid flow in the context of subsurface water and energy resources micromodels reveal mechanisms controlling multiphase flow and transport phenomena in the pore space of geological porous media sinton 2014 for instance understanding fluid flow through dual porosity carbonate rock is complex due to its heterogeneous pore network across multiple length scales a typical dual porosity carbonate pore network consists of a wide size range of pores 1 200 µm and minerals mixed with micro and macroscale fractures and particles of varying size yun et al 2017 micromodels are often criticized for their lack of reproduction of solid fluid chemistry whereas the effect of wettability i e the affinity of fluid for a pore wall on fluid movement can be studied and visualized particularly well in the pore space of micromodels zhao et al 2016 a typical etched silicon micromodel has uniform silicon dioxide pore surfaces after manufacture accordingly recent papers have emphasized the functionalization of micromodels with clay minerals and calcite song et al 2018 song and kovscek 2015 yun et al 2020 as well as construction of micromodels out of calcite song et al 2014 other studies have focused on the understanding of how chemicals alter the arrangement of fluids at pore scale howe et al 2015 yun et al 2020 the accurate and rapid characterization of trapping processes the arrangement of fluids at pore scale and the impact of trapping on multiphase displacement in micromodels remains a challenge in short it is not yet currently feasible to perform quick and thorough interrogation of a large number of sample images of rock and its pore space at high resolution over a large field of view fov thus full characterization of the interactions between aqueous phases organic phases and rock is limited we believe that pore to darcy scale observation of displacement processes in complex and realistic porous media e g sandstone type and carbonate type systems can be achieved by fast monitoring using a large number of microscopic images of pores existing in porous media motivated by advances in related fields that use microfluidics riordon et al 2019 we explore machine learning for the rapid and accurate categorization of pore scale images we place special emphasis on the fluids that wet pore walls because of the importance of wettability to multiphase flow blunt et al 2013 and the various industrially relevant methods employed to change wettability at the pore scale lu et al 2014 hirasaki et al 2008 image analysis to quantify the volume fraction of pore space filled by aqueous organic and solid phases is relatively easy to automate but the interpretation of the fluids that wet solid surfaces remains painstaking and laborious hence the main objective of this manuscript is to explore the application of deep learning to enable automatic categorization of wettability using pore scale images we contribute here to understanding of multiphase flow through aiding the experimentalist toward this purpose this paper proceeds with a literature review including wettability microfluidics for multiphase flow applications and applications of machine learning to porous media images then the methodologies for image acquisition and the training of deep learning models to classify wettability using fully connected layer networks fcn and convolutional neural networks convnet are discussed image classification results follow including a saliency analysis that illustrates qualitatively and quantitatively the role of each pixel on image classification 2 literature review this section discusses the importance of understanding the impact of wettability of the porous system where multiple phases oil water and gas coexist micromodels as a means of understanding wettability and flow mechanisms are also discussed then recent studies employing machine learning for accelerating data analysis are presented 2 1 relevance of wettability the importance of wettability in many natural and industrial processes such as oil recovery co2 sequestration coating and printing cannot be overstated in the particular case of immiscible phase displacement in porous media the affinity of the solid for liquid phases so called wettability is a critical parameter determining the remobilization of oil phases jadhunandan et al 1995 wettability plays an important role during immiscible fluid flow in porous media it is a direct consequence of complex pore level physics including thin films that coat pore walls kovscek et al 1993 the sequence of pores invaded is a function of pore size distribution the pore level distribution of water and oil wet surfaces and the ratio of viscous to capillary forces zhao et al 2016 holtzman 2016 avendaño et al 2019 displacement at pore scale often occurs in a piston like regime in which one phase is displaced by the other typically the displaced liquid leaves a thin film on the wall if the capillary forces are strong enough and sufficient wetting liquid is available the thin film attached to the wall may form a liquid collar and break up the continuity of the displacing phase by snap off roof 1970 the wettability characteristics of pore spaces are usually not uniform throughout a rock or soil thereby increasing the complexity of oil displacement by water injection traditional wettability quantification methods such as contact angle do not account for three dimensional pore topology pore size distribution and control of variables such as mineralogy recently significant progress has been made to measure the distribution of contact angles within rock and found a variety of angles andrew et al 2014 alhammadi et al 2017 systems with average contact angle around 90 displayed the greatest displacement efficiencies increasing the contact angle minimizes the trapping and fingering effect additionally the interplay between displacement efficiency and pore size disorder is reduced as the degree of water wetness decreases holtzman 2016 rock and soil surfaces that have been contacted by crude oil typically have altered wettability and become weakly water wet mixed wet or oil wet kovscek et al 1993 oil wet and mixed wet systems typically display less trapping of the oil phase than water wet media at the pore scale the oil phase remains connected along the solid surface thus displacement of the continuous oil phase is more efficient and results in lesser residual phase saturation sor if sufficient water is injected salathiel 1973 the relationship between wettability alteration and residual phase saturation is complex tanino and blunt 2013 tanino and blunt 2013 observed a mixed wet system with different initial oil phase saturation soi they showed both monotonic and nonmonotonic trends between sor and soi for oil wet and mixed wet media sor decreased as soi increased where soi 0 5 outside of this range the greater the soi the greater is the sor in this work only soi greater than 0 5 formed stable layers thereby preventing snap off reducing oil phase trapping and increasing oil recovery for the core system tanino and blunt 2013 it has been found that wettability driven capillary trapping has a significant role in the efficiency of eor and ccs alyafei and blunt 2016 residual trapping driven by capillary forces increases storage security for ccs and residual oil sor in pore spaces that limits oil recovery capillary trapping is mainly controlled by pore geometry and wettability therefore advances in the study of the interplay of wettability and complex pore structure leads to improved application ccs and eor further alyafei and blunt 2016 investigated water wet rock showing that the residual nonwetting oil saturation snwr increases monotonically as initial nonwetting saturation snwi increases the snap off mechanism leads to a greater volume of nonwetting phase immobilized lake 2010 2 2 microfluidics microfluidics has been used since at least the1960 s to gain understanding of the configuration of multiple phases as they flow through porous media mattax and kyte 1961 microfluidics as applied to energy has surged in recent time as miniaturized devices have become more sophisticated incorporating realistic pore geometries accurate pore size dimensions representative mineralogy and clay content buchgraber et al 2012a yun et al 2017 song et al 2014 song and kovscek 2015 thus micromodel experiments are a powerful methodology to understand qualitatively and quantitatively multiphase flow and its relevant transport phenomena at pore scale visualization tools microscopes and cameras have enabled real time imaging and the collection of image data at resolutions of 100 to 200x across microfluidic devices that have macroscopic dimensions on the order of cm the range of applications and an assessment of the state of the art are reviewed by sinton 2014 specifically etched silicon micromodels with anodically bonded glass coverplates offer realistic representation of pore network geometries superior multiscale imaging opportunities and the ability to functionalize solid surfaces with clay or calcite song and kovscek 2016 wang et al 2017 surface functionalized microfluidic devices provide both representative pore geometry and surface mineral heterogeneities such microfluidic devices are useful for understanding the response of surfaces and fluids to low salinity brine and carbonated water mahzari et al 2018 buchgraber et al 2012a b describe a process whereby silicon microfluidic devices are created with pore scale geometry that is similar to real rocks using real rock thin section images obtained with a scanning electron microscope such images are binarized and used to create a pore network mask suitable for etching into silicon in an extension yun et al 2017 describe how thin section images and image analysis are used to add multiple etch depths to a micromodel to more realistically represent pores in three dimensions the devices in this work follow these existing fabrication protocols buchgraber et al 2012a yun et al 2017 2 3 automated image processing for microfluidics visual investigation of multiphase fluid flow using microfluidic devices has served as a useful tool for direct evidence of unique fluid transport mechanisms in porous media and characterizing important factors directly advanced imaging techniques and cutting edge image processing analysis algorithms have been an active research area to produce more reliable and accurate experimental outcomes from a micromodel experiment application and development of appropriate image processing analysis algorithms are essential to successful assessment of the variables of interest such as fluid saturation and other morphological features from microfluidic experiments for instance mahmoodi et al 2018 applied successfully various machine learning algorithms to enable an automated image based computational statistical analysis for better assessment of micromodel experimental results understanding the mechanisms of the formation of residual nonwetting phases is significant to developing better recovery methods the formation of residual oil is directly related to the complex interplay between pore structure wettability pore body throat ratio and pore size distribution machine learning methods in recent years have been widely used in subsurface engineering to improve efficiency and ensure objectivity zhao et al 2017 proposed the application of machine learning tools especially for the automated analysis of micromodel experiments zhao et al 2017 used the conventional machine learning method called a seeded k means semisupervised learning ssl to classify automatically remaining oil at the micropore scale by training on the images of the remaining oil in the high water cut stage from 2d etched glass micromodel experiments zhao et al 2017 showed that the k means semi supervised learning ssl method classified automatically remaining oil into four types oil film throat retained oil heterogeneous multipores oil and clustered oil 2 4 deep learning applied to porous media in contrast to conventional machine learning techniques that typically require manual feature extraction deep learning methods allow machines to work effectively with the raw input and automatically extract features needed for the learning tasks such as classification or regression a typical deep learning model consists of layers with linear and non linear transformations by stacking many such layers a deep neural network is theoretically capable of approximating any complex non linear function deep learning models such as convolutional neural networks are very good at discovering intrinsic structures in data such as images and are therefore very successful at machine learning tasks such as pattern recognition and image classification goodfellow et al 2016 there are many different architectures for deep neural networks and each of them is suitable for different inputs in a fully connected neural network fcn neurons at each layer are connected to all neurons in the previous layer fcn models work well for input with a relatively small number of features because the number of parameters in fcn models scale directly with the input dimension unlike an fcn the neurons within each layer of a convolutional neural network convnet are only connected to a small region of the previous layer this difference helps to reduce the number of parameters in a convnet significantly a convnet preserves image dimensions including width height and depth e g color channels the output from every layer of a convnet preserves the 3d volume structure this makes the learning of spatial correlation of the input images more effective on the other hand it also makes the forward evaluation in a convnet more efficient to implement a typical convnet consists of mainly convolutional layers and pooling layers at each convolutional layer multiple filters with a relatively small spatial size are applied to obtain neurons in the next layer these neurons are connected to local patches of the feature maps from the previous layer all the neurons share the same set of filters these filters scan through the input feature maps to extract local features at every location the insight behind this design lies in the fact that for input data such as images values of a local region of pixels are often times highly correlated and the local features in images are typically irrelevant to location therefore it is effective to use the same set of filters to extract local features at different locations the result of this local filtering is passed through a non linear activation layer such as a relu f z m a x z 0 to add nonlinearity to each layer and improve the expressiveness of the convnet a pooling layer locally summarizes the activation from a convolutional layer it reduces the spatial dimension of input increase the reception field size and helps the deeper layers learn larger scale features for image classification tasks the output from the final convolutional layer is converted to a vector and then fed through fully connected layers to obtain the final output of probabilities for different categories successfully applying deep learning requires appropriate specification of hyperparameters such as network architecture activation functions and learning rates determining optimal hyperparameter values is important to obtain the best performance of a deep learning algorithm in addition to feed forward convnet and hyperparameter tuning such as a deeper network more advanced architectures such as residual layers he et al 2016 may help to mitigate gradient vanishing in deep neural works and implementing skip connections ronneberger et al 2015 helps small scale features in shallow layers to propagate through a deep architecture alqahtani et al 2018 recently used deep learning models to predict properties of porous media from unprocessed image data alqahtani et al 2018 proposed the application of a convnet to study pore scale transport phenomena from high resolution micro computed tomography micro ct imaging of digital rocks the convnet is trained to learn rapidly from 2d greyscale microcomputed tomography images and predict several porous media properties porosity coordination number and average pore size the deep learning based analysis ensured that petrophysical analysis of digital rocks can be conducted without the need for user biased image processing algorithms and expensive numerical simulations 3 data acquisition an experimental procedure to fabricate microfluidic devices with strong oil and water wet surface wetting conditions is presented importantly laser scanning fluoresence microscopy lsfm is used to collect many pore scale images image processing post image acquisition and details of the data structure for images are also presented in this section to document the use of microfluidic image data and deep learning 3 1 creation of oil and water wet surfaces micromodels are designed in house and manufactured in the stanford nanofabrication facility snf using standard photolithography techniques following the procedure outlined by buchgraber et al 2012b 4 inch silicon wafers were etched with a pore network to a depth of about 20 µm as a final fabrication step a glass cover plate was attached to the top of the etched wafer using anodic bonding hence a closed system capable of holding fluids under pressure is created during bonding the wafer surface is oxidized and is water wet subsquently the surface was modified to oil wet using a silane treatment process employing hmds grate et al 2013 kisler et al 2003 reported that the stability of hydrophobic surface coatings via hmds treatment persisted in aqueous solutions for about 7 days the micromodels used in this paper have either sandstone type or carbonate type pore networks and the wettability of both rock patterns is either strongly oil wet or water wet fig 1 illustrates the outcome of micromodel fabrication and wettability alteration at pore scale in a sandstone type pore network false coloring has been applied such that water is shaded green and oil is shaded red fig 1 a demonstrates grains that are clearly water wet as water coats the grain surfaces even when surrounded by oil on the other hand fig 1 b displays oil wettability in that oil coats grain surfaces and inhabits the smallest pore spaces that have not been invaded by water this figures also displays some emulsification of water within the oil phase 3 2 micromodel experimental setup real time visualization of flow and or transport in the micromodel is critical for a successful microfluidic experimental setup thus a basic microfluidic setup consists of a pump microfluidic device pressure controllers and visualization system in figs 2 and 3 syringe pumps inject the fluid into the chip pattern through the inlet tube where it displaces interacts with resident fluid in the micromodel in this work we inject a total of about 1 pore volume of fluid at a flow rate of 0 001 ml min ca of about 10 6 pressure transducers heating chambers and the microscope are equipped for both controls of experimental condition and qualitative quantitative measurements fig 3 provides details on how secure seals are made with micromodels to permit fluid injection and production 3 3 pore and whole micromodel imaging two different phases i e decane dyed with nilered and water dyed green with fluorescein were the injectants into the experimental setup shown in fig 2 saturation profiles of decane and water in the complex sandstone and carbonate type pore networks were documented using images to visualize the entire micromodel pore network 1400 microscopic images were stitched together as illustrated for a sandstone type micromodel in fig 4 the image acquisition was conducted using a laser scanning fluorescence microscope with a 100x objective the field of view of a single image with a 100x objective is about 800µm by 800µm and the acquisition time is 0 6 s at 100x the overall ganglia pattern and details of the phase wetting the solid are readily apparent we believe that characterizing the morphology of phases within the pore space gives more holistic details for micromodels in comparison to contact angle measurement because the topology of a phase in the depth direction which is important to contact angel determination is difficult to image the final size of the fov from the images are varied during the training phase of deep learning due to the importance of spatial resolution for wettability classification more details about the variation of spatial resolution are discussed in the next section each raw pixel from image 200 200 3 pixels has a corresponding pixel wise fluorescence emission intensity for the range of wavelength from 450 to 700 nm the emission data from nilered and fluorescein dyed phases was used for post processing and for phase segmentation for decane and water phases respectively then the decane water and grains in the images were identified and labeled a total of 1600 images from each rock pattern for both oil and water wet conditions were prepared the images were assigned manually to their classes as shown in fig 5 4 training spatial resolution is important for wettability classification hence we explain the selection criteria for the 6400 images with different fovs for all classes this section discusses our methodology using fully connected neural networks and convolutional neural network models in detail its also details the evaluation criteria 4 1 image data with varying spatial resolution figs 6 and 7 display image data from the four classes with different spatial resolutions note that fig 6 is a sandstone type geometry whereas fig 7 is carbonate type the original 100x images are examined at four different spatial resolutions 0 6x zoom 1x zoom 2x zoom and 3x zoom relative to the baseline 800µm by 800µm image 0 6x zoom increases the size of fov whereas and 2x and 3x zoom decrease the size of fov hence 0 6x zoom images are particularly useful because they give an overview of the distribution and macrolevel configuration of the phases in the large domain of the pore network these images however do not give enough resolution to show thin film corner fluids surrounding grains pore level wettability is understood more clearly by studying the role of thin films in porous media kovscek et al 1993 in this regard 3x zoom images are high resolution and capture details of thin films and the shape of interfacial curvature and contact angles such details are significant aspects for pore scale wettability classification because the training image data set combines four different spatial resolutions it is expected to be helpful to evaluate the accuracy of our deep learning algorithms the varying spatial resolution of the carbonate type pore network results in a significant degree of heterogeneity in pore and grain size distribution i e dual porosity in contrast to the sandstone type network that has relatively uniformly distributed pore size and grain dimensions the greater heterogeneity is expected to aid image classification from the carbonate type networks the data structure for training has the same number of images for each class the dataset has 6400 rgb images 200 pixel by 200 pixel with 3 rgb channels in 4 classes including oil wet sandstone water wet sandstone oil wet carbonate and water wet carbonate there are 1600 images per class the 3200 sandstone images are used for sandstone wettability classification we randomly chose 3000 images as the training set 100 images as the evaluation set and 100 images as the test set to decrease the variance of test error estimation we use 10 different random seeds to generate 10 different splits of training evaluation and test sets we train each network 10 times each time on a different training set and estimate test error on the corresponding test set the average test error is used for comparing different networks similarly the 3200 carbonate images are used for carbonate wettability classification we apply the same strategy for splitting the dataset and estimating test errors finally all 6400 images are used for simultaneous classification of rock types and wettability following the same strategy of splitting the dataset and estimating test errors here each training set has 6000 images each evaluation set and test set has 200 images this training and testing strategy gives an objective assessment of the performance of the models 4 2 model architecture we consider two types of neural network architectures fully connected neural networks and convolutional neural networks recall that an fcn is the most basic form of a neural network and in a convnet each neuron is only connected to a local region of neurons in the previous layer this local connectivity makes convnet more effective at capturing the local features presented in image data we describe the architectures of fcn and convnet used in this study and compare their performances in both cases recommended values of hyper parameters were used without optimization for the fcn the input image originally of size 200 200 3 is reshaped to a vector of size 120000 1 it is then fed through four hidden layers each with 512 256 128 and 128 neurons respectively each hidden layer is followed by a batch normalization layer and then a relu nonlinear activation layer the output layer of the fcn first outputs a score vector of size of mc 1 where mc is the number of classes then a softmax activation function is applied to convert the class scores into class probabilities the major layers in the fcn are shown in table 1 the number of parameters to be trained in this fcn model is 61 623 554 we experimented with two architectures of convnet the first convnet is relatively shallow consisting of 3 convolutional layers and 2 dense layers we refer to this net as the 5 layer convnet each convolutional layer has 3 convolutional filters of size 3 3 followed by a relu nonlinear activation layer and a maxpool layer that down samples the input by a factor of 2 along each spatial dimension the output from the last convolutional layer is flattened to a vector and then fed through 2 fully connected layers to output the score vectors again the softmax activation function is applied to obtain the class probabilities the major layers in the convnet are shown in table 2 the total number of parameters is 939 254 that is around 65 times less than that in the fcn model the second convnet is relatively deep and contains more filters there are 6 convolutional layer and 2 dense layers we refer to this net as the 8 layer convnet each convolutional layer has a varying number of filters max pooling is performed after every other convolutional layer the architecture of the 8 layer convnet is shown in table 3 the total number of parameters is 2 513 402 that is around 2 5 times less than that in the fcn model both fcn and convnet use a cross entropy loss log loss function that is relevant to the distance between the output distribution from the trained model and the original distribution from the dataset cross entropy loss log loss function is an ideal loss function for our neural network architecture that have an activation function softmax applied to the scores in our model s output layer thus soft max activation with cross entropy loss trains a model architecture to output a probability over the mc classes for each image goodfellow et al 2016 more specifically minimizing cross entropy is equivalent to a direct indication of the increase in the predictive power of our model average cross entropy loss lavg is expressed as 1 l a v g 1 n i 1 n y i c ln p y i c 1 y i c ln 1 p y i c m c 2 1 n i 1 n c 1 m c y i c ln p y i c m c 2 where mc is the number of classes sandstone oil wet sandstone water wet carbo oil wet carbo water wet n is number of observations y i c is binary indicator 0 or 1 y i c 1 if class label c is the correct classification for observation i and p y i c is predicted probability observation i of class c to train the neural networks the training set is divided into mini batches of size b s 50 then an extension of the stochastic gradient descent optimization algorithms called rmsprop is applied ruder 2016 with a learning rate of l r 0 001 for a total of 20 epochs here one epoch means iterating through all the mini batches once 5 results and discussion the wettability and morphology of pores strongly influences the ganglia shape and pore scale configuration of oil and water phases this section presents the predictions of wettability strong oil wetting or strong water wetting and illustrates the interplay between the oil phase water phase and grain surfaces 5 1 the effect of spatial variation the role of spatial variation on training performance was investigated first for the sandstone case as summarized in table 4 the accuracy of the validation set is 0 87 and the test set accuracy is 0 86 for the fcn using 1500 sandstone images with 1x and 2x zoom increasing the number 3100 of training set images for the fcn with variation of spatial resolution 0 6x 1x 2x and 3x zoom resulted in a validation set accuracy that increased to 0 93 the test set accuracy however is 0 82 and so no enhancement is obtained compared to the accuracy with 1500 images of sandstone only 1x and 2x zoom the lack of enhancement in this case is attributed to the fact that it is challenging to evaluate wettability in the zoomed out 0 6x test set images that is it is difficult to recognize a distinctive oil and water configuration in the sandstone geometry due to its relatively homogeneous size distribution the role of spatial variation on training performance could be evaluated in the future using results from the carbonate type images because the carbonate rock type has a more heterogeneous pore size distribution 5 2 evaluation of classifiers to evaluate fully the effectiveness of the models we examined both average precision and average accuracy on the test set from 10 training runs recall that we trained each model 10 times with 10 different random splits of training evaluation and test sets all test data sets have a roughly balanced number of images between water wet and oil wet where the ratio is around 50 50 hence accuracy and precision are objective evaluation tools for the approximately balanced datasets we also tabulated average confusion matrix in tables 5 and 6 to obtain more detailed measures of accuracy and precision the confusion matrix constructed here has four elements as follows twpw rate in which true t label is water wet w and predicted p label is water wet w twpo rate in which true t label is water wet w and predicted p label is oil wet o topw rate in which true t label is oil wet o and predicted p label is water wet w topo rate in which true t label is oil wet o and predicted p label is oil wet o the values of average precision and average accuracy are computed from a confusion matrix as 2 a c c u r a c y b a l t w p w t o p o t w p w t w p o t o p w t o p o 3 p r e c i s i o n w t w p w t w p w t o p w 4 p r e c i s i o n o t o p o t w p o t o p o where accuracy b a l is the measurement of the weighted percentage of correct decisions the classifier makes for oil and water wet cases precision w is the percentage of water wet identifications being correct and precision o is the percentage of oil wet identifications being correct table 7 tabulates the accuracy and precision values for oil wet and water wet calculated from all values in the confusion matrix overall trained models performed binary classification very well showing accuracy b a l greater than 95 except for the performance of fcn for sandstone rock type as expected convnet performs better comparing all aspects accuracy b a l precision o precision w in table 7 regardless of the type of rock patterns convnet substantially preserves the relationship between the neighbor pixels thus the pore level details of the spatial arrangement of rock thin films and interface angles are captured better the 8 layer convnet model achieves further improvement on top of the 5 layer convnet model consistent with the general observation in the computer vision community the deeper architecture and larger number of filters help improve the performance of the convnet in image classification interestingly improvement of classification performance from fcn to convnet is more substantial and profound for sandstone than for carbonate networks for instance accuracy b a l increased from 87 4 by fcn to 99 5 by 8 layer convnet for the sandstone rock type giving 12 1 improvement as opposed to 0 6 increase for the carbonate rock type the relatively heterogeneous pore size distribution in carbonate porous media promotes more distinctive capillary force contrast throughout the pore spaces than that of homogeneous sized pores in sandstone consequently images from carbonate rock have more profound saturation profiles and provide additional features for the classifier model to determine wettability accuracy b a l of the 8 layer convnet for all four classes is 98 5 this promising result indicates that the classifier performs satisfactorily to classify wettability and grain shape distribution simultaneously 5 3 image specific saliency map generating an image specific saliency map simonyan et al 2014 allows us to rank the pixels of a given test image based on their influence on the classification score for oil and water wet surfaces image specific class saliency demonstrates the class score derivative with respect to each pixel of the image hence the saliency map highlights the pixels that affect the class score the most simonyan et al 2014 generally such pixels correspond to particular object locations within images for the object detection classification within an image the influence of pixels of i 0 on the top 1 class score sc i 0 is computed for a given an image i 0 a class c and a classification convnet with the class score function sc i as described in simonyan et al 2014 for example we compute the linear score for the class c for a given image i 5 s c i w c t i b c i bc and wc are the image in the vectorized one dimensional form the bias of the model and the weight vector respectively the magnitude of an element weight vector w c i j indicates the significance of the corresponding pixels of i for determining the class c as described in simonyan et al 2014 the class saliency map m r m n of an image i 0 with m rows and n columns and a class c is obtained by computing the derivative w using back propagation and rearranging the elements of the vector w in the present work we use the multichannel e g rgb color image with weight w h i j z where the index h i j z represents the color channel z of the pixel in the i th row and j th column of image i the greatest absolute value of w across all color channels m i j max z w h i j z was used to obtain a single class saliency value for each pixel i j from a convnet trained on the image labels the saliency map for a single class of a specific image is computed quickly by a single back propagation pass using tensorflow tf gradients sc i 0 i 0 an image specific saliency map is computed using the gradient of the class score with respect to the input image generated the saliency map addresses the visualization of our wettability classification models learned using convnet or fcn the saliency map shown in fig 8 illustrates the importance of each pixel and its effect on the classification score for the top 1 class for that image we use the 8 layer convnet and the first random split of dataset for generating the saliency maps to analyze quantitatively the spatial distribution of high saliency pixels we did the following we first extract the rock fluid interface from the images as shown in fig 8 d and then calculate the euclidean distance in number of pixels to the closest rock fluid interface for all pixels as shown in fig 8 e for convenience we refer to this distance as p2i pixel to interface distance for each image we use the average p2i distance from all pixels each image has a total of 40 000 pixels as a reference value then we compute the average p2i distance from the top 0 1 0 2 0 5 and 1 pixels with the largest saliency values the statistics of the average p2i distance from all pixels and top saliency pixels are summarized in table 8 for sandstone the average p2i distance from top saliency pixels are significantly smaller than the average p2i distance from all pixels this indicates pixels near rock fluid interfaces are most important for the 8 layer convnet to classify wettability for sandstone for carbonate the average p2i distance from top saliency pixels is only slightly smaller than the average p2i distance from all pixels this means that the 8 layer convnet considers wider regions compared to sandstone for classifying wettability of carbonate the image specific class saliency map topo in fig 8 highlights the areas of the given image identified with respect to the given class top 1 class as oil wet in this case as can be seen in fig 8b and c pixels in pore throats and near interface of phases are the most important for the model s prediction of the oil wet class quantitatively fig 8 f illustrates that the top 0 1 saliency pixels have smaller p2i distances and close proximity to the rock surface fig 8 c combines test image fig 8a and saliency map fig 8b for a better localization of the pixels that have more impact on the oil wet classification significantly fig 8 c demonstrates the bright highlighted regions where the trained model focuses on the interface area between rock water oil and pore throats occupied by the wetting phase water for its prediction of oil wetness another image specific class saliency map topo in fig 9 for the image of very low non wetting phase water saturation is presented clearly compared to pixels of grain and dominant wetting phase decane in red we see that the pixels of the water ganglia green interface and dominant wetting phase surrounding the grain surface in the image affect significantly the model s prediction of the oil wet class saliency maps twpw for images of water wet carbonate with large fov display the importance of identifying the particular phase that occupies large versus small sized pores in a dual porosity medium fig 10 the images contain overall saturation profiles in both micro and macropore regions but few fine details of contact angle and the interface between two phases the model predicts the correct class we see that fig 10c highlights the pixels of water green in the macropore larger size pore space region and water phase located close to the grain surface for its prediction of the oil wet class compared to the sandstone case where the top 0 1 saliency pixels are located near the rock surface the prediction on carbonate pore networks produces the saliency map showing the wide range of p2i distance from top 0 1 saliency pixels fig 10f the heterogeneous nature of the carbonate pore network requires the trained algorithm to perform multi level observations near surface and overall phase saturation profile for the wettability classification fig 11 addresses the case of small fov where small pore space is occupied by single phase water in green the convnet model successfully predicts the water wet class for the image even though the image has no oil phase training using images that are either homogeneously water wet or oil wet is important to identify regions of pore space filled with a single phase and their wetting fluid occupancy because heterogeneous micromodels have a distribution of pore sizes the wetting fluid is preferentially found in the smallest pore space where nonwetting fluid has not had sufficient capillary pressure to invade these regions are important for wettability classification the class saliency map topo in fig 11c shows the model s strong emphasis on the body of gain and the region of the interface between grain and water the central body of water green ganglia has less impact on the model s class prediction 5 4 versatility of trained deep learning algorithm the trained algorithm with a 5 layer network was applied to a water and surfactant flooding experiment conducted by yun chang cogswell eichmann gizzatov thomas al hazza abdel fattah wang 2020 the object of the experiment was to evaluate the efficacy of aqueous surfactant solution to mobilize trapped nonwetting phase fig 12 summarizes microscopic images of the microfluidic chip after the water flooding fig 12 a and after the surfactant flooding fig 12 b the microscopic images were not used for training the convnet and the network has never seen this particular pore network pattern the microfluidic chip is commercially available micronit microtechnologies netherlands with a pore volume of 2 4 μl and 60 matrix porosity the object of this test is to evaluate whether the trained algorithm is applicable to determine the initial wettability during the water flooding stage and to detect the alteration of wettability after 1 pv injection of aqueous surfactant solution the trained convnet predicts the oil wet conditions for all three oil wet images fig 12 a 1 a 2 and a 3 regardless of the increase in water wetness of pore surface in fig 12b the trained algorithm strongly relies on the dominant region with the occupancy of wetting phase oil near surface for its wettability prediction a partially water wet surface is seen in fig 13 b however the trained algorithm predicts fig 12b 1 b 2 and b 3 as the oil wet conditions as shown in fig 13b 1 6 summary and future work this work presented and evaluated a methodology for automated classification of images from microfluidic devices micromodels with water and oil wet surface wettability fluid injection experiments using micromodels with two different pore network patterns were conducted to prepare pore level images that were used as a data set to train two deep learning algorithms the first is a three layer fully connected neural network fcn and the second is a convolutional neural network convnet both models successfully classified test set images according to wettability the convnet was the most accurate classifier with an average test set accuracy of 99 5 1 for sandstone pore networks 99 3 1 for carbonate pore networks and 98 5 1 for all two pore networks deep learning significantly sped up and enhanced the accuracy of interpretation of images from micromodel experiments interestingly construction of saliency maps for both types of pore networks with various occupancy of pore spaces by oil and water showed that the deep learning algorithms focused on solid fluid interfaces and the fluid phase occupancy of the smallest dimension pore spaces such as pore throats to classify wettability these are the same features used in the manual classification of the images that formed the training data set there are numerous possibilities for further work from the studies of the effect of spatial variation we may enhance the data quality by adding more levels of image magnification consistent with the difference in pore size distribution and pore sizes for carbonate type and sandstone type pore networks more images with greater magnification such as 4x or 5x zoom of base images for both the sandstone type network will give greater weight to thin film thickness on the grain surface and thereby aid wettability classification additionally the images used for training had surfaces that were uniformly wetting to water or to oil we demonstrated briefly that our trained algorithm failed to detect the onset point of the mixed wet condition thus enlarging the study to a greater range of wettability including mixed wettability where water wet and oil wet surfaces are found in the same pore spaces would be of great interest such images might also provide the opportunity to quantify the fraction of the pore space wet by each fluid if a crude oil is used to establish mixed wettabiity the trained model enables wettability classification resulting from the precipitation of crude oil components asphaltenes from locally trapped crude oil it would be very interesting to try to incorporate dynamic effects by examining target areas of the image where the relative wettability changes depending on preferential dynamics of flow stagnant flow areas would make a useful comparison to areas of substantial flow including the leading edge of displacement fronts to understand if wettability alteration proceeds at different rates in these differently swept areas the long term stability of hmds coating grate et al 2013 is limited under aqueous conditions this loss of hydrophobicity over time 7 8 days could be used to create micromodel surfaces with more or less uniform intermediate wetting conditions an image data set with intermediate wetting adds an additional class for deep learning models that could be a great benefit for the precise classification of possible wetting scenarios hence proper training of the deep learning algorithm for different wetting conditions would serve as a tool to monitor the progress of mixed wettability caused by different pore level scenarios in oil reservoirs or in soils where oil has been spilled future applications of deep learning in microfluidics may also be to connect initial and injection conditions to the outcomes of wettability or desaturation of pore space documented in images for example deep learning may be used to choose the rate conditions of an experiment or the properties of a chemical to be injected to achieve the outcome desired in this way the hit or miss nature of screening of injectants may be altered and more time focused on understanding how to obtain optimal outcomes credit authorship contribution statement wonjin yun conceptualization methodology software writing original draft yimin liu conceptualization methodology software writing original draft anthony r kovscek conceptualization supervision funding acquisition writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgment the support of the supri a industrial affiliates is acknowledged gratefully 
422,the morphodynamics of tidal marshes is investigated using a novel model marshmorpho2d that couples 2d tidal dynamics wave dynamics mass conserving sediment transport edge erosion pond dynamics and marsh upland migration by only changing tidal range sediment supply and rslr rate the model reproduces a great variety of spatial patterns in marsh loss for all tidal ranges an increase in rslr triggers channel widening whereas a decrease in sediment supply triggers tidal flat deepening and increases wave edge erosion marsh loss by pond runaway expansion dominates for intermediate rslr rates especially for small tidal ranges and for small sediment supplies drowning only takes place in the microtidal setting for high rslr rates and extremely low sediment supply drowning is restricted to the landward portion of the marsh and lacks the variety of spatial scales associated with pond runaway for a large tidal range the amount of marsh loss by drowning and pond runaway is negligible thus increasing the relative importance of edge erosion and channel widening upland migration deepens the channels which release sediment and thus help sustaining the existing marsh nonetheless marsh upland expansion compensates for existing marsh loss only for a large tidal range or for a high sediment supply and thus microtidal marshes are likely to experience net loss marsh loss is highly heterogeneous and is not well represented by the dichotomy between marsh survival and marsh loss based on vertical accretion thresholds marsh loss can take place by a variety of mechanisms hindering the ability to generalize predictions about marsh loss 1 introduction the fast rates of marsh loss observed in the last decades have raised concerns about the sustainability of tidal marshes a plethora of models have been proposed to explain the observed patterns of marsh loss and predict their extent in the next centuries fagherazzi et al 2012 wiberg et al 2020 commonly identified mechanisms of marsh loss are drowning channel widening marsh edge erosion and pond expansion the complex interplay between these different mechanisms might explain a recent conclusion based on field observation that marsh degradation can occur through many different pathways wasson et al 2019 despite this evidence however existing marsh evolution models focus on a few mechanisms at a time and thus they inevitably provide partial results that are biased toward the mechanisms taken into consideration the simplest spatially distributed marsh evolution models only include marsh vertical accretion without an explicit link to sediment dynamics examples are the slamm model craft et al 2009 the diva model spencer et al 2016 and the hydromem model alizad et al 2016 all of which are applied to relatively large marsh domains 100 km2 a common assumption of these models is that marsh loss can only take place by drowning when the vegetated platform accretes slower than the relative sea level rise rslr rate even though these vertical only models are useful to establish the optimum elevation for marsh restoration they might underestimate marsh loss when mechanisms other than drowning are important models applied to smaller domains 0 1 10 km2 have focused on the coupled dynamics of the channel network and marsh platform these models simulate the decrease in suspended sediment concentration away from the channel network d alpaos and marani 2016 kirwan and guntenspergen 2010 thus providing more realistic spatial patterns on the marsh platform for example these models predict that marsh drowning will mainly take place in the marsh interior in addition because the channel network is allowed to change through time marsh loss can also take place by channel widening belliard et al 2015 d alpaos et al 2007b kirwan and murray 2007 mariotti 2018 marsh loss by wind induced edge erosion fitzgerald and hughes 2019 leonardi et al 2016 schwimmer 2001 has been the focus of a relatively few morphodynamic models marsh edge erosion coupled with tidal flat dynamics has been implemented in 1d i e transect models mariotti and fagherazzi 2010 tambroni and seminara 2012 which highlighted that the marsh edge will retreat as the sediment supply to compensate for that loss decreases more realistic patterns of marsh edge erosion has also been simulated with 2d models which however neglected the tidal dynamics and sediment mass conservation leonardi and fagherazzi 2014 valentine and mariotti 2019 in addition wave dynamics and marsh edge erosion have been included in state of the art hydromorphodynamic models which despite their richness of details still have limitations in predicting marsh evolution for example marsh edge erosion has been implemented in the delft3d model but at the expenses of using a very coarse spatial resolution mariotti and canestrelli 2017 a similar approach using delft3d included a more realistic representation of vegetation processes best et al 2018 but at the expense of not including the actual mechanism of wave induced edge erosion i e simulating it instead as a vertical erosion mechanism and largely restricting the size of the model domain and the time window simulated in addition to tide and wave dynamics biochemical driven processes such as those associated with ponds have been recognized as an agent of morphological evolution ponded areas not only prevent the vegetation from accumulating new organic sediment but also oxidize the existing organic matter through sulfate reduction spivak et al 2017 van huissteden and van de plassche 1998 in turn this process causes an active lowering of the bed and a lateral erosion of the pond edge ponding has been first included in a predictive model for marsh evolution by including temporary vegetation disturbances kirwan and guntenspergen 2010 i e by only including the vegetation removal effect subsequently a lumped model for pond dynamics included the process of pond expansion and determined the critical sedimentation rate for pond recovery mariotti 2016 this model was then incorporated in a spatially explicit 2d framework mariotti et al 2020b which also included the process of active pond deepening yet the model still neglected channel dynamics tidal flat dynamics and marsh edge erosion and thus prevented to simulate the transition from biochemical driven pond expansion to current and wave driven erosion recent emphasis has been given to upland migration as a way to create new marsh fagherazzi et al 2019 this process has been explored with 1d transect models kirwan et al 2016 schuerch et al 2018 which assume that new marsh creation is proportional to rslr rate and generally forecast that new marsh creation will exceed the loss of the existing marsh these predictions neglect 2d effects including channel dynamics and pond dynamics and thus might underestimate the loss of the existing marsh furthermore the absence of sediment mass conservation in one of these models schuerch et al 2018 casted some doubts about its ability to correctly simulate the persistence of the marsh recently created by upland expansion tornqvist et al 2019 field measurements have further emphasized the need for a comprehensive sediment mass budget to assess the stability of marshes ganju 2019 similarly landscape evolution models need to perform a sediment budget of the entire system i e including channels and tidal flats so that feedbacks related to sediment mass conservation can be reproduced wiberg et al 2020 unfortunately many simplified 2d models for long term marsh evolution do not conserve the total mass of sediment specifically they assume a fixed sediment concentration within the channels which then act as an endless source for the marsh platform furthermore even 2d models that consider the dynamics of sediment within the channels neglect the coupling with the evolving tidal flats belliard et al 2015 mariotti 2018 i e a fixed suspended sediment concentration is imposed at the mouth of the channel and the marsh seaward position is fixed a recent summary on the state of sediment based marsh restoration ganju 2019 advocated for an integration of channel and intertidal flat processes and evolution as well as the role of open water conversion and edge erosion and concluded that more physically based deterministic models should be used to explore parameter space and guide management through identifying tipping points related to sediment supply relative sea level rise wave erosion open water conversion and integrative three dimensional processes in line with this conclusion we here develop a computationally efficient model capable of simulating the major ecogeomorphological processes in salt marshes including 2d tidal dynamics mass conserving sediment transport throughout the domain wave dynamics marsh edge erosion pond dynamics and marsh upland migration using this model we determine the relative and absolute contribution of each marsh loss mechanism for different settings tidal range rslr rate and sediment supply the spatial patterns of marsh loss associated with these settings and the amount of marsh loss that could take place in the absence of drowning 2 methods marshmorpho2d combines previously developed models mariotti 2018 mariotti et al 2020b valentine and mariotti 2019 in a consistent framework that 1 allows to conserve the total mass of sediment 2 does not impose geometric constraints within the domain e g the position of the channel network or the position of the marsh edge and 3 is computationally efficient the vegetation tidal hydrodynamic wave hydrodynamic sediment transport pond dynamics and morphodynamics modules are described below 2 1 vegetation model the presence of salt marsh vegetation is simulated in a parametric way as a function of the bed elevation marsh vegetation is assumed to be present between the elevation zlo and zup both calculated with respect to mean sea level msl following previous models morris et al 2002 the yearly peak aboveground vegetation biomass b is modeled as a parabolic function of the marsh elevation z the vegetation biomass is equal to zero for elevation smaller than z lo and larger than z up and it has a maximum midway between z lo and z up b is nondimensionalized by the maximum value so that b takes values between 0 and 1 a similar parameterization has been used in other marsh models carr et al 2018 kirwan et al 2016 and any other parameterization for the vegetation can be easily implemented in model the organogenic deposition term o which accounts for the net accumulation of both above and below ground biomass produced in situ is set equal to o max b where o max is a dimensional coefficient l t that includes the yearly rate of organic matter production the fraction of refractory material as well as the organic matter dry bulk density the maximum accretion by in situ production has been estimated to be between 3 mm yr morris et al 2016 and 9 mm yr blum and christian 2004 d alpaos et al 2007b and here it is set equal to 6 mm yr marsh vegetation also affects drag settling velocity and soil creep for simplicity the coefficients that characterize these processes are set equal to a constant value denoted by the subscript o when vegetation is absent and to another constant value denoted by the subscript b when the vegetation is present 2 2 tide averaged flow the model neglects intra tidal variability and calculates instead a tide averaged flow the model considers a spatially variable tide averaged water depth h which is equal to the average water depth only considering the times when the bed is inundated 1 h max 0 r 2 z max 0 r 2 z 2 where z is the bed elevation with respect to msl for numerical stability depths smaller than 0 02 m are set equal to 0 02 m the hydrodynamic model mariotti 2018 considers a friction dominated flow that neglects the temporal and inertial terms rinaldo et al 1999 a spatially variable water depth and bed roughness is included in the momentum equation di silvio et al 2010 then by linearizing the friction term di silvio et al 2010 and using the manning s equation the momentum and continuity equations are simplified as 1 u h 4 3 n 2 η 3 h u i where n is the manning friction coefficient set equal to no or nb depending on whether the bed is vegetated η is the water level surface u ux uy is the depth averaged and absolute value tide averaged velocity i e it is the absolute value of the velocity during either the ebb or flood phase the term i is the distributed input of water which varies in space as a function of the bed elevation and is equal to r 2 max r 2 min z r 2 t 2 where t is the tidal period to account for the velocity variability during a tidal cycle the intra tidal velocity is distributed as u t up sin t2π t where the peak velocity up is equal to u π 2 so that u 1 t 0 t u d t this allows to calculated the intra tidal current bed shear stress τ current ρgn 2 h 1 3 u 2 2 3 wind wave model the significant wave height and peak period of sea waves i e waves generated by the local wind hs and tp are calculated as a function of wind speed water depth and fetch using semi empirical formulas young and verhagen 1996 wind speed is imposed as a spatially uniform parameter and water depth is equal to the local tide averaged water depth h in every point the fetch is computed as the distance along the direction of the incoming wind to the first point where the bed is vegetated or where the water depth falls below a certain threshold which is set equal to 0 2 m in order to account for diffraction refraction and directional spreading of sea waves the fetch field is spatially smoothed by applying a diffusion rate of 0 1 m2 s for 1 day this procedure avoids the formation of unrealistic spatial heterogeneities in the wave field which create unrealistic streaks of erosion in the bed the smoothing coefficient is tuned to reproduce a realistic wave field given the wave height wave period and water depth the maximum wave orbital velocity uw and the wave power p is computed using the linear wave theory wiberg and sherwood 2008 the wave bed shear stress is τ wave 0 5ρfwuw 2 where fw is the bed friction coefficient calculated as fw min 0 3 0 00251exp 5 21 aw ks 0 19 swart 1974 and where aw is the orbital amplitude and ks is the nikuradse length in sandy beds the nikuradse length is generally assumed equal to 2 5 times the median grain diameter but in muddy beds the irregularities due to bioturbation and flocculation dominates over the roughness of individual grains grant and madsen 1986 indeed the bed roughness of muddy sediments could be as high as 1 cm ke et al 1994 here we chose ks 0 3 mm such that the modeled sea waves produce a realistic range of bed shear stresses 0 1 1 pa to take into account that the intertidal areas do not have waves during a portion of the tidal cycle the wave bed shear stress is also multiplied by the normalized hydroperiod which is calculated as fh min 1 r 2 min z r 2 r this factor is needed because the waves are calculated using the average water depth during the portion of the tidal cycle when the bed is inundated eq 1 2 4 sediment transport and bed morphodynamics the suspended sediment transport is assumed to be dominated by tidal dispersion di silvio et al 2010 and residual currents are neglected assuming that the sediment concentration field is at steady state the mass balance reads 4 k k o h c h d e where k kx ky is the tidal dispersion coefficient ko is horizontal turbulent diffusion coefficient d and e are the deposition and erosion terms and ch is the suspended sediment concentration averaged over the time during which the bed is inundated which is related to the tide averaged concentration as ch c fh the tidal dispersion coefficient is calculated based on the mixing length theory arons and stommel 1951 5 k i k u i 2 t 2 i x y where k is an adimensional coefficient following a calibration based on a comparison with a detailed hydrodynamic model this coefficient is set equal to 1 mariotti and murshid 2018 the horizontal turbulent diffusivity ko is introduced to allow for sediment transport even in the absence of tidal currents thus simulating processes such as wind driven and wave driven horizontal mixing assuming no threshold for settling sediment deposition is calculated as 6 d w s c w s c h f h where the settling velocity ws is set equal to wso where vegetation is not present and to wsb where vegetation is present adopting a formulation that allows a smooth transition near the critical shear stress carniello et al 2012 the tide averaged erosion flux reads 7 e 1 t 0 t m e max 0 1 τ τ c r 2 1 d t where τ is the intra tidal total bed shear stress which is equal to the sum of the current and wave bed shear stress τcr is the critical shear stress and me is an erodibility coefficient because the erosion is integrated over a tidal cycle the term e becomes independent of the specific timing of the tide as such given a certain morphological configuration the terms e and d represent an idealized erosion and deposition rate present at any given time the evolution of the bed elevation is then computed as 8 z t d e ρ s o r f where ρs is the inorganic dry bulk density r is the rate of relative sea level rise and f is the soil creep or soil diffusivity flux the in situ organic deposition is assumed to contribute to a common sediment pool that combines both organic and mineral matter i e the amount of organic material is not kept track off therefore when soil is eroded e g through the term e the released material is treated as if it was all composed of mud as such the model keeps track of the total amount of sediment but does not keep track of the amount of organic and mineral individually as explained later an exception to this rule is present for the marsh edge erosion and ponding mechanism the soil creep flux is set proportional to the bed slope 9 f μ a μ e z where the bed is devoid of vegetation the creep coefficient μ is set equal to μo which is equal to 3 65 m2 yr based on previous model calibration kirwan and murray 2007 where the bed is vegetated the creep coefficient μ is set equal to μb which is equal to 0 1 m2 yr following field measurements in plum island estuary ma usa mariotti et al 2019 following mariotti and murshid 2018 we also include a downslope term that is proportional via the coefficient aμ to the total bed erosion this component prevents the creation of unrealistic deep and narrow channels in the tidal flats to allow for channel incision over flat surfaces the creep flux is set equal to zero for slopes smaller than one degree 2 5 marsh edge erosion the rate of marsh edge erosion is assumed to be linearly proportional to the wave power at the marsh edge 10 w α e d g e p f h where αedge is the marsh edge erodibility and where the term fh is included to take into account the reduction in the tide averaged wave power when the bed is located above mlw i e the bed is dry for some portion of the tidal cycle the process of marsh edge erosion is numerically implemented using a probabilistic approach during a time step a cell is eroded with probability equal to wtot δt δx where wtot is the sum of the wave power at all the exposed sides of the cell and where δx and δt are the spatial and temporal discretization the thickness of the eroded marsh cell is equal to the elevation of the eroded marsh minus the average of the elevation of the adjacent wet cells if this thickness is higher than the maximum scarp height δscarp set equal to 2 m the thickness is set equal to δscarp a fraction fox of the material eroded through edge erosion is assumed to be oxidized i e it is removed from the system the remaining material is conserved and it is distributed in the nearby cells this redistribution is calculated by diffusing away the material from the eroded cell with a diffusion coefficient proportional to the water depth so that the material is mostly distributed toward the tidal flat where the water depth is larger the fraction fox should in theory depend on the amount of organic matter in the marsh and on the tendency of this organic matter to be oxidized because the model does not keep track of the amount of organic in each cell the fraction fox needs to be assumed a priori and thus relies on the assumption that the organic content within a single salt marsh in nearly constant as a reference we consider the case in which all the material is conserved i e fox 0 and the case in which some of the material is oxidized is discussed as a sensitivity analysis 2 6 pond dynamics ponds are defined as waterlogged areas i e areas that remain permanently inundated even at low tide ponds are identified at every time step i e any time the bathymetry changes to identify ponds the model first defines the channel network as those cells with an elevation lower than a certain threshold zntw here set equal to the lower limit for vegetation growth so that the channel network only includes unvegetated cells and that are continuously connected to the open boundary of the system to exclude low lying areas in the marsh interior that might indeed be ponds then the model performs a flood fill operation which identifies all regional minima in elevations that are not connected to the channel network this allows to calculate the depth of the water than would remain on the marsh surface at the end of the ebb phase then any cell with a residual water depth larger than a certain threshold δmin 0 1 m is classified as a pond according to the procedure large pond areas can form in the marsh interior when the marsh close to the channels attains an elevation more than δmin higher than the marsh interior and continuously encircles the marsh interior according to this rule a marsh that is flat or monotonically sloping toward the channels would never form ponds to simulate the effect of pond formation by physical disturbances such as rafting ice plucking and animal grazing we included a pond seeding mechanism mariotti et al 2020b during a time step every vegetated cell independent on their elevation has a probability pseedδx2δt to experience a pond seeding event cells that are selected for seeding are lowered by an elevation δpondseed this mechanism does not directly classify these cells as ponds but because δpondseed is larger than δmin these depressions are automatically classified as ponds by the pond finding procedure the model does not have an ad hoc mechanism for pond reconnection which was needed in a previous simplified pond model mariotti et al 2020b instead a pond would automatically reconnect when it stops to be identified as a pond by the pond finding procedure this generally happens when a new small channel forms and connect the pond to the main channel network but can also happen when an existing channel widens or when the wave exposed marsh edge retreats a previous analysis mariotti et al 2020b showed that the main effect of pond seeding is not to directly removing marsh area but rather to create new sites for pond expansion which is described below this condition only applies when the initial pond seed is relatively small e g 1 m2 the grid resolution used in the marshmorpho2d simulations δx 10 m is such that the initial size of the pond seed is at least 100 m2 and thus the amount of area directly created by pond formation is not negligible as such the rate of pond seeding needs to be reduced compared to previous calibration mariotti et al 2020b by reducing the rate of pond formation rate from 0 4 10 4 ponds m2 yr to 0 4 10 5 ponds m2 yr the model predicts that the average pond area in the pond recovery regime is 10 of the total marsh area which matches the observation in barnstable marsh mariotti et al 2020b and in the plum island estuary marsh spivak et al 2017 the presence of ponds affects the marsh dynamics in three ways first pond areas do not have vegetation even though their elevation is within the range for vegetation growth z zlow any submerged aquatic vegetation that might be present in the ponds is neglected therefore ponds do not have in situ plant production and their settling velocity and drag coefficient is the same as the unvegetated areas second ponds experience enhanced organic matter decay by sulfate reduction van huissteden and van de plassche 1998 and thus lose elevation at the rate pdeepeing third ponds expand laterally because the edge of the ponds is also subject to organic matter decay pond expansion is simulated at the interface between ponds and vegetated marsh cells the vegetated cells are eroded with the same probabilistic algorithm as the wave induced marsh edge erosion with the difference that the rate of retreat is set equal to a constant rate pexp direct measurement in the barnstable marsh found an expansion rate of 1 5 cm yr mariotti et al 2020b however because the rate of pond formation is reduced by a factor 10 the pond expansion rate is also increased by a factor 10 to obtain a similar balance even with this correction the pond expansion rate 15 cm yr is much smaller than the average retreat by wave edge erosion which is generally 1 m yr the elevation loss by pond expansion is set equal to the minimum between the pond scarp height and δpondseed both the process of pond seeding pond expansion and pond deepening lower the bed elevation and are all implemented as an additional term in eq 8 all material removed by this elevation loss is removed from the system given that is assumed to be caused by organic matter decay because the model does not keep track of the stratigraphy this loss needs to be applied to the common pool of sediment i e the combined mud and organic this elevation loss could be interpreted to selectively take place on the organic fraction of the sediment as an example we consider an arbitrary elevation equal to 0 2 m if the soil was composed 100 or organic material this would be interpreted as net scour of 0 2 m if the soil was composed of 50 of mud this would be interpreted as the reworking of 0 4 m soil where 50 of the material is removed and 50 is re deposited in the same cell thus causing a net 0 2 m scour 2 7 numerical implementation tidal flow wind waves sediment transport and bed elevation changes are discretized over a structured cartesian domain and solved with a finite volume implicit method opportune boundary conditions are imposed zero water flow and zero sediment transport at the closed boundaries zero velocity gradient and constant suspended sediment concentration co at the open boundary fig 1 the model conserves the total sediment mass i e mud and organic combined together within the domain deviation from the sediment conservation arises from 1 material entering or exiting the seaward boundary 2 accumulation of new organic material by in situ production 3 decay of organic matter by pond formation expansion and deepening 4 decay of organic matter released by edge erosion all of these components are tracked and can be included in the sediment budget e g the model keeps track of how much material entered or exited the domain from the seaward boundary the model splits the hydrodynamics and morphodynamics steps given a certain morphodynamic configuration the hydrodynamic and sediment transport equations eq 1 7 are calculated at steady state as indeed reflected by the absence of a time component in those equations that is the values are assumed to remain constant until the bed is updated which is generally one year but it could be much shorter as explained below the model is run with a reference morphodynamic time step equal to 1 year any time variable forcing i e the wind speed and direction is kept constant during a morphodynamic time step given the steady state hydrodynamic and sediment transport results the morphodynamic changes associated to the morphodynamic time step are computed eq 8 plus the procedures for edge erosion and ponding if the elevation change in any point is greater than a certain threshold the whole morphodynamic time step is discarded and the step is divided in two subsets the first subset of the step i e the first 0 5 years is calculated ex novo i e the steady state equations are calculated and then the morphodynamics is updated if the changes satisfy the morphological requirement the subset is accepted and the morphodynamic is updated if not the initial subset is further divided in two subsets and the procedure is repeated until a subset is finally accepted when a subset is accepted the whole procedure is repeated for the remaining portion of the original moprhodynamic time step which could be further re subdivided if needed in general every time that a subset is accepted the bed morphodynamics is updated and the steady state hydrodynamics and sediment transport are recalculated once the original morphodynamic time step is completed the morphodynamic configuration at the end of the step is finalized the next moprhodynamic time step is then run with new forcings e g a different wind speed and direction there are several reasons why large morphological steps can be used first by integrating over a tidal cycle the actual changes of the bed are smaller than the instantaneous bed changes second the calculation of the suspended sediment concentration and thus the sediment deposition uses an implicit method which avoids the occurrence of extremely high deposition rates third the bed diffusion is also calculated with an implicit method which filters out excessive scouring as a result the code is extremely fast for a 300 500 cells domain as used here a morphological time step which is generally one year requires about 3 s on a single core 3 6 ghz computer also the computation time scales about linearly with the number of cells because the time steps are relatively long 1 year an hourly wind speed time series that includes both calm and stormy periods cannot be directly used instead we identify an equivalent wind speed or morphological wind in analogy with the morphological tide defined by latteux 1995 whose effect is equivalent to the time variable wind for a given wind speed time series we assumed a water depth of 1 m and a fetch of 5 km and we use the wave model to calculate the time series of wave power and excess bed shear stress which is equal to max 0 1 τ τ c r 2 1 we then find a constant wind speed that gives the same value of wave power and excess bed shear stress as the average of the time series for illustrative purposes using a wind speed time series from the coast of massachusetts station 63048 from the usace wave information studies we obtain an equivalent wind speed of 7 m s for the wind direction a different value is randomly chosen every time step to allow for a more realistic wave field for simplicity we consider an isotropic wind direction distribution but an anisotropic wind distribution could be used without further complications 3 results all simulations are performed on a domain 3 km wide and 5 km long where the seaward 1 km is used as a permanent tidal flat where the marsh cannot propagate into thus preventing the marsh from filling the whole domain fig 1a the incoming waves from the seaward and lateral boundaries of the permanent tidal flat have an addition fetch of 5 km this allows to parametrize the effect of a larger and more exposed domain e g an estuary or a very large bay that is not explicitly included in the model even though the domain size and shape is arbitrary it is representative of many marsh systems fig 1d e noticeably it is much larger than the domain used in previous detailed hydromorphodynamic models belliard et al 2016 best et al 2018 and thus allows for space dependent feedbacks associated with wind waves examples of the velocity field wave field and suspended sediment concentration field from a simulation that used this domain is showed in fig 2 the simulation is initialized by considering a gentle sloping ramp starting at msl at the landward end and ending at 2 m depth at the seaward end fig 1a random perturbations in elevations on the order of 0 1 m are included to break the symmetry the model is then run with a constant rslr rate and sediment supply for 1000 years which is enough for the marsh to reach a steady state and thus create a reference marsh fig 1b c even though the eustatic sea level rise has been about 1 mm yr in the last five thousand years many areas in the atlantic and gulf coast of the usa have experienced a eustatic sea level rise of 2 3 mm yr since the beginning of the 20th century church and white 2006 donnelly et al 2004 gehrels and woodworth 2013 jevrejeva et al 2008 and have also experienced a wide range of land lowering rates due for example to glacial isostatic adjustments engelhart et al 2009 despite the large variability rslr rates experienced by marshes during their formation we select a single value r 2 5 mm yr to create the reference marsh we also select co 60 mg l which is considered a high sediment supply raposa et al 2016 starting with the steady state configuration we increased r and we decreased co and run the simulations for 200 years this time window which is the maximum interval previously identified as long term nasem 2018 is slightly longer than the time horizons considered by previous models nonetheless because acceleration in rslr and decrease in sediment supply have already took place since the beginning of the 1900s in some areas the 200 year simulation window could be interpreted as a prediction to year 2100 the increase in rslr rate and reduction in sediment supply simulated in the model is chosen to reflect realistic values for marshes in the atlantic pacific and gulf coasts of the us wasson et al 2019 all other parameters critical bed shear stress settling velocity maximum in situ deposition wind speed etc are kept constant table 1 we repeated these simulations for two different tidal ranges as mesotidal regime 3 m characteristics of new england salt marshes and a microtidal 0 7 m regime characteristics of marshes in chesapeake bay figs 1 and 3 3 1 rslr rates and sediment supply for the microtidal range a moderate rslr rate 5 mm yr causes a slight channel widening and an increase of unvegetated areas in the marsh interior which include both ponds and recently drained ponds that transformed into small tidal flats fig 3 both trends amplify for larger rslr rates while keeping a low rslr rate 2 5 mm yr we reduced the sediment supply fig 3 halving the sediment supply from 60 mg l to 30 mg l indirectly triggers an increase in marsh edge erosion this also increases channel widening especially at the channel mouth further reduction in sediment supply 15 mg l marginally increases marsh edge erosion and channel widening and further reduction in sediment supply 7 5 m l does not cause much additional erosion similarly pond expansion in the marsh interior does not increase much for a reduction in sediment supply from 15 or 7 5 mg l the combined effect of rslr and sediment supply triggers massive marsh loss for a sediment supply co 30 mg l an increase in rslr rate to 10 mm yr triggers the formation of open water areas in the marsh interior a striking example occurs for the intermediate rslr rates 7 5 mm yr and for a sediment supply of 30 mg l in this case the marsh is lost both at the seaward and at the landward end for the mesotidal range marsh loss is generally smaller and more concentrated toward the seaward end fig 3 the only effect of an increase in rslr rate is a slight channel widening the unvegetated area in the marsh interior does not increase and the marsh edge retreat is slow even for high rslr rates a reduction in sediment supply causes channel widening and marsh edge erosion even for very high r and low co the loss in the marsh interior is generally small and most of the loss is by edge erosion and channel widening to quantify the patterns of marsh loss we calculated the unvegetated vegetated ratio uvvr for the marsh which is the amount of unvegetated area excluding channels wider than 10 m and the open tidal flat divided by the amount of vegetated area ganju et al 2017 fig 3 the vegetated area is defined as the area that is above the lower limit for vegetation growth z zlo and that is not identified as a pond by the pond finding procedure the unvegetated area is the remaining area except for the channel area given that the spatial discretization is 10 m all channels are at least 10 m wide in order to avoid the inclusion of the tidal flat area the vegetated and unvegetated area is calculated on the region that is at least 2 km landward of the original marsh edge of the steady state marsh for the mesotidal regime the uvvr remains nearly constant equal to about 0 08 0 1 for all cases and at most increases to 0 15 for the higher rslr rate and lowest co for the microtidal regime the uvvr is relatively small 0 06 when the marsh is stable increases to values around 0 5 1 when a large portion of the marsh is lost e g for r 7 5 mm yr and co 15 mg l and quickly diverges toward infinity when the marsh is completely lost we also compared all simulations by calculating the amount of marsh loss through time over a 500 years period i e extending by 300 years the previous simulations fig 4 the rate of marsh loss varies by orders of magnitude and increases for higher rslr rates and lower sediment supply no clear threshold is present i e the rate of marsh loss varies smoothly with the rslr rate and the sediment supply yet for the microtidal case with very high rslr and low sediment supply i e when the marsh drowns the marsh loss becomes remarkably fast and the entire marsh can be lost within 200 years 3 2 quantifying the effect of channel widening edge erosion and ponding the effects of the various marsh loss mechanisms are not additive because of their feedbacks for example ponding increases the amount of open water areas and thus accelerates wave edge erosion also a process that removes a portion of the marsh reduces the marsh area that can be potentially be removed other processes we performed a simplified procedure to estimate the individual contribution of each mechanism figs 5 and 6 first a reference case is created by running the model without pond dynamics and without marsh edge erosion in this case any marsh loss is attributed to drowning or channel widening marsh loss associated with channel widening is isolated by considering the cells that are contiguous to the channel network and the remaining marsh loss is attributed to drowning we then performed two simulations in which either pond dynamics or wave dynamics are included the additional marsh loss compared to the reference case is attributed to either ponding or edge erosion we then normalized the erosion rates so that the sum of the individual components is equal to the marsh loss rate that occurs when all the processes are present this procedure underestimates the contribution from edge erosion and ponding because their contribution is calculated only on the leftover marsh that was not eroded by drowning or channel widening in reality some of the marsh loss attributed to drowning could have been lost by edge erosion and ponding as such the predicted marsh loss by edge erosion and ponding should be considered as the marginal erosion taking place after drowning marsh drowning is always negligible in the mesotidal marsh in the microtidal marsh it is either absent for most the scenarios or constitute about 50 of the total marsh loss for the scenarios with r 10 mm yr and co 15 or 7 5 mg l the amount of marsh loss by channel widening is similar for both microtidal and mesotidal marshes in both cases channel widening increases for increasing r and decreasing co at most channel widening contributes to a 15 loss of the initial marsh marsh loss by wave edge erosion is mainly associated by a reduction in sediment supply and it account up to a 20 loss of the initial marsh for the mesotidal regime edge erosion is always the major mechanism of marsh loss for the microtidal marsh the relative contribution of marsh edge erosion decreases as the sediment supply drops from 15 to 7 5 mg l this reduction happens because the other marsh erosion processes reduce the amount of marsh that can be eroded by wave edge erosion the importance of edge erosion and ponding is most evident in the simulations with r 7 5 mm yr and co 15 mg l in which 70 of the initial marsh is lost fig 7 without ponding and edge erosion marsh loss is only due to channel widening and it is only 20 of the initial marsh 3 3 marsh upland expansion we consider the case in which the marsh is allowed to migrate upland fig 8 upland slopes on the mid atlantic coast of the usa range from 0 3 10 3 to 2 6 10 3 schieder et al 2018 and thus a value of 1 10 3 is taken as representative we thus added a 2 km stretch on the landward end of the domain starting at the elevation of mhw which is different for the two tidal range scenarios and increasing in elevation with a slope of 1 10 3 for simplicity we assume that the upland is instantaneously converted to marsh as soon as it drops below mhw thus neglecting any lag effect associated with tree resilience fagherazzi et al 2019 as such the model considers the maximum potential rate at which the upland can be converted to marsh the scenarios with and without upland expansion are compared considering all marsh erosion mechanisms i e including both wave edge erosion and ponding for the microtidal case net marsh expansion is only present for a high sediment supply 60 and 30 mg l for a low sediment supply marsh grain is less than marsh loss leading to a net marsh loss in particular some of the marsh created by upland expansion at the early stages is lost by the end of the 200 years simulation for the mesotidal case marsh expansion is more likely to create a net marsh gain as for the microtidal settings a reduction in sediment supply drastically decreases net marsh expansion nonetheless even for the low sediment supply 7 5 and 15 mg l marsh expansion is able to balance marsh loss and thus the net marsh change is nearly zero 4 discussion 4 1 does the model reproduce realistic marsh evolution the hydrodynamic model and the channel widening was validated for the marshes of plum island estuary mariotti 2018 when considering a wide range of rslr and sediment supply we find that channel widening varies from 0 to 0 5 m yr which agrees with measurements from a variety of marsh sites ensign et al 2017 mariotti 2018 robinson 2018 the wind wave model and the edge erosion model were validated for the marshes of louisiana valentine and mariotti 2019 the marsh edge erosion rate predicted in the marshmorpho2d simulations varies from 0 to 10 m yr thus matching the observed range leonardi et al 2016 schwimmer 2001 noticeably this wide range of erosion rates is obtained even considering a constant edge erodibility and a constant wind speed i e by only changing rslr rate and sediment supply which in turns affect the tidal flat depth and the accumulation in front of the marsh edge the model also agrees with a recent observation that sediment supply controls at the scale of the whole uk coast whether the marsh edge progrades or retreats ladd et al 2019 pond dynamics was validated against observations in barnstable marsh ma usa even though in the marshmorpho2d model the pond drainage dynamics was implemented in a slightly different way i e ponds form not only by seeding but also by marsh impoundment triggered by differential accretion the model predicts that in the pond recovery regime i e for a low r and a high co fig 3 ponds occupies 10 of the total marsh area noticeably this correspond to an uvvr of 0 1 fig 5 which has been empirically shown to indicate stable marshes ganju et al 2015 even if the hydrodynamics and sediment transport are simplified compared for example to a model like delft3d marshmorpho2d conserves the total sediment mass within the domain thus the model accounts for all feedbacks associated with mass conservation that is the erosion in one part of the domain causes accretion in other parts of the domain unless that sediment is exported out of the domain through the seaward boundary this is valid for material eroded by any erosion mechanisms i e bed deepening by tidal currents bed deepening by waves bank erosion by creep and wave edge erosion in general the self organized marshes look qualitatively similar to real marshes fig 1 except for a tendency of channels to form 90 angles because of the cartesian grid and for an underrepresentation of channel meandering this last mismatch is likely due to the absence of secondary flow in curved channels which is a common drawback even in high resolution depth averaged hydrodynamic models even though this aspect will need to be addressed to apply the model to real sites it does not affect the results for idealized marshes as those analyzed here a variety of patterns of marsh loss are obtained only by changing r and co fig 3 i e while keeping constant the parameters related to sediment dynamics such bed erodibility marsh edge erodibility pond expansion rate maximum organic sediment deposition etc and while using physically inspired processes as opposed to mainly empirical formulations qualitatively this support the empirical finding that marsh degradation can occur through many different pathways wasson et al 2019 some details of the marsh evolution depend on the choice of the parameters and the processes used in the model for example decreasing increasing the diffusion of the sediment released by edge erosion causes them to deposit closer farther to the edge fig 9 c d increasing reducing the rate of pond seeding increases reduces the rate of marsh loss by pond expansion fig 9e f using different formulas for wave generation or for the smoothing of the wave field slightly affect the patterns of edge erosion especially in shadow zones such as at the channel junction with the tidal flat fig 9b given that many model parameters are 1 not validated against a specific marsh and 2 likely to vary among different marshes the simulations should be taken as indicative of a generalized marsh evolution 4 2 landward marsh loss by ponding and drowning ponding and drowning are more concentrated in the landward end of the marsh especially for the microtidal regime fig 3 to better understand this pattern we consider two ways to spatially characterize the marsh 1 interior versus channel side marsh and 2 landward versus seaward marsh the marsh interior is defined considering the distance along the marsh platform from the closest channel which is generally less than a hundred meters marani et al 2003 the landward marsh is defined considering the distance from the major sediment source which in this case is the eroding tidal flat according to this definition channels are not considered a primary sediment source unless they are eroding but are rather considered a conveyor for the sediment released in the tidal flat in the model the distance from the sediment source is up to 4 km whereas in real marshes this could be up to tens of kilometers the marsh interior is well known to be more susceptible to drowning and ponding fagherazzi et al 2012 in addition to this effect the model emphasizes the seaward landward difference in marsh loss specifically at the same distance from the closest channel the landward marsh is more prone to loss than the seaward marsh this difference is due to the spatially variable sediment availability within the channel as exemplified in fig 2e and it is particularly evident for the microtidal case thus a small tidal range not only limits the ability to transport sediment toward the marsh interior i e across the marsh platform as overland flow but also limit the ability to transport sediment in the landward portion of the marsh i e within the channels this result is consistent with the patterns of marsh loss in blackwater bay md usa larsen et al 2004 and barataria bay la usa couvillion 2018 both of which are large microtidal marshes in which major marsh loss is taking place in the landward portion of the marsh i e 5 10 km landward of the nearest open water i e a major tidal flat or a shallow bay because a larger tidal excursion in mesotidal systems can transport sediment both toward the landward portion of the marsh and toward the marsh interior the mesotidal marsh experiences nearly no loss by ponding or drowning the simulations with the ponding mechanism highlight that loss in the marsh interior can take place even if the vegetated marsh accretes faster than rslr rate for example for the case with r 5 mm yr the vegetated marsh would always keep pace with rslr because the maximum organic accretion is 6 mm yr the pond mechanism causes instead the formation of many rounded mudflats in the interior which do not recover when they get reconnected to the channel network mariotti 2016 even when some of the landward marsh starts to drown r 7 5 mm yr and co 15 mg ponding still remains the major agent of interior loss specifically ponding tends to occur throughout the domain i e not only in the landward portion and create a much more irregular interior loss mosaic likely to due to the merging of different ponds thus contrary to the conclusion obtained with an idealized 1d model that only considered drowning vinent et al 2019 our model suggests that pond dynamics is necessary to reproduce the large variety of scales observed in interior marsh loss the different marsh interior loss for the microtidal and mesotidal cases are reflected by the difference in uvvr fig 3 given the method used here to calculate the uvrr i e excluding the channels and the open tidal flat channel widening and marsh edge erosion are not represented in the uvvr that is the uvvr only tracks marsh loss due to either ponding or drowning indeed for the mesotidal regime the uvvr is nearly constant i e it is generally around 0 1 for most combinations of r and co and only reaches 0 15 for the highest r and lowest co on the other hand for the microtidal case the uvvr increases drastically as the marsh is lost in the interior slight modification of the uvvr e g including larger portions of the channel network and of the tidal flat could allow to include more mechanisms of marsh loss for example calculating the uvvr at a coarser spatial resolution will likely integrate more mechanisms of marsh loss in addition calculating some topological characteristics of uvvr e g whether the unvegetated area is connected or fragmented into many clusters might allow to better describe the status of the marsh deterioration and distinguish the various mechanisms of marsh loss 4 3 seaward marsh loss by edge erosion and channel widening contrary to ponding and drowning both wave edge erosion and channel widening tend to take place toward the seaward end of the marsh the open tidal flat allows for large waves thus leading to faster edge erosion rates at the seaward end channels widening is caused by the tidal dynamics mariotti 2018 i e by deepening on the channel bed and subsequent bank slumping simulated here as a soil diffusion channel widening is faster for channels that are already wide mariotti 2018 and thus widening is more accentuated toward the mouth of the channels in addition the channel mouth is also exposed to wave erosion and thus the two processes tend to overlap indeed the widening of large channels 100 m wide toward their seaward end has been attributed to waves rather than tidal currents ensign et al 2017 this effect is exemplified by the simulations without edge wave edge erosion fig 5 showing that channels widening at their mouth is less than for the case with wave edge erosion in general edge erosion does not proceed as a straight front because both channels and ponds create a heterogeneous geometry into which the marsh edge retreats this suggests that one dimensional models kirwan et al 2016 mariotti and carr 2014 mariotti and fagherazzi 2010 tambroni and seminara 2012 underestimate marsh edge erosion loss because they underestimate the perimeter of the marsh that can be attacked by waves even without invoking the fractal nature of coastlines mandelbrot 1967 the marsh edge perimeter is about twice as long as the total width of the marsh even though some of the portions of the marsh perimeter might be sheltered and thus receive slightly less wave power than the straight marsh front they still contribute to the total marsh loss by edge erosion 4 4 seaward marsh loss is due to erosion not drowning the model results as well as previous field observations leonardi et al 2016 schwimmer 2001 indicate that the marsh edge is lost by physical erosion from wave impact when wave edge erosion is not included in the simulations the seaward edge of the marsh does not erode at all fig 5 nevertheless many predictive models for marsh evolution still simulate the seaward loss of the marsh as a drowning process i e vertical accretion smaller than rslr for example the hydromem model predicted the loss of the seaward portion of a microtidal marsh in the gulf of mexico motivated by the fact that this portion of the marsh is lower i e it has less elevation capital and thus will drown first however this prediction is contingent to the assumption that the sediment supply is uniform in space in reality even though the low marsh has less elevation capital it receives more sediment and thus accretes faster than the landward portion of the marsh indeed some of the highest marsh elevation are found where the marsh retreats the faster elsey quirk et al 2019 similarly the model of schuerch et al 2018 included a seaward loss term which suggested the presence of wave induced edge erosion yet this term was actually calculated as a drowning i e the marsh inability to accrete vertically faster than rslr the marshmorpho2d model also predicts that the low marsh adjacent to channels is lost by erosion i e by channel widening which here is simulated by bank creep on the contrary the loss of the channel adjacent marsh is often modeled as a drowning process valiela et al 2018 following the assumption that areas with an initial lower elevation will be lost first as for the previous argument about wave exposed marsh edges we argue that the drowning approach is in contradiction with the ubiquitous observation that suspended sediment deposition is highest on the marsh adjacent to channels as previously pointed out ganju 2019 a disproportionate emphasis has been given to the comparison between vertical accretion and rslr rate ostensibly due to the simplicity of the approach the mechanism of drowning is not wrong per se but only represent one aspect of the marsh evolution and should not be applied to model seaward marsh loss or channel side marsh loss furthermore vertical accretion is highly dependent on the local sediment availability which in turn is highly dependent the sediment released by erosional mechanism thus the sediment supply that drives vertical accretion cannot be predicted without modeling marsh erosion mechanisms and conserving sediment mass across all spatiotemporal scales landscape evolution models are needed to correctly predict the spatial extent of marshes and to reconcile model predictions with field observations 4 5 marsh edge erosion locally enhances marsh vertical accretion it has been previously recognized that marsh edge erosion will release sediment which in turn can aid marsh vertical accretion fitzgerald and hughes 2019 mariotti and carr 2014 our simulations indicate that this effect is localized to about one km from the marsh edge and that the largest effect is most evident within 100 m from the marsh edge fig 10 this result agrees with the observation that the highest marsh elevation a ridge up to 0 5 m high is often found next to fast retreating marsh edges elsey quirk et al 2019 noticeable is the comparison of the microtidal marsh for r 10 mm yr the marsh edge is elevation higher when the sediment supply is 15 mg l than when the sediment supply is 30 mg l fig 3 this apparent contradiction is caused by geomorphological feedbacks that are only present when the sediment dynamics of the whole system is taken into account a lower sediment supply deepens the whole tidal flat which in turns allows larger waves to hit the marsh and to release more sediment this sediment source locally overwhelms the otherwise sediment starved system and causes faster vertical accretion on the nearby marsh this emphasizes that a local measurements of ssc cannot be used as a proxy for landscape level sediment supply ganju et al 2015 if the sediment released by marsh edge erosion is not conserved i e it is assumed to be lost by oxidation the marsh in the seaward region erodes at a much faster rate fig 10 noticeably even without conserving the edge material the deepening of the tidal flat in front of the marsh releases large amounts of sediment and thus the seaward end of the marsh receives more sediment than the landward end of the marsh i e it attains a higher elevation thus as previously recognized in data driven sediment budgets hopkinson et al 2018 both marsh edge erosion and tidal flat erosion are key sources of sediment for the marsh platform the amount of sediment that oxidizes upon edge erosion is poorly constrained clearly all the inorganic sediment is conserved and thus minerogenic marshes likely conserve most of the eroded edge material on the other hand the organic sediment can be oxidized upon erosion yet field measurements indicate that eroded organic material can re deposit on the marsh surface hopkinson et al 2018 suggesting that a large fraction of the organic matter released by edge erosion is conserved as such assuming fox 0 is reasonable in the absence of detailed measurements 4 6 marsh upland migration our model confirms previous results that upland migration can rapidly create new marsh schuerch et al 2018 especially when the upland slope is gentle 10 3 and devoid of anthropogenic impediments fig 8 in addition we identified previously neglected feedbacks associated with sediment redistribution during upland expansion fig 11 upland expansion extends the channel network and increases the tidal prism which then has a twofold effect on one hand channel widening cause additional marsh loss on the other hand channel deepening releases sediment which contributes to further marsh accretion the simulations show that this latter effect dominates and thus upland expansion overall benefits the existing marsh this beneficial effect is found especially in the seaward region where the increase in tidal prism and the channel deepening is more accentuated fig 11d the formation of new marsh and the additional sediment available to sustain the existing marsh indicates that upland migration has the potential to mitigate the ongoing marsh loss unfortunately the high rslr rates needed to trigger upland expansion also causes marsh loss by channel widening pond expansion and marsh edge erosion in addition even the marsh recently created by upland expansion can be lost indeed this marsh is located in the landward region and thus receives the least amount of sediment as shown in the model for the case with r 10 mm yr and co 15 mg l the majority of the marsh created at the beginning of the upland expansion disappears within 200 years fig 11b therefore without an external sediment supply to slow down the loss of the existing marsh marsh upland expansion will not compensate for marsh loss a previous model that included marsh upland expansion and marsh loss by drowning predicted a net global increase in marsh area schuerch et al 2018 we argue that this model underestimated marsh loss by not including some crucial processes such as spatially variable sediment availability especially the decrease toward the landward region channel widening pond expansion and marsh edge erosion upland marsh expansion might allow for net marsh gain only if the tidal range is large or if sediment supply is large conditions that have already being identified to increase marsh resilience as previously suggested tornqvist et al 2019 net marsh gain is unlikely especially in microtidal settings 4 7 model limitations and future directions the model simulates subsidence in a static way i e by imposing an equivalent sea level rise throughout the domain without any feedbacks from the morphodynamics this subsidence can be imposed uniformly in the domain as performed here or can be imposed heterogeneously i e higher subsidence toward the seaward end which is often the case in deltaic systems a first attempt to recreate a dynamic subsidence is to model it as a function of the total sediment thickness a more refined approach is to relate it to the stratigraphy i e using a different compressibility for organic and mineral sediment which would require to store the mineral and organic material into separate pools and to keep track of the stratigraphy stratigraphy book keeping would allow to track carbon accumulation and remobilization which would be useful to determine how much of the carbon deposited in salt marshes is recycled as opposed from new in situ production broek et al 2018 mariotti et al 2020a stratigraphy book keeping would also enable to include sand as a distinct sediment class which might be necessary to simulate backbarrier marshes another improvement would be the inclusion of a riverine component zhou et al 2014 which would allow to deliver sediment from the landward boundary of the marsh a riverine component could also be used to calculate spatial patterns of salinity within the domain and the salinity field could be leveraged to simulate different types of marsh fresh brackish salt with different vegetation properties the model could be also easily expanded to include other types of benthic biota such as seagrasses microphytobenthos and mussel beds 5 conclusions marsh drowning is not the only and often not the major contributor to marsh loss channel widening marsh edge erosion and pond expansion dominate marsh loss except for microtidal marshes with very high rslr rates and very low sediment supply as such drowning thresholds should not be used as the only metric to predict future marsh evolution a reduction in sediment supply greatly enhances all marsh loss mechanisms accounting for spatially variable sediment availability as well as sediment conservation is essential to predict the magnitude and spatial patterns of marsh loss we suggest that estimating the external sediment supply to the marsh which is different from the sediment supply associated with internal recycling is the most critical and least developed aspect of marsh monitoring previous predictions of net wetland expansion due to upland migration are overly optimistic because they underestimated the loss of the existing marsh due to the lack of relevant 2d mechanisms and because they did not include the loss of the marsh recently formed by upland expansion net marsh gain can only occur in mesotidal marshes with a large sediment supply and microtidal marshes will likely experience net loss a two dimensional framework is needed to correctly simulate marsh evolution first it allows to reproduce the convoluted marsh perimeter that is eroded by wave impact especially close to the channel mouth second it allows to include channel widening and ponding as a mechanism of marsh loss third it allows to simulate variability in suspended sediment availability both in the seaward landward direction i e throughout the channel network and in the channel interior direction i e over the marsh platform the marshmorpho2d model is able to recreate realistic patterns of marsh loss starting from physically based processes the next step is to apply the model to specific sites constrain its many parameters and test its ability to hindcast marsh loss during the last century declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the marshmorpho2d 2 0 model can be downloaded from the community surface dynamics modeling system website https csdms colorado edu wiki model marshmorpho2d and it is set up to reproduce fig 3 funding support came from woods hole sea grant na14oar4170104 and national oceanic and atmospheric administration na14nos4190145 supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103710 appendix supplementary materials image application 1 
422,the morphodynamics of tidal marshes is investigated using a novel model marshmorpho2d that couples 2d tidal dynamics wave dynamics mass conserving sediment transport edge erosion pond dynamics and marsh upland migration by only changing tidal range sediment supply and rslr rate the model reproduces a great variety of spatial patterns in marsh loss for all tidal ranges an increase in rslr triggers channel widening whereas a decrease in sediment supply triggers tidal flat deepening and increases wave edge erosion marsh loss by pond runaway expansion dominates for intermediate rslr rates especially for small tidal ranges and for small sediment supplies drowning only takes place in the microtidal setting for high rslr rates and extremely low sediment supply drowning is restricted to the landward portion of the marsh and lacks the variety of spatial scales associated with pond runaway for a large tidal range the amount of marsh loss by drowning and pond runaway is negligible thus increasing the relative importance of edge erosion and channel widening upland migration deepens the channels which release sediment and thus help sustaining the existing marsh nonetheless marsh upland expansion compensates for existing marsh loss only for a large tidal range or for a high sediment supply and thus microtidal marshes are likely to experience net loss marsh loss is highly heterogeneous and is not well represented by the dichotomy between marsh survival and marsh loss based on vertical accretion thresholds marsh loss can take place by a variety of mechanisms hindering the ability to generalize predictions about marsh loss 1 introduction the fast rates of marsh loss observed in the last decades have raised concerns about the sustainability of tidal marshes a plethora of models have been proposed to explain the observed patterns of marsh loss and predict their extent in the next centuries fagherazzi et al 2012 wiberg et al 2020 commonly identified mechanisms of marsh loss are drowning channel widening marsh edge erosion and pond expansion the complex interplay between these different mechanisms might explain a recent conclusion based on field observation that marsh degradation can occur through many different pathways wasson et al 2019 despite this evidence however existing marsh evolution models focus on a few mechanisms at a time and thus they inevitably provide partial results that are biased toward the mechanisms taken into consideration the simplest spatially distributed marsh evolution models only include marsh vertical accretion without an explicit link to sediment dynamics examples are the slamm model craft et al 2009 the diva model spencer et al 2016 and the hydromem model alizad et al 2016 all of which are applied to relatively large marsh domains 100 km2 a common assumption of these models is that marsh loss can only take place by drowning when the vegetated platform accretes slower than the relative sea level rise rslr rate even though these vertical only models are useful to establish the optimum elevation for marsh restoration they might underestimate marsh loss when mechanisms other than drowning are important models applied to smaller domains 0 1 10 km2 have focused on the coupled dynamics of the channel network and marsh platform these models simulate the decrease in suspended sediment concentration away from the channel network d alpaos and marani 2016 kirwan and guntenspergen 2010 thus providing more realistic spatial patterns on the marsh platform for example these models predict that marsh drowning will mainly take place in the marsh interior in addition because the channel network is allowed to change through time marsh loss can also take place by channel widening belliard et al 2015 d alpaos et al 2007b kirwan and murray 2007 mariotti 2018 marsh loss by wind induced edge erosion fitzgerald and hughes 2019 leonardi et al 2016 schwimmer 2001 has been the focus of a relatively few morphodynamic models marsh edge erosion coupled with tidal flat dynamics has been implemented in 1d i e transect models mariotti and fagherazzi 2010 tambroni and seminara 2012 which highlighted that the marsh edge will retreat as the sediment supply to compensate for that loss decreases more realistic patterns of marsh edge erosion has also been simulated with 2d models which however neglected the tidal dynamics and sediment mass conservation leonardi and fagherazzi 2014 valentine and mariotti 2019 in addition wave dynamics and marsh edge erosion have been included in state of the art hydromorphodynamic models which despite their richness of details still have limitations in predicting marsh evolution for example marsh edge erosion has been implemented in the delft3d model but at the expenses of using a very coarse spatial resolution mariotti and canestrelli 2017 a similar approach using delft3d included a more realistic representation of vegetation processes best et al 2018 but at the expense of not including the actual mechanism of wave induced edge erosion i e simulating it instead as a vertical erosion mechanism and largely restricting the size of the model domain and the time window simulated in addition to tide and wave dynamics biochemical driven processes such as those associated with ponds have been recognized as an agent of morphological evolution ponded areas not only prevent the vegetation from accumulating new organic sediment but also oxidize the existing organic matter through sulfate reduction spivak et al 2017 van huissteden and van de plassche 1998 in turn this process causes an active lowering of the bed and a lateral erosion of the pond edge ponding has been first included in a predictive model for marsh evolution by including temporary vegetation disturbances kirwan and guntenspergen 2010 i e by only including the vegetation removal effect subsequently a lumped model for pond dynamics included the process of pond expansion and determined the critical sedimentation rate for pond recovery mariotti 2016 this model was then incorporated in a spatially explicit 2d framework mariotti et al 2020b which also included the process of active pond deepening yet the model still neglected channel dynamics tidal flat dynamics and marsh edge erosion and thus prevented to simulate the transition from biochemical driven pond expansion to current and wave driven erosion recent emphasis has been given to upland migration as a way to create new marsh fagherazzi et al 2019 this process has been explored with 1d transect models kirwan et al 2016 schuerch et al 2018 which assume that new marsh creation is proportional to rslr rate and generally forecast that new marsh creation will exceed the loss of the existing marsh these predictions neglect 2d effects including channel dynamics and pond dynamics and thus might underestimate the loss of the existing marsh furthermore the absence of sediment mass conservation in one of these models schuerch et al 2018 casted some doubts about its ability to correctly simulate the persistence of the marsh recently created by upland expansion tornqvist et al 2019 field measurements have further emphasized the need for a comprehensive sediment mass budget to assess the stability of marshes ganju 2019 similarly landscape evolution models need to perform a sediment budget of the entire system i e including channels and tidal flats so that feedbacks related to sediment mass conservation can be reproduced wiberg et al 2020 unfortunately many simplified 2d models for long term marsh evolution do not conserve the total mass of sediment specifically they assume a fixed sediment concentration within the channels which then act as an endless source for the marsh platform furthermore even 2d models that consider the dynamics of sediment within the channels neglect the coupling with the evolving tidal flats belliard et al 2015 mariotti 2018 i e a fixed suspended sediment concentration is imposed at the mouth of the channel and the marsh seaward position is fixed a recent summary on the state of sediment based marsh restoration ganju 2019 advocated for an integration of channel and intertidal flat processes and evolution as well as the role of open water conversion and edge erosion and concluded that more physically based deterministic models should be used to explore parameter space and guide management through identifying tipping points related to sediment supply relative sea level rise wave erosion open water conversion and integrative three dimensional processes in line with this conclusion we here develop a computationally efficient model capable of simulating the major ecogeomorphological processes in salt marshes including 2d tidal dynamics mass conserving sediment transport throughout the domain wave dynamics marsh edge erosion pond dynamics and marsh upland migration using this model we determine the relative and absolute contribution of each marsh loss mechanism for different settings tidal range rslr rate and sediment supply the spatial patterns of marsh loss associated with these settings and the amount of marsh loss that could take place in the absence of drowning 2 methods marshmorpho2d combines previously developed models mariotti 2018 mariotti et al 2020b valentine and mariotti 2019 in a consistent framework that 1 allows to conserve the total mass of sediment 2 does not impose geometric constraints within the domain e g the position of the channel network or the position of the marsh edge and 3 is computationally efficient the vegetation tidal hydrodynamic wave hydrodynamic sediment transport pond dynamics and morphodynamics modules are described below 2 1 vegetation model the presence of salt marsh vegetation is simulated in a parametric way as a function of the bed elevation marsh vegetation is assumed to be present between the elevation zlo and zup both calculated with respect to mean sea level msl following previous models morris et al 2002 the yearly peak aboveground vegetation biomass b is modeled as a parabolic function of the marsh elevation z the vegetation biomass is equal to zero for elevation smaller than z lo and larger than z up and it has a maximum midway between z lo and z up b is nondimensionalized by the maximum value so that b takes values between 0 and 1 a similar parameterization has been used in other marsh models carr et al 2018 kirwan et al 2016 and any other parameterization for the vegetation can be easily implemented in model the organogenic deposition term o which accounts for the net accumulation of both above and below ground biomass produced in situ is set equal to o max b where o max is a dimensional coefficient l t that includes the yearly rate of organic matter production the fraction of refractory material as well as the organic matter dry bulk density the maximum accretion by in situ production has been estimated to be between 3 mm yr morris et al 2016 and 9 mm yr blum and christian 2004 d alpaos et al 2007b and here it is set equal to 6 mm yr marsh vegetation also affects drag settling velocity and soil creep for simplicity the coefficients that characterize these processes are set equal to a constant value denoted by the subscript o when vegetation is absent and to another constant value denoted by the subscript b when the vegetation is present 2 2 tide averaged flow the model neglects intra tidal variability and calculates instead a tide averaged flow the model considers a spatially variable tide averaged water depth h which is equal to the average water depth only considering the times when the bed is inundated 1 h max 0 r 2 z max 0 r 2 z 2 where z is the bed elevation with respect to msl for numerical stability depths smaller than 0 02 m are set equal to 0 02 m the hydrodynamic model mariotti 2018 considers a friction dominated flow that neglects the temporal and inertial terms rinaldo et al 1999 a spatially variable water depth and bed roughness is included in the momentum equation di silvio et al 2010 then by linearizing the friction term di silvio et al 2010 and using the manning s equation the momentum and continuity equations are simplified as 1 u h 4 3 n 2 η 3 h u i where n is the manning friction coefficient set equal to no or nb depending on whether the bed is vegetated η is the water level surface u ux uy is the depth averaged and absolute value tide averaged velocity i e it is the absolute value of the velocity during either the ebb or flood phase the term i is the distributed input of water which varies in space as a function of the bed elevation and is equal to r 2 max r 2 min z r 2 t 2 where t is the tidal period to account for the velocity variability during a tidal cycle the intra tidal velocity is distributed as u t up sin t2π t where the peak velocity up is equal to u π 2 so that u 1 t 0 t u d t this allows to calculated the intra tidal current bed shear stress τ current ρgn 2 h 1 3 u 2 2 3 wind wave model the significant wave height and peak period of sea waves i e waves generated by the local wind hs and tp are calculated as a function of wind speed water depth and fetch using semi empirical formulas young and verhagen 1996 wind speed is imposed as a spatially uniform parameter and water depth is equal to the local tide averaged water depth h in every point the fetch is computed as the distance along the direction of the incoming wind to the first point where the bed is vegetated or where the water depth falls below a certain threshold which is set equal to 0 2 m in order to account for diffraction refraction and directional spreading of sea waves the fetch field is spatially smoothed by applying a diffusion rate of 0 1 m2 s for 1 day this procedure avoids the formation of unrealistic spatial heterogeneities in the wave field which create unrealistic streaks of erosion in the bed the smoothing coefficient is tuned to reproduce a realistic wave field given the wave height wave period and water depth the maximum wave orbital velocity uw and the wave power p is computed using the linear wave theory wiberg and sherwood 2008 the wave bed shear stress is τ wave 0 5ρfwuw 2 where fw is the bed friction coefficient calculated as fw min 0 3 0 00251exp 5 21 aw ks 0 19 swart 1974 and where aw is the orbital amplitude and ks is the nikuradse length in sandy beds the nikuradse length is generally assumed equal to 2 5 times the median grain diameter but in muddy beds the irregularities due to bioturbation and flocculation dominates over the roughness of individual grains grant and madsen 1986 indeed the bed roughness of muddy sediments could be as high as 1 cm ke et al 1994 here we chose ks 0 3 mm such that the modeled sea waves produce a realistic range of bed shear stresses 0 1 1 pa to take into account that the intertidal areas do not have waves during a portion of the tidal cycle the wave bed shear stress is also multiplied by the normalized hydroperiod which is calculated as fh min 1 r 2 min z r 2 r this factor is needed because the waves are calculated using the average water depth during the portion of the tidal cycle when the bed is inundated eq 1 2 4 sediment transport and bed morphodynamics the suspended sediment transport is assumed to be dominated by tidal dispersion di silvio et al 2010 and residual currents are neglected assuming that the sediment concentration field is at steady state the mass balance reads 4 k k o h c h d e where k kx ky is the tidal dispersion coefficient ko is horizontal turbulent diffusion coefficient d and e are the deposition and erosion terms and ch is the suspended sediment concentration averaged over the time during which the bed is inundated which is related to the tide averaged concentration as ch c fh the tidal dispersion coefficient is calculated based on the mixing length theory arons and stommel 1951 5 k i k u i 2 t 2 i x y where k is an adimensional coefficient following a calibration based on a comparison with a detailed hydrodynamic model this coefficient is set equal to 1 mariotti and murshid 2018 the horizontal turbulent diffusivity ko is introduced to allow for sediment transport even in the absence of tidal currents thus simulating processes such as wind driven and wave driven horizontal mixing assuming no threshold for settling sediment deposition is calculated as 6 d w s c w s c h f h where the settling velocity ws is set equal to wso where vegetation is not present and to wsb where vegetation is present adopting a formulation that allows a smooth transition near the critical shear stress carniello et al 2012 the tide averaged erosion flux reads 7 e 1 t 0 t m e max 0 1 τ τ c r 2 1 d t where τ is the intra tidal total bed shear stress which is equal to the sum of the current and wave bed shear stress τcr is the critical shear stress and me is an erodibility coefficient because the erosion is integrated over a tidal cycle the term e becomes independent of the specific timing of the tide as such given a certain morphological configuration the terms e and d represent an idealized erosion and deposition rate present at any given time the evolution of the bed elevation is then computed as 8 z t d e ρ s o r f where ρs is the inorganic dry bulk density r is the rate of relative sea level rise and f is the soil creep or soil diffusivity flux the in situ organic deposition is assumed to contribute to a common sediment pool that combines both organic and mineral matter i e the amount of organic material is not kept track off therefore when soil is eroded e g through the term e the released material is treated as if it was all composed of mud as such the model keeps track of the total amount of sediment but does not keep track of the amount of organic and mineral individually as explained later an exception to this rule is present for the marsh edge erosion and ponding mechanism the soil creep flux is set proportional to the bed slope 9 f μ a μ e z where the bed is devoid of vegetation the creep coefficient μ is set equal to μo which is equal to 3 65 m2 yr based on previous model calibration kirwan and murray 2007 where the bed is vegetated the creep coefficient μ is set equal to μb which is equal to 0 1 m2 yr following field measurements in plum island estuary ma usa mariotti et al 2019 following mariotti and murshid 2018 we also include a downslope term that is proportional via the coefficient aμ to the total bed erosion this component prevents the creation of unrealistic deep and narrow channels in the tidal flats to allow for channel incision over flat surfaces the creep flux is set equal to zero for slopes smaller than one degree 2 5 marsh edge erosion the rate of marsh edge erosion is assumed to be linearly proportional to the wave power at the marsh edge 10 w α e d g e p f h where αedge is the marsh edge erodibility and where the term fh is included to take into account the reduction in the tide averaged wave power when the bed is located above mlw i e the bed is dry for some portion of the tidal cycle the process of marsh edge erosion is numerically implemented using a probabilistic approach during a time step a cell is eroded with probability equal to wtot δt δx where wtot is the sum of the wave power at all the exposed sides of the cell and where δx and δt are the spatial and temporal discretization the thickness of the eroded marsh cell is equal to the elevation of the eroded marsh minus the average of the elevation of the adjacent wet cells if this thickness is higher than the maximum scarp height δscarp set equal to 2 m the thickness is set equal to δscarp a fraction fox of the material eroded through edge erosion is assumed to be oxidized i e it is removed from the system the remaining material is conserved and it is distributed in the nearby cells this redistribution is calculated by diffusing away the material from the eroded cell with a diffusion coefficient proportional to the water depth so that the material is mostly distributed toward the tidal flat where the water depth is larger the fraction fox should in theory depend on the amount of organic matter in the marsh and on the tendency of this organic matter to be oxidized because the model does not keep track of the amount of organic in each cell the fraction fox needs to be assumed a priori and thus relies on the assumption that the organic content within a single salt marsh in nearly constant as a reference we consider the case in which all the material is conserved i e fox 0 and the case in which some of the material is oxidized is discussed as a sensitivity analysis 2 6 pond dynamics ponds are defined as waterlogged areas i e areas that remain permanently inundated even at low tide ponds are identified at every time step i e any time the bathymetry changes to identify ponds the model first defines the channel network as those cells with an elevation lower than a certain threshold zntw here set equal to the lower limit for vegetation growth so that the channel network only includes unvegetated cells and that are continuously connected to the open boundary of the system to exclude low lying areas in the marsh interior that might indeed be ponds then the model performs a flood fill operation which identifies all regional minima in elevations that are not connected to the channel network this allows to calculate the depth of the water than would remain on the marsh surface at the end of the ebb phase then any cell with a residual water depth larger than a certain threshold δmin 0 1 m is classified as a pond according to the procedure large pond areas can form in the marsh interior when the marsh close to the channels attains an elevation more than δmin higher than the marsh interior and continuously encircles the marsh interior according to this rule a marsh that is flat or monotonically sloping toward the channels would never form ponds to simulate the effect of pond formation by physical disturbances such as rafting ice plucking and animal grazing we included a pond seeding mechanism mariotti et al 2020b during a time step every vegetated cell independent on their elevation has a probability pseedδx2δt to experience a pond seeding event cells that are selected for seeding are lowered by an elevation δpondseed this mechanism does not directly classify these cells as ponds but because δpondseed is larger than δmin these depressions are automatically classified as ponds by the pond finding procedure the model does not have an ad hoc mechanism for pond reconnection which was needed in a previous simplified pond model mariotti et al 2020b instead a pond would automatically reconnect when it stops to be identified as a pond by the pond finding procedure this generally happens when a new small channel forms and connect the pond to the main channel network but can also happen when an existing channel widens or when the wave exposed marsh edge retreats a previous analysis mariotti et al 2020b showed that the main effect of pond seeding is not to directly removing marsh area but rather to create new sites for pond expansion which is described below this condition only applies when the initial pond seed is relatively small e g 1 m2 the grid resolution used in the marshmorpho2d simulations δx 10 m is such that the initial size of the pond seed is at least 100 m2 and thus the amount of area directly created by pond formation is not negligible as such the rate of pond seeding needs to be reduced compared to previous calibration mariotti et al 2020b by reducing the rate of pond formation rate from 0 4 10 4 ponds m2 yr to 0 4 10 5 ponds m2 yr the model predicts that the average pond area in the pond recovery regime is 10 of the total marsh area which matches the observation in barnstable marsh mariotti et al 2020b and in the plum island estuary marsh spivak et al 2017 the presence of ponds affects the marsh dynamics in three ways first pond areas do not have vegetation even though their elevation is within the range for vegetation growth z zlow any submerged aquatic vegetation that might be present in the ponds is neglected therefore ponds do not have in situ plant production and their settling velocity and drag coefficient is the same as the unvegetated areas second ponds experience enhanced organic matter decay by sulfate reduction van huissteden and van de plassche 1998 and thus lose elevation at the rate pdeepeing third ponds expand laterally because the edge of the ponds is also subject to organic matter decay pond expansion is simulated at the interface between ponds and vegetated marsh cells the vegetated cells are eroded with the same probabilistic algorithm as the wave induced marsh edge erosion with the difference that the rate of retreat is set equal to a constant rate pexp direct measurement in the barnstable marsh found an expansion rate of 1 5 cm yr mariotti et al 2020b however because the rate of pond formation is reduced by a factor 10 the pond expansion rate is also increased by a factor 10 to obtain a similar balance even with this correction the pond expansion rate 15 cm yr is much smaller than the average retreat by wave edge erosion which is generally 1 m yr the elevation loss by pond expansion is set equal to the minimum between the pond scarp height and δpondseed both the process of pond seeding pond expansion and pond deepening lower the bed elevation and are all implemented as an additional term in eq 8 all material removed by this elevation loss is removed from the system given that is assumed to be caused by organic matter decay because the model does not keep track of the stratigraphy this loss needs to be applied to the common pool of sediment i e the combined mud and organic this elevation loss could be interpreted to selectively take place on the organic fraction of the sediment as an example we consider an arbitrary elevation equal to 0 2 m if the soil was composed 100 or organic material this would be interpreted as net scour of 0 2 m if the soil was composed of 50 of mud this would be interpreted as the reworking of 0 4 m soil where 50 of the material is removed and 50 is re deposited in the same cell thus causing a net 0 2 m scour 2 7 numerical implementation tidal flow wind waves sediment transport and bed elevation changes are discretized over a structured cartesian domain and solved with a finite volume implicit method opportune boundary conditions are imposed zero water flow and zero sediment transport at the closed boundaries zero velocity gradient and constant suspended sediment concentration co at the open boundary fig 1 the model conserves the total sediment mass i e mud and organic combined together within the domain deviation from the sediment conservation arises from 1 material entering or exiting the seaward boundary 2 accumulation of new organic material by in situ production 3 decay of organic matter by pond formation expansion and deepening 4 decay of organic matter released by edge erosion all of these components are tracked and can be included in the sediment budget e g the model keeps track of how much material entered or exited the domain from the seaward boundary the model splits the hydrodynamics and morphodynamics steps given a certain morphodynamic configuration the hydrodynamic and sediment transport equations eq 1 7 are calculated at steady state as indeed reflected by the absence of a time component in those equations that is the values are assumed to remain constant until the bed is updated which is generally one year but it could be much shorter as explained below the model is run with a reference morphodynamic time step equal to 1 year any time variable forcing i e the wind speed and direction is kept constant during a morphodynamic time step given the steady state hydrodynamic and sediment transport results the morphodynamic changes associated to the morphodynamic time step are computed eq 8 plus the procedures for edge erosion and ponding if the elevation change in any point is greater than a certain threshold the whole morphodynamic time step is discarded and the step is divided in two subsets the first subset of the step i e the first 0 5 years is calculated ex novo i e the steady state equations are calculated and then the morphodynamics is updated if the changes satisfy the morphological requirement the subset is accepted and the morphodynamic is updated if not the initial subset is further divided in two subsets and the procedure is repeated until a subset is finally accepted when a subset is accepted the whole procedure is repeated for the remaining portion of the original moprhodynamic time step which could be further re subdivided if needed in general every time that a subset is accepted the bed morphodynamics is updated and the steady state hydrodynamics and sediment transport are recalculated once the original morphodynamic time step is completed the morphodynamic configuration at the end of the step is finalized the next moprhodynamic time step is then run with new forcings e g a different wind speed and direction there are several reasons why large morphological steps can be used first by integrating over a tidal cycle the actual changes of the bed are smaller than the instantaneous bed changes second the calculation of the suspended sediment concentration and thus the sediment deposition uses an implicit method which avoids the occurrence of extremely high deposition rates third the bed diffusion is also calculated with an implicit method which filters out excessive scouring as a result the code is extremely fast for a 300 500 cells domain as used here a morphological time step which is generally one year requires about 3 s on a single core 3 6 ghz computer also the computation time scales about linearly with the number of cells because the time steps are relatively long 1 year an hourly wind speed time series that includes both calm and stormy periods cannot be directly used instead we identify an equivalent wind speed or morphological wind in analogy with the morphological tide defined by latteux 1995 whose effect is equivalent to the time variable wind for a given wind speed time series we assumed a water depth of 1 m and a fetch of 5 km and we use the wave model to calculate the time series of wave power and excess bed shear stress which is equal to max 0 1 τ τ c r 2 1 we then find a constant wind speed that gives the same value of wave power and excess bed shear stress as the average of the time series for illustrative purposes using a wind speed time series from the coast of massachusetts station 63048 from the usace wave information studies we obtain an equivalent wind speed of 7 m s for the wind direction a different value is randomly chosen every time step to allow for a more realistic wave field for simplicity we consider an isotropic wind direction distribution but an anisotropic wind distribution could be used without further complications 3 results all simulations are performed on a domain 3 km wide and 5 km long where the seaward 1 km is used as a permanent tidal flat where the marsh cannot propagate into thus preventing the marsh from filling the whole domain fig 1a the incoming waves from the seaward and lateral boundaries of the permanent tidal flat have an addition fetch of 5 km this allows to parametrize the effect of a larger and more exposed domain e g an estuary or a very large bay that is not explicitly included in the model even though the domain size and shape is arbitrary it is representative of many marsh systems fig 1d e noticeably it is much larger than the domain used in previous detailed hydromorphodynamic models belliard et al 2016 best et al 2018 and thus allows for space dependent feedbacks associated with wind waves examples of the velocity field wave field and suspended sediment concentration field from a simulation that used this domain is showed in fig 2 the simulation is initialized by considering a gentle sloping ramp starting at msl at the landward end and ending at 2 m depth at the seaward end fig 1a random perturbations in elevations on the order of 0 1 m are included to break the symmetry the model is then run with a constant rslr rate and sediment supply for 1000 years which is enough for the marsh to reach a steady state and thus create a reference marsh fig 1b c even though the eustatic sea level rise has been about 1 mm yr in the last five thousand years many areas in the atlantic and gulf coast of the usa have experienced a eustatic sea level rise of 2 3 mm yr since the beginning of the 20th century church and white 2006 donnelly et al 2004 gehrels and woodworth 2013 jevrejeva et al 2008 and have also experienced a wide range of land lowering rates due for example to glacial isostatic adjustments engelhart et al 2009 despite the large variability rslr rates experienced by marshes during their formation we select a single value r 2 5 mm yr to create the reference marsh we also select co 60 mg l which is considered a high sediment supply raposa et al 2016 starting with the steady state configuration we increased r and we decreased co and run the simulations for 200 years this time window which is the maximum interval previously identified as long term nasem 2018 is slightly longer than the time horizons considered by previous models nonetheless because acceleration in rslr and decrease in sediment supply have already took place since the beginning of the 1900s in some areas the 200 year simulation window could be interpreted as a prediction to year 2100 the increase in rslr rate and reduction in sediment supply simulated in the model is chosen to reflect realistic values for marshes in the atlantic pacific and gulf coasts of the us wasson et al 2019 all other parameters critical bed shear stress settling velocity maximum in situ deposition wind speed etc are kept constant table 1 we repeated these simulations for two different tidal ranges as mesotidal regime 3 m characteristics of new england salt marshes and a microtidal 0 7 m regime characteristics of marshes in chesapeake bay figs 1 and 3 3 1 rslr rates and sediment supply for the microtidal range a moderate rslr rate 5 mm yr causes a slight channel widening and an increase of unvegetated areas in the marsh interior which include both ponds and recently drained ponds that transformed into small tidal flats fig 3 both trends amplify for larger rslr rates while keeping a low rslr rate 2 5 mm yr we reduced the sediment supply fig 3 halving the sediment supply from 60 mg l to 30 mg l indirectly triggers an increase in marsh edge erosion this also increases channel widening especially at the channel mouth further reduction in sediment supply 15 mg l marginally increases marsh edge erosion and channel widening and further reduction in sediment supply 7 5 m l does not cause much additional erosion similarly pond expansion in the marsh interior does not increase much for a reduction in sediment supply from 15 or 7 5 mg l the combined effect of rslr and sediment supply triggers massive marsh loss for a sediment supply co 30 mg l an increase in rslr rate to 10 mm yr triggers the formation of open water areas in the marsh interior a striking example occurs for the intermediate rslr rates 7 5 mm yr and for a sediment supply of 30 mg l in this case the marsh is lost both at the seaward and at the landward end for the mesotidal range marsh loss is generally smaller and more concentrated toward the seaward end fig 3 the only effect of an increase in rslr rate is a slight channel widening the unvegetated area in the marsh interior does not increase and the marsh edge retreat is slow even for high rslr rates a reduction in sediment supply causes channel widening and marsh edge erosion even for very high r and low co the loss in the marsh interior is generally small and most of the loss is by edge erosion and channel widening to quantify the patterns of marsh loss we calculated the unvegetated vegetated ratio uvvr for the marsh which is the amount of unvegetated area excluding channels wider than 10 m and the open tidal flat divided by the amount of vegetated area ganju et al 2017 fig 3 the vegetated area is defined as the area that is above the lower limit for vegetation growth z zlo and that is not identified as a pond by the pond finding procedure the unvegetated area is the remaining area except for the channel area given that the spatial discretization is 10 m all channels are at least 10 m wide in order to avoid the inclusion of the tidal flat area the vegetated and unvegetated area is calculated on the region that is at least 2 km landward of the original marsh edge of the steady state marsh for the mesotidal regime the uvvr remains nearly constant equal to about 0 08 0 1 for all cases and at most increases to 0 15 for the higher rslr rate and lowest co for the microtidal regime the uvvr is relatively small 0 06 when the marsh is stable increases to values around 0 5 1 when a large portion of the marsh is lost e g for r 7 5 mm yr and co 15 mg l and quickly diverges toward infinity when the marsh is completely lost we also compared all simulations by calculating the amount of marsh loss through time over a 500 years period i e extending by 300 years the previous simulations fig 4 the rate of marsh loss varies by orders of magnitude and increases for higher rslr rates and lower sediment supply no clear threshold is present i e the rate of marsh loss varies smoothly with the rslr rate and the sediment supply yet for the microtidal case with very high rslr and low sediment supply i e when the marsh drowns the marsh loss becomes remarkably fast and the entire marsh can be lost within 200 years 3 2 quantifying the effect of channel widening edge erosion and ponding the effects of the various marsh loss mechanisms are not additive because of their feedbacks for example ponding increases the amount of open water areas and thus accelerates wave edge erosion also a process that removes a portion of the marsh reduces the marsh area that can be potentially be removed other processes we performed a simplified procedure to estimate the individual contribution of each mechanism figs 5 and 6 first a reference case is created by running the model without pond dynamics and without marsh edge erosion in this case any marsh loss is attributed to drowning or channel widening marsh loss associated with channel widening is isolated by considering the cells that are contiguous to the channel network and the remaining marsh loss is attributed to drowning we then performed two simulations in which either pond dynamics or wave dynamics are included the additional marsh loss compared to the reference case is attributed to either ponding or edge erosion we then normalized the erosion rates so that the sum of the individual components is equal to the marsh loss rate that occurs when all the processes are present this procedure underestimates the contribution from edge erosion and ponding because their contribution is calculated only on the leftover marsh that was not eroded by drowning or channel widening in reality some of the marsh loss attributed to drowning could have been lost by edge erosion and ponding as such the predicted marsh loss by edge erosion and ponding should be considered as the marginal erosion taking place after drowning marsh drowning is always negligible in the mesotidal marsh in the microtidal marsh it is either absent for most the scenarios or constitute about 50 of the total marsh loss for the scenarios with r 10 mm yr and co 15 or 7 5 mg l the amount of marsh loss by channel widening is similar for both microtidal and mesotidal marshes in both cases channel widening increases for increasing r and decreasing co at most channel widening contributes to a 15 loss of the initial marsh marsh loss by wave edge erosion is mainly associated by a reduction in sediment supply and it account up to a 20 loss of the initial marsh for the mesotidal regime edge erosion is always the major mechanism of marsh loss for the microtidal marsh the relative contribution of marsh edge erosion decreases as the sediment supply drops from 15 to 7 5 mg l this reduction happens because the other marsh erosion processes reduce the amount of marsh that can be eroded by wave edge erosion the importance of edge erosion and ponding is most evident in the simulations with r 7 5 mm yr and co 15 mg l in which 70 of the initial marsh is lost fig 7 without ponding and edge erosion marsh loss is only due to channel widening and it is only 20 of the initial marsh 3 3 marsh upland expansion we consider the case in which the marsh is allowed to migrate upland fig 8 upland slopes on the mid atlantic coast of the usa range from 0 3 10 3 to 2 6 10 3 schieder et al 2018 and thus a value of 1 10 3 is taken as representative we thus added a 2 km stretch on the landward end of the domain starting at the elevation of mhw which is different for the two tidal range scenarios and increasing in elevation with a slope of 1 10 3 for simplicity we assume that the upland is instantaneously converted to marsh as soon as it drops below mhw thus neglecting any lag effect associated with tree resilience fagherazzi et al 2019 as such the model considers the maximum potential rate at which the upland can be converted to marsh the scenarios with and without upland expansion are compared considering all marsh erosion mechanisms i e including both wave edge erosion and ponding for the microtidal case net marsh expansion is only present for a high sediment supply 60 and 30 mg l for a low sediment supply marsh grain is less than marsh loss leading to a net marsh loss in particular some of the marsh created by upland expansion at the early stages is lost by the end of the 200 years simulation for the mesotidal case marsh expansion is more likely to create a net marsh gain as for the microtidal settings a reduction in sediment supply drastically decreases net marsh expansion nonetheless even for the low sediment supply 7 5 and 15 mg l marsh expansion is able to balance marsh loss and thus the net marsh change is nearly zero 4 discussion 4 1 does the model reproduce realistic marsh evolution the hydrodynamic model and the channel widening was validated for the marshes of plum island estuary mariotti 2018 when considering a wide range of rslr and sediment supply we find that channel widening varies from 0 to 0 5 m yr which agrees with measurements from a variety of marsh sites ensign et al 2017 mariotti 2018 robinson 2018 the wind wave model and the edge erosion model were validated for the marshes of louisiana valentine and mariotti 2019 the marsh edge erosion rate predicted in the marshmorpho2d simulations varies from 0 to 10 m yr thus matching the observed range leonardi et al 2016 schwimmer 2001 noticeably this wide range of erosion rates is obtained even considering a constant edge erodibility and a constant wind speed i e by only changing rslr rate and sediment supply which in turns affect the tidal flat depth and the accumulation in front of the marsh edge the model also agrees with a recent observation that sediment supply controls at the scale of the whole uk coast whether the marsh edge progrades or retreats ladd et al 2019 pond dynamics was validated against observations in barnstable marsh ma usa even though in the marshmorpho2d model the pond drainage dynamics was implemented in a slightly different way i e ponds form not only by seeding but also by marsh impoundment triggered by differential accretion the model predicts that in the pond recovery regime i e for a low r and a high co fig 3 ponds occupies 10 of the total marsh area noticeably this correspond to an uvvr of 0 1 fig 5 which has been empirically shown to indicate stable marshes ganju et al 2015 even if the hydrodynamics and sediment transport are simplified compared for example to a model like delft3d marshmorpho2d conserves the total sediment mass within the domain thus the model accounts for all feedbacks associated with mass conservation that is the erosion in one part of the domain causes accretion in other parts of the domain unless that sediment is exported out of the domain through the seaward boundary this is valid for material eroded by any erosion mechanisms i e bed deepening by tidal currents bed deepening by waves bank erosion by creep and wave edge erosion in general the self organized marshes look qualitatively similar to real marshes fig 1 except for a tendency of channels to form 90 angles because of the cartesian grid and for an underrepresentation of channel meandering this last mismatch is likely due to the absence of secondary flow in curved channels which is a common drawback even in high resolution depth averaged hydrodynamic models even though this aspect will need to be addressed to apply the model to real sites it does not affect the results for idealized marshes as those analyzed here a variety of patterns of marsh loss are obtained only by changing r and co fig 3 i e while keeping constant the parameters related to sediment dynamics such bed erodibility marsh edge erodibility pond expansion rate maximum organic sediment deposition etc and while using physically inspired processes as opposed to mainly empirical formulations qualitatively this support the empirical finding that marsh degradation can occur through many different pathways wasson et al 2019 some details of the marsh evolution depend on the choice of the parameters and the processes used in the model for example decreasing increasing the diffusion of the sediment released by edge erosion causes them to deposit closer farther to the edge fig 9 c d increasing reducing the rate of pond seeding increases reduces the rate of marsh loss by pond expansion fig 9e f using different formulas for wave generation or for the smoothing of the wave field slightly affect the patterns of edge erosion especially in shadow zones such as at the channel junction with the tidal flat fig 9b given that many model parameters are 1 not validated against a specific marsh and 2 likely to vary among different marshes the simulations should be taken as indicative of a generalized marsh evolution 4 2 landward marsh loss by ponding and drowning ponding and drowning are more concentrated in the landward end of the marsh especially for the microtidal regime fig 3 to better understand this pattern we consider two ways to spatially characterize the marsh 1 interior versus channel side marsh and 2 landward versus seaward marsh the marsh interior is defined considering the distance along the marsh platform from the closest channel which is generally less than a hundred meters marani et al 2003 the landward marsh is defined considering the distance from the major sediment source which in this case is the eroding tidal flat according to this definition channels are not considered a primary sediment source unless they are eroding but are rather considered a conveyor for the sediment released in the tidal flat in the model the distance from the sediment source is up to 4 km whereas in real marshes this could be up to tens of kilometers the marsh interior is well known to be more susceptible to drowning and ponding fagherazzi et al 2012 in addition to this effect the model emphasizes the seaward landward difference in marsh loss specifically at the same distance from the closest channel the landward marsh is more prone to loss than the seaward marsh this difference is due to the spatially variable sediment availability within the channel as exemplified in fig 2e and it is particularly evident for the microtidal case thus a small tidal range not only limits the ability to transport sediment toward the marsh interior i e across the marsh platform as overland flow but also limit the ability to transport sediment in the landward portion of the marsh i e within the channels this result is consistent with the patterns of marsh loss in blackwater bay md usa larsen et al 2004 and barataria bay la usa couvillion 2018 both of which are large microtidal marshes in which major marsh loss is taking place in the landward portion of the marsh i e 5 10 km landward of the nearest open water i e a major tidal flat or a shallow bay because a larger tidal excursion in mesotidal systems can transport sediment both toward the landward portion of the marsh and toward the marsh interior the mesotidal marsh experiences nearly no loss by ponding or drowning the simulations with the ponding mechanism highlight that loss in the marsh interior can take place even if the vegetated marsh accretes faster than rslr rate for example for the case with r 5 mm yr the vegetated marsh would always keep pace with rslr because the maximum organic accretion is 6 mm yr the pond mechanism causes instead the formation of many rounded mudflats in the interior which do not recover when they get reconnected to the channel network mariotti 2016 even when some of the landward marsh starts to drown r 7 5 mm yr and co 15 mg ponding still remains the major agent of interior loss specifically ponding tends to occur throughout the domain i e not only in the landward portion and create a much more irregular interior loss mosaic likely to due to the merging of different ponds thus contrary to the conclusion obtained with an idealized 1d model that only considered drowning vinent et al 2019 our model suggests that pond dynamics is necessary to reproduce the large variety of scales observed in interior marsh loss the different marsh interior loss for the microtidal and mesotidal cases are reflected by the difference in uvvr fig 3 given the method used here to calculate the uvrr i e excluding the channels and the open tidal flat channel widening and marsh edge erosion are not represented in the uvvr that is the uvvr only tracks marsh loss due to either ponding or drowning indeed for the mesotidal regime the uvvr is nearly constant i e it is generally around 0 1 for most combinations of r and co and only reaches 0 15 for the highest r and lowest co on the other hand for the microtidal case the uvvr increases drastically as the marsh is lost in the interior slight modification of the uvvr e g including larger portions of the channel network and of the tidal flat could allow to include more mechanisms of marsh loss for example calculating the uvvr at a coarser spatial resolution will likely integrate more mechanisms of marsh loss in addition calculating some topological characteristics of uvvr e g whether the unvegetated area is connected or fragmented into many clusters might allow to better describe the status of the marsh deterioration and distinguish the various mechanisms of marsh loss 4 3 seaward marsh loss by edge erosion and channel widening contrary to ponding and drowning both wave edge erosion and channel widening tend to take place toward the seaward end of the marsh the open tidal flat allows for large waves thus leading to faster edge erosion rates at the seaward end channels widening is caused by the tidal dynamics mariotti 2018 i e by deepening on the channel bed and subsequent bank slumping simulated here as a soil diffusion channel widening is faster for channels that are already wide mariotti 2018 and thus widening is more accentuated toward the mouth of the channels in addition the channel mouth is also exposed to wave erosion and thus the two processes tend to overlap indeed the widening of large channels 100 m wide toward their seaward end has been attributed to waves rather than tidal currents ensign et al 2017 this effect is exemplified by the simulations without edge wave edge erosion fig 5 showing that channels widening at their mouth is less than for the case with wave edge erosion in general edge erosion does not proceed as a straight front because both channels and ponds create a heterogeneous geometry into which the marsh edge retreats this suggests that one dimensional models kirwan et al 2016 mariotti and carr 2014 mariotti and fagherazzi 2010 tambroni and seminara 2012 underestimate marsh edge erosion loss because they underestimate the perimeter of the marsh that can be attacked by waves even without invoking the fractal nature of coastlines mandelbrot 1967 the marsh edge perimeter is about twice as long as the total width of the marsh even though some of the portions of the marsh perimeter might be sheltered and thus receive slightly less wave power than the straight marsh front they still contribute to the total marsh loss by edge erosion 4 4 seaward marsh loss is due to erosion not drowning the model results as well as previous field observations leonardi et al 2016 schwimmer 2001 indicate that the marsh edge is lost by physical erosion from wave impact when wave edge erosion is not included in the simulations the seaward edge of the marsh does not erode at all fig 5 nevertheless many predictive models for marsh evolution still simulate the seaward loss of the marsh as a drowning process i e vertical accretion smaller than rslr for example the hydromem model predicted the loss of the seaward portion of a microtidal marsh in the gulf of mexico motivated by the fact that this portion of the marsh is lower i e it has less elevation capital and thus will drown first however this prediction is contingent to the assumption that the sediment supply is uniform in space in reality even though the low marsh has less elevation capital it receives more sediment and thus accretes faster than the landward portion of the marsh indeed some of the highest marsh elevation are found where the marsh retreats the faster elsey quirk et al 2019 similarly the model of schuerch et al 2018 included a seaward loss term which suggested the presence of wave induced edge erosion yet this term was actually calculated as a drowning i e the marsh inability to accrete vertically faster than rslr the marshmorpho2d model also predicts that the low marsh adjacent to channels is lost by erosion i e by channel widening which here is simulated by bank creep on the contrary the loss of the channel adjacent marsh is often modeled as a drowning process valiela et al 2018 following the assumption that areas with an initial lower elevation will be lost first as for the previous argument about wave exposed marsh edges we argue that the drowning approach is in contradiction with the ubiquitous observation that suspended sediment deposition is highest on the marsh adjacent to channels as previously pointed out ganju 2019 a disproportionate emphasis has been given to the comparison between vertical accretion and rslr rate ostensibly due to the simplicity of the approach the mechanism of drowning is not wrong per se but only represent one aspect of the marsh evolution and should not be applied to model seaward marsh loss or channel side marsh loss furthermore vertical accretion is highly dependent on the local sediment availability which in turn is highly dependent the sediment released by erosional mechanism thus the sediment supply that drives vertical accretion cannot be predicted without modeling marsh erosion mechanisms and conserving sediment mass across all spatiotemporal scales landscape evolution models are needed to correctly predict the spatial extent of marshes and to reconcile model predictions with field observations 4 5 marsh edge erosion locally enhances marsh vertical accretion it has been previously recognized that marsh edge erosion will release sediment which in turn can aid marsh vertical accretion fitzgerald and hughes 2019 mariotti and carr 2014 our simulations indicate that this effect is localized to about one km from the marsh edge and that the largest effect is most evident within 100 m from the marsh edge fig 10 this result agrees with the observation that the highest marsh elevation a ridge up to 0 5 m high is often found next to fast retreating marsh edges elsey quirk et al 2019 noticeable is the comparison of the microtidal marsh for r 10 mm yr the marsh edge is elevation higher when the sediment supply is 15 mg l than when the sediment supply is 30 mg l fig 3 this apparent contradiction is caused by geomorphological feedbacks that are only present when the sediment dynamics of the whole system is taken into account a lower sediment supply deepens the whole tidal flat which in turns allows larger waves to hit the marsh and to release more sediment this sediment source locally overwhelms the otherwise sediment starved system and causes faster vertical accretion on the nearby marsh this emphasizes that a local measurements of ssc cannot be used as a proxy for landscape level sediment supply ganju et al 2015 if the sediment released by marsh edge erosion is not conserved i e it is assumed to be lost by oxidation the marsh in the seaward region erodes at a much faster rate fig 10 noticeably even without conserving the edge material the deepening of the tidal flat in front of the marsh releases large amounts of sediment and thus the seaward end of the marsh receives more sediment than the landward end of the marsh i e it attains a higher elevation thus as previously recognized in data driven sediment budgets hopkinson et al 2018 both marsh edge erosion and tidal flat erosion are key sources of sediment for the marsh platform the amount of sediment that oxidizes upon edge erosion is poorly constrained clearly all the inorganic sediment is conserved and thus minerogenic marshes likely conserve most of the eroded edge material on the other hand the organic sediment can be oxidized upon erosion yet field measurements indicate that eroded organic material can re deposit on the marsh surface hopkinson et al 2018 suggesting that a large fraction of the organic matter released by edge erosion is conserved as such assuming fox 0 is reasonable in the absence of detailed measurements 4 6 marsh upland migration our model confirms previous results that upland migration can rapidly create new marsh schuerch et al 2018 especially when the upland slope is gentle 10 3 and devoid of anthropogenic impediments fig 8 in addition we identified previously neglected feedbacks associated with sediment redistribution during upland expansion fig 11 upland expansion extends the channel network and increases the tidal prism which then has a twofold effect on one hand channel widening cause additional marsh loss on the other hand channel deepening releases sediment which contributes to further marsh accretion the simulations show that this latter effect dominates and thus upland expansion overall benefits the existing marsh this beneficial effect is found especially in the seaward region where the increase in tidal prism and the channel deepening is more accentuated fig 11d the formation of new marsh and the additional sediment available to sustain the existing marsh indicates that upland migration has the potential to mitigate the ongoing marsh loss unfortunately the high rslr rates needed to trigger upland expansion also causes marsh loss by channel widening pond expansion and marsh edge erosion in addition even the marsh recently created by upland expansion can be lost indeed this marsh is located in the landward region and thus receives the least amount of sediment as shown in the model for the case with r 10 mm yr and co 15 mg l the majority of the marsh created at the beginning of the upland expansion disappears within 200 years fig 11b therefore without an external sediment supply to slow down the loss of the existing marsh marsh upland expansion will not compensate for marsh loss a previous model that included marsh upland expansion and marsh loss by drowning predicted a net global increase in marsh area schuerch et al 2018 we argue that this model underestimated marsh loss by not including some crucial processes such as spatially variable sediment availability especially the decrease toward the landward region channel widening pond expansion and marsh edge erosion upland marsh expansion might allow for net marsh gain only if the tidal range is large or if sediment supply is large conditions that have already being identified to increase marsh resilience as previously suggested tornqvist et al 2019 net marsh gain is unlikely especially in microtidal settings 4 7 model limitations and future directions the model simulates subsidence in a static way i e by imposing an equivalent sea level rise throughout the domain without any feedbacks from the morphodynamics this subsidence can be imposed uniformly in the domain as performed here or can be imposed heterogeneously i e higher subsidence toward the seaward end which is often the case in deltaic systems a first attempt to recreate a dynamic subsidence is to model it as a function of the total sediment thickness a more refined approach is to relate it to the stratigraphy i e using a different compressibility for organic and mineral sediment which would require to store the mineral and organic material into separate pools and to keep track of the stratigraphy stratigraphy book keeping would allow to track carbon accumulation and remobilization which would be useful to determine how much of the carbon deposited in salt marshes is recycled as opposed from new in situ production broek et al 2018 mariotti et al 2020a stratigraphy book keeping would also enable to include sand as a distinct sediment class which might be necessary to simulate backbarrier marshes another improvement would be the inclusion of a riverine component zhou et al 2014 which would allow to deliver sediment from the landward boundary of the marsh a riverine component could also be used to calculate spatial patterns of salinity within the domain and the salinity field could be leveraged to simulate different types of marsh fresh brackish salt with different vegetation properties the model could be also easily expanded to include other types of benthic biota such as seagrasses microphytobenthos and mussel beds 5 conclusions marsh drowning is not the only and often not the major contributor to marsh loss channel widening marsh edge erosion and pond expansion dominate marsh loss except for microtidal marshes with very high rslr rates and very low sediment supply as such drowning thresholds should not be used as the only metric to predict future marsh evolution a reduction in sediment supply greatly enhances all marsh loss mechanisms accounting for spatially variable sediment availability as well as sediment conservation is essential to predict the magnitude and spatial patterns of marsh loss we suggest that estimating the external sediment supply to the marsh which is different from the sediment supply associated with internal recycling is the most critical and least developed aspect of marsh monitoring previous predictions of net wetland expansion due to upland migration are overly optimistic because they underestimated the loss of the existing marsh due to the lack of relevant 2d mechanisms and because they did not include the loss of the marsh recently formed by upland expansion net marsh gain can only occur in mesotidal marshes with a large sediment supply and microtidal marshes will likely experience net loss a two dimensional framework is needed to correctly simulate marsh evolution first it allows to reproduce the convoluted marsh perimeter that is eroded by wave impact especially close to the channel mouth second it allows to include channel widening and ponding as a mechanism of marsh loss third it allows to simulate variability in suspended sediment availability both in the seaward landward direction i e throughout the channel network and in the channel interior direction i e over the marsh platform the marshmorpho2d model is able to recreate realistic patterns of marsh loss starting from physically based processes the next step is to apply the model to specific sites constrain its many parameters and test its ability to hindcast marsh loss during the last century declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the marshmorpho2d 2 0 model can be downloaded from the community surface dynamics modeling system website https csdms colorado edu wiki model marshmorpho2d and it is set up to reproduce fig 3 funding support came from woods hole sea grant na14oar4170104 and national oceanic and atmospheric administration na14nos4190145 supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103710 appendix supplementary materials image application 1 
423,estimation of the permeability tensor is crucial for many natural and industrial porous media applications homogenization provides a rigorous framework to calculate effective parameters from pore scale images of a representative unit cell of the porous medium by solving a boundary value problem also known as closure problem subject to global constraints however the latter are hard to satisfy for arbitrarily complex geometries we have developed a novel computational algorithm to calculate rigorously the permeability tensor the approach here referred to as τ simple is based on introducing an artificial time scale τ to satisfy the global constraint within the simple iteration we show that the proposed algorithm has high accuracy for both two dimensional and three dimensional periodically arranged geometries keywords homogenization upscaling closure problem 1 introduction flow and transport in porous media are ubiquitous in natural and engineering applications including but not limited to subsurface flow goharzadeh et al 2005 nikora et al 2001 liu et al 2013 dejam et al 2014 flow and nutrient transport over vegetation papke and battiato 2013 battiato and rubol 2014 rubol et al 2016 2018 porous membrane filtration maruf et al 2013 ling and battiato 2019 patterned porous surfaces ling et al 2016 2018 cui et al 2015 hou et al 2015 flows above carbon nanotube forests and superhydrophobic surfaces deck et al 2009 battiato 2012 2014 nutrient delivery in micro fluidic bioreactor devices gruenberger et al 2013 griffiths et al 2013 etc these vastly different systems share some common features their large scale response is strongly influenced by pore scale topology while the macroscopic observation length may range from the scale of meters to that of kilometers the microscopic features can be at the micronmeter or even nanometer scale the inherent multiscale nature of porous media requires systematic approaches to account for the impact of pore scale topology on macroscopic behavior this is routinely addressed by treating the porous medium as a continuum whose effective parameters can be experimentally determined through the fitting of macroscale balance laws e g the darcy s law to calculate permeability or an advection dispersion equation to calculate the effective dispersion coefficient experimentally the scalar permeability of an isotropic and homogeneous medium can be measured by a permeameter whose side walls are typically impermeable and where the lateral flow is neglected for anisotropic media the measurement of one dimensional permeability may lead to large errors auzerais et al 1990 bernabé 1992 renard et al 2001 yet experimentally measuring the full permeability tensor is challenging renard et al 2001 in recent decades the concurrent advancement of visualization techniques e g x ray microtomography and increased computational power has allowed one to perform direct numerical experiments on reconstructed 3d geometries of porous media to determine their effective parameters guibert et al 2016 however the solution of the flow and transport equations in macroscopic pore scale geometries is often computationally prohibitive chen et al 2008 kang et al 2014 in this regard upscaling formalisms e g volume averaging homogenization theory thermodynamically constrained averaging theory etc offer a computationally viable alternative to computing effective parameters despite their technical differences see review by battiato et al 2019 they are based on the concept that effective parameters can be determined through the solution of a local boundary value problem also known as closure problem on a representative unit cell of the porous medium satisfied by a vectorial quantity called closure variable then effective properties e g permeability or the dispersion tensor can be determined through appropriately defined spatial averages of the closure variable over the unit cell prediction of effective parameters through the numerical solution of the closure problem has two fundamental advantages on the one hand it dramatically reduces the computational cost associated with effective parameters estimation on the other hand it provides a rigorous conceptual framework to build purely predictive i e fit free macroscopic models from pore scale information in the form e g of x ray microtomographic images although direct validation of the purely predictive capabilities of the homogenization formalism with its bottom up definition of effective parameters has been so far demonstrated for idealized geometries only battiato and tartakovsky 2011 boso and battiato 2013 korneev and battiato 2016 generalizations to less idealized systems appear promising ling et al 2018 the accuracy in estimating effective parameters from the numerical solution of a closure problem on a unit cell or representative elementary volume in volume averaging theory is critical also in the context of multiscale numerical methods where ensuring rigorous upscaling bounds is essential to assess the error originating from the multiscale coupling battiato et al 2011 yousefzadeh and battiato 2017 wang and battiato 2020 the closure problem for flow generally involves a stokes like equation a continuity equation and a time independent global constraint on the spatial average of the closure variable over the unit cell f χ 0 the latter requires that the closure variable has zero mean over the unit cell and guarantees the existence and uniqueness of the closure problem solution as rigorously derived from the fredholm alternative auriault 2002 as compared to the method of volume averaging where a closure is imposed as an a priori assumption in upscaling by homogenization the fredholm alternative both enforces the zero mean condition to ensure that a unique solution exists and defines the integration domain over which such a global constraint needs to be satisfied it is therefore critical that this global constraint is satisfied thereby ensuring that the error bounds of the upscaled equation are satisfied several approaches have been used to calculate the permeability tensor from the closure problem one approach is to transform the closure problem which originally is in differential form to integral form barrere et al 1992 valdes parada et al 2009 whitaker 1986 and then compute the permeability through integration this approach automatically guarantees uniqueness of the solution and is based on the premise that the objective of the closure problem is to predict k and not to predict the details of the pressure and velocity fields barrere et al 1992 however in many problems such as upscaling in the presence of dendrites or multiphase flow the pore scale distribution of velocity and pressure is relevant goyeau et al 1999 an alternative approach is to employ standard fluid dynamics solvers with only minor variations since the closure variables can be treated as velocity and pressure fields mei 1992 mei and auriault 1991 mei et al 1996 for example the semi implicit method for pressure linked equations i e simple ferziger and perić 2002 patankar 1980 first solves the momentum equation e g stokes equation using the pressure field calculated from the previous iteration and then uses the intermediate velocity field to correct the pressure field using the continuity equation by iteratively correcting these two fields the converged result is the solution of the original equations the simple algorithm is known for fast convergence rates for both pressure and velocity fields yet in this case it is unclear how to enforce the aforementioned global constraint since the classical stokes problem and its most common solvers does not have any equivalent global condition on pressure to the best of our knowledge current methods cannot provide a permeability estimate that satisfies such a global constraint and that are at the same time able to obtain the pore scale distribution of pressure and velocity here we propose a new algorithm which combines simple with the search for stationary solution to the equation f χ χ τ with τ an artificial temporal scale such that the global constraint f χ 0 is recovered when τ t t this algorithm provides an important new tool to quantify unambiguously and rigorously pore scale images by computing the permeability tensor such estimates preserve the theoretical accuracy prescribed by homogenization theory through the global conditions imposed on the closure varables t simple provides the foundation for extending homogenization to more complex pore space topologies and mutliple fluid phases the paper is organized as follows section 2 reviews the fundamental equations and procedures of upscaling via homogenization and outlines the derivation of the closure problem in section 3 we introduce the τ simple algorithm for the solution of the closure problem with global constraints and present a convergence study in section 4 we validate the algorithm by comparing the permeability tensor obtained as a solution of the closure problem in the unit cell with that calculated from full pore scale simulations over a macroscopic domain we draw conclusions in section 5 2 homogenization and closure problem consider the incompressible flow of a newtonian fluid in a porous medium ω whose characteristic length is l fig 1 a let us assume that the medium can be represented microscopically by a collection of spatially periodic unit cells y with a characteristic length ℓ such that a scale parameter 1 ε ℓ l 1 the unit cell y b g consists of the pore space b and the impermeable solid matrix g that are separated by the smooth surface γ fig 1 b the pore spaces b of each cell y form a multi connected pore space domain b ε ω bounded by the smooth surface γ ε the flow field u u 1 u 2 u 3 is described by the stokes and the continuity equations subject to the no slip condition at the interface between the solid and the fluid γ 2a μ 2 u p 0 x b ε 2b u 0 x b ε 2c u 0 x γ ε where μ is the fluid dynamic viscosity and p is the pore scale pressure the west north east and south boundaries of ω are denoted as ω w ω n ω e and ω s respectively we define the following dimensionless quantities 3 x x l y y l u u u p p l 2 μ u l where u is a characteristic velocity then eq 2 can be cast in dimensionless form as follows 4a ε 2 x 2 u x p 0 x b ε 4b x u 0 x b ε 4c u 0 x γ ε upscaling of the equations 2 from the pore scale to the continuum scale has been the subject of numerous investigations including those relying on multiple scale expansions hornung 1997 auriault and adler 1995 mikelic et al 2006 wall 2007 marušić paloka and piatnitski 2005 and references therein in the following we provide a brief outline of the method interested readers are referred to classical works on homogenization by hornung 1997 auriault and adler 1995 or to reviews on upscaling methods battiato et al 2019 the homogenization method is based on the identification of a slow and fast variable x and y related as 5 x ε y so that all spatial derivatives can be written as 6 x 1 ε y first the pore scale velocity and pressure fields are expanded in integer powers of ε i e 7a u u 0 ε u 1 ε 2 u 2 o ε 3 7b p p 0 ε p 1 ε 2 p 2 o ε 3 and substituted into 4 while using 6 collecting terms of like power of ε leads to a cascade of equations which can be iteratively solved if a closure i e a relationship between the leading order and higher order terms is established see auriault and adler 1995 the closure for the pore scale equation 2 is 8 u 0 k y x p 0 9 p 1 a y x p 0 p 1 x where p 0 has been shown to be a function of x only see auriault and adler 1995 and k a tensor and a a vector are two closure variables which satisfy the following boundary value problem in the unit cell 10a y 2 k i y a 0 y b 10b y k 0 y b subject to 11a k 0 y γ 11b a 0 11c k a periodic in y where i is the identity tensor and the operator defines the volumetric average over the unit cell 12 1 y b x d b then eq 4 can be upscaled to darcy s law as follows 13 u k p 0 v 0 x ω i e darcy s law provides an effective representation of the pore scale stokes flow within errors of order o ε marušić paloka and piatnitski 2005 where the dimensionless permeability tensor k is defined as 14 k k y once the unit cell geometry is given k and a can be determined through 10 subject to 11a and 11c and the global condition 11b it is worth emphasizing that a direct evaluation of a and k allows for reconstruction of pore scale velocity and pressure at the first order through 8 in the next section we present a numerical algorithm based on simple that solves 10 while enforcing the global condition 11b 3 τ simple algorithm the algorithm here referred to as τ simple is based on combining simple with the search for a stationary solution to the equation a a τ with τ an artificial temporal scale such that the global constraint a 0 is recovered when τ t t the simple algorithm ferziger and perić 2002 is based on splitting each numerical iteration into i solving 10a using a from the previous step and ii calculating a correction for a using the continuity equation 10b we represent the true solution of 10 and 11 at step m as 15 k m k m k 16 a m a m a where and denote the intermediate solution and the correction fields respectively the algorithm shown in fig 2 is structured with two nested loops the outer loop m loop ensuring the convergence of the simple iteration and the inner loop τ loop ensuring the solution convergence to a steady state for the artificial time scale τ the algorithm is composed of the following steps step 1 set m 1 initialize a 0 step 2 a m 1 is used to calculate k m through 17 y 2 k m i y a m 1 0 where the laplace operator is written in discretized form as 18 y 2 k m a k m p h k m n with a the coefficient of discretization at point p k m p the k at iteration m and point p h k m n the coefficient matrix calculated from the neighboring points k m n with n p inserting 18 in 17 leads to 19 k m p a 1 h k m n a 1 i a 1 y a m 1 step 3 continuity is enforced by solving 20 k m k 0 for k step 4 a m is calculated by solving 21 α a 1 h k m n a 1 i a 1 y a m 0 since k 0 ferziger and perić 2002 in eq 21 α is a relaxation parameter step 5 set τ 0 inizialize a m 0 a m determine a m 0 step 6 march in time 22 τ a m a m until steady state i e τ convergence is reached if τ convergence is reached then the global condition a m 0 is satisfied step 7 check m convergence if m convergence is reached k m k m if not go back to step 2 in the following section we test and validate the algorithm on different two and three dimensional unit cells 4 algorithm convergence and validation 4 1 convergence in this study the implementation of the closure problem is conducted in openfoam an open source cfd platform within which the customized solver for the τ simple algorithm has been developed we test the algorithm on five periodic two dimensional unit cell geometries uc 01 to uc 05 and one three dimensional geometry uc 06 as shown in fig 3 where the white and grey areas indicate the solid grains and fluid domain respectively the six geometries include isotropic structures uc 01 and uc 06 anisotropic structures with principal axes aligned or misaligned with the cartesian system of reference uc 02 and uc 05 to inhibit or enhance lateral flows random uc 03 and fractured structures uc 04 in fig 4 we plot the values of the y 1 and y 2 components of a τ 0 a 1 and a 2 respectively as a function of the simple iteration m for all geometries the convergence criterion is satisfied when k 10 10 and a 10 10 both components satisfy the global constraint imposed on a a 0 also the relaxation parameter α is set to α 10 3 in all our simulations figs 5 a and b show the two components of a for uc 01 and uc 05 respectively as expected both components of a show strong dependence on the geometry of the unit cell since a satisfies a stokes like equation the components a 1 and a 2 of a can be thought of as the local pressure associated with a flow field k driven by a pressure drop aligned with directions y 1 and y 2 respectively for example figs 5 b shows that for a flow driven from left to right along direction y 1 or from bottom to top along direction y 2 higher local pressure will be experienced in front of the solid object relative to the flow direction see warm colors in figs 5 b in figs 5 c and d we plot the corresponding vector field a y for the same geometries uc 01 and uc 05 respectively three distinct points can be observed i peaks or local maxima from which a points away see dashed circle in figs 5 c ii valleys or local minima toward which a points such as around solid boundaries and iii saddle or minmax points for which a points toward and away along two orthogonal directions see dashed circle in figs 5 d these different structures correspond to different local values of the closure variable k y in fig 6 a and b we plot the four components of the tensor k k 11 k 12 k 21 and k 22 for uc 01 and uc 05 respectively with k 11 and k 22 the main diagonal components and k 12 and k 21 the off diagonal ones fig 6 shows that local maxima in a correspond to large diagonal components but small off diagonal ones for k on the contrary saddle points for a correspond to small values for k 11 and k 22 and large values for k 12 and k 21 finally local minima for the vector field a correspond to zero values of all components of k also in isotropic configurations e g uc 01 the two off diagonal components of k are expected to be very small while in anisotropic geometries e g uc 05 the off diagonal components of k are expected to be comparable to the diagonal ones this is confirmed in fig 6 b where for strongly anisotropic geometries e g uc 05 the pressure gradient in one direction will result in a large lateral flow in the other direction 4 2 pore scale simulations and permeability validation we proceed now with validating the permeability tensor as obtained from a solution of the closure problem using the proposed algorithm with that obtained from pore scale simulations at the macroscale in particular permeability k can be determined from the closure variable k in the unit cell as 23 k k and relates darcy flux with the macroscopic pressure through darcy s law 13 equivalently the permeability tensor can be evaluated from two numerical darcy experiments t1 and t2 where direct pore scale simulations of stokes flows in a macroscopic domain ω are conducted to determine the coefficients of proportionality between the spatially averaged pore scale velocity u t i ω and the macroscopically imposed pressure gradient p x i t i with i 1 2 driving the flow i e 24 k 11 k 12 k 21 k 22 u x 1 t 1 ω u x 1 t 2 ω u x 2 t 1 ω u x 2 t 2 ω p x 1 t 1 p x 1 t 2 p x 2 t 1 p x 2 t 2 1 where 25 u ω 1 ω b ε u d x 26 p x 1 t i p e p w l p x 2 t i p n p s l i 1 2 and pe pw pn and ps are the average pressure on the east ω e west ω w north ω n and south ω s boundaries of ω respectively extension to three dimensions is straightforward for the simulations the macroscopic domain ω in both 2d and 3d is obtained as the repetition of 10 unit cells in each direction i e l 10 l or ε 0 1 fig 1 figs 7 and 8 show the comparison between the permeability calculated through the τ simple algorithm and that determined by spatially averaging pore scale simulations over ω for both 2d and 3d unit cells respectively the dashed line represents the one to one bisectrix in fig 7 every quadrant represents the four components of k while the markers indicate different unit cells uc 01 to uc 05 in 2d there is an excellent agreement for all permeability components additionally by comparing the grey regions in all the geometries we can see that the uc 01 has the largest pore throat and pore space and the uc 04 has the thinnest throat of all cases as a result both approaches predict that uc 01 has the largest permeability and uc 04 has the smallest this is consistent with physical intuition since uc 01 has the largest porosity while uc 04 has the smallest furthermore uc 05 which contains a tilde ellipsoid is the configuration with the largest off diagonal components for the permeability tensor the strong structural anisotropy of the unit cell contributes to large lateral flows in fig 8 we plot the result of the three dimensional case uc 06 also in 3d there is an excellent match between the two methods also the main diagonal components are equal for three directions while the off diagonal components are small this is consistent with the isotropic pore scale structure of the unit cell 5 conclusions any upscaling method establishes the relation between microscopic properties of the porous medium and its effective parameters at the continuum scale in homogenization this is accomplished by solving a boundary value problem for two closure variables χ and a in the unit cell a representative microscale unit of the porous medium the boundary value problem is complemented by boundary conditions on χ as well as a global condition on a a 0 that guarantees uniqueness of the solution the need for directly handling the latter has been generally avoided by formulating the closure problem in integral form however while this approach is sufficient to calculate the effective permeability tensor k it does not allow for a reconstruction of pressure and velocity in the unit cell which is relevant in the context of e g multiphase flow and localized reactions such as dendrite growth in this work we have developed a numerical algorithm referred as simple τ based on the simple scheme the global constraint is satisfied by introducing an artificial time scale τ and by solving the transient equation a a τ until steady state is reached the algorithm implemented in openfoam is composed of two nested loops one to ensure convergence of the simple iteration and one to satisfy the global constraint we validated our algorithm by comparing the permeability tensor obtained from solving a numerical darcy experiment on a macroscopic pore scale domain formed as the repetition of 10 unit cells in each dimension and the one obtained from solving the local closure problem six unit cell geometries were tested including five two dimensional cases uc 01 to uc 05 and one three dimensional case uc 06 the unit cell geometries include both isotropic anisotropic regular and random structures we found good agreement for all permeability tensor components including the highly anisotropic scenario where the off diagonal components are large the algorithm which rigorously solves the closure problem as derived from homogenization theory including the global constraint which guarantees uniqueness of the solution allows one to determine both i the permeability tensor from two and three dimensional images of porous structures and ii the pore scale distribution of pressure and velocity the latter are important when pore scale details of pressure and velocity fields are critical such as in multiphase flows it is worth emphasizing that the algorithm can be extended to calculate effective properties that are constrained by boundary value problems similar in structure to the stokes equation including the effective thermal conductivity tensor and the effective dielectric permeativity tensor finally the algorithm can serve as an image based or geometry based permeability quantification tool crucial to many applications e g functional porous media designing and conductivity estimation using images of rock formations credit authorship contribution statement bowen ling conceptualization methodology software writing original draft ilenia battiato supervision funding acquisition writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work was supported as part of the center for mechanistic control of water hydrocarbon rock interactions in unconventional and tight oil formations cmc uf an energy frontier research center funded by the u s department of energy office of science 10 13039 100006132 under doe bes award de sc0019165 the authors would also like to thank anthony kovscek and davide picchi for their valuable inputs supplementary material supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103712 appendix a supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
423,estimation of the permeability tensor is crucial for many natural and industrial porous media applications homogenization provides a rigorous framework to calculate effective parameters from pore scale images of a representative unit cell of the porous medium by solving a boundary value problem also known as closure problem subject to global constraints however the latter are hard to satisfy for arbitrarily complex geometries we have developed a novel computational algorithm to calculate rigorously the permeability tensor the approach here referred to as τ simple is based on introducing an artificial time scale τ to satisfy the global constraint within the simple iteration we show that the proposed algorithm has high accuracy for both two dimensional and three dimensional periodically arranged geometries keywords homogenization upscaling closure problem 1 introduction flow and transport in porous media are ubiquitous in natural and engineering applications including but not limited to subsurface flow goharzadeh et al 2005 nikora et al 2001 liu et al 2013 dejam et al 2014 flow and nutrient transport over vegetation papke and battiato 2013 battiato and rubol 2014 rubol et al 2016 2018 porous membrane filtration maruf et al 2013 ling and battiato 2019 patterned porous surfaces ling et al 2016 2018 cui et al 2015 hou et al 2015 flows above carbon nanotube forests and superhydrophobic surfaces deck et al 2009 battiato 2012 2014 nutrient delivery in micro fluidic bioreactor devices gruenberger et al 2013 griffiths et al 2013 etc these vastly different systems share some common features their large scale response is strongly influenced by pore scale topology while the macroscopic observation length may range from the scale of meters to that of kilometers the microscopic features can be at the micronmeter or even nanometer scale the inherent multiscale nature of porous media requires systematic approaches to account for the impact of pore scale topology on macroscopic behavior this is routinely addressed by treating the porous medium as a continuum whose effective parameters can be experimentally determined through the fitting of macroscale balance laws e g the darcy s law to calculate permeability or an advection dispersion equation to calculate the effective dispersion coefficient experimentally the scalar permeability of an isotropic and homogeneous medium can be measured by a permeameter whose side walls are typically impermeable and where the lateral flow is neglected for anisotropic media the measurement of one dimensional permeability may lead to large errors auzerais et al 1990 bernabé 1992 renard et al 2001 yet experimentally measuring the full permeability tensor is challenging renard et al 2001 in recent decades the concurrent advancement of visualization techniques e g x ray microtomography and increased computational power has allowed one to perform direct numerical experiments on reconstructed 3d geometries of porous media to determine their effective parameters guibert et al 2016 however the solution of the flow and transport equations in macroscopic pore scale geometries is often computationally prohibitive chen et al 2008 kang et al 2014 in this regard upscaling formalisms e g volume averaging homogenization theory thermodynamically constrained averaging theory etc offer a computationally viable alternative to computing effective parameters despite their technical differences see review by battiato et al 2019 they are based on the concept that effective parameters can be determined through the solution of a local boundary value problem also known as closure problem on a representative unit cell of the porous medium satisfied by a vectorial quantity called closure variable then effective properties e g permeability or the dispersion tensor can be determined through appropriately defined spatial averages of the closure variable over the unit cell prediction of effective parameters through the numerical solution of the closure problem has two fundamental advantages on the one hand it dramatically reduces the computational cost associated with effective parameters estimation on the other hand it provides a rigorous conceptual framework to build purely predictive i e fit free macroscopic models from pore scale information in the form e g of x ray microtomographic images although direct validation of the purely predictive capabilities of the homogenization formalism with its bottom up definition of effective parameters has been so far demonstrated for idealized geometries only battiato and tartakovsky 2011 boso and battiato 2013 korneev and battiato 2016 generalizations to less idealized systems appear promising ling et al 2018 the accuracy in estimating effective parameters from the numerical solution of a closure problem on a unit cell or representative elementary volume in volume averaging theory is critical also in the context of multiscale numerical methods where ensuring rigorous upscaling bounds is essential to assess the error originating from the multiscale coupling battiato et al 2011 yousefzadeh and battiato 2017 wang and battiato 2020 the closure problem for flow generally involves a stokes like equation a continuity equation and a time independent global constraint on the spatial average of the closure variable over the unit cell f χ 0 the latter requires that the closure variable has zero mean over the unit cell and guarantees the existence and uniqueness of the closure problem solution as rigorously derived from the fredholm alternative auriault 2002 as compared to the method of volume averaging where a closure is imposed as an a priori assumption in upscaling by homogenization the fredholm alternative both enforces the zero mean condition to ensure that a unique solution exists and defines the integration domain over which such a global constraint needs to be satisfied it is therefore critical that this global constraint is satisfied thereby ensuring that the error bounds of the upscaled equation are satisfied several approaches have been used to calculate the permeability tensor from the closure problem one approach is to transform the closure problem which originally is in differential form to integral form barrere et al 1992 valdes parada et al 2009 whitaker 1986 and then compute the permeability through integration this approach automatically guarantees uniqueness of the solution and is based on the premise that the objective of the closure problem is to predict k and not to predict the details of the pressure and velocity fields barrere et al 1992 however in many problems such as upscaling in the presence of dendrites or multiphase flow the pore scale distribution of velocity and pressure is relevant goyeau et al 1999 an alternative approach is to employ standard fluid dynamics solvers with only minor variations since the closure variables can be treated as velocity and pressure fields mei 1992 mei and auriault 1991 mei et al 1996 for example the semi implicit method for pressure linked equations i e simple ferziger and perić 2002 patankar 1980 first solves the momentum equation e g stokes equation using the pressure field calculated from the previous iteration and then uses the intermediate velocity field to correct the pressure field using the continuity equation by iteratively correcting these two fields the converged result is the solution of the original equations the simple algorithm is known for fast convergence rates for both pressure and velocity fields yet in this case it is unclear how to enforce the aforementioned global constraint since the classical stokes problem and its most common solvers does not have any equivalent global condition on pressure to the best of our knowledge current methods cannot provide a permeability estimate that satisfies such a global constraint and that are at the same time able to obtain the pore scale distribution of pressure and velocity here we propose a new algorithm which combines simple with the search for stationary solution to the equation f χ χ τ with τ an artificial temporal scale such that the global constraint f χ 0 is recovered when τ t t this algorithm provides an important new tool to quantify unambiguously and rigorously pore scale images by computing the permeability tensor such estimates preserve the theoretical accuracy prescribed by homogenization theory through the global conditions imposed on the closure varables t simple provides the foundation for extending homogenization to more complex pore space topologies and mutliple fluid phases the paper is organized as follows section 2 reviews the fundamental equations and procedures of upscaling via homogenization and outlines the derivation of the closure problem in section 3 we introduce the τ simple algorithm for the solution of the closure problem with global constraints and present a convergence study in section 4 we validate the algorithm by comparing the permeability tensor obtained as a solution of the closure problem in the unit cell with that calculated from full pore scale simulations over a macroscopic domain we draw conclusions in section 5 2 homogenization and closure problem consider the incompressible flow of a newtonian fluid in a porous medium ω whose characteristic length is l fig 1 a let us assume that the medium can be represented microscopically by a collection of spatially periodic unit cells y with a characteristic length ℓ such that a scale parameter 1 ε ℓ l 1 the unit cell y b g consists of the pore space b and the impermeable solid matrix g that are separated by the smooth surface γ fig 1 b the pore spaces b of each cell y form a multi connected pore space domain b ε ω bounded by the smooth surface γ ε the flow field u u 1 u 2 u 3 is described by the stokes and the continuity equations subject to the no slip condition at the interface between the solid and the fluid γ 2a μ 2 u p 0 x b ε 2b u 0 x b ε 2c u 0 x γ ε where μ is the fluid dynamic viscosity and p is the pore scale pressure the west north east and south boundaries of ω are denoted as ω w ω n ω e and ω s respectively we define the following dimensionless quantities 3 x x l y y l u u u p p l 2 μ u l where u is a characteristic velocity then eq 2 can be cast in dimensionless form as follows 4a ε 2 x 2 u x p 0 x b ε 4b x u 0 x b ε 4c u 0 x γ ε upscaling of the equations 2 from the pore scale to the continuum scale has been the subject of numerous investigations including those relying on multiple scale expansions hornung 1997 auriault and adler 1995 mikelic et al 2006 wall 2007 marušić paloka and piatnitski 2005 and references therein in the following we provide a brief outline of the method interested readers are referred to classical works on homogenization by hornung 1997 auriault and adler 1995 or to reviews on upscaling methods battiato et al 2019 the homogenization method is based on the identification of a slow and fast variable x and y related as 5 x ε y so that all spatial derivatives can be written as 6 x 1 ε y first the pore scale velocity and pressure fields are expanded in integer powers of ε i e 7a u u 0 ε u 1 ε 2 u 2 o ε 3 7b p p 0 ε p 1 ε 2 p 2 o ε 3 and substituted into 4 while using 6 collecting terms of like power of ε leads to a cascade of equations which can be iteratively solved if a closure i e a relationship between the leading order and higher order terms is established see auriault and adler 1995 the closure for the pore scale equation 2 is 8 u 0 k y x p 0 9 p 1 a y x p 0 p 1 x where p 0 has been shown to be a function of x only see auriault and adler 1995 and k a tensor and a a vector are two closure variables which satisfy the following boundary value problem in the unit cell 10a y 2 k i y a 0 y b 10b y k 0 y b subject to 11a k 0 y γ 11b a 0 11c k a periodic in y where i is the identity tensor and the operator defines the volumetric average over the unit cell 12 1 y b x d b then eq 4 can be upscaled to darcy s law as follows 13 u k p 0 v 0 x ω i e darcy s law provides an effective representation of the pore scale stokes flow within errors of order o ε marušić paloka and piatnitski 2005 where the dimensionless permeability tensor k is defined as 14 k k y once the unit cell geometry is given k and a can be determined through 10 subject to 11a and 11c and the global condition 11b it is worth emphasizing that a direct evaluation of a and k allows for reconstruction of pore scale velocity and pressure at the first order through 8 in the next section we present a numerical algorithm based on simple that solves 10 while enforcing the global condition 11b 3 τ simple algorithm the algorithm here referred to as τ simple is based on combining simple with the search for a stationary solution to the equation a a τ with τ an artificial temporal scale such that the global constraint a 0 is recovered when τ t t the simple algorithm ferziger and perić 2002 is based on splitting each numerical iteration into i solving 10a using a from the previous step and ii calculating a correction for a using the continuity equation 10b we represent the true solution of 10 and 11 at step m as 15 k m k m k 16 a m a m a where and denote the intermediate solution and the correction fields respectively the algorithm shown in fig 2 is structured with two nested loops the outer loop m loop ensuring the convergence of the simple iteration and the inner loop τ loop ensuring the solution convergence to a steady state for the artificial time scale τ the algorithm is composed of the following steps step 1 set m 1 initialize a 0 step 2 a m 1 is used to calculate k m through 17 y 2 k m i y a m 1 0 where the laplace operator is written in discretized form as 18 y 2 k m a k m p h k m n with a the coefficient of discretization at point p k m p the k at iteration m and point p h k m n the coefficient matrix calculated from the neighboring points k m n with n p inserting 18 in 17 leads to 19 k m p a 1 h k m n a 1 i a 1 y a m 1 step 3 continuity is enforced by solving 20 k m k 0 for k step 4 a m is calculated by solving 21 α a 1 h k m n a 1 i a 1 y a m 0 since k 0 ferziger and perić 2002 in eq 21 α is a relaxation parameter step 5 set τ 0 inizialize a m 0 a m determine a m 0 step 6 march in time 22 τ a m a m until steady state i e τ convergence is reached if τ convergence is reached then the global condition a m 0 is satisfied step 7 check m convergence if m convergence is reached k m k m if not go back to step 2 in the following section we test and validate the algorithm on different two and three dimensional unit cells 4 algorithm convergence and validation 4 1 convergence in this study the implementation of the closure problem is conducted in openfoam an open source cfd platform within which the customized solver for the τ simple algorithm has been developed we test the algorithm on five periodic two dimensional unit cell geometries uc 01 to uc 05 and one three dimensional geometry uc 06 as shown in fig 3 where the white and grey areas indicate the solid grains and fluid domain respectively the six geometries include isotropic structures uc 01 and uc 06 anisotropic structures with principal axes aligned or misaligned with the cartesian system of reference uc 02 and uc 05 to inhibit or enhance lateral flows random uc 03 and fractured structures uc 04 in fig 4 we plot the values of the y 1 and y 2 components of a τ 0 a 1 and a 2 respectively as a function of the simple iteration m for all geometries the convergence criterion is satisfied when k 10 10 and a 10 10 both components satisfy the global constraint imposed on a a 0 also the relaxation parameter α is set to α 10 3 in all our simulations figs 5 a and b show the two components of a for uc 01 and uc 05 respectively as expected both components of a show strong dependence on the geometry of the unit cell since a satisfies a stokes like equation the components a 1 and a 2 of a can be thought of as the local pressure associated with a flow field k driven by a pressure drop aligned with directions y 1 and y 2 respectively for example figs 5 b shows that for a flow driven from left to right along direction y 1 or from bottom to top along direction y 2 higher local pressure will be experienced in front of the solid object relative to the flow direction see warm colors in figs 5 b in figs 5 c and d we plot the corresponding vector field a y for the same geometries uc 01 and uc 05 respectively three distinct points can be observed i peaks or local maxima from which a points away see dashed circle in figs 5 c ii valleys or local minima toward which a points such as around solid boundaries and iii saddle or minmax points for which a points toward and away along two orthogonal directions see dashed circle in figs 5 d these different structures correspond to different local values of the closure variable k y in fig 6 a and b we plot the four components of the tensor k k 11 k 12 k 21 and k 22 for uc 01 and uc 05 respectively with k 11 and k 22 the main diagonal components and k 12 and k 21 the off diagonal ones fig 6 shows that local maxima in a correspond to large diagonal components but small off diagonal ones for k on the contrary saddle points for a correspond to small values for k 11 and k 22 and large values for k 12 and k 21 finally local minima for the vector field a correspond to zero values of all components of k also in isotropic configurations e g uc 01 the two off diagonal components of k are expected to be very small while in anisotropic geometries e g uc 05 the off diagonal components of k are expected to be comparable to the diagonal ones this is confirmed in fig 6 b where for strongly anisotropic geometries e g uc 05 the pressure gradient in one direction will result in a large lateral flow in the other direction 4 2 pore scale simulations and permeability validation we proceed now with validating the permeability tensor as obtained from a solution of the closure problem using the proposed algorithm with that obtained from pore scale simulations at the macroscale in particular permeability k can be determined from the closure variable k in the unit cell as 23 k k and relates darcy flux with the macroscopic pressure through darcy s law 13 equivalently the permeability tensor can be evaluated from two numerical darcy experiments t1 and t2 where direct pore scale simulations of stokes flows in a macroscopic domain ω are conducted to determine the coefficients of proportionality between the spatially averaged pore scale velocity u t i ω and the macroscopically imposed pressure gradient p x i t i with i 1 2 driving the flow i e 24 k 11 k 12 k 21 k 22 u x 1 t 1 ω u x 1 t 2 ω u x 2 t 1 ω u x 2 t 2 ω p x 1 t 1 p x 1 t 2 p x 2 t 1 p x 2 t 2 1 where 25 u ω 1 ω b ε u d x 26 p x 1 t i p e p w l p x 2 t i p n p s l i 1 2 and pe pw pn and ps are the average pressure on the east ω e west ω w north ω n and south ω s boundaries of ω respectively extension to three dimensions is straightforward for the simulations the macroscopic domain ω in both 2d and 3d is obtained as the repetition of 10 unit cells in each direction i e l 10 l or ε 0 1 fig 1 figs 7 and 8 show the comparison between the permeability calculated through the τ simple algorithm and that determined by spatially averaging pore scale simulations over ω for both 2d and 3d unit cells respectively the dashed line represents the one to one bisectrix in fig 7 every quadrant represents the four components of k while the markers indicate different unit cells uc 01 to uc 05 in 2d there is an excellent agreement for all permeability components additionally by comparing the grey regions in all the geometries we can see that the uc 01 has the largest pore throat and pore space and the uc 04 has the thinnest throat of all cases as a result both approaches predict that uc 01 has the largest permeability and uc 04 has the smallest this is consistent with physical intuition since uc 01 has the largest porosity while uc 04 has the smallest furthermore uc 05 which contains a tilde ellipsoid is the configuration with the largest off diagonal components for the permeability tensor the strong structural anisotropy of the unit cell contributes to large lateral flows in fig 8 we plot the result of the three dimensional case uc 06 also in 3d there is an excellent match between the two methods also the main diagonal components are equal for three directions while the off diagonal components are small this is consistent with the isotropic pore scale structure of the unit cell 5 conclusions any upscaling method establishes the relation between microscopic properties of the porous medium and its effective parameters at the continuum scale in homogenization this is accomplished by solving a boundary value problem for two closure variables χ and a in the unit cell a representative microscale unit of the porous medium the boundary value problem is complemented by boundary conditions on χ as well as a global condition on a a 0 that guarantees uniqueness of the solution the need for directly handling the latter has been generally avoided by formulating the closure problem in integral form however while this approach is sufficient to calculate the effective permeability tensor k it does not allow for a reconstruction of pressure and velocity in the unit cell which is relevant in the context of e g multiphase flow and localized reactions such as dendrite growth in this work we have developed a numerical algorithm referred as simple τ based on the simple scheme the global constraint is satisfied by introducing an artificial time scale τ and by solving the transient equation a a τ until steady state is reached the algorithm implemented in openfoam is composed of two nested loops one to ensure convergence of the simple iteration and one to satisfy the global constraint we validated our algorithm by comparing the permeability tensor obtained from solving a numerical darcy experiment on a macroscopic pore scale domain formed as the repetition of 10 unit cells in each dimension and the one obtained from solving the local closure problem six unit cell geometries were tested including five two dimensional cases uc 01 to uc 05 and one three dimensional case uc 06 the unit cell geometries include both isotropic anisotropic regular and random structures we found good agreement for all permeability tensor components including the highly anisotropic scenario where the off diagonal components are large the algorithm which rigorously solves the closure problem as derived from homogenization theory including the global constraint which guarantees uniqueness of the solution allows one to determine both i the permeability tensor from two and three dimensional images of porous structures and ii the pore scale distribution of pressure and velocity the latter are important when pore scale details of pressure and velocity fields are critical such as in multiphase flows it is worth emphasizing that the algorithm can be extended to calculate effective properties that are constrained by boundary value problems similar in structure to the stokes equation including the effective thermal conductivity tensor and the effective dielectric permeativity tensor finally the algorithm can serve as an image based or geometry based permeability quantification tool crucial to many applications e g functional porous media designing and conductivity estimation using images of rock formations credit authorship contribution statement bowen ling conceptualization methodology software writing original draft ilenia battiato supervision funding acquisition writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work was supported as part of the center for mechanistic control of water hydrocarbon rock interactions in unconventional and tight oil formations cmc uf an energy frontier research center funded by the u s department of energy office of science 10 13039 100006132 under doe bes award de sc0019165 the authors would also like to thank anthony kovscek and davide picchi for their valuable inputs supplementary material supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103712 appendix a supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
424,predicting the solute dispersivity in porous media is complicated by the known scale dependency of dispersion processes in this study we combined three complementary methods to investigate solute dispersivity at different length scales the applied methods included 36 cm long column experiments extremely large three dimensional 3d x ray image based pore network simulations and darcy scale modelling we used x ray imaging to extract the information on pore structures needed to construct a very long 36 cm pore network model doing so for the first time a direct comparison of the pore scale model to the large experimental observations was performed the longitudinal dispersivity was found to increase with length with the rate of increase being lower at higher flow velocities results have shown that a pore network which matches pore connectivity distribution and pore size distribution of a sub sample of the column is able to reproduce the experimentally observed solute breakthrough curves pore scale modelling provided the extent of pore velocity variations corresponding to various locations along the experimental column as well as the one dimensional 1d darcy scale model we have found that even in homogenous porous media immobile pores exist with low velocities compared to the average velocity which creates local concentration maximals graphical abstract image graphical abstract keywords dispersivity column experiment pore scale modelling pore network modelling x ray imaging 1 introduction solute dispersion in porous media has been the focus of many systematic studies in various fields of hydrology geophysics petroleum engineering chemical engineering soil physics and agricultural engineering bijeljic et al 2013 delgado 2006 dispersion plays a key role in subsurface transport by affecting the migration of contaminants the mixing of salt and fresh water nick et al 2013 and related processes over the past decades solute dispersion phenomena have been widely investigated theoretically experimentally and numerically from the pore scale to the column scale and the field scale under both saturated and unsaturated conditions agrawal et al 2020 bunsri et al 2008 dünser and meyer 2016 estabragh et al 2013 harvey and gorelick 1995 kohanpour et al 2020 mcdaniel et al 2015 raoof and hassanizadeh 2013 sherman et al 2018 toride et al 2003 zhen et al 2016 the degree of solute spreading has been found to be closely related to the water flow velocity distribution within and between pores the divergence and convergence of flow paths within the porous medium and molecular diffusion see theory of solute dispersion in porous media in supplementary materials delgado 2006 harvey and gorelick 1995 furthermore dispersivity is known to be a scale dependent parameter which increases with the length scale providing subsurface solute transport studies with a great challenge transport of solutes at the field scale involves difficulties due to the inherent uncertainty in subsurface hydraulic and transport parameters subsurface heterogeneity at the field scale of aquifers is one of the most uncontrolled parameters that has a significant effect on solute transport particularly for reactive solutes nick et al 2011 pu and fox 2015 slimene et al 2015 although column scale experiments in the laboratory allow much more control over the experimental conditions they are generally still too macroscopic in nature to directly observe the contribution of the underlying pore scale processes on flow solute transport and spreading nevertheless investigating these underlying processes at the microscopic or pore scale offers a unique way to study the scale dependency of continuum scale transport parameters such scale dependency cannot be easily captured by an effective medium darcy approach bultreys et al 2016 xiong et al 2016 for this reason pore scale information can be valuable for understanding solute dispersion at the larger length scales delgado 2006 several studies indicate that pore scale modelling allows to relate the macro scale dispersion coefficient to the pore size distribution and velocity distribution within a porous medium bultreys et al 2016 xiong et al 2016 parvan et al 2020 among existing methods pore network modelling pnm has been increasingly used to simulate results from laboratory experiments and to improve our understanding of underlying pore scale processes bodla et al 2010 delgado 2006 köhne et al 2011 porta et al 2016 varloteaux et al 2013 they are now widely used in the geosciences and related fields to study capillarity and multiphase flow bultreys et al 2015 zhou and helland 2016 non reactive and reactive contaminant transport acharya et al 2007 delgado 2006 köhne et al 2011 varloteaux et al 2013 mineral dissolution and precipitation processes caused by co2 sequestration algive et al 2010 nogues et al 2013 raoof et al 2012 electrokinetic transport in charged porous media li et al 2014 zhang et al 2015a as well as colloid and virus transport seetha et al 2014 zhang et al 2015b among other applications most or all of pnm studies thus far have been used to simulate fluid flow and or solute transport processes in natural and engineered porous media at relatively small spatial scales generally from a mm to at most a few cm mehmani and balhoff 2015 yang et al 2016 few if any studies exist where the models have been applied to larger length scales e g 30 cm or larger due to limitation of imaging techniques to acquire large 3d pore networks and the required computational times to simulate the governing equations of flow and transport in the resulting media simulating pore scale processes on larger length scales should help to improve our understanding needed to explain the dependency of scale variant transport parameters on travel distance and various pore scale properties e g coordination number and pore size moreover the results would significantly help to develop macroscale constitutive relationships suitable as inputs for continuum scale models for a wide range of applications as explained earlier 1 1 pore scale modelling various pore scale computational methods have been developed to study flow and transport through porous media some directly simulate transport on the complex pore geometry and some simulate using a conceptualized pore network that retains the same topological structure of the media yang et al 2016 the first type of model is typically referred to as direct numerical simulation which includes standard computational fluid dynamics for example lattice boltzmann method chen et al 2018 zhou et al 2020 parvan et al 2020 smoothed particle hydrodynamics tartakovsky et al 2016 ye et al 2019 or finite element methods to directly solve the pore scale governing equations agrawal et al 2020 the second presents the pore space as a connected network with geometrically simplified pore bodies and pore throats and applies a eulerian description e g raoof et al 2013 or a lagrangian method e g bijeljic et al 2004 to obtain transport though the media over time this method intends to maintain the topology of the actual pore space but does not represent the geometric details of individual pores throats to gain computational efficiency dong and blunt 2009 raoof and hassanizadeh 2010 yang et al 2016 1 2 x ray tomography ct scan to provide accurate results a pore scale model should be able to reproduce the main geometric and topological features of the real porous medium including the pore size distribution and the connectivity between pores arns et al 2004 raoof and hassanizadeh 2010 the need for accurate pore structure makes non destructive 3d imaging techniques such as x ray micro computed tomography micro ct valuable tools for quantifying the internal structure of porous media in three dimensions cnudde and boone 2013 vaz et al 2014 wildenschild and sheppard 2013 the combination of 3d imaging together with image analysis provides the necessary information for pore scale modelling fig 1 x ray micro ct imaging is being used increasingly to investigate the internal structures of a large variety of porous objects including geomaterials boone et al 2014 t bultreys et al 2015 cnudde and boone 2013 griggs et al 2015 pereira et al 2016 one of the most common applications of x ray tomography in subsurface research is the extraction of pore networks from micro ct images of soil and rocks to allow investigations of pore scale flow and reactive transport processes blunt et al 2013 boone et al 2014 bultreys et al 2015a cnudde and boone 2013 griggs et al 2015 pereira et al 2016 dynamic imaging experiments using micro ct are now being used to investigate in situ pore scale processes at the mm to cm scale bultreys et al 2015b menke et al 2015 in this study we use micro ct together with image analysis techniques to extract a representative pore network of laboratory column scale experiments and to use the resulting pore network to simulate flow and tracer cacl2 transport through the column 1 3 objectives in this study we intend to explore solute transport and dispersion using three different methods column transport experiments continuum scale modelling and pore scale modelling we performed a series of 36 cm long sand column transport experiments under saturated conditions to obtain solute breakthrough curves at several locations along the flow path from which we calculate hydrodynamic dispersion coefficients using continuum scale modelling at the same time a representative part of the same sand sample was imaged using x ray micro ct to directly extract the pore network and to obtain the geometric and topological properties of the pore space since micro ct has a sample size resolution trade off that significantly hinders direct imaging of the entire 36 cm sand column at the required resolution the statistical properties of the accurate image based pore network of the representative sample were used to construct a very large pore network model with a size equal to the sand column experiment i e a 36 cm long pore scale domain fluid flow and solute transport were subsequently simulated in the large network to obtain both the 3d distribution of solute within the domain and the breakthrough curve of solutes at several locations identical to the experiments 11 18 25 36 cm this allowed us to directly compare solute dispersion processes based on the experimental data continuum scale modelling and pore network simulation 2 materials and methods 2 1 experimental column fig 2 shows a schematic of the experimental setup used in our study a glass cylinder of 36 cm length and 9 0 cm internal diameter was used to construct the experimental column which contained stainless steel lids with a port at its inlet and outlet faces three measuring probes at depths of 11 18 and 25 cm were placed along the column to obtain solute concentrations utilizing the measured electrical conductivity ec the column was packed with a well sorted filtered sand originating from a river bed in papendrecht the netherlands filtersand filcom netherlands the filter sand had an average grain size i e the d50 value of 0 50 mm with the grain size varying mostly between 0 43 and 0 63 mm selected properties of the sand sample are given in table 1 the columns were packed and provided a porosity value of around 0 38 the porosity was calculated gravimetrically after packing the sand columns were flushed with co2 for a period of four hours to replace air from the soil pore spaces due to high solubility of co2 in water respect to air thus ensuring as water saturated as possible conditions next the sand column was gradually saturated by water from the bottom using a peristaltic pump ismatec switzerland we established constant flow rates ranging from 2 0 to 5 3 cm3 min 1 by adjusting the hydraulic head at the top of the sand column using a small water container after reaching fully saturated steady state flow conditions we applied a pulse input of a solute using a low concentration 0 05 m of cacl2 sigma aldrich dynamic measurement of soil moisture temperature and ec were carried out over time using several 5te sensor see measurements in supplementary materials 2 2 micro ct imaging of sand samples a sand sub sample was taken from the experimental column using a plastic tube of 5 cm long and 1 5 cm inner diameter with sharp edges to prevent any displacements of sand grains the sample was partially saturated this resulted in the adhesion of sand particles the three dimensional pore structure of the subsample was measured with the hector micro ct scanner at ugct ghent belgium masschaele et al 2013 the sample was scanned with an accelerating voltage of 100 kv and a target power of 10 w 2400 projections 1 s illumination each were reconstructed using octopus reconstruction software inside matters belgium resulting in a 3d dataset with a voxel size of 8 3 µm nick et al 2013 2 3 pore network modelling pnm of flow and transport in a saturated sand column to directly compare the breakthrough curves obtained experimentally with pnm results a pore network must be constructed with the same length as the experimental columns i e 36 cm in this study it is not feasible to scan the complete 9 0 cm diameter experimental column since this would require lowering the micro ct scan resolution and lead to less accurate pore structures even if the desired resolution could be maintained scanning a 36 cm long column at a voxel pitch of 8 3 µm would require an extremely long scanning time and result in an impractically large micro ct dataset for this reason we extracted the pore network from the imaged sub sample and used this to construct an equivalent network for the entire 36 cm column that was statistically identical to the imaged sample to do so the micro ct scan was first segmented by automatically selecting a grey value threshold using a k means clustering algorithm spurious noise voxels were removed using a majority filter in octopus analysis brabant et al 2011 the pore network domain was then extracted using a grain recognition based network extraction algorithm using the ecore software fei norway bakke and øren 1997 to construct the larger and stochastically representative pore network we targeted key geometrical and topological parameters of the sand pack i e the pore size distribution the pore connectivity distribution and the pore throat lengths these are the major controlling parameters for flow and solute transport and should therefore be the same for the larger scale stochastic network as the direct image based network for the pore sizes a large number of pore body and throat sizes were generated by applying the same pore size distribution obtained through imaging fig 3 the pore coordination number distribution obtained from the image based network was replicated in the stochastic model using the multi directional random structure pore network developed by raoof and hassanizadeh 2010 this method uses an initial pore network with a high pore coordination number and then eliminates pores to obtain a network with a desired average and distribution of the pore coordination number that matches the measured values from the image based model a saturated flow field was established in the pore network by imposing different pressures on the opposing inlet and outlet boundaries of the network all other boundaries parallel to the overall flow direction were assumed to be no flow boundaries fig 4 shows a schematic representation of pore bodies interconnected by means of pore throats within the network with flow occurring from pore body j towards pore body i through pore throat ij such pore space discretization provides a computationally efficient way to solve flow and transport in porous media compared to the direct numerical solution of governing transport equations in complex pore structures fathi et al 2017 we assumed that discharge qij through a given pore throat can be prescribed by the hagen poiseuille equation li et al 2014 raoof et al 2012 1 q i j π r i j 4 8 μ l p j p i where qij is the volumetric discharge through pore throat ij rij is the radius of the pore throat μ is the dynamic viscosity and pi and pj are pressures at pore bodies i and j respectively we assumed incompressible steady state saturated flow such that the sum of discharges of all pore throats connected to a pore body must be zero 2 j 1 z i q i j 0 j 1 2 z i where zi is the coordination number of pore body i combining eqs 1 and 2 for all pores leads to a linear system of equations with a sparse symmetric positive definite coefficient matrix which can be solved for the pore body pressures the flow velocities in all pore throats can be calculated using eq 1 considering the network as a rev the average pore water velocity v is given by 3 v q l v f q ϕ a in which q is the total flux being the sum of fluxes through all pore throats at the inlet or outlet boundary of the network l is the network length vf is total fluid volume in the network φ is porosity and a is the cross sectional area of the sample perpendicular to the flow direction solute transport through the pore network was calculated for both pore bodies and pore throats and considering advection and diffusion processes calculations were done by considering each pore element i e the pore bodies and pore throats as a control volume the estimated pore velocities using eq 3 were used in calculations of the advection term in the solute transport equations the solute concentration in a given pore body i was obtained using li et al 2014 raoof et al 2012 4 v i d c i d t j 1 n i n t h q i j c i j q i c i j 1 z i d 0 a i j c i j c i l i j where vi is the volume of pore body i qi is the total volumetric volume rate going out of the pore body i aij is the cross sectional area of the pore throat d 0 is the ionic or molecular diffusion coefficient ci is the concentration in pore body i cij is the concentration in the pore throat between pore bodies i and j lij is again the length of that throat and n i n t h is the number of pore throats flowing into the pore body i assuming that pore body j is the upstream node and pore body i the downstream node the solute concentration in pore throat ij can be obtained using raoof et al 2012 li et al 2014 5 v i j d c i j d t q i j c j c i j d 0 a i j c j c i j c i c i j l i j eq s 4 and 5 were solved using a fully implicit method embedded in the poreflow package developed by raoof et al 2013 to obtain solute breakthrough curves flux averaged concentrations at selected distances were obtained by averaging concentrations over the network cross section at successive times the applied pore network provided a total of 328 725 pores this included 1461 pores in the x direction along the sample length and the flow direction at the cross sectional plane i e y and z directions we have considered 15 15 pores which provides an area of 13 7 mm 2 this cross sectional size was chosen based on the representative elementary volume rev size tested on the sample to provide stable values for porosity and permeability the computational time needed to get a full set of btcs for each simulation using a fully implicit method raoof et al 2013 was around 12 days using a parallelized program shared memory multiprocessing using openmp architecture on 6 cores under linux os 3 results and discussion 3 1 breakthrough curves the experimentally observed btcs at four different depths are shown in fig 5 in terms of normalized concentrations c c0 of cacl2 btcs show a gaussian shape at all depths this agrees with several studies of tracer transport in homogenously packed columns under saturated conditions lee et al 2014 toride et al 2003 to describe the measured btcs at the darcy scale we have assumed transport by advection and dispersion processes see section 1 in supplementary materials assuming a constant concentration at the inlet boundary e g c x 0 t c i n and a semi infinite profile c x t 0 the analytical solution for the tracer distribution within the 1d column subject to a step increase of the inlet concentration from zero to c o is given by 6 c c o 1 2 e r f c x v t 2 d t 1 2 exp v x d e r f c x v t 2 d t where t is the time of sampling after the step change in the input concentration and erfc is the complementary error function we fitted eq 6 to the measured concentration btcs to determine pore velocity v and the solute dispersion d from which the solute dispersivity λ was calculated as d de λvn where de is an effective diffusion coefficient l2t 1 λ is the longitudinal dispersivity l which is assumed to be an intrinsic soil property for saturated flow and n is a parameter here we assumed the contribution of the molecular diffusion at high values of péclet number pe 10 is negligible and the empirical constant n in hydrodynamic dispersion equation is equal to one the cxtfit program was used to fit eq 6 to obtain the transport parameters see theory of solute dispersion in porous media in supplementary materials toride et al 1995 fig 5 shows excellent agreement between the macroscale btc s and the experimental data results of the fitting parameters are provided in table 2 r squared values for regression of the observed data versus predicted data in all experiments was very high and around 0 98 results of macro scale model at different locations show that the estimated dispersivity values increase with travel distance to reach to asymptotic values at around a distance of 25 cm furthermore dispersivity values slightly increase with the pore water velocity reduction fig 6 however the dispersivity at a short distance increases more over the travel distance when the velocity is smaller these results are consistent with several earlier experimental studies using repacked soils showing dependency of the dispersivity on travel distance and pore water velocity appelo and postma 2004 bandai et al 2017 bromly et al 2007 kanzari et al 2015 nützmann et al 2002 toride et al 2003 we have calculated the dimensionless péclet number to evaluate the effect of molecular diffusion on the hydrodynamic dispersion for the macro scale model very high péclet number pe 50 values were obtained this confirms the validity of our assumption that the contribution of the molecular diffusion is negligible and the empirical constant n is equal to one results also showed that with an increase in the péclet number and or velocity the longitudinal dispersion coefficient increased these results are consistent with earlier studies see fig 1 supplementary materials 3 2 pore network results the process of generating a larger pore network having a size equal to the 36 cm column experiment was explained in section 2 3 for initial and boundary conditions we have considered similar situations as those applied to column experiments the macroscopic 1d model uses one average velocity for each experiment the corresponding pore scale models is however three dimensional where different pores have different velocities the average of pore velocities should be equal to the macroscopic 1d velocity in order to compare the two different scale models to obtain target average velocities we have assigned different pressures at the inlet and outlet faces of the pore network model and calculated the steady state flow by solving eqs 1 and 2 using poreflow to obtain velocity values of 0 077 0 145 and 0 197 cm min 1 similar to the experiments the initial concertation of the pores was set to zero in the pore network model a pulse injection of solute was stimulated by setting the pore concentrations at the inlet face of the network to c c0 1 0 for a period of time followed by injecting solute free water i e c c0 0 0 for the rest of simulation during the simulation the concentration of pores located at the outlet of the pore network was averaged i e cross sectional average weighted by velocity of pores at different times to obtain the time curve of average outlet concentration which is compatible with the concentration measurements at the outlet of column experiments the resulting btcs from pnm simulations are shown in fig 5 together with the btcs obtained from experiments and the 1d macroscale model in general pnm could simulate the experimental btcs transport parameters used in pnm are provided in table 2 fig 5 shows that compared to the darcy model pnm provides a less quality fit to the experimental observations this difference can be explained based on the scale of the two models which determines their mathematical formulations and the level of complexity that they include darcy scale model assumes flow and transport in the column as 1d macroscopic processes consequently it applies one average velocity and uses a dispersion coefficient to account for solute mixing the dispersion coefficient is a fitting parameter and is tuned to obtain the best possible fit i e the darcy model fit in fig 5 since the column is homogenous the fit quality is very good the pore scale model however included the complex 3d pore structure of the media and simulates flow and transport in three dimensional space this model simulates the experimental observations without using any fitting transport parameter unlike darcy model that uses dispersion coefficient as a fitting coefficient as pore structures in porous media are often very complex and there is no assumption of 1d flow or presence of a fitting parameter the quality of the agreement between pore scale modelling results and the experimental observations may not be very good the degree of agreement depends on the ability of the chosen pore scale model to represent 3d pore structures it is possible to use numerical simulations which capture details of the 3d pore structures such as direct numerical solution of the navier stokes equations however such as simulations are computationally very expensive and cannot be used for simulations in long columns such as the 36 cm length column used in this study pore network modelling enables simulating such a large column however simplifies the pore structures into a network of pore bodies and pore throats the quality of pore scale btcs are better at locations farther from the inlet of the sample fig 5 the generated pore network model was macroscopically homogenous with the pore sizes obtained from imaging since the soil column was uniformly packed and carefully filled cm by cm the medium should be macroscopically homogenous therefore pnm tailing of short distance btcs may be due to its formulation that only one average pressure and concentration value is assigned to each single pore to enable simulations of relatively large domains although poreflow calculates separate concentrations for pore bodies and pore throats to lower solute mixing the instant mixing within each pore element can overestimate the overall solute dispersion in the pore network this effect should be more pronounced for relatively short travel times i e close to the inlet since then still larger concentration gradients are present as solutes percolate further into the sample and experiences different pore spaces concentration gradients become less abrupt thus reducing the averaging effect this is likely to be the reason for the better match of computed and measured btcs obtained at longer distances in contrast with dispersivity values derived from the measured btcs dispersivity values obtained with the pnm 0 109 cm to 0 121 cm were almost constant with travel distance for the experiment with flow rate of 3 9 cm3 min 1 the results obtained from darcy model and pore scale model are also different given the applied flow velocities the cause of solute dispersion in our column experiments is velocity variations which are very difficult to be obtained experimentally in long columns the darcy model provides a dispersion coefficient as an indication of velocity variations the pore scale model however provides pore level velocity variations within the sample and shows how different pores with different velocities contribute to solute transport pore scale simulations indicate that by relatively advection dominant conditions local flow velocity variations are the main cause of solute dispersion to present velocity variations we have averaged pore velocity values of pore throats at several cross sections along the sample and provides the statistical information for each location the velocities are obtained by dividing the volumetric flux of each pore throat located at the chosen cross section by its cross sectional area fig 7 shows the analysis of velocity variations there is a wide range of velocities at different cross sections of the column with some pores having a nearly 5 times higher velocity compared to the average velocity of the column experiments and several pores having very low velocity values our results shown that pore scale concentration values have a slightly positive correlation with the pore coordination number this can be explained based on the higher connectivity of pores with larger coordination numbers and the concomitant larger water and solute fluxes through these pores in continuum scale modelling the solute dispersive fluxes are simulated using values of concentration gradients this leads to classical monotonically increasing concentration values behind the btc peak and to monotonically decreasing concentration values ahead of the btc peak fig 8 a such a 1d concentration distribution is indeed the behaviour of the cross sectional average of the 3d pore scale concentrations over time fig 8 a and b however remarkably fig 8c illustrates that in contrast to the continuum scale modelling results which provide monotonically changing concentrations behind and ahead of the btc peak there are several pores with much higher concentration values as compared to their surrounding pores i e creating locally non monotonic concentration variations our results have shown that such pores are often those with lower flow velocity values which create a relatively immobile liquid phase locally where the accumulated solute slowly diffuses back after the peak concentration passes fig 8 shows that even in a homogenous porous medium several pores exist with very low velocities as the fraction of such pores is smaller than the fraction of the rest of pores within he sample cross sectional averaging provides concentrations values which are monotonies i e fig 8a when the fraction of the relatively immobile pores is much larger one may choose to apply a mobile immobile model mim to simulate solute transport at the continuum scale in our study the column was packed very homogenously and the fraction of immobile pores is low enough to allow the use of ade model and to prevent extra terms needed when using mim model this choice is confirmed by the ability of the ade model to fit the experimental btcs very well as shown in fig 5 4 conclusions in this study we investigated solute transport and dispersion using three complementary methods including i column scale solute transport experiments to provide concentration measurements ii a 1d continuum scale modelling to provide the macroscopic behaviour of the sand column and its dispersion coefficient and iii a pore scale modelling to obtain the underlying velocity variations within the 3d pore structures which are responsible for the observed solute dispersion for the first time it was shown that pore network modelling is able to simulate transport in a porous media in size of tens of centimetres this provides confidence that this pore scale approach can ultimately be applied to model the progress of reactive solutes along the length of shallow unsaturated zone and especially to depths where agricultural processes occur the main findings can be summarized as follows 1 we have shown that a pore network which matches both pore connectivity distribution and pore size distribution of the sample is able to reproduce the experimentally observed solute breakthrough curves therefore there is no need to image the whole sample which is very challenging for long sample sizes such as the one used in this study we should note that our soil column was homogeneous and the sub sample used for imaging was larger than the size of the representative elementary volume rev which provide statistically stable transport parameters 2 ability to build a very long 36 cm pore scale model allowed us to directly compare the pore scale modelling results with the experimentally measured solute concentrations as well as the results from continuum darcy scale modelling we found that even in a homogenous porous media immobile pores exist with low velocities compared to the average velocity this process created local variations in the concentration field where several pores have much higher concentration values as compared to their surrounding pores such local concentration variations cannot be obtained when using continuum scale models as they lead to the classical monotonically increasing concentration values behind the btc peak and to monotonically decreasing concentration values ahead of the btc peak 3 results show that the calculated dispersivity values increase with travel distance as well as slightly increase with the pore water velocity reduction pore scale concentration values showed a slightly positive correlation with the pore coordination number this may be explained based on the higher connectivity of pores with larger coordination numbers and the concomitant larger fluxes through these pores findings of this work will be helpful to illustrate the underlying processes contributing to the spread of a contaminant plume about the advective front such an understanding can contribute to the design of more cost effective and accurate treatment schemes in natural settings by decreasing the uncertainties about the dispersion coefficient as well as the design of engineered permeable reactive barriers through choice of materials with optimum pore size distributions still we acknowledge that more studies are needed for these applications including the use of reactive solutes and more heterogeneous porous media appendix supplementary materials video clip of a simulation with velocity of 0 145 cm min 1 showing 3d distribution of concentrations as well as btcs at three locations note to provide a better visualization the model cross section in this video is reduced to 10 10 pores while the domain length is kept unchanged to represent 36 cm of the sand sample credit authorship contribution statement mojtaba g mahmoodlu conceptualization data curation formal analysis investigation project administration methodology writing original draft writing review editing amir raoof supervision resources software writing review editing funding acquisition tom bultreys software visualization jeroen van stappen software visualization veerle cnudde writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research was part of research project project no 6 600 2019 which was founded by gonbad university this work was also partially supported by the veni research grant with project no 016 151 047 awarded to amir raoof by the netherlands organization for scientific research nwo supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103713 appendix supplementary materials image application 1 image video 2 
424,predicting the solute dispersivity in porous media is complicated by the known scale dependency of dispersion processes in this study we combined three complementary methods to investigate solute dispersivity at different length scales the applied methods included 36 cm long column experiments extremely large three dimensional 3d x ray image based pore network simulations and darcy scale modelling we used x ray imaging to extract the information on pore structures needed to construct a very long 36 cm pore network model doing so for the first time a direct comparison of the pore scale model to the large experimental observations was performed the longitudinal dispersivity was found to increase with length with the rate of increase being lower at higher flow velocities results have shown that a pore network which matches pore connectivity distribution and pore size distribution of a sub sample of the column is able to reproduce the experimentally observed solute breakthrough curves pore scale modelling provided the extent of pore velocity variations corresponding to various locations along the experimental column as well as the one dimensional 1d darcy scale model we have found that even in homogenous porous media immobile pores exist with low velocities compared to the average velocity which creates local concentration maximals graphical abstract image graphical abstract keywords dispersivity column experiment pore scale modelling pore network modelling x ray imaging 1 introduction solute dispersion in porous media has been the focus of many systematic studies in various fields of hydrology geophysics petroleum engineering chemical engineering soil physics and agricultural engineering bijeljic et al 2013 delgado 2006 dispersion plays a key role in subsurface transport by affecting the migration of contaminants the mixing of salt and fresh water nick et al 2013 and related processes over the past decades solute dispersion phenomena have been widely investigated theoretically experimentally and numerically from the pore scale to the column scale and the field scale under both saturated and unsaturated conditions agrawal et al 2020 bunsri et al 2008 dünser and meyer 2016 estabragh et al 2013 harvey and gorelick 1995 kohanpour et al 2020 mcdaniel et al 2015 raoof and hassanizadeh 2013 sherman et al 2018 toride et al 2003 zhen et al 2016 the degree of solute spreading has been found to be closely related to the water flow velocity distribution within and between pores the divergence and convergence of flow paths within the porous medium and molecular diffusion see theory of solute dispersion in porous media in supplementary materials delgado 2006 harvey and gorelick 1995 furthermore dispersivity is known to be a scale dependent parameter which increases with the length scale providing subsurface solute transport studies with a great challenge transport of solutes at the field scale involves difficulties due to the inherent uncertainty in subsurface hydraulic and transport parameters subsurface heterogeneity at the field scale of aquifers is one of the most uncontrolled parameters that has a significant effect on solute transport particularly for reactive solutes nick et al 2011 pu and fox 2015 slimene et al 2015 although column scale experiments in the laboratory allow much more control over the experimental conditions they are generally still too macroscopic in nature to directly observe the contribution of the underlying pore scale processes on flow solute transport and spreading nevertheless investigating these underlying processes at the microscopic or pore scale offers a unique way to study the scale dependency of continuum scale transport parameters such scale dependency cannot be easily captured by an effective medium darcy approach bultreys et al 2016 xiong et al 2016 for this reason pore scale information can be valuable for understanding solute dispersion at the larger length scales delgado 2006 several studies indicate that pore scale modelling allows to relate the macro scale dispersion coefficient to the pore size distribution and velocity distribution within a porous medium bultreys et al 2016 xiong et al 2016 parvan et al 2020 among existing methods pore network modelling pnm has been increasingly used to simulate results from laboratory experiments and to improve our understanding of underlying pore scale processes bodla et al 2010 delgado 2006 köhne et al 2011 porta et al 2016 varloteaux et al 2013 they are now widely used in the geosciences and related fields to study capillarity and multiphase flow bultreys et al 2015 zhou and helland 2016 non reactive and reactive contaminant transport acharya et al 2007 delgado 2006 köhne et al 2011 varloteaux et al 2013 mineral dissolution and precipitation processes caused by co2 sequestration algive et al 2010 nogues et al 2013 raoof et al 2012 electrokinetic transport in charged porous media li et al 2014 zhang et al 2015a as well as colloid and virus transport seetha et al 2014 zhang et al 2015b among other applications most or all of pnm studies thus far have been used to simulate fluid flow and or solute transport processes in natural and engineered porous media at relatively small spatial scales generally from a mm to at most a few cm mehmani and balhoff 2015 yang et al 2016 few if any studies exist where the models have been applied to larger length scales e g 30 cm or larger due to limitation of imaging techniques to acquire large 3d pore networks and the required computational times to simulate the governing equations of flow and transport in the resulting media simulating pore scale processes on larger length scales should help to improve our understanding needed to explain the dependency of scale variant transport parameters on travel distance and various pore scale properties e g coordination number and pore size moreover the results would significantly help to develop macroscale constitutive relationships suitable as inputs for continuum scale models for a wide range of applications as explained earlier 1 1 pore scale modelling various pore scale computational methods have been developed to study flow and transport through porous media some directly simulate transport on the complex pore geometry and some simulate using a conceptualized pore network that retains the same topological structure of the media yang et al 2016 the first type of model is typically referred to as direct numerical simulation which includes standard computational fluid dynamics for example lattice boltzmann method chen et al 2018 zhou et al 2020 parvan et al 2020 smoothed particle hydrodynamics tartakovsky et al 2016 ye et al 2019 or finite element methods to directly solve the pore scale governing equations agrawal et al 2020 the second presents the pore space as a connected network with geometrically simplified pore bodies and pore throats and applies a eulerian description e g raoof et al 2013 or a lagrangian method e g bijeljic et al 2004 to obtain transport though the media over time this method intends to maintain the topology of the actual pore space but does not represent the geometric details of individual pores throats to gain computational efficiency dong and blunt 2009 raoof and hassanizadeh 2010 yang et al 2016 1 2 x ray tomography ct scan to provide accurate results a pore scale model should be able to reproduce the main geometric and topological features of the real porous medium including the pore size distribution and the connectivity between pores arns et al 2004 raoof and hassanizadeh 2010 the need for accurate pore structure makes non destructive 3d imaging techniques such as x ray micro computed tomography micro ct valuable tools for quantifying the internal structure of porous media in three dimensions cnudde and boone 2013 vaz et al 2014 wildenschild and sheppard 2013 the combination of 3d imaging together with image analysis provides the necessary information for pore scale modelling fig 1 x ray micro ct imaging is being used increasingly to investigate the internal structures of a large variety of porous objects including geomaterials boone et al 2014 t bultreys et al 2015 cnudde and boone 2013 griggs et al 2015 pereira et al 2016 one of the most common applications of x ray tomography in subsurface research is the extraction of pore networks from micro ct images of soil and rocks to allow investigations of pore scale flow and reactive transport processes blunt et al 2013 boone et al 2014 bultreys et al 2015a cnudde and boone 2013 griggs et al 2015 pereira et al 2016 dynamic imaging experiments using micro ct are now being used to investigate in situ pore scale processes at the mm to cm scale bultreys et al 2015b menke et al 2015 in this study we use micro ct together with image analysis techniques to extract a representative pore network of laboratory column scale experiments and to use the resulting pore network to simulate flow and tracer cacl2 transport through the column 1 3 objectives in this study we intend to explore solute transport and dispersion using three different methods column transport experiments continuum scale modelling and pore scale modelling we performed a series of 36 cm long sand column transport experiments under saturated conditions to obtain solute breakthrough curves at several locations along the flow path from which we calculate hydrodynamic dispersion coefficients using continuum scale modelling at the same time a representative part of the same sand sample was imaged using x ray micro ct to directly extract the pore network and to obtain the geometric and topological properties of the pore space since micro ct has a sample size resolution trade off that significantly hinders direct imaging of the entire 36 cm sand column at the required resolution the statistical properties of the accurate image based pore network of the representative sample were used to construct a very large pore network model with a size equal to the sand column experiment i e a 36 cm long pore scale domain fluid flow and solute transport were subsequently simulated in the large network to obtain both the 3d distribution of solute within the domain and the breakthrough curve of solutes at several locations identical to the experiments 11 18 25 36 cm this allowed us to directly compare solute dispersion processes based on the experimental data continuum scale modelling and pore network simulation 2 materials and methods 2 1 experimental column fig 2 shows a schematic of the experimental setup used in our study a glass cylinder of 36 cm length and 9 0 cm internal diameter was used to construct the experimental column which contained stainless steel lids with a port at its inlet and outlet faces three measuring probes at depths of 11 18 and 25 cm were placed along the column to obtain solute concentrations utilizing the measured electrical conductivity ec the column was packed with a well sorted filtered sand originating from a river bed in papendrecht the netherlands filtersand filcom netherlands the filter sand had an average grain size i e the d50 value of 0 50 mm with the grain size varying mostly between 0 43 and 0 63 mm selected properties of the sand sample are given in table 1 the columns were packed and provided a porosity value of around 0 38 the porosity was calculated gravimetrically after packing the sand columns were flushed with co2 for a period of four hours to replace air from the soil pore spaces due to high solubility of co2 in water respect to air thus ensuring as water saturated as possible conditions next the sand column was gradually saturated by water from the bottom using a peristaltic pump ismatec switzerland we established constant flow rates ranging from 2 0 to 5 3 cm3 min 1 by adjusting the hydraulic head at the top of the sand column using a small water container after reaching fully saturated steady state flow conditions we applied a pulse input of a solute using a low concentration 0 05 m of cacl2 sigma aldrich dynamic measurement of soil moisture temperature and ec were carried out over time using several 5te sensor see measurements in supplementary materials 2 2 micro ct imaging of sand samples a sand sub sample was taken from the experimental column using a plastic tube of 5 cm long and 1 5 cm inner diameter with sharp edges to prevent any displacements of sand grains the sample was partially saturated this resulted in the adhesion of sand particles the three dimensional pore structure of the subsample was measured with the hector micro ct scanner at ugct ghent belgium masschaele et al 2013 the sample was scanned with an accelerating voltage of 100 kv and a target power of 10 w 2400 projections 1 s illumination each were reconstructed using octopus reconstruction software inside matters belgium resulting in a 3d dataset with a voxel size of 8 3 µm nick et al 2013 2 3 pore network modelling pnm of flow and transport in a saturated sand column to directly compare the breakthrough curves obtained experimentally with pnm results a pore network must be constructed with the same length as the experimental columns i e 36 cm in this study it is not feasible to scan the complete 9 0 cm diameter experimental column since this would require lowering the micro ct scan resolution and lead to less accurate pore structures even if the desired resolution could be maintained scanning a 36 cm long column at a voxel pitch of 8 3 µm would require an extremely long scanning time and result in an impractically large micro ct dataset for this reason we extracted the pore network from the imaged sub sample and used this to construct an equivalent network for the entire 36 cm column that was statistically identical to the imaged sample to do so the micro ct scan was first segmented by automatically selecting a grey value threshold using a k means clustering algorithm spurious noise voxels were removed using a majority filter in octopus analysis brabant et al 2011 the pore network domain was then extracted using a grain recognition based network extraction algorithm using the ecore software fei norway bakke and øren 1997 to construct the larger and stochastically representative pore network we targeted key geometrical and topological parameters of the sand pack i e the pore size distribution the pore connectivity distribution and the pore throat lengths these are the major controlling parameters for flow and solute transport and should therefore be the same for the larger scale stochastic network as the direct image based network for the pore sizes a large number of pore body and throat sizes were generated by applying the same pore size distribution obtained through imaging fig 3 the pore coordination number distribution obtained from the image based network was replicated in the stochastic model using the multi directional random structure pore network developed by raoof and hassanizadeh 2010 this method uses an initial pore network with a high pore coordination number and then eliminates pores to obtain a network with a desired average and distribution of the pore coordination number that matches the measured values from the image based model a saturated flow field was established in the pore network by imposing different pressures on the opposing inlet and outlet boundaries of the network all other boundaries parallel to the overall flow direction were assumed to be no flow boundaries fig 4 shows a schematic representation of pore bodies interconnected by means of pore throats within the network with flow occurring from pore body j towards pore body i through pore throat ij such pore space discretization provides a computationally efficient way to solve flow and transport in porous media compared to the direct numerical solution of governing transport equations in complex pore structures fathi et al 2017 we assumed that discharge qij through a given pore throat can be prescribed by the hagen poiseuille equation li et al 2014 raoof et al 2012 1 q i j π r i j 4 8 μ l p j p i where qij is the volumetric discharge through pore throat ij rij is the radius of the pore throat μ is the dynamic viscosity and pi and pj are pressures at pore bodies i and j respectively we assumed incompressible steady state saturated flow such that the sum of discharges of all pore throats connected to a pore body must be zero 2 j 1 z i q i j 0 j 1 2 z i where zi is the coordination number of pore body i combining eqs 1 and 2 for all pores leads to a linear system of equations with a sparse symmetric positive definite coefficient matrix which can be solved for the pore body pressures the flow velocities in all pore throats can be calculated using eq 1 considering the network as a rev the average pore water velocity v is given by 3 v q l v f q ϕ a in which q is the total flux being the sum of fluxes through all pore throats at the inlet or outlet boundary of the network l is the network length vf is total fluid volume in the network φ is porosity and a is the cross sectional area of the sample perpendicular to the flow direction solute transport through the pore network was calculated for both pore bodies and pore throats and considering advection and diffusion processes calculations were done by considering each pore element i e the pore bodies and pore throats as a control volume the estimated pore velocities using eq 3 were used in calculations of the advection term in the solute transport equations the solute concentration in a given pore body i was obtained using li et al 2014 raoof et al 2012 4 v i d c i d t j 1 n i n t h q i j c i j q i c i j 1 z i d 0 a i j c i j c i l i j where vi is the volume of pore body i qi is the total volumetric volume rate going out of the pore body i aij is the cross sectional area of the pore throat d 0 is the ionic or molecular diffusion coefficient ci is the concentration in pore body i cij is the concentration in the pore throat between pore bodies i and j lij is again the length of that throat and n i n t h is the number of pore throats flowing into the pore body i assuming that pore body j is the upstream node and pore body i the downstream node the solute concentration in pore throat ij can be obtained using raoof et al 2012 li et al 2014 5 v i j d c i j d t q i j c j c i j d 0 a i j c j c i j c i c i j l i j eq s 4 and 5 were solved using a fully implicit method embedded in the poreflow package developed by raoof et al 2013 to obtain solute breakthrough curves flux averaged concentrations at selected distances were obtained by averaging concentrations over the network cross section at successive times the applied pore network provided a total of 328 725 pores this included 1461 pores in the x direction along the sample length and the flow direction at the cross sectional plane i e y and z directions we have considered 15 15 pores which provides an area of 13 7 mm 2 this cross sectional size was chosen based on the representative elementary volume rev size tested on the sample to provide stable values for porosity and permeability the computational time needed to get a full set of btcs for each simulation using a fully implicit method raoof et al 2013 was around 12 days using a parallelized program shared memory multiprocessing using openmp architecture on 6 cores under linux os 3 results and discussion 3 1 breakthrough curves the experimentally observed btcs at four different depths are shown in fig 5 in terms of normalized concentrations c c0 of cacl2 btcs show a gaussian shape at all depths this agrees with several studies of tracer transport in homogenously packed columns under saturated conditions lee et al 2014 toride et al 2003 to describe the measured btcs at the darcy scale we have assumed transport by advection and dispersion processes see section 1 in supplementary materials assuming a constant concentration at the inlet boundary e g c x 0 t c i n and a semi infinite profile c x t 0 the analytical solution for the tracer distribution within the 1d column subject to a step increase of the inlet concentration from zero to c o is given by 6 c c o 1 2 e r f c x v t 2 d t 1 2 exp v x d e r f c x v t 2 d t where t is the time of sampling after the step change in the input concentration and erfc is the complementary error function we fitted eq 6 to the measured concentration btcs to determine pore velocity v and the solute dispersion d from which the solute dispersivity λ was calculated as d de λvn where de is an effective diffusion coefficient l2t 1 λ is the longitudinal dispersivity l which is assumed to be an intrinsic soil property for saturated flow and n is a parameter here we assumed the contribution of the molecular diffusion at high values of péclet number pe 10 is negligible and the empirical constant n in hydrodynamic dispersion equation is equal to one the cxtfit program was used to fit eq 6 to obtain the transport parameters see theory of solute dispersion in porous media in supplementary materials toride et al 1995 fig 5 shows excellent agreement between the macroscale btc s and the experimental data results of the fitting parameters are provided in table 2 r squared values for regression of the observed data versus predicted data in all experiments was very high and around 0 98 results of macro scale model at different locations show that the estimated dispersivity values increase with travel distance to reach to asymptotic values at around a distance of 25 cm furthermore dispersivity values slightly increase with the pore water velocity reduction fig 6 however the dispersivity at a short distance increases more over the travel distance when the velocity is smaller these results are consistent with several earlier experimental studies using repacked soils showing dependency of the dispersivity on travel distance and pore water velocity appelo and postma 2004 bandai et al 2017 bromly et al 2007 kanzari et al 2015 nützmann et al 2002 toride et al 2003 we have calculated the dimensionless péclet number to evaluate the effect of molecular diffusion on the hydrodynamic dispersion for the macro scale model very high péclet number pe 50 values were obtained this confirms the validity of our assumption that the contribution of the molecular diffusion is negligible and the empirical constant n is equal to one results also showed that with an increase in the péclet number and or velocity the longitudinal dispersion coefficient increased these results are consistent with earlier studies see fig 1 supplementary materials 3 2 pore network results the process of generating a larger pore network having a size equal to the 36 cm column experiment was explained in section 2 3 for initial and boundary conditions we have considered similar situations as those applied to column experiments the macroscopic 1d model uses one average velocity for each experiment the corresponding pore scale models is however three dimensional where different pores have different velocities the average of pore velocities should be equal to the macroscopic 1d velocity in order to compare the two different scale models to obtain target average velocities we have assigned different pressures at the inlet and outlet faces of the pore network model and calculated the steady state flow by solving eqs 1 and 2 using poreflow to obtain velocity values of 0 077 0 145 and 0 197 cm min 1 similar to the experiments the initial concertation of the pores was set to zero in the pore network model a pulse injection of solute was stimulated by setting the pore concentrations at the inlet face of the network to c c0 1 0 for a period of time followed by injecting solute free water i e c c0 0 0 for the rest of simulation during the simulation the concentration of pores located at the outlet of the pore network was averaged i e cross sectional average weighted by velocity of pores at different times to obtain the time curve of average outlet concentration which is compatible with the concentration measurements at the outlet of column experiments the resulting btcs from pnm simulations are shown in fig 5 together with the btcs obtained from experiments and the 1d macroscale model in general pnm could simulate the experimental btcs transport parameters used in pnm are provided in table 2 fig 5 shows that compared to the darcy model pnm provides a less quality fit to the experimental observations this difference can be explained based on the scale of the two models which determines their mathematical formulations and the level of complexity that they include darcy scale model assumes flow and transport in the column as 1d macroscopic processes consequently it applies one average velocity and uses a dispersion coefficient to account for solute mixing the dispersion coefficient is a fitting parameter and is tuned to obtain the best possible fit i e the darcy model fit in fig 5 since the column is homogenous the fit quality is very good the pore scale model however included the complex 3d pore structure of the media and simulates flow and transport in three dimensional space this model simulates the experimental observations without using any fitting transport parameter unlike darcy model that uses dispersion coefficient as a fitting coefficient as pore structures in porous media are often very complex and there is no assumption of 1d flow or presence of a fitting parameter the quality of the agreement between pore scale modelling results and the experimental observations may not be very good the degree of agreement depends on the ability of the chosen pore scale model to represent 3d pore structures it is possible to use numerical simulations which capture details of the 3d pore structures such as direct numerical solution of the navier stokes equations however such as simulations are computationally very expensive and cannot be used for simulations in long columns such as the 36 cm length column used in this study pore network modelling enables simulating such a large column however simplifies the pore structures into a network of pore bodies and pore throats the quality of pore scale btcs are better at locations farther from the inlet of the sample fig 5 the generated pore network model was macroscopically homogenous with the pore sizes obtained from imaging since the soil column was uniformly packed and carefully filled cm by cm the medium should be macroscopically homogenous therefore pnm tailing of short distance btcs may be due to its formulation that only one average pressure and concentration value is assigned to each single pore to enable simulations of relatively large domains although poreflow calculates separate concentrations for pore bodies and pore throats to lower solute mixing the instant mixing within each pore element can overestimate the overall solute dispersion in the pore network this effect should be more pronounced for relatively short travel times i e close to the inlet since then still larger concentration gradients are present as solutes percolate further into the sample and experiences different pore spaces concentration gradients become less abrupt thus reducing the averaging effect this is likely to be the reason for the better match of computed and measured btcs obtained at longer distances in contrast with dispersivity values derived from the measured btcs dispersivity values obtained with the pnm 0 109 cm to 0 121 cm were almost constant with travel distance for the experiment with flow rate of 3 9 cm3 min 1 the results obtained from darcy model and pore scale model are also different given the applied flow velocities the cause of solute dispersion in our column experiments is velocity variations which are very difficult to be obtained experimentally in long columns the darcy model provides a dispersion coefficient as an indication of velocity variations the pore scale model however provides pore level velocity variations within the sample and shows how different pores with different velocities contribute to solute transport pore scale simulations indicate that by relatively advection dominant conditions local flow velocity variations are the main cause of solute dispersion to present velocity variations we have averaged pore velocity values of pore throats at several cross sections along the sample and provides the statistical information for each location the velocities are obtained by dividing the volumetric flux of each pore throat located at the chosen cross section by its cross sectional area fig 7 shows the analysis of velocity variations there is a wide range of velocities at different cross sections of the column with some pores having a nearly 5 times higher velocity compared to the average velocity of the column experiments and several pores having very low velocity values our results shown that pore scale concentration values have a slightly positive correlation with the pore coordination number this can be explained based on the higher connectivity of pores with larger coordination numbers and the concomitant larger water and solute fluxes through these pores in continuum scale modelling the solute dispersive fluxes are simulated using values of concentration gradients this leads to classical monotonically increasing concentration values behind the btc peak and to monotonically decreasing concentration values ahead of the btc peak fig 8 a such a 1d concentration distribution is indeed the behaviour of the cross sectional average of the 3d pore scale concentrations over time fig 8 a and b however remarkably fig 8c illustrates that in contrast to the continuum scale modelling results which provide monotonically changing concentrations behind and ahead of the btc peak there are several pores with much higher concentration values as compared to their surrounding pores i e creating locally non monotonic concentration variations our results have shown that such pores are often those with lower flow velocity values which create a relatively immobile liquid phase locally where the accumulated solute slowly diffuses back after the peak concentration passes fig 8 shows that even in a homogenous porous medium several pores exist with very low velocities as the fraction of such pores is smaller than the fraction of the rest of pores within he sample cross sectional averaging provides concentrations values which are monotonies i e fig 8a when the fraction of the relatively immobile pores is much larger one may choose to apply a mobile immobile model mim to simulate solute transport at the continuum scale in our study the column was packed very homogenously and the fraction of immobile pores is low enough to allow the use of ade model and to prevent extra terms needed when using mim model this choice is confirmed by the ability of the ade model to fit the experimental btcs very well as shown in fig 5 4 conclusions in this study we investigated solute transport and dispersion using three complementary methods including i column scale solute transport experiments to provide concentration measurements ii a 1d continuum scale modelling to provide the macroscopic behaviour of the sand column and its dispersion coefficient and iii a pore scale modelling to obtain the underlying velocity variations within the 3d pore structures which are responsible for the observed solute dispersion for the first time it was shown that pore network modelling is able to simulate transport in a porous media in size of tens of centimetres this provides confidence that this pore scale approach can ultimately be applied to model the progress of reactive solutes along the length of shallow unsaturated zone and especially to depths where agricultural processes occur the main findings can be summarized as follows 1 we have shown that a pore network which matches both pore connectivity distribution and pore size distribution of the sample is able to reproduce the experimentally observed solute breakthrough curves therefore there is no need to image the whole sample which is very challenging for long sample sizes such as the one used in this study we should note that our soil column was homogeneous and the sub sample used for imaging was larger than the size of the representative elementary volume rev which provide statistically stable transport parameters 2 ability to build a very long 36 cm pore scale model allowed us to directly compare the pore scale modelling results with the experimentally measured solute concentrations as well as the results from continuum darcy scale modelling we found that even in a homogenous porous media immobile pores exist with low velocities compared to the average velocity this process created local variations in the concentration field where several pores have much higher concentration values as compared to their surrounding pores such local concentration variations cannot be obtained when using continuum scale models as they lead to the classical monotonically increasing concentration values behind the btc peak and to monotonically decreasing concentration values ahead of the btc peak 3 results show that the calculated dispersivity values increase with travel distance as well as slightly increase with the pore water velocity reduction pore scale concentration values showed a slightly positive correlation with the pore coordination number this may be explained based on the higher connectivity of pores with larger coordination numbers and the concomitant larger fluxes through these pores findings of this work will be helpful to illustrate the underlying processes contributing to the spread of a contaminant plume about the advective front such an understanding can contribute to the design of more cost effective and accurate treatment schemes in natural settings by decreasing the uncertainties about the dispersion coefficient as well as the design of engineered permeable reactive barriers through choice of materials with optimum pore size distributions still we acknowledge that more studies are needed for these applications including the use of reactive solutes and more heterogeneous porous media appendix supplementary materials video clip of a simulation with velocity of 0 145 cm min 1 showing 3d distribution of concentrations as well as btcs at three locations note to provide a better visualization the model cross section in this video is reduced to 10 10 pores while the domain length is kept unchanged to represent 36 cm of the sand sample credit authorship contribution statement mojtaba g mahmoodlu conceptualization data curation formal analysis investigation project administration methodology writing original draft writing review editing amir raoof supervision resources software writing review editing funding acquisition tom bultreys software visualization jeroen van stappen software visualization veerle cnudde writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research was part of research project project no 6 600 2019 which was founded by gonbad university this work was also partially supported by the veni research grant with project no 016 151 047 awarded to amir raoof by the netherlands organization for scientific research nwo supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103713 appendix supplementary materials image application 1 image video 2 
