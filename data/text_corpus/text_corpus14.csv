index,text
70,the paper is focused on high efficiency stokes solver that is applied to the incompressible flow in porous media computational domains are represented by binarized 3d computed tomography voxel models the solution procedure is constructed around a fast algebraic multigrid solver that utilizes the power of graphics processing units gpus in order to minimize memory footprint and accelerate the solver a simple mac type staggered finite difference discretization is used and a coupled stokes saddle point type system is solved directly on a gpu the mac discretization is discussed taking particular care of internal solid boundaries around pores the method includes topological domain analysis on a gpu which removes isolated volumes with no flow in the domain based on the connected component labeling depending on the boundary conditions we consider various types of boundary conditions and efficient parallel strategies for the gpus including fast matrix assembly and residual regularization our method is extensively benchmarked both against analytical solutions and applied problems from digital rock physics in terms of computational wall time precision approximation order and convergence we demonstrate that it takes up to 5 23 s on a modern gpu card to obtain a solution with 1 1 0 6 error residuals for 3d geometries with 300 450 3 voxels and a porosity range of 5 37 graphical abstract keywords stokes flow porous media algebraic multigrid method general purpose gpu krylov subspace solvers permeability permeability tensor data availability data will be made available on request 1 introduction structure property relationships sahimi 2003 torquato 2002 are the basis of the pore scale modeling technology that targets directly solving governing physical equations within the geometry of the materials under study or to simplify the relationships using various statistical approaches in particular flow and transport characteristics for porous media in the form of for example permeability tensors guibert et al 2016 gerke et al 2019 scandelli et al 2022 relative permeabilities and capillary curves for multi phase flow valvatne and blunt 2004 patzek 2001 ryazanov et al 2009 electrical properties khachkova et al 2021 and dispersion tensors salles et al 1993 are of utmost importance for applications in petroleum engineering blunt 2017 godinho et al 2016 hydrology and soil physics barbosa et al 2022a ferreira et al 2022 food engineering derossi et al 2019 and numerous other disciplines the results of the pore scale simulations can be used to optimize the parameters of the c o 2 sequestration hydrocarbon recovery or soil irrigation and to parameterize the continuum scale models to describe the flow problems in the m km scale among the physical properties mentioned earlier the permeability is the foundational characteristic as a key parameter in majority of continuum scale models and is based on homogenized pressure and flow velocity fields that are also needed to compute other properties e g dispersion khirevich and patzek 2019 the input data for pore scale modeling information usually comes from x ray tomography xct imaging cnudde and boone 2013a abrosimov et al 2021 in the form of 3d images the fundamental problem of almost any imaging method is the field of view to imaging resolution ratio the larger the porous media sample is the lower the resolution gerke et al 2015 covering hierarchical structural features of most natural porous media at all interesting scales thus requires multiscale imaging with sub sampling karsanina et al 2018 chen et al 2016 tahmasebi 2018 based on combined xct scanning electron microscopy sem or focused ion beam milling fib sem methods hemes et al 2015 gerke et al 2021 stochastic reconstruction techniques adler et al 1990 yeong and torquato 1998 allow recreating 3d structure based on limited 2d or 3d information different methods such as process based methods thovert and adler 2011 barbosa et al 2022b multiple point statistics tahmasebi and sahimi 2013 gravey and mariethoz 2020 and simulated annealing based jiao and chawla 2014 karsanina and gerke 2018 algorithms and their hybrids politis et al 2008 cherkasov et al 2021 not only helpful in substitution of time consuming imaging but is also necessary to fuse multiscale images into a single digital model karsanina et al 2018 li et al 2020 wu et al 2019 as imaging methods provide information in the form of attenuation of x ray or electron back scattering intensity one needs image processing techniques to segment out the pores and solids this step in input data preparation currently evolves towards the usage of deep learning techniques e g karimpouli and tahmasebi 2019b lavrukhin et al 2021 after the 3d image of porous space is obtained the pore scale method can be applied to such an image to compute the permeability the majority of such methods can be roughly divided into the following groups 1 direct pore scale simulations involving the numerical solution of the navier stokes equation as will be reviewed in detail below 2 pore network model pnm approach patzek 2001 valvatne and blunt 2004 gerke et al 2020 and 3 different classes of effective medium approximations naik et al 2021 ghanbarian 2022 direct simulations are computationally very expensive even on modern hardware and for large modeling domains require parallel implementation of thousands of cpus khirevich et al 2012 the last two approaches are much more efficient but they require some parameters or tuning that are ideally based on direct simulations for example miao et al 2017 proposed to parameterize the hydraulic conductances of the pnm elements with the help of the machine learning the framework that was applied in different pnm models misaghian et al 2022 tembely et al 2021 rabbani and babaei 2019 that requires local flow velocities and pressures to train the neural network to predict conductances on the fly during pore network extraction in an accurate manner in summary we still lack a robust and computationally efficient single phase flow simulator that is needed in numerous applications starting from dispersion modeling and spanning to parameterization of the pnm models the problem of the single phase incompressible flow simulation in porous media is studied and covered in literature well for example ord et al 2009 golparvar et al 2018 as we argued above in digital rock applications we are usually interested in the approach where partial differential equations and boundary conditions that describe the incompressible flow are solved in the provided domain directly incompressible flows in porous media can be considered in either creeping or advective regimes which are defined by the local reynolds number for example flow in small pores is creeping while flow in cracks and large pores is advective each one requires a different treatment from the computational point of view both methods are saddle point problems due to the incompressibility constraint while the first case has a pure parabolic nature for the momentum equation the second one is hyperbolic dominated computationally one can divide the methods that solve incompressible viscous flows in porous media into several groups based on different methods of approximation the first group treats incompressibility constraints approximately e g using artificial compressibility method the second group tries to pose incompressibility constrain exactly by considering a much more complicated saddle point problem another classification of methods can be formulated based on how one treats temporal derivatives in the momentum equations let us classify some common methods that are usually applied to simulating flows in porous media into these categories for example a popular lattice boltzmann method lbm treats incompressibility approximately via chapman enskog expansion while being an explicit method chen and doolen 1998 khirevich et al 2015 mcclure et al 2021 artificial compressibility methods kwak and kiris 2010 treat incompressibility approximately but can be either explicit gerke et al 2018 or implicit lee et al 2001 for the exact steady state these methods recover the original incompressible equations in reality there is always a trade off between accuracy and efficiency madsen and schäffer 2006 projection methods treat incompressibility exactly however such an approach is only possible if the helmholtz projection can be derived exactly otherwise these methods are incompressible up to an error in the fractional step method approximation see kim and moin 1985 armfield and street 1999 these methods can be either explicit armfield et al 2010 or implicit feng et al 2011 2012 finally a fully coupled system of equations can be considered where incompressibility is satisfied up to the convergence criteria of the linear system solver such methods are always implicit john and tobiska 2000 darwish et al 2009 uroić and jasak 2018 riella et al 2019 in this paper we are focusing on the solution of the pure creeping flow problems that can be described by the stokes operator using the fully coupled stationary system of equations infinite time step size the choice of the method for the solution is dictated by severe restrictions on the explicit method time step size due to stability conditions roughly proportional to the maximum velocity magnitude times the spatial discretization size squared and by a users interest in stationary flow in porous media first the continuous infinite dimensional system should be discretized to obtain the finite dimensional approximate system of equations that a computer can solve here one has an excellent choice of finite difference finite element gibson et al 2020 or other types landmann et al 2008 of approximation next this finite dimensional system which is a saddle point problem needs to be solved efficiently benzi et al 2005 both are tightly coupled and should be chosen depending on the target computational architecture note that an optimal solution method is the method that can solve the discrete problem of size n using o n floating point operations and hence the wall time has a linear dependence on the problem size unlike explicit methods optimal iterative solution methods for elliptic problems are multigrid methods fedorenko 1962 bakhvalov 1966 xu and zikatanov 2017 and domain decomposition methods schueller and mcdonough 2002 pechstein 2013 in this study we focus our attention on the application of the algebraic multigrid amg methods as the preconditioners to solve the problem such methods were already applied to the problem at hand e g demidov et al 2021 and excellent reviews on preconditioning strategies are presented in works may and moresi 2008 and elman et al 2008 note that an optimal choice would be to use a geometric multigrid gmg method with a vanka type smoother manservisi 2006 saberi et al 2022 but the porous media geometry a microscopically heterogeneous mixture of pore and solid inclusions limits the application of the gmg it is very difficult to construct optimal restriction and prolongation operations on this random mixture of fluid and solid bodies besides vanka type smoothers require additional treatment in the case of mass parallel implementation claus and bolten 2021 the approach discussed above is not new for example the stokes system was solved using amg methods with simple type discretization in mostaghimi et al 2012b in linden et al 2015 a stokes solver based on the clustering of variables is considered where the systems are solved using the block gauss seidel algorithm as an iterative solver in this paper our attention is on performance and modern computational architectures in order to achieve maximum performance one should select a target hardware computational architecture among other things in this research we are focusing our attention on the graphics processing unit gpu as the main computational unit the development of efficient general purpose gpus has been boosted in recent years by the progress in machine learning and neural networks as a result modern gpus are efficient in terms of floating point operations per consumed energy unit green top 500 per occupied space and per cost of the hardware however gpus have one substantial weakness low device memory capacity compared to the on board cpu random access memory ram in this case construction of coupled stationary solvers which need much more memory than explicit methods storage of the operator matrix preconditioning matrices etc requires a careful selection of the discretization method as well as the solution method since the domain information in porous media can be directly provided by the segmented x ray computed tomography xct images as bit arrays of voxels cnudde and boone 2013b hampel 2015 we intend to exploit this situation and use the simplest finite difference second order approximation harlow and welch 1965 since the underlying grid is structured and orthogonal this approximation while relatively accurate allows us to decrease the sizes of the matrices and potentially maximize the size of the problem under consideration in addition it is possible for some domains to have a union of fluid voxels voxels that share the same bit information corresponding to the void volumes inside a sample that form separate volumes with no flow through boundaries to avoid solving systems with such isolated volumes topological analysis is needed on the provided domain to remove such disconnections all these methods including domain analysis needs to be solved on a gpu in order to maximize the efficiency the aim of our study was to develop a robust and computationally efficient stokes solver for gpu architecture the paper is laid out as follows first the description of the problem is considered next the topological domain analysis and discretization are discussed where each method is supplied with algorithms that are adopted for the gpu computational architecture the approximation of the continuous operator is discussed where details are given for different combinations of boundary conditions including internal solid voxels this part also discusses features of the main coupled system matrix formulation in parallel on the gpu after that the method of the system solution is described the regularization of the residual is provided in full detail including parallel algorithms the next section contains the results of different tests the first part deals with analytical tests such tests that have analytical solutions where the order of approximation is analyzed experimentally and the efficiency of the solver is shown in computational wall time the next part is dealing with the variety of tests on sphere packings which are taken from gerke et al 2018 some comparison with exact data is performed and the efficiency of the method is analyzed the third part of the tests is performed for permeability calculation on stochastically generated domains a successive set of increasing domains with pre defined permeability is supplied to the solver the resulting estimation of permeability allows us to establish the process of convergence towards the pre defined expected permeability value wall time efficiency is analyzed in these tests and the results are compared to the lbm gpu method finally some real tests from other papers are simulated and compared to known results available in the literature the paper is finalized with discussion summary and outlook 2 analysis numerical method the computational domain ω r 3 is assumed to be formed by the union of hexahedrons with piecewise smooth external boundaries δ ω its normal unit vectors n to the boundaries are collinear with the standard unit vectors in the direction of the x y and z axes of a three dimensional cartesian coordinate system if not this can always be corrected by introducing an affine orthogonal transformation the domain is represented by the union of 3d voxels f i 1 n w i each voxel is equipped with a boolean value 0 or 1 for one value the voxel is a fluid or pore voxel that permits a flow and for the other the voxel is a solid voxel where no flow occurs voxel size is constant in each direction such a setup is common for the digital representation of the 3d xct binarized images the nondimentionalized stokes problem in the domain ω r 3 with external boundaries δ ω is described by the following system of equations 1 v p f v 0 with the combination of the following set of boundary conditions velocity dirichlet boundary conditions 2 v δ ω d v d pressure dirichlet boundary conditions 3 v n δ ω n 0 p δ ω n g periodic boundary conditions 4 v δ ω p 1 v δ ω p 2 p δ ω p 1 p δ ω p 2 where δ ω p 2 is an opposite boundary to the boundary δ ω p 1 opposite is in terms of affine mapping in orthogonal directions the vector function v is commonly referred to as velocity scalar function p as pressure which is also a lagrange multiplier for the divergence free condition known vector function in the right hand side f as the source term and vector n represents the outward normal unit vector on the boundary we define external and internal boundaries external boundary conditions are given as the combination of 2 3 and 4 on the boundary planes of the hexahedron domain external boundary the dirichlet velocity boundary condition is set by the known vector function v d and the dirichlet pressure boundary condition is set by the known scalar function g the construction of the internal boundary is formed as follows each pair of voxels that share a common face but with different boolean values forms a local internal boundary an internal boundary is formed as a union of all local internal boundaries such boundary is a piecewise smooth lipschitz surface inside a hexahedron domain internal boundary on which the boundary condition 2 with v d 0 is set we are interested in finding a sufficiently smooth numerical solution v p of the system 1 for the provided domain ω with internal and external boundaries 2 1 domain discretization and analysis for the real xct images the domain ω may contain isolated volumes which are not connected to the main flow domain these isolated volumes while absolutely valid contribute no valuable information to the solution it is a common practice to apply explicit khirevich et al 2015 gerke et al 2018 or implicit bird et al 2014 numerical methods that have a temporal derivative in 1 to the provided domain as it is the isolated volumes do not degenerate the solution in any way they only occupy additional memory on the other hand the solution of the stationary problem as it is formulated in 1 will cause convergence problems for iterative methods that solve the discrete linear system indeed for each isolated volume a problem with pure dirichlet boundary conditions is posed so the pressure is defined up to a constant hence each isolated volume would contribute a basis vector to the null space of the linear operator hence the degeneration of the system increases with each volume added that way if one uses simple family approximation then this problem is regularized during the formulation of the approximate system on the mass conservation operator see mostaghimi et al 2012b but the overall accuracy exhibits only first order convergence in l 2 norm the usage of the full coupled system on the discrete level that is the second order in l 2 norm will lead to the poor convergence for the large null space hence it is beneficial to remove these isolated volumes from the domain prior to the discrete system formulation for this reason we perform a topological analysis of the domain during this analysis we detect isolated volumes and convert fluid voxels within them to solid voxels we also identify independent not connected flow channels for further processing the analysis is based on the connected component labeling ccl approach the connected components depend on the external boundary conditions that are used in the problem setup and on the connectivity pattern that is defined by the discrete operator stencil in the case of the chosen discretization it is a connection between voxels through a common plane i e a 6 point connectivity since the whole idea of the method is to solve the problem as fast as possible the ccl should be executed in parallel on a gpu the core algorithm for the ccl is chosen from the paper playne and hawick 2018 by playne and hawick this is one of the most efficient gpu based algorithms for ccl it identifies and eliminates redundant operations in the previous methods for gpu for rectilinear two and three dimensional datasets however the method requires clamped boundary conditions in all planes of a hexahedron it is based on labeling each voxel depending on its coordinates and its neighbors if the neighboring component has the same type as the central voxel then the label is set to the coordinate of the neighbor if not then the actual coordinates of the central voxel are set after that the algorithm relabels all components that have labels that are not equal to the central hence it finds the boundary where the type of voxels changed for more details see playne and hawick 2018 it is a very efficient algorithm but it has some drawbacks namely the application of this algorithm to the domains with some or all periodically associated external boundaries is impossible if no other type of voxel were present in some orthogonal section the algorithm would halt hence the domain analysis is performed depending on the external boundary conditions under consideration we are considering three possible situations the main algorithm 1 is used in all cases of external boundary conditions first the ccl is applied which generates the colored domain such that each connected component set has a unique color and the set of solid voxels has a unique color of 0 at this stage particular boundary conditions periodic association are not taken into account the data from ccl algorithm is used to construct the dictionary of colors using a parallel version of exclusive scan operation on the gpu this allows us to make the coloring index contiguous since the initial coloring returned by ccl algorithm in general case is not contiguous next the color dictionary is modified depending on the boundary conditions periodic association if exists after this step the colors with a value greater than 0 represent the set of fluid voxels that permit the flow w r t the provided geometry boundary conditions and used connectivity finally the colored domain and the original domain are modified to meet these requirements the new set of voxels is formulated and the colored domain c and a new corrected domain ω are returned the whole algorithm poses no problems with parallel implementation on a gpu the application of the algorithm is justified by the following proposition 1 the solution of 1 with a uniform constant source term for any subdomain with only zero velocity dirichlet boundary conditions 2 is trivial with zero uniform velocity proof by the construction of the ccl algorithm one finds isolated volumes as such that have no distinct color on the external boundaries of the domain or have only zero dirichlet velocity boundary conditions on all its external boundaries such isolated volumes have a piecewise smooth boundary constructed by the union of the set of internal boundary voxels and external boundaries if any let us consider a single isolated volume v 0 for 1 with uniform boundary conditions 2 where v d 0 on the piecewise smooth boundary in this case it is easy to show that the trivial solution 0 p is the unique solution of 1 where p is some linear function since the source term is uniform constant that satisfies p f without the loss of generality we assume that v 0 p x d x 0 we prove this fact as follows let f c x c y c z t where c α are constants then one can introduce a scalar potential φ c x x c y y c z z and f φ following temam 1984 see page 28 consider the hilbert space of compactly supported divergence free vector functions on the isolated volume that are closed in h 0 1 and from a complete space v u h 0 1 v 0 div u 0 a standard inner product of vector functions is defined as u v v 0 j 1 3 u j x v j x d x and for scalar functions f g is defined as f g v 0 f x g x d x an inner product of two gradients of some vector functions is defined as again see temam 1984 u v j 1 3 k 1 3 j u k j v k where j are the components of a differential operator in a canonical cartesian basis the problem for 1 with uniform zero boundary conditions 2 is solved by finding a unique pair of smooth functions v p that satisfy the system of eqs 1 applying inner product of 1 with any function u v one obtains v p f u 0 since the domain v 0 is piecewise smooth we can perform integration by parts v u f u u v where surface integrals are zero since u δ v 0 0 a e and pressure integral is zero since u 0 analogous to temam 1984 see page 32 one needs to find a smooth v v such that v u f u u v thus formulating a variational form of the problem the term on the right hand side can be considered as f u φ u φ u 0 u v where surface integral is also zero since u δ v 0 0 a e hence 5 v u 0 u v finally we show that the last statement only possible for v 0 let us define a functional for the inner product in h 0 1 u v u v u v u one needs to show that u v u 0 u v the second part of the sum is zero by 5 using cauchy schwarz and poincare inequalities we obtain v u c 1 v l 2 u l 2 c 2 v l 2 u l 2 0 u v by using v l 2 0 from 5 the proposition is valid since the space v is complete the pressure is explicitly defined as p x φ x mes v 0 1 v 0 φ x d x the proof of the fact that the found solution is also a smooth solution of the original problem is based on the completeness of the divergence free space v this is the unique solution 0 p to the stokes problem in v 0 the result of this proposition allows one to exclude all isolated volumes that have only uniform zero velocity dirichlet boundary conditions from consideration 2 1 1 non periodic boundary conditions this set of boundary conditions always has an inflow and an outflow external boundaries defined by either 2 or 3 all other external boundaries are set by zero dirichlet velocity boundary conditions 2 with v d 0 in this case the algorithm 1 does not require the call to additional functions the steps on lines 7 11 perform the following operations 1 c u c b 1 c b 2 c b 2 c b 1 2 c c u d c 0 as the result all such colors that are not shared by inflow and outflow boundaries b 1 and b 2 are excluded from the consideration and replaced by the solid voxels due to proposition 1 2 1 2 partially periodic boundary conditions in this case the flow can be driven by either dirichlet boundaries 2 or 3 or by the external force that is set by the source term f in 1 in both cases we have a partial periodic association of boundaries in this case the main algorithm 1 calls the function provided in the algorithm 2 the algorithm 2 also has no serial bottlenecks and can be executed in parallel on each step it associates the colors of two opposite planes under the periodicity assumption at first the dictionary of periodically associated colors is identified lines 5 10 for p x then the associated dictionary is used to modify the original dictionary lines 13 16 which is later used by the main algorithm 1 to correct the domain during this step any color that is connected to the solid voxels on the other side is not modified see line 6 2 1 3 fully periodic boundary conditions in this case the flow is driven by the external force that is set by the source term f with uniform constant components it is a more complicated case than the other two the problem is in the correct identification of the periodic channels that are formed by the pore voxels where the flow is possible using proposition 1 it is necessary to identify isolated volumes under the assumption of periodic connectivity of opposite external boundaries remark 1 we do not state that the channels where the flow is possible will guarantee a non zero velocity the simplest example is the channel in the form of an x shape and the external force term that has a nonzero component in the horizontal direction and other components are zero due to the symmetry the solution will have a zero velocity in this channel the elimination of isolated volumes for this topology will serve as an optimization of memory and the number of operations each channel is formed by the union of voxels which has a unique nonzero color generated by the ccl process let the set of colors in the domain be designated as c i e each voxel w j f in the domain has a color c j c each external boundary plane is designated as b j and color c c that has a voxel w k w k ω 0 such that n ω e j 0 is designated as c b j definition 1 let the set of fluid voxels f has the same color c a pass through channel g is defined as a union of voxels with the same color c i e g w j w j f such that c b k c b l 0 for at least one combination k 1 6 l 1 6 and k l definition 2 let the set of fluid voxels f has the same color c a locked channel h is defined as a union of voxels with the same color c h w j w j f such that c b k c b l 0 for all combinations k 1 6 l 1 6 k l and c b k 0 the union of all through flow channels is designated as g the union of all blocked channel is designated as h proposition 2 the solution of 1 in any channel that is not from g and h is trivial with zero uniform velocity proof by definitions 1 2 we can conclude that the set of channels which is not in g and h is the set of channels which have no connection with the external boundary surface of ω hence these channels form isolated volumes therefore by proposition 1 the solution of 1 in such channels is trivial one needs to consider only channels from g and h the periodic association of two external opposite boundary planes b 1 and b 2 is understood in terms of an affine mapping of b 2 to b 1 and determination of voxel colors that are directly connected through one of the voxel surfaces after the affine mapping each channel from g or h can be connected to either one or more channels or can become locked by the solid voxels on the overlapped plane if the channel becomes blocked then it is a channel that contains an isolated volume and by proposition 1 all voxels in the channel can be marked as solid voxels by the periodic association a channel from h can be blocked connected to another channels from h connected to channels from g or connected to another channels from h and g in the first case the channel becomes an isolated volume that by proposition 1 has only a zero velocity solution in the second case the channel is connected only to other locked channels and those channels from a single isolated volume again a zero velocity solution is guaranteed by proposition 1 if a channel from h is connected to a channel from g then it can be used to interconnect two channels from g by a transitive relation the same situation may take place if a channel from h is connected to several channels from h and g in two later cases the flow is possible but not guaranteed see remark 1 so the last two cases are valid cases for the fully periodic boundary association hence we have proven two following proposition 3 the solution of 1 in any channel from h that is not connected to a channel from g is trivial with zero uniform velocity proposition 4 the solution of 1 in any channel from g that is locked by the periodic association not connected to any channels from g and h is trivial with zero uniform velocity all voxels in channels that fall into the category in propositions 1 2 3 and 4 can be marked as solid in the algorithm 1 at line 7 the algorithm for pure periodic association coloring is similar to the algorithm 2 the domain ω being modified by the algorithm 2 to eliminate isolated volumes can be used to perform discretization the set of colors c is also returned by the algorithm that can be used at the solution stage implementation of the algorithms for the gpu version is based on cuda kernels and thrust cuda c template library functions for unique set symm diff and exclusive scan on modern hardware such an approach results in a fast execution time of approximately 120 150 ms for the domain size of 100 0 3 voxels 2 2 approximation stokes problem approximation should comply with ladyzhenskaya babuška brezzi lbb condition if no artificial stabilization is used the simplest lbb stable staggered finite difference approximation is used harlow and welch 1965 which is reformulated for the conditions of the admissible internal boundary the choice of this scheme is dictated by the desire to minimize the memory footprint which is a scarce resource on gpus and obtain second order convergence a cartesian main uniform grid of n n x n y n z elements is introduced with j 0 n x 1 k 0 n y 1 l 0 n z 1 indexes for x y z directions respectively hence each voxel w i can be indexed by the main grid due to the usage of the staggered grid one needs to introduce additional grids for velocity and gradient components in x y z directions depending on the component of the velocity and boundary conditions in this case the grid can be extended to one element when the cartesian direction vector coincides with the discrete operator component direction in this case the discretization is called leading direction discretization for example x component velocity grid for non periodic boundary conditions has indexes j 0 n x k 0 n y 1 l 0 n z 1 the discretization is called tangential direction discretization when the cartesian direction does not coincide with the discrete operator component direction an element cell is identified with the negative half step i e a staggered cell s has indexes for v x s v x j 1 2 k l for v y s v y j k 1 2 l for v z s v z j k l 1 2 and for p s p j k l shifting a cell in the orthogonal direction is designated as s α 1 and is individual for each variable e g v x s x 1 v x j 1 2 k l v y s x 1 v y j 1 k 1 2 l v z s x 1 v z j 1 k l 1 2 and p s x 1 p j 1 k l p s y 1 p j k 1 l p s z 1 p j k l 1 all voxels have the same length in each direction h α α x y z which is common for data obtained from xct scans for the cell with a fluid voxel s that also has all neighboring fluid cells and smooth functions the approximation is formulated in the standard form for the staggered discretization the discrete stokes operator is obtained by the expansion near the center of velocity elements and due to the staggered location all approximations are second order accurate 6 v α s α x y z h α 2 v α s α 1 2 v α s v α s α 1 o h α 2 p s h x 1 p s p s x 1 o h x 2 h y 1 p s p s y 1 o h y 2 h z 1 p s p s z 1 o h z 2 discrete divergence operator is obtained by expanding smooth functions near the center of s relative to the pressure discretization hence these expansions are also second order accurate 7 v s α x y z h α 1 v α s α 1 v α s o h α 2 next we consider the discretization of boundary conditions first we consider periodic boundary conditions 4 let the periodically associated boundary surfaces be designated as b 0 and b 1 for the leading direction α discretization near the cell s b 0 is associated with the cell s b 1 and the latter is excluded from the discrete system hence the velocity grid indexes for the leading periodic direction are changed to j 0 n x 1 k 0 n y 1 l 0 n z 1 the association is performed by replacing appropriate indexes in 6 and 7 for neighboring cells s α 1 with the substitution of s 0 b 0 instead of s n α b 1 which is no longer available in discrete form for the laplace and divergence discrete operators the gradient operator on the main grid is discretized near the periodic boundary by a simple substitution of s n α 1 b 1 instead of s 1 b 0 the tangential direction discretization β in case of a periodic boundary condition is performed for the laplace operator only by simple substitutions s n β 1 b 1 instead of s 1 b 0 and s 0 b 0 instead of s n β b 1 another types of external and internal boundary conditions require some work to maintain uniform second order approximation for visibility and clarity we demonstrate only a 2d case a 2d staggered grid to simplify description is shown in fig 1 but it can be easily extended to a 3d problem since the directions are orthogonal each vector component for velocity and pressure gradient operators within the 3d grid contains one leading direction and two tangential directions velocity and pressure gradient indexes are shifted by 1 2 step but numbered using integers as it is done in actual implementation shifted velocity cell indexes are displayed in red while main cell indexes indices for voxels pressure and velocity in the tangential direction are displayed in black fig 1 for example index for the pressure cell 1 in α direction is displayed in black and appropriate velocity index in α direction that has index 1 1 2 is designated as 1 in red in the similar fashion velocity indexes in tangential direction β are given as blue indexes in integer values all cells that coincide with the solid voxels are removed from the discrete system thus decreasing the memory footprint let us start from the dirichlet velocity boundary conditions eq 2 in this case the pressure is not set hence the gradient operator will have no entries in α direction at points 0 0 2 3 3 2 4 1 and in β direction at points 1 1 1 2 1 3 1 4 for internal boundaries for external boundaries the gradient operator has no entries in α direction at points 0 velocity is approximated as follows first we consider conditions on the internal boundary for the leading direction α the velocity value is set to the value on the boundary e g at points and this value is inserted into the discrete laplace operator for example for the external boundary the values of velocities i e at line is set explicitly to the prescribed value the divergence operator remains unchanged now consider the approximation of the discrete laplace operator elements in the tangential direction β several typical cases should be considered each case is deduced by expanding the smooth velocity function near the boundary point and equating the first and third derivative coefficients to zero by solving a linear system the location of the zero velocity in a cell in the tangential direction is indicated by blue squares in fig 1 consider all cases by example the first case is the line the boundary value is set at point the second partial derivative at point is approximated as the same is true for line except it requires two special treatments near cells and which are mirrored the second case is the line the second order second partial derivative at cell is found as the third case is presented at the line the second order second partial derivative at cell is found as each of these cases can be extended to the external dirichlet boundary conditions e g like a value in point in these cases velocity values are set explicitly in the case of internal boundary conditions the velocity values at the blue squares are set to zero in the formulas provided above the next to consider is the pressure dirichlet boundary conditions eq 3 on external boundaries the pressure value is set on the external boundary e g at line for the α direction in this case the pressure is found using constant extrapolation e g at cell the second order is achieved due to symmetry the divergence operator remains unchanged discrete laplace operator is modified depending on the leading or tangential direction of discretization for the leading direction discretization e g at cell the discretization of the velocity derivative in a normal direction is symmetric relative to the middle point it is true if the function can be smoothly extended beyond the boundary otherwise the formula presents the first order approximation hence for the case when the solid voxel is close to the boundary cell at the approximation cannot be derived and the no flow condition is set for the tangential direction e g at point one obtains again second order accuracy is achieved if the function can be smoothly extended beyond the boundary if the solid voxel is close to the boundary cell at the approximation in the β direction is changed to this concludes the consideration of all boundary conditions 2 3 assembly of the main linear system having introduced discretization one needs to assemble the main linear system of algebraic equations which is a discrete representation of the linear operator eq 1 with imposed boundary conditions the matrix of the linear operator may have structured zeros and in order to save memory it is assembled in a compressed row storage crs or yale format while this procedure is trivial for the serial approach with no solid cells a parallel gpu optimized algorithm with solid cells requires some elaboration first the calculation of lexicographic indexes is performed separately for each variable due to the staggered grid topology and random location of solid voxels see algorithm 4 for each variable one needs to execute a parallel kernel in algorithm 3 that assembles indexes then an inclusive scan is executed and total number of entries are obtained for each variable which are stored in start index array next the same kernel is called to set these indexes and exclude solid voxels finally assembled indexes and the number of elements are returned the next step is to construct the matrix itself in full compliance with the continuous operator the matrix can be split to matrices of the laplace operator a r n v n v gradient operator b t r n v n p and divergence operator b r n p n v here n p start index 3 start index 2 n v start index 2 the system eq 1 is formulated in the discrete form as 8 a x b a b t b 0 u p f 0 although the main system can be written as 2 2 block system the actual formulation of the whole matrix a requires different indexing in crs format for different matrices in the system each matrix is constructed in two passes see algorithm 5 for an example the algorithm 5 accepts the stencil function that is responsible for setting correct nodes and correct weights depending on the neighbor voxels in the stencil and boundary conditions line 5 all described in section 2 2 for the gpu implementation of the stencil function it is a device method that returns appropriate index values for the points in the stencil and weights for each point that is set in the stencil in addition it returns the weight that is used on the right hand side generated by discrete boundary conditions the crs matrix assembly starts by calling the assembly process that is demonstrated by the algorithm 5 with run rows true and allocated array r o w p t r s of size start index 2 1 for this example this will set the number of elements in each row of the matrix in parallel lines 7 10 in the algorithm then exclusive scan is executed over the r o w p t r s array that will fill the array with the correct indexes of rows in the crs format the scan will also return the total number of non zero elements in the matrix finally the assembly algorithm demonstrated by algorithm 5 is called again in parallel with run rows false arrays of column indexes and values c o l s v a l s and vector r h s of the discrete right hand side f arrays of column indexes and values have sizes equal to the number of non zero elements in the matrix the vector r h s has the same size as the matrix s total number of rows i e start index 3 the algorithm fills the right hand side vector and local arrays c and v lines 12 20 then sorts them and stores results in the provided arrays depending on the whole system formulation type formulating coupled matrix a or three different matrices a b t and b matrix indexes of rows and columns for gradient and divergence operators should be modified while executing algorithm 5 on the second run for the assembly of the b t matrix it is necessary to modify column indexes by removing indexes of the a matrix for the assembly of the b matrix it is necessary to modify row indexes by removing those of the a matrix the implementation of the gpu version is based on the cuda kernels being executed for each parfor segment of the algorithms all scan operations are performed using thrust c library s functions such approach is very efficient and is capable of assembling a matrix over 100 0 3 voxels in less than 100 ms on modern gpus 2 4 solution of the linear system the formulated problem eq 8 despite being linear is relatively hard to compute the solution pair v p of eq 1 is not the minimizer of a quadratic functional as it would be for the case of an elliptic type pde but of a saddle point the pressure function can be considered as the lagrange multiplier for the original diffusive system being subject to an incompressibility constraint the solution pair u p of the linear system in eq 8 has the same property of the saddle point problem the problem is usually large and beyond the limit of an exact solution hence iterative methods must be used in this paper we used amgcl library demidov et al 2021 but with modifications that are targeted gpu only architecture for better performance on gpus the analysis of the modification and performance is discussed in evstigneev 2022 we used the generalized minimal residual gmres method with the left preconditioner 9 p 1 a x p 1 b where p is the block preconditioning matrix for the matrix a it is shown in evstigneev 2022 that one of the most efficient preconditioners is the block triangular preconditioner which is formulated as 10 p 1 a b t 0 s ˆ 1 a 1 a 1 b t s ˆ 1 0 s ˆ 1 a 1 0 0 e e b t 0 e e 0 0 s ˆ 1 it is applied as the composition of matrix multiplications here e is the identity matrix and s ˆ is the approximation of the pressure schur complement matrix s b a 1 b t it is easy to show that if the schur complement matrix is exactly factored then the preconditioner is exactly the inverse of the a matrix but the construction of the matrix s is expensive let alone its inverse so its inverse is usually replaced with a suitable approximation in evstigneev 2022 we demonstrated that a good choice for the matrix generated by the considered approximation is the usage of a weighted bfbt preconditioner of elman et al 2006 11 s ˆ 1 b b t 1 b a b t b b t 1 we used the version where the matrices are scaled by the diagonal in accordance with may and moresi 2008 this scaling slightly increases the convergence speed the preconditioning procedure is implemented in a modified version of the amgcl library the application of the preconditioner is prepared before the iterative procedure takes place as follows first the operator matrices a b and b t are extracted from the coupled matrix a then the amg hierarchy is formulated using the misk smooth aggregation variant described at ryabkov 2022 for matrix a and matrix b b t then the smoothers for each amg level are constructed the best results are obtained by using the ilu 0 smoother on each level let r n b a x n r δ u δ p t be the residual vector returned from the gmres at some iteration n the application of the preconditioner is described in the algorithm 6 after the domain analysis the set of colors c is generated where each color value corresponds to a separate flow channel another difficulty is the null space of a that depends on the external and internal boundary conditions if the problem is discretized with pressure dirichlet boundary conditions as in eq 3 then after the domain analysis only valid channels remain in terms of permissible flow and the matrix a is well defined if the velocity dirichlet boundary conditions are set in the whole domain as in eq 2 the pressure is defined up to an arbitrary constant this case poses no problems for the gmres method if the null space has a dimension of one however as the number of independent channels increases the dimension of the null space also increases since pressure in each channel is defined up to an arbitrary constant the same is true for the fully periodic boundary conditions as described by eq 4 in this case special care should be taken in order to maintain the fast convergence of the method to compensate for rounding off errors the algorithm 7 which is called in line 9 of the algorithm 6 is used to shift the pressure residual in each channel in such a way that the mean value of the residual in each channel is zero for the case when bound t is true remark 2 if one considers pure periodic boundary conditions with no solid voxels then the situation is slightly different the null space of pressure has a dimension one but the null space of velocity is no longer trivial which would be regularized by the internal boundary condition if the domain had solid voxels and is null a span 1 1 n u x 0 0 n u y n u z t 0 0 n u x 1 1 n u y 0 0 n u z t 0 0 n u x n u y 1 1 n u z t in this case the velocity residual should be regularized for each basis vector by fixing an arbitrary constant this should be done with the accordance to the image of the linear operator f this problem is implicitly solved in the taylor green vortex test cases see section 3 1 and is not discussed here in more detail the first procedure in the algorithm 7 is the preparation of the key value arrays necessary to perform efficient parallel operations it calculates the key value pair for the pressure residual vector in parallel from the pressure indexing array and domain coloring next the keys and values are sorted in parallel by sort by key and at last the total number of elements for each color is obtained by calling sum reduce by key all this is done in parallel on the gpu using the thrust cuda c library after each invocation of the preconditioner the function shift residual is called it stores the residual values in permuted order in accordance with the sorted values next the sum of each color value is calculated by calling sum reduce by key at line 7 of the algorithm 7 finally the obtained sum is applied to the original residual vector to shift it in such a way that it is zero in each channel up to the floating point precision these steps are performed in parallel on a gpu by using cuda kernels and thrust cuda c library functions 3 validation and numerical results all calculations are performed on the following hardware the cpu is intel xeon gold 6248r gpu is nvidia tesla v100 with 32 gb of device ram the linear solver s relative residual threshold termination value is set to 1 0 1 0 6 for single and 1 0 1 0 11 for double floating point precision the averaged quantities e g velocity are calculated with high order cubature formula using tri quadratic interpolation 3 1 validation on analytical tests convergence this section contains the set of tests that are aimed at convergence analysis double floating point precision is used the results are provided in l 2 and l norms as functions of the number of discrete points in a single essential direction to estimate the first norm a high order quadrature formula was used for the integral in order to avoid introducing additional errors in the estimation of the norms for the l norm a tri quadratic interpolation was used we designate l 2 v as the norm for the velocity error and l 2 p as the norm for the pressure error all tests where a dominant direction can be chosen are executed by changing this dominant direction along all basis vectors the first test is the solution of the plane poiseuille flow problem which is driven by either a pressure gradient or a constant external force in a single direction the plane parallel flow is achieved by setting periodic boundary conditions in one of two directions the solution is a second order polynomial for velocity and a first order polynomial for pressure it is expected to obtain an exact solution up to the base floating point type precision error since a parabola can be constructed using at least three points the results are provided in fig 2 the next two test cases are the poiseuille flow problem in rectangular channel of height 0 y h and width 0 z l driven by the pressure gradient or forcing term p δ this problem has the following analytical solution proudman 1914 presented by fast converging series in terms n u y z p δ 2 y h y 4 p δ h 2 π 3 n 1 1 2 n 1 3 sinh β n z sinh β n l z sinh β n l sin β n y β n 2 n 1 π h in these tests we used 50 terms of the series that allowed us to obtain an error rate twice that of the double floating point precision the pressure term is also linear for this problem with respect to the flow direction two cases are considered the first case is the standard domain with no solid voxels the second case is the domain that is covered by one layer of solid voxels adjacent to the boundary planes in the tangential direction this allows one to check the convergence order in channels that are formed by the solid voxels and serves as an integral test case for software development the results are provided in figs 3 and 4 one can observe the second order convergence for both test cases it is important to obtain second order convergence for the case with solid voxels the second order asymptotic would not be obtained for the case when the velocity derivatives near solid voxels in tangential directions are approximated with the first order as it is usually done e g mostaghimi et al 2012b the pressure distribution is exact as expected these results were obtained for aspect ratios of h l 1 1 1 5 1 10 two well known manufactured solutions are used as the next two test cases the first one is the test case for the circular flow problem from rhebergen and wells 2020 section 4 5 on a unit cube with non homogeneous dirichlet velocity boundary conditions the analytical solution is given as u x x y z π sin π x cos π y π sin π x cos π z u y x y z π sin π y cos π z π sin π y cos π x u z x y z π sin π z cos π x π sin π z cos π y p x y z sin π x sin π y sin π z 8 π 3 the forcing term is set as the residual when the proposed solution is substituted into eq 1 it is easy to show that the mean value of the pressure field is zero the results are provided in fig 5 one can observe that while the numerical solution for the velocity is obtained with the second order convergence the numerical solution for the pressure has a lower approximation order in l norm see fig 5 right upper crosses this demonstrates the importance of residual regularization for pure neumann pressure boundary conditions the difference on the boundary was enough to pollute the numerical solution because of the use of the preconditioner the second order convergence in pressure is restored when the pressure residual regularization is used mean value in the domain is zero the final test case is the pure periodic taylor green vortex solution taylor and green 1937 in unit cube which is given in particular by the analytical solution u x x y z 2 cos 2 π x sin 2 π y sin 2 π z u y x y z sin 2 π x cos 2 π y sin 2 π z u z x y z sin 2 π x sin 2 π y cos 2 π z p x y z 6 π sin 2 π x sin 2 π y sin 2 π z the forcing term residual is nonzero only in x direction f x x y z 36 π 2 cos 2 π x sin 2 π y sin 2 π z again dominant directions x y z are shifted as the test case is executed the results are presented in fig 6 each point presented in fig 6 in fact has three overlapping points for dominant x y or z directions in all cases we observe second order convergence the residual regularization was used see remark 2 the wall time of each test execution and the convergence are presented in fig 7 in all cases the variable problem size is the number of rows or columns of the coupled system matrix almost perfect linear scaling of wall time for all test cases is observed an interesting observation here is the unexpected twofold decrease in execution time for the single floating point test compared to the double floating point test while computational time should have decreased by the gpu 1 3 multiplier and lesser set convergence threshold value we assume that it is due to the decrease in precision in reduction type operations this requires further investigation with the help of the compensated algorithms e g evstigneev et al 2022 for the reference to the old hardware we compare the wall time on several old gpus available to authors namely nvidia geforce titan black with 6 gb of ram and nvidia geforce titan x with 12 gb of ram we selected the poiseuille 3d flow problem as a benchmark the results for single and double precision are presented in fig 8 maximum acceleration in double precision of v100 vs titan black is 2 7 times and v100 vs titian x is 10 7 maximum acceleration in single precision of v100 vs titan black is 3 6 times and v100 vs titian x is 2 2 a theoretical ratio of peak double precision performance of v100 vs titan black is 2 5 and v100 vs titan x is 19 8 peak single precision of v100 vs titan black is 3 7 and v100 vs titan x is 1 3 taken from https www techpowerup com the results correlate with the peak performance well additional acceleration is achieved for v100 gpu because software for old gpus is configured under cuda 10 2 the latest supported version with sparse matrix and vector operations are performed using cusparse library but for v100 gpu a new cuda 11 5 is used and more efficient low level speck library parger et al 2020 is applied to sparse matrix and vector operations for more information on optimizations see evstigneev 2022 3 2 flow in simplified porous media validation on sphere packings this test case is inspired by papers khirevich et al 2015 gerke et al 2018 and can be used as the qualitative test case for the flows in porous media this test case and dataset were designed to fit two relaxation and multi relaxation lbm schemes to such geometry where solid bodies are represented by possibly overlapping spheres which have piecewise constant surface approximation analogous to the xct images containing rectangular voxels the domain is assumed to be periodic examples from the dataset are provided in figs 9 11 the porosity in all datasets is calculated as the ratio of fluid voxel numbers to the total number of all voxels each sphere has an underlying spherical diameter given in voxel units and designated as d v o x analogous to gerke et al 2018 note that spheres can have non integer discretization khirevich et al 2015 there are three types of sphere packing layouts available in the publicly available dataset gerke et al 2018 depending on the location of the enclosing cube simple cubic sc fig 9 body centered cubic bcc fig 10 face centered cubic fcc fig 11 two latter types are additionally separated into touching spheres with less porosity in each case and loosely packed spheres with higher porosity the first one is defined by the array of spheres where each sphere is intersected by all its neighbors by a point i e touching the second one is defined by spheres that have a gap between neighbors see figs 10 and 11 right and left for comparison the formula that allows one to estimate the drag force for each layout for a sphere is available in gerke et al 2018 appendix d formula 30 and table d1 and we refer the reader to the cited paper the results of all simulations for the sphere packings are provided in fig 12 13 14 where a relative difference between formula calculated and numerically calculated permeability for spheres is provided and an example of the flow velocity is shown for these simulations fully periodic boundary conditions were used as is necessary to obtain the analytical solutions the obtained results are very close to those that are provided in gerke et al 2018 for the explicit artificial compressibility method fdmss calculated permeability tensors are perfectly diagonal with the same permeability in each orthogonal direction in all studied cases we observed that the permeability of the sphere packing differs from the permeability of the provided reference solution for the sc case the first order convergence towards the baseline formula for the sphere is obtained fig 12 left the convergence order is optimal for the provided discretization piecewise constant boundary approximation such that each spherical element is replaced by a voxel with sides that have normal vectors collinear with canonical cartesian directions of the convex second order surface results in the first order convergence for the bcc fig 13 left and fcc fig 14 left cases one can observe the first order convergence but with worse constants for the loose packing and convergence order degradation for the touching packing the first order convergence is again justified by the approximated geometry while the constant is worsened because the width of the channels between the spheres is decreased see flow velocities in fig 13 14 right therefore the approximation tends to degrade but since the original geometry of the spheres approximates the analytical spheres only piecewise constantly the convergence of the second order for the flow restores the incline on the other hand the bcc and fcc cases for the touching spheres show substantial differences this is because the spheres in these cases no longer approximate analytical spheres indeed the layout was designed to be used for the test of lbm methods where a fitting parameter exists that modifies the approximation of the strain rate tensor see khirevich and patzek 2018 as a result a partial slip condition can be restored on the boundary of the spheres providing more flexibility of tuning towards spherical solutions in addition lbm provides mass and momentum transfer in diagonal directions combining these two facts lbm allows one to adjust the approximation to the geometry if the latter is known in the first place classical cfd methods assume on the other hand that the voxels represent sufficient information about the boundary and treat boundary as is this explains the different convergence rates between the flow around the discretized and analytical spheres one must take a spatial care if the flow is assumed to be around convex smooth boundaries for example implement immersed boundary methods see le et al 2009 the analysis of convergence and execution wall time is presented next the whole set of test cases contained 75 samples 30 of which were test cases on grids with 10 0 3 and the rest were on the grids 30 1 3 voxels each case in the dataset was executed three times to obtain all permeability tensor components the whole dataset was tested in 1036 s averaged of 10 executions using single precision calculations the results are provided in fig 15 a spread in wall times against the reference data from the 3d poiseuille test problem indicates that the amg hierarchies are not constructed well in such a way that the high frequency eigenfunctions of the residual are damped in the multigrid process this is partially confirmed by the provided convergence analysis in fig 15 right where the best iteration count is 25 and the worst is 40 for larger test cases however the asymptotic is still linear as can be seen by considering the provided reference from the 3d poiseuille flow test case all small test cases 10 0 3 voxels in volume converged in 15 20 iterations and took less than 4 s 3 3 stochastic reconstruction with designed permeability in this subsection the flow in an artificially constructed porous medium is considered the computational domain is obtained using the stochastic reconstruction technique gerke et al 2014 with analytically chosen correlation functions jiao et al 2007 karsanina et al 2015 the domain is constructed in such a way that the expected permeability is around 1200 md under zero dirichlet velocity boundary conditions in the tangential directions to the flow the original domain size is 70 0 3 it is expected to obtain relatively close permeability with the sequential increase of the domain size the quality of the design is tested with the help of fdmss gerke et al 2018 pore network computations gerke et al 2020 and direct solver balashov et al 2020 the results are provided in fig 16 for the zero dirichlet velocity boundary conditions and in fig 17 for periodic boundary conditions one can observe that the relative difference between simulated and expected permeabilities behaves as expected and reaches a minimum error for the zero velocity dirichlet boundary conditions in fig 16 left on the other hand the permeability relative difference fails to converge for periodic boundary conditions in fig 17 this is expected since the domain was constructed for no flow conditions in tangential directions and it shows the importance of selecting the correct boundary conditions for porous media simulations wall times are provided in these figures on the right for each type of boundary conditions the least square fitted lines indicate an optimal linear performance the lattice boltzmann method for porous media lbpm mcclure et al 2021 was used to show the validity of the results as well as compare the wall time see fig 18 the lbpm software is running on the same gpu that runs all tests in single precision floating point base type and the multi relaxation lbm scheme is used to perform simulation and calculate the permeability the stopping criteria for the lbpm updates is when the calculated permeability relative difference is less than 5 0 1 0 6 on the left one can notice a relatively close trend of error decrease for both our and lbm methods on the right one can compare wall times for the lbpm code and the current implementation the explicit lattice boltzmann method has a quadratic asymptotic vs a linear asymptotic for the multigrid preconditioned coupled stokes solver observe that both methods have some lagging for small domain sizes this is because the gpu has not enough load to run on such relatively small domains 3 4 comparison against other available data xct images of real rocks this subsection contains a comparison of permeability against known data from mostaghimi et al 2012b a results are provided in the table 1 best fitted permeability values are provided since no information about the particular direction in which the flow was oriented is available in the references the velocity fields and pressure iso surfaces are provided in fig 19 20 for different boundary conditions calculation of each test case in a single flow direction requires three directions to calculate a full permeability tensor took less than 25 s of wall time see details in the table 4 general discussion and outlook in this paper we present a method to solve stokes equations directly on binarized three dimensional images that contain information on the pore structure of the porous media at hand several issues are to be discussed here the main issue is the available device memory on the gpu we used the tesla v100 gpu with 32 gb and were able to solve problems up to 20 million fluid voxels with single floating point precision this is the image size of 45 0 3 and porosity of 0 372 after the topological domain analysis removed all disconnected fluid volumes it is clearly not sufficient to be used in routine applications due to inability to achieve the representative elementary volume gerke and karsanina 2021 utilization of cutting edge recent gpus with up to 80gb of device memory will increase the size only up to 50 million cells in order to overcome this drawback the method needs to be extended to multiple gpus however in this case the underlying amg solver is no longer applicable with the same demonstrated efficiency we made some preliminary testing of the amgcl solver demidov et al 2021 in multiple gpus variant via mpi interface and found that the preconditioning becomes inefficient in order to achieve this approach one needs to design a new solver based on modern cutting edge results in the field of numerical linear algebra where scattering the computational domain on multiple gpus will retain good preconditioning quality such an approach was used in bocharov et al 2020 where a symmetric gauss seidel preconditioner was ported on multiple gpus with no loss of preconditioning quality compared to a single gpu we expect such a solution to also partly compensate the effect of preconditioning degradation in fig 15 where a poorer smoother in amg spai 0 instead of ilu 0 for a matrix had to be chosen in order to fit data into device s memory another interesting point for discussion is the test on spherical packings that we utilized see section 3 2 the issue is that this test is correct for two relaxation times or multi relaxation times lbm methods where approximation can be fitted to the underlying geometry by some free parameters under the assumption of the known original geometry shape if no such assumption is posed and it cannot be posed for real xct images a method would converge only up to the first order maximum since the spheres are approximated using piecewise constant voxel surface based functions on the surface actually these are no longer spheres but pointy structured spherical hedgehogs like blobs the data obtained from simulation would only converge to the flow around such hedgehogs it is very well demonstrated in left part of the figs 12 14 for sc and loose packing for bcc and fcc touching spheres for bcc and fcc lose all approximation and only remotely resemble spheres under the considered approximation as such these tests would show a maximum of first order convergence or worse for any classical cfd method including fem and dg methods of higher order this issue suggests that such tests should only be considered qualitative for a classical cfd method and other analytical tests should be designed in order to obtain real convergence analysis in porous media however if one wishes to impose exact boundary if it is known for example some laboratory tests are performed on manufactured sphere packings then one can exploit this fact and use immersed boundary method this will guarantee 2 d order convergence for convex lipschitz continuous boundary in our experience main system matrix assembly will not degenerate efficiency the process of constructing stencils near the boundary can be divided into several stages detection of intersected elements mirroring of the unknowns w r t the boundary setting fictional unknowns as functions of real mesh points setting those equations into the matrix each of which is efficiently parallel on the other hand one may need special care in constructing amg hierarchies in order to obtain grid independent convergence that is to be answered in our future research another different approach that can be utilized is to apply lattice boltzmann method in the steady state format see verberg and ladd 1999 this will most likely increase the precision near boundaries by a constant since both methods are of the second order of approximation but some issues will arise first it will be difficult to obtain grid independent convergence to obtain the grid independent convergence one must apply advanced multigrid or domain decomposition dd methods the original paper used unpreconditioned bicgstab method geometric multigrid method is the best option here but it is impossible to apply it directly on a complex porous media domain structure one will either lose approximation or lower grid operators will be large and again grid independence convergence will not be achieved one way to overcome this is to use the amg as it is done in the current research but it requires storing large matrices in ram and for q3d19 lbm scheme the size of such matrix will be prohibitively large for gpus besides the resulting matrix is not symmetric and it is a challenge to tune amg method to produce correct aggregates for non symmetric matrices the third option is to use dd methods but only additive methods can be applied for the grid independent convergence one will need to estimate some eigenvectors that correspond to positive eigenvalues with the smallest real parts see spillane et al 2013 such process will consume even more ram other preconditioning strategies can be tested but such discussion is beyond the scope of the paper in our implementation the direct stokes flow solver is even more efficient than pore network modeling method while usually pnm takes a couple of seconds to compute permeability it takes from minutes to hours to extract the pore network model from the 3d image even in a parallel fashion khan et al 2020 zubov et al 2022 our blastingly fast solution of the single phase flow problem allows to apply direct flow simulations to a variety of fashionable problems starting from deep learning to direct upscaling permeability tensors obtained for a large collection of images can serve as a foundation for machine learning ml predictions based on structural descriptors such as correlation functions röding et al 2020 karsanina et al 2021 or persistence diagrams moon et al 2019 resulting pressure and velocity fields can be utilized to another ml approach to predict such fields within the pore space and then evaluate the permeability karimpouli and tahmasebi 2019a santos et al 2020 with a very fast solution within subcubes of 300 45 0 3 voxels in volume we can create a computational mesh for larger scale model based on darcy equation or domain decomposition approach horgue et al 2015 that will help in creating a more physically based upscaling technique accounting for local structural non stationarities gerke and karsanina 2021 the same general approach based on implicit scheme and gpu implementation is our future focus for multiphase flow simulations 5 summary in this paper we have presented a novel stokes solver based on amg and implemented on gpu the numerical scheme was extensively tested on numerous artificial porous media with analytically known permeability values and on real world xct images of different porous media samples such an implementation allowed to obtain blastingly fast solutions for 3d images with volumes of 300 45 0 3 voxels within 10 25 s this wall times include loading the image and the analysis of the 3d pore geometry that was shown to be crucial for correct application of major boundary conditions including the case of fully periodic domain as such our code allows to incorporate direct single phase flow simulations in a variety of machine learning applications moreover we laid a foundation for future fast gpu based multiphase solver credit authorship contribution statement nickolay m evstigneev design the numerical scheme software writing original draft prepared graphical results reviewed the final version oleg i ryabkov software writing original draft prepared graphical results reviewed the final version kirill m gerke conceived this research writing original draft prepared graphical results reviewed the final version declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research was partially supported with the rfbr grant 20 07 00066a collaborative effort of the authors within the fat imp flow and transport in media with pores research group 
70,the paper is focused on high efficiency stokes solver that is applied to the incompressible flow in porous media computational domains are represented by binarized 3d computed tomography voxel models the solution procedure is constructed around a fast algebraic multigrid solver that utilizes the power of graphics processing units gpus in order to minimize memory footprint and accelerate the solver a simple mac type staggered finite difference discretization is used and a coupled stokes saddle point type system is solved directly on a gpu the mac discretization is discussed taking particular care of internal solid boundaries around pores the method includes topological domain analysis on a gpu which removes isolated volumes with no flow in the domain based on the connected component labeling depending on the boundary conditions we consider various types of boundary conditions and efficient parallel strategies for the gpus including fast matrix assembly and residual regularization our method is extensively benchmarked both against analytical solutions and applied problems from digital rock physics in terms of computational wall time precision approximation order and convergence we demonstrate that it takes up to 5 23 s on a modern gpu card to obtain a solution with 1 1 0 6 error residuals for 3d geometries with 300 450 3 voxels and a porosity range of 5 37 graphical abstract keywords stokes flow porous media algebraic multigrid method general purpose gpu krylov subspace solvers permeability permeability tensor data availability data will be made available on request 1 introduction structure property relationships sahimi 2003 torquato 2002 are the basis of the pore scale modeling technology that targets directly solving governing physical equations within the geometry of the materials under study or to simplify the relationships using various statistical approaches in particular flow and transport characteristics for porous media in the form of for example permeability tensors guibert et al 2016 gerke et al 2019 scandelli et al 2022 relative permeabilities and capillary curves for multi phase flow valvatne and blunt 2004 patzek 2001 ryazanov et al 2009 electrical properties khachkova et al 2021 and dispersion tensors salles et al 1993 are of utmost importance for applications in petroleum engineering blunt 2017 godinho et al 2016 hydrology and soil physics barbosa et al 2022a ferreira et al 2022 food engineering derossi et al 2019 and numerous other disciplines the results of the pore scale simulations can be used to optimize the parameters of the c o 2 sequestration hydrocarbon recovery or soil irrigation and to parameterize the continuum scale models to describe the flow problems in the m km scale among the physical properties mentioned earlier the permeability is the foundational characteristic as a key parameter in majority of continuum scale models and is based on homogenized pressure and flow velocity fields that are also needed to compute other properties e g dispersion khirevich and patzek 2019 the input data for pore scale modeling information usually comes from x ray tomography xct imaging cnudde and boone 2013a abrosimov et al 2021 in the form of 3d images the fundamental problem of almost any imaging method is the field of view to imaging resolution ratio the larger the porous media sample is the lower the resolution gerke et al 2015 covering hierarchical structural features of most natural porous media at all interesting scales thus requires multiscale imaging with sub sampling karsanina et al 2018 chen et al 2016 tahmasebi 2018 based on combined xct scanning electron microscopy sem or focused ion beam milling fib sem methods hemes et al 2015 gerke et al 2021 stochastic reconstruction techniques adler et al 1990 yeong and torquato 1998 allow recreating 3d structure based on limited 2d or 3d information different methods such as process based methods thovert and adler 2011 barbosa et al 2022b multiple point statistics tahmasebi and sahimi 2013 gravey and mariethoz 2020 and simulated annealing based jiao and chawla 2014 karsanina and gerke 2018 algorithms and their hybrids politis et al 2008 cherkasov et al 2021 not only helpful in substitution of time consuming imaging but is also necessary to fuse multiscale images into a single digital model karsanina et al 2018 li et al 2020 wu et al 2019 as imaging methods provide information in the form of attenuation of x ray or electron back scattering intensity one needs image processing techniques to segment out the pores and solids this step in input data preparation currently evolves towards the usage of deep learning techniques e g karimpouli and tahmasebi 2019b lavrukhin et al 2021 after the 3d image of porous space is obtained the pore scale method can be applied to such an image to compute the permeability the majority of such methods can be roughly divided into the following groups 1 direct pore scale simulations involving the numerical solution of the navier stokes equation as will be reviewed in detail below 2 pore network model pnm approach patzek 2001 valvatne and blunt 2004 gerke et al 2020 and 3 different classes of effective medium approximations naik et al 2021 ghanbarian 2022 direct simulations are computationally very expensive even on modern hardware and for large modeling domains require parallel implementation of thousands of cpus khirevich et al 2012 the last two approaches are much more efficient but they require some parameters or tuning that are ideally based on direct simulations for example miao et al 2017 proposed to parameterize the hydraulic conductances of the pnm elements with the help of the machine learning the framework that was applied in different pnm models misaghian et al 2022 tembely et al 2021 rabbani and babaei 2019 that requires local flow velocities and pressures to train the neural network to predict conductances on the fly during pore network extraction in an accurate manner in summary we still lack a robust and computationally efficient single phase flow simulator that is needed in numerous applications starting from dispersion modeling and spanning to parameterization of the pnm models the problem of the single phase incompressible flow simulation in porous media is studied and covered in literature well for example ord et al 2009 golparvar et al 2018 as we argued above in digital rock applications we are usually interested in the approach where partial differential equations and boundary conditions that describe the incompressible flow are solved in the provided domain directly incompressible flows in porous media can be considered in either creeping or advective regimes which are defined by the local reynolds number for example flow in small pores is creeping while flow in cracks and large pores is advective each one requires a different treatment from the computational point of view both methods are saddle point problems due to the incompressibility constraint while the first case has a pure parabolic nature for the momentum equation the second one is hyperbolic dominated computationally one can divide the methods that solve incompressible viscous flows in porous media into several groups based on different methods of approximation the first group treats incompressibility constraints approximately e g using artificial compressibility method the second group tries to pose incompressibility constrain exactly by considering a much more complicated saddle point problem another classification of methods can be formulated based on how one treats temporal derivatives in the momentum equations let us classify some common methods that are usually applied to simulating flows in porous media into these categories for example a popular lattice boltzmann method lbm treats incompressibility approximately via chapman enskog expansion while being an explicit method chen and doolen 1998 khirevich et al 2015 mcclure et al 2021 artificial compressibility methods kwak and kiris 2010 treat incompressibility approximately but can be either explicit gerke et al 2018 or implicit lee et al 2001 for the exact steady state these methods recover the original incompressible equations in reality there is always a trade off between accuracy and efficiency madsen and schäffer 2006 projection methods treat incompressibility exactly however such an approach is only possible if the helmholtz projection can be derived exactly otherwise these methods are incompressible up to an error in the fractional step method approximation see kim and moin 1985 armfield and street 1999 these methods can be either explicit armfield et al 2010 or implicit feng et al 2011 2012 finally a fully coupled system of equations can be considered where incompressibility is satisfied up to the convergence criteria of the linear system solver such methods are always implicit john and tobiska 2000 darwish et al 2009 uroić and jasak 2018 riella et al 2019 in this paper we are focusing on the solution of the pure creeping flow problems that can be described by the stokes operator using the fully coupled stationary system of equations infinite time step size the choice of the method for the solution is dictated by severe restrictions on the explicit method time step size due to stability conditions roughly proportional to the maximum velocity magnitude times the spatial discretization size squared and by a users interest in stationary flow in porous media first the continuous infinite dimensional system should be discretized to obtain the finite dimensional approximate system of equations that a computer can solve here one has an excellent choice of finite difference finite element gibson et al 2020 or other types landmann et al 2008 of approximation next this finite dimensional system which is a saddle point problem needs to be solved efficiently benzi et al 2005 both are tightly coupled and should be chosen depending on the target computational architecture note that an optimal solution method is the method that can solve the discrete problem of size n using o n floating point operations and hence the wall time has a linear dependence on the problem size unlike explicit methods optimal iterative solution methods for elliptic problems are multigrid methods fedorenko 1962 bakhvalov 1966 xu and zikatanov 2017 and domain decomposition methods schueller and mcdonough 2002 pechstein 2013 in this study we focus our attention on the application of the algebraic multigrid amg methods as the preconditioners to solve the problem such methods were already applied to the problem at hand e g demidov et al 2021 and excellent reviews on preconditioning strategies are presented in works may and moresi 2008 and elman et al 2008 note that an optimal choice would be to use a geometric multigrid gmg method with a vanka type smoother manservisi 2006 saberi et al 2022 but the porous media geometry a microscopically heterogeneous mixture of pore and solid inclusions limits the application of the gmg it is very difficult to construct optimal restriction and prolongation operations on this random mixture of fluid and solid bodies besides vanka type smoothers require additional treatment in the case of mass parallel implementation claus and bolten 2021 the approach discussed above is not new for example the stokes system was solved using amg methods with simple type discretization in mostaghimi et al 2012b in linden et al 2015 a stokes solver based on the clustering of variables is considered where the systems are solved using the block gauss seidel algorithm as an iterative solver in this paper our attention is on performance and modern computational architectures in order to achieve maximum performance one should select a target hardware computational architecture among other things in this research we are focusing our attention on the graphics processing unit gpu as the main computational unit the development of efficient general purpose gpus has been boosted in recent years by the progress in machine learning and neural networks as a result modern gpus are efficient in terms of floating point operations per consumed energy unit green top 500 per occupied space and per cost of the hardware however gpus have one substantial weakness low device memory capacity compared to the on board cpu random access memory ram in this case construction of coupled stationary solvers which need much more memory than explicit methods storage of the operator matrix preconditioning matrices etc requires a careful selection of the discretization method as well as the solution method since the domain information in porous media can be directly provided by the segmented x ray computed tomography xct images as bit arrays of voxels cnudde and boone 2013b hampel 2015 we intend to exploit this situation and use the simplest finite difference second order approximation harlow and welch 1965 since the underlying grid is structured and orthogonal this approximation while relatively accurate allows us to decrease the sizes of the matrices and potentially maximize the size of the problem under consideration in addition it is possible for some domains to have a union of fluid voxels voxels that share the same bit information corresponding to the void volumes inside a sample that form separate volumes with no flow through boundaries to avoid solving systems with such isolated volumes topological analysis is needed on the provided domain to remove such disconnections all these methods including domain analysis needs to be solved on a gpu in order to maximize the efficiency the aim of our study was to develop a robust and computationally efficient stokes solver for gpu architecture the paper is laid out as follows first the description of the problem is considered next the topological domain analysis and discretization are discussed where each method is supplied with algorithms that are adopted for the gpu computational architecture the approximation of the continuous operator is discussed where details are given for different combinations of boundary conditions including internal solid voxels this part also discusses features of the main coupled system matrix formulation in parallel on the gpu after that the method of the system solution is described the regularization of the residual is provided in full detail including parallel algorithms the next section contains the results of different tests the first part deals with analytical tests such tests that have analytical solutions where the order of approximation is analyzed experimentally and the efficiency of the solver is shown in computational wall time the next part is dealing with the variety of tests on sphere packings which are taken from gerke et al 2018 some comparison with exact data is performed and the efficiency of the method is analyzed the third part of the tests is performed for permeability calculation on stochastically generated domains a successive set of increasing domains with pre defined permeability is supplied to the solver the resulting estimation of permeability allows us to establish the process of convergence towards the pre defined expected permeability value wall time efficiency is analyzed in these tests and the results are compared to the lbm gpu method finally some real tests from other papers are simulated and compared to known results available in the literature the paper is finalized with discussion summary and outlook 2 analysis numerical method the computational domain ω r 3 is assumed to be formed by the union of hexahedrons with piecewise smooth external boundaries δ ω its normal unit vectors n to the boundaries are collinear with the standard unit vectors in the direction of the x y and z axes of a three dimensional cartesian coordinate system if not this can always be corrected by introducing an affine orthogonal transformation the domain is represented by the union of 3d voxels f i 1 n w i each voxel is equipped with a boolean value 0 or 1 for one value the voxel is a fluid or pore voxel that permits a flow and for the other the voxel is a solid voxel where no flow occurs voxel size is constant in each direction such a setup is common for the digital representation of the 3d xct binarized images the nondimentionalized stokes problem in the domain ω r 3 with external boundaries δ ω is described by the following system of equations 1 v p f v 0 with the combination of the following set of boundary conditions velocity dirichlet boundary conditions 2 v δ ω d v d pressure dirichlet boundary conditions 3 v n δ ω n 0 p δ ω n g periodic boundary conditions 4 v δ ω p 1 v δ ω p 2 p δ ω p 1 p δ ω p 2 where δ ω p 2 is an opposite boundary to the boundary δ ω p 1 opposite is in terms of affine mapping in orthogonal directions the vector function v is commonly referred to as velocity scalar function p as pressure which is also a lagrange multiplier for the divergence free condition known vector function in the right hand side f as the source term and vector n represents the outward normal unit vector on the boundary we define external and internal boundaries external boundary conditions are given as the combination of 2 3 and 4 on the boundary planes of the hexahedron domain external boundary the dirichlet velocity boundary condition is set by the known vector function v d and the dirichlet pressure boundary condition is set by the known scalar function g the construction of the internal boundary is formed as follows each pair of voxels that share a common face but with different boolean values forms a local internal boundary an internal boundary is formed as a union of all local internal boundaries such boundary is a piecewise smooth lipschitz surface inside a hexahedron domain internal boundary on which the boundary condition 2 with v d 0 is set we are interested in finding a sufficiently smooth numerical solution v p of the system 1 for the provided domain ω with internal and external boundaries 2 1 domain discretization and analysis for the real xct images the domain ω may contain isolated volumes which are not connected to the main flow domain these isolated volumes while absolutely valid contribute no valuable information to the solution it is a common practice to apply explicit khirevich et al 2015 gerke et al 2018 or implicit bird et al 2014 numerical methods that have a temporal derivative in 1 to the provided domain as it is the isolated volumes do not degenerate the solution in any way they only occupy additional memory on the other hand the solution of the stationary problem as it is formulated in 1 will cause convergence problems for iterative methods that solve the discrete linear system indeed for each isolated volume a problem with pure dirichlet boundary conditions is posed so the pressure is defined up to a constant hence each isolated volume would contribute a basis vector to the null space of the linear operator hence the degeneration of the system increases with each volume added that way if one uses simple family approximation then this problem is regularized during the formulation of the approximate system on the mass conservation operator see mostaghimi et al 2012b but the overall accuracy exhibits only first order convergence in l 2 norm the usage of the full coupled system on the discrete level that is the second order in l 2 norm will lead to the poor convergence for the large null space hence it is beneficial to remove these isolated volumes from the domain prior to the discrete system formulation for this reason we perform a topological analysis of the domain during this analysis we detect isolated volumes and convert fluid voxels within them to solid voxels we also identify independent not connected flow channels for further processing the analysis is based on the connected component labeling ccl approach the connected components depend on the external boundary conditions that are used in the problem setup and on the connectivity pattern that is defined by the discrete operator stencil in the case of the chosen discretization it is a connection between voxels through a common plane i e a 6 point connectivity since the whole idea of the method is to solve the problem as fast as possible the ccl should be executed in parallel on a gpu the core algorithm for the ccl is chosen from the paper playne and hawick 2018 by playne and hawick this is one of the most efficient gpu based algorithms for ccl it identifies and eliminates redundant operations in the previous methods for gpu for rectilinear two and three dimensional datasets however the method requires clamped boundary conditions in all planes of a hexahedron it is based on labeling each voxel depending on its coordinates and its neighbors if the neighboring component has the same type as the central voxel then the label is set to the coordinate of the neighbor if not then the actual coordinates of the central voxel are set after that the algorithm relabels all components that have labels that are not equal to the central hence it finds the boundary where the type of voxels changed for more details see playne and hawick 2018 it is a very efficient algorithm but it has some drawbacks namely the application of this algorithm to the domains with some or all periodically associated external boundaries is impossible if no other type of voxel were present in some orthogonal section the algorithm would halt hence the domain analysis is performed depending on the external boundary conditions under consideration we are considering three possible situations the main algorithm 1 is used in all cases of external boundary conditions first the ccl is applied which generates the colored domain such that each connected component set has a unique color and the set of solid voxels has a unique color of 0 at this stage particular boundary conditions periodic association are not taken into account the data from ccl algorithm is used to construct the dictionary of colors using a parallel version of exclusive scan operation on the gpu this allows us to make the coloring index contiguous since the initial coloring returned by ccl algorithm in general case is not contiguous next the color dictionary is modified depending on the boundary conditions periodic association if exists after this step the colors with a value greater than 0 represent the set of fluid voxels that permit the flow w r t the provided geometry boundary conditions and used connectivity finally the colored domain and the original domain are modified to meet these requirements the new set of voxels is formulated and the colored domain c and a new corrected domain ω are returned the whole algorithm poses no problems with parallel implementation on a gpu the application of the algorithm is justified by the following proposition 1 the solution of 1 with a uniform constant source term for any subdomain with only zero velocity dirichlet boundary conditions 2 is trivial with zero uniform velocity proof by the construction of the ccl algorithm one finds isolated volumes as such that have no distinct color on the external boundaries of the domain or have only zero dirichlet velocity boundary conditions on all its external boundaries such isolated volumes have a piecewise smooth boundary constructed by the union of the set of internal boundary voxels and external boundaries if any let us consider a single isolated volume v 0 for 1 with uniform boundary conditions 2 where v d 0 on the piecewise smooth boundary in this case it is easy to show that the trivial solution 0 p is the unique solution of 1 where p is some linear function since the source term is uniform constant that satisfies p f without the loss of generality we assume that v 0 p x d x 0 we prove this fact as follows let f c x c y c z t where c α are constants then one can introduce a scalar potential φ c x x c y y c z z and f φ following temam 1984 see page 28 consider the hilbert space of compactly supported divergence free vector functions on the isolated volume that are closed in h 0 1 and from a complete space v u h 0 1 v 0 div u 0 a standard inner product of vector functions is defined as u v v 0 j 1 3 u j x v j x d x and for scalar functions f g is defined as f g v 0 f x g x d x an inner product of two gradients of some vector functions is defined as again see temam 1984 u v j 1 3 k 1 3 j u k j v k where j are the components of a differential operator in a canonical cartesian basis the problem for 1 with uniform zero boundary conditions 2 is solved by finding a unique pair of smooth functions v p that satisfy the system of eqs 1 applying inner product of 1 with any function u v one obtains v p f u 0 since the domain v 0 is piecewise smooth we can perform integration by parts v u f u u v where surface integrals are zero since u δ v 0 0 a e and pressure integral is zero since u 0 analogous to temam 1984 see page 32 one needs to find a smooth v v such that v u f u u v thus formulating a variational form of the problem the term on the right hand side can be considered as f u φ u φ u 0 u v where surface integral is also zero since u δ v 0 0 a e hence 5 v u 0 u v finally we show that the last statement only possible for v 0 let us define a functional for the inner product in h 0 1 u v u v u v u one needs to show that u v u 0 u v the second part of the sum is zero by 5 using cauchy schwarz and poincare inequalities we obtain v u c 1 v l 2 u l 2 c 2 v l 2 u l 2 0 u v by using v l 2 0 from 5 the proposition is valid since the space v is complete the pressure is explicitly defined as p x φ x mes v 0 1 v 0 φ x d x the proof of the fact that the found solution is also a smooth solution of the original problem is based on the completeness of the divergence free space v this is the unique solution 0 p to the stokes problem in v 0 the result of this proposition allows one to exclude all isolated volumes that have only uniform zero velocity dirichlet boundary conditions from consideration 2 1 1 non periodic boundary conditions this set of boundary conditions always has an inflow and an outflow external boundaries defined by either 2 or 3 all other external boundaries are set by zero dirichlet velocity boundary conditions 2 with v d 0 in this case the algorithm 1 does not require the call to additional functions the steps on lines 7 11 perform the following operations 1 c u c b 1 c b 2 c b 2 c b 1 2 c c u d c 0 as the result all such colors that are not shared by inflow and outflow boundaries b 1 and b 2 are excluded from the consideration and replaced by the solid voxels due to proposition 1 2 1 2 partially periodic boundary conditions in this case the flow can be driven by either dirichlet boundaries 2 or 3 or by the external force that is set by the source term f in 1 in both cases we have a partial periodic association of boundaries in this case the main algorithm 1 calls the function provided in the algorithm 2 the algorithm 2 also has no serial bottlenecks and can be executed in parallel on each step it associates the colors of two opposite planes under the periodicity assumption at first the dictionary of periodically associated colors is identified lines 5 10 for p x then the associated dictionary is used to modify the original dictionary lines 13 16 which is later used by the main algorithm 1 to correct the domain during this step any color that is connected to the solid voxels on the other side is not modified see line 6 2 1 3 fully periodic boundary conditions in this case the flow is driven by the external force that is set by the source term f with uniform constant components it is a more complicated case than the other two the problem is in the correct identification of the periodic channels that are formed by the pore voxels where the flow is possible using proposition 1 it is necessary to identify isolated volumes under the assumption of periodic connectivity of opposite external boundaries remark 1 we do not state that the channels where the flow is possible will guarantee a non zero velocity the simplest example is the channel in the form of an x shape and the external force term that has a nonzero component in the horizontal direction and other components are zero due to the symmetry the solution will have a zero velocity in this channel the elimination of isolated volumes for this topology will serve as an optimization of memory and the number of operations each channel is formed by the union of voxels which has a unique nonzero color generated by the ccl process let the set of colors in the domain be designated as c i e each voxel w j f in the domain has a color c j c each external boundary plane is designated as b j and color c c that has a voxel w k w k ω 0 such that n ω e j 0 is designated as c b j definition 1 let the set of fluid voxels f has the same color c a pass through channel g is defined as a union of voxels with the same color c i e g w j w j f such that c b k c b l 0 for at least one combination k 1 6 l 1 6 and k l definition 2 let the set of fluid voxels f has the same color c a locked channel h is defined as a union of voxels with the same color c h w j w j f such that c b k c b l 0 for all combinations k 1 6 l 1 6 k l and c b k 0 the union of all through flow channels is designated as g the union of all blocked channel is designated as h proposition 2 the solution of 1 in any channel that is not from g and h is trivial with zero uniform velocity proof by definitions 1 2 we can conclude that the set of channels which is not in g and h is the set of channels which have no connection with the external boundary surface of ω hence these channels form isolated volumes therefore by proposition 1 the solution of 1 in such channels is trivial one needs to consider only channels from g and h the periodic association of two external opposite boundary planes b 1 and b 2 is understood in terms of an affine mapping of b 2 to b 1 and determination of voxel colors that are directly connected through one of the voxel surfaces after the affine mapping each channel from g or h can be connected to either one or more channels or can become locked by the solid voxels on the overlapped plane if the channel becomes blocked then it is a channel that contains an isolated volume and by proposition 1 all voxels in the channel can be marked as solid voxels by the periodic association a channel from h can be blocked connected to another channels from h connected to channels from g or connected to another channels from h and g in the first case the channel becomes an isolated volume that by proposition 1 has only a zero velocity solution in the second case the channel is connected only to other locked channels and those channels from a single isolated volume again a zero velocity solution is guaranteed by proposition 1 if a channel from h is connected to a channel from g then it can be used to interconnect two channels from g by a transitive relation the same situation may take place if a channel from h is connected to several channels from h and g in two later cases the flow is possible but not guaranteed see remark 1 so the last two cases are valid cases for the fully periodic boundary association hence we have proven two following proposition 3 the solution of 1 in any channel from h that is not connected to a channel from g is trivial with zero uniform velocity proposition 4 the solution of 1 in any channel from g that is locked by the periodic association not connected to any channels from g and h is trivial with zero uniform velocity all voxels in channels that fall into the category in propositions 1 2 3 and 4 can be marked as solid in the algorithm 1 at line 7 the algorithm for pure periodic association coloring is similar to the algorithm 2 the domain ω being modified by the algorithm 2 to eliminate isolated volumes can be used to perform discretization the set of colors c is also returned by the algorithm that can be used at the solution stage implementation of the algorithms for the gpu version is based on cuda kernels and thrust cuda c template library functions for unique set symm diff and exclusive scan on modern hardware such an approach results in a fast execution time of approximately 120 150 ms for the domain size of 100 0 3 voxels 2 2 approximation stokes problem approximation should comply with ladyzhenskaya babuška brezzi lbb condition if no artificial stabilization is used the simplest lbb stable staggered finite difference approximation is used harlow and welch 1965 which is reformulated for the conditions of the admissible internal boundary the choice of this scheme is dictated by the desire to minimize the memory footprint which is a scarce resource on gpus and obtain second order convergence a cartesian main uniform grid of n n x n y n z elements is introduced with j 0 n x 1 k 0 n y 1 l 0 n z 1 indexes for x y z directions respectively hence each voxel w i can be indexed by the main grid due to the usage of the staggered grid one needs to introduce additional grids for velocity and gradient components in x y z directions depending on the component of the velocity and boundary conditions in this case the grid can be extended to one element when the cartesian direction vector coincides with the discrete operator component direction in this case the discretization is called leading direction discretization for example x component velocity grid for non periodic boundary conditions has indexes j 0 n x k 0 n y 1 l 0 n z 1 the discretization is called tangential direction discretization when the cartesian direction does not coincide with the discrete operator component direction an element cell is identified with the negative half step i e a staggered cell s has indexes for v x s v x j 1 2 k l for v y s v y j k 1 2 l for v z s v z j k l 1 2 and for p s p j k l shifting a cell in the orthogonal direction is designated as s α 1 and is individual for each variable e g v x s x 1 v x j 1 2 k l v y s x 1 v y j 1 k 1 2 l v z s x 1 v z j 1 k l 1 2 and p s x 1 p j 1 k l p s y 1 p j k 1 l p s z 1 p j k l 1 all voxels have the same length in each direction h α α x y z which is common for data obtained from xct scans for the cell with a fluid voxel s that also has all neighboring fluid cells and smooth functions the approximation is formulated in the standard form for the staggered discretization the discrete stokes operator is obtained by the expansion near the center of velocity elements and due to the staggered location all approximations are second order accurate 6 v α s α x y z h α 2 v α s α 1 2 v α s v α s α 1 o h α 2 p s h x 1 p s p s x 1 o h x 2 h y 1 p s p s y 1 o h y 2 h z 1 p s p s z 1 o h z 2 discrete divergence operator is obtained by expanding smooth functions near the center of s relative to the pressure discretization hence these expansions are also second order accurate 7 v s α x y z h α 1 v α s α 1 v α s o h α 2 next we consider the discretization of boundary conditions first we consider periodic boundary conditions 4 let the periodically associated boundary surfaces be designated as b 0 and b 1 for the leading direction α discretization near the cell s b 0 is associated with the cell s b 1 and the latter is excluded from the discrete system hence the velocity grid indexes for the leading periodic direction are changed to j 0 n x 1 k 0 n y 1 l 0 n z 1 the association is performed by replacing appropriate indexes in 6 and 7 for neighboring cells s α 1 with the substitution of s 0 b 0 instead of s n α b 1 which is no longer available in discrete form for the laplace and divergence discrete operators the gradient operator on the main grid is discretized near the periodic boundary by a simple substitution of s n α 1 b 1 instead of s 1 b 0 the tangential direction discretization β in case of a periodic boundary condition is performed for the laplace operator only by simple substitutions s n β 1 b 1 instead of s 1 b 0 and s 0 b 0 instead of s n β b 1 another types of external and internal boundary conditions require some work to maintain uniform second order approximation for visibility and clarity we demonstrate only a 2d case a 2d staggered grid to simplify description is shown in fig 1 but it can be easily extended to a 3d problem since the directions are orthogonal each vector component for velocity and pressure gradient operators within the 3d grid contains one leading direction and two tangential directions velocity and pressure gradient indexes are shifted by 1 2 step but numbered using integers as it is done in actual implementation shifted velocity cell indexes are displayed in red while main cell indexes indices for voxels pressure and velocity in the tangential direction are displayed in black fig 1 for example index for the pressure cell 1 in α direction is displayed in black and appropriate velocity index in α direction that has index 1 1 2 is designated as 1 in red in the similar fashion velocity indexes in tangential direction β are given as blue indexes in integer values all cells that coincide with the solid voxels are removed from the discrete system thus decreasing the memory footprint let us start from the dirichlet velocity boundary conditions eq 2 in this case the pressure is not set hence the gradient operator will have no entries in α direction at points 0 0 2 3 3 2 4 1 and in β direction at points 1 1 1 2 1 3 1 4 for internal boundaries for external boundaries the gradient operator has no entries in α direction at points 0 velocity is approximated as follows first we consider conditions on the internal boundary for the leading direction α the velocity value is set to the value on the boundary e g at points and this value is inserted into the discrete laplace operator for example for the external boundary the values of velocities i e at line is set explicitly to the prescribed value the divergence operator remains unchanged now consider the approximation of the discrete laplace operator elements in the tangential direction β several typical cases should be considered each case is deduced by expanding the smooth velocity function near the boundary point and equating the first and third derivative coefficients to zero by solving a linear system the location of the zero velocity in a cell in the tangential direction is indicated by blue squares in fig 1 consider all cases by example the first case is the line the boundary value is set at point the second partial derivative at point is approximated as the same is true for line except it requires two special treatments near cells and which are mirrored the second case is the line the second order second partial derivative at cell is found as the third case is presented at the line the second order second partial derivative at cell is found as each of these cases can be extended to the external dirichlet boundary conditions e g like a value in point in these cases velocity values are set explicitly in the case of internal boundary conditions the velocity values at the blue squares are set to zero in the formulas provided above the next to consider is the pressure dirichlet boundary conditions eq 3 on external boundaries the pressure value is set on the external boundary e g at line for the α direction in this case the pressure is found using constant extrapolation e g at cell the second order is achieved due to symmetry the divergence operator remains unchanged discrete laplace operator is modified depending on the leading or tangential direction of discretization for the leading direction discretization e g at cell the discretization of the velocity derivative in a normal direction is symmetric relative to the middle point it is true if the function can be smoothly extended beyond the boundary otherwise the formula presents the first order approximation hence for the case when the solid voxel is close to the boundary cell at the approximation cannot be derived and the no flow condition is set for the tangential direction e g at point one obtains again second order accuracy is achieved if the function can be smoothly extended beyond the boundary if the solid voxel is close to the boundary cell at the approximation in the β direction is changed to this concludes the consideration of all boundary conditions 2 3 assembly of the main linear system having introduced discretization one needs to assemble the main linear system of algebraic equations which is a discrete representation of the linear operator eq 1 with imposed boundary conditions the matrix of the linear operator may have structured zeros and in order to save memory it is assembled in a compressed row storage crs or yale format while this procedure is trivial for the serial approach with no solid cells a parallel gpu optimized algorithm with solid cells requires some elaboration first the calculation of lexicographic indexes is performed separately for each variable due to the staggered grid topology and random location of solid voxels see algorithm 4 for each variable one needs to execute a parallel kernel in algorithm 3 that assembles indexes then an inclusive scan is executed and total number of entries are obtained for each variable which are stored in start index array next the same kernel is called to set these indexes and exclude solid voxels finally assembled indexes and the number of elements are returned the next step is to construct the matrix itself in full compliance with the continuous operator the matrix can be split to matrices of the laplace operator a r n v n v gradient operator b t r n v n p and divergence operator b r n p n v here n p start index 3 start index 2 n v start index 2 the system eq 1 is formulated in the discrete form as 8 a x b a b t b 0 u p f 0 although the main system can be written as 2 2 block system the actual formulation of the whole matrix a requires different indexing in crs format for different matrices in the system each matrix is constructed in two passes see algorithm 5 for an example the algorithm 5 accepts the stencil function that is responsible for setting correct nodes and correct weights depending on the neighbor voxels in the stencil and boundary conditions line 5 all described in section 2 2 for the gpu implementation of the stencil function it is a device method that returns appropriate index values for the points in the stencil and weights for each point that is set in the stencil in addition it returns the weight that is used on the right hand side generated by discrete boundary conditions the crs matrix assembly starts by calling the assembly process that is demonstrated by the algorithm 5 with run rows true and allocated array r o w p t r s of size start index 2 1 for this example this will set the number of elements in each row of the matrix in parallel lines 7 10 in the algorithm then exclusive scan is executed over the r o w p t r s array that will fill the array with the correct indexes of rows in the crs format the scan will also return the total number of non zero elements in the matrix finally the assembly algorithm demonstrated by algorithm 5 is called again in parallel with run rows false arrays of column indexes and values c o l s v a l s and vector r h s of the discrete right hand side f arrays of column indexes and values have sizes equal to the number of non zero elements in the matrix the vector r h s has the same size as the matrix s total number of rows i e start index 3 the algorithm fills the right hand side vector and local arrays c and v lines 12 20 then sorts them and stores results in the provided arrays depending on the whole system formulation type formulating coupled matrix a or three different matrices a b t and b matrix indexes of rows and columns for gradient and divergence operators should be modified while executing algorithm 5 on the second run for the assembly of the b t matrix it is necessary to modify column indexes by removing indexes of the a matrix for the assembly of the b matrix it is necessary to modify row indexes by removing those of the a matrix the implementation of the gpu version is based on the cuda kernels being executed for each parfor segment of the algorithms all scan operations are performed using thrust c library s functions such approach is very efficient and is capable of assembling a matrix over 100 0 3 voxels in less than 100 ms on modern gpus 2 4 solution of the linear system the formulated problem eq 8 despite being linear is relatively hard to compute the solution pair v p of eq 1 is not the minimizer of a quadratic functional as it would be for the case of an elliptic type pde but of a saddle point the pressure function can be considered as the lagrange multiplier for the original diffusive system being subject to an incompressibility constraint the solution pair u p of the linear system in eq 8 has the same property of the saddle point problem the problem is usually large and beyond the limit of an exact solution hence iterative methods must be used in this paper we used amgcl library demidov et al 2021 but with modifications that are targeted gpu only architecture for better performance on gpus the analysis of the modification and performance is discussed in evstigneev 2022 we used the generalized minimal residual gmres method with the left preconditioner 9 p 1 a x p 1 b where p is the block preconditioning matrix for the matrix a it is shown in evstigneev 2022 that one of the most efficient preconditioners is the block triangular preconditioner which is formulated as 10 p 1 a b t 0 s ˆ 1 a 1 a 1 b t s ˆ 1 0 s ˆ 1 a 1 0 0 e e b t 0 e e 0 0 s ˆ 1 it is applied as the composition of matrix multiplications here e is the identity matrix and s ˆ is the approximation of the pressure schur complement matrix s b a 1 b t it is easy to show that if the schur complement matrix is exactly factored then the preconditioner is exactly the inverse of the a matrix but the construction of the matrix s is expensive let alone its inverse so its inverse is usually replaced with a suitable approximation in evstigneev 2022 we demonstrated that a good choice for the matrix generated by the considered approximation is the usage of a weighted bfbt preconditioner of elman et al 2006 11 s ˆ 1 b b t 1 b a b t b b t 1 we used the version where the matrices are scaled by the diagonal in accordance with may and moresi 2008 this scaling slightly increases the convergence speed the preconditioning procedure is implemented in a modified version of the amgcl library the application of the preconditioner is prepared before the iterative procedure takes place as follows first the operator matrices a b and b t are extracted from the coupled matrix a then the amg hierarchy is formulated using the misk smooth aggregation variant described at ryabkov 2022 for matrix a and matrix b b t then the smoothers for each amg level are constructed the best results are obtained by using the ilu 0 smoother on each level let r n b a x n r δ u δ p t be the residual vector returned from the gmres at some iteration n the application of the preconditioner is described in the algorithm 6 after the domain analysis the set of colors c is generated where each color value corresponds to a separate flow channel another difficulty is the null space of a that depends on the external and internal boundary conditions if the problem is discretized with pressure dirichlet boundary conditions as in eq 3 then after the domain analysis only valid channels remain in terms of permissible flow and the matrix a is well defined if the velocity dirichlet boundary conditions are set in the whole domain as in eq 2 the pressure is defined up to an arbitrary constant this case poses no problems for the gmres method if the null space has a dimension of one however as the number of independent channels increases the dimension of the null space also increases since pressure in each channel is defined up to an arbitrary constant the same is true for the fully periodic boundary conditions as described by eq 4 in this case special care should be taken in order to maintain the fast convergence of the method to compensate for rounding off errors the algorithm 7 which is called in line 9 of the algorithm 6 is used to shift the pressure residual in each channel in such a way that the mean value of the residual in each channel is zero for the case when bound t is true remark 2 if one considers pure periodic boundary conditions with no solid voxels then the situation is slightly different the null space of pressure has a dimension one but the null space of velocity is no longer trivial which would be regularized by the internal boundary condition if the domain had solid voxels and is null a span 1 1 n u x 0 0 n u y n u z t 0 0 n u x 1 1 n u y 0 0 n u z t 0 0 n u x n u y 1 1 n u z t in this case the velocity residual should be regularized for each basis vector by fixing an arbitrary constant this should be done with the accordance to the image of the linear operator f this problem is implicitly solved in the taylor green vortex test cases see section 3 1 and is not discussed here in more detail the first procedure in the algorithm 7 is the preparation of the key value arrays necessary to perform efficient parallel operations it calculates the key value pair for the pressure residual vector in parallel from the pressure indexing array and domain coloring next the keys and values are sorted in parallel by sort by key and at last the total number of elements for each color is obtained by calling sum reduce by key all this is done in parallel on the gpu using the thrust cuda c library after each invocation of the preconditioner the function shift residual is called it stores the residual values in permuted order in accordance with the sorted values next the sum of each color value is calculated by calling sum reduce by key at line 7 of the algorithm 7 finally the obtained sum is applied to the original residual vector to shift it in such a way that it is zero in each channel up to the floating point precision these steps are performed in parallel on a gpu by using cuda kernels and thrust cuda c library functions 3 validation and numerical results all calculations are performed on the following hardware the cpu is intel xeon gold 6248r gpu is nvidia tesla v100 with 32 gb of device ram the linear solver s relative residual threshold termination value is set to 1 0 1 0 6 for single and 1 0 1 0 11 for double floating point precision the averaged quantities e g velocity are calculated with high order cubature formula using tri quadratic interpolation 3 1 validation on analytical tests convergence this section contains the set of tests that are aimed at convergence analysis double floating point precision is used the results are provided in l 2 and l norms as functions of the number of discrete points in a single essential direction to estimate the first norm a high order quadrature formula was used for the integral in order to avoid introducing additional errors in the estimation of the norms for the l norm a tri quadratic interpolation was used we designate l 2 v as the norm for the velocity error and l 2 p as the norm for the pressure error all tests where a dominant direction can be chosen are executed by changing this dominant direction along all basis vectors the first test is the solution of the plane poiseuille flow problem which is driven by either a pressure gradient or a constant external force in a single direction the plane parallel flow is achieved by setting periodic boundary conditions in one of two directions the solution is a second order polynomial for velocity and a first order polynomial for pressure it is expected to obtain an exact solution up to the base floating point type precision error since a parabola can be constructed using at least three points the results are provided in fig 2 the next two test cases are the poiseuille flow problem in rectangular channel of height 0 y h and width 0 z l driven by the pressure gradient or forcing term p δ this problem has the following analytical solution proudman 1914 presented by fast converging series in terms n u y z p δ 2 y h y 4 p δ h 2 π 3 n 1 1 2 n 1 3 sinh β n z sinh β n l z sinh β n l sin β n y β n 2 n 1 π h in these tests we used 50 terms of the series that allowed us to obtain an error rate twice that of the double floating point precision the pressure term is also linear for this problem with respect to the flow direction two cases are considered the first case is the standard domain with no solid voxels the second case is the domain that is covered by one layer of solid voxels adjacent to the boundary planes in the tangential direction this allows one to check the convergence order in channels that are formed by the solid voxels and serves as an integral test case for software development the results are provided in figs 3 and 4 one can observe the second order convergence for both test cases it is important to obtain second order convergence for the case with solid voxels the second order asymptotic would not be obtained for the case when the velocity derivatives near solid voxels in tangential directions are approximated with the first order as it is usually done e g mostaghimi et al 2012b the pressure distribution is exact as expected these results were obtained for aspect ratios of h l 1 1 1 5 1 10 two well known manufactured solutions are used as the next two test cases the first one is the test case for the circular flow problem from rhebergen and wells 2020 section 4 5 on a unit cube with non homogeneous dirichlet velocity boundary conditions the analytical solution is given as u x x y z π sin π x cos π y π sin π x cos π z u y x y z π sin π y cos π z π sin π y cos π x u z x y z π sin π z cos π x π sin π z cos π y p x y z sin π x sin π y sin π z 8 π 3 the forcing term is set as the residual when the proposed solution is substituted into eq 1 it is easy to show that the mean value of the pressure field is zero the results are provided in fig 5 one can observe that while the numerical solution for the velocity is obtained with the second order convergence the numerical solution for the pressure has a lower approximation order in l norm see fig 5 right upper crosses this demonstrates the importance of residual regularization for pure neumann pressure boundary conditions the difference on the boundary was enough to pollute the numerical solution because of the use of the preconditioner the second order convergence in pressure is restored when the pressure residual regularization is used mean value in the domain is zero the final test case is the pure periodic taylor green vortex solution taylor and green 1937 in unit cube which is given in particular by the analytical solution u x x y z 2 cos 2 π x sin 2 π y sin 2 π z u y x y z sin 2 π x cos 2 π y sin 2 π z u z x y z sin 2 π x sin 2 π y cos 2 π z p x y z 6 π sin 2 π x sin 2 π y sin 2 π z the forcing term residual is nonzero only in x direction f x x y z 36 π 2 cos 2 π x sin 2 π y sin 2 π z again dominant directions x y z are shifted as the test case is executed the results are presented in fig 6 each point presented in fig 6 in fact has three overlapping points for dominant x y or z directions in all cases we observe second order convergence the residual regularization was used see remark 2 the wall time of each test execution and the convergence are presented in fig 7 in all cases the variable problem size is the number of rows or columns of the coupled system matrix almost perfect linear scaling of wall time for all test cases is observed an interesting observation here is the unexpected twofold decrease in execution time for the single floating point test compared to the double floating point test while computational time should have decreased by the gpu 1 3 multiplier and lesser set convergence threshold value we assume that it is due to the decrease in precision in reduction type operations this requires further investigation with the help of the compensated algorithms e g evstigneev et al 2022 for the reference to the old hardware we compare the wall time on several old gpus available to authors namely nvidia geforce titan black with 6 gb of ram and nvidia geforce titan x with 12 gb of ram we selected the poiseuille 3d flow problem as a benchmark the results for single and double precision are presented in fig 8 maximum acceleration in double precision of v100 vs titan black is 2 7 times and v100 vs titian x is 10 7 maximum acceleration in single precision of v100 vs titan black is 3 6 times and v100 vs titian x is 2 2 a theoretical ratio of peak double precision performance of v100 vs titan black is 2 5 and v100 vs titan x is 19 8 peak single precision of v100 vs titan black is 3 7 and v100 vs titan x is 1 3 taken from https www techpowerup com the results correlate with the peak performance well additional acceleration is achieved for v100 gpu because software for old gpus is configured under cuda 10 2 the latest supported version with sparse matrix and vector operations are performed using cusparse library but for v100 gpu a new cuda 11 5 is used and more efficient low level speck library parger et al 2020 is applied to sparse matrix and vector operations for more information on optimizations see evstigneev 2022 3 2 flow in simplified porous media validation on sphere packings this test case is inspired by papers khirevich et al 2015 gerke et al 2018 and can be used as the qualitative test case for the flows in porous media this test case and dataset were designed to fit two relaxation and multi relaxation lbm schemes to such geometry where solid bodies are represented by possibly overlapping spheres which have piecewise constant surface approximation analogous to the xct images containing rectangular voxels the domain is assumed to be periodic examples from the dataset are provided in figs 9 11 the porosity in all datasets is calculated as the ratio of fluid voxel numbers to the total number of all voxels each sphere has an underlying spherical diameter given in voxel units and designated as d v o x analogous to gerke et al 2018 note that spheres can have non integer discretization khirevich et al 2015 there are three types of sphere packing layouts available in the publicly available dataset gerke et al 2018 depending on the location of the enclosing cube simple cubic sc fig 9 body centered cubic bcc fig 10 face centered cubic fcc fig 11 two latter types are additionally separated into touching spheres with less porosity in each case and loosely packed spheres with higher porosity the first one is defined by the array of spheres where each sphere is intersected by all its neighbors by a point i e touching the second one is defined by spheres that have a gap between neighbors see figs 10 and 11 right and left for comparison the formula that allows one to estimate the drag force for each layout for a sphere is available in gerke et al 2018 appendix d formula 30 and table d1 and we refer the reader to the cited paper the results of all simulations for the sphere packings are provided in fig 12 13 14 where a relative difference between formula calculated and numerically calculated permeability for spheres is provided and an example of the flow velocity is shown for these simulations fully periodic boundary conditions were used as is necessary to obtain the analytical solutions the obtained results are very close to those that are provided in gerke et al 2018 for the explicit artificial compressibility method fdmss calculated permeability tensors are perfectly diagonal with the same permeability in each orthogonal direction in all studied cases we observed that the permeability of the sphere packing differs from the permeability of the provided reference solution for the sc case the first order convergence towards the baseline formula for the sphere is obtained fig 12 left the convergence order is optimal for the provided discretization piecewise constant boundary approximation such that each spherical element is replaced by a voxel with sides that have normal vectors collinear with canonical cartesian directions of the convex second order surface results in the first order convergence for the bcc fig 13 left and fcc fig 14 left cases one can observe the first order convergence but with worse constants for the loose packing and convergence order degradation for the touching packing the first order convergence is again justified by the approximated geometry while the constant is worsened because the width of the channels between the spheres is decreased see flow velocities in fig 13 14 right therefore the approximation tends to degrade but since the original geometry of the spheres approximates the analytical spheres only piecewise constantly the convergence of the second order for the flow restores the incline on the other hand the bcc and fcc cases for the touching spheres show substantial differences this is because the spheres in these cases no longer approximate analytical spheres indeed the layout was designed to be used for the test of lbm methods where a fitting parameter exists that modifies the approximation of the strain rate tensor see khirevich and patzek 2018 as a result a partial slip condition can be restored on the boundary of the spheres providing more flexibility of tuning towards spherical solutions in addition lbm provides mass and momentum transfer in diagonal directions combining these two facts lbm allows one to adjust the approximation to the geometry if the latter is known in the first place classical cfd methods assume on the other hand that the voxels represent sufficient information about the boundary and treat boundary as is this explains the different convergence rates between the flow around the discretized and analytical spheres one must take a spatial care if the flow is assumed to be around convex smooth boundaries for example implement immersed boundary methods see le et al 2009 the analysis of convergence and execution wall time is presented next the whole set of test cases contained 75 samples 30 of which were test cases on grids with 10 0 3 and the rest were on the grids 30 1 3 voxels each case in the dataset was executed three times to obtain all permeability tensor components the whole dataset was tested in 1036 s averaged of 10 executions using single precision calculations the results are provided in fig 15 a spread in wall times against the reference data from the 3d poiseuille test problem indicates that the amg hierarchies are not constructed well in such a way that the high frequency eigenfunctions of the residual are damped in the multigrid process this is partially confirmed by the provided convergence analysis in fig 15 right where the best iteration count is 25 and the worst is 40 for larger test cases however the asymptotic is still linear as can be seen by considering the provided reference from the 3d poiseuille flow test case all small test cases 10 0 3 voxels in volume converged in 15 20 iterations and took less than 4 s 3 3 stochastic reconstruction with designed permeability in this subsection the flow in an artificially constructed porous medium is considered the computational domain is obtained using the stochastic reconstruction technique gerke et al 2014 with analytically chosen correlation functions jiao et al 2007 karsanina et al 2015 the domain is constructed in such a way that the expected permeability is around 1200 md under zero dirichlet velocity boundary conditions in the tangential directions to the flow the original domain size is 70 0 3 it is expected to obtain relatively close permeability with the sequential increase of the domain size the quality of the design is tested with the help of fdmss gerke et al 2018 pore network computations gerke et al 2020 and direct solver balashov et al 2020 the results are provided in fig 16 for the zero dirichlet velocity boundary conditions and in fig 17 for periodic boundary conditions one can observe that the relative difference between simulated and expected permeabilities behaves as expected and reaches a minimum error for the zero velocity dirichlet boundary conditions in fig 16 left on the other hand the permeability relative difference fails to converge for periodic boundary conditions in fig 17 this is expected since the domain was constructed for no flow conditions in tangential directions and it shows the importance of selecting the correct boundary conditions for porous media simulations wall times are provided in these figures on the right for each type of boundary conditions the least square fitted lines indicate an optimal linear performance the lattice boltzmann method for porous media lbpm mcclure et al 2021 was used to show the validity of the results as well as compare the wall time see fig 18 the lbpm software is running on the same gpu that runs all tests in single precision floating point base type and the multi relaxation lbm scheme is used to perform simulation and calculate the permeability the stopping criteria for the lbpm updates is when the calculated permeability relative difference is less than 5 0 1 0 6 on the left one can notice a relatively close trend of error decrease for both our and lbm methods on the right one can compare wall times for the lbpm code and the current implementation the explicit lattice boltzmann method has a quadratic asymptotic vs a linear asymptotic for the multigrid preconditioned coupled stokes solver observe that both methods have some lagging for small domain sizes this is because the gpu has not enough load to run on such relatively small domains 3 4 comparison against other available data xct images of real rocks this subsection contains a comparison of permeability against known data from mostaghimi et al 2012b a results are provided in the table 1 best fitted permeability values are provided since no information about the particular direction in which the flow was oriented is available in the references the velocity fields and pressure iso surfaces are provided in fig 19 20 for different boundary conditions calculation of each test case in a single flow direction requires three directions to calculate a full permeability tensor took less than 25 s of wall time see details in the table 4 general discussion and outlook in this paper we present a method to solve stokes equations directly on binarized three dimensional images that contain information on the pore structure of the porous media at hand several issues are to be discussed here the main issue is the available device memory on the gpu we used the tesla v100 gpu with 32 gb and were able to solve problems up to 20 million fluid voxels with single floating point precision this is the image size of 45 0 3 and porosity of 0 372 after the topological domain analysis removed all disconnected fluid volumes it is clearly not sufficient to be used in routine applications due to inability to achieve the representative elementary volume gerke and karsanina 2021 utilization of cutting edge recent gpus with up to 80gb of device memory will increase the size only up to 50 million cells in order to overcome this drawback the method needs to be extended to multiple gpus however in this case the underlying amg solver is no longer applicable with the same demonstrated efficiency we made some preliminary testing of the amgcl solver demidov et al 2021 in multiple gpus variant via mpi interface and found that the preconditioning becomes inefficient in order to achieve this approach one needs to design a new solver based on modern cutting edge results in the field of numerical linear algebra where scattering the computational domain on multiple gpus will retain good preconditioning quality such an approach was used in bocharov et al 2020 where a symmetric gauss seidel preconditioner was ported on multiple gpus with no loss of preconditioning quality compared to a single gpu we expect such a solution to also partly compensate the effect of preconditioning degradation in fig 15 where a poorer smoother in amg spai 0 instead of ilu 0 for a matrix had to be chosen in order to fit data into device s memory another interesting point for discussion is the test on spherical packings that we utilized see section 3 2 the issue is that this test is correct for two relaxation times or multi relaxation times lbm methods where approximation can be fitted to the underlying geometry by some free parameters under the assumption of the known original geometry shape if no such assumption is posed and it cannot be posed for real xct images a method would converge only up to the first order maximum since the spheres are approximated using piecewise constant voxel surface based functions on the surface actually these are no longer spheres but pointy structured spherical hedgehogs like blobs the data obtained from simulation would only converge to the flow around such hedgehogs it is very well demonstrated in left part of the figs 12 14 for sc and loose packing for bcc and fcc touching spheres for bcc and fcc lose all approximation and only remotely resemble spheres under the considered approximation as such these tests would show a maximum of first order convergence or worse for any classical cfd method including fem and dg methods of higher order this issue suggests that such tests should only be considered qualitative for a classical cfd method and other analytical tests should be designed in order to obtain real convergence analysis in porous media however if one wishes to impose exact boundary if it is known for example some laboratory tests are performed on manufactured sphere packings then one can exploit this fact and use immersed boundary method this will guarantee 2 d order convergence for convex lipschitz continuous boundary in our experience main system matrix assembly will not degenerate efficiency the process of constructing stencils near the boundary can be divided into several stages detection of intersected elements mirroring of the unknowns w r t the boundary setting fictional unknowns as functions of real mesh points setting those equations into the matrix each of which is efficiently parallel on the other hand one may need special care in constructing amg hierarchies in order to obtain grid independent convergence that is to be answered in our future research another different approach that can be utilized is to apply lattice boltzmann method in the steady state format see verberg and ladd 1999 this will most likely increase the precision near boundaries by a constant since both methods are of the second order of approximation but some issues will arise first it will be difficult to obtain grid independent convergence to obtain the grid independent convergence one must apply advanced multigrid or domain decomposition dd methods the original paper used unpreconditioned bicgstab method geometric multigrid method is the best option here but it is impossible to apply it directly on a complex porous media domain structure one will either lose approximation or lower grid operators will be large and again grid independence convergence will not be achieved one way to overcome this is to use the amg as it is done in the current research but it requires storing large matrices in ram and for q3d19 lbm scheme the size of such matrix will be prohibitively large for gpus besides the resulting matrix is not symmetric and it is a challenge to tune amg method to produce correct aggregates for non symmetric matrices the third option is to use dd methods but only additive methods can be applied for the grid independent convergence one will need to estimate some eigenvectors that correspond to positive eigenvalues with the smallest real parts see spillane et al 2013 such process will consume even more ram other preconditioning strategies can be tested but such discussion is beyond the scope of the paper in our implementation the direct stokes flow solver is even more efficient than pore network modeling method while usually pnm takes a couple of seconds to compute permeability it takes from minutes to hours to extract the pore network model from the 3d image even in a parallel fashion khan et al 2020 zubov et al 2022 our blastingly fast solution of the single phase flow problem allows to apply direct flow simulations to a variety of fashionable problems starting from deep learning to direct upscaling permeability tensors obtained for a large collection of images can serve as a foundation for machine learning ml predictions based on structural descriptors such as correlation functions röding et al 2020 karsanina et al 2021 or persistence diagrams moon et al 2019 resulting pressure and velocity fields can be utilized to another ml approach to predict such fields within the pore space and then evaluate the permeability karimpouli and tahmasebi 2019a santos et al 2020 with a very fast solution within subcubes of 300 45 0 3 voxels in volume we can create a computational mesh for larger scale model based on darcy equation or domain decomposition approach horgue et al 2015 that will help in creating a more physically based upscaling technique accounting for local structural non stationarities gerke and karsanina 2021 the same general approach based on implicit scheme and gpu implementation is our future focus for multiphase flow simulations 5 summary in this paper we have presented a novel stokes solver based on amg and implemented on gpu the numerical scheme was extensively tested on numerous artificial porous media with analytically known permeability values and on real world xct images of different porous media samples such an implementation allowed to obtain blastingly fast solutions for 3d images with volumes of 300 45 0 3 voxels within 10 25 s this wall times include loading the image and the analysis of the 3d pore geometry that was shown to be crucial for correct application of major boundary conditions including the case of fully periodic domain as such our code allows to incorporate direct single phase flow simulations in a variety of machine learning applications moreover we laid a foundation for future fast gpu based multiphase solver credit authorship contribution statement nickolay m evstigneev design the numerical scheme software writing original draft prepared graphical results reviewed the final version oleg i ryabkov software writing original draft prepared graphical results reviewed the final version kirill m gerke conceived this research writing original draft prepared graphical results reviewed the final version declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research was partially supported with the rfbr grant 20 07 00066a collaborative effort of the authors within the fat imp flow and transport in media with pores research group 
71,river channels self organize to form tree like networks that follow certain statistical laws such as horton s laws and hack s law which is perhaps the reason why simple statistical models are often used to explain river network evolution however statistical models generally do not attempt to explain the differences between network structures here we address this issue by incorporating certain physically meaningful variables in a statistical modeling framework the model allows the network to grow in a headward direction via probabilistic decisions based on two free parameters simulations performed over a planar matrix result in tree like networks exhibiting power law scaling relationships as displayed by real river networks the two parameters are shown to be capable of explaining the variation of key network characteristics such as compactness coefficient and hack s exponent the uniqueness of the model thus lies in its ability to generate networks with different shapes and characteristics keywords river networks landscape evolution scaling laws self organization randomness data availability data will be made available on request 1 introduction river networks have been studied in the domains of geosciences and hydrology for scientific as well as practical importance hergarten and neugebauer 2001 montgomery 2013 newson 2002 rodríguez iturbe and valdés 1979 rodriguez iturbe et al 1998 sarker et al 2019 the river channels organize to form self similar tree like network patterns as a result of complex landscape evolution processes cieplak et al 1998 paik and kumar 2008 tarboton et al 1988 it is important to have a quantitative understanding of drainage network morphology for modeling the processes involved in landscape evolution nones 2020 as well as modeling the landscape s hydrological response biswal and singh 2017 di lazzaro and volpi 2011 rodríguez iturbe et al 1982 understanding river network topology has immense applications in ecology as river networks act as ecological corridors for different species populations and pathogens rinaldo et al 2018 rodriguez iturbe et al 2009 human settlement patterns are also inextricably linked to the configurations of river networks ceola et al 2016 fang et al 2018 river networks should also be investigated to get some deeper theoretical insights as they exhibit some distinctive fractal properties rodriguez iturbe et al 1998 the tree like networks follow certain power law scaling relationships irrespective of the underlined controls such as geology topography and climate dodds and rothman 2000 maritan et al 1996 rigon et al 1996 these scaling laws mainly include hack s law exceeding probability distribution for the contributing area and upstream length the power law distributions are widely found in nature such as distributions of galaxies biological networks earthquake magnitudes the population of cities word frequency in literature and many socioeconomic or demographic indices newman 2005 how river basins evolve and organize into scale free tree like network topologies is not yet fully understood paik and kumar 2010 understanding river network evolution can also be helpful in understanding diverse natural phenomena that follow similar scaling laws the earliest attempts to study the drainage networks were made by horton 1945 and leopold 1962 different modeling frameworks can be found in the literature which can be classified into categories mentioned below there are models based on purely topological and statistical approaches like random walk models howard 1971 leopold 1962 scheidegger 1968 seginer 1969 shreve 1966 smart and moruzzi 1971 van pelt et al 1989 observational and experimental studies done in laboratory setup cheraghi et al 2018 pelletier 2003 schumm et al 1987 wittmann et al 1991 process based models which try to model actual physical processes using mathematical equations bonetti et al 2020 codilean et al 2006 paik and kumar 2008 perron et al 2012 tucker and hancock 2010 willgoose et al 1991b 1990 and then there are optimality based models giacometti 2000 paik 2011 rigon et al 1993 rinaldo et al 1992 rodriguez iturbe et al 1992a there are advantages and disadvantages to different modeling approaches the process based models try to incorporate detailed complex processes such as erosion and sediment deposition involved in landscape evolution these models are very sensitive to assumptions about the initial condition of the landscape features kwang and parker 2019 generally process based models focus on overall landscape features such as elevation profiles and sediment transport and not just river network organization the experimental models are carried out in rainfall erosion facilities pelletier 2003 these models can explain the dynamic nature of drainage networks and they also provide the data for testing hypotheses regarding mechanisms responsible for the observed geomorphic features bennett and liu 2016 rhoads 2020 optimality based models postulate an optimization principle underlying the evolution of drainage patterns and attempt to optimize that attribute throughout the landscape using an optimization algorithm leopold 1962 paik and kumar 2010 rodríguez iturbe et al 1992 yang and song 1979 different models have applied different optimization principles such as maximum entropy minimum stream power minimum energy expenditure etc but there isn t complete agreement on what is being optimized refer to paik kumar 2010 for a detailed review of optimality approaches purely statistical or topological models are more simplistic as they model the river network formation as a purely random process such statistical models try to explain the overall organization of river networks and related statistical properties including the scaling laws mentioned above random walk and random topology models are widely known in the domain of statistical models there are statistical models which involve probabilistic decisions in network formation with a certain physical basis e g troutman and karlinger 1992 some of the models have applied the headward growth approach through probabilistic decisions howard 1971 smart and moruzzi 1971 however in existing headward growth approaches random walks or probabilistic decisions are not based on any physical basis existing headward growth based statistical models were not evaluated for the scaling laws and they were not developed further to explain the relevant geomorphic network properties they do not explain any differences in network characteristics such as watershed compactness coefficient and hack s exponent here we have proposed a probability based headward growth model to simulate drainage network evolution the approach is analogous to the earlier headward growth models but here we have incorporated the network growth based on probabilities derived from the basis of certain physically relatable variables such as downstream length and flow accumulation the model attempts to explain the drainage network evolution and its organization into self similar tree like patterns the model parameters provide flexibility to generate networks with different shapes and characteristics thus the presented model can be useful to explain the differences in network patterns observed in nature the model is described in the following section 2 model description 2 1 model assumptions consider a landscape where the channel networks are yet to be evolved before the channel incision begins the flow directions will be determined by the existing gradients there will be more discharge accumulation towards lower elevation areas as channel incision processes are likely to start in areas receiving higher flow channel formation generally starts in the lower elevation areas this is evident from the experimental landscape evolution studies pelletier 2003 rhoads 2020 once a channel is formed its nearby areas become vulnerable to channel incision since sediment erosion at a point increases with discharge tucker and hancock 2010 willgoose et al 1991 it is reasonable to assume that the areas bordering the already evolved drainage network will be more prone to erosion and be part of the evolving drainage network furthermore a channel head moving at a faster rate suggests it keeps receiving a higher amount of flow this also means the longer the distance to the outlet of a channel head the higher the probability it will travel faster than other competing channel heads with a relatively shorter distances to the outlet thus although network growth is possible in all directions there will be a higher probability towards the headward direction this assumption is supported by the empirical evidence from experimental studies parker 1977 pelletier 2003 the other aspect of the model concerns assigning flow directions to these evolving drainage pixels the flow generally happens in the direction of the steepest gradient however there is heterogeneity in the surface resistance distribution caused by local factors such as vegetation land use grain size etc this local heterogeneity plays the role of randomness during the localized channel growth 2 2 the proposed model the model is demonstrated using a planar matrix fig 1 which represents a hypothetical landscape area initially all the border pixels are assumed to flow outwards this is analogous to an island where all boundary pixels are flowing outwards as the simulation proceeds the network growth will happen from these border outlets based on probabilistic decisions these probabilities are derived from the above mentioned process assumptions which are explained later at each step of the simulation we shall have three types of pixels fig 1a shows the initial setup the first type is drainage pixels to whom the flow direction has been assigned drainage pixels represent the evolved drainage network pixels neighbouring to these drainage pixels are the potential pixels which are prone to be part of evolving drainage networks in subsequent steps and the third type is uninvolved pixels at each step we will select one pixel from the pool of potential pixels and assign a flow direction to it with this the chosen potential pixel is converted to a drainage pixel thus the network grows by adding anew pixel at each step the algorithm goes on until all pixels are assigned with the flow direction as a result all pixels will be classified as drainage pixels at the end of the simulation at each step the potential pixel is chosen from the list by utilizing a probability function to make a random selection this function simply assigns probabilities to potential pixels based on the downstream lengths of its neighbouring drainage pixel the potential pixels neighbouring to the drainage pixels with a higher downstream length l will have a higher chance of being selected for assigning drainage direction and becoming part of the drainage network we can use a monotonically increasing function to assign probability weightages to potential pixels as a function of l here we have chosen power functions to assign probabilities because many attributes for drainage networks follow power laws this is mathematically represented by the equation p pixel l α here the parameter α represents the weightage of downstream lengths in assigning probabilities to the respective pixels fig 1b shows the schematic of probabilities for choosing a potential pixel at an intermediate step the next step is to assign a flow direction to the potential pixel chosen in the previous step eight different flow directions are considered here the choice of flow direction is made by a probability function based on flow accumulation ad values of surrounding drainage pixels here flow direction will be more probable towards drainage pixel having higher flow accumulation value note that the drainage direction is assigned only towards existing drainage pixels this is represented by the following equation p f d a d β here β represents the weightage of flow accumulation values in assigning probabilities to the surrounding drainage pixels fig 1c shows the schematic of these probabilities for a sample example demonstrated below let s understand the simulation algorithm with an example the simulation starts from the initial setup fig 1a and stops when all pixels are assigned with drainage direction the flow accumulation value is set at 1 for these border pixels at the start of the simulation this value of flow accumulation represents the extent of discharge being received by that drainage pixel these values are updated at each step as more drainage pixels are added to the drainage network now a pixel has to be chosen from the list of potential pixels since all drainage pixels border outlets have equal downstream length now there is an equal probability for all potential pixels to be the next drainage pixel let s suppose a pixel in the 5th row and 2nd column that is 5 2 in fig 1b is randomly chosen in the first step now it will have three possible flow directions that are west northwest and southwest since all the neighbouring 3 pixels have equal flow accumulation that is 1 and all three flow directions are equally probable one of the three would be randomly assigned let s suppose the algorithm assigned the northwest flow direction now this pixel will be counted as a drainage pixel and we will add its neighbouring uninvolved pixels 4 3 5 3 6 3 to the list of potential pixels we will update the flow accumulation value of pixel 5 1 to 2 and of 5 2 to 1 also the updated downstream lengths of 5 2 will be 2 note that in the next step newly added potential pixels will have a slightly higher probability than others because of the higher downstream length of their neighbouring pixel 5 2 fig 1b and c try to explain the probabilities associated with the downstream length and higher flow accumulation values for a snapshot of simulation with a smaller grid sized matrix 3 results and discussion 3 1 headward growth generates tree like patterns fig 2 shows the drainage network evolution obtained on a 250 250 grid as a result of a sample simulation for α 0 and β 0 i e growth with equal probability for all concerned pixels the resulting network fig 2c shows the formation of tree like patterns this suggests that the headward growth is sufficient to generate tree like network patterns the model s network growth extends all the way to the watershed divide s last pixel note that we have applied the flow accumulation threshold of 100 pixels to show the drainage networks in subsequent figures since there is significant involvement of randomness in the process of drainage network evolution each simulation produces a unique drainage network 3 2 model with parameters simulating networks with varying shapes and sizes the simulations with different α and β values produce networks with different shapes and sizes however the simulated networks for any particular set of α and β share remarkable statistical similarities fig 3 shows drainage network evolution for different α values for constant β 1 the parameter α is related to the overall sizes of the basins formed if the α is kept as zero although the network formation is random we see statistical emergence of symmetric growth from all four sides figs 2c 3c the distinction of networks along the diagonal lines can be observed this is because of the equal probability of growth from all four sides when we increase the α the competition of growing networks from all sides is constrained the networks growing at a higher pace get more space to grow it can be observed that the networks with lower α are more elongated because of this network growth competition fig 3 thus the α parameter impacts the sizes of the basin formed and the size of largest basin formed increases with α we calculated the fraction of area of the largest basin formed in the simulation with respect to total matrix area fig 4 shows how this area fraction increases with α the β parameter represents dynamics due to local randomness it is concerned with the network characteristics shaped by local interactions the networks for different β are shown in fig 5 the figures of simulations for different β for constant α 1 are shown here but similar observations were found for other α values as well although there are no clearly observable differences in networks with β variation slight increase in the compactness or roundedness of basins can be noticed as β increases fig 5 we calculated the gravelius compactness coefficient to quantitatively account for the differences in the shapes of networks it is defined as the ratio of the perimeter of the watershed to the circumference of a circle whose area is equal to that of the given drainage basin we calculated it for the largest 50 basins formed in the simulation fig 6 shows that the gravelius compactness coefficients decreases with α as well as β a lower value of gravelius coefficient suggests a more compact network fig 3 clearly shows that with increasing α the networks become more compact or rounded similarly fig 5 also depicts how networks are getting compact on increasing β when another parameter α is kept constant this can be intuitively understood from fig 1 c the higher β would give the higher probability for the center pixel to flow towards the downside compared to any other side thus with higher β the newly evolving pixels get drawn towards surrounding pixels with higher flow accumulation than newly evolved pixels with relatively smaller flow accumulation value which are towards the growing side of the network this eventually leads to a relatively compact network we also estimated standard sinuosity distance along the stream divided by minimum distance between two ends of stream for the largest watershed formed in the simulation but did not find any significant trend with any of the parameters the next section will explain how all of these networks are similar to real river networks since they follow the same statistical scaling laws topological and statistical models mentioned earlier howard 1971 smart and moruzzi 1971 had considered randomness and probabilistic headward growth however the probabilities considered for headward growth in these models did not resemble any physical variables the well known optimal channel network model rigon et al 1993 could explain the power law relationships by suggesting that drainage networks organize themselves in order to minimize total energy expenditure paik and kumar 2008 gave a process based model to explain the river network organization based on inherent randomness however existing models don t generally attempt to explain the networks of different shapes and characteristics the proposed model provides this added advantage with its two free parameters different landscapes show different network organization further study would be required to identify appropriate geomorphic indices to characterize different network patterns and understand their relation with proposed models parameters thus the model holds potential to be developed further to quantitatively explain the differences in drainage network organization there is further scope to understand whether these parameters can explain the specific statistical morphometric network characteristics corresponding to natural basins in different geological and climatic settings as mentioned in ranjbar et al 2018 sassolas serrayet et al 2018 yi et al 2018 currently we have used power functions for assigning probabilities however other increasing functions can be looked upon and their relevance to physical headward growth can be explored in future 3 3 modelled networks follow scaling laws many studies in the past have quantified shared characteristics of natural drainage networks one such attempt is hack s law which is an empirical power law relationship between the length of streams and the area of their basins denoted as l ah here l is the upstream distance of a pixel from the watershed divide along the stream and a is the corresponding contributing area hack 1957 in this case since all the pixels have undergone a similar process of evolution we can expect all the pixels which are part of the drainage network to follow hack s relationship as suggested by rigon et al 1996 we computed hack s exponent from the scatter plot of all the pixels having flow accumulation value greater than 50 we always got the hack s exponent value around 0 57 0 04 for multiple simulations even with different combinations of parameters fig 8a shows the hack s law relationship for a sample simulation other important power law scaling relationships found in natural river basins are the distributions of contributing areas and upstream lengths rigon et al 1996 i rodríguez iturbe et al 1992a we can obtain the exceedance probability of contributing area as p ad δ representing the number of pixels in watershed having contributing areas greater than δ or the probability that a pixel chosen at random will have a contributing area greater than δ similarly we can find the exceedance probability of upstream lengths as p x l where x is the upstream distance from that point to the watershed divide along the flow directions these relationships can be expressed as p ad δ δ ε and p x l l ϕ these relationships have been observed to follow fairly constant values of exponents in real river basins we computed exponent values ε and ϕ for the largest watershed formed in the simulation figs 7 b and c these exponent values came out to be around 0 45 0 03 and 0 72 0 05 which are similar to the values observed in real river networks the h ε and ϕ values for real river networks have been reported to be in the range of 0 56 0 60 0 41 0 43 and 0 7 0 8 respectively dodds and rothman 1999 maritan et al 1996 paik and kumar 2008 rigon et al 1996 we experimented with the different combinations of α and β values and ran multiple simulations to account for the effect of randomness in network formation fig 8 shows the variation of scaling exponents with parameters we noticed that hack s exponent decreases with α fig 8a and slightly increases with β fig 8b however there was no discernible trend in the other two scaling exponents hack s law expression suggests that elongated networks will have a slightly higher value of the exponent this can be observed in our simulated networks as there is a decreasing trend of hack s exponent with increased α the hack s exponent is slightly increasing with increasing compactness with β as discussed earlier scaling laws are widely observed in nature the approach proposed through this model can be applied to other complex network systems it has been well established in network sciences that continuously expanding complex networks with the preferential attachment of the newly added connections to the already well connected sites produces networks with scale free power law distributions barabási and albert 1999 the present model can also be seen from a similar point of view we have an expanding drainage network where new drainage pixels are preferentially added the α can be linked with this preferential attachment where α controls the rate of preferential growth thus the network is expected to follow power law distributions the presented model s power law exponents match that of real river basins thus the model might have rightly captured certain aspects of the drainage network growth through this model we argue that the complex natural phenomena are neither completely random nor completely deterministic thus the approach of modeling complex processes using randomness coupled with physical process understanding could be very effective 3 4 modelled networks and real networks our algorithm can also be applied to general irregular boundary conditions of real case landscapes we chose two islands hawaii and tasmania with distinct drainage network shapes and tried to model them using the proposed model by choosing appropriate parameter values fig 9 shows comparison of real as well as modelled networks the differences in the drainage network structures of the islands are mainly explained by gravelius compactness coefficient as show in figs 9a c the basins of tasmania are more rounded compared to the basins of hawaii the model seems to capture the difference quite well figs 9b d the median gravelius coefficient values for the real and the modelled networks are close to 1 5 for tasmania and 2 for hawaii both real and modelled networks of the two islands show similar scaling exponents section 3 3 the values of h ε and ϕ for the real and modelled networks of the two islands respectively are close to 0 55 0 48 0 74 3 5 limitations and future scope one may argue here our model may never produce a network that fully matches a real network as landscape evolution is an example of a complex system process with significant involvement of randomness no model can capture all the details of a real river network instead the focus should be to explain the key statistical characteristics e g bak 1996 the proposed model produces static drainage networks however real river networks are dynamic in nature i e a real network may change with time due to erosion and deposition process future studies should focus on modifying the model e g by integrating it with a process base model paik and kumar 2008 to simulate dynamics of drainage networks the model provides us a 2d drainage network but these networks can be used to construct a full fledged artificial landscape topography by applying certain scaling relationships such as such as slope area relationship this has been already demonstrated with the optimal channel network model some ecological modeling studies utilize these information of derived topographic features and river network geometries carraro et al 2020 the model could be improved by including additional parameters in existing framework that represent additional physical processes in order to capture finer details of landscape evolution for example some key processes related to slope and sediment deposition are not reflected in the current model the implications of the different parameter combinations for different network types are another possibility to be explored finally the proposed general technique can be applied to other systems that exhibit scaling behavior 5 conclusions we have shown that the approach of using randomness in combination with important physical processes to simulate complex systems has been effective for modeling drainage networks the model followed the probabilistic headward growth of drainage networks the probabilities were derived from a few physically relatable variables related to network growth processes of landscape evolution the modelled drainage networks suggest quite good statistical similarities with natural river networks the values of power law scaling exponents for modeled networks namely hack s law and distribution of contributing areas and upstream length resemble that of real river networks the model also offers the flexibility of two free parameters to create different networks of varying shapes and sizes and capture differences in networks with compactness coefficient and hack s exponent the model has further scope to improve such that it can be useful to explain certain differences in network patterns finally the presented approach has also potential to be applied for systems exhibiting similar scaling behavior data statement shapefile of tasmania and hawaii were obtained from arcgis data repository https hub arcgis com datasets esri world continents about credit authorship contribution statement dnyanesh borse conceptualization software writing original draft basudev biswal conceptualization supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the authors gratefully acknowledge the research grant and scholarship received through prime minister s research fellowship pmrf from government of india we have no conflicts of interest to disclose 
71,river channels self organize to form tree like networks that follow certain statistical laws such as horton s laws and hack s law which is perhaps the reason why simple statistical models are often used to explain river network evolution however statistical models generally do not attempt to explain the differences between network structures here we address this issue by incorporating certain physically meaningful variables in a statistical modeling framework the model allows the network to grow in a headward direction via probabilistic decisions based on two free parameters simulations performed over a planar matrix result in tree like networks exhibiting power law scaling relationships as displayed by real river networks the two parameters are shown to be capable of explaining the variation of key network characteristics such as compactness coefficient and hack s exponent the uniqueness of the model thus lies in its ability to generate networks with different shapes and characteristics keywords river networks landscape evolution scaling laws self organization randomness data availability data will be made available on request 1 introduction river networks have been studied in the domains of geosciences and hydrology for scientific as well as practical importance hergarten and neugebauer 2001 montgomery 2013 newson 2002 rodríguez iturbe and valdés 1979 rodriguez iturbe et al 1998 sarker et al 2019 the river channels organize to form self similar tree like network patterns as a result of complex landscape evolution processes cieplak et al 1998 paik and kumar 2008 tarboton et al 1988 it is important to have a quantitative understanding of drainage network morphology for modeling the processes involved in landscape evolution nones 2020 as well as modeling the landscape s hydrological response biswal and singh 2017 di lazzaro and volpi 2011 rodríguez iturbe et al 1982 understanding river network topology has immense applications in ecology as river networks act as ecological corridors for different species populations and pathogens rinaldo et al 2018 rodriguez iturbe et al 2009 human settlement patterns are also inextricably linked to the configurations of river networks ceola et al 2016 fang et al 2018 river networks should also be investigated to get some deeper theoretical insights as they exhibit some distinctive fractal properties rodriguez iturbe et al 1998 the tree like networks follow certain power law scaling relationships irrespective of the underlined controls such as geology topography and climate dodds and rothman 2000 maritan et al 1996 rigon et al 1996 these scaling laws mainly include hack s law exceeding probability distribution for the contributing area and upstream length the power law distributions are widely found in nature such as distributions of galaxies biological networks earthquake magnitudes the population of cities word frequency in literature and many socioeconomic or demographic indices newman 2005 how river basins evolve and organize into scale free tree like network topologies is not yet fully understood paik and kumar 2010 understanding river network evolution can also be helpful in understanding diverse natural phenomena that follow similar scaling laws the earliest attempts to study the drainage networks were made by horton 1945 and leopold 1962 different modeling frameworks can be found in the literature which can be classified into categories mentioned below there are models based on purely topological and statistical approaches like random walk models howard 1971 leopold 1962 scheidegger 1968 seginer 1969 shreve 1966 smart and moruzzi 1971 van pelt et al 1989 observational and experimental studies done in laboratory setup cheraghi et al 2018 pelletier 2003 schumm et al 1987 wittmann et al 1991 process based models which try to model actual physical processes using mathematical equations bonetti et al 2020 codilean et al 2006 paik and kumar 2008 perron et al 2012 tucker and hancock 2010 willgoose et al 1991b 1990 and then there are optimality based models giacometti 2000 paik 2011 rigon et al 1993 rinaldo et al 1992 rodriguez iturbe et al 1992a there are advantages and disadvantages to different modeling approaches the process based models try to incorporate detailed complex processes such as erosion and sediment deposition involved in landscape evolution these models are very sensitive to assumptions about the initial condition of the landscape features kwang and parker 2019 generally process based models focus on overall landscape features such as elevation profiles and sediment transport and not just river network organization the experimental models are carried out in rainfall erosion facilities pelletier 2003 these models can explain the dynamic nature of drainage networks and they also provide the data for testing hypotheses regarding mechanisms responsible for the observed geomorphic features bennett and liu 2016 rhoads 2020 optimality based models postulate an optimization principle underlying the evolution of drainage patterns and attempt to optimize that attribute throughout the landscape using an optimization algorithm leopold 1962 paik and kumar 2010 rodríguez iturbe et al 1992 yang and song 1979 different models have applied different optimization principles such as maximum entropy minimum stream power minimum energy expenditure etc but there isn t complete agreement on what is being optimized refer to paik kumar 2010 for a detailed review of optimality approaches purely statistical or topological models are more simplistic as they model the river network formation as a purely random process such statistical models try to explain the overall organization of river networks and related statistical properties including the scaling laws mentioned above random walk and random topology models are widely known in the domain of statistical models there are statistical models which involve probabilistic decisions in network formation with a certain physical basis e g troutman and karlinger 1992 some of the models have applied the headward growth approach through probabilistic decisions howard 1971 smart and moruzzi 1971 however in existing headward growth approaches random walks or probabilistic decisions are not based on any physical basis existing headward growth based statistical models were not evaluated for the scaling laws and they were not developed further to explain the relevant geomorphic network properties they do not explain any differences in network characteristics such as watershed compactness coefficient and hack s exponent here we have proposed a probability based headward growth model to simulate drainage network evolution the approach is analogous to the earlier headward growth models but here we have incorporated the network growth based on probabilities derived from the basis of certain physically relatable variables such as downstream length and flow accumulation the model attempts to explain the drainage network evolution and its organization into self similar tree like patterns the model parameters provide flexibility to generate networks with different shapes and characteristics thus the presented model can be useful to explain the differences in network patterns observed in nature the model is described in the following section 2 model description 2 1 model assumptions consider a landscape where the channel networks are yet to be evolved before the channel incision begins the flow directions will be determined by the existing gradients there will be more discharge accumulation towards lower elevation areas as channel incision processes are likely to start in areas receiving higher flow channel formation generally starts in the lower elevation areas this is evident from the experimental landscape evolution studies pelletier 2003 rhoads 2020 once a channel is formed its nearby areas become vulnerable to channel incision since sediment erosion at a point increases with discharge tucker and hancock 2010 willgoose et al 1991 it is reasonable to assume that the areas bordering the already evolved drainage network will be more prone to erosion and be part of the evolving drainage network furthermore a channel head moving at a faster rate suggests it keeps receiving a higher amount of flow this also means the longer the distance to the outlet of a channel head the higher the probability it will travel faster than other competing channel heads with a relatively shorter distances to the outlet thus although network growth is possible in all directions there will be a higher probability towards the headward direction this assumption is supported by the empirical evidence from experimental studies parker 1977 pelletier 2003 the other aspect of the model concerns assigning flow directions to these evolving drainage pixels the flow generally happens in the direction of the steepest gradient however there is heterogeneity in the surface resistance distribution caused by local factors such as vegetation land use grain size etc this local heterogeneity plays the role of randomness during the localized channel growth 2 2 the proposed model the model is demonstrated using a planar matrix fig 1 which represents a hypothetical landscape area initially all the border pixels are assumed to flow outwards this is analogous to an island where all boundary pixels are flowing outwards as the simulation proceeds the network growth will happen from these border outlets based on probabilistic decisions these probabilities are derived from the above mentioned process assumptions which are explained later at each step of the simulation we shall have three types of pixels fig 1a shows the initial setup the first type is drainage pixels to whom the flow direction has been assigned drainage pixels represent the evolved drainage network pixels neighbouring to these drainage pixels are the potential pixels which are prone to be part of evolving drainage networks in subsequent steps and the third type is uninvolved pixels at each step we will select one pixel from the pool of potential pixels and assign a flow direction to it with this the chosen potential pixel is converted to a drainage pixel thus the network grows by adding anew pixel at each step the algorithm goes on until all pixels are assigned with the flow direction as a result all pixels will be classified as drainage pixels at the end of the simulation at each step the potential pixel is chosen from the list by utilizing a probability function to make a random selection this function simply assigns probabilities to potential pixels based on the downstream lengths of its neighbouring drainage pixel the potential pixels neighbouring to the drainage pixels with a higher downstream length l will have a higher chance of being selected for assigning drainage direction and becoming part of the drainage network we can use a monotonically increasing function to assign probability weightages to potential pixels as a function of l here we have chosen power functions to assign probabilities because many attributes for drainage networks follow power laws this is mathematically represented by the equation p pixel l α here the parameter α represents the weightage of downstream lengths in assigning probabilities to the respective pixels fig 1b shows the schematic of probabilities for choosing a potential pixel at an intermediate step the next step is to assign a flow direction to the potential pixel chosen in the previous step eight different flow directions are considered here the choice of flow direction is made by a probability function based on flow accumulation ad values of surrounding drainage pixels here flow direction will be more probable towards drainage pixel having higher flow accumulation value note that the drainage direction is assigned only towards existing drainage pixels this is represented by the following equation p f d a d β here β represents the weightage of flow accumulation values in assigning probabilities to the surrounding drainage pixels fig 1c shows the schematic of these probabilities for a sample example demonstrated below let s understand the simulation algorithm with an example the simulation starts from the initial setup fig 1a and stops when all pixels are assigned with drainage direction the flow accumulation value is set at 1 for these border pixels at the start of the simulation this value of flow accumulation represents the extent of discharge being received by that drainage pixel these values are updated at each step as more drainage pixels are added to the drainage network now a pixel has to be chosen from the list of potential pixels since all drainage pixels border outlets have equal downstream length now there is an equal probability for all potential pixels to be the next drainage pixel let s suppose a pixel in the 5th row and 2nd column that is 5 2 in fig 1b is randomly chosen in the first step now it will have three possible flow directions that are west northwest and southwest since all the neighbouring 3 pixels have equal flow accumulation that is 1 and all three flow directions are equally probable one of the three would be randomly assigned let s suppose the algorithm assigned the northwest flow direction now this pixel will be counted as a drainage pixel and we will add its neighbouring uninvolved pixels 4 3 5 3 6 3 to the list of potential pixels we will update the flow accumulation value of pixel 5 1 to 2 and of 5 2 to 1 also the updated downstream lengths of 5 2 will be 2 note that in the next step newly added potential pixels will have a slightly higher probability than others because of the higher downstream length of their neighbouring pixel 5 2 fig 1b and c try to explain the probabilities associated with the downstream length and higher flow accumulation values for a snapshot of simulation with a smaller grid sized matrix 3 results and discussion 3 1 headward growth generates tree like patterns fig 2 shows the drainage network evolution obtained on a 250 250 grid as a result of a sample simulation for α 0 and β 0 i e growth with equal probability for all concerned pixels the resulting network fig 2c shows the formation of tree like patterns this suggests that the headward growth is sufficient to generate tree like network patterns the model s network growth extends all the way to the watershed divide s last pixel note that we have applied the flow accumulation threshold of 100 pixels to show the drainage networks in subsequent figures since there is significant involvement of randomness in the process of drainage network evolution each simulation produces a unique drainage network 3 2 model with parameters simulating networks with varying shapes and sizes the simulations with different α and β values produce networks with different shapes and sizes however the simulated networks for any particular set of α and β share remarkable statistical similarities fig 3 shows drainage network evolution for different α values for constant β 1 the parameter α is related to the overall sizes of the basins formed if the α is kept as zero although the network formation is random we see statistical emergence of symmetric growth from all four sides figs 2c 3c the distinction of networks along the diagonal lines can be observed this is because of the equal probability of growth from all four sides when we increase the α the competition of growing networks from all sides is constrained the networks growing at a higher pace get more space to grow it can be observed that the networks with lower α are more elongated because of this network growth competition fig 3 thus the α parameter impacts the sizes of the basin formed and the size of largest basin formed increases with α we calculated the fraction of area of the largest basin formed in the simulation with respect to total matrix area fig 4 shows how this area fraction increases with α the β parameter represents dynamics due to local randomness it is concerned with the network characteristics shaped by local interactions the networks for different β are shown in fig 5 the figures of simulations for different β for constant α 1 are shown here but similar observations were found for other α values as well although there are no clearly observable differences in networks with β variation slight increase in the compactness or roundedness of basins can be noticed as β increases fig 5 we calculated the gravelius compactness coefficient to quantitatively account for the differences in the shapes of networks it is defined as the ratio of the perimeter of the watershed to the circumference of a circle whose area is equal to that of the given drainage basin we calculated it for the largest 50 basins formed in the simulation fig 6 shows that the gravelius compactness coefficients decreases with α as well as β a lower value of gravelius coefficient suggests a more compact network fig 3 clearly shows that with increasing α the networks become more compact or rounded similarly fig 5 also depicts how networks are getting compact on increasing β when another parameter α is kept constant this can be intuitively understood from fig 1 c the higher β would give the higher probability for the center pixel to flow towards the downside compared to any other side thus with higher β the newly evolving pixels get drawn towards surrounding pixels with higher flow accumulation than newly evolved pixels with relatively smaller flow accumulation value which are towards the growing side of the network this eventually leads to a relatively compact network we also estimated standard sinuosity distance along the stream divided by minimum distance between two ends of stream for the largest watershed formed in the simulation but did not find any significant trend with any of the parameters the next section will explain how all of these networks are similar to real river networks since they follow the same statistical scaling laws topological and statistical models mentioned earlier howard 1971 smart and moruzzi 1971 had considered randomness and probabilistic headward growth however the probabilities considered for headward growth in these models did not resemble any physical variables the well known optimal channel network model rigon et al 1993 could explain the power law relationships by suggesting that drainage networks organize themselves in order to minimize total energy expenditure paik and kumar 2008 gave a process based model to explain the river network organization based on inherent randomness however existing models don t generally attempt to explain the networks of different shapes and characteristics the proposed model provides this added advantage with its two free parameters different landscapes show different network organization further study would be required to identify appropriate geomorphic indices to characterize different network patterns and understand their relation with proposed models parameters thus the model holds potential to be developed further to quantitatively explain the differences in drainage network organization there is further scope to understand whether these parameters can explain the specific statistical morphometric network characteristics corresponding to natural basins in different geological and climatic settings as mentioned in ranjbar et al 2018 sassolas serrayet et al 2018 yi et al 2018 currently we have used power functions for assigning probabilities however other increasing functions can be looked upon and their relevance to physical headward growth can be explored in future 3 3 modelled networks follow scaling laws many studies in the past have quantified shared characteristics of natural drainage networks one such attempt is hack s law which is an empirical power law relationship between the length of streams and the area of their basins denoted as l ah here l is the upstream distance of a pixel from the watershed divide along the stream and a is the corresponding contributing area hack 1957 in this case since all the pixels have undergone a similar process of evolution we can expect all the pixels which are part of the drainage network to follow hack s relationship as suggested by rigon et al 1996 we computed hack s exponent from the scatter plot of all the pixels having flow accumulation value greater than 50 we always got the hack s exponent value around 0 57 0 04 for multiple simulations even with different combinations of parameters fig 8a shows the hack s law relationship for a sample simulation other important power law scaling relationships found in natural river basins are the distributions of contributing areas and upstream lengths rigon et al 1996 i rodríguez iturbe et al 1992a we can obtain the exceedance probability of contributing area as p ad δ representing the number of pixels in watershed having contributing areas greater than δ or the probability that a pixel chosen at random will have a contributing area greater than δ similarly we can find the exceedance probability of upstream lengths as p x l where x is the upstream distance from that point to the watershed divide along the flow directions these relationships can be expressed as p ad δ δ ε and p x l l ϕ these relationships have been observed to follow fairly constant values of exponents in real river basins we computed exponent values ε and ϕ for the largest watershed formed in the simulation figs 7 b and c these exponent values came out to be around 0 45 0 03 and 0 72 0 05 which are similar to the values observed in real river networks the h ε and ϕ values for real river networks have been reported to be in the range of 0 56 0 60 0 41 0 43 and 0 7 0 8 respectively dodds and rothman 1999 maritan et al 1996 paik and kumar 2008 rigon et al 1996 we experimented with the different combinations of α and β values and ran multiple simulations to account for the effect of randomness in network formation fig 8 shows the variation of scaling exponents with parameters we noticed that hack s exponent decreases with α fig 8a and slightly increases with β fig 8b however there was no discernible trend in the other two scaling exponents hack s law expression suggests that elongated networks will have a slightly higher value of the exponent this can be observed in our simulated networks as there is a decreasing trend of hack s exponent with increased α the hack s exponent is slightly increasing with increasing compactness with β as discussed earlier scaling laws are widely observed in nature the approach proposed through this model can be applied to other complex network systems it has been well established in network sciences that continuously expanding complex networks with the preferential attachment of the newly added connections to the already well connected sites produces networks with scale free power law distributions barabási and albert 1999 the present model can also be seen from a similar point of view we have an expanding drainage network where new drainage pixels are preferentially added the α can be linked with this preferential attachment where α controls the rate of preferential growth thus the network is expected to follow power law distributions the presented model s power law exponents match that of real river basins thus the model might have rightly captured certain aspects of the drainage network growth through this model we argue that the complex natural phenomena are neither completely random nor completely deterministic thus the approach of modeling complex processes using randomness coupled with physical process understanding could be very effective 3 4 modelled networks and real networks our algorithm can also be applied to general irregular boundary conditions of real case landscapes we chose two islands hawaii and tasmania with distinct drainage network shapes and tried to model them using the proposed model by choosing appropriate parameter values fig 9 shows comparison of real as well as modelled networks the differences in the drainage network structures of the islands are mainly explained by gravelius compactness coefficient as show in figs 9a c the basins of tasmania are more rounded compared to the basins of hawaii the model seems to capture the difference quite well figs 9b d the median gravelius coefficient values for the real and the modelled networks are close to 1 5 for tasmania and 2 for hawaii both real and modelled networks of the two islands show similar scaling exponents section 3 3 the values of h ε and ϕ for the real and modelled networks of the two islands respectively are close to 0 55 0 48 0 74 3 5 limitations and future scope one may argue here our model may never produce a network that fully matches a real network as landscape evolution is an example of a complex system process with significant involvement of randomness no model can capture all the details of a real river network instead the focus should be to explain the key statistical characteristics e g bak 1996 the proposed model produces static drainage networks however real river networks are dynamic in nature i e a real network may change with time due to erosion and deposition process future studies should focus on modifying the model e g by integrating it with a process base model paik and kumar 2008 to simulate dynamics of drainage networks the model provides us a 2d drainage network but these networks can be used to construct a full fledged artificial landscape topography by applying certain scaling relationships such as such as slope area relationship this has been already demonstrated with the optimal channel network model some ecological modeling studies utilize these information of derived topographic features and river network geometries carraro et al 2020 the model could be improved by including additional parameters in existing framework that represent additional physical processes in order to capture finer details of landscape evolution for example some key processes related to slope and sediment deposition are not reflected in the current model the implications of the different parameter combinations for different network types are another possibility to be explored finally the proposed general technique can be applied to other systems that exhibit scaling behavior 5 conclusions we have shown that the approach of using randomness in combination with important physical processes to simulate complex systems has been effective for modeling drainage networks the model followed the probabilistic headward growth of drainage networks the probabilities were derived from a few physically relatable variables related to network growth processes of landscape evolution the modelled drainage networks suggest quite good statistical similarities with natural river networks the values of power law scaling exponents for modeled networks namely hack s law and distribution of contributing areas and upstream length resemble that of real river networks the model also offers the flexibility of two free parameters to create different networks of varying shapes and sizes and capture differences in networks with compactness coefficient and hack s exponent the model has further scope to improve such that it can be useful to explain certain differences in network patterns finally the presented approach has also potential to be applied for systems exhibiting similar scaling behavior data statement shapefile of tasmania and hawaii were obtained from arcgis data repository https hub arcgis com datasets esri world continents about credit authorship contribution statement dnyanesh borse conceptualization software writing original draft basudev biswal conceptualization supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the authors gratefully acknowledge the research grant and scholarship received through prime minister s research fellowship pmrf from government of india we have no conflicts of interest to disclose 
72,when a gravity current interacts with a barrier the flow is reflected back in the form of a moving hydraulic jump or bore this latter phenomenon has important implications for estuarine mixing and sediment reworking in the oceanographic context in order to examine those reflection processes two dimensional gravity currents interacting with slopes and overhanging barriers are examined by laboratory experiments and theoretical analysis relevant parameters such as the initial volume of the dense fluid the opening of the fixed gate used for the dense fluid release and the angle of the slope or overhang positioned inside the tank were varied an image analysis technique based on light attenuation was applied to evaluate the instantaneous density fields the theoretical predictions based on shallow water theory give reasonable agreement compared with the laboratory experiments about the spatial position of the dense current and the definition of the point where the reflection process starts moreover the analysis of the density fields highlights the presence of areas within the dense current characterized by a greater dilution due to the reflection of the current nevertheless the bulk entrainment parameter is only slightly affected by the presence of a steep slope or overhang keywords gravity currents theoretical model reflection process entrainment data availability data will be made available on request 1 introduction gravity currents are flows driven by density differences within a fluid the latter can be caused by temperature differences salinity gradients dissolved substances or particulates these flows widely occur spontaneously in nature or also as outcome from human activities dense oceanic currents avalanches sand storms accidental oil spills to marine areas or released pollutant mass dispersing in rivers are a few examples of gravity currents simpson 1997 mixing across stable density interfaces because of background turbulence is a frequent phenomenon in geophysical and engineering flows fernando 1991 such mixing processes play a fundamental role in the dynamics of dense currents because they contribute to the dilution of the current which in turn changes the buoyancy forces driving the motion itself since the dynamics of gravity currents are affected by the amount of the entrained ambient fluid different studies have been focused on this issue nogueira et al 2014 de falco et al 2020 2021a ottolenghi et al 2016b wilson et al 2017 zordan et al 2018 modelling of gravity currents mainly relies on classical studies made on uniform horizontal surfaces adduce et al 2012 ottolenghi et al 2016a inghilesi et al 2018 he et al 2021 while the importance of the topographic features on the development of the density current has only recently been recognized dai 2013 la rocca et al 2013 cuthbertson et al 2014 2018 dai and huang 2021 adduce et al 2022 maggi et al 2022 several theoretical and experimental studies have been conducted on the dynamics of the gravity currents over complex boundaries for instance de falco et al 2021b through laboratory tests and a detailed density measurements explored the dense current interaction with an isolated obstacle with a focus on the entrainment processes moreover negretti et al 2008 investigated the effect of a rough bottom on the interfacial instabilities for a two layer exchange flow over a sill using sparse and dense roughness elements beside experimental analysis many studies employing numerical models can be found in literature ooi et al 2009 tokyay et al 2014 inghilesi et al 2018 just a few studies deal with the reverse flow generated by the interaction of the gravity current with bottom slopes gonzalez juez et al 2009 2010 highlighting how the relation between the angles of the slopes to the oncoming current and to the reflected jump have important implications for estuarine mixing and sediment reworking in the oceanographic context thorpe 1983 kneller and mccaffrey 1999 our study extends the work of lane serff et al 1995 where the interaction between a gravity current and a bottom triangular obstacle was considered lane serff et al 1995 was mainly focused on the overflow of the incoming gravity current and did not study the transients connected with the reflection process here we present a more detailed study of the reflection process focusing our attention on completely blocked flows in order to analysed the dense current reflected the reflections of two dimensional gravity currents from simple slopes i e up slope and from cases steeper than vertical barriers i e an overhang are considered these flows can be encountered in a number of natural and industrial contexts the up slope mimics for example when a sea breeze meets a high ridge or a dense turbidity current meets a continental shelf or sea mount the overhang case where the upper boundary slopes down to the floor can occur where a dense current meets the grounding line of an ice shelf or in some geological or industrial flows where a dense intrusion flows along the lower boundary of a contained region with a downward sloping roof this flow is also equivalent to a light gravity current flowing along a horizontal upper surface with the lower boundary sloping up to the surface see fig 1 this is the case for example when a fresh water outflow meets a beach an observation of reflected fresh water flows is given by thorpe 1983 and flow reflected by an overhanging barrier is described briefly by simpson 1997 in this work we present a comprehensive analysis of the gravity currents dynamics including a focus on the entrainment processes based on laboratory experiments using a non intrusive technique moreover we introduce a theoretical model based on a slowly varying shallow water theory approach our model has some similarities with simpson 1997 indeed we assume that as the current approaches the foot of the barrier it occupies a constant portion of the total channel depth the paper is structured as follows the experimental measurements are given in section 2 in section 3 we set out the shallow water theory approach a qualitative description of the dynamics of the interaction with the barrier the experimental results and the comparison with the theoretical model are discussed in section 4 specifically the dense flow propagation and the analysis of the non dimensional averaged density fields are presented respectively in section 4 2 and section 4 3 section 4 4 is mainly focused on the entrainment processes through the analysis of the non dimensional area of the current and the bulk entrainment parameter finally section 5 gives a summary of key results 2 experimental setup and laboratory experiments the laboratory experiments are carried out at the hydraulics laboratory of the roma tre university in a perspex tank with a length height and width of 3 m 0 3 m and 0 2 m respectively the experimental apparatus shown in fig 2a is similar to that described in lane serff et al 1995 by which it is possible to reproduce steady gravity currents the lock reservoir is realized with a fixed gate placed at l 0 0 4 m leaving a rectangular opening at the bottom across the width of the tank the opening is covered by a 4 mm thick removable vertical gate a uniform perspex slope is located at l t 0 85 m from the fixed gate with different angles θ in order to represent up slopes vertical barriers or overhanging barriers for each experiment the first part of the tank is filled with salty water with initial density ρ 1 while the rest of the tank is filled with an ambient fluid of density ρ 0 ρ 1 all the experiments are conducted with a constant δ ρ 40 kg m 3 where δ ρ ρ 1 ρ 0 an electronic density meter anton paar dma 4100m is used to perform initial density measurements furthermore a controlled quantity of dye is added to the salty water in order to visualize the dense flow the run starts when the sliding gate is suddenly removed and an exchange flow through the opening develops a dense flow starts from the left part of the tank to the right part forming a gravity current while at the same time a turbulent plume of fresh water rises into the lock reservoir during the propagation of the current the dense fluid entrains the lighter one causing mixing and dilution of the dense current the experiment stops when the reflected dense flow generated by the presence of the slope reaches the opening of the fixed gate each experiment is acquired by a ccd charged couple device camera with a frequency of 25 hz and a spatial resolution of 1024 668 pixels the camera is positioned at a fixed distance in front of the tank and the accuracy of the measurement is 3 mm pixel a backlight system is employed to provide a uniform light each frame of the acquired movie is converted into a matrix of grey levels with values ranging from 0 black to 255 white in order to evaluate the instantaneous density fields an image analysis technique is applied as in la forgia et al 2020 de falco et al 2021b c and adduce et al 2022 for each experiment nine calibration images with known and controlled concentrations of dye are acquired the nine calibration images are used to obtain a pixel based calibration curve allowing the conversion of the greyscale into density values the relative deviation between the total mass of salt in the tank and the total mass of salt evaluated experimentally is 0 15 as already observed by adduce et al 2022 the dimensionless density field is defined as 1 ρ x y t ρ x y t ρ 0 ρ 1 ρ 0 where ρ x y t is the local density of the current the cartesian reference system is shown in fig 2a fifteen up slope experiments including three with a vertical barrier and ten experiments with an overhanging barrier are performed two different openings of the fixed gate are used h g 0 05 m and h g 0 1 m and the initial total water depths are h 0 0 3 m and h 0 0 15 m the angles of the barriers θ s for the slope angle and θ o for the overhang angle are varied between 15 and 90 as shown in fig 2b the up slope sruns the vertical experimental runs vruns and the overhang runs oruns are summarized in table 1 the froude f r u f g d 0 0 5 and reynolds number r e u f d 0 ν based on initial quantities with u f the front velocity of the dense flow d 0 the height of the tail of the incoming gravity current g the reduced and ν the kinematic viscosity are also presented in table 1 3 theoretical model as stated in the introduction the approach used in this study is based on shallow water theory and present some similarities with lane serff et al 1995 however some of the transient features of the flow cannot be described by this technique when a gravity current first meets a slope while most of the dense current is reflected back a portion of the dense current continues up the slope much farther than the final level of the steady reflected flow we denote this process as splash this is obviously significant for example in the design of barriers to contain accidental dense gas releases shallow water theory assumes distinct layers of fluid whereas in practice there is mixing between the gravity current and the surrounding fluid this is especially true when the gravity current is reflected the speed of the incoming gravity current u can be described in terms of froude number f r u g d where g is the reduced gravity and d is the height of the tail of the gravity current in lane serff et al 1995 a simple power law was fitted to the observed relationship between the froude number and the relative depth of the channel while the observations showed that froude number increased with channel depth they also showed that the froude number tended towards a maximum value the limit for very deep channels rather than fit a different type of function one which has a maximum value we will use the same power law here but impose an explicit upper bound on the froude number so that the froude number is given by 2 f r 0 56 h d 0 22 h 12 d 3 f r 1 h 12 d where h is the depth of the channel when the gravity current meets the barrier the flow is reflected in the form of a moving hydraulic jump or bore the change in the flow either side of the bore is found by using jump conditions matching the momentum and mass flux and allowing for energy loss in lane serff et al 1995 the energy loss is assumed to be confined to the lower layer giving non hydrostatic pressure change across the jump wood and simpson 1984 the theoretical analysis of the partial or complete reflection of gravity currents by obstacles is discussed in lane serff et al 1995 including non boussinesq effects the effects of a free surface and the effects of a passive third layer and so we do not repeat that analysis here for the present work however it is useful to extract the results from lane serff et al 1995 for the complete reflection of gravity current under the boussinesq approximation we assume here that changes in free surface height are negligible so that the free surface can be approximated by a rigid lid for shallow channels h less than approximately 2 9 the equations allow for a faster moving smaller bore than that predicted by assuming a single sharp jump from one depth to another this suggest that the reflection in those cases would be a bore of this shallower depth followed by a rarefaction a smooth and constantly changing adjustment to the final depth the difference in speed is relatively small and we are concentrating on flow in relatively deep channels in this paper so we will generally ignore rarefactions here more details on the rarefactions in two layer flows are given by baines 1984 the incoming gravity current and the reflected dense flow from the barrier has been examined by a thorough theoretical analysis based on that formulated by lane serff et al 1995 with a more detailed study on the reflection process of completely blocked flow in the following we provide a brief recapitulation of the basic concepts of the analysis while the detailed description of the theoretical model can be found in lane serff et al 1995 as will be discussed more thoroughly in the following paragraphs when the gravity current meets the barrier the flow is reflected in the form of a moving hydraulic jump or bore the flow is divided into two layers the upper layer and the lower one and the change in the flow is found by using jump conditions matching the momentum and mass flux balance equations it is assumed that changes in free surface height are negligible so the free surface can be approximated by a rigid lid moreover the topography is considered sufficiently slowly varying so the vertical velocities and accelerations may be neglected and also viscous effects can be ignored in this manner the velocity varies with the horizontal position but not with the height of the dense flow so that the shallow water theory can be used for further information about he theoretical model assumptions see lane serff et al 1995 the problem is formalized adopting a suitable non dimensional form of the equations the heights are divided by the height of the tail of the incoming gravity current d 0 in particular the non dimensional total depth before the barrier is h 0 h 0 d 0 while the dimensionless horizontal distance x and time t are respectively 4 x x d 0 tan 9 0 θ 5 t t d 0 g tan 9 0 θ where x x l t is the distance between the reference system adopted and the slope position l t g g ρ 1 ρ 0 ρ 0 and θ is the degree tilting of the barrier therefore it is obtained the gradient of the slope or overhang equal to one in non dimensional units 3 1 effective reflection point in terms of the gravity current and bore positions measured far from the barrier the gravity current seems to have an effective reflection point at some distance from the foot of the barrier once the gravity current has been reflected neglecting the small fluctuations at the interface between the dense fluid and the ambient one downstream of the moving bore the fluid interface between the upper and the lower layer of the dense fluid has to be horizontal and stationary thus the position of the effective reflection point can be calculate how 6 x r 0 5 b tan 9 0 θ equivalent to the non dimensional distance 7 x r 0 5 b d 0 upstream of the barrier for overhangs or downstream of the barrier for slopes fig 3 3 2 up slope cases under the shallow water theory assumptions the non dimensionalisation adopted transforms the results for different slope angles onto a unique curve at least for flows in channels of the same relative depth h 0 the behaviour of the dense flow that continues to advance once the barrier is reached cannot be described by shallow water theory because it seems to be related to the gravity current head however we notice that the advancement of the portion of the dense current flowing on the slope is very limited because of the inclination of the slope itself and moreover affected by the top of the channel 3 3 overhang cases in case of overhanging barrier the slope of the upper boundary is assumed constant so the gravity current is approaching the barrier from deep water when h i d 0 12 where h i is the depth of the channel the current has constant depth d 0 and the front moves with constant speed given by 8 u 0 g d 0 as the current approaches the barrier we assume that it conserves volume flux so that u 0 d 0 u d but with the gravity current height d and speed u adjusting as the channel depth h decreases in accordance with eq 2 from conservation of volume flux and eq 8 we have 9 u u 0 d 0 d g d 0 d 0 d so the froude number is given by 10 f r u g d d 0 d 3 2 substituting eq 10 into eq 2 gives 11 d 0 d 3 2 0 22 0 56 h d 0 0 22 raising eq 11 to 1 1 28 shows that when 12 h d 0 2 66 the current depth d increases and the speed decreases 12 d d 0 1 57 h d 0 0 17 13 u u 0 0 64 h d 0 0 17 however the gravity current height is limited to half the local channel depth and once the current has 2 66 h d 0 0 the volume flux cannot be conserved and the reflection process begins from this point we assume that the current continues to occupy half the channel depth d h 2 simpson 1997 and the current decelerate following the trend 14 u u 0 0 46 h d 0 0 5 this last system of equations is solved by an iterative algorithm fixing the time origin as the time when the current reaches the foot of the barrier the transition points h d 0 12 and h d 0 2 66 occur respectively at t 19 7 and t 7 1 thus a complete description of the deceleration of the gravity current as it approaches an overhang is carried out based upon results from constant speed gravity current in the following paragraphs this theoretical prediction will be compared with the experimental results 4 results 4 1 qualitative observations of flow evolution visual inspection of the recorded movies reveals that the nature of the barrier strongly affects the dynamics of the gravity current especially the reflection process to better understand the significant differences between an up slope and an overhanging barrier two series of snapshots for the experiment s 10 h 0 0 3 m h g 0 1 m θ s 3 0 and o 8 h 0 0 3 m h g 0 1 m θ o 3 0 and non dimensional instantaneous density fields are shown in fig 4 as the gate is removed the initial development of the dense flow is similar for both cases the incoming gravity current has the characteristic form with a slightly raised nose and a head region higher than the following tail fig 4a b in the up slope case the current decelerates as it flows up the slope the head of the current becomes thinner and a reflected bore can be seen propagating back upstream fig 4c a transient splash continues to flow up the slope around the final height fig 4b some mixing can be observed during the reflection process fig 4e in the overhang case the current decelerates as it approaches the foot of the barrier being affected by its presence the impact determines a reverse flow associated with a mixing zone close to the barrier characterized by a height higher than the steady return flow fig 4d also in this case the reflected current can generate a bore propagating back upstream fig 4f in all experiments the shape of the reflected flow will depend on the opening of the fixed gate h g the reverse flow may take the shape of a group of smooth symmetrical waveforms with no mixing at the upper interface or alternatively an asymmetrical shape with much turbulent mixing on its leeside as already observed by edwards et al 1994 in the overhang case the mixing associated with the reflection process seems to be greater than for the up slope fig 4g and 4c 4 2 position of the incoming gravity current and outgoing bores the instantaneous front position of the current x f is defined as the foremost point of the nose of the dense current the experimental front position is obtained by using the non dimensional iso density contour at ρ 2 and following the time advancement of the first point of the dense current along the x direction the position of the reflected current x b is defined as the time advancement of the first point identified using a non dimensional iso density contour at ρ 50 on an intermediate height between d and the bore height d b along the reverse direction of the initial motion i e the mean thickness of the bore waveform edwards et al 1994 the height of the tail of the incoming gravity current d is also defined using a non dimensional iso density contour at ρ 2 and it is approximately h g 2 in all the tests the origin of the reference system is fixed when the current reaches the foot of the barrier both in the spatial and temporal scale the dimensionless position x versus the dimensionless time t for the up slope cases and the overhangs cases are shown for two different h 0 obtained by two different gate dimensions h g 0 05 m 0 1 m and different slope angles θ ranging from 15 to 90 in fig 5 and in fig 7 respectively the laboratory data are depicted with markers where the different colour refer to different runs the red line indicates the beginning of the slope while the black solid line pertains to the theoretical model predictions fig 5 shows that in the up slope cases the current is characterized by a constant front speed until it reaches the slope where it starts to decelerate as it flows up the slope and a reflected bore can be seen propagating back upstream all the experimental cases show a similar behaviour with quite significant differences in the portion of the current flowing over the slope the experimental results show a reasonable agreement with the theoretical prediction reproduced with a black solid line focusing on the incoming gravity current generally the theoretical model slightly underestimates the front position these differences are more significant far from the barrier an opposite behaviour can be observed for the outgoing flow with the bore position overestimated by the theoretical model in this case the differences between the theoretical and the experimental predictions are more evident those differences can be explained by the models assumptions the theoretical scheme considers both the incoming dense flow and the outgoing bore flow as simple advective processes neglecting the mixing and the dilution processes highlighted by the analysis of the density fields we remind the reader that predictions for the velocity of the reflected jump and the depth of the lower layer to the right of the jump are given in lane serff et al 1995 fig 6 shows the maximum dimensionless horizontal position x reached by the dense current on the slope as a function of θ s all the relevant parameters explored in our study i e the initial channel depth h the opening gate h g and the slope angle θ s affect the splash of dense current on the slope fig 6 highlights as the lower the θ s the greater the distance x travelled by the current moreover focus on the experiments with the same h g a greater initial h implies a greater distance x reached on the other hand in the experiments with the same h a greater h g implies a smaller x reached with the non dimensional form here adopted in fig 7 the overhang cases are depicted as in the previous case far from the barrier the gravity current advances with a constant velocity but in these cases the current starts to decelerate even before it reaches the foot of the barrier being affected by its presence indeed the inclination of the barrier affects the surface conditions which causes a rapid variation in the dynamics of the dense current and in its height while it seems that the initial channel depth h does not have a significant effect on the dynamics of the current on the other hand the slope angle θ o and the opening of the fixed gate h g strongly affect the current behaviour the effects of θ o can be observed both during the incoming current deceleration process and in the reflection process the smaller is θ o the earlier the incoming current starts to decelerate and the reflection processes start the opening gate h g mainly influences the behaviour of the reflected current and it will be discussed in the next paragraph here the theory gives a particularly accurate description of the flow deceleration and it is interesting to note that the theory provides a good agreement for all the angles θ o tested experimentally 4 3 depth averaged density fields and current dynamics the pixel based analysis of the density fields adopted here allows us to obtain the local density value ρ and accordingly the depth averaged density ρ v ρ v can be obtained by integrating ρ within the current below its upper boundary the latter is defined by a threshold of excess density of 2 from the observation of ρ v it is possible to infer the main characteristics of the flow dynamics the evolution in time and space of the dimensionless depth averaged density ρ v x t ρ v ρ 0 ρ 1 ρ 0 for the up slopes and overhangs runs is shown in figs 8 and 9 respectively by using the hovmöller diagram for the plane x t the yellow lines indicate the position of the theoretical effective reflection point while the thin red line is the non dimensional iso density contour at ρ 50 adopted here for the bore definition as it is possible to observe the adopted threshold is consistent with the theoretical value the higher values of ρ v observed throughout the experiments identify the head region the area near the front of the current and the outgoing bores the incoming gravity current front x f t and the outgoing bore position x b t are also depicted with white markers on the diagrams a noticeable exception is in the up slope run when the current flows up the barrier the higher values of ρ v are observed close to the slope foot indeed part of the dense current is reflected back towards the lock opening while a transient splash continues to flow up the slope to the final height the smaller θ s is the more evident is the transient splash phenomenon this result is consistent with the studies by lombardi et al 2015 and de falco et al 2020 2021c which observed that the head of the current becomes less dense as θ s increases due to the backward flow while the reflection process begins the outgoing bore starts to propagate with an approximately constant velocity which depends on the gate opening h g the shape of the outgoing flow is significantly affected by the value of h g this result is consistent with previous studies edwards et al 1994 for moderate values of h g the reflection response consists in nonlinear waves or in a weak undular bore visible in the form of curved dark stripes in fig 8a c for larger values of h g a strong internal hydraulic jump that appears in figure as a single dark area dominates the response fig 8d f the different behaviours of the dense current in the neighbourhood of the slope are related to the value of the froude number fr which governs the phenomenon cummins et al 2006 the initial bore reflection point x b 0 occurs at some distance from the foot of the barrier and it seems to be related to the values θ s and h g but not to the initial water depth h 0 the first time which is detected the front of the reverse current is t b 0 clearly the greater h g is the farther the current goes differences in the time t b 0 can be observed for different angles the smaller is θ s the greater is t b 0 for the overhang runs the highest values of ρ v can be also observed at the foot of the barrier because when the dense current reaches the overhang a portion of the current is trapped between the bottom and the barrier indeed as suggested by the hovmöller diagrams in fig 9 in each run there is a vertical dark stripe indicating a greater value of depth averaged density for a given configuration h 0 h g the smaller the angle θ o is the greater is the band thickness fig 9a and 9c and the greater is the mass of dense current trapped moreover fig 9b c show bright areas in the body of the current even before the current interaction with the barrier those bright areas indicate a great dilution of the current and therefore a great mixing of the current the reason behind those light spots is that when the current approaches the barrier the flow is affected by the change of the boundary conditions caused by the presence of the barrier itself focusing on the overhang angle θ o fig 9 hints that for small θ o the incoming front propagates with non constant velocity and the reflections structure is not well defined as in the up slope cases the theoretical effective reflection point indicated with a yellow line exhibits a good agreement with the experimental results in all the up slope experiments but it seems to be less accurate for the overhang runs the variation of the boundary condition in the overhang runs especially for small θ o makes the definition of the start position of the reflection rather difficult 4 4 dense current fractional area and bulk entrainment during the experiments the potential energy is converted into kinetic energy and the dense current increases its volume due to the entrainment of ambient fluid and the consequent mixing between the dense and light fluids following the approach of jacobson and testik 2013 and de falco et al 2021b the non dimensional dense current area a per unit width is defined as 15 a a i a 0 a 0 where a i is the area of the current in the x y plane at each time t i and a 0 is the area of the current once it formed at time t 0 for the evaluation of the area a i the isodensity level ρ 2 is adopted as in the previous studies of nogueira et al 2014 lombardi et al 2015 ottolenghi et al 2016a the dimensionless time evolution of a is shown in fig 10 for all the experiments performed in the up slope cases panels a c an increase of a is observed over time until the dense flow reaches the slope and the reflection processes begin at 3 for h g 5 cm and at 4 for h g 10 cm while after that time a still exhibits an increase in time but with a lower rate this behaviour suggests that the entrainment of ambient fluid is more significant during the front advancement along the horizontal bottom for all the up slope experiments performed the opening of the fixed gate h g plays a key role on a while the initial water column h 0 and the angle inclination θ s seem to exert a less significant effect indeed focusing on figure fig 10a b the angle θ s defines only the time duration of the tests without noteworthy difference on the a behaviour it is interesting to note that in fig 10c the non dimensional dense current area a increases as h g increases but in a non proportional manner furthermore unlike what is observed in 10a b a longer duration of the experiments results in a greater increase of a the overhang runs show a smaller increase of a compared to the up slope runs for all the experiments performed fig 10d f also in these experiments a linear increase of a is observed over time with different trends the higher one pertaining to the advancement phase and the lower one to the reflected bore like the up slope experiments the opening of the fixed gate h g is a parameter that rules the time evolution of a but in this case the effect of the angle inclination θ o cannot be neglected indeed even if for the thin currents shown in fig 10d there are not significant differences across all the values of θ o explored the entrainment of ambient fluid can be evaluated by a dimensionless entrainment parameter e fernando 1991 cenedese and adduce 2008 the procedure adopted in this analysis for the evaluation of e b u l k is similar to nogueira et al 2014 de falco et al 2021b we define the bulk entrainment discharge q e i b u l k as 16 q e i b u l k a i a 0 t i t 0 s q s where s is the width of the tank a i is the area of the current in the x y plane at each time t i a 0 is the area of the current once it formed at time t 0 and q s is the average flow outgoing from the tank the quantity q s is evaluated applying the mass balance at the lock as 17 q s c o c f c o v l o c k t where c o is the initial concentration of the dense current in the lock reservoir while c f is the final average concentration at the end of the run v l o c k is the initial volume of the dense current and t is the total duration of the test the bulk entrainment velocity w e i b u l k is defined as 18 w e i b u l k q e i b u l k s i with s i the area of the interface between the dense and the ambient fluids finally the bulk entrainment e b u l k is 19 e b u l k w e i b u l k α u b where α u b is a velocity scale representing the difference between the bulk velocity of the dense current and the bulk velocity of the ambient fluid flowing in the opposite direction the coefficient α varied between 1 2 and 1 4 it was selected taking into account the relative depths of dense and ambient fluids and following the no net flow condition as in lane serff et al 1995 the space evolution of the e b u l k as function of the front position x f is shown in fig 11 for the up slope runs until the dense current reaches the higher point on the slope in all the tests e b u l k exhibits a similar behaviour first during the front propagation a quite rapid decrease of e b u l k can be observed then when the gravity current flows over the slope the e b u l k tends to an asymptotic value in all cases when the dense current flows on the slope the order of magnitude of e b u l k is 1 0 2 the values are consistent with previous laboratory studies cenedese and adduce 2008 ottolenghi et al 2016a de falco et al 2021c typically gravity currents flowing up a slope and generated with the lock release technique show a lower values of e b u l k as θ s increases de falco et al 2020 this behaviour is due to the less intense development of instabilities at the interface between the dense and light fluids and it is less evident in our study due to the steady state inflow conditions moreover the analysis performed hints how the main parameter governing the entrainment process is h g while the variation of the angle of inclination θ s the initial water depths h 0 exert a less significant effect our derivation of the entrainment parameter is not based on local measurements as in ellison and turner 1959 but instead on integral measurements to better understand the entrainment process e b u l k is displayed in fig 12 as a function of the local froude f r and reynolds numbers r e defined as 20 f r u f g h m r e u f h m ν where u f is the front velocity calculated as the ratio between the distance travelled by the current and the time i e the front position g is the reduced gravity obtained for each instant by the averaged density of the total dense current and h m is the average height of the current once it is fully formed and ν is the kinematic viscosity fig 12 explores the dependence of e b u l k on the f r and r e for all the experiments performed different panels refer to different front positions the values e b u l k versus f r and r e are evaluated after the current has travelled a distance of 0 80 m a c and 0 93 m b d solid markers refer to s runs while empty symbols refer to o runs the same markers refer to the same initial conditions i e h 0 and h g for all the experiments performed f r ranged between 0 6 and 0 8 and 3000 r e 10000 so we are always under sub critical conditions i e f r 1 and in a turbulent regime at x f 0 80 m all the s runs with the same h g show quite similar values of e b u l k fig 12a c the same behaviour can be observed for the o runs with h g 5 cm while focus on o runs with h g 10 cm the e b u l k values are lower than the corresponding s runs even if the r e values are almost the same moreover the e b u l k value appears strongly affected by the inclination of the barrier θ o the greater θ o the greater e b u l k fig 12c accordingly with the evaluations of the non dimensional dense current area a lower values of e b u l k are observed after the current has reached the slope fig 12b d at x f 0 93 m for all the s runs with the same h g 5 cm seems that an increase in θ s leads to a slight decrease of e b u l k fig 12b d characterized by a decrease of r e while despite the interaction with the slope f r is not significantly affected on the other hand for h g 10 cm the s runs show quite similar values of e b u l k this latter result can be due to the start of the reflection processes of the dense current at the toe of the slope causing the increase in thrust of the dense current focus on the o runs depicted in fig 12a c the e b u l k values are lower than the s runs and moreover the e b u l k is strongly affected by the inclination of the barrier θ o even before the current has reached the barrier itself indeed there is a decrease of e b u l k even if the values of f r and r e are quite similar to the s runs 5 conclusions in the present paper the dynamics of steady two dimensional gravity currents interacting with slopes and overhangs are examined by using laboratory experiments and the results are supported by a theoretical analysis a total of twenty five experiments were performed by varying the initial total water depths h 0 the openings of the fixed gate h g and the angle inclination of the barriers θ keeping constant the initial density gradient δ ρ the study performed shows how the nature of the barrier strongly affects the dynamics of the dense current the deceleration of the incoming gravity current approaching the barrier the outgoing bore dynamics and the mixing associated with them are analysed the theoretical model assumes that the current is able to adjust to the local conditions and neglects the mixing and the dilution processes despite those simplifying assumptions it shows a reasonable agreement with the experiments indeed the current slows and deepens somewhat as it approaches the barrier until the current occupies half the channel depth when the deceleration becomes greater in the s runs when the current reaches the barrier a splash continues up the barrier considerably higher than the height of the steady return flow clearly the splash cannot be correctly represented by the slowly varying assumption the current dynamics seems to be deeply affected by θ and h g which have been shown to be the main parameters governing the evolution of the current moreover detailed density measurements enabled to deepen the dynamics of the dense flow and to emphasize the complex dynamics and different behaviours between the s runs and the o runs the analysis of the temporal evolution of the density shows how the current once it reaches the barrier it is reflected back as an hydraulic jump that takes the form of an undular bore with a series of waves behind the bore this phenomenon is governed by the parameter h g the bigger is h g the stronger is the internal hydraulic jump regarding the spatial position where the bore is generated namely the effective reflection point the comparison between the theoretical predictions and the experimental runs show a reasonable agreement for the s runs cases while for the o runs we notice a slightly overestimation the latter can be due to the rather difficult definition of the start position of the reflection in the laboratory experiments especially for small θ o because of mixing effects near the barrier finally an accurate density field analysis is performed in order to describe more thoroughly the mixing processes associated to the evolution of the dense current spatio temporal changes of the non dimensional area a and of the bulk entrainment parameter e b u l k presented for all the series of experiments do not highlight differences between the runs in the s runs the initial water column h 0 and the angle inclination θ s seem to exert a less significant effect compared to the opening of the fixed gate h g the same behaviour is observed for the o runs but with a smaller increase of a compared to the s runs due to the change of the boundary conditions caused by the angle inclination θ o of the barrier which constrains the expansion of the dense current the e b u l k analysis performed for the laboratory experiments suggests that the entrainment occurs always under sub critical conditions i e f r 1 and in a turbulent regime since 2000 r e 10000 with its magnitude is in good agreement with previous findings despite the fact that in the o runs a splash of dense fluid is forced up over lighter fluid increasing the mixing locally the e b u l k of the current is slightly less than the s runs indicating that a balance is induced by the higher deceleration of the current declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this research was funded by the italian ministry of education university and research miur through the departments of excellence 2018 2022 program 
72,when a gravity current interacts with a barrier the flow is reflected back in the form of a moving hydraulic jump or bore this latter phenomenon has important implications for estuarine mixing and sediment reworking in the oceanographic context in order to examine those reflection processes two dimensional gravity currents interacting with slopes and overhanging barriers are examined by laboratory experiments and theoretical analysis relevant parameters such as the initial volume of the dense fluid the opening of the fixed gate used for the dense fluid release and the angle of the slope or overhang positioned inside the tank were varied an image analysis technique based on light attenuation was applied to evaluate the instantaneous density fields the theoretical predictions based on shallow water theory give reasonable agreement compared with the laboratory experiments about the spatial position of the dense current and the definition of the point where the reflection process starts moreover the analysis of the density fields highlights the presence of areas within the dense current characterized by a greater dilution due to the reflection of the current nevertheless the bulk entrainment parameter is only slightly affected by the presence of a steep slope or overhang keywords gravity currents theoretical model reflection process entrainment data availability data will be made available on request 1 introduction gravity currents are flows driven by density differences within a fluid the latter can be caused by temperature differences salinity gradients dissolved substances or particulates these flows widely occur spontaneously in nature or also as outcome from human activities dense oceanic currents avalanches sand storms accidental oil spills to marine areas or released pollutant mass dispersing in rivers are a few examples of gravity currents simpson 1997 mixing across stable density interfaces because of background turbulence is a frequent phenomenon in geophysical and engineering flows fernando 1991 such mixing processes play a fundamental role in the dynamics of dense currents because they contribute to the dilution of the current which in turn changes the buoyancy forces driving the motion itself since the dynamics of gravity currents are affected by the amount of the entrained ambient fluid different studies have been focused on this issue nogueira et al 2014 de falco et al 2020 2021a ottolenghi et al 2016b wilson et al 2017 zordan et al 2018 modelling of gravity currents mainly relies on classical studies made on uniform horizontal surfaces adduce et al 2012 ottolenghi et al 2016a inghilesi et al 2018 he et al 2021 while the importance of the topographic features on the development of the density current has only recently been recognized dai 2013 la rocca et al 2013 cuthbertson et al 2014 2018 dai and huang 2021 adduce et al 2022 maggi et al 2022 several theoretical and experimental studies have been conducted on the dynamics of the gravity currents over complex boundaries for instance de falco et al 2021b through laboratory tests and a detailed density measurements explored the dense current interaction with an isolated obstacle with a focus on the entrainment processes moreover negretti et al 2008 investigated the effect of a rough bottom on the interfacial instabilities for a two layer exchange flow over a sill using sparse and dense roughness elements beside experimental analysis many studies employing numerical models can be found in literature ooi et al 2009 tokyay et al 2014 inghilesi et al 2018 just a few studies deal with the reverse flow generated by the interaction of the gravity current with bottom slopes gonzalez juez et al 2009 2010 highlighting how the relation between the angles of the slopes to the oncoming current and to the reflected jump have important implications for estuarine mixing and sediment reworking in the oceanographic context thorpe 1983 kneller and mccaffrey 1999 our study extends the work of lane serff et al 1995 where the interaction between a gravity current and a bottom triangular obstacle was considered lane serff et al 1995 was mainly focused on the overflow of the incoming gravity current and did not study the transients connected with the reflection process here we present a more detailed study of the reflection process focusing our attention on completely blocked flows in order to analysed the dense current reflected the reflections of two dimensional gravity currents from simple slopes i e up slope and from cases steeper than vertical barriers i e an overhang are considered these flows can be encountered in a number of natural and industrial contexts the up slope mimics for example when a sea breeze meets a high ridge or a dense turbidity current meets a continental shelf or sea mount the overhang case where the upper boundary slopes down to the floor can occur where a dense current meets the grounding line of an ice shelf or in some geological or industrial flows where a dense intrusion flows along the lower boundary of a contained region with a downward sloping roof this flow is also equivalent to a light gravity current flowing along a horizontal upper surface with the lower boundary sloping up to the surface see fig 1 this is the case for example when a fresh water outflow meets a beach an observation of reflected fresh water flows is given by thorpe 1983 and flow reflected by an overhanging barrier is described briefly by simpson 1997 in this work we present a comprehensive analysis of the gravity currents dynamics including a focus on the entrainment processes based on laboratory experiments using a non intrusive technique moreover we introduce a theoretical model based on a slowly varying shallow water theory approach our model has some similarities with simpson 1997 indeed we assume that as the current approaches the foot of the barrier it occupies a constant portion of the total channel depth the paper is structured as follows the experimental measurements are given in section 2 in section 3 we set out the shallow water theory approach a qualitative description of the dynamics of the interaction with the barrier the experimental results and the comparison with the theoretical model are discussed in section 4 specifically the dense flow propagation and the analysis of the non dimensional averaged density fields are presented respectively in section 4 2 and section 4 3 section 4 4 is mainly focused on the entrainment processes through the analysis of the non dimensional area of the current and the bulk entrainment parameter finally section 5 gives a summary of key results 2 experimental setup and laboratory experiments the laboratory experiments are carried out at the hydraulics laboratory of the roma tre university in a perspex tank with a length height and width of 3 m 0 3 m and 0 2 m respectively the experimental apparatus shown in fig 2a is similar to that described in lane serff et al 1995 by which it is possible to reproduce steady gravity currents the lock reservoir is realized with a fixed gate placed at l 0 0 4 m leaving a rectangular opening at the bottom across the width of the tank the opening is covered by a 4 mm thick removable vertical gate a uniform perspex slope is located at l t 0 85 m from the fixed gate with different angles θ in order to represent up slopes vertical barriers or overhanging barriers for each experiment the first part of the tank is filled with salty water with initial density ρ 1 while the rest of the tank is filled with an ambient fluid of density ρ 0 ρ 1 all the experiments are conducted with a constant δ ρ 40 kg m 3 where δ ρ ρ 1 ρ 0 an electronic density meter anton paar dma 4100m is used to perform initial density measurements furthermore a controlled quantity of dye is added to the salty water in order to visualize the dense flow the run starts when the sliding gate is suddenly removed and an exchange flow through the opening develops a dense flow starts from the left part of the tank to the right part forming a gravity current while at the same time a turbulent plume of fresh water rises into the lock reservoir during the propagation of the current the dense fluid entrains the lighter one causing mixing and dilution of the dense current the experiment stops when the reflected dense flow generated by the presence of the slope reaches the opening of the fixed gate each experiment is acquired by a ccd charged couple device camera with a frequency of 25 hz and a spatial resolution of 1024 668 pixels the camera is positioned at a fixed distance in front of the tank and the accuracy of the measurement is 3 mm pixel a backlight system is employed to provide a uniform light each frame of the acquired movie is converted into a matrix of grey levels with values ranging from 0 black to 255 white in order to evaluate the instantaneous density fields an image analysis technique is applied as in la forgia et al 2020 de falco et al 2021b c and adduce et al 2022 for each experiment nine calibration images with known and controlled concentrations of dye are acquired the nine calibration images are used to obtain a pixel based calibration curve allowing the conversion of the greyscale into density values the relative deviation between the total mass of salt in the tank and the total mass of salt evaluated experimentally is 0 15 as already observed by adduce et al 2022 the dimensionless density field is defined as 1 ρ x y t ρ x y t ρ 0 ρ 1 ρ 0 where ρ x y t is the local density of the current the cartesian reference system is shown in fig 2a fifteen up slope experiments including three with a vertical barrier and ten experiments with an overhanging barrier are performed two different openings of the fixed gate are used h g 0 05 m and h g 0 1 m and the initial total water depths are h 0 0 3 m and h 0 0 15 m the angles of the barriers θ s for the slope angle and θ o for the overhang angle are varied between 15 and 90 as shown in fig 2b the up slope sruns the vertical experimental runs vruns and the overhang runs oruns are summarized in table 1 the froude f r u f g d 0 0 5 and reynolds number r e u f d 0 ν based on initial quantities with u f the front velocity of the dense flow d 0 the height of the tail of the incoming gravity current g the reduced and ν the kinematic viscosity are also presented in table 1 3 theoretical model as stated in the introduction the approach used in this study is based on shallow water theory and present some similarities with lane serff et al 1995 however some of the transient features of the flow cannot be described by this technique when a gravity current first meets a slope while most of the dense current is reflected back a portion of the dense current continues up the slope much farther than the final level of the steady reflected flow we denote this process as splash this is obviously significant for example in the design of barriers to contain accidental dense gas releases shallow water theory assumes distinct layers of fluid whereas in practice there is mixing between the gravity current and the surrounding fluid this is especially true when the gravity current is reflected the speed of the incoming gravity current u can be described in terms of froude number f r u g d where g is the reduced gravity and d is the height of the tail of the gravity current in lane serff et al 1995 a simple power law was fitted to the observed relationship between the froude number and the relative depth of the channel while the observations showed that froude number increased with channel depth they also showed that the froude number tended towards a maximum value the limit for very deep channels rather than fit a different type of function one which has a maximum value we will use the same power law here but impose an explicit upper bound on the froude number so that the froude number is given by 2 f r 0 56 h d 0 22 h 12 d 3 f r 1 h 12 d where h is the depth of the channel when the gravity current meets the barrier the flow is reflected in the form of a moving hydraulic jump or bore the change in the flow either side of the bore is found by using jump conditions matching the momentum and mass flux and allowing for energy loss in lane serff et al 1995 the energy loss is assumed to be confined to the lower layer giving non hydrostatic pressure change across the jump wood and simpson 1984 the theoretical analysis of the partial or complete reflection of gravity currents by obstacles is discussed in lane serff et al 1995 including non boussinesq effects the effects of a free surface and the effects of a passive third layer and so we do not repeat that analysis here for the present work however it is useful to extract the results from lane serff et al 1995 for the complete reflection of gravity current under the boussinesq approximation we assume here that changes in free surface height are negligible so that the free surface can be approximated by a rigid lid for shallow channels h less than approximately 2 9 the equations allow for a faster moving smaller bore than that predicted by assuming a single sharp jump from one depth to another this suggest that the reflection in those cases would be a bore of this shallower depth followed by a rarefaction a smooth and constantly changing adjustment to the final depth the difference in speed is relatively small and we are concentrating on flow in relatively deep channels in this paper so we will generally ignore rarefactions here more details on the rarefactions in two layer flows are given by baines 1984 the incoming gravity current and the reflected dense flow from the barrier has been examined by a thorough theoretical analysis based on that formulated by lane serff et al 1995 with a more detailed study on the reflection process of completely blocked flow in the following we provide a brief recapitulation of the basic concepts of the analysis while the detailed description of the theoretical model can be found in lane serff et al 1995 as will be discussed more thoroughly in the following paragraphs when the gravity current meets the barrier the flow is reflected in the form of a moving hydraulic jump or bore the flow is divided into two layers the upper layer and the lower one and the change in the flow is found by using jump conditions matching the momentum and mass flux balance equations it is assumed that changes in free surface height are negligible so the free surface can be approximated by a rigid lid moreover the topography is considered sufficiently slowly varying so the vertical velocities and accelerations may be neglected and also viscous effects can be ignored in this manner the velocity varies with the horizontal position but not with the height of the dense flow so that the shallow water theory can be used for further information about he theoretical model assumptions see lane serff et al 1995 the problem is formalized adopting a suitable non dimensional form of the equations the heights are divided by the height of the tail of the incoming gravity current d 0 in particular the non dimensional total depth before the barrier is h 0 h 0 d 0 while the dimensionless horizontal distance x and time t are respectively 4 x x d 0 tan 9 0 θ 5 t t d 0 g tan 9 0 θ where x x l t is the distance between the reference system adopted and the slope position l t g g ρ 1 ρ 0 ρ 0 and θ is the degree tilting of the barrier therefore it is obtained the gradient of the slope or overhang equal to one in non dimensional units 3 1 effective reflection point in terms of the gravity current and bore positions measured far from the barrier the gravity current seems to have an effective reflection point at some distance from the foot of the barrier once the gravity current has been reflected neglecting the small fluctuations at the interface between the dense fluid and the ambient one downstream of the moving bore the fluid interface between the upper and the lower layer of the dense fluid has to be horizontal and stationary thus the position of the effective reflection point can be calculate how 6 x r 0 5 b tan 9 0 θ equivalent to the non dimensional distance 7 x r 0 5 b d 0 upstream of the barrier for overhangs or downstream of the barrier for slopes fig 3 3 2 up slope cases under the shallow water theory assumptions the non dimensionalisation adopted transforms the results for different slope angles onto a unique curve at least for flows in channels of the same relative depth h 0 the behaviour of the dense flow that continues to advance once the barrier is reached cannot be described by shallow water theory because it seems to be related to the gravity current head however we notice that the advancement of the portion of the dense current flowing on the slope is very limited because of the inclination of the slope itself and moreover affected by the top of the channel 3 3 overhang cases in case of overhanging barrier the slope of the upper boundary is assumed constant so the gravity current is approaching the barrier from deep water when h i d 0 12 where h i is the depth of the channel the current has constant depth d 0 and the front moves with constant speed given by 8 u 0 g d 0 as the current approaches the barrier we assume that it conserves volume flux so that u 0 d 0 u d but with the gravity current height d and speed u adjusting as the channel depth h decreases in accordance with eq 2 from conservation of volume flux and eq 8 we have 9 u u 0 d 0 d g d 0 d 0 d so the froude number is given by 10 f r u g d d 0 d 3 2 substituting eq 10 into eq 2 gives 11 d 0 d 3 2 0 22 0 56 h d 0 0 22 raising eq 11 to 1 1 28 shows that when 12 h d 0 2 66 the current depth d increases and the speed decreases 12 d d 0 1 57 h d 0 0 17 13 u u 0 0 64 h d 0 0 17 however the gravity current height is limited to half the local channel depth and once the current has 2 66 h d 0 0 the volume flux cannot be conserved and the reflection process begins from this point we assume that the current continues to occupy half the channel depth d h 2 simpson 1997 and the current decelerate following the trend 14 u u 0 0 46 h d 0 0 5 this last system of equations is solved by an iterative algorithm fixing the time origin as the time when the current reaches the foot of the barrier the transition points h d 0 12 and h d 0 2 66 occur respectively at t 19 7 and t 7 1 thus a complete description of the deceleration of the gravity current as it approaches an overhang is carried out based upon results from constant speed gravity current in the following paragraphs this theoretical prediction will be compared with the experimental results 4 results 4 1 qualitative observations of flow evolution visual inspection of the recorded movies reveals that the nature of the barrier strongly affects the dynamics of the gravity current especially the reflection process to better understand the significant differences between an up slope and an overhanging barrier two series of snapshots for the experiment s 10 h 0 0 3 m h g 0 1 m θ s 3 0 and o 8 h 0 0 3 m h g 0 1 m θ o 3 0 and non dimensional instantaneous density fields are shown in fig 4 as the gate is removed the initial development of the dense flow is similar for both cases the incoming gravity current has the characteristic form with a slightly raised nose and a head region higher than the following tail fig 4a b in the up slope case the current decelerates as it flows up the slope the head of the current becomes thinner and a reflected bore can be seen propagating back upstream fig 4c a transient splash continues to flow up the slope around the final height fig 4b some mixing can be observed during the reflection process fig 4e in the overhang case the current decelerates as it approaches the foot of the barrier being affected by its presence the impact determines a reverse flow associated with a mixing zone close to the barrier characterized by a height higher than the steady return flow fig 4d also in this case the reflected current can generate a bore propagating back upstream fig 4f in all experiments the shape of the reflected flow will depend on the opening of the fixed gate h g the reverse flow may take the shape of a group of smooth symmetrical waveforms with no mixing at the upper interface or alternatively an asymmetrical shape with much turbulent mixing on its leeside as already observed by edwards et al 1994 in the overhang case the mixing associated with the reflection process seems to be greater than for the up slope fig 4g and 4c 4 2 position of the incoming gravity current and outgoing bores the instantaneous front position of the current x f is defined as the foremost point of the nose of the dense current the experimental front position is obtained by using the non dimensional iso density contour at ρ 2 and following the time advancement of the first point of the dense current along the x direction the position of the reflected current x b is defined as the time advancement of the first point identified using a non dimensional iso density contour at ρ 50 on an intermediate height between d and the bore height d b along the reverse direction of the initial motion i e the mean thickness of the bore waveform edwards et al 1994 the height of the tail of the incoming gravity current d is also defined using a non dimensional iso density contour at ρ 2 and it is approximately h g 2 in all the tests the origin of the reference system is fixed when the current reaches the foot of the barrier both in the spatial and temporal scale the dimensionless position x versus the dimensionless time t for the up slope cases and the overhangs cases are shown for two different h 0 obtained by two different gate dimensions h g 0 05 m 0 1 m and different slope angles θ ranging from 15 to 90 in fig 5 and in fig 7 respectively the laboratory data are depicted with markers where the different colour refer to different runs the red line indicates the beginning of the slope while the black solid line pertains to the theoretical model predictions fig 5 shows that in the up slope cases the current is characterized by a constant front speed until it reaches the slope where it starts to decelerate as it flows up the slope and a reflected bore can be seen propagating back upstream all the experimental cases show a similar behaviour with quite significant differences in the portion of the current flowing over the slope the experimental results show a reasonable agreement with the theoretical prediction reproduced with a black solid line focusing on the incoming gravity current generally the theoretical model slightly underestimates the front position these differences are more significant far from the barrier an opposite behaviour can be observed for the outgoing flow with the bore position overestimated by the theoretical model in this case the differences between the theoretical and the experimental predictions are more evident those differences can be explained by the models assumptions the theoretical scheme considers both the incoming dense flow and the outgoing bore flow as simple advective processes neglecting the mixing and the dilution processes highlighted by the analysis of the density fields we remind the reader that predictions for the velocity of the reflected jump and the depth of the lower layer to the right of the jump are given in lane serff et al 1995 fig 6 shows the maximum dimensionless horizontal position x reached by the dense current on the slope as a function of θ s all the relevant parameters explored in our study i e the initial channel depth h the opening gate h g and the slope angle θ s affect the splash of dense current on the slope fig 6 highlights as the lower the θ s the greater the distance x travelled by the current moreover focus on the experiments with the same h g a greater initial h implies a greater distance x reached on the other hand in the experiments with the same h a greater h g implies a smaller x reached with the non dimensional form here adopted in fig 7 the overhang cases are depicted as in the previous case far from the barrier the gravity current advances with a constant velocity but in these cases the current starts to decelerate even before it reaches the foot of the barrier being affected by its presence indeed the inclination of the barrier affects the surface conditions which causes a rapid variation in the dynamics of the dense current and in its height while it seems that the initial channel depth h does not have a significant effect on the dynamics of the current on the other hand the slope angle θ o and the opening of the fixed gate h g strongly affect the current behaviour the effects of θ o can be observed both during the incoming current deceleration process and in the reflection process the smaller is θ o the earlier the incoming current starts to decelerate and the reflection processes start the opening gate h g mainly influences the behaviour of the reflected current and it will be discussed in the next paragraph here the theory gives a particularly accurate description of the flow deceleration and it is interesting to note that the theory provides a good agreement for all the angles θ o tested experimentally 4 3 depth averaged density fields and current dynamics the pixel based analysis of the density fields adopted here allows us to obtain the local density value ρ and accordingly the depth averaged density ρ v ρ v can be obtained by integrating ρ within the current below its upper boundary the latter is defined by a threshold of excess density of 2 from the observation of ρ v it is possible to infer the main characteristics of the flow dynamics the evolution in time and space of the dimensionless depth averaged density ρ v x t ρ v ρ 0 ρ 1 ρ 0 for the up slopes and overhangs runs is shown in figs 8 and 9 respectively by using the hovmöller diagram for the plane x t the yellow lines indicate the position of the theoretical effective reflection point while the thin red line is the non dimensional iso density contour at ρ 50 adopted here for the bore definition as it is possible to observe the adopted threshold is consistent with the theoretical value the higher values of ρ v observed throughout the experiments identify the head region the area near the front of the current and the outgoing bores the incoming gravity current front x f t and the outgoing bore position x b t are also depicted with white markers on the diagrams a noticeable exception is in the up slope run when the current flows up the barrier the higher values of ρ v are observed close to the slope foot indeed part of the dense current is reflected back towards the lock opening while a transient splash continues to flow up the slope to the final height the smaller θ s is the more evident is the transient splash phenomenon this result is consistent with the studies by lombardi et al 2015 and de falco et al 2020 2021c which observed that the head of the current becomes less dense as θ s increases due to the backward flow while the reflection process begins the outgoing bore starts to propagate with an approximately constant velocity which depends on the gate opening h g the shape of the outgoing flow is significantly affected by the value of h g this result is consistent with previous studies edwards et al 1994 for moderate values of h g the reflection response consists in nonlinear waves or in a weak undular bore visible in the form of curved dark stripes in fig 8a c for larger values of h g a strong internal hydraulic jump that appears in figure as a single dark area dominates the response fig 8d f the different behaviours of the dense current in the neighbourhood of the slope are related to the value of the froude number fr which governs the phenomenon cummins et al 2006 the initial bore reflection point x b 0 occurs at some distance from the foot of the barrier and it seems to be related to the values θ s and h g but not to the initial water depth h 0 the first time which is detected the front of the reverse current is t b 0 clearly the greater h g is the farther the current goes differences in the time t b 0 can be observed for different angles the smaller is θ s the greater is t b 0 for the overhang runs the highest values of ρ v can be also observed at the foot of the barrier because when the dense current reaches the overhang a portion of the current is trapped between the bottom and the barrier indeed as suggested by the hovmöller diagrams in fig 9 in each run there is a vertical dark stripe indicating a greater value of depth averaged density for a given configuration h 0 h g the smaller the angle θ o is the greater is the band thickness fig 9a and 9c and the greater is the mass of dense current trapped moreover fig 9b c show bright areas in the body of the current even before the current interaction with the barrier those bright areas indicate a great dilution of the current and therefore a great mixing of the current the reason behind those light spots is that when the current approaches the barrier the flow is affected by the change of the boundary conditions caused by the presence of the barrier itself focusing on the overhang angle θ o fig 9 hints that for small θ o the incoming front propagates with non constant velocity and the reflections structure is not well defined as in the up slope cases the theoretical effective reflection point indicated with a yellow line exhibits a good agreement with the experimental results in all the up slope experiments but it seems to be less accurate for the overhang runs the variation of the boundary condition in the overhang runs especially for small θ o makes the definition of the start position of the reflection rather difficult 4 4 dense current fractional area and bulk entrainment during the experiments the potential energy is converted into kinetic energy and the dense current increases its volume due to the entrainment of ambient fluid and the consequent mixing between the dense and light fluids following the approach of jacobson and testik 2013 and de falco et al 2021b the non dimensional dense current area a per unit width is defined as 15 a a i a 0 a 0 where a i is the area of the current in the x y plane at each time t i and a 0 is the area of the current once it formed at time t 0 for the evaluation of the area a i the isodensity level ρ 2 is adopted as in the previous studies of nogueira et al 2014 lombardi et al 2015 ottolenghi et al 2016a the dimensionless time evolution of a is shown in fig 10 for all the experiments performed in the up slope cases panels a c an increase of a is observed over time until the dense flow reaches the slope and the reflection processes begin at 3 for h g 5 cm and at 4 for h g 10 cm while after that time a still exhibits an increase in time but with a lower rate this behaviour suggests that the entrainment of ambient fluid is more significant during the front advancement along the horizontal bottom for all the up slope experiments performed the opening of the fixed gate h g plays a key role on a while the initial water column h 0 and the angle inclination θ s seem to exert a less significant effect indeed focusing on figure fig 10a b the angle θ s defines only the time duration of the tests without noteworthy difference on the a behaviour it is interesting to note that in fig 10c the non dimensional dense current area a increases as h g increases but in a non proportional manner furthermore unlike what is observed in 10a b a longer duration of the experiments results in a greater increase of a the overhang runs show a smaller increase of a compared to the up slope runs for all the experiments performed fig 10d f also in these experiments a linear increase of a is observed over time with different trends the higher one pertaining to the advancement phase and the lower one to the reflected bore like the up slope experiments the opening of the fixed gate h g is a parameter that rules the time evolution of a but in this case the effect of the angle inclination θ o cannot be neglected indeed even if for the thin currents shown in fig 10d there are not significant differences across all the values of θ o explored the entrainment of ambient fluid can be evaluated by a dimensionless entrainment parameter e fernando 1991 cenedese and adduce 2008 the procedure adopted in this analysis for the evaluation of e b u l k is similar to nogueira et al 2014 de falco et al 2021b we define the bulk entrainment discharge q e i b u l k as 16 q e i b u l k a i a 0 t i t 0 s q s where s is the width of the tank a i is the area of the current in the x y plane at each time t i a 0 is the area of the current once it formed at time t 0 and q s is the average flow outgoing from the tank the quantity q s is evaluated applying the mass balance at the lock as 17 q s c o c f c o v l o c k t where c o is the initial concentration of the dense current in the lock reservoir while c f is the final average concentration at the end of the run v l o c k is the initial volume of the dense current and t is the total duration of the test the bulk entrainment velocity w e i b u l k is defined as 18 w e i b u l k q e i b u l k s i with s i the area of the interface between the dense and the ambient fluids finally the bulk entrainment e b u l k is 19 e b u l k w e i b u l k α u b where α u b is a velocity scale representing the difference between the bulk velocity of the dense current and the bulk velocity of the ambient fluid flowing in the opposite direction the coefficient α varied between 1 2 and 1 4 it was selected taking into account the relative depths of dense and ambient fluids and following the no net flow condition as in lane serff et al 1995 the space evolution of the e b u l k as function of the front position x f is shown in fig 11 for the up slope runs until the dense current reaches the higher point on the slope in all the tests e b u l k exhibits a similar behaviour first during the front propagation a quite rapid decrease of e b u l k can be observed then when the gravity current flows over the slope the e b u l k tends to an asymptotic value in all cases when the dense current flows on the slope the order of magnitude of e b u l k is 1 0 2 the values are consistent with previous laboratory studies cenedese and adduce 2008 ottolenghi et al 2016a de falco et al 2021c typically gravity currents flowing up a slope and generated with the lock release technique show a lower values of e b u l k as θ s increases de falco et al 2020 this behaviour is due to the less intense development of instabilities at the interface between the dense and light fluids and it is less evident in our study due to the steady state inflow conditions moreover the analysis performed hints how the main parameter governing the entrainment process is h g while the variation of the angle of inclination θ s the initial water depths h 0 exert a less significant effect our derivation of the entrainment parameter is not based on local measurements as in ellison and turner 1959 but instead on integral measurements to better understand the entrainment process e b u l k is displayed in fig 12 as a function of the local froude f r and reynolds numbers r e defined as 20 f r u f g h m r e u f h m ν where u f is the front velocity calculated as the ratio between the distance travelled by the current and the time i e the front position g is the reduced gravity obtained for each instant by the averaged density of the total dense current and h m is the average height of the current once it is fully formed and ν is the kinematic viscosity fig 12 explores the dependence of e b u l k on the f r and r e for all the experiments performed different panels refer to different front positions the values e b u l k versus f r and r e are evaluated after the current has travelled a distance of 0 80 m a c and 0 93 m b d solid markers refer to s runs while empty symbols refer to o runs the same markers refer to the same initial conditions i e h 0 and h g for all the experiments performed f r ranged between 0 6 and 0 8 and 3000 r e 10000 so we are always under sub critical conditions i e f r 1 and in a turbulent regime at x f 0 80 m all the s runs with the same h g show quite similar values of e b u l k fig 12a c the same behaviour can be observed for the o runs with h g 5 cm while focus on o runs with h g 10 cm the e b u l k values are lower than the corresponding s runs even if the r e values are almost the same moreover the e b u l k value appears strongly affected by the inclination of the barrier θ o the greater θ o the greater e b u l k fig 12c accordingly with the evaluations of the non dimensional dense current area a lower values of e b u l k are observed after the current has reached the slope fig 12b d at x f 0 93 m for all the s runs with the same h g 5 cm seems that an increase in θ s leads to a slight decrease of e b u l k fig 12b d characterized by a decrease of r e while despite the interaction with the slope f r is not significantly affected on the other hand for h g 10 cm the s runs show quite similar values of e b u l k this latter result can be due to the start of the reflection processes of the dense current at the toe of the slope causing the increase in thrust of the dense current focus on the o runs depicted in fig 12a c the e b u l k values are lower than the s runs and moreover the e b u l k is strongly affected by the inclination of the barrier θ o even before the current has reached the barrier itself indeed there is a decrease of e b u l k even if the values of f r and r e are quite similar to the s runs 5 conclusions in the present paper the dynamics of steady two dimensional gravity currents interacting with slopes and overhangs are examined by using laboratory experiments and the results are supported by a theoretical analysis a total of twenty five experiments were performed by varying the initial total water depths h 0 the openings of the fixed gate h g and the angle inclination of the barriers θ keeping constant the initial density gradient δ ρ the study performed shows how the nature of the barrier strongly affects the dynamics of the dense current the deceleration of the incoming gravity current approaching the barrier the outgoing bore dynamics and the mixing associated with them are analysed the theoretical model assumes that the current is able to adjust to the local conditions and neglects the mixing and the dilution processes despite those simplifying assumptions it shows a reasonable agreement with the experiments indeed the current slows and deepens somewhat as it approaches the barrier until the current occupies half the channel depth when the deceleration becomes greater in the s runs when the current reaches the barrier a splash continues up the barrier considerably higher than the height of the steady return flow clearly the splash cannot be correctly represented by the slowly varying assumption the current dynamics seems to be deeply affected by θ and h g which have been shown to be the main parameters governing the evolution of the current moreover detailed density measurements enabled to deepen the dynamics of the dense flow and to emphasize the complex dynamics and different behaviours between the s runs and the o runs the analysis of the temporal evolution of the density shows how the current once it reaches the barrier it is reflected back as an hydraulic jump that takes the form of an undular bore with a series of waves behind the bore this phenomenon is governed by the parameter h g the bigger is h g the stronger is the internal hydraulic jump regarding the spatial position where the bore is generated namely the effective reflection point the comparison between the theoretical predictions and the experimental runs show a reasonable agreement for the s runs cases while for the o runs we notice a slightly overestimation the latter can be due to the rather difficult definition of the start position of the reflection in the laboratory experiments especially for small θ o because of mixing effects near the barrier finally an accurate density field analysis is performed in order to describe more thoroughly the mixing processes associated to the evolution of the dense current spatio temporal changes of the non dimensional area a and of the bulk entrainment parameter e b u l k presented for all the series of experiments do not highlight differences between the runs in the s runs the initial water column h 0 and the angle inclination θ s seem to exert a less significant effect compared to the opening of the fixed gate h g the same behaviour is observed for the o runs but with a smaller increase of a compared to the s runs due to the change of the boundary conditions caused by the angle inclination θ o of the barrier which constrains the expansion of the dense current the e b u l k analysis performed for the laboratory experiments suggests that the entrainment occurs always under sub critical conditions i e f r 1 and in a turbulent regime since 2000 r e 10000 with its magnitude is in good agreement with previous findings despite the fact that in the o runs a splash of dense fluid is forced up over lighter fluid increasing the mixing locally the e b u l k of the current is slightly less than the s runs indicating that a balance is induced by the higher deceleration of the current declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this research was funded by the italian ministry of education university and research miur through the departments of excellence 2018 2022 program 
73,watertable fluctuations are a characteristic feature of coastal unconfined aquifers they interact with the vadose zone creating a dynamic effective porosity for which a new empirical expression is proposed based on a dimensionless parameter related to the fluctuation frequency after comparing with both experimental data and numerical simulations the new expression is implemented into a modified boussinesq equation allowing for examination of the effects of the dynamic effective porosity on watertable fluctuations the dispersion relation arising from the modified boussinesq equation predicts laboratory experimental data accurately highlighting the importance of the dynamic effective porosity in modeling watertable fluctuations in coastal unconfined aquifers this in turn confirms the applicability of the real valued expression of the dynamic effective porosity an outcome is that the phase lag between the total moisture above the watertable and watertable height measured in laboratory experiments using vertical soil columns 1d systems can be ignored when predicting watertable fluctuations in coastal unconfined aquifers 2d systems the dynamic effective porosity is always smaller than the soil porosity and so by comparison there is a reduction in vertical water exchange between the saturated and vadose zones consequently watertable waves can propagate further landward without standing wave behaviors keywords vadose zone effects boussinesq equation analytical solution laboratory experiment dispersion relation data availability all of data are compiled from previous studies 1 introduction as a transition zone between the ocean and land coastal unconfined aquifers respond to interactions between terrestrial fresh groundwater and seawater due to oceanic oscillations e g tides or waves water flows into or out of the aquifer periodically which directly affects a range of groundwater dependent processes including sediment mobilization seawater intrusion submarine groundwater discharge solute transport and chemical loading to the ocean e g parlange et al 1984 li et al 1999 moore 2010 xin et al 2010 bakhtyar et al 2011 werner et al 2013 robinson et al 2018 wallace et al 2020 watertable fluctuations induced by oceanic oscillations are an important signal for quantifying these processes and their prediction is a longstanding topic e g philip 1973 smiles stokes 1976 parlange et al 1984 such fluctuations have been investigated by field measurements e g nielsen et al 1990 raubenheimer et al 1999 robinson et al 2006 heiss michael 2014 trglavcnik et al 2018 laboratory experiments e g cartwright et al 2004 robinson li 2004 shoushtari et al 2016 2017 numerical simulations e g li et al 1997 cartwright et al 2006 shoushtari et al 2015 brakenhoff et al 2019 and analytical solutions e g parlange brutsaert 1987 barry et al 1996 nielsen et al 1997 li et al 2000a b teo et al 2003 song et al 2007 kong et al 2013 2015 among these analytical solutions based on the 1d boussinesq equation describe watertable fluctuations and give results that are easily computed present explicit relations between parameters that impact watertable fluctuations and can be used as benchmarks for numerical simulations as described below laboratory experiments aimed at quantifying watertable fluctuations consider coastal aquifers with freshwater only i e density variations due to saltwater are ignored this simplifies the flow problem and permits unambiguous interpretation of the experimental data using fully analytical approaches this type of experiment is considered in this work despite its potential to be misleading we refer to this type of experimental setup as a coastal aquifer as is commonly done in the literature the dupuit forchheimer based boussinesq equation describes groundwater flow in the saturated zone bear 2012 it is amenable to analytical investigations and so is used to reveal mechanisms that influence watertable wave propagation e g nielsen 1990 li et al 2000a teo et al 2003 jeng et al 2005a to examine the effects of vertical flow on watertable fluctuations liu and wen 1997 and nielsen et al 1997 proposed a boussinesq equation based on different approximation methods however all these investigations ignore unsaturated flow that arises when the watertable rises and falls which affects predictions of watertable fluctuations e g gillham 1984 kong et al 2016b luo et al 2018 to improve such predictions modifications to the boussinesq equation are used an early step in this direction was taken by parlange and brutsaert 1987 who presented a boussinesq equation that included vertical exchange between the saturated and vadose zones barry et al 1996 presented an approximate analytical solution that considered the effect of this exchange on watertable fluctuations for the case of a periodic boundary condition following the method of parlange and brutsaert 1987 jeng et al 2005b further improved the boussinesq model by proposing a higher order capillarity correction these modifications were all based on the 1d boussinesq equation horizontal flow only without explicit consideration of vertical flow although the effect of the unsaturated zone was considered indirectly the combined effects of unsaturated and vertical flows were investigated by li et al 2000b and shoushtari et al 2016 who extended the boussinesq model proposed by nielsen et al 1997 recently kong et al 2013 2015 developed two types of boussinesq equation involving horizontal unsaturated flow under the assumption of a hydrostatic vertical pressure distribution accounting for both short kong et al 2013 and long kong et al 2015 period watertable fluctuations when applied to analyze watertable fluctuations in coastal unconfined aquifers subjected to the archetypal case of a single component boundary fluctuation most of the aforementioned boussinesq equation models predict an asymptotic amplitude decay rate and zero phase lag increase rate standing wave behavior of watertable waves for increasing dimensionless aquifer depth γ γ neωd ks where ne is the static effective porosity ω t 1 is the angular frequency of the boundary forcing d l is the mean aquifer depth and ks lt 1 is the saturated hydraulic conductivity e g barry et al 1996 liu wen 1997 nielsen et al 1997 li et al 2000a kong et al 2013 2015 nevertheless the laboratory experiments of shoushtari et al 2016 which cover a wide range of γ in an unconfined aquifer with a vertical boundary indicated an increase of both the amplitude decay rate and phase lag increase rate of watertable waves with increasing γ shoushtari et al 2016 concluded that the existing boussinesq equations could not correctly reproduce the experimental results this discrepancy between experimental data and theoretical predictions especially for the phase lag increase rate motivates further investigations on the potential mechanisms controlling watertable fluctuations in coastal unconfined aquifers soil porosity is an important parameter in quantifying water exchange in porous media if the watertable fluctuates rapidly then the vadose zone above the watertable will fill and drain in response the fluctuation rate affects how much water drains from or imbibes into the vadose zone and hence the pore space available for exchange between the watertable and the vadose zone is affected i e in the vadose zone above the watertable there is a dynamic effective porosity that depends on the fluctuation rate shoushtari et al 2016 attempted to address this issue by combining the complex frequency dependent effective porosity proposed by cartwright et al 2005 with the infinite order boussinesq equation of nielsen et al 1997 but like all existing theories this new theory failed to give predictions that matched their experimental results shoushtari et al 2016 did not analyze the effects of the dynamic effective porosity on watertable fluctuations and so it remains unclear to what extent the dynamic effective porosity affects watertable fluctuations in any case as indicated by hilberts and troch 2006 the complex valued expression for the dynamic effective porosity proposed by cartwright et al 2005 has limited practical use this paper aims to provide new insight into the effects of the dynamic effective porosity on watertable fluctuations first the dynamic effective porosity is determined empirically from existing experimental measurements and numerical results then a modified governing equation that considers the effects of the dynamic effective porosity is derived to predict watertable fluctuations this allows exploration of the underlying mechanisms causing the discrepancy between experimental data and existing theoretical predictions for watertable fluctuations finally conclusions are drawn 2 theory 2 1 modified governing equation with the dynamic effective porosity following liu wen 1997 for homogeneous and isotropic coastal unconfined aquifers fig 1 flow in the saturated zone can be described by the continuity equation 1 2 φ x 2 2 φ z 2 0 d z ζ where φ l is the hydraulic head x l is the horizontal distance from the vertical seaward boundary z l is the elevation relative to the x axis and ζ l is the watertable relative to the x axis at the watertable 2 φ ζ z ζ the kinematic free surface boundary satisfies 3 ζ t k s n e φ x ζ x k s n e φ z 0 z ζ where t t is time according to childs 1960 the effective porosity ne is defined as the volume of water that an unconfined aquifer releases or gains per unit surface area of aquifer per unit change of the watertable height in previous studies e g barry et al 1996 nielsen et al 1997 kong et al 2013 2015 ne was usually treated as a soil dependent constant however because of the unsaturated zone experimental nielsen perrochet 2000 cartwright et al 2005 numerical acharya et al 2012 pazdniakov et al 2019 and field rabinovich et al 2015 evidence indicates that ne is dynamic and depends on the porewater velocity therefore the dynamic effective porosity nt is introduced to account for unsaturated zone effects during watertable fluctuations replacing ne by nt leads to the modified kinematic free surface boundary condition with unsaturated zone effects included 4 ζ t k s n t φ x ζ x k s n t φ z 0 z ζ for the impermeable bottom boundary no flow boundary we have 5 φ z 0 z d the governing model is rewritten using the following dimensionless parameters liu wen 1997 6 ζ ζ a x x l z z d t k s d l 2 n t t h d d φ φ a where a l is the amplitude of driving wave envelope at the sea boundary and l k s d t n t l is the modified wave length with t t being the fluctuation period then an expansion is performed using two small parameters μ 2 and ε defined as liu wen 1997 7 μ 2 d l 2 n t d k s t ε a d replacing ne by nt leads to a smaller μ 2 for watertable fluctuations with the same period given that a perturbation method is used to derive the governing equation a smaller μ 2 leads to a smaller truncation error substituting eqs 6 and 7 into eqs 1 2 4 and 5 gives 8 μ 2 2 φ x 2 2 φ z 2 0 h z ε ζ 9 φ ζ z ε ζ 10 μ 2 ζ t ε φ x ζ x φ z 0 z ε ζ 11 φ z 0 z h integrating eq 8 along z from h to ε ζ and using eq 10 yields the exact equation 12 ζ t x h ε ζ φ x d z 0 the procedures given in liu and wen 1997 are used to find ζ from eq 12 which leads to 13 ζ t ε x ζ ζ x h 2 ζ x 2 1 3 μ 2 h 3 4 ζ x 4 0 the truncation error of eq 13 is o μ 4 μ 2 ε combining eq 6 with eq 13 gives the following dimensional form 14 n t ζ t k s x ζ ζ x k s d 2 ζ x 2 1 3 k s d 3 4 ζ x 4 eq 14 accounts for both the dynamic effective porosity nt in the left side of the equation and vertical flow effects final term on the right side of the equation on watertable fluctuations the derivation of eq 14 is identical to that presented by liu wen 1997 with the difference that unsaturated zone effects are taken into account by a watertable fluctuation dependent nt determined just below 2 2 dynamic effective porosity during watertable fluctuations pazdniakov et al 2019 proposed an approximate expression to predict the dynamic effective porosity under seasonal or diurnal groundwater level fluctuations motivated by the results of cartwright et al 2005 and pazdniakov et al 2019 and assuming no truncation of the capillary fringe a modified empirical expression describing the relation between the dynamic effective porosity and fluctuation frequency is 15a n t n e 1 exp a τ ω b with 15b τ ω n e h ψ k s 1 ω n e ω h ψ k s 15c n e h ψ 0 θ θ r d ψ where τ ω is a dimensionless time scale related to the watertable fluctuation frequency and soil properties a and b are the fitting parameters section 3 1 θ is the soil water content related to the capillary suction ψ l θ r is the residual soil water content and hψ l is a measure of the equivalent saturated height of the unsaturated zone parlange brutsaert 1987 cartwright et al 2005 physically τ ω is the ratio of the response timescale of the unsaturated zone nehψ ks the minimum time needed by the unsaturated zone to fully respond to a boundary disturbance to the timescale of the surface water level fluctuation imposed on the aquifer 1 ω it should be noted that eq 15a has the same functional form as that of pazdniakov et al 2019 but a with different variable τ ω we will discuss eq 15a in more detail shortly to solve eq 15c explicitly the relation between θ and ψ is described by a modified van genuchten model troch 1993 kong et al 2016b luo et al 2019 16 θ θ s θ r s e θ r θ s θ r 1 α 1 ψ n 1 1 1 n 1 θ r where θ s is the saturated soil water content se is the effective saturation and α 1 l 1 and n 1 are the parameters obtained by fitting eq 16 to measurements of the soil moisture characteristic curve other expressions e g van genuchten 1980 can also be used to describe the relation between θ and ψ but eq 15c may then need to be evaluated numerically observe that the difference between eq 16 and the original van genuchten 1980 model vg model is the exponent substituting eq 16 into eq 15c gives 17 h ψ 1 α 1 by comparison pazdniakov et al 2019 derived τ ω from the relation between the hydraulic conductivity and the capillary suction whereas here it is derived from the relation between soil water content and capillary suction in addition τ ω is an approximation in pozdniakov et al 2019 their eq 12 whereas here it is an exact expression due to use of eq 16 related to the fluctuation period 2 3 analytical solution to the modified governing equation substituting eq 15a into eq 14 gives 18 n e 1 exp a τ ω b ζ t k s x ζ ζ x k s d 2 ζ x 2 1 3 k s d 3 4 ζ x 4 to derive the analytical solution for the watertable as in previous studies a single component sinusoidal tide at the sea boundary is assumed 19 ζ 0 t a s i n ω t for ε 1 eq 7 watertable fluctuations are small and eq 18 can be linearized to e g parlange brutsaert 1987 barry et al 1996 kong et al 2015 20 n e 1 exp a τ ω b ζ t k s d 2 ζ x 2 1 3 k s d 3 4 ζ x 4 for which the analytical solution is e g liu and wen 1997 nielsen et al 1997 21a ζ a exp k r d x s i n ω t k i d x with 21b k d 3 2 1 1 4 3 1 exp a τ ω b n e ω d k s i where k kr iki is the watertable wave number with i 1 the real krd and imaginary kid parts represent the amplitude spatial decay rate and phase lag increase rate of the predicted watertable waves respectively liu wen 1997 3 results and discussion 3 1 effects of watertable fluctuations on dynamic effective porosity 1d column experiments the main reason that the dynamic effective porosity varies with watertable fluctuation rate is the filling drainage of the unsaturated zone above the aquifer which is rate limited due to the water flow rate e g li et al 1997 cartwright 2014 cartwright et al 2005 reported experiments to quantify this exchange using 1d column experiments to establish the relation between dynamic effective porosity nt and forcing fluctuation frequency ω the dimensionless parameter τ ω eq 15b is used if the response time of the unsaturated zone is much longer than the timescale of the surface water level fluctuation i e large τ ω water in the unsaturated zone will not have sufficient time to reach equilibrium during watertable fluctuations then the water exchange between the saturated and unsaturated zones must reduce resulting in a smaller nt this behavior is consistent with experimental evidence cartwright et al 2005 cartwright 2014 luo et al 2020 and the complex dynamic effective porosity concept of nielsen and perrochet 2000 and cartwright et al 2005 eq 15a captures this behavior since nt approaches ne for small τ ω whereas it tends to zero for large τ ω the appropriateness of the functional form of eq 15a is evaluated by fitting it to nt obtained from experiments and numerical simulations cartwright et al 2005 carried out 63 experiments involving three different soils as can be seen from fig 2 a the range of nt ne and τ ω for these experiments varies from 10 2 5 to 10 0 4 two orders of magnitude and 10 2 to 103 five orders of magnitude respectively as expected nt ne declines with increasing τ ω in addition regardless of soil type there is a clear relation between nt ne and τ ω which is captured by eq 15a the parameters of which can be fitted e g matlab ver 9 function lsqcurvefit giving a 0 0335 and b 0 4444 fig 2a in general eq 15a performs well although there is small deviation between eq 15a and experimental data at larger τ ω in short the fitted values match well with the experimental values r 2 0 94 indicating that eq 15a satisfactorily describes the dynamic effective porosity as it varies with the fluctuation frequency for different soils since the ranges of nt ne and τ ω obtained from experiments are relatively narrow we also consider numerical model results of pozdniakov et al 2019 a total of 299 cases covering 100 random soils was simulated with hydrus 1d šimůnek et al 2020 compared with available experiments these numerical simulations cover wider ranges of nt ne and τ ω with the former varying from 10 3 to 100 three orders of magnitude and the latter from 10 3 to 105 eight orders of magnitude as shown in fig 3 b nt ne is equal to unity at small τ ω and then decreases rapidly with increasing τ ω suggesting a frequency dependent nt ne again numerical results show a clear dependence of nt ne on τ ω although both nt ne and τ ω span a broad range for the numerical model results the relation between nt ne and τ ω can be approximated by eq 15a by taking a 0 1216 and b 0 3642 although there is a small deviation at large τ ω we also plotted the fitted nt ne versus numerical nt ne fig 3b the fitted values match well with the numerical values r 2 0 98 based on the experimental and numerical data the effective porosity will be significantly impacted by watertable fluctuations when τ ω is larger than 0 01 green dashed line in figs 2a and 3a this gives a critical value to identify whether the unsaturated zone has sufficient time to respond to a boundary fluctuation it is worth noting that the values of a and b are different for experimental and numerical results which leads to a small deviation between the optimal fitting curves fig 3a this systematic deviation could be induced by either the experiments or the simulations on the one hand hysteresis is ignored in the numerical simulations on the other hand there is a lack of measurements for nt ne close to 1 for experiments which will affect the fitting results in addition a linear response of the watertable is assumed to determine the experimental dynamic effective porosity cartwright et al 2005 i e the governing equation was linearized above under the assumption of a small amplitude fluctuation which may contribute to the deviation overall despite these uncertainties the relation between the dynamic effective porosity and fluctuation frequency can be predicted with reasonable accuracy by eq 15a the 1d sand column experiments carried out by nielsen and perrochet 2000 and cartwright et al 2005 indicate a phase lag between the total moisture above the watertable and watertable height during watertable fluctuations in order to account for this phase lag cartwright et al 2005 suggested a complex valued expression to describe the dynamic effective porosity where the real and imaginary parts respectively represent the effective porosity and phase lag however in this study we focus on watertable fluctuations in coastal unconfined aquifers 2d systems as they respond to boundary forcing with a fixed frequency not the moisture content above the watertable for this case in the following section we examine the impact of eq 15a in predicting watertable fluctuations in 2d experiments for horizontal transmission of watertable fluctuations forced by a single component watertable change at the boundary 3 2 effects of dynamic effective porosity on watertable fluctuations 2d aquifer experiments here an extensive set of existing 2d experimental results is used to examine the modified governing eq 18 in predicting watertable fluctuations as mentioned earlier eq 18 considers both the dynamic effective porosity and vertical flow effects therefore to identify the respective roles of the vertical flow and dynamic effective porosity three other equations based on eq 18 are presented 1 eq a1 a refers to the appendix without the dynamic effective porosity and vertical flow 2 eq a2 only with the vertical flow and 3 eq a3 only with the dynamic effective porosity following previous studies e g nielsen 1990 barry et al 1996 li et al 2000a cartwright et al 2004 kong et al 2015 the dispersion relation linking the amplitude decay rate krd with phase lag increase rate kid is adopted to characterize the propagation of watertable waves a total of 122 sand flume experiments covering a wide range of γ values from 4 to 415 were reported by shoushtari et al 2016 and are used here to examine the validity of these predictions the experiments were carried out in a sand flume with dimensions of 9 m length 0 15 m width 1 5 m height given that the properties are similar the two sands adopted in shoushtari et al 2016 s experiments are considered to have the same vg fitting parameters van genuchten 1980 as can be seen from fig 4 eq 16 matches well with the vg model using the parameters listed in table 1 there is a small deviation between the best fit curves for the experimental and numerical data of nt ne and τ ω and so two pairs of curves for the two pairs of best fit a and b values are compared one pair of values obtained from fitting to experimental data and another pair from fitting to numerical data in general eq 18 requires that both ε and μ 2 are small for the experiments of shoushtari et al 2016 ε changes from 0 11 to 0 15 μ 2 is in the range of 0 64 to 66 08 with the static effective porosity whereas it varies from 0 085 to 1 19 and 0 18 to 3 85 for a and b values obtained from fitting to experimental and numerical data respectively fig 5 therefore it is anticipated that including the dynamic effective porosity leads to a smaller truncation error when using eq 18 even though μ 2 is slightly larger than unity in a few experimental cases with the dynamic effective porosity included we will see that eq 18 still performs well in predicting watertable fluctuations fig 6 shows the predictions of the dispersion relations in eqs a7 and a8 which were derived from eqs a1 and a2 respectively as expected eq a1 performs poorly whereas eq a2 compares well with the data shoushtari et al 2016 this suggests that the vertical flow plays an important role in affecting watertable wave propagations note that plots of krd versus kid are independent of any specific form adopted for ne since such plots depend on a single dimensionless parameter γ nielsen et al 1997 shoushtari et al 2016 therefore the predicted curves from eqs a1 and a3 overlap with each other as well as those from equations a2 and 18 the role of γ is further explored by examining each of krd and kid as a function of neωd k fig 7 to check the applicability of the modified eqs 18 and a3 i e approximate analytical solutions of the dispersion relation shown in eqs 21b and a9 respectively in contrast to the relation between krd and kid which as mentioned is independent of the functional form of ne there are large deviations between predictions of krd and kid as they vary with γ from governing equations with or without considering dynamic effective porosity effects depending on the values of a and b fig 7 moreover these deviations increase for increasing γ again this emphasizes that the effective porosity is increasingly influenced by watertable fluctuations as γ increases compared to eqs a1 and a2 i e approximate analytical solutions of the dispersion relation shown in eqs a7 and a8 respectively that assume a constant effective porosity for a given γ both krd and kid are smaller when the dynamic effective porosity is considered this is because a smaller effective porosity corresponds to reduced vertical water exchange and hence watertable waves can propagate further landward i e smaller krd and kid li et al 2000b shoushtari et al 2016 analyzed their experimental results and demonstrated that the existing theories were unable to predict the measured dispersion relation correctly fig 5 in shoushtari et al 2016 even considering different factors e g capillary effect hysteresis porous media deformation shoushtari cartwright 2017 in contrast eq 18 predicts well the relations between krd or kid and γ despite the fact that experimental and numerical results of the dynamic effective porosity do not agree i e give rise to different values of a and b in eq 15a consistent with the experimental results no standing waves occur even for large γ when predicting watertable fluctuations based on eq 18 this is because a large γ induces a small effective porosity that enhances watertable wave propagation the success of eq 18 highlights the significant role played by dynamic effective porosity on watertable fluctuations and so confirms that eq 15a fitted by nonlinear least squares can be used to describe the relation between dynamic effective porosity and fluctuation frequency moreover this in turn suggests that the phase lag between the total moisture and watertable height measured in laboratory experiments using vertical soil columns can be ignored when predicting watertable fluctuations observe that substituting the complex valued expression for the dynamic effective porosity proposed by cartwright et al 2005 into eq 14 does not properly predict the measured dispersion relation fig 8 moreover as mentioned previously the complex valued expression for the dynamic effective porosity proposed by cartwright et al 2005 has limited practical use hilberts troch 2006 to overcome this shortcoming cartwright et al 2006 took the absolute value of the complex number and got reasonable outcomes when predicting watertable fluctuations that is cartwright et al 2006 adopt a real valued expression for the dynamic effective porosity further showing that the phase lag between the total moisture and watertable height measured in laboratory experiments using vertical soil columns can be ignored when predicting watertable fluctuations eq 18 with a and b from experiments a 0 0335 and b 0 4444 performs better than the corresponding simulation derived values in predicting experimental results this is consistent with μ 2 being much smaller for a and b when these parameters are determined from fitting to experimental data thus leading to a smaller truncation error it further suggests that richards equation has some limitations in describing exchange between the saturated and unsaturated zones for watertables subjected to high frequency fluctuations as already shown by shoushtari et al 2016 3 3 applications of the modified governing equation to predict watertable fluctuations in other experiments regardless of the values of a and b obtained from fitting to experimental or numerical data eq 18 captures not only the behavior of krd versus kid but also krd or kid versus γ for 122 experiments conducted by shoushtari et al 2016 however the dimensionless parameter γ varies from 4 to 415 for these experiments in reality tides usually have a period of about 12 h assuming d 20 m typical aquifer depth according to zamrsky et al 2018 ne 0 4 and ks 4 10 4 m s typical properties of sand leads to γ 2 9 smaller than 4 it still remains unclear whether eq 18 can accurately predict the dispersion relation for watertable fluctuations with γ 4 therefore we further validated eq 18 by comparing its predictions with experiments having a smaller value of γ kong et al 2016a carried out watertable fluctuation experiments using a sand flume with dimensions of 30 m length 1 5 m height 1 2 m width the sand adopted in the experiment had a saturated hydraulic conductivity of 5 10 4 m s 1 and a static effective porosity of 0 42 for the experimental sand hψ was 0 55 m the mean sea level was set to 0 9 m from the aquifer bottom three different water level fluctuations with the same amplitude 0 2 m but a different period 45 60 and 120 min were imposed on the sea boundary leading to γ 1 76 1 32 and 0 32 respectively in accordance with the preceding section two pairs of a and b were considered a 0 0335 and b 0 4444 and a 0 1216 and b 0 3642 fig 6 displays predicted krd versus kid curves and experimental data as can be seen the three measured points from kong et al 2016a are close to the curve predicted by eq 18 in addition the relations between krd or kid and γ are presented in fig 9 consistent with high frequency watertable fluctuations the governing equation without including the dynamic effective porosity significantly overestimates k r d and k i d for all three experiments with a smaller γ in addition increasing γ exacerbates the deviation between the analytical predictions and measurements once the dynamic effective porosity is considered the analytical solution performs better in predicting both krd and kid this confirms the validity of eq 18 and highlights the crucial role played by the dynamic effective porosity even for low frequency watertable fluctuations by comparison again eq 18 with a and b from experiments a 0 0335 and b 0 4444 performs better in predicting measured results additionally experimental results of parlange et al 1984 and cartwright et al 2003 were used to check the validity of eq 18 as can be seen from figs 10 and 11 predictions of eq 18 agree well with the measured watertable in both experiments note that since unsaturated properties of the sand used in parlange et al 1984 were not reported the optimal value of nt ks in eq 14 was estimated to be 0 5 s cm consistent with experiments of shoushtari et al 2016 and kong et al 2016a eq 18 with a and b from experiments a 0 0335 and b 0 4444 performs better in predicting experimental results of cartwright et al 2003 therefore experimentally determined values of a and b are recommended for practical use when predicting watertable fluctuations in coastal unconfined aquifers 4 conclusions this study evaluated the effects of dynamic effective porosity on watertable fluctuations in coastal unconfined aquifers following pazdniakov et al 2019 we proposed a new modified expression to predict the dynamic effective porosity under watertable fluctuations after validation against both experiments and numerical simulations this expression was substituted into a modified boussinesq equation to examine the effects of the dynamic effective porosity on watertable fluctuations the results lead to the following conclusions a real valued expression equation 15 quantifying changes in the dynamic effective porosity due to watertable fluctuations agrees with experimental and numerical results in 1d systems eq 18 which results from replacing the static effective porosity with the real valued expression of the dynamic effective porosity equation 15 in the boussinesq model of liu and wen 1997 leads to accurate predictions of watertable fluctuations in four sets of experimental data the above finding means that the phase lag between the total moisture above the watertable and watertable height measured in laboratory experiments using vertical soil columns 1d systems has negligible effects when predicting watertable fluctuations in coastal unconfined aquifers 2d systems the modified governing equation considering the vertical flow in the saturated zone and dynamic effective porosity can accurately predict experimental dispersion relations highlighting the importance of dynamic effective porosity in modeling watertable fluctuations for a given soil the dynamic effective porosity decreases with increasing fluctuation frequency leading to a decrease in vertical water exchange between the saturated zone and unsaturated zone and hence watertable waves can propagate further landward especially for high frequency fluctuations consistent with experimental observations no standing waves occur even at a large γ i e high frequency fluctuations imposed at the lateral seaward boundary when predicting watertable fluctuations based on the modified governing equation this is because a large γ induces a small effective porosity that enhances watertable wave propagation because of macropores and faults aquifers are invariably more complicated than the one considered here which significantly affects watertable fluctuations geng michael 2021 moreover the density difference between seawater and fresh groundwater is ignored consistent with the experimental data sets analyzed regardless this study shows that the dynamic effective porosity plays an important role in modeling watertable fluctuations our real valued effective porosity model leads to reliable predictions of watertable response which is essential for reliable quantification of many groundwater dependent processes in coastal unconfined aquifers credit authorship contribution statement zhaoyang luo conceptualization methodology visualization writing original draft writing review editing jun kong conceptualization methodology supervision writing review editing lili yao visualization writing review editing chunhui lu writing review editing ling li writing review editing d a barry methodology supervision writing review editing declaration of competing interest the authors declare that there is no conflict of interest acknowledgments this research was supported by the national natural science foundation of china 51979095 and marine science and technology innovation project of jiangsu jszrhykj202105 we gratefully appreciate p wang for providing the numerical data of pozdniakov et al 2019 and n cartwright for providing the experimental data of shoushtari et al 2016 appendix when dynamic effective porosity and vertical flow effects are ignored eq 18 reduces to a1 n e ζ t k s x ζ ζ x k s d 2 ζ x 2 considering only vertical flow effects eq 18 reduces to a2 n e ζ t k s x ζ ζ x k s d 2 ζ x 2 1 3 k s d 3 4 ζ x 4 whereas if only the dynamic effective porosity effects are accounted for eq 18 reduces to a3 n e 1 exp a τ ω b ζ t k s x ζ ζ x k s d 2 ζ x 2 eqs a1 a3 are linearized as respectively a4 n e ζ t k s d 2 ζ x 2 a5 n e ζ t k s d 2 ζ x 2 1 3 k s d 3 4 ζ x 4 a6 n e 1 exp a τ ω b ζ t k s d 2 ζ x 2 the corresponding dispersion relations of watertable waves from eqs a4 a6 are respectively liu and wen 1997 nielsen et al 1997 a7 k d n e ω d k s i a8 k d 3 2 1 1 4 3 n e ω d k s i a9 k d 1 exp a τ ω b n e ω d k s i 
73,watertable fluctuations are a characteristic feature of coastal unconfined aquifers they interact with the vadose zone creating a dynamic effective porosity for which a new empirical expression is proposed based on a dimensionless parameter related to the fluctuation frequency after comparing with both experimental data and numerical simulations the new expression is implemented into a modified boussinesq equation allowing for examination of the effects of the dynamic effective porosity on watertable fluctuations the dispersion relation arising from the modified boussinesq equation predicts laboratory experimental data accurately highlighting the importance of the dynamic effective porosity in modeling watertable fluctuations in coastal unconfined aquifers this in turn confirms the applicability of the real valued expression of the dynamic effective porosity an outcome is that the phase lag between the total moisture above the watertable and watertable height measured in laboratory experiments using vertical soil columns 1d systems can be ignored when predicting watertable fluctuations in coastal unconfined aquifers 2d systems the dynamic effective porosity is always smaller than the soil porosity and so by comparison there is a reduction in vertical water exchange between the saturated and vadose zones consequently watertable waves can propagate further landward without standing wave behaviors keywords vadose zone effects boussinesq equation analytical solution laboratory experiment dispersion relation data availability all of data are compiled from previous studies 1 introduction as a transition zone between the ocean and land coastal unconfined aquifers respond to interactions between terrestrial fresh groundwater and seawater due to oceanic oscillations e g tides or waves water flows into or out of the aquifer periodically which directly affects a range of groundwater dependent processes including sediment mobilization seawater intrusion submarine groundwater discharge solute transport and chemical loading to the ocean e g parlange et al 1984 li et al 1999 moore 2010 xin et al 2010 bakhtyar et al 2011 werner et al 2013 robinson et al 2018 wallace et al 2020 watertable fluctuations induced by oceanic oscillations are an important signal for quantifying these processes and their prediction is a longstanding topic e g philip 1973 smiles stokes 1976 parlange et al 1984 such fluctuations have been investigated by field measurements e g nielsen et al 1990 raubenheimer et al 1999 robinson et al 2006 heiss michael 2014 trglavcnik et al 2018 laboratory experiments e g cartwright et al 2004 robinson li 2004 shoushtari et al 2016 2017 numerical simulations e g li et al 1997 cartwright et al 2006 shoushtari et al 2015 brakenhoff et al 2019 and analytical solutions e g parlange brutsaert 1987 barry et al 1996 nielsen et al 1997 li et al 2000a b teo et al 2003 song et al 2007 kong et al 2013 2015 among these analytical solutions based on the 1d boussinesq equation describe watertable fluctuations and give results that are easily computed present explicit relations between parameters that impact watertable fluctuations and can be used as benchmarks for numerical simulations as described below laboratory experiments aimed at quantifying watertable fluctuations consider coastal aquifers with freshwater only i e density variations due to saltwater are ignored this simplifies the flow problem and permits unambiguous interpretation of the experimental data using fully analytical approaches this type of experiment is considered in this work despite its potential to be misleading we refer to this type of experimental setup as a coastal aquifer as is commonly done in the literature the dupuit forchheimer based boussinesq equation describes groundwater flow in the saturated zone bear 2012 it is amenable to analytical investigations and so is used to reveal mechanisms that influence watertable wave propagation e g nielsen 1990 li et al 2000a teo et al 2003 jeng et al 2005a to examine the effects of vertical flow on watertable fluctuations liu and wen 1997 and nielsen et al 1997 proposed a boussinesq equation based on different approximation methods however all these investigations ignore unsaturated flow that arises when the watertable rises and falls which affects predictions of watertable fluctuations e g gillham 1984 kong et al 2016b luo et al 2018 to improve such predictions modifications to the boussinesq equation are used an early step in this direction was taken by parlange and brutsaert 1987 who presented a boussinesq equation that included vertical exchange between the saturated and vadose zones barry et al 1996 presented an approximate analytical solution that considered the effect of this exchange on watertable fluctuations for the case of a periodic boundary condition following the method of parlange and brutsaert 1987 jeng et al 2005b further improved the boussinesq model by proposing a higher order capillarity correction these modifications were all based on the 1d boussinesq equation horizontal flow only without explicit consideration of vertical flow although the effect of the unsaturated zone was considered indirectly the combined effects of unsaturated and vertical flows were investigated by li et al 2000b and shoushtari et al 2016 who extended the boussinesq model proposed by nielsen et al 1997 recently kong et al 2013 2015 developed two types of boussinesq equation involving horizontal unsaturated flow under the assumption of a hydrostatic vertical pressure distribution accounting for both short kong et al 2013 and long kong et al 2015 period watertable fluctuations when applied to analyze watertable fluctuations in coastal unconfined aquifers subjected to the archetypal case of a single component boundary fluctuation most of the aforementioned boussinesq equation models predict an asymptotic amplitude decay rate and zero phase lag increase rate standing wave behavior of watertable waves for increasing dimensionless aquifer depth γ γ neωd ks where ne is the static effective porosity ω t 1 is the angular frequency of the boundary forcing d l is the mean aquifer depth and ks lt 1 is the saturated hydraulic conductivity e g barry et al 1996 liu wen 1997 nielsen et al 1997 li et al 2000a kong et al 2013 2015 nevertheless the laboratory experiments of shoushtari et al 2016 which cover a wide range of γ in an unconfined aquifer with a vertical boundary indicated an increase of both the amplitude decay rate and phase lag increase rate of watertable waves with increasing γ shoushtari et al 2016 concluded that the existing boussinesq equations could not correctly reproduce the experimental results this discrepancy between experimental data and theoretical predictions especially for the phase lag increase rate motivates further investigations on the potential mechanisms controlling watertable fluctuations in coastal unconfined aquifers soil porosity is an important parameter in quantifying water exchange in porous media if the watertable fluctuates rapidly then the vadose zone above the watertable will fill and drain in response the fluctuation rate affects how much water drains from or imbibes into the vadose zone and hence the pore space available for exchange between the watertable and the vadose zone is affected i e in the vadose zone above the watertable there is a dynamic effective porosity that depends on the fluctuation rate shoushtari et al 2016 attempted to address this issue by combining the complex frequency dependent effective porosity proposed by cartwright et al 2005 with the infinite order boussinesq equation of nielsen et al 1997 but like all existing theories this new theory failed to give predictions that matched their experimental results shoushtari et al 2016 did not analyze the effects of the dynamic effective porosity on watertable fluctuations and so it remains unclear to what extent the dynamic effective porosity affects watertable fluctuations in any case as indicated by hilberts and troch 2006 the complex valued expression for the dynamic effective porosity proposed by cartwright et al 2005 has limited practical use this paper aims to provide new insight into the effects of the dynamic effective porosity on watertable fluctuations first the dynamic effective porosity is determined empirically from existing experimental measurements and numerical results then a modified governing equation that considers the effects of the dynamic effective porosity is derived to predict watertable fluctuations this allows exploration of the underlying mechanisms causing the discrepancy between experimental data and existing theoretical predictions for watertable fluctuations finally conclusions are drawn 2 theory 2 1 modified governing equation with the dynamic effective porosity following liu wen 1997 for homogeneous and isotropic coastal unconfined aquifers fig 1 flow in the saturated zone can be described by the continuity equation 1 2 φ x 2 2 φ z 2 0 d z ζ where φ l is the hydraulic head x l is the horizontal distance from the vertical seaward boundary z l is the elevation relative to the x axis and ζ l is the watertable relative to the x axis at the watertable 2 φ ζ z ζ the kinematic free surface boundary satisfies 3 ζ t k s n e φ x ζ x k s n e φ z 0 z ζ where t t is time according to childs 1960 the effective porosity ne is defined as the volume of water that an unconfined aquifer releases or gains per unit surface area of aquifer per unit change of the watertable height in previous studies e g barry et al 1996 nielsen et al 1997 kong et al 2013 2015 ne was usually treated as a soil dependent constant however because of the unsaturated zone experimental nielsen perrochet 2000 cartwright et al 2005 numerical acharya et al 2012 pazdniakov et al 2019 and field rabinovich et al 2015 evidence indicates that ne is dynamic and depends on the porewater velocity therefore the dynamic effective porosity nt is introduced to account for unsaturated zone effects during watertable fluctuations replacing ne by nt leads to the modified kinematic free surface boundary condition with unsaturated zone effects included 4 ζ t k s n t φ x ζ x k s n t φ z 0 z ζ for the impermeable bottom boundary no flow boundary we have 5 φ z 0 z d the governing model is rewritten using the following dimensionless parameters liu wen 1997 6 ζ ζ a x x l z z d t k s d l 2 n t t h d d φ φ a where a l is the amplitude of driving wave envelope at the sea boundary and l k s d t n t l is the modified wave length with t t being the fluctuation period then an expansion is performed using two small parameters μ 2 and ε defined as liu wen 1997 7 μ 2 d l 2 n t d k s t ε a d replacing ne by nt leads to a smaller μ 2 for watertable fluctuations with the same period given that a perturbation method is used to derive the governing equation a smaller μ 2 leads to a smaller truncation error substituting eqs 6 and 7 into eqs 1 2 4 and 5 gives 8 μ 2 2 φ x 2 2 φ z 2 0 h z ε ζ 9 φ ζ z ε ζ 10 μ 2 ζ t ε φ x ζ x φ z 0 z ε ζ 11 φ z 0 z h integrating eq 8 along z from h to ε ζ and using eq 10 yields the exact equation 12 ζ t x h ε ζ φ x d z 0 the procedures given in liu and wen 1997 are used to find ζ from eq 12 which leads to 13 ζ t ε x ζ ζ x h 2 ζ x 2 1 3 μ 2 h 3 4 ζ x 4 0 the truncation error of eq 13 is o μ 4 μ 2 ε combining eq 6 with eq 13 gives the following dimensional form 14 n t ζ t k s x ζ ζ x k s d 2 ζ x 2 1 3 k s d 3 4 ζ x 4 eq 14 accounts for both the dynamic effective porosity nt in the left side of the equation and vertical flow effects final term on the right side of the equation on watertable fluctuations the derivation of eq 14 is identical to that presented by liu wen 1997 with the difference that unsaturated zone effects are taken into account by a watertable fluctuation dependent nt determined just below 2 2 dynamic effective porosity during watertable fluctuations pazdniakov et al 2019 proposed an approximate expression to predict the dynamic effective porosity under seasonal or diurnal groundwater level fluctuations motivated by the results of cartwright et al 2005 and pazdniakov et al 2019 and assuming no truncation of the capillary fringe a modified empirical expression describing the relation between the dynamic effective porosity and fluctuation frequency is 15a n t n e 1 exp a τ ω b with 15b τ ω n e h ψ k s 1 ω n e ω h ψ k s 15c n e h ψ 0 θ θ r d ψ where τ ω is a dimensionless time scale related to the watertable fluctuation frequency and soil properties a and b are the fitting parameters section 3 1 θ is the soil water content related to the capillary suction ψ l θ r is the residual soil water content and hψ l is a measure of the equivalent saturated height of the unsaturated zone parlange brutsaert 1987 cartwright et al 2005 physically τ ω is the ratio of the response timescale of the unsaturated zone nehψ ks the minimum time needed by the unsaturated zone to fully respond to a boundary disturbance to the timescale of the surface water level fluctuation imposed on the aquifer 1 ω it should be noted that eq 15a has the same functional form as that of pazdniakov et al 2019 but a with different variable τ ω we will discuss eq 15a in more detail shortly to solve eq 15c explicitly the relation between θ and ψ is described by a modified van genuchten model troch 1993 kong et al 2016b luo et al 2019 16 θ θ s θ r s e θ r θ s θ r 1 α 1 ψ n 1 1 1 n 1 θ r where θ s is the saturated soil water content se is the effective saturation and α 1 l 1 and n 1 are the parameters obtained by fitting eq 16 to measurements of the soil moisture characteristic curve other expressions e g van genuchten 1980 can also be used to describe the relation between θ and ψ but eq 15c may then need to be evaluated numerically observe that the difference between eq 16 and the original van genuchten 1980 model vg model is the exponent substituting eq 16 into eq 15c gives 17 h ψ 1 α 1 by comparison pazdniakov et al 2019 derived τ ω from the relation between the hydraulic conductivity and the capillary suction whereas here it is derived from the relation between soil water content and capillary suction in addition τ ω is an approximation in pozdniakov et al 2019 their eq 12 whereas here it is an exact expression due to use of eq 16 related to the fluctuation period 2 3 analytical solution to the modified governing equation substituting eq 15a into eq 14 gives 18 n e 1 exp a τ ω b ζ t k s x ζ ζ x k s d 2 ζ x 2 1 3 k s d 3 4 ζ x 4 to derive the analytical solution for the watertable as in previous studies a single component sinusoidal tide at the sea boundary is assumed 19 ζ 0 t a s i n ω t for ε 1 eq 7 watertable fluctuations are small and eq 18 can be linearized to e g parlange brutsaert 1987 barry et al 1996 kong et al 2015 20 n e 1 exp a τ ω b ζ t k s d 2 ζ x 2 1 3 k s d 3 4 ζ x 4 for which the analytical solution is e g liu and wen 1997 nielsen et al 1997 21a ζ a exp k r d x s i n ω t k i d x with 21b k d 3 2 1 1 4 3 1 exp a τ ω b n e ω d k s i where k kr iki is the watertable wave number with i 1 the real krd and imaginary kid parts represent the amplitude spatial decay rate and phase lag increase rate of the predicted watertable waves respectively liu wen 1997 3 results and discussion 3 1 effects of watertable fluctuations on dynamic effective porosity 1d column experiments the main reason that the dynamic effective porosity varies with watertable fluctuation rate is the filling drainage of the unsaturated zone above the aquifer which is rate limited due to the water flow rate e g li et al 1997 cartwright 2014 cartwright et al 2005 reported experiments to quantify this exchange using 1d column experiments to establish the relation between dynamic effective porosity nt and forcing fluctuation frequency ω the dimensionless parameter τ ω eq 15b is used if the response time of the unsaturated zone is much longer than the timescale of the surface water level fluctuation i e large τ ω water in the unsaturated zone will not have sufficient time to reach equilibrium during watertable fluctuations then the water exchange between the saturated and unsaturated zones must reduce resulting in a smaller nt this behavior is consistent with experimental evidence cartwright et al 2005 cartwright 2014 luo et al 2020 and the complex dynamic effective porosity concept of nielsen and perrochet 2000 and cartwright et al 2005 eq 15a captures this behavior since nt approaches ne for small τ ω whereas it tends to zero for large τ ω the appropriateness of the functional form of eq 15a is evaluated by fitting it to nt obtained from experiments and numerical simulations cartwright et al 2005 carried out 63 experiments involving three different soils as can be seen from fig 2 a the range of nt ne and τ ω for these experiments varies from 10 2 5 to 10 0 4 two orders of magnitude and 10 2 to 103 five orders of magnitude respectively as expected nt ne declines with increasing τ ω in addition regardless of soil type there is a clear relation between nt ne and τ ω which is captured by eq 15a the parameters of which can be fitted e g matlab ver 9 function lsqcurvefit giving a 0 0335 and b 0 4444 fig 2a in general eq 15a performs well although there is small deviation between eq 15a and experimental data at larger τ ω in short the fitted values match well with the experimental values r 2 0 94 indicating that eq 15a satisfactorily describes the dynamic effective porosity as it varies with the fluctuation frequency for different soils since the ranges of nt ne and τ ω obtained from experiments are relatively narrow we also consider numerical model results of pozdniakov et al 2019 a total of 299 cases covering 100 random soils was simulated with hydrus 1d šimůnek et al 2020 compared with available experiments these numerical simulations cover wider ranges of nt ne and τ ω with the former varying from 10 3 to 100 three orders of magnitude and the latter from 10 3 to 105 eight orders of magnitude as shown in fig 3 b nt ne is equal to unity at small τ ω and then decreases rapidly with increasing τ ω suggesting a frequency dependent nt ne again numerical results show a clear dependence of nt ne on τ ω although both nt ne and τ ω span a broad range for the numerical model results the relation between nt ne and τ ω can be approximated by eq 15a by taking a 0 1216 and b 0 3642 although there is a small deviation at large τ ω we also plotted the fitted nt ne versus numerical nt ne fig 3b the fitted values match well with the numerical values r 2 0 98 based on the experimental and numerical data the effective porosity will be significantly impacted by watertable fluctuations when τ ω is larger than 0 01 green dashed line in figs 2a and 3a this gives a critical value to identify whether the unsaturated zone has sufficient time to respond to a boundary fluctuation it is worth noting that the values of a and b are different for experimental and numerical results which leads to a small deviation between the optimal fitting curves fig 3a this systematic deviation could be induced by either the experiments or the simulations on the one hand hysteresis is ignored in the numerical simulations on the other hand there is a lack of measurements for nt ne close to 1 for experiments which will affect the fitting results in addition a linear response of the watertable is assumed to determine the experimental dynamic effective porosity cartwright et al 2005 i e the governing equation was linearized above under the assumption of a small amplitude fluctuation which may contribute to the deviation overall despite these uncertainties the relation between the dynamic effective porosity and fluctuation frequency can be predicted with reasonable accuracy by eq 15a the 1d sand column experiments carried out by nielsen and perrochet 2000 and cartwright et al 2005 indicate a phase lag between the total moisture above the watertable and watertable height during watertable fluctuations in order to account for this phase lag cartwright et al 2005 suggested a complex valued expression to describe the dynamic effective porosity where the real and imaginary parts respectively represent the effective porosity and phase lag however in this study we focus on watertable fluctuations in coastal unconfined aquifers 2d systems as they respond to boundary forcing with a fixed frequency not the moisture content above the watertable for this case in the following section we examine the impact of eq 15a in predicting watertable fluctuations in 2d experiments for horizontal transmission of watertable fluctuations forced by a single component watertable change at the boundary 3 2 effects of dynamic effective porosity on watertable fluctuations 2d aquifer experiments here an extensive set of existing 2d experimental results is used to examine the modified governing eq 18 in predicting watertable fluctuations as mentioned earlier eq 18 considers both the dynamic effective porosity and vertical flow effects therefore to identify the respective roles of the vertical flow and dynamic effective porosity three other equations based on eq 18 are presented 1 eq a1 a refers to the appendix without the dynamic effective porosity and vertical flow 2 eq a2 only with the vertical flow and 3 eq a3 only with the dynamic effective porosity following previous studies e g nielsen 1990 barry et al 1996 li et al 2000a cartwright et al 2004 kong et al 2015 the dispersion relation linking the amplitude decay rate krd with phase lag increase rate kid is adopted to characterize the propagation of watertable waves a total of 122 sand flume experiments covering a wide range of γ values from 4 to 415 were reported by shoushtari et al 2016 and are used here to examine the validity of these predictions the experiments were carried out in a sand flume with dimensions of 9 m length 0 15 m width 1 5 m height given that the properties are similar the two sands adopted in shoushtari et al 2016 s experiments are considered to have the same vg fitting parameters van genuchten 1980 as can be seen from fig 4 eq 16 matches well with the vg model using the parameters listed in table 1 there is a small deviation between the best fit curves for the experimental and numerical data of nt ne and τ ω and so two pairs of curves for the two pairs of best fit a and b values are compared one pair of values obtained from fitting to experimental data and another pair from fitting to numerical data in general eq 18 requires that both ε and μ 2 are small for the experiments of shoushtari et al 2016 ε changes from 0 11 to 0 15 μ 2 is in the range of 0 64 to 66 08 with the static effective porosity whereas it varies from 0 085 to 1 19 and 0 18 to 3 85 for a and b values obtained from fitting to experimental and numerical data respectively fig 5 therefore it is anticipated that including the dynamic effective porosity leads to a smaller truncation error when using eq 18 even though μ 2 is slightly larger than unity in a few experimental cases with the dynamic effective porosity included we will see that eq 18 still performs well in predicting watertable fluctuations fig 6 shows the predictions of the dispersion relations in eqs a7 and a8 which were derived from eqs a1 and a2 respectively as expected eq a1 performs poorly whereas eq a2 compares well with the data shoushtari et al 2016 this suggests that the vertical flow plays an important role in affecting watertable wave propagations note that plots of krd versus kid are independent of any specific form adopted for ne since such plots depend on a single dimensionless parameter γ nielsen et al 1997 shoushtari et al 2016 therefore the predicted curves from eqs a1 and a3 overlap with each other as well as those from equations a2 and 18 the role of γ is further explored by examining each of krd and kid as a function of neωd k fig 7 to check the applicability of the modified eqs 18 and a3 i e approximate analytical solutions of the dispersion relation shown in eqs 21b and a9 respectively in contrast to the relation between krd and kid which as mentioned is independent of the functional form of ne there are large deviations between predictions of krd and kid as they vary with γ from governing equations with or without considering dynamic effective porosity effects depending on the values of a and b fig 7 moreover these deviations increase for increasing γ again this emphasizes that the effective porosity is increasingly influenced by watertable fluctuations as γ increases compared to eqs a1 and a2 i e approximate analytical solutions of the dispersion relation shown in eqs a7 and a8 respectively that assume a constant effective porosity for a given γ both krd and kid are smaller when the dynamic effective porosity is considered this is because a smaller effective porosity corresponds to reduced vertical water exchange and hence watertable waves can propagate further landward i e smaller krd and kid li et al 2000b shoushtari et al 2016 analyzed their experimental results and demonstrated that the existing theories were unable to predict the measured dispersion relation correctly fig 5 in shoushtari et al 2016 even considering different factors e g capillary effect hysteresis porous media deformation shoushtari cartwright 2017 in contrast eq 18 predicts well the relations between krd or kid and γ despite the fact that experimental and numerical results of the dynamic effective porosity do not agree i e give rise to different values of a and b in eq 15a consistent with the experimental results no standing waves occur even for large γ when predicting watertable fluctuations based on eq 18 this is because a large γ induces a small effective porosity that enhances watertable wave propagation the success of eq 18 highlights the significant role played by dynamic effective porosity on watertable fluctuations and so confirms that eq 15a fitted by nonlinear least squares can be used to describe the relation between dynamic effective porosity and fluctuation frequency moreover this in turn suggests that the phase lag between the total moisture and watertable height measured in laboratory experiments using vertical soil columns can be ignored when predicting watertable fluctuations observe that substituting the complex valued expression for the dynamic effective porosity proposed by cartwright et al 2005 into eq 14 does not properly predict the measured dispersion relation fig 8 moreover as mentioned previously the complex valued expression for the dynamic effective porosity proposed by cartwright et al 2005 has limited practical use hilberts troch 2006 to overcome this shortcoming cartwright et al 2006 took the absolute value of the complex number and got reasonable outcomes when predicting watertable fluctuations that is cartwright et al 2006 adopt a real valued expression for the dynamic effective porosity further showing that the phase lag between the total moisture and watertable height measured in laboratory experiments using vertical soil columns can be ignored when predicting watertable fluctuations eq 18 with a and b from experiments a 0 0335 and b 0 4444 performs better than the corresponding simulation derived values in predicting experimental results this is consistent with μ 2 being much smaller for a and b when these parameters are determined from fitting to experimental data thus leading to a smaller truncation error it further suggests that richards equation has some limitations in describing exchange between the saturated and unsaturated zones for watertables subjected to high frequency fluctuations as already shown by shoushtari et al 2016 3 3 applications of the modified governing equation to predict watertable fluctuations in other experiments regardless of the values of a and b obtained from fitting to experimental or numerical data eq 18 captures not only the behavior of krd versus kid but also krd or kid versus γ for 122 experiments conducted by shoushtari et al 2016 however the dimensionless parameter γ varies from 4 to 415 for these experiments in reality tides usually have a period of about 12 h assuming d 20 m typical aquifer depth according to zamrsky et al 2018 ne 0 4 and ks 4 10 4 m s typical properties of sand leads to γ 2 9 smaller than 4 it still remains unclear whether eq 18 can accurately predict the dispersion relation for watertable fluctuations with γ 4 therefore we further validated eq 18 by comparing its predictions with experiments having a smaller value of γ kong et al 2016a carried out watertable fluctuation experiments using a sand flume with dimensions of 30 m length 1 5 m height 1 2 m width the sand adopted in the experiment had a saturated hydraulic conductivity of 5 10 4 m s 1 and a static effective porosity of 0 42 for the experimental sand hψ was 0 55 m the mean sea level was set to 0 9 m from the aquifer bottom three different water level fluctuations with the same amplitude 0 2 m but a different period 45 60 and 120 min were imposed on the sea boundary leading to γ 1 76 1 32 and 0 32 respectively in accordance with the preceding section two pairs of a and b were considered a 0 0335 and b 0 4444 and a 0 1216 and b 0 3642 fig 6 displays predicted krd versus kid curves and experimental data as can be seen the three measured points from kong et al 2016a are close to the curve predicted by eq 18 in addition the relations between krd or kid and γ are presented in fig 9 consistent with high frequency watertable fluctuations the governing equation without including the dynamic effective porosity significantly overestimates k r d and k i d for all three experiments with a smaller γ in addition increasing γ exacerbates the deviation between the analytical predictions and measurements once the dynamic effective porosity is considered the analytical solution performs better in predicting both krd and kid this confirms the validity of eq 18 and highlights the crucial role played by the dynamic effective porosity even for low frequency watertable fluctuations by comparison again eq 18 with a and b from experiments a 0 0335 and b 0 4444 performs better in predicting measured results additionally experimental results of parlange et al 1984 and cartwright et al 2003 were used to check the validity of eq 18 as can be seen from figs 10 and 11 predictions of eq 18 agree well with the measured watertable in both experiments note that since unsaturated properties of the sand used in parlange et al 1984 were not reported the optimal value of nt ks in eq 14 was estimated to be 0 5 s cm consistent with experiments of shoushtari et al 2016 and kong et al 2016a eq 18 with a and b from experiments a 0 0335 and b 0 4444 performs better in predicting experimental results of cartwright et al 2003 therefore experimentally determined values of a and b are recommended for practical use when predicting watertable fluctuations in coastal unconfined aquifers 4 conclusions this study evaluated the effects of dynamic effective porosity on watertable fluctuations in coastal unconfined aquifers following pazdniakov et al 2019 we proposed a new modified expression to predict the dynamic effective porosity under watertable fluctuations after validation against both experiments and numerical simulations this expression was substituted into a modified boussinesq equation to examine the effects of the dynamic effective porosity on watertable fluctuations the results lead to the following conclusions a real valued expression equation 15 quantifying changes in the dynamic effective porosity due to watertable fluctuations agrees with experimental and numerical results in 1d systems eq 18 which results from replacing the static effective porosity with the real valued expression of the dynamic effective porosity equation 15 in the boussinesq model of liu and wen 1997 leads to accurate predictions of watertable fluctuations in four sets of experimental data the above finding means that the phase lag between the total moisture above the watertable and watertable height measured in laboratory experiments using vertical soil columns 1d systems has negligible effects when predicting watertable fluctuations in coastal unconfined aquifers 2d systems the modified governing equation considering the vertical flow in the saturated zone and dynamic effective porosity can accurately predict experimental dispersion relations highlighting the importance of dynamic effective porosity in modeling watertable fluctuations for a given soil the dynamic effective porosity decreases with increasing fluctuation frequency leading to a decrease in vertical water exchange between the saturated zone and unsaturated zone and hence watertable waves can propagate further landward especially for high frequency fluctuations consistent with experimental observations no standing waves occur even at a large γ i e high frequency fluctuations imposed at the lateral seaward boundary when predicting watertable fluctuations based on the modified governing equation this is because a large γ induces a small effective porosity that enhances watertable wave propagation because of macropores and faults aquifers are invariably more complicated than the one considered here which significantly affects watertable fluctuations geng michael 2021 moreover the density difference between seawater and fresh groundwater is ignored consistent with the experimental data sets analyzed regardless this study shows that the dynamic effective porosity plays an important role in modeling watertable fluctuations our real valued effective porosity model leads to reliable predictions of watertable response which is essential for reliable quantification of many groundwater dependent processes in coastal unconfined aquifers credit authorship contribution statement zhaoyang luo conceptualization methodology visualization writing original draft writing review editing jun kong conceptualization methodology supervision writing review editing lili yao visualization writing review editing chunhui lu writing review editing ling li writing review editing d a barry methodology supervision writing review editing declaration of competing interest the authors declare that there is no conflict of interest acknowledgments this research was supported by the national natural science foundation of china 51979095 and marine science and technology innovation project of jiangsu jszrhykj202105 we gratefully appreciate p wang for providing the numerical data of pozdniakov et al 2019 and n cartwright for providing the experimental data of shoushtari et al 2016 appendix when dynamic effective porosity and vertical flow effects are ignored eq 18 reduces to a1 n e ζ t k s x ζ ζ x k s d 2 ζ x 2 considering only vertical flow effects eq 18 reduces to a2 n e ζ t k s x ζ ζ x k s d 2 ζ x 2 1 3 k s d 3 4 ζ x 4 whereas if only the dynamic effective porosity effects are accounted for eq 18 reduces to a3 n e 1 exp a τ ω b ζ t k s x ζ ζ x k s d 2 ζ x 2 eqs a1 a3 are linearized as respectively a4 n e ζ t k s d 2 ζ x 2 a5 n e ζ t k s d 2 ζ x 2 1 3 k s d 3 4 ζ x 4 a6 n e 1 exp a τ ω b ζ t k s d 2 ζ x 2 the corresponding dispersion relations of watertable waves from eqs a4 a6 are respectively liu and wen 1997 nielsen et al 1997 a7 k d n e ω d k s i a8 k d 3 2 1 1 4 3 n e ω d k s i a9 k d 1 exp a τ ω b n e ω d k s i 
74,curvature induced secondary flow in 2d depth averaged hydro morphodynamic models an assessment of different approaches and key factors tommaso lazzarin conceptualization methodology validation investigation visualization writing original draft daniele p viero conceptualization methodology supervision writing review editing department of civil environmental and architectural engineering university of padova via marzolo 9 35131 padova italy department of civil environmental and architectural engineering university of padova via marzolo 9 padova 35131 italy department of civil environmental and architectural engineering university of padova via marzolo 9 35131 padova italy corresponding author curvature induced secondary flows are ubiquitous in nature and have long attracted scientist attention modelling such kind of secondary flows is not straightforward while full 3d models fit the purpose at the cost of great computational demand simplified models often pose concerns about their effectiveness and the representation of key processes in the present study helical flow secondary currents are included in a two dimensional depth averaged hydro morphodynamic model on cartesian unstructured meshes the non uniform vertical distribution of velocity in streamwise and spanwise directions is accounted for introducing dispersive terms in the shallow water equations an anisotropic diffusivity tensor in the advection diffusion equation and a correction to the direction of bed shear stress and bedload transport different approaches available in the literature are recast in similar form and compared to each other in terms of flow field tracer transport and bed evolution using data from laboratory experiments and real world case studies the model includes a novel pure 2d implementation of the non linear saturation mechanism that limits the growth of secondary flows in relatively sharp bends a substantial part of the paper is devoted to discuss key factors in secondary flow modelling including implementation tricks guidelines to mesh design the suitability of local and non local approaches and the role of bathymetry the final goal is to provide useful guidelines for 2d hydro and morphodynamic modelling in river bends keywords secondary currents helical flow sharp bend saturation shallow water equations hydro morphodynamic model free surface flow data availability data will be made available on request 1 introduction in river and channel bends the interplay between the curvature of streamlines in the horizontal plane and the non uniformity of streamwise velocity along the vertical produces a streamwise oriented helical flow because of an imbalance between the outward centrifugal acceleration and the inward pressure gradient blanckaert and de vriend 2010 falcon 1984 van balen et al 2010 this curvature induced secondary current which acts to deviate the high velocity thread from the inner to the outer bank ahmadi et al 2009 bolla pittaluga et al 2009 johannesson and parker 1989a lien et al 1999 seminara 2006 shimizu et al 1990 wu et al 2004 2005 has long attracted scientist attention e g boussinesq 1868 thomson 1877 the tea leaves of einstein 1926 see also bowker 1988 because of interesting fundamental implications in shaping the riverbed bathymetry in contributing to bank erosion and meander migration in enhancing mixing and dispersions of heat and solutes in increasing flow resistance etc constantinescu et al 2013 demuren and rodi 1986 duan 2004 gu et al 2016 iwasaki et al 2016 jang and shimizu 2005 koken et al 2013 lai et al 2012 papanicolaou et al 2007 termini 2014 modelling the secondary currents in river bends is an important and challenging issue the most natural way of modelling secondary currents is employing full three dimensional 3d models which naturally resolve curvature induced helical flows keylock et al 2012 starting from pioneering applications in the 70s leschziner and rodi 1979 pratap and spalding 1975 the increased computational power has now allowed modelling long stretches of natural rivers with full 3d computational fluid dynamics cfd tools but the need of suitable computing facilities and of large computational time still hinder their widespread application fischer antze et al 2008 horna munoz and constantinescu 2018 the search for efficient strategies to account for curvature induced secondary flow in reduced order hydraulic models started by van bendegom 1947 by looking at the flow field in a single bend has so far produced many different approaches and modelling strategies blanckaert and de vriend 2010 camporeale et al 2007 lane 1998 most of these are linear or weakly non linear models valid for low curvatures of the river axis and slowly varying bed topography hence suitable to model long term migration of large scale meandering rivers to meet the specific needs of practical engineering problems involving fluvial hydro and morpho dynamics two dimensional 2d free surface shallow water models still represent a valid compromise between efficiency and effectiveness shaheed et al 2021 uijttewaal 2014 in 2d depth averaged models the vertical velocity profile is assumed implicitly and it is commonly taken to be constant bates 2022 ghamry and steffler 2002 to account for the effects of secondary flows in channel bends the shallow water equations swes are enriched with dispersive stresses bora and khalita 2020 camporeale et al 2021 song et al 2012 which parameterize the momentum transfer produced by the streamwise oriented helical flow the simplest approach to account for curvature induced secondary flows in 2d models assumes instantaneous adaptation of secondary flow intensity to the driving curvature the dispersive stresses are linked to the local streamline curvature directly begnudelli et al 2010 duan 2004 guan et al 2016 lien et al 1999 song et al 2012 actually the problem is further complicated because the streamline curvature generates secondary flow progressively i e with a phase lag due to inertia and the helical flow is subject to different dissipative mechanisms as well blanckaert and de vriend 2003 2004 the lagged formation of helical flow in steady state applications was simulated by introducing an adaptation length blanckaert and de vriend 2003 de vriend 1981 johannesson and parker 1989b kikkawa et al 1976 rozovskii 1957 wu et al 2004 2005 a more rigorous and general approach requires solving a transport diffusion equation for vorticity or angular momentum with centrifugal force and resistance mechanisms acting as source and sink terms respectively bernard and schneider 1992 einstein and li 1958 ikeda and nishimura 1986 kalkwijk and booij 1986 odgaard 1986 at the cost of additional computational demand this approach doesn t suffer from local singularities in the curvature field and reproduces the slow decay of the helical flow which vanishes at a long distance downstream of a bend bai et al 2019 concerning the implementation of the above methods modelling approaches proliferated with regard to i the basic conservation principle such as extra equations from the navier stokes equations ghamry and steffler 2002 jin and steffler 1993 yeh and kennedy 1993 reduced versions of the momentum equation in the transversal direction e g kalkwijk and booij 1986 odgaard 1986 or the conservation of angular momentum in the transversal plane e g bernard and schneider 1992 finnie et al 1999 ii the vertical profile for the streamwise velocity component either logarithmic bernard and schneider 1992 de vriend 1977 1981 kitanidis and kennedy 1984 shimizu et al 1990 or power law odgaard 1986 wu et al 2004 yeh and kennedy 1993 iii the vertical profile for the spanwise velocity component typically linear with zero mean odgaard 1986 albeit with variations de vriend 1977 1981 kikkawa et al 1976 shin and seo 2021 iv the way in which local curvature is estimated and possibly filtered to avoid numerical instabilities abad et al 2008 begnudelli et al 2010 v the use of boundary fitted orthogonal curvilinear grids which naturally allow evaluating longitudinal and transversal terms e g blanckaert and de vriend 2003 demuren 1993 as opposed to general purpose unstructured meshes in a cartesian reference frame that are more flexible in case of unevenly curved bends and wandering riverbeds jin and steffler 1993 nikora and roy 2011 vi the treatment of impervious banks using either the free or no slip condition each one entailing specific pros and cons blanckaert 2001 in general the basic model assumptions limit the scope of such 2d models to the case of mild curvatures indeed in the case of sharp bends curvature induced secondary flows are characterized by relevant non linear feedbacks the helical flow with its outward transport of streamwise momentum modifies both the horizontal pattern and the vertical profiles of flow velocity the high velocity thread is moved outward and the vertical profile is flattened which means weakening the helical flow production mechanism blanckaert 2009 blanckaert and de vriend 2003 blanckaert and graf 2004 wei et al 2016 this feedback based non linear process referred to as saturation of secondary flow has been assessed quite recently and its implementation in 2d depth averaged models is still in its infancy guan et al 2016 ottevanger et al 2012 qin et al 2019 shin and seo 2021 xiao et al 2022 finally the implementation of 2d models accounting for curvature induced secondary flows as well as their application to laboratory and real world case studies lead to face many other subtle factors examples are the proper inclusion of high spatial gradients of water depth associated to compound cross sections and irregular bathymetries the computation of dispersive stresses at the wet dry interface or at the mesh lateral boundaries the need of accounting for lateral wall friction particularly for laboratory applications with rectangular cross sections effective strategies to employ coarser computational meshes etc the present study aims at providing a comprehensive assessment of curvature induced secondary flows in the frame of general purpose depth averaged 2d models for river hydro and morpho dynamics on cartesian i e not curvilinear coordinate systems different parameterizations available in the technical literature are recast in similar form and implemented in a 2d finite element hydrodynamic model for both the cases of instantaneous adaptation of helical flow intensity and of transport of streamline vorticity the saturation of secondary flow in the case of strong curvatures is modelled introducing a pure 2d extension of the model by blanckaert and de vriend 2003 saturation effects can be accounted for with any of the approaches for secondary flow implemented in the model the hydrodynamic module for curvature induced secondary flows is then integrated with a module for transport of passive tracers and with a morphodynamic module solving for the bedload sediment transport the paper is organized as follows the theoretical models for curvature induced flows are presented in sect 2 along with an in depth description of implementation techniques the model is verified against several laboratory experiments both with fixed and movable bed sect 3 a model application to a real case study po river is used to assess some key factors in 2d depth averaged hydro and morphodynamic modelling of real rivers the relevant aspects emerged in this study are then discussed in light of the recent advances on the subject and of open issues sect 4 a set of conclusions closes the paper 2 accounting for curvature induced secondary flows in 2d models 2 1 shallow water equations with dispersive stresses on a horizontal cartesian frame with axes x y under the hypothesis of hydrostatic pressure distribution the depth averaged navier stokes equations commonly known as de saint venant or shallow water equations swes read 1 d d t q x y 1 y re x x x re x y y 1 y d x x x d x y y τ b x ρ y g h x 0 d d t q y y 1 y re x y x re y y y 1 y d y x x d y y y τ b y ρ y g h y 0 η h h t q x x q y y 0 where t is time d dt is the material lagrangian time derivative q qx qy are the depth integrated velocity components y is the equivalent water depth i e water volume per unit area defina 2000 re are the reynolds turbulent stresses in the horizontal plane τbx τby are the bed shear stress components ρ is the water density g is gravity and h is the water surface elevation over a datum in the continuity equation η h 0 1 is a depth dependent storage coefficient defined as the wet area fraction defina 2000 the dispersive stresses dxx dxy and dyy emerge from the integration of a non uniform vertical distribution of velocity over the water depth and are defined as 2 d x x 0 y u z 2 d z d x y d y x 0 y u z v z d z d y y 0 y v z 2 d z where the apostrophe denotes the difference between the real and the depth averaged velocity component note that the velocity vector is here defined as w u v q y 3 u z u z u v z v z v dispersive stress terms thus account for the subscale spatial variations of the unresolved velocity field to obtain close form expressions of the dispersive terms it is convenient to use a local s n reference frame with s the longitudinal streamwise and n the transversal spanwise directions see fig 1 a and to assume simple vertical distributions of the flow velocity components along s and n among the different expressions used in previous studies a power law distribution can be assumed for the streamwise component ws which allows for a simpler derivation of dispersive stresses according to odgaard 1986 4 w s z w m 1 m z y 1 m being w u 2 v 2 the magnitude of the depth averaged velocity and m a friction parameter m χκ g 1 2 with χ the chezy coefficient and κ 0 4 the von karman constant for the spanwise velocity component wn a linear profile with zero mean is commonly used jin and steffler 1993 kalkwijk and booij 1986 odgaard 1986 5 w n z w v n s 2 z y 1 where v n s v n s w is the non dimensional transversal velocity component at the free surface integration on the water depth provides begnudelli et al 2010 lien et al 1999 wu et al 2004 6 d ss y w 2 m 2 m d sn d ns y w 2 1 2 m v ns sign r d nn y v ns w 2 3 being r the radius of curvature of depth averaged streamlines r is positive for clockwise bends in the flow direction and negative vice versa finally these terms are rotated into the x y coordinate frame by expressing the rotation matrix in terms of velocity components to read 7 d x x d s s u 2 w 2 2 d s n u v w 2 d n n v 2 w 2 d x y d y x d s s u v w 2 d s n u 2 v 2 w 2 d n n u v w 2 d y y d s s v 2 w 2 2 d s n u v w 2 d n n u 2 w 2 lien et al 1999 reported an equivalent derivation of these terms for the case of a logarithmic vertical profile of streamwise velocity it s worth noting that the net contribution to momentum eqs 1 of dispersive stresses dij with i and j denoting either x or y depends on their spatial derivatives rather than on their magnitude concerning the role of the single dispersive terms dss does not depend on the secondary flow it acts in the streamwise direction by hindering both spatial acceleration and deceleration the mixed dsn term is the most important term for simulating secondary flows its spatial gradient may lead to additional resistance at the inner side of bends and to acceleration at the outer side of bends dietrich and smith 1983 thus accounting for the effect of outward momentum transfer ascribed to the helical flow dnn may produce a spanwise net stress that depending on the spanwise gradient of flow velocity w and secondary flow intensity v n s may lead to a larger free surface transversal slope 2 2 instantaneous adaptation and vorticity transport approaches the dispersive stresses for curvature induced secondary flows which depend on the helical flow intensity can be expressed in terms of non dimensional spanwise velocity component at the free surface v n s basically v n s can be evaluated using two different approaches i a local approach which implies instantaneous adaptation of the helical flow intensity to the local flow features and ii a vorticity transport approach which accounts for generation transport and dissipation of the helical flow in the local approach which is simpler and less computationally demanding v n s is a direct function of the local water depth velocity and streamline curvature as a major drawback the local approach does not consider the inertia of secondary flow and the spatially distributed field of v n s becomes particularly sensible to local variations of flow field and streamline curvature particularly in the vicinity of sharp boundaries e g bridge piers abutments the vorticity transport approach models the helical flow in terms of streamwise vorticity component which emerges from the non uniformity of the spanwise velocity einstein and li 1958 usually rather than solving the complete equation for three dimensional vorticity vector blackaert and de vriend 2004 depth average simplified versions of the vorticity equations are solved for the streamwise component of vorticity ω finnie et al 1999 uchida and fukuoka 2014 the general form of the transport equation for streamwise vorticity in the x y horizontal plane is 8 d ω d t ω prod ω diss in which ωprod is a production term depending on the imbalance between the centrifugal acceleration and the transversal pressure gradient and ωdiss is a dissipation term that derives from the bottom stresses farhadi et al 2018 nezu 2005 several formulations have been proposed in the technical literature to estimate the production and dissipation terms of eq 8 although formally different being obtained from different basis assumptions they all share a similar structure as shown in the following noting that the streamwise vorticity component ω is twice the angular velocity ω and assuming the linear profile for spanwise velocity of eq 5 it results 9 ω 2 ω 2 v n s y 2 4 v n s y under the hypothesis of slowly varying water depth eq 8 can be written directly in terms of vns in the general form 10 d v n s d t f d k p w 2 r k d v n s w y being kp and kd production and dissipation coefficients whose formulation depends on the basic conservation principle fd is a coefficient introduced to account for non linearity in the production of helical flow see sect 2 3 kalkwijk and booij 1986 derived a transport diffusion equation starting from the momentum equation in the transversal direction and using a logarithmic vertical profile for streamwise velocity this approach is also implemented in delft3d with a slightly different formulation for the production term see chavarrías et al 2019 a similar approach has been proposed by odgaard 1986 which used a power law eq 4 for the vertical profile of streamwise velocity actually both these studies worked with the assumption of steady state yet the generalization to unsteady flow is straightforward bernard and schneider 1992 obtained the transport diffusion equation by imposing angular momentum conservation on a cross section and assuming a logarithmic vertical profile for the longitudinal velocity component in the present work for the sake of simplicity the same approach has been reformulated using the power law in eq 4 eq 10 can be used to estimate the transversal surface velocity v n s for both the vorticity transport approach and the instantaneous adaptation approach indeed the instantaneous adaptation approach implicitly assumes that an equilibrium condition is locally attained elsewhere which is equivalent to assume that the material derivative of streamwise vorticity i e the left hand side term in eq 10 vanishes in this case v n s can be evaluated directly and locally as 11 v n s v n s w f d k p k d y r compared to the local approach which allows estimating the transversal velocity calculating production dissipation terms solely the vorticity transport method has a higher computational cost since the transport eq 10 must also be solved table 1 reports the different expressions for production and dissipation terms available in the literature also expressed according to the form of eqs 10 and 11 in fig 2 a the magnitude of the transversal velocity component at the free surface is plotted for different value of the strickler roughness coefficient ks the bernard and schneider 1992 model reformulated assuming a power law vertical profile red dashed line is very similar to their original lag law based model red continuous line the model by odgaard 1986 shows an opposite trend with respect to that of kalkwijk and booij 1986 by increasing values of ks i e moving toward smoother beds the vertical profile of streamwise velocity component is progressively flatter which entails a reduced production of helical flow yet a smoother bed also entails reduced resistances to spiral motion the two above models give different weight to these two opposing factors 2 3 saturation of secondary flows in eq 10 as well as in eq 11 assuming fd 1 leads to linear models in which the intensity of secondary flow increases indefinitely with the streamline curvature camporeale et al 2007 song et al 2012 this is not the real case particularly for higher curvature ratios y r because of the so called saturation effect bai et al 2019 blanckaert 2009 blanckaert and de vriend 2003 the dampening factor fd 0 1 is introduced in eq 10 to reduce the production term in all the formulation here implemented when the saturation mechanism plays a role blanckaert and de vriend 2003 proposed a parameterization in which fd is a function of the bend parameter β which in turn depends on the normalized transversal gradient of the depth averaged velocity αs 12 f d 1 exp 0 4 1 05 β 3 0 89 β 2 0 5 β β y r 0 41 m 0 55 α s 1 0 25 α s r w w n the key parameter is here αs which varies from αs 1 i e potential flow or free vortex spanwise velocity distribution with maximum velocity at the inner side to αs 1 i e forced vortex with maximum velocity at the outer side blanckaert and de vriend 2003 ottevanger et al 2012 the rationale is that generally αs 1 at the bend entrance where the helical flow production is stronger and the outward momentum transfer has still to affect the flow as opposite αs tends to 1 as the high velocity thread shifts to the outer side of the bend i e where the vertical profile of velocity is likely to be flattened and the production of helical flow weakened accordingly the dampening factor fd decreases for increasing αs fig 2b through the bend parameter β fd also depends on hydrodynamic variables y and r and on bottom friction m for increasingly sharp bends fd decreases indicating that non linear effects become increasingly important in limiting the growth of helical flow the non linear model by blanckaert and de vriend 2003 has been conceived for reduced order models developed on curvilinear reference frames typically used as meander migration models in which the secondary currents are parameterized based on momentum balance at the channel centreline ottevanger 2013 proposed to extend the model to the whole channel width by extending the secondary flow intensity estimated at the centreline modulated with empirical power law weighting functions such an extension is limited to regular shaped cross sections and presumes the knowledge of the channel centreline and walls iterative procedures are required to deal with more complex geometries qin et al 2019 the generalization of this nonlinear model to a form that is suitable to general purpose 2d schemes is still to be sought 2 4 a pure 2d approach and the treatment of banks within the scope of general purpose 2d depth averaged models which include the salient features of curvature induced secondary flows the approach used to account for impervious banks and the transversal distribution of the dsn dispersive stress deserves some discussions as well explained by blanckaert 2001 it is known since johannesson and parker 1989a that in a channel bend the dsn dispersive stress must satisfy two conditions i it should be positive in the central region of the cross section where the helical flow produces the highest transversal momentum flux and ii it should decay to zero toward the impervious banks where the direction of secondary flow is mostly vertical and the velocity progressively reduces due to sidewall friction when applying linear models for secondary currents to strongly curved flows the helical flow intensity is generally overestimated when the physically sound hypotheses of no slip condition is assumed e g blanckaert 2001 lien et al 1999 indeed in the external part of the bend the no slip condition amplifies the negative outward spanwise gradient of velocity entailing a larger streamwise oriented net stress at the outer side of the bend a simple solution that has often been used in previous studies lien et al 1999 song et al 2012 is adopting the free slip condition at impervious banks the spanwise gradient of velocity is reduced and so it is the dispersive stress dsn unfortunately this causes an unphysical momentum flux at the banks johannesson and parker 1989a moreover while assuming a free slip condition at the banks entails minor drawbacks in case of relatively large cross sections the sidewall friction plays a significant role in case of cross sections with large aspect ratios typical of artificial channels and laboratory flumes and should be accounted for physics based analytical solutions proposed in previous studies e g ikeda et al 1990 are unsuitable to general purpose 2d depth averaged models for which the channel centreline and width as well as the distance from the banks cannot even be identified actually the bank location can change substantially depending on the water level in typical compound cross sections e g passing from full bank to flood discharge as well as due to movable bed dynamics in case of active i e migrating braided anabranching riverbeds in general purpose 2d models based on a cartesian i e not curvilinear reference frame only local variables i e the flow depth and velocity the radius of curvature r etc can be used to estimate the helical flow strength jin and steffler 1993 koch and flokstra 1980 hence here we explore the practical solution of implementing a model for secondary flow including the associated non linear saturation effects based on local variables only the effectiveness of such a pure 2d approach has to be verified by means of model applications the reader is referred to sect 3 and 4 the basic idea is that considering the physics based saturation effects rather than the unphysical free slip condition at sidewalls or other case specific tuning parameters could alleviate the overestimation of secondary flow that is produced in strongly curved bends when the no slip condition acts at impervious banks of course providing a physically sound representation of the complex 3d phenomena occurring in strongly curved channel bends is beyond the scope of the present work the goal is achieving a cost effective versatile and useful tools for engineering applications 2 5 advection diffusion equation in the presence of secondary currents the advection diffusion equation allows to determine the evolution in time and space of the vertically averaged concentration c of tracers and substances transported by the flow it is used to model suspended sediment pollutant transport and other transported quantities such as the vorticity ω sect 2 2 the advection diffusion equation can be written as 13 y c t c q y ε t c y d d c s where is the 2d divergence operator εt νt σt is the turbulent diffusivity commonly expressed as a function of the eddy viscosity νt and of the schmidt number σt duan 2004 dd is an anisotropic diffusivity tensor that accounts for dispersion and s is a source term the dispersive diffusion term is often neglected in the practice i e dd 0 and the turbulent diffusivity is tuned using the schmidt number as a calibration parameter for representing experimental data in general conditions smaller values for the schmidt number increase the mixing and vice versa duan 2004 hu et al 2017 however the curvature induced helical flow enhances the lateral mixing engmann 1986 fischer 1969 lee and kim 2012 moncho esteve et al 2017 rishnappan and lau 1977 particularly large curvature and strong secondary currents entail a marked anisotropic diffusivity that needs to be modelled with a suitable parameterization demuren and rodi 1986 duan 2004 this generally suffices to make the calibration of the schmidt number unnecessary i e σt 1 can be assumed in the case of channel bends the principal components of the dd tensor in the local s n reference frame can be expressed in the following general form 14 d dss α ds u y d dnn α dn u y d dsn d dns 0 where u is the friction velocity and αds αdn are proper parameters elder 1959 holly and usseglio polatera 1984 shin et al 2020 different formulations for αds and αdn are available in the literature depending on flow and environmental conditions e g the shape of the velocity profile seo and baek 2004 or the presence of vegetation lou et al 2020 following elder 1959 a common choice is αds 5 93 to account for the presence of helical flows αdn can be estimated as a function of the transversal velocity at the free surface vns as a result of depth averaging fischer et al 1979 lee and seo 2013 considering the vertical distributions of velocity expressed by eqs 4 and 5 leads to 15 α d n 1 6 κ v n s u 2 finally by rotating the principal component tensor onto the x y reference frame the diffusivity components ddij become alavian 1986 16 d d x x d d s s u 2 w 2 d d n n v 2 w 2 d d x y d d y x d d s s d d n n u v w 2 d d y y d d s s v 2 w 2 d d n n u 2 w 2 2 6 the 2def finite element numerical model the different parameterizations of curvature induced secondary currents are implemented in the framework of the 2def finite element hydrodynamic model d alpaos and defina 2007 defina 2003 viero et al 2014 2013 the model solves eqs 1 which constitute a modified version of the full shallow water equations to deal with wetting and drying processes over irregular topography defina 2000 the bottom friction is expressed using the strickler manning formulation it is treated semi implicitly to enhance model stability cea and bladé 2015 valiani et al 2002 viero and valipour 2017 the computational domain is discretized with 2d triangular elements a staggered scheme is used in which water levels are defined at the grid nodes and assumed to vary piecewise linearly through the domain flat triangular elements characterized by a constant elevation convey the discharge among adjacent nodes in the framework of semi implicit mixed eulerian lagrangian scheme in the momentum equation the material lagrangian derivative of the depth averaged velocity is replaced by its finite difference formulation 17 d w d t w w 0 δ t where the subscript 0 indicates the terms at the previous time step and position backward along the lagrangian trajectory under the hypothesis of slowly varying flows momentum equations are linearized and then solved for q w y which in turn are substituted into the continuity equation and solved with a finite element galerkin s method defina 2003 the semi implicit nature of the scheme limits its applicability to subcritical flows yet relaxes the cfl restriction on the computational time step a single system of n algebraic equations being n the number of nodes is solved at each time step by a modified conjugate gradient method considering that the accuracy of the scheme allows for using relatively coarse meshes the model turns out to be particularly efficient 2 6 1 computation of the local streamline curvature the lagrangian approach for convective terms is used also to estimate the local radius of curvature of the streamlines based on the spatial variation of the direction of the velocity bonetto and defina 1998 denoting with ϑ the angle of the velocity vector to the x axis positive counter clockwise and with r the local radius of curvature of the streamline fig 1b the streamwise distance ds can be written as 18 d s r ϑ s d s ϑ s r d ϑ observing that tanϑ v u and cosϑ u w the derivative of ϑ can be expressed in terms of velocity components as 19 d d s v u d d s tan θ 1 cos 2 ϑ d ϑ d s w u 2 d ϑ d s the local streamline curvature 1 r is then obtained by combining eqs 18 and 19 20 1 r d ϑ d s u w 2 d d s v u u 2 w 2 1 u d v d s v u 2 d u d s 1 w 2 v d u d s u d v d s for slowly varying flows δs w1δt and the spatial derivative of the velocity components can be approximated as 21 d u d s 1 u 1 u 0 w 1 δ t d v d s 1 v 1 v 0 w 1 δ t where the label 1 denotes the centre of a generic cell hence making use of eqs 20 and 21 the local curvature is finally given by 22 1 r 1 1 w 1 3 δ t v 1 u 1 u 0 u 1 v 1 v 0 1 w 1 3 δ t u 1 v 0 v 1 u 0 2 6 2 computation of the reynolds turbulent stresses the horizontal components of reynolds turbulent stresses are modelled with the boussinesq approximation and the depth integrated eddy viscosity by stansby 2003 and uittenbogaard and van vossen 2004 see also viero 2019 the reynolds terms in eqs 1 are 23 r e i j ν t y u i j u j i with indexes i and j denoting either x or y ν t the eddy viscosity and ui qi y the generic depth averaged velocity component looking at the first equation in 1 under the hypothesis of smooth spatial variations of the eddy viscosity the first reynolds stress component becomes 24 r e x x x r e x y y ν t y x 2 u x x y u x y u y x ν t y 2 u x x 2 2 u x y 2 ν t y x u x x u y y according to the continuity equation in 1 the last right hand side term is proportional to the temporal variation of the water level and is negligible in case of slowly varying flows hence the reynolds stress can be estimated as 25 r e x x x r e x y y r e y x x r e y y y ν t y 2 u x x 2 2 u x y 2 2 u y x 2 2 u y y 2 ν t y 2 u considering that these terms have to be computed for each element of an unstructured triangular mesh the divergence theorem is used to obtain the average cell value of the reynolds stresses 26 ν t y a e a e 2 u d a ν t y a e γ e u n γ d γ ν t y a e k u k n k l k in which ae is the area and γ e the boundary of the computational element n γ is the unit vector normal to the cell boundary positive outward and k identifies each of the three cell sides whose length is lk denoting with o the centroid of the cell and with ok the centroid of the cell adjacent to the k th side of the cell and with dk the projection of the segment o o k onto n k the last term of eq 26 becomes 27 2 ν t a e k u o k u o p k l k d k in which the weight pk min yk y 1 accounts for the fact that the reynolds stresses take only place at the wet interface shared by adjacent cells e g if the adjacent cell is dry no reynolds stress occurs for cell sides belonging to the mesh boundary assuming u ok u o or equivalently pk 0 allows simulating the slip condition 2 6 3 computation of the dispersive stress terms similar to the reynolds stresses the computation of dispersive stresses in eqs 1 requires a suitable evaluation of the spatial derivatives of the dij terms defined at eq 7 denoted the dispersive terms with 28 d d x x d x y d y x d y y the dispersive stresses are given by d the average of the dispersive stresses for each computational cell can be evaluated making use of the divergence of d 29 1 a e a e d d a 1 a e γ e d n γ d γ 1 a e k d k n k l k in which d k is the tensor of dispersive terms evaluated at the centre of the k th cell side this can be obtained as the average of the d terms previously computed for adjacent cells and weighted with the distance of centroids to the centre of the k th cell side concerning the dampening factor which accounts for the saturation of secondary flow in case of sharp bends the key point is the computation of the transversal gradient of the velocity which appears in eq 12 within αs and is equal to w n w n with n the unit vector normal to the local flow direction making use of the divergence theorem for each computational cell the average value of the velocity gradient is evaluated as 30 1 a e a e w d a 1 a e γ e w n γ d γ 1 a e k w k n γ k l k where the velocity at the side centre wk is computed as the average of the w at adjacent cells weighted with the distance of centroids to the centre of the k th cell side lk is the length of the k th cell side and n γk is the outward unit vector normal to the cell side 2 6 4 wall function to account for no slip condition at sidewalls at the mesh boundaries the model allows imposing a classical slip condition or to use a wall function to account for additional friction exerted by sidewalls in the latter case an additional stress component parallel to the wall direction is added to the momentum balance of wall adjacent elements it is computed as wu et al 2000 31 τ w a l l ρ w 2 κ ln d w a l l e s 2 where es is the equivalent sand grain roughness of lateral walls and dwall is the limit between the buffer and the logarithmic layers at the wall see fig 1c assumed equal to 32 d w a l l 50 ν u where ν is the kinematic viscosity of water and u the shear velocity for each grid cell the wall shear stress is applied on the surface y bwall being bwall the length of the vertical wall 2 6 5 numerical scheme for the transport diffusion equation the transport diffusion equation sect 2 5 is solved using a conservative second order in space numerical scheme the scheme is equivalent to that described by casulli and zanolli 2005 with the substantial difference that variables are located oppositely in the two staggered meshes in casulli and zanolli 2005 the model cells are control volumes that exchange fluxes through the cell sides in the present model the triangular elements convey fluxes from a node to the others or from two nodes to the remaining one the second order accuracy in space for the advective terms is achieved using an upwind total variation diminishing tvd scheme to avoid spurious oscillations the superbee limiter is applied based on two consecutive gradients of nodal tracer concentration for each node of the grid the preliminary step is computing the upstream concentration as the average concentration of all the upstream nodes weighted with the value of incoming water discharge casulli and zanolli 2005 then for each element the direction of the velocity vector determines each couple of nodes that exchange flow and tracer with each other and the concentration value at these two connected nodes is completed with the upstream concentration the two consecutive gradients allow applying the tvd limiter and the limited gradient of concentration is finally used to compute the tracer flux between nodes 2 6 6 bedload transport the bed evolution module of the 2def model described in defina 2003 is based on the exner sediment balance equation 33 1 n z b t q b 0 where n is the bed sediment porosity zb the bottom elevation and qb the volumetric sediment transport rate per unit width expressed as struiksma 1985 34 q b q b 0 1 χ c f z b s being χ an empirical factor to account for the effect of longitudinal slope on transport rate χ 0 03 according to crosato and struiksma 1989 and cf the friction coefficient cf ks 2y4 3 g the sediment transport rate q b0 is evaluated with a continuous variant carniello et al 2012 of the threshold based meyer peter and müller mpm formula 35 q b 0 8 g d s 3 s 1 t 1 5 with t θ c θ c 4 μ θ 4 4 where ds is the characteristic median sediment diameter s ρs ρ the relative density of sediments μ the ripple factor vermeer 1986 θ the shields parameter and θc the threshold value for incipient bedload transport compared to the original mpm formulation the continuous variant provides smoother hence more stable practically equivalent solutions the components of the sediment rate qbx and qby are obtained from qb as a function the direction of sediment transport which in turn depends on the near bed flow velocity in channel bends and meandering rivers using the mean velocity of the primary flow to estimate the bedload transport is often incorrect since the curvature induced secondary flow can significantly affect the flow and sediment direction at the bottom abad et al 2008 kitanidis and kennedy 1984 the inward oriented velocity at the bottom is the main cause of bend scour and of point bar accretion respectively at the outer and at the inner sides of bends bathurst et al 1977 engel and rhoads 2012 rozovskii 1957 empirical corrections have been proposed in the literature for representing the deviation of bedload transport to the mean flow velocity olesen 1987 suggested the following angular correction 36 δ β a c y r where ac is a parameter typically assumed in the range 7 12 accordingly the bottom velocity can be estimated as 37 w b u δ β v v δ β u such an approach still finds widespread applications in hydro morphological models vanzo et al 2021 yet a major limitation comes from the direct dependence on the local streamline curvature as in the instantaneous adaptation approach for secondary flows sect 2 2 which may produce unphysical results in case of large curvatures inertia and saturation are not considered moreover the bottom characteristics such as the bed roughness that shapes the vertical profile of flow velocity are not accounted for explicitly as a consequence such a correction model needs at least robust and site specific calibration alternatively when curvature induced helical flow is modelled effectively the bottom deviation angle δβ can be evaluated depending on the near bed transversal velocity component this is expected to provide a more accurate estimation of bedload than using empirical local corrections wang and tassi 2014 as inertia saturation and vertical velocity profiles can be all accounted for according to the linear velocity profile of eq 5 the transversal velocity component at the bottom is opposite to that at the free surface i e vns the near bed velocity becomes equal to 38 w b u b v b u v n s v v v n s u and it forms an angle δ arctan v b u b to the x axis the direction of sediment transport α is also influenced by the bed slope baar et al 2018 chavarrías et al 2019 which is accounted for according to struiksma 1985 39 α arctan sen δ 1 f θ z b y cos δ 1 f θ z b x the function f θ weights the influence of the transverse bed slope and is estimated as talmon et al 1995 40 f θ ζ θ with ζ 9 d s y 0 3 3 results 3 1 test with fixed bed mild curvature laboratory experiments the effectiveness of secondary flow parameterizations described in the previous section is first verified by comparing the hydrodynamic field modelled with different approaches to the laboratory data from the riprap test facility experiment bernard and schneider 1992 finnie et al 1999 the riprap channel is l 274 m long and b 5 27 m wide with 2 1 bank slope in the lower part of lateral walls fig 3 the four bends 90 and 135 right wise 90 left wise and 135 right wise have a constant centreline radius of curvature r 15 2 m the longitudinal slope is 0 216 and the strickler roughness coefficient is ks 38 5 m1 3 s the numerical mesh is made of 6 293 nodes and 11 528 triangles with mean linear size of 45 cm i e channel width to cell side length ratio b δx of about 12 the model of odgaard 1986 is used for the source terms in eq 10 and 11 see also table 1 and the wall function of eq 31 is used to enforce the no slip condition at the lateral boundaries thus accounting for the presence of side walls as boundary conditions constant flowrate q 4 25 m³ s and water depth yd 0 8 m are imposed at the inlet and outlet sections respectively fig 4 shows the spanwise profiles of depth averaged velocity in steady state conditions for the 11 cross sections of figure 3 the experimental data red dots from finnie et al 1999 are compared with model results obtained without considering dispersive stresses dotted lines with the instantaneous adaptation solid lines and with the vorticity transport dash dotted lines approaches for the same cases the plan view of fig 5 shows the location of the main stream high velocity thread in the supplementary material figure s1 highlights the importance of using a wall function to account for the resistance induced by sidewalls and figure s2 and s3 the performance of the different formulations collected in table 1 for the source terms of eq 10 and 11 fig 4 confirms that accounting for curvature induced secondary flow is necessary to obtain reasonable transversal velocity profiles in the presence of bends while the difference with a classical 2d formulation without dispersive terms is striking the local instantaneous adaptation and the vorticity transport approaches perform similarly to each other they both reproduce the experimental data very well with the vorticity transport approach slightly retarding the development of the secondary flow and in turn the outer shift of higher velocities at the beginning of bends see sect 2 6 and 10 the mean rmse evaluated for the whole 11 sections is 0 224 m s without dispersive terms 0 109 m s using the local approach and 0 123 m s using the vorticity transport approach the dispersive stresses in the swes produce deceleration of the flow in the inner part and acceleration at the outer part of the bend dietrich and smith 1983 thus shifting the high velocity thread toward the outer side of bends compared to the simulation without dispersive terms fig 5 fig 5 also shows one of the main differences between the instantaneous adaptation and the vorticity transport approaches by looking at the undisturbed flow approaching the first bend the outward shift of the high velocity thread is faster with the local approach fig 5a as it doesn t account for rotational inertia on the contrary the vorticity transport approach can account for the phase lag which becomes more important in the last part and downstream of bends indeed the vorticity transport approach fig 5b shows a persistent deviation of the high velocity thread well after the bend i e when there is no more curvature of the streamlines in the case of multiple subsequent bends the residual helical flow interacts with the secondary current that grows in the following bend abad and garcia 2009 thus increasing or decreasing the intensity of the helical flow depending on the curvature sign of successive bends passing from the first to the second bend the high velocity thread returns to the channel centre with the local approach whereas it remains at the outer left side of the channel by transporting the vorticity on the contrary the change in curvature sign in the two last bends produces a retarded outward shift of the high velocity thread in fig 5b in the riprap experiment the width ratio y b 0 2 is quite low notwithstanding the sidewalls of the channel affect significantly the transversal velocity profile as shown in figure s1 supplementary material without including a wall function for the boundary elements the model overpredicts the flow velocity close to the walls and at some sections this overprediction becomes larger when including the dispersive stresses for curvature induced helical flow the different formulations implemented for the source terms kp and kd in eq 10 and 11 reported in table 1 produce very similar results the different solutions become nearly indistinguishable both using the instantaneous adaptation and the vorticity transport approach figures s2 and s3 in the supplementary material 3 2 test with fixed bed strong curvature laboratory experiments in strongly curved bends the strong secondary circulation produced by the large streamline curvature flattens the vertical profile of velocity thus weakening the mechanism of helical flow production in what is called the saturation of secondary flows blanckaert and de vriend 2003 we use the experiments of blanckaert and de vriend 2003 and rozovskii 1957 in which the curvature is strong and the saturation effect plays a key role to check the model accuracy in terms of secondary circulation strength and spatial pattern the ecole polytechnique fédérale lausanne epfl channel blanckaert and de vriend 2003 has a length l 19 7 m and a width b 1 3 m with vertical side walls the bend develops for 193 with a constant curvature radius r 1 7 m at the centreline fig 6 a for the experiment here considered the bottom is flat and fixed and the strickler coefficient is ks 60 m1 3 s three different steady flow experiments have been conducted with inflow of 56 89 and 104 l s and downstream water depth of 10 9 16 0 and 21 3 cm respectively with fixed upstream discharge and downstream water level numerical simulations have been run until steady state conditions are attained for the three scenarios the bend sharpness is y r 0 065 0 095 and 0 125 the dampening factor fd introduced in sects 2 2 and 2 3 is computed for each computational cell based on the local flow variables and in particular on the transversal gradient of longitudinal velocity αs fig 7 shows that in the first part of the bend the high velocity thread is located at the inner side of the bend αs 0 as in a potential flow the streamise vorticity is still developing and the interaction with the primary flow is negligible the production of streamwise vorticity is maximum fd 1 in the second part of the bend as the high velocity thread is moved outward by the momentum transfer associated to the helical flow αs progressively increases the non linear saturation feedback mechanism becomes important and the production of vorticity is reduced fd 1 at the downstream end of the bend the high velocity thread is close to the outer bank and αs 1 expectedly by increasing the bend sharpness y r the saturation effect develops faster and becomes stronger second and third column in fig 7 with the consequence that the helical flow intensity does not grow much with y r in fig 8 the model results are compared with experimental data in terms of the non dimensional quantity fn 2 angle brackets highlight depth averaging which measures the strength of the secondary circulation and is defined as blanckaert and de vriend 2003 41 f n 2 v n s 2 w y r 2 comparing the results with experimental data the non linear model allows to predict the magnitude of the secondary flow far more precisely than the linear model confirming the effectiveness of the present approach it has to be said that while fn 2 magnifies the secondary flow strength thus the difference between linear and non linear models the change in the flow field obtained by accounting for non linear saturation model is quite small in the first case q 56 l s and more important for the largest discharge values this suggests that accounting for non linear effects improves the model predictions and becomes fundamental for larger values of the bends sharpness the channel used by rozovskii 1957 has a length l 11 5 m and a width b 0 8 m with vertical side walls the bend develops for 180 with a constant curvature radius r 0 8 m at the centreline fig 6b for the experiment here considered the bottom is flat and fixed and the strickler roughness coefficient is ks 70 m1 3 s the inlet velocity is w 0 26 m s and the downstream water depth is y 5 1 cm the bend sharpness is y r 0 07 the model results obtained with the no slip condition at the sidewalls are compared with the measured data in terms of depth averaged velocity at different cross sections fig 9 and in terms of water surface elevation along the channel at the inner and outer sidewalls fig 10 the model without dispersive terms overpredicts the velocity peak at the inner part of the bend as can be noted especially between section 5 and 11 in fig 9 introducing the dispersive terms with a linear formulation i e fd 1 in eq 10 or in eq 11 the high velocity thread is shifted to the outer side of the bend dash dotted lines overestimating the observed redistribution of velocity especially in the final part of the bend including the representation of the saturation mechanisms leads to a general improvement of model predictions the free surface profiles in fig 10 show that a classical 2d model without dispersive terms tends to underpredict the head losses the linear model for secondary currents leads to a significant overestimation of head losses probably because the flow is much confinated toward the outer side of the bend again including the non linear effect improves the model prediction the interest here is checking the effectiveness of the pure 2d non linear model for secondary flow in terms of transversal distribution of dispersive stresses as discussed in sect 2 4 for the experiment by blanckaert and de vriend 2003 with a discharge of 89 l s fig 11 a shows the spanwise distribution of the dsn dispersive term at 90 from the beginning of the bend the red line shows the measured data as reported by ottevanger 2013 linear models either analytical ottevanger 2013 or the present numerical scheme green and black dash dotted lines respectively overrate the dispersive stress especially close to the sidewalls where it has to decay to zero johannesson and parker 1989a blanckaert 2001 the prediction from the non linear model with the no slip condition at sidewalls black solid line is in good agreement with the empirical formulation by ottevanger 2013 and not too far from the measured data a comparison among the same models and formulations for the experiment by rozovskii 1957 is reported in fig 11b in terms of transversal velocity at the free surface vns which stands for the helical flow intensity although measured data are not available it emerges that i linear formulations dash dotted lines lead to excessively strong circulation ii the no slip condition at the sidewalls reduces the momentum redistribution close to the banks black lines and iii accounting for both the sidewall friction and the non linear saturation effects black solid line improves the physical soundness of the solution 3 3 transport of passive tracers in curved channel to test the model effectiveness in reproducing the transport of a generic passive tracer in presence of curvature induced secondary currents we use the experiments of chang 1971 which have been subject to many model applications see e g begnudelli et al 2010 duan 2004 duan and nanda 2006 ye and mccorquodale 1997 the flume is 35 4 m long and it has two opposite 90 bends with a radius of curvature r 8 53 m the cross section is rectangular and the width is b 2 34 m the mean velocity is u 0 367 m s and the water depth is y 0 115 m which are obtained imposing an upstream inflow of 0 0988 m³ s a downstream water level of 0 115 m and running the model until steady state conditions are attained a constant inflow of a conservative tracer qc 0 01 m³ s is then introduced as point injection located at 3 different transversal coordinates the injection points are named ip1 ip2 and ip3 in fig 12 the mesh resolution is a key factor for controlling the numerical diffusion in transport problems begnudelli et al 2010 casulli and zanolli 2005 to test the mesh dependency of the model solution three different mesh grids have been used with 3 396 mesh 1x 13 349 mesh 4x and 49 587 mesh 16x elements respectively these are obtained through halving the sides of each elements i e the number of elements is about 4 times greater at each refinement for the three meshes the channel width to cell side length ratio b δx is about 10 20 and 40 figure s4 and figure s5 in the supplementary material show that only the finest mesh 16x channel width to cell side length ratio of about 40 leads to reliable results with the coarser meshes 1x and 4x numerical diffusion becomes unacceptably high using the finest mesh the concentration profiles fig 13 are in good agreement with the experimental data of chang 1971 the comparison of solutions obtained with and without considering the curvature induced dispersion grey and black lines in fig 13 highlights the enhanced diffusion generated by the helical flow well described introducing the dispersive terms in the transport diffusion equation when a proper mesh resolution is used the dispersive terms in the advection diffusion equation allow reproducing the correct tracer distribution in the curved channel with the schmidt number σt 1 contrarily to match the experimental data without using these dispersive terms the schmidt number has to be tuned to lower values figure s6 of the supplementary material so as to increase the spanwise diffusion artificially rodi 2017 ye and mccorquodale 1998 the top views of fig 14 a b referring to the same scenarios of fig 13 suggest that the strength of the secondary flow is modest in the experiments of chang 1971 this is confirmed by looking at fig 14c d lateral injection points ip2 and ip3 the tracer remains almost confined closed to the lateral walls according to the experimental data and numerical results shown by duan 2004 and moncho esteve et al 2017 finally the role of the longitudinal dispersion terms ds in eq 14 is highlighted in figure s7 of the supplementary material by releasing the tracer at point ip1 starting at t 0 on a steady baseflow with ds 0 the leading front of the coloured water reveals that the high velocity thread is located at the inner side free vortex flow weak velocity redistribution performed by the secondary current the additional anisotropic streamwise diffusion provided by the ds terms makes the leading front faster and closer to the channel centreline 3 4 bedload transport laboratory experiments the parametrization of curvature induced helical flows allows to estimate the near bed transversal component of the flow velocity thus predicting more precisely the direction of the bedload transport to analyse this influence on the bed evolution we considered the experiment performed by koch and flokstra 1980 at the laboratory of fluid mechanics lfm channel the channel has a rectangular cross section width b 1 7 m and a u shape bend with curvature radius r 4 25 m measured at the centreline the longitudinal bed slope is 0 18 and the strickler roughness coefficient is ks 36 m1 3 s the discharge is q 0 17 m³ s and the downstream water depth is y 0 2 m the bed sediment has a median diameter ds 0 78 mm and a relative density s 2 65 the mesh has 1 719 nodes and 3 040 elements corresponding to about 8 elements per channel width the simulations started from a previously computed steady flow over a bed with only streamwise slope then keeping fixed the inflow discharge and the downstream water level the bed is left free to evolve until an equilibrium state is reached without any corrections to account for helical flow the bottom shear stresses are aligned to the primary flow fig 15 a introducing the secondary current correction bottom stresses change their direction inward fig 15b this produces an imbalance in the bedload transport with leads to scouring at the outer side and bed accretion at the inner part of the bend the bed topography at equilibrium is shown in the colour maps of fig 16 in terms of erosion deposition with respect to the initially flat bed z and in the transversal profiles of bed elevations reported in fig 17 see also figure s8 of the supplementary material which plots the difference between computed and measured values of z with respect to the experimental data fig 16a a 2d model with no corrections for the bedload direction leads to completely unreliable results only the accelerations and decelerations associated to the free vortex flow field at the beginning and at the end of the bend produce some modifications of the bed fig 16b the empirical correction of bedload direction proposed by olesen 1987 with ac 10 in eq 36 tends to overestimates both erosion and depositions fig 16c especially as this correction is based on the local radius of curvature scour and deposition start at the very beginning of the bend no phase lag and proceed uniformly along the bend in the experiment scour and erosion slightly decrease at 135 the computed z is over 3 times larger than the measured one fig 17 the explicit parametrization of the secondary current and the correction of bedload direction proposed by bernard and schneider 1992 leads to better estimations compared to the instantaneous adaptation approach fig 16d the vorticity transport approach in fig 16e correctly reproduces the initial phase lag and the increased scour at the end of the bend close to the outer wall the cross sections in fig 17 show that the inclusion of secondary flow according to bernard and schneider 1992 well reproduces the inner aggradation whereas the outer scour is underestimated finally fig 18 shows a comparison of the scour deposition produced by the three different models for secondary flow here implemented the bed evolution is estimated using different parametrization for secondary currents intensity compared to bernard and schneider 1992 which is in good agreement with experimental data the models of kalkwijk and booji 1986 and odgaard 1986 slightly underestimate the magnitude of z yet with a very similar spatial pattern see also figure s9 of the supplementary material which plots the difference between computed and measured values of z 3 5 real world case study fixed and mobile bed the model is finally applied to a real world case study the 50 km long reach of the po river northern italy between the mincio and the panaro confluences i e from 12 km upstream of ostiglia to 8 km downstream of ficarolo fig 19 the meandering reach has been modelled using a 2d triangular grid with 58 570 nodes and 114 452 elements the focus is here on three meandering bends denoted as m1 m2 and m3 in fig 19 table 2 reports additional details the bathymetry derived from a 2004 multibeam survey merged with a 2008 lidar survey is shown in figure s10 of the supplementary material a fixed water level derived from an available rating curve is used as downstream boundary condition we then considered three different discharge scenarios named q 3990 q 7400 q 11 500 where q denotes the discharge expressed in m³ s and imposed at the inlet section for each discharge scenario a first set of simulations has been performed with the fixed real bathymetry with and without including the dispersive terms in the momentum equations the inclusion of secondary flow correction entails minor changes to the flow field an example is shown in figure 20 at the aa cross section meander m1 the increase and the outer shift of the peak velocity obtained by including the correction for the secondary flow is absolutely modest and it further decreases for lower flowrate values e g q 3990 m³ s fig 20 b using the instantaneous adaptation or the vorticity transport approach entails negligible differences as well dashed and solid lines in fig 20b similar results are obtained for meanders m2 and m3 some relevant parameters are reported in table 2 the depth averaged velocity field at meander m1 for the discharge q 11 500 m³ s and including the dispersive stresses in the momentum equations is shown in fig 21 the w 2 m s isoline is plotted for both the cases with magenta and without orange the dispersive stresses again without any substantial difference these results suggest that including the dispersive terms for curvature induced secondary flow is inessential to model the depth averaged 2d flow field in natural rivers with fixed deformed bed nonetheless it has been already pointed out that secondary flow plays a major role with respect to the development of the bed topography blanckaert 2010 shimizu et al 1990 the po river case study is then used to check the ability of the different approaches for curvature induced secondary flow in modelling the relevant hydro morphodynamic processes and to produce real like bathymetric configurations hence a set of mobile bed simulations has been run starting from a flat bed i e an unbalanced bathymetric configuration obtained by linearly interpolating the bed elevation from the mesh inlet to the outlet fig 22 b the surveyed bed is shown in fig 22a the movable bed simulations either with or without dispersive terms and correction for bedload direction are run with a constant discharge q 11 500 m³ s until an equilibrium bed condition is reached the inclusion of dispersive stresses and the correction for bedload direction are actually necessary to obtain reliable bed configurations as demonstrated by comparing the equilibrium configuration obtained in the two different modelling approaches fig 22c interestingly reliable equilibrium bathymetries are obtained also using the empirical correction for the bedload direction proposed by olesen 1987 with ac 10 or considering a lower discharge of q 7400 m³ s see figure s11 of the supplementary material fig 23 shows the bed evolution and the depth averaged velocity field from the initially flat bed to the equilibrium condition reached at time teq 2 years modelled considering the dispersive terms with the flat bed the high velocity thread is located at the inner part of the bend and the flow then collides at an oblique angle with the outer bank in this situation the secondary flow is relatively strong and so is the velocity redistribution entailed by the dispersive terms as time advances sediments are carried toward the accreting point bar in the inner part of the bend due to the inward direction imposed by the helical flow the main part of the discharge then flows over the deepest part of the bend driven by the so called topographic steering blanckaert 2010 more than by momentum redistribution induced by the secondary flow approaching the equilibrium condition the importance of topographic steering increases and the already weak effect of dispersive terms further reduces 4 discussion this study deals with the inclusion of helical flow secondary currents in two dimensional general purpose river and flood models the implementation of different modelling approaches and the application to several case studies both in the laboratory and in the field shed light on a set of interesting issues which are here discussed 4 1 the role of dispersive terms in momentum and transport diffusion equations the model applications described in the previous section highlighted the importance of including the dispersive terms yet not all these terms play an important role nor are always necessary in the momentum equations the most important contribution is given by the diagonal term dsn its spatial gradient entails additional resistance at the inner side of bends and acceleration at the outer side of bends dietrich and smith 1983 which are the outcome of the outward momentum transfer generated by the helical flow the dss and dnn terms are often neglected in the technical literature e g finnie et al 1999 indeed the streamwise variation of dss is generally smooth and the dnn term is typically much smaller than dsn when the curvature ratio y r is much lower than 1 lien et al 1999 in the model applications described above the inclusion of the dss and dnn terms not shown produced negligible modifications in the model outcomes in the equation for transport and diffusion of conservative tracers and suspended matters the inclusion of dispersive terms suffices to avoid the calibration of the schmidt number to match experimental data however in transport diffusion problems the mesh resolution is the key factor to control the numerical diffusion and to obtain reliable results 4 2 model sensitivity to the mesh resolution the dispersive terms for curvature induced secondary flows rely on the proper evaluation of the transversal gradient of the dsn dispersive stress the effectiveness of the helical flow parameterization then depends on the mesh resolution we performed an ad hoc sensitivity analysis of the model results to the mesh resolution for the above case studies as a representative example we considered the riprap experiment and compared the model results obtained with four different mesh fig 24 mesh 1x cell side length 2 00 m b δx 4 tot 1 112 cells mesh 10x cell side length 0 45 m b δx 10 tot 11 528 cells mesh 40x cell side length 0 22 m b δx 24 tot 43 395 cells mesh 160x cell side length 0 11 m b δx 48 tot 166 965 cells with b δx the channel width to cell side length ratio fig 24 shows that the dispersive terms which come from the transversal derivatives of the dsn stresses are smoothed out excessively using the coarsest mesh 1x the mesh 10x well adheres to the experimental velocity data fig 24f the mesh 40x improves the representation of dispersive terms particularly close to the channel walls where the highest gradients of dispersive terms are located fig 24b leading to an improved spanwise distribution of flow velocity fig 24f finally as shown in fig 24g the far increased computational need required by mesh 160x vertical bars is not counterbalanced by a further improvement of the solution the velocity rmse does not reduce for b δx 10 the mesh resolution was shown to have a far more important role in controlling the numerical diffusion of passive tracers and suspended matters sect 3 3 which requires finer meshes b δx 40 than for including the parameterization of secondary flow on momentum equations only b δx 10 20 using a coarser mesh with the schmidt number tuned to larger values is a computationally efficient alternative however it entails extra diffusion in straight river segments and a loss of predictive ability ad hoc calibration becomes mandatory the choice of the grid structure e g structured or unstructured regular or irregular is another issue that can affect the numerical diffusion of transported tracers casulli and zanolli 2005 while unstructured meshes allow for a greater flexibility and easier adaptation to irregular boundaries the computation of the spatial gradients of dispersive stresses may become challenging close to geometrical singularities and at interfaces where the elements size changes abruptly nabi et al 2016 an ad hoc sensitivity analysis not shown here demonstrated that when a proper mesh resolution is chosen the schemes described at sects 2 6 leads to an accurate estimation of the spatial gradients irrespective of the kind of structured mesh employed e g regular aligned with flow or irregular cell patterns 4 3 modelling approaches to dispersive stress estimation different options have been implemented to estimate the helical flow intensity which regard the local or transported approach i e with instantaneous adaptation or by transporting the streamwise vorticity component the theoretical formulation for the secondary flow parameterization i e the expression for kp and kd in eqs 10 or 11 the inclusion of wall functions and of a non linear model for secondary flow saturation the choice of the most suitable approach mainly depends on the geometrical configuration of the channel here we collect some general criteria the local approach is the easiest to implement the cheapest from a computational standpoint and particularly suitable for long regular bends as it neglects the secondary flow inertia the helical flow intensity can be overpredicted in high curvature bends especially at the entrance of the bend or mispredicted in tight succession of counterrotating bends moreover the local approach is very sensitive to geometrical singularities that entail abrupt variations of streamline curvature also in straight river segments where spurious local variations of dispersive stresses can appear thus to avoid the onset of unphysical dispersive stresses it is a good practice to apply a spatial smoothing e g a shapiro filter shapiro 1970 to the streamline curvature field the vorticity transport approach which intrinsically smooths out possible unevenness in the streamline curvature field as a result of the secondary flow inertia is surely more robust and physically sound yet more demanding from a computational standpoint it is advisable for river channels in which the bathymetry presents some unevenness in the case of sharp bends and in tight sequences of bends the different parameterizations of secondary flow here implemented see table 1 lead to dispersive stresses dij whose magnitude are quite different however the dispersive terms in the momentum equations which depend on the spatial gradients of dij are coherently predicted by the different parameterizations the model applications of sect 3 suggested that the different theoretical formulations are practically equivalent to each other the magnitude of dispersive terms in momentum equations which depends on the gradients of dispersive stresses dij is generally negligible at the channel centreline and maximum towards the banks where both flow velocity and the dispersive stress tend to zero blanckaert 2001 johannesson and parker 1989a in case of compact low aspect ratio cross sections the velocity gradient at the banks is greatly affected by the no slip condition at the channel walls in these cases which are generally found in laboratory flumes the use of wall functions to account for side wall friction is mandatory instead in natural bends the effect of lateral wall is less significant as banks are tilted and the aspect ratio is far larger in this kind of cross sections velocity reduces progressively in the transversal direction dictated by the progressive reduction of water depth consequently the free slip condition at sidewalls is generally an acceptable hypothesis in natural rivers finally the model applications showed that the saturation of secondary flow has to be accounted for to limit the intensity of helical flow when strong secondary currents act to flatten the vertical profile of the streamwise velocity component blanckaert 2009 blanckaert et al 2013 when and where the saturation effect becomes important is not only a function of the bend curvature but also of the local flow field indeed the key parameter governing the occurring of saturation is the spanwise gradient of the longitudinal velocity component which describes if the high velocity thread locates at the inner free vortex type flow or at the outer forced vortex type flow of the bend importantly the local flow field and the transversal gradient of velocity αs also depend on the bed bathymetry i e flat or deformed outward tilted this can be seen also by looking at the spatial distribution of the parameter αs the normalized transversal gradient of the depth averaged velocity for a flat bed rectangular cross section αs is expected to approach 1 at the beginning of the bend free vortex flow type and to progressively increase along the bend to denote forced vortex flow type blanckaert 2010 this is roughly depicted by the plots in the second line of fig 7 instead in a real bend with deformed bed the high velocity thread locates at the outer side of the bend due to topographic steering keeping αs 1 at the inner side and αs 1 at the outer side all along the bend figure s12 in the supplementary material as a result the helical flow intensity is dampened by the saturation model fd 1 at the main core of the flow outer side of the bend where the velocity and the centrifugal force are highest and limited by the low streamwise velocity at the inner side of the bend where the dampening factor fd 1 would let the helical flow to develop free interestingly when the depth averaged flow field is mainly driven by the bathymetry the spatial distribution of αs remains broadly the same either considering or ignoring the dispersive terms figure s12 in the supplementary material the role of bend bathymetry is further discussed in sect 4 5 a relevant aspect concerning the model implementation is that the saturation effect can be effectively assessed with a pure 2d approach thus avoiding any reference to the channel centreline or width gu et al 2016 ottevanger et al 2012 nor requiring time consuming iterative procedures to estimate the non linear parameters qin et al 2019 in this way the validity of traditional 2d models is extended to relatively sharp bends in a straightforward manner and without dramatic increase of the computational burden the modeller should be aware that 2d models equipped with this kind of description of secondary flows cannot represent the formation of counterrotating secondary cells in very sharp bend blanckaert and de vriend 2010 stoesser et al 2010 4 4 ill posedness and instability in 2d secondary flow models the recent study by chavarrías et al 2019 highlighted an important issue concerning the possible ill posedness of 2d depth averaged models with linear formulation for the secondary flow they considered the case in which the helical flow intensity is computed using a transport equation ill posedness was shown to appear in the form of non physical oscillations of the flow field which increase with increased grid refinement they demonstrated that adding a certain amount of diffusion particularly in the spanwise direction may lead to a well posed problem and provide stable solutions besides that they observed that accounting for the saturation effect may have a similar stabilizing effect as saturation models act to dampen any kind of unbounded production of helical flow intensity as in the case of unstable short waves on the one hand we stress that while 2d models compute the intensity of the helical flow locally the secondary flow typically emerges as a unique rotating cell in the physical domain hence to be physically consistent the helical flow intensity computed by 2d models should vary smoothly in the spanwise direction of course enhanced transversal diffusion as that provided by the use of coarse grids is beneficial in this regard on the other hand it is interesting to note that in the numerical experiments by chavarrías et al 2019 model instabilities as a result of ill posedness were significant for a grid with b δx 100 and disappeared when they used a coarser grid with b δx 10 comparable with the grid resolution used and suggested as reasonable in the present study 4 5 the interplay of secondary flow and bed bathymetry the importance of secondary flow in shaping hydro and morphodynamics in curved channels as well as the ability of 2d models to effectively capture the effects of helical flow have been long debated in the literature alho and mäkinen 2010 guan et al 2016 kasvi et al 2015 2013 lane 1998 a tangled picture also emerges from the case studies assessed in sect 3 including the dispersive terms in the momentum equations was crucial in the case of laboratory experiments yet it entailed minor changes to the flow field in the real world case of the po river considering the surveyed bed bathymetry the different behaviour might be attributed to different curvature ratios among these tests we then computed for the model applications presented in sect 3 different scaling parameters that have been proposed to measure the strength of curvature induced secondary flow and its effects on hydrodynamic kashyap et al 2012 according to the values collected in table 3 the secondary flow correction is most important in the epfl channel of blanckaert and de vriend 2003 followed by that of rozovskii 1957 and less important for the chang 1971 case this ranking agrees with the outcomes of the model applications shown in sect 3 1 and 3 3 respectively in fact we used the experimental data by chang 1971 only to check the transport and diffusion module because the effect of dispersive terms on the depth averaged 2d hydrodynamics was negligible looking at the po river case study the parameters of table 3 values are actually lower than most of their laboratory counterparts but not sufficiently small to justify the weak to negligible effect of secondary flows on the depth averaged hydrodynamics of the po river test case similarly the velocity redistribution by secondary flow is known to be much important for narrow cross sections e g b y 10 and negligible in shallow ones with b y 50 blanckaert 2011 blanckaert and de vriend 2010 constantinescu et al 2013 but again the aspect ratio of the po river case study is not so different to justify the basically different behaviour the above considerations and the results shown in sect 3 5 suggest that the main reason for the controversial results obtained in the previous and present applications stems from the fact that the development of and the role played by secondary flows essentially depends on the bed bathymetry in the po river test the surveyed bottom is deformed see the cross section in fig 20 and the colour map in fig 22a whereas the laboratory tests dealt with compact cross sections with flat bed and vertical walls by performing additional numerical experiments in which the bed was artificially flattened it was shown that the flow field in the po river bends is mainly driven by the bed topography i e the so called topographic steering than by momentum exchanges and velocity redistribution ascribed to curvature induced secondary flow blanckaert 2010 chen and duan 2006 deng et al 2021 he 2018 van balen et al 2010 of course the fact that the depth averaged 2d flow field is not significantly altered by the secondary circulation and can be roughly predicted by traditional 2d models without including dispersive terms does not imply that secondary circulations do no play a role at all secondary circulations causing the inner and outer streamwise oriented vortical cells still amplify the boundary shear stresses altering the transport of sediments and posing a threat to bank stability this picture further complicates in very sharp bends blanckaert 2011 constantinescu et al 2013 accounting for the effects of curvature induced secondary flow in 2d hydro morphological models remains almost necessary in particular when the bathymetric configuration is far from equilibrium conditions shimizu et al 1990 or when the bathymetry could be subject to strong variations e g long term simulations however the vast majority of natural river bends are mildly curved and or have a deformed bed in these conditions the depth averaged 2d flow field is nearly independent of dispersive terms and the major outcome of curvature induced secondary circulations is by far the change in bedload direction this explains why many hydro morphological models to account for the effect of secondary flows only implement empirical formulations to correct the bedload direction e g defina 2003 vanzo et al 2021 5 conclusions a correction for curvature induced secondary flow in channel and river bends is implemented in the hydro and morpho dynamic model 2def the dispersive terms appearing in the momentum equations are expressed according to three different formulations recast in similar form the computation can be performed assuming the instantaneous adaptation of secondary flow to the driving streamline curvature or accounting for inertia and phase lag of the helical flow via a vorticity transport approach the effect of impervious banks is accounted for using wall functions the classical linear model for secondary flow is completed with a novel pure 2d implementation of a robust non linear model accounting for the saturation of secondary flow occurring in relatively sharp bends dispersive terms are added also to the transport and diffusion equation and accounted for in the morphodynamic module for bedload transport and mobile bed evolution model applications to laboratory tests and to a real river with both fixed and mobile beds confirm the importance of accounting for secondary flow and the validity of the approaches the different formulations for dispersive terms perform similarly to each other the local instantaneous adaptation approach is less demanding and suitable to isolated bends in riverbeds with a regular bathymetry the streamline curvature field must be smoothed out to avoid numerical instabilities all the local approaches either to compute the dispersive stresses or to correct the direction of bedload transport produce unphysical results in presence of geometrical singularities such as bridge piers or abutments the inertia of secondary flow which is accounted for intrinsically when transporting the streamwise vorticity filters out the typical unevenness characterizing the bathymetry and the curvature field of real rivers and possible geometrical singularities the non linear model for secondary flow saturation is a fundamental ingredient to counteract the excessive growth of helical flow intensity in relatively sharp bends and to produce physically sound spatial distributions of dispersive stresses to this purpose wall functions are needed to model the effect of vertical impervious walls nonetheless in real rivers with tilted banks wall functions are unnecessary curvature induced secondary flows are shown to produce important modifications to the depth averaged flow field in case of rectangular cross sections i e flat bed in the spanwise direction the high velocity thread is moved from the inner to the outer side of the bend and saturation of secondary flow soon becomes important even for not excessively sharp bends on the contrary in real rivers with formed bathymetry outer scour the moderate streamline curvature and the already formed bed bathymetry make the effects of the correction less evident in terms of depth averaged flow field the estimation of secondary flow intensity remains important for modelling the transport of suspended matter and above all for repercussions on bedload transport and morphological setting however in real river with formed bathymetry empirical corrections for the direction of bedload transport based on the local streamline curvature and without including dispersive terms in the momentum equations generally perform satisfactorily funding t l is sponsored by a phd scholarship funded by the cariparo foundation d p v has been partly supported by the italian national research programme prin 2017 with the project n 2017seb7z8 interactions between hydrodynamics flows and biotic communities in fluvial ecosystems advancement in discharge monitoring and understanding of processes relevant for ecosystem sustainability by the development of novel technologies with field observations and laboratory testing enterprising credit authorship contribution statement tommaso lazzarin conceptualization methodology validation investigation visualization writing original draft daniele p viero conceptualization methodology supervision writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments prof andrea defina is gratefully acknowledged for fruitful discussions supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2022 104355 appendix supplementary materials image application 1 
74,curvature induced secondary flow in 2d depth averaged hydro morphodynamic models an assessment of different approaches and key factors tommaso lazzarin conceptualization methodology validation investigation visualization writing original draft daniele p viero conceptualization methodology supervision writing review editing department of civil environmental and architectural engineering university of padova via marzolo 9 35131 padova italy department of civil environmental and architectural engineering university of padova via marzolo 9 padova 35131 italy department of civil environmental and architectural engineering university of padova via marzolo 9 35131 padova italy corresponding author curvature induced secondary flows are ubiquitous in nature and have long attracted scientist attention modelling such kind of secondary flows is not straightforward while full 3d models fit the purpose at the cost of great computational demand simplified models often pose concerns about their effectiveness and the representation of key processes in the present study helical flow secondary currents are included in a two dimensional depth averaged hydro morphodynamic model on cartesian unstructured meshes the non uniform vertical distribution of velocity in streamwise and spanwise directions is accounted for introducing dispersive terms in the shallow water equations an anisotropic diffusivity tensor in the advection diffusion equation and a correction to the direction of bed shear stress and bedload transport different approaches available in the literature are recast in similar form and compared to each other in terms of flow field tracer transport and bed evolution using data from laboratory experiments and real world case studies the model includes a novel pure 2d implementation of the non linear saturation mechanism that limits the growth of secondary flows in relatively sharp bends a substantial part of the paper is devoted to discuss key factors in secondary flow modelling including implementation tricks guidelines to mesh design the suitability of local and non local approaches and the role of bathymetry the final goal is to provide useful guidelines for 2d hydro and morphodynamic modelling in river bends keywords secondary currents helical flow sharp bend saturation shallow water equations hydro morphodynamic model free surface flow data availability data will be made available on request 1 introduction in river and channel bends the interplay between the curvature of streamlines in the horizontal plane and the non uniformity of streamwise velocity along the vertical produces a streamwise oriented helical flow because of an imbalance between the outward centrifugal acceleration and the inward pressure gradient blanckaert and de vriend 2010 falcon 1984 van balen et al 2010 this curvature induced secondary current which acts to deviate the high velocity thread from the inner to the outer bank ahmadi et al 2009 bolla pittaluga et al 2009 johannesson and parker 1989a lien et al 1999 seminara 2006 shimizu et al 1990 wu et al 2004 2005 has long attracted scientist attention e g boussinesq 1868 thomson 1877 the tea leaves of einstein 1926 see also bowker 1988 because of interesting fundamental implications in shaping the riverbed bathymetry in contributing to bank erosion and meander migration in enhancing mixing and dispersions of heat and solutes in increasing flow resistance etc constantinescu et al 2013 demuren and rodi 1986 duan 2004 gu et al 2016 iwasaki et al 2016 jang and shimizu 2005 koken et al 2013 lai et al 2012 papanicolaou et al 2007 termini 2014 modelling the secondary currents in river bends is an important and challenging issue the most natural way of modelling secondary currents is employing full three dimensional 3d models which naturally resolve curvature induced helical flows keylock et al 2012 starting from pioneering applications in the 70s leschziner and rodi 1979 pratap and spalding 1975 the increased computational power has now allowed modelling long stretches of natural rivers with full 3d computational fluid dynamics cfd tools but the need of suitable computing facilities and of large computational time still hinder their widespread application fischer antze et al 2008 horna munoz and constantinescu 2018 the search for efficient strategies to account for curvature induced secondary flow in reduced order hydraulic models started by van bendegom 1947 by looking at the flow field in a single bend has so far produced many different approaches and modelling strategies blanckaert and de vriend 2010 camporeale et al 2007 lane 1998 most of these are linear or weakly non linear models valid for low curvatures of the river axis and slowly varying bed topography hence suitable to model long term migration of large scale meandering rivers to meet the specific needs of practical engineering problems involving fluvial hydro and morpho dynamics two dimensional 2d free surface shallow water models still represent a valid compromise between efficiency and effectiveness shaheed et al 2021 uijttewaal 2014 in 2d depth averaged models the vertical velocity profile is assumed implicitly and it is commonly taken to be constant bates 2022 ghamry and steffler 2002 to account for the effects of secondary flows in channel bends the shallow water equations swes are enriched with dispersive stresses bora and khalita 2020 camporeale et al 2021 song et al 2012 which parameterize the momentum transfer produced by the streamwise oriented helical flow the simplest approach to account for curvature induced secondary flows in 2d models assumes instantaneous adaptation of secondary flow intensity to the driving curvature the dispersive stresses are linked to the local streamline curvature directly begnudelli et al 2010 duan 2004 guan et al 2016 lien et al 1999 song et al 2012 actually the problem is further complicated because the streamline curvature generates secondary flow progressively i e with a phase lag due to inertia and the helical flow is subject to different dissipative mechanisms as well blanckaert and de vriend 2003 2004 the lagged formation of helical flow in steady state applications was simulated by introducing an adaptation length blanckaert and de vriend 2003 de vriend 1981 johannesson and parker 1989b kikkawa et al 1976 rozovskii 1957 wu et al 2004 2005 a more rigorous and general approach requires solving a transport diffusion equation for vorticity or angular momentum with centrifugal force and resistance mechanisms acting as source and sink terms respectively bernard and schneider 1992 einstein and li 1958 ikeda and nishimura 1986 kalkwijk and booij 1986 odgaard 1986 at the cost of additional computational demand this approach doesn t suffer from local singularities in the curvature field and reproduces the slow decay of the helical flow which vanishes at a long distance downstream of a bend bai et al 2019 concerning the implementation of the above methods modelling approaches proliferated with regard to i the basic conservation principle such as extra equations from the navier stokes equations ghamry and steffler 2002 jin and steffler 1993 yeh and kennedy 1993 reduced versions of the momentum equation in the transversal direction e g kalkwijk and booij 1986 odgaard 1986 or the conservation of angular momentum in the transversal plane e g bernard and schneider 1992 finnie et al 1999 ii the vertical profile for the streamwise velocity component either logarithmic bernard and schneider 1992 de vriend 1977 1981 kitanidis and kennedy 1984 shimizu et al 1990 or power law odgaard 1986 wu et al 2004 yeh and kennedy 1993 iii the vertical profile for the spanwise velocity component typically linear with zero mean odgaard 1986 albeit with variations de vriend 1977 1981 kikkawa et al 1976 shin and seo 2021 iv the way in which local curvature is estimated and possibly filtered to avoid numerical instabilities abad et al 2008 begnudelli et al 2010 v the use of boundary fitted orthogonal curvilinear grids which naturally allow evaluating longitudinal and transversal terms e g blanckaert and de vriend 2003 demuren 1993 as opposed to general purpose unstructured meshes in a cartesian reference frame that are more flexible in case of unevenly curved bends and wandering riverbeds jin and steffler 1993 nikora and roy 2011 vi the treatment of impervious banks using either the free or no slip condition each one entailing specific pros and cons blanckaert 2001 in general the basic model assumptions limit the scope of such 2d models to the case of mild curvatures indeed in the case of sharp bends curvature induced secondary flows are characterized by relevant non linear feedbacks the helical flow with its outward transport of streamwise momentum modifies both the horizontal pattern and the vertical profiles of flow velocity the high velocity thread is moved outward and the vertical profile is flattened which means weakening the helical flow production mechanism blanckaert 2009 blanckaert and de vriend 2003 blanckaert and graf 2004 wei et al 2016 this feedback based non linear process referred to as saturation of secondary flow has been assessed quite recently and its implementation in 2d depth averaged models is still in its infancy guan et al 2016 ottevanger et al 2012 qin et al 2019 shin and seo 2021 xiao et al 2022 finally the implementation of 2d models accounting for curvature induced secondary flows as well as their application to laboratory and real world case studies lead to face many other subtle factors examples are the proper inclusion of high spatial gradients of water depth associated to compound cross sections and irregular bathymetries the computation of dispersive stresses at the wet dry interface or at the mesh lateral boundaries the need of accounting for lateral wall friction particularly for laboratory applications with rectangular cross sections effective strategies to employ coarser computational meshes etc the present study aims at providing a comprehensive assessment of curvature induced secondary flows in the frame of general purpose depth averaged 2d models for river hydro and morpho dynamics on cartesian i e not curvilinear coordinate systems different parameterizations available in the technical literature are recast in similar form and implemented in a 2d finite element hydrodynamic model for both the cases of instantaneous adaptation of helical flow intensity and of transport of streamline vorticity the saturation of secondary flow in the case of strong curvatures is modelled introducing a pure 2d extension of the model by blanckaert and de vriend 2003 saturation effects can be accounted for with any of the approaches for secondary flow implemented in the model the hydrodynamic module for curvature induced secondary flows is then integrated with a module for transport of passive tracers and with a morphodynamic module solving for the bedload sediment transport the paper is organized as follows the theoretical models for curvature induced flows are presented in sect 2 along with an in depth description of implementation techniques the model is verified against several laboratory experiments both with fixed and movable bed sect 3 a model application to a real case study po river is used to assess some key factors in 2d depth averaged hydro and morphodynamic modelling of real rivers the relevant aspects emerged in this study are then discussed in light of the recent advances on the subject and of open issues sect 4 a set of conclusions closes the paper 2 accounting for curvature induced secondary flows in 2d models 2 1 shallow water equations with dispersive stresses on a horizontal cartesian frame with axes x y under the hypothesis of hydrostatic pressure distribution the depth averaged navier stokes equations commonly known as de saint venant or shallow water equations swes read 1 d d t q x y 1 y re x x x re x y y 1 y d x x x d x y y τ b x ρ y g h x 0 d d t q y y 1 y re x y x re y y y 1 y d y x x d y y y τ b y ρ y g h y 0 η h h t q x x q y y 0 where t is time d dt is the material lagrangian time derivative q qx qy are the depth integrated velocity components y is the equivalent water depth i e water volume per unit area defina 2000 re are the reynolds turbulent stresses in the horizontal plane τbx τby are the bed shear stress components ρ is the water density g is gravity and h is the water surface elevation over a datum in the continuity equation η h 0 1 is a depth dependent storage coefficient defined as the wet area fraction defina 2000 the dispersive stresses dxx dxy and dyy emerge from the integration of a non uniform vertical distribution of velocity over the water depth and are defined as 2 d x x 0 y u z 2 d z d x y d y x 0 y u z v z d z d y y 0 y v z 2 d z where the apostrophe denotes the difference between the real and the depth averaged velocity component note that the velocity vector is here defined as w u v q y 3 u z u z u v z v z v dispersive stress terms thus account for the subscale spatial variations of the unresolved velocity field to obtain close form expressions of the dispersive terms it is convenient to use a local s n reference frame with s the longitudinal streamwise and n the transversal spanwise directions see fig 1 a and to assume simple vertical distributions of the flow velocity components along s and n among the different expressions used in previous studies a power law distribution can be assumed for the streamwise component ws which allows for a simpler derivation of dispersive stresses according to odgaard 1986 4 w s z w m 1 m z y 1 m being w u 2 v 2 the magnitude of the depth averaged velocity and m a friction parameter m χκ g 1 2 with χ the chezy coefficient and κ 0 4 the von karman constant for the spanwise velocity component wn a linear profile with zero mean is commonly used jin and steffler 1993 kalkwijk and booij 1986 odgaard 1986 5 w n z w v n s 2 z y 1 where v n s v n s w is the non dimensional transversal velocity component at the free surface integration on the water depth provides begnudelli et al 2010 lien et al 1999 wu et al 2004 6 d ss y w 2 m 2 m d sn d ns y w 2 1 2 m v ns sign r d nn y v ns w 2 3 being r the radius of curvature of depth averaged streamlines r is positive for clockwise bends in the flow direction and negative vice versa finally these terms are rotated into the x y coordinate frame by expressing the rotation matrix in terms of velocity components to read 7 d x x d s s u 2 w 2 2 d s n u v w 2 d n n v 2 w 2 d x y d y x d s s u v w 2 d s n u 2 v 2 w 2 d n n u v w 2 d y y d s s v 2 w 2 2 d s n u v w 2 d n n u 2 w 2 lien et al 1999 reported an equivalent derivation of these terms for the case of a logarithmic vertical profile of streamwise velocity it s worth noting that the net contribution to momentum eqs 1 of dispersive stresses dij with i and j denoting either x or y depends on their spatial derivatives rather than on their magnitude concerning the role of the single dispersive terms dss does not depend on the secondary flow it acts in the streamwise direction by hindering both spatial acceleration and deceleration the mixed dsn term is the most important term for simulating secondary flows its spatial gradient may lead to additional resistance at the inner side of bends and to acceleration at the outer side of bends dietrich and smith 1983 thus accounting for the effect of outward momentum transfer ascribed to the helical flow dnn may produce a spanwise net stress that depending on the spanwise gradient of flow velocity w and secondary flow intensity v n s may lead to a larger free surface transversal slope 2 2 instantaneous adaptation and vorticity transport approaches the dispersive stresses for curvature induced secondary flows which depend on the helical flow intensity can be expressed in terms of non dimensional spanwise velocity component at the free surface v n s basically v n s can be evaluated using two different approaches i a local approach which implies instantaneous adaptation of the helical flow intensity to the local flow features and ii a vorticity transport approach which accounts for generation transport and dissipation of the helical flow in the local approach which is simpler and less computationally demanding v n s is a direct function of the local water depth velocity and streamline curvature as a major drawback the local approach does not consider the inertia of secondary flow and the spatially distributed field of v n s becomes particularly sensible to local variations of flow field and streamline curvature particularly in the vicinity of sharp boundaries e g bridge piers abutments the vorticity transport approach models the helical flow in terms of streamwise vorticity component which emerges from the non uniformity of the spanwise velocity einstein and li 1958 usually rather than solving the complete equation for three dimensional vorticity vector blackaert and de vriend 2004 depth average simplified versions of the vorticity equations are solved for the streamwise component of vorticity ω finnie et al 1999 uchida and fukuoka 2014 the general form of the transport equation for streamwise vorticity in the x y horizontal plane is 8 d ω d t ω prod ω diss in which ωprod is a production term depending on the imbalance between the centrifugal acceleration and the transversal pressure gradient and ωdiss is a dissipation term that derives from the bottom stresses farhadi et al 2018 nezu 2005 several formulations have been proposed in the technical literature to estimate the production and dissipation terms of eq 8 although formally different being obtained from different basis assumptions they all share a similar structure as shown in the following noting that the streamwise vorticity component ω is twice the angular velocity ω and assuming the linear profile for spanwise velocity of eq 5 it results 9 ω 2 ω 2 v n s y 2 4 v n s y under the hypothesis of slowly varying water depth eq 8 can be written directly in terms of vns in the general form 10 d v n s d t f d k p w 2 r k d v n s w y being kp and kd production and dissipation coefficients whose formulation depends on the basic conservation principle fd is a coefficient introduced to account for non linearity in the production of helical flow see sect 2 3 kalkwijk and booij 1986 derived a transport diffusion equation starting from the momentum equation in the transversal direction and using a logarithmic vertical profile for streamwise velocity this approach is also implemented in delft3d with a slightly different formulation for the production term see chavarrías et al 2019 a similar approach has been proposed by odgaard 1986 which used a power law eq 4 for the vertical profile of streamwise velocity actually both these studies worked with the assumption of steady state yet the generalization to unsteady flow is straightforward bernard and schneider 1992 obtained the transport diffusion equation by imposing angular momentum conservation on a cross section and assuming a logarithmic vertical profile for the longitudinal velocity component in the present work for the sake of simplicity the same approach has been reformulated using the power law in eq 4 eq 10 can be used to estimate the transversal surface velocity v n s for both the vorticity transport approach and the instantaneous adaptation approach indeed the instantaneous adaptation approach implicitly assumes that an equilibrium condition is locally attained elsewhere which is equivalent to assume that the material derivative of streamwise vorticity i e the left hand side term in eq 10 vanishes in this case v n s can be evaluated directly and locally as 11 v n s v n s w f d k p k d y r compared to the local approach which allows estimating the transversal velocity calculating production dissipation terms solely the vorticity transport method has a higher computational cost since the transport eq 10 must also be solved table 1 reports the different expressions for production and dissipation terms available in the literature also expressed according to the form of eqs 10 and 11 in fig 2 a the magnitude of the transversal velocity component at the free surface is plotted for different value of the strickler roughness coefficient ks the bernard and schneider 1992 model reformulated assuming a power law vertical profile red dashed line is very similar to their original lag law based model red continuous line the model by odgaard 1986 shows an opposite trend with respect to that of kalkwijk and booij 1986 by increasing values of ks i e moving toward smoother beds the vertical profile of streamwise velocity component is progressively flatter which entails a reduced production of helical flow yet a smoother bed also entails reduced resistances to spiral motion the two above models give different weight to these two opposing factors 2 3 saturation of secondary flows in eq 10 as well as in eq 11 assuming fd 1 leads to linear models in which the intensity of secondary flow increases indefinitely with the streamline curvature camporeale et al 2007 song et al 2012 this is not the real case particularly for higher curvature ratios y r because of the so called saturation effect bai et al 2019 blanckaert 2009 blanckaert and de vriend 2003 the dampening factor fd 0 1 is introduced in eq 10 to reduce the production term in all the formulation here implemented when the saturation mechanism plays a role blanckaert and de vriend 2003 proposed a parameterization in which fd is a function of the bend parameter β which in turn depends on the normalized transversal gradient of the depth averaged velocity αs 12 f d 1 exp 0 4 1 05 β 3 0 89 β 2 0 5 β β y r 0 41 m 0 55 α s 1 0 25 α s r w w n the key parameter is here αs which varies from αs 1 i e potential flow or free vortex spanwise velocity distribution with maximum velocity at the inner side to αs 1 i e forced vortex with maximum velocity at the outer side blanckaert and de vriend 2003 ottevanger et al 2012 the rationale is that generally αs 1 at the bend entrance where the helical flow production is stronger and the outward momentum transfer has still to affect the flow as opposite αs tends to 1 as the high velocity thread shifts to the outer side of the bend i e where the vertical profile of velocity is likely to be flattened and the production of helical flow weakened accordingly the dampening factor fd decreases for increasing αs fig 2b through the bend parameter β fd also depends on hydrodynamic variables y and r and on bottom friction m for increasingly sharp bends fd decreases indicating that non linear effects become increasingly important in limiting the growth of helical flow the non linear model by blanckaert and de vriend 2003 has been conceived for reduced order models developed on curvilinear reference frames typically used as meander migration models in which the secondary currents are parameterized based on momentum balance at the channel centreline ottevanger 2013 proposed to extend the model to the whole channel width by extending the secondary flow intensity estimated at the centreline modulated with empirical power law weighting functions such an extension is limited to regular shaped cross sections and presumes the knowledge of the channel centreline and walls iterative procedures are required to deal with more complex geometries qin et al 2019 the generalization of this nonlinear model to a form that is suitable to general purpose 2d schemes is still to be sought 2 4 a pure 2d approach and the treatment of banks within the scope of general purpose 2d depth averaged models which include the salient features of curvature induced secondary flows the approach used to account for impervious banks and the transversal distribution of the dsn dispersive stress deserves some discussions as well explained by blanckaert 2001 it is known since johannesson and parker 1989a that in a channel bend the dsn dispersive stress must satisfy two conditions i it should be positive in the central region of the cross section where the helical flow produces the highest transversal momentum flux and ii it should decay to zero toward the impervious banks where the direction of secondary flow is mostly vertical and the velocity progressively reduces due to sidewall friction when applying linear models for secondary currents to strongly curved flows the helical flow intensity is generally overestimated when the physically sound hypotheses of no slip condition is assumed e g blanckaert 2001 lien et al 1999 indeed in the external part of the bend the no slip condition amplifies the negative outward spanwise gradient of velocity entailing a larger streamwise oriented net stress at the outer side of the bend a simple solution that has often been used in previous studies lien et al 1999 song et al 2012 is adopting the free slip condition at impervious banks the spanwise gradient of velocity is reduced and so it is the dispersive stress dsn unfortunately this causes an unphysical momentum flux at the banks johannesson and parker 1989a moreover while assuming a free slip condition at the banks entails minor drawbacks in case of relatively large cross sections the sidewall friction plays a significant role in case of cross sections with large aspect ratios typical of artificial channels and laboratory flumes and should be accounted for physics based analytical solutions proposed in previous studies e g ikeda et al 1990 are unsuitable to general purpose 2d depth averaged models for which the channel centreline and width as well as the distance from the banks cannot even be identified actually the bank location can change substantially depending on the water level in typical compound cross sections e g passing from full bank to flood discharge as well as due to movable bed dynamics in case of active i e migrating braided anabranching riverbeds in general purpose 2d models based on a cartesian i e not curvilinear reference frame only local variables i e the flow depth and velocity the radius of curvature r etc can be used to estimate the helical flow strength jin and steffler 1993 koch and flokstra 1980 hence here we explore the practical solution of implementing a model for secondary flow including the associated non linear saturation effects based on local variables only the effectiveness of such a pure 2d approach has to be verified by means of model applications the reader is referred to sect 3 and 4 the basic idea is that considering the physics based saturation effects rather than the unphysical free slip condition at sidewalls or other case specific tuning parameters could alleviate the overestimation of secondary flow that is produced in strongly curved bends when the no slip condition acts at impervious banks of course providing a physically sound representation of the complex 3d phenomena occurring in strongly curved channel bends is beyond the scope of the present work the goal is achieving a cost effective versatile and useful tools for engineering applications 2 5 advection diffusion equation in the presence of secondary currents the advection diffusion equation allows to determine the evolution in time and space of the vertically averaged concentration c of tracers and substances transported by the flow it is used to model suspended sediment pollutant transport and other transported quantities such as the vorticity ω sect 2 2 the advection diffusion equation can be written as 13 y c t c q y ε t c y d d c s where is the 2d divergence operator εt νt σt is the turbulent diffusivity commonly expressed as a function of the eddy viscosity νt and of the schmidt number σt duan 2004 dd is an anisotropic diffusivity tensor that accounts for dispersion and s is a source term the dispersive diffusion term is often neglected in the practice i e dd 0 and the turbulent diffusivity is tuned using the schmidt number as a calibration parameter for representing experimental data in general conditions smaller values for the schmidt number increase the mixing and vice versa duan 2004 hu et al 2017 however the curvature induced helical flow enhances the lateral mixing engmann 1986 fischer 1969 lee and kim 2012 moncho esteve et al 2017 rishnappan and lau 1977 particularly large curvature and strong secondary currents entail a marked anisotropic diffusivity that needs to be modelled with a suitable parameterization demuren and rodi 1986 duan 2004 this generally suffices to make the calibration of the schmidt number unnecessary i e σt 1 can be assumed in the case of channel bends the principal components of the dd tensor in the local s n reference frame can be expressed in the following general form 14 d dss α ds u y d dnn α dn u y d dsn d dns 0 where u is the friction velocity and αds αdn are proper parameters elder 1959 holly and usseglio polatera 1984 shin et al 2020 different formulations for αds and αdn are available in the literature depending on flow and environmental conditions e g the shape of the velocity profile seo and baek 2004 or the presence of vegetation lou et al 2020 following elder 1959 a common choice is αds 5 93 to account for the presence of helical flows αdn can be estimated as a function of the transversal velocity at the free surface vns as a result of depth averaging fischer et al 1979 lee and seo 2013 considering the vertical distributions of velocity expressed by eqs 4 and 5 leads to 15 α d n 1 6 κ v n s u 2 finally by rotating the principal component tensor onto the x y reference frame the diffusivity components ddij become alavian 1986 16 d d x x d d s s u 2 w 2 d d n n v 2 w 2 d d x y d d y x d d s s d d n n u v w 2 d d y y d d s s v 2 w 2 d d n n u 2 w 2 2 6 the 2def finite element numerical model the different parameterizations of curvature induced secondary currents are implemented in the framework of the 2def finite element hydrodynamic model d alpaos and defina 2007 defina 2003 viero et al 2014 2013 the model solves eqs 1 which constitute a modified version of the full shallow water equations to deal with wetting and drying processes over irregular topography defina 2000 the bottom friction is expressed using the strickler manning formulation it is treated semi implicitly to enhance model stability cea and bladé 2015 valiani et al 2002 viero and valipour 2017 the computational domain is discretized with 2d triangular elements a staggered scheme is used in which water levels are defined at the grid nodes and assumed to vary piecewise linearly through the domain flat triangular elements characterized by a constant elevation convey the discharge among adjacent nodes in the framework of semi implicit mixed eulerian lagrangian scheme in the momentum equation the material lagrangian derivative of the depth averaged velocity is replaced by its finite difference formulation 17 d w d t w w 0 δ t where the subscript 0 indicates the terms at the previous time step and position backward along the lagrangian trajectory under the hypothesis of slowly varying flows momentum equations are linearized and then solved for q w y which in turn are substituted into the continuity equation and solved with a finite element galerkin s method defina 2003 the semi implicit nature of the scheme limits its applicability to subcritical flows yet relaxes the cfl restriction on the computational time step a single system of n algebraic equations being n the number of nodes is solved at each time step by a modified conjugate gradient method considering that the accuracy of the scheme allows for using relatively coarse meshes the model turns out to be particularly efficient 2 6 1 computation of the local streamline curvature the lagrangian approach for convective terms is used also to estimate the local radius of curvature of the streamlines based on the spatial variation of the direction of the velocity bonetto and defina 1998 denoting with ϑ the angle of the velocity vector to the x axis positive counter clockwise and with r the local radius of curvature of the streamline fig 1b the streamwise distance ds can be written as 18 d s r ϑ s d s ϑ s r d ϑ observing that tanϑ v u and cosϑ u w the derivative of ϑ can be expressed in terms of velocity components as 19 d d s v u d d s tan θ 1 cos 2 ϑ d ϑ d s w u 2 d ϑ d s the local streamline curvature 1 r is then obtained by combining eqs 18 and 19 20 1 r d ϑ d s u w 2 d d s v u u 2 w 2 1 u d v d s v u 2 d u d s 1 w 2 v d u d s u d v d s for slowly varying flows δs w1δt and the spatial derivative of the velocity components can be approximated as 21 d u d s 1 u 1 u 0 w 1 δ t d v d s 1 v 1 v 0 w 1 δ t where the label 1 denotes the centre of a generic cell hence making use of eqs 20 and 21 the local curvature is finally given by 22 1 r 1 1 w 1 3 δ t v 1 u 1 u 0 u 1 v 1 v 0 1 w 1 3 δ t u 1 v 0 v 1 u 0 2 6 2 computation of the reynolds turbulent stresses the horizontal components of reynolds turbulent stresses are modelled with the boussinesq approximation and the depth integrated eddy viscosity by stansby 2003 and uittenbogaard and van vossen 2004 see also viero 2019 the reynolds terms in eqs 1 are 23 r e i j ν t y u i j u j i with indexes i and j denoting either x or y ν t the eddy viscosity and ui qi y the generic depth averaged velocity component looking at the first equation in 1 under the hypothesis of smooth spatial variations of the eddy viscosity the first reynolds stress component becomes 24 r e x x x r e x y y ν t y x 2 u x x y u x y u y x ν t y 2 u x x 2 2 u x y 2 ν t y x u x x u y y according to the continuity equation in 1 the last right hand side term is proportional to the temporal variation of the water level and is negligible in case of slowly varying flows hence the reynolds stress can be estimated as 25 r e x x x r e x y y r e y x x r e y y y ν t y 2 u x x 2 2 u x y 2 2 u y x 2 2 u y y 2 ν t y 2 u considering that these terms have to be computed for each element of an unstructured triangular mesh the divergence theorem is used to obtain the average cell value of the reynolds stresses 26 ν t y a e a e 2 u d a ν t y a e γ e u n γ d γ ν t y a e k u k n k l k in which ae is the area and γ e the boundary of the computational element n γ is the unit vector normal to the cell boundary positive outward and k identifies each of the three cell sides whose length is lk denoting with o the centroid of the cell and with ok the centroid of the cell adjacent to the k th side of the cell and with dk the projection of the segment o o k onto n k the last term of eq 26 becomes 27 2 ν t a e k u o k u o p k l k d k in which the weight pk min yk y 1 accounts for the fact that the reynolds stresses take only place at the wet interface shared by adjacent cells e g if the adjacent cell is dry no reynolds stress occurs for cell sides belonging to the mesh boundary assuming u ok u o or equivalently pk 0 allows simulating the slip condition 2 6 3 computation of the dispersive stress terms similar to the reynolds stresses the computation of dispersive stresses in eqs 1 requires a suitable evaluation of the spatial derivatives of the dij terms defined at eq 7 denoted the dispersive terms with 28 d d x x d x y d y x d y y the dispersive stresses are given by d the average of the dispersive stresses for each computational cell can be evaluated making use of the divergence of d 29 1 a e a e d d a 1 a e γ e d n γ d γ 1 a e k d k n k l k in which d k is the tensor of dispersive terms evaluated at the centre of the k th cell side this can be obtained as the average of the d terms previously computed for adjacent cells and weighted with the distance of centroids to the centre of the k th cell side concerning the dampening factor which accounts for the saturation of secondary flow in case of sharp bends the key point is the computation of the transversal gradient of the velocity which appears in eq 12 within αs and is equal to w n w n with n the unit vector normal to the local flow direction making use of the divergence theorem for each computational cell the average value of the velocity gradient is evaluated as 30 1 a e a e w d a 1 a e γ e w n γ d γ 1 a e k w k n γ k l k where the velocity at the side centre wk is computed as the average of the w at adjacent cells weighted with the distance of centroids to the centre of the k th cell side lk is the length of the k th cell side and n γk is the outward unit vector normal to the cell side 2 6 4 wall function to account for no slip condition at sidewalls at the mesh boundaries the model allows imposing a classical slip condition or to use a wall function to account for additional friction exerted by sidewalls in the latter case an additional stress component parallel to the wall direction is added to the momentum balance of wall adjacent elements it is computed as wu et al 2000 31 τ w a l l ρ w 2 κ ln d w a l l e s 2 where es is the equivalent sand grain roughness of lateral walls and dwall is the limit between the buffer and the logarithmic layers at the wall see fig 1c assumed equal to 32 d w a l l 50 ν u where ν is the kinematic viscosity of water and u the shear velocity for each grid cell the wall shear stress is applied on the surface y bwall being bwall the length of the vertical wall 2 6 5 numerical scheme for the transport diffusion equation the transport diffusion equation sect 2 5 is solved using a conservative second order in space numerical scheme the scheme is equivalent to that described by casulli and zanolli 2005 with the substantial difference that variables are located oppositely in the two staggered meshes in casulli and zanolli 2005 the model cells are control volumes that exchange fluxes through the cell sides in the present model the triangular elements convey fluxes from a node to the others or from two nodes to the remaining one the second order accuracy in space for the advective terms is achieved using an upwind total variation diminishing tvd scheme to avoid spurious oscillations the superbee limiter is applied based on two consecutive gradients of nodal tracer concentration for each node of the grid the preliminary step is computing the upstream concentration as the average concentration of all the upstream nodes weighted with the value of incoming water discharge casulli and zanolli 2005 then for each element the direction of the velocity vector determines each couple of nodes that exchange flow and tracer with each other and the concentration value at these two connected nodes is completed with the upstream concentration the two consecutive gradients allow applying the tvd limiter and the limited gradient of concentration is finally used to compute the tracer flux between nodes 2 6 6 bedload transport the bed evolution module of the 2def model described in defina 2003 is based on the exner sediment balance equation 33 1 n z b t q b 0 where n is the bed sediment porosity zb the bottom elevation and qb the volumetric sediment transport rate per unit width expressed as struiksma 1985 34 q b q b 0 1 χ c f z b s being χ an empirical factor to account for the effect of longitudinal slope on transport rate χ 0 03 according to crosato and struiksma 1989 and cf the friction coefficient cf ks 2y4 3 g the sediment transport rate q b0 is evaluated with a continuous variant carniello et al 2012 of the threshold based meyer peter and müller mpm formula 35 q b 0 8 g d s 3 s 1 t 1 5 with t θ c θ c 4 μ θ 4 4 where ds is the characteristic median sediment diameter s ρs ρ the relative density of sediments μ the ripple factor vermeer 1986 θ the shields parameter and θc the threshold value for incipient bedload transport compared to the original mpm formulation the continuous variant provides smoother hence more stable practically equivalent solutions the components of the sediment rate qbx and qby are obtained from qb as a function the direction of sediment transport which in turn depends on the near bed flow velocity in channel bends and meandering rivers using the mean velocity of the primary flow to estimate the bedload transport is often incorrect since the curvature induced secondary flow can significantly affect the flow and sediment direction at the bottom abad et al 2008 kitanidis and kennedy 1984 the inward oriented velocity at the bottom is the main cause of bend scour and of point bar accretion respectively at the outer and at the inner sides of bends bathurst et al 1977 engel and rhoads 2012 rozovskii 1957 empirical corrections have been proposed in the literature for representing the deviation of bedload transport to the mean flow velocity olesen 1987 suggested the following angular correction 36 δ β a c y r where ac is a parameter typically assumed in the range 7 12 accordingly the bottom velocity can be estimated as 37 w b u δ β v v δ β u such an approach still finds widespread applications in hydro morphological models vanzo et al 2021 yet a major limitation comes from the direct dependence on the local streamline curvature as in the instantaneous adaptation approach for secondary flows sect 2 2 which may produce unphysical results in case of large curvatures inertia and saturation are not considered moreover the bottom characteristics such as the bed roughness that shapes the vertical profile of flow velocity are not accounted for explicitly as a consequence such a correction model needs at least robust and site specific calibration alternatively when curvature induced helical flow is modelled effectively the bottom deviation angle δβ can be evaluated depending on the near bed transversal velocity component this is expected to provide a more accurate estimation of bedload than using empirical local corrections wang and tassi 2014 as inertia saturation and vertical velocity profiles can be all accounted for according to the linear velocity profile of eq 5 the transversal velocity component at the bottom is opposite to that at the free surface i e vns the near bed velocity becomes equal to 38 w b u b v b u v n s v v v n s u and it forms an angle δ arctan v b u b to the x axis the direction of sediment transport α is also influenced by the bed slope baar et al 2018 chavarrías et al 2019 which is accounted for according to struiksma 1985 39 α arctan sen δ 1 f θ z b y cos δ 1 f θ z b x the function f θ weights the influence of the transverse bed slope and is estimated as talmon et al 1995 40 f θ ζ θ with ζ 9 d s y 0 3 3 results 3 1 test with fixed bed mild curvature laboratory experiments the effectiveness of secondary flow parameterizations described in the previous section is first verified by comparing the hydrodynamic field modelled with different approaches to the laboratory data from the riprap test facility experiment bernard and schneider 1992 finnie et al 1999 the riprap channel is l 274 m long and b 5 27 m wide with 2 1 bank slope in the lower part of lateral walls fig 3 the four bends 90 and 135 right wise 90 left wise and 135 right wise have a constant centreline radius of curvature r 15 2 m the longitudinal slope is 0 216 and the strickler roughness coefficient is ks 38 5 m1 3 s the numerical mesh is made of 6 293 nodes and 11 528 triangles with mean linear size of 45 cm i e channel width to cell side length ratio b δx of about 12 the model of odgaard 1986 is used for the source terms in eq 10 and 11 see also table 1 and the wall function of eq 31 is used to enforce the no slip condition at the lateral boundaries thus accounting for the presence of side walls as boundary conditions constant flowrate q 4 25 m³ s and water depth yd 0 8 m are imposed at the inlet and outlet sections respectively fig 4 shows the spanwise profiles of depth averaged velocity in steady state conditions for the 11 cross sections of figure 3 the experimental data red dots from finnie et al 1999 are compared with model results obtained without considering dispersive stresses dotted lines with the instantaneous adaptation solid lines and with the vorticity transport dash dotted lines approaches for the same cases the plan view of fig 5 shows the location of the main stream high velocity thread in the supplementary material figure s1 highlights the importance of using a wall function to account for the resistance induced by sidewalls and figure s2 and s3 the performance of the different formulations collected in table 1 for the source terms of eq 10 and 11 fig 4 confirms that accounting for curvature induced secondary flow is necessary to obtain reasonable transversal velocity profiles in the presence of bends while the difference with a classical 2d formulation without dispersive terms is striking the local instantaneous adaptation and the vorticity transport approaches perform similarly to each other they both reproduce the experimental data very well with the vorticity transport approach slightly retarding the development of the secondary flow and in turn the outer shift of higher velocities at the beginning of bends see sect 2 6 and 10 the mean rmse evaluated for the whole 11 sections is 0 224 m s without dispersive terms 0 109 m s using the local approach and 0 123 m s using the vorticity transport approach the dispersive stresses in the swes produce deceleration of the flow in the inner part and acceleration at the outer part of the bend dietrich and smith 1983 thus shifting the high velocity thread toward the outer side of bends compared to the simulation without dispersive terms fig 5 fig 5 also shows one of the main differences between the instantaneous adaptation and the vorticity transport approaches by looking at the undisturbed flow approaching the first bend the outward shift of the high velocity thread is faster with the local approach fig 5a as it doesn t account for rotational inertia on the contrary the vorticity transport approach can account for the phase lag which becomes more important in the last part and downstream of bends indeed the vorticity transport approach fig 5b shows a persistent deviation of the high velocity thread well after the bend i e when there is no more curvature of the streamlines in the case of multiple subsequent bends the residual helical flow interacts with the secondary current that grows in the following bend abad and garcia 2009 thus increasing or decreasing the intensity of the helical flow depending on the curvature sign of successive bends passing from the first to the second bend the high velocity thread returns to the channel centre with the local approach whereas it remains at the outer left side of the channel by transporting the vorticity on the contrary the change in curvature sign in the two last bends produces a retarded outward shift of the high velocity thread in fig 5b in the riprap experiment the width ratio y b 0 2 is quite low notwithstanding the sidewalls of the channel affect significantly the transversal velocity profile as shown in figure s1 supplementary material without including a wall function for the boundary elements the model overpredicts the flow velocity close to the walls and at some sections this overprediction becomes larger when including the dispersive stresses for curvature induced helical flow the different formulations implemented for the source terms kp and kd in eq 10 and 11 reported in table 1 produce very similar results the different solutions become nearly indistinguishable both using the instantaneous adaptation and the vorticity transport approach figures s2 and s3 in the supplementary material 3 2 test with fixed bed strong curvature laboratory experiments in strongly curved bends the strong secondary circulation produced by the large streamline curvature flattens the vertical profile of velocity thus weakening the mechanism of helical flow production in what is called the saturation of secondary flows blanckaert and de vriend 2003 we use the experiments of blanckaert and de vriend 2003 and rozovskii 1957 in which the curvature is strong and the saturation effect plays a key role to check the model accuracy in terms of secondary circulation strength and spatial pattern the ecole polytechnique fédérale lausanne epfl channel blanckaert and de vriend 2003 has a length l 19 7 m and a width b 1 3 m with vertical side walls the bend develops for 193 with a constant curvature radius r 1 7 m at the centreline fig 6 a for the experiment here considered the bottom is flat and fixed and the strickler coefficient is ks 60 m1 3 s three different steady flow experiments have been conducted with inflow of 56 89 and 104 l s and downstream water depth of 10 9 16 0 and 21 3 cm respectively with fixed upstream discharge and downstream water level numerical simulations have been run until steady state conditions are attained for the three scenarios the bend sharpness is y r 0 065 0 095 and 0 125 the dampening factor fd introduced in sects 2 2 and 2 3 is computed for each computational cell based on the local flow variables and in particular on the transversal gradient of longitudinal velocity αs fig 7 shows that in the first part of the bend the high velocity thread is located at the inner side of the bend αs 0 as in a potential flow the streamise vorticity is still developing and the interaction with the primary flow is negligible the production of streamwise vorticity is maximum fd 1 in the second part of the bend as the high velocity thread is moved outward by the momentum transfer associated to the helical flow αs progressively increases the non linear saturation feedback mechanism becomes important and the production of vorticity is reduced fd 1 at the downstream end of the bend the high velocity thread is close to the outer bank and αs 1 expectedly by increasing the bend sharpness y r the saturation effect develops faster and becomes stronger second and third column in fig 7 with the consequence that the helical flow intensity does not grow much with y r in fig 8 the model results are compared with experimental data in terms of the non dimensional quantity fn 2 angle brackets highlight depth averaging which measures the strength of the secondary circulation and is defined as blanckaert and de vriend 2003 41 f n 2 v n s 2 w y r 2 comparing the results with experimental data the non linear model allows to predict the magnitude of the secondary flow far more precisely than the linear model confirming the effectiveness of the present approach it has to be said that while fn 2 magnifies the secondary flow strength thus the difference between linear and non linear models the change in the flow field obtained by accounting for non linear saturation model is quite small in the first case q 56 l s and more important for the largest discharge values this suggests that accounting for non linear effects improves the model predictions and becomes fundamental for larger values of the bends sharpness the channel used by rozovskii 1957 has a length l 11 5 m and a width b 0 8 m with vertical side walls the bend develops for 180 with a constant curvature radius r 0 8 m at the centreline fig 6b for the experiment here considered the bottom is flat and fixed and the strickler roughness coefficient is ks 70 m1 3 s the inlet velocity is w 0 26 m s and the downstream water depth is y 5 1 cm the bend sharpness is y r 0 07 the model results obtained with the no slip condition at the sidewalls are compared with the measured data in terms of depth averaged velocity at different cross sections fig 9 and in terms of water surface elevation along the channel at the inner and outer sidewalls fig 10 the model without dispersive terms overpredicts the velocity peak at the inner part of the bend as can be noted especially between section 5 and 11 in fig 9 introducing the dispersive terms with a linear formulation i e fd 1 in eq 10 or in eq 11 the high velocity thread is shifted to the outer side of the bend dash dotted lines overestimating the observed redistribution of velocity especially in the final part of the bend including the representation of the saturation mechanisms leads to a general improvement of model predictions the free surface profiles in fig 10 show that a classical 2d model without dispersive terms tends to underpredict the head losses the linear model for secondary currents leads to a significant overestimation of head losses probably because the flow is much confinated toward the outer side of the bend again including the non linear effect improves the model prediction the interest here is checking the effectiveness of the pure 2d non linear model for secondary flow in terms of transversal distribution of dispersive stresses as discussed in sect 2 4 for the experiment by blanckaert and de vriend 2003 with a discharge of 89 l s fig 11 a shows the spanwise distribution of the dsn dispersive term at 90 from the beginning of the bend the red line shows the measured data as reported by ottevanger 2013 linear models either analytical ottevanger 2013 or the present numerical scheme green and black dash dotted lines respectively overrate the dispersive stress especially close to the sidewalls where it has to decay to zero johannesson and parker 1989a blanckaert 2001 the prediction from the non linear model with the no slip condition at sidewalls black solid line is in good agreement with the empirical formulation by ottevanger 2013 and not too far from the measured data a comparison among the same models and formulations for the experiment by rozovskii 1957 is reported in fig 11b in terms of transversal velocity at the free surface vns which stands for the helical flow intensity although measured data are not available it emerges that i linear formulations dash dotted lines lead to excessively strong circulation ii the no slip condition at the sidewalls reduces the momentum redistribution close to the banks black lines and iii accounting for both the sidewall friction and the non linear saturation effects black solid line improves the physical soundness of the solution 3 3 transport of passive tracers in curved channel to test the model effectiveness in reproducing the transport of a generic passive tracer in presence of curvature induced secondary currents we use the experiments of chang 1971 which have been subject to many model applications see e g begnudelli et al 2010 duan 2004 duan and nanda 2006 ye and mccorquodale 1997 the flume is 35 4 m long and it has two opposite 90 bends with a radius of curvature r 8 53 m the cross section is rectangular and the width is b 2 34 m the mean velocity is u 0 367 m s and the water depth is y 0 115 m which are obtained imposing an upstream inflow of 0 0988 m³ s a downstream water level of 0 115 m and running the model until steady state conditions are attained a constant inflow of a conservative tracer qc 0 01 m³ s is then introduced as point injection located at 3 different transversal coordinates the injection points are named ip1 ip2 and ip3 in fig 12 the mesh resolution is a key factor for controlling the numerical diffusion in transport problems begnudelli et al 2010 casulli and zanolli 2005 to test the mesh dependency of the model solution three different mesh grids have been used with 3 396 mesh 1x 13 349 mesh 4x and 49 587 mesh 16x elements respectively these are obtained through halving the sides of each elements i e the number of elements is about 4 times greater at each refinement for the three meshes the channel width to cell side length ratio b δx is about 10 20 and 40 figure s4 and figure s5 in the supplementary material show that only the finest mesh 16x channel width to cell side length ratio of about 40 leads to reliable results with the coarser meshes 1x and 4x numerical diffusion becomes unacceptably high using the finest mesh the concentration profiles fig 13 are in good agreement with the experimental data of chang 1971 the comparison of solutions obtained with and without considering the curvature induced dispersion grey and black lines in fig 13 highlights the enhanced diffusion generated by the helical flow well described introducing the dispersive terms in the transport diffusion equation when a proper mesh resolution is used the dispersive terms in the advection diffusion equation allow reproducing the correct tracer distribution in the curved channel with the schmidt number σt 1 contrarily to match the experimental data without using these dispersive terms the schmidt number has to be tuned to lower values figure s6 of the supplementary material so as to increase the spanwise diffusion artificially rodi 2017 ye and mccorquodale 1998 the top views of fig 14 a b referring to the same scenarios of fig 13 suggest that the strength of the secondary flow is modest in the experiments of chang 1971 this is confirmed by looking at fig 14c d lateral injection points ip2 and ip3 the tracer remains almost confined closed to the lateral walls according to the experimental data and numerical results shown by duan 2004 and moncho esteve et al 2017 finally the role of the longitudinal dispersion terms ds in eq 14 is highlighted in figure s7 of the supplementary material by releasing the tracer at point ip1 starting at t 0 on a steady baseflow with ds 0 the leading front of the coloured water reveals that the high velocity thread is located at the inner side free vortex flow weak velocity redistribution performed by the secondary current the additional anisotropic streamwise diffusion provided by the ds terms makes the leading front faster and closer to the channel centreline 3 4 bedload transport laboratory experiments the parametrization of curvature induced helical flows allows to estimate the near bed transversal component of the flow velocity thus predicting more precisely the direction of the bedload transport to analyse this influence on the bed evolution we considered the experiment performed by koch and flokstra 1980 at the laboratory of fluid mechanics lfm channel the channel has a rectangular cross section width b 1 7 m and a u shape bend with curvature radius r 4 25 m measured at the centreline the longitudinal bed slope is 0 18 and the strickler roughness coefficient is ks 36 m1 3 s the discharge is q 0 17 m³ s and the downstream water depth is y 0 2 m the bed sediment has a median diameter ds 0 78 mm and a relative density s 2 65 the mesh has 1 719 nodes and 3 040 elements corresponding to about 8 elements per channel width the simulations started from a previously computed steady flow over a bed with only streamwise slope then keeping fixed the inflow discharge and the downstream water level the bed is left free to evolve until an equilibrium state is reached without any corrections to account for helical flow the bottom shear stresses are aligned to the primary flow fig 15 a introducing the secondary current correction bottom stresses change their direction inward fig 15b this produces an imbalance in the bedload transport with leads to scouring at the outer side and bed accretion at the inner part of the bend the bed topography at equilibrium is shown in the colour maps of fig 16 in terms of erosion deposition with respect to the initially flat bed z and in the transversal profiles of bed elevations reported in fig 17 see also figure s8 of the supplementary material which plots the difference between computed and measured values of z with respect to the experimental data fig 16a a 2d model with no corrections for the bedload direction leads to completely unreliable results only the accelerations and decelerations associated to the free vortex flow field at the beginning and at the end of the bend produce some modifications of the bed fig 16b the empirical correction of bedload direction proposed by olesen 1987 with ac 10 in eq 36 tends to overestimates both erosion and depositions fig 16c especially as this correction is based on the local radius of curvature scour and deposition start at the very beginning of the bend no phase lag and proceed uniformly along the bend in the experiment scour and erosion slightly decrease at 135 the computed z is over 3 times larger than the measured one fig 17 the explicit parametrization of the secondary current and the correction of bedload direction proposed by bernard and schneider 1992 leads to better estimations compared to the instantaneous adaptation approach fig 16d the vorticity transport approach in fig 16e correctly reproduces the initial phase lag and the increased scour at the end of the bend close to the outer wall the cross sections in fig 17 show that the inclusion of secondary flow according to bernard and schneider 1992 well reproduces the inner aggradation whereas the outer scour is underestimated finally fig 18 shows a comparison of the scour deposition produced by the three different models for secondary flow here implemented the bed evolution is estimated using different parametrization for secondary currents intensity compared to bernard and schneider 1992 which is in good agreement with experimental data the models of kalkwijk and booji 1986 and odgaard 1986 slightly underestimate the magnitude of z yet with a very similar spatial pattern see also figure s9 of the supplementary material which plots the difference between computed and measured values of z 3 5 real world case study fixed and mobile bed the model is finally applied to a real world case study the 50 km long reach of the po river northern italy between the mincio and the panaro confluences i e from 12 km upstream of ostiglia to 8 km downstream of ficarolo fig 19 the meandering reach has been modelled using a 2d triangular grid with 58 570 nodes and 114 452 elements the focus is here on three meandering bends denoted as m1 m2 and m3 in fig 19 table 2 reports additional details the bathymetry derived from a 2004 multibeam survey merged with a 2008 lidar survey is shown in figure s10 of the supplementary material a fixed water level derived from an available rating curve is used as downstream boundary condition we then considered three different discharge scenarios named q 3990 q 7400 q 11 500 where q denotes the discharge expressed in m³ s and imposed at the inlet section for each discharge scenario a first set of simulations has been performed with the fixed real bathymetry with and without including the dispersive terms in the momentum equations the inclusion of secondary flow correction entails minor changes to the flow field an example is shown in figure 20 at the aa cross section meander m1 the increase and the outer shift of the peak velocity obtained by including the correction for the secondary flow is absolutely modest and it further decreases for lower flowrate values e g q 3990 m³ s fig 20 b using the instantaneous adaptation or the vorticity transport approach entails negligible differences as well dashed and solid lines in fig 20b similar results are obtained for meanders m2 and m3 some relevant parameters are reported in table 2 the depth averaged velocity field at meander m1 for the discharge q 11 500 m³ s and including the dispersive stresses in the momentum equations is shown in fig 21 the w 2 m s isoline is plotted for both the cases with magenta and without orange the dispersive stresses again without any substantial difference these results suggest that including the dispersive terms for curvature induced secondary flow is inessential to model the depth averaged 2d flow field in natural rivers with fixed deformed bed nonetheless it has been already pointed out that secondary flow plays a major role with respect to the development of the bed topography blanckaert 2010 shimizu et al 1990 the po river case study is then used to check the ability of the different approaches for curvature induced secondary flow in modelling the relevant hydro morphodynamic processes and to produce real like bathymetric configurations hence a set of mobile bed simulations has been run starting from a flat bed i e an unbalanced bathymetric configuration obtained by linearly interpolating the bed elevation from the mesh inlet to the outlet fig 22 b the surveyed bed is shown in fig 22a the movable bed simulations either with or without dispersive terms and correction for bedload direction are run with a constant discharge q 11 500 m³ s until an equilibrium bed condition is reached the inclusion of dispersive stresses and the correction for bedload direction are actually necessary to obtain reliable bed configurations as demonstrated by comparing the equilibrium configuration obtained in the two different modelling approaches fig 22c interestingly reliable equilibrium bathymetries are obtained also using the empirical correction for the bedload direction proposed by olesen 1987 with ac 10 or considering a lower discharge of q 7400 m³ s see figure s11 of the supplementary material fig 23 shows the bed evolution and the depth averaged velocity field from the initially flat bed to the equilibrium condition reached at time teq 2 years modelled considering the dispersive terms with the flat bed the high velocity thread is located at the inner part of the bend and the flow then collides at an oblique angle with the outer bank in this situation the secondary flow is relatively strong and so is the velocity redistribution entailed by the dispersive terms as time advances sediments are carried toward the accreting point bar in the inner part of the bend due to the inward direction imposed by the helical flow the main part of the discharge then flows over the deepest part of the bend driven by the so called topographic steering blanckaert 2010 more than by momentum redistribution induced by the secondary flow approaching the equilibrium condition the importance of topographic steering increases and the already weak effect of dispersive terms further reduces 4 discussion this study deals with the inclusion of helical flow secondary currents in two dimensional general purpose river and flood models the implementation of different modelling approaches and the application to several case studies both in the laboratory and in the field shed light on a set of interesting issues which are here discussed 4 1 the role of dispersive terms in momentum and transport diffusion equations the model applications described in the previous section highlighted the importance of including the dispersive terms yet not all these terms play an important role nor are always necessary in the momentum equations the most important contribution is given by the diagonal term dsn its spatial gradient entails additional resistance at the inner side of bends and acceleration at the outer side of bends dietrich and smith 1983 which are the outcome of the outward momentum transfer generated by the helical flow the dss and dnn terms are often neglected in the technical literature e g finnie et al 1999 indeed the streamwise variation of dss is generally smooth and the dnn term is typically much smaller than dsn when the curvature ratio y r is much lower than 1 lien et al 1999 in the model applications described above the inclusion of the dss and dnn terms not shown produced negligible modifications in the model outcomes in the equation for transport and diffusion of conservative tracers and suspended matters the inclusion of dispersive terms suffices to avoid the calibration of the schmidt number to match experimental data however in transport diffusion problems the mesh resolution is the key factor to control the numerical diffusion and to obtain reliable results 4 2 model sensitivity to the mesh resolution the dispersive terms for curvature induced secondary flows rely on the proper evaluation of the transversal gradient of the dsn dispersive stress the effectiveness of the helical flow parameterization then depends on the mesh resolution we performed an ad hoc sensitivity analysis of the model results to the mesh resolution for the above case studies as a representative example we considered the riprap experiment and compared the model results obtained with four different mesh fig 24 mesh 1x cell side length 2 00 m b δx 4 tot 1 112 cells mesh 10x cell side length 0 45 m b δx 10 tot 11 528 cells mesh 40x cell side length 0 22 m b δx 24 tot 43 395 cells mesh 160x cell side length 0 11 m b δx 48 tot 166 965 cells with b δx the channel width to cell side length ratio fig 24 shows that the dispersive terms which come from the transversal derivatives of the dsn stresses are smoothed out excessively using the coarsest mesh 1x the mesh 10x well adheres to the experimental velocity data fig 24f the mesh 40x improves the representation of dispersive terms particularly close to the channel walls where the highest gradients of dispersive terms are located fig 24b leading to an improved spanwise distribution of flow velocity fig 24f finally as shown in fig 24g the far increased computational need required by mesh 160x vertical bars is not counterbalanced by a further improvement of the solution the velocity rmse does not reduce for b δx 10 the mesh resolution was shown to have a far more important role in controlling the numerical diffusion of passive tracers and suspended matters sect 3 3 which requires finer meshes b δx 40 than for including the parameterization of secondary flow on momentum equations only b δx 10 20 using a coarser mesh with the schmidt number tuned to larger values is a computationally efficient alternative however it entails extra diffusion in straight river segments and a loss of predictive ability ad hoc calibration becomes mandatory the choice of the grid structure e g structured or unstructured regular or irregular is another issue that can affect the numerical diffusion of transported tracers casulli and zanolli 2005 while unstructured meshes allow for a greater flexibility and easier adaptation to irregular boundaries the computation of the spatial gradients of dispersive stresses may become challenging close to geometrical singularities and at interfaces where the elements size changes abruptly nabi et al 2016 an ad hoc sensitivity analysis not shown here demonstrated that when a proper mesh resolution is chosen the schemes described at sects 2 6 leads to an accurate estimation of the spatial gradients irrespective of the kind of structured mesh employed e g regular aligned with flow or irregular cell patterns 4 3 modelling approaches to dispersive stress estimation different options have been implemented to estimate the helical flow intensity which regard the local or transported approach i e with instantaneous adaptation or by transporting the streamwise vorticity component the theoretical formulation for the secondary flow parameterization i e the expression for kp and kd in eqs 10 or 11 the inclusion of wall functions and of a non linear model for secondary flow saturation the choice of the most suitable approach mainly depends on the geometrical configuration of the channel here we collect some general criteria the local approach is the easiest to implement the cheapest from a computational standpoint and particularly suitable for long regular bends as it neglects the secondary flow inertia the helical flow intensity can be overpredicted in high curvature bends especially at the entrance of the bend or mispredicted in tight succession of counterrotating bends moreover the local approach is very sensitive to geometrical singularities that entail abrupt variations of streamline curvature also in straight river segments where spurious local variations of dispersive stresses can appear thus to avoid the onset of unphysical dispersive stresses it is a good practice to apply a spatial smoothing e g a shapiro filter shapiro 1970 to the streamline curvature field the vorticity transport approach which intrinsically smooths out possible unevenness in the streamline curvature field as a result of the secondary flow inertia is surely more robust and physically sound yet more demanding from a computational standpoint it is advisable for river channels in which the bathymetry presents some unevenness in the case of sharp bends and in tight sequences of bends the different parameterizations of secondary flow here implemented see table 1 lead to dispersive stresses dij whose magnitude are quite different however the dispersive terms in the momentum equations which depend on the spatial gradients of dij are coherently predicted by the different parameterizations the model applications of sect 3 suggested that the different theoretical formulations are practically equivalent to each other the magnitude of dispersive terms in momentum equations which depends on the gradients of dispersive stresses dij is generally negligible at the channel centreline and maximum towards the banks where both flow velocity and the dispersive stress tend to zero blanckaert 2001 johannesson and parker 1989a in case of compact low aspect ratio cross sections the velocity gradient at the banks is greatly affected by the no slip condition at the channel walls in these cases which are generally found in laboratory flumes the use of wall functions to account for side wall friction is mandatory instead in natural bends the effect of lateral wall is less significant as banks are tilted and the aspect ratio is far larger in this kind of cross sections velocity reduces progressively in the transversal direction dictated by the progressive reduction of water depth consequently the free slip condition at sidewalls is generally an acceptable hypothesis in natural rivers finally the model applications showed that the saturation of secondary flow has to be accounted for to limit the intensity of helical flow when strong secondary currents act to flatten the vertical profile of the streamwise velocity component blanckaert 2009 blanckaert et al 2013 when and where the saturation effect becomes important is not only a function of the bend curvature but also of the local flow field indeed the key parameter governing the occurring of saturation is the spanwise gradient of the longitudinal velocity component which describes if the high velocity thread locates at the inner free vortex type flow or at the outer forced vortex type flow of the bend importantly the local flow field and the transversal gradient of velocity αs also depend on the bed bathymetry i e flat or deformed outward tilted this can be seen also by looking at the spatial distribution of the parameter αs the normalized transversal gradient of the depth averaged velocity for a flat bed rectangular cross section αs is expected to approach 1 at the beginning of the bend free vortex flow type and to progressively increase along the bend to denote forced vortex flow type blanckaert 2010 this is roughly depicted by the plots in the second line of fig 7 instead in a real bend with deformed bed the high velocity thread locates at the outer side of the bend due to topographic steering keeping αs 1 at the inner side and αs 1 at the outer side all along the bend figure s12 in the supplementary material as a result the helical flow intensity is dampened by the saturation model fd 1 at the main core of the flow outer side of the bend where the velocity and the centrifugal force are highest and limited by the low streamwise velocity at the inner side of the bend where the dampening factor fd 1 would let the helical flow to develop free interestingly when the depth averaged flow field is mainly driven by the bathymetry the spatial distribution of αs remains broadly the same either considering or ignoring the dispersive terms figure s12 in the supplementary material the role of bend bathymetry is further discussed in sect 4 5 a relevant aspect concerning the model implementation is that the saturation effect can be effectively assessed with a pure 2d approach thus avoiding any reference to the channel centreline or width gu et al 2016 ottevanger et al 2012 nor requiring time consuming iterative procedures to estimate the non linear parameters qin et al 2019 in this way the validity of traditional 2d models is extended to relatively sharp bends in a straightforward manner and without dramatic increase of the computational burden the modeller should be aware that 2d models equipped with this kind of description of secondary flows cannot represent the formation of counterrotating secondary cells in very sharp bend blanckaert and de vriend 2010 stoesser et al 2010 4 4 ill posedness and instability in 2d secondary flow models the recent study by chavarrías et al 2019 highlighted an important issue concerning the possible ill posedness of 2d depth averaged models with linear formulation for the secondary flow they considered the case in which the helical flow intensity is computed using a transport equation ill posedness was shown to appear in the form of non physical oscillations of the flow field which increase with increased grid refinement they demonstrated that adding a certain amount of diffusion particularly in the spanwise direction may lead to a well posed problem and provide stable solutions besides that they observed that accounting for the saturation effect may have a similar stabilizing effect as saturation models act to dampen any kind of unbounded production of helical flow intensity as in the case of unstable short waves on the one hand we stress that while 2d models compute the intensity of the helical flow locally the secondary flow typically emerges as a unique rotating cell in the physical domain hence to be physically consistent the helical flow intensity computed by 2d models should vary smoothly in the spanwise direction of course enhanced transversal diffusion as that provided by the use of coarse grids is beneficial in this regard on the other hand it is interesting to note that in the numerical experiments by chavarrías et al 2019 model instabilities as a result of ill posedness were significant for a grid with b δx 100 and disappeared when they used a coarser grid with b δx 10 comparable with the grid resolution used and suggested as reasonable in the present study 4 5 the interplay of secondary flow and bed bathymetry the importance of secondary flow in shaping hydro and morphodynamics in curved channels as well as the ability of 2d models to effectively capture the effects of helical flow have been long debated in the literature alho and mäkinen 2010 guan et al 2016 kasvi et al 2015 2013 lane 1998 a tangled picture also emerges from the case studies assessed in sect 3 including the dispersive terms in the momentum equations was crucial in the case of laboratory experiments yet it entailed minor changes to the flow field in the real world case of the po river considering the surveyed bed bathymetry the different behaviour might be attributed to different curvature ratios among these tests we then computed for the model applications presented in sect 3 different scaling parameters that have been proposed to measure the strength of curvature induced secondary flow and its effects on hydrodynamic kashyap et al 2012 according to the values collected in table 3 the secondary flow correction is most important in the epfl channel of blanckaert and de vriend 2003 followed by that of rozovskii 1957 and less important for the chang 1971 case this ranking agrees with the outcomes of the model applications shown in sect 3 1 and 3 3 respectively in fact we used the experimental data by chang 1971 only to check the transport and diffusion module because the effect of dispersive terms on the depth averaged 2d hydrodynamics was negligible looking at the po river case study the parameters of table 3 values are actually lower than most of their laboratory counterparts but not sufficiently small to justify the weak to negligible effect of secondary flows on the depth averaged hydrodynamics of the po river test case similarly the velocity redistribution by secondary flow is known to be much important for narrow cross sections e g b y 10 and negligible in shallow ones with b y 50 blanckaert 2011 blanckaert and de vriend 2010 constantinescu et al 2013 but again the aspect ratio of the po river case study is not so different to justify the basically different behaviour the above considerations and the results shown in sect 3 5 suggest that the main reason for the controversial results obtained in the previous and present applications stems from the fact that the development of and the role played by secondary flows essentially depends on the bed bathymetry in the po river test the surveyed bottom is deformed see the cross section in fig 20 and the colour map in fig 22a whereas the laboratory tests dealt with compact cross sections with flat bed and vertical walls by performing additional numerical experiments in which the bed was artificially flattened it was shown that the flow field in the po river bends is mainly driven by the bed topography i e the so called topographic steering than by momentum exchanges and velocity redistribution ascribed to curvature induced secondary flow blanckaert 2010 chen and duan 2006 deng et al 2021 he 2018 van balen et al 2010 of course the fact that the depth averaged 2d flow field is not significantly altered by the secondary circulation and can be roughly predicted by traditional 2d models without including dispersive terms does not imply that secondary circulations do no play a role at all secondary circulations causing the inner and outer streamwise oriented vortical cells still amplify the boundary shear stresses altering the transport of sediments and posing a threat to bank stability this picture further complicates in very sharp bends blanckaert 2011 constantinescu et al 2013 accounting for the effects of curvature induced secondary flow in 2d hydro morphological models remains almost necessary in particular when the bathymetric configuration is far from equilibrium conditions shimizu et al 1990 or when the bathymetry could be subject to strong variations e g long term simulations however the vast majority of natural river bends are mildly curved and or have a deformed bed in these conditions the depth averaged 2d flow field is nearly independent of dispersive terms and the major outcome of curvature induced secondary circulations is by far the change in bedload direction this explains why many hydro morphological models to account for the effect of secondary flows only implement empirical formulations to correct the bedload direction e g defina 2003 vanzo et al 2021 5 conclusions a correction for curvature induced secondary flow in channel and river bends is implemented in the hydro and morpho dynamic model 2def the dispersive terms appearing in the momentum equations are expressed according to three different formulations recast in similar form the computation can be performed assuming the instantaneous adaptation of secondary flow to the driving streamline curvature or accounting for inertia and phase lag of the helical flow via a vorticity transport approach the effect of impervious banks is accounted for using wall functions the classical linear model for secondary flow is completed with a novel pure 2d implementation of a robust non linear model accounting for the saturation of secondary flow occurring in relatively sharp bends dispersive terms are added also to the transport and diffusion equation and accounted for in the morphodynamic module for bedload transport and mobile bed evolution model applications to laboratory tests and to a real river with both fixed and mobile beds confirm the importance of accounting for secondary flow and the validity of the approaches the different formulations for dispersive terms perform similarly to each other the local instantaneous adaptation approach is less demanding and suitable to isolated bends in riverbeds with a regular bathymetry the streamline curvature field must be smoothed out to avoid numerical instabilities all the local approaches either to compute the dispersive stresses or to correct the direction of bedload transport produce unphysical results in presence of geometrical singularities such as bridge piers or abutments the inertia of secondary flow which is accounted for intrinsically when transporting the streamwise vorticity filters out the typical unevenness characterizing the bathymetry and the curvature field of real rivers and possible geometrical singularities the non linear model for secondary flow saturation is a fundamental ingredient to counteract the excessive growth of helical flow intensity in relatively sharp bends and to produce physically sound spatial distributions of dispersive stresses to this purpose wall functions are needed to model the effect of vertical impervious walls nonetheless in real rivers with tilted banks wall functions are unnecessary curvature induced secondary flows are shown to produce important modifications to the depth averaged flow field in case of rectangular cross sections i e flat bed in the spanwise direction the high velocity thread is moved from the inner to the outer side of the bend and saturation of secondary flow soon becomes important even for not excessively sharp bends on the contrary in real rivers with formed bathymetry outer scour the moderate streamline curvature and the already formed bed bathymetry make the effects of the correction less evident in terms of depth averaged flow field the estimation of secondary flow intensity remains important for modelling the transport of suspended matter and above all for repercussions on bedload transport and morphological setting however in real river with formed bathymetry empirical corrections for the direction of bedload transport based on the local streamline curvature and without including dispersive terms in the momentum equations generally perform satisfactorily funding t l is sponsored by a phd scholarship funded by the cariparo foundation d p v has been partly supported by the italian national research programme prin 2017 with the project n 2017seb7z8 interactions between hydrodynamics flows and biotic communities in fluvial ecosystems advancement in discharge monitoring and understanding of processes relevant for ecosystem sustainability by the development of novel technologies with field observations and laboratory testing enterprising credit authorship contribution statement tommaso lazzarin conceptualization methodology validation investigation visualization writing original draft daniele p viero conceptualization methodology supervision writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments prof andrea defina is gratefully acknowledged for fruitful discussions supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2022 104355 appendix supplementary materials image application 1 
