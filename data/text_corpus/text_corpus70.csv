index,text
350,many important groundwater transport applications require solving the darcy flow in heterogeneous porous media flow simulations especially in large highly heterogeneous aquifers require extensive computational resources a multiresolution multiscale approach to resolve the different heterogeneity scales and an accurate calculation of the velocity field common methods such as finite volumes and elements assume a discontinuous conductivity field introducing velocity discontinuities along the cell or element interfaces due to using classic discrete operators or lagrangian basis functions over the last decade the development of isogeometric analysis iga eliminates many of the aforementioned limitations bridging the gap between cad and numerical analysis since classic iga uses the galerkin and collocation approach in this paper we present a third concept in the form of c ontrol v olume i so g eometric analysis cv iga enabling local and global mass conservation as well as multiresolution description of all heterogeneity scales due to the approximation properties of spline basis functions the velocity field and its derivatives are continuous and are obtained by an optimal convergence rate the cv iga methodology is verified with 2 d numerical and stochastic benchmark flow simulations including comparisons with classic methods and two other iga formulations as well as the convergence analysis of the head and velocity fields for different orders of fup and b spline basis functions keywords isogeometric analysis iga fup basis functions b splines control volume galerkin collocation multiresolution approach groundwater flow heterogeneous porous media 1 introduction the analysis of flow in heterogeneous porous media is not only important due to water supply or interpretation of hydrogeological properties currently analyses of contaminant transport remediation or energy exploitation have become very important due to sustainable development and water resources protection realistic and reliable transport analysis requires extensive flow simulations including large domains complex geometries extensive computational burden with high parallel computing and resolving of many unfortunately especially fine heterogeneity scales finally the main input for transport analysis is an accurate velocity field that satisfies the local and global mass balance property and enables continuity of velocity and its derivatives due to the description of a velocity dependent dispersion tensor cainelli et al 2012 over the last few decades many numerical and stochastic methods have been developed to fulfil all the mentioned requirements due to scarcity of input data especially related to the hydraulic conductivity all flow and transport fields variables such as hydraulic conductivity head velocity concentration and or travel time have been regarded as stochastic random fields srf see comprehensive reviews of dagan 1989 gelhar 1993 rubin 2003 and zhang 2002 therefore many stochastic methods have been developed such as spectral methods e g gelhar 1993 perturbation methods e g dagan 1989 cvetkovic et al 1992 moment methods e g hsu et al 1996 stochastic finite element e g aguirre and haghighi 2003 or probabilistic collocation methods e g li and zhang 2007 xiu and hesthaven 2018 as well as many others most of these methods are faced with many computational and implementation problems especially in the case of high heterogeneity and large anisotropy in irregular domains despite the many desired properties of the aforementioned methodologies the monte carlo method is still the most general and reliable stochastic method which at least serves as a verification method of all the mentioned methods among others the monte carlo method has been used for flow and transport analysis in weakly and highly heterogeneous porous media by bellin et al 1992 cvetkovic et al 1992 1996 salandin and fiorroto 1998 zinn and harvey 2003 jankovic et al 2006 de dreuzy et al 2007 gotovac et al 2009b beaudoin and de dreuzy 2013 ramasomanana et al 2013 srzic et al 2013 fiori et al 2015 the monte carlo method first generates as many conditional or unconditional heterogeneity realizations of hydraulic conductivity as possible then the flow equation is solved for all realizations to obtain the velocity field that is the main input in transport simulations of for example contaminant transport the next step is solving the transport equation for all flow realizations and obtaining the plume concentration inside the domain or travel time flux breakthrough curve at some chosen control planes finally ensemble statistics for all flow and transport variables are analyzed to obtain its statistical moments correlations or probability density functions pdf s rubin 2003 however the computational heart of the monte carlo method as a stochastic methodology lies in applying the appropriate numerical techniques for flow and transport simulations in each realization in this paper we will focus on numerical flow simulations and derivation of an accurate velocity field needed for reliable transport simulations cainelli et al 2012 recently analyzed convergence and approximation properties of common numerical methods for flow analysis in heterogeneous porous media they defined common methods as the widely used finite element fem and finite volume fvm methods which regard hydraulic conductivity as a piecewise element cell constant field discontinuous field representing heterogeneity at some chosen scale the classic finite element method fem e g bellin et al 1992 divides the domain into the finite elements describing the head as a linear combination of classic lagrangian basis functions usually linear or quadratic the inherent problem of the classic fem is discontinuity of head gradients along the inter element boundaries due to the properties of lagrangian basis functions this effect in combination with the common assumption of the discontinuous conductivity field through the darcy law produces numerically unphysical velocity discontinuities variations causing additional artificial numerical dispersion and for instance inaccurate particle tracking in transport simulations these problems arise with higher heterogeneities due to larger inter element conductivity contrasts and larger velocity numerical errors classic fem can also violate local mass balance over elements the first way to overcome classic fem problems is to employ the mixed finite element mfe formulation e g mose et al 1994 where velocity is also represented by basis functions involving additional degrees of freedom and computational work in flow simulations additionally some mfe formulations can create ill posed problems another way is to perform postprocessor calculations on fem velocity fields requiring continuity of velocities between elements and or mass continuation yeh et al 1981 cordes and kinzelbach 1992 on the other side fvm methods such as modlflow formulation e g harbaugh 2005 de dreuzy et al 2007 can also be regarded as cell finite difference formulation satisfy mass balance over the cell boundaries and ensure velocity continuation normal to the cell boundaries however modflow generates discontinuities of tangential velocity components between cells it is possible to prove equivalence between modflow and mfe which uses low order basis functions canielli et al 2012 in addition of classical modflow and fem most other existing methods e g hou and wu 1997 jankovic et al 2006 vent and kitanidis 1996 or rasaei and sahimi 2009 do not support a true multiresolution approach respecting that hydraulic conductivity can be spanned by many scales gotovac et al 2009a presented a such multiresolution approach based on the adaptive fup collocation method afcm with the following crucial properties a correlated log conductivity lnk field is presented as a continuous function in a multiresolution way that can accurately describe all needed scales b independently resolves all heterogeneity and head scales c yields a continuous velocity field as well as its derivatives needed for application to realistic transport simulations with a velocity dependent dispersion tensor and d actively controls head and velocity numerical errors reducing numerical dispersion and ensuring convergence even in highly heterogeneous porous media the heart of the methodology lies in fup basis functions closely related to the b splines see gotovac and kozulic 1999 and supplementary material in conjunction with the collocation procedure however the main drawback was the lack of local and global mass balance due to the properties of the collocation framework inability to describe the general irregular geometry and computationally expensive head solution to obtain an accurate velocity field without numerical oscillations for high heterogeneity cases among others applications of the afcm have been shown for the analysis of the flow and transport in heterogeneous porous media relating to the travel time statistics gotovac et al 2009b concentration statistics srzic et al 2013 and advective transport fiori et al 2015 therefore in this paper we put desirable afcm properties to the broader context of isogeometric analysis iga initially published by hughes et al 2005 iga has attracted enormous attention by designers and modelers because it bridges the gap between computational aid design cad of irregular domains and the numerical description of physical processes on them the idea is quite simple use the same type of spline basis functions usually b splines or nurbs to describe both the geometry and solution head and velocity for our particular groundwater flow problem iga has been successfully applied in many fields of solid structural and fluid mechanics e g cottrell hughes and bazilevs 2009 it has been shown that iga significantly outperforms classical fem due to higher accuracy and enhanced continuity since classic iga uses the galerkin variation principle for solution description and transforms the physical domain to the virtual one for geometry description the apparent similarity between iga and fem has resulted in the scientific community widely accepting iga as new powerful modeling machinery spline fem in spirit iga is closely related to the meshless or mesh free methodologies due to its use of spline basis functions which enable many properties not seen in fem such as exact geometry description in cad sense no classical meshing more efficient refinement adaptive procedures and multiresolution approach higher continuity of solution and geometry and usage of higher order basis functions in addition to the galerkin weak formulation iga recently presented a collocation approach e g aurichio et al 2010 shillinger et al 2013 gomez and de lorenzis 2016 recently our numerical group developed and applied control finite volume iga formulation to the groundwater flow modeling in karst aquifers which are represented by 3 d heterogeneous porous matrix and 1 d laminar turbulent karst conduits malenica et al 2018 efficient numerical modeling using spline basis functions may not always link exclusively with iga that includes geometry transformations because everything can be performed only in the physical domain in that case spline basis functions which intersect domain boundaries must satisfy the geometry constraints and boundary conditions using for instance the rvachev solution structure method see for instance rvachev et al 2000 tsukanov and shapiro 2005 hollig et al 2003 apprich et al 2016 kozulic and gotovac 2017 recently iga has been used for solving groundwater flow problems such as filtration through the dam foundation shahrbanozadeh et al 2015 saturated flow bekele et al 2016 unsaturated flow nguyen et al 2014 or flow in fractured media hageman and borst 2019 finally in this paper using the framework of control volume isogeometric analysis cv iga the groundwater flow in heterogeneous porous media is then analyzed using two types of spline basis functions b splines and fup basis functions and compare to the common iga choices galerkin g iga and collocation c iga except geometry and solution head and velocity heterogeneity is also described by fup b spline basis functions introducing cv iga as a promising tool for more powerful flow simulations in heterogeneous porous media which enables the derivation of the velocity field with all the desired mentioned properties therefore this methodology can open new avenues for more robust and realistic simulations of tracer and contaminant transport cai et al 1997 zheng and bennett 2002 2 problem formulation this section will present brief review of mathematical and physical formulations of flow in heterogeneous porous media we assume that groundwater flow in heterogeneous porous media can be described by darcy law 1 q k h where q is the vector of darcy velocity h is the hydraulic head and k is the hydraulic conductivity symmetric tensor of the second order 2 k k xx k xy k yx k yy where kij is the tensor component which characterizes velocity in i direction under the unit hydraulic gradient in the j direction if tensor properties are equal in all directions it is an isotropic porous media otherwise the tensor represents an anisotropic porous media if the porous media contains the same conductivity tensor in all points it is a homogeneous porous media otherwise it is the heterogeneous one all real aquifers are heterogeneous and anisotropic domenico and schwartz 1998 due to lack of knowledge of the hydraulic conductivity distribution it is common practice to consider the hydraulic conductivity as a random stochastic field commonly defined by the average value variance and correlation length rubin 2003 in this paper we will assume that any hydraulic conductivity correlated field can be described by a continuous function representing all spatial scales on appropriate control volumes cells we will derive the basic equation of steady flow by applying the equation of continuity i e the mass balance law on the infinitesimal control volume with sides dx and dy thus the mass balance law on a control volume can be simple described as follows the difference between the mass that entered the control volume and that which came out of the control volume needs to be equal to the pumping recharge inside the control volume the amount of mass passing through a surface area of the control volume in the direction of the external normal per unit time is equal to the mass flux 3 q f d m d a d t ρ d v d a d t ρ q n which is equal to the product of density and darcy normal velocity component mass flux is negative in the direction of the external normal which means that the mass exits the control volume and vice versa when the mass enters the volume opposite to the direction of the external normal mass flux is positive it should be noted that the flow equation is defined for darcy s average velocity in the normal direction because the entire control surface is considered in the flow equation mass production pumping recharge within the control volume was determined by the rate q0 a its sign depends on whether it is a source plus or sink minus mathematically speaking steady 2 d flow equation can be written as 4 ρ q x d y d z ρ q x ρ q x x d x d y d z ρ q y d x d z ρ q y ρ q y y d y d x d z ρ q 0 d x d y d z 0 for incompressible fluid density is constant and 2 d flow equation is 5 q x x q y y q 0 0 in the reduced form it is written as 6 div q q 0 0 which defines that divergence of darcy velocity over the control volume is the equal to the mass production inside it the final form of the steady state flow equation is obtained by combining the mass balance on the infinitesimal flow parcel 6 darcy s law 1 and hydraulic conductivity tensor 2 7 x k xx h x k xy h y y k yx h x k yy h y q 0 0 eq 7 is valid for 2 d heterogeneous and anisotropic porous medium if principal axes of anisotropy coincide with axes x and y above equation can be reduced to the following form 8 x k xx h x y k yy h y q 0 0 dirichlet and neumann boundary conditions are given as follows 9 h x h d x x γ d 10 q x n q n x x γ n flow eq 8 with appropriate boundary conditions dirichlet d as a known head 9 and neumann n as a known normal flux through the boundary 10 and known hydraulic conductivity distribution measured interpolated or generated can be solved by many numerical methods such as the common finite element and finite volume methods in this paper we will use isogeometric analysis iga using the galerkin collocation and control volume approach solving the flow problem 8 10 will give the head field the final flow result is the pore velocity v q ne using 1 where ne is effective porosity 3 methodology this section will provide a detailed description of the methodology employed there are two basic categories of spline based methods a with geometry mapping from the physical space to the parameter space which is widely coined as isogeometric analysis iga see hughes et al 2005 and cottrell et al 2007 2009 and b without geometry mapping where the solution is directly approximated in the irregular physical domain see kozulic and gotovac 2017 tsukanov and shapiro 2005 or hollig et al 2003 in this paper we will present the iga framework with two classical formulations galerkin g iga see cottrell et al 2009 and collocation c iga see auricchio et al 2010 both formulations are implemented in the open parallel code petiga dalcin et al 2016 then we will present the fup b spline description of heterogeneity and the solution of the flow problem 8 10 using the recently developed control volume formulation cv iga malenica et al 2018 in that way we can compare three iga formulations capable of bringing new avenues for groundwater flow modeling in heterogeneous porous media mainly due its ability to describe the geometry heterogeneity and solution head and velocity supplementary material describes the fup and b spline basis functions 3 1 review of iga framework spline methods have been attracted scientific attention since its discovery in the 1950s however the research has developed in two separate directions one for cad and geometry description and another for numerical analysis for solving of the boundary initial value problems hughes et al 2005 linked these two directions so that all variables geometry and solutions such as head and velocity are described by a linear combination of spline basis functions for example fig 1 presents the iga scheme of how one 2 d subdomain or patch defined as general four sided object we limit our considerations in this section to the one patch is transformed from the parameter space transformed domain to the physical space real domain using the following spline representation 11 x ξ η j 1 n x j ϕ j ξ η y ξ η j 1 n y j ϕ j ξ η where xj and yj are coordinates of n control points b xj yj in the physical space while ξ and η are coordinates in the parameter space the key elements of 11 are spline basis functions ɸj which are obtained by cartesian product of 1 d basis functions from each direction number and position of basis functions in both directions inside the patch are defined by knot vectors fig 1 in this paper we use open uniform knot vector as an ordered set of increasing parameter values ξ ξ1 ξ2 ξk n 1 ξi ξi 1 where ξi is the i th knot k is the number of basis functions and n is the polynomial order fig 1 for example in the ξ direction the knot vector divides the parametric space into intervals usually referred to as knot spans knot has a multiplicity m if knot value is repeated m times in the knot vector in this paper uniform open knot vectors are used where the first and last knots have a multiplicity m n 1 while all other knots are different and uniformly spaced between the first and last knot see for example review of nguyen et al 2015 moreover knots define distribution of parent elements in the parametric space located between neighboring knots fig 1 which have the same role as finite elements in fem therefore patch is divided to the parent elements which can serve as a basic integration element after integration over all parent elements assembling process is the same as in fem the control points define the control mesh in physical space which enables the designer to create a wide range of desired objects for instance in the car or aviation industry expression 11 presents that coordinates of control points directly define mappings from the parametric to the physical space fig 1 also ilustrates spline mapping for a chosen set of control points number of control points is equal to the number of basis functions which is on the other side defined by a knot vectors in both directions the control grid mesh which defines the connectivity between control points is also shown the non interpolatory nature of control points in the interior of the domain is evident and represents a notable difference over conventional lagrangian meshes nguyen et al 2015 in classic iga b splines and nurbs are widely recognized as suitable spline basis functions with the following main properties a compact support implying localized approximation properties b strictly positive values implying positive definiteness c partition of unity d enables continuity up to the desired order and e enables multiresolution or multiscale representation and construction of efficient adaptive procedures supplementary material presents a short description of the b splines and fup basis functions that will be used in this paper multidimensional spline representation uses a tensor product of basis functions from each direction fig 1 expression 11 shows that iga operates only with basis functions in the regular parameter space since transformations from the real to the transformed domain and vice versa are defined by jacobian and its inverse as in classic fem cottrell et al 2009 now the solution as the head or any other variable e g hydraulic conductivity as in this paper can also be described by expression 11 and an independent set of basis functions in the parameter space 12 u ξ η j 1 n α j φ j ξ η α j φ j ξ η isogeometric analysis iga means that the geometry and solution description use the same type of basis functions fig 1 the number and order of basis functions may not be the same in 11 and 12 in 12 spline coefficients αj can be calculated using the method of weighted residuals multiplying 8 10 with the test or weighting functions 13a ω k h w ω d ω ω q 0 w ω d ω 13b γ d h w γ d γ γ d h d w γ d γ 13c γ n q n w γ d γ γ n q n w γ d γ test or weighting functions are defined on domain 13a as well as on the dirichlet 13b and neumann 13c boundaries number of test functions should be equal to number of basis functions formulation 13 is usually called as strong formulation that requires up to the second order solution derivatives c2 continuity description of conductivity as a function defined up to the first derivatives c1 continuity and an independent set of 2 d test functions over the domain as well as 1 d test functions on dirichlet d and neumann n boundaries this strong formulation is needed for collocation c iga because the test functions are equal to the dirac functions in the selected collocation points inside the domain and along the boundaries e g shillinger et al 2013 classical galerkin g iga cottrell et al 2009 uses a weak variational formulation of the groundwater flow problem 8 10 involving the green gauss ostrogradski integration theorem in 13a 14 ω k h w ω d ω ω q 0 w ω d ω γ n q n w ω d γ γ d k h n w ω d γ weak formulation reduces the requirement for solution continuity to the c1 conductivity field to the c0 and directly involves neumann boundary conditions usually test functions in 14 are set to be zero on the dirichlet boundary as in fem in that case dirichlet boundary conditions should be satisfied by 13b or separately usually by an arbitrary function which only needs to satisfy the imposing essential boundary conditions on the dirichlet boundary the conductivity field can be a continuous spline function as in 12 but a more usual choice is a piecewise constant function at finite element or finite volume cell in common methods such as fem or modflow a detailed description of the heterogeneity representation in the strong 13 and weak formulation 14 will be given in the sequel to operate in the parameter space a derivation of jacobian and its inverse is needed related to eq 11 while boundary and other 1 d curves as well as all derivatives and elemental areas should be transformed according to the classic rules 15a j x ξ y ξ x η y η j 1 n ϕ j ξ x j ϕ j ξ y j ϕ j η x j ϕ j η y j 15b j 1 ξ x η x ξ y η y 1 d e t j y η y ξ x η x ξ 15c f l f ξ ξ l f η η l l x y 15d d ω d x d y d e t j d ξ d η 15e d e t j r x s 2 y s 2 s ξ o r η 15f n n x n y 1 det j r y s x s s ξ or η jacobian its inverse and determinant 15a b are defined only by the basis function derivatives in parameter space and control points from 11 eq 15c relates the derivatives between the parameter and physical space the jacobian determinant is crucial for 2 d integration 15d in the physical domain operating only in a parametric space any integration along the 1 d curve part of the neumann and dirichlet boundary or control volume boundary inside the 2 d domain can be considered in an analogous way together with its determinant 15g and normal 15f note that in this paper 1 d integration is only needed in the direction of two axes in the parameter space substituting 11 for the geometry 12 for the head solution and 15 for parameter space operations in 13 or 14 the strong or weak variational formulation in the parameter space can be obtained the choice of test functions determines the type of method spline basis functions as test functions represent the galerkin formulation standard g iga see cottrel et al 2009 while constant unit functions on the chosen control volumes subdomains represent control volume formulation cv iga malenica et al 2018 a detailed description of all these formulations and treatment of boundary conditions will be presented in the sequel what can iga contribute to the groundwater flow modeling in heterogeneous porous media compared with fem except for an exact description of the geometry iga uses higher order spline basis functions that enable the desired order of continuity eliminating case in fem discontinuities for zero and first velocity derivatives inside the domain or strictly speaking in fem terminology on interfaces between elements another property is the application of different strategies for construction of adaptive procedures such as lr splines or hierarchical b splines to describe variables with different resolution levels enabling the multiresolution approach e g vuong et al 2011 or bekele et al 2016 finally the description of heterogeneity as a linear combination of spline basis functions in multiresolution way gotovac et al 2009a makes iga and generally spline based methods promising tool for groundwater flow modeling in heterogeneous porous media 3 2 multiresolution spline representation of the hydraulic conductivity field in this paper we will develop a heterogeneity description closely related to its physical definition and in situ measurements it is well known that heterogeneity of porous media is defined from the pore scale to some larger macro scale a fundamental concept of the representative elementary volume rev said that it is the smallest volume consists of a certain number of pores and grains that can be represented by the average value of porosity or hydraulic conductivity in terms of a continuous function rev is a scale larger than the pore scale but significantly smaller than the macro scale groundwater flow problem 8 10 is defined on the rev scale due to complex geological conditions of heterogeneity development over a long time period heterogeneity can be defined at all scales larger than rev each larger scale includes some effects related only to that scale and changes the representative average value at some certain location on the other side our equipment always requires a certain scale and the obtained measurements represent an average value on that scale moreover different hydrogeological hydraulic and geophysical measurements give different average values on different scales finally modeling of groundwater flow and transport often require definitions of different scales all these reasons require that the heterogeneity description should be presented by the multiresolution framework described in this section in this paper we will assume that any hydraulic conductivity correlated field defined by the average value variance and correlation length in the classic geostatistical way rubin 2003 can be presented by a continuous function this is in accordance with gotovac et al 2009a who described the hydraulic conductivity field as a continuous function by fup collocation transform fct to develop the control volume framework we will present a derivation of cv iga that retains all the desired properties of the fct the basic difference between the two approaches lies in the fact that the fct satisfies the function values exactly in the collocation points while the cv iga satisfies the cell average function value using an averaging process on the appropriate control volumes cells therefore cv iga has a more fundamental concept closely related to the definition of heterogeneity scales and real measurements of conductivity supporting the rev concept and scale dependent processes the hydraulic conductivity function k x y is usually spanned by values which mutually differ by many orders of magnitude therefore direct approximation of k x y can produce numerical oscillations and negative unphysical values for small k values it is more feasible to approximate the log conductivity field y lnk see gotovac et al 2009a because that field is more regular usually with values ranging from 2 to 25 and always produces a strictly positive conductivity approximation k expy for example 2 d multi resolution expansion of the log conductivity function in the parameter space can be expressed in the following way 16 y ξ η j 0 j k k 1 z j k d k j ψ k j ξ η where j shows the resolution level from chosen zero to a maximum level jk needed for the fup b spline presentation 16 dk j are fup b spline coefficients ψk j are fup b spline basis functions zj k is the number of basis functions at level j and k denotes the function index at the current level j the zero level is the starting coarsest level that is always present in the grid fig 2 shows one example of the zero level with 25 internal fup2 basis functions with vertices inside the domain and 24 boundary fup2 basis functions with vertices along the domain boundary each basis function is obtained as a tensor product of the related basis functions from each direction and represented by symbols circles and squares which presents the greville point location greville coordinates in each direction can be found using the well known relation for b splines of n th order according to the knot vector ξ ξ1 ξ2 ξk n 1 17 g i ξ i 1 ξ i n n greville points coincide with vertices of n th order basis functions if the vertex location is located at least n 1 2 characteristic intervals from the boundary greville points are located also on the boundary and they do not coincide to the vertices of the internal basis functions which are located closer than n 1 2 characteristic intervals from the boundary we use the same greville points for fup basis functions of the n 1 th order as for the b splines of the n th order because fup basis functions have one more characteristic interval see supplementary material the characteristic interval at each level for each direction is equal to the scale or distance between the adjacent internal vertices in the parameter space see fig 1 it is also dimension of the parent element 18 δ ξ j 1 2 j m i n x j δ η j 1 2 j m i n y j where jminx and jminy are the resolutions in both directions at the zero level jminx jminy 2 in fig 2 for the collocation framework a crucial step is the choice of locations of collocation points the classic choice is the vector of greville points that leads to a stable and convergent solution e g gotovac et al 2007 2009a shillinger et al 2013 since the control volume framework can be regarded as a subdomain collocation framework the choice of locations and dimensions of control volumes also becomes a crucial step for approximation of heterogeneity representation 16 for each basis function only one control volume is related to the corresponding greville point and defined as the rectangle in the parameter space with sides boundaries at half distance between the neighboring greville points or at the boundary fig 2 dashed rectangles therefore control volume approximation at the zero level needs to satisfy the cell average value of function 16 for each corresponding control volume cell 19 d k 0 1 a l 0 ω l 0 ψ k 0 ξ η d a l 0 1 a l 0 ω l 0 y ξ η d a l 0 k l 1 z 0 k where k denotes index of basis functions while l denotes index of control volumes al 0 is the area of the control volume cell formally we write it in both sides of 19 to emphasize that right side represents average value on the other side that area is not actually calculated system 19 yields fup or b spline coefficients at the zero level log conductivity field on the right side can be known rare case interpolated from direct measurements or can be generated by stochastic random generators based on geostatistical analysis every next resolution level j includes two times more internal basis functions in each direction with two times smaller compact support and control volume cells eq 18 note that smaller scales at higher levels involve higher frequencies and detailed approximation properties which are particularly important for zones with large log conductivity gradients for the first and every next level the algorithm should only satisfy the cell average residual between the known conductivity and its previous level approximation on control volumes 20 d k j 1 a l j ω l j ψ k j ξ η d a l j 1 a l j ω l j y ξ η y j 1 ξ η d a l j k l 1 z j k al j is the area of the control volume cell at level j non symmetric system 19 or 20 is efficiently solved at each level using the gmres generalized minimal residual solver and schwartz preconditioner gotovac et al 2009a the obtained fup b spline coefficients at higher levels describe only the log conductivity contribution or residual related to that level or scale the procedure is repeated until the residual is less than the prescribed threshold in all cells at some higher resolution level or a maximum level is reached in this way the hydraulic log conductivity is described in a multiresolution way fig 3 presents the multiresolution cv iga description of the conductivity field generated by hydrogen bellin and rubin 1996 at the fourth level as a set of discrete cell average values 128 128 squares fig 3f the lnk variance is eight while four cells cover the correlation length of the exponential variogram structure the coarsest zero level 8 8 fig 3a describes only the global conductivity patterns while higher levels fig 3b e capture finer heterogeneity scales the final fourth level fig 3e exactly reproduces the heterogeneity patterns in control volume sense generated by hydrogen fig 3f note that this procedure should be repeated for all components of the conductivity tensor implying that each component is described by an independent continuous function 16 gotovac et al 2009a used the collocation procedure via fct to obtain an adaptive grid and remove all collocation points at higher levels that do not significantly contribute to the log conductivity representation 16 however new research in the iga community presents more efficient algorithms two promising directions for adaptive algorithms apply truncated hierarchical b splines and t splines e g hennig et al 2017 which can include all important different scales in different spatial zones to accurately describe log conductivity 16 in this paper we apply only the multiresolution representation of the conductivity field gotovac et al 2009a while fully iga adaptive algorithms can be developed in future contributions 3 3 three iga formulations 3 3 1 galerkin iga g iga g iga uses weak formulation 14 and spline basis functions as test functions directly satisfying neumann boundary conditions dalcin et al 2016 in classic fem dirichlet boundary conditions are satisfied by imposing solution values in the finite element nodes since classic fem uses lagrangian basis functions which are collocated in finite element nodes higher order spline basis functions in iga do not possess such a kronecker property because there are always few non zero basis functions at each point on the dirichlet boundary the basic iga approach performs construction of an arbitrary function that exactly satisfies the dirichlet boundary conditions cottrell et al 2009 then the weak formulation 14 directly satisfies neumann conditions and homogeneous dirichlet boundary conditions implying that test functions in 14 must be zero on the dirichlet boundary in this paper we formulate a strong treatment of boundary conditions to formally have the same approach for all three iga formulations therefore we use the collocation approach for basis functions with greville points on the dirichlet boundary in such a way that spline approximation 12 exactly satisfies the dirichlet boundary conditions in these points it means that in 13b the dirac delta function is used for the test function on the dirichlet boundary bazargan lari 2014 substitution of 11 12 15 and 16 in weak formulation 14 and dirichlet boundary conditions 13b yields the final g iga formulation 21 α k j 0 1 0 1 k ξ φ k j φ l j detjd ξ 0 1 0 1 q 0 φ l j detjd ξ 0 1 q n φ l j det j n d t n k l z j ξ l j ω γ d 22 α k j φ k j ξ l j h d ξ l j k l z j ξ l j γ d where j is the current resolution level while subscript l denotes raw of matrix and index of test functions while k denotes column of matrix and index of basis functions conductivity 16 is obtained by cv iga as explained in the previous subsection system 21 22 independently of log conductivity resolution 16 at any resolution level j is non symmetric due to 22 and it is solved by gmres with the schwartz preconditioner as explained in gotovac et al 2009a g iga usually spends significant cpu time for assembling system 21 22 the numerical integration in 21 can be performed by classical gauss numerical integration cottrell et al 2009 fig 1 shows that the knot vector in each direction defines the distribution of parent elements at the patch subdomain rather than performing gauss integration in 21 over the whole patch regarding the basis and test functions as global functions it is more feasible to apply integration on the parent elements in that case analogy between iga and fem is complete gauss integration over parent elements creates the local stiffness conductance matrix assembling means that members of the local matrices are placed into the global matrix 21 using the connectivity list similar to the classic fem procedure this assembling concept is a main reason why many scientists and engineers describe g iga as a spline fem however groundwater flow modeling in heterogeneous porous media involves hydraulic conductivity as a very demanding function for numerical integration in 21 classic fem regards hydraulic conductivity as a piecewise element constant function implying that the numerical integration in 21 depends only on the basis function derivatives and jacobian components 15a and 15b it is also possible to set the same for hydraulic conductivity in iga for the parent elements however if we regard hydraulic conductivity as a continuous function 16 and use different basis functions and resolution levels for conductivity and head then the numerical integration in 21 can be more demanding especially for high heterogeneity and cases where head resolution levels are coarser than conductivity resolution due to large conductivity gradients over the integration parent element one practical approach is dividing the parent element in 21 into sub elements of the same size as a conductivity resolution since at least four parent elements should cover the conductivity correlation length integration in 21 needs to respect the conductivity resolution so that integral functions stay sufficiently smooth especially in highly heterogeneous cases finally g iga is the computationally expensive concept due to numerical integration of the conductance matrix 21 22 as well as the large number of non zero matrix members in each row 2n 3 ndim for fup and 2n 1 ndim for b splines if ndim represents the dimensionality of the problem and n is the order of basis functions note that there are other more advanced optimal numerical integration concepts for g iga for example see barton and calo 2015 or calabro et al 2017 3 3 2 collocation iga c iga c iga is a very promising alternative to the classic iga galerkin formulation in terms of computational cost and efficiency e g auricchio et al 2010 shillinger et al 2013 as noted earlier test functions for c iga are dirac functions that eliminate the integration procedure to calculate the stiffness conductance matrix using the strong formulation in 13 substituting the dirac test functions in 13a c the collocation formulation at each resolution level has a very simple form satisfying the differential flow eq 13a in the interior greville collocation points as well as the dirichlet 13b and neumann 13c boundary conditions in the boundary greville collocation points e g gotovac et al 2009a shillinger et al 2013 see fig 2 23a α k j k ξ l j φ k j ξ l j k ξ l j 2 φ k j ξ l j q 0 ξ l j k l z j ξ l j ω γ d γ n 23b α k j φ k j ξ l j h d ξ l j k l z j ξ l j γ d 23c α k j k ξ l j φ k j ξ l j n ξ l j q n ξ l j k l z j ξ l j γ n special attention needs to be devoted to the neumann boundary conditions in very complex domains de lorenzis et al 2015 namely strong satisfaction in 23c can lead to numerical instabilities problem can be solved by using the hybrid collocation replacing 21 with 21c or introducing penalty method de lorenzis et al 2015 since we are more interested in this paper to the heterogeneity effects than in complex geometry issues classical c iga formulation 23 is considered conductivity 16 is obtained by cv iga enabling evaluation of the zero and first conductivity derivatives in the collocation points system 24 is also non symmetric and is solved by gmres as in the galerkin case the first derivatives of basis functions in 23 are evaluated in the same way as in 21 while second derivatives in the expansion form involve many more factors in the parameter space see kozulić and gotovac 2000 gotovac et al 2009a used the same strong formulation 23 in only the physical domain without geometry transformations 11 they analyzed the heterogeneity influence in strong formulation 23 and presented that expression 23a is indeed the collocation form of the advection dispersion equation where the conductivity first derivatives act as velocity while conductivity plays the role of dispersion in highly heterogeneous porous media conductivity gradients are usually significantly larger than conductivity and the groundwater flow problem becomes an advection dominated problem implying that c iga will be faced with numerical oscillations and instabilities gotovac et al 2009 found that the collocation algorithm is accurate only if the consequent grid peclet number is reduced implying the application of a denser grid for head than for conductivity 16 in the case of high heterogeneity novel research also shows that de lorenzis et al 2015 hansen 2016 gomez and de lorenzis 2016 franherdorf et al 2017 greville collocation points are not the best collocation points and super convergent points can be found to yield near galerkin optimal convergence and accuracy such improved collocation formulation can be competitive with cv iga formulation which will be shown in the sequel despite this shillinger et al 2013 proved that c iga 23 can be competitive with g iga in terms of computational cost and accuracy criteria especially for higher order spline basis functions therefore due to all mentioned reasons we will include classical c iga 23 in this paper as a candidate for solving the groundwater flow problem in heterogeneous porous media 8 10 finally c iga is significantly cheaper than g iga due to the absence of numerical integration of the conductance matrix as well as a significantly smaller number of non zero matrix members in each row n 1 ndim for fup and n ndim for b splines if ndim represents the dimensionality of the problem and n is the order of basis functions 3 3 3 control volume iga cv iga the iga framework offers the application of many possible methods involving strong 13 or weak 14 formulations different choices of spline basis and test functions or treatment of boundary conditions in fluid mechanics the finite volume method is very popular due to its simplicity and mass conservation properties particularly modlfow harbaurgh 2005 see also the open parallel and unstructured finite volume code pflotran hammond et al 2014 is well known as the most popular solver for flow in heterogeneous porous media modflow is based on the mass balance of boundary fluxes at each cell or finite control volume fluxes are obtained using the darcy law 1 and the finite difference operator for hydraulic gradient using the neighboring head cell values this solver is very stable even for highly heterogeneous porous media and presents the state of the art in this field e g de dreuzy et al 2007 naturally the modflow properties imply that a novel higher order control volume solver can be created using iga and spline basis functions it is important to note here that such a novel finite control volume method will have many additional properties in comparison with modflow indispensable for groundwater flow modeling in heterogeneous porous media a this method is not the classic finite volume method ferziger and peric 2002 because the head is not the piecewise cell average value and the velocity is not a linear discrete interpolation from the cell boundary fluxes rather here head solution 12 is a continuous function described by a linear combination of fup b splines basis functions and velocity is simply obtained by 1 12 and 16 as a continuous function this method is more related to the control volume finite element method by patankar 1980 or baliga and patankar 1983 cai et al 1997 b velocity derivatives are also continuous functions due to smoothness and continuity of fup b spline basis functions up to the desired order that is important for derivation of velocity dependent dispersion tensor and consistent random walk simulations c heterogeneity is described by 16 as a continuous function describing all heterogeneity scales contrary to the piecewise cell constant representation d geometry is exactly described in the isogeometric cad system and e the method enables high order convergence properties and obtained accuracy as well as more efficient adaptive refinement strategies e g vuong et al 2011 recently malenica et al 2018 developed such control volume formulation inside the iga framework and applied it to the groundwater flow analysis in the karst aquifers therefore in this paper we apply here an cv iga concept in heterogeneous porous media as well as special treatment of boundary conditions first we need to introduce the control volume framework to solve differential flow eq 8 the domain is divided by control volume cells as in fig 2 which is an example of some chosen resolution level the gauss divergence theorem should be applied on each cell 24 ω d i v q d ω ω γ q n d γ introducing 24 to 8 yielding 25 ω γ q n d γ ω q 0 d ω this formulation is reduced to the mass balance between discharges through the cell boundaries and pumping recharge as an external loading over the cell where n is external normal vector applying darcy law 1 to the mass balance eq 25 for each cell control volume 26 γ k h n d γ ω q 0 d ω comparison of 26 to the weak formulation 14 leads to the conclusion that control volume formulation 26 can be regarded as weak formulation 14 with constant piecewise test functions unit on control volume elsewhere zero first we choose the explained strategy in section 3 2 and define control volumes around the corresponding the greville points in such a way that the control volume in the parameter space is defined as a rectangle with sides at a half distance between the neighboring greville points or at the boundary fig 2 dashed rectangles with four sides r 1 4 non overlapping control volumes based on greville points cover the whole domain implying exact satisfaction of the local and global mass balance introducing 11 12 15 and 16 in 26 the mass balance flow equation is formulated at each control volume in the parameter space 27 α k j r l 1 4 γ r l k φ k j n d e t j r l d t r l ω l q 0 d e t j d ξ l γ n l q n d e t j n l d t n l where k is the subscript for index of basis functions and l represents index of control volumes due to weak formulation neumann boundary conditions in 27 are satisfied in the same way as in g iga dirichlet boundary conditions can be solved similar as in two previous formulations 13b 22 or 23b except that now test dirichlet boundary function is unit function on that boundary control volume part of dirichlet boundary with end points at half distance between neighboring boundary greville points see fig 2 elsewhere is zero in that case eq 13b is represented in the parameter space as follows 28 α k j γ d l φ k j det j d l d t d l γ d l h d det j d l d t d l control volume system 27 28 requires more operator evaluations per degree of freedom than c iga due to numerical integration over boundaries of control volumes and therefore the computational cost for cv iga lies between g iga and c iga cv iga has n 3 ndim for fup and n 2 ndim for b splines of non zero matrix members in each row if ndim represents the dimensionality of the problem and n is the order of basis functions and requires numerical integration of ndim 1 control volume boundary integrals that are much more cheaper than g iga special attention should be devoted to the consideration of local global mass balance on control volumes weak formulation 27 shows that local mass balance is satisfied exactly on interior control volumes with respect to the obtained cv iga velocity field and fluxes on cv boundaries see next section 3 4 and spline representations 11 12 and 16 however it is not the case with boundary cv s for neumann cv boundary local mass balance in 27 is obtained with respect to the given flux in 13b it means that cv iga flux on neumann boundary is not the same as the given flux in 13b it is well known consequence of weak satisfaction of neumann boundary conditions however as discretization goes to zero calculated cv iga neumann boundary flux should be converging to the given flux 13b similarly calculated cv iga dirichlet boundary flux satisfies weak imposition of dirichlet essential boundary conditions 28 but does not ensure local mass balance on boundary dirichlet cv s therefore after obtaining cv iga solution from system 27 28 it is needed to calculate dirichlet boundary flux as outer boundary flux which ensures mass balance on dirichlet boundary cv s using other known interior fluxes as postprocessing step once again as discretization goes to zero outer boundary flux should be converging to the cv iga dirichlet boundary flux finally global mass balance is obtained between neumann given boundary flux 13b calculated outer dirichlet boundary flux and pumping recharge given from the right side of 27 as discretization goes to zero calculated spline boundary fluxes are also in the global mass balance with pumping recharge these considerations are similar as in classic fem and iga due to used weak formulation 14 moreover cv iga in comparison to c iga has two important advantages because it exactly satisfies the local and global mass balance and considers flow problem 8 10 as the diffusion problem which means that cv iga can solve 27 28 without numerical oscillations for a wide range of heterogeneity enabling a higher convergence order and better accuracy non symmetric system 27 28 and the numerical integration are solved as the previous two iga formulations using the gmres solver and gauss numerical integration 3 4 velocity field without loss of generality we will show here the calculation of the velocity field for a 2 d isotropic porous media according to the darcy law 1 as well multiresolution representation of hydraulic conductivity 16 and head 12 calculation of the velocity has the following form 29 q s x y e x p j 0 j y k 1 z j y d k j ϕ k j x y j 0 j h k 1 z j h α k j φ k j x y s s x y fup b spline basis functions within iga obtain velocity components and all its derivatives as smooth and continuous functions see gotovac et al 2009a supplementary material in 29 it means that the iga for all three formulations yields velocity field 29 with all the mentioned desired properties indispensable for reliable transport simulations a consider heterogeneous hydraulic conductivity as a continuous function resolving all spatial heterogeneity scales b yields continuous velocity field which implies reduction of numerical dispersion c yields continuous derivatives of the velocity field which enables rigorous treatment of the velocity dependent dispersion tensor for random walk transport simulations additionally cv iga satisfies the local and global mass balance property on the velocity field avoiding loss adding of mass in transport simulations 4 results and discussion 4 1 flow problem in 2 d uncorrelated heterogeneous porous media with pumping this example will show verification of cv iga using low order fup1 basis functions with respect to the classical methods modflow and fem verification test is taken from the modflow report mehl and hill 2005 it is 1260 m long and 1350 m wide has constant head boundaries of 10 m and 1 0 m on the left and right sides respectively no flow boundaries extend across the top and bottom fig 4 a pumping well extracts 5 5 m3 s from the center of the domain the heterogeneity structure was constructed using five transmissivity t zones randomly distributed throughout the domain with a spatial resolution equivalent to the coarsest zero spatial level 90 90 m as shown in fig 4a five levels of heterogeneity are considered they begin with a homogenous case t 0 25 m2 s for all zones then the contrasts of the transmissivities represented by each zone are increased four times until the heterogeneity structure has a variance of lnt of approximately 3 61 and a range of approximately three orders of magnitude in that way five heterogeneity sequences are generated with lnt variances of 0 0 05 0 64 1 96 and 3 61 fig 4b presents control volume presentation cv iga of heterogeneous distribution defined in fig 4a previously explained in the section 3 2 classical methods regard heterogeneity as piecewise constant field on control volume cell grid modflow or finite element mesh fem presented in fig 4a cv iga considers it as continuous function fig 4b satisfying constant control volume values fig 4a according to the system 19 although there is no correlation because five heterogeneity zones in fig 4a are randomly distributed over the domain cv iga heterogeneity presentation is a smooth function with the same geostatistics as classical modlfow or fem presentation head solution is defined on many resolution levels starting from the coarsest zero level 90 90 m with 210 control volumes presented on fig 4a to the finest 6 th level 1 40625 1 40625 m with 860160 control volumes heterogeneity distribution is always defined on zero level according to the fig 4a and 4b fig 5 a presents head flow solutions for homogeneous case while fig 5b for the most heterogeneous case with a variance of lnt of approximately 3 61 head cv iga solution is presented on the finest 6 th resolution level it is compared with classic modflow solution mehl and hill 2005 based on the cell centered finite difference algorithm which can also be regarded as control volume solver homogeneous solutions are almost identical fig 5a while significant differences between solutions exist for highly heterogeneous case in fig 5b which can be associated to the different formulations but also to the different approximations of the lnt field in fig 4 moreover both solutions follow heterogeneity patterns in the same way but there are zones with larger head differences however deeper analysis requires convergence properties of these solutions since the head solution is refined over six higher resolution levels than the heterogeneity resolution level convergence log log plots are presented for all heterogeneity levels and cv iga in fig 6 a the x axis presents discretization length δx δx δy the same in both directions while the y axis denotes l1 norm of head numerical error for each head resolution level l1 norm is defined through the definition of the p norm lp εj p 1 p p 1 and calculated on the 7 th resolution level higher than the maximum used 6 th head level head numerical error ε at each resolution level j is defined as a difference residual between head solution on that level j and previous level j 1 indeed head error is computed by solving the system 27 28 convergence rate p can be calculated using the empirical expression εj εj 1 2p in log log scale it is transformed to the following log εj εj 1 p log2 p log δx j δx j 1 therefore in log log plot in fig 6a convergence rates p are presented as slopes of calculated lines cv iga obtains optimal quadratic convergence rate p 2 for all heterogeneity levels due to smooth and continuous presentation of heterogeneity as well as for head derivatives therefore calculated velocity according to the expression 29 is continuous and smooth field without any artificial numerical velocity variations on the other side fig 6b shows that it is not the case with two other classical methods a modlfow and b fem solution with linear basis functions we used here g iga algorithm section 3 3 1 with b1 basis functions but heterogeneity distribution is replaced by piecewise constant field according to the fig 4a mehl and hill 2005 reported that modlfow can obtain optimal quadratic convergence rate in homogeneous and very low heterogeneous case higher heterogeneity introduces larger lnt discontinuities causing the well known numerical consequence that convergence rate becomes suboptimal although head resolution level is very high discontinuities between different heterogeneity zones cannot be resolved without loose of accuracy moreover mehl and hill 2005 presented that also adaptive mesh refinement cannot improve modflow convergence rate the same consequence appears in fem algorithm where additionally discontinuities of head derivatives between finite elements degrades convergence rate as it was presented many times in the literature among others in cainelli et al 2012 in conclusion cv iga in comparison with classical methods such as modflow and fem enables optimal convergence rate with continuous velocity approximation without numerical dispersion 4 2 flow problem in 2 d correlated heterogeneous porous media under mean uniform flow conditions 4 2 1 flow realizations with cv iga to verify the cv iga methodology with other iga methodologies we use a classic benchmark for the flow in multi gaussian heterogeneous porous media under mean uniform flow conditions e g bellin et al 1992 gotovac et al 2009b fig 7 presents such a flow realization with an exponential variogram and two different heterogeneous lnk variances one fig 7a and eight fig 7b on a relatively large domain defined in the dimensionless correlation coordinates lx iy ly iy 64 32 hydraulic conductivity is generated on the fourth level 256 128 cells control volumes with four control volumes per correlation length iy the boundary conditions create mean uniform flow conditions in the following way fig 7 the top and bottom boundaries exhibit no flow neumann conditions while the left and right boundaries have dirichlet boundary conditions with heads equal to 10 m and 0 m respectively fig 7 presents the hydraulic conductivity field as the filled background as well as the head red contours and velocity solution blue polylines as streamlines at the fourth level for both lnk variances the hydraulic conductivity and solution are obtained by cv iga the homogeneous media yield a uniform flow solution with linear distributions of the head and horizontal streamlines heterogeneity causes deviations in both families of curves the weakly heterogeneous porous media exhibit small heterogeneity variations implying small velocity variations and a relatively uniform flow field fig 7a the highly heterogeneous solution the lnk variance is approximately greater than three is characterized by preferential flow channels e g gotovac et al 2009b which occupy a small portion of the domain but transfer most of the total flow discharge fig 7b the flow field tends to connect higher conductivity zones using minimum flow energy fig 7 clearly shows how the velocity field becomes increasingly complex with heterogeneity variations introducing large head and velocity gradients the head can be considered for all levels independent of the conductivity resolution from the chosen zero level 16 8 cells to the maximum user defined level in this case we choose the 7 th maximum level with 2048 1024 cells using an independent linear combination of basis functions 12 the coarse zero level usually describes only the global flow pattern and each higher resolution level presents its own head residual or the particular contribution at that level higher levels include detailed velocity patterns that completely resolve the influences of all the heterogeneity scales fig 8 presents the multiresolution head solutions at different resolution levels for the log conductivity at the fourth level presented in fig 7b the multiresolution solutions directly enable measurements of the accuracy which is related to the head and or velocity residual at each level for the high lnk variance field generated at the fourth level the head solution at the second level fig 8a is in relatively close agreement with the fourth level however inside the control volumes there are zones with stagnant streamlines the control volume formulation exactly satisfies the mass balance through the cell boundaries but large heterogeneity variations at the fourth level cause a hydraulic gradient head derivatives involving artificial numerical sink source zones at the second level this is not the case for the cases with weak and mild heterogeneity where even coarser levels can produce very accurate head and velocity fields however for the case with high heterogeneity it is not possible to obtain an accurate velocity field on coarser levels fig 8b confirms that the fourth level produces a very accurate head solution because its comparison versus the fifth level shows that the difference between them is negligible for all practical purposes the head residual at the fifth level is less than 0 1 mm head is bounded in interval 0 10 m which means that we obtained a very accurate head and velocity field at the same level in which the lnk field is generated even for the high heterogeneity case 4 2 2 convergence analysis for three iga formulations the accuracy and convergence analysis results are studied in more detail in figs 9 and 10 for the head and velocity respectively all three iga formulations galerkin g iga collocation c iga and control volume cv iga are compared using the fup and b spline basis functions up to the 4 th order fig 9 presents the relationship between the discretized grid in dimensionless form the same in both directions δ x δx lx δy ly and the head residual on a log log scale for the flow realization presented in fig 7b var lnk 8 generated at the fourth level the head residual at each level j 1 7 greater than zero level is defined as the difference between the head at a particular level j and that at the previous level j 1 and the residual is obtained for all three formulations solving systems 21 22 23 and 27 28 for g iga c iga and cv iga respectively the head residual is given in the form of the l2 euclidean norm as a measure of numerical error the slopes of the simulated lines present the convergence rate p a similar analysis is performed many times for the poisson equation for g iga and c iga see among others schillinger et al 2013 hanssen 2016 in the case of a homogeneous aquifer the groundwater flow problem 8 10 is equal to the poisson equation it is well known that g iga yields the optimal convergence rate p n 1 for the poisson problem if n is the order of the fup or b spline functions fig 9a d confirms that this result still holds true even for the high heterogeneity case var lnk 8 and higher order basis functions up to the 4 th order according to the fig 6 in this subsection only highly heterogeneous case is analyzed because all results are valid irrespective to the heterogeneity level c iga yields a suboptimal convergence rate p n for even basis functions and p n 1 for odd basis functions c iga is a computationally cheaper and more efficient algorithm than g iga however it suffers from three basic drawbacks 1 an optimal convergence rate is absent and therefore the accuracy is reduced 2 c iga regards the groundwater flow problem as an advection dispersion equation through the strong formulation see section 3 3 involving numerical oscillations and instabilities for high heterogeneity cases especially at head levels coarser than the fourth lnk level 3 there is no local or global mass balance due to the point collocation nature of the algorithm gomez and de lorenzis 2016 proved that greville collocation points are not optimal convergence points for the poisson problem rather they found superconvergent collocation points which yield an optimal convergence rate for odd basis functions p n 1 but for even basis functions the convergence rate is not optimal p n the reason for this phenomenon is still not well understood moreover in this paper we use fup and b spline basis functions which have a different number of characteristic intervals nevertheless the problem is still polynomial order dependent cv iga lies between g iga and c iga with respect to computational efficiency as well as accuracy as shown in fig 9 fig 9 shows that the convergence rate for cv iga is optimal p n 1 for odd basis functions and suboptimal p n for even basis functions the same as c iga with superconvergent collocation points once again the mystery for even basis functions is also present for cv iga fig 9a shows that for n 1 the convergence rate p 2 is optimal for g iga and cv iga when g iga uses b 1 splines basis functions are the same as lagrangian 1 d linear fem basis functions contrary to the example in section 4 1 g iga obtains optimal convergence rate due to continuous heterogeneity approximation there are no collocation results because c iga requires at least c2 continuity or continuous second order derivatives that are satisfied with fup2 or b3 basis functions fig 9b d presents the convergence results for higher order basis functions due to the reduction in the convergence order c iga and cv iga are less accurate than g iga for even orders however cv iga is approximately few orders of magnitude more accurate than c iga for odd order basis functions cv iga has the optimal convergence rate with accuracy very close to that of g iga fig 10 presents the convergence and accuracy analysis for the velocity 29 calculated from the darcy law 1 generally c iga yields the optimal convergence rate p n for even basis functions and a suboptimal convergence rate p n 1 for odd basis functions cv iga yields the same optimal convergence rate as g iga p n for all orders of basis functions and has very close results to g iga cv iga is two orders of magnitude more accurate than c iga for even basis functions and is much more accurate for odd basis functions for g iga and cv iga with b1 splines fig 10a we calculate the velocity closely related to the classic fem and modflow analysis b1 splines have c0 continuity and are not well suited for second order problems therefore the modflow velocity calculation uses cell averaged boundary velocities and performs a linear approximation at each cell from four boundary cell velocities e g de dreuzy et al 2007 fem also uses the postprocessing procedure as a linear velocity approximation from the velocities taken from central element gauss points caineli et al 2012 in that case the enhanced convergence rate for the velocity is two but requires additional cpu time due to the additional velocity approximation in comparison with the classic iga however the classic modlfow and fem techniques cannot describe continuous velocity derivatives due to the reduced c1 continuity of the velocity approximation in order to fully describe the velocity dependent tensor iga needs to use at least fup2 or b3 basis functions cv iga presents the best candidate velocity approximation for groundwater flow modeling in heterogeneous porous media due to the following it has the optimal convergence rate its accuracy is very close to that of g iga it has a substantially smaller computational cost and greater robustness than g iga and it satisfies the local and global mass balance and stability in comparison with c iga fup basis functions are more accurate than b splines for the same order due to their enhanced continuity and better approximation properties but they have one more characteristic interval for the same order of basis functions implying a more expensive cost to solve the linear system of equations for both basis functions convergence rate depends of their polynomial order in conclusion the presented results for highly heterogeneous porous media var lnk 8 prove that the convergence rates are identical as a pure poisson problem for a homogeneous domain regardless of the heterogeneity variance 4 2 3 stochastic analysis in order to stochastically verify presented methodology using the hydrogen random generator rubin and bellin 1996 100 numerical realizations are generated for the same setup and domain as in fig 7 lnk head and velocity are obtained at fourth resolution level and nine lnk variances 0 25 1 2 3 4 5 6 7 and 8 cv iga is compared to the g iga and afcm gotovac et al 2009a which is equivalent to the c iga for regular geometry such as in this example additionally all three iga formulations are compared to the classic modflow solution de dreuzy et al 2007 we selected dimensionless velocity variance as indicator of solution accuracy and recall the collocation results of afcm gotovac et al 2009b in both directions 30 σ v x 2 u 2 3 8 σ y 2 1 376 875 σ y 2 0 175 31 σ v y 2 u 2 1 8 σ y 2 1 328 535 σ y 2 0 535 where u is an average velocity fig 11 confirms that cv iga yields similar results as in 30 31 that is obtained from the equivalent afcm algorithm gotovac et al 2009b to c iga moreover cv iga is also similar to g iga which is expected due to fig 10 implying very good agreement between all three iga formulations de dreuzy et al 2007 used the finite volume classic modflow algorithm which obtains smaller transversal and higher longitudinal velocity variance than cv iga however all stochastic solutions are in close agreement confirming verification of the cv iga with earlier published stochastic results 4 2 4 computational efficiency convergence analysis in the subsection 4 2 2 and figs 9 and 10 presented accuracy issues however the computational efficiency needs to be explored according to the convergence analysis in subsection 4 2 2 we choose highly heterogeneous example from the fig 7b as mentioned earlier in the section 3 c iga is computationally cheaper method than g iga with respect to the number of quadrature integration points and number of non zero matrix elements cv iga lies between these two methods table 1 summarizes these considerations for all three iga formulations c iga requires only one integration point which is located in the greville collocation point cv iga requires 1 d integration on four control volume boundaries since the control volume boundaries are shared by neighboring control volumes cv iga requires nearly 1 d integration on two cv boundaries per control volume on the other side g iga performs 2 d integration on each parent element numerical integration is performed with 3 gauss points in each direction in order to ensure high order polynomial integration fifth order which is higher than the maximum order of the used basis functions for example for fup2 basis functions cv iga has 25 non zero matrix elements in each row and 6 gauss points per control volume g iga has 49 non zero matrix elements in each row and 9 gauss points per parent element while c iga has only one collocation quadrature point and 16 non zero matrix elements in each row evidently table 1 indicates that c iga is computationally relatively cheap while g iga is very expensive especially for higher order basis functions n 2 therefore cv iga combines advantages of c iga in terms of formulation simplicity and computational efficiency and g iga in terms of robustness and computational accuracy these considerations are shown in fig 12 in terms of cpu time and accuracy for fup2 and fup4 basis functions for fup2 basis functions g iga is still more efficient than c iga fig 12a for higher order fup4 basis functions situation is opposite although g iga significantly outperforms c iga in terms of accuracy figs 9 and 10 computational cost of c iga is very low and cpu time is smaller for the same obtained accuracy than g iga this behavior is also obtained for poisson and elasticity problem in schillinger et al 2013 reasons for this inversion of computational efficiency lie in significantly smaller number of non zero matrix elements for c iga where linear system of equations is less expensive moreover for larger problems and higher order fup4 basis functions numerical integration and generation of system of equations also require significant amount of computational cost for g iga on the other side c iga practically has no cpu time for matrix system generation cv iga requires more time than c iga for matrix system generation but its system of equations is not as expensive as g iga therefore cv iga computational efficiency in terms of cpu time lies between other two iga formulations non symmetric linear system of equations is solved at each head resolution level using the gmres solver and schwartz preconditioner gotovac et al 2009a dependence of number of gmres iterations and resolution levels is presented in table 2 solver is a relatively efficient for all iga formulations except for the highest 7 th head resolution level more than 2 million degrees of freedom where cpu time and number of gmres iterations are drastically increasing therefore indicator of computational cost is also number of gmres iterations which confirm relationship between all three iga formulations finally b splines are more efficient than fup basis functions in sense of computational cost b splines of n 1 th order have the roughly the same computational cost as fup basis functions of the n the order in terms of cpu time and number of gmres iterations 4 2 5 irregular geometry and significance of higher order basis functions in order to show additional application of cv iga to the description of flow in heterogeneous porous media in the complex geometry for the heterogeneity representation from the fig 7b var lnk 8 flow domain is transformed to the l shape now left and lower boundaries have dirichlet boundary conditions hleft 10m and hlower 0m while other two boundaries are no flow fig 13 a presents the classical l shape benchmark test case it means that only shape of the flow domain is changed while all other parameters including the heterogeneity description is maintained l shape domain fig 13 cannot be described by only one patch if we use open uniform knot vector two patches are used but there are two discontinuity points in two corners denoted by points a and b in fig 13 because there is no unique normal in these points moreover continuity between patches in terms of jacobian terms 15 a and b are violated note that different approaches for gluing of patches are presented in the literature among others buchegger et al 2016 but it is beyond of the scope in this paper flow solution in l shape domain is presented in fig 13a flow patterns in terms of headlines and streamlines follow behavior as in fig 7 for rectangular domain l shape flow test case exhibits well known numerical problems in this classical fluid mechanics benchmark containing two mentioned corner singular points where velocity in both directions has discontinuity two bilinear no flow boundaries are also two streamlines however neighboring streamlines cannot satisfy no flow boundary conditions close to the singular points as discretization decreases problematic zones around corners are smaller fig 13b presents convergence analysis for l shape problem contrary to figs 9 and 10 for smooth rectangular flow problem in case of l shape domain due to singular two corners and partially jacobian discontinuity between two patches the convergence rate is reduced fig 13b higher order basis functions slightly improve the convergence rate and accuracy but it is still far from the optimal rate this behavior is not surprising because it has been shown many times in the literature for poisson problem and l shape domain in the iga context for example see vough et al 2011 or garau and vazquez 2018 fig 13b opens discussion about influence of the higher order basis functions in the iga context particularly for cv iga groundwater flow modelling these two flow examples presented in this paper prove that under the smooth representation of heterogeneity and geometry an optimal convergence rate can be obtained it is very important to emphasize here that smooth cv iga heterogeneity approximation enables optimal convergence even in case of high heterogeneity where higher order spline basis functions drastically improve accuracy and convergence rate and significantly outperform classic low order fem and fvm methods however it is well known that any singular effects in terms of heterogeneity or geometry can reduce accuracy and convergence rate fig 6b proves that for classic methods due to heterogeneity while fig 13b presents it for cv iga due to geometry description thus convergence rate p is less than two for n 1 and 2 as well as less than four for n 3 and 4 if n is order of the fup basis functions fig 13b in that case significance of higher order basis functions is significantly reduced however many results from the iga community among others see recent results of garau and vazquez 2018 proved that l shape poisson problem with singular corners can be efficiently solved only by adaptive modelling using for example hierarchical b splines in that case hierarchical basis functions at higher resolution levels are only added in regions around two corners and optimal convergence rate can be obtained for all orders of basis functions only adaptation property of b splines and corresponding iga adaptive scheme enables significant improving of solving problems with discontinuities and singularities recently our numerical group developed hp adaptive cv iga procedure with hierarchical fup basis functions kamber et al 2020 however in this paper due to smooth cv iga lnk representation our main attention is to introduce this cv iga concept to the groundwater flow modeling in heterogeneous porous media emphasizing role of heterogeneity and calculation of smooth velocity field while adaptive flow analysis leaves for the further publications we can conclude that higher order fup spline basis functions need to be involved through the adaptive iga modelling in order to solve heterogeneity or geometry discontinuities and or singularities as pumping recharge points sharp transition zones or narrow discharge areas 5 conclusions in this paper we apply the cv iga framework which yields velocity field with all the desired properties that are indispensable for reliable transport simulations consider heterogeneous hydraulic conductivity as a lnk continuous function resolving all needed spatial heterogeneity scales convergence rate for velocity is optimal p n irrespective to the heterogeneity level if correlated log conductivity field 16 is defined as a continuous function yields a continuous velocity field eq 30 without numerical errors in the form of artificial discontinuities which implies reduction of numerical dispersion and ensures optimal convergence rate contrary to the classic methods such as modflow and fem yields continuous derivatives of the velocity field which enables rigorous treatment of the velocity dependent dispersion tensor needed for random walk transport simulations in this paper three iga formulations are compared although general properties of iga formulations are similar there are also important differences between them 1 g iga has an optimal convergence rate for head p n 1 and velocity p n if n is the fup or b spline order however g iga is the most expensive iga concept due to numerical integration of the stifness conductance matrix as well as the large number of non zero matrix members in each row 2n 3 ndim for fup and 2n 1 ndim for b splines if ndim represents the dimensionality of the problem 2 c iga has a suboptimal convergence rate for head p n for even and p n 1 for odd basis functions c iga has a suboptimal convergence rate for velocity p n 1 for odd and optimal convergence rate n for even basis functions c iga is significantly cheaper than g iga due to the absence of numerical integration of the conductance matrix as well as a significantly smaller number of non zero matrix members in each row n 1 ndim for fup and n ndim for b splines the main drawbacks of c iga are the absence of local and global mass balance and numerical oscillations in case of high heterogeneity and a large peclet grid number groundwater flow problem is regarded as an advection dispersion problem in the collocation strong formulation 3 cv iga has a suboptimal convergence rate for head p n for even basis functions however cv iga has an optimal convergence rate for head p n 1 for odd basis functions more important cv iga has an optimal convergence rate for velocity p n for all orders of basis functions with an accuracy very close to g iga cv iga lies between c iga and g iga with respect to computational cost convergence and accuracy cv iga has n 3 ndim for fup and n 2 ndim for b splines of non zero matrix members in each row and requires numerical integration of ndim 1 control volume boundary integrals that are much more cheaper than g iga cv iga exclusively has a local global mass balance property in comparison with two other iga concepts considering all three iga concepts cv iga is the most powerful candidate for groundwater flow modeling in heterogeneous porous media 4 fup basis functions and b splines of the same order have the same convergence rates for all three concepts and all mentioned cases because they are closely related to the approximation properties of polynomials fup basis functions always obtain better accuracy than b splines for the same order due to enhanced continuity properties however fup are more expensive than b splines because they include one more characteristic interval for the same order the choice of basis functions depends on the problem and required continuity future research can include the development of fully space and time adaptive kamber et al 2020 iga methods for efficient modeling of flow as well as for contaminant transport or saltwater intrusion which needs to involve a velocity dependent dispersion tensor with continuous velocity field and its derivatives e g gotovac et al 2007 finally resolving of singularities due to non smooth description of for example geometry pumping recharge or heterogeneity needs to be solved by using adaptive approaches with higher order spline basis functions declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research is funded by the croatian science foundation in croatian hrvatska zaklada za znanost hrzz through the scientific project groundwater flow modeling in karst aquifers grant number uip 2013 11 8103 this research is partially supported through project kk 01 1 1 02 0027 a project co financed by the croatian government and the european union through the european regional development fund the competitiveness and cohesion operational programme supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103838 appendix supplementary materials image application 1 
350,many important groundwater transport applications require solving the darcy flow in heterogeneous porous media flow simulations especially in large highly heterogeneous aquifers require extensive computational resources a multiresolution multiscale approach to resolve the different heterogeneity scales and an accurate calculation of the velocity field common methods such as finite volumes and elements assume a discontinuous conductivity field introducing velocity discontinuities along the cell or element interfaces due to using classic discrete operators or lagrangian basis functions over the last decade the development of isogeometric analysis iga eliminates many of the aforementioned limitations bridging the gap between cad and numerical analysis since classic iga uses the galerkin and collocation approach in this paper we present a third concept in the form of c ontrol v olume i so g eometric analysis cv iga enabling local and global mass conservation as well as multiresolution description of all heterogeneity scales due to the approximation properties of spline basis functions the velocity field and its derivatives are continuous and are obtained by an optimal convergence rate the cv iga methodology is verified with 2 d numerical and stochastic benchmark flow simulations including comparisons with classic methods and two other iga formulations as well as the convergence analysis of the head and velocity fields for different orders of fup and b spline basis functions keywords isogeometric analysis iga fup basis functions b splines control volume galerkin collocation multiresolution approach groundwater flow heterogeneous porous media 1 introduction the analysis of flow in heterogeneous porous media is not only important due to water supply or interpretation of hydrogeological properties currently analyses of contaminant transport remediation or energy exploitation have become very important due to sustainable development and water resources protection realistic and reliable transport analysis requires extensive flow simulations including large domains complex geometries extensive computational burden with high parallel computing and resolving of many unfortunately especially fine heterogeneity scales finally the main input for transport analysis is an accurate velocity field that satisfies the local and global mass balance property and enables continuity of velocity and its derivatives due to the description of a velocity dependent dispersion tensor cainelli et al 2012 over the last few decades many numerical and stochastic methods have been developed to fulfil all the mentioned requirements due to scarcity of input data especially related to the hydraulic conductivity all flow and transport fields variables such as hydraulic conductivity head velocity concentration and or travel time have been regarded as stochastic random fields srf see comprehensive reviews of dagan 1989 gelhar 1993 rubin 2003 and zhang 2002 therefore many stochastic methods have been developed such as spectral methods e g gelhar 1993 perturbation methods e g dagan 1989 cvetkovic et al 1992 moment methods e g hsu et al 1996 stochastic finite element e g aguirre and haghighi 2003 or probabilistic collocation methods e g li and zhang 2007 xiu and hesthaven 2018 as well as many others most of these methods are faced with many computational and implementation problems especially in the case of high heterogeneity and large anisotropy in irregular domains despite the many desired properties of the aforementioned methodologies the monte carlo method is still the most general and reliable stochastic method which at least serves as a verification method of all the mentioned methods among others the monte carlo method has been used for flow and transport analysis in weakly and highly heterogeneous porous media by bellin et al 1992 cvetkovic et al 1992 1996 salandin and fiorroto 1998 zinn and harvey 2003 jankovic et al 2006 de dreuzy et al 2007 gotovac et al 2009b beaudoin and de dreuzy 2013 ramasomanana et al 2013 srzic et al 2013 fiori et al 2015 the monte carlo method first generates as many conditional or unconditional heterogeneity realizations of hydraulic conductivity as possible then the flow equation is solved for all realizations to obtain the velocity field that is the main input in transport simulations of for example contaminant transport the next step is solving the transport equation for all flow realizations and obtaining the plume concentration inside the domain or travel time flux breakthrough curve at some chosen control planes finally ensemble statistics for all flow and transport variables are analyzed to obtain its statistical moments correlations or probability density functions pdf s rubin 2003 however the computational heart of the monte carlo method as a stochastic methodology lies in applying the appropriate numerical techniques for flow and transport simulations in each realization in this paper we will focus on numerical flow simulations and derivation of an accurate velocity field needed for reliable transport simulations cainelli et al 2012 recently analyzed convergence and approximation properties of common numerical methods for flow analysis in heterogeneous porous media they defined common methods as the widely used finite element fem and finite volume fvm methods which regard hydraulic conductivity as a piecewise element cell constant field discontinuous field representing heterogeneity at some chosen scale the classic finite element method fem e g bellin et al 1992 divides the domain into the finite elements describing the head as a linear combination of classic lagrangian basis functions usually linear or quadratic the inherent problem of the classic fem is discontinuity of head gradients along the inter element boundaries due to the properties of lagrangian basis functions this effect in combination with the common assumption of the discontinuous conductivity field through the darcy law produces numerically unphysical velocity discontinuities variations causing additional artificial numerical dispersion and for instance inaccurate particle tracking in transport simulations these problems arise with higher heterogeneities due to larger inter element conductivity contrasts and larger velocity numerical errors classic fem can also violate local mass balance over elements the first way to overcome classic fem problems is to employ the mixed finite element mfe formulation e g mose et al 1994 where velocity is also represented by basis functions involving additional degrees of freedom and computational work in flow simulations additionally some mfe formulations can create ill posed problems another way is to perform postprocessor calculations on fem velocity fields requiring continuity of velocities between elements and or mass continuation yeh et al 1981 cordes and kinzelbach 1992 on the other side fvm methods such as modlflow formulation e g harbaugh 2005 de dreuzy et al 2007 can also be regarded as cell finite difference formulation satisfy mass balance over the cell boundaries and ensure velocity continuation normal to the cell boundaries however modflow generates discontinuities of tangential velocity components between cells it is possible to prove equivalence between modflow and mfe which uses low order basis functions canielli et al 2012 in addition of classical modflow and fem most other existing methods e g hou and wu 1997 jankovic et al 2006 vent and kitanidis 1996 or rasaei and sahimi 2009 do not support a true multiresolution approach respecting that hydraulic conductivity can be spanned by many scales gotovac et al 2009a presented a such multiresolution approach based on the adaptive fup collocation method afcm with the following crucial properties a correlated log conductivity lnk field is presented as a continuous function in a multiresolution way that can accurately describe all needed scales b independently resolves all heterogeneity and head scales c yields a continuous velocity field as well as its derivatives needed for application to realistic transport simulations with a velocity dependent dispersion tensor and d actively controls head and velocity numerical errors reducing numerical dispersion and ensuring convergence even in highly heterogeneous porous media the heart of the methodology lies in fup basis functions closely related to the b splines see gotovac and kozulic 1999 and supplementary material in conjunction with the collocation procedure however the main drawback was the lack of local and global mass balance due to the properties of the collocation framework inability to describe the general irregular geometry and computationally expensive head solution to obtain an accurate velocity field without numerical oscillations for high heterogeneity cases among others applications of the afcm have been shown for the analysis of the flow and transport in heterogeneous porous media relating to the travel time statistics gotovac et al 2009b concentration statistics srzic et al 2013 and advective transport fiori et al 2015 therefore in this paper we put desirable afcm properties to the broader context of isogeometric analysis iga initially published by hughes et al 2005 iga has attracted enormous attention by designers and modelers because it bridges the gap between computational aid design cad of irregular domains and the numerical description of physical processes on them the idea is quite simple use the same type of spline basis functions usually b splines or nurbs to describe both the geometry and solution head and velocity for our particular groundwater flow problem iga has been successfully applied in many fields of solid structural and fluid mechanics e g cottrell hughes and bazilevs 2009 it has been shown that iga significantly outperforms classical fem due to higher accuracy and enhanced continuity since classic iga uses the galerkin variation principle for solution description and transforms the physical domain to the virtual one for geometry description the apparent similarity between iga and fem has resulted in the scientific community widely accepting iga as new powerful modeling machinery spline fem in spirit iga is closely related to the meshless or mesh free methodologies due to its use of spline basis functions which enable many properties not seen in fem such as exact geometry description in cad sense no classical meshing more efficient refinement adaptive procedures and multiresolution approach higher continuity of solution and geometry and usage of higher order basis functions in addition to the galerkin weak formulation iga recently presented a collocation approach e g aurichio et al 2010 shillinger et al 2013 gomez and de lorenzis 2016 recently our numerical group developed and applied control finite volume iga formulation to the groundwater flow modeling in karst aquifers which are represented by 3 d heterogeneous porous matrix and 1 d laminar turbulent karst conduits malenica et al 2018 efficient numerical modeling using spline basis functions may not always link exclusively with iga that includes geometry transformations because everything can be performed only in the physical domain in that case spline basis functions which intersect domain boundaries must satisfy the geometry constraints and boundary conditions using for instance the rvachev solution structure method see for instance rvachev et al 2000 tsukanov and shapiro 2005 hollig et al 2003 apprich et al 2016 kozulic and gotovac 2017 recently iga has been used for solving groundwater flow problems such as filtration through the dam foundation shahrbanozadeh et al 2015 saturated flow bekele et al 2016 unsaturated flow nguyen et al 2014 or flow in fractured media hageman and borst 2019 finally in this paper using the framework of control volume isogeometric analysis cv iga the groundwater flow in heterogeneous porous media is then analyzed using two types of spline basis functions b splines and fup basis functions and compare to the common iga choices galerkin g iga and collocation c iga except geometry and solution head and velocity heterogeneity is also described by fup b spline basis functions introducing cv iga as a promising tool for more powerful flow simulations in heterogeneous porous media which enables the derivation of the velocity field with all the desired mentioned properties therefore this methodology can open new avenues for more robust and realistic simulations of tracer and contaminant transport cai et al 1997 zheng and bennett 2002 2 problem formulation this section will present brief review of mathematical and physical formulations of flow in heterogeneous porous media we assume that groundwater flow in heterogeneous porous media can be described by darcy law 1 q k h where q is the vector of darcy velocity h is the hydraulic head and k is the hydraulic conductivity symmetric tensor of the second order 2 k k xx k xy k yx k yy where kij is the tensor component which characterizes velocity in i direction under the unit hydraulic gradient in the j direction if tensor properties are equal in all directions it is an isotropic porous media otherwise the tensor represents an anisotropic porous media if the porous media contains the same conductivity tensor in all points it is a homogeneous porous media otherwise it is the heterogeneous one all real aquifers are heterogeneous and anisotropic domenico and schwartz 1998 due to lack of knowledge of the hydraulic conductivity distribution it is common practice to consider the hydraulic conductivity as a random stochastic field commonly defined by the average value variance and correlation length rubin 2003 in this paper we will assume that any hydraulic conductivity correlated field can be described by a continuous function representing all spatial scales on appropriate control volumes cells we will derive the basic equation of steady flow by applying the equation of continuity i e the mass balance law on the infinitesimal control volume with sides dx and dy thus the mass balance law on a control volume can be simple described as follows the difference between the mass that entered the control volume and that which came out of the control volume needs to be equal to the pumping recharge inside the control volume the amount of mass passing through a surface area of the control volume in the direction of the external normal per unit time is equal to the mass flux 3 q f d m d a d t ρ d v d a d t ρ q n which is equal to the product of density and darcy normal velocity component mass flux is negative in the direction of the external normal which means that the mass exits the control volume and vice versa when the mass enters the volume opposite to the direction of the external normal mass flux is positive it should be noted that the flow equation is defined for darcy s average velocity in the normal direction because the entire control surface is considered in the flow equation mass production pumping recharge within the control volume was determined by the rate q0 a its sign depends on whether it is a source plus or sink minus mathematically speaking steady 2 d flow equation can be written as 4 ρ q x d y d z ρ q x ρ q x x d x d y d z ρ q y d x d z ρ q y ρ q y y d y d x d z ρ q 0 d x d y d z 0 for incompressible fluid density is constant and 2 d flow equation is 5 q x x q y y q 0 0 in the reduced form it is written as 6 div q q 0 0 which defines that divergence of darcy velocity over the control volume is the equal to the mass production inside it the final form of the steady state flow equation is obtained by combining the mass balance on the infinitesimal flow parcel 6 darcy s law 1 and hydraulic conductivity tensor 2 7 x k xx h x k xy h y y k yx h x k yy h y q 0 0 eq 7 is valid for 2 d heterogeneous and anisotropic porous medium if principal axes of anisotropy coincide with axes x and y above equation can be reduced to the following form 8 x k xx h x y k yy h y q 0 0 dirichlet and neumann boundary conditions are given as follows 9 h x h d x x γ d 10 q x n q n x x γ n flow eq 8 with appropriate boundary conditions dirichlet d as a known head 9 and neumann n as a known normal flux through the boundary 10 and known hydraulic conductivity distribution measured interpolated or generated can be solved by many numerical methods such as the common finite element and finite volume methods in this paper we will use isogeometric analysis iga using the galerkin collocation and control volume approach solving the flow problem 8 10 will give the head field the final flow result is the pore velocity v q ne using 1 where ne is effective porosity 3 methodology this section will provide a detailed description of the methodology employed there are two basic categories of spline based methods a with geometry mapping from the physical space to the parameter space which is widely coined as isogeometric analysis iga see hughes et al 2005 and cottrell et al 2007 2009 and b without geometry mapping where the solution is directly approximated in the irregular physical domain see kozulic and gotovac 2017 tsukanov and shapiro 2005 or hollig et al 2003 in this paper we will present the iga framework with two classical formulations galerkin g iga see cottrell et al 2009 and collocation c iga see auricchio et al 2010 both formulations are implemented in the open parallel code petiga dalcin et al 2016 then we will present the fup b spline description of heterogeneity and the solution of the flow problem 8 10 using the recently developed control volume formulation cv iga malenica et al 2018 in that way we can compare three iga formulations capable of bringing new avenues for groundwater flow modeling in heterogeneous porous media mainly due its ability to describe the geometry heterogeneity and solution head and velocity supplementary material describes the fup and b spline basis functions 3 1 review of iga framework spline methods have been attracted scientific attention since its discovery in the 1950s however the research has developed in two separate directions one for cad and geometry description and another for numerical analysis for solving of the boundary initial value problems hughes et al 2005 linked these two directions so that all variables geometry and solutions such as head and velocity are described by a linear combination of spline basis functions for example fig 1 presents the iga scheme of how one 2 d subdomain or patch defined as general four sided object we limit our considerations in this section to the one patch is transformed from the parameter space transformed domain to the physical space real domain using the following spline representation 11 x ξ η j 1 n x j ϕ j ξ η y ξ η j 1 n y j ϕ j ξ η where xj and yj are coordinates of n control points b xj yj in the physical space while ξ and η are coordinates in the parameter space the key elements of 11 are spline basis functions ɸj which are obtained by cartesian product of 1 d basis functions from each direction number and position of basis functions in both directions inside the patch are defined by knot vectors fig 1 in this paper we use open uniform knot vector as an ordered set of increasing parameter values ξ ξ1 ξ2 ξk n 1 ξi ξi 1 where ξi is the i th knot k is the number of basis functions and n is the polynomial order fig 1 for example in the ξ direction the knot vector divides the parametric space into intervals usually referred to as knot spans knot has a multiplicity m if knot value is repeated m times in the knot vector in this paper uniform open knot vectors are used where the first and last knots have a multiplicity m n 1 while all other knots are different and uniformly spaced between the first and last knot see for example review of nguyen et al 2015 moreover knots define distribution of parent elements in the parametric space located between neighboring knots fig 1 which have the same role as finite elements in fem therefore patch is divided to the parent elements which can serve as a basic integration element after integration over all parent elements assembling process is the same as in fem the control points define the control mesh in physical space which enables the designer to create a wide range of desired objects for instance in the car or aviation industry expression 11 presents that coordinates of control points directly define mappings from the parametric to the physical space fig 1 also ilustrates spline mapping for a chosen set of control points number of control points is equal to the number of basis functions which is on the other side defined by a knot vectors in both directions the control grid mesh which defines the connectivity between control points is also shown the non interpolatory nature of control points in the interior of the domain is evident and represents a notable difference over conventional lagrangian meshes nguyen et al 2015 in classic iga b splines and nurbs are widely recognized as suitable spline basis functions with the following main properties a compact support implying localized approximation properties b strictly positive values implying positive definiteness c partition of unity d enables continuity up to the desired order and e enables multiresolution or multiscale representation and construction of efficient adaptive procedures supplementary material presents a short description of the b splines and fup basis functions that will be used in this paper multidimensional spline representation uses a tensor product of basis functions from each direction fig 1 expression 11 shows that iga operates only with basis functions in the regular parameter space since transformations from the real to the transformed domain and vice versa are defined by jacobian and its inverse as in classic fem cottrell et al 2009 now the solution as the head or any other variable e g hydraulic conductivity as in this paper can also be described by expression 11 and an independent set of basis functions in the parameter space 12 u ξ η j 1 n α j φ j ξ η α j φ j ξ η isogeometric analysis iga means that the geometry and solution description use the same type of basis functions fig 1 the number and order of basis functions may not be the same in 11 and 12 in 12 spline coefficients αj can be calculated using the method of weighted residuals multiplying 8 10 with the test or weighting functions 13a ω k h w ω d ω ω q 0 w ω d ω 13b γ d h w γ d γ γ d h d w γ d γ 13c γ n q n w γ d γ γ n q n w γ d γ test or weighting functions are defined on domain 13a as well as on the dirichlet 13b and neumann 13c boundaries number of test functions should be equal to number of basis functions formulation 13 is usually called as strong formulation that requires up to the second order solution derivatives c2 continuity description of conductivity as a function defined up to the first derivatives c1 continuity and an independent set of 2 d test functions over the domain as well as 1 d test functions on dirichlet d and neumann n boundaries this strong formulation is needed for collocation c iga because the test functions are equal to the dirac functions in the selected collocation points inside the domain and along the boundaries e g shillinger et al 2013 classical galerkin g iga cottrell et al 2009 uses a weak variational formulation of the groundwater flow problem 8 10 involving the green gauss ostrogradski integration theorem in 13a 14 ω k h w ω d ω ω q 0 w ω d ω γ n q n w ω d γ γ d k h n w ω d γ weak formulation reduces the requirement for solution continuity to the c1 conductivity field to the c0 and directly involves neumann boundary conditions usually test functions in 14 are set to be zero on the dirichlet boundary as in fem in that case dirichlet boundary conditions should be satisfied by 13b or separately usually by an arbitrary function which only needs to satisfy the imposing essential boundary conditions on the dirichlet boundary the conductivity field can be a continuous spline function as in 12 but a more usual choice is a piecewise constant function at finite element or finite volume cell in common methods such as fem or modflow a detailed description of the heterogeneity representation in the strong 13 and weak formulation 14 will be given in the sequel to operate in the parameter space a derivation of jacobian and its inverse is needed related to eq 11 while boundary and other 1 d curves as well as all derivatives and elemental areas should be transformed according to the classic rules 15a j x ξ y ξ x η y η j 1 n ϕ j ξ x j ϕ j ξ y j ϕ j η x j ϕ j η y j 15b j 1 ξ x η x ξ y η y 1 d e t j y η y ξ x η x ξ 15c f l f ξ ξ l f η η l l x y 15d d ω d x d y d e t j d ξ d η 15e d e t j r x s 2 y s 2 s ξ o r η 15f n n x n y 1 det j r y s x s s ξ or η jacobian its inverse and determinant 15a b are defined only by the basis function derivatives in parameter space and control points from 11 eq 15c relates the derivatives between the parameter and physical space the jacobian determinant is crucial for 2 d integration 15d in the physical domain operating only in a parametric space any integration along the 1 d curve part of the neumann and dirichlet boundary or control volume boundary inside the 2 d domain can be considered in an analogous way together with its determinant 15g and normal 15f note that in this paper 1 d integration is only needed in the direction of two axes in the parameter space substituting 11 for the geometry 12 for the head solution and 15 for parameter space operations in 13 or 14 the strong or weak variational formulation in the parameter space can be obtained the choice of test functions determines the type of method spline basis functions as test functions represent the galerkin formulation standard g iga see cottrel et al 2009 while constant unit functions on the chosen control volumes subdomains represent control volume formulation cv iga malenica et al 2018 a detailed description of all these formulations and treatment of boundary conditions will be presented in the sequel what can iga contribute to the groundwater flow modeling in heterogeneous porous media compared with fem except for an exact description of the geometry iga uses higher order spline basis functions that enable the desired order of continuity eliminating case in fem discontinuities for zero and first velocity derivatives inside the domain or strictly speaking in fem terminology on interfaces between elements another property is the application of different strategies for construction of adaptive procedures such as lr splines or hierarchical b splines to describe variables with different resolution levels enabling the multiresolution approach e g vuong et al 2011 or bekele et al 2016 finally the description of heterogeneity as a linear combination of spline basis functions in multiresolution way gotovac et al 2009a makes iga and generally spline based methods promising tool for groundwater flow modeling in heterogeneous porous media 3 2 multiresolution spline representation of the hydraulic conductivity field in this paper we will develop a heterogeneity description closely related to its physical definition and in situ measurements it is well known that heterogeneity of porous media is defined from the pore scale to some larger macro scale a fundamental concept of the representative elementary volume rev said that it is the smallest volume consists of a certain number of pores and grains that can be represented by the average value of porosity or hydraulic conductivity in terms of a continuous function rev is a scale larger than the pore scale but significantly smaller than the macro scale groundwater flow problem 8 10 is defined on the rev scale due to complex geological conditions of heterogeneity development over a long time period heterogeneity can be defined at all scales larger than rev each larger scale includes some effects related only to that scale and changes the representative average value at some certain location on the other side our equipment always requires a certain scale and the obtained measurements represent an average value on that scale moreover different hydrogeological hydraulic and geophysical measurements give different average values on different scales finally modeling of groundwater flow and transport often require definitions of different scales all these reasons require that the heterogeneity description should be presented by the multiresolution framework described in this section in this paper we will assume that any hydraulic conductivity correlated field defined by the average value variance and correlation length in the classic geostatistical way rubin 2003 can be presented by a continuous function this is in accordance with gotovac et al 2009a who described the hydraulic conductivity field as a continuous function by fup collocation transform fct to develop the control volume framework we will present a derivation of cv iga that retains all the desired properties of the fct the basic difference between the two approaches lies in the fact that the fct satisfies the function values exactly in the collocation points while the cv iga satisfies the cell average function value using an averaging process on the appropriate control volumes cells therefore cv iga has a more fundamental concept closely related to the definition of heterogeneity scales and real measurements of conductivity supporting the rev concept and scale dependent processes the hydraulic conductivity function k x y is usually spanned by values which mutually differ by many orders of magnitude therefore direct approximation of k x y can produce numerical oscillations and negative unphysical values for small k values it is more feasible to approximate the log conductivity field y lnk see gotovac et al 2009a because that field is more regular usually with values ranging from 2 to 25 and always produces a strictly positive conductivity approximation k expy for example 2 d multi resolution expansion of the log conductivity function in the parameter space can be expressed in the following way 16 y ξ η j 0 j k k 1 z j k d k j ψ k j ξ η where j shows the resolution level from chosen zero to a maximum level jk needed for the fup b spline presentation 16 dk j are fup b spline coefficients ψk j are fup b spline basis functions zj k is the number of basis functions at level j and k denotes the function index at the current level j the zero level is the starting coarsest level that is always present in the grid fig 2 shows one example of the zero level with 25 internal fup2 basis functions with vertices inside the domain and 24 boundary fup2 basis functions with vertices along the domain boundary each basis function is obtained as a tensor product of the related basis functions from each direction and represented by symbols circles and squares which presents the greville point location greville coordinates in each direction can be found using the well known relation for b splines of n th order according to the knot vector ξ ξ1 ξ2 ξk n 1 17 g i ξ i 1 ξ i n n greville points coincide with vertices of n th order basis functions if the vertex location is located at least n 1 2 characteristic intervals from the boundary greville points are located also on the boundary and they do not coincide to the vertices of the internal basis functions which are located closer than n 1 2 characteristic intervals from the boundary we use the same greville points for fup basis functions of the n 1 th order as for the b splines of the n th order because fup basis functions have one more characteristic interval see supplementary material the characteristic interval at each level for each direction is equal to the scale or distance between the adjacent internal vertices in the parameter space see fig 1 it is also dimension of the parent element 18 δ ξ j 1 2 j m i n x j δ η j 1 2 j m i n y j where jminx and jminy are the resolutions in both directions at the zero level jminx jminy 2 in fig 2 for the collocation framework a crucial step is the choice of locations of collocation points the classic choice is the vector of greville points that leads to a stable and convergent solution e g gotovac et al 2007 2009a shillinger et al 2013 since the control volume framework can be regarded as a subdomain collocation framework the choice of locations and dimensions of control volumes also becomes a crucial step for approximation of heterogeneity representation 16 for each basis function only one control volume is related to the corresponding greville point and defined as the rectangle in the parameter space with sides boundaries at half distance between the neighboring greville points or at the boundary fig 2 dashed rectangles therefore control volume approximation at the zero level needs to satisfy the cell average value of function 16 for each corresponding control volume cell 19 d k 0 1 a l 0 ω l 0 ψ k 0 ξ η d a l 0 1 a l 0 ω l 0 y ξ η d a l 0 k l 1 z 0 k where k denotes index of basis functions while l denotes index of control volumes al 0 is the area of the control volume cell formally we write it in both sides of 19 to emphasize that right side represents average value on the other side that area is not actually calculated system 19 yields fup or b spline coefficients at the zero level log conductivity field on the right side can be known rare case interpolated from direct measurements or can be generated by stochastic random generators based on geostatistical analysis every next resolution level j includes two times more internal basis functions in each direction with two times smaller compact support and control volume cells eq 18 note that smaller scales at higher levels involve higher frequencies and detailed approximation properties which are particularly important for zones with large log conductivity gradients for the first and every next level the algorithm should only satisfy the cell average residual between the known conductivity and its previous level approximation on control volumes 20 d k j 1 a l j ω l j ψ k j ξ η d a l j 1 a l j ω l j y ξ η y j 1 ξ η d a l j k l 1 z j k al j is the area of the control volume cell at level j non symmetric system 19 or 20 is efficiently solved at each level using the gmres generalized minimal residual solver and schwartz preconditioner gotovac et al 2009a the obtained fup b spline coefficients at higher levels describe only the log conductivity contribution or residual related to that level or scale the procedure is repeated until the residual is less than the prescribed threshold in all cells at some higher resolution level or a maximum level is reached in this way the hydraulic log conductivity is described in a multiresolution way fig 3 presents the multiresolution cv iga description of the conductivity field generated by hydrogen bellin and rubin 1996 at the fourth level as a set of discrete cell average values 128 128 squares fig 3f the lnk variance is eight while four cells cover the correlation length of the exponential variogram structure the coarsest zero level 8 8 fig 3a describes only the global conductivity patterns while higher levels fig 3b e capture finer heterogeneity scales the final fourth level fig 3e exactly reproduces the heterogeneity patterns in control volume sense generated by hydrogen fig 3f note that this procedure should be repeated for all components of the conductivity tensor implying that each component is described by an independent continuous function 16 gotovac et al 2009a used the collocation procedure via fct to obtain an adaptive grid and remove all collocation points at higher levels that do not significantly contribute to the log conductivity representation 16 however new research in the iga community presents more efficient algorithms two promising directions for adaptive algorithms apply truncated hierarchical b splines and t splines e g hennig et al 2017 which can include all important different scales in different spatial zones to accurately describe log conductivity 16 in this paper we apply only the multiresolution representation of the conductivity field gotovac et al 2009a while fully iga adaptive algorithms can be developed in future contributions 3 3 three iga formulations 3 3 1 galerkin iga g iga g iga uses weak formulation 14 and spline basis functions as test functions directly satisfying neumann boundary conditions dalcin et al 2016 in classic fem dirichlet boundary conditions are satisfied by imposing solution values in the finite element nodes since classic fem uses lagrangian basis functions which are collocated in finite element nodes higher order spline basis functions in iga do not possess such a kronecker property because there are always few non zero basis functions at each point on the dirichlet boundary the basic iga approach performs construction of an arbitrary function that exactly satisfies the dirichlet boundary conditions cottrell et al 2009 then the weak formulation 14 directly satisfies neumann conditions and homogeneous dirichlet boundary conditions implying that test functions in 14 must be zero on the dirichlet boundary in this paper we formulate a strong treatment of boundary conditions to formally have the same approach for all three iga formulations therefore we use the collocation approach for basis functions with greville points on the dirichlet boundary in such a way that spline approximation 12 exactly satisfies the dirichlet boundary conditions in these points it means that in 13b the dirac delta function is used for the test function on the dirichlet boundary bazargan lari 2014 substitution of 11 12 15 and 16 in weak formulation 14 and dirichlet boundary conditions 13b yields the final g iga formulation 21 α k j 0 1 0 1 k ξ φ k j φ l j detjd ξ 0 1 0 1 q 0 φ l j detjd ξ 0 1 q n φ l j det j n d t n k l z j ξ l j ω γ d 22 α k j φ k j ξ l j h d ξ l j k l z j ξ l j γ d where j is the current resolution level while subscript l denotes raw of matrix and index of test functions while k denotes column of matrix and index of basis functions conductivity 16 is obtained by cv iga as explained in the previous subsection system 21 22 independently of log conductivity resolution 16 at any resolution level j is non symmetric due to 22 and it is solved by gmres with the schwartz preconditioner as explained in gotovac et al 2009a g iga usually spends significant cpu time for assembling system 21 22 the numerical integration in 21 can be performed by classical gauss numerical integration cottrell et al 2009 fig 1 shows that the knot vector in each direction defines the distribution of parent elements at the patch subdomain rather than performing gauss integration in 21 over the whole patch regarding the basis and test functions as global functions it is more feasible to apply integration on the parent elements in that case analogy between iga and fem is complete gauss integration over parent elements creates the local stiffness conductance matrix assembling means that members of the local matrices are placed into the global matrix 21 using the connectivity list similar to the classic fem procedure this assembling concept is a main reason why many scientists and engineers describe g iga as a spline fem however groundwater flow modeling in heterogeneous porous media involves hydraulic conductivity as a very demanding function for numerical integration in 21 classic fem regards hydraulic conductivity as a piecewise element constant function implying that the numerical integration in 21 depends only on the basis function derivatives and jacobian components 15a and 15b it is also possible to set the same for hydraulic conductivity in iga for the parent elements however if we regard hydraulic conductivity as a continuous function 16 and use different basis functions and resolution levels for conductivity and head then the numerical integration in 21 can be more demanding especially for high heterogeneity and cases where head resolution levels are coarser than conductivity resolution due to large conductivity gradients over the integration parent element one practical approach is dividing the parent element in 21 into sub elements of the same size as a conductivity resolution since at least four parent elements should cover the conductivity correlation length integration in 21 needs to respect the conductivity resolution so that integral functions stay sufficiently smooth especially in highly heterogeneous cases finally g iga is the computationally expensive concept due to numerical integration of the conductance matrix 21 22 as well as the large number of non zero matrix members in each row 2n 3 ndim for fup and 2n 1 ndim for b splines if ndim represents the dimensionality of the problem and n is the order of basis functions note that there are other more advanced optimal numerical integration concepts for g iga for example see barton and calo 2015 or calabro et al 2017 3 3 2 collocation iga c iga c iga is a very promising alternative to the classic iga galerkin formulation in terms of computational cost and efficiency e g auricchio et al 2010 shillinger et al 2013 as noted earlier test functions for c iga are dirac functions that eliminate the integration procedure to calculate the stiffness conductance matrix using the strong formulation in 13 substituting the dirac test functions in 13a c the collocation formulation at each resolution level has a very simple form satisfying the differential flow eq 13a in the interior greville collocation points as well as the dirichlet 13b and neumann 13c boundary conditions in the boundary greville collocation points e g gotovac et al 2009a shillinger et al 2013 see fig 2 23a α k j k ξ l j φ k j ξ l j k ξ l j 2 φ k j ξ l j q 0 ξ l j k l z j ξ l j ω γ d γ n 23b α k j φ k j ξ l j h d ξ l j k l z j ξ l j γ d 23c α k j k ξ l j φ k j ξ l j n ξ l j q n ξ l j k l z j ξ l j γ n special attention needs to be devoted to the neumann boundary conditions in very complex domains de lorenzis et al 2015 namely strong satisfaction in 23c can lead to numerical instabilities problem can be solved by using the hybrid collocation replacing 21 with 21c or introducing penalty method de lorenzis et al 2015 since we are more interested in this paper to the heterogeneity effects than in complex geometry issues classical c iga formulation 23 is considered conductivity 16 is obtained by cv iga enabling evaluation of the zero and first conductivity derivatives in the collocation points system 24 is also non symmetric and is solved by gmres as in the galerkin case the first derivatives of basis functions in 23 are evaluated in the same way as in 21 while second derivatives in the expansion form involve many more factors in the parameter space see kozulić and gotovac 2000 gotovac et al 2009a used the same strong formulation 23 in only the physical domain without geometry transformations 11 they analyzed the heterogeneity influence in strong formulation 23 and presented that expression 23a is indeed the collocation form of the advection dispersion equation where the conductivity first derivatives act as velocity while conductivity plays the role of dispersion in highly heterogeneous porous media conductivity gradients are usually significantly larger than conductivity and the groundwater flow problem becomes an advection dominated problem implying that c iga will be faced with numerical oscillations and instabilities gotovac et al 2009 found that the collocation algorithm is accurate only if the consequent grid peclet number is reduced implying the application of a denser grid for head than for conductivity 16 in the case of high heterogeneity novel research also shows that de lorenzis et al 2015 hansen 2016 gomez and de lorenzis 2016 franherdorf et al 2017 greville collocation points are not the best collocation points and super convergent points can be found to yield near galerkin optimal convergence and accuracy such improved collocation formulation can be competitive with cv iga formulation which will be shown in the sequel despite this shillinger et al 2013 proved that c iga 23 can be competitive with g iga in terms of computational cost and accuracy criteria especially for higher order spline basis functions therefore due to all mentioned reasons we will include classical c iga 23 in this paper as a candidate for solving the groundwater flow problem in heterogeneous porous media 8 10 finally c iga is significantly cheaper than g iga due to the absence of numerical integration of the conductance matrix as well as a significantly smaller number of non zero matrix members in each row n 1 ndim for fup and n ndim for b splines if ndim represents the dimensionality of the problem and n is the order of basis functions 3 3 3 control volume iga cv iga the iga framework offers the application of many possible methods involving strong 13 or weak 14 formulations different choices of spline basis and test functions or treatment of boundary conditions in fluid mechanics the finite volume method is very popular due to its simplicity and mass conservation properties particularly modlfow harbaurgh 2005 see also the open parallel and unstructured finite volume code pflotran hammond et al 2014 is well known as the most popular solver for flow in heterogeneous porous media modflow is based on the mass balance of boundary fluxes at each cell or finite control volume fluxes are obtained using the darcy law 1 and the finite difference operator for hydraulic gradient using the neighboring head cell values this solver is very stable even for highly heterogeneous porous media and presents the state of the art in this field e g de dreuzy et al 2007 naturally the modflow properties imply that a novel higher order control volume solver can be created using iga and spline basis functions it is important to note here that such a novel finite control volume method will have many additional properties in comparison with modflow indispensable for groundwater flow modeling in heterogeneous porous media a this method is not the classic finite volume method ferziger and peric 2002 because the head is not the piecewise cell average value and the velocity is not a linear discrete interpolation from the cell boundary fluxes rather here head solution 12 is a continuous function described by a linear combination of fup b splines basis functions and velocity is simply obtained by 1 12 and 16 as a continuous function this method is more related to the control volume finite element method by patankar 1980 or baliga and patankar 1983 cai et al 1997 b velocity derivatives are also continuous functions due to smoothness and continuity of fup b spline basis functions up to the desired order that is important for derivation of velocity dependent dispersion tensor and consistent random walk simulations c heterogeneity is described by 16 as a continuous function describing all heterogeneity scales contrary to the piecewise cell constant representation d geometry is exactly described in the isogeometric cad system and e the method enables high order convergence properties and obtained accuracy as well as more efficient adaptive refinement strategies e g vuong et al 2011 recently malenica et al 2018 developed such control volume formulation inside the iga framework and applied it to the groundwater flow analysis in the karst aquifers therefore in this paper we apply here an cv iga concept in heterogeneous porous media as well as special treatment of boundary conditions first we need to introduce the control volume framework to solve differential flow eq 8 the domain is divided by control volume cells as in fig 2 which is an example of some chosen resolution level the gauss divergence theorem should be applied on each cell 24 ω d i v q d ω ω γ q n d γ introducing 24 to 8 yielding 25 ω γ q n d γ ω q 0 d ω this formulation is reduced to the mass balance between discharges through the cell boundaries and pumping recharge as an external loading over the cell where n is external normal vector applying darcy law 1 to the mass balance eq 25 for each cell control volume 26 γ k h n d γ ω q 0 d ω comparison of 26 to the weak formulation 14 leads to the conclusion that control volume formulation 26 can be regarded as weak formulation 14 with constant piecewise test functions unit on control volume elsewhere zero first we choose the explained strategy in section 3 2 and define control volumes around the corresponding the greville points in such a way that the control volume in the parameter space is defined as a rectangle with sides at a half distance between the neighboring greville points or at the boundary fig 2 dashed rectangles with four sides r 1 4 non overlapping control volumes based on greville points cover the whole domain implying exact satisfaction of the local and global mass balance introducing 11 12 15 and 16 in 26 the mass balance flow equation is formulated at each control volume in the parameter space 27 α k j r l 1 4 γ r l k φ k j n d e t j r l d t r l ω l q 0 d e t j d ξ l γ n l q n d e t j n l d t n l where k is the subscript for index of basis functions and l represents index of control volumes due to weak formulation neumann boundary conditions in 27 are satisfied in the same way as in g iga dirichlet boundary conditions can be solved similar as in two previous formulations 13b 22 or 23b except that now test dirichlet boundary function is unit function on that boundary control volume part of dirichlet boundary with end points at half distance between neighboring boundary greville points see fig 2 elsewhere is zero in that case eq 13b is represented in the parameter space as follows 28 α k j γ d l φ k j det j d l d t d l γ d l h d det j d l d t d l control volume system 27 28 requires more operator evaluations per degree of freedom than c iga due to numerical integration over boundaries of control volumes and therefore the computational cost for cv iga lies between g iga and c iga cv iga has n 3 ndim for fup and n 2 ndim for b splines of non zero matrix members in each row if ndim represents the dimensionality of the problem and n is the order of basis functions and requires numerical integration of ndim 1 control volume boundary integrals that are much more cheaper than g iga special attention should be devoted to the consideration of local global mass balance on control volumes weak formulation 27 shows that local mass balance is satisfied exactly on interior control volumes with respect to the obtained cv iga velocity field and fluxes on cv boundaries see next section 3 4 and spline representations 11 12 and 16 however it is not the case with boundary cv s for neumann cv boundary local mass balance in 27 is obtained with respect to the given flux in 13b it means that cv iga flux on neumann boundary is not the same as the given flux in 13b it is well known consequence of weak satisfaction of neumann boundary conditions however as discretization goes to zero calculated cv iga neumann boundary flux should be converging to the given flux 13b similarly calculated cv iga dirichlet boundary flux satisfies weak imposition of dirichlet essential boundary conditions 28 but does not ensure local mass balance on boundary dirichlet cv s therefore after obtaining cv iga solution from system 27 28 it is needed to calculate dirichlet boundary flux as outer boundary flux which ensures mass balance on dirichlet boundary cv s using other known interior fluxes as postprocessing step once again as discretization goes to zero outer boundary flux should be converging to the cv iga dirichlet boundary flux finally global mass balance is obtained between neumann given boundary flux 13b calculated outer dirichlet boundary flux and pumping recharge given from the right side of 27 as discretization goes to zero calculated spline boundary fluxes are also in the global mass balance with pumping recharge these considerations are similar as in classic fem and iga due to used weak formulation 14 moreover cv iga in comparison to c iga has two important advantages because it exactly satisfies the local and global mass balance and considers flow problem 8 10 as the diffusion problem which means that cv iga can solve 27 28 without numerical oscillations for a wide range of heterogeneity enabling a higher convergence order and better accuracy non symmetric system 27 28 and the numerical integration are solved as the previous two iga formulations using the gmres solver and gauss numerical integration 3 4 velocity field without loss of generality we will show here the calculation of the velocity field for a 2 d isotropic porous media according to the darcy law 1 as well multiresolution representation of hydraulic conductivity 16 and head 12 calculation of the velocity has the following form 29 q s x y e x p j 0 j y k 1 z j y d k j ϕ k j x y j 0 j h k 1 z j h α k j φ k j x y s s x y fup b spline basis functions within iga obtain velocity components and all its derivatives as smooth and continuous functions see gotovac et al 2009a supplementary material in 29 it means that the iga for all three formulations yields velocity field 29 with all the mentioned desired properties indispensable for reliable transport simulations a consider heterogeneous hydraulic conductivity as a continuous function resolving all spatial heterogeneity scales b yields continuous velocity field which implies reduction of numerical dispersion c yields continuous derivatives of the velocity field which enables rigorous treatment of the velocity dependent dispersion tensor for random walk transport simulations additionally cv iga satisfies the local and global mass balance property on the velocity field avoiding loss adding of mass in transport simulations 4 results and discussion 4 1 flow problem in 2 d uncorrelated heterogeneous porous media with pumping this example will show verification of cv iga using low order fup1 basis functions with respect to the classical methods modflow and fem verification test is taken from the modflow report mehl and hill 2005 it is 1260 m long and 1350 m wide has constant head boundaries of 10 m and 1 0 m on the left and right sides respectively no flow boundaries extend across the top and bottom fig 4 a pumping well extracts 5 5 m3 s from the center of the domain the heterogeneity structure was constructed using five transmissivity t zones randomly distributed throughout the domain with a spatial resolution equivalent to the coarsest zero spatial level 90 90 m as shown in fig 4a five levels of heterogeneity are considered they begin with a homogenous case t 0 25 m2 s for all zones then the contrasts of the transmissivities represented by each zone are increased four times until the heterogeneity structure has a variance of lnt of approximately 3 61 and a range of approximately three orders of magnitude in that way five heterogeneity sequences are generated with lnt variances of 0 0 05 0 64 1 96 and 3 61 fig 4b presents control volume presentation cv iga of heterogeneous distribution defined in fig 4a previously explained in the section 3 2 classical methods regard heterogeneity as piecewise constant field on control volume cell grid modflow or finite element mesh fem presented in fig 4a cv iga considers it as continuous function fig 4b satisfying constant control volume values fig 4a according to the system 19 although there is no correlation because five heterogeneity zones in fig 4a are randomly distributed over the domain cv iga heterogeneity presentation is a smooth function with the same geostatistics as classical modlfow or fem presentation head solution is defined on many resolution levels starting from the coarsest zero level 90 90 m with 210 control volumes presented on fig 4a to the finest 6 th level 1 40625 1 40625 m with 860160 control volumes heterogeneity distribution is always defined on zero level according to the fig 4a and 4b fig 5 a presents head flow solutions for homogeneous case while fig 5b for the most heterogeneous case with a variance of lnt of approximately 3 61 head cv iga solution is presented on the finest 6 th resolution level it is compared with classic modflow solution mehl and hill 2005 based on the cell centered finite difference algorithm which can also be regarded as control volume solver homogeneous solutions are almost identical fig 5a while significant differences between solutions exist for highly heterogeneous case in fig 5b which can be associated to the different formulations but also to the different approximations of the lnt field in fig 4 moreover both solutions follow heterogeneity patterns in the same way but there are zones with larger head differences however deeper analysis requires convergence properties of these solutions since the head solution is refined over six higher resolution levels than the heterogeneity resolution level convergence log log plots are presented for all heterogeneity levels and cv iga in fig 6 a the x axis presents discretization length δx δx δy the same in both directions while the y axis denotes l1 norm of head numerical error for each head resolution level l1 norm is defined through the definition of the p norm lp εj p 1 p p 1 and calculated on the 7 th resolution level higher than the maximum used 6 th head level head numerical error ε at each resolution level j is defined as a difference residual between head solution on that level j and previous level j 1 indeed head error is computed by solving the system 27 28 convergence rate p can be calculated using the empirical expression εj εj 1 2p in log log scale it is transformed to the following log εj εj 1 p log2 p log δx j δx j 1 therefore in log log plot in fig 6a convergence rates p are presented as slopes of calculated lines cv iga obtains optimal quadratic convergence rate p 2 for all heterogeneity levels due to smooth and continuous presentation of heterogeneity as well as for head derivatives therefore calculated velocity according to the expression 29 is continuous and smooth field without any artificial numerical velocity variations on the other side fig 6b shows that it is not the case with two other classical methods a modlfow and b fem solution with linear basis functions we used here g iga algorithm section 3 3 1 with b1 basis functions but heterogeneity distribution is replaced by piecewise constant field according to the fig 4a mehl and hill 2005 reported that modlfow can obtain optimal quadratic convergence rate in homogeneous and very low heterogeneous case higher heterogeneity introduces larger lnt discontinuities causing the well known numerical consequence that convergence rate becomes suboptimal although head resolution level is very high discontinuities between different heterogeneity zones cannot be resolved without loose of accuracy moreover mehl and hill 2005 presented that also adaptive mesh refinement cannot improve modflow convergence rate the same consequence appears in fem algorithm where additionally discontinuities of head derivatives between finite elements degrades convergence rate as it was presented many times in the literature among others in cainelli et al 2012 in conclusion cv iga in comparison with classical methods such as modflow and fem enables optimal convergence rate with continuous velocity approximation without numerical dispersion 4 2 flow problem in 2 d correlated heterogeneous porous media under mean uniform flow conditions 4 2 1 flow realizations with cv iga to verify the cv iga methodology with other iga methodologies we use a classic benchmark for the flow in multi gaussian heterogeneous porous media under mean uniform flow conditions e g bellin et al 1992 gotovac et al 2009b fig 7 presents such a flow realization with an exponential variogram and two different heterogeneous lnk variances one fig 7a and eight fig 7b on a relatively large domain defined in the dimensionless correlation coordinates lx iy ly iy 64 32 hydraulic conductivity is generated on the fourth level 256 128 cells control volumes with four control volumes per correlation length iy the boundary conditions create mean uniform flow conditions in the following way fig 7 the top and bottom boundaries exhibit no flow neumann conditions while the left and right boundaries have dirichlet boundary conditions with heads equal to 10 m and 0 m respectively fig 7 presents the hydraulic conductivity field as the filled background as well as the head red contours and velocity solution blue polylines as streamlines at the fourth level for both lnk variances the hydraulic conductivity and solution are obtained by cv iga the homogeneous media yield a uniform flow solution with linear distributions of the head and horizontal streamlines heterogeneity causes deviations in both families of curves the weakly heterogeneous porous media exhibit small heterogeneity variations implying small velocity variations and a relatively uniform flow field fig 7a the highly heterogeneous solution the lnk variance is approximately greater than three is characterized by preferential flow channels e g gotovac et al 2009b which occupy a small portion of the domain but transfer most of the total flow discharge fig 7b the flow field tends to connect higher conductivity zones using minimum flow energy fig 7 clearly shows how the velocity field becomes increasingly complex with heterogeneity variations introducing large head and velocity gradients the head can be considered for all levels independent of the conductivity resolution from the chosen zero level 16 8 cells to the maximum user defined level in this case we choose the 7 th maximum level with 2048 1024 cells using an independent linear combination of basis functions 12 the coarse zero level usually describes only the global flow pattern and each higher resolution level presents its own head residual or the particular contribution at that level higher levels include detailed velocity patterns that completely resolve the influences of all the heterogeneity scales fig 8 presents the multiresolution head solutions at different resolution levels for the log conductivity at the fourth level presented in fig 7b the multiresolution solutions directly enable measurements of the accuracy which is related to the head and or velocity residual at each level for the high lnk variance field generated at the fourth level the head solution at the second level fig 8a is in relatively close agreement with the fourth level however inside the control volumes there are zones with stagnant streamlines the control volume formulation exactly satisfies the mass balance through the cell boundaries but large heterogeneity variations at the fourth level cause a hydraulic gradient head derivatives involving artificial numerical sink source zones at the second level this is not the case for the cases with weak and mild heterogeneity where even coarser levels can produce very accurate head and velocity fields however for the case with high heterogeneity it is not possible to obtain an accurate velocity field on coarser levels fig 8b confirms that the fourth level produces a very accurate head solution because its comparison versus the fifth level shows that the difference between them is negligible for all practical purposes the head residual at the fifth level is less than 0 1 mm head is bounded in interval 0 10 m which means that we obtained a very accurate head and velocity field at the same level in which the lnk field is generated even for the high heterogeneity case 4 2 2 convergence analysis for three iga formulations the accuracy and convergence analysis results are studied in more detail in figs 9 and 10 for the head and velocity respectively all three iga formulations galerkin g iga collocation c iga and control volume cv iga are compared using the fup and b spline basis functions up to the 4 th order fig 9 presents the relationship between the discretized grid in dimensionless form the same in both directions δ x δx lx δy ly and the head residual on a log log scale for the flow realization presented in fig 7b var lnk 8 generated at the fourth level the head residual at each level j 1 7 greater than zero level is defined as the difference between the head at a particular level j and that at the previous level j 1 and the residual is obtained for all three formulations solving systems 21 22 23 and 27 28 for g iga c iga and cv iga respectively the head residual is given in the form of the l2 euclidean norm as a measure of numerical error the slopes of the simulated lines present the convergence rate p a similar analysis is performed many times for the poisson equation for g iga and c iga see among others schillinger et al 2013 hanssen 2016 in the case of a homogeneous aquifer the groundwater flow problem 8 10 is equal to the poisson equation it is well known that g iga yields the optimal convergence rate p n 1 for the poisson problem if n is the order of the fup or b spline functions fig 9a d confirms that this result still holds true even for the high heterogeneity case var lnk 8 and higher order basis functions up to the 4 th order according to the fig 6 in this subsection only highly heterogeneous case is analyzed because all results are valid irrespective to the heterogeneity level c iga yields a suboptimal convergence rate p n for even basis functions and p n 1 for odd basis functions c iga is a computationally cheaper and more efficient algorithm than g iga however it suffers from three basic drawbacks 1 an optimal convergence rate is absent and therefore the accuracy is reduced 2 c iga regards the groundwater flow problem as an advection dispersion equation through the strong formulation see section 3 3 involving numerical oscillations and instabilities for high heterogeneity cases especially at head levels coarser than the fourth lnk level 3 there is no local or global mass balance due to the point collocation nature of the algorithm gomez and de lorenzis 2016 proved that greville collocation points are not optimal convergence points for the poisson problem rather they found superconvergent collocation points which yield an optimal convergence rate for odd basis functions p n 1 but for even basis functions the convergence rate is not optimal p n the reason for this phenomenon is still not well understood moreover in this paper we use fup and b spline basis functions which have a different number of characteristic intervals nevertheless the problem is still polynomial order dependent cv iga lies between g iga and c iga with respect to computational efficiency as well as accuracy as shown in fig 9 fig 9 shows that the convergence rate for cv iga is optimal p n 1 for odd basis functions and suboptimal p n for even basis functions the same as c iga with superconvergent collocation points once again the mystery for even basis functions is also present for cv iga fig 9a shows that for n 1 the convergence rate p 2 is optimal for g iga and cv iga when g iga uses b 1 splines basis functions are the same as lagrangian 1 d linear fem basis functions contrary to the example in section 4 1 g iga obtains optimal convergence rate due to continuous heterogeneity approximation there are no collocation results because c iga requires at least c2 continuity or continuous second order derivatives that are satisfied with fup2 or b3 basis functions fig 9b d presents the convergence results for higher order basis functions due to the reduction in the convergence order c iga and cv iga are less accurate than g iga for even orders however cv iga is approximately few orders of magnitude more accurate than c iga for odd order basis functions cv iga has the optimal convergence rate with accuracy very close to that of g iga fig 10 presents the convergence and accuracy analysis for the velocity 29 calculated from the darcy law 1 generally c iga yields the optimal convergence rate p n for even basis functions and a suboptimal convergence rate p n 1 for odd basis functions cv iga yields the same optimal convergence rate as g iga p n for all orders of basis functions and has very close results to g iga cv iga is two orders of magnitude more accurate than c iga for even basis functions and is much more accurate for odd basis functions for g iga and cv iga with b1 splines fig 10a we calculate the velocity closely related to the classic fem and modflow analysis b1 splines have c0 continuity and are not well suited for second order problems therefore the modflow velocity calculation uses cell averaged boundary velocities and performs a linear approximation at each cell from four boundary cell velocities e g de dreuzy et al 2007 fem also uses the postprocessing procedure as a linear velocity approximation from the velocities taken from central element gauss points caineli et al 2012 in that case the enhanced convergence rate for the velocity is two but requires additional cpu time due to the additional velocity approximation in comparison with the classic iga however the classic modlfow and fem techniques cannot describe continuous velocity derivatives due to the reduced c1 continuity of the velocity approximation in order to fully describe the velocity dependent tensor iga needs to use at least fup2 or b3 basis functions cv iga presents the best candidate velocity approximation for groundwater flow modeling in heterogeneous porous media due to the following it has the optimal convergence rate its accuracy is very close to that of g iga it has a substantially smaller computational cost and greater robustness than g iga and it satisfies the local and global mass balance and stability in comparison with c iga fup basis functions are more accurate than b splines for the same order due to their enhanced continuity and better approximation properties but they have one more characteristic interval for the same order of basis functions implying a more expensive cost to solve the linear system of equations for both basis functions convergence rate depends of their polynomial order in conclusion the presented results for highly heterogeneous porous media var lnk 8 prove that the convergence rates are identical as a pure poisson problem for a homogeneous domain regardless of the heterogeneity variance 4 2 3 stochastic analysis in order to stochastically verify presented methodology using the hydrogen random generator rubin and bellin 1996 100 numerical realizations are generated for the same setup and domain as in fig 7 lnk head and velocity are obtained at fourth resolution level and nine lnk variances 0 25 1 2 3 4 5 6 7 and 8 cv iga is compared to the g iga and afcm gotovac et al 2009a which is equivalent to the c iga for regular geometry such as in this example additionally all three iga formulations are compared to the classic modflow solution de dreuzy et al 2007 we selected dimensionless velocity variance as indicator of solution accuracy and recall the collocation results of afcm gotovac et al 2009b in both directions 30 σ v x 2 u 2 3 8 σ y 2 1 376 875 σ y 2 0 175 31 σ v y 2 u 2 1 8 σ y 2 1 328 535 σ y 2 0 535 where u is an average velocity fig 11 confirms that cv iga yields similar results as in 30 31 that is obtained from the equivalent afcm algorithm gotovac et al 2009b to c iga moreover cv iga is also similar to g iga which is expected due to fig 10 implying very good agreement between all three iga formulations de dreuzy et al 2007 used the finite volume classic modflow algorithm which obtains smaller transversal and higher longitudinal velocity variance than cv iga however all stochastic solutions are in close agreement confirming verification of the cv iga with earlier published stochastic results 4 2 4 computational efficiency convergence analysis in the subsection 4 2 2 and figs 9 and 10 presented accuracy issues however the computational efficiency needs to be explored according to the convergence analysis in subsection 4 2 2 we choose highly heterogeneous example from the fig 7b as mentioned earlier in the section 3 c iga is computationally cheaper method than g iga with respect to the number of quadrature integration points and number of non zero matrix elements cv iga lies between these two methods table 1 summarizes these considerations for all three iga formulations c iga requires only one integration point which is located in the greville collocation point cv iga requires 1 d integration on four control volume boundaries since the control volume boundaries are shared by neighboring control volumes cv iga requires nearly 1 d integration on two cv boundaries per control volume on the other side g iga performs 2 d integration on each parent element numerical integration is performed with 3 gauss points in each direction in order to ensure high order polynomial integration fifth order which is higher than the maximum order of the used basis functions for example for fup2 basis functions cv iga has 25 non zero matrix elements in each row and 6 gauss points per control volume g iga has 49 non zero matrix elements in each row and 9 gauss points per parent element while c iga has only one collocation quadrature point and 16 non zero matrix elements in each row evidently table 1 indicates that c iga is computationally relatively cheap while g iga is very expensive especially for higher order basis functions n 2 therefore cv iga combines advantages of c iga in terms of formulation simplicity and computational efficiency and g iga in terms of robustness and computational accuracy these considerations are shown in fig 12 in terms of cpu time and accuracy for fup2 and fup4 basis functions for fup2 basis functions g iga is still more efficient than c iga fig 12a for higher order fup4 basis functions situation is opposite although g iga significantly outperforms c iga in terms of accuracy figs 9 and 10 computational cost of c iga is very low and cpu time is smaller for the same obtained accuracy than g iga this behavior is also obtained for poisson and elasticity problem in schillinger et al 2013 reasons for this inversion of computational efficiency lie in significantly smaller number of non zero matrix elements for c iga where linear system of equations is less expensive moreover for larger problems and higher order fup4 basis functions numerical integration and generation of system of equations also require significant amount of computational cost for g iga on the other side c iga practically has no cpu time for matrix system generation cv iga requires more time than c iga for matrix system generation but its system of equations is not as expensive as g iga therefore cv iga computational efficiency in terms of cpu time lies between other two iga formulations non symmetric linear system of equations is solved at each head resolution level using the gmres solver and schwartz preconditioner gotovac et al 2009a dependence of number of gmres iterations and resolution levels is presented in table 2 solver is a relatively efficient for all iga formulations except for the highest 7 th head resolution level more than 2 million degrees of freedom where cpu time and number of gmres iterations are drastically increasing therefore indicator of computational cost is also number of gmres iterations which confirm relationship between all three iga formulations finally b splines are more efficient than fup basis functions in sense of computational cost b splines of n 1 th order have the roughly the same computational cost as fup basis functions of the n the order in terms of cpu time and number of gmres iterations 4 2 5 irregular geometry and significance of higher order basis functions in order to show additional application of cv iga to the description of flow in heterogeneous porous media in the complex geometry for the heterogeneity representation from the fig 7b var lnk 8 flow domain is transformed to the l shape now left and lower boundaries have dirichlet boundary conditions hleft 10m and hlower 0m while other two boundaries are no flow fig 13 a presents the classical l shape benchmark test case it means that only shape of the flow domain is changed while all other parameters including the heterogeneity description is maintained l shape domain fig 13 cannot be described by only one patch if we use open uniform knot vector two patches are used but there are two discontinuity points in two corners denoted by points a and b in fig 13 because there is no unique normal in these points moreover continuity between patches in terms of jacobian terms 15 a and b are violated note that different approaches for gluing of patches are presented in the literature among others buchegger et al 2016 but it is beyond of the scope in this paper flow solution in l shape domain is presented in fig 13a flow patterns in terms of headlines and streamlines follow behavior as in fig 7 for rectangular domain l shape flow test case exhibits well known numerical problems in this classical fluid mechanics benchmark containing two mentioned corner singular points where velocity in both directions has discontinuity two bilinear no flow boundaries are also two streamlines however neighboring streamlines cannot satisfy no flow boundary conditions close to the singular points as discretization decreases problematic zones around corners are smaller fig 13b presents convergence analysis for l shape problem contrary to figs 9 and 10 for smooth rectangular flow problem in case of l shape domain due to singular two corners and partially jacobian discontinuity between two patches the convergence rate is reduced fig 13b higher order basis functions slightly improve the convergence rate and accuracy but it is still far from the optimal rate this behavior is not surprising because it has been shown many times in the literature for poisson problem and l shape domain in the iga context for example see vough et al 2011 or garau and vazquez 2018 fig 13b opens discussion about influence of the higher order basis functions in the iga context particularly for cv iga groundwater flow modelling these two flow examples presented in this paper prove that under the smooth representation of heterogeneity and geometry an optimal convergence rate can be obtained it is very important to emphasize here that smooth cv iga heterogeneity approximation enables optimal convergence even in case of high heterogeneity where higher order spline basis functions drastically improve accuracy and convergence rate and significantly outperform classic low order fem and fvm methods however it is well known that any singular effects in terms of heterogeneity or geometry can reduce accuracy and convergence rate fig 6b proves that for classic methods due to heterogeneity while fig 13b presents it for cv iga due to geometry description thus convergence rate p is less than two for n 1 and 2 as well as less than four for n 3 and 4 if n is order of the fup basis functions fig 13b in that case significance of higher order basis functions is significantly reduced however many results from the iga community among others see recent results of garau and vazquez 2018 proved that l shape poisson problem with singular corners can be efficiently solved only by adaptive modelling using for example hierarchical b splines in that case hierarchical basis functions at higher resolution levels are only added in regions around two corners and optimal convergence rate can be obtained for all orders of basis functions only adaptation property of b splines and corresponding iga adaptive scheme enables significant improving of solving problems with discontinuities and singularities recently our numerical group developed hp adaptive cv iga procedure with hierarchical fup basis functions kamber et al 2020 however in this paper due to smooth cv iga lnk representation our main attention is to introduce this cv iga concept to the groundwater flow modeling in heterogeneous porous media emphasizing role of heterogeneity and calculation of smooth velocity field while adaptive flow analysis leaves for the further publications we can conclude that higher order fup spline basis functions need to be involved through the adaptive iga modelling in order to solve heterogeneity or geometry discontinuities and or singularities as pumping recharge points sharp transition zones or narrow discharge areas 5 conclusions in this paper we apply the cv iga framework which yields velocity field with all the desired properties that are indispensable for reliable transport simulations consider heterogeneous hydraulic conductivity as a lnk continuous function resolving all needed spatial heterogeneity scales convergence rate for velocity is optimal p n irrespective to the heterogeneity level if correlated log conductivity field 16 is defined as a continuous function yields a continuous velocity field eq 30 without numerical errors in the form of artificial discontinuities which implies reduction of numerical dispersion and ensures optimal convergence rate contrary to the classic methods such as modflow and fem yields continuous derivatives of the velocity field which enables rigorous treatment of the velocity dependent dispersion tensor needed for random walk transport simulations in this paper three iga formulations are compared although general properties of iga formulations are similar there are also important differences between them 1 g iga has an optimal convergence rate for head p n 1 and velocity p n if n is the fup or b spline order however g iga is the most expensive iga concept due to numerical integration of the stifness conductance matrix as well as the large number of non zero matrix members in each row 2n 3 ndim for fup and 2n 1 ndim for b splines if ndim represents the dimensionality of the problem 2 c iga has a suboptimal convergence rate for head p n for even and p n 1 for odd basis functions c iga has a suboptimal convergence rate for velocity p n 1 for odd and optimal convergence rate n for even basis functions c iga is significantly cheaper than g iga due to the absence of numerical integration of the conductance matrix as well as a significantly smaller number of non zero matrix members in each row n 1 ndim for fup and n ndim for b splines the main drawbacks of c iga are the absence of local and global mass balance and numerical oscillations in case of high heterogeneity and a large peclet grid number groundwater flow problem is regarded as an advection dispersion problem in the collocation strong formulation 3 cv iga has a suboptimal convergence rate for head p n for even basis functions however cv iga has an optimal convergence rate for head p n 1 for odd basis functions more important cv iga has an optimal convergence rate for velocity p n for all orders of basis functions with an accuracy very close to g iga cv iga lies between c iga and g iga with respect to computational cost convergence and accuracy cv iga has n 3 ndim for fup and n 2 ndim for b splines of non zero matrix members in each row and requires numerical integration of ndim 1 control volume boundary integrals that are much more cheaper than g iga cv iga exclusively has a local global mass balance property in comparison with two other iga concepts considering all three iga concepts cv iga is the most powerful candidate for groundwater flow modeling in heterogeneous porous media 4 fup basis functions and b splines of the same order have the same convergence rates for all three concepts and all mentioned cases because they are closely related to the approximation properties of polynomials fup basis functions always obtain better accuracy than b splines for the same order due to enhanced continuity properties however fup are more expensive than b splines because they include one more characteristic interval for the same order the choice of basis functions depends on the problem and required continuity future research can include the development of fully space and time adaptive kamber et al 2020 iga methods for efficient modeling of flow as well as for contaminant transport or saltwater intrusion which needs to involve a velocity dependent dispersion tensor with continuous velocity field and its derivatives e g gotovac et al 2007 finally resolving of singularities due to non smooth description of for example geometry pumping recharge or heterogeneity needs to be solved by using adaptive approaches with higher order spline basis functions declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research is funded by the croatian science foundation in croatian hrvatska zaklada za znanost hrzz through the scientific project groundwater flow modeling in karst aquifers grant number uip 2013 11 8103 this research is partially supported through project kk 01 1 1 02 0027 a project co financed by the croatian government and the european union through the european regional development fund the competitiveness and cohesion operational programme supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103838 appendix supplementary materials image application 1 
351,the momentum transfer across fluid interfaces in multi phase flow leads to a non negligible viscous coupling effect in this study we use the lattice boltzmann method lbm as a direct simulator to solve the three phase flow at pore scale the viscous coupling effects are investigated for various fluid configurations in simple pore geometries with different conditions in terms of saturation wettability and viscosity ratio it is found that the viscous coupling effect can be significant for certain configurations a parametric modification factor for conventional three phase conductance model is then proposed to estimate the viscous coupling effect the modification factor as a function of viscosity ratios can be easily incorporated into existing pore network model pnm to eliminate errors from viscous coupling effect moreover an elegant approach using machine learning technique is proposed to predict the multi phase permeability by a trained artificial neural network ann from the direct simulation database such data driven approach can be extended to develop a more sophisticated pnm for a better prediction of transport properties taking account of the viscous coupling effects keywords viscous coupling effect multiphase flow lattice boltzmann method porous media 1 introduction the pore scale behavior of multiphase flow in porous media is essential for many applications including oil recovery carbon dioxide storage and fuel cell optimization blunt et al 2013 the three phase flow behavior is of great importance in petroleum engineering due to the fact that many enhanced oil recovery eor processes such as water alternating gas injection steamflooding etc rely on the complicated phenomena of three phase systems oil water and gas modeling such multiphase flow at the porous scale is required to investigate detailed displacement mechanisms and transport behaviors various pore scale models have been developed to predict constitutive properties such as the relationship between permeability and the fluid saturation and the relationship between capillary pressure and the saturation blunt et al 2013 the pore scale models can be categorized as indirect and direct methods in the indirect method the pore spaces are represented by simple sphere or cube geometries which are connected by throats with idealized shapes bryant and blunt 1992 joekar niasar and hassanizadeh 2012 pore network modeling pnm fatt 1956 raoof and hassanizadeh 2012 blunt 2001 joekar niasar and hassanizadeh 2012 is a typical indirect method which solves simplified transport equations on idealized pore geometries several algorithms were proposed to generate proxy pore network models for 3d pore structure reconstructed from computed tomography images of reservoir rocks bakke et al 1997 dong and blunt 2009 pore network models have been used as a popular tool because of their efficiency and ability to quickly estimate transport properties such as the relative permeability which is extremely time consuming to measure experimentally patzek et al 2000 successfully simulated drainage and imbibition processes in pore network models to predict multiphase flow properties three phase pore network modeling has also been developed decades ago fenwick et al 1998 hui and blunt 2000 piri and blunt 2005 the predictive capabilities of network models have improved such that they can also be used to calculate three phase relative permeability suicmez et al 2006 al dhahli et al 2012 the limitation of pore network modeling resided in the inaccuracy of empirical models and the extraction of the pore spaces due to such simplification of flow processes and pore space geometry some important phenomena such as viscous coupling has been neglected valvatne and blunt 2004 xie et al 2017 shams et al 2018 the viscous coupling effect is usually important as it influences the prediction accuracy of relative permeability curves ehrlich 1993 xie et al 2017 shams et al 2018 the experimental data also showed the importance of the viscous coupling during three phase flow in porous media dehghanpour et al 2011b 2011a dehghanpour et al 2011b measured the relative permeabilites of three phase flow and the observed flow coupling effect between water and oil is even stronger in three phase flow than two phase flow on the other hand the use of direct methods implies that we solve the physical governing equations on the exact realistic geometry of the porous media at the pore scale therefore it is possible to accurately capture the missing physical phenomena in pnm if the correct governing equations are selected and solved properly numerical schemes such as finite element yang et al 2019 white et al 2006 finite volume raeini et al 2012 2014 2015 and lattice boltzmann methods lbm boek and venturoli 2010 jiang and tsuji 2015 tsuji et al 2016 jiang and tsuji 2017 shah et al 2017 zacharoudiou et al 2017 fakhari et al 2018 saito et al 2017 2018 leclaire et al 2017 have been used for the direct simulations the lbm is the most popular method for capturing the multiphase fluid transport in porous media because of its simplicity in treating complex pore geometry coupled with interfacial phenomena and thermodynamics huang and lu 2009 liu et al 2014 jiang and tsuji 2015 liu et al 2016 zacharoudiou and boek 2016 jiang and tsuji 2017 chen et al 2018 fakhari et al 2018 however the lbm as well as other direct simulation approach are extremely computationally expensive this will cause some difficulties to compute properties at large rev representative elementary volume sizes of rock samples at the mm to cm scale parallel computation techniques have been comprehensively used to improve the computational efficiency and scalability chen et al 2019 gao et al 2015 wang et al 2005 however such simulations still require large computational resources such as super computers as a more practical and applicable solution the combination of direct numerical simulation and pore network modeling is considered to be a good approach for multiphase flow properties prediction in this work we developed an improved conductance model for the pnm using data derived from direct pore scale lbm simulations the improved model is proposed to incorporate important viscous coupling effects for multiphase flow conditions the viscous coupling effects which are neglected in pnms have been proven to have a substantial influence on multiphase flow processes li et al 2005 huang and lu 2009 xie et al 2017 shams et al 2018 li et al 2005 found that the interfacial area between fluids strongly affects the permeability indicating that the common extension of darcy s law cannot capture flow properties accurately huang and lu 2009 investigated viscous coupling effects by simulating co and countercurrent steady state two phase flow and found that viscous coupling effects are strongly related to the saturation distribution xie et al 2017 proposed an improved empirical function by introducing a correction factor to include the viscous coupling effect into pnm and achieved better predictions of relative permeability shams et al 2018 presented a simple parametric model for the hydraulic conductance as a function of the geometry and viscosity ratio to account for viscous coupling effects however most of all these models are developed for two phase flow frameworks regarding the conductance model of the three phase flow al futaisi et al 2002 used a finite element method to solve the three phase creeping flow in angular capillaries and adopted a regression method to model hydraulic conductance however they ignored the continuity conditions of velocity and shear stress along the interfaces and a prescribed interface shape is required to consider the momentum transfer at the interface we use the lbm to simulate three phase flow at the pore scale with various geometric parameters and viscosity ratios because lbm is able to naturally satisfy the continuity conditions of velocity and shear stress and is more flexible in handling the contact angles the dependence of viscous coupling effects on these parameters is then investigated furthermore an improved empirical correlation for the conductance is developed by introducing a modification factor as a function of viscosity ratio in the conventional three phase conductance model piri 2003 incorporating the viscous coupling effect finally machine learning techniques have been used to predict the permeability of three phase flow considering the viscous coupling effect in pore throat by a trained artificial neural network ann we use the lb direction simulations to generate a database with a set of input parameters including the viscosity ratios for training these two newly proposed models can be incorporated into pnm for a better prediction of transport properties with the consideration of viscous coupling effects 2 methodology 2 1 empirical equations of pore network model in pore network models the conductance g a is the key parameter to compute the absolute and relative permeability valvatne and blunt 2004 using the conductance g a the local flow rate q i j a fig 1 of the phase a between two connected pores i and j can be given by darcy s law 1 q ij a g ij a p ij where p i j is the pressure gradient of fluid a between adjacent pores i and j fig 1 since the exact analytic solution for conductance is generally unknown several empirical expressions have been developed for different fluid configurations and different pore geometries piri 2003 depending on the number of phases coexisting in the pore the conductance g a is determined accordingly the single phase conductance is given by 2 g λ a 2 g μ in which parameter λ is 0 5 0 6 and 0 5623 for circular triangular and square elements respectively xie et al 2017 in eq 2 g is the shape factor μ is the dynamic viscosity and a is the cross sectional area for two phase flow the conductance of each phase must be calculated depending on the fluid occupation for fluids occupying the corner and layer area valvatne and blunt 2004 developed empirical expressions as 3 g c c a c 2 g c μ c 4 g l b 0 4 g l μ l where subscripts c and l represent the corner and layer configurations respectively a c is the area of the corner phase and parameters c and g c are determined by the corner fluid geometry while b 0 and g l are related to the layer fluid geometry for three phase flow hui and blunt 2000 proposed the following expressions to compute the conductance of wetting corner and spreading sandwiched layers for a three phase coexisting pore corner fig 2 the conductance of the corner phase can be estimated by 5 g c a c 2 1 sin α 2 φ 2 cos θ φ 1 φ 3 2 12 μ sin 2 α 1 φ 3 2 φ 2 f φ 1 2 θ i π 2 α 6 g c a c 2 tan α 1 sin α 2 φ 3 2 12 μ sin 2 α 1 φ 3 1 f φ 3 2 θ i π 2 α 7 φ 1 π 2 α θ 8 φ 2 cot α cos θ sin θ 9 φ 3 π 2 α tan α where θ θ i and α is the corner angle the conductance of the sandwiched phase can be estimated by 10 g l a 1 3 1 sin α 2 tan α φ 3 2 12 μ a c sin 2 α 1 φ 3 1 f 1 φ 3 1 f 2 φ 3 a 2 a cl 2 where the parameters a 1 and a 2 are the areas of sandwiched phase and corner phase respectively a c l is a summation of areas of corner and sandwiched phase the empirical equations of conductance for two phase flow eq 3 and eq 4 completely neglect the viscous coupling which means flow in each phase is independent of the other phase xie et al 2017 proposed a modification factor correcting the original empirical equations to include the viscous coupling effect here in the case of three phase flow there is a parameter f in eq 6 which implicitly reflects the viscous coupling effect between each phase f 1 represents a no flow boundary condition completely neglecting the viscous coupling effect while f 0 represents a free slip boundary condition no flow boundary condition means that the interface is treated as a solid boundary and the velocity of each phase at the interface is forced to be zero no slip free slip boundary condition indicates that the interface is treated as a perfectly lubricated boundary fluid can slip freely at the interface both of these two conditions are unrealistic because continuity of velocity and shear stress along the interface must be satisfied to consider the momentum exchange at the interface for the equation of the sandwiched phase s conductance eq 10 two parameters f 1 and f 2 are involved because there are two interfaces layer center interface and corner layer interface to quantify the viscous coupling effect instead of using the constant value for the parameters f f 1 and f 2 we try to develop a function of viscosities of the three phases for determining the values of f f 1 and f 2 in order to improve the accuracy of empirical equations 2 2 direct pore scale simulation method for three phase flow to develop an improved conductance model we use direct pore scale simulation method to provide the details of three phase flow then we could derive similar modification factors xie et al 2017 from the detailed direct numerical simulation results here we adopt a color gradient three phase lb model liu et al 2016 jiang and tsuji 2017 leclaire et al 2013 as the direct pore scale flow solver in this method the three phase flow is solved in an integrated manner and the shape of the interfaces is determined by the fundamental physical parameters e g wettability and surface tension in lbm particle distribution functions pdf f i k x t are introduced to represent three different fluids where i and k denote the velocity direction and phase respectively the evolution of f i k x t is governed by the following lb equation 11 f i k x e i δ t t δ t f i k x t ω i k x t where e i is the lattice velocity in the i th direction and δ t is the time step ω i k denotes the collision operator 12 ω i k ω i k 3 ω i k 1 ω i k 2 where ω i k 1 is the single phase collision operator ω i k 2 is the multiphase collision operator for perturbation which generates interfacial tensions and ω i k 3 is the multiphase collision operator for the phase segregation those collision operators are given as 13 ω i k 1 f i k f i k m 1 s m f i k f i k eq 14 ω i k 2 f i k f i k l l k a kl 2 g kl w i g kl e i 2 g kl 2 b i 15 ω i k 3 f i k ρ k ρ f i i k k β kl ρ k ρ l ρ 2 cos φ i kl f i eq ρ 0 to improve the numerical stability and remove the uncertainty due to viscosity dependence pan et al 2006 the multiple relaxation time mrt operator d humieres 1992 of the single phase lb model is adopted here as the first sub operator ω i k 1 the m matrix transforms the particle distributions into moment space which is given by tölke 2002 and then distribution functions are relaxed towards a local equilibrium f i e q with a diagonal matrix of relaxation coefficients s the equilibrium f i e q is a function of density and velocity which can be found in reis and phillips 2007 jiang and tsuji 2017 the relaxation coefficients s are determined according to the fluid s kinematic viscosity ν and numerical stability considerations kuwata and suga 2015 in eq 14 w i is the weights depending on the lattice type and b i is the parameter related to the lattice speed in this paper we choose d3q19 three dimensional 19 velocity lattice with b 0 1 3 w 0 1 3 w 1 6 b 1 6 1 18 and w 7 18 b 7 18 1 36 liu et al 2012 in the second perturbation operator ω i k 2 f i k a k l is related to the interfacial tension between k l fluid interfaces g k l is the color gradient indicating the normal direction of k l fluid interfaces which can be calculated from the density field as leclaire et al 2013 16 g kl ρ l ρ ρ k ρ ρ k ρ ρ l ρ in the above equation the gradient operator for an arbitrary variable ϕ is approximated by liu et al 2012 saito et al 2018 leclaire et al 2011 17 ϕ x t 3 c 2 i w i e i ϕ x e i δ t t to promote phase segregation and maintain a sharp interface leclaire et al 2012 a third recoloring operator ω i k 3 f i k has to be applied in the recolor operator f i denotes the post perturbation value of the total particle distribution function and β k l is a parameter latva kokko and rothman 2005 controlling the thickness of the k l interface taking a value of between 0 and 1 the β k l is set to be 0 8 for all the simulations in this study and the interface thickness is around 5 lattices when the viscosities of the fluids are different an interpolation is applied to calculate the viscosities in the interfacial region leclaire et al 2013 as a result the smooth transition of interfacial viscosities can be obtained and the continuity conditions of velocity and shear stress at the interface are naturally ensured φ i k l indicates the angle between the color gradient g k l and the lattice direction vector e i the f i e q ρ 0 is the equilibrium function calculated with a zero velocity finally the macroscopic flow properties including density ρ and velocity u can be calculated as 18 ρ k ρ k ρ k i f i k ρ u i k f i k e i 2 3 validation 2 3 1 three phase co current flow between parallel plates for immiscible three phase flows in porous media a typical scenario is that the wetting fluid attaches and moves along the solid surface forming a wetting layer therefore we first investigated a layered three phase co current flow in a straight channel fig 3 to validate the numerical method and confirm the viscous coupling effects the fluid 1 flows in the center while fluid 3 flows along the upper and lower plates the sandwiched fluid 2 lays in between fluid 1 and fluid 3 the distance between the upper and lower plates is 2 h the coordinates of the interface between fluid 1 and 2 are a while the coordinates of the interface between fluid 2 and 3 are b the governing equations of fluid flow for each phase are given by 19 μ l 2 u l p l where subscript l represents the different phase l 1 2 3 μ is the viscosity and p is the pressure the u l y are the velocities of each phase the boundary conditions are 20 u 1 y a u 2 y a u 2 y b u 3 y b u 3 y h 0 21 u 1 y y 0 0 μ 1 u 1 y y a μ 2 u 2 y y a μ 2 u 2 y y b μ 3 u 3 y y b the theoretical cross sectional velocity distribution can be obtained by solving the above equations 22 0 y a u 1 a 1 y 2 c 1 a y b u 2 a 2 y 2 b 2 y c 2 b y h u 3 a 3 y 2 b 3 y c 3 where 23 a 1 0 5 p 1 μ 1 a 2 0 5 p 2 μ 2 a 3 0 5 p 3 μ 3 24 b 2 2 a 2 a 2 μ 1 μ 2 a 1 a 25 b 3 2 a 3 b μ 2 μ 3 2 a 2 b b 2 26 c 3 a 3 h 2 b 3 h 27 c 2 a 3 a 2 b 2 b 3 b 2 b c 3 28 c 1 a 2 a 1 a 2 b 2 b c 2 the conductance of the three fluids can be calculated from the velocity distribution it is clear that the velocity profile of each phase is correlated to the viscosity ratio eq 22 which confirms the importance of the viscous coupling effect the analytical solution is usually difficult to obtain for other types of complex configurations therefore direct simulation by lattice boltzmann multiphase model is adopted to address the viscous coupling effect for those complex configurations numerical simulation tests are first performed by simulating this layered three phase co current flow the computation domain is set as 100 101 20 lattice sites periodic boundary conditions are applied on the x and z directions non slip boundary conditions at the top and bottom solid wall in y direction are implemented by using the bounce back scheme for simplicity the densities of the three phases are set to be identical the surface tension σ is chosen to be 0 01 in lattice unit a uniform pressure gradient along the flow direction p 1 p 2 p 3 p is applied on the whole domain in our simulation a body force of 10 6 in lattice unit is applied to mimic the pressure gradient two cases with different viscosity ratios are considered here case i with μ 1 μ 2 μ 3 1 2 4 and case ii with μ 1 μ 2 μ 3 1 5 25 after the systems reach the steady state the velocity profiles along y axes are shown in fig 4 for case i our simulation results showed a good agreement with the theoretical solution while for case ii the peak velocity of center layer phase obtained from lbm is about 4 3 lower than that of analytical one this small discrepancy may due to the large viscosity ratio it has been reported that high viscosity ratio decreases the accuracy of the model yang and boek 2013 these validation cases confirm the capability of our direct flow solver to account for the viscous coupling effect 2 3 2 viscous coupling effect on velocity distribution of triangular pore throat to investigate the effect of the center layer s viscosity on the velocity distribution in the cross section of triangular pore throat we performed three phase flow simulation on the fluid configuration illustrated in fig 5 a the triangle side length is 90 lattice sites we adjusted the viscosity of the center phase ν c e n while keeping the viscosities of the other two phases to an identical constant value ν i four cases with different viscosity ratios ν i ν c e n 1 1 3 1 5 and 1 10 are considered here the boundary conditions were set as the same with the above validation case in fig 6 we plotted velocity profiles along the center line of the cross sectional triangle for the cases with different viscosity ratios indeed the condition with ν i ν c e n 1 1 is equivalent with the situation of single phase flow it can be seen that the velocity of the center phase decreases substantially with the increase of its viscosity as a result the low velocity center phase will drag the layer fluid through the viscous shear force at the interface which reduces the permeability of the corner phase these results again demonstrated the importance of the viscous coupling effect the impact of viscosity variation of the center phase on the corner phase s velocities is relatively small this is because the shear force from the center phase has to be transmitted through the middle layer phase to the corner phase in this sandwich configuration and the corner phase s velocities are mainly determined by the non slip condition of the stationary wall 3 results and discussion in this section we use the three phase lbm model as a direct simulator to further examine the impact of the viscous coupling effect on the flow properties inside the pore throats of pnm with various configurations in pnm the cross section of individual pore throats are usually modeled as triangles and polygons piri 2003 here in addition to the equilateral triangle the often used square and right triangle are also considered in this study the fluid configuration in a pore throat corner of these three geometries are illustrated in fig 5 the square side length has 190 lattice sites the right triangle is composed of 30 and 60 angles with the shortest side which has a length of 210 lattice sites the length of the pore throat along the flow direction is 20 lattice sites bounce back boundary conditions are applied on all the walls and the periodic boundary conditions are applied on the flow direction all the simulations used the same pressure gradient meaning the same magnitude of driving force the driving force is set to be low enough to achieve a small capillary number 1 0 10 4 ca μ u σ where u denotes the mean velocity and the direction of interfacial tension force is always orthogonal to the direction of pressure gradient in our scenario therefore the interfaces are very stable in our simulations the empirical equation eq 6 indicates that the conductance depends on the parameters such as wettability contact angle corner half angle saturation of each phase areas and the viscosity ratios the corner phase conductance changes under various conditions combination of different viscosity ratio contact angles saturations and fluid configurations have been studied to quantify those parameters impacts on viscous coupling effects the other parameters including density ratio and interfacial tension ratio are set to be unity for simplicity 3 1 effect of pore throat geometries three geometries fig 5 are considered for the shape of cross section of pore throats these geometries contain different corner angles the wettability was set to be neutral for all the cases here which means the contact angles θ i θ i i 90 to investigate the viscous coupling effect on the conductance of corner phase we kept the viscosity of corner phase as a constant while adjusting the viscosities of the layer and center phases with different sets of viscosity ratio ν c o r ν l a y ν c e n 1 1 1 1 10 1 and ν c o r ν l a y ν c e n 1 1 1 1 1 10 first we individually adjusted the viscosity of the layer or center phase while fixing the other two phases viscosity increase of the viscosity of layer phase leads to a decrease of conductance of the corner phase red lines in fig 7 the same trend can be observed for the results of center phase s viscosity adjustment yellow lines in fig 7 however for all the cases the layer phase viscosity change has an obvious larger impact on the corner phase s flow rate compared with the center layer viscosity change the red curve is always below yellow curve in fig 7 and has a steeper gradient since the layer phase is adjacent to the corner phase the shear force change caused by the viscosity increase of the layer phase has a direct impact on the corner phase for the square geometry the viscosities of center phase and layer phase have a similar effect fig 7 b on the corner phase s conductance the difference between the red curve and yellow curve of 90 corner of square in fig 7 b is smaller than other cases with small corner angles for the right triangle geometry it is found that there is no strong influence of center phase s viscosity change on the corner phase s conductance when the corner angle is small yellow curve is almost horizontal in fig 7 c the magnitude of the total shear force of center phase transmitting to the corner fluid depends on the area of interface larger corner angle results in a wider area of interface therefore the effect of the center phase viscosity is much greater in the 90 corner while it is almost negligible in 30 corner in the case of the 30 corner the ratio of interfacial area to the whole fluid boundary is low therefore the shear force between center phase and the corner phase has a smaller contribution to the flow rate compared to the wall shear force from the no slip boundary condition we also estimated the flow rate for the conductance of corner phase using the empirical equation eq 6 recall that the parameter f implicitly reflects the viscosity coupling effect between each phase in the empirical equation eq 6 of the conductivity the f 0 1 can be seen as a measurement for slip effect at the interface f 1 means a no flow boundary condition while f 0 means a free slip boundary condition at the interface here f 0 corresponds to the case with identical viscosity viscosity ratio equals to 1 while f 1 corresponds to the case with infinite viscosity of layer and center phase viscosity ratio equals to 0 the possible results of corner phase s flow rate calculated by the conventional empirical equation eq 6 with the parameter f treated as a variable in the range of 0 1 are plotted in fig 7 as black line it is seen that the empirical equation underestimated the corner phase conductance for all cases compared with our results of direct simulations therefore the original empirical equation cannot capture the accurate viscous coupling effect to further investigate the relationship between the corner phase s conductance and viscosities of the other two phases we then run 100 simulations by fixing only the corner phase s viscosity and adjusting the viscosity of center together with that of layer phases with various combinations of viscosity ratios ν c o r ν l a y v c e n 1 1 1 1 10 10 the transition of the corner phase s conductance when increasing the viscosities of the other two phases fig 8 shows that the viscous coupling effects of both center and layer phases are significant for geometries with large corner angles fig 8 a and b while the center phase s viscosity change has only a small impact on the configuration of small corner angle fig 8 c the transition of corner phase s conductance shows a difference between the equilateral triangle and right triangle even if the corner angle is the same fig 8 a and d therefore the shape of cross section also has an impact on the viscous coupling effect a symmetrical cross section is favorable for the transmission of shear forces in the case of right triangle the center phase s viscosity has a smaller influence due to asymmetric shape of cross section 3 2 dependence on contact angle to investigate the viscous coupling effect under various contact angle conditions we adjusted the wettability of the solid wall to create three different configurations with different phase contact angles case i θ c l 60 θ l b 90 case ii θ c l 135 θ l b 135 case iii θ c l 90 θ l b 135 the subscript c l represents the interface between the corner and layer phase and l b denotes the interface between the layer and center bulk phase the equilibrium configurations of the three phases with different contact angles are displayed in fig 9 we independently increased the viscosities of layer phase and center phase respectively the simulated conductances of the corner phase with different sets of viscosity ratio ν c o r ν l a y v c e n 1 1 1 1 10 1 and ν c o r ν l a y v c e n 1 1 1 1 1 10 are shown in fig 9 the conductance of corner phase decreases with the increase of the other phases viscosities due to the viscous coupling effect the viscosity increase of the layer phase red lines in fig 9 has a greater impact on the corner phase s conductance than that of the center phase yellow lines in fig 9 these two kinds of trends are consistent with the above observation for the same reason discussed in section 3 1 viscous coupling effect arising from center phase viscosity showed dependence on the contact angle for case iii θ c l 90 θ l b 135 the center phase s viscosity change has a negligible effect on corner phase s conductance while the conductance of corner phase decreases faster for case i compared with case ii and iii yellow curves in fig 9 in case iii the layer phase forms a biconcave lens shape and the area of the layer phase is smaller compared with case i and ii such shape results in a lower velocity distribution and therefore lower shear force on the other hand the contact angle has little influence when changing the layer phase viscosity three red curves in fig 9almost collapse together the viscous coupling has to act through the interface whose effect is directly related to the length of the interface the lengths of the interface between corner and layer phases are almost the same for three cases the change of interfacial length caused by the variation of the corner phase s contact angle is limited here therefore only a very small impact on the viscous coupling effect can be observed 3 3 dependence on saturation to investigate the dependence of the viscosity coupling effect on the saturations of the three phases configurations with thinner thickness layer phase fig 10 b case ii and smaller area corner phase fig 10 c case iii are constructed based on the original case fig 10 a case i the wettability was set to neutral for all the three phases the saturations of corner phase for the three cases are s c i s c i i 0 056 s c i i i 0 027 and the saturations of layer phase for the three cases are s l i 0 102 s l i i 0 049 s l i i i 0 081 the results again showed that the viscosity change of the layer phase has an obvious larger impact on the conductance of the corner phase fig 10 increase of the ratio ν l a y ν c o r up to 10 results in a decrease of 50 for the corner phase s conductance while increasing the ratio ν c e n ν c o r leads to a decrease of roughly 10 20 for the corner phase s conductance this trend is similar to fig 9for the same reason that the shear force from layer directly acts on the corner phase through their shared interface the differences of the three curves for different saturation cases are small fig 10 note that the absolute conductance flow rate in the empirical equation eq 6 is related to the value of saturation here we focused on investigating the viscous coupling effect based on the normalized conductance g g i g b with g b being the base conductance calculated by using identical viscosity ratio and g i being the conductance calculated by various viscosity ratios the results of normalized conductance showed that the saturation variation has a small effect on the viscous coupling for the cases i and ii with the same saturation of corner phase an increase of the layer phase s saturation leads to a slightly bigger impact of viscous coupling effect from the layer phase if we further decrease the saturation of the corner phase the viscous coupling effect from the layer phase becomes stronger with regard to center phase viscosity adjustment our results of case ii showed the largest viscous coupling effect since the shear force from the center phase has to be transmitted across the layer phase the thinner layer phase shortens the distance between the corner phase and center phase in case ii therefore the propagation of the shear forces from the center phase to corner phase becomes easier 3 4 modification factor the above results show that the viscous coupling effect on predicting the transport properties is significant in the original model by hui and blunt 2000 the empirical equation is unable to match the results of direct simulation with a single constant parameter f which is related to the viscous coupling effect fig 8 here we try to extend the original model by incorporating the viscous coupling effect extracted from the direction simulations and improve the predication accuracy the results in section 3 2 and 3 3 indicated that viscous coupling effect was not very sensitive to wettability or saturations which is agreed with the finding in the reference xie et al 2017 the viscosity ratios has the largest impact on the conductance therefore we introduce a new function of the two viscosity ratios m 1 ν c o r ν l a y and m 2 ν l a y ν c e n to account the viscous coupling effect assuming the parameter f in the empirical equation eq 6 to be 0 we defined a reference value of conductance as 29 g c r a c 2 tan α 1 sin α 2 φ 3 2 12 μ sin 2 α 1 φ 3 then we propose a new conductance model by correcting the reference value through a modification factor f c v m 1 m 2 to approach the results of direct simulations as 30 g c g c r f c v m 1 m 2 a c 2 tan α 1 sin α 2 φ 3 2 12 μ sin 2 α 1 φ 3 f c v m 1 m 2 to propose an expression for this function we use second order polynomial model expressed by two variables m 1 and m 2 as follow 31 f c v m 1 m 2 a c m 1 b c m 2 c c m 1 m 2 d c m 1 2 e c m 2 2 h c the six constant parameters a c h c are determined by a least squares algorithm to fit with the data from direct simulations f c s i m v g c s i m g c r the obtained parameters are listed in table 1 the modification factors calculated by eq 31 using the obtained parameters surfaces in fig 11 showing a very good agreement with the simulation results dots in fig 11 therefore the proposed new conductance model with this modification factor eq 30 is able to capture the viscous coupling effects under different viscosity ratio conditions here the modification factor is considered to be independent to the wettability and saturation because the viscous coupling effect was not very sensitive to these parameters the proposed modification factor is indeed a relative ratio between the conductance predicted under three phase condition with viscous coupling effect and that under single phase state with free slip interface condition the relationship between conductance and wettability as well as saturation is already included in the reference function eq 29 this modification factor may show dependence if the contact angle or saturation is extremely high or low however for most of values of wettability and saturation such dependence can be neglected xie et al 2017 based on the same procedure we propose the modification factor f l v for the layer phase s conductance the base reference value g l r for layer phase s conductance without viscous coupling effect is defined from the original equation eq 10 with f 1 f 2 0 32 g l r a 1 3 1 sin α 2 tan α φ 3 2 12 μ a cl sin 2 α 1 φ 3 1 a 2 a cl 2 similarly the layer phase s conductance can be corrected by the modification factor f l v to include viscous coupling effect 33 g l g l r f l v m 3 m 4 where viscosity ratios are defined as m 3 ν c o r ν l a y and m 4 ν c e n ν l a y again the polynomial type of modification function is used 34 f l v m 3 m 4 a l m 3 b l m 4 c l m 3 m 4 d l m 3 2 e l m 4 2 h l the six constant parameters a l h l obtained by fitting the function to data from direct simulations using least squares algorithm are shown in table 2 the obtained modification factors showed a very good performance compared with the simulation results fig 12 these modification factors can be used to improve the original pore network model for a better performance of predicting the transport parameters by incorporating the viscous coupling effect 3 5 a general data driven machine learning model for permeability the above modification factor is proposed as a correction for the original empirical equation for conductance for a practical application a data driven way to predict the multiphases permeability considering the viscous coupling effect is further proposed based on the data obtained from direct simulations the machine learning method was adopted to develop a fast and accurate model for permeability machine learning methods provide a function using a set of neurons and weights to express the relationship between inputs and outputs alpaydin 2014 here the levenberg marquardt algorithm is used as the optimizer to train an artificial neural network ann to predict the permeability output based on the properties in terms of three phases configuration throat s geometry viscosity ratios and etc inputs levenberg marquardt is an iterative algorithm to find the minimum of a loss function taking the form of a sum of squared errors marquardt 1963 lourakis et al 2005 this algorithm is an efficient tool to optimize weights and biases of a neural network approach in a second order training speed without having to compute the hessian matrix hagan martin and menhaj mohammad 1994 yu and wilamowski 2011 rabbani and babaei 2019 in this study we adopted a fully connected neural network with one hidden layer fig 13 the optimal size of the hidden layer is usually a prior unknown variable therefore two ann architectures with different number of nodes ann1 6 nodes ann2 7 nodes in the hidden layer were considered here both anns have 8 input parameters and one output of the permeability we considered 8 input parameters which include corner angle α contact angle between corner and layer phases θ i contact angle between layer and center phases θ i i mean distance d m of the cross area s shape saturation of corner phase s c saturation of layer phase s l viscosity ratio m 1 and viscosity ratio m 2 fig 13 here the mean distance d m is obtained by calculating the average of the euclidean distance map of the pixel based cross section rabbani and babaei 2019 the euclidean distance of a void space means the distance from the void pixel to the nearest solid pixel the mean distance parameter was adopted here because it reflects the topological feature of cross section s shape and is highly correlated with the permeability rabbani and babaei 2019 and the above modification factor also showed a heavy dependence on the shape of cross section training of this neural network was conducted by using the nftool function in deep learning toolbox of matlab to train the neural networks we built a database composed of 3200 entries using different combinations of input parameters presented in section 3 1 3 3 for various situations we take 70 of them for training 15 for validation and 15 for testing then the mean squared error mse and coefficient of determination r 2 are calculated to evaluate the training performance fig 14 and 15 showed the relationships between the original data from direction simulations and predicted results by the anns for the permeabilities of corner phase and layer phase respectively the results of ann1 with 6 node hidden layer is more scattered than that of the ann2 with 7 node hidden layer the learning performance of ann1 and ann2 are provided in table 3 and 4 in terms of mean squared error mse and coefficient of determination r 2 these results quantitively demonstrated a better prediction performance of ann2 the ann2 with 7 node hidden layer is able to perfectly calculate the permeability of multiphase flow in pore throat with the given 8 input parameters further increasing the size of hidden layer may lead to over fitting therefore the optimized size of the hidden layer must be 7 nodes for our proposed neural network model finally an explicit function in supplementary material can be extracted from this trained neural network and then coupled into the pnm to improve the accuracy of permeability calculation by incorporating the advantages of direct simulations with the viscous coupling effect 4 conclusion in this study the viscous coupling effects in three phase flow through pore throat channels have been studied by using the multiphase lbm direct simulation under various conditions with different saturations wettability and fluid configurations the results indicate that the viscous coupling effect during simultaneous flow of different fluid phases has a significant impact on the hydraulic conductance of fluid layers occupying the corner areas this viscous coupling effect is heavily correlated to the shape of cross section and the length of interface across which the momentum transfers our direct simulation results show that the geometric parameters such as corner angle and the viscosity ratios largely affect the viscous coupling effects we have also demonstrated that the conventional empirical equation derived using free slip and no flow boundary fails to capture the correct conductance for a range of viscosity ratios a modification factor which is expressed as a function of viscosity ratios is proposed to correct the original empirical equation to include the viscous coupling effect with this modification factor the results calculated by the corrected equation agree well with the data from direct simulations we further proposed a more elegant way to predict the permeability of three phase flow in pore throat tubes by using the machine learning method two anns with different nodes of hidden layer were trained by a database built from the results of direct simulations using different combinations of 8 inputs including various geometric parameters wettability and viscosity ratios the results showed that the ann with 7 node hidden layer provide a perfect capability of estimating the permeabilities with coefficient of determination r 2 higher than 0 99 these two proposed new models can be directly incorporated into pore network modeling for predicting flow transport properties with the viscous coupling effect for large core scale model though the present study only considered the straight pore throat tubes our approach can be easily extended to deal with more complicated shape of pore throats the coupling of direction simulation and pore network modeling through this way has a great potential to improve the accuracy of pore network modeling by incorporating more detailed pore scale information while still maintaining good computational efficiency credit authorship contribution statement fei jiang conceptualization methodology software investigation writing original draft jianhui yang conceptualization investigation resources writing review editing edo boek writing review editing takeshi tsuji writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this work was supported by jsps kakenhi grant numbers 19k15100 20k20948 the authors would like to acknowledge the support of the i2cner which is sponsored by the world premier international research center initiative wpi ministry of education culture sports science and technology mext japan supplementary material the training data are provided and the trained neural networks are given as explicit functions in the repository https github com fjiang cloud viscouscouple supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103797 appendix a supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
351,the momentum transfer across fluid interfaces in multi phase flow leads to a non negligible viscous coupling effect in this study we use the lattice boltzmann method lbm as a direct simulator to solve the three phase flow at pore scale the viscous coupling effects are investigated for various fluid configurations in simple pore geometries with different conditions in terms of saturation wettability and viscosity ratio it is found that the viscous coupling effect can be significant for certain configurations a parametric modification factor for conventional three phase conductance model is then proposed to estimate the viscous coupling effect the modification factor as a function of viscosity ratios can be easily incorporated into existing pore network model pnm to eliminate errors from viscous coupling effect moreover an elegant approach using machine learning technique is proposed to predict the multi phase permeability by a trained artificial neural network ann from the direct simulation database such data driven approach can be extended to develop a more sophisticated pnm for a better prediction of transport properties taking account of the viscous coupling effects keywords viscous coupling effect multiphase flow lattice boltzmann method porous media 1 introduction the pore scale behavior of multiphase flow in porous media is essential for many applications including oil recovery carbon dioxide storage and fuel cell optimization blunt et al 2013 the three phase flow behavior is of great importance in petroleum engineering due to the fact that many enhanced oil recovery eor processes such as water alternating gas injection steamflooding etc rely on the complicated phenomena of three phase systems oil water and gas modeling such multiphase flow at the porous scale is required to investigate detailed displacement mechanisms and transport behaviors various pore scale models have been developed to predict constitutive properties such as the relationship between permeability and the fluid saturation and the relationship between capillary pressure and the saturation blunt et al 2013 the pore scale models can be categorized as indirect and direct methods in the indirect method the pore spaces are represented by simple sphere or cube geometries which are connected by throats with idealized shapes bryant and blunt 1992 joekar niasar and hassanizadeh 2012 pore network modeling pnm fatt 1956 raoof and hassanizadeh 2012 blunt 2001 joekar niasar and hassanizadeh 2012 is a typical indirect method which solves simplified transport equations on idealized pore geometries several algorithms were proposed to generate proxy pore network models for 3d pore structure reconstructed from computed tomography images of reservoir rocks bakke et al 1997 dong and blunt 2009 pore network models have been used as a popular tool because of their efficiency and ability to quickly estimate transport properties such as the relative permeability which is extremely time consuming to measure experimentally patzek et al 2000 successfully simulated drainage and imbibition processes in pore network models to predict multiphase flow properties three phase pore network modeling has also been developed decades ago fenwick et al 1998 hui and blunt 2000 piri and blunt 2005 the predictive capabilities of network models have improved such that they can also be used to calculate three phase relative permeability suicmez et al 2006 al dhahli et al 2012 the limitation of pore network modeling resided in the inaccuracy of empirical models and the extraction of the pore spaces due to such simplification of flow processes and pore space geometry some important phenomena such as viscous coupling has been neglected valvatne and blunt 2004 xie et al 2017 shams et al 2018 the viscous coupling effect is usually important as it influences the prediction accuracy of relative permeability curves ehrlich 1993 xie et al 2017 shams et al 2018 the experimental data also showed the importance of the viscous coupling during three phase flow in porous media dehghanpour et al 2011b 2011a dehghanpour et al 2011b measured the relative permeabilites of three phase flow and the observed flow coupling effect between water and oil is even stronger in three phase flow than two phase flow on the other hand the use of direct methods implies that we solve the physical governing equations on the exact realistic geometry of the porous media at the pore scale therefore it is possible to accurately capture the missing physical phenomena in pnm if the correct governing equations are selected and solved properly numerical schemes such as finite element yang et al 2019 white et al 2006 finite volume raeini et al 2012 2014 2015 and lattice boltzmann methods lbm boek and venturoli 2010 jiang and tsuji 2015 tsuji et al 2016 jiang and tsuji 2017 shah et al 2017 zacharoudiou et al 2017 fakhari et al 2018 saito et al 2017 2018 leclaire et al 2017 have been used for the direct simulations the lbm is the most popular method for capturing the multiphase fluid transport in porous media because of its simplicity in treating complex pore geometry coupled with interfacial phenomena and thermodynamics huang and lu 2009 liu et al 2014 jiang and tsuji 2015 liu et al 2016 zacharoudiou and boek 2016 jiang and tsuji 2017 chen et al 2018 fakhari et al 2018 however the lbm as well as other direct simulation approach are extremely computationally expensive this will cause some difficulties to compute properties at large rev representative elementary volume sizes of rock samples at the mm to cm scale parallel computation techniques have been comprehensively used to improve the computational efficiency and scalability chen et al 2019 gao et al 2015 wang et al 2005 however such simulations still require large computational resources such as super computers as a more practical and applicable solution the combination of direct numerical simulation and pore network modeling is considered to be a good approach for multiphase flow properties prediction in this work we developed an improved conductance model for the pnm using data derived from direct pore scale lbm simulations the improved model is proposed to incorporate important viscous coupling effects for multiphase flow conditions the viscous coupling effects which are neglected in pnms have been proven to have a substantial influence on multiphase flow processes li et al 2005 huang and lu 2009 xie et al 2017 shams et al 2018 li et al 2005 found that the interfacial area between fluids strongly affects the permeability indicating that the common extension of darcy s law cannot capture flow properties accurately huang and lu 2009 investigated viscous coupling effects by simulating co and countercurrent steady state two phase flow and found that viscous coupling effects are strongly related to the saturation distribution xie et al 2017 proposed an improved empirical function by introducing a correction factor to include the viscous coupling effect into pnm and achieved better predictions of relative permeability shams et al 2018 presented a simple parametric model for the hydraulic conductance as a function of the geometry and viscosity ratio to account for viscous coupling effects however most of all these models are developed for two phase flow frameworks regarding the conductance model of the three phase flow al futaisi et al 2002 used a finite element method to solve the three phase creeping flow in angular capillaries and adopted a regression method to model hydraulic conductance however they ignored the continuity conditions of velocity and shear stress along the interfaces and a prescribed interface shape is required to consider the momentum transfer at the interface we use the lbm to simulate three phase flow at the pore scale with various geometric parameters and viscosity ratios because lbm is able to naturally satisfy the continuity conditions of velocity and shear stress and is more flexible in handling the contact angles the dependence of viscous coupling effects on these parameters is then investigated furthermore an improved empirical correlation for the conductance is developed by introducing a modification factor as a function of viscosity ratio in the conventional three phase conductance model piri 2003 incorporating the viscous coupling effect finally machine learning techniques have been used to predict the permeability of three phase flow considering the viscous coupling effect in pore throat by a trained artificial neural network ann we use the lb direction simulations to generate a database with a set of input parameters including the viscosity ratios for training these two newly proposed models can be incorporated into pnm for a better prediction of transport properties with the consideration of viscous coupling effects 2 methodology 2 1 empirical equations of pore network model in pore network models the conductance g a is the key parameter to compute the absolute and relative permeability valvatne and blunt 2004 using the conductance g a the local flow rate q i j a fig 1 of the phase a between two connected pores i and j can be given by darcy s law 1 q ij a g ij a p ij where p i j is the pressure gradient of fluid a between adjacent pores i and j fig 1 since the exact analytic solution for conductance is generally unknown several empirical expressions have been developed for different fluid configurations and different pore geometries piri 2003 depending on the number of phases coexisting in the pore the conductance g a is determined accordingly the single phase conductance is given by 2 g λ a 2 g μ in which parameter λ is 0 5 0 6 and 0 5623 for circular triangular and square elements respectively xie et al 2017 in eq 2 g is the shape factor μ is the dynamic viscosity and a is the cross sectional area for two phase flow the conductance of each phase must be calculated depending on the fluid occupation for fluids occupying the corner and layer area valvatne and blunt 2004 developed empirical expressions as 3 g c c a c 2 g c μ c 4 g l b 0 4 g l μ l where subscripts c and l represent the corner and layer configurations respectively a c is the area of the corner phase and parameters c and g c are determined by the corner fluid geometry while b 0 and g l are related to the layer fluid geometry for three phase flow hui and blunt 2000 proposed the following expressions to compute the conductance of wetting corner and spreading sandwiched layers for a three phase coexisting pore corner fig 2 the conductance of the corner phase can be estimated by 5 g c a c 2 1 sin α 2 φ 2 cos θ φ 1 φ 3 2 12 μ sin 2 α 1 φ 3 2 φ 2 f φ 1 2 θ i π 2 α 6 g c a c 2 tan α 1 sin α 2 φ 3 2 12 μ sin 2 α 1 φ 3 1 f φ 3 2 θ i π 2 α 7 φ 1 π 2 α θ 8 φ 2 cot α cos θ sin θ 9 φ 3 π 2 α tan α where θ θ i and α is the corner angle the conductance of the sandwiched phase can be estimated by 10 g l a 1 3 1 sin α 2 tan α φ 3 2 12 μ a c sin 2 α 1 φ 3 1 f 1 φ 3 1 f 2 φ 3 a 2 a cl 2 where the parameters a 1 and a 2 are the areas of sandwiched phase and corner phase respectively a c l is a summation of areas of corner and sandwiched phase the empirical equations of conductance for two phase flow eq 3 and eq 4 completely neglect the viscous coupling which means flow in each phase is independent of the other phase xie et al 2017 proposed a modification factor correcting the original empirical equations to include the viscous coupling effect here in the case of three phase flow there is a parameter f in eq 6 which implicitly reflects the viscous coupling effect between each phase f 1 represents a no flow boundary condition completely neglecting the viscous coupling effect while f 0 represents a free slip boundary condition no flow boundary condition means that the interface is treated as a solid boundary and the velocity of each phase at the interface is forced to be zero no slip free slip boundary condition indicates that the interface is treated as a perfectly lubricated boundary fluid can slip freely at the interface both of these two conditions are unrealistic because continuity of velocity and shear stress along the interface must be satisfied to consider the momentum exchange at the interface for the equation of the sandwiched phase s conductance eq 10 two parameters f 1 and f 2 are involved because there are two interfaces layer center interface and corner layer interface to quantify the viscous coupling effect instead of using the constant value for the parameters f f 1 and f 2 we try to develop a function of viscosities of the three phases for determining the values of f f 1 and f 2 in order to improve the accuracy of empirical equations 2 2 direct pore scale simulation method for three phase flow to develop an improved conductance model we use direct pore scale simulation method to provide the details of three phase flow then we could derive similar modification factors xie et al 2017 from the detailed direct numerical simulation results here we adopt a color gradient three phase lb model liu et al 2016 jiang and tsuji 2017 leclaire et al 2013 as the direct pore scale flow solver in this method the three phase flow is solved in an integrated manner and the shape of the interfaces is determined by the fundamental physical parameters e g wettability and surface tension in lbm particle distribution functions pdf f i k x t are introduced to represent three different fluids where i and k denote the velocity direction and phase respectively the evolution of f i k x t is governed by the following lb equation 11 f i k x e i δ t t δ t f i k x t ω i k x t where e i is the lattice velocity in the i th direction and δ t is the time step ω i k denotes the collision operator 12 ω i k ω i k 3 ω i k 1 ω i k 2 where ω i k 1 is the single phase collision operator ω i k 2 is the multiphase collision operator for perturbation which generates interfacial tensions and ω i k 3 is the multiphase collision operator for the phase segregation those collision operators are given as 13 ω i k 1 f i k f i k m 1 s m f i k f i k eq 14 ω i k 2 f i k f i k l l k a kl 2 g kl w i g kl e i 2 g kl 2 b i 15 ω i k 3 f i k ρ k ρ f i i k k β kl ρ k ρ l ρ 2 cos φ i kl f i eq ρ 0 to improve the numerical stability and remove the uncertainty due to viscosity dependence pan et al 2006 the multiple relaxation time mrt operator d humieres 1992 of the single phase lb model is adopted here as the first sub operator ω i k 1 the m matrix transforms the particle distributions into moment space which is given by tölke 2002 and then distribution functions are relaxed towards a local equilibrium f i e q with a diagonal matrix of relaxation coefficients s the equilibrium f i e q is a function of density and velocity which can be found in reis and phillips 2007 jiang and tsuji 2017 the relaxation coefficients s are determined according to the fluid s kinematic viscosity ν and numerical stability considerations kuwata and suga 2015 in eq 14 w i is the weights depending on the lattice type and b i is the parameter related to the lattice speed in this paper we choose d3q19 three dimensional 19 velocity lattice with b 0 1 3 w 0 1 3 w 1 6 b 1 6 1 18 and w 7 18 b 7 18 1 36 liu et al 2012 in the second perturbation operator ω i k 2 f i k a k l is related to the interfacial tension between k l fluid interfaces g k l is the color gradient indicating the normal direction of k l fluid interfaces which can be calculated from the density field as leclaire et al 2013 16 g kl ρ l ρ ρ k ρ ρ k ρ ρ l ρ in the above equation the gradient operator for an arbitrary variable ϕ is approximated by liu et al 2012 saito et al 2018 leclaire et al 2011 17 ϕ x t 3 c 2 i w i e i ϕ x e i δ t t to promote phase segregation and maintain a sharp interface leclaire et al 2012 a third recoloring operator ω i k 3 f i k has to be applied in the recolor operator f i denotes the post perturbation value of the total particle distribution function and β k l is a parameter latva kokko and rothman 2005 controlling the thickness of the k l interface taking a value of between 0 and 1 the β k l is set to be 0 8 for all the simulations in this study and the interface thickness is around 5 lattices when the viscosities of the fluids are different an interpolation is applied to calculate the viscosities in the interfacial region leclaire et al 2013 as a result the smooth transition of interfacial viscosities can be obtained and the continuity conditions of velocity and shear stress at the interface are naturally ensured φ i k l indicates the angle between the color gradient g k l and the lattice direction vector e i the f i e q ρ 0 is the equilibrium function calculated with a zero velocity finally the macroscopic flow properties including density ρ and velocity u can be calculated as 18 ρ k ρ k ρ k i f i k ρ u i k f i k e i 2 3 validation 2 3 1 three phase co current flow between parallel plates for immiscible three phase flows in porous media a typical scenario is that the wetting fluid attaches and moves along the solid surface forming a wetting layer therefore we first investigated a layered three phase co current flow in a straight channel fig 3 to validate the numerical method and confirm the viscous coupling effects the fluid 1 flows in the center while fluid 3 flows along the upper and lower plates the sandwiched fluid 2 lays in between fluid 1 and fluid 3 the distance between the upper and lower plates is 2 h the coordinates of the interface between fluid 1 and 2 are a while the coordinates of the interface between fluid 2 and 3 are b the governing equations of fluid flow for each phase are given by 19 μ l 2 u l p l where subscript l represents the different phase l 1 2 3 μ is the viscosity and p is the pressure the u l y are the velocities of each phase the boundary conditions are 20 u 1 y a u 2 y a u 2 y b u 3 y b u 3 y h 0 21 u 1 y y 0 0 μ 1 u 1 y y a μ 2 u 2 y y a μ 2 u 2 y y b μ 3 u 3 y y b the theoretical cross sectional velocity distribution can be obtained by solving the above equations 22 0 y a u 1 a 1 y 2 c 1 a y b u 2 a 2 y 2 b 2 y c 2 b y h u 3 a 3 y 2 b 3 y c 3 where 23 a 1 0 5 p 1 μ 1 a 2 0 5 p 2 μ 2 a 3 0 5 p 3 μ 3 24 b 2 2 a 2 a 2 μ 1 μ 2 a 1 a 25 b 3 2 a 3 b μ 2 μ 3 2 a 2 b b 2 26 c 3 a 3 h 2 b 3 h 27 c 2 a 3 a 2 b 2 b 3 b 2 b c 3 28 c 1 a 2 a 1 a 2 b 2 b c 2 the conductance of the three fluids can be calculated from the velocity distribution it is clear that the velocity profile of each phase is correlated to the viscosity ratio eq 22 which confirms the importance of the viscous coupling effect the analytical solution is usually difficult to obtain for other types of complex configurations therefore direct simulation by lattice boltzmann multiphase model is adopted to address the viscous coupling effect for those complex configurations numerical simulation tests are first performed by simulating this layered three phase co current flow the computation domain is set as 100 101 20 lattice sites periodic boundary conditions are applied on the x and z directions non slip boundary conditions at the top and bottom solid wall in y direction are implemented by using the bounce back scheme for simplicity the densities of the three phases are set to be identical the surface tension σ is chosen to be 0 01 in lattice unit a uniform pressure gradient along the flow direction p 1 p 2 p 3 p is applied on the whole domain in our simulation a body force of 10 6 in lattice unit is applied to mimic the pressure gradient two cases with different viscosity ratios are considered here case i with μ 1 μ 2 μ 3 1 2 4 and case ii with μ 1 μ 2 μ 3 1 5 25 after the systems reach the steady state the velocity profiles along y axes are shown in fig 4 for case i our simulation results showed a good agreement with the theoretical solution while for case ii the peak velocity of center layer phase obtained from lbm is about 4 3 lower than that of analytical one this small discrepancy may due to the large viscosity ratio it has been reported that high viscosity ratio decreases the accuracy of the model yang and boek 2013 these validation cases confirm the capability of our direct flow solver to account for the viscous coupling effect 2 3 2 viscous coupling effect on velocity distribution of triangular pore throat to investigate the effect of the center layer s viscosity on the velocity distribution in the cross section of triangular pore throat we performed three phase flow simulation on the fluid configuration illustrated in fig 5 a the triangle side length is 90 lattice sites we adjusted the viscosity of the center phase ν c e n while keeping the viscosities of the other two phases to an identical constant value ν i four cases with different viscosity ratios ν i ν c e n 1 1 3 1 5 and 1 10 are considered here the boundary conditions were set as the same with the above validation case in fig 6 we plotted velocity profiles along the center line of the cross sectional triangle for the cases with different viscosity ratios indeed the condition with ν i ν c e n 1 1 is equivalent with the situation of single phase flow it can be seen that the velocity of the center phase decreases substantially with the increase of its viscosity as a result the low velocity center phase will drag the layer fluid through the viscous shear force at the interface which reduces the permeability of the corner phase these results again demonstrated the importance of the viscous coupling effect the impact of viscosity variation of the center phase on the corner phase s velocities is relatively small this is because the shear force from the center phase has to be transmitted through the middle layer phase to the corner phase in this sandwich configuration and the corner phase s velocities are mainly determined by the non slip condition of the stationary wall 3 results and discussion in this section we use the three phase lbm model as a direct simulator to further examine the impact of the viscous coupling effect on the flow properties inside the pore throats of pnm with various configurations in pnm the cross section of individual pore throats are usually modeled as triangles and polygons piri 2003 here in addition to the equilateral triangle the often used square and right triangle are also considered in this study the fluid configuration in a pore throat corner of these three geometries are illustrated in fig 5 the square side length has 190 lattice sites the right triangle is composed of 30 and 60 angles with the shortest side which has a length of 210 lattice sites the length of the pore throat along the flow direction is 20 lattice sites bounce back boundary conditions are applied on all the walls and the periodic boundary conditions are applied on the flow direction all the simulations used the same pressure gradient meaning the same magnitude of driving force the driving force is set to be low enough to achieve a small capillary number 1 0 10 4 ca μ u σ where u denotes the mean velocity and the direction of interfacial tension force is always orthogonal to the direction of pressure gradient in our scenario therefore the interfaces are very stable in our simulations the empirical equation eq 6 indicates that the conductance depends on the parameters such as wettability contact angle corner half angle saturation of each phase areas and the viscosity ratios the corner phase conductance changes under various conditions combination of different viscosity ratio contact angles saturations and fluid configurations have been studied to quantify those parameters impacts on viscous coupling effects the other parameters including density ratio and interfacial tension ratio are set to be unity for simplicity 3 1 effect of pore throat geometries three geometries fig 5 are considered for the shape of cross section of pore throats these geometries contain different corner angles the wettability was set to be neutral for all the cases here which means the contact angles θ i θ i i 90 to investigate the viscous coupling effect on the conductance of corner phase we kept the viscosity of corner phase as a constant while adjusting the viscosities of the layer and center phases with different sets of viscosity ratio ν c o r ν l a y ν c e n 1 1 1 1 10 1 and ν c o r ν l a y ν c e n 1 1 1 1 1 10 first we individually adjusted the viscosity of the layer or center phase while fixing the other two phases viscosity increase of the viscosity of layer phase leads to a decrease of conductance of the corner phase red lines in fig 7 the same trend can be observed for the results of center phase s viscosity adjustment yellow lines in fig 7 however for all the cases the layer phase viscosity change has an obvious larger impact on the corner phase s flow rate compared with the center layer viscosity change the red curve is always below yellow curve in fig 7 and has a steeper gradient since the layer phase is adjacent to the corner phase the shear force change caused by the viscosity increase of the layer phase has a direct impact on the corner phase for the square geometry the viscosities of center phase and layer phase have a similar effect fig 7 b on the corner phase s conductance the difference between the red curve and yellow curve of 90 corner of square in fig 7 b is smaller than other cases with small corner angles for the right triangle geometry it is found that there is no strong influence of center phase s viscosity change on the corner phase s conductance when the corner angle is small yellow curve is almost horizontal in fig 7 c the magnitude of the total shear force of center phase transmitting to the corner fluid depends on the area of interface larger corner angle results in a wider area of interface therefore the effect of the center phase viscosity is much greater in the 90 corner while it is almost negligible in 30 corner in the case of the 30 corner the ratio of interfacial area to the whole fluid boundary is low therefore the shear force between center phase and the corner phase has a smaller contribution to the flow rate compared to the wall shear force from the no slip boundary condition we also estimated the flow rate for the conductance of corner phase using the empirical equation eq 6 recall that the parameter f implicitly reflects the viscosity coupling effect between each phase in the empirical equation eq 6 of the conductivity the f 0 1 can be seen as a measurement for slip effect at the interface f 1 means a no flow boundary condition while f 0 means a free slip boundary condition at the interface here f 0 corresponds to the case with identical viscosity viscosity ratio equals to 1 while f 1 corresponds to the case with infinite viscosity of layer and center phase viscosity ratio equals to 0 the possible results of corner phase s flow rate calculated by the conventional empirical equation eq 6 with the parameter f treated as a variable in the range of 0 1 are plotted in fig 7 as black line it is seen that the empirical equation underestimated the corner phase conductance for all cases compared with our results of direct simulations therefore the original empirical equation cannot capture the accurate viscous coupling effect to further investigate the relationship between the corner phase s conductance and viscosities of the other two phases we then run 100 simulations by fixing only the corner phase s viscosity and adjusting the viscosity of center together with that of layer phases with various combinations of viscosity ratios ν c o r ν l a y v c e n 1 1 1 1 10 10 the transition of the corner phase s conductance when increasing the viscosities of the other two phases fig 8 shows that the viscous coupling effects of both center and layer phases are significant for geometries with large corner angles fig 8 a and b while the center phase s viscosity change has only a small impact on the configuration of small corner angle fig 8 c the transition of corner phase s conductance shows a difference between the equilateral triangle and right triangle even if the corner angle is the same fig 8 a and d therefore the shape of cross section also has an impact on the viscous coupling effect a symmetrical cross section is favorable for the transmission of shear forces in the case of right triangle the center phase s viscosity has a smaller influence due to asymmetric shape of cross section 3 2 dependence on contact angle to investigate the viscous coupling effect under various contact angle conditions we adjusted the wettability of the solid wall to create three different configurations with different phase contact angles case i θ c l 60 θ l b 90 case ii θ c l 135 θ l b 135 case iii θ c l 90 θ l b 135 the subscript c l represents the interface between the corner and layer phase and l b denotes the interface between the layer and center bulk phase the equilibrium configurations of the three phases with different contact angles are displayed in fig 9 we independently increased the viscosities of layer phase and center phase respectively the simulated conductances of the corner phase with different sets of viscosity ratio ν c o r ν l a y v c e n 1 1 1 1 10 1 and ν c o r ν l a y v c e n 1 1 1 1 1 10 are shown in fig 9 the conductance of corner phase decreases with the increase of the other phases viscosities due to the viscous coupling effect the viscosity increase of the layer phase red lines in fig 9 has a greater impact on the corner phase s conductance than that of the center phase yellow lines in fig 9 these two kinds of trends are consistent with the above observation for the same reason discussed in section 3 1 viscous coupling effect arising from center phase viscosity showed dependence on the contact angle for case iii θ c l 90 θ l b 135 the center phase s viscosity change has a negligible effect on corner phase s conductance while the conductance of corner phase decreases faster for case i compared with case ii and iii yellow curves in fig 9 in case iii the layer phase forms a biconcave lens shape and the area of the layer phase is smaller compared with case i and ii such shape results in a lower velocity distribution and therefore lower shear force on the other hand the contact angle has little influence when changing the layer phase viscosity three red curves in fig 9almost collapse together the viscous coupling has to act through the interface whose effect is directly related to the length of the interface the lengths of the interface between corner and layer phases are almost the same for three cases the change of interfacial length caused by the variation of the corner phase s contact angle is limited here therefore only a very small impact on the viscous coupling effect can be observed 3 3 dependence on saturation to investigate the dependence of the viscosity coupling effect on the saturations of the three phases configurations with thinner thickness layer phase fig 10 b case ii and smaller area corner phase fig 10 c case iii are constructed based on the original case fig 10 a case i the wettability was set to neutral for all the three phases the saturations of corner phase for the three cases are s c i s c i i 0 056 s c i i i 0 027 and the saturations of layer phase for the three cases are s l i 0 102 s l i i 0 049 s l i i i 0 081 the results again showed that the viscosity change of the layer phase has an obvious larger impact on the conductance of the corner phase fig 10 increase of the ratio ν l a y ν c o r up to 10 results in a decrease of 50 for the corner phase s conductance while increasing the ratio ν c e n ν c o r leads to a decrease of roughly 10 20 for the corner phase s conductance this trend is similar to fig 9for the same reason that the shear force from layer directly acts on the corner phase through their shared interface the differences of the three curves for different saturation cases are small fig 10 note that the absolute conductance flow rate in the empirical equation eq 6 is related to the value of saturation here we focused on investigating the viscous coupling effect based on the normalized conductance g g i g b with g b being the base conductance calculated by using identical viscosity ratio and g i being the conductance calculated by various viscosity ratios the results of normalized conductance showed that the saturation variation has a small effect on the viscous coupling for the cases i and ii with the same saturation of corner phase an increase of the layer phase s saturation leads to a slightly bigger impact of viscous coupling effect from the layer phase if we further decrease the saturation of the corner phase the viscous coupling effect from the layer phase becomes stronger with regard to center phase viscosity adjustment our results of case ii showed the largest viscous coupling effect since the shear force from the center phase has to be transmitted across the layer phase the thinner layer phase shortens the distance between the corner phase and center phase in case ii therefore the propagation of the shear forces from the center phase to corner phase becomes easier 3 4 modification factor the above results show that the viscous coupling effect on predicting the transport properties is significant in the original model by hui and blunt 2000 the empirical equation is unable to match the results of direct simulation with a single constant parameter f which is related to the viscous coupling effect fig 8 here we try to extend the original model by incorporating the viscous coupling effect extracted from the direction simulations and improve the predication accuracy the results in section 3 2 and 3 3 indicated that viscous coupling effect was not very sensitive to wettability or saturations which is agreed with the finding in the reference xie et al 2017 the viscosity ratios has the largest impact on the conductance therefore we introduce a new function of the two viscosity ratios m 1 ν c o r ν l a y and m 2 ν l a y ν c e n to account the viscous coupling effect assuming the parameter f in the empirical equation eq 6 to be 0 we defined a reference value of conductance as 29 g c r a c 2 tan α 1 sin α 2 φ 3 2 12 μ sin 2 α 1 φ 3 then we propose a new conductance model by correcting the reference value through a modification factor f c v m 1 m 2 to approach the results of direct simulations as 30 g c g c r f c v m 1 m 2 a c 2 tan α 1 sin α 2 φ 3 2 12 μ sin 2 α 1 φ 3 f c v m 1 m 2 to propose an expression for this function we use second order polynomial model expressed by two variables m 1 and m 2 as follow 31 f c v m 1 m 2 a c m 1 b c m 2 c c m 1 m 2 d c m 1 2 e c m 2 2 h c the six constant parameters a c h c are determined by a least squares algorithm to fit with the data from direct simulations f c s i m v g c s i m g c r the obtained parameters are listed in table 1 the modification factors calculated by eq 31 using the obtained parameters surfaces in fig 11 showing a very good agreement with the simulation results dots in fig 11 therefore the proposed new conductance model with this modification factor eq 30 is able to capture the viscous coupling effects under different viscosity ratio conditions here the modification factor is considered to be independent to the wettability and saturation because the viscous coupling effect was not very sensitive to these parameters the proposed modification factor is indeed a relative ratio between the conductance predicted under three phase condition with viscous coupling effect and that under single phase state with free slip interface condition the relationship between conductance and wettability as well as saturation is already included in the reference function eq 29 this modification factor may show dependence if the contact angle or saturation is extremely high or low however for most of values of wettability and saturation such dependence can be neglected xie et al 2017 based on the same procedure we propose the modification factor f l v for the layer phase s conductance the base reference value g l r for layer phase s conductance without viscous coupling effect is defined from the original equation eq 10 with f 1 f 2 0 32 g l r a 1 3 1 sin α 2 tan α φ 3 2 12 μ a cl sin 2 α 1 φ 3 1 a 2 a cl 2 similarly the layer phase s conductance can be corrected by the modification factor f l v to include viscous coupling effect 33 g l g l r f l v m 3 m 4 where viscosity ratios are defined as m 3 ν c o r ν l a y and m 4 ν c e n ν l a y again the polynomial type of modification function is used 34 f l v m 3 m 4 a l m 3 b l m 4 c l m 3 m 4 d l m 3 2 e l m 4 2 h l the six constant parameters a l h l obtained by fitting the function to data from direct simulations using least squares algorithm are shown in table 2 the obtained modification factors showed a very good performance compared with the simulation results fig 12 these modification factors can be used to improve the original pore network model for a better performance of predicting the transport parameters by incorporating the viscous coupling effect 3 5 a general data driven machine learning model for permeability the above modification factor is proposed as a correction for the original empirical equation for conductance for a practical application a data driven way to predict the multiphases permeability considering the viscous coupling effect is further proposed based on the data obtained from direct simulations the machine learning method was adopted to develop a fast and accurate model for permeability machine learning methods provide a function using a set of neurons and weights to express the relationship between inputs and outputs alpaydin 2014 here the levenberg marquardt algorithm is used as the optimizer to train an artificial neural network ann to predict the permeability output based on the properties in terms of three phases configuration throat s geometry viscosity ratios and etc inputs levenberg marquardt is an iterative algorithm to find the minimum of a loss function taking the form of a sum of squared errors marquardt 1963 lourakis et al 2005 this algorithm is an efficient tool to optimize weights and biases of a neural network approach in a second order training speed without having to compute the hessian matrix hagan martin and menhaj mohammad 1994 yu and wilamowski 2011 rabbani and babaei 2019 in this study we adopted a fully connected neural network with one hidden layer fig 13 the optimal size of the hidden layer is usually a prior unknown variable therefore two ann architectures with different number of nodes ann1 6 nodes ann2 7 nodes in the hidden layer were considered here both anns have 8 input parameters and one output of the permeability we considered 8 input parameters which include corner angle α contact angle between corner and layer phases θ i contact angle between layer and center phases θ i i mean distance d m of the cross area s shape saturation of corner phase s c saturation of layer phase s l viscosity ratio m 1 and viscosity ratio m 2 fig 13 here the mean distance d m is obtained by calculating the average of the euclidean distance map of the pixel based cross section rabbani and babaei 2019 the euclidean distance of a void space means the distance from the void pixel to the nearest solid pixel the mean distance parameter was adopted here because it reflects the topological feature of cross section s shape and is highly correlated with the permeability rabbani and babaei 2019 and the above modification factor also showed a heavy dependence on the shape of cross section training of this neural network was conducted by using the nftool function in deep learning toolbox of matlab to train the neural networks we built a database composed of 3200 entries using different combinations of input parameters presented in section 3 1 3 3 for various situations we take 70 of them for training 15 for validation and 15 for testing then the mean squared error mse and coefficient of determination r 2 are calculated to evaluate the training performance fig 14 and 15 showed the relationships between the original data from direction simulations and predicted results by the anns for the permeabilities of corner phase and layer phase respectively the results of ann1 with 6 node hidden layer is more scattered than that of the ann2 with 7 node hidden layer the learning performance of ann1 and ann2 are provided in table 3 and 4 in terms of mean squared error mse and coefficient of determination r 2 these results quantitively demonstrated a better prediction performance of ann2 the ann2 with 7 node hidden layer is able to perfectly calculate the permeability of multiphase flow in pore throat with the given 8 input parameters further increasing the size of hidden layer may lead to over fitting therefore the optimized size of the hidden layer must be 7 nodes for our proposed neural network model finally an explicit function in supplementary material can be extracted from this trained neural network and then coupled into the pnm to improve the accuracy of permeability calculation by incorporating the advantages of direct simulations with the viscous coupling effect 4 conclusion in this study the viscous coupling effects in three phase flow through pore throat channels have been studied by using the multiphase lbm direct simulation under various conditions with different saturations wettability and fluid configurations the results indicate that the viscous coupling effect during simultaneous flow of different fluid phases has a significant impact on the hydraulic conductance of fluid layers occupying the corner areas this viscous coupling effect is heavily correlated to the shape of cross section and the length of interface across which the momentum transfers our direct simulation results show that the geometric parameters such as corner angle and the viscosity ratios largely affect the viscous coupling effects we have also demonstrated that the conventional empirical equation derived using free slip and no flow boundary fails to capture the correct conductance for a range of viscosity ratios a modification factor which is expressed as a function of viscosity ratios is proposed to correct the original empirical equation to include the viscous coupling effect with this modification factor the results calculated by the corrected equation agree well with the data from direct simulations we further proposed a more elegant way to predict the permeability of three phase flow in pore throat tubes by using the machine learning method two anns with different nodes of hidden layer were trained by a database built from the results of direct simulations using different combinations of 8 inputs including various geometric parameters wettability and viscosity ratios the results showed that the ann with 7 node hidden layer provide a perfect capability of estimating the permeabilities with coefficient of determination r 2 higher than 0 99 these two proposed new models can be directly incorporated into pore network modeling for predicting flow transport properties with the viscous coupling effect for large core scale model though the present study only considered the straight pore throat tubes our approach can be easily extended to deal with more complicated shape of pore throats the coupling of direction simulation and pore network modeling through this way has a great potential to improve the accuracy of pore network modeling by incorporating more detailed pore scale information while still maintaining good computational efficiency credit authorship contribution statement fei jiang conceptualization methodology software investigation writing original draft jianhui yang conceptualization investigation resources writing review editing edo boek writing review editing takeshi tsuji writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this work was supported by jsps kakenhi grant numbers 19k15100 20k20948 the authors would like to acknowledge the support of the i2cner which is sponsored by the world premier international research center initiative wpi ministry of education culture sports science and technology mext japan supplementary material the training data are provided and the trained neural networks are given as explicit functions in the repository https github com fjiang cloud viscouscouple supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103797 appendix a supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
352,vuggy carbonate rocks have a complex geometry with pore size ranges from nano to several millimeters e g vugs compared to other rocks e g sandstones this multiscale nature makes pore scale studies very challenging vugs have significant effects on rock properties e g porosity permeability capillary pressure etc by establishing high conductive pathways multiscale pore network models can capture pores across various length scales and can be used to predict the flow behavior of these porous systems in this study a dual scale pnm is implemented to reconstruct the behavior of a vuggy carbonate sample the rock sample is ct scanned at two different scales at the macro scale i e vugular network a medical ct scanner is used to image the rock sample at the resolution of 100 μm for better visualization of macropores i e vugs of the rock sample imaging is conducted at both dry and saturated states with an x ray attenuating brine i e nai solution the rock is also imaged by a micro ct scanner at the resolution of 0 75 μm to extract the micro scale properties i e micro network the images at both scales are preprocessed first then the networks of both scales are extracted by two network extraction algorithms i e the sub network of the over segmented watershed snow and the maximal ball mb method and the results compared together then a stochastically equivalent network based on the extracted micro network properties is generated with a larger field of view fov then vugs are randomly added to the reconstructed micro network based on the properties of the macro scale ct images the result is a dual scale unstructured irregular pnm this modeling approach can efficiently preserve the vug to vug and vug to pore connectivity of overlapping vugs the results show that the reconstructed dual scale pnm has very close properties to the laboratory measurement data of the real rock sample graphical abstract image graphical abstract keywords pore network reconstruction dual scale network vuggy carbonate micro ct scan medical ct scan 1 introduction because of the presence of pores at multiscale the pores scale modeling of carbonates is a challenging task zhang et al 2016 sun et al 2017 raeini et al 2019 carbonates often show a multimodal pore size distribution an example is vugular porosity vugs are solution enlarged molds in which the outline of the precursor grain is poorly defined lønøy 2006 they can be appeared as either separated isolated or touching vugs separate vugs are pore space connected through interparticle porosity while touching vugs are pore space that forms an interconnected system independent of the interparticle porosity lucia 1995 touching vug channels can introduce permeability contrasts as the main contributors to heterogeneity in vuggy systems vik et al 2012 therefore these vugs are of prime importance due to the vug percolation effect sadeghnejad and gostick 2020 sadeghnejad and masihi 2016 sadeghnejad and masihi 2017 in which the overlapped vugs create low resistance pathways inside the porous media and alter their petrophysical and flow properties in recent years great attention has been dedicated to pore scale modeling of complex geological systems gao et al 2015 okabe and blunt 2005 sun et al 2017 this approach can compute rock petrophysical and flow properties faster and at a lower cost than the conventional core analysis approach the emergence of this method is due to the introduction of models that can capture the complexity of rocks blunt et al 2013 blunt et al 2002 the pore scale modeling is divided into two main approaches direct pore scale modeling dpm blunt 2017 chen and heidari 2016 frank et al 2018 shams et al 2018 and pore network modeling pnm bauer et al 2012 bultreys et al 2015 dong et al 2007 martinez mendoza et al 2019 in dpm the flow governing transport equations are directly solved at the pore scale therefore this approach is computationally expensive on the contrary a pnm is composed of individual pores and throats an abstraction of the actual pore space pnm can provide the micro to macro scale flow mechanism consisting of several phases wettability trapping dissolution and convection sharqawy 2016 correctly predicting the behavior of multiscale systems e g vuggy carbonates requires having information across various length scales different imaging techniques at various resolutions are used to capture the pore scale properties of such samples including scanning electron microscopy sem focused ion beam sem fib sem micro ct scanning nano ct scanning etc many topological morphological and flow related properties of these samples at each scale can be extracted using these images these imaging techniques have different resolutions versus field of views fovs and can reveal various pore sizes of a rock structure sem and fib sem are nano scale imaging techniques that have the highest resolution suitable for nanopore analysis the spatial resolution of these devices can be as small as 10 nm micro ct scanners are the most applicable devices because of their controllable resolution and manageable fov their spatial resolution ranges from approximately a fraction of μm to several μm which can capture the basic pore scale properties of rocks for large size phenomena e g vugs macro fractures the medical ct scanning technique can also provide an acceptable resolution these devices usually have a spatial resolution between 100 μm to 1 mm on top of the device resolution their fovs should be considered as well increasing the fov will decrease the spatial resolution a role of thumb of approximately 1000 fold from resolution to fov can be considered blunt et al 2013 du plessis et al 2017 dierick et al 2014 having an accurate pore topology of a carbonate sample and an understanding of underlying physics can accurately capture macroscopic fluid behavior e g core scale relative permeability mehmani et al 2020 having images at various scales the next step is fusing them into a digital rock model that integrates the actual rock features at multiple scales to do so pore scale models including pnms and dpm approaches are implemented to characterize the multiscale properties of rocks the computationally demanding nature of the dpm methods making them challenging to perform simulations on representative volumes particularly in heterogeneous multiscale rocks mehmani et al 2020 bultreys et al 2016 furthermore as flow rate decreases in multiphase capillary dominant systems the computational time increases making the direct simulation on large images challenging one replacement solution can be implementing pnms the pnm approach is one of the most widely applied methods to study the fluid flow in rock samples raeini et al 2019 mehmani et al 2020 in this method pore networks are reconstructed via integrating multiple single scale pore networks also called network based integration method since pnms describe individual network elements with infinite resolution and in a computationally efficient way they are probably the most suitable technique for multiscale simulations bultreys et al 2016 gerke et al 2020 the challenge of pnms at multiscale is finding the right set of geometry parameters e g sizes locations and orientations of the pore bodies and pore throats for quantitative predictions of transport in porous media mousavi et al 2012 pnms can be directly extracted from rock images the classical pore network extraction methods are classified into medial axis ma maximal ball mb and watershed algorithms ma converts the pore space to a skeleton that passes through all throats with junctions occurring at pore bodies lindquist et al 1996 in this method significant post processing must be applied to remove artifacts and small details venkatarangan 2001 especially in noisy images shin et al 2005 different studies tried to find network properties in more efficient ways al raoush and willson 2005 youssef et al 2007 jiang et al 2007 jiang et al 2017 ioannidis and chatzis 2000 liang et al 2000 sheppard et al 2005 sheppard et al 2006 yi et al 2017 in the mb method the largest possible spheres that lie in the space of pores regions are found and then between them throats are established silin and patzek 2006 the advantage of this method is its attempt to explicitly identify wide passages in the pore space as pores and narrow passages as throats bultreys et al 2016 different researchers introduced extended versions of this method for complete pore network extraction al kharusi and blunt 2007 dong and blunt 2009 barsi andreeta et al 2019 arand and hesser 2017 or more complex porous media zheng et al 2019 although this technique provides reliable results it requires high computational costs byholm et al 2006 and would result in excessive unreal pores in noisy images a third well known image based network extraction method is the watershed algorithm sheppard et al 2014 rabbani et al 2014 thompson et al 2006 sheppard et al 2004 this method treats an image as a topographic map and finds the lines that run along the tops of ridges also called watersheds rabbani jamshidi rabbani et al 2014 used this algorithm to extract the pore network of a low porosity rock sample gostick gostick 2017 refined the watershed extraction method for high porosity materials by extracting the sub network of the over segmented watershed snow by removing spurious peaks in the distance transform map this algorithm could prevent over segmentation khan tranter khan et al 2019 used the snow algorithm to simultaneously extract void and solid networks from tomographic images of porous materials moreover gerke sizonenko gerke et al 2020 presented a robust and computationally efficient hybrid watershed maximal ball methodology to recently extract pnms from 3d pore geometries they extracted pore bodies from the maximal ball method while throat connection from the watershed algorithm the presence of pores at multiple scales in vuggy carbonates can influence their transport properties the joint modeling of such different scales results in pore scale models both at the macroscale and microscale with the highest possible resolution the concept of a dual scale network of vuggy carbonates by combining small scale matrix pores and millimeter sized vuggy pores was introduced by ioannidis and chatzis ioannidis and chatzis 2000 for simplicity they used a regular uniform pnm for the primary porosity and vugs with cubic shapes were superimposed on them with a given porosity distribution the same concept was used to calculate the multiphase flow transport properties in vuggy carbonates taking into account their specific pore structure parameters moctezuma et al 2003 békri et al 2004 bekri et al 2005 sadeghnejad and gostick 2020 implemented pore network modeling and image based technique to construct a multiscale network of vugular systems this study used an image processing technique to generate a lattice based network of vugs on top of the primary porosity network that can preserve vug to vug and vug to pore connectivity of overlapping vugs their method s base network was a regular lattice which is not suitable for capturing the complexity of heterogeneous vuggy carbonates moreover they used an adjustable parameter of the throat connections to match the permeability of their network with that of the real rock sample jiang van dijke jiang et al 2012 reconstructed a three scale vuggy carbonate by integrating three networks at various scales micro meso and vugs extracted from images one drawback of this work was that the experimental results did not validate the reconstructed networks mehmani prodanovic mehmani et al 2013 constructed a 3d multiscale irregular network of shale gas matrix which contains nano and micropores they included novel transport equations like slip flow and knudsen diffusion to simulate gas flow in the shale system bultreys hoorebeke bultreys et al 2015 developed a workflow to construct a dual scale model that consists of micro and macro pores to simulate drainage in heterogeneous rocks they used an approach of treating microporosity as a continuous porous medium they used micro links instead of micropores which act both in parallel and series to the macropore network mehmani mehmani mehmani et al 2015 introduced an irregular unstructured model for the primary porosity and vugs were randomly inserted into it they simulated the behavior of vugs with several orders of magnitude larger than intergranular pores to compute the breakthrough pressure of the dual scale networks in this study we develop an efficient and robust method to reconstruct dual scale networks of vuggy carbonates our approach focuses on stitching a macro pnm to a micro pnm extracted from actual images at different scales to do so a vuggy carbonate sample is ct scanned at two different scales i e medical and micro ct micro pores are extracted from the micro ct scan images while macro pores are captured from the medical ct scan data in both dry and saturated states we then use the snow algorithm for extracting pnms and compare the outputs with the mb approach a stochastically micro network at a larger fov is reconstructed based on the extracted micro network properties from the micro ct images by implementing a novel approach this approach can preserve pore throat diameter distributions the minimum distance between pores and coordination numbers in both initial and final pnm at the larger fov the result is an unstructured irregular pore network of microporosity then vugs are added to this network to reconstruct the behavior of the dual scale vuggy model the vugs are allowed to overlap each other to mimic the behavior of touching vugs by running different realizations of the dual scale network model the effect of vugs in the rock structure is analyzed in detail moreover the dual scale network properties are validated against the petrophysical porosity and permeability and mercury intrusion capillary pressure micp data of the sample 2 methodology and workflow the workflow of this study is illustrated in fig 1 the petrophysical properties of the sample were measured at the plug scale different subsets of the plug samples were used for ct imaging and micp measurement fig 2 the micro and vugular networks of the studied rock sample were extracted from its micro ct and medical ct images finally the dual scale network of the sample was modeled based on the network properties extracted from both ct images 2 1 rock sample in this study a vuggy carbonate sample was used for the analysis fig 2a the porosity and permeability of the 1 5 plug sample were measured by the boyle s law technique phi 110 core test systems inc and steady state method ka 220 core test systems inc the properties of the rock sample are summarized in table 1 after the porosity and permeability measurements the pore size distribution of the rock sample was measured by the micp method on a trim end fig 2e of the plug sample to ensure the homogeneity of the sample a fast medical ct scan was acquired before the trimming of the plug micp measures the volume of mercury hg that invades the pore volume of a rock as the pressure of mercury increases as mercury does not wet rock surfaces the applied pressure is the capillary pressure needed for hg to enter into pores throats the capillary pressure can be related to pore throat diameter by the washburn relationship eq 1 this capillary pressure can be used to calculate the effective diameter of pore throats given assumptions about pore throat shapes brown 2015 since the hg surface tension and wettability are known the cylindrical pore throat radius r corresponding to a particular hg pressure pc can be estimated from 1 p c 2 σ cos θ r where θ is the contact angle σ is the surface tension pc is the capillary pressure and r is the cylindrical throat radius 2 2 imaging the micro ct and medical ct images were captured from a mini plug fig 2d and an end trim of the main plug fig 2b and c respectively the images were taken in horizontal directions of samples fig 3 a and b show a slice of micro ct and medical ct scan images during the micro ct scanning 971 slices of the mini plug were imaged moreover 12 individual slices were scanned from the trim sample by the medical ct scanner the properties of the micro ct and medical ct scan images are presented in table 2 we used the differential imaging technique also called dry wet imaging smal et al 2018 to capture medical ct images in this method the rock is imaged twice once in a dry and clean state next time when it is saturated by a contrast fluid i e an x ray attenuating fluid usually heavy molecular weight salts with high contrast values like sodium iodate nai markussen et al 2019 bhattad et al 2014 potassium iodate ki lin et al 2016 gao et al 2019 zhang et al 2019 and cesium iodate csi boone et al 2014 latham et al 2008 are implemented for saturating rocks first the ct scanning was acquired in a dry state fig 3b and then the trim sample was saturated with a 1 molal nai brine this solution attenuates the passage of x ray radiation through it the attenuation coefficient of chemical elements is related to their atomic number z 4 and radiation energy therefore because of the high atomic number z 53 iodine has a large attenuation coefficient the attenuation coefficient of iodine is about 730 cm2 g at 32 kev which is very large and increases the x ray absorption in pores saturated by the iodine solution the ct scan of the saturated sample was acquired in the same direction and positions of the dry state fig 3c having both images the three main stages of the process workflow are 1 dry wet image registration 2 intensity scaling and 3 pointwise intensity subtraction long et al 2013 the dry images as shown in fig 3b consist of solids white vugs black and unresolved pores gray and the wet images fig 3c consist of the solid white vugs light black and unresolved micro pores slightly light gray by subtracting the two images of the dry and wet state fig 3d the macro pores i e vugs that could not easily be observed in the dry state images are detected markussen et al 2019 zhang et al 2019 this is because vugs have the most difference in gray level in both image states shown by yellow regions in fig 3d the image analysis steps of this workflow were implemented in fiji imagej schindelin et al 2012 2 3 image preprocessing and pnm extraction the micro ct scan images were cropped to contain 350 350 350 voxels with a resolution of 0 75 μm to reduce noise a gaussian filter was applied to ct images subsequently the wave transformation equations yu and fan 2017 coded in python were used to make the gray level of voxels homogeneous across the images next the images were segmented by a suite of python functions into pore and grain phases moslemipour et al 2020 for image segmentation a constant threshold value by the expected porosity calculated from subtracting the vuggy porosity i e obtained from the medical ct images from the total sample porosity table 1 was applied to the images a beam hardening effect was observed at the corners of the medical ct scan images the images were cropped to 200 200 36 pixels by the imagej software package to reduce this effect the 3d medical ct images have voxels with a size of 0 1 mm two extraction methods were applied on micro ct and medical ct images the mb silin and patzek 2006 and snow gostick 2017 algorithm afterward the best network was selected for reconstructing the dual scale pnm from each scale after the network extraction the porosity and permeability of the extracted networks were calculated and compared to experimentally known values the porosity of the extracted networks can be calculated by eq a 1 see appendix a appendix a describes the details of the porosity and permeability calculation 2 4 dual scale network generation various studies in the literature generated multiscale unstructured irregular network models 20 36 60 developed for carbonates and other heterogeneous rock systems such as tight formations with micro and macroporosity here we adopt the method of sadeghnejad and gostick 2020 to reconstruct the dual scale network of this study in their method vugs are added to a network of micropores distributed on a structured regular lattice in such a network micropore bodies are located at the equally spaced lattice nodes i e structured network with a fixed coordination number i e regular network however in an actual rock sample the centers of pores are not located on lattice points i e unstructured network moreover the number of throats connected to a pore is not fixed across the network i e irregular network thus an unstructured irregular pore network model can be a better selection to model the behavior of dual scale systems thus our contribution is to further developed the previous algorithm sadeghnejad and gostick 2020 to account for such an unstructured irregular network model moreover this study uses the information directly extracted from the rock ct images at two different scales e g the minimum pore to pore distance coordination number of vugs which results in a dual scale pnm which is more realistic than the previous study the flowchart of our algorithm to reconstruct a dual scale pnm is illustrated schematically in fig 4 this algorithm was developed in python and its code is available in moslemipour and sadeghnejad 2020 the properties of the generated pnms were computed by openpnm gostick et al 2016 an open source pnm package the visualization of the extracted and reconstructed networks is performed using paraview ahrens et al 2005 an open source multiplatform data analysis and visualization application in the next chapters we discuss the details of the introduced algorithm 2 4 1 reconstruction of stochastic micro network first the micro and vugular networks were extracted from the micro ct and medical ct images according to the extraction methods that were explained in section 2 3 we call these pnms extracted networks as the fov of the extracted micro pnm from the micro ct images is not large enough it is necessary to reconstruct a larger stochastic pnm with an arbitrary dimension as shown in fig 5 to reconstruct such a new stochastic pnm with a specific size i e arbitrary fov pores are distributed randomly in the entire network space the density of pores and throats eqs 3 and 4 in the stochastic micro network is equal ρ p s t o ρ p e x t and ρ t s t o ρ t e x t to the density of pores and throats in the extracted network from the micro ct scan images jiang et al 2013 3 ρ p n p v 4 ρ t n t v where v is the network volume np and nt are the number of pores and throats respectively in either the extracted network from the ct images or the stochastic generated network with an arbitrary fov the minimum distance between the distributed pores in the stochastic network d min s t o is preserved to be equal to that of the extracted network from the micro ct images d min e x t fig 5a then we allocate each node a diameter based on the pore size distribution of the extracted micro network fig 5b we further check that pores do not overlap with each other subsequently a coordination number is assigned randomly to each pore selected from the coordination number distribution of the extracted micro network fig 5b the number inside each pore shows its given coordination number the neighbor pores around each selected pore are found and sorted based on their distance to the center pore subsequently each pore is connected to nearby closest pores based on their assigned coordination number fig 5c moreover throats with a longer length than the maximum length limit imposed by the extracted micro network from ct images are removed from the system by applying this procedure the final number of throats in the reconstructed stochastic network will be almost equal to the number of throats computed in the extracted micro network in the next step the throat diameters of the stochastic network are assigned randomly from the throat diameter distribution of the extracted micro network it is tried to keep a throat diameter smaller than the minimum diameter of its connecting pores during the throat diameter assignment accordingly the reconstructed stochastic network has statistical properties very close to the original extracted pore network from the micro ct images 2 4 2 fusing vugs into stochastic micro network after reconstructing the stochastic micro network macro pores i e vugs are fused into it according to the extracted vugular network properties from the medical ct scan images of the rock during fusing the two networks vugs are added based on the occupied volume fraction i e porosity of them in the extracted vugular network from the medical ct images ϕ v u g i m a g e thus the volume fraction of vugs in the dual scale network ϕ v u g n e t becomes equal to the volume fraction of vugs in the medical ct images ϕ v u g i m a g e besides the fraction of connected and isolated vugs in the reconstructed network is preserved too the procedure of adding vugs into the stochastic micro network is as follows at first a fine grid is generated on top of the reconstructed stochastic micro network fig 6 b this fine grid is used for detecting the overlapping area of touching vugs implementing such a fine grid enables us to correctly compute the porosity of the dual scale pnm when some vugs overlapped each other the grid size of this fine cubic grid l is calculated from the minimum distance between the micro pores 5 d min s t o 2 l x 2 l y 2 l z 2 i f l x l y l z l l d min s t o 3 where d min s t o is the minimum distance between the distributed pores lx ly and lz are the length of each fine grid in the x y and z direction fig 6c shows how this fine grid can be used for the volume fraction calculation of the two overlapped vugs the summation of the filled grids blue grids in fig 6c of the entire fine grid is used to compute the volume fraction occupied by touching vugs to easily model the surface vugs i e those vugs that touch the rock surface e g the lower left blue vug in fig 6d some boundary grids are added to the main fine gird space the number of added grids in each direction n can be calculated by eq 6 6 n r m l where rm is the largest vug radius in the micro ct image and is the ceiling function after the reconstruction of the entire dual scale network these extra grids are removed from the model and the volume fraction of the surface vugs are corrected accordingly in our model to add vugs into the stochastic micro network model some micropores are randomly selected the diameter of each vug is assigned randomly based on the vug diameter distribution of the extracted macro network from medical ct images fig 6d in the next step it is essential to remove the vugs that are entirely placed into larger vugs i e child vugs during adding each vug into the network the underlying pores and throats of the stochastic micro network are eliminated fig 6d moreover the state of underlying fine grids is changed to occupied fig 6c and d fig 7 a illustrates the connections between a vug and its neighboring micro pores before removing pores inside a vug fig 7a the adjacent pores outside pores which are connected to the inside pores are determined first finally vugs are connected to just these neighboring pores by introducing new throat connections for example if any outside pore is connected to more than one inside pore fig 7a only an equivalent throat is considered to connect it to the vug fig 7b after finalizing vug to pore connections the touching vug connections vug to vug connections should be established this touching vugs connectivity is inspired by the properties of the extracted vugular network from the medical ct scan images first a vug to vug coordination number should be assigned to each vug that is randomly selected from the coordination number distribution obtained from the ct scan images this coordination number connects vugs to other adjacent vugs fig 6e shows the final dual scale network after adding vugs to the stochastic micro network model in the next step the geometric properties of vugs and their connecting throats should be set the diameter of a throat connecting a vug into its adjacent micro pores dt is assumed to be equal to the micro pore diameter i e the minimum diameter of connecting pores fig 8 a whereas a fraction f of the smaller vug diameter is used for the diameter of a throat connecting two vugs d t vug vug fig 8b 7 d t v u g v u g f min d i d j where d is the vug diameters fig 8c depicts two overlapping vugs the vug to vug distance l int of overlapped vugs is corrected by eq 8 8 l int d i d j 2 l f where lf is the overlapped length between the two vugs furthermore the hydraulic conductance between two overlapped vugs should be corrected by considering the modified length of each vug eq 9 is used for calculating the modified vug diameter sadeghnejad and gostick 2020 9 l i o r j d i o r j l int 2 where l i or j is the modified length of either the ith or jth vug 3 results and discussion 3 1 micro network extraction during the modeling of fluid flow in porous media it is essential to find the smallest volume for which quantity fluctuations such as porosity and permeability no longer occur this volume is called the representative elementary volume rev there are two methods for calculating rev i deterministic rev drev ii statistical rev srev mostaghimi et al 2013 singh et al 2020 drev is estimated by calculating the property of interest e g porosity permeability across cubic domains with increasing size from the center of the image the domain size wherein the property variation vanishes represents the drev size the srev method is obtained by a moving window approach which covers the entire spatial variation of the measured property across an image as the property of interest in each scale is calculated for various windows across the image this method can provide the standard deviation of variation at each length scale in this study the drev approach is used to estimate the rev of the micro network the porosity and permeability for the extracted networks with different length scales which were selected from the subsections of the same image are plotted in fig 9 the size in which the calculated results do not vary significantly can be considered as the representative rev as shown in fig 9 above the system size of 200 and 350 voxels for porosity and permeability respectively the calculated properties from the equivalent pnm become independent from the image size thus an image size of 350 350 350 voxels i e 2623 μm 3 was selected from the micro network for performing the next operations the micro network was extracted by both snow and mb algorithms from the micro ct scan images fig 10 a and b show the extracted micro networks table 3 summarizes the properties of the extracted networks the porosity and permeability of both extracted micro networks are lower than the lab results this difference is due to the lack of availability of very large pores i e vugs in the extracted micro networks in the extracted micro network the diameter of pores and throats are in a range of 0 7 to 23 μm it shows that large diameter vugs could not be captured in the fov of the micro ct imaging technique the quality and resolution of ct images can affect the segmentation process during a network extraction method verri et al 2017 the presence of noise in our ct images affects the segmentation process if those noises are not removed during the de noising step correctly the output network of the mb method shows some small fake pores the existence of very close neighboring pores can be a good example of the existence of such noises in reality they may belong to a single large pore in the input image however the snow algorithm finds and eliminates those spurious peaks of an input image gostick 2017 thus the extracted network by the snow algorithm fig 10a contains a fewer number of pores and throats with a larger diameter than that in the mb method fig 10b moreover the existence of large diameter pores and throats in the network extracted by the snow algorithm results in having a network with higher porosity 17 5 and permeability 1 46 md values than that of the mb method see table 3 3 2 vugular network extraction the differential map of the dry and wet states of the medical ct image is used for estimating the role of the vugular network on the system the vugular network was extracted by both mb and snow algorithms and the porosity and the extracted networks were calculated by openpnm the region of interest from the medical ct images has a volume of 20 20 3 6 mm we will show later that the system s largest vug has a diameter of 1 to 2 millimeters this field of view is then large enough to capture approximately a good distribution of vug sizes in the rock sample thus the image data can be used to estimate the volume fraction of vugs in the system as the field of view is in the range of the continuum scale i e darcy scale table 4 summarizes the properties of the extracted vugular network fig 10c and d show the vugular networks extracted from the differential image by the snow and mb algorithms respectively a typical percolation path is specified in green color in the network image which shows that vugs percolate the image rock sample analyzing the extracted vugular network properties shows that both networks have smaller porosity than the lab measured porosity 28 3 the extracted networks have pores with a diameter in a range of 100 μm to 1 mm contrary to the extracted micro networks these vugular networks do not have any information from the micro pores according to medical ct scan resolution i e 0 1mm thus it is reasonable that the porosity of the extracted vugular network should be lower than the lab measured porosity of the rock sample i e 28 3 as shown in fig 10 the number of pores in the extracted vugular network by the snow algorithm is again fewer than that by the mb algorithm 3 3 pore size distribution analysis fig 11 compares the pore size distribution psd of micp data at three scales i e nano micro and vugular scales with that of the extracted networks as the porosity 28 3 and permeability 223 md of the actual rock sample are high enough the role of the nanopores on the flow properties of this sample was ignored because the nanopores do not contribute to flow at this scale comparing the psds at the micro scale shows that the snow algorithm extracted larger pores than the mb method fig 11 the mb algorithm extracted many micropores in the range 1 5 to 3 which cannot be considered real pores according to the micp data as mentioned before this algorithm in contrary to snow cannot handle the undesirable noises in the micro ct images the extracted network by the snow algorithm has a better match to the psd results of the micp test than mb at this scale it was also shown that the resulted capillary pressure curve for a network extracted by mb was quite far from the experimental capillary pressure curve gostick 2017 thus the snow algorithm was used for extracting the micro network properties in our study at the vugular scale the psd of the micp data shows that this method could not capture vugs with a diameter larger than 208 μm while both extracted networks by the snow and mb contain vugs with large diameters the reason is that the ultimate peak of the micp test c a 208 μm is composed of all pores that mercury could enter into them with the first specified pressure during the measurement this pressure was set on 0 5 psi implementing the washburn equation eq 1 and considering the mercury properties σ 479dynes cm θ 140 the set pressure of 0 5 psi is equal to pores with a similar or larger diameter of 208 μm an end face trim of the sample is shown in fig 12 as can be seen the trim contains vugs with diameters of up to 2 mm which is another proof that the resolution of the micp test was not enough to capture the large diameter pores of the sample at the vugular scale the psd of both snow and mb networks match roughly well with micp thus the results of the snow algorithm was implemented for further studies 3 4 dual scale network reconstruction the visual photography fig 12 and the extracted macro networks from the medical ct images fig 11 showed that the rock sample contains some vugs with diameters larger than 200μm the fov of the extracted micro network was 2623 μm 3 thus a stochastic micro network with a larger fov should be generated to contain a representative amount of vugs therefore a micro network with a size of 900 900 900 μm was reconstructed stochastically based on the extracted network properties snow from the micro ct data this network has a volume of 0 729 mm 3 table 5 compares the generated stochastic micro network properties with the micro pores extracted from the micro ct scan images the number of pores and throats in the generated stochastic network are 111 127 and 183 102 respectively the porosity and permeability of the generated stochastic micro network match well with the micro network extracted from the micro ct image which is a strong indicator that the implemented algorithm works accurately to further verify the approach the pore size throat size and coordination number distributions of the reconstructed network are plotted in fig 13 against that of the extracted micro network from the micro ct images this figure shows that all distributions coincide after reconstructing the stochastic micro network vugs are added based on their volume fraction ϕ v u g i m a g e computed from the vugular network extracted from the medical ct images by the algorithm described in section 2 4 while adding vugs 57 3 of vugs were considered isolated vugs and the remaining vugs were touching vugs table 4 moreover to better match the lab measured porosity value 28 3 fin eq 7 was considered to be 0 57 fig 14 a illustrates the extracted micro network from the micro ct images and fig 14b and c depict the generated stochastic micro network and a realization of the dual scale network respectively as vugs are being added randomly to the stochastic micro network in the dual scale network thus we can generate different dual scale network realizations of the vuggy rock sample more than 250 realizations of the vuggy model were generated to check the variation of permeability versus porosity fig 15 a shows the scatter plot of porosity versus permeability of the dual scale network for various realizations the initial stochastic micro network i e without vug green square point in fig 15a and the lab measured properties of the studied rock sample red triangular point in fig 15a are shown in this figure during adding vugs to the micro network different conditions of vug connectivity occur the amount of this connectivity would control the porosity and especially permeability of the generated dual scale network model it was shown that vugs could appear in either percolated or non percolated states in a dual scale pnm sadeghnejad and gostick 2020 in the percolated state high permeable touching vugs can create a conductive path inside the rock sample in this condition the permeability of the network increases sharply while its porosity does not change so much when the quantity of vugs increases the filled and empty blue circle points in fig 15a shows those percolated and non percolated realizations respectively the percolated realizations have an average porosity and permeability of 28 1 0 7 and 176 73 md respectively non percolated vug realizations have an average porosity and permeability of 27 1 2 8 and 30 17 md comparing the lab measured porosity 28 3 and permeability 223 md of the rock sample red triangular point in fig 15a with those randomly generated vugular networks reveals a good prediction of the proposed dual scale pore network method as discussed earlier the field of view of micro ct images was not large enough to include large size vugs thus vugs are not available in the generated stochastic network this is why the porosity and permeability of the stochastic network are significantly different from the results of the dual scale models it should be noted that there is always a deviation between the laboratory and imaged processed results this difference in permeability value can be because of different reasons firstly the real rock sample size and the pnm or the micro and medial ct images are different from each other secondly the permeability of the rock sample was measured at the stressed condition i e 500 psi while the ct images were acquired at zero confining pressure the permeability variation of the percolated vug realizations of this study is compared with the results of the previous study of sadeghnejad and gostick 2020 in fig 15b the measured laboratory permeability of the rock sample is also shown with a dashed blue line in this figure as can be seen from this box plot our dual scale model could predict the permeability of the vuggy rock sample more accurately i e has a less permeability variation than the previous study it worth mentioning that in the previous study a matching parameter for throat diameters was implemented to match the network permeability with the measured laboratory data nevertheless the introduced dual scale model of this study could predict the rock properties without any matching parameter for permeability the reason is that the previous model reconstructed its networks based on the distribution of pores and vugs by defining a cut off on the micp data however this study used imaging techniques at various scales to realistically model both micro and vugular networks furthermore contrary to the previous study sadeghnejad and gostick 2020 that used a regular lattice based network with a fixed coordination number we implemented irregular networks with a variable coordination number that can better represent the heterogeneity in complex vugular carbonate systems 4 conclusions in this study we described a method for reconstructing a dual scale pore network model for predicting the behavior of a vuggy carbonate sample this unstructured irregular pore network model is reconstructed based on data from different length scales the sample was ct scanned at the micro and vugular scale by a micro ct and a medical ct scanner to better determine the vugular network properties the differential imaging technique was used to image the sample at both dry and wet states by the medical ct scanner after the network extraction at both scales by different methods i e mb and snow both networks fused into each other by the introduced stochastic approach the petrophysical properties of the dual scale stochastic network were compared with the measured laboratory properties of the rock at the plug scale the results showed that the dual scale stochastic network reconstructed by fusing the stochastic pnm of micro pores i e extracted from micro ct data with vugular pores i e extracted from medical ct scans has very close petrophysical properties to the measured laboratory data of the rock sample it shows that the proposed methodology for reconstructing dual scale vugular rocks was successful this algorithm can efficiently preserve vug to micro pore and vug to vug connections our irregular micro network model does not use any matching parameter for generating network properties i e permeability this algorithm can efficiently preserve vug to micro pore and vug to vug connections moreover a more realistic pore coordination number is used in our model therefore this unstructured irregular pnm is better suited to predict the behavior of dual scale vugular rocks both extraction methods i e mb and snow were efficient in extracting networks from images at both scales micro and medical ct however the snow algorithm provided better results for noisy images the existence of vugs in a sample is not the only influential reason for changing the flow properties of carbonate rocks however the connectivity of vugs in the rock sample is important as well this connectivity can improve the permeability of the sample by generating conductive flow pathways in the rock credit authorship contribution statement abolfazl moslemipour methodology software validation formal analysis data curation investigation visualization writing original draft saeid sadeghnejad conceptualization validation investigation resources writing review editing supervision project administration declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the authors would like to express their very great appreciation to dr j gostick university of waterloo for his valuable and constructive suggestions during the planning and development of this research work supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103795 appendix b supplementary materials image application 1 appendix a porosity and hydraulic conductance calculations the porosity of the extracted networks can be calculated using eq a 1 this equation considered the sum of the pore throats and vugs volume to the total network volume a 1 ϕ v p v t v v l x l y l z where vp vt and vv are the pore throat and vug volume respectively lx ly and lz are the network dimensions the hydraulic conductance between two pores just depends on throat properties the hydraulic conductance between pores i and j g h i j is calculated by the hagen poiseuille method which is defined by eq a 2 a 2 g h i j g h t π 128 d t 4 l t where ghi j or gh t is the hydraulic conductance of throat between pores of i and j dt is the diameter of the throat lt is the length of the throat and μ is the viscosity of the liquid phase the flow rate between pores i and j is calculated by eq a 3 a 3 q i j π 128 μ d t 4 l t p j p i g h t δ p i j where pi and pj are the pressure for the i and j pores moreover δp i j and q i j are the pressure difference and flow rate between them respectively then permeability values calculated in three directions and the arithmetic mean of them reported as the total permeability of the network in an actual rock the geometry of pores and throats is not as simple as spheres and cylinders thus a parameter in the models should be defined to consider the sharpness and non homogeneity of pores and throats geometries each of the network extraction methods of this study uses a different procedure for computing this parameter the mb method uses a shape factor which is affected by an object s shape but is independent of its dimension this shape factor affects the hydraulic conductance of pores and throats fig a 1 shows the shape factor g and it is defined by eq a 4 the hydraulic conductance of each pore or throat by using the shape factor is calculated by eq a 5 moreover the network flow rate is calculated by eqs a 6 and a 7 a 4 g a p 2 a 5 g p k a 2 g μ p 1 2 a 2 g μ p a 6 q p i j g p i j l i j φ p i φ p j a 7 l i j g p i j l i g p i l t g p t l j g p j where g is the pore or throat shape factor a and p represents the cross sectional area and perimeter length of the pore or throat area respectively gp and μ p represent the hydraulic conductance and the fluid viscosity respectively besides l is the length of the throat and ϕ is the phase potential the harmonic average of each pore and throat individual conductance considers as the conductance between two pore bodies g p ij i and j are the indices of two adjacent pores and t is their connecting throat 
352,vuggy carbonate rocks have a complex geometry with pore size ranges from nano to several millimeters e g vugs compared to other rocks e g sandstones this multiscale nature makes pore scale studies very challenging vugs have significant effects on rock properties e g porosity permeability capillary pressure etc by establishing high conductive pathways multiscale pore network models can capture pores across various length scales and can be used to predict the flow behavior of these porous systems in this study a dual scale pnm is implemented to reconstruct the behavior of a vuggy carbonate sample the rock sample is ct scanned at two different scales at the macro scale i e vugular network a medical ct scanner is used to image the rock sample at the resolution of 100 μm for better visualization of macropores i e vugs of the rock sample imaging is conducted at both dry and saturated states with an x ray attenuating brine i e nai solution the rock is also imaged by a micro ct scanner at the resolution of 0 75 μm to extract the micro scale properties i e micro network the images at both scales are preprocessed first then the networks of both scales are extracted by two network extraction algorithms i e the sub network of the over segmented watershed snow and the maximal ball mb method and the results compared together then a stochastically equivalent network based on the extracted micro network properties is generated with a larger field of view fov then vugs are randomly added to the reconstructed micro network based on the properties of the macro scale ct images the result is a dual scale unstructured irregular pnm this modeling approach can efficiently preserve the vug to vug and vug to pore connectivity of overlapping vugs the results show that the reconstructed dual scale pnm has very close properties to the laboratory measurement data of the real rock sample graphical abstract image graphical abstract keywords pore network reconstruction dual scale network vuggy carbonate micro ct scan medical ct scan 1 introduction because of the presence of pores at multiscale the pores scale modeling of carbonates is a challenging task zhang et al 2016 sun et al 2017 raeini et al 2019 carbonates often show a multimodal pore size distribution an example is vugular porosity vugs are solution enlarged molds in which the outline of the precursor grain is poorly defined lønøy 2006 they can be appeared as either separated isolated or touching vugs separate vugs are pore space connected through interparticle porosity while touching vugs are pore space that forms an interconnected system independent of the interparticle porosity lucia 1995 touching vug channels can introduce permeability contrasts as the main contributors to heterogeneity in vuggy systems vik et al 2012 therefore these vugs are of prime importance due to the vug percolation effect sadeghnejad and gostick 2020 sadeghnejad and masihi 2016 sadeghnejad and masihi 2017 in which the overlapped vugs create low resistance pathways inside the porous media and alter their petrophysical and flow properties in recent years great attention has been dedicated to pore scale modeling of complex geological systems gao et al 2015 okabe and blunt 2005 sun et al 2017 this approach can compute rock petrophysical and flow properties faster and at a lower cost than the conventional core analysis approach the emergence of this method is due to the introduction of models that can capture the complexity of rocks blunt et al 2013 blunt et al 2002 the pore scale modeling is divided into two main approaches direct pore scale modeling dpm blunt 2017 chen and heidari 2016 frank et al 2018 shams et al 2018 and pore network modeling pnm bauer et al 2012 bultreys et al 2015 dong et al 2007 martinez mendoza et al 2019 in dpm the flow governing transport equations are directly solved at the pore scale therefore this approach is computationally expensive on the contrary a pnm is composed of individual pores and throats an abstraction of the actual pore space pnm can provide the micro to macro scale flow mechanism consisting of several phases wettability trapping dissolution and convection sharqawy 2016 correctly predicting the behavior of multiscale systems e g vuggy carbonates requires having information across various length scales different imaging techniques at various resolutions are used to capture the pore scale properties of such samples including scanning electron microscopy sem focused ion beam sem fib sem micro ct scanning nano ct scanning etc many topological morphological and flow related properties of these samples at each scale can be extracted using these images these imaging techniques have different resolutions versus field of views fovs and can reveal various pore sizes of a rock structure sem and fib sem are nano scale imaging techniques that have the highest resolution suitable for nanopore analysis the spatial resolution of these devices can be as small as 10 nm micro ct scanners are the most applicable devices because of their controllable resolution and manageable fov their spatial resolution ranges from approximately a fraction of μm to several μm which can capture the basic pore scale properties of rocks for large size phenomena e g vugs macro fractures the medical ct scanning technique can also provide an acceptable resolution these devices usually have a spatial resolution between 100 μm to 1 mm on top of the device resolution their fovs should be considered as well increasing the fov will decrease the spatial resolution a role of thumb of approximately 1000 fold from resolution to fov can be considered blunt et al 2013 du plessis et al 2017 dierick et al 2014 having an accurate pore topology of a carbonate sample and an understanding of underlying physics can accurately capture macroscopic fluid behavior e g core scale relative permeability mehmani et al 2020 having images at various scales the next step is fusing them into a digital rock model that integrates the actual rock features at multiple scales to do so pore scale models including pnms and dpm approaches are implemented to characterize the multiscale properties of rocks the computationally demanding nature of the dpm methods making them challenging to perform simulations on representative volumes particularly in heterogeneous multiscale rocks mehmani et al 2020 bultreys et al 2016 furthermore as flow rate decreases in multiphase capillary dominant systems the computational time increases making the direct simulation on large images challenging one replacement solution can be implementing pnms the pnm approach is one of the most widely applied methods to study the fluid flow in rock samples raeini et al 2019 mehmani et al 2020 in this method pore networks are reconstructed via integrating multiple single scale pore networks also called network based integration method since pnms describe individual network elements with infinite resolution and in a computationally efficient way they are probably the most suitable technique for multiscale simulations bultreys et al 2016 gerke et al 2020 the challenge of pnms at multiscale is finding the right set of geometry parameters e g sizes locations and orientations of the pore bodies and pore throats for quantitative predictions of transport in porous media mousavi et al 2012 pnms can be directly extracted from rock images the classical pore network extraction methods are classified into medial axis ma maximal ball mb and watershed algorithms ma converts the pore space to a skeleton that passes through all throats with junctions occurring at pore bodies lindquist et al 1996 in this method significant post processing must be applied to remove artifacts and small details venkatarangan 2001 especially in noisy images shin et al 2005 different studies tried to find network properties in more efficient ways al raoush and willson 2005 youssef et al 2007 jiang et al 2007 jiang et al 2017 ioannidis and chatzis 2000 liang et al 2000 sheppard et al 2005 sheppard et al 2006 yi et al 2017 in the mb method the largest possible spheres that lie in the space of pores regions are found and then between them throats are established silin and patzek 2006 the advantage of this method is its attempt to explicitly identify wide passages in the pore space as pores and narrow passages as throats bultreys et al 2016 different researchers introduced extended versions of this method for complete pore network extraction al kharusi and blunt 2007 dong and blunt 2009 barsi andreeta et al 2019 arand and hesser 2017 or more complex porous media zheng et al 2019 although this technique provides reliable results it requires high computational costs byholm et al 2006 and would result in excessive unreal pores in noisy images a third well known image based network extraction method is the watershed algorithm sheppard et al 2014 rabbani et al 2014 thompson et al 2006 sheppard et al 2004 this method treats an image as a topographic map and finds the lines that run along the tops of ridges also called watersheds rabbani jamshidi rabbani et al 2014 used this algorithm to extract the pore network of a low porosity rock sample gostick gostick 2017 refined the watershed extraction method for high porosity materials by extracting the sub network of the over segmented watershed snow by removing spurious peaks in the distance transform map this algorithm could prevent over segmentation khan tranter khan et al 2019 used the snow algorithm to simultaneously extract void and solid networks from tomographic images of porous materials moreover gerke sizonenko gerke et al 2020 presented a robust and computationally efficient hybrid watershed maximal ball methodology to recently extract pnms from 3d pore geometries they extracted pore bodies from the maximal ball method while throat connection from the watershed algorithm the presence of pores at multiple scales in vuggy carbonates can influence their transport properties the joint modeling of such different scales results in pore scale models both at the macroscale and microscale with the highest possible resolution the concept of a dual scale network of vuggy carbonates by combining small scale matrix pores and millimeter sized vuggy pores was introduced by ioannidis and chatzis ioannidis and chatzis 2000 for simplicity they used a regular uniform pnm for the primary porosity and vugs with cubic shapes were superimposed on them with a given porosity distribution the same concept was used to calculate the multiphase flow transport properties in vuggy carbonates taking into account their specific pore structure parameters moctezuma et al 2003 békri et al 2004 bekri et al 2005 sadeghnejad and gostick 2020 implemented pore network modeling and image based technique to construct a multiscale network of vugular systems this study used an image processing technique to generate a lattice based network of vugs on top of the primary porosity network that can preserve vug to vug and vug to pore connectivity of overlapping vugs their method s base network was a regular lattice which is not suitable for capturing the complexity of heterogeneous vuggy carbonates moreover they used an adjustable parameter of the throat connections to match the permeability of their network with that of the real rock sample jiang van dijke jiang et al 2012 reconstructed a three scale vuggy carbonate by integrating three networks at various scales micro meso and vugs extracted from images one drawback of this work was that the experimental results did not validate the reconstructed networks mehmani prodanovic mehmani et al 2013 constructed a 3d multiscale irregular network of shale gas matrix which contains nano and micropores they included novel transport equations like slip flow and knudsen diffusion to simulate gas flow in the shale system bultreys hoorebeke bultreys et al 2015 developed a workflow to construct a dual scale model that consists of micro and macro pores to simulate drainage in heterogeneous rocks they used an approach of treating microporosity as a continuous porous medium they used micro links instead of micropores which act both in parallel and series to the macropore network mehmani mehmani mehmani et al 2015 introduced an irregular unstructured model for the primary porosity and vugs were randomly inserted into it they simulated the behavior of vugs with several orders of magnitude larger than intergranular pores to compute the breakthrough pressure of the dual scale networks in this study we develop an efficient and robust method to reconstruct dual scale networks of vuggy carbonates our approach focuses on stitching a macro pnm to a micro pnm extracted from actual images at different scales to do so a vuggy carbonate sample is ct scanned at two different scales i e medical and micro ct micro pores are extracted from the micro ct scan images while macro pores are captured from the medical ct scan data in both dry and saturated states we then use the snow algorithm for extracting pnms and compare the outputs with the mb approach a stochastically micro network at a larger fov is reconstructed based on the extracted micro network properties from the micro ct images by implementing a novel approach this approach can preserve pore throat diameter distributions the minimum distance between pores and coordination numbers in both initial and final pnm at the larger fov the result is an unstructured irregular pore network of microporosity then vugs are added to this network to reconstruct the behavior of the dual scale vuggy model the vugs are allowed to overlap each other to mimic the behavior of touching vugs by running different realizations of the dual scale network model the effect of vugs in the rock structure is analyzed in detail moreover the dual scale network properties are validated against the petrophysical porosity and permeability and mercury intrusion capillary pressure micp data of the sample 2 methodology and workflow the workflow of this study is illustrated in fig 1 the petrophysical properties of the sample were measured at the plug scale different subsets of the plug samples were used for ct imaging and micp measurement fig 2 the micro and vugular networks of the studied rock sample were extracted from its micro ct and medical ct images finally the dual scale network of the sample was modeled based on the network properties extracted from both ct images 2 1 rock sample in this study a vuggy carbonate sample was used for the analysis fig 2a the porosity and permeability of the 1 5 plug sample were measured by the boyle s law technique phi 110 core test systems inc and steady state method ka 220 core test systems inc the properties of the rock sample are summarized in table 1 after the porosity and permeability measurements the pore size distribution of the rock sample was measured by the micp method on a trim end fig 2e of the plug sample to ensure the homogeneity of the sample a fast medical ct scan was acquired before the trimming of the plug micp measures the volume of mercury hg that invades the pore volume of a rock as the pressure of mercury increases as mercury does not wet rock surfaces the applied pressure is the capillary pressure needed for hg to enter into pores throats the capillary pressure can be related to pore throat diameter by the washburn relationship eq 1 this capillary pressure can be used to calculate the effective diameter of pore throats given assumptions about pore throat shapes brown 2015 since the hg surface tension and wettability are known the cylindrical pore throat radius r corresponding to a particular hg pressure pc can be estimated from 1 p c 2 σ cos θ r where θ is the contact angle σ is the surface tension pc is the capillary pressure and r is the cylindrical throat radius 2 2 imaging the micro ct and medical ct images were captured from a mini plug fig 2d and an end trim of the main plug fig 2b and c respectively the images were taken in horizontal directions of samples fig 3 a and b show a slice of micro ct and medical ct scan images during the micro ct scanning 971 slices of the mini plug were imaged moreover 12 individual slices were scanned from the trim sample by the medical ct scanner the properties of the micro ct and medical ct scan images are presented in table 2 we used the differential imaging technique also called dry wet imaging smal et al 2018 to capture medical ct images in this method the rock is imaged twice once in a dry and clean state next time when it is saturated by a contrast fluid i e an x ray attenuating fluid usually heavy molecular weight salts with high contrast values like sodium iodate nai markussen et al 2019 bhattad et al 2014 potassium iodate ki lin et al 2016 gao et al 2019 zhang et al 2019 and cesium iodate csi boone et al 2014 latham et al 2008 are implemented for saturating rocks first the ct scanning was acquired in a dry state fig 3b and then the trim sample was saturated with a 1 molal nai brine this solution attenuates the passage of x ray radiation through it the attenuation coefficient of chemical elements is related to their atomic number z 4 and radiation energy therefore because of the high atomic number z 53 iodine has a large attenuation coefficient the attenuation coefficient of iodine is about 730 cm2 g at 32 kev which is very large and increases the x ray absorption in pores saturated by the iodine solution the ct scan of the saturated sample was acquired in the same direction and positions of the dry state fig 3c having both images the three main stages of the process workflow are 1 dry wet image registration 2 intensity scaling and 3 pointwise intensity subtraction long et al 2013 the dry images as shown in fig 3b consist of solids white vugs black and unresolved pores gray and the wet images fig 3c consist of the solid white vugs light black and unresolved micro pores slightly light gray by subtracting the two images of the dry and wet state fig 3d the macro pores i e vugs that could not easily be observed in the dry state images are detected markussen et al 2019 zhang et al 2019 this is because vugs have the most difference in gray level in both image states shown by yellow regions in fig 3d the image analysis steps of this workflow were implemented in fiji imagej schindelin et al 2012 2 3 image preprocessing and pnm extraction the micro ct scan images were cropped to contain 350 350 350 voxels with a resolution of 0 75 μm to reduce noise a gaussian filter was applied to ct images subsequently the wave transformation equations yu and fan 2017 coded in python were used to make the gray level of voxels homogeneous across the images next the images were segmented by a suite of python functions into pore and grain phases moslemipour et al 2020 for image segmentation a constant threshold value by the expected porosity calculated from subtracting the vuggy porosity i e obtained from the medical ct images from the total sample porosity table 1 was applied to the images a beam hardening effect was observed at the corners of the medical ct scan images the images were cropped to 200 200 36 pixels by the imagej software package to reduce this effect the 3d medical ct images have voxels with a size of 0 1 mm two extraction methods were applied on micro ct and medical ct images the mb silin and patzek 2006 and snow gostick 2017 algorithm afterward the best network was selected for reconstructing the dual scale pnm from each scale after the network extraction the porosity and permeability of the extracted networks were calculated and compared to experimentally known values the porosity of the extracted networks can be calculated by eq a 1 see appendix a appendix a describes the details of the porosity and permeability calculation 2 4 dual scale network generation various studies in the literature generated multiscale unstructured irregular network models 20 36 60 developed for carbonates and other heterogeneous rock systems such as tight formations with micro and macroporosity here we adopt the method of sadeghnejad and gostick 2020 to reconstruct the dual scale network of this study in their method vugs are added to a network of micropores distributed on a structured regular lattice in such a network micropore bodies are located at the equally spaced lattice nodes i e structured network with a fixed coordination number i e regular network however in an actual rock sample the centers of pores are not located on lattice points i e unstructured network moreover the number of throats connected to a pore is not fixed across the network i e irregular network thus an unstructured irregular pore network model can be a better selection to model the behavior of dual scale systems thus our contribution is to further developed the previous algorithm sadeghnejad and gostick 2020 to account for such an unstructured irregular network model moreover this study uses the information directly extracted from the rock ct images at two different scales e g the minimum pore to pore distance coordination number of vugs which results in a dual scale pnm which is more realistic than the previous study the flowchart of our algorithm to reconstruct a dual scale pnm is illustrated schematically in fig 4 this algorithm was developed in python and its code is available in moslemipour and sadeghnejad 2020 the properties of the generated pnms were computed by openpnm gostick et al 2016 an open source pnm package the visualization of the extracted and reconstructed networks is performed using paraview ahrens et al 2005 an open source multiplatform data analysis and visualization application in the next chapters we discuss the details of the introduced algorithm 2 4 1 reconstruction of stochastic micro network first the micro and vugular networks were extracted from the micro ct and medical ct images according to the extraction methods that were explained in section 2 3 we call these pnms extracted networks as the fov of the extracted micro pnm from the micro ct images is not large enough it is necessary to reconstruct a larger stochastic pnm with an arbitrary dimension as shown in fig 5 to reconstruct such a new stochastic pnm with a specific size i e arbitrary fov pores are distributed randomly in the entire network space the density of pores and throats eqs 3 and 4 in the stochastic micro network is equal ρ p s t o ρ p e x t and ρ t s t o ρ t e x t to the density of pores and throats in the extracted network from the micro ct scan images jiang et al 2013 3 ρ p n p v 4 ρ t n t v where v is the network volume np and nt are the number of pores and throats respectively in either the extracted network from the ct images or the stochastic generated network with an arbitrary fov the minimum distance between the distributed pores in the stochastic network d min s t o is preserved to be equal to that of the extracted network from the micro ct images d min e x t fig 5a then we allocate each node a diameter based on the pore size distribution of the extracted micro network fig 5b we further check that pores do not overlap with each other subsequently a coordination number is assigned randomly to each pore selected from the coordination number distribution of the extracted micro network fig 5b the number inside each pore shows its given coordination number the neighbor pores around each selected pore are found and sorted based on their distance to the center pore subsequently each pore is connected to nearby closest pores based on their assigned coordination number fig 5c moreover throats with a longer length than the maximum length limit imposed by the extracted micro network from ct images are removed from the system by applying this procedure the final number of throats in the reconstructed stochastic network will be almost equal to the number of throats computed in the extracted micro network in the next step the throat diameters of the stochastic network are assigned randomly from the throat diameter distribution of the extracted micro network it is tried to keep a throat diameter smaller than the minimum diameter of its connecting pores during the throat diameter assignment accordingly the reconstructed stochastic network has statistical properties very close to the original extracted pore network from the micro ct images 2 4 2 fusing vugs into stochastic micro network after reconstructing the stochastic micro network macro pores i e vugs are fused into it according to the extracted vugular network properties from the medical ct scan images of the rock during fusing the two networks vugs are added based on the occupied volume fraction i e porosity of them in the extracted vugular network from the medical ct images ϕ v u g i m a g e thus the volume fraction of vugs in the dual scale network ϕ v u g n e t becomes equal to the volume fraction of vugs in the medical ct images ϕ v u g i m a g e besides the fraction of connected and isolated vugs in the reconstructed network is preserved too the procedure of adding vugs into the stochastic micro network is as follows at first a fine grid is generated on top of the reconstructed stochastic micro network fig 6 b this fine grid is used for detecting the overlapping area of touching vugs implementing such a fine grid enables us to correctly compute the porosity of the dual scale pnm when some vugs overlapped each other the grid size of this fine cubic grid l is calculated from the minimum distance between the micro pores 5 d min s t o 2 l x 2 l y 2 l z 2 i f l x l y l z l l d min s t o 3 where d min s t o is the minimum distance between the distributed pores lx ly and lz are the length of each fine grid in the x y and z direction fig 6c shows how this fine grid can be used for the volume fraction calculation of the two overlapped vugs the summation of the filled grids blue grids in fig 6c of the entire fine grid is used to compute the volume fraction occupied by touching vugs to easily model the surface vugs i e those vugs that touch the rock surface e g the lower left blue vug in fig 6d some boundary grids are added to the main fine gird space the number of added grids in each direction n can be calculated by eq 6 6 n r m l where rm is the largest vug radius in the micro ct image and is the ceiling function after the reconstruction of the entire dual scale network these extra grids are removed from the model and the volume fraction of the surface vugs are corrected accordingly in our model to add vugs into the stochastic micro network model some micropores are randomly selected the diameter of each vug is assigned randomly based on the vug diameter distribution of the extracted macro network from medical ct images fig 6d in the next step it is essential to remove the vugs that are entirely placed into larger vugs i e child vugs during adding each vug into the network the underlying pores and throats of the stochastic micro network are eliminated fig 6d moreover the state of underlying fine grids is changed to occupied fig 6c and d fig 7 a illustrates the connections between a vug and its neighboring micro pores before removing pores inside a vug fig 7a the adjacent pores outside pores which are connected to the inside pores are determined first finally vugs are connected to just these neighboring pores by introducing new throat connections for example if any outside pore is connected to more than one inside pore fig 7a only an equivalent throat is considered to connect it to the vug fig 7b after finalizing vug to pore connections the touching vug connections vug to vug connections should be established this touching vugs connectivity is inspired by the properties of the extracted vugular network from the medical ct scan images first a vug to vug coordination number should be assigned to each vug that is randomly selected from the coordination number distribution obtained from the ct scan images this coordination number connects vugs to other adjacent vugs fig 6e shows the final dual scale network after adding vugs to the stochastic micro network model in the next step the geometric properties of vugs and their connecting throats should be set the diameter of a throat connecting a vug into its adjacent micro pores dt is assumed to be equal to the micro pore diameter i e the minimum diameter of connecting pores fig 8 a whereas a fraction f of the smaller vug diameter is used for the diameter of a throat connecting two vugs d t vug vug fig 8b 7 d t v u g v u g f min d i d j where d is the vug diameters fig 8c depicts two overlapping vugs the vug to vug distance l int of overlapped vugs is corrected by eq 8 8 l int d i d j 2 l f where lf is the overlapped length between the two vugs furthermore the hydraulic conductance between two overlapped vugs should be corrected by considering the modified length of each vug eq 9 is used for calculating the modified vug diameter sadeghnejad and gostick 2020 9 l i o r j d i o r j l int 2 where l i or j is the modified length of either the ith or jth vug 3 results and discussion 3 1 micro network extraction during the modeling of fluid flow in porous media it is essential to find the smallest volume for which quantity fluctuations such as porosity and permeability no longer occur this volume is called the representative elementary volume rev there are two methods for calculating rev i deterministic rev drev ii statistical rev srev mostaghimi et al 2013 singh et al 2020 drev is estimated by calculating the property of interest e g porosity permeability across cubic domains with increasing size from the center of the image the domain size wherein the property variation vanishes represents the drev size the srev method is obtained by a moving window approach which covers the entire spatial variation of the measured property across an image as the property of interest in each scale is calculated for various windows across the image this method can provide the standard deviation of variation at each length scale in this study the drev approach is used to estimate the rev of the micro network the porosity and permeability for the extracted networks with different length scales which were selected from the subsections of the same image are plotted in fig 9 the size in which the calculated results do not vary significantly can be considered as the representative rev as shown in fig 9 above the system size of 200 and 350 voxels for porosity and permeability respectively the calculated properties from the equivalent pnm become independent from the image size thus an image size of 350 350 350 voxels i e 2623 μm 3 was selected from the micro network for performing the next operations the micro network was extracted by both snow and mb algorithms from the micro ct scan images fig 10 a and b show the extracted micro networks table 3 summarizes the properties of the extracted networks the porosity and permeability of both extracted micro networks are lower than the lab results this difference is due to the lack of availability of very large pores i e vugs in the extracted micro networks in the extracted micro network the diameter of pores and throats are in a range of 0 7 to 23 μm it shows that large diameter vugs could not be captured in the fov of the micro ct imaging technique the quality and resolution of ct images can affect the segmentation process during a network extraction method verri et al 2017 the presence of noise in our ct images affects the segmentation process if those noises are not removed during the de noising step correctly the output network of the mb method shows some small fake pores the existence of very close neighboring pores can be a good example of the existence of such noises in reality they may belong to a single large pore in the input image however the snow algorithm finds and eliminates those spurious peaks of an input image gostick 2017 thus the extracted network by the snow algorithm fig 10a contains a fewer number of pores and throats with a larger diameter than that in the mb method fig 10b moreover the existence of large diameter pores and throats in the network extracted by the snow algorithm results in having a network with higher porosity 17 5 and permeability 1 46 md values than that of the mb method see table 3 3 2 vugular network extraction the differential map of the dry and wet states of the medical ct image is used for estimating the role of the vugular network on the system the vugular network was extracted by both mb and snow algorithms and the porosity and the extracted networks were calculated by openpnm the region of interest from the medical ct images has a volume of 20 20 3 6 mm we will show later that the system s largest vug has a diameter of 1 to 2 millimeters this field of view is then large enough to capture approximately a good distribution of vug sizes in the rock sample thus the image data can be used to estimate the volume fraction of vugs in the system as the field of view is in the range of the continuum scale i e darcy scale table 4 summarizes the properties of the extracted vugular network fig 10c and d show the vugular networks extracted from the differential image by the snow and mb algorithms respectively a typical percolation path is specified in green color in the network image which shows that vugs percolate the image rock sample analyzing the extracted vugular network properties shows that both networks have smaller porosity than the lab measured porosity 28 3 the extracted networks have pores with a diameter in a range of 100 μm to 1 mm contrary to the extracted micro networks these vugular networks do not have any information from the micro pores according to medical ct scan resolution i e 0 1mm thus it is reasonable that the porosity of the extracted vugular network should be lower than the lab measured porosity of the rock sample i e 28 3 as shown in fig 10 the number of pores in the extracted vugular network by the snow algorithm is again fewer than that by the mb algorithm 3 3 pore size distribution analysis fig 11 compares the pore size distribution psd of micp data at three scales i e nano micro and vugular scales with that of the extracted networks as the porosity 28 3 and permeability 223 md of the actual rock sample are high enough the role of the nanopores on the flow properties of this sample was ignored because the nanopores do not contribute to flow at this scale comparing the psds at the micro scale shows that the snow algorithm extracted larger pores than the mb method fig 11 the mb algorithm extracted many micropores in the range 1 5 to 3 which cannot be considered real pores according to the micp data as mentioned before this algorithm in contrary to snow cannot handle the undesirable noises in the micro ct images the extracted network by the snow algorithm has a better match to the psd results of the micp test than mb at this scale it was also shown that the resulted capillary pressure curve for a network extracted by mb was quite far from the experimental capillary pressure curve gostick 2017 thus the snow algorithm was used for extracting the micro network properties in our study at the vugular scale the psd of the micp data shows that this method could not capture vugs with a diameter larger than 208 μm while both extracted networks by the snow and mb contain vugs with large diameters the reason is that the ultimate peak of the micp test c a 208 μm is composed of all pores that mercury could enter into them with the first specified pressure during the measurement this pressure was set on 0 5 psi implementing the washburn equation eq 1 and considering the mercury properties σ 479dynes cm θ 140 the set pressure of 0 5 psi is equal to pores with a similar or larger diameter of 208 μm an end face trim of the sample is shown in fig 12 as can be seen the trim contains vugs with diameters of up to 2 mm which is another proof that the resolution of the micp test was not enough to capture the large diameter pores of the sample at the vugular scale the psd of both snow and mb networks match roughly well with micp thus the results of the snow algorithm was implemented for further studies 3 4 dual scale network reconstruction the visual photography fig 12 and the extracted macro networks from the medical ct images fig 11 showed that the rock sample contains some vugs with diameters larger than 200μm the fov of the extracted micro network was 2623 μm 3 thus a stochastic micro network with a larger fov should be generated to contain a representative amount of vugs therefore a micro network with a size of 900 900 900 μm was reconstructed stochastically based on the extracted network properties snow from the micro ct data this network has a volume of 0 729 mm 3 table 5 compares the generated stochastic micro network properties with the micro pores extracted from the micro ct scan images the number of pores and throats in the generated stochastic network are 111 127 and 183 102 respectively the porosity and permeability of the generated stochastic micro network match well with the micro network extracted from the micro ct image which is a strong indicator that the implemented algorithm works accurately to further verify the approach the pore size throat size and coordination number distributions of the reconstructed network are plotted in fig 13 against that of the extracted micro network from the micro ct images this figure shows that all distributions coincide after reconstructing the stochastic micro network vugs are added based on their volume fraction ϕ v u g i m a g e computed from the vugular network extracted from the medical ct images by the algorithm described in section 2 4 while adding vugs 57 3 of vugs were considered isolated vugs and the remaining vugs were touching vugs table 4 moreover to better match the lab measured porosity value 28 3 fin eq 7 was considered to be 0 57 fig 14 a illustrates the extracted micro network from the micro ct images and fig 14b and c depict the generated stochastic micro network and a realization of the dual scale network respectively as vugs are being added randomly to the stochastic micro network in the dual scale network thus we can generate different dual scale network realizations of the vuggy rock sample more than 250 realizations of the vuggy model were generated to check the variation of permeability versus porosity fig 15 a shows the scatter plot of porosity versus permeability of the dual scale network for various realizations the initial stochastic micro network i e without vug green square point in fig 15a and the lab measured properties of the studied rock sample red triangular point in fig 15a are shown in this figure during adding vugs to the micro network different conditions of vug connectivity occur the amount of this connectivity would control the porosity and especially permeability of the generated dual scale network model it was shown that vugs could appear in either percolated or non percolated states in a dual scale pnm sadeghnejad and gostick 2020 in the percolated state high permeable touching vugs can create a conductive path inside the rock sample in this condition the permeability of the network increases sharply while its porosity does not change so much when the quantity of vugs increases the filled and empty blue circle points in fig 15a shows those percolated and non percolated realizations respectively the percolated realizations have an average porosity and permeability of 28 1 0 7 and 176 73 md respectively non percolated vug realizations have an average porosity and permeability of 27 1 2 8 and 30 17 md comparing the lab measured porosity 28 3 and permeability 223 md of the rock sample red triangular point in fig 15a with those randomly generated vugular networks reveals a good prediction of the proposed dual scale pore network method as discussed earlier the field of view of micro ct images was not large enough to include large size vugs thus vugs are not available in the generated stochastic network this is why the porosity and permeability of the stochastic network are significantly different from the results of the dual scale models it should be noted that there is always a deviation between the laboratory and imaged processed results this difference in permeability value can be because of different reasons firstly the real rock sample size and the pnm or the micro and medial ct images are different from each other secondly the permeability of the rock sample was measured at the stressed condition i e 500 psi while the ct images were acquired at zero confining pressure the permeability variation of the percolated vug realizations of this study is compared with the results of the previous study of sadeghnejad and gostick 2020 in fig 15b the measured laboratory permeability of the rock sample is also shown with a dashed blue line in this figure as can be seen from this box plot our dual scale model could predict the permeability of the vuggy rock sample more accurately i e has a less permeability variation than the previous study it worth mentioning that in the previous study a matching parameter for throat diameters was implemented to match the network permeability with the measured laboratory data nevertheless the introduced dual scale model of this study could predict the rock properties without any matching parameter for permeability the reason is that the previous model reconstructed its networks based on the distribution of pores and vugs by defining a cut off on the micp data however this study used imaging techniques at various scales to realistically model both micro and vugular networks furthermore contrary to the previous study sadeghnejad and gostick 2020 that used a regular lattice based network with a fixed coordination number we implemented irregular networks with a variable coordination number that can better represent the heterogeneity in complex vugular carbonate systems 4 conclusions in this study we described a method for reconstructing a dual scale pore network model for predicting the behavior of a vuggy carbonate sample this unstructured irregular pore network model is reconstructed based on data from different length scales the sample was ct scanned at the micro and vugular scale by a micro ct and a medical ct scanner to better determine the vugular network properties the differential imaging technique was used to image the sample at both dry and wet states by the medical ct scanner after the network extraction at both scales by different methods i e mb and snow both networks fused into each other by the introduced stochastic approach the petrophysical properties of the dual scale stochastic network were compared with the measured laboratory properties of the rock at the plug scale the results showed that the dual scale stochastic network reconstructed by fusing the stochastic pnm of micro pores i e extracted from micro ct data with vugular pores i e extracted from medical ct scans has very close petrophysical properties to the measured laboratory data of the rock sample it shows that the proposed methodology for reconstructing dual scale vugular rocks was successful this algorithm can efficiently preserve vug to micro pore and vug to vug connections our irregular micro network model does not use any matching parameter for generating network properties i e permeability this algorithm can efficiently preserve vug to micro pore and vug to vug connections moreover a more realistic pore coordination number is used in our model therefore this unstructured irregular pnm is better suited to predict the behavior of dual scale vugular rocks both extraction methods i e mb and snow were efficient in extracting networks from images at both scales micro and medical ct however the snow algorithm provided better results for noisy images the existence of vugs in a sample is not the only influential reason for changing the flow properties of carbonate rocks however the connectivity of vugs in the rock sample is important as well this connectivity can improve the permeability of the sample by generating conductive flow pathways in the rock credit authorship contribution statement abolfazl moslemipour methodology software validation formal analysis data curation investigation visualization writing original draft saeid sadeghnejad conceptualization validation investigation resources writing review editing supervision project administration declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the authors would like to express their very great appreciation to dr j gostick university of waterloo for his valuable and constructive suggestions during the planning and development of this research work supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103795 appendix b supplementary materials image application 1 appendix a porosity and hydraulic conductance calculations the porosity of the extracted networks can be calculated using eq a 1 this equation considered the sum of the pore throats and vugs volume to the total network volume a 1 ϕ v p v t v v l x l y l z where vp vt and vv are the pore throat and vug volume respectively lx ly and lz are the network dimensions the hydraulic conductance between two pores just depends on throat properties the hydraulic conductance between pores i and j g h i j is calculated by the hagen poiseuille method which is defined by eq a 2 a 2 g h i j g h t π 128 d t 4 l t where ghi j or gh t is the hydraulic conductance of throat between pores of i and j dt is the diameter of the throat lt is the length of the throat and μ is the viscosity of the liquid phase the flow rate between pores i and j is calculated by eq a 3 a 3 q i j π 128 μ d t 4 l t p j p i g h t δ p i j where pi and pj are the pressure for the i and j pores moreover δp i j and q i j are the pressure difference and flow rate between them respectively then permeability values calculated in three directions and the arithmetic mean of them reported as the total permeability of the network in an actual rock the geometry of pores and throats is not as simple as spheres and cylinders thus a parameter in the models should be defined to consider the sharpness and non homogeneity of pores and throats geometries each of the network extraction methods of this study uses a different procedure for computing this parameter the mb method uses a shape factor which is affected by an object s shape but is independent of its dimension this shape factor affects the hydraulic conductance of pores and throats fig a 1 shows the shape factor g and it is defined by eq a 4 the hydraulic conductance of each pore or throat by using the shape factor is calculated by eq a 5 moreover the network flow rate is calculated by eqs a 6 and a 7 a 4 g a p 2 a 5 g p k a 2 g μ p 1 2 a 2 g μ p a 6 q p i j g p i j l i j φ p i φ p j a 7 l i j g p i j l i g p i l t g p t l j g p j where g is the pore or throat shape factor a and p represents the cross sectional area and perimeter length of the pore or throat area respectively gp and μ p represent the hydraulic conductance and the fluid viscosity respectively besides l is the length of the throat and ϕ is the phase potential the harmonic average of each pore and throat individual conductance considers as the conductance between two pore bodies g p ij i and j are the indices of two adjacent pores and t is their connecting throat 
353,the impact of tunnel drainage on local water resources has attracted increasing attention in the past decades the potential impacts of tunnel drainage on terrestrial vegetation have been evaluated from a groundwater environment perspective however previous attempts did not consider the atmospheric and climatic conditions along with the change to the regional groundwater table to address the lack of atmospheric influence this study proposes a vulnerability assessment method focused on the soil plant atmosphere continuum by taking tunnel drainage atmospheric and climatic impacts into account the proposed method consists of five stages 1 groundwater seepage model for water table distribution 2 topsoil model based on a single column perspective for soil water pressure distributions 3 dynamic root zone wilting for the transient model 4 budyko type analysis for the soil water storage under longer term climatic changes and 5 summary based on the outcomes of vulnerability analysis the case study was located in the yuexi county anhui east china and was investigated based on different soil textures weather conditions and groundwater table drawdown scenarios transient intra annual water pressure dynamics were simulated for one year and aggregate variations of soil water storage were summarized using the budyko framework the assessment method demonstrated that the textural differences and climatic changes are more impactful on plant vulnerability compared to the drainage effect in the specific case the increase in aridity towards the sub humid dry climate drives the soil columns to decrease the water storage where the significant loss of water storage was also observed in the budyko type framework the outcomes suggest that under sub humid dry conditions when combined with tunnel drainage the drawdown on shallow groundwater levels leads the vegetation to be vulnerable keywords soil plant atmosphere continuum root zone wilting soil water budget soil water pressure tunnel drainage environmental vulnerability assessment nomenclature aet actual evapotranspiration mm d 1 b shape factor parameter for r δ r eq a2 dimensionless et evapotranspiration cm d 1 h h z t hydraulic head and water table level m h 0 h z t 1 initial hydraulic head and water table level m h h z t soil water pressure cm h soil water pressure below which plants begin closing their stomata cm h max soil water pressure value below which roots extract water at the maximum rate until h cm h min allowable minimum soil water pressure at the soil surface cm hw soil water pressure below which plants begin to wilt cm i canopy interception mm k k h unsaturated hydraulic conductivity m s 1 k eff effective hydraulic conductivity for layered soil profile m s 1 k s saturated hydraulic conductivity m s 1 n exponent in the soil water retention function dimensionless p precipitation mm pet potential evapotranspiration mm d 1 q 0 q 0 t initial surface flux cm d 1 q max maximum constant surface flux cm q p precipitation flux on the soil surface qr soil surface runoff flux q τ root possible root water extraction flux cm d 1 q τ 0 the potential transpiration flux cm d 1 q τ potential water extraction flux as function of vertical coordinate also referred to as the spatial distribution of q τ 0 over the rooting zone cm d 1 q τ a actual transpiration flux cm d 1 q ε potential evaporation flux cm d 1 q ε a actual evaporation flux cm d 1 r δ r root length density distribution cm 3 r δ r normalized water uptake distribution unitless ravg medium root length density cm 3 rwu root water uptake cm d 1 s s specific storage m 1 spac soil plant atmosphere continuum t time d t 0 time when simulation begins d t 1 initiation time of drawdown induced by tunnel drainage d t 2 t 3 intermittent times that represent the duration after the tunnel drainage d t 4 the time water table stagnates and drawdown stops d w net volumetric sink source term m3m 3s 1 z vertical coordinate cm zb zb t water table level and lower boundary value cm z max depth of rock surface cm α empirical parameter in the soil retention function d 1 α d value of α for drying condition of the soil water retention function d 1 α w value of α for wetting condition of the soil water retention function d 1 β soil surface slope angle degrees δ rooting depth cm δ e effective rooting depth which represents 50 of the total rooting depth cm δ r relative root length normalized by δ dimensionless δ r max the maximum relative rooting depth cm δ w the portion of the rooting depth which corresponds to hw cm θ θ h soil water content m3m 3 θ r residual soil water content m3m 3 θ s saturated soil water content m3m 3 θ s d saturated soil water content of the drying condition m3m 3 θ s w saturated soil water content of the wetting condition m3m 3 μ h root water uptake as a function of soil water pressure dimensionless ω modified budyko model parameter referred to as the shape parameter dimensionless 1 introduction tunnel inflow during excavation and prolonged discharge by drainage during its life cycle out of the tunnel may cause groundwater resource depletion underground tunnel drainage alters the regional groundwater flow system and disturbs the local water balance gargini et al 2008 scheidler et al 2017 vincenzi et al 2009 there is also evidence that highlights the adverse effects of deep underground drainage on the land surface butscher et al 2011 chiu and chia 2012 kim et al 2008 kværner and snilsberg 2008 li et al 2016 as a result potential impacts of tunnel drainage during underground excavations were evaluated from an environmental perspective huang et al 2015 li et al 2018 mossmark et al 2017 and the impact on the hydrogeological environment yang et al 2009 was considered recent studies have targeted the impact on terrestrial vegetation including the groundwater drawdown li et al 2018 and topsoil water dynamics gokdemir et al 2020 others have determined limiting tunnel drainage rate considering the ecological groundwater table level cheng et al 2014 2019 although these works explained the relationship between discharge induced drawdown and terrestrial vegetation the contribution of atmospheric and climatic dynamics to the topsoil rooting zone during tunnel drainage was excluded the assessment results for the impact of tunnel drainage on terrestrial vegetation indicate that discharge induced drawdown causes a reduction in plant growth zheng et al 2017 and crop yield nosetto et al 2009 additionally atmospheric studies emphasizing the interaction between terrain vegetation soil water balance and groundwater levels jiang et al 2009 leung et al 2011 martínez de la torre and miguez macho 2019 rahman et al 2015 rihani et al 2010 reveal the dynamics between subsurface and atmospheric conditions atmos therefore it is critical to include the association between topsoil water content and atmospheric forcing in the assessment of tunnel drainage in this study vulnerability stands for the negative impact on vegetation due to the wilting of the terrestrial vegetation that occurs when soil water pressure in the rooting zone reduces to the wilting point gokdemir et al 2020 which is denoted as the point at which the plants cannot retrieve necessary water for their survival kirkham 2014 if wilting point conditions persist terrestrial plants start to die off and vulnerability conditions are met the occurrence of vulnerability is primarily related to infiltration and soil water storage thus the increased water storage in the soil inhibits the occurrence of vulnerability therefore the vulnerability is controlled by the amount of water in the soil in ideal conditions the resources of soil water storage are groundwater and rainfall for the topsoil the assessment of vulnerability requires consideration of both sources this research considers the evaluation of environmental impact induced by deep tunnel drainage from the soil plant atmosphere continuum spac perspective norman and anderson 2004 in this context the long term aridity of the field is important based on atmospheric and climatic factors regions with a high rate of increased aridity are expected to be more vulnerable spinoni et al 2015 however in the case of shallow water table depths plants may shift sufficient supplies of water needed for their survival against aridity cui and shao 2005 the water storage that remains inside the soil and accessible by vegetation is called plant available water supplied from groundwater as an essential source for vegetation survival especially in prolonged dry seasons yang et al 2017 thus empirically based estimates for water storage associated with hypothetical and real cases are proposed including plant available water in the soil milly 1994 yang et al 2009 yokoo et al 2008 a semi empirical approach is included in this study to evaluate the relationship between soil moisture dynamics and monthly variations in soil water storage in the vulnerability assessment the primary form of the budyko framework approach budyko 1958 1974 was considered and represents the relationship between the ratio of actual evapotranspiration aet to precipitation p and aridity as the ratio of potential evapotranspiration pet to precipitation this study focuses on including the atmospheric and climatic components to the tunnel drainage impact by proposing an assessment method that can analyze the interactions between atmospheric and climatic conditions and groundwater table drawdown in soil media from a vulnerability perspective unlike previous attempts this work provides an impact assessment including the soil layer s water dynamics and the rooting zone coupling with atmospheric conditions for this purpose the vulnerability assessment method is employed on a specific case study to evaluate the vulnerability of terrain vegetation according to the difference in aridity accordingly this study is organized as follows section 2 introduces the methodology including the sub sections of vulnerability assessment method and brief definition of groundwater seepage and transient topsoil model components section 3 summarizes the study site and followed by a subsection that presents the design of hypothetical case study scenarios and atmospheric boundary conditions section 4 summarizes the results of the application of vulnerability assessment method and soil water storage analysis from the budyko perspective the study is finalized with discussions in section 5 and a summary and conclusion in section 6 2 methodology 2 1 vulnerability assessment in this section the relationship of the proposed vulnerability assessment framework with atmospheric forcing under the influence of tunnel drainage is introduced the components that link spac perspective to vulnerability according to local climate are explained 2 1 1 assessment method based on atmospheric factors the vulnerability assessment method is a product of the integration of numerical modeling with empirical concepts in this context the data flow of the method is designed to feed the topsoil and groundwater models the vulnerability analysis was conducted using the outcomes of the topsoil model where the effect of daily atmospheric conditions was analyzed using dynamic root zone wilting the changes in soil water storage were evaluated depending on the climatic difference on a yearly scale using budyko type analysis fig 1 d the vulnerability assessment method employs the following stages a groundwater seepage model for water table distribution b topsoil model based on a single column perspective for soil water pressure distributions c dynamic root zone wilting for the transient model d budyko type analysis for the soil water storage under longer term climatic changes e summary based on the outcomes of vulnerability analysis the sequential nature of the vulnerability analysis gives the freedom to evaluate the system from hourly to yearly time scales hourly processes such as canopy interception and rainfall daily process of evaporation and monthly process of transpiration baird and wilby 1999 savenije 1997 can be included in the system individually as the principal element of the method the vulnerability assessment method provides a way to test the occurrence of vegetation wilting and the exceedance of the plant available water limits based on climatic conditions 2 2 groundwater seepage model the groundwater seepage model provides the transient groundwater level distributions by using the finite difference groundwater model modflow harbaugh 2005 to solve eq 1 1 s s h t k s h w where ss is the specific storage h represents hydraulic head or water level and k s is saturated hydraulic conductivity that is assumed for homogeneous and isotropic porous media w is the net volumetric sink source term the recharge process and tunnel drainage are considered as the source and the sink respectively discretization is made based on the refined grid principle to represent the tunnel surface where drainage nodes are located on the tunnel surface zero hydraulic head conditions are simulated 2 h 0 along the tunnel interior and seepage and tunnel drainage flux is calculated in this research we have focused on the representative drawdown conditions observed in the outcomes of the groundwater seepage model after performing the tunnel drainage simulations the validation was performed based on measured tunnel drainage flux and borehole groundwater hydraulic head measurements li et al 2018 2 3 transient topsoil model the topsoil model was prepared to solve unsaturated flow in the vadose zone the hydrus 1d model šimůnek et al 2013 is used to represent the components of spac as the topsoil model layered and homogeneous soil columns rooting depth water uptake model and atmospheric boundary conditions were implemented into the model hydrus 1d was selected to employ a one dimensional solution of the mixed form richards equation as a verified tool that has been used in several prior studies on soil water dynamics and surface processes e g balugani et al 2017 šimunek et al 2012 soylu et al 2011 zlotnik et al 2007 the topsoil model is designed to respond to three components one for the net infiltration on the ground surface eq 2 another for the root water uptake rwu and on for the deep or shallow soil groundwater table the first component is considered as the mass balance on the soil surface 2 q 0 q p cos β q r q ε where q indicates water fluxes and q 0 stands for infiltration with subscripts of surface runoff r daily precipitation p and evaporation ε that represent aggregate soil and canopy evaporation and where β is the surface slope angle in this study the unit soil column approach is adopted dagan and bresler 1983 rubin and or 1993 see fig 2 and q 0 is imposed as the boundary condition at the ground surface infiltration without ponding is assumed on a flat soil surface β 0 the potential root uptake q τ at z δ can be calculated from q τ 0 which is included in the topsoil model as a function of relative rooting depth δ r 3 q τ q τ 0 r δ r for z δ where δ r is the normalized soil depth with rooting depth z δ q τ 0 is the potential transpiration flux which is assigned based on the dominant vegetation type at the study site and the normalized water uptake distribution is r δ r see appendix a for the assumptions of rwu and integration into the rooting zone integration of eq 3 over rooting depth leads to the actual transpiration flux 4 q τ a 0 δ max q τ root d δ aet is calculated as the sum of q τ a and actual evaporation flux q ε a for a particular time period the numerical solution of richards equation eq 5 was obtained for atmospheric bc as 5 θ z t z k h d h d z 1 q τ root z accordingly eq 5 was subjected to the following conditions neuman et al 1974 for the soil surface upper bc 6 k h d h d z 1 q max at z 0 h min h t 0 at z 0 where h min is the allowable minimum pressure head at the soil surface and determined based on the equilibrium between water vapor and soil water content and q max is equivalent to potential evaporation or infiltration rate under the imposed atmospheric conditions thus q ε a is estimated by simulating soil water pressure by the imposed bcs eq 6 on 5 unless runoff conditions are met then eq 5 is solved imposing atmospheric and groundwater table bcs that interact with rwu in the root zone the relationship between unsaturated hydraulic conductivity k h and volumetric water content θ z is modeled using the assumptions of the mualem van genuchten soil hydraulic model under hysteretic conditions for details see van genuchten 1980 mualem 1976 as the third and final component the groundwater table is designed as the lower boundary condition zb here zb represents a hydraulic head that can be changed due to the impact of tunnel drainage and received from the groundwater seepage model zb is equivalent to the initial hydraulic head h 0 when the drainage conditions are non existent four lower bcs are selected to represent a gradual reduction in water table levels for the same representative layered soil profile fig 2 the bottom bcs are set to represent the scenario with different groundwater table which is exposed to drawdown induced by tunnel drainage 2 4 dynamic root zone wilting the method is created based on the dynamic root zone wilting concept which relies on a double vulnerability criterion on a single soil profile these criteria represent two simultaneous conditions 1 any condition that reduces topsoil water pressure to the wilting point hw and 2 drying of 50 of the entire rooting depth gokdemir et al 2020 a combination of dynamic root zone wilting and the empirically based method to estimate the water storage in soil column was implemented to extend the vulnerability of the case study the soil profiles designed with an average rooting depth of 100 cm where the root zone is assumed to be 70 of root water supply provided by the upper 50 cm as an effective rooting depth δ e bennett and doss 1960 r δ r is distributed unevenly such that δ e represents approximately 80 of the root mass yu et al 2007 zhuang et al 2001 the seasonal alterations in vegetation root density were neglected and ravg was assumed to be constant both criterion of vulnerability is met when the pressure of the entire δ e reduced to hw 2 5 soil water storage estimation this study is designed to evaluate the effects of climatic conditions combined with groundwater table drawdown as a representation of tunnel drainage effects from a soil water storage perspective for this a budyko based framework was adopted where climate effects were hypothetically evaluated using fu curves fu 1981 zhang et al 2004 a semi empirical expression represents the water storage as follows 7 a e t p 1 p e t p 1 p e t p ω 1 ω where ω is the shape parameter representing the long term changes in soil water storage by drawdown and climate effect for the fu curves these curves indicate the ensemble characteristics of soil properties land cover and vegetation class wang et al 2016 zhang et al 2004 a seasonal aridity index is defined as the ratio of potential evaporation to effective precipitation where effective precipitation is the difference between rainfall and water storage change correspondingly an evaporation ratio is defined as the ratio of evaporation to effective precipitation according to eq 7 ω is considered as a regulatory parameter that modifies the division of annual q p between q ε and qr zhang et al 2004 and ranges between one and infinity in the literature typically budyko type analyses were initially conducted using the original budyko curve and with ω 2 6 as the reference value chen et al 2013 donohue et al 2012 greve et al 2016 wang et al 2016 although the aggregate physical meaning of ω is defined clearly alternate values have been proposed for the shape factor from different regions with diverse landscape characteristics gunkel and lange 2017 therefore in the present work budyko type analysis is covered for a wide range of fu curves and ω values 3 study site and case study this section designed to present the description of selected study site section 3 1 and the hypothetical case study section 3 2 includes the drawdown and atmospheric scenarios based on the study site information 3 1 study site the highway connection tunnel is located in yuexi county anhui province mid eastern china with a maximum depth of 548 m below ground surface and 7548 km long towards east to west direction the tunnel was constructed into a deep aquifer in moderately weathered granite and gneiss rock bodies the study site is an afforested area with chinese fir cunninghamia lanceolata and various understory species along with rock types the soil parent material is composed of residual clay soil over fully weathered gneiss and contains silty clay layers within it the forestry area of the study site 180 km2 has soft soil layers predominantly formed by silt and silty clay profiles up to 20 m in thickness above the tunnel zone the region has typical climatic features of central eastern china with a sub tropical humid climate according to the 34 year 1980 2014 data form houshan station the majority 70 of rainfall occurs between may and november with an average annual precipitation of 1147 8 mm the driest year 1995 received 775 7 mm rainfall while the wettest year 1990 received 1660 mm annual precipitation the annual rainfall 946 4 mm corresponding to the year after the tunnel construction was considered for the vulnerability assessment during this year further climatic and atmospheric evaluations were conducted based on the data collected from yuexi station which is similar to the study area in terms of elevation fig 3 c 3 2 case study a vulnerability assessment was conducted for the case study based on several scenarios related to forest cover weather conditions and soil types from the tunneling site the assumptions for parameters representing soil components of the case study were made based on the field observations from the study site and preliminary feasibility reports of the tunnel project in this section representation of the case study for the model assumptions and simulations is presented the wilting dynamics were tested from two perspectives for the case study i the combined effect of tunnel induced water drawdown and daily variation of atmospheric conditions and ii the summary of climatic condition of mingtang tunnel as the humid and sub humid dry climate for a year the impacts of different soil textures are evaluated inherently in all scenarios 3 2 1 assumptions for soil hydraulic parameters and topsoil model design the assumptions for the topsoil model components and defined bcs are summarized in table 1 the hypothetical scenarios are designed to assess vulnerability for different hydraulic heads on the tunnel after different drawdown conditions 3 2 2 scenarios and assumptions for atmospheric and climatic forcing although dynamic root zone wilting is related to the daily change of soil water pressure in the root zone the budyko type analysis is applied for a one year period because the water storage accuracy of the method reduces for shorter periods donohue et al 2007 the annual evapotranspiration et is evaluated as an aggregate value for the budyko type analysis the components of et are separated to examine their impact on water pressure distribution savenije 2004 total precipitation for the 2013 2014 tunneling year was 1135 mm with a daily average of 13 8 mm day and a total annual calculated pet of 946 mm according to unep the 1997 classification for the mingtang area is a typical humid climate aridity index 0 83 grove 1999 atmospheric bcs fig 4 were converted from daily meteorological data corresponding to the tunnel construction year using the standardized penman monteith method for tall canopies walter et al 2001 a synthetic atmospheric condition was created based on the meteorological data under the assumption of reduced annual rainfall by 40 and the local surface air temperature elevation by 2 c as the target future temperature in china fu et al 2018 to create a more arid atmospheric condition the altered synthetic atmospheric condition represents a sub humid dry climate with reduced total precipitation of 464 7 mm and a total annual pet of 680 mm aridity index 1 46 daily evaporative partitioning was assumed based on an empirical relationship between pet and q τ defined as q τ 0 73pet 0 43 in ouyang et al 2018 in the same work a similar coniferous forest dominated by cunninghamia lanceolata with approximately the same climatic conditions of eastern china was considered plant parameters were selected based on maximal usage of soil water for coniferous forests a layered soil profile was assumed as a reference for the mingtang area and compared with the homogeneous soil profiles atmospheric bcs were imposed on sandy clay sandy loam and layered soil profiles separately the lower bcs were assigned for all profiles fig 2 as the initial water table at t 1 was 8 h z t 1 0 at z z b 1 0 m the second boundary at t 2 for intermittent drawdown condition was 9 h z t 2 0 at z z b 5 0 m the lowest levels for the highest drainage impacts were 10 h z t 3 0 at z z b 10 m h z t 4 0 at z z b 20 m lower bcs were arranged to simulate the impact of drainage on a shallower water table and on a relatively deep water table here the shallow water tables zb 1 0 5 0m are where the saturated zone corresponds to the topsoil as the closest water level to the root zone model simulations were performed on a daily time scale for a year an intra annual analysis was conducted and results reported for before 90th day on 268th day and after the peak rainfall 350th day as marked by the vertical lines in fig 4 4 results the results are organized according to the components of vulnerability assessment demonstrated in fig 1 and the scenarios summarized in table 2 sub sections present the analysis of atmospheric section 4 1 and climatic section 4 2 effects on vulnerability 4 1 dynamic root zone wilting under different water drawdown scenarios with atmospheric conditions the analysis was conducted to explore the dynamics of vulnerability originating from i transient pressure distributions for defined soil profiles and ii various conditions of z b representing before after tunnel drainage had occurred the results of the two water drawdown scenarios from 5 0 m to 20 m fig 5 as deep and shallow 1 0 m to 10 m fig 6 are elaborated here intra annual outcomes for atmospheric conditions were used corresponding to the tunnel construction year three selections were made for that year the 90th and 350th day representing the start and end days of the wet season as the first and second dry periods in turn and the 268th day as the day having the most abundant rainfall the pressure profiles are shown for each selected day for the humid and sub humid dry climate scenarios in figs 5 and 6 all intra annual simulation outcomes based on changing groundwater levels are presented in appendix b fig b1 figs 5 and 6 show the transient simulation results from the topsoil model for three contrasting days that differ in daily atmospheric conditions water pressure distributions for these three periods were grouped based on the three modeled soil profiles homogeneous or layered in a total of 24 simulation results according to three scenario groups table 2 important physical observations were marked with numbers to facilitate understanding the intra annual pressure distributions demonstrate that differences in zb for deeper water table did not result in significant root zone wilting with the pressure curves representing simulations for the 20 m water table level mostly overlapping the ones for the 5 m water table level within the root zone dl5 dl20 the same behavior was observed also for the sandy clay soil scenario dsc5 dsc20 conversely the topsoil pressure distribution for the case studies of a shallow water table of z b 1m lead to wilting by the change of water table to 10 m such that for all soil profiles the shallow water table condition remains far from wilting conditions ④ in fig 6 however a drawdown to the water level of 10 m under sub humid dry climate conditions exhibits a transformation toward wilting the wilting zone manifests itself on simulations of dl5 dl10 and dl20 in the same fashion by exhibiting an expansion of the wilting zone to 10 cm rooting depth first and then reaches to δ e at the end of second dry period ② in fig 5 and ⑤ in fig 6d similarly the homogeneous sandy clay scenario with a sub humid dry climate shows expansion of the wilting zone over the whole δ e in the second dry period ⑤ in fig 6b all of the above case studies meet the vulnerability conditions independent of soil type the intra annual water pressure dynamics exhibited variability for the layered profile based on soil heterogeneity on the day of maximum rainfall perched water accumulated at depths of 60 cm and 160 cm in the humid climate except for the shallow water with 1 m soil depth hl5 hl20 in fig 5c ③ and hl10 in fig 6c in contrast a transient perched water table did not occur in the homogeneous case studies figs 5a and 6a and the soil remained saturated deeper than the maximum root depth throughout the year 2 0 4 0 m 4 2 soil water storage analysis for climatic scenarios although the previous analysis focused on the development of the wilting zone at a daily time scale it did not reveal information from the aggregate change in soil water storage based on climatic scenarios the budyko type analysis diagnoses the impact of shallow and deep groundwater level drawdown for yearlong water storage under humid and sub humid dry climate conditions fig 7 summarizes the change in soil water storage at the end of the year with each point representing the soil column with different settings the components of the figure are summarized as follows 1 simulation results for each soil column sandy loam sandy clay layered are presented salient points 2 experimental fu curves gray lines and limit lines dashed red line are included to show the position of salient points relative to each curve the budyko framework in fig 7 demonstrates two behaviors i the vertical movement of points simulation outcomes depends on their soil texture and changes in the water table and ii the horizontal movement of points because of an increase in aridity to a drier climate the upward movement between and within the points indicates an evaporative increase equivalent to water loss where the former represents a diversion from the layered soil profile circle and the latter the change in the shallow water table according to the budyko framework the evaporative index changes according to soil scenario fig 7 ① shows an evaporative increase water loss toward the simulation of sandy loam profiles larger than the sandy clay profile relative to the layered profile the evaporative increase for the sandy loam hls1 5 10 20 is approximately 12 136 2 mm in humid and also 12 55 8 mm in sub humid climates dls1 5 10 20 while for the sandy clay scenario it is approximately 2 22 7 mm for humid hsc20 and 5 23 24 mm for sub humid climates dsc20 all of the simulation outcomes are scattered over a wide range of ω values from 3 3 to approximately 10 the response of the water levels zb 5 m 10 m and 20 m to drawdown is not significant the soil water storage does not change significantly for either sandy clay or sandy loam profiles fig 7 ② the sandy loam scenario reached its limit for both climatic conditions which indicates that all the available water was used for evapotranspiration conversely the analysis shows that the variations in the water table are effective for water storage in the case of change from most shallow zb 1 m to deeper water level conditions see simulations hl1 hl20 and dl1 dl20 in fig 7 ③ 5 discussion 5 1 vulnerability of shallow water table in soil under atmospheric conditions in this study the water levels were designated based on borehole readings of the study site which in reference to water levels was deeper than 20 m until the rock bodies were exposed there is evidence to suggest that saturated groundwater level fluctuates from 1 to 30 m depending on topography and seasonality fan and miguez macho 2010 de graaf et al 2015 grogan and galvão 2006 this study follows the fact that the water table is the bottom limit of the vadose zone and regulates land drainage fan 2015 accordingly drawdown scenarios were designed to represent the change in base level water tables kafri and yechieli 2010 induced by long term tunnel drainage the intra annual outcomes of transient topsoil simulations suggest that humid atmospheric conditions do not lead to vulnerability even though pressure distribution in the root zone approaches the wilting point for sandy loam profiles under drawdown to zb 10m conversely in sub humid dry scenarios plants cannot recover following a peak rainfall period after drawdown to deep water levels dl20 therefore it can be inferred that atmospheric conditions are a distinctive factor for vulnerability in the case of deeper water level conditions the differences between soil water pressure distributions are not significant in the case of the drawdown scenario from 5 to 20 m fig 5b and d conversely the withdrawal of water table conditions from 1 to 10 m leads to a reduction in topsoil water pressure for both climatic conditions topsoil pressure meets the vulnerability conditions when combined with sub humid dry climate scenarios fig 6b and d the only scenario that does not show any influence by water drawdown is when layered soil is combined with humid climate fig 6c the top clay loam layer with low conductivity carried the plant available water yearlong despite the alterations to the saturated water level therefore the textural variety caused the topsoil pressure behavior to remain non vulnerable gokdemir et al 2020 yeh 1989 however when combined with a dry climatic scenario low conductive layers cannot inhibit the decrease in the saturated level induced by drawdown fig 6d and simulations reach vulnerable conditions after peak rainfall 350th day 5 2 influence of climatic conditions on soil water storage under drawdown scenarios from a perspective of vulnerability the profiles corresponded to fu curves and associated ω eq 7 and demonstrated that the reference simulation results for the study site fit into a reasonable range of ω for humid basins in china wang et al 2018 and the global values reported in gunkel and lange 2017 the changes in evaporation index due to the position of the reference condition in fig 7 revealed that a high permeability soil sandy loam leads to a higher water loss specifically the drainage capacity of the soil types impact aggregate soil water storage yokoo et al 2008 therefore the sandy loam simulations reached the limits for both climatic conditions fig 7 indicating that all q p infiltrated into the rooting zone was used the sandy loam profiles thus indicate a higher ω value 9 in humid climate conditions the system may retrieve the water loss from the soil however the sandy loam scenario in the sub humid dry climate leads to water stress conditions wherein the plant available water cannot be recovered on the other hand the soil profiles with less drainage capacity layered clay loam have lower evaporative index values despite their high potential of annual evapotranspiration salvucci and entekhabi 1995 compared to coarse grained soil types eagleson 1978 istanbulluoglu et al 2012 within the simulations textural differences dominated the change in water storage compared to the impact of variations in groundwater table from the impact of drawdown the reference simulation outcomes are the most responsive to the withdrawal of shallow water levels the general position of water storage outcomes prove that the drawdown scenario from shallow water z b 1m is a condition where the system loses water 22 7 mm and the drawdown seems insignificant in humid climates however from the perspective of vulnerability assessment the results indicate that the same amount of water lost to groundwater discharge via tunnel drainage manifests itself through an increase of ω from 3 3 to 3 5 fig 7 ③ and caused wilting of local vegetation under a sub humid dry climatic condition fig 6d even though the drawdown scenario from z b 5m to 20 m indicates water loss it does not represent a transition from non vulnerable to vulnerable conditions fig 5 hsc5 hsc20 hence a vertical shift in the budyko framework was absent overall in a humid climate the plant available water remained existent throughout the year and wilting conditions did not occur fig 5c thus the vegetation with a relatively lower water level would better resist the impacts of dry conditions when ample rainfall is available to create a perched water table robinson et al 2005 because the majority of the mingtang region has layered soil a deep drawdown which exceeds vegetation root depth would not cause the vegetation to wilt however the integrated vulnerability assessment method suggests that the study site region is sensitive to changes in climate therefore a substantial increase in annual temperature or a decrease in annual rainfall may result in the development of vulnerable conditions for the same textural soil structure 5 3 vulnerability assessment method viewed from a behavioral perspective in its basic form the vulnerability assessment is based on the dynamic root zone wilting and soil water storage analysis from section 3 1 the dynamic root zone analysis evaluates the impacts on an hourly to daily basis therefore it is only possible to see the impact of climatic changes on an extended decadal time scale through the inclusion of a soil water budget from a vulnerability perspective the soil water budget analysis demonstrated two critical behaviors based on climatic and drawdown scenarios i increase in aridity based on climatic alteration and ii evaporative increase associated with the drawdown of groundwater level for the specific case of this study the former behavior led simulation results to follow specific fu curves which suggests essential insight but not a clear outcome in terms of vulnerability assessment as it is not possible to know whether vulnerability conditions were satisfied however the latter behavior represents a minimal change in water storage compared to annual rainfall while the dynamic wilting analysis captures the occurrence of vulnerability conditions water budget including budyko type analysis reveals the amount of annual water loss to tunnel drainage that causes the vulnerability based on climatic scenarios although the derived ω parameter values in the literature for basins and sub basins exhibit a wide range of values the cause of higher or lower fu curves depends on the regional characteristics of the secondary controls vegetation land cover topography etc gunkel and lange 2017 yang et al 2009 temporal zhang et al 2008 and spatial xu et al 2013 analysis scales of the investigation also control the curves independent of the prevalent climatic conditions the analysis results in this study suggest that the values of ω parameters higher than the reference curve ω 2 6 are linked to the most likely occurrence of vulnerability in the case of drained water storage 6 conclusion the research presented in this study targets including atmospheric and climatic evaluation in the impact assessment of deep tunnel drainage through integration to a vulnerability assessment method for terrestrial vegetation the dynamics of vulnerability induced by drawdown were examined by integrating the dynamic root zone wilting with soil water storage analysis from daily to annual scales respectively accordingly intra annual simulation results showed that the drawdown alone did not cause vulnerability in a humid climate after tunnel drainage however vulnerability conditions are met in a sub humid climate the shallower water conditions response to drawdown exhibits behavior that the vegetation adapted to shallower water conditions were exposed to vulnerability after tunnel drainage combined with the intra annual results according to the approximate estimations derived from the soil water storage analysis all sandy loam soil simulation results demonstrated the highest evaporative potential discharge by tunnel drainage did lead to water loss in the representative scenarios for both climatic conditions however the case studies with high value in the budyko framework satisfied the vulnerability conditions in the transient model through an increase in aridity the analysis results support the idea that the change in climatic conditions is more deterministic than the groundwater level differences on shallow water from a vulnerability perspective the interpretations of the outcomes of dynamic root zone wilting and soil water storage analysis prove that the assessment is successfully links the impact of drainage induced drawdown and physical modeling credit authorship contribution statement cagri gokdemir conceptualization methodology software formal analysis investigation data curation visualization writing original draft yoram rubin supervision writing review editing xiaojun li supervision resources writing review editing hao xu investigation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the research was conducted with support from the natural science foundation of china grant no 41877246 the science and technology plan project of the ministry of transport of china 2013318j02120 the tongji civil engineering peak discipline plan and the fundamental research funds for central universities supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103796 appendix c supplementary materials image application 1 appendix a this appendix contains the summary of assumptions for rwu in this research the assumptions are linked to topsoil model defined in section 3 2 r δ r is normalized water uptake distribution that is given as a1 r δ r r δ r 0 δ r max r δ r d δ r in eq a1 r δ r represents the root specific length as the length of the root per unit volume soil the denominator in the equation represents the normalization of the uptake distribution to ensure the integration of r δ r to unity over the maximum relative rooting depth δ r max the root zone is assumed as fully grown and the uptake in the zone is controlled by r δ r dos santos et al 2017 therefore a2 r δ r b 2 r a v g b ex p b 1 1 δ r ex p b δ r b 0 where ravg is the average root density and b is a shape factor parameter for the root distribution fig a1 b based on the design of root distribution q τ can be linked to the soil water pressure depending on soil water availability feddes et al 2001 as follows a3 q τ root μ h q τ where μ h is a dimensionless stepwise water pressure response function also called the plant limiting function fig a1 a illustrates the variation in the limiting function with h which is a stepwise response function summarized in eq a4 šimunek et al 1992 a4 μ h 0 h h w h h w 1 h h w h w h h h h here the function represents rwu responses based on thresholds of wilting and stomatal closure h pressure values from h up to maximum pressure point h max q τ root z is its maximum rate and diminishes after h to zero on hw appendix b all intra annual simulations results were demonstrated according to case studies in fig b1 
353,the impact of tunnel drainage on local water resources has attracted increasing attention in the past decades the potential impacts of tunnel drainage on terrestrial vegetation have been evaluated from a groundwater environment perspective however previous attempts did not consider the atmospheric and climatic conditions along with the change to the regional groundwater table to address the lack of atmospheric influence this study proposes a vulnerability assessment method focused on the soil plant atmosphere continuum by taking tunnel drainage atmospheric and climatic impacts into account the proposed method consists of five stages 1 groundwater seepage model for water table distribution 2 topsoil model based on a single column perspective for soil water pressure distributions 3 dynamic root zone wilting for the transient model 4 budyko type analysis for the soil water storage under longer term climatic changes and 5 summary based on the outcomes of vulnerability analysis the case study was located in the yuexi county anhui east china and was investigated based on different soil textures weather conditions and groundwater table drawdown scenarios transient intra annual water pressure dynamics were simulated for one year and aggregate variations of soil water storage were summarized using the budyko framework the assessment method demonstrated that the textural differences and climatic changes are more impactful on plant vulnerability compared to the drainage effect in the specific case the increase in aridity towards the sub humid dry climate drives the soil columns to decrease the water storage where the significant loss of water storage was also observed in the budyko type framework the outcomes suggest that under sub humid dry conditions when combined with tunnel drainage the drawdown on shallow groundwater levels leads the vegetation to be vulnerable keywords soil plant atmosphere continuum root zone wilting soil water budget soil water pressure tunnel drainage environmental vulnerability assessment nomenclature aet actual evapotranspiration mm d 1 b shape factor parameter for r δ r eq a2 dimensionless et evapotranspiration cm d 1 h h z t hydraulic head and water table level m h 0 h z t 1 initial hydraulic head and water table level m h h z t soil water pressure cm h soil water pressure below which plants begin closing their stomata cm h max soil water pressure value below which roots extract water at the maximum rate until h cm h min allowable minimum soil water pressure at the soil surface cm hw soil water pressure below which plants begin to wilt cm i canopy interception mm k k h unsaturated hydraulic conductivity m s 1 k eff effective hydraulic conductivity for layered soil profile m s 1 k s saturated hydraulic conductivity m s 1 n exponent in the soil water retention function dimensionless p precipitation mm pet potential evapotranspiration mm d 1 q 0 q 0 t initial surface flux cm d 1 q max maximum constant surface flux cm q p precipitation flux on the soil surface qr soil surface runoff flux q τ root possible root water extraction flux cm d 1 q τ 0 the potential transpiration flux cm d 1 q τ potential water extraction flux as function of vertical coordinate also referred to as the spatial distribution of q τ 0 over the rooting zone cm d 1 q τ a actual transpiration flux cm d 1 q ε potential evaporation flux cm d 1 q ε a actual evaporation flux cm d 1 r δ r root length density distribution cm 3 r δ r normalized water uptake distribution unitless ravg medium root length density cm 3 rwu root water uptake cm d 1 s s specific storage m 1 spac soil plant atmosphere continuum t time d t 0 time when simulation begins d t 1 initiation time of drawdown induced by tunnel drainage d t 2 t 3 intermittent times that represent the duration after the tunnel drainage d t 4 the time water table stagnates and drawdown stops d w net volumetric sink source term m3m 3s 1 z vertical coordinate cm zb zb t water table level and lower boundary value cm z max depth of rock surface cm α empirical parameter in the soil retention function d 1 α d value of α for drying condition of the soil water retention function d 1 α w value of α for wetting condition of the soil water retention function d 1 β soil surface slope angle degrees δ rooting depth cm δ e effective rooting depth which represents 50 of the total rooting depth cm δ r relative root length normalized by δ dimensionless δ r max the maximum relative rooting depth cm δ w the portion of the rooting depth which corresponds to hw cm θ θ h soil water content m3m 3 θ r residual soil water content m3m 3 θ s saturated soil water content m3m 3 θ s d saturated soil water content of the drying condition m3m 3 θ s w saturated soil water content of the wetting condition m3m 3 μ h root water uptake as a function of soil water pressure dimensionless ω modified budyko model parameter referred to as the shape parameter dimensionless 1 introduction tunnel inflow during excavation and prolonged discharge by drainage during its life cycle out of the tunnel may cause groundwater resource depletion underground tunnel drainage alters the regional groundwater flow system and disturbs the local water balance gargini et al 2008 scheidler et al 2017 vincenzi et al 2009 there is also evidence that highlights the adverse effects of deep underground drainage on the land surface butscher et al 2011 chiu and chia 2012 kim et al 2008 kværner and snilsberg 2008 li et al 2016 as a result potential impacts of tunnel drainage during underground excavations were evaluated from an environmental perspective huang et al 2015 li et al 2018 mossmark et al 2017 and the impact on the hydrogeological environment yang et al 2009 was considered recent studies have targeted the impact on terrestrial vegetation including the groundwater drawdown li et al 2018 and topsoil water dynamics gokdemir et al 2020 others have determined limiting tunnel drainage rate considering the ecological groundwater table level cheng et al 2014 2019 although these works explained the relationship between discharge induced drawdown and terrestrial vegetation the contribution of atmospheric and climatic dynamics to the topsoil rooting zone during tunnel drainage was excluded the assessment results for the impact of tunnel drainage on terrestrial vegetation indicate that discharge induced drawdown causes a reduction in plant growth zheng et al 2017 and crop yield nosetto et al 2009 additionally atmospheric studies emphasizing the interaction between terrain vegetation soil water balance and groundwater levels jiang et al 2009 leung et al 2011 martínez de la torre and miguez macho 2019 rahman et al 2015 rihani et al 2010 reveal the dynamics between subsurface and atmospheric conditions atmos therefore it is critical to include the association between topsoil water content and atmospheric forcing in the assessment of tunnel drainage in this study vulnerability stands for the negative impact on vegetation due to the wilting of the terrestrial vegetation that occurs when soil water pressure in the rooting zone reduces to the wilting point gokdemir et al 2020 which is denoted as the point at which the plants cannot retrieve necessary water for their survival kirkham 2014 if wilting point conditions persist terrestrial plants start to die off and vulnerability conditions are met the occurrence of vulnerability is primarily related to infiltration and soil water storage thus the increased water storage in the soil inhibits the occurrence of vulnerability therefore the vulnerability is controlled by the amount of water in the soil in ideal conditions the resources of soil water storage are groundwater and rainfall for the topsoil the assessment of vulnerability requires consideration of both sources this research considers the evaluation of environmental impact induced by deep tunnel drainage from the soil plant atmosphere continuum spac perspective norman and anderson 2004 in this context the long term aridity of the field is important based on atmospheric and climatic factors regions with a high rate of increased aridity are expected to be more vulnerable spinoni et al 2015 however in the case of shallow water table depths plants may shift sufficient supplies of water needed for their survival against aridity cui and shao 2005 the water storage that remains inside the soil and accessible by vegetation is called plant available water supplied from groundwater as an essential source for vegetation survival especially in prolonged dry seasons yang et al 2017 thus empirically based estimates for water storage associated with hypothetical and real cases are proposed including plant available water in the soil milly 1994 yang et al 2009 yokoo et al 2008 a semi empirical approach is included in this study to evaluate the relationship between soil moisture dynamics and monthly variations in soil water storage in the vulnerability assessment the primary form of the budyko framework approach budyko 1958 1974 was considered and represents the relationship between the ratio of actual evapotranspiration aet to precipitation p and aridity as the ratio of potential evapotranspiration pet to precipitation this study focuses on including the atmospheric and climatic components to the tunnel drainage impact by proposing an assessment method that can analyze the interactions between atmospheric and climatic conditions and groundwater table drawdown in soil media from a vulnerability perspective unlike previous attempts this work provides an impact assessment including the soil layer s water dynamics and the rooting zone coupling with atmospheric conditions for this purpose the vulnerability assessment method is employed on a specific case study to evaluate the vulnerability of terrain vegetation according to the difference in aridity accordingly this study is organized as follows section 2 introduces the methodology including the sub sections of vulnerability assessment method and brief definition of groundwater seepage and transient topsoil model components section 3 summarizes the study site and followed by a subsection that presents the design of hypothetical case study scenarios and atmospheric boundary conditions section 4 summarizes the results of the application of vulnerability assessment method and soil water storage analysis from the budyko perspective the study is finalized with discussions in section 5 and a summary and conclusion in section 6 2 methodology 2 1 vulnerability assessment in this section the relationship of the proposed vulnerability assessment framework with atmospheric forcing under the influence of tunnel drainage is introduced the components that link spac perspective to vulnerability according to local climate are explained 2 1 1 assessment method based on atmospheric factors the vulnerability assessment method is a product of the integration of numerical modeling with empirical concepts in this context the data flow of the method is designed to feed the topsoil and groundwater models the vulnerability analysis was conducted using the outcomes of the topsoil model where the effect of daily atmospheric conditions was analyzed using dynamic root zone wilting the changes in soil water storage were evaluated depending on the climatic difference on a yearly scale using budyko type analysis fig 1 d the vulnerability assessment method employs the following stages a groundwater seepage model for water table distribution b topsoil model based on a single column perspective for soil water pressure distributions c dynamic root zone wilting for the transient model d budyko type analysis for the soil water storage under longer term climatic changes e summary based on the outcomes of vulnerability analysis the sequential nature of the vulnerability analysis gives the freedom to evaluate the system from hourly to yearly time scales hourly processes such as canopy interception and rainfall daily process of evaporation and monthly process of transpiration baird and wilby 1999 savenije 1997 can be included in the system individually as the principal element of the method the vulnerability assessment method provides a way to test the occurrence of vegetation wilting and the exceedance of the plant available water limits based on climatic conditions 2 2 groundwater seepage model the groundwater seepage model provides the transient groundwater level distributions by using the finite difference groundwater model modflow harbaugh 2005 to solve eq 1 1 s s h t k s h w where ss is the specific storage h represents hydraulic head or water level and k s is saturated hydraulic conductivity that is assumed for homogeneous and isotropic porous media w is the net volumetric sink source term the recharge process and tunnel drainage are considered as the source and the sink respectively discretization is made based on the refined grid principle to represent the tunnel surface where drainage nodes are located on the tunnel surface zero hydraulic head conditions are simulated 2 h 0 along the tunnel interior and seepage and tunnel drainage flux is calculated in this research we have focused on the representative drawdown conditions observed in the outcomes of the groundwater seepage model after performing the tunnel drainage simulations the validation was performed based on measured tunnel drainage flux and borehole groundwater hydraulic head measurements li et al 2018 2 3 transient topsoil model the topsoil model was prepared to solve unsaturated flow in the vadose zone the hydrus 1d model šimůnek et al 2013 is used to represent the components of spac as the topsoil model layered and homogeneous soil columns rooting depth water uptake model and atmospheric boundary conditions were implemented into the model hydrus 1d was selected to employ a one dimensional solution of the mixed form richards equation as a verified tool that has been used in several prior studies on soil water dynamics and surface processes e g balugani et al 2017 šimunek et al 2012 soylu et al 2011 zlotnik et al 2007 the topsoil model is designed to respond to three components one for the net infiltration on the ground surface eq 2 another for the root water uptake rwu and on for the deep or shallow soil groundwater table the first component is considered as the mass balance on the soil surface 2 q 0 q p cos β q r q ε where q indicates water fluxes and q 0 stands for infiltration with subscripts of surface runoff r daily precipitation p and evaporation ε that represent aggregate soil and canopy evaporation and where β is the surface slope angle in this study the unit soil column approach is adopted dagan and bresler 1983 rubin and or 1993 see fig 2 and q 0 is imposed as the boundary condition at the ground surface infiltration without ponding is assumed on a flat soil surface β 0 the potential root uptake q τ at z δ can be calculated from q τ 0 which is included in the topsoil model as a function of relative rooting depth δ r 3 q τ q τ 0 r δ r for z δ where δ r is the normalized soil depth with rooting depth z δ q τ 0 is the potential transpiration flux which is assigned based on the dominant vegetation type at the study site and the normalized water uptake distribution is r δ r see appendix a for the assumptions of rwu and integration into the rooting zone integration of eq 3 over rooting depth leads to the actual transpiration flux 4 q τ a 0 δ max q τ root d δ aet is calculated as the sum of q τ a and actual evaporation flux q ε a for a particular time period the numerical solution of richards equation eq 5 was obtained for atmospheric bc as 5 θ z t z k h d h d z 1 q τ root z accordingly eq 5 was subjected to the following conditions neuman et al 1974 for the soil surface upper bc 6 k h d h d z 1 q max at z 0 h min h t 0 at z 0 where h min is the allowable minimum pressure head at the soil surface and determined based on the equilibrium between water vapor and soil water content and q max is equivalent to potential evaporation or infiltration rate under the imposed atmospheric conditions thus q ε a is estimated by simulating soil water pressure by the imposed bcs eq 6 on 5 unless runoff conditions are met then eq 5 is solved imposing atmospheric and groundwater table bcs that interact with rwu in the root zone the relationship between unsaturated hydraulic conductivity k h and volumetric water content θ z is modeled using the assumptions of the mualem van genuchten soil hydraulic model under hysteretic conditions for details see van genuchten 1980 mualem 1976 as the third and final component the groundwater table is designed as the lower boundary condition zb here zb represents a hydraulic head that can be changed due to the impact of tunnel drainage and received from the groundwater seepage model zb is equivalent to the initial hydraulic head h 0 when the drainage conditions are non existent four lower bcs are selected to represent a gradual reduction in water table levels for the same representative layered soil profile fig 2 the bottom bcs are set to represent the scenario with different groundwater table which is exposed to drawdown induced by tunnel drainage 2 4 dynamic root zone wilting the method is created based on the dynamic root zone wilting concept which relies on a double vulnerability criterion on a single soil profile these criteria represent two simultaneous conditions 1 any condition that reduces topsoil water pressure to the wilting point hw and 2 drying of 50 of the entire rooting depth gokdemir et al 2020 a combination of dynamic root zone wilting and the empirically based method to estimate the water storage in soil column was implemented to extend the vulnerability of the case study the soil profiles designed with an average rooting depth of 100 cm where the root zone is assumed to be 70 of root water supply provided by the upper 50 cm as an effective rooting depth δ e bennett and doss 1960 r δ r is distributed unevenly such that δ e represents approximately 80 of the root mass yu et al 2007 zhuang et al 2001 the seasonal alterations in vegetation root density were neglected and ravg was assumed to be constant both criterion of vulnerability is met when the pressure of the entire δ e reduced to hw 2 5 soil water storage estimation this study is designed to evaluate the effects of climatic conditions combined with groundwater table drawdown as a representation of tunnel drainage effects from a soil water storage perspective for this a budyko based framework was adopted where climate effects were hypothetically evaluated using fu curves fu 1981 zhang et al 2004 a semi empirical expression represents the water storage as follows 7 a e t p 1 p e t p 1 p e t p ω 1 ω where ω is the shape parameter representing the long term changes in soil water storage by drawdown and climate effect for the fu curves these curves indicate the ensemble characteristics of soil properties land cover and vegetation class wang et al 2016 zhang et al 2004 a seasonal aridity index is defined as the ratio of potential evaporation to effective precipitation where effective precipitation is the difference between rainfall and water storage change correspondingly an evaporation ratio is defined as the ratio of evaporation to effective precipitation according to eq 7 ω is considered as a regulatory parameter that modifies the division of annual q p between q ε and qr zhang et al 2004 and ranges between one and infinity in the literature typically budyko type analyses were initially conducted using the original budyko curve and with ω 2 6 as the reference value chen et al 2013 donohue et al 2012 greve et al 2016 wang et al 2016 although the aggregate physical meaning of ω is defined clearly alternate values have been proposed for the shape factor from different regions with diverse landscape characteristics gunkel and lange 2017 therefore in the present work budyko type analysis is covered for a wide range of fu curves and ω values 3 study site and case study this section designed to present the description of selected study site section 3 1 and the hypothetical case study section 3 2 includes the drawdown and atmospheric scenarios based on the study site information 3 1 study site the highway connection tunnel is located in yuexi county anhui province mid eastern china with a maximum depth of 548 m below ground surface and 7548 km long towards east to west direction the tunnel was constructed into a deep aquifer in moderately weathered granite and gneiss rock bodies the study site is an afforested area with chinese fir cunninghamia lanceolata and various understory species along with rock types the soil parent material is composed of residual clay soil over fully weathered gneiss and contains silty clay layers within it the forestry area of the study site 180 km2 has soft soil layers predominantly formed by silt and silty clay profiles up to 20 m in thickness above the tunnel zone the region has typical climatic features of central eastern china with a sub tropical humid climate according to the 34 year 1980 2014 data form houshan station the majority 70 of rainfall occurs between may and november with an average annual precipitation of 1147 8 mm the driest year 1995 received 775 7 mm rainfall while the wettest year 1990 received 1660 mm annual precipitation the annual rainfall 946 4 mm corresponding to the year after the tunnel construction was considered for the vulnerability assessment during this year further climatic and atmospheric evaluations were conducted based on the data collected from yuexi station which is similar to the study area in terms of elevation fig 3 c 3 2 case study a vulnerability assessment was conducted for the case study based on several scenarios related to forest cover weather conditions and soil types from the tunneling site the assumptions for parameters representing soil components of the case study were made based on the field observations from the study site and preliminary feasibility reports of the tunnel project in this section representation of the case study for the model assumptions and simulations is presented the wilting dynamics were tested from two perspectives for the case study i the combined effect of tunnel induced water drawdown and daily variation of atmospheric conditions and ii the summary of climatic condition of mingtang tunnel as the humid and sub humid dry climate for a year the impacts of different soil textures are evaluated inherently in all scenarios 3 2 1 assumptions for soil hydraulic parameters and topsoil model design the assumptions for the topsoil model components and defined bcs are summarized in table 1 the hypothetical scenarios are designed to assess vulnerability for different hydraulic heads on the tunnel after different drawdown conditions 3 2 2 scenarios and assumptions for atmospheric and climatic forcing although dynamic root zone wilting is related to the daily change of soil water pressure in the root zone the budyko type analysis is applied for a one year period because the water storage accuracy of the method reduces for shorter periods donohue et al 2007 the annual evapotranspiration et is evaluated as an aggregate value for the budyko type analysis the components of et are separated to examine their impact on water pressure distribution savenije 2004 total precipitation for the 2013 2014 tunneling year was 1135 mm with a daily average of 13 8 mm day and a total annual calculated pet of 946 mm according to unep the 1997 classification for the mingtang area is a typical humid climate aridity index 0 83 grove 1999 atmospheric bcs fig 4 were converted from daily meteorological data corresponding to the tunnel construction year using the standardized penman monteith method for tall canopies walter et al 2001 a synthetic atmospheric condition was created based on the meteorological data under the assumption of reduced annual rainfall by 40 and the local surface air temperature elevation by 2 c as the target future temperature in china fu et al 2018 to create a more arid atmospheric condition the altered synthetic atmospheric condition represents a sub humid dry climate with reduced total precipitation of 464 7 mm and a total annual pet of 680 mm aridity index 1 46 daily evaporative partitioning was assumed based on an empirical relationship between pet and q τ defined as q τ 0 73pet 0 43 in ouyang et al 2018 in the same work a similar coniferous forest dominated by cunninghamia lanceolata with approximately the same climatic conditions of eastern china was considered plant parameters were selected based on maximal usage of soil water for coniferous forests a layered soil profile was assumed as a reference for the mingtang area and compared with the homogeneous soil profiles atmospheric bcs were imposed on sandy clay sandy loam and layered soil profiles separately the lower bcs were assigned for all profiles fig 2 as the initial water table at t 1 was 8 h z t 1 0 at z z b 1 0 m the second boundary at t 2 for intermittent drawdown condition was 9 h z t 2 0 at z z b 5 0 m the lowest levels for the highest drainage impacts were 10 h z t 3 0 at z z b 10 m h z t 4 0 at z z b 20 m lower bcs were arranged to simulate the impact of drainage on a shallower water table and on a relatively deep water table here the shallow water tables zb 1 0 5 0m are where the saturated zone corresponds to the topsoil as the closest water level to the root zone model simulations were performed on a daily time scale for a year an intra annual analysis was conducted and results reported for before 90th day on 268th day and after the peak rainfall 350th day as marked by the vertical lines in fig 4 4 results the results are organized according to the components of vulnerability assessment demonstrated in fig 1 and the scenarios summarized in table 2 sub sections present the analysis of atmospheric section 4 1 and climatic section 4 2 effects on vulnerability 4 1 dynamic root zone wilting under different water drawdown scenarios with atmospheric conditions the analysis was conducted to explore the dynamics of vulnerability originating from i transient pressure distributions for defined soil profiles and ii various conditions of z b representing before after tunnel drainage had occurred the results of the two water drawdown scenarios from 5 0 m to 20 m fig 5 as deep and shallow 1 0 m to 10 m fig 6 are elaborated here intra annual outcomes for atmospheric conditions were used corresponding to the tunnel construction year three selections were made for that year the 90th and 350th day representing the start and end days of the wet season as the first and second dry periods in turn and the 268th day as the day having the most abundant rainfall the pressure profiles are shown for each selected day for the humid and sub humid dry climate scenarios in figs 5 and 6 all intra annual simulation outcomes based on changing groundwater levels are presented in appendix b fig b1 figs 5 and 6 show the transient simulation results from the topsoil model for three contrasting days that differ in daily atmospheric conditions water pressure distributions for these three periods were grouped based on the three modeled soil profiles homogeneous or layered in a total of 24 simulation results according to three scenario groups table 2 important physical observations were marked with numbers to facilitate understanding the intra annual pressure distributions demonstrate that differences in zb for deeper water table did not result in significant root zone wilting with the pressure curves representing simulations for the 20 m water table level mostly overlapping the ones for the 5 m water table level within the root zone dl5 dl20 the same behavior was observed also for the sandy clay soil scenario dsc5 dsc20 conversely the topsoil pressure distribution for the case studies of a shallow water table of z b 1m lead to wilting by the change of water table to 10 m such that for all soil profiles the shallow water table condition remains far from wilting conditions ④ in fig 6 however a drawdown to the water level of 10 m under sub humid dry climate conditions exhibits a transformation toward wilting the wilting zone manifests itself on simulations of dl5 dl10 and dl20 in the same fashion by exhibiting an expansion of the wilting zone to 10 cm rooting depth first and then reaches to δ e at the end of second dry period ② in fig 5 and ⑤ in fig 6d similarly the homogeneous sandy clay scenario with a sub humid dry climate shows expansion of the wilting zone over the whole δ e in the second dry period ⑤ in fig 6b all of the above case studies meet the vulnerability conditions independent of soil type the intra annual water pressure dynamics exhibited variability for the layered profile based on soil heterogeneity on the day of maximum rainfall perched water accumulated at depths of 60 cm and 160 cm in the humid climate except for the shallow water with 1 m soil depth hl5 hl20 in fig 5c ③ and hl10 in fig 6c in contrast a transient perched water table did not occur in the homogeneous case studies figs 5a and 6a and the soil remained saturated deeper than the maximum root depth throughout the year 2 0 4 0 m 4 2 soil water storage analysis for climatic scenarios although the previous analysis focused on the development of the wilting zone at a daily time scale it did not reveal information from the aggregate change in soil water storage based on climatic scenarios the budyko type analysis diagnoses the impact of shallow and deep groundwater level drawdown for yearlong water storage under humid and sub humid dry climate conditions fig 7 summarizes the change in soil water storage at the end of the year with each point representing the soil column with different settings the components of the figure are summarized as follows 1 simulation results for each soil column sandy loam sandy clay layered are presented salient points 2 experimental fu curves gray lines and limit lines dashed red line are included to show the position of salient points relative to each curve the budyko framework in fig 7 demonstrates two behaviors i the vertical movement of points simulation outcomes depends on their soil texture and changes in the water table and ii the horizontal movement of points because of an increase in aridity to a drier climate the upward movement between and within the points indicates an evaporative increase equivalent to water loss where the former represents a diversion from the layered soil profile circle and the latter the change in the shallow water table according to the budyko framework the evaporative index changes according to soil scenario fig 7 ① shows an evaporative increase water loss toward the simulation of sandy loam profiles larger than the sandy clay profile relative to the layered profile the evaporative increase for the sandy loam hls1 5 10 20 is approximately 12 136 2 mm in humid and also 12 55 8 mm in sub humid climates dls1 5 10 20 while for the sandy clay scenario it is approximately 2 22 7 mm for humid hsc20 and 5 23 24 mm for sub humid climates dsc20 all of the simulation outcomes are scattered over a wide range of ω values from 3 3 to approximately 10 the response of the water levels zb 5 m 10 m and 20 m to drawdown is not significant the soil water storage does not change significantly for either sandy clay or sandy loam profiles fig 7 ② the sandy loam scenario reached its limit for both climatic conditions which indicates that all the available water was used for evapotranspiration conversely the analysis shows that the variations in the water table are effective for water storage in the case of change from most shallow zb 1 m to deeper water level conditions see simulations hl1 hl20 and dl1 dl20 in fig 7 ③ 5 discussion 5 1 vulnerability of shallow water table in soil under atmospheric conditions in this study the water levels were designated based on borehole readings of the study site which in reference to water levels was deeper than 20 m until the rock bodies were exposed there is evidence to suggest that saturated groundwater level fluctuates from 1 to 30 m depending on topography and seasonality fan and miguez macho 2010 de graaf et al 2015 grogan and galvão 2006 this study follows the fact that the water table is the bottom limit of the vadose zone and regulates land drainage fan 2015 accordingly drawdown scenarios were designed to represent the change in base level water tables kafri and yechieli 2010 induced by long term tunnel drainage the intra annual outcomes of transient topsoil simulations suggest that humid atmospheric conditions do not lead to vulnerability even though pressure distribution in the root zone approaches the wilting point for sandy loam profiles under drawdown to zb 10m conversely in sub humid dry scenarios plants cannot recover following a peak rainfall period after drawdown to deep water levels dl20 therefore it can be inferred that atmospheric conditions are a distinctive factor for vulnerability in the case of deeper water level conditions the differences between soil water pressure distributions are not significant in the case of the drawdown scenario from 5 to 20 m fig 5b and d conversely the withdrawal of water table conditions from 1 to 10 m leads to a reduction in topsoil water pressure for both climatic conditions topsoil pressure meets the vulnerability conditions when combined with sub humid dry climate scenarios fig 6b and d the only scenario that does not show any influence by water drawdown is when layered soil is combined with humid climate fig 6c the top clay loam layer with low conductivity carried the plant available water yearlong despite the alterations to the saturated water level therefore the textural variety caused the topsoil pressure behavior to remain non vulnerable gokdemir et al 2020 yeh 1989 however when combined with a dry climatic scenario low conductive layers cannot inhibit the decrease in the saturated level induced by drawdown fig 6d and simulations reach vulnerable conditions after peak rainfall 350th day 5 2 influence of climatic conditions on soil water storage under drawdown scenarios from a perspective of vulnerability the profiles corresponded to fu curves and associated ω eq 7 and demonstrated that the reference simulation results for the study site fit into a reasonable range of ω for humid basins in china wang et al 2018 and the global values reported in gunkel and lange 2017 the changes in evaporation index due to the position of the reference condition in fig 7 revealed that a high permeability soil sandy loam leads to a higher water loss specifically the drainage capacity of the soil types impact aggregate soil water storage yokoo et al 2008 therefore the sandy loam simulations reached the limits for both climatic conditions fig 7 indicating that all q p infiltrated into the rooting zone was used the sandy loam profiles thus indicate a higher ω value 9 in humid climate conditions the system may retrieve the water loss from the soil however the sandy loam scenario in the sub humid dry climate leads to water stress conditions wherein the plant available water cannot be recovered on the other hand the soil profiles with less drainage capacity layered clay loam have lower evaporative index values despite their high potential of annual evapotranspiration salvucci and entekhabi 1995 compared to coarse grained soil types eagleson 1978 istanbulluoglu et al 2012 within the simulations textural differences dominated the change in water storage compared to the impact of variations in groundwater table from the impact of drawdown the reference simulation outcomes are the most responsive to the withdrawal of shallow water levels the general position of water storage outcomes prove that the drawdown scenario from shallow water z b 1m is a condition where the system loses water 22 7 mm and the drawdown seems insignificant in humid climates however from the perspective of vulnerability assessment the results indicate that the same amount of water lost to groundwater discharge via tunnel drainage manifests itself through an increase of ω from 3 3 to 3 5 fig 7 ③ and caused wilting of local vegetation under a sub humid dry climatic condition fig 6d even though the drawdown scenario from z b 5m to 20 m indicates water loss it does not represent a transition from non vulnerable to vulnerable conditions fig 5 hsc5 hsc20 hence a vertical shift in the budyko framework was absent overall in a humid climate the plant available water remained existent throughout the year and wilting conditions did not occur fig 5c thus the vegetation with a relatively lower water level would better resist the impacts of dry conditions when ample rainfall is available to create a perched water table robinson et al 2005 because the majority of the mingtang region has layered soil a deep drawdown which exceeds vegetation root depth would not cause the vegetation to wilt however the integrated vulnerability assessment method suggests that the study site region is sensitive to changes in climate therefore a substantial increase in annual temperature or a decrease in annual rainfall may result in the development of vulnerable conditions for the same textural soil structure 5 3 vulnerability assessment method viewed from a behavioral perspective in its basic form the vulnerability assessment is based on the dynamic root zone wilting and soil water storage analysis from section 3 1 the dynamic root zone analysis evaluates the impacts on an hourly to daily basis therefore it is only possible to see the impact of climatic changes on an extended decadal time scale through the inclusion of a soil water budget from a vulnerability perspective the soil water budget analysis demonstrated two critical behaviors based on climatic and drawdown scenarios i increase in aridity based on climatic alteration and ii evaporative increase associated with the drawdown of groundwater level for the specific case of this study the former behavior led simulation results to follow specific fu curves which suggests essential insight but not a clear outcome in terms of vulnerability assessment as it is not possible to know whether vulnerability conditions were satisfied however the latter behavior represents a minimal change in water storage compared to annual rainfall while the dynamic wilting analysis captures the occurrence of vulnerability conditions water budget including budyko type analysis reveals the amount of annual water loss to tunnel drainage that causes the vulnerability based on climatic scenarios although the derived ω parameter values in the literature for basins and sub basins exhibit a wide range of values the cause of higher or lower fu curves depends on the regional characteristics of the secondary controls vegetation land cover topography etc gunkel and lange 2017 yang et al 2009 temporal zhang et al 2008 and spatial xu et al 2013 analysis scales of the investigation also control the curves independent of the prevalent climatic conditions the analysis results in this study suggest that the values of ω parameters higher than the reference curve ω 2 6 are linked to the most likely occurrence of vulnerability in the case of drained water storage 6 conclusion the research presented in this study targets including atmospheric and climatic evaluation in the impact assessment of deep tunnel drainage through integration to a vulnerability assessment method for terrestrial vegetation the dynamics of vulnerability induced by drawdown were examined by integrating the dynamic root zone wilting with soil water storage analysis from daily to annual scales respectively accordingly intra annual simulation results showed that the drawdown alone did not cause vulnerability in a humid climate after tunnel drainage however vulnerability conditions are met in a sub humid climate the shallower water conditions response to drawdown exhibits behavior that the vegetation adapted to shallower water conditions were exposed to vulnerability after tunnel drainage combined with the intra annual results according to the approximate estimations derived from the soil water storage analysis all sandy loam soil simulation results demonstrated the highest evaporative potential discharge by tunnel drainage did lead to water loss in the representative scenarios for both climatic conditions however the case studies with high value in the budyko framework satisfied the vulnerability conditions in the transient model through an increase in aridity the analysis results support the idea that the change in climatic conditions is more deterministic than the groundwater level differences on shallow water from a vulnerability perspective the interpretations of the outcomes of dynamic root zone wilting and soil water storage analysis prove that the assessment is successfully links the impact of drainage induced drawdown and physical modeling credit authorship contribution statement cagri gokdemir conceptualization methodology software formal analysis investigation data curation visualization writing original draft yoram rubin supervision writing review editing xiaojun li supervision resources writing review editing hao xu investigation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the research was conducted with support from the natural science foundation of china grant no 41877246 the science and technology plan project of the ministry of transport of china 2013318j02120 the tongji civil engineering peak discipline plan and the fundamental research funds for central universities supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103796 appendix c supplementary materials image application 1 appendix a this appendix contains the summary of assumptions for rwu in this research the assumptions are linked to topsoil model defined in section 3 2 r δ r is normalized water uptake distribution that is given as a1 r δ r r δ r 0 δ r max r δ r d δ r in eq a1 r δ r represents the root specific length as the length of the root per unit volume soil the denominator in the equation represents the normalization of the uptake distribution to ensure the integration of r δ r to unity over the maximum relative rooting depth δ r max the root zone is assumed as fully grown and the uptake in the zone is controlled by r δ r dos santos et al 2017 therefore a2 r δ r b 2 r a v g b ex p b 1 1 δ r ex p b δ r b 0 where ravg is the average root density and b is a shape factor parameter for the root distribution fig a1 b based on the design of root distribution q τ can be linked to the soil water pressure depending on soil water availability feddes et al 2001 as follows a3 q τ root μ h q τ where μ h is a dimensionless stepwise water pressure response function also called the plant limiting function fig a1 a illustrates the variation in the limiting function with h which is a stepwise response function summarized in eq a4 šimunek et al 1992 a4 μ h 0 h h w h h w 1 h h w h w h h h h here the function represents rwu responses based on thresholds of wilting and stomatal closure h pressure values from h up to maximum pressure point h max q τ root z is its maximum rate and diminishes after h to zero on hw appendix b all intra annual simulations results were demonstrated according to case studies in fig b1 
354,several approaches are commonly applied to modeling fractured aquifers including stochastic continuum sc and discrete fracture network dfn models while dfn models provide a more realistic representation of the system their development necessitates an accurate characterization of the fracture network extensive and often prohibitive resources are typically required to map a reliable fracture network which is essential to develop an effective dfn model the present study develops and demonstrates a simple framework for mapping transport pathways in fractured systems utilizing the coherence between solute transport and the lagged interdependence between two time series evaluated through the stochastic event synchrony ses technique the ses based framework was applied to solute breakthrough curves obtained i analytically at different locations along a single synthetic fracture both with and without matrix diffusion and ii numerically at multiple locations within a synthetic impervious fracture network in all cases the framework was capable of accurately mapping the transport pathways represented by direct pathes between the locations considered the framework was also capable of identifying the hydrogeologic characteristics within each connection i e flow velocity or its relationship to the dispersion coefficient this framework is expected to significantly reduce the extensive resources required to identify the transport pathways within complex fractured aquifers additionally the ses based transport pathways identified may be used to enhance the reliability of other fracture network mapping or generation approaches by representing an additional constraint this study is the first in the field of hydrogeology to adopt synchronization analysis and is expected to open the gate for using ses to address related problems keywords synchronization analysis fractured aquifers transport pathways discrete fracture network 1 introduction understanding groundwater flow and contaminant transport in fractured aquifers is of critical importance to resource extraction e g potable water fracking and waste management e g industrial wastewater nuclear waste carbon sequestration singhal and gupta 2010 as they provide source water to support these activities and storage for the wastes they produce shapiro 2002 although open connected fractures in these aquifers represent only a small fraction of the porosity they are the primary conduits for groundwater and contaminants nrc 1996 tsang et al 1998 simulating groundwater flow and contaminant transport in fractured aquifers is challenging due to the heterogeneous nature of fracture characteristics dorn et al 2013 approaches used include stochastic continuum sc and discrete fracture network dfn models e g hadgu et al 2017 illman and hughson 2005 koohbor et al 2019 li et al 2001 ngo et al 2017 selroos et al 2002 tsang et al 1996 in sc models the fractured system is conceptualized as a single continuum or two interacting continua dershowitz and miller 1995 dietrich et al 2005 depending on the fracture density and homogenization scale berkowitz 2002 on the other hand dfn models relies on the use of an explicit representation of the fractures and matrix that form the network cacas et al 1990 each of the sc and the dfn modelling approaches has advantages disadvantages and a degree of complexity however a dfn model typically yields more accurate results than the corresponding sc model due to its explicit representation of the fracture network botros et al 2008 the development of an effective dfn model requires adequate characterization at the single fracture e g location length size orientation and fracture network e g statistical distributions of fracture properties connectivity fracture density scales dorn et al 2013 it is prohibitive to obtain these characteristics for each individual fracture in a network therefore fracture networks generated stochastically or mapped based on field observations are typically adopted in dfn models somogyvári et al 2017 extensive research has been conducted over the past several decades to develop effective field based techniques for the hydraulic and geometric characterization of individual fractures the surrounding rock matrix and the network e g burbey 2010 chandra et al 2019 hsu et al 2019 kang et al 2016 klammler et al 2016 klepikova et al 2018 persaud et al 2018 ren et al 2018 shakas et al 2018 2016 vitale et al 2019 these techniques can be classified into i hydraulic tests e g packer and slug tests ii tracer tests e g solute heat and iii geophysical techniques e g seismic methods ground penetrating radar berkowitz 2002 all of which can be applied within or between boreholes in conjunction with visual inspection of cores and outcrops and areal photographs numerous field based characterization techniques for fractured aquifers have been presented nrc 2015 1996 with the consensus being that these methods measure the response to the presence of fractures i e hydraulic connections or transport pathways rather than mapping the physical fractures berkowitz 2002 since field based approaches only provide information about fractures that intersect boreholes the heterogenous nature of fractured aquifers requires extensive resources to conduct comprehensive and detailed field investigations therefore field data are often limited and are subsequently extrapolated to the whole aquifer through generating stochastically conditioned fracture networks e g dorn et al 2013 klepikova et al 2014 somogyvári et al 2017 another widely applied approach for mapping a representative fracture network is to include observations from multiple hydraulic tests conducted in a tomography fashion e g dong et al 2019 hao et al 2008 illman 2014 illman et al 2009 sharmeen et al 2012 this approach relies on iteratively adjusting the network parameters e g fracture orientation transmissivity and geometry such that the deviation between the model predictions and actual observation is minimal however this iterative approach is computationally expensive particularly when the study area is extensive and a large number of observations need to be matched while hydraulic tomography was originally developed based on the sc approach its application has been extended to fractured systems this extension implies i the existence of a representative elementary volume rev for the probability of fracture connectivity dong et al 2019 and ii the assumption that hydraulic connectivity between the fractures and matrix is continuous although they are in fact hydraulically disconnected dong et al 2019 while a representative fracture network can be identified through considering observations from multiple field based investigations it is postulated herein that a small subset of these investigations can be utilized to map fracture networks directly by evaluating the interdependence between temporally varying data i e time series acquired from several locations within the aquifer however classic correlation measures e g kendall s tau coefficient spearman s rank correlation coefficient cannot be used to evaluate the interdependence in fracture networks as they cannot adequately address the lag between temporally varying variables a more appropriate method for evaluating the interdependence is by measuring the degree of synchronization based on the fact that the perturbation of an ambient condition e g pressure solute concentration temperature at a specific location will cause an effect at a downstream location s after some time lag if the two locations are hydraulically connected either directly i e through a fracture or indirectly i e both locations are part of the same fracture network the resulting fracture map then represents the possible transport pathways rather than the physical fractures between the locations from which the observations were collected different synchronization measures have been discussed in detail in earlier studies e g hsu 1992 quiroga et al 2002 schreiber et al 2003 including nonlinear interdependences phase synchronization mutual information cross correlation and coherence function some of these measures are only suitable for linearly related time series while others do not use the series values or do not distinguish between the different values within each series cross correlation analysis is widely employed in the characterization of fractured aquifers e g hao et al 2008 kim et al 2000 lee et al 2017 lee and lee 2000 zha et al 2014 this approach evaluates the cross correlation coefficient at multiple lags from field observations collected over space and time the optimum lag then corresponds to the highest correlation coefficient two sets of observations are considered interrelated when the highest correlation coefficient exceeds a specified threshold it should be emphasized that this approach evaluates the linear relationship between two sets of observations time series but does not assess the causality therefore within the context of fractured network mapping similar responses may be identified at two locations that are not hydraulically connected further cross correlation analysis is a deterministic approach and thus acceptance limits for the cross correlation coefficient have not been defined dauwels et al 2009 presented the stochastic event synchrony ses as an alternative approach for assessing the synchronization i e interdependence between two time series in the ses approach specific values events are chosen from each series and their occurrence times are aligned iteratively the reliability of the ses based synchrony is determined by the fraction of paired aligned events at a specific time lag and its precision is measured by the accuracy of alignment of these events at that time lag while the ses approach was originally developed to assess the quasi simultaneous appearance of events based on time lag only additional constraints should be introduced for the objective of the current study as the appearance of a solute does not guarantee that it migrated between two observation points the solute mass together with the transport mechanisms between the observation points must also be considered within the ses to allow robust conclusions based on its metrics therefore paired events must be mathematically related when the ses is applied for fractured aquifer characterization meaning that the mass migrated between the specified locations event synchronization analysis has been widely utilized within the field of water resources particularly in hydroclimatology applications e g boers et al 2019 2014 2013 konapala and mishra 2017 lima et al 2017 malik et al 2012 2010 ozturk et al 2019 however to the best of the authors knowledge the present study is the first to apply event synchronization analysis in the field of hydrogeology the objective of the present study is to develop a ses based framework for identifying transport pathways within fractured aquifers based on solute concentration data obtained over time and space through i confirming the ability of ses to identify transport pathways in a single fracture based on solute transport ii exploring the relationship between ses metrics i e reliability and precision and the transport parameters within a single fracture and iii demonstrating the application of the ses based framework to multiple locations within a fracture network to determine the transport pathways between these locations and thereby develop a fracture network map this technique is expected to significantly reduce the extensive resources typically required to identify transport pathways within fractured aquifers ses based connections can also be added as a constraint when using other techniques to develop representative fracture networks e g stochastic generation hydraulic tomography cross correlation analysis 2 methods 2 1 solute transport in fractures in fractured aquifers groundwater flow and solute transport occur in both fractures and the surrounding rock matrix bear et al 1993 rausch et al 2005 while advection and dispersion are primarily responsible for solute transport within the fracture molecular diffusion is the dominant transport mechanism in the matrix bear et al 1993 rausch et al 2005 other mechanisms influencing solute transport in fractured systems include sorption and decay bear et al 1993 while a fractured system typically consists of a set of connected fractures surrounded by a pervious or impervious matrix understanding solute behavior at the system scale is based on that in single fractures abdel salam and chrysikopoulos 1995 therefore the ses based framework developed in the present study is based on solute behavior in a single fracture modeling solute transport in a single fracture requires coupling its behavior in the open fracture with that in the rock matrix the resulting coupled governing equations can be solved analytically liu et al 2017 maloszewski and zuber 1990 meng et al 2018 sudicky and frind 1982 tang et al 1981 or numerically abdel salam and chrysikopoulos 1995 brutz and rajaram 2017 he et al 2017 james and chrysikopoulos 1999 natarajan 2014 suzuki et al 2018 in different configurations of a single fracture under specified boundary condition at the inlet i e constant concentration constant flux instantaneous or time dependent function when the solute is released into the fracture following a time dependent function the breakthrough curve btc at any location along the fracture is the convolution of that function and the analytical solution under an instantaneous injection bodin et al 2007 analytical solutions developed to date have not been confirmed at the network scale and thus numerical techniques are typically adopted bodin et al 2007 makedonska et al 2015 ngo et al 2017 only the instantaneous or time dependent injection schemes are of interest in the present study as these conditions represent the typical procedures of field based tracer tests when a conservative solute is introduced to a fracture with an impervious matrix i e no matrix diffusion the injected mass is preserved along the fracture however hydrodynamic dispersion causes the residence time of each solute particle between any two locations in the fracture to be a random variable whose probability density function can be approximated by a lognormal one delay and bodin 2001 the theoretical mean residence time t is the average time lag between the appearance of the entire mass at the two locations and depends on the distance between these locations d and the average flow velocity u as follows 1 t d u however matrix diffusion cannot be neglected when the matrix is permeable solute may diffuse into or out of the matrix depending on the direction of the concentration gradient across the fracture wall when matrix diffusion is considered the btc at any location along the fracture can be expressed as the convolution of two functions i the btc resulting from an instantaneous injection of a conservative solute when matrix diffusion is negligible and ii a retention function representing the fracture matrix system response to the solute input function when hydrodynamic dispersion along the fracture is neglected cvetkovic et al 1999 hassan et al 2001 liu et al 2017 the migration of solute particles between two points in a fracture is typically governed by advection and dispersion only even when matrix diffusion is not negligible however calculating t according to eq 1 is not valid in this case as it does not account for fracture matrix interactions the retention function representing the matrix response to the input source acts as a decay function and results in a long tailed btc therefore matrix diffusion can be represented by a retardation factor r that delays solute migration in the fracture and t is subsequently estimated as follows delay and bodin 2001 2 t t o r t o 2 ω 2 t o 2 e r f c ω t o b 2 ω t o b π e x p ω 2 t o 2 b where to d u ω θ d e b θ is the matrix porosity de is the solute diffusion coefficient as defined in tang et al 1981 b is the fracture aperture b 2 d d u 3 and dis the hydrodynamic dispersion coefficient the same concept i e adopting a retardation factor is utilized when the solute interacts with impervious fracture wall however the mass retained is adsorbed onto the surface of the fracture rather than within the matrix another retardation factor is introduced in this case based on the relationship between the sorbed and mobile fractions of the solute a more complex transport scenario includes a reactive solute moving along a fracture with permeable surfaces which combines advection hydrodynamic dispersion sorption and matrix diffusion in all cases t is the theoretical time lag between the centers of mass cm of two btcs at two distinct locations along the fracture as shown in fig 1 considering all possible transport mechanisms such btcs can be obtained from a field based tracer test and the interdependence between them can be used to reveal the transport pathway between the two locations however such transport pathway will always be represented by a straight path connecting the two locations it is noteworthy that a single fracture typically has variable aperture however the present study idealized fracture surfaces as two parallel plates to facilitate the development of the ses based framework therefore b u and d are assumed to be constant along the fracture 2 2 stochastic event synchrony synchronization is defined as the agreement or correlation in time between different processes boccaletti et al 2002 and it indicates the interdependence between systems coupled through such processes boccaletti et al 2018 different synchronization measures have been developed over the past two centuries each of which has its own strengths and limitations stochastic event synchrony ses was first introduced by dauwels et al 2009 to overcome the limitations of other measures and it can be used to uncover the interdependence between two or more linearly or nonlinearly coupled time series the first step in the application of ses is to identify specific events from each time series e g maximum values minimum values or values larger than a specific threshold and subsequently attempt to align or pair these events event selection is challenging and must reflect the application and objective of the study as there is no consistent way for event selection events are most often hand picked based on the judgement of an expert for example maximum values may be selected to investigate the propagation of storms and floods while minimum values may be selected for drought analysis when the ses approach is applied events are first selected from the first time series the second time series is then scanned such that a pair is assigned to each individual event in the first series ensuring that paired events are mathematically related i e time lag and solute mass as discussed below when multiple events from the first series are paired with a single event from the second series respective events from the first series are replaced by the earliest one fig 2 illustrates this even pairing process it should be mentioned that the application of the ses approach is considered of the order o ε η where ε is the number of events selected from the first time series and η is the number of locations employed this indicates the computational efficiency of the ses approach compared to other fracture mapping techniques e g hydraulic tomography particularly when large number of observations and locations are employed the fraction of events in the first series that find pairs in the second known as the coincidence ratio ρ indicates the reliability of pairing synchronization between the two series higher values of ρ indicate that more events from the first series are replicated in the second one after a period of time as all paired events may not be aligned exactly at the same time lag an average time jitter τ is defined to represent the average deviation from the mean lag therefore the lag between two series is a random variable with a specific mean average of all lags and an average time jitter it is noteworthy that two time series are highly synchronized when they can be characterized by higher ρ and lower τ at a specific mean lag it is also noteworthy that the ses approach can alternatively be applied through iteratively assuming a hypothetical pre defined time lag with the aim of maximizing ρ and minimizing τ an initial guess for the pre defined time lag can be obtained based on the transmissivity of the system this guess is subsequently rectified through an iterative process and an optimal solution is obtained machine learning and evolutionary algorithms can therein be used to identify the optimum set of paired events and also prevent the solution from being trapped in local minima or maxima the events shown in fig 2 can represent any processes such as signals transmitted through the human neural system or concentrations of a solute observed at two locations within a fractured network the latter example is the focus of the present study it must be noted that concentration based events may find pairs where transport pathways do not exist thus more confidence can be placed in the legitimacy of mass based event pairs as mass represents the cumulation of concentration over time it should be emphasized that an event pair within the originally developed ses approach are defined as two events aligned at a specific lag even if their values are not interrelated however paired events in the present study were identified such that they are mathematically related at the corresponding lag therefore ses metrics can reveal solute transport between two locations 2 3 the ses based framework a single and unique transport pathway i e a fracture between two locations in a fractured aquifer represents a transmission path for a solute however the distance x travelled by each solute particle in that fracture within a time dt is not deterministic due the range of mechanisms influencing its transport e g hydrodynamic dispersion matrix diffusion therefore dt between two specific locations i e x is constant is a random variable described as bodin et al 2007 3 d t d t c o n ω x u e r f c 1 u 01 2 where dtcon is a lognormal random number with a mean of x ru and a variance of 2dx u3 and u 01 is a uniform random number between 0 and 1 the first term on the right hand side of eq 3 dtcon represents the travel time imposed by advection dispersion and matrix diffusion and the second term represents the solute particle residence time within the rock matrix the mean value of dt is t calculated using eq 1 when matrix diffusion is neglected or eq 2 when matrix diffusion is considered the btc at any location along the fracture is the relationship between the concentration of solute particles arriving at that location and time the cm of a btc corresponds to the mean travel time i e t of all solute particles and the btc spreading can be described by higher moments of dt synchronization between two btcs i e btc 1 and btc 2 acquired from two locations i e location 1 and location 2 along a fracture requires a number of events i e observations on btc 1 to find pairs from btc 2 therefore nt and lt points are defined on btcs 1 and 2 respectively each point on btc 1 expresses solute concentration at location 1 at time tj as shown in fig 3 where j is the point index j 1 2 nt similar terminology is used at location 2 except that the index j is replaced by an index k k 1 2 lt as shown in fig 3 assuming that the volumetric flow rate q is known mass arrival at locations 1 and 2 can be estimated at tj and tk respectively an event i e point at tj of btc 1 is paired with that at tk of btc 2 when mass arrival at these times are mathematically related under the transport mechanisms considered mass arrival at any location is defined as the time integral of the btc i e the area under the btc until a specified time multiplied by q as solute mass is in fact a group of particles mass arrived at a location m at time ti can be defined through two quantities i the arrival time i e ti and ii the average arrival time of the corresponding solute particles t i which represents the cm of the btc up to time ti therefore a mathematical notation of mm ti t i is used to represent this arrived mass to assess the synchronization between the btcs 1 and 2 the pairing of m2 tk t k at location 2 with m1 tj t j at location 1 is tested where t j is the mean travel time of all solute particles arriving at location 1 up to time tj i e the arrival time of cmj and t k is the mean travel time of all solute particles arriving at location 2 up to time tk i e the arrival time of cmk as shown in fig 3 after its arrival at location 1 the mass m1 tj t j migrates along the fracture and is theoretically expected to reach location 2 after t as m 2 tj t t j t when matrix diffusion is negligible masses m 2 tj t t j t and m1 tj t j must be the same whereas when matrix diffusion is considered the two masses must be mathematically related through available analytical solutions e g maloszewski and zuber 1990 tang et al 1981 the use of such analytical solutions provides an additional constraint to ensure that event pairing is based on both time and value rather than time only as the quasi simultaneous appearance of a solute does not guarantee that it migrated between two observation points the jth event from btc 1 is paired with the kth event from btc 2 if m2 tk t k and m 2 tj t t j t are nearly the same subsequently the kth point on btc 2 is referred to as the nth point and the time lag between the two events is tjn while the time lag between the two btcs is theoretically t the actual lag between two paired events i e tjn is t j t n which may be different from t leading to a time jitter τ jn equals to t jn t this time jitter can be positive or negative depending of the value of the corresponding tjn when compared to t it is noteworthy that the actual lag i e tjn is calculated based the mean arrival times i e t j and t n not the absolute arrival times i e tj and tn as the events employed represent the mass rather than concentration in addition estimating τ jn based on t rather than the actual mean lag was chosen in the present study to facilitate relating the ses metrics i e actual mean lag and average jitter to the hydrogeological properties in the fracture as discussed in greater detail below during a field based tracer experiment tj and tk represent the sampling times at locations 1 and 2 respectively it is noteworthy that since q is often unknown prior to proper characterization of a fractured aquifer time integration of the btc can be used as an indicator of mm ti t i where the cm of any portion of the btc is at t i the application of ses utilizing two btcs results in a set of paired events n each of which is lagged by a time tjn that differs from t by a jitter τ jn the actual mean lag t a c t and average jitter τ between the two btcs are thus respectively 4a t a c t 1 n j 1 n t j t n 4b τ 1 n j 1 n t jn t the degree of synchronization between the two btcs at τ and t a c t expressed by ρ is the ratio between n and nt for a transport pathway to exist between the locations where the btcs are acquired ρ must be equal to or exceed a threshold value ρacc calculated by 5 ρ acc p t act min τ jn dt t act max τ jn where p represents the probability that the travel time between locations 1 and 2 is within the time interval t a c t min τ j n and t a c t max τ j n in other words p represents the fraction of solute particles expressed through the number of events from btc 1 i e n expected to migrate from location 1 to location 2 within that time interval under the transport mechanisms considered calculating the time range shown in eq 5 is a subsequent step of event pairing and thus analytical solutions used to assess mass migration are implicitly included in the determination of this time range it is noteworthy that a stochastic rather than a deterministic model is required to evaluate the value of p based on an appropriate distribution of dt the stochastic model developed by delay and bodin 2001 to describe solute travel time in fractures is thus employed for a conservative solute not subject to matrix diffusion dt is lognormal with a mean of x u and a variance of 2dx u3 delay and bodin 2001 and subsequently ρacc can be evaluated analytically however the statistical distribution of dt is not well known when matrix diffusion is considered in this case for simplicity the residence time in the rock matrix tm is assumed to be the same for all solute particles and is given by 6 t m t o 2 ω 2 t o 2 erfc ω t o b 2 ω t o b π exp ω 2 t o 2 b subtracting tm from each term on the right hand side of eq 5 yields a modified expression to estimate dt dtcon which is lognormally distributed with a mean of x ru and a variance of 2dx u3 and therefore ρacc can be evaluated analytically when a transport pathway is detected i e ρ ρacc between two locations the subtraction of τ from t a c t yields the theoretical time lag between the two btcs i e t and thus enables i the use of eq 1 to estimate the average flow velocity i e u when matrix diffusion is negligible or ii the development of a relationship between u and d based on eq 2 when matrix diffusion is considered and when the matrix properties i e de and θ and fracture aperture i e b are known based on the discussion above a ses based framework is proposed to assess the presence of a transport pathway between two locations along a single fracture as shown in fig 4 it is noteworthy that the ses based framework is proposed based on the assumption that btcs are fully developed at the observation locations which is not the typical situation however the framework can still be applied to incomplete btcs through i the use of t a c t instead of t in eq 4b to estimate τ and subsequently ii estimate the hydrogeological properties in the fracture using eq 1 and 2 based on t a c t rather than t a c t τ while the application of ses may appear similar to assessing the cross correlation between two time series at multiple lags it is emphasized that the cross correlation between two time series at multiple lags evaluates the linear relationship between two sets of observations time series but does not assess the causality it is the constraints applied for selecting paired events within the ses approach that provide insights about the presence of a transport pathway between two locations in addition the use of ses rather than other synchronization measures e g lagged correlation coefficient coherence function phase synchronization mutual information is preferred as the synchronization reliability expressed through ρ can be evaluated based on the physical processes underlying solute transport it should be mentioned that the ses based framework employs temporal concentration datasets i e btcs that can be obtained from field tracer experiments or long term monitoring programs the latter is often the situation at contaminated sites e g superfund sites or when potential sources of contamination e g landfills construction exist and the aquifer is being monitored for early detection 3 results and discussion three different cases were chosen to demonstrate the efficacy of the ses based framework in identifying transport pathways 1 a single synthetic fracture with an instantaneous solute injection at the inlet under both pervious and impervious matrix conditions 2 a single synthetic fracture with an impervious matrix and an exponentially decaying solute release at the inlet and 3 a synthetic fracture network with an impermeable matrix and exponentially decaying solute releases at two distinct points along the inlet boundary the ses based framework was first applied to a single synthetic fracture with specified hydrogeologic characteristics to assess its efficacy in identifying interdependence between btcs acquired from two locations along that fracture thus demonstrating the existence of a transport pathway between these locations the hydrogeologic characteristics of the synthetic fracture is delay and bodin 2001 length l 2 m b 200 μm u 5 10 6 m s d 5 10 7 m2 s when the matrix is assumed to be permeable θ 0 35 and d e 10 13 m2 s tang et al 1981 were used a mass of 100g of a conservative solute was released at the fracture inlet through an instantaneous injection and btcs were calculated at 0 2l 0 4l 0 6l 0 8l and l using the analytical solutions reported in kreft and zuber 1978 and maloszewski and zuber 1990 for impermeable and permeable matrix conditions respectively these btcs are shown in fig 5 each btc was divided into 500 points i e nt lt 500 and the ses based framework was employed the btc at the fracture inlet was neglected as it represents a single event since the btc at each location precedes those at downstream locations it was only necessary to apply the ses based framework in this sequence i e btcs at upstream and downstream locations are represented by btc1 and btc2 respectively when the direction of flow is unknown different sequences can be applied to determine the flow direction fig 6 shows the synchronization metrics i e ρ t a c t and τ along with the corresponding ρacc for each pair of btcs for cases a considering matrix diffusion and b neglecting matrix diffusion to assess the efficacy of the ses based framework in identifying the transport pathway between the locations of each btc pair fig 6is shown as a colormap representing the synchronization metrics and corresponding ρacc each panel in fig 6 can be viewed as a two dimensional array with entries representing the synchronization metrics between each btc pair the entries above the antidiagonal on each panel represent ρacc fig 6a and b or τ fig 6c and d whereas those below the antidiagonal represent ρ fig 6a and b or t a c t fig 6c and d the antidiagonal entries on each panel are not considered as they represent the synchronization metrics between a btc at a specific location and itself a transport pathway exists between the locations of each btc pair in cases a and b since all ρ values are larger than ρacc figs 6a and b the comparison of corresponding ρ and ρacc values for each btc pair demonstrates the efficacy of the ses based framework in determining the presence of a transport pathway between any two locations within the fracture considered the values of ρ were 80 or larger and 50 or larger for the cases with and without matrix diffusion respectively this is attributed to the fact that more uncertainty is associated with the solute residence time when matrix diffusion is considered however the fact remains that even when matrix diffusion is present a significant difference between ρ and ρacc still exists and therefore matrix diffusion did not impact the ability of the ses based framework to identify the transport pathways in terms of the precision metrics the difference between t a c t and τ for each btc pair was consistently t therefore t a c t τ can be used to estimate u for case a i e no matrix diffusion and obtain the relationship between u and d for case b i e with matrix diffusion it should also be mentioned that the sensitivity of the ses metrics i e ρ t a c t and τ to the number of observations reflecting the number of divisions of each btc was analysed through changing the number of points on the btcs from 20 to 500 the changes in the ses metrics were less than 5 indicating that they are not sensitive to the number of observations within the range tested a second case is employed to assess the efficacy of the ses based framework under different boundary conditions in this case 100g of a conservative solute was introduced at the inlet of a single fracture with impervious walls through an exponentially decaying release exp γt where γ 1 10 5 s 1 is the decay rate bodin et al 2003 peclet numbers pe ranging from 0 2 to 100 were adopted and the corresponding effluent btc was estimated using the time domain random walk tdrw approach delay and bodin 2001 this range of pe values was obtained through changing the fracture length i e l between 2 cm and 10 m and was calculated using the same u and d values employed in the previous case btcs at the inlet and outlet represented by btc 1 and 2 respectively were divided into 500 points i e nt lt 500 for each pe the ses based framework was subsequently applied and the corresponding ratios ρ ρacc and t a c t τ t are shown in fig 7 the ses based framework effectively detected the transport pathway between the fracture inlet and outlet for the range of pe investigated as indicated by the fact that ρ ρacc is consistently greater than 1 furthermore t a c t τ t is always equal to 1 0 supporting the use of ses metrics t a c t and τ to determine the transport parameters uin this case the results from both cases support the efficacy of the ses based framework in revealing the existence of a transport pathway between two locations along a fracture for different matrix conditions and under different inlet boundary conditions of even greater interest is the ability of the ses based framework to detect multiple connections within a fracture network therefore a third case using a simple impermeable synthetic fracture network within a 10 000 m2 square domain is developed as shown in fig 8 the fractures are assumed to have equal apertures of 100 µm and constant heads of 100 m and 90 m are assigned to the inlet left and outlet right boundaries respectively a conservative solute was injected through the inlet boundary following the release scheme described in the previous case case 2 with a γ value of 10 8 s 1 the tdrw approach was adopted to simulate the transport of 100 000 solute particles representing the mass injected through the synthetic network and the btcs together with the arrival time of their cms were obtained at all intersections as shown in fig 9 and fig 10 respectively the hydraulic connections were identified through solving the flow problem for the whole network fig 8a and are shown in fig 8b transport pathways corresponding to these hydraulic connections should be reproducible through applying the ses based framework before applying the ses based framework fracture intersections were classified into inlet outlet and interior nodes inlet and outlet nodes are those on the left and right boundaries respectively interior and outlet nodes were sorted according to the arrival time of their corresponding cms and were subsequently divided into node groups such that the total mass within each node group is approximately equal to the total mass injected this procedure is similar to that employed for determining the stages when dynamic programming is used for solving a resources allocation problem the node groups formulated together with their assigned points are shown in fig 11 it is noteworthy that in a field based tracer test inlet nodes correspond to injection locations while outlet and interior nodes cannot be distinguished however outlet nodes can be identified as those having the largest cm arrival times the btcs at all nodes were divided into 500 segments i e the number of points events is 501 and the ses based framework was subsequently employed the framework was applied to each two subsequent node groups where the node group of the lower index is referred to as the upstream group and that of a higher index is referred to as the downstream group in general four different circumstances can be encountered when the ses based framework is applied in a dfn setting a each of the upstream and downstream node groups contain a single node e g when the framework is applied to groups 2 and 3 shown in fig 11 b the upstream node group contains one node while the downstream node group contains multiple nodes e g when the framework is applied to groups 4 and 5 shown in fig 11 c the upstream node group contains multiple nodes while the downstream node group contains one node does not exist in this example and d both the upstream and downstream node groups contain multiple nodes e g when the framework is applied to groups 5 and 6 shown in fig 11 in circumstance a the application of the ses based framework is similar to that utilized in verification cases 1 and 2 i e assessing the synchronization between only two btcs in circumstance b the btc within the upstream node group a single btc is scaled using the total mass ratio of each btc within the downstream node group in other words the btc of the upstream node group is partitioned among the downstream nodes based on the mass arrival at each node similarly in circumstance c the btc within the downstream node group is scaled using the total mass ratio of each btc within the upstream node group in circumstance d each btc within both the upstream and downstream node group is normalized using its own maximum value so that the effect of mass sharing between multiple connections is reduced it is noteworthy that more uncertainty is associated with circumstance d as the normalization process may result in event pairs that are actually independent while these represent four different circumstances they can be in fact classified into i two single nodes from subsequent node groups are connected and ii two subsequent node groups are connected it is noteworthy that using either the btcs or the accumulated btcs in verification case 3 results in the same ses metrics based on the above discussion the resulting synchronization metrics ρ ρi ρii and the corresponding ρ a c c ρ acc i ρ acc ii where the superscripts i and ii refer to the circumstance classification discussed above were estimated between the nodes within each two subsequent node groups a direct transport pathway is assumed to exist between two nodes one from the upstream node group and the other from the downstream node group when ρi ρ a c c i and ρii ρ a c c i i whereas all nodes in the upstream node group are assumed to be directly hydraulically connected to all those in the downstream node group when ρ i i ρ a c c i i and ρ i ρ a c c i a zero value of ρ a c c i or ρ a c c i i indicates that there is no probability for the solute particles to migrate between the two nodes in either or both circumstance classifications i and ii within the time interval t act min τ jn and t act max τ jn therefore the corresponding transport pathway s can be rejected the ses based framework effectively detected 26 out of 32 of the direct transport pathways existing in the synthetic fracture network see fig 12 a additional 15 transport pathways were also detected between different nodes within the network due to the similarities between the btcs at these nodes see fig 12b a mass balance condition can therefore be applied at each intersection to assess the existence of the identified connections the results from verification case 3 demonstrate the efficacy of the ses based framework in reconstructing the transport pathways within an impermeable fracture network additionally the results from this verification case highlight the efficiency of the ses based framework in identifying the transport pathway between two locations under a periodic injection scheme where multimodal btcs similar to those in fig 9 are typically observed it is noteworthy that the present study employed equal number of events at all locations i e the btcs were divided into the same number of segments in each verification case for demonstration however this is not mandatory for the application of the ses based framework it is also noteworthy that a simplified system i e fractures with constant apertures impermeable matrix was employed in this verification case to demonstrate the applicability of the ses based framework at the network scale and further tests are required to assess its robustness in more complex settings in real fractured systems variable apertures and apertures of different sizes yield complex mass transfer at intersections which will significantly affect the system behavior and lead to more uncertainty in the connections identified using the ses based framework additionally these simulations were conducted in a two dimensional 2d space however the effects of matrix diffusion are more prominent in 3d which could result in undetected solute concentrations this also could lead to more uncertainty in the results of the ses based framework the application of the ses based framework can in turn result in multiple networks rather than a unique solution as highly synchronized btcs may result in detecting transport pathways where actual fractures do not exist it is thus highlighted that careful attention must be paid to the application and interpretation of the ses framework at the fracture network scale e g event pairing neglected mechanisms multiple observation types particularly as the network becomes more complex with more uncertainty however it should be mentioned that an optimization technique can be coupled with the ses based framework to reduce the effects of the different sources of uncertainty and identify the most reliable transport pathways this would in turn enhance the reliability of this approach the ses based framework can also be used to identify transport pathways within three dimensional fracture networks when available observations are acquired from different locations at multiple depths in this situation the application of the framework would be similar to verification case 3 taking into account the different sources of uncertainty as discussed above 4 conclusions the coherence between solute transport in a fracture and time series synchronization enabled the development of a ses based framework that is able to detect transport pathways between two points in a fractured aquifer the efficacy of the ses based framework was demonstrated through its ability to map the transport pathway s based on the solute btcs at two distinct locations within i a single synthetic fracture with an impermeable matrix under instantaneous and exponentially decaying solute releases at the inlet ii a single synthetic fracture with permeable matrix under an instantaneous solute injection and iii a fracture network with an impermeable matrix under exponentially decaying solute releases at two points along the inlet boundary additionally the ses based framework is able to determine u or the relationship between u and d for impermeable and permeable matrix conditions respectively this ses based framework was able to map transport pathways using sparsely located btcs rather than hydraulic geometrical and connectivity data all of which require far more intensive resources to collect in the field the transport pathways mapped using the ses based framework can be utilized to condition fracture networks developed through other approaches e g stochastic generation hydraulic tomography cross correlation analysis therefore enable the development of reliable dfn models this is in fact crucial for the effective planning management and remediation in fractured aquifers this study is the first to introduce the synchronization analysis in the field of hydrogeology and is expected to be the basis for applying the same analysis to solve complex relevant problems in similar systems credit authorship contribution statement ahmed yosri conceptualization methodology software formal analysis writing original draft sarah dickson anderson conceptualization writing review editing supervision funding acquisition ahmad siam writing review editing wael el dakhakhni writing review editing supervision funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgment this research was supported by nserc through the canadian nuclear energy infrastructure resilience under systemic risk canrisk collaborative research and training experience create grant number create 482707 2016 and discovery grant programs grant number rgpin 250121 2013 
354,several approaches are commonly applied to modeling fractured aquifers including stochastic continuum sc and discrete fracture network dfn models while dfn models provide a more realistic representation of the system their development necessitates an accurate characterization of the fracture network extensive and often prohibitive resources are typically required to map a reliable fracture network which is essential to develop an effective dfn model the present study develops and demonstrates a simple framework for mapping transport pathways in fractured systems utilizing the coherence between solute transport and the lagged interdependence between two time series evaluated through the stochastic event synchrony ses technique the ses based framework was applied to solute breakthrough curves obtained i analytically at different locations along a single synthetic fracture both with and without matrix diffusion and ii numerically at multiple locations within a synthetic impervious fracture network in all cases the framework was capable of accurately mapping the transport pathways represented by direct pathes between the locations considered the framework was also capable of identifying the hydrogeologic characteristics within each connection i e flow velocity or its relationship to the dispersion coefficient this framework is expected to significantly reduce the extensive resources required to identify the transport pathways within complex fractured aquifers additionally the ses based transport pathways identified may be used to enhance the reliability of other fracture network mapping or generation approaches by representing an additional constraint this study is the first in the field of hydrogeology to adopt synchronization analysis and is expected to open the gate for using ses to address related problems keywords synchronization analysis fractured aquifers transport pathways discrete fracture network 1 introduction understanding groundwater flow and contaminant transport in fractured aquifers is of critical importance to resource extraction e g potable water fracking and waste management e g industrial wastewater nuclear waste carbon sequestration singhal and gupta 2010 as they provide source water to support these activities and storage for the wastes they produce shapiro 2002 although open connected fractures in these aquifers represent only a small fraction of the porosity they are the primary conduits for groundwater and contaminants nrc 1996 tsang et al 1998 simulating groundwater flow and contaminant transport in fractured aquifers is challenging due to the heterogeneous nature of fracture characteristics dorn et al 2013 approaches used include stochastic continuum sc and discrete fracture network dfn models e g hadgu et al 2017 illman and hughson 2005 koohbor et al 2019 li et al 2001 ngo et al 2017 selroos et al 2002 tsang et al 1996 in sc models the fractured system is conceptualized as a single continuum or two interacting continua dershowitz and miller 1995 dietrich et al 2005 depending on the fracture density and homogenization scale berkowitz 2002 on the other hand dfn models relies on the use of an explicit representation of the fractures and matrix that form the network cacas et al 1990 each of the sc and the dfn modelling approaches has advantages disadvantages and a degree of complexity however a dfn model typically yields more accurate results than the corresponding sc model due to its explicit representation of the fracture network botros et al 2008 the development of an effective dfn model requires adequate characterization at the single fracture e g location length size orientation and fracture network e g statistical distributions of fracture properties connectivity fracture density scales dorn et al 2013 it is prohibitive to obtain these characteristics for each individual fracture in a network therefore fracture networks generated stochastically or mapped based on field observations are typically adopted in dfn models somogyvári et al 2017 extensive research has been conducted over the past several decades to develop effective field based techniques for the hydraulic and geometric characterization of individual fractures the surrounding rock matrix and the network e g burbey 2010 chandra et al 2019 hsu et al 2019 kang et al 2016 klammler et al 2016 klepikova et al 2018 persaud et al 2018 ren et al 2018 shakas et al 2018 2016 vitale et al 2019 these techniques can be classified into i hydraulic tests e g packer and slug tests ii tracer tests e g solute heat and iii geophysical techniques e g seismic methods ground penetrating radar berkowitz 2002 all of which can be applied within or between boreholes in conjunction with visual inspection of cores and outcrops and areal photographs numerous field based characterization techniques for fractured aquifers have been presented nrc 2015 1996 with the consensus being that these methods measure the response to the presence of fractures i e hydraulic connections or transport pathways rather than mapping the physical fractures berkowitz 2002 since field based approaches only provide information about fractures that intersect boreholes the heterogenous nature of fractured aquifers requires extensive resources to conduct comprehensive and detailed field investigations therefore field data are often limited and are subsequently extrapolated to the whole aquifer through generating stochastically conditioned fracture networks e g dorn et al 2013 klepikova et al 2014 somogyvári et al 2017 another widely applied approach for mapping a representative fracture network is to include observations from multiple hydraulic tests conducted in a tomography fashion e g dong et al 2019 hao et al 2008 illman 2014 illman et al 2009 sharmeen et al 2012 this approach relies on iteratively adjusting the network parameters e g fracture orientation transmissivity and geometry such that the deviation between the model predictions and actual observation is minimal however this iterative approach is computationally expensive particularly when the study area is extensive and a large number of observations need to be matched while hydraulic tomography was originally developed based on the sc approach its application has been extended to fractured systems this extension implies i the existence of a representative elementary volume rev for the probability of fracture connectivity dong et al 2019 and ii the assumption that hydraulic connectivity between the fractures and matrix is continuous although they are in fact hydraulically disconnected dong et al 2019 while a representative fracture network can be identified through considering observations from multiple field based investigations it is postulated herein that a small subset of these investigations can be utilized to map fracture networks directly by evaluating the interdependence between temporally varying data i e time series acquired from several locations within the aquifer however classic correlation measures e g kendall s tau coefficient spearman s rank correlation coefficient cannot be used to evaluate the interdependence in fracture networks as they cannot adequately address the lag between temporally varying variables a more appropriate method for evaluating the interdependence is by measuring the degree of synchronization based on the fact that the perturbation of an ambient condition e g pressure solute concentration temperature at a specific location will cause an effect at a downstream location s after some time lag if the two locations are hydraulically connected either directly i e through a fracture or indirectly i e both locations are part of the same fracture network the resulting fracture map then represents the possible transport pathways rather than the physical fractures between the locations from which the observations were collected different synchronization measures have been discussed in detail in earlier studies e g hsu 1992 quiroga et al 2002 schreiber et al 2003 including nonlinear interdependences phase synchronization mutual information cross correlation and coherence function some of these measures are only suitable for linearly related time series while others do not use the series values or do not distinguish between the different values within each series cross correlation analysis is widely employed in the characterization of fractured aquifers e g hao et al 2008 kim et al 2000 lee et al 2017 lee and lee 2000 zha et al 2014 this approach evaluates the cross correlation coefficient at multiple lags from field observations collected over space and time the optimum lag then corresponds to the highest correlation coefficient two sets of observations are considered interrelated when the highest correlation coefficient exceeds a specified threshold it should be emphasized that this approach evaluates the linear relationship between two sets of observations time series but does not assess the causality therefore within the context of fractured network mapping similar responses may be identified at two locations that are not hydraulically connected further cross correlation analysis is a deterministic approach and thus acceptance limits for the cross correlation coefficient have not been defined dauwels et al 2009 presented the stochastic event synchrony ses as an alternative approach for assessing the synchronization i e interdependence between two time series in the ses approach specific values events are chosen from each series and their occurrence times are aligned iteratively the reliability of the ses based synchrony is determined by the fraction of paired aligned events at a specific time lag and its precision is measured by the accuracy of alignment of these events at that time lag while the ses approach was originally developed to assess the quasi simultaneous appearance of events based on time lag only additional constraints should be introduced for the objective of the current study as the appearance of a solute does not guarantee that it migrated between two observation points the solute mass together with the transport mechanisms between the observation points must also be considered within the ses to allow robust conclusions based on its metrics therefore paired events must be mathematically related when the ses is applied for fractured aquifer characterization meaning that the mass migrated between the specified locations event synchronization analysis has been widely utilized within the field of water resources particularly in hydroclimatology applications e g boers et al 2019 2014 2013 konapala and mishra 2017 lima et al 2017 malik et al 2012 2010 ozturk et al 2019 however to the best of the authors knowledge the present study is the first to apply event synchronization analysis in the field of hydrogeology the objective of the present study is to develop a ses based framework for identifying transport pathways within fractured aquifers based on solute concentration data obtained over time and space through i confirming the ability of ses to identify transport pathways in a single fracture based on solute transport ii exploring the relationship between ses metrics i e reliability and precision and the transport parameters within a single fracture and iii demonstrating the application of the ses based framework to multiple locations within a fracture network to determine the transport pathways between these locations and thereby develop a fracture network map this technique is expected to significantly reduce the extensive resources typically required to identify transport pathways within fractured aquifers ses based connections can also be added as a constraint when using other techniques to develop representative fracture networks e g stochastic generation hydraulic tomography cross correlation analysis 2 methods 2 1 solute transport in fractures in fractured aquifers groundwater flow and solute transport occur in both fractures and the surrounding rock matrix bear et al 1993 rausch et al 2005 while advection and dispersion are primarily responsible for solute transport within the fracture molecular diffusion is the dominant transport mechanism in the matrix bear et al 1993 rausch et al 2005 other mechanisms influencing solute transport in fractured systems include sorption and decay bear et al 1993 while a fractured system typically consists of a set of connected fractures surrounded by a pervious or impervious matrix understanding solute behavior at the system scale is based on that in single fractures abdel salam and chrysikopoulos 1995 therefore the ses based framework developed in the present study is based on solute behavior in a single fracture modeling solute transport in a single fracture requires coupling its behavior in the open fracture with that in the rock matrix the resulting coupled governing equations can be solved analytically liu et al 2017 maloszewski and zuber 1990 meng et al 2018 sudicky and frind 1982 tang et al 1981 or numerically abdel salam and chrysikopoulos 1995 brutz and rajaram 2017 he et al 2017 james and chrysikopoulos 1999 natarajan 2014 suzuki et al 2018 in different configurations of a single fracture under specified boundary condition at the inlet i e constant concentration constant flux instantaneous or time dependent function when the solute is released into the fracture following a time dependent function the breakthrough curve btc at any location along the fracture is the convolution of that function and the analytical solution under an instantaneous injection bodin et al 2007 analytical solutions developed to date have not been confirmed at the network scale and thus numerical techniques are typically adopted bodin et al 2007 makedonska et al 2015 ngo et al 2017 only the instantaneous or time dependent injection schemes are of interest in the present study as these conditions represent the typical procedures of field based tracer tests when a conservative solute is introduced to a fracture with an impervious matrix i e no matrix diffusion the injected mass is preserved along the fracture however hydrodynamic dispersion causes the residence time of each solute particle between any two locations in the fracture to be a random variable whose probability density function can be approximated by a lognormal one delay and bodin 2001 the theoretical mean residence time t is the average time lag between the appearance of the entire mass at the two locations and depends on the distance between these locations d and the average flow velocity u as follows 1 t d u however matrix diffusion cannot be neglected when the matrix is permeable solute may diffuse into or out of the matrix depending on the direction of the concentration gradient across the fracture wall when matrix diffusion is considered the btc at any location along the fracture can be expressed as the convolution of two functions i the btc resulting from an instantaneous injection of a conservative solute when matrix diffusion is negligible and ii a retention function representing the fracture matrix system response to the solute input function when hydrodynamic dispersion along the fracture is neglected cvetkovic et al 1999 hassan et al 2001 liu et al 2017 the migration of solute particles between two points in a fracture is typically governed by advection and dispersion only even when matrix diffusion is not negligible however calculating t according to eq 1 is not valid in this case as it does not account for fracture matrix interactions the retention function representing the matrix response to the input source acts as a decay function and results in a long tailed btc therefore matrix diffusion can be represented by a retardation factor r that delays solute migration in the fracture and t is subsequently estimated as follows delay and bodin 2001 2 t t o r t o 2 ω 2 t o 2 e r f c ω t o b 2 ω t o b π e x p ω 2 t o 2 b where to d u ω θ d e b θ is the matrix porosity de is the solute diffusion coefficient as defined in tang et al 1981 b is the fracture aperture b 2 d d u 3 and dis the hydrodynamic dispersion coefficient the same concept i e adopting a retardation factor is utilized when the solute interacts with impervious fracture wall however the mass retained is adsorbed onto the surface of the fracture rather than within the matrix another retardation factor is introduced in this case based on the relationship between the sorbed and mobile fractions of the solute a more complex transport scenario includes a reactive solute moving along a fracture with permeable surfaces which combines advection hydrodynamic dispersion sorption and matrix diffusion in all cases t is the theoretical time lag between the centers of mass cm of two btcs at two distinct locations along the fracture as shown in fig 1 considering all possible transport mechanisms such btcs can be obtained from a field based tracer test and the interdependence between them can be used to reveal the transport pathway between the two locations however such transport pathway will always be represented by a straight path connecting the two locations it is noteworthy that a single fracture typically has variable aperture however the present study idealized fracture surfaces as two parallel plates to facilitate the development of the ses based framework therefore b u and d are assumed to be constant along the fracture 2 2 stochastic event synchrony synchronization is defined as the agreement or correlation in time between different processes boccaletti et al 2002 and it indicates the interdependence between systems coupled through such processes boccaletti et al 2018 different synchronization measures have been developed over the past two centuries each of which has its own strengths and limitations stochastic event synchrony ses was first introduced by dauwels et al 2009 to overcome the limitations of other measures and it can be used to uncover the interdependence between two or more linearly or nonlinearly coupled time series the first step in the application of ses is to identify specific events from each time series e g maximum values minimum values or values larger than a specific threshold and subsequently attempt to align or pair these events event selection is challenging and must reflect the application and objective of the study as there is no consistent way for event selection events are most often hand picked based on the judgement of an expert for example maximum values may be selected to investigate the propagation of storms and floods while minimum values may be selected for drought analysis when the ses approach is applied events are first selected from the first time series the second time series is then scanned such that a pair is assigned to each individual event in the first series ensuring that paired events are mathematically related i e time lag and solute mass as discussed below when multiple events from the first series are paired with a single event from the second series respective events from the first series are replaced by the earliest one fig 2 illustrates this even pairing process it should be mentioned that the application of the ses approach is considered of the order o ε η where ε is the number of events selected from the first time series and η is the number of locations employed this indicates the computational efficiency of the ses approach compared to other fracture mapping techniques e g hydraulic tomography particularly when large number of observations and locations are employed the fraction of events in the first series that find pairs in the second known as the coincidence ratio ρ indicates the reliability of pairing synchronization between the two series higher values of ρ indicate that more events from the first series are replicated in the second one after a period of time as all paired events may not be aligned exactly at the same time lag an average time jitter τ is defined to represent the average deviation from the mean lag therefore the lag between two series is a random variable with a specific mean average of all lags and an average time jitter it is noteworthy that two time series are highly synchronized when they can be characterized by higher ρ and lower τ at a specific mean lag it is also noteworthy that the ses approach can alternatively be applied through iteratively assuming a hypothetical pre defined time lag with the aim of maximizing ρ and minimizing τ an initial guess for the pre defined time lag can be obtained based on the transmissivity of the system this guess is subsequently rectified through an iterative process and an optimal solution is obtained machine learning and evolutionary algorithms can therein be used to identify the optimum set of paired events and also prevent the solution from being trapped in local minima or maxima the events shown in fig 2 can represent any processes such as signals transmitted through the human neural system or concentrations of a solute observed at two locations within a fractured network the latter example is the focus of the present study it must be noted that concentration based events may find pairs where transport pathways do not exist thus more confidence can be placed in the legitimacy of mass based event pairs as mass represents the cumulation of concentration over time it should be emphasized that an event pair within the originally developed ses approach are defined as two events aligned at a specific lag even if their values are not interrelated however paired events in the present study were identified such that they are mathematically related at the corresponding lag therefore ses metrics can reveal solute transport between two locations 2 3 the ses based framework a single and unique transport pathway i e a fracture between two locations in a fractured aquifer represents a transmission path for a solute however the distance x travelled by each solute particle in that fracture within a time dt is not deterministic due the range of mechanisms influencing its transport e g hydrodynamic dispersion matrix diffusion therefore dt between two specific locations i e x is constant is a random variable described as bodin et al 2007 3 d t d t c o n ω x u e r f c 1 u 01 2 where dtcon is a lognormal random number with a mean of x ru and a variance of 2dx u3 and u 01 is a uniform random number between 0 and 1 the first term on the right hand side of eq 3 dtcon represents the travel time imposed by advection dispersion and matrix diffusion and the second term represents the solute particle residence time within the rock matrix the mean value of dt is t calculated using eq 1 when matrix diffusion is neglected or eq 2 when matrix diffusion is considered the btc at any location along the fracture is the relationship between the concentration of solute particles arriving at that location and time the cm of a btc corresponds to the mean travel time i e t of all solute particles and the btc spreading can be described by higher moments of dt synchronization between two btcs i e btc 1 and btc 2 acquired from two locations i e location 1 and location 2 along a fracture requires a number of events i e observations on btc 1 to find pairs from btc 2 therefore nt and lt points are defined on btcs 1 and 2 respectively each point on btc 1 expresses solute concentration at location 1 at time tj as shown in fig 3 where j is the point index j 1 2 nt similar terminology is used at location 2 except that the index j is replaced by an index k k 1 2 lt as shown in fig 3 assuming that the volumetric flow rate q is known mass arrival at locations 1 and 2 can be estimated at tj and tk respectively an event i e point at tj of btc 1 is paired with that at tk of btc 2 when mass arrival at these times are mathematically related under the transport mechanisms considered mass arrival at any location is defined as the time integral of the btc i e the area under the btc until a specified time multiplied by q as solute mass is in fact a group of particles mass arrived at a location m at time ti can be defined through two quantities i the arrival time i e ti and ii the average arrival time of the corresponding solute particles t i which represents the cm of the btc up to time ti therefore a mathematical notation of mm ti t i is used to represent this arrived mass to assess the synchronization between the btcs 1 and 2 the pairing of m2 tk t k at location 2 with m1 tj t j at location 1 is tested where t j is the mean travel time of all solute particles arriving at location 1 up to time tj i e the arrival time of cmj and t k is the mean travel time of all solute particles arriving at location 2 up to time tk i e the arrival time of cmk as shown in fig 3 after its arrival at location 1 the mass m1 tj t j migrates along the fracture and is theoretically expected to reach location 2 after t as m 2 tj t t j t when matrix diffusion is negligible masses m 2 tj t t j t and m1 tj t j must be the same whereas when matrix diffusion is considered the two masses must be mathematically related through available analytical solutions e g maloszewski and zuber 1990 tang et al 1981 the use of such analytical solutions provides an additional constraint to ensure that event pairing is based on both time and value rather than time only as the quasi simultaneous appearance of a solute does not guarantee that it migrated between two observation points the jth event from btc 1 is paired with the kth event from btc 2 if m2 tk t k and m 2 tj t t j t are nearly the same subsequently the kth point on btc 2 is referred to as the nth point and the time lag between the two events is tjn while the time lag between the two btcs is theoretically t the actual lag between two paired events i e tjn is t j t n which may be different from t leading to a time jitter τ jn equals to t jn t this time jitter can be positive or negative depending of the value of the corresponding tjn when compared to t it is noteworthy that the actual lag i e tjn is calculated based the mean arrival times i e t j and t n not the absolute arrival times i e tj and tn as the events employed represent the mass rather than concentration in addition estimating τ jn based on t rather than the actual mean lag was chosen in the present study to facilitate relating the ses metrics i e actual mean lag and average jitter to the hydrogeological properties in the fracture as discussed in greater detail below during a field based tracer experiment tj and tk represent the sampling times at locations 1 and 2 respectively it is noteworthy that since q is often unknown prior to proper characterization of a fractured aquifer time integration of the btc can be used as an indicator of mm ti t i where the cm of any portion of the btc is at t i the application of ses utilizing two btcs results in a set of paired events n each of which is lagged by a time tjn that differs from t by a jitter τ jn the actual mean lag t a c t and average jitter τ between the two btcs are thus respectively 4a t a c t 1 n j 1 n t j t n 4b τ 1 n j 1 n t jn t the degree of synchronization between the two btcs at τ and t a c t expressed by ρ is the ratio between n and nt for a transport pathway to exist between the locations where the btcs are acquired ρ must be equal to or exceed a threshold value ρacc calculated by 5 ρ acc p t act min τ jn dt t act max τ jn where p represents the probability that the travel time between locations 1 and 2 is within the time interval t a c t min τ j n and t a c t max τ j n in other words p represents the fraction of solute particles expressed through the number of events from btc 1 i e n expected to migrate from location 1 to location 2 within that time interval under the transport mechanisms considered calculating the time range shown in eq 5 is a subsequent step of event pairing and thus analytical solutions used to assess mass migration are implicitly included in the determination of this time range it is noteworthy that a stochastic rather than a deterministic model is required to evaluate the value of p based on an appropriate distribution of dt the stochastic model developed by delay and bodin 2001 to describe solute travel time in fractures is thus employed for a conservative solute not subject to matrix diffusion dt is lognormal with a mean of x u and a variance of 2dx u3 delay and bodin 2001 and subsequently ρacc can be evaluated analytically however the statistical distribution of dt is not well known when matrix diffusion is considered in this case for simplicity the residence time in the rock matrix tm is assumed to be the same for all solute particles and is given by 6 t m t o 2 ω 2 t o 2 erfc ω t o b 2 ω t o b π exp ω 2 t o 2 b subtracting tm from each term on the right hand side of eq 5 yields a modified expression to estimate dt dtcon which is lognormally distributed with a mean of x ru and a variance of 2dx u3 and therefore ρacc can be evaluated analytically when a transport pathway is detected i e ρ ρacc between two locations the subtraction of τ from t a c t yields the theoretical time lag between the two btcs i e t and thus enables i the use of eq 1 to estimate the average flow velocity i e u when matrix diffusion is negligible or ii the development of a relationship between u and d based on eq 2 when matrix diffusion is considered and when the matrix properties i e de and θ and fracture aperture i e b are known based on the discussion above a ses based framework is proposed to assess the presence of a transport pathway between two locations along a single fracture as shown in fig 4 it is noteworthy that the ses based framework is proposed based on the assumption that btcs are fully developed at the observation locations which is not the typical situation however the framework can still be applied to incomplete btcs through i the use of t a c t instead of t in eq 4b to estimate τ and subsequently ii estimate the hydrogeological properties in the fracture using eq 1 and 2 based on t a c t rather than t a c t τ while the application of ses may appear similar to assessing the cross correlation between two time series at multiple lags it is emphasized that the cross correlation between two time series at multiple lags evaluates the linear relationship between two sets of observations time series but does not assess the causality it is the constraints applied for selecting paired events within the ses approach that provide insights about the presence of a transport pathway between two locations in addition the use of ses rather than other synchronization measures e g lagged correlation coefficient coherence function phase synchronization mutual information is preferred as the synchronization reliability expressed through ρ can be evaluated based on the physical processes underlying solute transport it should be mentioned that the ses based framework employs temporal concentration datasets i e btcs that can be obtained from field tracer experiments or long term monitoring programs the latter is often the situation at contaminated sites e g superfund sites or when potential sources of contamination e g landfills construction exist and the aquifer is being monitored for early detection 3 results and discussion three different cases were chosen to demonstrate the efficacy of the ses based framework in identifying transport pathways 1 a single synthetic fracture with an instantaneous solute injection at the inlet under both pervious and impervious matrix conditions 2 a single synthetic fracture with an impervious matrix and an exponentially decaying solute release at the inlet and 3 a synthetic fracture network with an impermeable matrix and exponentially decaying solute releases at two distinct points along the inlet boundary the ses based framework was first applied to a single synthetic fracture with specified hydrogeologic characteristics to assess its efficacy in identifying interdependence between btcs acquired from two locations along that fracture thus demonstrating the existence of a transport pathway between these locations the hydrogeologic characteristics of the synthetic fracture is delay and bodin 2001 length l 2 m b 200 μm u 5 10 6 m s d 5 10 7 m2 s when the matrix is assumed to be permeable θ 0 35 and d e 10 13 m2 s tang et al 1981 were used a mass of 100g of a conservative solute was released at the fracture inlet through an instantaneous injection and btcs were calculated at 0 2l 0 4l 0 6l 0 8l and l using the analytical solutions reported in kreft and zuber 1978 and maloszewski and zuber 1990 for impermeable and permeable matrix conditions respectively these btcs are shown in fig 5 each btc was divided into 500 points i e nt lt 500 and the ses based framework was employed the btc at the fracture inlet was neglected as it represents a single event since the btc at each location precedes those at downstream locations it was only necessary to apply the ses based framework in this sequence i e btcs at upstream and downstream locations are represented by btc1 and btc2 respectively when the direction of flow is unknown different sequences can be applied to determine the flow direction fig 6 shows the synchronization metrics i e ρ t a c t and τ along with the corresponding ρacc for each pair of btcs for cases a considering matrix diffusion and b neglecting matrix diffusion to assess the efficacy of the ses based framework in identifying the transport pathway between the locations of each btc pair fig 6is shown as a colormap representing the synchronization metrics and corresponding ρacc each panel in fig 6 can be viewed as a two dimensional array with entries representing the synchronization metrics between each btc pair the entries above the antidiagonal on each panel represent ρacc fig 6a and b or τ fig 6c and d whereas those below the antidiagonal represent ρ fig 6a and b or t a c t fig 6c and d the antidiagonal entries on each panel are not considered as they represent the synchronization metrics between a btc at a specific location and itself a transport pathway exists between the locations of each btc pair in cases a and b since all ρ values are larger than ρacc figs 6a and b the comparison of corresponding ρ and ρacc values for each btc pair demonstrates the efficacy of the ses based framework in determining the presence of a transport pathway between any two locations within the fracture considered the values of ρ were 80 or larger and 50 or larger for the cases with and without matrix diffusion respectively this is attributed to the fact that more uncertainty is associated with the solute residence time when matrix diffusion is considered however the fact remains that even when matrix diffusion is present a significant difference between ρ and ρacc still exists and therefore matrix diffusion did not impact the ability of the ses based framework to identify the transport pathways in terms of the precision metrics the difference between t a c t and τ for each btc pair was consistently t therefore t a c t τ can be used to estimate u for case a i e no matrix diffusion and obtain the relationship between u and d for case b i e with matrix diffusion it should also be mentioned that the sensitivity of the ses metrics i e ρ t a c t and τ to the number of observations reflecting the number of divisions of each btc was analysed through changing the number of points on the btcs from 20 to 500 the changes in the ses metrics were less than 5 indicating that they are not sensitive to the number of observations within the range tested a second case is employed to assess the efficacy of the ses based framework under different boundary conditions in this case 100g of a conservative solute was introduced at the inlet of a single fracture with impervious walls through an exponentially decaying release exp γt where γ 1 10 5 s 1 is the decay rate bodin et al 2003 peclet numbers pe ranging from 0 2 to 100 were adopted and the corresponding effluent btc was estimated using the time domain random walk tdrw approach delay and bodin 2001 this range of pe values was obtained through changing the fracture length i e l between 2 cm and 10 m and was calculated using the same u and d values employed in the previous case btcs at the inlet and outlet represented by btc 1 and 2 respectively were divided into 500 points i e nt lt 500 for each pe the ses based framework was subsequently applied and the corresponding ratios ρ ρacc and t a c t τ t are shown in fig 7 the ses based framework effectively detected the transport pathway between the fracture inlet and outlet for the range of pe investigated as indicated by the fact that ρ ρacc is consistently greater than 1 furthermore t a c t τ t is always equal to 1 0 supporting the use of ses metrics t a c t and τ to determine the transport parameters uin this case the results from both cases support the efficacy of the ses based framework in revealing the existence of a transport pathway between two locations along a fracture for different matrix conditions and under different inlet boundary conditions of even greater interest is the ability of the ses based framework to detect multiple connections within a fracture network therefore a third case using a simple impermeable synthetic fracture network within a 10 000 m2 square domain is developed as shown in fig 8 the fractures are assumed to have equal apertures of 100 µm and constant heads of 100 m and 90 m are assigned to the inlet left and outlet right boundaries respectively a conservative solute was injected through the inlet boundary following the release scheme described in the previous case case 2 with a γ value of 10 8 s 1 the tdrw approach was adopted to simulate the transport of 100 000 solute particles representing the mass injected through the synthetic network and the btcs together with the arrival time of their cms were obtained at all intersections as shown in fig 9 and fig 10 respectively the hydraulic connections were identified through solving the flow problem for the whole network fig 8a and are shown in fig 8b transport pathways corresponding to these hydraulic connections should be reproducible through applying the ses based framework before applying the ses based framework fracture intersections were classified into inlet outlet and interior nodes inlet and outlet nodes are those on the left and right boundaries respectively interior and outlet nodes were sorted according to the arrival time of their corresponding cms and were subsequently divided into node groups such that the total mass within each node group is approximately equal to the total mass injected this procedure is similar to that employed for determining the stages when dynamic programming is used for solving a resources allocation problem the node groups formulated together with their assigned points are shown in fig 11 it is noteworthy that in a field based tracer test inlet nodes correspond to injection locations while outlet and interior nodes cannot be distinguished however outlet nodes can be identified as those having the largest cm arrival times the btcs at all nodes were divided into 500 segments i e the number of points events is 501 and the ses based framework was subsequently employed the framework was applied to each two subsequent node groups where the node group of the lower index is referred to as the upstream group and that of a higher index is referred to as the downstream group in general four different circumstances can be encountered when the ses based framework is applied in a dfn setting a each of the upstream and downstream node groups contain a single node e g when the framework is applied to groups 2 and 3 shown in fig 11 b the upstream node group contains one node while the downstream node group contains multiple nodes e g when the framework is applied to groups 4 and 5 shown in fig 11 c the upstream node group contains multiple nodes while the downstream node group contains one node does not exist in this example and d both the upstream and downstream node groups contain multiple nodes e g when the framework is applied to groups 5 and 6 shown in fig 11 in circumstance a the application of the ses based framework is similar to that utilized in verification cases 1 and 2 i e assessing the synchronization between only two btcs in circumstance b the btc within the upstream node group a single btc is scaled using the total mass ratio of each btc within the downstream node group in other words the btc of the upstream node group is partitioned among the downstream nodes based on the mass arrival at each node similarly in circumstance c the btc within the downstream node group is scaled using the total mass ratio of each btc within the upstream node group in circumstance d each btc within both the upstream and downstream node group is normalized using its own maximum value so that the effect of mass sharing between multiple connections is reduced it is noteworthy that more uncertainty is associated with circumstance d as the normalization process may result in event pairs that are actually independent while these represent four different circumstances they can be in fact classified into i two single nodes from subsequent node groups are connected and ii two subsequent node groups are connected it is noteworthy that using either the btcs or the accumulated btcs in verification case 3 results in the same ses metrics based on the above discussion the resulting synchronization metrics ρ ρi ρii and the corresponding ρ a c c ρ acc i ρ acc ii where the superscripts i and ii refer to the circumstance classification discussed above were estimated between the nodes within each two subsequent node groups a direct transport pathway is assumed to exist between two nodes one from the upstream node group and the other from the downstream node group when ρi ρ a c c i and ρii ρ a c c i i whereas all nodes in the upstream node group are assumed to be directly hydraulically connected to all those in the downstream node group when ρ i i ρ a c c i i and ρ i ρ a c c i a zero value of ρ a c c i or ρ a c c i i indicates that there is no probability for the solute particles to migrate between the two nodes in either or both circumstance classifications i and ii within the time interval t act min τ jn and t act max τ jn therefore the corresponding transport pathway s can be rejected the ses based framework effectively detected 26 out of 32 of the direct transport pathways existing in the synthetic fracture network see fig 12 a additional 15 transport pathways were also detected between different nodes within the network due to the similarities between the btcs at these nodes see fig 12b a mass balance condition can therefore be applied at each intersection to assess the existence of the identified connections the results from verification case 3 demonstrate the efficacy of the ses based framework in reconstructing the transport pathways within an impermeable fracture network additionally the results from this verification case highlight the efficiency of the ses based framework in identifying the transport pathway between two locations under a periodic injection scheme where multimodal btcs similar to those in fig 9 are typically observed it is noteworthy that the present study employed equal number of events at all locations i e the btcs were divided into the same number of segments in each verification case for demonstration however this is not mandatory for the application of the ses based framework it is also noteworthy that a simplified system i e fractures with constant apertures impermeable matrix was employed in this verification case to demonstrate the applicability of the ses based framework at the network scale and further tests are required to assess its robustness in more complex settings in real fractured systems variable apertures and apertures of different sizes yield complex mass transfer at intersections which will significantly affect the system behavior and lead to more uncertainty in the connections identified using the ses based framework additionally these simulations were conducted in a two dimensional 2d space however the effects of matrix diffusion are more prominent in 3d which could result in undetected solute concentrations this also could lead to more uncertainty in the results of the ses based framework the application of the ses based framework can in turn result in multiple networks rather than a unique solution as highly synchronized btcs may result in detecting transport pathways where actual fractures do not exist it is thus highlighted that careful attention must be paid to the application and interpretation of the ses framework at the fracture network scale e g event pairing neglected mechanisms multiple observation types particularly as the network becomes more complex with more uncertainty however it should be mentioned that an optimization technique can be coupled with the ses based framework to reduce the effects of the different sources of uncertainty and identify the most reliable transport pathways this would in turn enhance the reliability of this approach the ses based framework can also be used to identify transport pathways within three dimensional fracture networks when available observations are acquired from different locations at multiple depths in this situation the application of the framework would be similar to verification case 3 taking into account the different sources of uncertainty as discussed above 4 conclusions the coherence between solute transport in a fracture and time series synchronization enabled the development of a ses based framework that is able to detect transport pathways between two points in a fractured aquifer the efficacy of the ses based framework was demonstrated through its ability to map the transport pathway s based on the solute btcs at two distinct locations within i a single synthetic fracture with an impermeable matrix under instantaneous and exponentially decaying solute releases at the inlet ii a single synthetic fracture with permeable matrix under an instantaneous solute injection and iii a fracture network with an impermeable matrix under exponentially decaying solute releases at two points along the inlet boundary additionally the ses based framework is able to determine u or the relationship between u and d for impermeable and permeable matrix conditions respectively this ses based framework was able to map transport pathways using sparsely located btcs rather than hydraulic geometrical and connectivity data all of which require far more intensive resources to collect in the field the transport pathways mapped using the ses based framework can be utilized to condition fracture networks developed through other approaches e g stochastic generation hydraulic tomography cross correlation analysis therefore enable the development of reliable dfn models this is in fact crucial for the effective planning management and remediation in fractured aquifers this study is the first to introduce the synchronization analysis in the field of hydrogeology and is expected to be the basis for applying the same analysis to solve complex relevant problems in similar systems credit authorship contribution statement ahmed yosri conceptualization methodology software formal analysis writing original draft sarah dickson anderson conceptualization writing review editing supervision funding acquisition ahmad siam writing review editing wael el dakhakhni writing review editing supervision funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgment this research was supported by nserc through the canadian nuclear energy infrastructure resilience under systemic risk canrisk collaborative research and training experience create grant number create 482707 2016 and discovery grant programs grant number rgpin 250121 2013 
