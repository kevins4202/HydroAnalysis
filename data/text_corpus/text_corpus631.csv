index,text
3155,the kling gupta efficiency 3 empirical description of uncertainty of the kling gupta efficiency 3 1 linear regression 3 1 1 theory 3 1 2 application linear function 3 2 nonlinear regression 3 2 1 theory 3 2 2 application a hydrologic toy model 3 3 diagnostic regression 3 3 1 application linear function 3 3 2 application a conceptual watershed model 4 conclusions data and software availability credit authorship contribution statement acknowledgment appendix a decomposition of the mean squared residual appendix b decomposition of the coefficient of determination appendix c description of multivariate parameter uncertainty aitken 1936 42 48 a ammann 2019 2147 2172 l anderson 1952 193 212 t barber 2019 87 101 c bates 2001 937 947 b beven 2006 18 36 k beven 1992 279 298 k beven 2001 11 29 k boyle 2000 3663 3674 d breusch 1978 334 355 t breusch 1979 1287 1294 t brunner 2020 3951 3966 m draper 1995 399 403 n draper 1998 n wileyseriesinprobabilitystatistics appliedregressionanalysis duan 1992 1015 1031 q durbin 1950 409 428 j durbin 1951 159 179 j efron 1979 1 26 b everitt 2010 b cambridgedictionarystatistics freer 1996 2161 2173 j gauch 2020 m goldfeld 1965 539 547 s gupta 1998 751 763 h gupta 2008 3802 3813 h gupta 2009 80 91 h kavetski 2006 d kavetski 2006 d knoben 2019 2463 2480 w kuczera 1983 1151 1162 g kuczera 1998 69 85 g lamontagne 2020 1 25 j murphy 1988 2417 2424 a nash 1970 282 290 j newman 2015 209 223 a pool 2018 1941 1953 s oliveira 2022 e2022wr032263 d rakovec 2019 13991 14007 o sadegh 2013 4831 4850 m scharnagl 2015 2155 2199 b schoups 2010 g schoups 2010 g schwemmle 2021 2187 2198 r shapiro 1965 591 611 s sorooshian 1980 430 442 s spear 1980 43 49 r spear 2020 1 16 r stedinger 1985 1421 1432 j tasker 1980 1107 1113 g vogel 1993 1745 1752 r vrugt 2018 954 971 j vrugt 2013 4335 4345 j vrugt 2002 j vrugt 2005 j vrugt 2006 288 307 j vrugt 2009 273 290 j westerberg 2011 2205 2227 i white 1980 817 838 h yilmaz 2008 k vrugtx2022x127968 vrugtx2022x127968xj full 2022 05 25t00 54 40z fundingbody university of california uc 2021 core hybrid http creativecommons org licenses by 4 0 2024 06 29t00 00 00 000z 2024 06 29t00 00 00 000z http creativecommons org licenses by nc nd 4 0 this is an open access article under the cc by license 2022 the author s published by elsevier b v 2022 07 07t03 07 45 220z http vtw elsevier com data voc addontypes 50 7 aggregated refined 0 item s0022 1694 22 00543 1 s0022169422005431 1 s2 0 s0022169422005431 10 1016 j jhydrol 2022 127968 271842 2023 04 04t04 21 47 375301z 2022 09 01 2022 09 30 unlimited cdlhyb21 1 s2 0 s0022169422005431 main pdf https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 main application pdf 1ba9a18e6a9616e03571e3f223a8a7a1 main pdf main pdf pdf true 4018911 main 18 1 s2 0 s0022169422005431 main 1 png https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 preview image png dfc081036b3ed6cd30b0e00a4fe97c54 main 1 png main 1 png png 56382 849 656 image web pdf 1 1 s2 0 s0022169422005431 gr2 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr2 downsampled image jpeg ae50a31a7df93c0655e9f59e98b9d987 gr2 jpg gr2 gr2 jpg jpg 14325 151 534 image downsampled 1 s2 0 s0022169422005431 gr1 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr1 downsampled image jpeg 78c171e67680058dd41f114424f195fb gr1 jpg gr1 gr1 jpg jpg 50556 258 551 image downsampled 1 s2 0 s0022169422005431 gr4 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr4 downsampled image jpeg 67fa76c41c855171b421660da59650ba gr4 jpg gr4 gr4 jpg jpg 52497 345 622 image downsampled 1 s2 0 s0022169422005431 gr3 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr3 downsampled image jpeg e941e9cb8dbd277a6790a58cdb283150 gr3 jpg gr3 gr3 jpg jpg 63931 270 570 image downsampled 1 s2 0 s0022169422005431 gr6 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr6 downsampled image jpeg 7154c42879f9620e07e7c6082adae63c gr6 jpg gr6 gr6 jpg jpg 45538 326 667 image downsampled 1 s2 0 s0022169422005431 gr5 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr5 downsampled image jpeg b4ba8999c973bf023e74bcffa7cedf7c gr5 jpg gr5 gr5 jpg jpg 16177 125 622 image downsampled 1 s2 0 s0022169422005431 gr8 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr8 downsampled image jpeg 87f64b6541fd96d41512c2d11ae6e844 gr8 jpg gr8 gr8 jpg jpg 53818 350 667 image downsampled 1 s2 0 s0022169422005431 gr7 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr7 downsampled image jpeg f50eec4c2fe440d97e31f924517504fc gr7 jpg gr7 gr7 jpg jpg 18505 257 511 image downsampled 1 s2 0 s0022169422005431 fx1 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 fx1 downsampled image jpeg 143139feb50856e488abd4b1e02fd168 fx1 jpg fx1 fx1 jpg jpg 5913 40 378 image downsampled 1 s2 0 s0022169422005431 gr9 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr9 downsampled image jpeg 557f38441c067cf5b309293ae4b43374 gr9 jpg gr9 gr9 jpg jpg 25543 198 578 image downsampled 1 s2 0 s0022169422005431 gr10 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr10 downsampled image jpeg 3b260c8b2e8f0c3055eb9bb3071eb195 gr10 jpg gr10 gr10 jpg jpg 29700 194 622 image downsampled 1 s2 0 s0022169422005431 gr11 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr11 downsampled image jpeg abecdc332defc1a91917b285619dd849 gr11 jpg gr11 gr11 jpg jpg 95512 542 667 image downsampled 1 s2 0 s0022169422005431 gr2 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr2 thumbnail image gif 8a47717547b6ea946bbe8dd8db0c2278 gr2 sml gr2 gr2 sml sml 2757 62 219 image thumbnail 1 s2 0 s0022169422005431 gr1 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr1 thumbnail image gif 31f205470bbc2bb37a1e77605d7a087f gr1 sml gr1 gr1 sml sml 9580 103 219 image thumbnail 1 s2 0 s0022169422005431 gr4 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr4 thumbnail image gif 8ebf854131292a06bf51008bda55949d gr4 sml gr4 gr4 sml sml 9181 121 219 image thumbnail 1 s2 0 s0022169422005431 gr3 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr3 thumbnail image gif 449542dc79217a446f0340798bd1b704 gr3 sml gr3 gr3 sml sml 11835 104 219 image thumbnail 1 s2 0 s0022169422005431 gr6 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr6 thumbnail image gif 9876553a84f53373039ed6d6d6c8f7a7 gr6 sml gr6 gr6 sml sml 5275 107 219 image thumbnail 1 s2 0 s0022169422005431 gr5 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr5 thumbnail image gif 0ecda20f2183c069210042ca287b29d7 gr5 sml gr5 gr5 sml sml 2547 44 219 image thumbnail 1 s2 0 s0022169422005431 gr8 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr8 thumbnail image gif 4867db51642cb35a69e61c779562c68e gr8 sml gr8 gr8 sml sml 7497 115 219 image thumbnail 1 s2 0 s0022169422005431 gr7 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr7 thumbnail image gif 2e8be1b89721f0e4090dabdbe66fa994 gr7 sml gr7 gr7 sml sml 4175 110 219 image thumbnail 1 s2 0 s0022169422005431 fx1 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 fx1 thumbnail image gif df0bbda314d372575d24993f8aa96e7e fx1 sml fx1 fx1 sml sml 2497 23 219 image thumbnail 1 s2 0 s0022169422005431 gr9 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr9 thumbnail image gif 9f6bf65f80ab2596e2075f31cb0f710e gr9 sml gr9 gr9 sml sml 4846 75 219 image thumbnail 1 s2 0 s0022169422005431 gr10 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr10 thumbnail image gif 781689b9b4ee089661451fa93acfcd2a gr10 sml gr10 gr10 sml sml 3446 68 219 image thumbnail 1 s2 0 s0022169422005431 gr11 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr11 thumbnail image gif 394c0dfdbb3211e90f32f5ab70764140 gr11 sml gr11 gr11 sml sml 12330 164 202 image thumbnail 1 s2 0 s0022169422005431 gr2 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 highres image jpeg 349ecbb86e8f99c4857b845081553c33 gr2 lrg jpg gr2 gr2 lrg jpg jpg 88626 668 2362 image high res 1 s2 0 s0022169422005431 gr1 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 highres image jpeg d5f333fca40878c8b4eeb5376bb7ae73 gr1 lrg jpg gr1 gr1 lrg jpg jpg 358752 1144 2441 image high res 1 s2 0 s0022169422005431 gr4 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 highres image jpeg ac7175f39a8a6f9d28c82b7a197df955 gr4 lrg jpg gr4 gr4 lrg jpg jpg 380706 1529 2756 image high res 1 s2 0 s0022169422005431 gr3 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 highres image jpeg 52d23b36cd9e75ef4314fd95d7c8e417 gr3 lrg jpg gr3 gr3 lrg jpg jpg 468216 1197 2526 image high res 1 s2 0 s0022169422005431 gr6 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 highres image jpeg b619fe9bdbe93bedd9e95e7eac2c111d gr6 lrg jpg gr6 gr6 lrg jpg jpg 259423 1445 2953 image high res 1 s2 0 s0022169422005431 gr5 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 highres image jpeg 4eede3af83ac352b3098b3b4264a7da0 gr5 lrg jpg gr5 gr5 lrg jpg jpg 106474 552 2756 image high res 1 s2 0 s0022169422005431 gr8 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 highres image jpeg 9f2629216685f123f4b02e04b560081f gr8 lrg jpg gr8 gr8 lrg jpg jpg 353683 1551 2953 image high res 1 s2 0 s0022169422005431 gr7 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 highres image jpeg 01fbaf785d922b83d458caebda76ebf1 gr7 lrg jpg gr7 gr7 lrg jpg jpg 116909 1139 2264 image high res 1 s2 0 s0022169422005431 fx1 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 highres image jpeg 220d52d610d13925e82316a9e6ff1528 fx1 lrg jpg fx1 fx1 lrg jpg jpg 44951 178 1673 image high res 1 s2 0 s0022169422005431 gr9 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 highres image jpeg f9ff67b12da7036781b8edf4b6ffd6d6 gr9 lrg jpg gr9 gr9 lrg jpg jpg 180979 878 2559 image high res 1 s2 0 s0022169422005431 gr10 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 highres image jpeg a62a7da74344681b40e37acdfb46a106 gr10 lrg jpg gr10 gr10 lrg jpg jpg 176648 860 2756 image high res 1 s2 0 s0022169422005431 gr11 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 highres image jpeg d8378885674d36209ac46f461be620a4 gr11 lrg jpg gr11 gr11 lrg jpg jpg 705399 2401 2953 image high res 1 s2 0 s0022169422005431 am pdf am am pdf pdf 355331 aam pdf https s3 eu west 1 amazonaws com prod ucs content store eu west content egi 105vq8w33j9 main application pdf adfd5a9684e1a9b8c59788a65e9e84be am pdf hydrol 127968 127968 s0022 1694 22 00543 1 10 1016 j jhydrol 2022 127968 the author s fig 1 illustrative example of parameter confidence regions and confidence intervals a contour plot of the generalized least squares objective function of eq 17 for a linear regression function f θ t at b using 0 97 a 1 025 and 1 30 b 2 60 the contour lines are labeled and coded using a copper colormap the bivariate 100 γ confidence regions of the slope a and intercept b defined by eq 27 are displayed with a gray color scheme using γ 0 50 γ 0 90 γ 0 95 and γ 0 99 respectively the dashed blue lines display the univariate 95 confidence intervals of the slope and intercept computed from eq 29 b bivariate scatter plot of the n 10 000 optimized values of a and b derived from the bootstrap method the color of the dots signifies the confidence level derived from the bootstrap samples the dashed blue lines portray the univariate 95 intervals of a and b the red cross highlights the minimum of the gls objective function fig 2 schematic illustration of the three parameter hydrologic model grey boxes labeled in red correspond to fictitious control volumes which control the transformation of rainfall into river discharge arrows portray the fluxes into and out of the compartments including daily precipitation p t the inflows 1 d p t and dp t to the fast and slow reservoirs in mm d and the fast q f and slow q s reservoir s contribution to the discharge this simple model admits an analytic solution for the simulated discharge fig 3 bivariate scatter plots of the parameter pairs of the three parameter hydrologic model a d k f b k f k s and c k s d using the bootstrap method top panel and dream algorithm bottom panel the samples are color coded to reveal their respective confidence levels γ 0 5 light gray γ 0 90 light medium gray γ 0 95 medium gray and γ 0 99 dark gray the optimum parameter values are separately indicated in each graph with a red cross fig 4 visualization of the bivariate confidence region of the slope a and intercept b of the linear regression function f θ t at b for a the gls objective function using eq 27 and b the kg efficiency with the bootstrap method the confidence regions are coded with a gray color scheme using γ 0 50 γ 0 90 γ 0 95 and γ 0 99 respectively the dashed blue lines depict the univariate 95 confidence intervals of the slope and intercept derived from a eq 29 and b the percentiles of the bootstrap samples the red cross corresponds to a the minimum of the gls objective function and b the maximum of the kg efficiency fig 5 schematic illustration of the hmodel after schoups et al 2010 grey boxes labeled in red correspond to fictitious control volumes of the watershed which govern the rainfall runoff transformation arrows portray the fluxes into and out of the compartments including precipitation p t interception evaporation e i surface runoff q runoff and percolation q perc the four state variables are simulated using a mass conservative second order integration method with adaptive time step fig 6 histograms of the optimized hmodel parameters for the thousand replicates of the leaf river top panel and kinchafoonee creek bottom panel watersheds including a s max mm b q max mm c α f d k f and e k s the relative frequencies on the y axis are normalized to yield a common empirical density between 0 and 1 for all parameters the red crosses correspond to the optimized hmodel parameter values θ of the measured discharge records fig 7 histogram of the kg efficiency derived from repeated optimization of the hmodel parameters using the replicates of the discharge record of the a leaf river and b kinchafoonee creek the maximized kg efficiencies of the measured discharge data are separately indicated with a red cross fig 8 bivariate scatter plots of selected parameter pairs including a i max s max b α f s max c k f s max and d k s s max for the leaf river top panel and kinchafoonee creek bottom panel watersheds the confidence regions are coded with a gray color scheme using γ 0 50 light γ 0 90 light medium γ 0 95 medium and γ 0 99 dark respectively the red crosses signify the hmodel parameter values that maximize the kg efficiency of the measured discharge records fig 9 observed red dots and 99 hmodel simulated gray region daily discharge time series for a seven month period between nov 1 2004 and june 30 2005 of the discharge record of the leaf river basin the light red region corresponds to the 99 intervals of the discharge measurement errors fig 10 diagnostic analysis of the streamflow residuals of the calibrated hmodel using the kg efficiency a residuals as a function of simulated discharge b histogram of residuals c acf with 95 significance levels dotted red lines fig 11 confidence regions gray tints and 95 confidence intervals dashed blue lines for a linear regression function f θ t at b with homoscedastic measurement errors and 0 97 a 1 025 and 1 30 b 2 60 a generalized least squares using the analytic expressions of eqs 27 and 29 b resampling of the training data record with the bootstrap method c contouring of the gls objective function using the tolerable increment of eq c3 and d bayesian inference with the dream algorithm using a uniform prior for the slope a and intercept b and likelihood function of eq c4 the bivariate 100 γ confidence regions of the slope a and intercept b are displayed with a gray color scheme using γ 0 50 light gray γ 0 90 light medium gray γ 0 95 medium gray and γ 0 99 dark gray respectively the top left graph includes contour lines of the gls objective function in eq c1 the red cross highlights the minimum of the gls objective function table 1 description of the hmodel parameters including their symbols units lower and upper bounds parameter symbol units min max maximum interception i max mm 0 10 soil water storage capacity s max mm 10 1000 maximum percolation rate q max mm d 0 100 evaporation parameter α e 0 100 runoff parameter α f 10 10 time constant fast reservoir k f d 0 10 time constant slow reservoir k s d 0 500 research papers confidence intervals of the kling gupta efficiency jasper a vrugt conceptualization methodology software validation formal analysis investigation writing original draft writing review editing visualization supervision project administration debora y de oliveira software validation formal analysis data curation visualization department of civil and environmental engineering university of california irvine california usa department of civil and environmental engineering university of california irvine california usa department of civil and environmental engineering university of california irvine california usa corresponding author this manuscript was handled by andras bardossy editor in chief the kling gupta efficiency hereafter referred to as kg efficiency rather than its common abbreviation kge proposed by gupta et al 2009 has become a widely used metric for evaluating the goodness of fit of n vectors of observations y y 1 y 2 y n and corresponding model simulations y θ y 1 θ y 2 θ y n θ this metric rectifies some of the shortcomings of the coefficient of determination r 2 also known to hydrologists as the efficiency of nash and sutcliffe 1970 by using a euclidean distance based weighting of the correlation bias and temporal variability of the observed y and simulated y θ data but as the kg efficiency is not borne out of assumptions with respect to the statistical distribution of the residuals e θ y y θ we cannot formally characterize its uncertainty the ns efficiency suffers a similar problem yet statistical theory postulates that its confidence intervals should follow a beta distribution in certain special cases without a formal description of the confidence intervals of the kg efficiency we cannot amongst others quantify parameter uncertainty compute confidence and prediction limits on simulated model responses inform decision makers about critical modeling uncertainties evaluate model adequacy and assess the information content of calibration data more fundamentally without confidence intervals we cannot establish whether the kg efficiency is a consistent efficient and unbiased estimator in this paper we present an empirical description of the confidence intervals of the kg efficiency we relate the unknown probability distribution of the kg efficiency to the measurement errors of the training data record y and use the bootstrap method to carry out statistical inference we illustrate our method by application to a simple linear regression function for which the least squares parameter confidence regions are exactly known and two hydrologic models of contrasting complexity the empirical parameter confidence regions and or intervals of the kg efficiency are compared to those derived from generalized least squares objective function contouring and bayesian analysis using markov chain monte carlo simulation the marginal parameter distributions of the kg efficiency are generally well described by a normal distribution results further confirm that the distribution of the kg efficiency is a complex function of data length and the magnitude distribution and structure of the measurement errors this prohibits an analytic description of the empirical confidence regions and or intervals of the kg efficiency and reiterates the need for the bootstrap method keywords kling gupta efficiency nash sutcliffe efficiency confidence intervals bootstrap method bayesian analysis marginal distribution 1 introduction and scope consider a dynamic system model m θ x ℝ d ℝ n which simulates a n record y y 1 y 2 y n of a single output variable for a d vector of parameter values θ θ 1 θ 2 θ d with θ ℝ p and array x of constants and input variables required under the supposition or hypothesis that they govern by causality using physical laws of nature e g mathematical function s the simulated output the array x may characterize the system s initial state and or invariant distributed properties and document the evolution of its spatiotemporal control inputs forcing explanatory variables but is of no particular interest here therefore we suppress use of this symbol and write instead y m θ for the vector valued form of the model with respect to θ a key task is now to determine suitable values of the parameters θ so that the model output y approximates as closely and consistently as possible the observed system behavior y y 1 y 2 y n we may now write y m θ where 1 2 n signifies a n 1 vector of measurement errors the common paradigm in the statistical literature is to hypothesize a measurement error distribution p n of the data y and exploit this assumption in the construction of an objective function f θ for example if the measurement errors satisfy the so called gauss markov assumptions and i have a zero mean e i 0 ii constant variance var i σ 2 for all i n and iii are uncorrelated cov i j 0 for all i j then minimization of the well known sum of squared residuals 1 f ssr θ i 1 n y i y t θ 2 will lead to minimum variance estimates of the parameters θ the ssr is strictly positive meaning that f ssr θ 0 for θ ℝ p possibly with exception of one or more points at which f ssr θ 0 as complex systems do not admit a perfect characterization the residuals between model and data e i θ y i y i θ for all i 1 2 n will on average be substantially larger than the data measurement errors i gupta et al 1998 beven and binley 1992 beven 2006 kavetski et al 2006 vrugt and beven 2018 nonetheless the residuals are expected to absorb the consequences of model misspecification an inadequate characterization of the system properties and errors in the forcing explanatory variables and initial states and behave statistically in a similar way as the measurement errors in this paper we distinguish between formal and informal measures of the goodness of fit to clarify this terminology formal measures of the goodness of fit such as the f ssr θ are the result of the rigorous application of statistical theory and demand explicit and testable assumptions about the probabilistic properties of the residuals these hypotheses can be verified aposteriori using regression diagnostics this involves the use of statistical tests for i variance homogeneity goldfeld and quandt 1965 breusch and pagan 1979 white 1980 ii serial correlation durbin and watson 1950 durbin and watson 1951 breusch 1978 and iii normality anderson and darling 1952 shapiro and wilk 1965 of the residuals these diagnostic checks provide guidance on further stages of model development hence constitute an important advantage of the use of formal goodness of fit measures informal measures of the goodness of fit on the contrary do not make assumptions about the expected structure and or distribution of the residuals examples include the coefficient of determination r 2 better known to hydrologists as the nash sutcliffe ns efficiency nash and sutcliffe 1970 and the kling gupta kg efficiency gupta et al 2009 the use of these metrics has profound consequences the most important of which for this paper is that the lack of clarity in the assumptions about the expected distribution of the residuals prohibits an objective characterization of the confidence and prediction intervals of the parameters and simulated output in the past decades a large number of goodness of fit measures have been used to fit hydrologic models to data this includes the use of a formal objective and or likelihood functions that result from the application of first principles with respect to the statistical properties of the residuals such as the ssr in eq 1 and weighted formulations thereof with without treatment of serial correlation and or heteroscedasticity within the context of weighted and or generalized least squares tasker 1980 stedinger and tasker 1985 kavetski et al 2006 kavetski et al 2006 b equivalent likelihood functions sorooshian and dracup 1980 kuczera 1983 bates and campbell 2001 possibly augmented with skew and or kurtosis schoups and vrugt 2010 scharnagl et al 2015 ammann et al 2019 within the context of maximum likelihood estimation and bayesian inference c informal metrics of fit such as the ns nash and sutcliffe 1970 kg gupta et al 2009 knoben et al 2019 and diagnostic schwemmle et al 2021 efficiencies and possible nonparametric variants pool et al 2018 and other improvements lamontagne et al 2020 within the context of model calibration and or evaluation d pseudo likelihood functions within the context of the glue methodology beven and binley 1992 freer et al 1996 beven and freer 2001 e informal statistical measures of the quality of fit such as the coefficient of determination and percentage bias within the context of multiple criteria methods gupta et al 1998 boyle et al 2000 f hydrologic signatures within the context of model diagnostics gupta et al 2008 yilmaz et al 2008 westerberg et al 2011 g summary metrics within the context of approximate bayesian computation vrugt and sadegh 2013 sadegh and vrugt 2013 and h tolerable ranges within the context of limits of acceptability beven 2006 vrugt and beven 2018 regional sensitivity analysis spear and hornberger 1980 spear et al 2020 and the parameter identification method based on the localization of information vrugt et al 2002 this arrangement in groups should not imply that certain goodness of fit metrics are only used within a particular context for example the kg efficiency is not only used as objective function for model calibration but also serves its purpose in model diagnostics e g see rakovec et al 2019 since the publication by gupta et al 2009 the kling gupta kg efficiency has become a widely used metric for evaluating the goodness of fit of n vectors of model simulations y θ y 1 θ y 2 θ y n θ and corresponding observations y y 1 y 2 y n this metric rectifies some of the shortcomings of the popular nash sutcliffe ns efficiency by using a different euclidean distance based weighting of the correlation bias and temporal variability of the observed and simulated data but this adjustment to the weights of the hydrograph descriptors does not solve the fundamental problem of how to characterize the confidence and prediction limits of the kg efficiency we face a similar problem with the ns efficiency yet for certain special cases we can construct its confidence intervals using the beta distribution draper and smith 1998 albeit this is rarely done in the literature without a description of the confidence intervals of the kg efficiency we cannot amongst others quantify parameter uncertainty derive confidence and prediction limits on simulated model responses assess regional relationships between model parameters and catchment characteristics kuczera and parent 1998 inform decision makers about critical modeling uncertainties evaluate model adequacy and assess the information content of calibration data vrugt et al 2006 more fundamentally without confidence intervals we cannot establish whether the kg efficiency is a consistent efficient and unbiased estimator this paper is concerned with the empirical 1 1 we use the wording empirical confidence intervals to emphasize the heuristic nature of the confidence intervals of informal goodness of fit metrics such as the kg efficiency description of the confidence intervals of the kg efficiency as this estimator lacks a fundamental basis in statistical regression theory we relate the distribution of the kg efficiency to the measurement errors of the training data record y and resort to the bootstrap method of efron 1979 to characterize its confidence and prediction intervals section 2 presents a small sample correction in the decomposition of the ns efficiency of gupta et al 2009 as prerequisite to the exact definition of the kg efficiency this is followed by section 3 which describes our methodology for estimating the uncertainty of the kg efficiency we frame our methodology within the context of generalized least squares and alternate between theory and examples involving simple linear regression and nonlinear regression of the rainfall discharge transformation we compare the confidence limits of the kg efficiency against those derived from least squares estimation finally section 4 concludes our paper with a summary of the main findings 2 the mean squared residual in this section we briefly review the origins of the kg efficiency which has led to its current use to this end we first present the now widely known decomposition of the widely used mean squared residual but with proper treatment of the population and sample variances of the measured y and simulated y θ data 2 1 decomposition the ssr is intimately related to the mean squared residual 2 2 the definition mean squared error mse is widespread in the literature but inconsistent when its computation involves unobservable errors the word error implies a difference between an observed value and its true value as our measurements of system behavior are imperfect the residuals e θ y y θ are estimates of the errors under the assumed model y m θ hence we should use the word residual instead or msr 2 f msr θ 1 n i 1 n y i y i θ 2 which as its name suggests is the average squared difference between the measured and simulated values and thus a multiple of 1 n of the ssr note that the msr has units equal to the squared dimension of the measurements used the msr in turn may be normalized by the variance of the training data σ y 2 to yield the well known coefficient of determination r 2 1 as follows 3 r 2 1 i 1 n y i y i θ 2 i 1 n y i m y 2 1 n msr n σ y 2 1 msr σ y 2 where m y signifies the mean of the observed data 4 m y 1 n i 1 n y i and s y 2 is an estimate of the unknown population variance σ y 2 5 s y 2 1 n 1 i 1 n y i m y 2 as a reminder it is common practice to use the greek letters μ and σ 2 for the theoretical or population mean and variance and to use lower case letters m and s 2 for their sample estimates derived from the data e g see lamontagne et al 2020 this difference in notation is important and consequential for small sample sizes for the sample variance s y 2 to be an unbiased estimator of the true population variance σ y 2 of the n record of measured data y we must divide by n 1 rather than n in the denominator of eq 5 this is also known as bessel s correction and a consequence of the use of the sample mean m y rather than the unknown population mean μ y according to eq 5 the sum term i 1 n y i m y 2 must equal n 1 s y 2 hence the coefficient of determination in eq 3 may be written as 6 r 2 1 n msr n 1 s y 2 the r 2 measures the proportion of the variance of the measured data that is explained by the model m θ as the denominator of eq 3 does not depend on the model output y the parameters θ that maximize the coefficient of determination r 2 will minimize the ssr nonetheless the r 2 is classified as an informal metric of quality of fit as its definition does not follow from assumptions regarding the nature of the residuals or more precisely the measurement errors the r 2 is also known as the nash sutcliffe efficiency among hydrologists and used widely as measure of model performance of watershed models gupta et al 2009 has shown that we can decompose the msr into three different terms 7 msr 2 σ y σ y 1 r σ y σ y 2 m y m y 2 where r 1 1 measures the strength of linear association between the measured and simulated data 8 r c y y s y 2 s y 2 1 n 1 i 1 n y i m y y i m y 1 n 1 i 1 n y i m y 2 1 n 1 i 1 n y i m y 2 which is also known as pearson s sample correlation coefficient 2 2 small sample correction of the ns efficiency eq 7 will return biased values of the msr if users insert sample variances s y 2 and s y 2 of the measured and simulated data respectively lamontagne et al 2020 we consider this commonplace situation in appendix a and should use instead the following expression 9 msr 2 n 2 n s y s y 1 r n 1 n s y s y 2 m y m y 2 the two formulations eqs 7 and 9 are almost similar except for the use of the sample standard deviations s y and s y of the measured and simulated data and the multiplicative constants 2 n 2 n and n 1 n in front of the first and second term respectively these two multipliers are the result of bessel s correction and yield unbiased estimates of the msr for small n say n 20 the two multiplicative constants approach unity for large n and thus can be removed without harm for multi year records of daily discharge measured at the catchment outlet we can now combine eqs 3 and 9 to yield the following expression for the r 2 and thus nse see appendix b 10 r 2 2 s y s y r y y s y s y 2 n n 1 m y m y s y 2 nse 2 α r α 2 c β n 2 a similar decomposition of the nse into three components of correlation conditional unconditional bias and or relative variability was presented by murphy 1988 and gupta et al 2009 but assume knowledge of the unknown population means and variances of the measured and simulated data y and y θ respectively as a result our decomposition in eq 10 adds a unitless multiplier c n n 1 to the third term of eq 4 of gupta et al 2009 the dimensionless scalars α 0 and β n r measure the relative variability in the simulated and observed values and the normalized bias respectively 11 α s y s y and β n m y m y s y and r 1 1 is the well known sample correlation coefficient of pearson in eq 8 if instead we work with the statistical definition δ of bias 12 δ m y m y m y then we yield the sample equivalent of the theoretical definition of the efficiency e of lamontagne et al 2020 as follows 13 r 2 2 α r α 2 cc y 2 δ 2 nse where c y s y m y is the well known coefficient of variation of the measured data and again c n n 1 is a testament to bessel s correction the use of the standardized bias in eq 13 simplifies comparison across models and or watersheds lamontagne et al 2020 2 3 the kling gupta efficiency drawing inspiration from the decomposition of the nse gupta et al 2009 proposed a new criterion the so called kling gupta kg efficiency to read 14 kg 1 ed where ed equals the euclidean distance of α β r to the so called ideal point 1 1 1 and is computed using 15 ed α 1 2 β 1 2 r 1 2 where β m y m y is a unitless measure of the bias β r like the r 2 and thus nse the kg efficiency can take on values between minus infinity and one where unity implies a perfect fit to the measured data gupta et al 2009 has demonstrated the advantages of the kg efficiency over the widely used nse this has stimulated widespread use of the kg efficiency in hydrology for evaluating the goodness of fit between model simulations y and corresponding observations y one potential concern with the application of the kg efficiency is that the three components α β and r of eq 15 are ratios of product moments that are known to exhibit enormous bias for skewed data such as daily streamflow records lamontagne et al 2020 vogel and fennessey 1993 barber et al 2019 this problem persists even for long streamflow time series and should be avoided lamontagne et al 2020 presents improved estimators of the nse and kg efficiency in controlled monte carlo experiments this paper is not concerned with a formal mathematical analysis of the empirical sampling properties of the kg efficiency as in lamontagne et al 2020 but rather focuses attention on the confidence intervals of this estimator as the kg efficiency is an informal measure of the goodness of fit its optimal parameter estimates θ that maximize eq 14 do not enjoy a formal description of their confidence intervals this impairs our ability to quantify model parameter and predictive uncertainty of the kg efficiency in fact most hydrologic signatures that are used in watershed model diagnostics suffer a similar limitation certainly we would favor a statistical description of the empirical distribution of the kg efficiency a quantitative description of the empirical confidence intervals of the kg efficiency serves many practical tasks and purposes of which uncertainty quantification of model parameter and simulated output is most important from the perspective of this paper more fundamentally this knowledge of the confidence intervals of the kg efficiency is a necessary requirement for a formal analysis of the asymptotic behavior consistency efficiency and unbiasedness of this estimator 3 empirical description of uncertainty of the kling gupta efficiency we present our empirical description of the uncertainty of the kg efficiency we frame our methodology within the context of generalized least squares and alternate between theory and ensuing case studies using parameter estimation problems in linear and nonlinear regression this order of presentation helps to convey our arguments and methodology and should help readers understand how current developments relate to statistical regression theory certainly we should not ignore and or forget about least squares methods in our efforts to push forward the envelope in hydrologic model calibration and evaluation 3 1 linear regression 3 1 1 theory to clarify our approach we write the measurements of the training record as follows 16 y y where y y 1 y n is the true response of the data generating system s we would want our simulated output to mimic as closely and consistently as possible this unobserved measurement error free response to help uncover and replicate the unobserved true response y we must make some assumptions about the nature and distribution of the measurement errors when the i s in eq 16 are expected to have a zero mean with constant variance σ 2 then the msr will provide a meaningful assessment of model performance this constancy assumption however does not do justice to variables such as river discharge whose measurement errors increase with the measured flow level y and thus i d n 0 σ i 2 i 1 n where the symbol d means distributed according to the magnitude and structure of the measurement errors of the training data y will exert control on the quality of the parameter estimates hence this information should be incorporated in the msr estimator for a meaningful comparison of the measured and modeled system response this extension of the msr to correlated and or heteroscedastic measurement errors is also known as generalized least squares and was first described by aitken 1936 he showed that if the measurement errors 1 2 n have i a zero mean e i 0 i 1 2 n and ii covariance matrix cov e σ then minimization of the generalized least squares gls objective function 17 f gls θ e θ σ 1 e θ produces unbiased and minimum variance estimates of the parameters θ the symbol denotes matrix transpose and turns the n 1 residual vector e θ into a row vector so as to have matching inner dimensions in eq 17 the diagonal entries of the n n measurement error covariance matrix σ specify the variances of the measurement errors of the y i s while the off diagonal entries list the pairwise covariances of i and j for all i j 1 2 n and i j to better understand the inner workings of the vector matrix vector product of eq 17 we define the n n weight matrix w to be the square root of σ 1 so that w σ 1 2 and thus w w σ 1 then eq 17 can be written as a vector inner product f gls θ ε θ ε θ of the homogenized and or decorrelated residuals ε θ we θ the entries of the n 1 vector ε θ are also referred to as partial residuals or innovations when the measurement errors are known to be uncorrelated the off diagonal entries of σ and thus w are zero and eq 17 specializes to a weighted sum of squared residuals wssr objective function 18 f wssr θ i 1 n y i y i θ 2 σ i 2 i 1 n w i 2 e i θ 2 i 1 n ε i θ 2 where the weights w i 1 σ i i 1 n on the main diagonal of w are equal to the reciprocal of the measurement error standard deviations and ε θ ε 1 θ ε 2 θ ε n θ is the n 1 vector of homogenized partial residuals in the case of homoscedastic errors the weights w i are all equal hence we can write σ σ 2 i n where i n is the identity matrix of size n and the wssr reduces to a multiple of 1 σ 2 of the ssr the use of the n n covariance matrix of the measurement errors σ places the gls and thus wssr objective functions on a firm statistical footing suppose that we would like to fit the linear regression function y dθ with n p design matrix d and p 1 parameter vector θ θ 1 θ 2 θ p to the n entries y 1 y 2 y n of the training data record y with n n measurement error covariance matrix σ the gls parameter values θ can be obtained by setting the derivative of eq 17 with respect to θ to zero to yield 19 θ θ 1 θ 2 θ p d σ 1 d 1 d σ 1 y where c θ d σ 1 d 1 equals the p p variance covariance matrix of the gls parameters this positive definite matrix p p matrix defines an elliptical distribution a generalization of the multivariate normal distribution with density function 20 p θ k ψ θ θ c θ 1 θ θ where k is a normalization constant and the scalar function ψ x returns the unnormalized density at x the 100 γ confidence region of the gls parameter values is now made up all parameter vectors θ ℝ p that lie inside the space delineated by 21 θ θ c θ 1 θ θ f p γ p n p at the critical value p γ γ the above inequality describes an ellipse for p 2 an ellipsoid in three dimensions and a hyperboloid in p dimensional cartesian parameter space r p although other shapes can occur the principal axes volume shape and orientation direction angle of the confidence region of the hyperboloid are determined by the inverse parameter covariance matrix also referred to as fisher information matrix i θ after sir ronald aylmer fisher 1890 1962 the larger the values of i θ d σ 1 d the stronger the curvature of f gls θ and the smaller the uncertainty of the parameters and thus volume of the confidence region to link our assumptions about the probabilistic properties of the measurement errors to the gls parameters θ we write the n n covariance matrix of the measurement errors σ σ 2 v and thus d n n 0 σ 2 v in the case of homoscedastic and uncorrelated measurement errors v i n otherwise the nonsingular n n matrix v may have unequal diagonal elements heteroscedasticity and or off diagonal entries that are non zero the p p parameter covariance matrix c θ can now be written as follows 22 c θ s 2 d v 1 d 1 with corresponding geometric description of the 100 γ confidence region 23 θ θ d v 1 d θ θ s 2 f p γ p n p where s 2 is the sample variance of the weighted homogenized and or decorrelated residuals 24 s 2 e θ v 1 e θ n p according to the definition of the chi square distribution the sum of squares of the weighted residuals in the numerator of eq 24 will follow a multiple σ 2 of the χ 2 distribution with n p degrees of freedom this implies that s 2 d σ 2 χ n p 2 n p with loss of one degree of freedom for each parameter of the regression function analogously the sum of squares of p weighted parameter deviations from the center θ of the ellipsoidal region defined in the numerator of eq 23 will follow a multiple σ 2 of the chi square distribution with p degrees of freedom thus θ θ d v 1 d θ θ d σ 2 χ p 2 if we put everything together we yield 25 the ratio of two chi squared variates u 1 and u 2 with ν 1 and ν 2 degrees of freedom 26 x u 1 ν 1 u 2 ν 2 produces a variate x which follows a f distribution f ν 1 ν 2 with ν 1 and ν 2 degrees of freedom thus the joint 100 γ confidence region of the gls parameters θ now satisfies 27 θ θ d v 1 d θ θ ps 2 f f 1 p γ p n p where f f 1 p γ p ν signifies the inverse of the fisher snedecor cumulative distribution function cdf with p and ν n p degrees of freedom at the critical value p γ γ the inverse cdf is also called the quantile or percent point function and returns the value x of random variable x at which p x x p γ in other words the inverse cdf f x 1 p γ of some univariate distribution x returns the unique real number x so that f x x p γ for long training data records y the distribution of the sample variance of the weighted residuals in the denominator of eq 25 reduces to σ 2 and the 100 γ confidence region becomes 28 θ θ d v 1 d θ θ ps 2 f χ 2 1 p γ p multivariate confidence regions are difficult to visualize and thus pseudo univariate intervals may be determined instead from the diagonal entries of the p p parameter covariance matrix c θ as follows 29 θ γ θ diag c θ f t 1 1 2 1 γ n p where f t 1 p γ ν is the inverse of the student s t cumulative distribution function at cumulative probability percentile p γ 1 2 1 γ and degrees of freedom ν n p these confidence intervals are projections of the confidence region on individual parameter axes for γ 0 95 we yield a 95 parameter confidence interval and the critical t value f t 1 p γ ν equals 12 71 2 57 and 1 96 for n 1 n 5 and n respectively confidence limits of the least squares simulated output y d θ y 1 y 2 y n of the linear regression function y dθ can be computed as follows 30 y i γ y i f t 1 p γ ν s d i d v 1 d 1 d i where d i signifies the i th row of the design matrix and i 1 2 n the confidence intervals follow a normal distribution with mean equal to the least squares output y i d i θ and variance determined by d i and parameter covariance matrix c θ s 2 d v 1 d 1 3 1 2 application linear function to illustrate the application of eqs 27 and 29 please consider fig 1 a which presents a contour plot of the gls objective function for a simple regression function y i f a b t i at i b using synthetic training data y y created using a 1 b 2 t 1 2 50 and measurement errors d n n 0 σ drawn at random from a n variate normal distribution with zero mean and n n covariance matrix σ σ 2 v where σ 2 1 2 and v i n in vector form the regression function reads y i d t i θ where d t i t i 1 signifies the i th row of the n p design matrix d and θ a b the colored ellipses portray the 100 γ confidence regions of a slope and b intercept using γ 0 50 light gray γ 0 90 light medium gray γ 0 95 medium gray and γ 0 99 dark gray the dotted blue lines portray separately the 2 5 and 97 5 percentiles that make up the 95 confidence intervals of the regression model parameters a and b derived from eq 29 the red plus characterizes the gls solution of a and b the 100 γ confidence region of the slope and intercept a and b equals a thin ellipse that centers on the least squares solution red cross the length and direction of the two principal axes of the ellipse are given by the eigenvalues and eigenvectors respectively of the parameter covariance matrix c θ as a result the 99 confidence region of the two parameters a and b is simply a multiple of their 95 region the ellipses enclose values of the slope and intercept a b which the training data y suggests are statistically acceptable at a given confidence level γ the univariate 95 confidence intervals of the slope and intercept blue dotted lines underestimate their bivariate counterparts nevertheless provide a reasonable description of the individual parameter ranges one should be careful however in interpreting these intervals for a and b as a joint confidence region indeed points in the bottom left or upper right corners of the rectangular region delineated by the univariate 95 intervals may seem reasonable for a b yet the joint 95 confidence region of the two parameters as characterized exactly by the ellipse in medium gray demonstrates that points in the white region are inadequate in other words the hypercube defined by expression 29 can be very different from the proper joint confidence region of the parameters this discrepancy between univariate and multivariate confidence intervals is well known in the statistical literature draper and guttman 1995 and researchers usually present univariate confidence intervals only in the general case with p 3 parameters the differences between the marginal and joint confidence regions are typically larger and more difficult to visualize therefore most researchers resort to univariate confidence intervals only note that one can change the projection of the confidence regions on the parameter axes and or adapt the rectangular block to have an equal size volume as the ellipsoidal region draper and guttman 1995 for example press et al 1992 suggests replacing f t 1 1 2 1 γ n p in eq 29 with f χ 2 1 p γ p this may result in a better agreement of the confidence interval block and its ellipsoidal counterpart s yet for reasons demonstrated herein this univariate description of parameter uncertainty cannot replace the joint confidence region certainly the mathematical description of the confidence region in eq 27 is only exact for regression functions with valid basis functions then the n p design matrix d is fixed and the principal axes of the ellipse described by d v 1 d are independent of θ ℝ p for all other functions the sensitivity design matrix will depend on the parameter values and the confidence region expressed in eq 27 is at best only an approximation of the true multivariate parameter uncertainty this is no grounds for panic but simply a reason to change the approach to how we construct the confidence regions fortunately the gls objective function is rooted in statistical theory and therefore we can choose among several different methods to describe exactly the multivariate parameter uncertainty this includes among others i contouring of the gls objective function ii monte carlo simulation and iii the bootstrap method these three methods are fundamentally different but share in common an exhaustive description of the gls cost function in the neighborhood of θ as the first of these two methods demand use of formal goodness of fit measures and or likelihood functions which originate from residual assumptions see appendix c in their current form they are not capable of characterizing parameter uncertainty associated with the application of informal quality of fit metrics such as the kg efficiency hence we focus our attention on the bootstrap method as this approach best suits our application as will be demonstrated next fig 1b illustrates the results of the bootstrap method of efron 1979 by application to the regression function y i f a b t i at i b used herein the scatter plot visualizes a b data pairs derived from the repeated application of eq 19 to n 10 000 different realizations y r y of the training data record y drawn at random from the n variate normal distribution with mean y and covariance matrix σ s 2 v and thus y r d n n y s 2 v this is equivalent to our formulation of the training data in eq 16 with measurement errors d n n 0 s 2 v the variance of the homogenized residuals s 2 is computed from the gls solution θ using eq 24 the bootstrap samples are color coded based on their percentiles of the gls objective function of eq 17 computed using the measured training data y not the replicate records the 100 γ confidence region s of the slope and intercept derived from the bootstrap method match exactly their analytic counterparts of eq 27 this is true for all critical values the small imperfections in the outside perimeter of the outermost ellipse sampled by the bootstrap method highlights the need for a sufficiently large sample size this frontier demarcates the edges of the 99 confidence region and is characterized by the most improbable realizations of the training data record we also witness an excellent agreement between the univariate 95 bootstrap confidence intervals of a and b and their analytic values derived from eq 29 in summary if we perturb the measured data y y 1 y 2 y n according to the assumptions of the gls estimator then the optimized parameter values for each replicate record y r of the training data y define a p variate distribution with probability density function synonymous to eq 20 and 100 γ confidence region s described by eq 27 this is the underlying idea of approximate bayesian computation see e g vrugt and sadegh 2013 and allows for an exact description of parameter uncertainty in the absence of convenient closed form solutions for their confidence regions and or intervals such as eqs 29 and 27 for the gls wssr and or ssr objective functions next we should confirm that these conclusions also hold for regression functions with invalid basis functions 3 2 nonlinear regression 3 2 1 theory the regression function f θ t at b of the first case study satisfies the linearity condition 31 f θ δ θ t i f θ t i d i δ θ where d i t i 1 is the i th row of the n p design matrix d and i 1 2 n this linearity condition does not hold for regression functions whose output depends nonlinearly on their parameters then the entries of the design matrix d may not only depend on the explanatory variable t but also on the values of one or more parameters this is commonplace in hydrology and has two important implications the gls parameter values θ cannot be determined from the closed form solution in eq 19 but instead must be estimated using an iterative search and or optimization method furthermore we should not expect eqs 29 and 30 to provide an exact description of the 100 γ confidence intervals of the parameters and simulated output next we illustrate the application of the bootstrap method to nonlinear regression 3 2 2 application a hydrologic toy model our second case study considers a simple 3 parameter hydrologic model comprised of two linear reservoirs organized in parallel see fig 2 this model has two state variables s f and s s with units of mm and three parameters the unitless rainfall distribution coefficient d 0 1 and the recession constants k s and k f of the slow and fast reservoirs respectively with dimensions of reciprocal day we set d 0 65 k s 0 035 and k f 0 7 and create a 5 year simulation of daily discharge y y 1 y 2 y n in mm day via an analytic solution using as model input a hypothetical record of daily rainfall data each entry of the discharge simulation is subsequently perturbed with a heteroscedastic measurement error d n n 0 σ to yield y t y t t the n n measurement error covariance matrix σ c v where c 0 01 and the n n matrix v has zeros everywhere except for the main diagonal which lists the squared values of the n simulated discharges this amounts to a heteroscedastic measurement error with standard deviation equal to 10 of the simulated discharge we would now like to use the measured data y y 1 y 2 y n to determine the confidence regions of the parameters as the model does not have valid basis functions we cannot write the model in matrix form and must use an optimization method to minimize the gls objective function in eq 17 we assume perfect knowledge of the measurement errors thus admit σ to our analysis fig 3 top panel presents the results of the bootstrap method using repeated minimization of the gls objective function in eq 17 for replicate samples y r d n n y σ of the measured discharge record the gray tints of the bootstrap samples differ based on their confidence levels including γ 0 5 light gray γ 0 90 light medium gray γ 0 95 medium gray and γ 0 99 dark gray the red cross in each graph indicates the gls optimum the bottom panel serves as our benchmark and presents scatter plots of the bivariate samples of the posterior distribution derived from the dream algorithm vrugt et al 2009 in keeping with the gls assumptions we must specify a uniform prior parameter distribution in connection with the likelihood function of eq c4 in appendix c with σ 2 0 01 the bivariate confidence regions of the parameter pairs appear symmetric around their optimum value with sampling density that decreases away from the center of the point clouds the confidence regions are well described by ellipses and their diagonal orientation suggests the presence of parameter correlation among d k s and k s this is all interesting yet most important is the nearly perfect match of the confidence regions of the bootstrap method and the dream algorithm this is not a surprise nevertheless an important demonstration to those unfamiliar with the bootstrap method and its applicability to uncertainty quantification it needs no further demonstration that the confidence intervals of both methods are a perfect match we are now ready to pair the bootstrap method with the kg efficiency but before doing so we first would like to provide some general remarks about the limitations of the bootstrap method the bootstrap method provides a powerful alternative to arguably more beautiful and cpu friendly analytic procedures thus is a wonderful addition to the hydrologists arsenal of statistical inference methods yet the apparent simplicity of bootstrapping may fool users into thinking that no important assumptions are being made in its application these assumptions relate to the independence of the samples and the sample size certainly bootstrapping is not recommended for small training records comprised of only a few observations then the resampled records may not be representative of the underlying data generating process and this will corrupt the standard errors and or confidence intervals of the variables of interest furthermore our experience suggests that it is not particularly easy to preserve higher order moments skew and or kurtosis of the training data record and or characterize well the periodicity and persistence of dynamic systems these are known problems with resampling in general and different implementations of the bootstrap method may be found in the literature to minimize bias and estimation errors furthermore the large computational requirements of the bootstrap method complicate its application to highly parameterized and or cpu intensive models 3 3 diagnostic regression the bootstrap method serves as principal foundation of our methodology for constructing confidence regions and or intervals of informal goodness of fit metrics in regression analysis this includes metrics such as the nse and kg efficiency and hydrologic signatures within the context of model diagnostics we coin this field diagnostic regression not to be confused with regression diagnostics which equal procedures and techniques designed to verify statistical assumptions and model validity in linear regression everitt and skrondal 2010 such diagnostic checks are also used in bayesian inference to ascertain that the residuals satisfy assumptions made by the likelihood function schoups and vrugt 2010 thus in diagnostic regression we model the relationship between dependent and independent variables through application of informal goodness of fit metrics and present empirical estimates of the confidence and or prediction limits of variables of interest this adds a new member to the large family of commonly used regression techniques such as lasso logistic ordinal polynomial ridge support vector stepwise and quantile regression and offers a common creative license and receptacle for the growing collection of heuristic and or applied model data synthesis methods before we move on to the application of diagnostic regression we provide one general remark we use the wording empirical confidence intervals to emphasize the heuristic nature of the confidence intervals obtained from diagnostic regression with metrics such as the kg efficiency in principle one could use the label empirical to characterize any sampling based estimates of the confidence regions and or intervals but the so obtained estimates of the confidence and prediction intervals from the dream algorithm are an approximation of the true uncertainty as defined by the residual assumptions 3 3 1 application linear function we revisit our first case study of section 3 1 and use the kg efficiency to determine the optimal values of the slope a and intercept b and their empirical confidence regions and intervals bootstrapping involves repeated maximization of the kg efficiency of eq 14 for many different realizations of the training data record fig 4 presents the confidence regions derived from a the analytic expression of eq 27 and b the bootstrap method using the kg efficiency the left graph is a copy of fig 1a and is used for benchmark purposes we observe a close match in the optimum value θ of the slope and intercept derived from diagnostic regression with the kg efficiency red cross and the least squares solution θ of eq 19 furthermore the bivariate confidence regions of the kg efficiency show a strong resemblance with their exact least squares counterparts of eq 27 the confidence regions of the kg efficiency center on the optimum a b values θ and appear well described by ellipses the major and minor axes of the ellipses of the kg efficiency match quite closely those derived from the information matrix i θ of the gls confidence regions but exhibit an enlarged angle from the horizontal slope axis furthermore the ellipses that make up the 95 and 99 confidence regions of a and b appear discontinuous in the area immediately above and below the optimum kg solution red cross indeed at these critical levels the bootstrap samples provide only a somewhat spotty characterization of the bivariate parameter uncertainty it is not particularly clear what causes this apparent deficiency certainly we used a large enough sample size we do not apply the kg efficiency to our hydrologic toy model of the second case study but rather focus our attention on a more complex watershed model using measured streamflow data instead 3 3 2 application a conceptual watershed model our third and last study illustrates the application of diagnostic regression with the kg efficiency to the hmodel a parsimonious conceptual watershed model originally developed by schoups et al 2010 we estimate the hmodel parameters and their respective confidence intervals using 14 year long records oct 1 1994 sept 30 2008 of daily discharge data from the a leaf river near collins ms usgs 02472000 and b kinchafoonee creek near dawson ga usgs 02350900 these two medium sized watersheds exhibit a strong and weak winter regime respectively according to the functional classification of brunner et al 2020 the hmodel transforms rainfall into runoff at the watershed outlet using an interception unsaturated zone fast and slow flow reservoir respectively which simulate interception throughfall evaporation surface runoff percolation fast streamflow and baseflow see fig 5 the hmodel structure processes control input and numerical solution have been discussed by schoups et al 2010 and interested readers are referred to this publication for further details table 1 lists the seven hmodel parameters and their corresponding symbols units and upper and lower bounds we discard the first five years of the discharge records in our computation of the kg efficiency to reduce sensitivity to state variable initialization the empirical description of the uncertainty of the kg efficiency with the bootstrap method requires many different replicates of the measured discharge records of the leaf river and kinchafoonee creek these replicates should characterize streamflow measurement uncertainty and preserve the statistical properties e g streamflow moments and temporal structure persistence and hydrologic characteristics e g catchment summary metrics of the measured discharge record the model free duplication method of oliveira and vrugt 2022 satisfies these requirements and thus serves our purpose a brief description of this method is given below interested readers are referred to oliveira and vrugt 2022 for further details per eq 16 the entries of the discharge measurement vector may be written as follows 32 y h t where h t is the data generating process of the true streamflow at time t n and the measurement errors 1 2 n d n n 0 σ are variates drawn from a n variate normal distribution with zero mean and n n measurement error covariance matrix σ 33 σ e σ 1 2 r y 1 σ 1 σ 2 r y n 1 σ 1 σ n r y 1 σ 2 σ 1 σ 2 2 r y n 2 σ 2 σ n r y n 1 σ n σ 1 r y n 2 σ n σ 2 σ n 2 1 r y 1 r y n 1 r y 1 1 r y n 2 r y n 1 r y n 2 1 σ 1 σ 2 σ n σ 1 σ 2 σ n r y σ σ where r y denotes the n n correlation matrix of the measurement errors r y τ is the correlation function of the measurement errors σ σ 1 σ 2 σ n signifies the n vector of measurement error standard deviations is the hadamard or schur product and τ 1 2 n the correlation matrix r y can be derived from the sample autocorrelation function acf of the measured discharge data y y 1 y 2 y n the sample autocorrelation r y τ for two streamflow observations y i and y j a distance time τ i j apart may be computed using 34 r y τ cov y i y j var y i i τ 1 n y i m y y i τ m y i τ 1 n y i m y 2 where m y 1 n t 1 n y t mm d denotes the mean of the n record of streamflow observations the entries of the n 1 vector of measurement error variances σ 2 are computed from hourly discharge observations using the procedure described in oliveira and vrugt 2022 specifically the t th entry s t 2 of s 2 is computed as follows oliveira and vrugt 2022 35 s t 2 1 m 1 m 1 i 1 m y i h 1 m j 1 m y j h 2 1 m 1 m i 1 m a h y i h b h 2 where the y i h s mm d are the m 24 hourly discharge observations i 1 2 m of the t th day of the daily streamflow record y and the coefficients a h and b h mm d signify the slope and intercept of the hourly discharge measurement error function respectively this linear function turns the hourly discharge measurements into estimates of the measurement error standard deviation and is derived from nonparametric differencing using the estimator of vrugt et al 2005 eq 35 can be rewritten as follows 36 s t 2 1 m s y h 2 1 m 2 i 1 m s h 2 where the first term s y h 2 mm 2 d 2 measures the spread of the hourly discharge observations measurement uncertainty and the second term 1 m s h 2 mm 2 d 2 accounts for their respective measurement error variances replicate discharge records y r y are now created by perturbing the measured streamflow time series y with measurement errors drawn from the n variate normal distribution d n n 0 σ with zero mean and covariance matrix σ of eq 33 to do so efficiently we write instead y r y lν where ν ℝ n is a n 1 vector of independent standard normal variates and the n n lower triangular matrix l is derived from cholesky decomposition of the symmetric positive definite matrix σ ll prior to computation of the correlation matrix r y the discharge measurements are replaced by their respective variates of a standard normal distribution this transformation promotes hydrologic characterization by suppressing sudden bumps and discharge fluctuations during long recession periods note that if σ is written as product of a constant σ 2 and a n n matrix v then l σ 2 chol v the use of the discharge sample acf in the measurement error covariance matrix σ introduces serial correlation among the t s this is a necessary means to preserving the smoothness statistical and hydrologic properties of the measured discharge record oliveira and vrugt 2022 the autocorrelation avoids overly bumpy replicate records that result from the use of the measured discharge time series rather than the underlying data generating process in eq 32 fig 6 presents histograms of a representative group of five hmodel parameters a s max b q max c α f d k f and e k s derived from the bootstrap method using the n 1 000 replicates of the measured daily discharge records of the leaf river top panel and kinchafoonee creek bottom panel for each replicate record we optimized the seven hmodel parameters by maximization of the kg efficiency using the shuffled complex evolution sce ua algorithm of duan et al 1992 the marginal distributions summarize the effect of the discharge measurement errors on the inferred hmodel parameter values the modes of the histograms coincide quite well with their optimized values θ of the measured discharge records red crosses the frequency distributions of the hmodel parameters appear well defined by calibration against the kg efficiency the parameters exhibit a relatively small dispersion appear symmetric around their mean and are well described by a gaussian distribution exceptions to this are the histograms of parameters i max fig 3a1 which is truncated by its upper bound and k s fig 3e2 which has a positive skew and thus tail to the right as a result the marginal distributions of these two parameters do not center on their values derived from the measured discharge record but are found at the upper and lower end of their distribution this deviation from normality may become more common for catchments from other hydrologic regimes for example with snow melt or extended dry periods next fig 7 presents the marginal distribution of the kg efficiency obtained from evaluating the optimized hmodel parameters of the thousand replicate records for the measured discharge data of the a leaf river top panel and b kinchafoonee creek the optimized kg values of the measured discharge data records are separately indicated with a blue cross as the kg efficiency is a metric that has to be maximized its frequency distribution is truncated at the upper bound by its maximized value for the measured discharge record and the probability mass of the bootstrap samples is dispersed in a tail to the left quite remarkably the 50 90 95 and 99 percentiles of the distributions of the kg efficiency have a similar distance to the maximum kg efficiency this amounts to 0 0032 0 0018 0 0013 and 0 005 respectively listed in order of the critical values this finding may support a more formal probabilistic description of the kg efficiency in a fashion similar to the tolerable increments for the gls estimator discussed in appendix c indeed for the gls estimator the tolerable increment follows an inverse chi square cumulative distribution function with p degrees of freedom hence δ gls γ f χ 2 1 p γ p where p γ γ thus the tolerable increment of the gls only depends on parameter dimensionality not on data length and the nature of the measurement errors residuals we have investigated this thread for the kg efficiency with the linear regression function of section 3 1 using different lengths of the training data record and homoscedastic heteroscedastic and or correlated measurement errors our preliminary results not shown have demonstrated that the tolerable reduction of the kg efficiency δ kg depends on the magnitude and nature of the measurement errors in other words the kg efficiency does not admit a simple probabilistic description of its confidence regions and or intervals this leaves as our only option the bootstrap method using replicates of the discharge record to provide insights into the bootstrap samples please consider fig 8 which presents bivariate scatter plots of a i max s max b α f s max c k f s max and d k s s max using the replicates of the discharge record of the leaf river top panel and kinchafoonee creek bottom panel watersheds the red crosses portray the optimal values of the hmodel parameters θ using diagnostic regression for the measured discharge records the bootstrap samples are coded in different gray tints based on their confidence levels γ 0 5 light gray γ 0 90 light medium gray γ 0 95 medium gray and γ 0 99 dark gray the bootstrap samples populate only a small part of the prior parameter space the dotty plots are well described by concentric circles and or elongated ellipses which center on the midpoint of the dotty plots and envelope the optimum solution red cross of the hmodel parameters the exception to this is the a1 i max s max parameter pair whose bivariate distribution cloud is truncated by the upper bound of i max the density of the points decreases away from the midpoint of the point cloud we do not witness any mutual relationships between the pairs of plotted parameters with exception of the b2 α f s max and c1 k f s max parameter pairs which exhibit a positive linear correlation the bivariate confidence regions of the hmodel parameters are sharply delineated for the leaf river data record and organized in long elongated ellipses around the midpoint of the bootstrap samples for the kinchafoonee creek on the contrary the boundaries of the joint parameter confidence regions of the hmodel parameters are poorly defined the confidence regions mix and overlap an effect that is particularly visible towards the outer perimeter of the point clouds of the hmodel parameters pairs this mixing of the confidence regions is a result of the projection of the p 7 dimensional parameter space onto only two axes this geometric simplification destroys the underlying multivariate surface of the kg efficiency and this distorted organization may therefore lead to a mixing of the confidence regions the reason so as to why the leaf river watershed does not suffer this protrusion conveys important information about the geometry of the kg confidence regions in the full parameter space in short the confidence regions can only increase or decrease monotonically with each marginalized unplotted parameter axes for the spatial organization of the confidence regions to be preserved in the two dimensional projections in the top panel the p variate confidence regions for the kinchafoonee creek violate the monotonicity requirement for at least one of the marginalized parameter axes and as a result the projection introduces mixing so evidently present in the two dimensional snapshots in the bottom panel of course this mixing will not affect the confidence intervals of the hmodel parameters finally we must verify the accuracy and or precision of the kg calibrated hmodel by comparison against the measured discharge record fig 9 presents a time series plot of measured red dots and hmodel simulated discharge for the leaf river watershed using a representative 8 month portion of the historical record as the kinchafoonee creek presents similar findings we do not visualize these results the light red area displays the 99 discharge measurement uncertainty whereas the gray region corresponds to 99 hmodel simulation uncertainty associated with the kg efficiency we do not display the streamflow simulation of the optimal hmodel parameters θ of the measured discharge record of the leaf river this simulation is contained within the 99 confidence limits of the simulated discharge mostly at the center of the gray interval the hmodel tracks the measured discharge data reasonably well although a positive bias is observed in the first 50 days of the 7 month period between the middle end of november and middle of december 2004 this initial overshoot of the measured discharge data is rectified during subsequent storm events demonstrating an increasingly better match between the simulated and measured hydrographs certainly the baseflow is rather poorly described by the hmodel in the 242 day window this deficiency is particularly visible in the long recession period at the end of the 7 month record the large model data mismatch so visible in the early part of the record may point at an exaggerated state of the hmodel s four control volumes in the period leading up to the storm event in november 2004 measurement errors of the antecedant basin average rainfall may have corrupted the state variables of the hmodel one has to be careful however in attributing this early mismatch to precipitation errors as performance metrics other than the kg efficiency may improve the overall compliance between the hmodel and the measured discharge data this then would have an immediate effect on the simulated state of the leaf river basin preceding the storm event in nov 2004 if so desired data assimilation may be used to refine the simulated state variables and remove excess water from the control volumes if the measured discharge data dictate doing so improves model data compliance the 99 confidence intervals of the simulated hydrograph gray region are smallest on average at the end of a long recession period and reach a maximum width at peak discharge this dependence of the width of the hmodel discharge confidence intervals on simulated flow level is a result of the heteroscedastic nature of the discharge measurement errors as evidenced by the measured streamflow record using nonparametric differencing vrugt et al 2005 oliveira and vrugt 2022 the 99 confidence intervals of the hmodel simulated streamflows exceed the discharge measurement uncertainty red region but appear rather small compared to the residuals of the optimal hmodel parameters θ indeed the gray region makes up only a small part of the distance between the measured and simulated discharge records this small width is commensurate with a poor coverage of the discharge confidence intervals of the kg efficiency only a handful of streamflow observations contained within the gray region this is why it is common practice in the context of generalized least squares to use the sample variance of the residuals see eq 24 in the computation of the 100 γ confidence intervals of the gls parameters θ and simulated output y in eqs 29 and 30 we can follow a similar approach in diagnostic regression and use the residuals of the optimal hmodel parameters θ in our computation of the empirical confidence intervals of the kg efficiency this requires only a minor change to the implementation of the bootstrap method we must replace our probabilistic description of the measurement errors of the training data record with an analogous description of the model residuals of the maximized kg efficiency of the measured training data record inevitably this will substantially enhance hmodel parameter and simulation uncertainty the formulation of the n variate residual distribution is relatively simple for well behaved residuals with known marginal distribution constant variance and or structure that satisfies a simple autoregressive scheme but skewed and or lepto or platykurtic residuals with a nonconstant variance bias and or an unusual structure persistence and or state dependence do not necessarily admit a convenient probabilistic description this limits our ability to draw accurate replicates of the training data record and complicates uncertainty quantification of model parameter and simulation uncertainty with the bootstrap method in diagnostic regression with the kg efficiency the generalized plus and universal likelihood functions of vrugt et al 2022 will help in distilling a convenient probabilistic description of time series of ideal and non ideal residuals but this does not guarantee a perfect characterization the time series plot in fig 9 certainly makes clear that the discharge residuals exhibit a changing bias and correlation structure with flow level but as the kg efficiency is an informal goodness of fit metric we cannot unify the actual residual characteristics with prior assumptions made about their probabilistic properties nevertheless fig 10 analyzes the a magnitude b distribution and c acf of the streamflow residuals of the calibrated hmodel with maximum kg efficiency the residuals increase with magnitude of the simulated discharge in a manner that is expected from the knowledge of the measurement errors the empirical distribution of the discharge residuals appears symmetric is centered about zero and is much peakier than the normal distribution lastly the residuals exhibit considerable serial correlation at the first few lags this is expected given the systematic over and or underprediction so evidently present at high and low flows respectively in the time series plot these findings warrant treatment of residual serial correlation and heteroscedasticity for example through the use of generalized least squares alternatively we can resort to bayesian analysis specify a generalized likelihood function schoups and vrugt 2010 and infer the matrix v along with σ 2 simultaneously with the hmodel parameters using mcmc simulation with the dream algorithm this approach lets the data speak for itself and provides samples from the posterior distribution which can be presented as confidence regions 4 conclusions informal quality of fit measures such as the kg efficiency are not borne out of testable hypotheses with respect to the probabilistic properties of the residuals this has profound consequences we cannot verify a posteriori whether assumptions of the kg estimator have been satisfied and more importantly from the perspective of this paper the uncertainty of the kg efficiency is not defined this begs the question how we should compute confidence and prediction limits on current and or future model responses if we do not know which marginal distribution to expect of the residuals of the kg efficiency to move beyond the status quo this paper has presented a simple framework for determining empirical confidence intervals of the kg efficiency our method relates the distribution of the kg efficiency to the measurement errors of the calibration data parameter and simulation uncertainty may then be quantified with the bootstrap method using replicates of the data record the first two case studies served as demonstration of the bootstrap method for statistical inference of parameter uncertainty to those unfamiliar with this methodology we showed that the bootstrap method yields the exact same parameter confidence regions and intervals as generalized least squares within the context of linear regression and bayesian analysis coupled with mcmc simulation within the context of nonlinear regression after this proof of concept we turned our attention to the kg efficiency and used this informal goodness of fit metric within the context of diagnostic regression to determine optimal parameter values and their associated uncertainty of a simple linear regression function with slope and intercept and the 7 parameter hmodel of schoups et al 2010 using measured discharge data of two contrasting watersheds the empirical confidence regions and intervals of the slope and intercept derived from diagnostic regression using the kg efficiency were in close agreement with their exact counterparts obtained from generalized least squares the ellipses of the kg efficiency exhibited an enlarged angle from the horizontal axis the application of diagnostic regression with the kg efficiency to the hmodel showed that its parameters were well described by a normal distribution with relatively small dispersion and or skew and possibly truncated by the prior distribution the modes of the marginal parameter distributions coincided quite well with their optimized values derived from the measured discharge records of the leaf river and kinchafoonee creek the distribution of the kg efficiency is a complex function of data length and the magnitude distribution and structure of the discharge measurement errors this prohibits a simple closed form description of the empirical confidence regions and or intervals of the kg efficiency defined herein this leaves as only option the bootstrap method to quantify model parameter and predictive uncertainty of the kg efficiency within the context of diagnostic regression data and software availability the data models and other software are available upon request from the corresponding author jasper uci edu and can be downloaded from https github com jaspervrugt kgefficiency credit authorship contribution statement jasper a vrugt conceptualization methodology software validation formal analysis investigation writing original draft writing review editing visualization supervision project administration debora y de oliveira software validation formal analysis data curation visualization declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgment we greatly appreciate the constructive comments of the ae and two reviewers that have led to an improved manuscript the first author acknowledges interactions with dr yan liu on the mathematical underpinning of the kg estimator the second author gratefully acknowledges the financial support received from the brazilian federal agency for support and evaluation of graduate education capes grant no 88881 174456 2018 01 the camels data set is described in newman 2015 and can be downloaded from https dx doi org 10 5065 d6mw2f4d the hourly streamflow data of gauch et al 2020 are available at https doi org 10 5281 zenodo 4072700 appendix a decomposition of the mean squared residual the original derivation of the mean squared residual msr by gupta et al 2009 assumes knowledge of the population variances of the n 1 records of measured y y 1 y 2 y n and simulated y y 1 y 2 y n data the msr is equal to a1 msr 1 n t 1 n y t y t θ 2 and may be decomposed in different terms as follows a2 msr 1 n t 1 n y t y t θ y t y t θ 1 n t 1 n y t 2 1 n t 1 n y t θ 2 2 n t 1 n y t y t θ we can now make use of the following well known identities to rewrite the above expression a3a i 1 n x i 2 n 1 s x 2 nm x 2 a3b i 1 n x i y i n 1 r xy s x s y nm x m y where m x is the mean of the n record of x values a4 m x 1 n i 1 n x i the variable s x 2 denotes its associated variance a5 s x 2 1 n 1 i 1 n x i m x 2 and r xy signifies the sample correlation coefficient of the x i y i data pairs i 1 2 n a6 r 1 n 1 i 1 n y i m y y i m y 1 n 1 i 1 n y i m y 2 1 n 1 i 1 n y i m y 2 if we substitute the identities of eqs a3a and a3b into eq a2 we yield a7 msr 1 n n 1 s y 2 nm y 2 1 n n 1 s y 2 nm y 2 2 n n 1 r y y s y s y nm y m y n 1 n s y 2 m y 2 n 1 n s y 2 m y 2 2 n 2 n r y y s y s y 2 m y m y n 1 n s y 2 s y 2 m y m y 2 2 n 2 n r y y s y s y now as a 2 b 2 a b 2 2 ab we can rewrite the first term to read a8 msr n 1 n s y s y 2 2 s y s y m y m y 2 2 n 2 n r y y s y s y n 1 n s y s y 2 m y m y 2 2 n 2 n s y s y 2 n 2 n r y y s y s y n 1 n s y s y 2 m y m y 2 2 n 2 n s y s y 1 r y y we can now reorganize the above expression and rearrange the terms in similar order as eq 7 to yield a9 msr 2 n 2 n s y s y 1 r y y n 1 n s y s y 2 m y m y 2 this concludes our derivation appendix b decomposition of the coefficient of determination according to eq 6 the coefficient of determination r 2 satisfies the following equality b1 r 2 1 n msr n 1 s y 2 nse where nse is the infamous nash sutcliffe efficiency we can reformulate the above expression by substituting for the mean squared residual msr eq a9 to yield b2 r 2 1 2 n 2 s y s y 1 r n 1 s y s y 2 n m y m y 2 n 1 s y 2 n 1 s y 2 2 n 2 s y s y 1 r n 1 s y s y 2 n m y m y 2 n 1 s y 2 n 1 s y 2 2 n 2 s y s y r 1 n 1 s y 2 s y 2 2 s y 2 s y n m y m y 2 n 1 s y 2 n 1 s y 2 2 n 2 s y s y r 1 n 1 s y 2 n 1 s y 2 2 n 1 s y 2 s y n m y m y 2 n 1 s y 2 2 n 2 s y s y r n 1 s y 2 n m y m y 2 n 1 s y 2 this leaves us with the following expression for the r 2 and thus nse b3 r 2 2 s y s y r s y s y 2 n n 1 m y m y s y 2 this concludes the derivation appendix c description of multivariate parameter uncertainty the confidence regions described by the expression in eq 27 can also be inferred by other means in this appendix we consider two other approaches besides the bootstrap method described in the main text the first of these alternative methods uses contouring of the gls objective function consider the gls objective function in eq 17 c1 f gls θ e θ σ 1 e θ which may also be written as follows c2 f gls θ we θ we θ ε θ ε θ where w σ 1 2 signifies the n n weight matrix and ε θ ε 1 θ ε 2 θ ε n θ denotes the n 1 vector of homogenized and or decorrelated residuals now we expect that if θ θ then the n squared entries of ε θ should on average have a value of unity as a result f gls θ should follow a chi square distribution with n p degrees of freedom hence f gls θ d χ n p 2 with expected value e ε θ ε θ n p any deviation of the parameters from θ will increase the value of f gls θ from its expected minimum of n p the larger this increment the lesser the support for the parameter values θ by the training data y the tolerable increment δ f gls from n p for a desired confidence level γ equals press et al 1992 c3 δ f gls γ f χ 2 1 p γ p where f χ 2 1 p γ p signifies the inverse of the chi square cumulative distribution function cdf with p degrees of freedom at the critical value p γ γ now we discretize the parameter space in uniform intervals and evaluate the objective function f gls θ at each grid point all points θ with f gls θ f gls θ δ f gls γ will make up the 100 γ confidence region of the parameters see fig 11 c as second approach we consider monte carlo simulation this approach necessitates the use of a prior distribution and a likelihood function to be commensurate with the gls objective function we must specify a uninformative prior distribution for the slope and intercept a and b and use the following formulation of the log likelihood function l θ σ 2 y v c4 l θ σ 2 y v n 2 log 2 π 1 2 log σ 2 v 1 2 e θ σ 2 v 1 e θ where signifies the determinant operator and σ 2 is the estimate of the population variance of the measurement errors to be comparable with our gls implementation we must infer its value jointly with those of the coefficients a and b of the linear regression function we use markov chain monte carlo simulation with the dream algorithm vrugt et al 2009 to determine the trivariate posterior distribution of θ a b and σ 2 fig 11d presents the bivariate distribution of the slope and intercept as expected not shown the marginal distribution of σ 2 follows a scaled chi square distribution with n p degrees of freedom see eq 25 
3155,the kling gupta efficiency 3 empirical description of uncertainty of the kling gupta efficiency 3 1 linear regression 3 1 1 theory 3 1 2 application linear function 3 2 nonlinear regression 3 2 1 theory 3 2 2 application a hydrologic toy model 3 3 diagnostic regression 3 3 1 application linear function 3 3 2 application a conceptual watershed model 4 conclusions data and software availability credit authorship contribution statement acknowledgment appendix a decomposition of the mean squared residual appendix b decomposition of the coefficient of determination appendix c description of multivariate parameter uncertainty aitken 1936 42 48 a ammann 2019 2147 2172 l anderson 1952 193 212 t barber 2019 87 101 c bates 2001 937 947 b beven 2006 18 36 k beven 1992 279 298 k beven 2001 11 29 k boyle 2000 3663 3674 d breusch 1978 334 355 t breusch 1979 1287 1294 t brunner 2020 3951 3966 m draper 1995 399 403 n draper 1998 n wileyseriesinprobabilitystatistics appliedregressionanalysis duan 1992 1015 1031 q durbin 1950 409 428 j durbin 1951 159 179 j efron 1979 1 26 b everitt 2010 b cambridgedictionarystatistics freer 1996 2161 2173 j gauch 2020 m goldfeld 1965 539 547 s gupta 1998 751 763 h gupta 2008 3802 3813 h gupta 2009 80 91 h kavetski 2006 d kavetski 2006 d knoben 2019 2463 2480 w kuczera 1983 1151 1162 g kuczera 1998 69 85 g lamontagne 2020 1 25 j murphy 1988 2417 2424 a nash 1970 282 290 j newman 2015 209 223 a pool 2018 1941 1953 s oliveira 2022 e2022wr032263 d rakovec 2019 13991 14007 o sadegh 2013 4831 4850 m scharnagl 2015 2155 2199 b schoups 2010 g schoups 2010 g schwemmle 2021 2187 2198 r shapiro 1965 591 611 s sorooshian 1980 430 442 s spear 1980 43 49 r spear 2020 1 16 r stedinger 1985 1421 1432 j tasker 1980 1107 1113 g vogel 1993 1745 1752 r vrugt 2018 954 971 j vrugt 2013 4335 4345 j vrugt 2002 j vrugt 2005 j vrugt 2006 288 307 j vrugt 2009 273 290 j westerberg 2011 2205 2227 i white 1980 817 838 h yilmaz 2008 k vrugtx2022x127968 vrugtx2022x127968xj full 2022 05 25t00 54 40z fundingbody university of california uc 2021 core hybrid http creativecommons org licenses by 4 0 2024 06 29t00 00 00 000z 2024 06 29t00 00 00 000z http creativecommons org licenses by nc nd 4 0 this is an open access article under the cc by license 2022 the author s published by elsevier b v 2022 07 07t03 07 45 220z http vtw elsevier com data voc addontypes 50 7 aggregated refined 0 item s0022 1694 22 00543 1 s0022169422005431 1 s2 0 s0022169422005431 10 1016 j jhydrol 2022 127968 271842 2023 04 04t04 21 47 375301z 2022 09 01 2022 09 30 unlimited cdlhyb21 1 s2 0 s0022169422005431 main pdf https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 main application pdf 1ba9a18e6a9616e03571e3f223a8a7a1 main pdf main pdf pdf true 4018911 main 18 1 s2 0 s0022169422005431 main 1 png https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 preview image png dfc081036b3ed6cd30b0e00a4fe97c54 main 1 png main 1 png png 56382 849 656 image web pdf 1 1 s2 0 s0022169422005431 gr2 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr2 downsampled image jpeg ae50a31a7df93c0655e9f59e98b9d987 gr2 jpg gr2 gr2 jpg jpg 14325 151 534 image downsampled 1 s2 0 s0022169422005431 gr1 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr1 downsampled image jpeg 78c171e67680058dd41f114424f195fb gr1 jpg gr1 gr1 jpg jpg 50556 258 551 image downsampled 1 s2 0 s0022169422005431 gr4 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr4 downsampled image jpeg 67fa76c41c855171b421660da59650ba gr4 jpg gr4 gr4 jpg jpg 52497 345 622 image downsampled 1 s2 0 s0022169422005431 gr3 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr3 downsampled image jpeg e941e9cb8dbd277a6790a58cdb283150 gr3 jpg gr3 gr3 jpg jpg 63931 270 570 image downsampled 1 s2 0 s0022169422005431 gr6 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr6 downsampled image jpeg 7154c42879f9620e07e7c6082adae63c gr6 jpg gr6 gr6 jpg jpg 45538 326 667 image downsampled 1 s2 0 s0022169422005431 gr5 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr5 downsampled image jpeg b4ba8999c973bf023e74bcffa7cedf7c gr5 jpg gr5 gr5 jpg jpg 16177 125 622 image downsampled 1 s2 0 s0022169422005431 gr8 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr8 downsampled image jpeg 87f64b6541fd96d41512c2d11ae6e844 gr8 jpg gr8 gr8 jpg jpg 53818 350 667 image downsampled 1 s2 0 s0022169422005431 gr7 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr7 downsampled image jpeg f50eec4c2fe440d97e31f924517504fc gr7 jpg gr7 gr7 jpg jpg 18505 257 511 image downsampled 1 s2 0 s0022169422005431 fx1 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 fx1 downsampled image jpeg 143139feb50856e488abd4b1e02fd168 fx1 jpg fx1 fx1 jpg jpg 5913 40 378 image downsampled 1 s2 0 s0022169422005431 gr9 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr9 downsampled image jpeg 557f38441c067cf5b309293ae4b43374 gr9 jpg gr9 gr9 jpg jpg 25543 198 578 image downsampled 1 s2 0 s0022169422005431 gr10 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr10 downsampled image jpeg 3b260c8b2e8f0c3055eb9bb3071eb195 gr10 jpg gr10 gr10 jpg jpg 29700 194 622 image downsampled 1 s2 0 s0022169422005431 gr11 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr11 downsampled image jpeg abecdc332defc1a91917b285619dd849 gr11 jpg gr11 gr11 jpg jpg 95512 542 667 image downsampled 1 s2 0 s0022169422005431 gr2 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr2 thumbnail image gif 8a47717547b6ea946bbe8dd8db0c2278 gr2 sml gr2 gr2 sml sml 2757 62 219 image thumbnail 1 s2 0 s0022169422005431 gr1 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr1 thumbnail image gif 31f205470bbc2bb37a1e77605d7a087f gr1 sml gr1 gr1 sml sml 9580 103 219 image thumbnail 1 s2 0 s0022169422005431 gr4 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr4 thumbnail image gif 8ebf854131292a06bf51008bda55949d gr4 sml gr4 gr4 sml sml 9181 121 219 image thumbnail 1 s2 0 s0022169422005431 gr3 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr3 thumbnail image gif 449542dc79217a446f0340798bd1b704 gr3 sml gr3 gr3 sml sml 11835 104 219 image thumbnail 1 s2 0 s0022169422005431 gr6 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr6 thumbnail image gif 9876553a84f53373039ed6d6d6c8f7a7 gr6 sml gr6 gr6 sml sml 5275 107 219 image thumbnail 1 s2 0 s0022169422005431 gr5 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr5 thumbnail image gif 0ecda20f2183c069210042ca287b29d7 gr5 sml gr5 gr5 sml sml 2547 44 219 image thumbnail 1 s2 0 s0022169422005431 gr8 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr8 thumbnail image gif 4867db51642cb35a69e61c779562c68e gr8 sml gr8 gr8 sml sml 7497 115 219 image thumbnail 1 s2 0 s0022169422005431 gr7 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr7 thumbnail image gif 2e8be1b89721f0e4090dabdbe66fa994 gr7 sml gr7 gr7 sml sml 4175 110 219 image thumbnail 1 s2 0 s0022169422005431 fx1 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 fx1 thumbnail image gif df0bbda314d372575d24993f8aa96e7e fx1 sml fx1 fx1 sml sml 2497 23 219 image thumbnail 1 s2 0 s0022169422005431 gr9 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr9 thumbnail image gif 9f6bf65f80ab2596e2075f31cb0f710e gr9 sml gr9 gr9 sml sml 4846 75 219 image thumbnail 1 s2 0 s0022169422005431 gr10 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr10 thumbnail image gif 781689b9b4ee089661451fa93acfcd2a gr10 sml gr10 gr10 sml sml 3446 68 219 image thumbnail 1 s2 0 s0022169422005431 gr11 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 gr11 thumbnail image gif 394c0dfdbb3211e90f32f5ab70764140 gr11 sml gr11 gr11 sml sml 12330 164 202 image thumbnail 1 s2 0 s0022169422005431 gr2 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 highres image jpeg 349ecbb86e8f99c4857b845081553c33 gr2 lrg jpg gr2 gr2 lrg jpg jpg 88626 668 2362 image high res 1 s2 0 s0022169422005431 gr1 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 highres image jpeg d5f333fca40878c8b4eeb5376bb7ae73 gr1 lrg jpg gr1 gr1 lrg jpg jpg 358752 1144 2441 image high res 1 s2 0 s0022169422005431 gr4 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 highres image jpeg ac7175f39a8a6f9d28c82b7a197df955 gr4 lrg jpg gr4 gr4 lrg jpg jpg 380706 1529 2756 image high res 1 s2 0 s0022169422005431 gr3 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 highres image jpeg 52d23b36cd9e75ef4314fd95d7c8e417 gr3 lrg jpg gr3 gr3 lrg jpg jpg 468216 1197 2526 image high res 1 s2 0 s0022169422005431 gr6 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 highres image jpeg b619fe9bdbe93bedd9e95e7eac2c111d gr6 lrg jpg gr6 gr6 lrg jpg jpg 259423 1445 2953 image high res 1 s2 0 s0022169422005431 gr5 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 highres image jpeg 4eede3af83ac352b3098b3b4264a7da0 gr5 lrg jpg gr5 gr5 lrg jpg jpg 106474 552 2756 image high res 1 s2 0 s0022169422005431 gr8 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 highres image jpeg 9f2629216685f123f4b02e04b560081f gr8 lrg jpg gr8 gr8 lrg jpg jpg 353683 1551 2953 image high res 1 s2 0 s0022169422005431 gr7 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 highres image jpeg 01fbaf785d922b83d458caebda76ebf1 gr7 lrg jpg gr7 gr7 lrg jpg jpg 116909 1139 2264 image high res 1 s2 0 s0022169422005431 fx1 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 highres image jpeg 220d52d610d13925e82316a9e6ff1528 fx1 lrg jpg fx1 fx1 lrg jpg jpg 44951 178 1673 image high res 1 s2 0 s0022169422005431 gr9 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 highres image jpeg f9ff67b12da7036781b8edf4b6ffd6d6 gr9 lrg jpg gr9 gr9 lrg jpg jpg 180979 878 2559 image high res 1 s2 0 s0022169422005431 gr10 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 highres image jpeg a62a7da74344681b40e37acdfb46a106 gr10 lrg jpg gr10 gr10 lrg jpg jpg 176648 860 2756 image high res 1 s2 0 s0022169422005431 gr11 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169422005431 highres image jpeg d8378885674d36209ac46f461be620a4 gr11 lrg jpg gr11 gr11 lrg jpg jpg 705399 2401 2953 image high res 1 s2 0 s0022169422005431 am pdf am am pdf pdf 355331 aam pdf https s3 eu west 1 amazonaws com prod ucs content store eu west content egi 105vq8w33j9 main application pdf adfd5a9684e1a9b8c59788a65e9e84be am pdf hydrol 127968 127968 s0022 1694 22 00543 1 10 1016 j jhydrol 2022 127968 the author s fig 1 illustrative example of parameter confidence regions and confidence intervals a contour plot of the generalized least squares objective function of eq 17 for a linear regression function f θ t at b using 0 97 a 1 025 and 1 30 b 2 60 the contour lines are labeled and coded using a copper colormap the bivariate 100 γ confidence regions of the slope a and intercept b defined by eq 27 are displayed with a gray color scheme using γ 0 50 γ 0 90 γ 0 95 and γ 0 99 respectively the dashed blue lines display the univariate 95 confidence intervals of the slope and intercept computed from eq 29 b bivariate scatter plot of the n 10 000 optimized values of a and b derived from the bootstrap method the color of the dots signifies the confidence level derived from the bootstrap samples the dashed blue lines portray the univariate 95 intervals of a and b the red cross highlights the minimum of the gls objective function fig 2 schematic illustration of the three parameter hydrologic model grey boxes labeled in red correspond to fictitious control volumes which control the transformation of rainfall into river discharge arrows portray the fluxes into and out of the compartments including daily precipitation p t the inflows 1 d p t and dp t to the fast and slow reservoirs in mm d and the fast q f and slow q s reservoir s contribution to the discharge this simple model admits an analytic solution for the simulated discharge fig 3 bivariate scatter plots of the parameter pairs of the three parameter hydrologic model a d k f b k f k s and c k s d using the bootstrap method top panel and dream algorithm bottom panel the samples are color coded to reveal their respective confidence levels γ 0 5 light gray γ 0 90 light medium gray γ 0 95 medium gray and γ 0 99 dark gray the optimum parameter values are separately indicated in each graph with a red cross fig 4 visualization of the bivariate confidence region of the slope a and intercept b of the linear regression function f θ t at b for a the gls objective function using eq 27 and b the kg efficiency with the bootstrap method the confidence regions are coded with a gray color scheme using γ 0 50 γ 0 90 γ 0 95 and γ 0 99 respectively the dashed blue lines depict the univariate 95 confidence intervals of the slope and intercept derived from a eq 29 and b the percentiles of the bootstrap samples the red cross corresponds to a the minimum of the gls objective function and b the maximum of the kg efficiency fig 5 schematic illustration of the hmodel after schoups et al 2010 grey boxes labeled in red correspond to fictitious control volumes of the watershed which govern the rainfall runoff transformation arrows portray the fluxes into and out of the compartments including precipitation p t interception evaporation e i surface runoff q runoff and percolation q perc the four state variables are simulated using a mass conservative second order integration method with adaptive time step fig 6 histograms of the optimized hmodel parameters for the thousand replicates of the leaf river top panel and kinchafoonee creek bottom panel watersheds including a s max mm b q max mm c α f d k f and e k s the relative frequencies on the y axis are normalized to yield a common empirical density between 0 and 1 for all parameters the red crosses correspond to the optimized hmodel parameter values θ of the measured discharge records fig 7 histogram of the kg efficiency derived from repeated optimization of the hmodel parameters using the replicates of the discharge record of the a leaf river and b kinchafoonee creek the maximized kg efficiencies of the measured discharge data are separately indicated with a red cross fig 8 bivariate scatter plots of selected parameter pairs including a i max s max b α f s max c k f s max and d k s s max for the leaf river top panel and kinchafoonee creek bottom panel watersheds the confidence regions are coded with a gray color scheme using γ 0 50 light γ 0 90 light medium γ 0 95 medium and γ 0 99 dark respectively the red crosses signify the hmodel parameter values that maximize the kg efficiency of the measured discharge records fig 9 observed red dots and 99 hmodel simulated gray region daily discharge time series for a seven month period between nov 1 2004 and june 30 2005 of the discharge record of the leaf river basin the light red region corresponds to the 99 intervals of the discharge measurement errors fig 10 diagnostic analysis of the streamflow residuals of the calibrated hmodel using the kg efficiency a residuals as a function of simulated discharge b histogram of residuals c acf with 95 significance levels dotted red lines fig 11 confidence regions gray tints and 95 confidence intervals dashed blue lines for a linear regression function f θ t at b with homoscedastic measurement errors and 0 97 a 1 025 and 1 30 b 2 60 a generalized least squares using the analytic expressions of eqs 27 and 29 b resampling of the training data record with the bootstrap method c contouring of the gls objective function using the tolerable increment of eq c3 and d bayesian inference with the dream algorithm using a uniform prior for the slope a and intercept b and likelihood function of eq c4 the bivariate 100 γ confidence regions of the slope a and intercept b are displayed with a gray color scheme using γ 0 50 light gray γ 0 90 light medium gray γ 0 95 medium gray and γ 0 99 dark gray respectively the top left graph includes contour lines of the gls objective function in eq c1 the red cross highlights the minimum of the gls objective function table 1 description of the hmodel parameters including their symbols units lower and upper bounds parameter symbol units min max maximum interception i max mm 0 10 soil water storage capacity s max mm 10 1000 maximum percolation rate q max mm d 0 100 evaporation parameter α e 0 100 runoff parameter α f 10 10 time constant fast reservoir k f d 0 10 time constant slow reservoir k s d 0 500 research papers confidence intervals of the kling gupta efficiency jasper a vrugt conceptualization methodology software validation formal analysis investigation writing original draft writing review editing visualization supervision project administration debora y de oliveira software validation formal analysis data curation visualization department of civil and environmental engineering university of california irvine california usa department of civil and environmental engineering university of california irvine california usa department of civil and environmental engineering university of california irvine california usa corresponding author this manuscript was handled by andras bardossy editor in chief the kling gupta efficiency hereafter referred to as kg efficiency rather than its common abbreviation kge proposed by gupta et al 2009 has become a widely used metric for evaluating the goodness of fit of n vectors of observations y y 1 y 2 y n and corresponding model simulations y θ y 1 θ y 2 θ y n θ this metric rectifies some of the shortcomings of the coefficient of determination r 2 also known to hydrologists as the efficiency of nash and sutcliffe 1970 by using a euclidean distance based weighting of the correlation bias and temporal variability of the observed y and simulated y θ data but as the kg efficiency is not borne out of assumptions with respect to the statistical distribution of the residuals e θ y y θ we cannot formally characterize its uncertainty the ns efficiency suffers a similar problem yet statistical theory postulates that its confidence intervals should follow a beta distribution in certain special cases without a formal description of the confidence intervals of the kg efficiency we cannot amongst others quantify parameter uncertainty compute confidence and prediction limits on simulated model responses inform decision makers about critical modeling uncertainties evaluate model adequacy and assess the information content of calibration data more fundamentally without confidence intervals we cannot establish whether the kg efficiency is a consistent efficient and unbiased estimator in this paper we present an empirical description of the confidence intervals of the kg efficiency we relate the unknown probability distribution of the kg efficiency to the measurement errors of the training data record y and use the bootstrap method to carry out statistical inference we illustrate our method by application to a simple linear regression function for which the least squares parameter confidence regions are exactly known and two hydrologic models of contrasting complexity the empirical parameter confidence regions and or intervals of the kg efficiency are compared to those derived from generalized least squares objective function contouring and bayesian analysis using markov chain monte carlo simulation the marginal parameter distributions of the kg efficiency are generally well described by a normal distribution results further confirm that the distribution of the kg efficiency is a complex function of data length and the magnitude distribution and structure of the measurement errors this prohibits an analytic description of the empirical confidence regions and or intervals of the kg efficiency and reiterates the need for the bootstrap method keywords kling gupta efficiency nash sutcliffe efficiency confidence intervals bootstrap method bayesian analysis marginal distribution 1 introduction and scope consider a dynamic system model m θ x ℝ d ℝ n which simulates a n record y y 1 y 2 y n of a single output variable for a d vector of parameter values θ θ 1 θ 2 θ d with θ ℝ p and array x of constants and input variables required under the supposition or hypothesis that they govern by causality using physical laws of nature e g mathematical function s the simulated output the array x may characterize the system s initial state and or invariant distributed properties and document the evolution of its spatiotemporal control inputs forcing explanatory variables but is of no particular interest here therefore we suppress use of this symbol and write instead y m θ for the vector valued form of the model with respect to θ a key task is now to determine suitable values of the parameters θ so that the model output y approximates as closely and consistently as possible the observed system behavior y y 1 y 2 y n we may now write y m θ where 1 2 n signifies a n 1 vector of measurement errors the common paradigm in the statistical literature is to hypothesize a measurement error distribution p n of the data y and exploit this assumption in the construction of an objective function f θ for example if the measurement errors satisfy the so called gauss markov assumptions and i have a zero mean e i 0 ii constant variance var i σ 2 for all i n and iii are uncorrelated cov i j 0 for all i j then minimization of the well known sum of squared residuals 1 f ssr θ i 1 n y i y t θ 2 will lead to minimum variance estimates of the parameters θ the ssr is strictly positive meaning that f ssr θ 0 for θ ℝ p possibly with exception of one or more points at which f ssr θ 0 as complex systems do not admit a perfect characterization the residuals between model and data e i θ y i y i θ for all i 1 2 n will on average be substantially larger than the data measurement errors i gupta et al 1998 beven and binley 1992 beven 2006 kavetski et al 2006 vrugt and beven 2018 nonetheless the residuals are expected to absorb the consequences of model misspecification an inadequate characterization of the system properties and errors in the forcing explanatory variables and initial states and behave statistically in a similar way as the measurement errors in this paper we distinguish between formal and informal measures of the goodness of fit to clarify this terminology formal measures of the goodness of fit such as the f ssr θ are the result of the rigorous application of statistical theory and demand explicit and testable assumptions about the probabilistic properties of the residuals these hypotheses can be verified aposteriori using regression diagnostics this involves the use of statistical tests for i variance homogeneity goldfeld and quandt 1965 breusch and pagan 1979 white 1980 ii serial correlation durbin and watson 1950 durbin and watson 1951 breusch 1978 and iii normality anderson and darling 1952 shapiro and wilk 1965 of the residuals these diagnostic checks provide guidance on further stages of model development hence constitute an important advantage of the use of formal goodness of fit measures informal measures of the goodness of fit on the contrary do not make assumptions about the expected structure and or distribution of the residuals examples include the coefficient of determination r 2 better known to hydrologists as the nash sutcliffe ns efficiency nash and sutcliffe 1970 and the kling gupta kg efficiency gupta et al 2009 the use of these metrics has profound consequences the most important of which for this paper is that the lack of clarity in the assumptions about the expected distribution of the residuals prohibits an objective characterization of the confidence and prediction intervals of the parameters and simulated output in the past decades a large number of goodness of fit measures have been used to fit hydrologic models to data this includes the use of a formal objective and or likelihood functions that result from the application of first principles with respect to the statistical properties of the residuals such as the ssr in eq 1 and weighted formulations thereof with without treatment of serial correlation and or heteroscedasticity within the context of weighted and or generalized least squares tasker 1980 stedinger and tasker 1985 kavetski et al 2006 kavetski et al 2006 b equivalent likelihood functions sorooshian and dracup 1980 kuczera 1983 bates and campbell 2001 possibly augmented with skew and or kurtosis schoups and vrugt 2010 scharnagl et al 2015 ammann et al 2019 within the context of maximum likelihood estimation and bayesian inference c informal metrics of fit such as the ns nash and sutcliffe 1970 kg gupta et al 2009 knoben et al 2019 and diagnostic schwemmle et al 2021 efficiencies and possible nonparametric variants pool et al 2018 and other improvements lamontagne et al 2020 within the context of model calibration and or evaluation d pseudo likelihood functions within the context of the glue methodology beven and binley 1992 freer et al 1996 beven and freer 2001 e informal statistical measures of the quality of fit such as the coefficient of determination and percentage bias within the context of multiple criteria methods gupta et al 1998 boyle et al 2000 f hydrologic signatures within the context of model diagnostics gupta et al 2008 yilmaz et al 2008 westerberg et al 2011 g summary metrics within the context of approximate bayesian computation vrugt and sadegh 2013 sadegh and vrugt 2013 and h tolerable ranges within the context of limits of acceptability beven 2006 vrugt and beven 2018 regional sensitivity analysis spear and hornberger 1980 spear et al 2020 and the parameter identification method based on the localization of information vrugt et al 2002 this arrangement in groups should not imply that certain goodness of fit metrics are only used within a particular context for example the kg efficiency is not only used as objective function for model calibration but also serves its purpose in model diagnostics e g see rakovec et al 2019 since the publication by gupta et al 2009 the kling gupta kg efficiency has become a widely used metric for evaluating the goodness of fit of n vectors of model simulations y θ y 1 θ y 2 θ y n θ and corresponding observations y y 1 y 2 y n this metric rectifies some of the shortcomings of the popular nash sutcliffe ns efficiency by using a different euclidean distance based weighting of the correlation bias and temporal variability of the observed and simulated data but this adjustment to the weights of the hydrograph descriptors does not solve the fundamental problem of how to characterize the confidence and prediction limits of the kg efficiency we face a similar problem with the ns efficiency yet for certain special cases we can construct its confidence intervals using the beta distribution draper and smith 1998 albeit this is rarely done in the literature without a description of the confidence intervals of the kg efficiency we cannot amongst others quantify parameter uncertainty derive confidence and prediction limits on simulated model responses assess regional relationships between model parameters and catchment characteristics kuczera and parent 1998 inform decision makers about critical modeling uncertainties evaluate model adequacy and assess the information content of calibration data vrugt et al 2006 more fundamentally without confidence intervals we cannot establish whether the kg efficiency is a consistent efficient and unbiased estimator this paper is concerned with the empirical 1 1 we use the wording empirical confidence intervals to emphasize the heuristic nature of the confidence intervals of informal goodness of fit metrics such as the kg efficiency description of the confidence intervals of the kg efficiency as this estimator lacks a fundamental basis in statistical regression theory we relate the distribution of the kg efficiency to the measurement errors of the training data record y and resort to the bootstrap method of efron 1979 to characterize its confidence and prediction intervals section 2 presents a small sample correction in the decomposition of the ns efficiency of gupta et al 2009 as prerequisite to the exact definition of the kg efficiency this is followed by section 3 which describes our methodology for estimating the uncertainty of the kg efficiency we frame our methodology within the context of generalized least squares and alternate between theory and examples involving simple linear regression and nonlinear regression of the rainfall discharge transformation we compare the confidence limits of the kg efficiency against those derived from least squares estimation finally section 4 concludes our paper with a summary of the main findings 2 the mean squared residual in this section we briefly review the origins of the kg efficiency which has led to its current use to this end we first present the now widely known decomposition of the widely used mean squared residual but with proper treatment of the population and sample variances of the measured y and simulated y θ data 2 1 decomposition the ssr is intimately related to the mean squared residual 2 2 the definition mean squared error mse is widespread in the literature but inconsistent when its computation involves unobservable errors the word error implies a difference between an observed value and its true value as our measurements of system behavior are imperfect the residuals e θ y y θ are estimates of the errors under the assumed model y m θ hence we should use the word residual instead or msr 2 f msr θ 1 n i 1 n y i y i θ 2 which as its name suggests is the average squared difference between the measured and simulated values and thus a multiple of 1 n of the ssr note that the msr has units equal to the squared dimension of the measurements used the msr in turn may be normalized by the variance of the training data σ y 2 to yield the well known coefficient of determination r 2 1 as follows 3 r 2 1 i 1 n y i y i θ 2 i 1 n y i m y 2 1 n msr n σ y 2 1 msr σ y 2 where m y signifies the mean of the observed data 4 m y 1 n i 1 n y i and s y 2 is an estimate of the unknown population variance σ y 2 5 s y 2 1 n 1 i 1 n y i m y 2 as a reminder it is common practice to use the greek letters μ and σ 2 for the theoretical or population mean and variance and to use lower case letters m and s 2 for their sample estimates derived from the data e g see lamontagne et al 2020 this difference in notation is important and consequential for small sample sizes for the sample variance s y 2 to be an unbiased estimator of the true population variance σ y 2 of the n record of measured data y we must divide by n 1 rather than n in the denominator of eq 5 this is also known as bessel s correction and a consequence of the use of the sample mean m y rather than the unknown population mean μ y according to eq 5 the sum term i 1 n y i m y 2 must equal n 1 s y 2 hence the coefficient of determination in eq 3 may be written as 6 r 2 1 n msr n 1 s y 2 the r 2 measures the proportion of the variance of the measured data that is explained by the model m θ as the denominator of eq 3 does not depend on the model output y the parameters θ that maximize the coefficient of determination r 2 will minimize the ssr nonetheless the r 2 is classified as an informal metric of quality of fit as its definition does not follow from assumptions regarding the nature of the residuals or more precisely the measurement errors the r 2 is also known as the nash sutcliffe efficiency among hydrologists and used widely as measure of model performance of watershed models gupta et al 2009 has shown that we can decompose the msr into three different terms 7 msr 2 σ y σ y 1 r σ y σ y 2 m y m y 2 where r 1 1 measures the strength of linear association between the measured and simulated data 8 r c y y s y 2 s y 2 1 n 1 i 1 n y i m y y i m y 1 n 1 i 1 n y i m y 2 1 n 1 i 1 n y i m y 2 which is also known as pearson s sample correlation coefficient 2 2 small sample correction of the ns efficiency eq 7 will return biased values of the msr if users insert sample variances s y 2 and s y 2 of the measured and simulated data respectively lamontagne et al 2020 we consider this commonplace situation in appendix a and should use instead the following expression 9 msr 2 n 2 n s y s y 1 r n 1 n s y s y 2 m y m y 2 the two formulations eqs 7 and 9 are almost similar except for the use of the sample standard deviations s y and s y of the measured and simulated data and the multiplicative constants 2 n 2 n and n 1 n in front of the first and second term respectively these two multipliers are the result of bessel s correction and yield unbiased estimates of the msr for small n say n 20 the two multiplicative constants approach unity for large n and thus can be removed without harm for multi year records of daily discharge measured at the catchment outlet we can now combine eqs 3 and 9 to yield the following expression for the r 2 and thus nse see appendix b 10 r 2 2 s y s y r y y s y s y 2 n n 1 m y m y s y 2 nse 2 α r α 2 c β n 2 a similar decomposition of the nse into three components of correlation conditional unconditional bias and or relative variability was presented by murphy 1988 and gupta et al 2009 but assume knowledge of the unknown population means and variances of the measured and simulated data y and y θ respectively as a result our decomposition in eq 10 adds a unitless multiplier c n n 1 to the third term of eq 4 of gupta et al 2009 the dimensionless scalars α 0 and β n r measure the relative variability in the simulated and observed values and the normalized bias respectively 11 α s y s y and β n m y m y s y and r 1 1 is the well known sample correlation coefficient of pearson in eq 8 if instead we work with the statistical definition δ of bias 12 δ m y m y m y then we yield the sample equivalent of the theoretical definition of the efficiency e of lamontagne et al 2020 as follows 13 r 2 2 α r α 2 cc y 2 δ 2 nse where c y s y m y is the well known coefficient of variation of the measured data and again c n n 1 is a testament to bessel s correction the use of the standardized bias in eq 13 simplifies comparison across models and or watersheds lamontagne et al 2020 2 3 the kling gupta efficiency drawing inspiration from the decomposition of the nse gupta et al 2009 proposed a new criterion the so called kling gupta kg efficiency to read 14 kg 1 ed where ed equals the euclidean distance of α β r to the so called ideal point 1 1 1 and is computed using 15 ed α 1 2 β 1 2 r 1 2 where β m y m y is a unitless measure of the bias β r like the r 2 and thus nse the kg efficiency can take on values between minus infinity and one where unity implies a perfect fit to the measured data gupta et al 2009 has demonstrated the advantages of the kg efficiency over the widely used nse this has stimulated widespread use of the kg efficiency in hydrology for evaluating the goodness of fit between model simulations y and corresponding observations y one potential concern with the application of the kg efficiency is that the three components α β and r of eq 15 are ratios of product moments that are known to exhibit enormous bias for skewed data such as daily streamflow records lamontagne et al 2020 vogel and fennessey 1993 barber et al 2019 this problem persists even for long streamflow time series and should be avoided lamontagne et al 2020 presents improved estimators of the nse and kg efficiency in controlled monte carlo experiments this paper is not concerned with a formal mathematical analysis of the empirical sampling properties of the kg efficiency as in lamontagne et al 2020 but rather focuses attention on the confidence intervals of this estimator as the kg efficiency is an informal measure of the goodness of fit its optimal parameter estimates θ that maximize eq 14 do not enjoy a formal description of their confidence intervals this impairs our ability to quantify model parameter and predictive uncertainty of the kg efficiency in fact most hydrologic signatures that are used in watershed model diagnostics suffer a similar limitation certainly we would favor a statistical description of the empirical distribution of the kg efficiency a quantitative description of the empirical confidence intervals of the kg efficiency serves many practical tasks and purposes of which uncertainty quantification of model parameter and simulated output is most important from the perspective of this paper more fundamentally this knowledge of the confidence intervals of the kg efficiency is a necessary requirement for a formal analysis of the asymptotic behavior consistency efficiency and unbiasedness of this estimator 3 empirical description of uncertainty of the kling gupta efficiency we present our empirical description of the uncertainty of the kg efficiency we frame our methodology within the context of generalized least squares and alternate between theory and ensuing case studies using parameter estimation problems in linear and nonlinear regression this order of presentation helps to convey our arguments and methodology and should help readers understand how current developments relate to statistical regression theory certainly we should not ignore and or forget about least squares methods in our efforts to push forward the envelope in hydrologic model calibration and evaluation 3 1 linear regression 3 1 1 theory to clarify our approach we write the measurements of the training record as follows 16 y y where y y 1 y n is the true response of the data generating system s we would want our simulated output to mimic as closely and consistently as possible this unobserved measurement error free response to help uncover and replicate the unobserved true response y we must make some assumptions about the nature and distribution of the measurement errors when the i s in eq 16 are expected to have a zero mean with constant variance σ 2 then the msr will provide a meaningful assessment of model performance this constancy assumption however does not do justice to variables such as river discharge whose measurement errors increase with the measured flow level y and thus i d n 0 σ i 2 i 1 n where the symbol d means distributed according to the magnitude and structure of the measurement errors of the training data y will exert control on the quality of the parameter estimates hence this information should be incorporated in the msr estimator for a meaningful comparison of the measured and modeled system response this extension of the msr to correlated and or heteroscedastic measurement errors is also known as generalized least squares and was first described by aitken 1936 he showed that if the measurement errors 1 2 n have i a zero mean e i 0 i 1 2 n and ii covariance matrix cov e σ then minimization of the generalized least squares gls objective function 17 f gls θ e θ σ 1 e θ produces unbiased and minimum variance estimates of the parameters θ the symbol denotes matrix transpose and turns the n 1 residual vector e θ into a row vector so as to have matching inner dimensions in eq 17 the diagonal entries of the n n measurement error covariance matrix σ specify the variances of the measurement errors of the y i s while the off diagonal entries list the pairwise covariances of i and j for all i j 1 2 n and i j to better understand the inner workings of the vector matrix vector product of eq 17 we define the n n weight matrix w to be the square root of σ 1 so that w σ 1 2 and thus w w σ 1 then eq 17 can be written as a vector inner product f gls θ ε θ ε θ of the homogenized and or decorrelated residuals ε θ we θ the entries of the n 1 vector ε θ are also referred to as partial residuals or innovations when the measurement errors are known to be uncorrelated the off diagonal entries of σ and thus w are zero and eq 17 specializes to a weighted sum of squared residuals wssr objective function 18 f wssr θ i 1 n y i y i θ 2 σ i 2 i 1 n w i 2 e i θ 2 i 1 n ε i θ 2 where the weights w i 1 σ i i 1 n on the main diagonal of w are equal to the reciprocal of the measurement error standard deviations and ε θ ε 1 θ ε 2 θ ε n θ is the n 1 vector of homogenized partial residuals in the case of homoscedastic errors the weights w i are all equal hence we can write σ σ 2 i n where i n is the identity matrix of size n and the wssr reduces to a multiple of 1 σ 2 of the ssr the use of the n n covariance matrix of the measurement errors σ places the gls and thus wssr objective functions on a firm statistical footing suppose that we would like to fit the linear regression function y dθ with n p design matrix d and p 1 parameter vector θ θ 1 θ 2 θ p to the n entries y 1 y 2 y n of the training data record y with n n measurement error covariance matrix σ the gls parameter values θ can be obtained by setting the derivative of eq 17 with respect to θ to zero to yield 19 θ θ 1 θ 2 θ p d σ 1 d 1 d σ 1 y where c θ d σ 1 d 1 equals the p p variance covariance matrix of the gls parameters this positive definite matrix p p matrix defines an elliptical distribution a generalization of the multivariate normal distribution with density function 20 p θ k ψ θ θ c θ 1 θ θ where k is a normalization constant and the scalar function ψ x returns the unnormalized density at x the 100 γ confidence region of the gls parameter values is now made up all parameter vectors θ ℝ p that lie inside the space delineated by 21 θ θ c θ 1 θ θ f p γ p n p at the critical value p γ γ the above inequality describes an ellipse for p 2 an ellipsoid in three dimensions and a hyperboloid in p dimensional cartesian parameter space r p although other shapes can occur the principal axes volume shape and orientation direction angle of the confidence region of the hyperboloid are determined by the inverse parameter covariance matrix also referred to as fisher information matrix i θ after sir ronald aylmer fisher 1890 1962 the larger the values of i θ d σ 1 d the stronger the curvature of f gls θ and the smaller the uncertainty of the parameters and thus volume of the confidence region to link our assumptions about the probabilistic properties of the measurement errors to the gls parameters θ we write the n n covariance matrix of the measurement errors σ σ 2 v and thus d n n 0 σ 2 v in the case of homoscedastic and uncorrelated measurement errors v i n otherwise the nonsingular n n matrix v may have unequal diagonal elements heteroscedasticity and or off diagonal entries that are non zero the p p parameter covariance matrix c θ can now be written as follows 22 c θ s 2 d v 1 d 1 with corresponding geometric description of the 100 γ confidence region 23 θ θ d v 1 d θ θ s 2 f p γ p n p where s 2 is the sample variance of the weighted homogenized and or decorrelated residuals 24 s 2 e θ v 1 e θ n p according to the definition of the chi square distribution the sum of squares of the weighted residuals in the numerator of eq 24 will follow a multiple σ 2 of the χ 2 distribution with n p degrees of freedom this implies that s 2 d σ 2 χ n p 2 n p with loss of one degree of freedom for each parameter of the regression function analogously the sum of squares of p weighted parameter deviations from the center θ of the ellipsoidal region defined in the numerator of eq 23 will follow a multiple σ 2 of the chi square distribution with p degrees of freedom thus θ θ d v 1 d θ θ d σ 2 χ p 2 if we put everything together we yield 25 the ratio of two chi squared variates u 1 and u 2 with ν 1 and ν 2 degrees of freedom 26 x u 1 ν 1 u 2 ν 2 produces a variate x which follows a f distribution f ν 1 ν 2 with ν 1 and ν 2 degrees of freedom thus the joint 100 γ confidence region of the gls parameters θ now satisfies 27 θ θ d v 1 d θ θ ps 2 f f 1 p γ p n p where f f 1 p γ p ν signifies the inverse of the fisher snedecor cumulative distribution function cdf with p and ν n p degrees of freedom at the critical value p γ γ the inverse cdf is also called the quantile or percent point function and returns the value x of random variable x at which p x x p γ in other words the inverse cdf f x 1 p γ of some univariate distribution x returns the unique real number x so that f x x p γ for long training data records y the distribution of the sample variance of the weighted residuals in the denominator of eq 25 reduces to σ 2 and the 100 γ confidence region becomes 28 θ θ d v 1 d θ θ ps 2 f χ 2 1 p γ p multivariate confidence regions are difficult to visualize and thus pseudo univariate intervals may be determined instead from the diagonal entries of the p p parameter covariance matrix c θ as follows 29 θ γ θ diag c θ f t 1 1 2 1 γ n p where f t 1 p γ ν is the inverse of the student s t cumulative distribution function at cumulative probability percentile p γ 1 2 1 γ and degrees of freedom ν n p these confidence intervals are projections of the confidence region on individual parameter axes for γ 0 95 we yield a 95 parameter confidence interval and the critical t value f t 1 p γ ν equals 12 71 2 57 and 1 96 for n 1 n 5 and n respectively confidence limits of the least squares simulated output y d θ y 1 y 2 y n of the linear regression function y dθ can be computed as follows 30 y i γ y i f t 1 p γ ν s d i d v 1 d 1 d i where d i signifies the i th row of the design matrix and i 1 2 n the confidence intervals follow a normal distribution with mean equal to the least squares output y i d i θ and variance determined by d i and parameter covariance matrix c θ s 2 d v 1 d 1 3 1 2 application linear function to illustrate the application of eqs 27 and 29 please consider fig 1 a which presents a contour plot of the gls objective function for a simple regression function y i f a b t i at i b using synthetic training data y y created using a 1 b 2 t 1 2 50 and measurement errors d n n 0 σ drawn at random from a n variate normal distribution with zero mean and n n covariance matrix σ σ 2 v where σ 2 1 2 and v i n in vector form the regression function reads y i d t i θ where d t i t i 1 signifies the i th row of the n p design matrix d and θ a b the colored ellipses portray the 100 γ confidence regions of a slope and b intercept using γ 0 50 light gray γ 0 90 light medium gray γ 0 95 medium gray and γ 0 99 dark gray the dotted blue lines portray separately the 2 5 and 97 5 percentiles that make up the 95 confidence intervals of the regression model parameters a and b derived from eq 29 the red plus characterizes the gls solution of a and b the 100 γ confidence region of the slope and intercept a and b equals a thin ellipse that centers on the least squares solution red cross the length and direction of the two principal axes of the ellipse are given by the eigenvalues and eigenvectors respectively of the parameter covariance matrix c θ as a result the 99 confidence region of the two parameters a and b is simply a multiple of their 95 region the ellipses enclose values of the slope and intercept a b which the training data y suggests are statistically acceptable at a given confidence level γ the univariate 95 confidence intervals of the slope and intercept blue dotted lines underestimate their bivariate counterparts nevertheless provide a reasonable description of the individual parameter ranges one should be careful however in interpreting these intervals for a and b as a joint confidence region indeed points in the bottom left or upper right corners of the rectangular region delineated by the univariate 95 intervals may seem reasonable for a b yet the joint 95 confidence region of the two parameters as characterized exactly by the ellipse in medium gray demonstrates that points in the white region are inadequate in other words the hypercube defined by expression 29 can be very different from the proper joint confidence region of the parameters this discrepancy between univariate and multivariate confidence intervals is well known in the statistical literature draper and guttman 1995 and researchers usually present univariate confidence intervals only in the general case with p 3 parameters the differences between the marginal and joint confidence regions are typically larger and more difficult to visualize therefore most researchers resort to univariate confidence intervals only note that one can change the projection of the confidence regions on the parameter axes and or adapt the rectangular block to have an equal size volume as the ellipsoidal region draper and guttman 1995 for example press et al 1992 suggests replacing f t 1 1 2 1 γ n p in eq 29 with f χ 2 1 p γ p this may result in a better agreement of the confidence interval block and its ellipsoidal counterpart s yet for reasons demonstrated herein this univariate description of parameter uncertainty cannot replace the joint confidence region certainly the mathematical description of the confidence region in eq 27 is only exact for regression functions with valid basis functions then the n p design matrix d is fixed and the principal axes of the ellipse described by d v 1 d are independent of θ ℝ p for all other functions the sensitivity design matrix will depend on the parameter values and the confidence region expressed in eq 27 is at best only an approximation of the true multivariate parameter uncertainty this is no grounds for panic but simply a reason to change the approach to how we construct the confidence regions fortunately the gls objective function is rooted in statistical theory and therefore we can choose among several different methods to describe exactly the multivariate parameter uncertainty this includes among others i contouring of the gls objective function ii monte carlo simulation and iii the bootstrap method these three methods are fundamentally different but share in common an exhaustive description of the gls cost function in the neighborhood of θ as the first of these two methods demand use of formal goodness of fit measures and or likelihood functions which originate from residual assumptions see appendix c in their current form they are not capable of characterizing parameter uncertainty associated with the application of informal quality of fit metrics such as the kg efficiency hence we focus our attention on the bootstrap method as this approach best suits our application as will be demonstrated next fig 1b illustrates the results of the bootstrap method of efron 1979 by application to the regression function y i f a b t i at i b used herein the scatter plot visualizes a b data pairs derived from the repeated application of eq 19 to n 10 000 different realizations y r y of the training data record y drawn at random from the n variate normal distribution with mean y and covariance matrix σ s 2 v and thus y r d n n y s 2 v this is equivalent to our formulation of the training data in eq 16 with measurement errors d n n 0 s 2 v the variance of the homogenized residuals s 2 is computed from the gls solution θ using eq 24 the bootstrap samples are color coded based on their percentiles of the gls objective function of eq 17 computed using the measured training data y not the replicate records the 100 γ confidence region s of the slope and intercept derived from the bootstrap method match exactly their analytic counterparts of eq 27 this is true for all critical values the small imperfections in the outside perimeter of the outermost ellipse sampled by the bootstrap method highlights the need for a sufficiently large sample size this frontier demarcates the edges of the 99 confidence region and is characterized by the most improbable realizations of the training data record we also witness an excellent agreement between the univariate 95 bootstrap confidence intervals of a and b and their analytic values derived from eq 29 in summary if we perturb the measured data y y 1 y 2 y n according to the assumptions of the gls estimator then the optimized parameter values for each replicate record y r of the training data y define a p variate distribution with probability density function synonymous to eq 20 and 100 γ confidence region s described by eq 27 this is the underlying idea of approximate bayesian computation see e g vrugt and sadegh 2013 and allows for an exact description of parameter uncertainty in the absence of convenient closed form solutions for their confidence regions and or intervals such as eqs 29 and 27 for the gls wssr and or ssr objective functions next we should confirm that these conclusions also hold for regression functions with invalid basis functions 3 2 nonlinear regression 3 2 1 theory the regression function f θ t at b of the first case study satisfies the linearity condition 31 f θ δ θ t i f θ t i d i δ θ where d i t i 1 is the i th row of the n p design matrix d and i 1 2 n this linearity condition does not hold for regression functions whose output depends nonlinearly on their parameters then the entries of the design matrix d may not only depend on the explanatory variable t but also on the values of one or more parameters this is commonplace in hydrology and has two important implications the gls parameter values θ cannot be determined from the closed form solution in eq 19 but instead must be estimated using an iterative search and or optimization method furthermore we should not expect eqs 29 and 30 to provide an exact description of the 100 γ confidence intervals of the parameters and simulated output next we illustrate the application of the bootstrap method to nonlinear regression 3 2 2 application a hydrologic toy model our second case study considers a simple 3 parameter hydrologic model comprised of two linear reservoirs organized in parallel see fig 2 this model has two state variables s f and s s with units of mm and three parameters the unitless rainfall distribution coefficient d 0 1 and the recession constants k s and k f of the slow and fast reservoirs respectively with dimensions of reciprocal day we set d 0 65 k s 0 035 and k f 0 7 and create a 5 year simulation of daily discharge y y 1 y 2 y n in mm day via an analytic solution using as model input a hypothetical record of daily rainfall data each entry of the discharge simulation is subsequently perturbed with a heteroscedastic measurement error d n n 0 σ to yield y t y t t the n n measurement error covariance matrix σ c v where c 0 01 and the n n matrix v has zeros everywhere except for the main diagonal which lists the squared values of the n simulated discharges this amounts to a heteroscedastic measurement error with standard deviation equal to 10 of the simulated discharge we would now like to use the measured data y y 1 y 2 y n to determine the confidence regions of the parameters as the model does not have valid basis functions we cannot write the model in matrix form and must use an optimization method to minimize the gls objective function in eq 17 we assume perfect knowledge of the measurement errors thus admit σ to our analysis fig 3 top panel presents the results of the bootstrap method using repeated minimization of the gls objective function in eq 17 for replicate samples y r d n n y σ of the measured discharge record the gray tints of the bootstrap samples differ based on their confidence levels including γ 0 5 light gray γ 0 90 light medium gray γ 0 95 medium gray and γ 0 99 dark gray the red cross in each graph indicates the gls optimum the bottom panel serves as our benchmark and presents scatter plots of the bivariate samples of the posterior distribution derived from the dream algorithm vrugt et al 2009 in keeping with the gls assumptions we must specify a uniform prior parameter distribution in connection with the likelihood function of eq c4 in appendix c with σ 2 0 01 the bivariate confidence regions of the parameter pairs appear symmetric around their optimum value with sampling density that decreases away from the center of the point clouds the confidence regions are well described by ellipses and their diagonal orientation suggests the presence of parameter correlation among d k s and k s this is all interesting yet most important is the nearly perfect match of the confidence regions of the bootstrap method and the dream algorithm this is not a surprise nevertheless an important demonstration to those unfamiliar with the bootstrap method and its applicability to uncertainty quantification it needs no further demonstration that the confidence intervals of both methods are a perfect match we are now ready to pair the bootstrap method with the kg efficiency but before doing so we first would like to provide some general remarks about the limitations of the bootstrap method the bootstrap method provides a powerful alternative to arguably more beautiful and cpu friendly analytic procedures thus is a wonderful addition to the hydrologists arsenal of statistical inference methods yet the apparent simplicity of bootstrapping may fool users into thinking that no important assumptions are being made in its application these assumptions relate to the independence of the samples and the sample size certainly bootstrapping is not recommended for small training records comprised of only a few observations then the resampled records may not be representative of the underlying data generating process and this will corrupt the standard errors and or confidence intervals of the variables of interest furthermore our experience suggests that it is not particularly easy to preserve higher order moments skew and or kurtosis of the training data record and or characterize well the periodicity and persistence of dynamic systems these are known problems with resampling in general and different implementations of the bootstrap method may be found in the literature to minimize bias and estimation errors furthermore the large computational requirements of the bootstrap method complicate its application to highly parameterized and or cpu intensive models 3 3 diagnostic regression the bootstrap method serves as principal foundation of our methodology for constructing confidence regions and or intervals of informal goodness of fit metrics in regression analysis this includes metrics such as the nse and kg efficiency and hydrologic signatures within the context of model diagnostics we coin this field diagnostic regression not to be confused with regression diagnostics which equal procedures and techniques designed to verify statistical assumptions and model validity in linear regression everitt and skrondal 2010 such diagnostic checks are also used in bayesian inference to ascertain that the residuals satisfy assumptions made by the likelihood function schoups and vrugt 2010 thus in diagnostic regression we model the relationship between dependent and independent variables through application of informal goodness of fit metrics and present empirical estimates of the confidence and or prediction limits of variables of interest this adds a new member to the large family of commonly used regression techniques such as lasso logistic ordinal polynomial ridge support vector stepwise and quantile regression and offers a common creative license and receptacle for the growing collection of heuristic and or applied model data synthesis methods before we move on to the application of diagnostic regression we provide one general remark we use the wording empirical confidence intervals to emphasize the heuristic nature of the confidence intervals obtained from diagnostic regression with metrics such as the kg efficiency in principle one could use the label empirical to characterize any sampling based estimates of the confidence regions and or intervals but the so obtained estimates of the confidence and prediction intervals from the dream algorithm are an approximation of the true uncertainty as defined by the residual assumptions 3 3 1 application linear function we revisit our first case study of section 3 1 and use the kg efficiency to determine the optimal values of the slope a and intercept b and their empirical confidence regions and intervals bootstrapping involves repeated maximization of the kg efficiency of eq 14 for many different realizations of the training data record fig 4 presents the confidence regions derived from a the analytic expression of eq 27 and b the bootstrap method using the kg efficiency the left graph is a copy of fig 1a and is used for benchmark purposes we observe a close match in the optimum value θ of the slope and intercept derived from diagnostic regression with the kg efficiency red cross and the least squares solution θ of eq 19 furthermore the bivariate confidence regions of the kg efficiency show a strong resemblance with their exact least squares counterparts of eq 27 the confidence regions of the kg efficiency center on the optimum a b values θ and appear well described by ellipses the major and minor axes of the ellipses of the kg efficiency match quite closely those derived from the information matrix i θ of the gls confidence regions but exhibit an enlarged angle from the horizontal slope axis furthermore the ellipses that make up the 95 and 99 confidence regions of a and b appear discontinuous in the area immediately above and below the optimum kg solution red cross indeed at these critical levels the bootstrap samples provide only a somewhat spotty characterization of the bivariate parameter uncertainty it is not particularly clear what causes this apparent deficiency certainly we used a large enough sample size we do not apply the kg efficiency to our hydrologic toy model of the second case study but rather focus our attention on a more complex watershed model using measured streamflow data instead 3 3 2 application a conceptual watershed model our third and last study illustrates the application of diagnostic regression with the kg efficiency to the hmodel a parsimonious conceptual watershed model originally developed by schoups et al 2010 we estimate the hmodel parameters and their respective confidence intervals using 14 year long records oct 1 1994 sept 30 2008 of daily discharge data from the a leaf river near collins ms usgs 02472000 and b kinchafoonee creek near dawson ga usgs 02350900 these two medium sized watersheds exhibit a strong and weak winter regime respectively according to the functional classification of brunner et al 2020 the hmodel transforms rainfall into runoff at the watershed outlet using an interception unsaturated zone fast and slow flow reservoir respectively which simulate interception throughfall evaporation surface runoff percolation fast streamflow and baseflow see fig 5 the hmodel structure processes control input and numerical solution have been discussed by schoups et al 2010 and interested readers are referred to this publication for further details table 1 lists the seven hmodel parameters and their corresponding symbols units and upper and lower bounds we discard the first five years of the discharge records in our computation of the kg efficiency to reduce sensitivity to state variable initialization the empirical description of the uncertainty of the kg efficiency with the bootstrap method requires many different replicates of the measured discharge records of the leaf river and kinchafoonee creek these replicates should characterize streamflow measurement uncertainty and preserve the statistical properties e g streamflow moments and temporal structure persistence and hydrologic characteristics e g catchment summary metrics of the measured discharge record the model free duplication method of oliveira and vrugt 2022 satisfies these requirements and thus serves our purpose a brief description of this method is given below interested readers are referred to oliveira and vrugt 2022 for further details per eq 16 the entries of the discharge measurement vector may be written as follows 32 y h t where h t is the data generating process of the true streamflow at time t n and the measurement errors 1 2 n d n n 0 σ are variates drawn from a n variate normal distribution with zero mean and n n measurement error covariance matrix σ 33 σ e σ 1 2 r y 1 σ 1 σ 2 r y n 1 σ 1 σ n r y 1 σ 2 σ 1 σ 2 2 r y n 2 σ 2 σ n r y n 1 σ n σ 1 r y n 2 σ n σ 2 σ n 2 1 r y 1 r y n 1 r y 1 1 r y n 2 r y n 1 r y n 2 1 σ 1 σ 2 σ n σ 1 σ 2 σ n r y σ σ where r y denotes the n n correlation matrix of the measurement errors r y τ is the correlation function of the measurement errors σ σ 1 σ 2 σ n signifies the n vector of measurement error standard deviations is the hadamard or schur product and τ 1 2 n the correlation matrix r y can be derived from the sample autocorrelation function acf of the measured discharge data y y 1 y 2 y n the sample autocorrelation r y τ for two streamflow observations y i and y j a distance time τ i j apart may be computed using 34 r y τ cov y i y j var y i i τ 1 n y i m y y i τ m y i τ 1 n y i m y 2 where m y 1 n t 1 n y t mm d denotes the mean of the n record of streamflow observations the entries of the n 1 vector of measurement error variances σ 2 are computed from hourly discharge observations using the procedure described in oliveira and vrugt 2022 specifically the t th entry s t 2 of s 2 is computed as follows oliveira and vrugt 2022 35 s t 2 1 m 1 m 1 i 1 m y i h 1 m j 1 m y j h 2 1 m 1 m i 1 m a h y i h b h 2 where the y i h s mm d are the m 24 hourly discharge observations i 1 2 m of the t th day of the daily streamflow record y and the coefficients a h and b h mm d signify the slope and intercept of the hourly discharge measurement error function respectively this linear function turns the hourly discharge measurements into estimates of the measurement error standard deviation and is derived from nonparametric differencing using the estimator of vrugt et al 2005 eq 35 can be rewritten as follows 36 s t 2 1 m s y h 2 1 m 2 i 1 m s h 2 where the first term s y h 2 mm 2 d 2 measures the spread of the hourly discharge observations measurement uncertainty and the second term 1 m s h 2 mm 2 d 2 accounts for their respective measurement error variances replicate discharge records y r y are now created by perturbing the measured streamflow time series y with measurement errors drawn from the n variate normal distribution d n n 0 σ with zero mean and covariance matrix σ of eq 33 to do so efficiently we write instead y r y lν where ν ℝ n is a n 1 vector of independent standard normal variates and the n n lower triangular matrix l is derived from cholesky decomposition of the symmetric positive definite matrix σ ll prior to computation of the correlation matrix r y the discharge measurements are replaced by their respective variates of a standard normal distribution this transformation promotes hydrologic characterization by suppressing sudden bumps and discharge fluctuations during long recession periods note that if σ is written as product of a constant σ 2 and a n n matrix v then l σ 2 chol v the use of the discharge sample acf in the measurement error covariance matrix σ introduces serial correlation among the t s this is a necessary means to preserving the smoothness statistical and hydrologic properties of the measured discharge record oliveira and vrugt 2022 the autocorrelation avoids overly bumpy replicate records that result from the use of the measured discharge time series rather than the underlying data generating process in eq 32 fig 6 presents histograms of a representative group of five hmodel parameters a s max b q max c α f d k f and e k s derived from the bootstrap method using the n 1 000 replicates of the measured daily discharge records of the leaf river top panel and kinchafoonee creek bottom panel for each replicate record we optimized the seven hmodel parameters by maximization of the kg efficiency using the shuffled complex evolution sce ua algorithm of duan et al 1992 the marginal distributions summarize the effect of the discharge measurement errors on the inferred hmodel parameter values the modes of the histograms coincide quite well with their optimized values θ of the measured discharge records red crosses the frequency distributions of the hmodel parameters appear well defined by calibration against the kg efficiency the parameters exhibit a relatively small dispersion appear symmetric around their mean and are well described by a gaussian distribution exceptions to this are the histograms of parameters i max fig 3a1 which is truncated by its upper bound and k s fig 3e2 which has a positive skew and thus tail to the right as a result the marginal distributions of these two parameters do not center on their values derived from the measured discharge record but are found at the upper and lower end of their distribution this deviation from normality may become more common for catchments from other hydrologic regimes for example with snow melt or extended dry periods next fig 7 presents the marginal distribution of the kg efficiency obtained from evaluating the optimized hmodel parameters of the thousand replicate records for the measured discharge data of the a leaf river top panel and b kinchafoonee creek the optimized kg values of the measured discharge data records are separately indicated with a blue cross as the kg efficiency is a metric that has to be maximized its frequency distribution is truncated at the upper bound by its maximized value for the measured discharge record and the probability mass of the bootstrap samples is dispersed in a tail to the left quite remarkably the 50 90 95 and 99 percentiles of the distributions of the kg efficiency have a similar distance to the maximum kg efficiency this amounts to 0 0032 0 0018 0 0013 and 0 005 respectively listed in order of the critical values this finding may support a more formal probabilistic description of the kg efficiency in a fashion similar to the tolerable increments for the gls estimator discussed in appendix c indeed for the gls estimator the tolerable increment follows an inverse chi square cumulative distribution function with p degrees of freedom hence δ gls γ f χ 2 1 p γ p where p γ γ thus the tolerable increment of the gls only depends on parameter dimensionality not on data length and the nature of the measurement errors residuals we have investigated this thread for the kg efficiency with the linear regression function of section 3 1 using different lengths of the training data record and homoscedastic heteroscedastic and or correlated measurement errors our preliminary results not shown have demonstrated that the tolerable reduction of the kg efficiency δ kg depends on the magnitude and nature of the measurement errors in other words the kg efficiency does not admit a simple probabilistic description of its confidence regions and or intervals this leaves as our only option the bootstrap method using replicates of the discharge record to provide insights into the bootstrap samples please consider fig 8 which presents bivariate scatter plots of a i max s max b α f s max c k f s max and d k s s max using the replicates of the discharge record of the leaf river top panel and kinchafoonee creek bottom panel watersheds the red crosses portray the optimal values of the hmodel parameters θ using diagnostic regression for the measured discharge records the bootstrap samples are coded in different gray tints based on their confidence levels γ 0 5 light gray γ 0 90 light medium gray γ 0 95 medium gray and γ 0 99 dark gray the bootstrap samples populate only a small part of the prior parameter space the dotty plots are well described by concentric circles and or elongated ellipses which center on the midpoint of the dotty plots and envelope the optimum solution red cross of the hmodel parameters the exception to this is the a1 i max s max parameter pair whose bivariate distribution cloud is truncated by the upper bound of i max the density of the points decreases away from the midpoint of the point cloud we do not witness any mutual relationships between the pairs of plotted parameters with exception of the b2 α f s max and c1 k f s max parameter pairs which exhibit a positive linear correlation the bivariate confidence regions of the hmodel parameters are sharply delineated for the leaf river data record and organized in long elongated ellipses around the midpoint of the bootstrap samples for the kinchafoonee creek on the contrary the boundaries of the joint parameter confidence regions of the hmodel parameters are poorly defined the confidence regions mix and overlap an effect that is particularly visible towards the outer perimeter of the point clouds of the hmodel parameters pairs this mixing of the confidence regions is a result of the projection of the p 7 dimensional parameter space onto only two axes this geometric simplification destroys the underlying multivariate surface of the kg efficiency and this distorted organization may therefore lead to a mixing of the confidence regions the reason so as to why the leaf river watershed does not suffer this protrusion conveys important information about the geometry of the kg confidence regions in the full parameter space in short the confidence regions can only increase or decrease monotonically with each marginalized unplotted parameter axes for the spatial organization of the confidence regions to be preserved in the two dimensional projections in the top panel the p variate confidence regions for the kinchafoonee creek violate the monotonicity requirement for at least one of the marginalized parameter axes and as a result the projection introduces mixing so evidently present in the two dimensional snapshots in the bottom panel of course this mixing will not affect the confidence intervals of the hmodel parameters finally we must verify the accuracy and or precision of the kg calibrated hmodel by comparison against the measured discharge record fig 9 presents a time series plot of measured red dots and hmodel simulated discharge for the leaf river watershed using a representative 8 month portion of the historical record as the kinchafoonee creek presents similar findings we do not visualize these results the light red area displays the 99 discharge measurement uncertainty whereas the gray region corresponds to 99 hmodel simulation uncertainty associated with the kg efficiency we do not display the streamflow simulation of the optimal hmodel parameters θ of the measured discharge record of the leaf river this simulation is contained within the 99 confidence limits of the simulated discharge mostly at the center of the gray interval the hmodel tracks the measured discharge data reasonably well although a positive bias is observed in the first 50 days of the 7 month period between the middle end of november and middle of december 2004 this initial overshoot of the measured discharge data is rectified during subsequent storm events demonstrating an increasingly better match between the simulated and measured hydrographs certainly the baseflow is rather poorly described by the hmodel in the 242 day window this deficiency is particularly visible in the long recession period at the end of the 7 month record the large model data mismatch so visible in the early part of the record may point at an exaggerated state of the hmodel s four control volumes in the period leading up to the storm event in november 2004 measurement errors of the antecedant basin average rainfall may have corrupted the state variables of the hmodel one has to be careful however in attributing this early mismatch to precipitation errors as performance metrics other than the kg efficiency may improve the overall compliance between the hmodel and the measured discharge data this then would have an immediate effect on the simulated state of the leaf river basin preceding the storm event in nov 2004 if so desired data assimilation may be used to refine the simulated state variables and remove excess water from the control volumes if the measured discharge data dictate doing so improves model data compliance the 99 confidence intervals of the simulated hydrograph gray region are smallest on average at the end of a long recession period and reach a maximum width at peak discharge this dependence of the width of the hmodel discharge confidence intervals on simulated flow level is a result of the heteroscedastic nature of the discharge measurement errors as evidenced by the measured streamflow record using nonparametric differencing vrugt et al 2005 oliveira and vrugt 2022 the 99 confidence intervals of the hmodel simulated streamflows exceed the discharge measurement uncertainty red region but appear rather small compared to the residuals of the optimal hmodel parameters θ indeed the gray region makes up only a small part of the distance between the measured and simulated discharge records this small width is commensurate with a poor coverage of the discharge confidence intervals of the kg efficiency only a handful of streamflow observations contained within the gray region this is why it is common practice in the context of generalized least squares to use the sample variance of the residuals see eq 24 in the computation of the 100 γ confidence intervals of the gls parameters θ and simulated output y in eqs 29 and 30 we can follow a similar approach in diagnostic regression and use the residuals of the optimal hmodel parameters θ in our computation of the empirical confidence intervals of the kg efficiency this requires only a minor change to the implementation of the bootstrap method we must replace our probabilistic description of the measurement errors of the training data record with an analogous description of the model residuals of the maximized kg efficiency of the measured training data record inevitably this will substantially enhance hmodel parameter and simulation uncertainty the formulation of the n variate residual distribution is relatively simple for well behaved residuals with known marginal distribution constant variance and or structure that satisfies a simple autoregressive scheme but skewed and or lepto or platykurtic residuals with a nonconstant variance bias and or an unusual structure persistence and or state dependence do not necessarily admit a convenient probabilistic description this limits our ability to draw accurate replicates of the training data record and complicates uncertainty quantification of model parameter and simulation uncertainty with the bootstrap method in diagnostic regression with the kg efficiency the generalized plus and universal likelihood functions of vrugt et al 2022 will help in distilling a convenient probabilistic description of time series of ideal and non ideal residuals but this does not guarantee a perfect characterization the time series plot in fig 9 certainly makes clear that the discharge residuals exhibit a changing bias and correlation structure with flow level but as the kg efficiency is an informal goodness of fit metric we cannot unify the actual residual characteristics with prior assumptions made about their probabilistic properties nevertheless fig 10 analyzes the a magnitude b distribution and c acf of the streamflow residuals of the calibrated hmodel with maximum kg efficiency the residuals increase with magnitude of the simulated discharge in a manner that is expected from the knowledge of the measurement errors the empirical distribution of the discharge residuals appears symmetric is centered about zero and is much peakier than the normal distribution lastly the residuals exhibit considerable serial correlation at the first few lags this is expected given the systematic over and or underprediction so evidently present at high and low flows respectively in the time series plot these findings warrant treatment of residual serial correlation and heteroscedasticity for example through the use of generalized least squares alternatively we can resort to bayesian analysis specify a generalized likelihood function schoups and vrugt 2010 and infer the matrix v along with σ 2 simultaneously with the hmodel parameters using mcmc simulation with the dream algorithm this approach lets the data speak for itself and provides samples from the posterior distribution which can be presented as confidence regions 4 conclusions informal quality of fit measures such as the kg efficiency are not borne out of testable hypotheses with respect to the probabilistic properties of the residuals this has profound consequences we cannot verify a posteriori whether assumptions of the kg estimator have been satisfied and more importantly from the perspective of this paper the uncertainty of the kg efficiency is not defined this begs the question how we should compute confidence and prediction limits on current and or future model responses if we do not know which marginal distribution to expect of the residuals of the kg efficiency to move beyond the status quo this paper has presented a simple framework for determining empirical confidence intervals of the kg efficiency our method relates the distribution of the kg efficiency to the measurement errors of the calibration data parameter and simulation uncertainty may then be quantified with the bootstrap method using replicates of the data record the first two case studies served as demonstration of the bootstrap method for statistical inference of parameter uncertainty to those unfamiliar with this methodology we showed that the bootstrap method yields the exact same parameter confidence regions and intervals as generalized least squares within the context of linear regression and bayesian analysis coupled with mcmc simulation within the context of nonlinear regression after this proof of concept we turned our attention to the kg efficiency and used this informal goodness of fit metric within the context of diagnostic regression to determine optimal parameter values and their associated uncertainty of a simple linear regression function with slope and intercept and the 7 parameter hmodel of schoups et al 2010 using measured discharge data of two contrasting watersheds the empirical confidence regions and intervals of the slope and intercept derived from diagnostic regression using the kg efficiency were in close agreement with their exact counterparts obtained from generalized least squares the ellipses of the kg efficiency exhibited an enlarged angle from the horizontal axis the application of diagnostic regression with the kg efficiency to the hmodel showed that its parameters were well described by a normal distribution with relatively small dispersion and or skew and possibly truncated by the prior distribution the modes of the marginal parameter distributions coincided quite well with their optimized values derived from the measured discharge records of the leaf river and kinchafoonee creek the distribution of the kg efficiency is a complex function of data length and the magnitude distribution and structure of the discharge measurement errors this prohibits a simple closed form description of the empirical confidence regions and or intervals of the kg efficiency defined herein this leaves as only option the bootstrap method to quantify model parameter and predictive uncertainty of the kg efficiency within the context of diagnostic regression data and software availability the data models and other software are available upon request from the corresponding author jasper uci edu and can be downloaded from https github com jaspervrugt kgefficiency credit authorship contribution statement jasper a vrugt conceptualization methodology software validation formal analysis investigation writing original draft writing review editing visualization supervision project administration debora y de oliveira software validation formal analysis data curation visualization declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgment we greatly appreciate the constructive comments of the ae and two reviewers that have led to an improved manuscript the first author acknowledges interactions with dr yan liu on the mathematical underpinning of the kg estimator the second author gratefully acknowledges the financial support received from the brazilian federal agency for support and evaluation of graduate education capes grant no 88881 174456 2018 01 the camels data set is described in newman 2015 and can be downloaded from https dx doi org 10 5065 d6mw2f4d the hourly streamflow data of gauch et al 2020 are available at https doi org 10 5281 zenodo 4072700 appendix a decomposition of the mean squared residual the original derivation of the mean squared residual msr by gupta et al 2009 assumes knowledge of the population variances of the n 1 records of measured y y 1 y 2 y n and simulated y y 1 y 2 y n data the msr is equal to a1 msr 1 n t 1 n y t y t θ 2 and may be decomposed in different terms as follows a2 msr 1 n t 1 n y t y t θ y t y t θ 1 n t 1 n y t 2 1 n t 1 n y t θ 2 2 n t 1 n y t y t θ we can now make use of the following well known identities to rewrite the above expression a3a i 1 n x i 2 n 1 s x 2 nm x 2 a3b i 1 n x i y i n 1 r xy s x s y nm x m y where m x is the mean of the n record of x values a4 m x 1 n i 1 n x i the variable s x 2 denotes its associated variance a5 s x 2 1 n 1 i 1 n x i m x 2 and r xy signifies the sample correlation coefficient of the x i y i data pairs i 1 2 n a6 r 1 n 1 i 1 n y i m y y i m y 1 n 1 i 1 n y i m y 2 1 n 1 i 1 n y i m y 2 if we substitute the identities of eqs a3a and a3b into eq a2 we yield a7 msr 1 n n 1 s y 2 nm y 2 1 n n 1 s y 2 nm y 2 2 n n 1 r y y s y s y nm y m y n 1 n s y 2 m y 2 n 1 n s y 2 m y 2 2 n 2 n r y y s y s y 2 m y m y n 1 n s y 2 s y 2 m y m y 2 2 n 2 n r y y s y s y now as a 2 b 2 a b 2 2 ab we can rewrite the first term to read a8 msr n 1 n s y s y 2 2 s y s y m y m y 2 2 n 2 n r y y s y s y n 1 n s y s y 2 m y m y 2 2 n 2 n s y s y 2 n 2 n r y y s y s y n 1 n s y s y 2 m y m y 2 2 n 2 n s y s y 1 r y y we can now reorganize the above expression and rearrange the terms in similar order as eq 7 to yield a9 msr 2 n 2 n s y s y 1 r y y n 1 n s y s y 2 m y m y 2 this concludes our derivation appendix b decomposition of the coefficient of determination according to eq 6 the coefficient of determination r 2 satisfies the following equality b1 r 2 1 n msr n 1 s y 2 nse where nse is the infamous nash sutcliffe efficiency we can reformulate the above expression by substituting for the mean squared residual msr eq a9 to yield b2 r 2 1 2 n 2 s y s y 1 r n 1 s y s y 2 n m y m y 2 n 1 s y 2 n 1 s y 2 2 n 2 s y s y 1 r n 1 s y s y 2 n m y m y 2 n 1 s y 2 n 1 s y 2 2 n 2 s y s y r 1 n 1 s y 2 s y 2 2 s y 2 s y n m y m y 2 n 1 s y 2 n 1 s y 2 2 n 2 s y s y r 1 n 1 s y 2 n 1 s y 2 2 n 1 s y 2 s y n m y m y 2 n 1 s y 2 2 n 2 s y s y r n 1 s y 2 n m y m y 2 n 1 s y 2 this leaves us with the following expression for the r 2 and thus nse b3 r 2 2 s y s y r s y s y 2 n n 1 m y m y s y 2 this concludes the derivation appendix c description of multivariate parameter uncertainty the confidence regions described by the expression in eq 27 can also be inferred by other means in this appendix we consider two other approaches besides the bootstrap method described in the main text the first of these alternative methods uses contouring of the gls objective function consider the gls objective function in eq 17 c1 f gls θ e θ σ 1 e θ which may also be written as follows c2 f gls θ we θ we θ ε θ ε θ where w σ 1 2 signifies the n n weight matrix and ε θ ε 1 θ ε 2 θ ε n θ denotes the n 1 vector of homogenized and or decorrelated residuals now we expect that if θ θ then the n squared entries of ε θ should on average have a value of unity as a result f gls θ should follow a chi square distribution with n p degrees of freedom hence f gls θ d χ n p 2 with expected value e ε θ ε θ n p any deviation of the parameters from θ will increase the value of f gls θ from its expected minimum of n p the larger this increment the lesser the support for the parameter values θ by the training data y the tolerable increment δ f gls from n p for a desired confidence level γ equals press et al 1992 c3 δ f gls γ f χ 2 1 p γ p where f χ 2 1 p γ p signifies the inverse of the chi square cumulative distribution function cdf with p degrees of freedom at the critical value p γ γ now we discretize the parameter space in uniform intervals and evaluate the objective function f gls θ at each grid point all points θ with f gls θ f gls θ δ f gls γ will make up the 100 γ confidence region of the parameters see fig 11 c as second approach we consider monte carlo simulation this approach necessitates the use of a prior distribution and a likelihood function to be commensurate with the gls objective function we must specify a uninformative prior distribution for the slope and intercept a and b and use the following formulation of the log likelihood function l θ σ 2 y v c4 l θ σ 2 y v n 2 log 2 π 1 2 log σ 2 v 1 2 e θ σ 2 v 1 e θ where signifies the determinant operator and σ 2 is the estimate of the population variance of the measurement errors to be comparable with our gls implementation we must infer its value jointly with those of the coefficients a and b of the linear regression function we use markov chain monte carlo simulation with the dream algorithm vrugt et al 2009 to determine the trivariate posterior distribution of θ a b and σ 2 fig 11d presents the bivariate distribution of the slope and intercept as expected not shown the marginal distribution of σ 2 follows a scaled chi square distribution with n p degrees of freedom see eq 25 
3156,this work presents a novel method to calculate the distributed water depth and flow velocity of heavy rainfall induced stormwater runoff although the shallow water equations or other numerical models are often employed to deal with the calculation of distributed water depth and flow velocity of runoff it still suffers from low computational efficiency due to low convergence this restricts its applicability to early warning of geological disasters floods and debris flows the novel method proposed in this work fully integrates the conceptual hydrological model and hydrodynamic model and gives full play to the advantages of both in the novel method based on the two equivalence relations between the hydrological model and the hydrodynamic model i e the discharge at the boundary of the catchment and the total water storage in the catchment calculated by the two models should be equal at all times a governing equation in ordinary differential equation ode form of stormwater runoff simulation is obtained named distributed runoff model drm the effectiveness and practicality of the drm have been verified by three validation systems results indicate that the drm can calculate distributed water depth and flow velocity of heavy rainfall induced stormwater runoff with a low degree of difficulty and a high degree of accuracy and efficiency keywords stormwater runoff water depth flow velocity hydrological model hydrodynamic model 1 introduction runoff produced by heavy rainfall has always been considered as the main cause of floods debris flows and other geological disasters the distributed water depth and flow velocity of runoff are indispensable key parameters to evaluate the occurrence time and location of these disasters in july 2021 many places of the world especially the henan province of china and the rheinland pfalz region of germany have encountered extreme rainfall events according to the reports floods and debris flows caused by heavy rainfall claimed at least 300 lives in henan sohu 2021 and almost 200 lives in germany rauwald 2021 particularly in henan 14 531 600 people were affected residents were in trouble since they did not pay enough attention to the weather forecast and thus failed to transfer in time the main reason is that people lack an intuitive understanding of the relationship between the rainfall intensity and flood as rainfall intensity is indirect information rather than the direct information e g water depth and flow velocity therefore water depth and flow velocity of heavy rainfall induced runoff stormwater are indispensable key information for the residents to evaluate the disaster situation and designate an evacuation plan many scholars have made great efforts to establish the link between rainfall and runoff e g murakami et al 2004 singh et al 2014 wei et al 2017 moreno rodenas et al 2018 lian et al 2020 yin et al 2021 among them the two most well known different technical routes are the hydrological model and hydrodynamic model the hydrological model is based on statistical analysis to establish the relationship between the total amount of outflow and the rainfall history as well as the basin area for example xin anjiang model hao et al 2018 tank model song et al 2019 watflood model unduche et al 2018 and hec hms model tassew et al 2019 these models are often used to obtain the discharge rate of the downstream section however the hydrological model has a significant defect that it has limitations to give two important hydraulic parameters i e water depth and flow velocity in flood warning pollutant diffusion assessment carbon dioxide emissions analysis etc water depth and flow velocity are two very important hydraulic parameters in another way the hydrodynamic model established by the laws of momentum and mass conservation has the following three forms saint venant equation in one dimension 1d köhne et al 2011 yu et al 2020 the shallow water equations in two dimensions 2d liu et al 2021 and integrated equation of runoff and seepage in three dimensions 3d weill et al 2009 many scholars have made great efforts to achieve efficient solution of 2d shallow water equations for example yu and chang 2021 presented an accurate and efficient finite volume approach for overland flow modelling in rural and urban areas through solving the 2d shallow water equations in the entire computational domain they used a low accuracy high efficiency scheme the rusanov scheme in regular flows and a high accuracy low efficiency scheme the hllc scheme in strong discontinuous flows xia and liang 2018 proposed a new efficient implicit scheme for discretizing the rigid friction term in the 2d shallow water equations to improve the computational efficiency of the runoff simulation liu et al 2021 proposed a lattice boltzmann lb model for a class of viscous shallow water equations in which they used a second order moment of the source term to recover the viscosity in the governing equation and they found that the second order moment of the source term can improve the accuracy of the lb model and ensure the conservation of the system vacondio et al 2017 proposed a gpu parallel numerical model based on a new block uniform quadtree buq grid which greatly improved the computational efficiency of shallow water equations in river simulation while due to the time step is still limited the calculation speed of the model using buq grid still needs to be further improved at present the real applications of 2d shallow water equations also suffer from the following problems 1 the increase of the computational domain and or the degree of dispersion will greatly increase the difficulty of solving partial differential equations 2 when the underlying surface of the watershed is complex the water flow is easily affected by terrain fluctuations resulting in the appearance of local distortion of flows and the collapse of the model it leads to low calculation efficiency of the actual runoff analysis in the wide mountainous area resulting in its inability to meet the timeliness requirements of flood warning rengers et al 2016 to solve the above mentioned problems hydrological and hydrodynamic coupling models have been receiving the increasing attention of scholars thompson et al 2004 bell et al 2005 lian et al 2007 betrie et al 2011 paiva et al 2011 ali et al 2012 waseem et al 2020 de arruda gomes et al 2021 however most of the above mentioned studies use the calculation results discharge rate of the hydrological model as the driving condition of the hydrodynamic model at some specific river nodes or channel locations without the fully coupled mathematical expression of hydrology and hydrodynamics this makes it difficult for ordinary administrators or field engineers to repeatedly operate these complex and computationally intensive models in a short period to make a timely assessment and early warning of floods in the locations that they concern therefore the purpose of this research is to establish a simple and practical method to greatly reduce the calculation difficulty and improve the calculation efficiency while meeting the requirements of the accuracy of the results this will enable the local government managers with weak research backgrounds or field engineers who do not have good computing equipment to make reasonable decisions for the early warning of floods and the evacuation of residents in an emergency situation 2 theory assuming that a catchment is a black box model a conceptual hydrological model is established fig 1 according to the law of conservation of mass the variation of the average storage water depth in the black box is 1 dh dt r i q 2 q q a and i f h where h is the average storage water depth mm q is the outlet rate of the catchment mm h if h l q 0 if h l q 0 r is the rainfall intensity mm h t is the time s l is outlet height mm i is the average infiltration in the catchment mm h f is the average infiltration rate in the catchment 1 h q is the total discharge at p point in fig 1 b m3 s a is the catchment area km2 the relationship between section outflow and runoff depth can be calculated according to the kinematic wave hydrodynamic model köhne et al 2011 3 h x t q 1 x l r i 4 q 1 x a h x m i n which a s n m where h x indicates the average water depth at the x section m nm indicates the average manning s roughness coefficient s m1 3 q 1 x indicates the average line outflow rate at the x section m2 s s indicates the slope gradient 1 l indicates the distance coordinate m on the slope m takes a value of 5 3 from eq 2 the total discharge q x of x section is equal to the conceptual outlet rate corresponding to the x section qx multiplied by the upstream catchment area a x 5 q x q x a x according to the kinematic wave hydrodynamic model the total discharge q x of x section is equal to the average line outflow rate q 1 x multiplied by the x section width b x as shown in fig 2 then the eq 5 is 6 q 1 x b x q x q x a x then substituting eq 4 into eq 6 can be obtained 7 s n m h x 5 3 b x q x a x after transformation 8 h x q x a x b x n m s 0 6 that is 9 h x n m s 0 6 q x 0 6 a x b x 0 6 then multiply both sides of eq 9 by the x section width b x and integrate the function 10 0 x h x b x d x 0 x n m s 0 6 q x 0 6 a x b x 0 6 b x d x from the black box model the upstream average storage water depth is hx which can be obtained by the law of conservation of mass 11 0 x h x b x d x h x a x then simultaneous eq 10 and eq 11 can be obtained 12 h x n m s 0 6 q x 0 6 0 x a x b x 0 6 b x d x a x then assume that the complex term in eq 12 is 13 0 x a x b x 0 6 b x d x a x b a x c where b and c are fitting parameters then eq 12 becomes 14 h x n m s 0 6 q x 0 6 b a x c simultaneous eq 1 and eq 14 and a fully coupled hydrology hydrodynamic model can be obtained 15 d h x dt r i q x h x n m s 0 6 q x 0 6 b a x c according to the kinematic wave hydrodynamic model the flow velocity v x at the section can be calculated by the water depth h x 16 v x s p n m h x 2 3 where sp is the slope gradient at the calculation point 1 finally the complete calculation equation of water depth and flow velocity at any position is as follows 17 d h x dt r i q x h x n m s 0 6 q x 0 6 b a x c h x n m s 0 6 k q x 0 6 a x b x 0 6 v x s p n m h x 2 3 where k is an assumed adjustment coefficient to comprehensively reflect the differences in slope vegetation and rainfall in the actual catchment area qx is the outlet rate at the x section m s if hx l qx 0 if hx l qx 0 it is noted that hx and qx mean the average water depth and outlet rate corresponding to the x section and they are not related to topographical factors as shown in fig 1 a relatively h x v x a x and b x are a function of x which are related to topographical factors therefore the expressions of these parameters are different the proposed fully coupled hydrology hydrodynamic model can be employed to deal with the calculation of water depth and flow velocity of runoff at any position as long as the upstream catchment area a x and rainfall history r corresponding to that location is known therefore it was named distributed runoff model drm the effectiveness and practicality of drm have been verified by test results and three other methods i e shallow water equations integrated watershed model and iterative cross coupled model of surface and subsurface flow 3 existing material and methods 3 1 shallow water equations of runoff the governing equations of 2d shallow water model for calculating water depth and flow velocity are as follows more details are discussed by zhu et al 2020 18 h t h u x h v y r i 19 u h t h u 2 1 2 g h 2 x h u v y h g h z x h g s fx 20 v h t h u v x h v 2 1 2 g h 2 y h g h z y h g s fy where u is flow velocity in x direction m s v is flow velocity in y direction m s g is the gravitational acceleration m s2 z is the elevation m sfx and sfy are the friction slope term 1 3 2 integrated watershed model of runoff and seepage the governing equation of the integrated watershed model of runoff and seepage is as follows more details are discussed by mori et al 2015 21 m p q ϕ s p t p w a t e r a i r where q is the volumetric flux m3 m3 s sp is fluid saturation of p phase water w or air a sw sa 1 φ is the effective porosity m3 m3 mp is the fluid mass flux of p phase m s which is as follows runoff 22 m w h 2 3 n m s h z 23 m a k s k r a ρ a g ψ a seepage 24 m p k s k r p ρ p g ψ p where ρp is the density of p phase kg m3 kr p is relative hydraulic conductivity of p phase 1 ks is saturated hydraulic conductivity m s ψp is the potential of p phase pa 3 3 iterative cross coupled model of runoff and seepage zhu et al 2020 proposed an iterative cross coupled model for simulating runoff and seepage by using diffusion wave approximation and 3d richards s equation richards 1931 as follows more details are discussed by zhu et al 2020 25 h t h 5 3 n m s h z r i 26 k s k r h p z q w c m s e s c h p t where cm is specific moisture capacity m 1 sc is specific storage coefficient m 1 se is the effective degree of saturation 1 hp is pressure head m kr is relative hydraulic conductivity 1 ks is saturated hydraulic conductivity m s qw is sink and source of water s 1 4 results 4 1 validation of drm by abdul and gillham system in this section the experimental system presented by abdul and gillham 1984 as illustrated in fig 3 a was selected to validate the applicability of drm in the validation system the applied rainfall intensity is 43 2 mm h and the duration is 20 min to verify the correctness of drm except the measured data the experimental system is also employed in the integrated watershed model and iterative cross coupled model of runoff and seepage among them the integrated watershed model is simulated by getflows getflows 2014 and the iterative cross coupled model is simulated by comsol multiphysics comsol multiphysics 2018 the values of the drm parameters used in the abdul and gillham system are listed in table 1 due to the high groundwater level as shown in fig 3 a the soil above the groundwater level is almost saturated thus the drm does not consider the infiltration while comsol and getflows consider the infiltration and the exfiltration the infiltration is almost equal to the exfiltration the simulation results of the normalized flux of outflow the ratio of outflow flux to inflow flux are plotted in fig 3 b from fig 3 b it can be seen that there is a good agreement between the drm calculation results and those calculated by comsol and getflows all of them can reflect the continuous increase of runoff at the beginning of the rainfall event and the sharp but sustained decline of runoff after the cessation of rainfall the notable difference in the part enclosed by the purple dashed line as shown in fig 3 b is believed to be caused by the existence of pore air the existence of pore air even if its content is very small could discourage the infiltration process weill et al 2009 while this effect is not considered in drm and numerical simulations this makes the exit runoff flux curve obtained from the experiment rises more slowly and drops more quickly accordingly by using the abdul and gillham system the effectiveness of drm on the scale of the test chamber the catchment area is 0 112 10 6 km2 has been well verified 4 2 validation of drm by the extensively used tilted impermeable v catchment system in section 4 1 the effectiveness of drm on the small scale has been well verified its applicability also should be checked on the large scale for example on the catchment scale indeed the real role of drm is to play on a larger scale of catchment area rather than in a small test box therefore a tilted impermeable v catchment system that was designed by di giammarco et al 1996 is selected to validate the effectiveness of drm as displayed in fig 4 a the area of the impermeable catchment system is 1 62 km2 which is satisfactory for the requirements on the catchment scale the slope gradient and manning s roughness coefficient are shown in fig 4 a the applied rainfall rate is 3 10 6 m s and the duration is 1 5 h the total time of the test and simulations is 3 h table 2 lists the values of the drm parameters used in the v catchment system fig 4 b shows the comparison of calculation results simulation results and measurement data of the channel outflow the calculation results obtained from drm are compared with the measurement data referred to di giammarco et al 1996 and the simulation results outputted from comsol and getflows and other simulation results referred to tian and liu 2011 and kollet and maxwell 2006 fig 4 b shows that there is an obvious deviation in the original results curve of drm blue dash line with other curves of measurement data and simulation data it seems that the time of runoff water takes to flow and converge in a large scale catchment responds to a slow rise in discharge curve in the early period of rainfall i e the hysteresis effect caused by time and space this effect is well manifested by actual factors in the measurement or the flow process of runoff in numerical simulations of the commercial software as the hydrological model in drm replaces the momentum conservation equation in the hydrodynamic model the hysteresis effect caused by time and space is not reflected in the discharge curve this hysteresis effect has been artificially adjusted in drm results that is the original curve blue dash line is rightward shifted on the time axis and the hysteresis time of drm results is assumed to be 10 min in this system after considering the hysteresis effect the new results curve of drm blue solid line the measurement results and other simulation results maintain a good consistency although there are some neglectable minor differences furthermore drm shows a good performance in the rapid generation process of runoff during the early stage of the rainfall and the gradual dissipation process of runoff after the end of the rainfall accordingly it indicates that the drm is also applicable on the catchment scale beyond the experimental scale as discussed in section 4 1 although it does not consider the hysteresis effect of discharge caused by time and space on the catchment scale which needs to be adjusted artificially according to the catchment area 4 3 validation of drm by the impermeable conceptual slope model to further validate the effectiveness of drm in calculating distributed water depth and flow velocity of stormwater runoff an impermeable conceptual slope model was designed fig 5 the length of the slope model is set to 100 m and the width is set to 10 m the gradient of the slope surface is 0 1 the applied rainfall intensity is selected as the value recorded at nissho pass during typhoon no 10 in hokkaido japan from 2016 to 08 28 01 00 to 2016 08 31 24 00 with a total time of 96 h table 3 lists the drm parameters values used in the impermeable conceptual slope model the time dependent water depth and flow velocity at the toe of the slope and the distributed water depth and flow velocity along the slope surface at different times calculated by shallow water equations and drm are plotted in fig 6 fig 6 a and fig 6 b show that at the exit of the slope the water depth and flow velocity calculated by drm are almost completely identical with the simulation results of the shallow water equations at different times which shows that drm has a very high calculation accuracy furthermore fig 6 c and fig 6 d indicate that at different times the water depth distribution and flow velocity distribution along the slope surface calculated by drm are also consistent with that calculated by shallow water equations this means that the drm proposed in this study has the ability to calculate distributed runoff water depth and flow velocity which makes it has the application potential in a wide area catchment it is worth noting that the drm not only has high calculation accuracy it also has high calculation efficiency in the calculation and simulation process the simulation time of one hour 1 h one day 1d and three days 3d for the shallow water equations is 14 s 93 s and 517 s respectively while the calculation time for the drm is 3 s 12 s and 57 s as listed in table 4 the calculation efficiency of drm has increased by 78 6 87 1 and 89 0 respectively so the calculation efficiency has increased by 70 90 due to the simple terrain of the conceptual slope model the calculation efficiency of the shallow water equations is high for wide area mountainous areas terrain factors will cause the convergence of the shallow water equations to deteriorate sharply so that the improvement of the calculation efficiency for calculating distributed water depth and flow velocity will be more obvious by using drm more importantly in addition to high calculation accuracy and high calculation efficiency drm simplifies the partial differential equations pdes used in shallow water equations integrated watershed model and iterative cross coupled model of runoff and seepage for solving distributed water depth and flow velocity into ordinary differential equations odes typically due to the complexity of the solution process the pdes usually can only be solved by numerical simulations for the local government especially in some economically underdeveloped areas the staff in the department responsible for disaster early warning are often with weak research backgrounds and the field engineers often do not have good computing equipment therefore a simple and practical method to greatly reduce the difficulty of the calculation is precious and powerful e g odes which can even be calculated in excel by substituting δh δt for dh dt to get an approximate solution and improve the efficiency of calculation while meeting the requirements of the accuracy of the results therefore the advantages demonstrated by drm in the above mentioned aspects will make it very useful and powerful in the decision making for the early warning of floods and the evacuation of residents in an emergency situation 4 4 validation of drm by calculating runoff depth and flow velocity in a real catchment in the above sections the effectiveness of drm on the laboratory scale is well validated this section continues to discuss the reliability and applicability of drm in a real catchment scenario the target area is selected at the nissho pass hokkaido japan where suffered a typhoon no 10 in 2016 as shown in fig 7 a the investigation after typhoon no 10 found that the runoff produced by the torrential rain caused mountain floods and serious debris flows at nissho pass as shown in fig 7 b and c runoff analysis is performed in a small catchment area with 550 m in width and 850 m in length which is located upstream of the pekerebetsu river hokkaido japan in this small catchment area the observed precipitation peaked at 55 mm at 01 00 on august 31th 2016 and the maximum observed cumulative precipitation reached 488 mm as shown in fig 8 weather station data and terrain information used in this research are publicly available at the website of japan meteorological agency https www data jma go jp gmd risk obsdl index php and geospatial information authority of japan https www gsi go jp top html the simulation time is from 00 00 on august 28th 2016 to 23 00 on august 31st 2016 for a total of 96 h table 5 lists the drm parameters values used in the real catchment at nissho pass hokkaido japan the simulation results of runoff are compared with the results of two dimensional 2d impermeable plane flow simulation using nays2d flood solver of the iric software nays2d flood solver 2018 which takes shallow water equations as governing equations for simulating runoff for more simulation details refer to zhu et al 2018 an exploratory point point a in fig 9 a is selected to compare the water depth and flow velocity obtained from drm and iric the time dependent water depth and flow velocity at point a is shown in fig 9 b and c fig 9 b and c show that at point a the water depth and flow velocity calculated by drm are almost completely identical with the simulation results of the iric shallow water equations at different times which shows that drm still has a very high calculation accuracy on the real catchment scale 5 discussions although the drm proposed in this study simplifies the calculation of the water depth and flow velocity of runoff which greatly reduces the calculation difficulty and improves the calculation efficiency when integrating the eq 10 the spatial variability the manning s roughness coefficient nm and slope gradient s is not considered as shown in the derivation process of eq 10 to eq 12 instead their average value was used to avoid this puzzle in a larger catchment area the diversity of vegetation and topography will lead to significant flaws in this assumption in this case a more detailed discussion is needed to solve this problem furthermore in eq 13 the complex term related to the catchment area generated by integrating the eq 10 is assumed to be a power function of the catchment area although this assumption is well verified in a simple slope model as discussed in section 4 3 in complex terrain the validity of this assumption or whether there are other simplified assumption forms still awaits further discussion however despite the above mentioned shortcomings this study is still valuable and meaningful for the new ideas proposed for the timely early warning of floods evaluation of the migration of pollutants in the water and analysis of the transportation of sediment since water depth and flow velocity are the key parameters in these studies this study is firmly believed to be attractive and valuable for scholars engaged in these studies 6 conclusions a novel method drm to calculate the distributed water depth and flow velocity of heavy rainfall induced stormwater runoff under time dependent rainfall is proposed by fully coupling the conceptual hydrological model and hydrodynamic model the effectiveness and practicality of drm on different catchment scales i e 0 112 10 6 km2 1 10 3 km2 and 1 62 km2 have been verified by comparing with the test results and three other methods i e shallow water equations integrated watershed model and iterative cross coupled model of runoff and seepage results indicate that the drm proposed in this study greatly improves the calculation efficiency and reduces the calculation difficulty of the distributed water depth and flow velocity of the heavy rainfall induced stormwater runoff while meeting the accuracy requirements credit authorship contribution statement yulong zhu conceptualization methodology software validation formal analysis investigation data curation writing original draft writing review editing funding acquisition yafen zhang methodology validation investigation resources data curation writing review editing jiaqiang yang software investigation data curation writing review editing binh t nguyen methodology investigation data curation writing review editing yuankun wang writing review editing supervision project administration funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this work was financially supported by the fundamental research funds for the central universities of china 2021ms043 and 2021ms041 
3156,this work presents a novel method to calculate the distributed water depth and flow velocity of heavy rainfall induced stormwater runoff although the shallow water equations or other numerical models are often employed to deal with the calculation of distributed water depth and flow velocity of runoff it still suffers from low computational efficiency due to low convergence this restricts its applicability to early warning of geological disasters floods and debris flows the novel method proposed in this work fully integrates the conceptual hydrological model and hydrodynamic model and gives full play to the advantages of both in the novel method based on the two equivalence relations between the hydrological model and the hydrodynamic model i e the discharge at the boundary of the catchment and the total water storage in the catchment calculated by the two models should be equal at all times a governing equation in ordinary differential equation ode form of stormwater runoff simulation is obtained named distributed runoff model drm the effectiveness and practicality of the drm have been verified by three validation systems results indicate that the drm can calculate distributed water depth and flow velocity of heavy rainfall induced stormwater runoff with a low degree of difficulty and a high degree of accuracy and efficiency keywords stormwater runoff water depth flow velocity hydrological model hydrodynamic model 1 introduction runoff produced by heavy rainfall has always been considered as the main cause of floods debris flows and other geological disasters the distributed water depth and flow velocity of runoff are indispensable key parameters to evaluate the occurrence time and location of these disasters in july 2021 many places of the world especially the henan province of china and the rheinland pfalz region of germany have encountered extreme rainfall events according to the reports floods and debris flows caused by heavy rainfall claimed at least 300 lives in henan sohu 2021 and almost 200 lives in germany rauwald 2021 particularly in henan 14 531 600 people were affected residents were in trouble since they did not pay enough attention to the weather forecast and thus failed to transfer in time the main reason is that people lack an intuitive understanding of the relationship between the rainfall intensity and flood as rainfall intensity is indirect information rather than the direct information e g water depth and flow velocity therefore water depth and flow velocity of heavy rainfall induced runoff stormwater are indispensable key information for the residents to evaluate the disaster situation and designate an evacuation plan many scholars have made great efforts to establish the link between rainfall and runoff e g murakami et al 2004 singh et al 2014 wei et al 2017 moreno rodenas et al 2018 lian et al 2020 yin et al 2021 among them the two most well known different technical routes are the hydrological model and hydrodynamic model the hydrological model is based on statistical analysis to establish the relationship between the total amount of outflow and the rainfall history as well as the basin area for example xin anjiang model hao et al 2018 tank model song et al 2019 watflood model unduche et al 2018 and hec hms model tassew et al 2019 these models are often used to obtain the discharge rate of the downstream section however the hydrological model has a significant defect that it has limitations to give two important hydraulic parameters i e water depth and flow velocity in flood warning pollutant diffusion assessment carbon dioxide emissions analysis etc water depth and flow velocity are two very important hydraulic parameters in another way the hydrodynamic model established by the laws of momentum and mass conservation has the following three forms saint venant equation in one dimension 1d köhne et al 2011 yu et al 2020 the shallow water equations in two dimensions 2d liu et al 2021 and integrated equation of runoff and seepage in three dimensions 3d weill et al 2009 many scholars have made great efforts to achieve efficient solution of 2d shallow water equations for example yu and chang 2021 presented an accurate and efficient finite volume approach for overland flow modelling in rural and urban areas through solving the 2d shallow water equations in the entire computational domain they used a low accuracy high efficiency scheme the rusanov scheme in regular flows and a high accuracy low efficiency scheme the hllc scheme in strong discontinuous flows xia and liang 2018 proposed a new efficient implicit scheme for discretizing the rigid friction term in the 2d shallow water equations to improve the computational efficiency of the runoff simulation liu et al 2021 proposed a lattice boltzmann lb model for a class of viscous shallow water equations in which they used a second order moment of the source term to recover the viscosity in the governing equation and they found that the second order moment of the source term can improve the accuracy of the lb model and ensure the conservation of the system vacondio et al 2017 proposed a gpu parallel numerical model based on a new block uniform quadtree buq grid which greatly improved the computational efficiency of shallow water equations in river simulation while due to the time step is still limited the calculation speed of the model using buq grid still needs to be further improved at present the real applications of 2d shallow water equations also suffer from the following problems 1 the increase of the computational domain and or the degree of dispersion will greatly increase the difficulty of solving partial differential equations 2 when the underlying surface of the watershed is complex the water flow is easily affected by terrain fluctuations resulting in the appearance of local distortion of flows and the collapse of the model it leads to low calculation efficiency of the actual runoff analysis in the wide mountainous area resulting in its inability to meet the timeliness requirements of flood warning rengers et al 2016 to solve the above mentioned problems hydrological and hydrodynamic coupling models have been receiving the increasing attention of scholars thompson et al 2004 bell et al 2005 lian et al 2007 betrie et al 2011 paiva et al 2011 ali et al 2012 waseem et al 2020 de arruda gomes et al 2021 however most of the above mentioned studies use the calculation results discharge rate of the hydrological model as the driving condition of the hydrodynamic model at some specific river nodes or channel locations without the fully coupled mathematical expression of hydrology and hydrodynamics this makes it difficult for ordinary administrators or field engineers to repeatedly operate these complex and computationally intensive models in a short period to make a timely assessment and early warning of floods in the locations that they concern therefore the purpose of this research is to establish a simple and practical method to greatly reduce the calculation difficulty and improve the calculation efficiency while meeting the requirements of the accuracy of the results this will enable the local government managers with weak research backgrounds or field engineers who do not have good computing equipment to make reasonable decisions for the early warning of floods and the evacuation of residents in an emergency situation 2 theory assuming that a catchment is a black box model a conceptual hydrological model is established fig 1 according to the law of conservation of mass the variation of the average storage water depth in the black box is 1 dh dt r i q 2 q q a and i f h where h is the average storage water depth mm q is the outlet rate of the catchment mm h if h l q 0 if h l q 0 r is the rainfall intensity mm h t is the time s l is outlet height mm i is the average infiltration in the catchment mm h f is the average infiltration rate in the catchment 1 h q is the total discharge at p point in fig 1 b m3 s a is the catchment area km2 the relationship between section outflow and runoff depth can be calculated according to the kinematic wave hydrodynamic model köhne et al 2011 3 h x t q 1 x l r i 4 q 1 x a h x m i n which a s n m where h x indicates the average water depth at the x section m nm indicates the average manning s roughness coefficient s m1 3 q 1 x indicates the average line outflow rate at the x section m2 s s indicates the slope gradient 1 l indicates the distance coordinate m on the slope m takes a value of 5 3 from eq 2 the total discharge q x of x section is equal to the conceptual outlet rate corresponding to the x section qx multiplied by the upstream catchment area a x 5 q x q x a x according to the kinematic wave hydrodynamic model the total discharge q x of x section is equal to the average line outflow rate q 1 x multiplied by the x section width b x as shown in fig 2 then the eq 5 is 6 q 1 x b x q x q x a x then substituting eq 4 into eq 6 can be obtained 7 s n m h x 5 3 b x q x a x after transformation 8 h x q x a x b x n m s 0 6 that is 9 h x n m s 0 6 q x 0 6 a x b x 0 6 then multiply both sides of eq 9 by the x section width b x and integrate the function 10 0 x h x b x d x 0 x n m s 0 6 q x 0 6 a x b x 0 6 b x d x from the black box model the upstream average storage water depth is hx which can be obtained by the law of conservation of mass 11 0 x h x b x d x h x a x then simultaneous eq 10 and eq 11 can be obtained 12 h x n m s 0 6 q x 0 6 0 x a x b x 0 6 b x d x a x then assume that the complex term in eq 12 is 13 0 x a x b x 0 6 b x d x a x b a x c where b and c are fitting parameters then eq 12 becomes 14 h x n m s 0 6 q x 0 6 b a x c simultaneous eq 1 and eq 14 and a fully coupled hydrology hydrodynamic model can be obtained 15 d h x dt r i q x h x n m s 0 6 q x 0 6 b a x c according to the kinematic wave hydrodynamic model the flow velocity v x at the section can be calculated by the water depth h x 16 v x s p n m h x 2 3 where sp is the slope gradient at the calculation point 1 finally the complete calculation equation of water depth and flow velocity at any position is as follows 17 d h x dt r i q x h x n m s 0 6 q x 0 6 b a x c h x n m s 0 6 k q x 0 6 a x b x 0 6 v x s p n m h x 2 3 where k is an assumed adjustment coefficient to comprehensively reflect the differences in slope vegetation and rainfall in the actual catchment area qx is the outlet rate at the x section m s if hx l qx 0 if hx l qx 0 it is noted that hx and qx mean the average water depth and outlet rate corresponding to the x section and they are not related to topographical factors as shown in fig 1 a relatively h x v x a x and b x are a function of x which are related to topographical factors therefore the expressions of these parameters are different the proposed fully coupled hydrology hydrodynamic model can be employed to deal with the calculation of water depth and flow velocity of runoff at any position as long as the upstream catchment area a x and rainfall history r corresponding to that location is known therefore it was named distributed runoff model drm the effectiveness and practicality of drm have been verified by test results and three other methods i e shallow water equations integrated watershed model and iterative cross coupled model of surface and subsurface flow 3 existing material and methods 3 1 shallow water equations of runoff the governing equations of 2d shallow water model for calculating water depth and flow velocity are as follows more details are discussed by zhu et al 2020 18 h t h u x h v y r i 19 u h t h u 2 1 2 g h 2 x h u v y h g h z x h g s fx 20 v h t h u v x h v 2 1 2 g h 2 y h g h z y h g s fy where u is flow velocity in x direction m s v is flow velocity in y direction m s g is the gravitational acceleration m s2 z is the elevation m sfx and sfy are the friction slope term 1 3 2 integrated watershed model of runoff and seepage the governing equation of the integrated watershed model of runoff and seepage is as follows more details are discussed by mori et al 2015 21 m p q ϕ s p t p w a t e r a i r where q is the volumetric flux m3 m3 s sp is fluid saturation of p phase water w or air a sw sa 1 φ is the effective porosity m3 m3 mp is the fluid mass flux of p phase m s which is as follows runoff 22 m w h 2 3 n m s h z 23 m a k s k r a ρ a g ψ a seepage 24 m p k s k r p ρ p g ψ p where ρp is the density of p phase kg m3 kr p is relative hydraulic conductivity of p phase 1 ks is saturated hydraulic conductivity m s ψp is the potential of p phase pa 3 3 iterative cross coupled model of runoff and seepage zhu et al 2020 proposed an iterative cross coupled model for simulating runoff and seepage by using diffusion wave approximation and 3d richards s equation richards 1931 as follows more details are discussed by zhu et al 2020 25 h t h 5 3 n m s h z r i 26 k s k r h p z q w c m s e s c h p t where cm is specific moisture capacity m 1 sc is specific storage coefficient m 1 se is the effective degree of saturation 1 hp is pressure head m kr is relative hydraulic conductivity 1 ks is saturated hydraulic conductivity m s qw is sink and source of water s 1 4 results 4 1 validation of drm by abdul and gillham system in this section the experimental system presented by abdul and gillham 1984 as illustrated in fig 3 a was selected to validate the applicability of drm in the validation system the applied rainfall intensity is 43 2 mm h and the duration is 20 min to verify the correctness of drm except the measured data the experimental system is also employed in the integrated watershed model and iterative cross coupled model of runoff and seepage among them the integrated watershed model is simulated by getflows getflows 2014 and the iterative cross coupled model is simulated by comsol multiphysics comsol multiphysics 2018 the values of the drm parameters used in the abdul and gillham system are listed in table 1 due to the high groundwater level as shown in fig 3 a the soil above the groundwater level is almost saturated thus the drm does not consider the infiltration while comsol and getflows consider the infiltration and the exfiltration the infiltration is almost equal to the exfiltration the simulation results of the normalized flux of outflow the ratio of outflow flux to inflow flux are plotted in fig 3 b from fig 3 b it can be seen that there is a good agreement between the drm calculation results and those calculated by comsol and getflows all of them can reflect the continuous increase of runoff at the beginning of the rainfall event and the sharp but sustained decline of runoff after the cessation of rainfall the notable difference in the part enclosed by the purple dashed line as shown in fig 3 b is believed to be caused by the existence of pore air the existence of pore air even if its content is very small could discourage the infiltration process weill et al 2009 while this effect is not considered in drm and numerical simulations this makes the exit runoff flux curve obtained from the experiment rises more slowly and drops more quickly accordingly by using the abdul and gillham system the effectiveness of drm on the scale of the test chamber the catchment area is 0 112 10 6 km2 has been well verified 4 2 validation of drm by the extensively used tilted impermeable v catchment system in section 4 1 the effectiveness of drm on the small scale has been well verified its applicability also should be checked on the large scale for example on the catchment scale indeed the real role of drm is to play on a larger scale of catchment area rather than in a small test box therefore a tilted impermeable v catchment system that was designed by di giammarco et al 1996 is selected to validate the effectiveness of drm as displayed in fig 4 a the area of the impermeable catchment system is 1 62 km2 which is satisfactory for the requirements on the catchment scale the slope gradient and manning s roughness coefficient are shown in fig 4 a the applied rainfall rate is 3 10 6 m s and the duration is 1 5 h the total time of the test and simulations is 3 h table 2 lists the values of the drm parameters used in the v catchment system fig 4 b shows the comparison of calculation results simulation results and measurement data of the channel outflow the calculation results obtained from drm are compared with the measurement data referred to di giammarco et al 1996 and the simulation results outputted from comsol and getflows and other simulation results referred to tian and liu 2011 and kollet and maxwell 2006 fig 4 b shows that there is an obvious deviation in the original results curve of drm blue dash line with other curves of measurement data and simulation data it seems that the time of runoff water takes to flow and converge in a large scale catchment responds to a slow rise in discharge curve in the early period of rainfall i e the hysteresis effect caused by time and space this effect is well manifested by actual factors in the measurement or the flow process of runoff in numerical simulations of the commercial software as the hydrological model in drm replaces the momentum conservation equation in the hydrodynamic model the hysteresis effect caused by time and space is not reflected in the discharge curve this hysteresis effect has been artificially adjusted in drm results that is the original curve blue dash line is rightward shifted on the time axis and the hysteresis time of drm results is assumed to be 10 min in this system after considering the hysteresis effect the new results curve of drm blue solid line the measurement results and other simulation results maintain a good consistency although there are some neglectable minor differences furthermore drm shows a good performance in the rapid generation process of runoff during the early stage of the rainfall and the gradual dissipation process of runoff after the end of the rainfall accordingly it indicates that the drm is also applicable on the catchment scale beyond the experimental scale as discussed in section 4 1 although it does not consider the hysteresis effect of discharge caused by time and space on the catchment scale which needs to be adjusted artificially according to the catchment area 4 3 validation of drm by the impermeable conceptual slope model to further validate the effectiveness of drm in calculating distributed water depth and flow velocity of stormwater runoff an impermeable conceptual slope model was designed fig 5 the length of the slope model is set to 100 m and the width is set to 10 m the gradient of the slope surface is 0 1 the applied rainfall intensity is selected as the value recorded at nissho pass during typhoon no 10 in hokkaido japan from 2016 to 08 28 01 00 to 2016 08 31 24 00 with a total time of 96 h table 3 lists the drm parameters values used in the impermeable conceptual slope model the time dependent water depth and flow velocity at the toe of the slope and the distributed water depth and flow velocity along the slope surface at different times calculated by shallow water equations and drm are plotted in fig 6 fig 6 a and fig 6 b show that at the exit of the slope the water depth and flow velocity calculated by drm are almost completely identical with the simulation results of the shallow water equations at different times which shows that drm has a very high calculation accuracy furthermore fig 6 c and fig 6 d indicate that at different times the water depth distribution and flow velocity distribution along the slope surface calculated by drm are also consistent with that calculated by shallow water equations this means that the drm proposed in this study has the ability to calculate distributed runoff water depth and flow velocity which makes it has the application potential in a wide area catchment it is worth noting that the drm not only has high calculation accuracy it also has high calculation efficiency in the calculation and simulation process the simulation time of one hour 1 h one day 1d and three days 3d for the shallow water equations is 14 s 93 s and 517 s respectively while the calculation time for the drm is 3 s 12 s and 57 s as listed in table 4 the calculation efficiency of drm has increased by 78 6 87 1 and 89 0 respectively so the calculation efficiency has increased by 70 90 due to the simple terrain of the conceptual slope model the calculation efficiency of the shallow water equations is high for wide area mountainous areas terrain factors will cause the convergence of the shallow water equations to deteriorate sharply so that the improvement of the calculation efficiency for calculating distributed water depth and flow velocity will be more obvious by using drm more importantly in addition to high calculation accuracy and high calculation efficiency drm simplifies the partial differential equations pdes used in shallow water equations integrated watershed model and iterative cross coupled model of runoff and seepage for solving distributed water depth and flow velocity into ordinary differential equations odes typically due to the complexity of the solution process the pdes usually can only be solved by numerical simulations for the local government especially in some economically underdeveloped areas the staff in the department responsible for disaster early warning are often with weak research backgrounds and the field engineers often do not have good computing equipment therefore a simple and practical method to greatly reduce the difficulty of the calculation is precious and powerful e g odes which can even be calculated in excel by substituting δh δt for dh dt to get an approximate solution and improve the efficiency of calculation while meeting the requirements of the accuracy of the results therefore the advantages demonstrated by drm in the above mentioned aspects will make it very useful and powerful in the decision making for the early warning of floods and the evacuation of residents in an emergency situation 4 4 validation of drm by calculating runoff depth and flow velocity in a real catchment in the above sections the effectiveness of drm on the laboratory scale is well validated this section continues to discuss the reliability and applicability of drm in a real catchment scenario the target area is selected at the nissho pass hokkaido japan where suffered a typhoon no 10 in 2016 as shown in fig 7 a the investigation after typhoon no 10 found that the runoff produced by the torrential rain caused mountain floods and serious debris flows at nissho pass as shown in fig 7 b and c runoff analysis is performed in a small catchment area with 550 m in width and 850 m in length which is located upstream of the pekerebetsu river hokkaido japan in this small catchment area the observed precipitation peaked at 55 mm at 01 00 on august 31th 2016 and the maximum observed cumulative precipitation reached 488 mm as shown in fig 8 weather station data and terrain information used in this research are publicly available at the website of japan meteorological agency https www data jma go jp gmd risk obsdl index php and geospatial information authority of japan https www gsi go jp top html the simulation time is from 00 00 on august 28th 2016 to 23 00 on august 31st 2016 for a total of 96 h table 5 lists the drm parameters values used in the real catchment at nissho pass hokkaido japan the simulation results of runoff are compared with the results of two dimensional 2d impermeable plane flow simulation using nays2d flood solver of the iric software nays2d flood solver 2018 which takes shallow water equations as governing equations for simulating runoff for more simulation details refer to zhu et al 2018 an exploratory point point a in fig 9 a is selected to compare the water depth and flow velocity obtained from drm and iric the time dependent water depth and flow velocity at point a is shown in fig 9 b and c fig 9 b and c show that at point a the water depth and flow velocity calculated by drm are almost completely identical with the simulation results of the iric shallow water equations at different times which shows that drm still has a very high calculation accuracy on the real catchment scale 5 discussions although the drm proposed in this study simplifies the calculation of the water depth and flow velocity of runoff which greatly reduces the calculation difficulty and improves the calculation efficiency when integrating the eq 10 the spatial variability the manning s roughness coefficient nm and slope gradient s is not considered as shown in the derivation process of eq 10 to eq 12 instead their average value was used to avoid this puzzle in a larger catchment area the diversity of vegetation and topography will lead to significant flaws in this assumption in this case a more detailed discussion is needed to solve this problem furthermore in eq 13 the complex term related to the catchment area generated by integrating the eq 10 is assumed to be a power function of the catchment area although this assumption is well verified in a simple slope model as discussed in section 4 3 in complex terrain the validity of this assumption or whether there are other simplified assumption forms still awaits further discussion however despite the above mentioned shortcomings this study is still valuable and meaningful for the new ideas proposed for the timely early warning of floods evaluation of the migration of pollutants in the water and analysis of the transportation of sediment since water depth and flow velocity are the key parameters in these studies this study is firmly believed to be attractive and valuable for scholars engaged in these studies 6 conclusions a novel method drm to calculate the distributed water depth and flow velocity of heavy rainfall induced stormwater runoff under time dependent rainfall is proposed by fully coupling the conceptual hydrological model and hydrodynamic model the effectiveness and practicality of drm on different catchment scales i e 0 112 10 6 km2 1 10 3 km2 and 1 62 km2 have been verified by comparing with the test results and three other methods i e shallow water equations integrated watershed model and iterative cross coupled model of runoff and seepage results indicate that the drm proposed in this study greatly improves the calculation efficiency and reduces the calculation difficulty of the distributed water depth and flow velocity of the heavy rainfall induced stormwater runoff while meeting the accuracy requirements credit authorship contribution statement yulong zhu conceptualization methodology software validation formal analysis investigation data curation writing original draft writing review editing funding acquisition yafen zhang methodology validation investigation resources data curation writing review editing jiaqiang yang software investigation data curation writing review editing binh t nguyen methodology investigation data curation writing review editing yuankun wang writing review editing supervision project administration funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this work was financially supported by the fundamental research funds for the central universities of china 2021ms043 and 2021ms041 
3157,as low grade lithium li extraction technology improves li rich geothermal fluids may become an alternative li source in the future most geothermal springs in southern tibet china have notably high li contents but the fluids li origins and enrichment processes remain unclear therefore this study investigated the li enrichment mechanisms in the study area based on 307 hydrogeochemical data of thermal spring waters selected from the literature our findings confirm that most li enriched geothermal springs in southern tibet are chemically influenced by magma also k mg and chalcedony geothermometers estimates indicated that most of the springs originate from shallow reservoirs with temperatures below 200 c although some higher temperature deep reservoirs may exist beneath tibet moreover we found that two hydrochemical processes mainly resulted in the relatively high li concentrations in southern tibet s thermal fluids first magmatic li enrichment resulted from the semi molten state magma degassing rather than leaching from the surrounding rocks in the deeper reservoirs subsequent mixing of the li rich deep fluids with varying amounts of infiltrating groundwater formed the shallow reservoirs during ascent to the earth s surface resulting in the observed differences in li concentrations of the thermal springs from these reservoirs secondly evaporation further concentrated the li in the li rich geothermal springs in southern tibet resulting in higher li levels than in other magmatic thermal springs the present study could not establish the li source for the tibet thermal springs with low cl concentrations because they may mix with large amounts of infiltrating groundwater however it is more likely that magmatic li still accounts for a large portion of the total li keywords southern tibet lithium magma evaporation enrichment 1 introduction the advent of electric transportation has resulted in a growing demand for lithium li and more pressure on li resources at present li is mainly extracted from pegmatite type deposits and brine type deposits globally and the latter accounts for about 65 of the li resource kesler et al 2012 in china li pegmatite type deposits are mostly distributed in the sichuan jiangxi and xinjiang provinces while the brine type deposits are found in qinghai and tibet however researchers have established that geothermal activities are crucial for li rich brine since most li rich saline lakes are located around hydrothermal systems bradley et al 2013 wang et al 2020a munk et al 2011 also as li extraction technology improves low grade geothermal fluids may serve as an alternative li source so further study of lithium s hydrochemical processes and origins in hydrothermal systems is required lithium concentrations in geothermal fluids from different geothermal systems vary in china for instance the li concentration of the boiling spring dagunguo in the rehai geothermal area is 6 13 mg l guo and wang 2012 while the maximum post boiling li concentration in the thermal springs in the rekeng geothermal area located in the western part of sichuan province is 4 9 mg l li et al 2019 additionally for the low temperature convective systems located in china s southeast coastal areas e g zhangzhou and fengshun geothermal fields the li levels in the fluids are lower than 1 mg l unless they mix with seawater gan et al 2019 li et al 2018a again the li concentrations are low in the conductive geothermal systems located beneath the north china plain for instance most water samples collected from the deep wells in tianjin wumishan formation and kaifeng neogene system reservoirs have li concentrations lower than 1 mg l li et al 2022b liu 2014a globally there seems to be a good relationship between li and cl concentrations in geothermal fluids the li concentrations of the hot waters collected from deep granite reservoirs in europe are lower than 10 mg l unless the waters have extremely high cl concentrations michard 1990 the hydrochemical data of geothermal waters in taupo volcanic zone new zealand also showed that high li concentrations 10 mg l are always accompanied by high cl levels giggenbach 1995 also the neutral dilute geothermal waters collected from different icelandic and yellowstone national park geothermal areas have li concentrations lower than 1 mg l and 6 mg l while the li maximum concentration in seawater derived geothermal fluids from iceland is 14 15 mg l sanjuan et al 2014 ball et al 2010 however it is interesting that although diluted geothermal waters usually have relatively low li concentrations 10 mg l the thermal springs in tibet are particularly li rich despite some having relatively low cl and tds total dissolved solids contents tong et al 2000 the maximum li concentration in the geothermal springs from tibet is 239 mg l xianhaizi geothermal spring and the thermal springs of 19 geothermal systems have concentrations above 19 mg l wang et al 2020a thus in tibet not only the saline lakes but the li enriched geothermal springs could be potential lithium resources in the future li bearing rocks leaching is one of the important li origins for geothermal fluids a lithium isotopy study showed that equilibrium exchange with magmatic rocks at high temperature mainly controlled li and its isotopes in geothermal fluids in taupo volcanic zone new zealand millot et al 2012 in the appalachian plateau region usa the application of different hydrochemical methods established that water rock reactions enable lithium enrichment of the fluids from the paleozoic aged reservoirs macpherson 2015 also for the upper rhine graben geothermal brines in european areas water rock interaction processes at relatively high temperatures 120 c are the dominant source and control of these li rich deep fluids sanjuan et al 2022 again based on an h o li b and sr isotopy study yu et al 2022 proposed that li enrichment in brines from the upper cretaceous gypsum bearing clastic aquifers of the jitai basin in china was by water rock interactions involving lithian muscovites however the geothermal fluids li may not only originate from the water mineral reaction but has a magmatic origin wang et al 2020a li et al 2021 also analyzed the hydrochemical data of geothermal waters from nine thermal systems in felsic reservoirs in china and inferred that magma degassing could be an li source although the study could not conclude whether magma degassing is the primary source moreover wang et al 2020b concluded that magmatic water and the dissolution of felsic igneous rocks mainly contributed to li rb and cs in the geothermal fluid of the rehai geothermal area china the himalayan geothermal activity zone which hosts many geothermal systems belongs to the collision area of the indian and eurasian plates studies have shown that some geothermal systems in the region e g yangbajing daggyai rehai and kangding geothermal areas have a magma heat source cheng et al 2022 guo et al 2007 guo and wang 2012 li et al 2018b liu et al 2019 yet interestingly only the southern tibet geothermal springs are relatively li rich in tibet it has been inferred that the li enrichment of the cl type geothermal springs and the lakes near the yarlung zangbo suture is probably related to the partial crustal melting rather than the single leaching of the basement rocks zheng et al 1990 zhang et al 2015 however limited evidence exists to conclude that water rock reaction or magmatic degassing results in the relatively high li concentrations in the southern tibet geothermal springs also how the hydrothermal systems in the area generally concentrate li remains unclear therefore we studied further the tibet geothermal systems by analyzing the hydrochemical data of geothermal springs from a book named thermal springs in tibet tong et al 2000 to ascertain the li origin of the southern tibet thermal fluids and clarify the hydrochemical processes of li enrichment the study will contribute to the body of knowledge regarding geothermal lithium resource exploration and provide some theoretical foundation for assessing the lithium resource potential of hydrothermal systems 2 geothermal and geological setting 2 1 tectonic background in the tibet the himalayan geothermal zone belongs to the tibetan plateau which was formed by a collision of continental crusts between the eurasian and indian plates due to the mosaic collision and subduction between the two plates southern tibet has experienced a very complex tectonic evolution liao 2018 results of the indepth project indicated that there is a large hidden thrust strip i e the main himalayan thrust from the himalayan area to the yarlung zangbo suture extending more than 150 km and a several kilometers thick as shown in fig 1 b zhao et al 2002 the partial lower crust of the lhasa block in the northern asian plate was pushed by the main himalayan thrust from the south to the shallow area then a series of southward thrusts were formed from north to south during the continuous northward propulsion for the indian continent including the main boundary thrust mbt and the main central thrust mct see fig 1a b the mbt and mct appear to the south of the watershed of the himalayan mountain in nepal bhutan and india the main thrust planes of the himalayan thrust zone all dip to the north at low or intermediate angles and the thrusting took place between 23 5 and 16 8 ma during the early himalayan orogenic period liao 2018 the indepth project results also showed that the footwall of the thrust zone has been subducted northwards for 200 km reaching a depth of 15 km and a partial melting layer is recognized beneath the yarlung zangbo suture where the thickness of crust increases to 60 74 km zeng et al 1995 zhao et al 1997 based on tectonic interpretation of high resolution seismic tomographic images of the eastern qinghai tibet plateau as provided by zhao et al 2002 and illustrated in fig 1 b a low velocity belt with a depth lower than 100 km lies beneath the tanggula mountain suggesting the possible existence of a melting zone 2 2 the comparative geothermal setting among southern tibet rehai and kangding the locations and outlet temperatures of geothermal springs are shown in fig 1 c based on the outlet temperatures tibet can divide into four geothermal manifestation zones the high temperature geothermal springs are mostly located in southern tibet which has five main geothermal activity belts they include the geothermal activity belts of the yarlung zangbo river the yarlung zangbo valley the south of nyenchen tonglha mountains the northern tibet and the corner of the yarlung zangbo river and shiquan river the areas near the yarlung zangbo valley have the relatively strong geothermal activity and interestingly evidence from geophysical research yuan et al 1987 unsworth et al 2005 and seismic exploration nelson et al 1996 brown et al 1996 indicate that there exists a 5 km thick low resistivity or low velocity belt with an increasing depth of 15 20 km from south to north of the yarlung zangbo suture the belt can be regarded as semi molten state magma and is 27 km deep in yangbajain lu 1989 wei et al 2001 additionally along the nyemo yangbajain damshung areas in the south of nyaiqentanglha mountains the indepth project also found four deep reflection highlights inferred as semi molten state magma at depths ranging from 15 km to 20 km which could belong to the granitic magma chambers zhao et al 2002 liao 2018 therefore the semi molten state magma is possibly the heat source of some high temperature hydrothermal systems in the vicinity of the yarlung zangbo suture additionally due to the main compressive stress the e w extension of the tibetan crust began resulting in the formation of many north south grabens in the neogene as shown in fig 1 a the molten material intruded upwardly into some the graben and surrounding areas which may be the heat source of the high temperature geothermal systems around the yarlung zangbo suture liao 2018 in contrast the absence or disconnection of the melting layers may explain the relatively weak geothermal activity in the northern and central parts of tibet lu 1989 wei et al 2001 guo 2020 however there is limited evidence to explain the quaternary volcanic eruptions at all geothermal fields in the tibetan plateau tan et al 2014 currently only four hydrothermal areas of tibet i e yangbajain yangyi langjiu and nakqu northern part of tibet have geological surveys or geothermal production wells their reservoir lithologies are mainly granitic mylonite and granite biotite granite and biotite granite porphyry granite and sandstone respectively guo et al 2014 therefore it is more likely that most hydrothermal systems in southern tibet have acidic rocks reservoirs the present study compared the hydrochemical characteristics of the geothermal fluids in tibet with two high temperature magmatic geothermal systems i e the rehai and kangding geothermal areas because they have a similar geological background the rehai and kangding geothermal areas are both located in the east of the himalayan geothermal zone as shown in fig 1 c and the hydrochemical studies have shown that the geothermal springs in both places have mixed with different amounts of magmatic water guo and wang 2012 guo et al 2017a li et al 2018b in kangding the geothermal springs may be influenced chemically by the magma from the mantle via the xianshuihe fault a deep fracture that can reach the moho phase du et al 2006 tian and pang 2017 also magnetotelluric data revealed an underlying zone of partial melt with a 4 to 19 distribution range beneath the kangding geothermal field at a depth of 10 km cheng et al 2022 the magmatic rocks including presinian biotite granites and yanshannian granodiorites are exposed in the western and eastern parts of the kangding geothermal area respectively liu 2014b geophysical investigations indicated that the geothermal fluids of the main geothermal areas in kangding exist in the contact zone of invaded indosinian yanshanian period granite and permian metasandstone liu 2014b unlike kangding the rehai geothermal field located in the tengchong volcanic region has remarkable geothermal manifestations such as boiling springs fumaroles hydrothermal explosions and steaming ground volcanic activity was frequent in the cenozoic era due to the intensive tectonic movement such that tengchong is characterized by the wide distribution of volcanic rocks of 1000 km2 including basalt andesite basalt andesite and dacite guo and wang 2012 magnetotelluric mt survey by the chinese academy of sciences revealed that a mantle derived magma chamber below rehai at a depth of 7 km and with a thickness of 20 km serves as the heat source bai et al 1994 and the lithology of the reservoirs beneath rehai are composed of yanshanian period granite and proterozoic metamorphic rocks zhao 1984 guo and wang 2012 3 hydrochemical characteristics of geothermal waters in tibet we used the hydrogeochemical data of 307 water samples with li concentrations from a book named thermal springs in tibet tong et al 2000 the geothermal manifestations seem to decrease gradually from the south to the north of tibet as shown in fig 1 also most of the geothermal springs with li concentrations above 5 mg l are located in the high temperature geothermal zone of southern tibet and distributed along the vicinity of the yarlung zangbo river although some springs in other zones also have relatively high lithium concentrations four of the waters had extremely high tds 10 g l as shown in table 1 however unlike the high temperature magmatic geothermal systems e g rehai and kangding in the himalayan geothermal zone not only the tds but almost all the chemical constituents in these four waters were extremely high so it is more likely that evaporation processes further concentrated these hydrochemical compositions simultaneously instead of water rock interactions or mixing with magmatic volatiles moreover although the xianhaizi thermal spring had the highest tds and li values among all the water samples there was generally no positive li tds or li b relationship for the four springs therefore assuming that the high intensity evaporation processes cause the elevated species i e li and b level in these geothermal waters the different concentrations in the primary waters before evaporation may ultimately determine the species distribution ratios compared to the maximum tds of the thermal waters in the rehai and kangding geothermal areas i e rehai dagunguo 2 94 g l 31 of the remaining 303 water samples had higher tds further implying that the springs in tibet may have undergone a relatively strong concentration process in magmatic geothermal systems e g rehai and kangding the neutral parent geothermal fluids could form after deep circulating groundwaters mix with magmatic water the parent fluids typically have high cl and na concentrations after undergoing sufficient water rock reaction guo and wang 2012 li et al 2018b so the tibet thermal springs with relatively high cl and na concentrations were possibly formed by processes similar to that observed in rehai and kanding therefore we compared the cl na li and b concentrations of the tibet rehai and kangding water samples to preliminarily ascertain the probable influence of magma degassing processes on the tibet springs as illustrated in fig 2 a b only 10 and 11 water samples in tibet exceeded the maximum cl 1032 8 mg l and na 1055 5 mg l concentrations in the kangding and rehai geothermal areas however a much higher number of the water samples exceeded the maximum li and b concentrations in these two geothermal areas over 100 33 of the water samples had b concentrations above 16 98 mg l while 55 18 water samples had li concentrations higher than 11 7 mg l notably the tibet waters b concentrations were far higher than that of rehai and kangding fig 3 is a ternary plot of the main anions so4 cl and hco3 co3 of the tibet water samples excluding the four samples with tds 10 mg l evidently hco3 co3 is the dominant anion in most of the water samples indicating that these geothermal springs were formed by co2 condensation or the mixing with co2 condensates just like some water samples in kangding the so4 enriching steam heated waters with low ph ph 2 may symbolize strong geothermal activities so the few samples in the steam heated waters zone may indicate a relatively low influence of the heat source compared to rehai because steam heated waters emerge in rehai guo et al 2014 nevertheless many water samples were located in the zones near the cl axis consistent with the rehai and kangding samples including some sample points in the deep cl waters hence it is reasonable to infer that these water samples originate from the deep parent geothermal fluids besides it is evident in fig 3 that unlike in rehai and kangding some tibet water samples deviated from the cl axis and still had relatively high so4 concentrations the na k mg triangular diagram by giggenbach 1988 is used to analyze the extent of water rock reactions as shown in fig 4 most of the tibet water sample plots fell in the immature waters zone and away from the full equilibrium line implying that these fluids had relatively low water rock reaction extent in the reservoirs also the distribution of most water points in the na k mg triangular diagram showed a seemingly linear trend toward the na k equal line instead of a random distribution just like those of kangding and rehai therefore based on the estimates of na k geothermometer giggenbach 1988 we can infer that although deep reservoirs of about 260 c may exist beneath some geothermal areas in tibet most of the thermal springs were generally from the relatively shallow reservoirs formed by deep geothermal fluids mixing with varying amounts of immature waters additionally fig 4 shows that the mixing processes may not largely disturb the na k ratios undoubtedly the na k and k mg geothermometers estimates will differ tremendously however the existence of shallow circulating convective geothermal systems without deep geothermal fluid influence cannot be ignored moreover these thermal springs in the low temperature reservoirs comprise infiltrating groundwater characterized by high mg concentrations besides the springs of some geothermal systems with carbonate reservoirs may have relatively high mg concentrations from the analysis above we may primarily conclude that magmatic volatiles may chemically influence the hydrochemical composition of some tibet geothermal fluids because the fluids have hydrochemical characteristics similar to those in rehai and kangding also although mixing with infiltrating groundwater may play a significant role in the species compositions for most geothermal springs the shallow reservoirs mixed geothermal fluids seem to have a lower reservoir temperature resulting in a relatively low water rock reaction that said further investigation is required to ascertain the enrichment mechanism of li 4 influence of temperature on lithium in geothermal fluids generally rising temperature increases the geothermal fluids degree of water rock reactions in the reservoirs promoting li leaching from the surrounding rocks into the waters so before ascertaining the li origin in tibet s thermal springs we studied the relationships between the reservoir temperatures and li concentrations given the huge hydrochemical data classical geothermometers were selected over the multicomponent geothermometry approach although different geothermometers have their respective applicable conditions limiting their general applicability li et al 2020 nitschke et al 2018 according to the analysis above most geothermal springs may originate from shallow reservoirs with relatively low reservoir temperatures 200 c hence applying the na k geothermometers will be inappropriate similar na k ratios can further indicate that the estimates of na k geothermometers will not represent the temperatures of shallow reservoirs because of the failure to establish a new na k equilibrium in shallow reservoirs nicholson 1993 li et al 2020 also the application of the na k ca geothermometer to na hco3 fluids has been described as troublesome while the sio2 and k mg geothermometers seem more suitable for na hco3 type low temperature geothermal systems fournier 1989 li et al 2018a 2020 therefore we obtained the temperatures of the shallow reservoirs in tibet by the k mg sio2 equilibrium system as shown in fig 5 the water samples located on or near the equilibrium lines of k mg sio2 verifying the k mg and sio2 geothermometers are more appropriate for the thermal systems almost all the water samples in tibet had reservoir temperature estimates below 200 c indicating that the geothermal springs may originate from the shallow reservoirs instead of the high temperature deep reservoirs directly notably the li concentrations of tibet s geothermal springs show an apparent positive relationship with the reservoir temperatures estimates yet that seems not to be the case for rehai and kangding although some of the reservoir temperatures exceeded 200 c conservative species in the geothermal fluids including li cl and b are hardly influenced by water rock reactions and are therefore used to investigate hydrochemical processes arnórsson 1985 nicholson 1993 fig 6 a b and c shows the relationship between the k mg ratios and the conservative species concentrations in the geothermal springs interestingly for the tibet springs all three conservative species showed a similar trend comprising three phases or processes as the k mg temperature increased as the temperature rose the conservative species concentrations in the fluids from the relatively low temperature reservoirs remained constant or increased gradually but sharply at about 100 c and above however in the last phase the concentrations increase at almost constant temperatures this may explain why the geothermal springs with high conservative species concentrations always have relatively high k mg temperatures besides because na can indicate the hydrochemical processes of the deep parent geothermal fluids we plotted the relationship between na and k mg temperature fig 6d to ascertain further the deep geothermal fluids flowing processes remarkably na also showed a comparable trend with the conservative species from the ensuing analysis different hydrochemical processes influence the geothermal fluids li concentrations also evaporation of the fluids near the earth s surface may chiefly cause further li enrichment additionally most li rich geothermal springs in tibet may originate from the parent geothermal fluids nevertheless it is still unclear whether water rock reaction in the deep reservoirs or mixing with magmatic water is the main li source in the geothermal fluids because water rock reaction processes leach only a small amount of cl and b the alkali chloride or neutral chloride geothermal springs with b concentration higher than 10 mg l emanate from magma degassing nicholson 1993 arnórsson and andrésdóttir 1995 dotsika et al 2006 also the cl b ratio is often used to indicate a common reservoir source for thermal waters because cl and b are conservative species guo and wang 2012 li et al 2019 so cl and b were employed to determine further the source of li in tibet s geothermal springs as shown in fig 7 roughly linear cl li and cl b relationships were observed for all the water samples moreover the water samples with extremely high cl concentrations also had relatively high li and b concentrations furthermore the cl b and cl li ratios of rhyolite from different volcanic regions sanjuan et al 2014 denoted by solid and dotted lines in fig 7 showed that the geothermal springs in tibet are enriched with b and cl respectively almost half of the geothermal springs may be influenced by magmatic water mixing resulting in relatively high b concentrations 10 mg l yet unlike b li enrichment in the fluids was not abnormally high although the cl li ratios of the tibet water samples deviated from the rhyolite isochemical dissolution lines they had a similar linear relationship to the samples from rehai and kangding hence in tibet the mixing with magmatic water does not result in abnormally high li concentrations in the geothermal spring however the b rich magmatic water causes the extremely high b concentration in the thermal springs comparable to rehai and kangding based on the cl b and li concentrations in the thermal waters from rehai and kangding we preliminarily grouped the water samples excluding the highly concentrated waters into two as delineated by the cadet blue and grey shaded areas in fig 7 the waters with relatively high cl concentrations had constant cl b and cl li ratios as the cl concentration decreased thus it is more likely that primarily magma degassing caused the relatively high li concentrations in the springs even though dilution with varying amounts of circulating groundwater occurs afterwards however it was difficult to establish the springs li origins for the samples with relatively low cl concentrations located in the grey shaded area because we could not confirm the relatively low li levels also originated from the magmatic li after mixing with large amounts of shallow groundwater 5 discussion 5 1 hydrochemical characteristics of geothermal systems in tibet the chemical compositions of geothermal fluids in hydrothermal systems carry large amounts of temperature or geological information about the reservoirs beneath giggenbach 1988 guo et al 2017b li et al 2020 nicholson 1993 so hydrochemical methods are used to investigate different types of geothermal systems before further exploitation hydrochemical processes such as magmatic degassing water rock reaction and cooling mainly determine the varied chemical constituents of geothermal fluids in different geothermal systems basically deep circulating groundwater becomes highly acid after mixing with magmatic gases e g co2 h2s hcl and then neutralize by reacting with the surrounding rocks in the deep reservoirs ultimately forming close to neutral and equilibrated nacl brines also termed parent geothermal fluids giggenbach 1988 nicholson 1993 these neutral brines still contain much of the original magmatic co2 and sulfur in the form of h2s and are characterized by low magnesium calcium and potassium contents due to early alteration which occurs deep in the geothermal systems giggenbach 1988 therefore the boiling large flow springs with the greatest cl and na concentration are generally fed directly from the deep parent geothermal fluids the geothermal fluids in the rehai and kangding geothermal systems are chemically influenced by magma and the dagunguo geothermal spring rh04 in rehai emanates directly from the parent geothermal fluid after adiabatic cooling guo et al 2017a guo and wang 2012 li et al 2019 so using the rehai and kangding geothermal systems as references we may infer that the higher cl concentration tibet springs fig 3 originate from the deep parent geothermal fluids this is because felsic rocks leaching without magmatic influence in the deep reservoir cannot increase the cl concentrations substantially to a level close to the thermal waters in magmatic geothermal systems for example the rekeng hydrothermal system located at the north eastern margin of the qinghai tibet plateau is a high temperature system conversely the springs cl concentrations are lower than 60 mg l although the system has a deep reservoir with a temperature close to 200 c li et al 2019 also the cl concentrations of most hot springs in the xinyi and zhangzhou geothermal systems located on the southeast coast of china are lower than 20 mg l but the chalcedony reservoir temperatures are around 100 c gan et al 2019 li et al 2018a additionally we could infer from other evidence that the relatively high cl and na concentrations in the geothermal springs are mainly from the magmatic waters first besides the waters with tds higher than 10 g l not all the chemical constituents in most water samples showed evidently high concentrations simultaneously indicating no or less evaporation second compared to the magmatic geothermal systems rehai and kangding similar cl na concentrations and cl li ratios in some tibet thermal springs were observed suggesting that these water samples also mix with the magmatic water in deep reservoirs what is more cl and na correlated positively with the k mg temperatures for dozens of the water samples which could further suggest that the high cl and na concentrations in these tibet geothermal springs mainly originated from mixing with the deep magmatic waters instead of evaporation or water rock reactions additionally because the average abundance of b in the earth s crust is merely 10 ppm the extremely high b concentrations in the fluids of high temperature hydrothermal systems with a magmatic heat source result from magma degassing arnórsson and andrésdóttir 1995 dotsika et al 2006 hence we can conclude that magma degassing might have caused the high b concentration 10 ppm for most thermal spring waters in tibet however many tibet thermal springs had abnormally high b concentrations maximum 491 25 mg l much higher than those observed in the rehai and kangding magmatic geothermal systems therefore we can infer that the semi molten crust magma may release more b than the mantle s magma in the deep reservoirs or that b bearing rocks leaching accounts for a large portion of the total b besides the relatively high li concentrations in tibet s geothermal springs corroborate that magma exists beneath the different geothermal systems although the li enrichment is not as abnormally high compared to b moreover the near linear relationships among cl b and li see fig 7 suggest most geothermal springs in tibet undergo similar mixing processes causing the dilution of these conservative species in the relatively shallow reservoirs geothermal fluids undergo complex cooling processes e g mixing process adiabatic cooling and conductive cooling before ascending to the earth s surface making it difficult to estimate shallow or deep reservoir temperatures accurately however even in relatively shallow reservoirs with lower temperatures 180 c fluids k mg sio2 system equilibrates more rapidly compared to the na k mg and na k ca systems li et al 2022a 2018a therefore although the different cooling processes may influence the k mg and sio2 geothermometers accuracy to some extent after the fluids leave the reservoirs comparable estimates of the two geothermometers could represent relatively accurate temperatures of fluids directly from reservoirs or mixed in new reservoirs li et al 2022a hence for most water samples from tibet located on or near the k mg and sio2 equilibrium lines in fig 5 the estimates of the k mg and sio2 geothermometers were chosen over other geothermometers as the references for the reservoir temperatures the k mg and chalcedony geothermometers estimates indicate that the reservoir temperatures in tibet are relatively low 200 c compared to rehai and kangding the high mg and ca concentrations agree well with this result because much lower mg and ca contents and relatively great water rock reaction extents often characterize geothermal fluids originating from deep high temperature felsic reservoirs such as samples rh04 and kd11 in rehai and kangding respectively what is more the apparent positive relationship between k mg temperature and the conservative species e g cl b as shown in fig 6 for dozens of the water samples could further suggest that the high cl and b concentrations in these tibet geothermal springs mainly originate from mixing with the deep magmatic waters instead of evaporation this provides further evidence that magmatic degassing may chemically influence most of the springs with relatively high cl and b and that mixing with the ascending magmatic waters indirectly heats up the fluids in the reservoirs in addition as shown in fig 3 the so4 and hco3 enrichment in many of the tibet water samples is a hydrochemical characteristic pointing that the reservoirs may have relatively low temperatures first dissolved h2s in the geothermal fluids oxidizes to so4 during the reasonably long ascent pathway because of the deeper magmatic heat sources guo et al 2014 also bicarbonate geothermal fluids always occur in an umbrella shaped perched condensate zone overlying the geothermal system and are common on the margins of magmatic geothermal fields nicholson 1993 these hydrochemical characteristics infer that these springs with high so4 and hco3 will deviate from the deep heat source and travel over a long distance after leaving the deep reservoirs geophysical investigations revealed that the magma depths in the yarlung zangbo rehai and kangding geothermal areas are about 15 20 km 7 km and 10 km respectively lu 1989 bai et al 1994 liao 2018 therefore we can ultimately conclude that most geothermal springs in tibet mainly originate from relatively shallow reservoirs with lower temperatures 200 c although deeper reservoirs close to the heat source may exist 5 2 origin and enrichment of lithium in the geothermal springs in tibet based on the discussion in section 5 1 there exist many shallow reservoirs with temperatures below 200 c even though semi molten crust magma acts as the heat resource and the water rock reaction extents of the fluids in these reservoirs deviate from the full equilibrium line however some springs are highly li rich compared to the rehai and kangding geothermal systems so we further discuss the origin and enrichment of li for the thermal springs in tibet generally among the conservative species cl has the highest fluid mobility followed by b and then li reyes and trompetter 2012 so the linear cl li and cl b relationships tentatively suggest that li in the hydrothermal fluids from tibet s shallow reservoirs originate from the deeper reservoirs the li concentrations in these reservoirs seem constant after the reservoirs are formed fig 8 illustrates the relationship between li and the main cations i e na k mg and ca as shown in fig 8 a and b an obvious boundary exists implying that li leaching from the surrounding rocks of shallow reservoirs will be difficult na and k in the fluids in the shallow reservoirs will increase at varying degrees by water rock reaction while mg and ca undergo different deposition and dissolution during the water rock reaction processes nevertheless we still cannot ascertain whether leaching li bearing minerals or the magmatic release process contributes to the lithium of geothermal fluids in the deeper reservoirs overall the geothermal fluids li concentrations generally correlated positively with the reservoir temperature estimated by k mg geothermometer but at relatively high temperatures the li concentration keeps increasing at a constant temperature shown in fig 6 a although rising reservoir temperatures may increase the dissolved li concentrations fouillac and michard 1981 the magmatic cl and b also depict similar trends with li see fig 6 thus it is more likely that for li rich geothermal waters in tibet the magmatic li constitutes the main portion of the total li concentration also we may conclude that deeper geothermal reservoirs exist beneath these low temperature shallow reservoirs in tibet which are directly influenced by magma degassing however further studies are required to verify this deduction the higher temperature shallow reservoirs are closer to the deep reservoirs so they will have more li rich geothermal fluids mixing resulting in a positive relationship between li concentrations and reservoir temperature the high temperature fluids in the deep reservoirs also have elevated levels of cl and b so both solutes show similar behavior to li during the mixing processes due to their conservative nature additionally the springs from the shallow reservoirs with relatively high temperatures may have higher outlet temperatures implying that these high li springs with comparable reservoir temperatures undergo evaporation this may explain why these li rich geothermal springs also have high and almost constant k mg temperatures estimates besides we found that in the north of tibet some springs in the low and middle temperature zones were also li rich as shown in fig 1 c conversely there is no evidence that magma or semi molten state magma exists beneath these areas at a shallow depth so it seems unlikely that these springs also mixed with deep magmatic waters therefore it could be concluded that evaporation causes the li enrichment of these springs despite the relatively low reservoir temperatures in fig 7 four geothermal springs with tds 10 g l showed similar cl li ratios indicating that the fluids had undergone high evaporation after leaving the reservoirs to the earth s surface in tibet finally in tibet we can conclude that different geothermal springs with varying initial li concentrations further concentrate lithium ultimately forming the li rich saline lakes of different li contents also many springs in the yarlung zangbo suture s vicinity had relatively high li concentrations due to the magmatic degassing effect fig 1 c so it is not surprising that the saline lakes in those areas have elevated li concentrations this accords well with the conclusion of zheng et al 1990 that li levels in the saline lakes are highest in the center of yarlung zangbo suture the rehai and kangding geothermal areas are both located in the eastern part of the himalayan geothermal zone unlike boron lithium in the tibet thermal springs showed no abnormally high concentrations compared to rehai and kangding even after evaporation about 18 of the water samples had li concentrations higher than 11 7 mg l and most of which were lower than 20 mg l also the cl li ratios of the tibet geothermal springs were close to those in rehai and kangding hence because it has been proven that mantle magma supplies the heat beneath the rehai geothermal area we can infer that the amount of cl and li released from the crust magma and mantle magma have minimal influence empirically classical geothermometers are more suitable for high temperature geothermal springs from reservoirs with little or no mixing with other groundwater sources nicholson 1993 however for thermal springs with lower outlet temperatures it is more likely that the fluids mix with large amounts of infiltrating groundwater before ascending to the earth s surface possibly disturbing the pre mixing k mg sio2 equilibrium established in the reservoirs this considerable uncertainty decreases the reliability of the k mg geothermometer estimates again k mg geothermometer estimates cannot be treated as the reservoirs temperatures due to the high mg concentrations in the groundwater in lower li springs li from the water reaction processes may account for a significant proportion of the total li concentration hence they cannot be ignored these explain why the concentrations of the conservative species in many geothermal springs have no evident relationship with the k mg temperatures as shown in fig 6 however based on fig 7 the near linear relationship between cl and li may indicate that the li in most of tibet s geothermal springs may originate from the magma for these low li spring waters although further studies are needed to substantiate this conclusion or otherwise preliminarily the present study has ascertained the enrichment mechanisms of lithium for the li enriched geothermal springs in southern tibet based on the hydrochemical methods however further studies involving more li isotope data of geothermal springs are needed to increase the confidence in this work s conclusions 6 conclusion although hundreds of geothermal springs are exposed in southern tibet the majority seem to be chemically influenced by magma estimates of k mg and chalcedony geothermometers indicate that the reservoir temperatures of the tibet hydrothermal systems studied are relatively low 200 c the reservoirs with 200 c probably formed by a mixture of deeper high temperature fluids and infiltrating groundwater and most of the geothermal springs are from these shallow reservoirs moreover none of the thermal springs originates directly from the deep high temperature reservoirs because all the water samples have a relatively low water rock reaction deviating from full equilibrium after mixing with infiltrating groundwater li hardly leaches from the surrounding rocks in the shallow reservoirs instead the high li of southern tibet s geothermal fluids are mainly from the magma two hydrochemical processes result in the elevated levels of li in southern tibet s thermal fluids firstly the deeper fluids have relatively high magmatic li from the degassing of the semi molten state magma rather than li leaching from the surrounding rocks in the deep reservoirs then the li rich thermal fluids mix with different amounts of infiltrating groundwater before ascending to the earth s surface in the shallow reservoirs forming thermal springs of varying li concentrations also the semi molten state magma does not cause a further rise in li concentration secondly the southern tibet thermal springs have comparable li enrichment with other magma influenced hydrothermal waters but evaporation further concentrates the li in the southern tibet fluids lastly distinguishing the li source seems difficult for the geothermal springs with low cl concentrations nevertheless it is more likely that the magmatic li constitutes the main portion of the total li concentration credit authorship contribution statement jiexiang li methodology writing original draft xinyi wang supervision validation chuanxia ruan software gideon sagoe language editing jianlin li writing reviewing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this work was supported by the national natural science foundation of china 41972254 42102297 41877208 innovative science and technology talents team construction project of henan province cxtd2016053 china postdoctoral science foundation 2021m701098 and special funds for higher education basic scientific research funds of henan province nsfrf200103 nsfrf210304 key scientific research projects of colleges and universities in henan province 22a170009 apendix 
3157,as low grade lithium li extraction technology improves li rich geothermal fluids may become an alternative li source in the future most geothermal springs in southern tibet china have notably high li contents but the fluids li origins and enrichment processes remain unclear therefore this study investigated the li enrichment mechanisms in the study area based on 307 hydrogeochemical data of thermal spring waters selected from the literature our findings confirm that most li enriched geothermal springs in southern tibet are chemically influenced by magma also k mg and chalcedony geothermometers estimates indicated that most of the springs originate from shallow reservoirs with temperatures below 200 c although some higher temperature deep reservoirs may exist beneath tibet moreover we found that two hydrochemical processes mainly resulted in the relatively high li concentrations in southern tibet s thermal fluids first magmatic li enrichment resulted from the semi molten state magma degassing rather than leaching from the surrounding rocks in the deeper reservoirs subsequent mixing of the li rich deep fluids with varying amounts of infiltrating groundwater formed the shallow reservoirs during ascent to the earth s surface resulting in the observed differences in li concentrations of the thermal springs from these reservoirs secondly evaporation further concentrated the li in the li rich geothermal springs in southern tibet resulting in higher li levels than in other magmatic thermal springs the present study could not establish the li source for the tibet thermal springs with low cl concentrations because they may mix with large amounts of infiltrating groundwater however it is more likely that magmatic li still accounts for a large portion of the total li keywords southern tibet lithium magma evaporation enrichment 1 introduction the advent of electric transportation has resulted in a growing demand for lithium li and more pressure on li resources at present li is mainly extracted from pegmatite type deposits and brine type deposits globally and the latter accounts for about 65 of the li resource kesler et al 2012 in china li pegmatite type deposits are mostly distributed in the sichuan jiangxi and xinjiang provinces while the brine type deposits are found in qinghai and tibet however researchers have established that geothermal activities are crucial for li rich brine since most li rich saline lakes are located around hydrothermal systems bradley et al 2013 wang et al 2020a munk et al 2011 also as li extraction technology improves low grade geothermal fluids may serve as an alternative li source so further study of lithium s hydrochemical processes and origins in hydrothermal systems is required lithium concentrations in geothermal fluids from different geothermal systems vary in china for instance the li concentration of the boiling spring dagunguo in the rehai geothermal area is 6 13 mg l guo and wang 2012 while the maximum post boiling li concentration in the thermal springs in the rekeng geothermal area located in the western part of sichuan province is 4 9 mg l li et al 2019 additionally for the low temperature convective systems located in china s southeast coastal areas e g zhangzhou and fengshun geothermal fields the li levels in the fluids are lower than 1 mg l unless they mix with seawater gan et al 2019 li et al 2018a again the li concentrations are low in the conductive geothermal systems located beneath the north china plain for instance most water samples collected from the deep wells in tianjin wumishan formation and kaifeng neogene system reservoirs have li concentrations lower than 1 mg l li et al 2022b liu 2014a globally there seems to be a good relationship between li and cl concentrations in geothermal fluids the li concentrations of the hot waters collected from deep granite reservoirs in europe are lower than 10 mg l unless the waters have extremely high cl concentrations michard 1990 the hydrochemical data of geothermal waters in taupo volcanic zone new zealand also showed that high li concentrations 10 mg l are always accompanied by high cl levels giggenbach 1995 also the neutral dilute geothermal waters collected from different icelandic and yellowstone national park geothermal areas have li concentrations lower than 1 mg l and 6 mg l while the li maximum concentration in seawater derived geothermal fluids from iceland is 14 15 mg l sanjuan et al 2014 ball et al 2010 however it is interesting that although diluted geothermal waters usually have relatively low li concentrations 10 mg l the thermal springs in tibet are particularly li rich despite some having relatively low cl and tds total dissolved solids contents tong et al 2000 the maximum li concentration in the geothermal springs from tibet is 239 mg l xianhaizi geothermal spring and the thermal springs of 19 geothermal systems have concentrations above 19 mg l wang et al 2020a thus in tibet not only the saline lakes but the li enriched geothermal springs could be potential lithium resources in the future li bearing rocks leaching is one of the important li origins for geothermal fluids a lithium isotopy study showed that equilibrium exchange with magmatic rocks at high temperature mainly controlled li and its isotopes in geothermal fluids in taupo volcanic zone new zealand millot et al 2012 in the appalachian plateau region usa the application of different hydrochemical methods established that water rock reactions enable lithium enrichment of the fluids from the paleozoic aged reservoirs macpherson 2015 also for the upper rhine graben geothermal brines in european areas water rock interaction processes at relatively high temperatures 120 c are the dominant source and control of these li rich deep fluids sanjuan et al 2022 again based on an h o li b and sr isotopy study yu et al 2022 proposed that li enrichment in brines from the upper cretaceous gypsum bearing clastic aquifers of the jitai basin in china was by water rock interactions involving lithian muscovites however the geothermal fluids li may not only originate from the water mineral reaction but has a magmatic origin wang et al 2020a li et al 2021 also analyzed the hydrochemical data of geothermal waters from nine thermal systems in felsic reservoirs in china and inferred that magma degassing could be an li source although the study could not conclude whether magma degassing is the primary source moreover wang et al 2020b concluded that magmatic water and the dissolution of felsic igneous rocks mainly contributed to li rb and cs in the geothermal fluid of the rehai geothermal area china the himalayan geothermal activity zone which hosts many geothermal systems belongs to the collision area of the indian and eurasian plates studies have shown that some geothermal systems in the region e g yangbajing daggyai rehai and kangding geothermal areas have a magma heat source cheng et al 2022 guo et al 2007 guo and wang 2012 li et al 2018b liu et al 2019 yet interestingly only the southern tibet geothermal springs are relatively li rich in tibet it has been inferred that the li enrichment of the cl type geothermal springs and the lakes near the yarlung zangbo suture is probably related to the partial crustal melting rather than the single leaching of the basement rocks zheng et al 1990 zhang et al 2015 however limited evidence exists to conclude that water rock reaction or magmatic degassing results in the relatively high li concentrations in the southern tibet geothermal springs also how the hydrothermal systems in the area generally concentrate li remains unclear therefore we studied further the tibet geothermal systems by analyzing the hydrochemical data of geothermal springs from a book named thermal springs in tibet tong et al 2000 to ascertain the li origin of the southern tibet thermal fluids and clarify the hydrochemical processes of li enrichment the study will contribute to the body of knowledge regarding geothermal lithium resource exploration and provide some theoretical foundation for assessing the lithium resource potential of hydrothermal systems 2 geothermal and geological setting 2 1 tectonic background in the tibet the himalayan geothermal zone belongs to the tibetan plateau which was formed by a collision of continental crusts between the eurasian and indian plates due to the mosaic collision and subduction between the two plates southern tibet has experienced a very complex tectonic evolution liao 2018 results of the indepth project indicated that there is a large hidden thrust strip i e the main himalayan thrust from the himalayan area to the yarlung zangbo suture extending more than 150 km and a several kilometers thick as shown in fig 1 b zhao et al 2002 the partial lower crust of the lhasa block in the northern asian plate was pushed by the main himalayan thrust from the south to the shallow area then a series of southward thrusts were formed from north to south during the continuous northward propulsion for the indian continent including the main boundary thrust mbt and the main central thrust mct see fig 1a b the mbt and mct appear to the south of the watershed of the himalayan mountain in nepal bhutan and india the main thrust planes of the himalayan thrust zone all dip to the north at low or intermediate angles and the thrusting took place between 23 5 and 16 8 ma during the early himalayan orogenic period liao 2018 the indepth project results also showed that the footwall of the thrust zone has been subducted northwards for 200 km reaching a depth of 15 km and a partial melting layer is recognized beneath the yarlung zangbo suture where the thickness of crust increases to 60 74 km zeng et al 1995 zhao et al 1997 based on tectonic interpretation of high resolution seismic tomographic images of the eastern qinghai tibet plateau as provided by zhao et al 2002 and illustrated in fig 1 b a low velocity belt with a depth lower than 100 km lies beneath the tanggula mountain suggesting the possible existence of a melting zone 2 2 the comparative geothermal setting among southern tibet rehai and kangding the locations and outlet temperatures of geothermal springs are shown in fig 1 c based on the outlet temperatures tibet can divide into four geothermal manifestation zones the high temperature geothermal springs are mostly located in southern tibet which has five main geothermal activity belts they include the geothermal activity belts of the yarlung zangbo river the yarlung zangbo valley the south of nyenchen tonglha mountains the northern tibet and the corner of the yarlung zangbo river and shiquan river the areas near the yarlung zangbo valley have the relatively strong geothermal activity and interestingly evidence from geophysical research yuan et al 1987 unsworth et al 2005 and seismic exploration nelson et al 1996 brown et al 1996 indicate that there exists a 5 km thick low resistivity or low velocity belt with an increasing depth of 15 20 km from south to north of the yarlung zangbo suture the belt can be regarded as semi molten state magma and is 27 km deep in yangbajain lu 1989 wei et al 2001 additionally along the nyemo yangbajain damshung areas in the south of nyaiqentanglha mountains the indepth project also found four deep reflection highlights inferred as semi molten state magma at depths ranging from 15 km to 20 km which could belong to the granitic magma chambers zhao et al 2002 liao 2018 therefore the semi molten state magma is possibly the heat source of some high temperature hydrothermal systems in the vicinity of the yarlung zangbo suture additionally due to the main compressive stress the e w extension of the tibetan crust began resulting in the formation of many north south grabens in the neogene as shown in fig 1 a the molten material intruded upwardly into some the graben and surrounding areas which may be the heat source of the high temperature geothermal systems around the yarlung zangbo suture liao 2018 in contrast the absence or disconnection of the melting layers may explain the relatively weak geothermal activity in the northern and central parts of tibet lu 1989 wei et al 2001 guo 2020 however there is limited evidence to explain the quaternary volcanic eruptions at all geothermal fields in the tibetan plateau tan et al 2014 currently only four hydrothermal areas of tibet i e yangbajain yangyi langjiu and nakqu northern part of tibet have geological surveys or geothermal production wells their reservoir lithologies are mainly granitic mylonite and granite biotite granite and biotite granite porphyry granite and sandstone respectively guo et al 2014 therefore it is more likely that most hydrothermal systems in southern tibet have acidic rocks reservoirs the present study compared the hydrochemical characteristics of the geothermal fluids in tibet with two high temperature magmatic geothermal systems i e the rehai and kangding geothermal areas because they have a similar geological background the rehai and kangding geothermal areas are both located in the east of the himalayan geothermal zone as shown in fig 1 c and the hydrochemical studies have shown that the geothermal springs in both places have mixed with different amounts of magmatic water guo and wang 2012 guo et al 2017a li et al 2018b in kangding the geothermal springs may be influenced chemically by the magma from the mantle via the xianshuihe fault a deep fracture that can reach the moho phase du et al 2006 tian and pang 2017 also magnetotelluric data revealed an underlying zone of partial melt with a 4 to 19 distribution range beneath the kangding geothermal field at a depth of 10 km cheng et al 2022 the magmatic rocks including presinian biotite granites and yanshannian granodiorites are exposed in the western and eastern parts of the kangding geothermal area respectively liu 2014b geophysical investigations indicated that the geothermal fluids of the main geothermal areas in kangding exist in the contact zone of invaded indosinian yanshanian period granite and permian metasandstone liu 2014b unlike kangding the rehai geothermal field located in the tengchong volcanic region has remarkable geothermal manifestations such as boiling springs fumaroles hydrothermal explosions and steaming ground volcanic activity was frequent in the cenozoic era due to the intensive tectonic movement such that tengchong is characterized by the wide distribution of volcanic rocks of 1000 km2 including basalt andesite basalt andesite and dacite guo and wang 2012 magnetotelluric mt survey by the chinese academy of sciences revealed that a mantle derived magma chamber below rehai at a depth of 7 km and with a thickness of 20 km serves as the heat source bai et al 1994 and the lithology of the reservoirs beneath rehai are composed of yanshanian period granite and proterozoic metamorphic rocks zhao 1984 guo and wang 2012 3 hydrochemical characteristics of geothermal waters in tibet we used the hydrogeochemical data of 307 water samples with li concentrations from a book named thermal springs in tibet tong et al 2000 the geothermal manifestations seem to decrease gradually from the south to the north of tibet as shown in fig 1 also most of the geothermal springs with li concentrations above 5 mg l are located in the high temperature geothermal zone of southern tibet and distributed along the vicinity of the yarlung zangbo river although some springs in other zones also have relatively high lithium concentrations four of the waters had extremely high tds 10 g l as shown in table 1 however unlike the high temperature magmatic geothermal systems e g rehai and kangding in the himalayan geothermal zone not only the tds but almost all the chemical constituents in these four waters were extremely high so it is more likely that evaporation processes further concentrated these hydrochemical compositions simultaneously instead of water rock interactions or mixing with magmatic volatiles moreover although the xianhaizi thermal spring had the highest tds and li values among all the water samples there was generally no positive li tds or li b relationship for the four springs therefore assuming that the high intensity evaporation processes cause the elevated species i e li and b level in these geothermal waters the different concentrations in the primary waters before evaporation may ultimately determine the species distribution ratios compared to the maximum tds of the thermal waters in the rehai and kangding geothermal areas i e rehai dagunguo 2 94 g l 31 of the remaining 303 water samples had higher tds further implying that the springs in tibet may have undergone a relatively strong concentration process in magmatic geothermal systems e g rehai and kangding the neutral parent geothermal fluids could form after deep circulating groundwaters mix with magmatic water the parent fluids typically have high cl and na concentrations after undergoing sufficient water rock reaction guo and wang 2012 li et al 2018b so the tibet thermal springs with relatively high cl and na concentrations were possibly formed by processes similar to that observed in rehai and kanding therefore we compared the cl na li and b concentrations of the tibet rehai and kangding water samples to preliminarily ascertain the probable influence of magma degassing processes on the tibet springs as illustrated in fig 2 a b only 10 and 11 water samples in tibet exceeded the maximum cl 1032 8 mg l and na 1055 5 mg l concentrations in the kangding and rehai geothermal areas however a much higher number of the water samples exceeded the maximum li and b concentrations in these two geothermal areas over 100 33 of the water samples had b concentrations above 16 98 mg l while 55 18 water samples had li concentrations higher than 11 7 mg l notably the tibet waters b concentrations were far higher than that of rehai and kangding fig 3 is a ternary plot of the main anions so4 cl and hco3 co3 of the tibet water samples excluding the four samples with tds 10 mg l evidently hco3 co3 is the dominant anion in most of the water samples indicating that these geothermal springs were formed by co2 condensation or the mixing with co2 condensates just like some water samples in kangding the so4 enriching steam heated waters with low ph ph 2 may symbolize strong geothermal activities so the few samples in the steam heated waters zone may indicate a relatively low influence of the heat source compared to rehai because steam heated waters emerge in rehai guo et al 2014 nevertheless many water samples were located in the zones near the cl axis consistent with the rehai and kangding samples including some sample points in the deep cl waters hence it is reasonable to infer that these water samples originate from the deep parent geothermal fluids besides it is evident in fig 3 that unlike in rehai and kangding some tibet water samples deviated from the cl axis and still had relatively high so4 concentrations the na k mg triangular diagram by giggenbach 1988 is used to analyze the extent of water rock reactions as shown in fig 4 most of the tibet water sample plots fell in the immature waters zone and away from the full equilibrium line implying that these fluids had relatively low water rock reaction extent in the reservoirs also the distribution of most water points in the na k mg triangular diagram showed a seemingly linear trend toward the na k equal line instead of a random distribution just like those of kangding and rehai therefore based on the estimates of na k geothermometer giggenbach 1988 we can infer that although deep reservoirs of about 260 c may exist beneath some geothermal areas in tibet most of the thermal springs were generally from the relatively shallow reservoirs formed by deep geothermal fluids mixing with varying amounts of immature waters additionally fig 4 shows that the mixing processes may not largely disturb the na k ratios undoubtedly the na k and k mg geothermometers estimates will differ tremendously however the existence of shallow circulating convective geothermal systems without deep geothermal fluid influence cannot be ignored moreover these thermal springs in the low temperature reservoirs comprise infiltrating groundwater characterized by high mg concentrations besides the springs of some geothermal systems with carbonate reservoirs may have relatively high mg concentrations from the analysis above we may primarily conclude that magmatic volatiles may chemically influence the hydrochemical composition of some tibet geothermal fluids because the fluids have hydrochemical characteristics similar to those in rehai and kangding also although mixing with infiltrating groundwater may play a significant role in the species compositions for most geothermal springs the shallow reservoirs mixed geothermal fluids seem to have a lower reservoir temperature resulting in a relatively low water rock reaction that said further investigation is required to ascertain the enrichment mechanism of li 4 influence of temperature on lithium in geothermal fluids generally rising temperature increases the geothermal fluids degree of water rock reactions in the reservoirs promoting li leaching from the surrounding rocks into the waters so before ascertaining the li origin in tibet s thermal springs we studied the relationships between the reservoir temperatures and li concentrations given the huge hydrochemical data classical geothermometers were selected over the multicomponent geothermometry approach although different geothermometers have their respective applicable conditions limiting their general applicability li et al 2020 nitschke et al 2018 according to the analysis above most geothermal springs may originate from shallow reservoirs with relatively low reservoir temperatures 200 c hence applying the na k geothermometers will be inappropriate similar na k ratios can further indicate that the estimates of na k geothermometers will not represent the temperatures of shallow reservoirs because of the failure to establish a new na k equilibrium in shallow reservoirs nicholson 1993 li et al 2020 also the application of the na k ca geothermometer to na hco3 fluids has been described as troublesome while the sio2 and k mg geothermometers seem more suitable for na hco3 type low temperature geothermal systems fournier 1989 li et al 2018a 2020 therefore we obtained the temperatures of the shallow reservoirs in tibet by the k mg sio2 equilibrium system as shown in fig 5 the water samples located on or near the equilibrium lines of k mg sio2 verifying the k mg and sio2 geothermometers are more appropriate for the thermal systems almost all the water samples in tibet had reservoir temperature estimates below 200 c indicating that the geothermal springs may originate from the shallow reservoirs instead of the high temperature deep reservoirs directly notably the li concentrations of tibet s geothermal springs show an apparent positive relationship with the reservoir temperatures estimates yet that seems not to be the case for rehai and kangding although some of the reservoir temperatures exceeded 200 c conservative species in the geothermal fluids including li cl and b are hardly influenced by water rock reactions and are therefore used to investigate hydrochemical processes arnórsson 1985 nicholson 1993 fig 6 a b and c shows the relationship between the k mg ratios and the conservative species concentrations in the geothermal springs interestingly for the tibet springs all three conservative species showed a similar trend comprising three phases or processes as the k mg temperature increased as the temperature rose the conservative species concentrations in the fluids from the relatively low temperature reservoirs remained constant or increased gradually but sharply at about 100 c and above however in the last phase the concentrations increase at almost constant temperatures this may explain why the geothermal springs with high conservative species concentrations always have relatively high k mg temperatures besides because na can indicate the hydrochemical processes of the deep parent geothermal fluids we plotted the relationship between na and k mg temperature fig 6d to ascertain further the deep geothermal fluids flowing processes remarkably na also showed a comparable trend with the conservative species from the ensuing analysis different hydrochemical processes influence the geothermal fluids li concentrations also evaporation of the fluids near the earth s surface may chiefly cause further li enrichment additionally most li rich geothermal springs in tibet may originate from the parent geothermal fluids nevertheless it is still unclear whether water rock reaction in the deep reservoirs or mixing with magmatic water is the main li source in the geothermal fluids because water rock reaction processes leach only a small amount of cl and b the alkali chloride or neutral chloride geothermal springs with b concentration higher than 10 mg l emanate from magma degassing nicholson 1993 arnórsson and andrésdóttir 1995 dotsika et al 2006 also the cl b ratio is often used to indicate a common reservoir source for thermal waters because cl and b are conservative species guo and wang 2012 li et al 2019 so cl and b were employed to determine further the source of li in tibet s geothermal springs as shown in fig 7 roughly linear cl li and cl b relationships were observed for all the water samples moreover the water samples with extremely high cl concentrations also had relatively high li and b concentrations furthermore the cl b and cl li ratios of rhyolite from different volcanic regions sanjuan et al 2014 denoted by solid and dotted lines in fig 7 showed that the geothermal springs in tibet are enriched with b and cl respectively almost half of the geothermal springs may be influenced by magmatic water mixing resulting in relatively high b concentrations 10 mg l yet unlike b li enrichment in the fluids was not abnormally high although the cl li ratios of the tibet water samples deviated from the rhyolite isochemical dissolution lines they had a similar linear relationship to the samples from rehai and kangding hence in tibet the mixing with magmatic water does not result in abnormally high li concentrations in the geothermal spring however the b rich magmatic water causes the extremely high b concentration in the thermal springs comparable to rehai and kangding based on the cl b and li concentrations in the thermal waters from rehai and kangding we preliminarily grouped the water samples excluding the highly concentrated waters into two as delineated by the cadet blue and grey shaded areas in fig 7 the waters with relatively high cl concentrations had constant cl b and cl li ratios as the cl concentration decreased thus it is more likely that primarily magma degassing caused the relatively high li concentrations in the springs even though dilution with varying amounts of circulating groundwater occurs afterwards however it was difficult to establish the springs li origins for the samples with relatively low cl concentrations located in the grey shaded area because we could not confirm the relatively low li levels also originated from the magmatic li after mixing with large amounts of shallow groundwater 5 discussion 5 1 hydrochemical characteristics of geothermal systems in tibet the chemical compositions of geothermal fluids in hydrothermal systems carry large amounts of temperature or geological information about the reservoirs beneath giggenbach 1988 guo et al 2017b li et al 2020 nicholson 1993 so hydrochemical methods are used to investigate different types of geothermal systems before further exploitation hydrochemical processes such as magmatic degassing water rock reaction and cooling mainly determine the varied chemical constituents of geothermal fluids in different geothermal systems basically deep circulating groundwater becomes highly acid after mixing with magmatic gases e g co2 h2s hcl and then neutralize by reacting with the surrounding rocks in the deep reservoirs ultimately forming close to neutral and equilibrated nacl brines also termed parent geothermal fluids giggenbach 1988 nicholson 1993 these neutral brines still contain much of the original magmatic co2 and sulfur in the form of h2s and are characterized by low magnesium calcium and potassium contents due to early alteration which occurs deep in the geothermal systems giggenbach 1988 therefore the boiling large flow springs with the greatest cl and na concentration are generally fed directly from the deep parent geothermal fluids the geothermal fluids in the rehai and kangding geothermal systems are chemically influenced by magma and the dagunguo geothermal spring rh04 in rehai emanates directly from the parent geothermal fluid after adiabatic cooling guo et al 2017a guo and wang 2012 li et al 2019 so using the rehai and kangding geothermal systems as references we may infer that the higher cl concentration tibet springs fig 3 originate from the deep parent geothermal fluids this is because felsic rocks leaching without magmatic influence in the deep reservoir cannot increase the cl concentrations substantially to a level close to the thermal waters in magmatic geothermal systems for example the rekeng hydrothermal system located at the north eastern margin of the qinghai tibet plateau is a high temperature system conversely the springs cl concentrations are lower than 60 mg l although the system has a deep reservoir with a temperature close to 200 c li et al 2019 also the cl concentrations of most hot springs in the xinyi and zhangzhou geothermal systems located on the southeast coast of china are lower than 20 mg l but the chalcedony reservoir temperatures are around 100 c gan et al 2019 li et al 2018a additionally we could infer from other evidence that the relatively high cl and na concentrations in the geothermal springs are mainly from the magmatic waters first besides the waters with tds higher than 10 g l not all the chemical constituents in most water samples showed evidently high concentrations simultaneously indicating no or less evaporation second compared to the magmatic geothermal systems rehai and kangding similar cl na concentrations and cl li ratios in some tibet thermal springs were observed suggesting that these water samples also mix with the magmatic water in deep reservoirs what is more cl and na correlated positively with the k mg temperatures for dozens of the water samples which could further suggest that the high cl and na concentrations in these tibet geothermal springs mainly originated from mixing with the deep magmatic waters instead of evaporation or water rock reactions additionally because the average abundance of b in the earth s crust is merely 10 ppm the extremely high b concentrations in the fluids of high temperature hydrothermal systems with a magmatic heat source result from magma degassing arnórsson and andrésdóttir 1995 dotsika et al 2006 hence we can conclude that magma degassing might have caused the high b concentration 10 ppm for most thermal spring waters in tibet however many tibet thermal springs had abnormally high b concentrations maximum 491 25 mg l much higher than those observed in the rehai and kangding magmatic geothermal systems therefore we can infer that the semi molten crust magma may release more b than the mantle s magma in the deep reservoirs or that b bearing rocks leaching accounts for a large portion of the total b besides the relatively high li concentrations in tibet s geothermal springs corroborate that magma exists beneath the different geothermal systems although the li enrichment is not as abnormally high compared to b moreover the near linear relationships among cl b and li see fig 7 suggest most geothermal springs in tibet undergo similar mixing processes causing the dilution of these conservative species in the relatively shallow reservoirs geothermal fluids undergo complex cooling processes e g mixing process adiabatic cooling and conductive cooling before ascending to the earth s surface making it difficult to estimate shallow or deep reservoir temperatures accurately however even in relatively shallow reservoirs with lower temperatures 180 c fluids k mg sio2 system equilibrates more rapidly compared to the na k mg and na k ca systems li et al 2022a 2018a therefore although the different cooling processes may influence the k mg and sio2 geothermometers accuracy to some extent after the fluids leave the reservoirs comparable estimates of the two geothermometers could represent relatively accurate temperatures of fluids directly from reservoirs or mixed in new reservoirs li et al 2022a hence for most water samples from tibet located on or near the k mg and sio2 equilibrium lines in fig 5 the estimates of the k mg and sio2 geothermometers were chosen over other geothermometers as the references for the reservoir temperatures the k mg and chalcedony geothermometers estimates indicate that the reservoir temperatures in tibet are relatively low 200 c compared to rehai and kangding the high mg and ca concentrations agree well with this result because much lower mg and ca contents and relatively great water rock reaction extents often characterize geothermal fluids originating from deep high temperature felsic reservoirs such as samples rh04 and kd11 in rehai and kangding respectively what is more the apparent positive relationship between k mg temperature and the conservative species e g cl b as shown in fig 6 for dozens of the water samples could further suggest that the high cl and b concentrations in these tibet geothermal springs mainly originate from mixing with the deep magmatic waters instead of evaporation this provides further evidence that magmatic degassing may chemically influence most of the springs with relatively high cl and b and that mixing with the ascending magmatic waters indirectly heats up the fluids in the reservoirs in addition as shown in fig 3 the so4 and hco3 enrichment in many of the tibet water samples is a hydrochemical characteristic pointing that the reservoirs may have relatively low temperatures first dissolved h2s in the geothermal fluids oxidizes to so4 during the reasonably long ascent pathway because of the deeper magmatic heat sources guo et al 2014 also bicarbonate geothermal fluids always occur in an umbrella shaped perched condensate zone overlying the geothermal system and are common on the margins of magmatic geothermal fields nicholson 1993 these hydrochemical characteristics infer that these springs with high so4 and hco3 will deviate from the deep heat source and travel over a long distance after leaving the deep reservoirs geophysical investigations revealed that the magma depths in the yarlung zangbo rehai and kangding geothermal areas are about 15 20 km 7 km and 10 km respectively lu 1989 bai et al 1994 liao 2018 therefore we can ultimately conclude that most geothermal springs in tibet mainly originate from relatively shallow reservoirs with lower temperatures 200 c although deeper reservoirs close to the heat source may exist 5 2 origin and enrichment of lithium in the geothermal springs in tibet based on the discussion in section 5 1 there exist many shallow reservoirs with temperatures below 200 c even though semi molten crust magma acts as the heat resource and the water rock reaction extents of the fluids in these reservoirs deviate from the full equilibrium line however some springs are highly li rich compared to the rehai and kangding geothermal systems so we further discuss the origin and enrichment of li for the thermal springs in tibet generally among the conservative species cl has the highest fluid mobility followed by b and then li reyes and trompetter 2012 so the linear cl li and cl b relationships tentatively suggest that li in the hydrothermal fluids from tibet s shallow reservoirs originate from the deeper reservoirs the li concentrations in these reservoirs seem constant after the reservoirs are formed fig 8 illustrates the relationship between li and the main cations i e na k mg and ca as shown in fig 8 a and b an obvious boundary exists implying that li leaching from the surrounding rocks of shallow reservoirs will be difficult na and k in the fluids in the shallow reservoirs will increase at varying degrees by water rock reaction while mg and ca undergo different deposition and dissolution during the water rock reaction processes nevertheless we still cannot ascertain whether leaching li bearing minerals or the magmatic release process contributes to the lithium of geothermal fluids in the deeper reservoirs overall the geothermal fluids li concentrations generally correlated positively with the reservoir temperature estimated by k mg geothermometer but at relatively high temperatures the li concentration keeps increasing at a constant temperature shown in fig 6 a although rising reservoir temperatures may increase the dissolved li concentrations fouillac and michard 1981 the magmatic cl and b also depict similar trends with li see fig 6 thus it is more likely that for li rich geothermal waters in tibet the magmatic li constitutes the main portion of the total li concentration also we may conclude that deeper geothermal reservoirs exist beneath these low temperature shallow reservoirs in tibet which are directly influenced by magma degassing however further studies are required to verify this deduction the higher temperature shallow reservoirs are closer to the deep reservoirs so they will have more li rich geothermal fluids mixing resulting in a positive relationship between li concentrations and reservoir temperature the high temperature fluids in the deep reservoirs also have elevated levels of cl and b so both solutes show similar behavior to li during the mixing processes due to their conservative nature additionally the springs from the shallow reservoirs with relatively high temperatures may have higher outlet temperatures implying that these high li springs with comparable reservoir temperatures undergo evaporation this may explain why these li rich geothermal springs also have high and almost constant k mg temperatures estimates besides we found that in the north of tibet some springs in the low and middle temperature zones were also li rich as shown in fig 1 c conversely there is no evidence that magma or semi molten state magma exists beneath these areas at a shallow depth so it seems unlikely that these springs also mixed with deep magmatic waters therefore it could be concluded that evaporation causes the li enrichment of these springs despite the relatively low reservoir temperatures in fig 7 four geothermal springs with tds 10 g l showed similar cl li ratios indicating that the fluids had undergone high evaporation after leaving the reservoirs to the earth s surface in tibet finally in tibet we can conclude that different geothermal springs with varying initial li concentrations further concentrate lithium ultimately forming the li rich saline lakes of different li contents also many springs in the yarlung zangbo suture s vicinity had relatively high li concentrations due to the magmatic degassing effect fig 1 c so it is not surprising that the saline lakes in those areas have elevated li concentrations this accords well with the conclusion of zheng et al 1990 that li levels in the saline lakes are highest in the center of yarlung zangbo suture the rehai and kangding geothermal areas are both located in the eastern part of the himalayan geothermal zone unlike boron lithium in the tibet thermal springs showed no abnormally high concentrations compared to rehai and kangding even after evaporation about 18 of the water samples had li concentrations higher than 11 7 mg l and most of which were lower than 20 mg l also the cl li ratios of the tibet geothermal springs were close to those in rehai and kangding hence because it has been proven that mantle magma supplies the heat beneath the rehai geothermal area we can infer that the amount of cl and li released from the crust magma and mantle magma have minimal influence empirically classical geothermometers are more suitable for high temperature geothermal springs from reservoirs with little or no mixing with other groundwater sources nicholson 1993 however for thermal springs with lower outlet temperatures it is more likely that the fluids mix with large amounts of infiltrating groundwater before ascending to the earth s surface possibly disturbing the pre mixing k mg sio2 equilibrium established in the reservoirs this considerable uncertainty decreases the reliability of the k mg geothermometer estimates again k mg geothermometer estimates cannot be treated as the reservoirs temperatures due to the high mg concentrations in the groundwater in lower li springs li from the water reaction processes may account for a significant proportion of the total li concentration hence they cannot be ignored these explain why the concentrations of the conservative species in many geothermal springs have no evident relationship with the k mg temperatures as shown in fig 6 however based on fig 7 the near linear relationship between cl and li may indicate that the li in most of tibet s geothermal springs may originate from the magma for these low li spring waters although further studies are needed to substantiate this conclusion or otherwise preliminarily the present study has ascertained the enrichment mechanisms of lithium for the li enriched geothermal springs in southern tibet based on the hydrochemical methods however further studies involving more li isotope data of geothermal springs are needed to increase the confidence in this work s conclusions 6 conclusion although hundreds of geothermal springs are exposed in southern tibet the majority seem to be chemically influenced by magma estimates of k mg and chalcedony geothermometers indicate that the reservoir temperatures of the tibet hydrothermal systems studied are relatively low 200 c the reservoirs with 200 c probably formed by a mixture of deeper high temperature fluids and infiltrating groundwater and most of the geothermal springs are from these shallow reservoirs moreover none of the thermal springs originates directly from the deep high temperature reservoirs because all the water samples have a relatively low water rock reaction deviating from full equilibrium after mixing with infiltrating groundwater li hardly leaches from the surrounding rocks in the shallow reservoirs instead the high li of southern tibet s geothermal fluids are mainly from the magma two hydrochemical processes result in the elevated levels of li in southern tibet s thermal fluids firstly the deeper fluids have relatively high magmatic li from the degassing of the semi molten state magma rather than li leaching from the surrounding rocks in the deep reservoirs then the li rich thermal fluids mix with different amounts of infiltrating groundwater before ascending to the earth s surface in the shallow reservoirs forming thermal springs of varying li concentrations also the semi molten state magma does not cause a further rise in li concentration secondly the southern tibet thermal springs have comparable li enrichment with other magma influenced hydrothermal waters but evaporation further concentrates the li in the southern tibet fluids lastly distinguishing the li source seems difficult for the geothermal springs with low cl concentrations nevertheless it is more likely that the magmatic li constitutes the main portion of the total li concentration credit authorship contribution statement jiexiang li methodology writing original draft xinyi wang supervision validation chuanxia ruan software gideon sagoe language editing jianlin li writing reviewing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this work was supported by the national natural science foundation of china 41972254 42102297 41877208 innovative science and technology talents team construction project of henan province cxtd2016053 china postdoctoral science foundation 2021m701098 and special funds for higher education basic scientific research funds of henan province nsfrf200103 nsfrf210304 key scientific research projects of colleges and universities in henan province 22a170009 apendix 
3158,a continent wide classification study of australian catchments was undertaken to group drainage basins with comparable flow characteristics based on forty metrics from the themes of climate topography surface condition and hydrogeology a principal component analysis reduced the multi collinear indices to nine principal components pcs a fuzzy c means cluster analysis on the pcs resulted in the delineation of eight subcatchment clusters with similar physiography and 82 5 of subcatchments displaying a membership coefficient greater than 0 7 subcatchments with poor cluster membership levels may be significant in highlighting complexity in the interaction between climatic controls and local geomorphological and land use variability the clusters are distinguished by different attributes in several key subcatchment variables and each group is described in terms of its flow and flood profile these interpretations are supported by separately derived streamflow signatures from gauged catchments cluster and pc distribution mapping revealed distinct spatial and drainage relationships between the subcatchments relevant to the assessment of flood behaviour the spatial pattern of the river basin regionalisation via physical catchment similarity closely resembles the modified köppen climate classification with differences highlighting the importance of non climate characteristics on streamflow behaviour in australia the catchment classification is an australia wide regionalisation scheme incorporating datasets with disparate spatial distribution and ungauged subcatchments this study therefore provides the framework for more detailed streamflow analysis by applying consistent methods across all catchments in australia and has implications for flood risk prediction mitigation and planning keywords catchment classification climate variability fuzzy c means clustering streamflow patterns topography water infiltration capacity 1 introduction catchment classification is a commonly applied measure that can address a wide range of research queries including regionalisation endeavours to assess ungauged catchments regionalisation is principally a process whereby catchments or river gauges are grouped according to homogeneity rao and srinivas 2008 regionalisation methods are employed to investigate catchments that may be data poor owing to paucity of gauging stations or limited time series records identification of homogenous regions allows for analyses in ungauged drainage basins and extended use of existing data some specific regionalisation or catchment delineation methods include weighted cluster analysis by climate or hydrology e g laaha and blöschl 2006 rao and srinivas 2008 the region of influence roi approach burn 1990 self organising maps unsupervised artificial neural networks ley et al 2011 geostatistical methods such as kriging e g top kriging a geostatistical method applied by merz and blöschl 2005 skøien et al 2006 and combined fuzzy clustering and bayesian modelling used by kennard et al 2010 on australia wide hydrological data for stream classification previous studies utilised diverse methods and parameters to classify regions e g olden et al 2012 and references therein catchment attributes are generally selected and adapted based on the intended application of the classification scheme sawicz et al 2014 employed six hydrological signatures to assess changes in catchment streamflow behaviour in the contiguous united states of america usa on decadal timescales stein et al 2009 grouped australia s stream network by applying a non hierarchical clustering method on 48 ecohydrological attributes kennard et al 2010 identified twelve distinct flow regimes in australia by exploring 120 ecologically relevant features on a regional scale brown et al 2014 employed random forests for classification of remotely sensed images in southeast australia whereas erskine et al 2017 focussed on geomorphological characteristics of rivers in northern australia new zealand rivers were grouped based on the river environment classification rec a deductive method incorporating climate topography geology land cover stream order and valley slope snelder and biggs 2002 snelder and booker 2013 determined that the rec was outperformed by statistically derived river categorisation methods in terms of their capability to describe streamflow dynamics snelder and booker 2013 also highlighted that various methods produce credible flow regime classifications with differences in groupings explaining distinctive aspects of river characteristics kuentz et al 2017 applied a classification and regression tree on 35 catchment descriptors and 16 flow signatures to group european drainage basins into ten classes many studies classify river basins by prevailing climate or hydrology rather than catchment characteristics e g topography or geology delineation methods commonly employ rainfall records instead of runoff data because the former are more abundant and are applicable to ungauged sites however merz and blöschl 2005 suggested that spatial proximity is demonstrably more powerful a control on similarity than any catchment characteristic arguing that spatially close drainage basins tend to have greater similarity in flood behaviour than distal catchments with comparable geomorphological properties spatial proximity implies similar extrinsic and intrinsic characteristics impacting flooding nevertheless some drainage basins although spatially proximal do exhibit distinctly different flood behaviour in response to differing geomorphological characteristics e g adjoining catchments on either side of the great dividing range australia regionalisation limited to only spatial proximity will therefore not always outperform a method that uses only catchment characteristics a combination of methods for example the hybrid roi eng et al 2007 can produce superior results in flow estimation catchment regionalisation improves data availability for streamflow studies by extending results into ungauged catchments and combining similar datasets to create larger records regionalisation outcomes are applicable to a range of further studies including flood frequency analysis and rainfall runoff modelling e g croke and norton 2004 eng et al 2007 merz and blöschl 2005 for instance regionalisation was used to more confidently estimate inputs required for rainfall runoff models e g the baseflow index and baseflow recession constant promoted by gibbs et al 2008 rainfall runoff models are a common tool in catchment studies giving a better understanding of catchment and stream behaviour e g annual average catchment yield dry season low flow characteristics or frequency of flow events above certain levels most rainfall runoff studies in australia focus on water yield rather than flood estimates boughton 2005 and few studies examine ungauged drainage basins rainfall runoff models rely on a regionalisation framework to allow for continent wide comparability in their employment guo et al 2021 at continent scale regionalisation is the necessary first step in grouping comparable catchments whereby similarity reflects a range of parameters that in some way interact with surface flow jaffrés et al 2021 demonstrated the strong link between streamflow and a diverse range of basin properties that encompass the fields of climate topography hydrogeology and surface catchment properties hence in the absence of a high density stream gauge network basin properties exclusive of surface hydrology data offer a strong unbiased method of regionalisation that characterises streamflow behaviour for the present study an australia wide regionalisation approach based on the physical similarity of river basins was employed with the aim of gaining an improved understanding of catchment behaviour in response to streamflow to achieve this goal objectives include the 1 creation of a classification scheme for australian catchments and 2 identification of specific metrics that define each catchment grouping these results then provide the framework for which catchment specific surface flow and flood risk assessment can be applied each core dataset is briefly described in section 2 whereas section 3 introduces the applied methods the results are presented in section 4 with each cluster discussed in detail in section 5 recommendations with respect to future studies are given in section 5 4 additional statistical details are provided in the supplementary material 2 core datasets the chosen parameters reflect hydrological behaviour and include measures of various catchment characteristics encompassing the fields of climate section 2 1 topography section 2 2 surface condition section 2 3 and subsurface permeability section 2 4 the derivation procedure for the forty subcatchment variables are detailed in section 2 of the companion paper jaffrés et al 2021 and a summary is presented here a complete list of indices and data sources is provided in table 1 jaffrés et al 2021 also introduced an amalgamated streamflow dataset from 749 gauges that are deemed of good quality and have a minimum data record of 15 years many of australia s catchments are essentially ungauged with streamflow monitoring predominantly focussed on more urbanised regions because of the data sparsity in a vast proportion of catchments and site disparity streamflow data are only applied in supporting capacity here to test the pertinence of sub basin clustering via attributes of climate topography hydrogeology and land surface examined streamflow properties are introduced in section 2 5 with appendix a 5 providing a more comprehensive summary 2 1 climate eighteen climate metrics table 1 related to rainfall actual evaporation and mean sea level pressure mslp patterns were included in this study table 5 in jaffrés et al 2021 mslps are included to represent atmospheric low pressure systems that often deliver intense precipitation with the rain bursts decreasing the potential of water infiltration while amplifying runoff conversely evaporation is incorporated to characterise water loss particularly during the drier seasons all daily weather station data were obtained from the bureau of meteorology bom precipitation descriptors include the annual average mean number of rain days the rainfall percentage during the austral summer season november to april and the first four l moments to derive the four l moment metrics only rain days were considered i e days with a minimum precipitation of 0 2 mm the method of l moments describes the shape of a probability distribution without assuming normality hosking and wallis 2005 and therefore offers more realistic estimates of extreme values in climate and hydrological settings where extreme events are common for l moments l r 3 where r is the moment of interest l moment ratios τ r l r l 2 were also calculated for simplicity l moment ratios τ 3 to τ 4 are hereafter also referred to as l moments the first four l moments are equivalent to mean l 1 standard deviation sd l 2 skewness τ 3 and kurtosis τ 4 a detailed description of the l moment derivation method is provided in appendix a 1 for evaporation and mslp the first three l moments for both the winter may to october and summer season were derived for every subcatchment with multiple climate stations each climate statistic was averaged to assign a single value for each variable to that subcatchment a radial basis function interpolation was applied to allocate values to subcatchments without climate stations 2 2 topography the digital elevation models by geoscience australia 2011 were utilised to derive 2816 subcatchments with gis based software package catchmentsim version 3 0 3 1 describing each subcatchment with eighteen topographical attributes jaffrés et al 2021 these features include area slope stream length horton s drainage density and elevation characteristics table 1 calculated by the software 2 3 surface condition the land surface value lsv presented in jaffrés et al 2021 was incorporated for this catchment classification scheme jaffrés et al 2021 illustrated how the vast diversity of soil descriptions could be aggregated into a simple relative rank value the lsv incorporating key parameters such as permeability texture and absorbance clay content and behaviour depth of soil profile incorporating geological outcrop and anthropogenic land use effects smaller lsvs represent subcatchments with higher water absorbance capacity whereas larger lsvs indicate more surface runoff 2 4 subsurface permeability subsurface permeability was assigned to each subcatchment based on surface lithology characteristics the surface lithology data were accessed from the australian hydrological geospatial fabric ahgf or geofabric https www bom gov au water geofabric index shtml groundwater cartography product v2 1 1 2 5 streamflow the australian streamflow dataset introduced in jaffrés et al 2021 was applied here with the average daily flow volumes downloaded from the bom water data online wdo https www bom gov au waterdata website in july 2018 all 749 wdo stations are listed by the bom as having data of superior quality are minimally impacted by anthropogenic changes and have a record length of at least 15 years time series shorter than 15 years are unlikely to include large rainfall events thus causing an underestimation of extreme flow events the data were used to derive 16 surface hydrology and baseflow variables table 2 flow events were defined based on peaks in flow rates above the 80th percentile for two peaks to be considered separate events the flow had to return to below the 80th percentile or to no flow for highly intermittent or ephemeral streams if multiple peaks were registered within a 6 day window only the main peak was selected the event duration was then the number of days during which the flow rate remained above the 80th percentile the rapidity and frequency of short term fluctuations in flow rates was investigated in terms of flashiness of the stream the richards baker flashiness rbf index baker et al 2004 is based on the differences in daily flow rates i 1 n q i q i 1 i 1 n q i low flow was considered in terms of the lowest mean flow during a 7 day window in addition the dimensionless baseflow index bfi was derived the bfi is the ratio of baseflow volume to total streamflow volume for a specified time period the bfi was extracted by applying the recursive digital filter method lyne and hollick 1979 f k a f k 1 1 a 2 y k y k 1 y k f k 0 where fk is the filtered quick response at the k th sampling instant yk is the original streamflow a is the filter parameter and yk fk is the filtered baseflow a filter value a of 0 98 was applied jaffrés et al 2021 for further details see appendix a 2 3 methods a regionalisation study of australian catchments was undertaken with the aim of determining similarities between drainage basins in terms of the parameters associated with streamflow dynamics and flooding standard regionalisation methods such as roi often focus on individual catchment gauges weighting adjacent gauged stations according to their degree of resemblance e g burn 1990 in remote regions of australia numerous catchments are ungauged and surface hydrology data are thus unavailable therefore a classification method was developed to identify resemblance among drainage basins according to other catchment signatures e g climate and topography specifically data availability for these traits had to encompass all of continental australia and tasmania in jaffrés et al 2021 surface hydrology data were utilised independently to determine whether the selected properties were relevant to streamflow response in ungauged catchments jaffrés et al 2021 delineated the relationships between surface hydrology data including baseflow characteristics and forty catchment metrics covered by the themes of climate topography surface condition and hydrogeology the surface hydrology indices are only used in supporting capacity for the second stage of this study i e to test the relevance of the catchment classification because most subcatchments are ungauged and spatial interpolation across subcatchments is meaningless in a hydrological context a principal component analysis pca based on a correlation matrix was conducted on the forty subcatchment descriptors table 1 to remove collinearity and unwanted biases in the cluster analysis the pca reduced the climate topography surface condition and hydrogeology dataset to nine orthogonal components each principal component pc was rotated by applying the varimax rotation to realign the input variables to specific components see appendix a 3 for details each rotated component was weighted by using their rotated pc eigenvalues to ensure that significant components had a greater impact in the cluster analysis before conducting fuzzy c means fcm clustering bezdek 1981 dunn 1973 several tests were undertaken to determine the most appropriate number of clusters the r package vegan oksanen et al 2013 allows for the measurement of the caliński harabasz criterion caliński and harabasz 1974 the caliński harabasz criterion is an internal measure and is sometimes called the variance ratio criterion this criterion compares the variance between clusters with the variance within clusters to determine cluster number suitability the highest value of the caliński harabasz criterion is considered the optimum number of clusters appendix a 4 outlines additional tests that were applied to establish optimum cluster numbers fcm clustering was then employed on the nine pcs to identify similarities between subcatchments the fcm clustering was performed with the r function fanny metric sqeuclidean a sum of squares of differences between observations part of package cluster maechler et al 2013 whereas hard clustering assigns each object to just one cluster soft or fuzzy clustering may assign the object to several clusters hence hard clustering allocates a membership coefficient mc of 1 to one cluster and 0 to all others conversely fuzzy clustering will assign relative mc values between 0 low fit to 1 strong fit to each cluster reflecting that several clusters may represent the characteristics of the object in this instance subcatchments the results of the fcm cluster analysis were also utilised to quantify cluster membership confidence to allow for the identification of clusters that did not neatly fit any category for each subcatchment the largest mc value was used to allocate subcatchments to a cluster mc values of close to 0 indicate a relatively poor fit and an mc of 1 implies an excellent fit after the application of fcm clustering on the sub basins each of the 749 streamflow timeseries was assigned to the cluster of its corresponding subcatchment the non parametric mann whitney u test wilcoxon rank sum test was then applied to test for disparities in distributions of streamflow properties table 2 between each pair of clusters the significance level for the analysis was set at 95 α 0 05 4 results 4 1 principal component analysis pca forty subcatchment metrics were used for the pca nine pcs were chosen based on a minimum eigenvalue of 1 incorporating 82 6 of the information contained in the subcatchment descriptors their spatial distribution is shown in fig 1 climate related descriptors dominate the first two pcs table 3 pc1 is associated with rainfall and mslp patterns within catchments with a strong latitudinal trend evident fig 1a pc2 is primarily devoted to evaporation with a secondary focus on variability in elevation and surface conditions a clear pattern towards lower pc values with greater distance from the coast is observable fig 1b reflecting the negative correlation between pc2 and evaporation levels pc3 relates to stream length and to a lesser extent subcatchment area elevation and slope characteristics are mainly represented by pc4 and pc5 respectively pc6 contains information about horton s drainage density and to a lesser level infiltration capacity lsv and subsurface permeability extreme rainfall intensity and regularity l moments 3 and 4 are dominant in pc7 whereas channel skewness and total upstream area are included in pc8 variability of subsurface permeability is the principal index in pc9 although pc6 explains a similar proportion of this feature albeit with reverse sign the complete rotated component loadings matrix is provided in table a 2 4 2 cluster analysis catchment classification scheme the test results for the optimal cluster number were not entirely consistent although most indicated a preference for 5 8 or 9 groups this pattern is epitomised by the caliński harabasz criterion according to that criterion the optimum number of clusters is 5 although 8 and 9 clusters are also recommended fig 2 all three options were investigated here we opted to analyse and present the eight clusters version in detail the mapping results based on 5 and 9 clusters are provided in appendix a 4 fig a 1 and fig a 2 all subcatchments in australia were grouped into eight fcm clusters the cluster specific data distributions for the 40 parameters are illustrated in fig 3 climate and lsv and fig 4 topography and hydrogeology fig 5 shows the spatial distribution of each subcatchment based on their strongest membership to a cluster cluster centres conventionally the mean subcatchment descriptor values within a cluster may be used to characterise a cluster but the fcm clustering method employed here does not allow for their direct calculation therefore the index values from the subcatchments with the largest cluster mcs were designated as a proxy for the cluster centre an mc value of 0 99 was applied as a cut off hence characteristics of subcatchments with a minimum membership of 0 99 are used to assign their median value for each descriptor to that cluster group table a 3 in appendix a 4 detailed interpretations of descriptor relationships characterising each cluster are provided in section 5 cluster mcs for each subcatchment are shown in fig 6 small cluster mcs highlight regions that require additional investigation to characterise their cluster profile most 82 5 subcatchments have mcs greater than 0 7 and 96 1 have mcs above 0 5 hence most subcatchments are assigned to their cluster type with a high certainty cluster specific mcs are presented in fig 7 the distribution of subcatchments per group is uneven with the fewest number contained in cluster 5 68 table 4 conversely 548 subcatchments are attributed to cluster 1 the number of stream gauges is greatest in cluster 8 359 whereas only one gauge is situated in a cluster 4 subcatchment except for cluster 8 the vast majority of sub basins in each group are ungauged table 4 in cluster 8 the median mean number of gauges per subcatchment is 1 2 04 sub basins in all other groups tend to have no gauges median of zero although multiple gauges may be associated with individual subcatchments maximum of 15 in a cluster 8 sub basin they are not necessarily operational concurrently in terms of mc subcatchments in cluster 2 have the greatest proportion exceeding 0 99 57 5 table 4 in comparison only 21 4 23 3 exceed that mc threshold in cluster 1 8 clusters 3 4 and 6 contain no gauges in subcatchments with a minimum mc of 0 99 fig 8 conversely approximately a third of the gauged sub basins in clusters 2 5 and 8 reach the 0 99 mc cut off with a maximum of 38 4 in cluster 2 however only 15 4 of the gauges i e four stations in cluster 5 are in subcatchments with an mc of at least 0 99 on a national scale 87 3 of subcatchments are ungauged with a mean number of 0 27 gauges per sub basin table 4 a total of 1016 subcatchments 36 1 have an mc of at least 0 99 with 97 of these gauged i e 27 1 of the 358 gauged sub basins 4 3 mann whitney u test hydrological differences the biased spatial distribution of stream gauges favouring the more populated coastal regions of australia creates disparity in the number of data points per cluster ranging from one station in cluster 4 to 359 sites in cluster 8 table 4 and fig 9 the mann whitney u test confirmed distinct differences between the clusters based on hydrological flow patterns as also illustrated by boxplots fig 10 for instance clusters 1 2 and 8 were deemed to have significantly different data distributions for most streamflow characteristics investigated clusters with fewer stations i e groups 3 to 6 exhibit fewer statistically significant results despite having the most extreme median values for some hydrological features e g bfi for cluster 3 fig 10m 5 discussion 5 1 catchment cluster characterisation the eight subcatchment groups derived with fcm clustering are typified by distinct signatures specific to each cluster each cluster is characterised by the average median descriptor value of subcatchments with the largest mcs 0 99 for that group table a 3 all eight clusters are compared with each other based on their relative values the indices have relatively high or low values in different clusters allowing characterisation of flow response however the nuanced relationship between variables and their relative significance within a cluster also impacts flow response interpretation of the cluster versus descriptor relationships shown in table a 3 in the context of the regional subcatchment distributions fig 5 revealed through the pca provides the basis for cluster descriptions presented here see also appendix a 4 for each cluster two main properties are described 1 the climate patterns within the region that characterise rainfall evaporation and potential for extreme pressure events such as monsoonal activity and cyclones and 2 the impact of topography and infiltration capacity on runoff pathways through individual catchments because of the sparsity and cluster disparity in available hydrological data associated patterns are only briefly discussed for each group 5 1 1 cluster 1 northern subtropical australia monsoonal influence cluster 1 subcatchments have high average daily rainfall 13 8 mm combined with average annual rain days 39 6 days most precipitation 91 8 falls in summer fig 3b further these areas also have relatively high daily rainfall variance fig 3d suggesting unpredictable rainfall patterns thus rainfall is strongly seasonal falling almost exclusively between the summer months of november to april when mslp fig 3m is very low and monsoonal activity is high the general absence of rainfall and cloudy condition during winter promotes increased evaporation during that period fig 3h during the dry season or during drought flow in the non perennial lower order streams ceases this is confirmed by the 50th percentile of surface flow with a catchment average of 0 m3 s for the gauges in this cluster along with comparatively low bfis in most streams fig 10m table a 4 topographical characteristics for cluster 1 are nondescript with all parameters considered average variability of subsurface permeability is relatively high and is the only non climate index deviating notably from the average fig 4t table a 3 when combined with rainfall patterns this characteristic suggests a strong propensity for localised flash flooding in these catchments during the more severe rainfall events this interpretation is supported by the largest cluster averaged rbf value 0 676 obtained for this group with the next highest rbf median 0 639 associated with cluster 5 fig 10g table a 4 large streamflow events in cluster 1 subcatchments are dominated by extreme rainfall and cyclonic storms or monsoonal activity during summer months average topographical characteristics surface condition and deep drainage capacity have little tempering effect on these flood inducing climatic properties consequently mean peak and surface flows tend to be highest in this cluster fig 10c h table a 4 increasing the risk of flash and riverine flooding 5 1 2 cluster 2 far northern coastal australia monsoonal summers cluster 2 subcatchments are characterised by very high average daily rainfall 15 4 mm and high rainfall variance fig 3c d but low skewness and kurtosis fig 3e f table a 3 this suggests that intense rainfall events occur frequently and extreme rainfall events are relatively common rainfall is also distinctly seasonal with most of the rain falling almost exclusively 95 4 between the months of november and april fig 3b accordingly with an annual total of 71 7 rain days many austral summer days will record some rainfall promoting lower evaporation levels fig 3g annual rainfall is highest in cluster 2 subcatchments 1104 8 mm based on the combination of average daily rainfall and rain day number fig 3a c cluster 2 subcatchments are typified by small variance in mslp fig 3o p mslp is negatively skewed in both seasons fig 3q r in summer cluster 2 has the most negative mslp skewness in the country 0 07 table a 3 the reverse pattern is evident in winter with the mslp of all other groups more negatively skewed than for cluster 2 0 02 these features suggest extreme low pressure events such as monsoonal lows troughs or tropical cyclones impacting on these catchments cluster 2 subcatchments are therefore prone to monsoonal and cyclonic activity during the summer period whereas winter storms are rare subcatchments within cluster 2 have low maximum elevations fig 4n and in contrast to the other clusters the smallest mean and median fig 4p q table a 3 further they are typified by below average flow path lengths and relatively high variability in subsurface permeability the upstream area is nearly three times larger than the area limited to individual subcatchment although both indices are near average compared with other clusters hence streamflow behaviour and flooding in upper subcatchments will impact on the downstream subcatchments given the high summer rainfall pre wetting from early wet season monsoonal storms and moderate evaporation may result in mid late wet season flooding after further rain these subcatchments also have the greatest rainfall variability fig 3d indicating a strong inclination for extreme rainfall events and therefore major flooding the minimal gradient of the coastal plains can also increase flood probability by discouraging efficient drainage into the ocean however high flow events generally do not last long in these catchments as encouraged by the relatively short stream lengths and reflected in the comparatively low cluster median for event duration fig 4k fig 10e nevertheless this characteristic can partially be ascribed to the very high 80th percentile 4 11 m3 s for this group fig 10f because flow events were defined based on that percentile high flow periods excluded flow volumes that would still be classed as part of major flow events in other clusters with more prolonged events derived from lowered volume thresholds 5 1 3 cluster 3 central australia dry riverbeds cluster 3 subcatchments display relatively large rainfall skewness and kurtosis fig 3e f this suggests that rainfall events are scarce and usually dominated by moderate storms the low number of annual rain days 31 4 days confirms the generally arid condition of these regions with a slightly greater chance of rainfall during the summer period 67 8 table a 3 evaporation is comparatively high within cluster 3 subcatchments particularly during the summer months fig 3g and highly variable throughout the year fig 3i j moderate rainfall levels and high evaporation leads to predominantly dry catchments all year round annual rainfall totals are among the lowest of the country 274 2 mm the topography of these subcatchments is mostly non distinct near average compared with the other clusters table a 3 however cluster 3 subcatchments typically present with low bifurcation ratio fig 4f denoting a large proportion of high order streams average elevation is very high in these subcatchments fig 4p q subsurface permeability fig 4s and surface absorbance fig 3s capacity are relatively high i e low lsv consequently the potential impacts of severe rainfall events are mitigated by permitting a large proportion of precipitation to infiltrate into the ground encouraging groundwater recharge simultaneously these characteristics also suggest that most streambeds remain dry except during heavy persistent rainfall periods i e predominantly ephemeral streams this view is supported by the low cluster median for bfi throughout the year in cluster 3 fig 10m n o although the number of high quality gauges is small n 4 and all stations are located in subcatchments with relatively low mcs 0 26 to 0 96 fig 8 5 1 4 cluster 4 flat central australia infrequent slow flows cluster 4 subcatchments feature two distinct groups fig 5 the main subcluster is located in the central east of australia whereas a smaller more disjointed assemblage is found inland of northern western australia cluster 4 subcatchments are distinguished by a small number of rain days 24 6 days but relatively high average daily rainfall 12 9 mm and variability fig 3a c d annual rainfall totals are only moderately larger 317 7 mm compared with those of cluster 3 the average skewness and kurtosis of rainfall data fig 3e f table a 3 suggest that intense rainfall events occur infrequently evaporation in these subcatchments is consistently high throughout the year fig 3g h but more variable in winter relative to other clusters fig 3j the climate characteristics associated with cluster 4 denote arid or semi arid conditions because most precipitation 76 3 falls during the summer period fig 3b and annual rainfall totals are low many streams are non perennial with flows usually restricted to brief periods of significant precipitation ephemeral streams cluster 4 subcatchments are relatively small fig 4a and have very low vertical gradients in the upstream regions whereas median elevation 199 7 m is average elevation variability is extremely small fig 4q r hence these subcatchments are very flat high peaks required to increase flow velocity are also absent fig 4n these subcatchments generally have very low absorbance i e high lsv fig 3s hence the landscape is predisposed to expediting runoff even with moderate subsurface permeability permitting a greater percentage of rainfall to reach watercourses subcatchment topography suggests slow and low streamflow the climate of cluster 4 is very dry with few rain days high evaporation and non distinct mslp conditions these attributes suggest that non perennial streams are common in cluster 4 as also indicated by the skewed streamflow data distribution l moment 3 of the sole stream gauge in this cluster station 130324a fig 10j table a 4 because severe rainfall events are rare high flow episodes are only infrequently experienced in the flood prone landscape stream gauge 130324a is situated in one of the eastern most subcatchments within cluster 4 outside the main area of this group further its cluster membership is relatively poor nearly evenly split between cluster 4 42 4 and cluster 3 40 8 accordingly streamflow properties derived from this site are not necessarily typical of this cluster 5 1 5 cluster 5 spatially disjointed large catchments slow moving flows cluster 5 subcatchments are geographically least constrained with members spread throughout most of continental australia fig 5 these subcatchments are typified by their topographical and infiltration characteristics rather than climate the most distinguishing features of these subcatchments are their large size gentle slopes and very low stream density fig 4a c e further stream lengths are extremely long fig 4g i k and simultaneously also greatly variable fig 4l the generally average condition of climatic indices is reflective of the large spatial spread of relevant subcatchments encompassing a variety of climate regimes subcatchments within cluster 5 are large and flat compared with other clusters fig 4a c slopes along the main flow path are gentle fig 4j meaning that flow velocity across these areas is reduced further they are also typified by very low stream density and channel skewness fig 4e m suggesting symmetrical drainage patterns among the small numbers of waterways in these basins the topographically induced propensity for long lasting high flow events is partially offset by very high subsurface permeability observed throughout most of these subcatchments fig 4s further the lsv is moderate albeit highly variable the very high capacity for water infiltration within cluster 5 subcatchments particularly in localised areas with low lsvs will delay and subdue peaks in streamflow and partially explains the low drainage density thus a large proportion of available water is expected to drain to the water table rather than progressing as overland flow this factor in combination with the semi arid to arid climate means that acute floods are not experienced regularly in cluster 5 subcatchments the modest number of stream gauges n 26 situated in cluster 5 subcatchments shows that peak flows are generally low cluster median of 1 7 m3 s table a 4 and combined with relatively few flow peaks 4 15 per year and small flow volumes flood risk is usually limited however the large areal extent low gradient and low stream density of these subcatchments suggest that these areas are susceptible to slow moving large scale flow events when a severe rainfall event does occur the lower reaches of the extensive murray darling river system and some larger subcatchments in north central new south wales were predominantly allocated to cluster 5 because most tributaries to the lower murray darling basin instead belong to cluster 7 section 5 1 7 downstream flow patterns heavily depend on the characteristics of both clusters especially as upstream areas tend to be extremely large 5 1 6 cluster 6 southern inland australia arid cluster 6 has the smallest average number of rain days 23 4 days per year of any cluster with an average of 8 0 mm recorded during those days fig 3a table a 3 consequently these are australia s driest subcatchment with an annual total of approximately 186 0 mm whereas variability of daily precipitation is low rainfall patterns have relatively high skewness and kurtosis fig 3d e f indicating that extreme rainfall events are possible but rare low rainfall coupled with very high summertime evaporation and high mslp throughout the year fig 3g m n indicates an extremely arid climate with ephemeral streams evaporation is greatly variable fig 3i j a reflection of the extremely dry conditions sporadically interspersed by brief rain periods the subcatchments of cluster 6 are particularly small in size and stream length fig 4a g i k their upper reaches are only gently sloping consistent with very low maximum elevation 241 8 m and a small elevation range fig 4d n o these attributes suggest that streamflow is probably slow this interpretation is confirmed by the nine stream gauges situated within these subcatchment with median event lengths 8 days greater than in all other clusters fig 10e cluster 6 subcatchments have a relatively low capacity to absorb water at the land surface high lsv fig 3s indicating more overland flow reporting to streams near average subsurface permeability only moderately encourages underground lateral flow cluster 6 subcatchments are predominantly arid supporting ephemeral streams peak flows within these subcatchments depend not only on rainfall but also on sufficiently low evaporation and antecedent soil moisture reaching critical levels convergence of these conditions is unlikely mitigating widespread inundation or flash floods especially because the upstream area is very small however localised short lived floods may occur in areas of poor field capacity i e high lsv the high lsvs indicate a strong propensity to generate runoff at the land surface rather than absorbing water into the soil profile any water that does reach the subsurface may be transmitted relatively quickly the arid or semi arid climate of cluster 6 subcatchments as indicated by very few rain days high evaporation and high mslp is not strongly conducive to flooding further the high lsv may increase runoff intensity but with little available rain small catchment size and moderately high subsurface permeability acting to delay and subdue streamflow peaks the potential for flooding from rainfall within the subcatchment is low 5 1 7 cluster 7 australian wheat growing belt moderate rainfall cluster 7 has the lowest mean daily rainfall 7 5 mm and variability in comparison with other clusters fig 3c d in addition similar seasonal rainfall totals can be expected during the summer 46 9 and winter periods fig 3b however the two disconnected regions in this cluster exhibit very distinct differences in climate winter rainfall is markedly more prominent in southwestern australia 74 5 n 38 fig 11 b whereas the eastern segment 49 8 summer rain n 77 is more representative of the cluster median consequently winter mlsps in the western zone tend to be lower fig 11 h indicative of the occasional storm passing through in the western region mean daily rainfall and variability are distinctly lower fig 11c d conversely the annual number of rain days is comparable between the two areas fig 11a because the western region experiences fewer rain days during the summer evaporation rates are greater in that period fig 11e combined with low rainfall skewness and kurtosis and average number of rain days 70 4 days most rainfall events in these subcatchments are of very low intensity extreme rainfall events such as intense storms are uncommon within these subcatchments evaporation is below average during winter reflecting the greater prevalence of rainfall during that period compared with other clusters 1 4 mslp is high throughout the year supporting the absence of notable rain events cluster 7 subcatchments are geomorphologically nondescript topographical characteristics of cluster 7 sub basins are close to average table a 3 however the western and eastern subcatchments in this group differ markedly in terms of maximum elevation vertical range lsv and to a lesser extent upstream area fig 11i l in cluster 7 the large absorbance capacity at the surface low lsv coupled with average capacity for water movement to depth suggests that flooding is more likely after interstitial moisture levels have risen to capacity however because rainfall is generally moderate to low high flow events occur rarely stream gauges confirm that peak flow volumes in this cluster tend to be smaller than in most other groups fig 10c table a 4 the large variability in both subsurface permeability and lsv fig 3t fig 4t indicates diverse lithology and different distributions of land use categories and soil types within these subcatchments with lowlands likely having a greater capacity for water infiltration subcatchments in cluster 7 are centred in two distinct areas southwest western australia and a fragmented band from eastern south australia to southeastern queensland these regions are associated with the major wheat growing belts of australia in the eastern australian distribution zone a large proportion of the subcatchments belong to the major murray darling river system these cluster 7 subcatchments are primarily limited to the upper parts of this sizeable basin these headwaters ultimately feeding the murray and darling rivers further downstream thus the cumulative impacts from the smaller subcatchments are felt by large river systems on a regional scale therefore the rainfall and drainage response in cluster 7 subcatchments is of great significance from an agricultural and economic perspective 5 1 8 cluster 8 mountainous southern australia frequent rainfall cluster 8 subcatchments fig 5 have below average mean daily rainfall 7 5 mm but very large number of annual rain days 117 3 days fig 3a c table a 3 rainfall is evenly spread between the summer 49 9 and winter period fig 3b rainfall of low intensity is therefore regularly experienced in these areas throughout the year consequently cluster 8 subcatchments have significantly lower evaporation compared with other clusters fig 3g h both summer and winter evaporation have small variance but high skewness fig 3i l consequently evaporation is usually low but can rise to high levels occasionally the mslp in cluster 8 is typically moderate winter to very high summer but also greatly variable and with strongly negative skew throughout the year fig 3m r consequently strong low pressure systems and cold fronts are rare and short lived fast moving over these catchments subcatchments within cluster 8 are generally very hilly or mountainous they have very steep slopes fig 4c d h j but average stream length across the subcatchment fig 4i k the maximum elevation 1320 9 m is very high compared with all other clusters and changes in elevation are significant fig 4n r stream density is high but their arrangement is not symmetrical across the subcatchment fig 4e m lsv values are relatively low fig 3s supporting large water absorbance however typical subsurface permeability levels are extremely low in these subcatchments fig 4s hence whereas the land surface encourages water uptake the lithology impedes efficient water infiltration and predisposes expedited runoff this factor reflects the large proportion of exposed hard rock surfaces associated with mountainous regions promoting significant runoff because of the advanced geological age of the australian landscape the topmost section of a stream channel is usually denuded of topsoil leaving a comparatively impermeable surface where runoff is rapid across the upper slopes cluster 8 subcatchments typically present with a high bifurcation ratio fig 4f this attribute denotes a large proportion of 1st order streams a reflection of a great number of creeks originating in the elevated regions cluster 8 subcatchments have perennial streams as a result of the combination of consistent daily rainfall and reliably low evaporation the high relief topography suggests that transmission of water through the catchment is likely rapid this is intensified by the land surface properties that indicate drainage of overland flow is fast the fast flowing drainage can result in flash floods although high intensity rainfall events are relatively rare based on the climate characteristics however because of regular rainfall and fast drainage flow events exceeding the 80th percentile are relatively common fig 10d table a 4 cluster 8 subcatchments can be exposed to floods in their lower reaches but conditions are not conducive to frequent extreme peak flows flow volumes are comparatively high throughout the year in these subcatchments fig 10k table a 4 and combined with limited flow variability fig 10i therefore produce the lowest median rbf 0 450 of any cluster fig 10g typical subsurface permeability is very low fig 4s resulting in a long delay between rainfall recharge to the water table and subsequent discharge to streams as baseflow snowfall may play a significant role in flooding tasmania and the australian alps 5 2 comparison of catchment classification schemes fig 12 exemplifies the dominance of climate descriptors in clustering individual subcatchments according to their intrinsic and extrinsic properties except for cluster 5 and to a lesser extent cluster 3 all groups are associated with distinct climatic conditions subcatchments with low pc1 values clusters 1 and 2 are noticeably biased towards summer rainfall and elevated winter evaporation along with high mean daily rainfall and variability the reverse is applicable for clusters 8 7 and 6 because their subcatchments tend to have high pc1 levels pc2 indicates that cluster 8 and cluster 2 subcatchments have a large proportion of rain days especially when compared with subcatchments in cluster 3 4 and 6 fig 12 also demonstrates that cluster 5 is poorly defined by the pc1 pc2 combination confirming that this cluster is predominantly defined by innate catchment properties e g stream length and area rather than climate attributes the zonation trends revealed in the catchment classification fig 5 are comparable with other published schemes such as the köppen climate classification beck et al 2018 köppen 1936 strong agreement is evident between the catchment clusters and the modified köppen climate classifications of the bom fig 13 a and beck et al 2018 fig 13b cluster 2 corresponds well with the bom s equatorial and tropical zones and beck et al 2018 s tropical area and the temperature subregion typified by dry winters cluster 8 closely resembles the temperate köppen regions that have no distinct dry season the desert köppen groups are represented by clusters 3 4 and 6 in addition to 5 to a lesser extent whereas grassland steppe regions partially overlap with clusters 1 7 and 5 the modified köppen climate classification also considers additional climatic descriptors that were not used in this study e g temperature meaning that these distinct climatic regions are real and consistent for a range of climate metrics however despite the similarities distinct differences between our results and the modified köppen climate classifications are also evident highlighting the nuances in applied climate signatures and the importance of intrinsic catchment properties for example cluster 7 overlaps a relatively large range of groups in both köppen classifications with most of its subcatchments distinguished by high cluster mcs cluster 7 regions are distinguished by a combination of relatively low daily rainfall totals high absorbance low lsvs and large variability in subsurface permeability and land surface conditions the relationships between broad scale catchment types and köppen regions are worthy of further research cluster 2 mostly coincides with class 10 predictable summer highly intermittent flow regime in kennard et al 2010 their fig 6 cluster 1 corresponds to classes 10 to 12 kennard et al 2010 with flow regimes summer dominated and very intermittent cluster 8 predominantly relates to classes 7 unpredictable intermittent flows in more northerly subcatchments and 5 unpredictable winter rarely intermittent in kennard et al 2010 because of the scarcity in available stream gauges in central australia regions of the three inland groups 3 4 and 6 and cluster 5 are generally not covered by kennard et al 2010 cluster 7 partially overlaps with available data in kennard et al 2010 with western subcatchments graded as having predictable winter and intermittent to highly intermittent flow regimes classes 7 and 9 cluster 2 closely matches meta groups a and e in stein et al 2009 their fig 8 10 these meta groups are characterised by high summer runoff fig 8 11 in stein et al 2009 meta group b equivalent to cluster 1 also features summer dominated runoff highly variable runoff exemplifies meta group c that represents clusters 3 4 and 6 cluster 7 mostly corresponds to meta group d typified by greater winter runoff and relatively large flow variability cluster 8 is covered by several meta groups f j these regions have high annual runoff and a greater tendency for winter dominated flows cluster 5 is generally not covered by the meta groups of stein et al 2009 5 3 large scale data availability pc1 and the classification study confirm that australia s subcatchment clustering is strongly climate influenced these zones trend mainly latitudinally i e north south counter to the main topographically influenced zones of eastern australia that trend east west streamflow behaviour is generally most strongly associated with climate attributes jaffrés et al 2021 as also previously determined for other regions e g usa jehn et al 2020 however further investigations are required to define the relative roles of the climatic and geomorphological drivers particularly in subcatchments where they significantly interact both factors ultimately control the frequency and intensity of flood response across the australian continent a degree of uncertainty in clarifying the relative influence of these factors comes from limitations in data availability for example the desert interior of australia fig 13 is largely devoid of rainfall gauges because daily precipitation is distinctly heterogeneous in nature spatial interpolation in the absence of a dense network of direct rainfall observations is associated with significant uncertainty and inaccuracy hence precipitation related values attributed to individual subcatchments in central australia must be viewed with caution especially average annual rain days fig 14 fig 14 reveals a broad longitudinal band of relatively large numbers of rain days 30 60 days allocated to each subcatchment this pattern is possibly an artificial feature arising from the data scarcity in that region with the actual average number of rain days smaller and closer to its eastern and western neighbours located outside the vast strip an alternative to weather station data would be the use of pre existing higher resolution 0 05 gridded australian products like silo scientific information for land owners jeffrey et al 2001 or awap australian water availability project jones et al 2009 however these datasets also have their inherent flaws jaffrés et al 2018 the present study has mostly focussed on long term or annual streamflow signatures although the differences in bfi on a seasonal scale was also investigated conversely other studies have analysed streamflow variability at higher resolutions for example laaha and blöschl 2006 have explored low flow variability on a monthly timescale grouping austrian catchments based on the seasonality of these patterns however clustering catchments via streamflow properties requires a well distributed monitoring network with sufficient data quality for instance kuentz et al 2017 had to omit a class of pan european catchments from some of their analyses because of insufficient availability of gauging stations in the absence of an adequate stream gauge dataset catchment classifications centred on flow attributes will have to be regionally restricted in most continents beck et al 2015 unless reanalysis datasets can be utilised e g alfieri et al 2020 nevertheless regionalisation based on catchments groupings founded on climate and intrinsic geological geomorphological pedological etc attributes should enable approximations of streamflow characteristics on a wide range of temporal and spatial scales several global and regional databases of catchment properties exist enabling detailed regionalisation studies however selection of the most suitable dataset s is not always straightforward depending on the study focus data requirements can vary widely and could entail high resolution information on both temporal e g sub daily and spatial scales for the present investigation hydrological information at a daily resolution was required along with national data coverage of intrinsic catchment properties for all australian basins with data quality and statistical methods improving steadily and diversifying over time numerous approaches are available to address specific research goals for instance the lsv or a variation thereof could also be derived from soil and land use descriptions contained within the global harmonized world soil database fao et al 2012 more recently the camels catchment attributes and meteorology for large sample studies project has created several databases for individual countries e g australia chile and usa with the focus on aggregating data of the best available quality mostly sourced directly from these nations fowler et al 2021 the australian version of camels camels aus also incorporated a subset of the high quality bom streamflow time series compiled by jaffrés et al 2021 the camels datasets contain a wide range of variables including hydro meteorological and intrinsic catchment attributes that are specifically tailored to each region addor et al 2017 fowler et al 2021 the accessibility of these freely available datasets permits the replication or enhancement of our study for other regions and scales 5 4 implications of low maximum cluster membership and future work most subcatchments have large maximum cluster mcs these subcatchments are thus strongly affiliated to a specific cluster whereas their link to the other seven clusters is weak conversely isolated assemblages of subcatchments have relatively poor fit fig 6 with no clear preference shown for a cluster areas of poor cluster preference draw attention to complexities in the data reflecting the impacts and interactive effects of climate topography surface condition and hydrogeology for example subcatchments in southern queensland fig 9 with low maximum membership fig 6 are coincident with topographical highlands and the transition between clusters 2 7 and 8 it is therefore likely that this area reflects the interaction of external climate drivers with complex topography additionally poor cluster membership may also relate to extrinsic influences on subcatchments such as the interplay of regional climate features e g el niño southern oscillation indian ocean dipole southern annular mode that may impact the continent with random frequency fluctuating intensity and changing geographical extent the regional and global climatic influences on localised weather events are undoubtedly strongly linked to the distribution of many of the variables used in this study as demonstrated by the coincidence of relatively regular weather patterns with large cluster mcs for example the strong memberships in northern cape york peninsula are associated with the regular annual southward migration of monsoonal activity conversely it is probable that anomalies in cluster mcs arise from the influence of unpredictable global climatic forces occasionally associated with extreme weather events this effect in conjunction with heterogeneity in topography and surface condition in subcatchments with a small mc may be significant from the perspective of flood in terms of regionalisation of streamflow behaviour subcatchments with poor cluster memberships could be of particular interest because of their potentially distinct response to the water cycle with a changing historical and future climate the catchment behaviour may also be non stationary as highlighted by sawicz et al 2014 in their assessment of decadal variations in flow patterns in the contiguous usa in addition anthropogenic or climate linked modification of the land surface will also impact on surface runoff and streamflow signatures especially in terms of severe rainfall events an increased abundance in less permeable land surface e g urbanisation will amplify the risk of riverine and flash flooding the low cluster membership of some subcatchments suggests that complex interaction between intrinsic catchment parameters and external climate processes have variable local impacts in the context of australian wide variability in climate rainfall amounts and intensity these anomalies can only be better defined by targeted studies across different climatic and topographical regions investigations of site specific permeability and infiltration loss measurements would enable improved quantitative calibration incorrect estimation of infiltration loss parameters is one of the major causes of error in streamflow estimation and probably accounts for an underestimation of predicted flood heights from rainfall and the subsequent runoff volumes field based studies targeting realistic calibration of specific catchment metrics are vital if more realistic flow estimates are to be achieved in ungauged catchments further research is also justified for the roles of evapotranspiration during the tropical wet season soil properties pre wetting of soils surface wetness field capacity depth of soil profile texture and mineralogy and land use specifically in a seasonal context wet vs dry season and how these factors influence soil permeability these relationships may be used to obtain realistic infiltration parameters during lengthy extreme events rather than the current often invalid continuous infiltration metrics in the context of the seasonally arid and tropical areas of northern australia field studies targeting the characteristics and the physical definition of non perennial streams and their influences on flow pathways are warranted because these features are currently poorly understood the inclusion of more robust and quantifiable geomorphological parameters will permit more reliable coefficients to be used in streamflow assessments of ungauged catchments in turn this will permit improved evaluations of water availability and the likely effects of potential flooding in regional catchment wide settings 6 conclusions this paper presents results from a national catchment classification scheme in which drainage basins were grouped according to their climatic and geomorphological characteristics forty variables from the themes of climate topography surface condition and hydrogeology were used based on the results presented by jaffrés et al 2021 to distinguish catchment types within australia that may influence rainfall and runoff regimes the main outcome is a whole of australia catchment classification scheme the forty descriptors were reduced to nine pcs the fcm cluster analysis then resulted in the delineation of eight clusters of subcatchments with similar physiography hence the sub basins were statistically grouped via a combination of indices reflecting intrinsic and extrinsic subcatchment properties the resulting clusters were used to provide definitions of the catchment types present across australia the clusters are distinguished by different attributes in several key subcatchment descriptors and they were each described in terms of their influence on the flow and flood profile section 5 a cluster mc of over 0 7 was attained by 82 5 of subcatchments the relevance of the study is supported by the strong links between the clusters and known physical characteristics of australia the similarity between the modified köppen climate classification for australia and the distribution of cluster zones is particularly notable and demonstrates that climate is an important control across the continent for example climate related parameters describe cluster 2 tropical monsoons predominantly summer rainfall cluster 8 mediterranean type climate primarily winter rainfall and cluster 6 aridity however there is sufficient variability e g cluster mosaic patterns to suggest that topographical factors can either override or interact with the climate to produce specific cluster sets exemplified by cluster 5 this cluster for which the dominant statistical indices are those related to topography has a disparate distribution with cluster members mainly typified by their extremely large size and long stream lengths subcatchments were clustered according to indices other than geographical proximity yet the patterns of clusters are easily visible when mapped this indicates that the metrics used in the regionalisation properly describe the intrinsic and extrinsic attributes that neighbouring subcatchments share areas where many clusters are intermingled also coincide with areas of poor catchment membership and require further investigation the study did not aim to suggest which clusters or catchments were more likely to flood but the results strongly imply that specific variables acting either singly or together could indicate locations where closer scrutiny for flood implications would be useful areas identified through ambiguous or anomalous cluster results low cluster membership are particularly worthy of further study primarily because of the complex interactions between geomorphology and climate in particular these subcatchments are located where dominant weather systems show varying influence on seasonal and decadal timescales for example in northern australia southward migration of the intertropical convergence zone and the associated strength of monsoonal activity becomes more irregular south of the tropic of capricorn and catchment geomorphology more complex this co occurrence may account for poor cluster membership of subcatchments in that area the effect of the random frequency of the migration of the intertropical convergence zone and consequent strength and geographical insurgence of monsoonal activity southward may be attributable to interactions with proximal climatic drivers such as the indian ocean dipole the southern annular mode and the el niño southern oscillation jaffrés et al 2018 this concept warrants further investigation this study identifies areas of poor cluster membership as targets for more detailed scrutiny because low cluster membership may act as an indication of extreme localised streamflow unpredictability further classification of ungauged subcatchments by using their primary data is a valuable resource to further analyse the flood responses of these little understood areas global climatic influences on localised weather events are undoubtedly critical to the distribution of many of the parameters used in this study and this is demonstrated where a more regular weather pattern coincides with a high degree of cluster membership however it is probable that the anomalies in the cluster membership also arise from interactions between complex geomorphology and the influence of as yet undefined global climatic forces credit authorship contribution statement jasmine b d jaffrés conceptualization methodology software validation formal analysis investigation writing original draft visualisation ben cuff conceptualization chris cuff conceptualization supervision funding acquisition matthew knott conceptualization supervision cecily rasmussen conceptualization supervision funding acquisition writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we gratefully acknowledge the constructive feedback of the two anonymous reviewers who aided in improving the clarity and quality of this manuscript rainfall and streamflow station data were accessed from the bom climate data online and water data online websites respectively evaporation and mslp data were supplied separately by the bom permeability data were obtained from geofabric catchment boundaries were derived from geoscience australia land use data were accessed from the australian department of agriculture water and the environment soil data originated from csiro s digital atlas of australian soils this study was financially supported by suncorp insurance appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 127969 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
3158,a continent wide classification study of australian catchments was undertaken to group drainage basins with comparable flow characteristics based on forty metrics from the themes of climate topography surface condition and hydrogeology a principal component analysis reduced the multi collinear indices to nine principal components pcs a fuzzy c means cluster analysis on the pcs resulted in the delineation of eight subcatchment clusters with similar physiography and 82 5 of subcatchments displaying a membership coefficient greater than 0 7 subcatchments with poor cluster membership levels may be significant in highlighting complexity in the interaction between climatic controls and local geomorphological and land use variability the clusters are distinguished by different attributes in several key subcatchment variables and each group is described in terms of its flow and flood profile these interpretations are supported by separately derived streamflow signatures from gauged catchments cluster and pc distribution mapping revealed distinct spatial and drainage relationships between the subcatchments relevant to the assessment of flood behaviour the spatial pattern of the river basin regionalisation via physical catchment similarity closely resembles the modified köppen climate classification with differences highlighting the importance of non climate characteristics on streamflow behaviour in australia the catchment classification is an australia wide regionalisation scheme incorporating datasets with disparate spatial distribution and ungauged subcatchments this study therefore provides the framework for more detailed streamflow analysis by applying consistent methods across all catchments in australia and has implications for flood risk prediction mitigation and planning keywords catchment classification climate variability fuzzy c means clustering streamflow patterns topography water infiltration capacity 1 introduction catchment classification is a commonly applied measure that can address a wide range of research queries including regionalisation endeavours to assess ungauged catchments regionalisation is principally a process whereby catchments or river gauges are grouped according to homogeneity rao and srinivas 2008 regionalisation methods are employed to investigate catchments that may be data poor owing to paucity of gauging stations or limited time series records identification of homogenous regions allows for analyses in ungauged drainage basins and extended use of existing data some specific regionalisation or catchment delineation methods include weighted cluster analysis by climate or hydrology e g laaha and blöschl 2006 rao and srinivas 2008 the region of influence roi approach burn 1990 self organising maps unsupervised artificial neural networks ley et al 2011 geostatistical methods such as kriging e g top kriging a geostatistical method applied by merz and blöschl 2005 skøien et al 2006 and combined fuzzy clustering and bayesian modelling used by kennard et al 2010 on australia wide hydrological data for stream classification previous studies utilised diverse methods and parameters to classify regions e g olden et al 2012 and references therein catchment attributes are generally selected and adapted based on the intended application of the classification scheme sawicz et al 2014 employed six hydrological signatures to assess changes in catchment streamflow behaviour in the contiguous united states of america usa on decadal timescales stein et al 2009 grouped australia s stream network by applying a non hierarchical clustering method on 48 ecohydrological attributes kennard et al 2010 identified twelve distinct flow regimes in australia by exploring 120 ecologically relevant features on a regional scale brown et al 2014 employed random forests for classification of remotely sensed images in southeast australia whereas erskine et al 2017 focussed on geomorphological characteristics of rivers in northern australia new zealand rivers were grouped based on the river environment classification rec a deductive method incorporating climate topography geology land cover stream order and valley slope snelder and biggs 2002 snelder and booker 2013 determined that the rec was outperformed by statistically derived river categorisation methods in terms of their capability to describe streamflow dynamics snelder and booker 2013 also highlighted that various methods produce credible flow regime classifications with differences in groupings explaining distinctive aspects of river characteristics kuentz et al 2017 applied a classification and regression tree on 35 catchment descriptors and 16 flow signatures to group european drainage basins into ten classes many studies classify river basins by prevailing climate or hydrology rather than catchment characteristics e g topography or geology delineation methods commonly employ rainfall records instead of runoff data because the former are more abundant and are applicable to ungauged sites however merz and blöschl 2005 suggested that spatial proximity is demonstrably more powerful a control on similarity than any catchment characteristic arguing that spatially close drainage basins tend to have greater similarity in flood behaviour than distal catchments with comparable geomorphological properties spatial proximity implies similar extrinsic and intrinsic characteristics impacting flooding nevertheless some drainage basins although spatially proximal do exhibit distinctly different flood behaviour in response to differing geomorphological characteristics e g adjoining catchments on either side of the great dividing range australia regionalisation limited to only spatial proximity will therefore not always outperform a method that uses only catchment characteristics a combination of methods for example the hybrid roi eng et al 2007 can produce superior results in flow estimation catchment regionalisation improves data availability for streamflow studies by extending results into ungauged catchments and combining similar datasets to create larger records regionalisation outcomes are applicable to a range of further studies including flood frequency analysis and rainfall runoff modelling e g croke and norton 2004 eng et al 2007 merz and blöschl 2005 for instance regionalisation was used to more confidently estimate inputs required for rainfall runoff models e g the baseflow index and baseflow recession constant promoted by gibbs et al 2008 rainfall runoff models are a common tool in catchment studies giving a better understanding of catchment and stream behaviour e g annual average catchment yield dry season low flow characteristics or frequency of flow events above certain levels most rainfall runoff studies in australia focus on water yield rather than flood estimates boughton 2005 and few studies examine ungauged drainage basins rainfall runoff models rely on a regionalisation framework to allow for continent wide comparability in their employment guo et al 2021 at continent scale regionalisation is the necessary first step in grouping comparable catchments whereby similarity reflects a range of parameters that in some way interact with surface flow jaffrés et al 2021 demonstrated the strong link between streamflow and a diverse range of basin properties that encompass the fields of climate topography hydrogeology and surface catchment properties hence in the absence of a high density stream gauge network basin properties exclusive of surface hydrology data offer a strong unbiased method of regionalisation that characterises streamflow behaviour for the present study an australia wide regionalisation approach based on the physical similarity of river basins was employed with the aim of gaining an improved understanding of catchment behaviour in response to streamflow to achieve this goal objectives include the 1 creation of a classification scheme for australian catchments and 2 identification of specific metrics that define each catchment grouping these results then provide the framework for which catchment specific surface flow and flood risk assessment can be applied each core dataset is briefly described in section 2 whereas section 3 introduces the applied methods the results are presented in section 4 with each cluster discussed in detail in section 5 recommendations with respect to future studies are given in section 5 4 additional statistical details are provided in the supplementary material 2 core datasets the chosen parameters reflect hydrological behaviour and include measures of various catchment characteristics encompassing the fields of climate section 2 1 topography section 2 2 surface condition section 2 3 and subsurface permeability section 2 4 the derivation procedure for the forty subcatchment variables are detailed in section 2 of the companion paper jaffrés et al 2021 and a summary is presented here a complete list of indices and data sources is provided in table 1 jaffrés et al 2021 also introduced an amalgamated streamflow dataset from 749 gauges that are deemed of good quality and have a minimum data record of 15 years many of australia s catchments are essentially ungauged with streamflow monitoring predominantly focussed on more urbanised regions because of the data sparsity in a vast proportion of catchments and site disparity streamflow data are only applied in supporting capacity here to test the pertinence of sub basin clustering via attributes of climate topography hydrogeology and land surface examined streamflow properties are introduced in section 2 5 with appendix a 5 providing a more comprehensive summary 2 1 climate eighteen climate metrics table 1 related to rainfall actual evaporation and mean sea level pressure mslp patterns were included in this study table 5 in jaffrés et al 2021 mslps are included to represent atmospheric low pressure systems that often deliver intense precipitation with the rain bursts decreasing the potential of water infiltration while amplifying runoff conversely evaporation is incorporated to characterise water loss particularly during the drier seasons all daily weather station data were obtained from the bureau of meteorology bom precipitation descriptors include the annual average mean number of rain days the rainfall percentage during the austral summer season november to april and the first four l moments to derive the four l moment metrics only rain days were considered i e days with a minimum precipitation of 0 2 mm the method of l moments describes the shape of a probability distribution without assuming normality hosking and wallis 2005 and therefore offers more realistic estimates of extreme values in climate and hydrological settings where extreme events are common for l moments l r 3 where r is the moment of interest l moment ratios τ r l r l 2 were also calculated for simplicity l moment ratios τ 3 to τ 4 are hereafter also referred to as l moments the first four l moments are equivalent to mean l 1 standard deviation sd l 2 skewness τ 3 and kurtosis τ 4 a detailed description of the l moment derivation method is provided in appendix a 1 for evaporation and mslp the first three l moments for both the winter may to october and summer season were derived for every subcatchment with multiple climate stations each climate statistic was averaged to assign a single value for each variable to that subcatchment a radial basis function interpolation was applied to allocate values to subcatchments without climate stations 2 2 topography the digital elevation models by geoscience australia 2011 were utilised to derive 2816 subcatchments with gis based software package catchmentsim version 3 0 3 1 describing each subcatchment with eighteen topographical attributes jaffrés et al 2021 these features include area slope stream length horton s drainage density and elevation characteristics table 1 calculated by the software 2 3 surface condition the land surface value lsv presented in jaffrés et al 2021 was incorporated for this catchment classification scheme jaffrés et al 2021 illustrated how the vast diversity of soil descriptions could be aggregated into a simple relative rank value the lsv incorporating key parameters such as permeability texture and absorbance clay content and behaviour depth of soil profile incorporating geological outcrop and anthropogenic land use effects smaller lsvs represent subcatchments with higher water absorbance capacity whereas larger lsvs indicate more surface runoff 2 4 subsurface permeability subsurface permeability was assigned to each subcatchment based on surface lithology characteristics the surface lithology data were accessed from the australian hydrological geospatial fabric ahgf or geofabric https www bom gov au water geofabric index shtml groundwater cartography product v2 1 1 2 5 streamflow the australian streamflow dataset introduced in jaffrés et al 2021 was applied here with the average daily flow volumes downloaded from the bom water data online wdo https www bom gov au waterdata website in july 2018 all 749 wdo stations are listed by the bom as having data of superior quality are minimally impacted by anthropogenic changes and have a record length of at least 15 years time series shorter than 15 years are unlikely to include large rainfall events thus causing an underestimation of extreme flow events the data were used to derive 16 surface hydrology and baseflow variables table 2 flow events were defined based on peaks in flow rates above the 80th percentile for two peaks to be considered separate events the flow had to return to below the 80th percentile or to no flow for highly intermittent or ephemeral streams if multiple peaks were registered within a 6 day window only the main peak was selected the event duration was then the number of days during which the flow rate remained above the 80th percentile the rapidity and frequency of short term fluctuations in flow rates was investigated in terms of flashiness of the stream the richards baker flashiness rbf index baker et al 2004 is based on the differences in daily flow rates i 1 n q i q i 1 i 1 n q i low flow was considered in terms of the lowest mean flow during a 7 day window in addition the dimensionless baseflow index bfi was derived the bfi is the ratio of baseflow volume to total streamflow volume for a specified time period the bfi was extracted by applying the recursive digital filter method lyne and hollick 1979 f k a f k 1 1 a 2 y k y k 1 y k f k 0 where fk is the filtered quick response at the k th sampling instant yk is the original streamflow a is the filter parameter and yk fk is the filtered baseflow a filter value a of 0 98 was applied jaffrés et al 2021 for further details see appendix a 2 3 methods a regionalisation study of australian catchments was undertaken with the aim of determining similarities between drainage basins in terms of the parameters associated with streamflow dynamics and flooding standard regionalisation methods such as roi often focus on individual catchment gauges weighting adjacent gauged stations according to their degree of resemblance e g burn 1990 in remote regions of australia numerous catchments are ungauged and surface hydrology data are thus unavailable therefore a classification method was developed to identify resemblance among drainage basins according to other catchment signatures e g climate and topography specifically data availability for these traits had to encompass all of continental australia and tasmania in jaffrés et al 2021 surface hydrology data were utilised independently to determine whether the selected properties were relevant to streamflow response in ungauged catchments jaffrés et al 2021 delineated the relationships between surface hydrology data including baseflow characteristics and forty catchment metrics covered by the themes of climate topography surface condition and hydrogeology the surface hydrology indices are only used in supporting capacity for the second stage of this study i e to test the relevance of the catchment classification because most subcatchments are ungauged and spatial interpolation across subcatchments is meaningless in a hydrological context a principal component analysis pca based on a correlation matrix was conducted on the forty subcatchment descriptors table 1 to remove collinearity and unwanted biases in the cluster analysis the pca reduced the climate topography surface condition and hydrogeology dataset to nine orthogonal components each principal component pc was rotated by applying the varimax rotation to realign the input variables to specific components see appendix a 3 for details each rotated component was weighted by using their rotated pc eigenvalues to ensure that significant components had a greater impact in the cluster analysis before conducting fuzzy c means fcm clustering bezdek 1981 dunn 1973 several tests were undertaken to determine the most appropriate number of clusters the r package vegan oksanen et al 2013 allows for the measurement of the caliński harabasz criterion caliński and harabasz 1974 the caliński harabasz criterion is an internal measure and is sometimes called the variance ratio criterion this criterion compares the variance between clusters with the variance within clusters to determine cluster number suitability the highest value of the caliński harabasz criterion is considered the optimum number of clusters appendix a 4 outlines additional tests that were applied to establish optimum cluster numbers fcm clustering was then employed on the nine pcs to identify similarities between subcatchments the fcm clustering was performed with the r function fanny metric sqeuclidean a sum of squares of differences between observations part of package cluster maechler et al 2013 whereas hard clustering assigns each object to just one cluster soft or fuzzy clustering may assign the object to several clusters hence hard clustering allocates a membership coefficient mc of 1 to one cluster and 0 to all others conversely fuzzy clustering will assign relative mc values between 0 low fit to 1 strong fit to each cluster reflecting that several clusters may represent the characteristics of the object in this instance subcatchments the results of the fcm cluster analysis were also utilised to quantify cluster membership confidence to allow for the identification of clusters that did not neatly fit any category for each subcatchment the largest mc value was used to allocate subcatchments to a cluster mc values of close to 0 indicate a relatively poor fit and an mc of 1 implies an excellent fit after the application of fcm clustering on the sub basins each of the 749 streamflow timeseries was assigned to the cluster of its corresponding subcatchment the non parametric mann whitney u test wilcoxon rank sum test was then applied to test for disparities in distributions of streamflow properties table 2 between each pair of clusters the significance level for the analysis was set at 95 α 0 05 4 results 4 1 principal component analysis pca forty subcatchment metrics were used for the pca nine pcs were chosen based on a minimum eigenvalue of 1 incorporating 82 6 of the information contained in the subcatchment descriptors their spatial distribution is shown in fig 1 climate related descriptors dominate the first two pcs table 3 pc1 is associated with rainfall and mslp patterns within catchments with a strong latitudinal trend evident fig 1a pc2 is primarily devoted to evaporation with a secondary focus on variability in elevation and surface conditions a clear pattern towards lower pc values with greater distance from the coast is observable fig 1b reflecting the negative correlation between pc2 and evaporation levels pc3 relates to stream length and to a lesser extent subcatchment area elevation and slope characteristics are mainly represented by pc4 and pc5 respectively pc6 contains information about horton s drainage density and to a lesser level infiltration capacity lsv and subsurface permeability extreme rainfall intensity and regularity l moments 3 and 4 are dominant in pc7 whereas channel skewness and total upstream area are included in pc8 variability of subsurface permeability is the principal index in pc9 although pc6 explains a similar proportion of this feature albeit with reverse sign the complete rotated component loadings matrix is provided in table a 2 4 2 cluster analysis catchment classification scheme the test results for the optimal cluster number were not entirely consistent although most indicated a preference for 5 8 or 9 groups this pattern is epitomised by the caliński harabasz criterion according to that criterion the optimum number of clusters is 5 although 8 and 9 clusters are also recommended fig 2 all three options were investigated here we opted to analyse and present the eight clusters version in detail the mapping results based on 5 and 9 clusters are provided in appendix a 4 fig a 1 and fig a 2 all subcatchments in australia were grouped into eight fcm clusters the cluster specific data distributions for the 40 parameters are illustrated in fig 3 climate and lsv and fig 4 topography and hydrogeology fig 5 shows the spatial distribution of each subcatchment based on their strongest membership to a cluster cluster centres conventionally the mean subcatchment descriptor values within a cluster may be used to characterise a cluster but the fcm clustering method employed here does not allow for their direct calculation therefore the index values from the subcatchments with the largest cluster mcs were designated as a proxy for the cluster centre an mc value of 0 99 was applied as a cut off hence characteristics of subcatchments with a minimum membership of 0 99 are used to assign their median value for each descriptor to that cluster group table a 3 in appendix a 4 detailed interpretations of descriptor relationships characterising each cluster are provided in section 5 cluster mcs for each subcatchment are shown in fig 6 small cluster mcs highlight regions that require additional investigation to characterise their cluster profile most 82 5 subcatchments have mcs greater than 0 7 and 96 1 have mcs above 0 5 hence most subcatchments are assigned to their cluster type with a high certainty cluster specific mcs are presented in fig 7 the distribution of subcatchments per group is uneven with the fewest number contained in cluster 5 68 table 4 conversely 548 subcatchments are attributed to cluster 1 the number of stream gauges is greatest in cluster 8 359 whereas only one gauge is situated in a cluster 4 subcatchment except for cluster 8 the vast majority of sub basins in each group are ungauged table 4 in cluster 8 the median mean number of gauges per subcatchment is 1 2 04 sub basins in all other groups tend to have no gauges median of zero although multiple gauges may be associated with individual subcatchments maximum of 15 in a cluster 8 sub basin they are not necessarily operational concurrently in terms of mc subcatchments in cluster 2 have the greatest proportion exceeding 0 99 57 5 table 4 in comparison only 21 4 23 3 exceed that mc threshold in cluster 1 8 clusters 3 4 and 6 contain no gauges in subcatchments with a minimum mc of 0 99 fig 8 conversely approximately a third of the gauged sub basins in clusters 2 5 and 8 reach the 0 99 mc cut off with a maximum of 38 4 in cluster 2 however only 15 4 of the gauges i e four stations in cluster 5 are in subcatchments with an mc of at least 0 99 on a national scale 87 3 of subcatchments are ungauged with a mean number of 0 27 gauges per sub basin table 4 a total of 1016 subcatchments 36 1 have an mc of at least 0 99 with 97 of these gauged i e 27 1 of the 358 gauged sub basins 4 3 mann whitney u test hydrological differences the biased spatial distribution of stream gauges favouring the more populated coastal regions of australia creates disparity in the number of data points per cluster ranging from one station in cluster 4 to 359 sites in cluster 8 table 4 and fig 9 the mann whitney u test confirmed distinct differences between the clusters based on hydrological flow patterns as also illustrated by boxplots fig 10 for instance clusters 1 2 and 8 were deemed to have significantly different data distributions for most streamflow characteristics investigated clusters with fewer stations i e groups 3 to 6 exhibit fewer statistically significant results despite having the most extreme median values for some hydrological features e g bfi for cluster 3 fig 10m 5 discussion 5 1 catchment cluster characterisation the eight subcatchment groups derived with fcm clustering are typified by distinct signatures specific to each cluster each cluster is characterised by the average median descriptor value of subcatchments with the largest mcs 0 99 for that group table a 3 all eight clusters are compared with each other based on their relative values the indices have relatively high or low values in different clusters allowing characterisation of flow response however the nuanced relationship between variables and their relative significance within a cluster also impacts flow response interpretation of the cluster versus descriptor relationships shown in table a 3 in the context of the regional subcatchment distributions fig 5 revealed through the pca provides the basis for cluster descriptions presented here see also appendix a 4 for each cluster two main properties are described 1 the climate patterns within the region that characterise rainfall evaporation and potential for extreme pressure events such as monsoonal activity and cyclones and 2 the impact of topography and infiltration capacity on runoff pathways through individual catchments because of the sparsity and cluster disparity in available hydrological data associated patterns are only briefly discussed for each group 5 1 1 cluster 1 northern subtropical australia monsoonal influence cluster 1 subcatchments have high average daily rainfall 13 8 mm combined with average annual rain days 39 6 days most precipitation 91 8 falls in summer fig 3b further these areas also have relatively high daily rainfall variance fig 3d suggesting unpredictable rainfall patterns thus rainfall is strongly seasonal falling almost exclusively between the summer months of november to april when mslp fig 3m is very low and monsoonal activity is high the general absence of rainfall and cloudy condition during winter promotes increased evaporation during that period fig 3h during the dry season or during drought flow in the non perennial lower order streams ceases this is confirmed by the 50th percentile of surface flow with a catchment average of 0 m3 s for the gauges in this cluster along with comparatively low bfis in most streams fig 10m table a 4 topographical characteristics for cluster 1 are nondescript with all parameters considered average variability of subsurface permeability is relatively high and is the only non climate index deviating notably from the average fig 4t table a 3 when combined with rainfall patterns this characteristic suggests a strong propensity for localised flash flooding in these catchments during the more severe rainfall events this interpretation is supported by the largest cluster averaged rbf value 0 676 obtained for this group with the next highest rbf median 0 639 associated with cluster 5 fig 10g table a 4 large streamflow events in cluster 1 subcatchments are dominated by extreme rainfall and cyclonic storms or monsoonal activity during summer months average topographical characteristics surface condition and deep drainage capacity have little tempering effect on these flood inducing climatic properties consequently mean peak and surface flows tend to be highest in this cluster fig 10c h table a 4 increasing the risk of flash and riverine flooding 5 1 2 cluster 2 far northern coastal australia monsoonal summers cluster 2 subcatchments are characterised by very high average daily rainfall 15 4 mm and high rainfall variance fig 3c d but low skewness and kurtosis fig 3e f table a 3 this suggests that intense rainfall events occur frequently and extreme rainfall events are relatively common rainfall is also distinctly seasonal with most of the rain falling almost exclusively 95 4 between the months of november and april fig 3b accordingly with an annual total of 71 7 rain days many austral summer days will record some rainfall promoting lower evaporation levels fig 3g annual rainfall is highest in cluster 2 subcatchments 1104 8 mm based on the combination of average daily rainfall and rain day number fig 3a c cluster 2 subcatchments are typified by small variance in mslp fig 3o p mslp is negatively skewed in both seasons fig 3q r in summer cluster 2 has the most negative mslp skewness in the country 0 07 table a 3 the reverse pattern is evident in winter with the mslp of all other groups more negatively skewed than for cluster 2 0 02 these features suggest extreme low pressure events such as monsoonal lows troughs or tropical cyclones impacting on these catchments cluster 2 subcatchments are therefore prone to monsoonal and cyclonic activity during the summer period whereas winter storms are rare subcatchments within cluster 2 have low maximum elevations fig 4n and in contrast to the other clusters the smallest mean and median fig 4p q table a 3 further they are typified by below average flow path lengths and relatively high variability in subsurface permeability the upstream area is nearly three times larger than the area limited to individual subcatchment although both indices are near average compared with other clusters hence streamflow behaviour and flooding in upper subcatchments will impact on the downstream subcatchments given the high summer rainfall pre wetting from early wet season monsoonal storms and moderate evaporation may result in mid late wet season flooding after further rain these subcatchments also have the greatest rainfall variability fig 3d indicating a strong inclination for extreme rainfall events and therefore major flooding the minimal gradient of the coastal plains can also increase flood probability by discouraging efficient drainage into the ocean however high flow events generally do not last long in these catchments as encouraged by the relatively short stream lengths and reflected in the comparatively low cluster median for event duration fig 4k fig 10e nevertheless this characteristic can partially be ascribed to the very high 80th percentile 4 11 m3 s for this group fig 10f because flow events were defined based on that percentile high flow periods excluded flow volumes that would still be classed as part of major flow events in other clusters with more prolonged events derived from lowered volume thresholds 5 1 3 cluster 3 central australia dry riverbeds cluster 3 subcatchments display relatively large rainfall skewness and kurtosis fig 3e f this suggests that rainfall events are scarce and usually dominated by moderate storms the low number of annual rain days 31 4 days confirms the generally arid condition of these regions with a slightly greater chance of rainfall during the summer period 67 8 table a 3 evaporation is comparatively high within cluster 3 subcatchments particularly during the summer months fig 3g and highly variable throughout the year fig 3i j moderate rainfall levels and high evaporation leads to predominantly dry catchments all year round annual rainfall totals are among the lowest of the country 274 2 mm the topography of these subcatchments is mostly non distinct near average compared with the other clusters table a 3 however cluster 3 subcatchments typically present with low bifurcation ratio fig 4f denoting a large proportion of high order streams average elevation is very high in these subcatchments fig 4p q subsurface permeability fig 4s and surface absorbance fig 3s capacity are relatively high i e low lsv consequently the potential impacts of severe rainfall events are mitigated by permitting a large proportion of precipitation to infiltrate into the ground encouraging groundwater recharge simultaneously these characteristics also suggest that most streambeds remain dry except during heavy persistent rainfall periods i e predominantly ephemeral streams this view is supported by the low cluster median for bfi throughout the year in cluster 3 fig 10m n o although the number of high quality gauges is small n 4 and all stations are located in subcatchments with relatively low mcs 0 26 to 0 96 fig 8 5 1 4 cluster 4 flat central australia infrequent slow flows cluster 4 subcatchments feature two distinct groups fig 5 the main subcluster is located in the central east of australia whereas a smaller more disjointed assemblage is found inland of northern western australia cluster 4 subcatchments are distinguished by a small number of rain days 24 6 days but relatively high average daily rainfall 12 9 mm and variability fig 3a c d annual rainfall totals are only moderately larger 317 7 mm compared with those of cluster 3 the average skewness and kurtosis of rainfall data fig 3e f table a 3 suggest that intense rainfall events occur infrequently evaporation in these subcatchments is consistently high throughout the year fig 3g h but more variable in winter relative to other clusters fig 3j the climate characteristics associated with cluster 4 denote arid or semi arid conditions because most precipitation 76 3 falls during the summer period fig 3b and annual rainfall totals are low many streams are non perennial with flows usually restricted to brief periods of significant precipitation ephemeral streams cluster 4 subcatchments are relatively small fig 4a and have very low vertical gradients in the upstream regions whereas median elevation 199 7 m is average elevation variability is extremely small fig 4q r hence these subcatchments are very flat high peaks required to increase flow velocity are also absent fig 4n these subcatchments generally have very low absorbance i e high lsv fig 3s hence the landscape is predisposed to expediting runoff even with moderate subsurface permeability permitting a greater percentage of rainfall to reach watercourses subcatchment topography suggests slow and low streamflow the climate of cluster 4 is very dry with few rain days high evaporation and non distinct mslp conditions these attributes suggest that non perennial streams are common in cluster 4 as also indicated by the skewed streamflow data distribution l moment 3 of the sole stream gauge in this cluster station 130324a fig 10j table a 4 because severe rainfall events are rare high flow episodes are only infrequently experienced in the flood prone landscape stream gauge 130324a is situated in one of the eastern most subcatchments within cluster 4 outside the main area of this group further its cluster membership is relatively poor nearly evenly split between cluster 4 42 4 and cluster 3 40 8 accordingly streamflow properties derived from this site are not necessarily typical of this cluster 5 1 5 cluster 5 spatially disjointed large catchments slow moving flows cluster 5 subcatchments are geographically least constrained with members spread throughout most of continental australia fig 5 these subcatchments are typified by their topographical and infiltration characteristics rather than climate the most distinguishing features of these subcatchments are their large size gentle slopes and very low stream density fig 4a c e further stream lengths are extremely long fig 4g i k and simultaneously also greatly variable fig 4l the generally average condition of climatic indices is reflective of the large spatial spread of relevant subcatchments encompassing a variety of climate regimes subcatchments within cluster 5 are large and flat compared with other clusters fig 4a c slopes along the main flow path are gentle fig 4j meaning that flow velocity across these areas is reduced further they are also typified by very low stream density and channel skewness fig 4e m suggesting symmetrical drainage patterns among the small numbers of waterways in these basins the topographically induced propensity for long lasting high flow events is partially offset by very high subsurface permeability observed throughout most of these subcatchments fig 4s further the lsv is moderate albeit highly variable the very high capacity for water infiltration within cluster 5 subcatchments particularly in localised areas with low lsvs will delay and subdue peaks in streamflow and partially explains the low drainage density thus a large proportion of available water is expected to drain to the water table rather than progressing as overland flow this factor in combination with the semi arid to arid climate means that acute floods are not experienced regularly in cluster 5 subcatchments the modest number of stream gauges n 26 situated in cluster 5 subcatchments shows that peak flows are generally low cluster median of 1 7 m3 s table a 4 and combined with relatively few flow peaks 4 15 per year and small flow volumes flood risk is usually limited however the large areal extent low gradient and low stream density of these subcatchments suggest that these areas are susceptible to slow moving large scale flow events when a severe rainfall event does occur the lower reaches of the extensive murray darling river system and some larger subcatchments in north central new south wales were predominantly allocated to cluster 5 because most tributaries to the lower murray darling basin instead belong to cluster 7 section 5 1 7 downstream flow patterns heavily depend on the characteristics of both clusters especially as upstream areas tend to be extremely large 5 1 6 cluster 6 southern inland australia arid cluster 6 has the smallest average number of rain days 23 4 days per year of any cluster with an average of 8 0 mm recorded during those days fig 3a table a 3 consequently these are australia s driest subcatchment with an annual total of approximately 186 0 mm whereas variability of daily precipitation is low rainfall patterns have relatively high skewness and kurtosis fig 3d e f indicating that extreme rainfall events are possible but rare low rainfall coupled with very high summertime evaporation and high mslp throughout the year fig 3g m n indicates an extremely arid climate with ephemeral streams evaporation is greatly variable fig 3i j a reflection of the extremely dry conditions sporadically interspersed by brief rain periods the subcatchments of cluster 6 are particularly small in size and stream length fig 4a g i k their upper reaches are only gently sloping consistent with very low maximum elevation 241 8 m and a small elevation range fig 4d n o these attributes suggest that streamflow is probably slow this interpretation is confirmed by the nine stream gauges situated within these subcatchment with median event lengths 8 days greater than in all other clusters fig 10e cluster 6 subcatchments have a relatively low capacity to absorb water at the land surface high lsv fig 3s indicating more overland flow reporting to streams near average subsurface permeability only moderately encourages underground lateral flow cluster 6 subcatchments are predominantly arid supporting ephemeral streams peak flows within these subcatchments depend not only on rainfall but also on sufficiently low evaporation and antecedent soil moisture reaching critical levels convergence of these conditions is unlikely mitigating widespread inundation or flash floods especially because the upstream area is very small however localised short lived floods may occur in areas of poor field capacity i e high lsv the high lsvs indicate a strong propensity to generate runoff at the land surface rather than absorbing water into the soil profile any water that does reach the subsurface may be transmitted relatively quickly the arid or semi arid climate of cluster 6 subcatchments as indicated by very few rain days high evaporation and high mslp is not strongly conducive to flooding further the high lsv may increase runoff intensity but with little available rain small catchment size and moderately high subsurface permeability acting to delay and subdue streamflow peaks the potential for flooding from rainfall within the subcatchment is low 5 1 7 cluster 7 australian wheat growing belt moderate rainfall cluster 7 has the lowest mean daily rainfall 7 5 mm and variability in comparison with other clusters fig 3c d in addition similar seasonal rainfall totals can be expected during the summer 46 9 and winter periods fig 3b however the two disconnected regions in this cluster exhibit very distinct differences in climate winter rainfall is markedly more prominent in southwestern australia 74 5 n 38 fig 11 b whereas the eastern segment 49 8 summer rain n 77 is more representative of the cluster median consequently winter mlsps in the western zone tend to be lower fig 11 h indicative of the occasional storm passing through in the western region mean daily rainfall and variability are distinctly lower fig 11c d conversely the annual number of rain days is comparable between the two areas fig 11a because the western region experiences fewer rain days during the summer evaporation rates are greater in that period fig 11e combined with low rainfall skewness and kurtosis and average number of rain days 70 4 days most rainfall events in these subcatchments are of very low intensity extreme rainfall events such as intense storms are uncommon within these subcatchments evaporation is below average during winter reflecting the greater prevalence of rainfall during that period compared with other clusters 1 4 mslp is high throughout the year supporting the absence of notable rain events cluster 7 subcatchments are geomorphologically nondescript topographical characteristics of cluster 7 sub basins are close to average table a 3 however the western and eastern subcatchments in this group differ markedly in terms of maximum elevation vertical range lsv and to a lesser extent upstream area fig 11i l in cluster 7 the large absorbance capacity at the surface low lsv coupled with average capacity for water movement to depth suggests that flooding is more likely after interstitial moisture levels have risen to capacity however because rainfall is generally moderate to low high flow events occur rarely stream gauges confirm that peak flow volumes in this cluster tend to be smaller than in most other groups fig 10c table a 4 the large variability in both subsurface permeability and lsv fig 3t fig 4t indicates diverse lithology and different distributions of land use categories and soil types within these subcatchments with lowlands likely having a greater capacity for water infiltration subcatchments in cluster 7 are centred in two distinct areas southwest western australia and a fragmented band from eastern south australia to southeastern queensland these regions are associated with the major wheat growing belts of australia in the eastern australian distribution zone a large proportion of the subcatchments belong to the major murray darling river system these cluster 7 subcatchments are primarily limited to the upper parts of this sizeable basin these headwaters ultimately feeding the murray and darling rivers further downstream thus the cumulative impacts from the smaller subcatchments are felt by large river systems on a regional scale therefore the rainfall and drainage response in cluster 7 subcatchments is of great significance from an agricultural and economic perspective 5 1 8 cluster 8 mountainous southern australia frequent rainfall cluster 8 subcatchments fig 5 have below average mean daily rainfall 7 5 mm but very large number of annual rain days 117 3 days fig 3a c table a 3 rainfall is evenly spread between the summer 49 9 and winter period fig 3b rainfall of low intensity is therefore regularly experienced in these areas throughout the year consequently cluster 8 subcatchments have significantly lower evaporation compared with other clusters fig 3g h both summer and winter evaporation have small variance but high skewness fig 3i l consequently evaporation is usually low but can rise to high levels occasionally the mslp in cluster 8 is typically moderate winter to very high summer but also greatly variable and with strongly negative skew throughout the year fig 3m r consequently strong low pressure systems and cold fronts are rare and short lived fast moving over these catchments subcatchments within cluster 8 are generally very hilly or mountainous they have very steep slopes fig 4c d h j but average stream length across the subcatchment fig 4i k the maximum elevation 1320 9 m is very high compared with all other clusters and changes in elevation are significant fig 4n r stream density is high but their arrangement is not symmetrical across the subcatchment fig 4e m lsv values are relatively low fig 3s supporting large water absorbance however typical subsurface permeability levels are extremely low in these subcatchments fig 4s hence whereas the land surface encourages water uptake the lithology impedes efficient water infiltration and predisposes expedited runoff this factor reflects the large proportion of exposed hard rock surfaces associated with mountainous regions promoting significant runoff because of the advanced geological age of the australian landscape the topmost section of a stream channel is usually denuded of topsoil leaving a comparatively impermeable surface where runoff is rapid across the upper slopes cluster 8 subcatchments typically present with a high bifurcation ratio fig 4f this attribute denotes a large proportion of 1st order streams a reflection of a great number of creeks originating in the elevated regions cluster 8 subcatchments have perennial streams as a result of the combination of consistent daily rainfall and reliably low evaporation the high relief topography suggests that transmission of water through the catchment is likely rapid this is intensified by the land surface properties that indicate drainage of overland flow is fast the fast flowing drainage can result in flash floods although high intensity rainfall events are relatively rare based on the climate characteristics however because of regular rainfall and fast drainage flow events exceeding the 80th percentile are relatively common fig 10d table a 4 cluster 8 subcatchments can be exposed to floods in their lower reaches but conditions are not conducive to frequent extreme peak flows flow volumes are comparatively high throughout the year in these subcatchments fig 10k table a 4 and combined with limited flow variability fig 10i therefore produce the lowest median rbf 0 450 of any cluster fig 10g typical subsurface permeability is very low fig 4s resulting in a long delay between rainfall recharge to the water table and subsequent discharge to streams as baseflow snowfall may play a significant role in flooding tasmania and the australian alps 5 2 comparison of catchment classification schemes fig 12 exemplifies the dominance of climate descriptors in clustering individual subcatchments according to their intrinsic and extrinsic properties except for cluster 5 and to a lesser extent cluster 3 all groups are associated with distinct climatic conditions subcatchments with low pc1 values clusters 1 and 2 are noticeably biased towards summer rainfall and elevated winter evaporation along with high mean daily rainfall and variability the reverse is applicable for clusters 8 7 and 6 because their subcatchments tend to have high pc1 levels pc2 indicates that cluster 8 and cluster 2 subcatchments have a large proportion of rain days especially when compared with subcatchments in cluster 3 4 and 6 fig 12 also demonstrates that cluster 5 is poorly defined by the pc1 pc2 combination confirming that this cluster is predominantly defined by innate catchment properties e g stream length and area rather than climate attributes the zonation trends revealed in the catchment classification fig 5 are comparable with other published schemes such as the köppen climate classification beck et al 2018 köppen 1936 strong agreement is evident between the catchment clusters and the modified köppen climate classifications of the bom fig 13 a and beck et al 2018 fig 13b cluster 2 corresponds well with the bom s equatorial and tropical zones and beck et al 2018 s tropical area and the temperature subregion typified by dry winters cluster 8 closely resembles the temperate köppen regions that have no distinct dry season the desert köppen groups are represented by clusters 3 4 and 6 in addition to 5 to a lesser extent whereas grassland steppe regions partially overlap with clusters 1 7 and 5 the modified köppen climate classification also considers additional climatic descriptors that were not used in this study e g temperature meaning that these distinct climatic regions are real and consistent for a range of climate metrics however despite the similarities distinct differences between our results and the modified köppen climate classifications are also evident highlighting the nuances in applied climate signatures and the importance of intrinsic catchment properties for example cluster 7 overlaps a relatively large range of groups in both köppen classifications with most of its subcatchments distinguished by high cluster mcs cluster 7 regions are distinguished by a combination of relatively low daily rainfall totals high absorbance low lsvs and large variability in subsurface permeability and land surface conditions the relationships between broad scale catchment types and köppen regions are worthy of further research cluster 2 mostly coincides with class 10 predictable summer highly intermittent flow regime in kennard et al 2010 their fig 6 cluster 1 corresponds to classes 10 to 12 kennard et al 2010 with flow regimes summer dominated and very intermittent cluster 8 predominantly relates to classes 7 unpredictable intermittent flows in more northerly subcatchments and 5 unpredictable winter rarely intermittent in kennard et al 2010 because of the scarcity in available stream gauges in central australia regions of the three inland groups 3 4 and 6 and cluster 5 are generally not covered by kennard et al 2010 cluster 7 partially overlaps with available data in kennard et al 2010 with western subcatchments graded as having predictable winter and intermittent to highly intermittent flow regimes classes 7 and 9 cluster 2 closely matches meta groups a and e in stein et al 2009 their fig 8 10 these meta groups are characterised by high summer runoff fig 8 11 in stein et al 2009 meta group b equivalent to cluster 1 also features summer dominated runoff highly variable runoff exemplifies meta group c that represents clusters 3 4 and 6 cluster 7 mostly corresponds to meta group d typified by greater winter runoff and relatively large flow variability cluster 8 is covered by several meta groups f j these regions have high annual runoff and a greater tendency for winter dominated flows cluster 5 is generally not covered by the meta groups of stein et al 2009 5 3 large scale data availability pc1 and the classification study confirm that australia s subcatchment clustering is strongly climate influenced these zones trend mainly latitudinally i e north south counter to the main topographically influenced zones of eastern australia that trend east west streamflow behaviour is generally most strongly associated with climate attributes jaffrés et al 2021 as also previously determined for other regions e g usa jehn et al 2020 however further investigations are required to define the relative roles of the climatic and geomorphological drivers particularly in subcatchments where they significantly interact both factors ultimately control the frequency and intensity of flood response across the australian continent a degree of uncertainty in clarifying the relative influence of these factors comes from limitations in data availability for example the desert interior of australia fig 13 is largely devoid of rainfall gauges because daily precipitation is distinctly heterogeneous in nature spatial interpolation in the absence of a dense network of direct rainfall observations is associated with significant uncertainty and inaccuracy hence precipitation related values attributed to individual subcatchments in central australia must be viewed with caution especially average annual rain days fig 14 fig 14 reveals a broad longitudinal band of relatively large numbers of rain days 30 60 days allocated to each subcatchment this pattern is possibly an artificial feature arising from the data scarcity in that region with the actual average number of rain days smaller and closer to its eastern and western neighbours located outside the vast strip an alternative to weather station data would be the use of pre existing higher resolution 0 05 gridded australian products like silo scientific information for land owners jeffrey et al 2001 or awap australian water availability project jones et al 2009 however these datasets also have their inherent flaws jaffrés et al 2018 the present study has mostly focussed on long term or annual streamflow signatures although the differences in bfi on a seasonal scale was also investigated conversely other studies have analysed streamflow variability at higher resolutions for example laaha and blöschl 2006 have explored low flow variability on a monthly timescale grouping austrian catchments based on the seasonality of these patterns however clustering catchments via streamflow properties requires a well distributed monitoring network with sufficient data quality for instance kuentz et al 2017 had to omit a class of pan european catchments from some of their analyses because of insufficient availability of gauging stations in the absence of an adequate stream gauge dataset catchment classifications centred on flow attributes will have to be regionally restricted in most continents beck et al 2015 unless reanalysis datasets can be utilised e g alfieri et al 2020 nevertheless regionalisation based on catchments groupings founded on climate and intrinsic geological geomorphological pedological etc attributes should enable approximations of streamflow characteristics on a wide range of temporal and spatial scales several global and regional databases of catchment properties exist enabling detailed regionalisation studies however selection of the most suitable dataset s is not always straightforward depending on the study focus data requirements can vary widely and could entail high resolution information on both temporal e g sub daily and spatial scales for the present investigation hydrological information at a daily resolution was required along with national data coverage of intrinsic catchment properties for all australian basins with data quality and statistical methods improving steadily and diversifying over time numerous approaches are available to address specific research goals for instance the lsv or a variation thereof could also be derived from soil and land use descriptions contained within the global harmonized world soil database fao et al 2012 more recently the camels catchment attributes and meteorology for large sample studies project has created several databases for individual countries e g australia chile and usa with the focus on aggregating data of the best available quality mostly sourced directly from these nations fowler et al 2021 the australian version of camels camels aus also incorporated a subset of the high quality bom streamflow time series compiled by jaffrés et al 2021 the camels datasets contain a wide range of variables including hydro meteorological and intrinsic catchment attributes that are specifically tailored to each region addor et al 2017 fowler et al 2021 the accessibility of these freely available datasets permits the replication or enhancement of our study for other regions and scales 5 4 implications of low maximum cluster membership and future work most subcatchments have large maximum cluster mcs these subcatchments are thus strongly affiliated to a specific cluster whereas their link to the other seven clusters is weak conversely isolated assemblages of subcatchments have relatively poor fit fig 6 with no clear preference shown for a cluster areas of poor cluster preference draw attention to complexities in the data reflecting the impacts and interactive effects of climate topography surface condition and hydrogeology for example subcatchments in southern queensland fig 9 with low maximum membership fig 6 are coincident with topographical highlands and the transition between clusters 2 7 and 8 it is therefore likely that this area reflects the interaction of external climate drivers with complex topography additionally poor cluster membership may also relate to extrinsic influences on subcatchments such as the interplay of regional climate features e g el niño southern oscillation indian ocean dipole southern annular mode that may impact the continent with random frequency fluctuating intensity and changing geographical extent the regional and global climatic influences on localised weather events are undoubtedly strongly linked to the distribution of many of the variables used in this study as demonstrated by the coincidence of relatively regular weather patterns with large cluster mcs for example the strong memberships in northern cape york peninsula are associated with the regular annual southward migration of monsoonal activity conversely it is probable that anomalies in cluster mcs arise from the influence of unpredictable global climatic forces occasionally associated with extreme weather events this effect in conjunction with heterogeneity in topography and surface condition in subcatchments with a small mc may be significant from the perspective of flood in terms of regionalisation of streamflow behaviour subcatchments with poor cluster memberships could be of particular interest because of their potentially distinct response to the water cycle with a changing historical and future climate the catchment behaviour may also be non stationary as highlighted by sawicz et al 2014 in their assessment of decadal variations in flow patterns in the contiguous usa in addition anthropogenic or climate linked modification of the land surface will also impact on surface runoff and streamflow signatures especially in terms of severe rainfall events an increased abundance in less permeable land surface e g urbanisation will amplify the risk of riverine and flash flooding the low cluster membership of some subcatchments suggests that complex interaction between intrinsic catchment parameters and external climate processes have variable local impacts in the context of australian wide variability in climate rainfall amounts and intensity these anomalies can only be better defined by targeted studies across different climatic and topographical regions investigations of site specific permeability and infiltration loss measurements would enable improved quantitative calibration incorrect estimation of infiltration loss parameters is one of the major causes of error in streamflow estimation and probably accounts for an underestimation of predicted flood heights from rainfall and the subsequent runoff volumes field based studies targeting realistic calibration of specific catchment metrics are vital if more realistic flow estimates are to be achieved in ungauged catchments further research is also justified for the roles of evapotranspiration during the tropical wet season soil properties pre wetting of soils surface wetness field capacity depth of soil profile texture and mineralogy and land use specifically in a seasonal context wet vs dry season and how these factors influence soil permeability these relationships may be used to obtain realistic infiltration parameters during lengthy extreme events rather than the current often invalid continuous infiltration metrics in the context of the seasonally arid and tropical areas of northern australia field studies targeting the characteristics and the physical definition of non perennial streams and their influences on flow pathways are warranted because these features are currently poorly understood the inclusion of more robust and quantifiable geomorphological parameters will permit more reliable coefficients to be used in streamflow assessments of ungauged catchments in turn this will permit improved evaluations of water availability and the likely effects of potential flooding in regional catchment wide settings 6 conclusions this paper presents results from a national catchment classification scheme in which drainage basins were grouped according to their climatic and geomorphological characteristics forty variables from the themes of climate topography surface condition and hydrogeology were used based on the results presented by jaffrés et al 2021 to distinguish catchment types within australia that may influence rainfall and runoff regimes the main outcome is a whole of australia catchment classification scheme the forty descriptors were reduced to nine pcs the fcm cluster analysis then resulted in the delineation of eight clusters of subcatchments with similar physiography hence the sub basins were statistically grouped via a combination of indices reflecting intrinsic and extrinsic subcatchment properties the resulting clusters were used to provide definitions of the catchment types present across australia the clusters are distinguished by different attributes in several key subcatchment descriptors and they were each described in terms of their influence on the flow and flood profile section 5 a cluster mc of over 0 7 was attained by 82 5 of subcatchments the relevance of the study is supported by the strong links between the clusters and known physical characteristics of australia the similarity between the modified köppen climate classification for australia and the distribution of cluster zones is particularly notable and demonstrates that climate is an important control across the continent for example climate related parameters describe cluster 2 tropical monsoons predominantly summer rainfall cluster 8 mediterranean type climate primarily winter rainfall and cluster 6 aridity however there is sufficient variability e g cluster mosaic patterns to suggest that topographical factors can either override or interact with the climate to produce specific cluster sets exemplified by cluster 5 this cluster for which the dominant statistical indices are those related to topography has a disparate distribution with cluster members mainly typified by their extremely large size and long stream lengths subcatchments were clustered according to indices other than geographical proximity yet the patterns of clusters are easily visible when mapped this indicates that the metrics used in the regionalisation properly describe the intrinsic and extrinsic attributes that neighbouring subcatchments share areas where many clusters are intermingled also coincide with areas of poor catchment membership and require further investigation the study did not aim to suggest which clusters or catchments were more likely to flood but the results strongly imply that specific variables acting either singly or together could indicate locations where closer scrutiny for flood implications would be useful areas identified through ambiguous or anomalous cluster results low cluster membership are particularly worthy of further study primarily because of the complex interactions between geomorphology and climate in particular these subcatchments are located where dominant weather systems show varying influence on seasonal and decadal timescales for example in northern australia southward migration of the intertropical convergence zone and the associated strength of monsoonal activity becomes more irregular south of the tropic of capricorn and catchment geomorphology more complex this co occurrence may account for poor cluster membership of subcatchments in that area the effect of the random frequency of the migration of the intertropical convergence zone and consequent strength and geographical insurgence of monsoonal activity southward may be attributable to interactions with proximal climatic drivers such as the indian ocean dipole the southern annular mode and the el niño southern oscillation jaffrés et al 2018 this concept warrants further investigation this study identifies areas of poor cluster membership as targets for more detailed scrutiny because low cluster membership may act as an indication of extreme localised streamflow unpredictability further classification of ungauged subcatchments by using their primary data is a valuable resource to further analyse the flood responses of these little understood areas global climatic influences on localised weather events are undoubtedly critical to the distribution of many of the parameters used in this study and this is demonstrated where a more regular weather pattern coincides with a high degree of cluster membership however it is probable that the anomalies in the cluster membership also arise from interactions between complex geomorphology and the influence of as yet undefined global climatic forces credit authorship contribution statement jasmine b d jaffrés conceptualization methodology software validation formal analysis investigation writing original draft visualisation ben cuff conceptualization chris cuff conceptualization supervision funding acquisition matthew knott conceptualization supervision cecily rasmussen conceptualization supervision funding acquisition writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we gratefully acknowledge the constructive feedback of the two anonymous reviewers who aided in improving the clarity and quality of this manuscript rainfall and streamflow station data were accessed from the bom climate data online and water data online websites respectively evaporation and mslp data were supplied separately by the bom permeability data were obtained from geofabric catchment boundaries were derived from geoscience australia land use data were accessed from the australian department of agriculture water and the environment soil data originated from csiro s digital atlas of australian soils this study was financially supported by suncorp insurance appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 127969 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
3159,snowmelt modeling is vital issue for proper operational flow forecasting systems but still challenging in upstream mountainous basins due to limited observations and associated uncertainties data assimilation is a valuable tool to improve model state estimates to improve hydrological forecast while assimilation of snow has been increasingly implemented in research particularly using sequential data assimilation methods less attention has been dedicated to compare different types of assimilation techniques this study aims at comparing the well known ensemble kalman filter enkf sequential data assimilation and the less known moving horizon estimation mhe variational assimilation initial conditions of the hydrological model states are improved by assimilating in situ streamflow and remotely sensed snow covered area data into the hydrologiska byråns vattenbalansavdelning hbv conceptual rainfall runoff model the study is applied to improve runoff predictions over two mountainous basins one in the uppermost catchment of the karasu river in eastern turkey and the second in an alpine basin located in the headwaters of the genil river in the northern flank of the sierra nevada mountain in southern spain the forecast models are tested in a hindcasting condition i e closed loop environment which simulates real time forecasting systems the results are analyzed using forecast verification metrics results showed that streamflow and snow state predictions using mhe outperform the commonly used enkf based on the continuous ranked probability score crps keywords data assimilation moving horizon estimation ensemble kalman filtering snowmelt modeling satellite snow products 1 introduction forecasting hydrological variables is a common task in research and technical works senent aparicio et al 2018 jimeno sáez et al 2017 that generate valuable information for decision makers in river basins and local authorities around the world it is especially relevant in mediterranean countries that suffer frequent and intensive droughts which will be exacerbated in the future due to climate change tramblay et al 2020 collados lara et al 2019 2020a the production of accurate and reliable forecasts is a challenging activity which relies on a cascade of processes where various sources of errors arise it is commonly accepted ajami et al 2007 fatichi et al 2016 fan et al 2017 that the uncertainty of a hydrological forecast derives from one or several of the following sources i model representation parametric and structural uncertainty ii forcing variables and iii initial conditions the latter poses the problem of determining the most accurate state of the system at forecast time i e at the time when the forecast is produced in order to estimate an optimum model state for the initial conditions data assimilation techniques merge observed and simulated information these methods rely on the uncertainty of both observations and simulations in order to produce what is sometimes referred to as the true state of the system reichle 2008 most common data assimilation techniques can be classified either as filters or smoother methods mclaughlin 2002 the former uses a recursive approach in which previous model states as well as model uncertainty characteristics are used as initialization for the forward model propagation which produces an initial estimate of the model states at forecast time new observations at forecast time are then assimilated together with the initial estimate to produce an optimum model state this process is repeated recursively each time as a new observation is available due to the characteristic of processing sets of data at a given time the filtering methods are also known as sequential methods the ensemble kalman filter enkf is a common example of sequential data assimilation evensen 2006 smoother methods on the other hand assimilate observations at different times within an assimilation interval or window while the initial state can be propagated to the simulation within the assimilation window the information on model uncertainty needs to be reinitialized with each run the smoother methods are also referred to as variational techniques given that the optimum solution relies on approximation methods most of the existing implementations of data assimilation in hydrology have focused on the assimilation of streamflow data seo et al 2009 abaza et al 2014 wang et al 2018 others less often implementations use streamflow and soil moisture data crow and ryu 2009 lee et al 2011 lopez et al 2016 meng et al 2017 assimilation of snow observations in hydrological forecasting systems is also a recently new field of research thirel et al 2013 stigter et al 2017 piazzi et al 2019 particularly of interest due to a growing availability of remote sensing observations accurate monitoring of snow is a vital component in the study of water resources and climate change as well as daily weather forecasting it is an important component of the hydrologic balance especially in mountainous regions however snow monitoring is particularly difficult in mountainous areas because of the large spatial variability of snow characteristics and often limited availability of ground based data collados lara et al 2020a using satellite imagery is the most practical approach for monitoring areal snow extent to depict large areas in the last century remote sensing of snow has improved with the current developments in technology numerous global and regional studies have been conducted on validation of satellite snow data to identify snow mapping accuracy maurer et al 2003 tekeli et al 2005 hall and riggs 2002 parajka and blöschl 2008 huang et al 2011 raleigh et al 2013 arsenault et al 2014 yang et al 2015 xu et al 2017 piazzi et al 2019 while the implementations of variational methods have been somehow limited sequential methods have been enthusiastically embraced by the hydrology community this is arguably due to the seamless integration of sequential methods to the existing hydrological models comparisons between variational and sequential techniques in hydrology are very limited abaza et al 2014 compared sequential and variational assimilation using streamflow data in the field of meteorological forecasting the relative advantages of the 4d var and the enkf have been documented by kalnay et al 2007 as well as hamill 2006 despite these efforts a thorough comparison of techniques particularly in hydrological forecasting applications is still missing the aim of this paper is therefore to contribute with such comparison by assessing the performance of each assimilation technique in hydrological forecasts in mountainous catchments with a particular focus on assimilating snow observations in this context the assimilation of snow observations and the intrinsic lag time in snowmelt processes adds a particularly interesting layer of complexity the inter comparison of both assimilation techniques is tested in two different characteristic basins the canales basin is located in the headwaters of the genil river in the southern part of spain the karasu basin is located in the headwaters of euphrates basin and the eastern part of turkey both of their hydrological responses are heavily influenced by snow accumulation and snow melting conditions 2 materials and methods the following provides an overview of the hydrological model the data and the assimilation techniques implemented in this study as well as the performance metrics used in order to assess the value of the assimilation over the forecast in each of the case studies 2 1 hbv hydrological model for this study we used the lumped hydrologiska byråns vattenbalansavdelning hbv conceptual rainfall runoff model to simulate conditions at a basin scale a subdivision according to elevation zones and land use was adopted to represent the characteristics of each catchment and later combined to compute the response of the model a detailed description of the hbv model structure is given in lindström et al 1997 our dedicated implementation of the hbv model is documented in schwanenberg and bernhard 2013 and refers to the implementations of bergström 1995 and lindström et al 1997 the implementation of the hbv model also refer to as forward model can be formulated using the following state and output variables dependencies 1 x k x k η k m k x k 1 μ k δ k η k 2 z k z k ε k h k x k ε k where x z δ are the state output and external forcing vectors respectively represents a simulated variable µ is a noise term introduced to either forcing or directly model states η ε are the model and the observation error with covariance q and r respectively m represents the forward model h is the observation operator and k is the time step index this is a convenient way of formulating the hydrological model variables in view of the different data assimilation setups 2 2 satellite snow data the moderate resolution imaging spectroradiometer modis is an imaging spectroradiometer to provide imagery of the earth s surface and clouds in 36 discrete narrow spectral bands from approximately 0 4 to 14 4 μm barnes et al 1998 modis instrument is on board two different satellites terra and aqua which started collecting observations on february 2000 and july 2002 respectively the mapping approach exploits the high reflectance in the visible and the low reflectance in the shortwave infrared part of the spectrum by the normalized difference snow index ndsi hall et al 1995 the ndsi calculation is based on modis bands 4 0 55 μm and 6 1 6 μm in this study modis daily snow product with 500 m spatial resolution was obtained for the years 2008 2011 from nasa modis imagery are merged one mosaic transformed to a new geographical projection utm wgs84 and adjusted for the area of interest by modis reprojection tool 4 0 mrt 4 0 there are ten classifications in modis snow algorithm but these classifications were reduced to three snow cloud and land in this study for simplifying the result presentation optical satellites are hindered by cloud cover and a cloud removal algorithm is needed especially during the period of snow melt for accuracy assessment various researchers have attempted to apply different algorithms to eliminate cloud coverage of modis products parajka and blöschl 2008 gafurov and bárdossy 2009 gao et al 2010 krajčí et al 2014 this study implements the filtering methodology introduced by sorman and yamankurt 2011 to eliminate cloud cover in the karasu catchment cloud coverage in the case of canales catchment where a reduced number of days is affected by this issue pardo iguzquiza et al 2017 was solved by using linear interpolation algorithms collados lara et al 2017 2 3 sequential data assimilation the sequential assimilation technique is structured by adding normally distributed perturbations to the forcing vector 3 δ k i δ k ξ k i with ξ k i n 0 u k where uk is the covariance of the perturbation these perturbations generate the state variables from the forward model defined as 4 x k i m x k 1 i δ k i u k i where the noise vector uk is set to zero the state updating step from the implementation of the enkf is provided by 5 x k i x k i k k d k i where dk is the distance between observed and simulated variables defined as 6 d k i z k ε k i h k x k i and kk is the kalman gain for time step k computed as 7 k k e x k z k e z k z k t r k 1 2 4 variational data assimilation in order to set a variational data assimilation varda we formulate the moving horizon estimation mhe rawlings 2013 based on eqs 1 and 2 for a forecast time tk 0 over an assimilation period k n 1 0 of n 1 time steps by an optimization problem according to alvarado montero et al 2016 8 min μ j min μ k n 1 0 w z z k z k w x x k x k w μ μ k where j indicates an objective function minimized with respect to the control variable u wz wx and wu correspond to weighting factors indicate a norm here the objective function provides a trade off between the observed and simulated variables and the amount of noise introduced into the system as indicated in eq 1 the noise term is either introduced to the forcing variables or to the state variables it is not added directly to the output variables as it would not back propagate the corrections into the model states the optimization of j creates a simulated model z hat that provides the optimum trade off between noise and distance of simulated and observed variables 2 5 calibration and performance the models were calibrated using the nash sutcliffe efficiency nse nash and sutcliffe 1970 combined with the relative volume rv in the joint performance indicator jp formulated as 9 jp nse 0 1 rv jp is then minimized using optimization algorithms these include an heuristic approach based on the particle swarm optimization algorithm pyswarm https pythonhosted org pyswarm as well as classical optimization using an interior point algorithms such as ipopt wächter and biegler 2006 the performance of the forecast was analyzed using the continuous ranked probability score crps formulated as 10 cpr s l 1 n k 1 n inf inf f t y k l γ y k l y k 2 d y where yk l represents the value of the forecast k l with a leadtime l k is the indicator of the forecast n is the number of ensembles f is the cumulative distribution function and г is a function which assumes probability 1 for values higher or equal to the observation and 0 otherwise the crps metric is equivalent to the mean absolute error when using deterministic forecasts it provides information of the accuracy of the forecast the crps metric computed in this study rely on the ensemble verification system developed by the national oceanic and atmospheric administration noaa brown et al 2010 3 study cases 3 1 karasu catchment the karasu catchment fig 1 is located in the headwaters of euphrates basin in eastern turkey it has a drainage area of 10275 km2 with altitudes ranging from 1125 to 3487 m above sea level the mean annual streamflow at the outlet gauge is approximately 84 m3 s for the period 2000 to 2008 the main land cover types are pasture shrub grass and bare land snowmelt contributes up to 60 70 of the annual runoff volume during spring and early summer months the accurate prediction of snowmelt induced runoff at the outlet of the karasu catchment is particularly important for applications such as flood forecasting reservoir management irrigation hydropower generation and water supply since large dam reservoirs exist in the downstream areas of the catchment the region suffers from sparse ground data and the absence of long term meteorological data particularly in the higher mountain ranges the hbv hydrological model of karasu is produced by splitting the elevation zones into 10 classifications with equal area each of these sub basins contributes to the accumulated streamflow compared to the measured flow at the output location kemah the model has one single land use and it uses daily time steps the hbv model for karasu has a total of 21 parameters including the muskingum routing parameters the calibration was done for the period oct 2002 oct 2008 resulting in a performance of 0 84 of nash sutcliffe efficiency the calibrated parameters were validated for the simulation period oct 2008 oct 2012 which resulted in a nse of 0 70 a number of automated weather operating stations ranging in elevation between 981 and 2937 m above sea level are located in and around the basin the model forcing variables of daily average temperature t and daily total precipitation p values were computed from these stations by the detrended kriging distribution method garen and marks 2005 the average values belonging to each elevational 10 zones were used in the model snow data was obtained from the moderate resolution imaging spectroradiometer modis observations cloud free snow covered area sca data were derived by applying the filtering methodology described by sorman and yamankurt 2011 3 2 canales catchment the canales alpine basin is located in the headwaters of the genil river basin in the northern flank of the sierra nevada mountain in souther spain fig 2 the canales basin covers a surface area of around 176 km2 and has a mean elevation above sea level a s l of 2050 m with elevations ranging from 850 to 3443 m a s l the main land cover type is composed by low vegetation shrubs grasses forbs etc the mean annual streamflow that reach the canales reservoir during the period 2000 to 2014 is approximately 2 4 m3 s jimeno sáez et al 2020 the genil river is one of the most important streams in granada province and one of the main tributaries of the guadalquivir river its resources are regulated by the canales reservoir which contributes to supply the granada city water demands the main resources stored in the canales reservoir come from sierra nevada mountains during the melting season sierra nevada covers an area of more than 2000 km2 with a high mountain mediterranean climate with a relatively dry summer and a wet winter during which snow is accumulated therefore the dynamics of snowfall is essential for the availability of water in canales basin nevertheless a limited number of snow field measurements are available collados lara et al 2020a b the hbv model for the canales basin is composed by 5 sub basins classified by elevation zones the model implements daily time steps and considers one single land use as well as a hydrological routing transfer function to represent concentration time following the implementation by schwanenberg and alvarado montero 2016 the output of the basin is located at the canales reservoir the nse performance for the calibration period oct 2000 oct 2010 was 0 69 while in the validation period oct 2010 oct 2014 the nse performance was 0 58 the model forcing variables i e precipitation and temperature were computed by applying geostatistical methods which are commonly used to assess climatic fields to take into account the spatial correlations between the experimental data chiles and delfiner 1999 matheron 1963 the elevation has been considered as secondary information in the applied kriging with external drift ked procedure where the relationship between the target variable precipitation or temperature and the elevation is included as an external drift that influences the kriging parameters a total of 119 precipitation gauges and 72 temperature gauges were used to estimate climatic fields in the alto genil basin a bigger basin that include canales basin in a distributed way with daily steps and 1 km spatial resolution see collados lara et al 2018 the evapotranspiration was computed using the hargreaves method hargreaves and samani 1985 from the estimated precipitation and temperatures mean maximum and minimum the sca information were obtained from modis observations for cloudy days the fractional snow cover provided by the modis product in a pixel covered by clouds was estimated using a linear interpolation algorithm between the closest prior and next cloudless days note that in this case study this provided an accurate enough approximation because in the historical period the number of consecutive cloudy days in a pixel was quite small see collados lara et al 2019 pardo igúzquiza et al 2017 4 results and discussion 4 1 data assimilation setup the assimilation setups with the different ranges for which sequential and variational data assimilation were tested are summarized in table 1 while the sequential type of data assimilation assimilates each new observation at a time the variational assimilation implements an assimilation window in this study the assimilation window was predefined as 6 months the sequential assimilation implements perturbations to the model forcings while the equivalent setup in variational assimilation corresponds to noise introduced to the model forcings and model states the variational assimilation provides a deterministic forecast while the sequential was configured to create an ensemble of 100 members the observation errors defined in sequential assimilation create the levels of confidence of the observation this is equivalent to the weighting factors defined in the variational setups finally an important remark must be made in relation to the assimilation of snow coverage since this is not a model state within the hbv model the simulated snow water equivalent swe was transformed into sca using a simple bilinear depletion function using a maximum coverage area at 40 mm of swe this is a simple way of approximating the value of sca from simulated swe in which sca reaches 100 for values of swe 40 mm or higher the sca for values of swe under 40 mm increase linearly from 0 to 100 with respect to swe 4 2 hindcasting results the forecasts were simulated using a hindcasting mode i e a recurrent simulation of daily forecasts the hindcasting experiments were executed for the corresponding validation periods of each catchment this yields a total of 1632 forecasts for canales and 1622 forecasts for karasu of 10 days each forecast for each assimilation setup the performances obtained from the forecast verification were analyzed using the mean crps indicator the results were obtained first for a wide range of experiments with multiple variations among these the most relevant are the modification introduced to the perturbation of model forcings and the modification of the observation error in the case of sequential data assimilation meanwhile the modifications introduced to the variational assimilation were mostly in the weighting factors of the objective function these modifications are motivated by the sensitivity of each method to these characteristics figs 3 and 4 show the crps performance results both for streamflow and sca forecast for comparisons purposes all streamflow values have been converted to mm day to keep a reasonable scale when comparing performance between basins for reading purposes only the most relevant modifications are shown in this study many others included additional modifications within the ranges defined in table 1 these include perturbations over precipitation of 5 15 and 20 for the case of karasu and 5 and 20 for the case of canales as well as observation errors of streamflow data of 0 1 1 5 and 10 for karasu and 1 5 and 10 for canales meanwhile the observation errors of sca ranged between 1 and 10 for both catchments the weighting factors implemented in the variational approach range between 0 01 and 200 for streamflow data in the case of karasu and between 1 and 200 for canales the results illustrate that both methods sequential and variational data assimilation significantly improve the streamflow predictions compared to the case without data assimilation in both catchments the implementations of variational data assimilation approach provide more consistent enhancement in streamflow for all lead times meanwhile sequential assimilation improves streamflow prediction but there is a higher spread of crps depending on the selection of observation errors compared to the variational approach moreover some of the sequential assimilations in canales produce a deterioration of streamflow forecast for longer lead times compared to the case without assimilation the positive impact of assimilation on sca forecast is more evident for variational approach meanwhile the sequential assimilation provides little to no improvement of sca predictions 4 3 comparison between assimilation techniques the experiments with the best performance from section 4 2 were chosen for a comparison assessment of mean crps the two best models assimilating only streamflow and assimilating streamflow and snow data were selected from the various experiments for each catchment in the case of karasu the best performances in sequential assimilation were obtained by using observation errors at 10 of the absolute sca observation values and 1 of the relative streamflow for variational assimilation assimilating both observations the best results were obtained by using a weighting factor 10 times higher for streamflow than for sca the weighting factors behave in the opposite way from the observation errors a higher weighting factor means a larger penalization of the term in the objective function whereas the larger the observation error the less reliable it becomes therefore the relationship between weighting factors and observation errors is identical for the case of karasu 1 10 streamflow to sca in canales the best results with the sequential techniques were obtained for observation errors at 1 of the absolute sca observation values and 1 of the relative streamflow we acknowledge that a 1 observation error in the sca observation seems overly optimistic although the results from the hindcasting experiment shows that it compensates for model structure errors that otherwise are propagated into the forecast the best performance for variational assimilation was obtained by assimilating both observations streamflow and snow using a weighting factor 100 times higher for streamflow than for sca this shows some disproportion between the weighting factors used in the variational approach and the observation errors implemented in sequential assimilation 1 1 and 1 100 streamflow to sca this could be associated to the effect of the assimilation window in the variational approach which takes into account multiple steps of observations to estimate the optimum model states fig 5 shows the comparison between assimilation techniques and assimilated observations the assimilation of only streamflow yields significant reductions of the mean crps for the streamflow forecast in both assimilating techniques in the case of karasu it reduces the average crps of the entire forecast from 0 21 mm day to 0 10 mm day using sequential assimilation and to 0 08 mm day using variational assimilation meanwhile the sequential assimilation in canales reduces the average crps of the entire forecast from 0 50 mm day to 0 34 mm day whereas the variational approach reduces it to only 0 39 mm day in terms of sca forecast both assimilation techniques produce a deterioration of the forecast compared to the case without assimilation when assimilating only streamflow increasing the average crps value in karasu from 8 32 to 9 16 using the sequential assimilation and to 8 58 using the variational assimilation the variational approach however was able to slightly improve the sca forecast in canales when assimilating only streamflow data reducing the average crps performance from 9 44 to 8 83 meanwhile the assimilation of snow data using the sequential technique provides little added value to streamflow forecast in the case of karasu the improvement with respect to the assimilation of only streamflow data is practically unnoticeable see top left plot in fig 5 similarly the sequential assimilation of snow data produces almost an identical response to the assimilation of only stremflow data in canales see top right plot in fig 5 in spite of this the sequential assimilation of snow data shows an improvement of the crps performance of sca forecast for both catchments compared to the assimilation of only streamflow data the improvement however is rapidly deteriorated when compared to the case without assimilation this is clearer for canales where the crps performance of sca forecast provides an improvement only within the first 4 days of the forecast the reason behind this is associated to a quick correction of snow states in the sequential approach which are not propagated to the rest of the model structure and therefore cannot hold for longer lead times on the other hand the variational approach shows a significant improvement in streamflow forecast when assimilating snow data this is more noticeable for the canales catchment after 1 day of lead time see top right plot in fig 5 where the average crps for the entire streamflow forecast is reduced by 24 compared to the assimilation of only streamflow the variational assimilation of snow data also shows a significant improvement of the forecast in terms of mean crps for the sca in both catchments the average crps of the entire forecast is reduced from to 8 6 to 5 2 for karasu and from 8 8 to 7 7 for canales the variational approach is therefore able to provide model corrections with a more long lasting effect on the forecast these corrections are enhanced by the assimilation of additional observations such as sca given the properties of the assimilation window to estimate optimum model states the previous results are complemented with the relative gains of each assimilation technique with respect to the case without data assimilation as shown in fig 6 the differences of using the variational assimilation become evident particularly for the performance of sca forecast the variational approach is able to improve the crps performance streamflow forecast by 58 and 40 for karasu and canales respectively it is also able to improve the performance of snow forecast by 37 and 19 for karasu and canales respectively meanwhile the equivalent assimilation of sca using sequential assimilation produced an improvement of 53 and 31 on streamflow forecast for karasu and canales respectively but only a 2 improvement of sca forecast in karasu and an average deterioration of 2 in canales the assimilation of snow in karasu provides a limited improvement to streamflow forecast since the assimilation of streamflow already is already able to produce accurate estimation of model states for streamflow forecast nevertheless the assimilation of snow data improves the snow forecast performance conversely the canales catchment suffers from poor model performance and therefore the assimilation of streamflow data is able to update model states that generate a larger improvement both in streamflow and snow forecast the assimilation of snow data in canales produces significant added value to the forecast of both hydrological quantities 5 conclusion and outlook in this study two different data assimilation techniques variational moving horizon estimation and sequential ensemble kalman filter were tested in snow dominated mountainous catchments in turkey and spain the assimilation methods were implemented through the well known conceptual and lumped hydrological model hbv the hindcasting experiments were run using perfect forecast data sets and snow coverage area data derived from modis was incorporated into the assimilation applications together with streamflow data the results showed that variational assimilation outperformed sequential assimilation in both catchments either by assimilating streamflow only or by simultaneously assimilating streamflow and snow data the reason for this could be associated to the implementation of an assimilation window in the variational techniques this allows updating model states taking into account hydrological delays such as snow accumulation in contrast the sequential assimilation can only update states using new observations and therefore it is limited in terms of compensating hydrological processes from the past increased perturbation of forcings in the sequential assimilation was shown to provide a better sampling of the covariance matrix which in return creates a more stable assimilation this is a fine balance between number of ensemble members observation errors and perturbation variance that forecasters are required to assess previous to implementing sequential assimilation additional factors to take into account are the differences between model calibration and validation of each catchment the different effect of snow in hydrological response for each catchment a higher model resolution of snow representation in karasu the differences in catchment size as well as the different cloud removal algorithms which might affect snow observation uncertainty declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement this project was supported by the european cooperation in science and technology cost action es1404 under short term scientific missions special thanks are extended to the state hydraulics works of turkey dsi as well as the turkish state meteorological service mgm the precipitation and temperature data for canales was provided by agencia estatal de meteorología aemet instituto de investigación y formación agraria y pesquera ifapa parque nacional de sierra nevada pns and red de información ambiental de andalucía rediam part of this research has been partially supported by the siglo an project rti2018 101397 b i00 from the spanish ministry of science innovation and universities programa estatal de i d i orientada a los retos de la sociedad 
3159,snowmelt modeling is vital issue for proper operational flow forecasting systems but still challenging in upstream mountainous basins due to limited observations and associated uncertainties data assimilation is a valuable tool to improve model state estimates to improve hydrological forecast while assimilation of snow has been increasingly implemented in research particularly using sequential data assimilation methods less attention has been dedicated to compare different types of assimilation techniques this study aims at comparing the well known ensemble kalman filter enkf sequential data assimilation and the less known moving horizon estimation mhe variational assimilation initial conditions of the hydrological model states are improved by assimilating in situ streamflow and remotely sensed snow covered area data into the hydrologiska byråns vattenbalansavdelning hbv conceptual rainfall runoff model the study is applied to improve runoff predictions over two mountainous basins one in the uppermost catchment of the karasu river in eastern turkey and the second in an alpine basin located in the headwaters of the genil river in the northern flank of the sierra nevada mountain in southern spain the forecast models are tested in a hindcasting condition i e closed loop environment which simulates real time forecasting systems the results are analyzed using forecast verification metrics results showed that streamflow and snow state predictions using mhe outperform the commonly used enkf based on the continuous ranked probability score crps keywords data assimilation moving horizon estimation ensemble kalman filtering snowmelt modeling satellite snow products 1 introduction forecasting hydrological variables is a common task in research and technical works senent aparicio et al 2018 jimeno sáez et al 2017 that generate valuable information for decision makers in river basins and local authorities around the world it is especially relevant in mediterranean countries that suffer frequent and intensive droughts which will be exacerbated in the future due to climate change tramblay et al 2020 collados lara et al 2019 2020a the production of accurate and reliable forecasts is a challenging activity which relies on a cascade of processes where various sources of errors arise it is commonly accepted ajami et al 2007 fatichi et al 2016 fan et al 2017 that the uncertainty of a hydrological forecast derives from one or several of the following sources i model representation parametric and structural uncertainty ii forcing variables and iii initial conditions the latter poses the problem of determining the most accurate state of the system at forecast time i e at the time when the forecast is produced in order to estimate an optimum model state for the initial conditions data assimilation techniques merge observed and simulated information these methods rely on the uncertainty of both observations and simulations in order to produce what is sometimes referred to as the true state of the system reichle 2008 most common data assimilation techniques can be classified either as filters or smoother methods mclaughlin 2002 the former uses a recursive approach in which previous model states as well as model uncertainty characteristics are used as initialization for the forward model propagation which produces an initial estimate of the model states at forecast time new observations at forecast time are then assimilated together with the initial estimate to produce an optimum model state this process is repeated recursively each time as a new observation is available due to the characteristic of processing sets of data at a given time the filtering methods are also known as sequential methods the ensemble kalman filter enkf is a common example of sequential data assimilation evensen 2006 smoother methods on the other hand assimilate observations at different times within an assimilation interval or window while the initial state can be propagated to the simulation within the assimilation window the information on model uncertainty needs to be reinitialized with each run the smoother methods are also referred to as variational techniques given that the optimum solution relies on approximation methods most of the existing implementations of data assimilation in hydrology have focused on the assimilation of streamflow data seo et al 2009 abaza et al 2014 wang et al 2018 others less often implementations use streamflow and soil moisture data crow and ryu 2009 lee et al 2011 lopez et al 2016 meng et al 2017 assimilation of snow observations in hydrological forecasting systems is also a recently new field of research thirel et al 2013 stigter et al 2017 piazzi et al 2019 particularly of interest due to a growing availability of remote sensing observations accurate monitoring of snow is a vital component in the study of water resources and climate change as well as daily weather forecasting it is an important component of the hydrologic balance especially in mountainous regions however snow monitoring is particularly difficult in mountainous areas because of the large spatial variability of snow characteristics and often limited availability of ground based data collados lara et al 2020a using satellite imagery is the most practical approach for monitoring areal snow extent to depict large areas in the last century remote sensing of snow has improved with the current developments in technology numerous global and regional studies have been conducted on validation of satellite snow data to identify snow mapping accuracy maurer et al 2003 tekeli et al 2005 hall and riggs 2002 parajka and blöschl 2008 huang et al 2011 raleigh et al 2013 arsenault et al 2014 yang et al 2015 xu et al 2017 piazzi et al 2019 while the implementations of variational methods have been somehow limited sequential methods have been enthusiastically embraced by the hydrology community this is arguably due to the seamless integration of sequential methods to the existing hydrological models comparisons between variational and sequential techniques in hydrology are very limited abaza et al 2014 compared sequential and variational assimilation using streamflow data in the field of meteorological forecasting the relative advantages of the 4d var and the enkf have been documented by kalnay et al 2007 as well as hamill 2006 despite these efforts a thorough comparison of techniques particularly in hydrological forecasting applications is still missing the aim of this paper is therefore to contribute with such comparison by assessing the performance of each assimilation technique in hydrological forecasts in mountainous catchments with a particular focus on assimilating snow observations in this context the assimilation of snow observations and the intrinsic lag time in snowmelt processes adds a particularly interesting layer of complexity the inter comparison of both assimilation techniques is tested in two different characteristic basins the canales basin is located in the headwaters of the genil river in the southern part of spain the karasu basin is located in the headwaters of euphrates basin and the eastern part of turkey both of their hydrological responses are heavily influenced by snow accumulation and snow melting conditions 2 materials and methods the following provides an overview of the hydrological model the data and the assimilation techniques implemented in this study as well as the performance metrics used in order to assess the value of the assimilation over the forecast in each of the case studies 2 1 hbv hydrological model for this study we used the lumped hydrologiska byråns vattenbalansavdelning hbv conceptual rainfall runoff model to simulate conditions at a basin scale a subdivision according to elevation zones and land use was adopted to represent the characteristics of each catchment and later combined to compute the response of the model a detailed description of the hbv model structure is given in lindström et al 1997 our dedicated implementation of the hbv model is documented in schwanenberg and bernhard 2013 and refers to the implementations of bergström 1995 and lindström et al 1997 the implementation of the hbv model also refer to as forward model can be formulated using the following state and output variables dependencies 1 x k x k η k m k x k 1 μ k δ k η k 2 z k z k ε k h k x k ε k where x z δ are the state output and external forcing vectors respectively represents a simulated variable µ is a noise term introduced to either forcing or directly model states η ε are the model and the observation error with covariance q and r respectively m represents the forward model h is the observation operator and k is the time step index this is a convenient way of formulating the hydrological model variables in view of the different data assimilation setups 2 2 satellite snow data the moderate resolution imaging spectroradiometer modis is an imaging spectroradiometer to provide imagery of the earth s surface and clouds in 36 discrete narrow spectral bands from approximately 0 4 to 14 4 μm barnes et al 1998 modis instrument is on board two different satellites terra and aqua which started collecting observations on february 2000 and july 2002 respectively the mapping approach exploits the high reflectance in the visible and the low reflectance in the shortwave infrared part of the spectrum by the normalized difference snow index ndsi hall et al 1995 the ndsi calculation is based on modis bands 4 0 55 μm and 6 1 6 μm in this study modis daily snow product with 500 m spatial resolution was obtained for the years 2008 2011 from nasa modis imagery are merged one mosaic transformed to a new geographical projection utm wgs84 and adjusted for the area of interest by modis reprojection tool 4 0 mrt 4 0 there are ten classifications in modis snow algorithm but these classifications were reduced to three snow cloud and land in this study for simplifying the result presentation optical satellites are hindered by cloud cover and a cloud removal algorithm is needed especially during the period of snow melt for accuracy assessment various researchers have attempted to apply different algorithms to eliminate cloud coverage of modis products parajka and blöschl 2008 gafurov and bárdossy 2009 gao et al 2010 krajčí et al 2014 this study implements the filtering methodology introduced by sorman and yamankurt 2011 to eliminate cloud cover in the karasu catchment cloud coverage in the case of canales catchment where a reduced number of days is affected by this issue pardo iguzquiza et al 2017 was solved by using linear interpolation algorithms collados lara et al 2017 2 3 sequential data assimilation the sequential assimilation technique is structured by adding normally distributed perturbations to the forcing vector 3 δ k i δ k ξ k i with ξ k i n 0 u k where uk is the covariance of the perturbation these perturbations generate the state variables from the forward model defined as 4 x k i m x k 1 i δ k i u k i where the noise vector uk is set to zero the state updating step from the implementation of the enkf is provided by 5 x k i x k i k k d k i where dk is the distance between observed and simulated variables defined as 6 d k i z k ε k i h k x k i and kk is the kalman gain for time step k computed as 7 k k e x k z k e z k z k t r k 1 2 4 variational data assimilation in order to set a variational data assimilation varda we formulate the moving horizon estimation mhe rawlings 2013 based on eqs 1 and 2 for a forecast time tk 0 over an assimilation period k n 1 0 of n 1 time steps by an optimization problem according to alvarado montero et al 2016 8 min μ j min μ k n 1 0 w z z k z k w x x k x k w μ μ k where j indicates an objective function minimized with respect to the control variable u wz wx and wu correspond to weighting factors indicate a norm here the objective function provides a trade off between the observed and simulated variables and the amount of noise introduced into the system as indicated in eq 1 the noise term is either introduced to the forcing variables or to the state variables it is not added directly to the output variables as it would not back propagate the corrections into the model states the optimization of j creates a simulated model z hat that provides the optimum trade off between noise and distance of simulated and observed variables 2 5 calibration and performance the models were calibrated using the nash sutcliffe efficiency nse nash and sutcliffe 1970 combined with the relative volume rv in the joint performance indicator jp formulated as 9 jp nse 0 1 rv jp is then minimized using optimization algorithms these include an heuristic approach based on the particle swarm optimization algorithm pyswarm https pythonhosted org pyswarm as well as classical optimization using an interior point algorithms such as ipopt wächter and biegler 2006 the performance of the forecast was analyzed using the continuous ranked probability score crps formulated as 10 cpr s l 1 n k 1 n inf inf f t y k l γ y k l y k 2 d y where yk l represents the value of the forecast k l with a leadtime l k is the indicator of the forecast n is the number of ensembles f is the cumulative distribution function and г is a function which assumes probability 1 for values higher or equal to the observation and 0 otherwise the crps metric is equivalent to the mean absolute error when using deterministic forecasts it provides information of the accuracy of the forecast the crps metric computed in this study rely on the ensemble verification system developed by the national oceanic and atmospheric administration noaa brown et al 2010 3 study cases 3 1 karasu catchment the karasu catchment fig 1 is located in the headwaters of euphrates basin in eastern turkey it has a drainage area of 10275 km2 with altitudes ranging from 1125 to 3487 m above sea level the mean annual streamflow at the outlet gauge is approximately 84 m3 s for the period 2000 to 2008 the main land cover types are pasture shrub grass and bare land snowmelt contributes up to 60 70 of the annual runoff volume during spring and early summer months the accurate prediction of snowmelt induced runoff at the outlet of the karasu catchment is particularly important for applications such as flood forecasting reservoir management irrigation hydropower generation and water supply since large dam reservoirs exist in the downstream areas of the catchment the region suffers from sparse ground data and the absence of long term meteorological data particularly in the higher mountain ranges the hbv hydrological model of karasu is produced by splitting the elevation zones into 10 classifications with equal area each of these sub basins contributes to the accumulated streamflow compared to the measured flow at the output location kemah the model has one single land use and it uses daily time steps the hbv model for karasu has a total of 21 parameters including the muskingum routing parameters the calibration was done for the period oct 2002 oct 2008 resulting in a performance of 0 84 of nash sutcliffe efficiency the calibrated parameters were validated for the simulation period oct 2008 oct 2012 which resulted in a nse of 0 70 a number of automated weather operating stations ranging in elevation between 981 and 2937 m above sea level are located in and around the basin the model forcing variables of daily average temperature t and daily total precipitation p values were computed from these stations by the detrended kriging distribution method garen and marks 2005 the average values belonging to each elevational 10 zones were used in the model snow data was obtained from the moderate resolution imaging spectroradiometer modis observations cloud free snow covered area sca data were derived by applying the filtering methodology described by sorman and yamankurt 2011 3 2 canales catchment the canales alpine basin is located in the headwaters of the genil river basin in the northern flank of the sierra nevada mountain in souther spain fig 2 the canales basin covers a surface area of around 176 km2 and has a mean elevation above sea level a s l of 2050 m with elevations ranging from 850 to 3443 m a s l the main land cover type is composed by low vegetation shrubs grasses forbs etc the mean annual streamflow that reach the canales reservoir during the period 2000 to 2014 is approximately 2 4 m3 s jimeno sáez et al 2020 the genil river is one of the most important streams in granada province and one of the main tributaries of the guadalquivir river its resources are regulated by the canales reservoir which contributes to supply the granada city water demands the main resources stored in the canales reservoir come from sierra nevada mountains during the melting season sierra nevada covers an area of more than 2000 km2 with a high mountain mediterranean climate with a relatively dry summer and a wet winter during which snow is accumulated therefore the dynamics of snowfall is essential for the availability of water in canales basin nevertheless a limited number of snow field measurements are available collados lara et al 2020a b the hbv model for the canales basin is composed by 5 sub basins classified by elevation zones the model implements daily time steps and considers one single land use as well as a hydrological routing transfer function to represent concentration time following the implementation by schwanenberg and alvarado montero 2016 the output of the basin is located at the canales reservoir the nse performance for the calibration period oct 2000 oct 2010 was 0 69 while in the validation period oct 2010 oct 2014 the nse performance was 0 58 the model forcing variables i e precipitation and temperature were computed by applying geostatistical methods which are commonly used to assess climatic fields to take into account the spatial correlations between the experimental data chiles and delfiner 1999 matheron 1963 the elevation has been considered as secondary information in the applied kriging with external drift ked procedure where the relationship between the target variable precipitation or temperature and the elevation is included as an external drift that influences the kriging parameters a total of 119 precipitation gauges and 72 temperature gauges were used to estimate climatic fields in the alto genil basin a bigger basin that include canales basin in a distributed way with daily steps and 1 km spatial resolution see collados lara et al 2018 the evapotranspiration was computed using the hargreaves method hargreaves and samani 1985 from the estimated precipitation and temperatures mean maximum and minimum the sca information were obtained from modis observations for cloudy days the fractional snow cover provided by the modis product in a pixel covered by clouds was estimated using a linear interpolation algorithm between the closest prior and next cloudless days note that in this case study this provided an accurate enough approximation because in the historical period the number of consecutive cloudy days in a pixel was quite small see collados lara et al 2019 pardo igúzquiza et al 2017 4 results and discussion 4 1 data assimilation setup the assimilation setups with the different ranges for which sequential and variational data assimilation were tested are summarized in table 1 while the sequential type of data assimilation assimilates each new observation at a time the variational assimilation implements an assimilation window in this study the assimilation window was predefined as 6 months the sequential assimilation implements perturbations to the model forcings while the equivalent setup in variational assimilation corresponds to noise introduced to the model forcings and model states the variational assimilation provides a deterministic forecast while the sequential was configured to create an ensemble of 100 members the observation errors defined in sequential assimilation create the levels of confidence of the observation this is equivalent to the weighting factors defined in the variational setups finally an important remark must be made in relation to the assimilation of snow coverage since this is not a model state within the hbv model the simulated snow water equivalent swe was transformed into sca using a simple bilinear depletion function using a maximum coverage area at 40 mm of swe this is a simple way of approximating the value of sca from simulated swe in which sca reaches 100 for values of swe 40 mm or higher the sca for values of swe under 40 mm increase linearly from 0 to 100 with respect to swe 4 2 hindcasting results the forecasts were simulated using a hindcasting mode i e a recurrent simulation of daily forecasts the hindcasting experiments were executed for the corresponding validation periods of each catchment this yields a total of 1632 forecasts for canales and 1622 forecasts for karasu of 10 days each forecast for each assimilation setup the performances obtained from the forecast verification were analyzed using the mean crps indicator the results were obtained first for a wide range of experiments with multiple variations among these the most relevant are the modification introduced to the perturbation of model forcings and the modification of the observation error in the case of sequential data assimilation meanwhile the modifications introduced to the variational assimilation were mostly in the weighting factors of the objective function these modifications are motivated by the sensitivity of each method to these characteristics figs 3 and 4 show the crps performance results both for streamflow and sca forecast for comparisons purposes all streamflow values have been converted to mm day to keep a reasonable scale when comparing performance between basins for reading purposes only the most relevant modifications are shown in this study many others included additional modifications within the ranges defined in table 1 these include perturbations over precipitation of 5 15 and 20 for the case of karasu and 5 and 20 for the case of canales as well as observation errors of streamflow data of 0 1 1 5 and 10 for karasu and 1 5 and 10 for canales meanwhile the observation errors of sca ranged between 1 and 10 for both catchments the weighting factors implemented in the variational approach range between 0 01 and 200 for streamflow data in the case of karasu and between 1 and 200 for canales the results illustrate that both methods sequential and variational data assimilation significantly improve the streamflow predictions compared to the case without data assimilation in both catchments the implementations of variational data assimilation approach provide more consistent enhancement in streamflow for all lead times meanwhile sequential assimilation improves streamflow prediction but there is a higher spread of crps depending on the selection of observation errors compared to the variational approach moreover some of the sequential assimilations in canales produce a deterioration of streamflow forecast for longer lead times compared to the case without assimilation the positive impact of assimilation on sca forecast is more evident for variational approach meanwhile the sequential assimilation provides little to no improvement of sca predictions 4 3 comparison between assimilation techniques the experiments with the best performance from section 4 2 were chosen for a comparison assessment of mean crps the two best models assimilating only streamflow and assimilating streamflow and snow data were selected from the various experiments for each catchment in the case of karasu the best performances in sequential assimilation were obtained by using observation errors at 10 of the absolute sca observation values and 1 of the relative streamflow for variational assimilation assimilating both observations the best results were obtained by using a weighting factor 10 times higher for streamflow than for sca the weighting factors behave in the opposite way from the observation errors a higher weighting factor means a larger penalization of the term in the objective function whereas the larger the observation error the less reliable it becomes therefore the relationship between weighting factors and observation errors is identical for the case of karasu 1 10 streamflow to sca in canales the best results with the sequential techniques were obtained for observation errors at 1 of the absolute sca observation values and 1 of the relative streamflow we acknowledge that a 1 observation error in the sca observation seems overly optimistic although the results from the hindcasting experiment shows that it compensates for model structure errors that otherwise are propagated into the forecast the best performance for variational assimilation was obtained by assimilating both observations streamflow and snow using a weighting factor 100 times higher for streamflow than for sca this shows some disproportion between the weighting factors used in the variational approach and the observation errors implemented in sequential assimilation 1 1 and 1 100 streamflow to sca this could be associated to the effect of the assimilation window in the variational approach which takes into account multiple steps of observations to estimate the optimum model states fig 5 shows the comparison between assimilation techniques and assimilated observations the assimilation of only streamflow yields significant reductions of the mean crps for the streamflow forecast in both assimilating techniques in the case of karasu it reduces the average crps of the entire forecast from 0 21 mm day to 0 10 mm day using sequential assimilation and to 0 08 mm day using variational assimilation meanwhile the sequential assimilation in canales reduces the average crps of the entire forecast from 0 50 mm day to 0 34 mm day whereas the variational approach reduces it to only 0 39 mm day in terms of sca forecast both assimilation techniques produce a deterioration of the forecast compared to the case without assimilation when assimilating only streamflow increasing the average crps value in karasu from 8 32 to 9 16 using the sequential assimilation and to 8 58 using the variational assimilation the variational approach however was able to slightly improve the sca forecast in canales when assimilating only streamflow data reducing the average crps performance from 9 44 to 8 83 meanwhile the assimilation of snow data using the sequential technique provides little added value to streamflow forecast in the case of karasu the improvement with respect to the assimilation of only streamflow data is practically unnoticeable see top left plot in fig 5 similarly the sequential assimilation of snow data produces almost an identical response to the assimilation of only stremflow data in canales see top right plot in fig 5 in spite of this the sequential assimilation of snow data shows an improvement of the crps performance of sca forecast for both catchments compared to the assimilation of only streamflow data the improvement however is rapidly deteriorated when compared to the case without assimilation this is clearer for canales where the crps performance of sca forecast provides an improvement only within the first 4 days of the forecast the reason behind this is associated to a quick correction of snow states in the sequential approach which are not propagated to the rest of the model structure and therefore cannot hold for longer lead times on the other hand the variational approach shows a significant improvement in streamflow forecast when assimilating snow data this is more noticeable for the canales catchment after 1 day of lead time see top right plot in fig 5 where the average crps for the entire streamflow forecast is reduced by 24 compared to the assimilation of only streamflow the variational assimilation of snow data also shows a significant improvement of the forecast in terms of mean crps for the sca in both catchments the average crps of the entire forecast is reduced from to 8 6 to 5 2 for karasu and from 8 8 to 7 7 for canales the variational approach is therefore able to provide model corrections with a more long lasting effect on the forecast these corrections are enhanced by the assimilation of additional observations such as sca given the properties of the assimilation window to estimate optimum model states the previous results are complemented with the relative gains of each assimilation technique with respect to the case without data assimilation as shown in fig 6 the differences of using the variational assimilation become evident particularly for the performance of sca forecast the variational approach is able to improve the crps performance streamflow forecast by 58 and 40 for karasu and canales respectively it is also able to improve the performance of snow forecast by 37 and 19 for karasu and canales respectively meanwhile the equivalent assimilation of sca using sequential assimilation produced an improvement of 53 and 31 on streamflow forecast for karasu and canales respectively but only a 2 improvement of sca forecast in karasu and an average deterioration of 2 in canales the assimilation of snow in karasu provides a limited improvement to streamflow forecast since the assimilation of streamflow already is already able to produce accurate estimation of model states for streamflow forecast nevertheless the assimilation of snow data improves the snow forecast performance conversely the canales catchment suffers from poor model performance and therefore the assimilation of streamflow data is able to update model states that generate a larger improvement both in streamflow and snow forecast the assimilation of snow data in canales produces significant added value to the forecast of both hydrological quantities 5 conclusion and outlook in this study two different data assimilation techniques variational moving horizon estimation and sequential ensemble kalman filter were tested in snow dominated mountainous catchments in turkey and spain the assimilation methods were implemented through the well known conceptual and lumped hydrological model hbv the hindcasting experiments were run using perfect forecast data sets and snow coverage area data derived from modis was incorporated into the assimilation applications together with streamflow data the results showed that variational assimilation outperformed sequential assimilation in both catchments either by assimilating streamflow only or by simultaneously assimilating streamflow and snow data the reason for this could be associated to the implementation of an assimilation window in the variational techniques this allows updating model states taking into account hydrological delays such as snow accumulation in contrast the sequential assimilation can only update states using new observations and therefore it is limited in terms of compensating hydrological processes from the past increased perturbation of forcings in the sequential assimilation was shown to provide a better sampling of the covariance matrix which in return creates a more stable assimilation this is a fine balance between number of ensemble members observation errors and perturbation variance that forecasters are required to assess previous to implementing sequential assimilation additional factors to take into account are the differences between model calibration and validation of each catchment the different effect of snow in hydrological response for each catchment a higher model resolution of snow representation in karasu the differences in catchment size as well as the different cloud removal algorithms which might affect snow observation uncertainty declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement this project was supported by the european cooperation in science and technology cost action es1404 under short term scientific missions special thanks are extended to the state hydraulics works of turkey dsi as well as the turkish state meteorological service mgm the precipitation and temperature data for canales was provided by agencia estatal de meteorología aemet instituto de investigación y formación agraria y pesquera ifapa parque nacional de sierra nevada pns and red de información ambiental de andalucía rediam part of this research has been partially supported by the siglo an project rti2018 101397 b i00 from the spanish ministry of science innovation and universities programa estatal de i d i orientada a los retos de la sociedad 
