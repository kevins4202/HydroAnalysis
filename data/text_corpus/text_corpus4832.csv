index,text
24160,juvenile salmonids migrate hundreds of kilometers from their natal streams to mature in the ocean throughout this migration they respond to environmental cues such as local water velocities and other stimuli to direct and modulate their movements often through heavily modified riverine and estuarine habitats management strategies in an uncertain future of climate change and altered land use regimes depend heavily on being able to reliably predict their ocean entry timings route use and survival rates through rivers and estuaries we developed a spatially explicit agent based model of fish movement in response to hydrodynamic flows that uses movement dynamics gleaned from multi dimensional tracking datasets of acoustically tagged juveniles moving through an urbanized branched tidal estuary we demonstrate how such models can be calibrated and we apply it to the sacramento san joaquin delta in central california the quality of the out of sample validation of the model to predict juvenile salmon survival and route selection indicates that the model is versatile and flexible enough to be used in novel hydroclimatological conditions keywords agent based model particle tracking model salmonid migration ecological model estuary hydrodynamics ecological management water resources management climate change data availability simulating the migration dynamics of juvenile salmonids through rivers and estuaries using a hydrodynamically driven enhanced particle tracking model github 1 introduction the loss of estuarine habitat for iconic endangered and economically important marine organisms is extensive around the world leaving decision makers with the difficult task of ensuring reliable water supply for human uses while maintaining ecosystem services while much is known about how rearing and migrating anadromous fish use estuarine habitats at present we have limited ability to make quantitative predictions about how these fish are likely to respond to changes to their estuarine environment therefore ecological models that provide sound understanding of the behaviors of aquatic species and contribute to realistic quantification of the population dynamics under altered hydroclimatologies are required for better understanding the resiliency of these species to changing landscapes and for optimal water management in this paper we describe the development of the enhanced particle tracking model eptm a data and theory driven agent based model of anadromous juvenile salmonid migration through rivers and estuaries using the outputs of a system scale hydrodynamic flow model in this model we develop behavior agencies that are consistent across multiple scales of motion tens of meters over a few minutes to hundreds of kilometers over several days and can be inferred from observations to demonstrate an application we calibrate and validate this model for migrating juvenile chinook salmon in the sacramento san joaquin delta hereafter the delta in central california globally salmonid species are widespread along temperate and subarctic coastlines and contributed nearly 15 billion dollars to the global fisheries in 2016 irarrazával and bustos gallardo 2019 many of the salmonid stocks are overexploited and a significant number of salmonid species are either threatened or critically endangered yeakley and hughes 2014 pauly 2018 habitat stewardship is a common and significant component of freshwater and marine management plans for salmonids yeakley and hughes 2014 in the delta facilitating successful salmonid migrations is a water management goal that often conflicts with other demands on the system such as extracting water from the estuary for agricultural or municipal use delta stewardship council 2019 every year four seasonal runs fall late fall winter and spring of juvenile chinook salmon johnson et al 2017 and steelhead migrate to the pacific ocean through the delta macfarlane and norton 2002 chapman et al 2013 moving through diverse habitats encountering predators interacting with highly dynamic flows and passing a multitude of human made structures survival of juvenile salmonids migrating through the delta can be extremely low e g perry et al 2010 perry et al 2014 michel et al 2015 perry et al 2018 buchanan and skalski 2020 as a result tools for predicting how water management actions will affect migrating salmonids are urgently needed delta stewardship council 2022 historically juvenile salmonid migration rates and survival through rivers and estuaries have been estimated using statistical models e g newman 2003 perry et al 2018 hance et al 2020 or phenomenological models that represent net migration rates overall dispersal and mortality through physically inspired fate and transport models e g zabel and anderson 1997 zabel et al 2008 sridharan and hein 2019 statistical models only reliably describe patterns over the observed range of conditions do not have emergent behaviors and therefore have limited use in novel hydroclimatological and management conditions at the other end of the spectrum are models that describe complex systems with dynamics that emerge due to the interactions of animal behavior in response to environmental stimuli these include cognitive models of fish movement e g hein et al 2018 jhawar et al 2020 nadler et al 2021 and fine scale computational fluid dynamics and coupled biological random walk models goodwin et al 2006 gross et al 2021 or simulated fish whose behavior is governed by machine learning arenas et al 2015 or artificial intelligence olivetti et al 2021 however these models are too computationally intensive and are either too abstract hein et al 2018 jhawar et al 2020 nadler et al 2021 or too domain specific olivetti et al 2021 gross et al 2021 to be useful as decision support tools agent based models with realistic behaviors driven by system scale flow models such as the eptm can help bridge the gap between simple models and highly refined models and have the potential to predict migration dynamics under novel conditions agent based models have been developed for fish movement and migration in the past e g massoudieh et al 2011 bracis and anderson 2012 kimmerer and rose 2018 gross et al 2020 morrice et al 2020 lai 2022 but have typically involved simple or ad hoc animal behaviors the behavioral complexity represented in the eptm is based on tagged salmonid migration data and theoretical expectations from the literature these behaviors allow us to capture the shifts in behavior of salmonids as they migrate through complex estuaries and to physically represent real world systems these features are likely limited in simpler models or are abstracted from intuitive understanding in artificial intelligence based models and in the case of ad hoc agent based models cannot be explained directly using the available data we organize the paper as follows in section 2 we provide a brief background of the migration dynamics of juvenile anadromous salmonids in section 3 we use the insights gained from section 2 to describe the structure of the eptm in sections 4 and 5 we calibrate and validate the model for a specific system and evaluating the sensitivity of the migration statistics to the model parameters in section 6 we present ways in which the model can be used as a numerical laboratory as well as a decision support tool for water management 2 juvenile salmonid migration and survival dynamics in order to build our migration model we i reviewed the literature on anadromous juvenile salmonid migration to identify common patterns in animal movement ii engaged with local and regional stakeholders in central california to incorporate anecdotal evidence about the natural history of salmonids and iii performed our own analyses of datasets obtained in the delta from acoustic telemetry arrays which provided system wide coverage in the form of detection histories of fish at various points along the river system perry et al 2010 san joaquin river group authority 2013 perry et al 2018 notch et al 2020 and high resolution planar two dimensional fish tracks aecom et al 2015 california department of water resources dwr 2015 r w dwr 2016 from two locations to quantify the key aspects of migration behavior directly from data raimondi et al 2021 using these datasets we identified five key behavioral elements of salmonid migration i active swimming ii orientation towards or away from the ocean iii holding relative to the flow iv routing at channel junctions and v mortality due to predation we subsequently discuss these elements as they apply to model design 2 1 active swimming behavior while larval life stages of some fish species passively drift with the flow nagel et al 2021 migrating juvenile salmonids actively propel themselves relative to the flow to describe fish movement in this paper we define swimming velocity directed or speed undirected as the movement rate of the fish relative to the water over a short timescale a few minutes the overground movement velocity as the directed combined movement rate of the fish and the water over a short timescale and the migration rate as the displacement per unit time of the fish through the river system over a long timescale several days several studies have shown some common patterns in salmonid migration i movement away from their natal streams e g sturrock et al 2015 ii swimming velocities within individual fish that vary over time e g lehman et al 2017 and iii in regions of estuaries where the tidal flow reverses migration rates that are faster when flow oceanward is faster and slower when flow oceanward is slower mccormick et al 1998 these results indicate that salmonid swimming speeds vary both spatially and temporally throughout the system and among individuals 2 2 orientation toward or away from the ocean orientation relative to the flow in tidal estuaries has received much attention in the acoustic tagging literature numerous studies have found that until they encounter a salinity threshold close to the point of ocean entry fish swim actively with the direction of flow during the ebb or oceanward flow phase of the tide and do not effectively move during the flood or landward flow phase of the tide mccleave 1978 solomon 1978 healey 1980 mccormick et al 1998 moore et al 1998 hedger et al 2008 in the lower estuary close to the ocean downstream of this salinity threshold fish mostly swim towards the ocean lacroix and mccurdy 1996 mccormick et al 1998 moore et al 1998 hedger et al 2008 in tidally reversing regions kelly and klimley 2012 reported that non salmonid anadromous fish orient somewhat randomly during slackwater or periods of low flows between tidal reversals acoustic telemetry studies in tidal parts of the delta have also reported positive rheotaxis or orientations against the flow in regions with strongly unidirectional oceanward flow as well as fish tracks exhibiting back and forth lateral movements across the river during low freshwater flows dwr 2015 r w dwr 2016 these results indicate a potential shift in the behavior of salmonids in response to the transition from unidirectional river flows to bidirectional flows in the estuary 2 3 holding relative to the flow in this paper we define holding as a behavior that results in no net displacement over some short period over a few minutes authors have reported two types of holding behaviors i holding related to flow and ii holding related to the day night cycle in general holding is likely governed by proximity to the ocean in regions where the tidal flow reverses fish have been observed to hold against the flow or move slowly oceanward during the landward phase of the flow lacroix and mccurdy 1996 miller and sadro 2003 lacroix et al 2005 some studies have reported a statistically significant preference among juvenile salmonids to migrate oceanward at night in regions of the river system where the flow is non reversing and a more photo period agnostic migration pattern throughout the whole day as fish move closer to the ocean moser et al 1991 lacroix and mccurdy 1996 hedger et al 2008 chapman et al 2013 some of these behaviors were also corroborated by observations by domain experts national marine fisheries service 2021 in particular selective holding of fish during the landward phase of the tide forward and tankersley 2001 verhelst et al 2018 preferential nighttime migration in the non reversing tidal regions of the delta and more uniform migration patterns throughout the day in the tidal parts of the system were observed by domain experts 2 4 routing at river junctions in general migratory fish do not move through channel junctions in river networks or branched tidal estuaries as neutrally buoyant suspended material steel et al 2013 ramόn et al 2018 recently two models have represented route selection processes significantly better than models which allow fish to randomly select a migration route the critical streakline perry et al 2014 r w 2016 see their box 3 for a summary hance et al 2020 and the bifurcating streamline sridharan et al 2018a models both allow fish to enter a channel depending on its position relative to the streamline that bifurcates the flow into downstream channels at a river junction 2 5 mortality due to predation past analyses suggest that mortality due to predation is important in estuaries such as the delta resulting in relatively low survival perry et al 2018 pope et al 2021 that is spatially variable perry et al 2018 hance et al 2020 michel et al 2020 c j michel et al 2021 notch et al 2020 anderson et al 2005 proposed a mean field theory of predation driven mortality the xt model in which survival is a function of local predator density the distance traveled by migrants through the predator field x the exposure time of migrants to predators t and the random velocities of predators and prey this model has been shown to be consistent with survival patterns of chinook salmon migrating through the snake and columbia rivers anderson et al 2005 and in the sacramento river steel et al 2020 3 model structure the eptm written in modular object oriented style in java is a three dimensional coupled physical biological lagrangian particle tracking model that simulates the movements and mortality of juvenile salmonids through a river or estuary sridharan et al 2021 the advantage of agent based models such as the eptm is the relative ease of specifying and modifying different behaviors one might wish simulated fish to follow in the eptm the behaviors of simulated fish combine additively with the local water velocity see also olivetti et al 2021 a feature that makes it easy to modify assumptions about physical forcing the processes that determine locomotion or both formally this decomposition allows us to write the overground movement velocity of a given individual within a simulation timestep as 1 u u s u h where u 0 is oceanward movement and u 0 is landward movement u s is an individual s swimming velocity and u h is the hydrodynamic velocity of the water in the individual s vicinity there are four major assumptions in the eptm i very small scale auto correlated sensory responses at sub second timescales are assumed to be represented by stochastic noise codling et al 2008 ii there is only a one way coupling between the flow and fish movement i e fluid structure interactions through which fish may alter the flow field are not modeled iii all simulated individuals follow the same stochastic behavioral rules and iv interactions among individuals are weak enough that a reasonable approximation of migration behavior can be achieved by simulating many non interacting individuals but see berdahl et al 2016 for timescales on the order of 15 min the typical timestep size at which movement is represented in the eptm the modifications of the flow field by the fish will average out so that fluid structure interactions e g filella et al 2018 can be safely ignored sridharan and hein 2019 showed that the application of a one dimensional advection dispersion model that is based on these assumptions is able to recover the distribution of travel times of migrating steelhead in the delta the structure of the eptm is designed around five behavior modules to simulate the key processes related to juvenile salmonid migration discussed in section 2 fig 1 at each simulation timestep simulated fish move through the water body where they are located experience a probability of mortality due to predation and if they are in the vicinity of a river junction move into one downstream water body or the other by iterating this process over many timesteps the eptm produces predictions about how populations of migrants move and when and where mortality occurs 3 1 model domain in order to explore the structure of a model as complex as the eptm we ground truthed it in the sacramento san joaquin delta fig 2 the delta is an estuary that has been highly modified by diking channelization water extraction invasive species and land reclamation and is vulnerable to climate change land subsidence sea level rise and salinity intrusion mortality of migrants is very high in the delta likely due to increased predation in highly channelized habitats with invasive aquatic plants moyle et al 2010 michel et al 2020 alterations of natural flows by water operations kimmerer 2008 and favorable thermal tolerance regimes of native and invasive predators c j michel et al 2021 however recent studies have shown that there is a positive relationship between freshwater inflow and survival of migrating salmonids in the delta perry et al 2018 buchanan and skalski 2020 hance et al 2020 michel et al 2015 c j 2021 indicating that the high mortality might likely be alleviated by favorable flow conditions the delta is an inverted alluvial fan estuary at the confluence of the sacramento and san joaquin rivers with its oceanward end at san francisco bay both the sacramento and san joaquin rivers are rain and snow fed and heavily regulated by dams with flows typically ranging from 200 to 2000 m3 s in the sacramento river and about 10 to 20 of that in the san joaquin river california state and federal pumping facilities in the south delta withdraw 10 to 50 of the inflow of freshwater from the system fig 2 by operating sluice gates in the north delta at the delta cross channel which feed pumps that supply a network of canals moving water south fig 2 sridharan et al 2018b discuss the hydrodynamics of this system in detail 3 2 hydrodynamics and physical forcing on simulated fish we based the eptm on the california department of water resources dwr delta simulation model ii dsm2 particle tracking module dwr 1998 dsm2 is a one dimensional subgrid shallow water equation solver that provides the mean along stream water velocities at grid points spaced roughly 1 5km apart and is used to drive the behaviors in the eptm in the eptm we disaggregate these mean velocities for both straight and curved channels the lateral and vertical water velocity structures are parametrized as described in appendix a dwr 1998 the eptm uses numerical methods that ensure consistency with the underlying model assumptions sridharan et al 2018a and most importantly it incorporates data and theory driven models of juvenile salmonid behavior during migration although the positional variable of primary interest is the along stream location of each individual x t we also track the location of each individual at each time in the lateral y t and vertical z t dimensions y t is specified as positive from the channel centerline to the right bank looking downstream and z t is specified as positive from the channel bottom to the free surface over a small time δ t positions are updated according to the following equations visser 1997 2 x t 1 x t u h u s δ t y t 1 y t r y 2 ε h δ t d ε h d y δ t z t 1 z t r z 2 ε v δ t d ε v d z δ t here u h u s and the vertical gradient of the vertical eddy diffusivity d ε v d z are all evaluated at the point x t y t z t t while the spatially variable vertical eddy diffusivity is evaluated at the point x t y t z t 1 2 d ε v d z δ t t ε h the spatially variable horizontal eddy diffusivity is evaluated at the point x t y t 1 2 d ε h d y δ t z t t r y and r z are uniformly distributed random numbers between 1 and 1 in the eptm we have included channel curvature water velocity and turbulent mixing profiles with at least as much realism as a one dimensional hydrodynamic model with a zeroth order turbulence closure will allow section a 1 in appendix a in order to represent particle trajectories realistically and balance the requirements of fidelity and performance we tuned several model settings see appendix a the profiles of u h ε h and ε v are obtained under the parametrizations in appendix a the rationale behind the formulation in the system of equations 2 is that simulated fish are pushed laterally and vertically due to random turbulent fluctuations in reality fish also move actively laterally and vertically within the water column in ways that likely depend on the morphologies of specific areas within the domain olivetti et al 2021 gross et al 2021 the net effect of the system of equations 2 is that behavior is adopted in the streamwise direction and passive particle like movements are applied in the lateral and vertical directions this compromise retains the generality of the model 3 3 simulation timescales the eptm model simulates processes with two distinct timesteps the primary timestep τ is 15 min and the sub timestep δ t is 20 s at every timestep the behavioral decisions of each individual are updated and mortality is evaluated while at every sub timestep the positions of each individual are updated see section a 2 in appendix a this finer time resolution helps resolve uncorrelated movements relative to flows and total path length during a 15 minute interval we chose the 15 minute timestep to ensure scalability in multi decadal water management scenario evaluations in which millions of fish have to be simulated over long durations given the 15 minute timestep simulated fish behaviors in the eptm should be interpreted as temporally coarsened representations of cognitive responses to instantaneous local stimuli exhibited by migrants which vary on spatial scales of a few meters and temporal scales of a few seconds olivetti et al 2021 however variability among individual migrants is maintained in the model the outcome of behavioral decisions at each timestep is stochastic and they are produced by a set of behavioral functions that result in actions based on the location of the animal within the system and the environmental conditions at that location we selected the forms of these functions on the basis of a review of the literature on migrating salmonids as well as empirical evidence from our analyses of salmonid migration behavior in the delta section 2 these functions also represent a tradeoff with the simplifying assumptions that is necessary to ensure that parameters are statistically identifiable and that computation times are tractable 3 4 active swimming behavior active swimming in the eptm involves only along stream movements induced by fish behavior locomotion in eptm involves a sequence of behavioral choices each individual makes at each timestep we represent these behaviors as a hierarchy of stochastic decisions to i first either hold position relative to the flow or swim and ii subsequently if they decide to swim then to select the swimming direction and the swimming speed the swimming speeds of migratory salmonids vary over time across environmental conditions and in different regions of an estuary olivetti et al 2021 to allow swimming speed to vary from one timestep to another and among individuals we draw a random swimming speed for each individual that is not holding at each point in time the swimming speed u s for each individual at each timestep is drawn from a log normal distribution of the form 3 lnn μ σ 1 u s σ 2 π e ln u s μ 2 2 σ 2 where the parameters are given by 4 μ 2 ln u s 1 2 ln σ u s 2 u s 2 σ ln σ u s 2 u s 2 2 ln u s in which the mean swimming speed and standard deviation in observed swimming speeds are respectively u s and σ u s 2 table 1 as salmonid swimming behavior could change over the course of migration with proximity to the ocean we allow the parameters of the log normal distribution to vary among different regions of the estuary as the simulated fish move through the system to ensure that randomly drawn swimming speeds remain within the range of biologically plausible speeds the log normal distribution is truncated at the 95th percentile and rescaled appropriately 3 5 orientation towards or away from the ocean the direction of along stream swimming relative to flow varies across the system and over environmental conditions olivetti et al 2021 to allow this in the eptm we incorporate a probabilistic swimming direction rule that determines each individual s swimming direction at each timestep the swimming direction is influenced by the individual s previous swimming direction as well as the flow it experiences the structure of this rule is based on empirical patterns in the high resolution fish tracks aecom et al 2015 dwr 2015 r w 2016 while migrants regularly turn to direct locomotion landward oceanward or toward channel banks they also exhibit a tendency to persist in a given swimming direction for long periods of time olivetti et al 2021 to capture this tendency to persist an individual is allowed to continue moving along its previous swimming direction either oceanward or landward at each simulation timestep with probability p m table 1 the decision to persist is then determined by a bernoulli trial with probability p m if the bernoulli draw to determine persistence results in a zero the individual s swimming direction is determined by a stochastic decision based on the flow it experiences during the current timestep this is motivated by the observation that fish in different flow regimes exhibit different tendencies to swim with or against prevailing flow olivetti et al 2021 a range of processes have been attributed to flow detection by fish liao 2007 burke et al 2014 klimley et al 2017 oteiza et al 2017 lohmann and lohmann 2019 miles et al 2021 regardless of the sensory mechanisms strong flows are significantly easier to perceive compared to very weak flows a simple way to represent this flow strength based perception is to model the probability of orienting in the direction of prevailing flow as a function of the dimensionless water velocity magnitude 5 u u h u h where u h is the instantaneous water velocity magnitude at the migrant s location and u h is the historical average water velocity in the system the quantity u h serves simply to normalize u to a consistent range of values and any other constant could be used in its place without loss of generality i e we are not assuming that fish have knowledge of the historical average water velocity we assume water velocity magnitude is related to the individual s probability of orienting in the direction of the prevailing flow according to the function 6 p swf t 0 5 p rheotaxis 0 5 1 1 e c b log u where p swf is the probability of orienting in the direction of flow p rheotaxis read as the complement of the probability of rheotaxis is a calibration parameter determined by where the migrant is located in the system c is half saturation point the abscissa of the inflection point and b is the slope of the steepest part of the curve table 1 if an individual is not holding and not persisting in its previous movement direction its direction relative to the flow is determined by a bernoulli draw with probability given by p swf t from eq 6 for positive values of c and small values of b simulated fish exhibit sluggish responses to flow signals i e an individual will make decisions that are not random only at very strong water speeds for negative values of c and large values of b simulated fish exhibit very sharp responses to small changes in the flow i e decisions will be nonrandom even for weak flows the p rheotaxis parameter determines if the individual is likely to orient with or against the flow if p rheotaxis 0 then as flows become stronger individuals will have a tendency to orient against the flow or perform positive rheotaxis if p rheotaxis 0 5 orientation decisions will be random if p rheotaxis 1 then as flows become stronger individuals will have a tendency to orient with the flow or perform negative rheotaxis by allowing these parameters to vary in different regions of the system spatial variation in responses to flows can be captured 3 6 holding relative to the flow in the eptm whether an individual will hold or swim during a given simulation timestep is determined by two factors the time of day and the phase of the tide these dependencies are implemented by the following equations 7 p hold p h u h u f i t d 1 p d s u h u f where p h is a probability that the individual holds u f is a landward flow threshold above which simulated fish are assumed to hold i t d is an indicator function denoting whether it is day 1 or night 0 and p d s is the probability of swimming during the daytime chapman et al 2013 table 1 a migrant s decision to hold is determined by a bernoulli trial with probability p hold at each timestep this allows the model to capture different types of holding behavior observed in the system 3 7 routing at river junctions in the eptm we allow simulated fish to move into downstream water bodies at junctions depending on their lateral position relative to the critical streakline or bifurcating streamline appendix a when a migrant reaches the end of a river channel within a sub timestep the routing process is invoked and it is moved into a downstream river or open water body such as a flooded island or shallow lake subsequently the remaining trajectory computation is completed for that sub timestep in the new channel beginning from a random cross sectional position if an individual enters an open water body it waits for a random length of time smaller than one day and then leaves the open water body randomly into a connecting downstream water body while it would be straightforward to implement stochastic routing decisions that depend on the flow the individual s lateral position and other system and species specific attributes see steel et al 2013 hance et al 2020 but we have not implemented this in the eptm as we wanted to retain generality across species and flow conditions recently nonphysical barriers and fish guidance mechanisms such as bubble curtains and strobe lights have been investigated to steer fish into favorable migration routes in the delta perry et al 2014 dwr 2015 r w dwr 2016 these mechanisms work by directing fish away from a potentially deleterious route without altering the flow and operate with some efficiency η we implement such mechanisms in the model as a synthetic barrier which restricts simulated fish from entering a specific water body during some fraction η of the time any number of barriers can be applied at any junction in the system domain with specified efficiencies over the duration of a simulation such barriers will simply divert a fraction of simulated fish η into the next nearest downstream water body that does not have a barrier while not fully realistic the barrier mechanism nevertheless allows us to capture the leading order function of such barriers see section 5 3 below 3 8 predation and mortality survival in the eptm is modeled using a modified version of the xt model developed in anderson et al 2005 the modification arises because we compute survival over the actual path of an individual in our model rather than over a fixed distance see appendix a this modification follows from tracking simulated fish trajectories in the eptm the basic assumption of the xt model is that on average the risk that prey migrating through a field of resident predators will be eaten by predators within a region can be expressed as constant per unit distance and per unit time rates our model computes survival probability of each individual in each 15 minute timestep as a function of two quantities the total distance traveled by that individual in the timestep x and the duration of the timestep as 8 p survival e x 2 ω 2 t 2 λ in the model t τ here the free parameters λ and ω respectively quantify how survival decays with distance traveled through a region and represent stochasticity in the predator prey encounters table 1 the difference between λ in eq 8 and in the anderson et al 2005 formulation is that in the former case this parameter has to be inflated as a consequence of using the distance over migrant trajectories instead of river reach lengths appendix a the difference in ω in the eptm is that this parameter also captures the stochasticity in flow and fish trajectories appendix a thus the parameter values in eq 8 will generally be much larger than in the conventional formulation of the xt model typically smaller values of λ represent denser predator fields while larger values represent sparse predator distributions small values of ω represent a smaller contribution of the random undirected components of predator and prey movements to the overall encounter rates conceptually small values of ω may be thought of as representative of stationary predators whereas large values as representative of roving predators in the eptm as we allow these parameters to spatially vary the home ranges of different types of predators can be potentially represented in the model in standard applications if a random draw from a uniform distribution is smaller than the probability of survival an individual continues to move through the system otherwise it is killed and the simulation terminates for that individual an alternate mode is also available in the model wherein particles are not removed from the computation but rather continue to be simulated survival estimates can then be provided for each region and compounded over the course of migration using a fixed population of simulated migrants 3 9 eptm behavior kinetics the functional responses of the behavior modules described in sections 3 4 to 3 6 and 3 8 to local environmental conditions observed by simulated fish i e instantaneous water velocities calibrated for salmonids migrating through the delta indicate the biological realism in the model these responses are sketched in fig 3 see appendix b for details on how the responses were sketched the parameter estimation process and optimal parameter values are reported below in sections 4 and 5 to simplify the subsequent discussion we grouped areas in the delta into three macro regions based on the flow characteristics modeled using dsm2 these are the nonreversing flow weakly reversing flow and strongly reversing flow macro regions which each have distinctive instantaneous water velocity histograms fig 3a in all subsequent rows of fig 3 we aggregated behavior responses within all regions constituting each macro region mean migration rate relative to the flow orientation holding and mortality dynamics are illustrated in figs 3b c d and e by assuming that simulated fish experience constant water velocities in each bin of the histograms shown in fig 3a over a period of five days by applying the swimming speed distribution in eq 2 and by using the orientation and holding probabilities from eqs 6 and 7 we obtain the mean relative migration rate as a function of water velocity in fig 3b see appendix b from nonreversing to reversing macro regions the mean relative migration rate generally increases monotonically from slower to slightly faster than the water velocity the probability of orienting with the flow estimated using eq 6 is typically much lower than random in the nonreversing and weakly reversing macro regions except during slack water indicating a tendency for positive rheotaxis in these regions in the strongly reversing macro region this probability is close to random fig 3c see appendix b very rarely do water velocities ever exceed the flood phase holding threshold under historic conditions the combined probability of holding due to strong flood phase landward flows and daylight estimated using eq 7 is typically about 0 75 without an appreciable trend through the domain fig 3d see appendix b mortality due to predation estimated using eq 8 and by assuming that simulated fish i drift passively towards the ocean with the unidirectional freshwater current in the nonreversing macro region and ii experience tidal excursions and a net oceanward stokes drift smythe 2020 in the reversing macro regions is typically low in the nonreversing macro region and significantly increases in the tidally reversing macro regions fig 3e see appendix b this is due to the increased path lengths and travel times in the reversing macro regions survival in the nonreversing macro region dips near slack water because the travel time approaches infinity whereas in the reversing macro regions survival increases near slack water as the distance traveled approaches its minimum value appendix 4b together the mechanisms of these behavior modules interact to produce realistic and well explained migration and survival dynamics the model incorporates behavioral dynamics that have been observed in juvenile salmon across numerous systems however every module might not be observed in every system thus the model can be simplified by turning off a module by setting parameters to specific values this is a strength that allows the model enough flexibility to emulate observed behavior in a given system table b 1 4 model calibration we applied the eptm to study migration through the delta of sacramento river juvenile chinook salmon we calibrated the model by comparing the distribution of travel times and survival obtained from releases of acoustically tagged fish into the system and eptm model simulations with matched simulated fish releases to calibrate the model we searched for optimal parameter values using a customized search process 4 1 calibration data to calibrate the eptm for salmonid migration in the delta we used data from tagging studies of late fall run chinook salmon 2006 2010 released in the sacramento river perry et al 2010 in total 1591 tagged late fall run juveniles were released in eight groups over the 5 year period table 2 these fish were tagged with vemco v5 acoustic tags and were tracked across multiple hydroacoustic receiver arrays fig 2 multistate mark recapture mmr models were fit within a hierarchical bayesian framework to concurrently estimate detection routing and survival probabilities through the different regions perry et al 2010 perry et al 2018 in addition to the regional survival estimates the data also included first detection times for each fish whenever it was detected at a receiver array we fit the model parameters to the observed travel time distributions and mmr estimated survival rates in each region 4 2 generating eptm predictions for model calibration in the eptm the model parameters can take different values in different parts of the domain this allows us to capture spatial changes in behavior along simulated fish trajectories to balance model parsimony with flexibility we imposed the restriction that parameter values should be constant within each region this does not preclude the possibility that some parameters may take on similar values across regions in total the 11 parameters in the eptm table 1 can vary across the nine regions fig 2 giving 99 model parameters that must be fit using the data to produce predictions from the eptm for fish in the calibration dataset we identified the first detection times of each fish detected in both the upstream and downstream ends of a region in the calibration data for each of these fish we released 10 simulated fish in an eptm simulation for which the dsm2 model was used to compute the flows over the migration period the durations of these simulations were set to be ten days longer than the last initial detection time of fish at the downstream end of the region for each tagged individual the fate of each simulated migrant in the region as well as the travel time through the region was recorded simulated fish were introduced into the model domain at the same locations as the telemetry stations demarcating the upstream ends of the mmr regions by performing such simulations over a large set of parameter values a representation of the model goodness of fit to the data was obtained this was used to estimate model parameters 4 3 model parameter constraints much data is available in the literature regarding animal swimming behaviors from which prior expectation can be set for the swimming parameters appendix c u s and σ u s were restricted to a range of 0 to 0 5 m s and u f to a range of 0 to 1 5 m s table 1 appendix c we allowed p m p rheotaxis p d s and p h to vary between 0 and 1 table 1 the values of c and b were bound between 10 and 10 and 0 and 10 respectively table 1 appendix c we set the lower and upper limits for u f to be 0 and 1 5 m s respectively appendix c λ and ω were allowed to vary between 10 and 1 000km and 0 and 2 m s respectively table 1 appendix c the survival parameter bounds were set based on the results in perry et al 2018 and simulations using a toy ptm model which involved a very fast random walk of simulated fish with behaviors identical to the eptm over three coarsely defined delta regions appendix c 4 4 calibration process to calibrate the model parameters with the late fall run chinook salmon data we applied a custom 4 stage process see appendix d for details first we deduced that the movement swimming orientation and holding parameters could be fit independently of the survival parameters see below second we performed a coarse grid search on a large number of movement parameter values to hone in on the best local optima defined within a multiobjective optimization framework appendix d third we performed a fine grid search in the neighborhoods of the best local optima obtained from the coarse grid search to identify the global optimum movement parameter values using the same optimization framework fourth we held the movement parameters at their optimum values and performed a grid search over the survival parameters to find the optimum values of these parameters we decided to use this custom approach due to a host of practical considerations which we discuss further in section 6 below for an 11 dimensional parameter space in each region of the model domain space filling algorithms provide an efficient way of sampling with significantly fewer points than a random selection of points which could fall on lower dimensional manifolds to select the optimal space filling algorithm we compared ten algorithms using the r package diceeval dupuy et al 2015 using the maximum separation method with a minimum separation criterion of 0 244 produced the best performance out of all the approaches across four performance metrics appendix d we compared the minimum separation criterion across 500 5000 and 50 000 sets of parameter value combinations or design points and found that the criterion value was indistinguishable between 5000 and 50 000 design points we then generated 5000 design points by sampling a standardized value of each parameter by subtracting the mean of the parameter range and dividing by its range from within the permissible range of values for that parameter using a maximum separation criterion based space filling algorithm in the r package dicedesign dupuy et al 2015 the calibration dataset contained eight release groups and survival and travel times could be computed reliably from these data for the nine regions this yielded a total of 5 000 8 9 360 000 eptm model calls as mmr analysis had been performed for each region we could fit the 11 model parameters for each region independently of the other regions but within each region to further reduce the complexity of fitting the 11 dimensional parameter set we used the toy ptm model to identify whether any parameter simplification or decoupling was possible to do this we applied the morris method of elementary effects analysis iooss and lemaitre 2015 using the global optimization toolbox developed by pianosi and wagener 2015 to study the relationships between the model parameters and the distribution of travel times and survival rates in the three regions appendix e the morris method is an efficient screening algorithm to study parameter interactions for high dimensional models which allowed us to identify parameter interactions with just 3400 toy ptm model calls appendix e based on this analysis we decoupled the model fitting process for the eptm to first fit the nine movement parameters and then fit the two survival parameters holding the movement parameters at their optimal values 5 results results of the eptm calibrated for chinook salmon migrating through the delta show strong agreement with many of the major patterns evident in the acoustic telemetry data see appendix d for a detailed presentation moreover parameter estimates reflect the behavioral patterns evident in our empirical analyses of data these agreements between model and data suggest that i the eptm is capable of capturing the salient features of salmonid migration through the delta to make accurate predictions and ii the module structures assumptions and interpretation of parameters are consistent with empirically observed behaviors of migrating fish in the system except for σ u s u f p d s and λ the spread in the top twenty best performing parameter sets is very tight fig d 2 the parameters with wide spreads were difficult to constrain as well as estimate from the data in the case of the other parameters the widest spread in the top performing parameter sets was observed in region 6 for b and p m where the flow is strong but regularly reverses so it is not unreasonable that the parameters associated with the swimming orientation should be sensitive to the timing of fish releases in this region our λ and ω parameters are significantly larger than those typically reported in the literature see section 3 8 for example while steel et al 2020 report λ 100 km and ω 0 05 m s by applying equations a 6 and a 8 with typical values of variance in water velocities in the delta we get equivalent values of λ 700 km and ω 0 2 m s these values are of comparable magnitude with our calibrated optima 5 1 calibration results the calibrated model accurately predicts travel time distributions and survival observed in the late fall run chinook salmon dataset we show regional deviations of eptm predicted survival estimates relative to mmr estimates in fig 4 a obtained by applying eq 8 to each simulated fish some regions show considerable variability in deviations between eptm predicted and mmr estimated survival within region the regions of the mainstem sacramento river and the sutter and steamboat sloughs in which the flow reverses tidally whereas others are more consistent the nonreversing regions of the sacramento river and the interior delta nevertheless in most regions parameter estimates only vary by a factor of two to three fig 4a in general predicted survival estimates are within 0 2 of mmr modeled survivals throughout the delta indicating that the model can capture survival patterns across the diverse habitat and hydrologic conditions present in different regions of the delta a second variable that can be predicted by eptm is the distribution of migrant travel times in fig 4b we show the distributions across release group of biases between observed and predicted travel time distribution means standard deviations skewness and kurtosis coefficients in the different regions the model predictions show strong agreement with travel time distributions for nearly all release by region combinations typically the bias between mean travel times predicted by the model and the mean observed travel times is less than two days except in regions 7 and 9 where only few tagged fish were left however simulated fish in the eptm travel systematically slower than equivalent tagged fish this is because of the 1591 fish used to calibrate the model 1028 were released during the four lowest flow periods in the calibration dataset this imbalance in the data has likely biased the model to predict smaller movement parameters as the larger number of fish would have skewed the goodness of fit measures particularly in regions away from the mainstem sacramento river the variation of the predicted standard deviation in travel times and the actual standard deviation in travel times is typically less than two days for migrations through regions that typically take a few days these deviations are quite small the biases in skewness and kurtoses generally fall within 1 and 3 respectively indicating that the observed and modeled travel time distributions are not significantly dissimilar in shape from each other however in regions 1 5 6 and 9 the model failed to reproduce multimodalities in the travel time distribution this pattern may be due to differences between individual fish that the model does not attempt to capture nevertheless on the whole the model is able to simulate survival and movement dynamics through the delta 5 2 out of sample validation to validate the model we selected fourteen releases of hatchery reared juvenile salmon acoustic telemetry system jsats tagged fall late fall and winter run chinook salmon between 2012 and 2017 j notch et al 2021 pope et al 2021 in which 2052 fish entered delta at sacramento table 3 these data were obtained from the california enhanced acoustic tagging project which provides arrival data and mmr survival estimates notch et al 2020 j 2021 we used data from release groups that met two criteria i at least 100 fish were released and ii the fish were observed at least at the telemetry stations at the landward and oceanward chipps island ends of the delta the validation dataset comprises of different runs of chinook salmon than the calibration dataset as well as encompasses different flow regimes 260 2150 m3 s versus 360 760m3 s in the calibration dataset and different fish forklengths 84 168 mm versus 150 166 mm in the calibration dataset survival predictions along different migratory routes for out of sample releases were produced by releasing 50 simulated fish at dsm2 nodes within each migratory route inset map in fig 5 a applying eq 8 to each individual averaging across all individuals released in each migratory route and subsequently averaging across the three releases reported in pope et al 2021 weighted by the number of fish in each release table 3 overall survival predictions from sacramento to chipps island for each release were obtained by releasing ten simulated fish for each real fish released applying eq 8 to each individual and averaging across all individuals released in these validation studies the model parameters in each region were set to their optimal values the route dependent survival estimated by the eptm captures the general trend of higher survival along the mainstem sacramento river and north delta sloughs and reduced survival in the interior delta fig 5a 95 confidence intervals on the survivals reported in pope et al 2021 and those predicted by the eptm overlap one another indicating that the model precision is comparable to that of the mmr estimates in fig 5b we show mmr estimated and predicted survival of chinook salmon passing through the delta as a function of mean flow in the sacramento river the flow survival relationship is a crucial tool that aids in overall management of water resources as it gives decision makers an understanding of what levels of flow must be maintained for providing essential ecosystem services so a reliable decision support model should be able to reproduce this relationship we fit a delta wide xt model to the mmr estimated and predicted survivals see appendix d to evaluate whether eptm is able to reliably represent this relationship the model follows from eq 8 as 9 p survival e x λ 1 a ω 2 q 2 here λ and a ω are fitting parameters which represent a delta wide lengthscale of survival decay and a flow scale respectively x 99 2 km is the distance between sacramento and chipps island along the sacramento river and q is the mean river flow during delta entry by fish the fitting parameters we obtained were λ 258 km and a ω 1 225 m 3 s for the mmr based survival estimates and λ 624 km and a ω 4 427 m 3 s for the survivals predicted by the eptm the discrepancies in these parameters may be attributed to systematic biases in the mmr estimation process and biological mechanisms not represented in eptm however both parameter sets have the same orders of magnitude and result in similar shapes for the flow versus survival relationship eptm predictions capture the major patterns evident in data firstly through delta survival predictions of the model red squares in fig 5b are similar to mmr estimates from data black circles in fig 5b in most cases the survival prediction is within 0 2 of the observed survival although there is a bias towards lower survival when flows are low this is likely because the late fall run chinook datasets used to calibrate the model were based on larger and slower moving fish than the smaller and faster moving fall and winter run chinook datasets used for validation tables 2 and 3 and inset boxplot in fig 5c resulting in slower migrations in the eptm than in the data boxplots in fig 5c this could also be because of the mean field treatment of mortality using the xt model when flows are low the water column is generally clearer and so migrants might be able to see predators earlier and avoid being eaten martin et al 2021 as the xt model within the eptm has been calibrated using typical flow conditions such nuances will not be represented in the model overall the model reproduced the shape and scale of the observed relationship between survival and mean river flow through the sacramento during migration through the delta lines and confidence intervals in fig 5b another aspect of out of sample validation is model performance in predicting migration routing to study how the model performs in predicting out of sample route use by salmon through the system we selected those releases 2014 and 2015 of the jsats program in which the endangered winter run chinook salmon passages were recorded through two key junctions along the sacramento river the mainstem sacramento river with sutter and steamboat sloughs and georgiana slough a fish guidance structure was in place in 2014 at the head of georgiana slough with an overall passage efficiency of η 0 777 r w dwr 2016 this was represented in the model as a synthetic barrier with the same efficiency results are shown in fig 6 which shows observed and predicted salmon detected along different possible routes at the two junctions to see if the model is able to reproduce routing during different phases of the tide we stratified this comparison by phase of the tide defined at the junction with sutter and steamboat sloughs with respect to the flow reversal in steamboat slough and at the junction at georgiana slough with respect to the flow reversal in georgiana slough in both years the model is able to predict the qualitative patterns in the data correctly and quantitative routing probabilities to within 20 from the observed values which is notable given that observed routing is not used to calibrate the model 5 3 behavioral implications of optimal parameter values estimates of model parameters are shown for each delta region in fig d 2 in fig d 3 we show how the optimal parameter values for each process within the eptm evolve through a simplified schematic network representation of the delta the combinations of these parameter values in the eptm s behavioral modules results in migration patterns that are consistent with the data collected in the delta fig d 4 for the active swimming component of the model the values of u s decrease from 0 44 m s in the nonreversing macro region to 0 36 m s in the tidally reversing macro regions and σ u s increase from 0 85 m s to 0 97 m s the large values of u s combined with small values of p rheotaxis and large p m s in the nonreversing macro region result in simulated fish actively swimming against strong nonreversing flows in the more tidally reversing macro regions decreasing u s increasing p rheotaxis typically exceeding 0 5 and reduced p m result in simulated fish executing either movements that are directed weakly with or against the flow fig 3c σ u s 2 generally increases with proximity to the ocean together these parameters result in actions by the simulated fish that increase migration rate and dispersion with proximity to the ocean as we observed in the acoustic telemetry datasets figs 3b and e 4 the orientation and holding parameters allow simulated fish to hold against the flow and even swim against the flow during the landward flood phase of the tide fig 3d the trends in c and b are both decreasing through the delta in the nonreversing macro region the net effect of these parameters in combination with the small values of p rheotaxis is to orient simulated fish against the flow much more often than with the flow in the parts of the system where the flow reverses tidally these parameters allow the logistic response to be small when flows are weak and thereby result in simulated fish orientations that may switch between with and against the flow in the reversing macro regions when flows are strong and oceanward the combination of c b and p rheotaxis allows simulated fish to be oriented more often with the flow during strongly landward flow reversals which are quite rare under historic conditions fig 3a u f and values p h 0 5 result in simulated fish approximately maintaining position p d s is around 0 5 with no appreciable trend through the system which is consistent with the values between 0 34 and 0 75 obtained in this region from acoustic telemetry experiments reported in chapman et al 2013 together these holding mechanisms contribute to fish typically holding about 75 of the time throughout the system fig 3d λ generally increases through the system while ω decreases in the delta predators are distributed largely in the fresh sacramento and san joaquin river waters than in the saltier western part of the system michel et al 2020 the spatial distribution of the λ and ω parameters thus represent a lower likelihood of predation in the western delta than in the eastern delta these patterns in λ and ω result in an overall increasing per timestep likelihood of survival through the tidally reversing macro regions however it typically takes significantly longer to move through these reversing flows and so the overall survival through these macro regions is lower than through the nonreversing macro region fig 3e 5 4 sensitivity analysis to evaluate the sensitivity of model predictions to parameter values we performed a global sensitivity analysis gsa with a quasi monte carlo analysis of variance anova owen 2013 decomposition of the variance in mean travel time and survival using the r package sensitivity iooss 2021 briefly the anova decomposition allows the variance in the model results to be expressed as a sum of the contribution of the conditional variance associated with each parameter or the first order effect of that parameter and the conditional variance of two three and up to n way parameter interactions this decomposition can be rewritten efficiently for each parameter into its first order effect and the sum of the variance of all its interactions with other parameters its total effect for the anova decomposition we used sobol indices sobol indices are the first and total order effects estimated using k n 2 model calls at sequentially perturbed parameter values baudin et al 2016 appendix e to evaluate the sensitivity of the model to parameters in a computationally tractable manner we used the reduced complexity toy ptm since the structure of the two models is identical and they are both driven by real flows with the only difference being the simplification of the toy ptm s model grid we expect the sensitivity of either model to the parameters to be very similar we performed 1 000 3 11 2 39 000 model calls independently over the three regions to compute the sobol indices in fig 7 we observe that in the regions upstream of georgiana slough where the flow does not usually reverse fig 7a corresponding to region 1 in the toy ptm the modeled travel times are likely most sensitive to p d s c p rheotaxis and u s the parameters with the strongest first order effects the model is relatively insensitive to b and σ u s here owing to the strong oceanward currents and low observed dispersal of fish in this region in georgiana slough the delta cross channel and the interior delta fig 7b corresponding to region 2 in the toy ptm we observe that the interactions of all the parameters contribute significantly to the sensitivity of the travel time simulation this is because of the tidally reversing flows and complex topology in this region that cause emergent behaviors that vary in response to flow and behavioral memory the sensitivity to b in this region indicates that the shape of the logistic function which dictates the rapidity of the response to changing flows is important here the dependence of the mean travel time to the survival parameters in this region only occurs through the interaction of these parameters with the movement parameters and the total effects associated with these parameters are the lowest amongst all the parameters thus our decision to decouple the movement and survival parameters during model calibration based on the elementary effects analysis of the results of the toy ptm is justified in the southwestern region of the mainstem sacramento river fig 7c corresponding to region 3 in the toy ptm the travel time simulations are most sensitive to u f p h c u s and p rheotaxis in this region the dispersion of fish in the acoustic tagging data is large and therefore the model is insensitive to values of σ u s however as the flow strongly reverses here simulated fish behaviors will be highly sensitive to assumptions about the holding and rheotaxis in all the regions the modeled survivals are primarily sensitive only to λ and ω fig 7d f thus the patterns revealed in the gsa indicates that the algorithms in the eptm result in behaviors that were anticipated from the system wide acoustic telemetry and high resolution fish tracking data 6 discussion and conclusions we have developed a data and theory driven agent based model of juvenile salmonid migration through rivers and estuaries that incorporates behaviors observed in the literature and in field studies this model allows simulated fish to move as a function of local flows and behavioral responses to environmental cues and memory of past actions when calibrated for the delta the model accurately reproduces the survival and routing patterns of multiple runs of chinook salmon as well as the flow versus survival relationships the flow versus survival relationship is a key water management metric used to plan operations such as pulsed dam releases for salmonid outmigration and diversions for agriculture industrial and municipal use given the complexity of behaviors observed in salmonids migrating through estuaries the eptm is a reasonably parsimonious model the combination of the optimized spatially variable set of behavior modules produces environment dependent behavioral responses that shift between the nonreversing and reversing flow macro regions of the delta fig 3 resulting in migration and survival patterns that reproduce observations in both in sample fig 4 and out of sample figs 5 and 6 datasets the runs of chinook and the seasons and flows that correspond to the calibration and out of sample validation are different for the calibration and validation the validation thus indicates that the mechanisms in the eptm are indeed simulating salmonid migratory movements with high fidelity in the eptm the relative importance of parameters can vary spatially as the mechanisms underlying the physical movement of fish change both the morris screening analysis fig e 1 and the sobol indices based gsa with the toy ptm fig 7 revealed similar parameter dependencies these analyses qualitatively confirm that the model is able to represent the mechanisms of fish movement outlined in section 2 animal movements predicted by the model are most sensitive to swimming memory and local flow based response parameters and their interactions in the nonreversing regions and to more complex interactions of parameters in the tidally reversing regions in the delta mortality is most sensitive to the interaction between the survival parameters the interaction of the active swimming orientation holding routing and mortality elements thus produce emergent spatial patterns in the behavior that were not explicitly assigned a priori calibrating the model exposed many challenges in optimizing complex stochastic agent based models we considered several established calibration methods before developing the pipeline used here these included particle swarm optimization poli et al 2007 emulation of the model predictions in conjunction with a monte carlo markov chain mcmc approach dancik et al 2010 and sequential monte carlo with approximate bayesian computations scranton et al 2014 based on simulations using the toy ptm we estimated that particle swarm optimization and approximate bayesian methods would require twenty to thirty million model calls to converge mcmc approaches would also require multiple chains of millions of model calls necessitating the use of an emulator the high dimensionality of the model made emulator construction challenging the workflow we have developed here is comparatively tractable and allowed us to arrive at the vicinity of the global optimum of parameter values with fewer than one million model calls we could not compute empirical confidence bounds about the optimal parameter values as this would have required at least one order of magnitude more model calls the corroboration between the spatial trends in the model parameters figure e 3 functional responses of the behavior modules to flow fig 3 and observed statistics of migration figure e 4 and the biologically plausible interactions among model parameters indicated in the gsa fig 7 together help build confidence in our estimates of the parameter values there are two difficulties in the model calibration which we could not overcome together these likely result in increasing modeled travel times and decreasing modeled survival compared to the data the first is that the calibration data was skewed disproportionately towards a greater number of fish released during lower flows table 1 this meant that a greater number of fish also survived to the interior delta during these low flow periods thus the parameter space searched was also influenced by these low flow conditions second the fish that the model was calibrated with were significantly larger than the fish that it was validated against tables 1 and 2 and inset in fig 5 in the delta the smaller fish migrate much faster relative to flow than larger fish inset in fig 5 together these two factors resulted in smaller movement parameter values than real fish are likely exhibiting longer travel times and hence reduced survivals at the time of model development the late fall run chinook salmon datasets were the only ones available to us in future iterations of the model this imbalance in the calibration will be addressed there are some limitations in the biological component of eptm which should be addressed in the future scaling arguments have been proposed for optimal and maximum cruising speeds of migratory aquatic animals that are theoretically limited by their body sizes and environmental conditions e g videler and nolet 1990 floryan et al 2018 these bioenergetic constraints are not currently incorporated in the model explicitly from fig 5c it is evident that size based movement speeds are likely to play an important role in improving travel time distribution fits and hence survival predictions the lateral movements of fish are very likely independent of the turbulent motions in the flow making the zeroth order turbulence closure model used in the eptm to stochastically move simulated fish laterally unrealistic for example kjelson et al 1982 reported that juvenile chinook in the delta are typically found near the shore during the day and offshore at night more recently goodwin et al rev have reported that some chinook salmon migrating in the sacramento river exhibit zig zagging trajectories which move from one bank to the other while others move relatively quickly along the stream centerline these types of studies indicate that individual migrants are heterogeneous it is also possible for different individuals to school and interact such inter individual heterogeneity and interactions if captured in models like the eptm may result in superior model performance than the ergodic assumption that all individuals are alike and differences in behavior are purely aleatory however care must be taken in constructing a generalizable biological random walk model for lateral and vertical movements owing to considerable ambiguity in the literature regarding the vertical placement of salmon within the water column azevedo and parkhurst 1957 mains and smith 1964 brett 1971 smith 1974 borthwick and corwin 2001 rundio et al 2017 and lack of adequate vertical resolution in the acoustic telemetry studies our application of the xt model of predation has some limitations first for fish that enter open water bodies mortality is not estimated during the time they are in such areas in places such as the interior delta where there are many submerged islands with a few entry points due to breaks in levees these open water areas may represent predation hotspots which are not represented in the eptm this could be the cause for the large deviation between modeled and observed survival in the georgiana slough route fig 5a second while migrants are actively attempting to avoid predators predators are also trying to optimize their positioning within the water column and are responding to prey movements to maximize their likelihood of catching their prey these dynamic interactions are not represented in the model and can be implemented in the future via a game theoretic formulation in which the ω parameter could be optimized by minimizing the differences between the outcomes of games played between archetypical predators and prey and observed survival rates in different parts of the system the three dimensional water velocity and mixing profiles described in section 3 2 allow for the general application of the model however for targeted applications to specific river and estuary systems we recommend developing lookup tables using measured acoustic doppler current profiler velocity and turbulent stress profiles to replace the laboratory derived profiles of gandhi et al 2016 similarly the lateral stochastic turbulent movement rules can be readily modified to include more realistic biological random walks or nonparametric models e g olivetti et al 2021 gross et al 2021 as long as the hydrodynamic model outputs are produced in a format readable by the eptm the model can be coupled with more sophisticated two and three dimensional flow models the eptm is both a scientific tool and decision support model as behaviors can interact with flow within the modular code environment it is relatively straightforward to interchange behavior modules and hydrodynamic routines for example apart from the behaviors elaborated in section 3 we also tested a suite of other behaviors such as requiring simulated fish to i always swim towards the ocean ii always swim near the water surface iii swim only during the oceanward ebb phase of the tide and iv swim in the direction of the positive salinity gradient thus the model can serve as a numerical test bed for evaluating alternative hypothesis of animal movement it is also possible to turn the behavior model off completely or assign more rudimentary circadian behaviors so that other organisms in the food web relevant to salmonids could be simulated and salmonid movements can be modeled to forage for food see table b 1 the dsm2 salinity water temperature and turbidity modules can be invoked to produce ecohydraulic simulations so that individuals can be instructed to search for optimal habitat e g dudley 2019 these latter advances would allow us to simulate both rearing and migrating juveniles in a similar vein there are no restrictions on the model structure to limit its application to salmonid migration only the behaviors can be modified to simulate the movements of other species of fish provided the three key assumptions of one way coupling between the flow and fish movements ergodicity of individuals and non interacting individuals hold models like the eptm are critical to both planning water operations and in also bridging the gap between fundamental aquatic biology and water management as water operations in multipurpose surface water systems are planned over long periods under the influence of climate change and projected water demand and can involve hundreds or even thousands of alternative management scenarios decision support tools that simulate the effects of flows and water operations on the aquatic ecosystem health over time must be fast the eptm is easily parallelizable resulting in linear performance gain with the number of computing cores and high scalability under changing landscapes sea level rise and climate change models which are not data and theory driven will likely be unreliable outside of their calibration range as we have demonstrated the eptm can perform reliably even outside its calibration range finally the temporal scale of the behaviors represented in the model are sufficiently fine to resolve biological responses to tidal and daily variability in environmental conditions but coarse enough so that autocorrelated movements that are difficult to observe in the field can be averaged over thus the eptm is able to represent behaviors which can be supported by the data and thereby justified to both scientists and managers the properties of the eptm outlined here constitute the key ingredients in the recipe of a model that can be used to both discover new science about animal movement as well as serve as management tools viz i high performance ii mechanistic with strong basis in the data and migration theory and iii operating at an intermediate scale of motion data availability statement the eptm model source code and all the data that was used to calibrate and validate the model are hosted in a github repository at https github com cvclcm eptm v2 credit authorship contribution statement vamsi krishna sridharan conceptualization methodology software validation formal analysis investigation data curation visualization writing original draft writing review editing supervision project administration funding acquisition doug jackson conceptualization methodology software validation formal analysis investigation writing original draft writing review editing andrew m hein methodology investigation formal analysis writing original draft writing review editing funding acquisition russell w perry methodology formal analysis investigation data curation writing review editing adam c pope methodology formal analysis investigation data curation writing review editing noble hendrix investigation writing review editing project administration funding acquisition eric m danner resources writing review editing supervision project administration funding acquisition steven t lindley conceptualization methodology software resources writing review editing supervision funding acquisition declaration of competing interest the authors declare the following financial interests personal relationships which may be considered as potential competing interests vamsi krishna sridharan reports financial support was provided by california department of fish and wildlife vamsi krishna sridharan reports financial support was provided by united states bureau of reclamation doug jackson reports financial support was provided by united states bureau of reclamation andrew hein reports financial support was provided by national science foundation andrew hein reports financial support was provided by california department of fish and wildlife eric danner reports financial support was provided by california department of fish and wildlife eric danner reports financial support was provided by united states bureau of reclamation steve lindley reports financial support was provided by california department of fish and wildlife steve lindley reports financial support was provided by united states bureau of reclamation russel perry reports financial support was provided by united states bureau of reclamation adam pope reports financial support was provided by united states bureau of reclamation noble hendrix reports financial support was provided by united states bureau of reclamation acknowledgements vamsi krishna sridharan acknowledges support from the california department of fish and wildlife through proposition 1 scientific grant p1896007 and from the united states bureau of reclamation through cooperative agreement r18ac00096 doug jackson acknowledges support from the united states bureau of reclamation through cooperative agreement r18ac00096 and interagency agreement r12pg20200 andrew hein acknowledges support from california department of fish and wildlife through proposition 1 scientific grant p1896007 and from the national science foundation through grant ios 1855956 russell perry and adam pope acknowledge support from the united states bureau of reclamation through interagency agreement r19pg00002 eric danner and steven lindley acknowledge support from the california department of fish and wildlife through proposition 1 scientific grant p1896007 and the united states bureau of reclamation through cooperative agreement r18ac00096 and interagency agreement r12pg20200 we thank kate le and jacob mcquirk at dwr rebecca buchanan at the university of washington seattle and sam johnston at hti sonar for providing the acoustic tracking data used in the model development discussions with pete klimley at university of california davis rebecca buchanan patricia brandes at the united states fish and wildlife service jon burau at the united states geological survey usgs rusty holleman and edward gross at resource management associates nick demetras peter dudley alyssa fitzgerald cyril michel and jeremy notch and at ucsc and dave rundio and edward dick at the national marine fisheries service nmfs improved our understanding of fish movements similarly structured engagement supported by the nmfs west coast regional office and usbr helped us leverage the domain expertise of local and regional stakeholders in california we also thank drs simone olivetti and benjamin burford at the ucsc and dalton hance at usgs who supplied additional data used in formulating and validating the model lastly we thank dr simone olivetti and ms amy hansen at usgs the journal editor and two independent reviewers for providing valuable feedback which improved the quality of this manuscript any use of trade firm or product names is for descriptive purposes only and does not imply endorsement by the u s government appendix a structure of the eptm a 1 hydrodynamic profiles and tuning parameters in section 3 2 we indicated that both straight and curved channels are implemented in the eptm we determine channel curvature with a statistical estimation procedure in which we fit both a theil sen robust linear regressor gilbert 1987 and a chernov lesort robust circular regressor chernov 2010 to a densely up sampled set of centerline coordinates of the channel if the pearson correlation coefficient value of the linear fit exceeds that of the circular fit or if the estimated radius of curvature exceeds 10km the channel is deemed straight we then determine the angle of the channel bend as the ratio of the total distance along the river and the radius of curvature here only the most significant curvature feature can be represented a straightforward way to represent smaller scale meanders is to refine the model grid as needed for straight channels the quantities in the system of equations 2 are evaluated from the following theoretical profile expressions dwr 1998 a 1 u h u f v f h f l a b 2 y w 2 c 2 y w 4 f v 1 0 1 κ 1 ln z h z h 0 01 0 z h 0 01 where w and h are respectively the cross sectional width and depth u is the mean streamwise water velocity a b c are constants specific to the river system κ 0 41 is von karman s constant f l and f v are the lateral and vertical dimensionless water velocity profiles and a 2 ε h c t h u ε v κ z h 1 z h d ε v d z κ 1 h 1 2 z h u 0 1 u where c t 0 6 is a constant and u is the friction velocity to represent flow profiles in curved channels we use the results of gandhi et al 2016 of turbulent open rectangular channel flow in bends of varying curvature up to 90o for angles beyond 90o we assume that the flow adjustment will not be significantly different blanckaert and de vriend 2004 and so we use the distribution at 90o we use the best fit regression of gandhi et al 2016 to their results to generate the flow profiles shown in figure a 1 a 3 u y log m 1 k 1 y 1 2 log m 2 k 2 1 y 2 g 1 g 2 g 3 y 1 2 α 1 1 y 2 β 1 0 1 u ξ d ξ where m 1 k 1 m 2 k 2 g 1 g 2 g 3 α and β are fitting parameters figure a 1a and ξ is the variable of lateral integration using the force balance between the turbulent eddy diffusivity and the shear stress by assuming a linear decay of the shear stress from its peak value at the channel banks to zero at the lateral position of peak flow defined from the left bank y max and similarly for the right bank a 4 ε h d u d y u 2 1 y y max where d u d y is obtained from the data and smoothing the resulting profile of ε h to remove spurious discontinuities we get profiles of the flow and mixing terms per the recommendations in ross and sharples 2004 we implemented a mixed layer near the channel banks to eliminate the problem of profile discontinuity we tested a variety of mixed layer thicknesses to evaluate the stability constraints in this approach based on this analysis we found that a near bank and near channel bottom and free surface mixed layer thickness of 20 of the channel width produces only 10 deviation from a uniformly well mixed concentration profile for passive particles that are initially well mixed laterally a 2 optimal timestep size to select the optimal value of δ t reported in section 3 2 we used the absolute value of the deviation of the location of the center of mass from the channel center of an initially uniformly distributed mass of passive particles after two days we found that a timestep of 20 s produces an optimal tradeoff between runtimes and model consistency a 3 critical streakline estimation here we outline how we estimate the position of the critical streakline introduced in section 3 7 we compute the position of the critical streakline from the right bank by convention as the location till which the flow sums to the outflow nearest to the left bank a 5 u h w y w 1 y w i u i q 1 i n f l o w i n g c h a n n e l d i r e c t e d o c e a n w a r d u h w y w 1 y w i u i q 2 i n f l o w i n g c h a n n e l d i r e c t e d l a n d w a r d when an individual reaches a channel junction it is assigned to one channel or the other based on its lateral location y t fig a 2 when there are junctions with more than three channels we implement a tree search algorithm in which the junction is dynamically deconstructed into a sequence of bifurcations with two downstream channels emanating from the channel through which the individual enters the junction a 4 xt model formulation in the eptm in section 3 8 we claimed that the parameters of the standard xt model as presented in anderson et al 2005 are slightly different from those in the eptm for a fish travelling back and forth a total distance x over n timesteps of size δ t such that t n δ t through a river reach of length x with along stream overground velocities of u i i 1 2 3 n we must have x u t and x u t where u i 1 n u i δ t t and u i 1 n u i δ t t we can write var u var u 2 e u 2 e u 2 e u 2 u 2 u 2 e u 2 var u u 2 u 2 var u var u clearly x x so that we must have u 2 u 2 or var u var u 0 to account for the dispersion due to random overground movements that includes the effects of biological and hydrodynamic fluctuations over the distance x x var u var u t in our xt model formulation in addition to the random predator prey encounters speed defined in anderson et al 2005 we must also have an additional term equal to var u var u t 2 so the value of ω in our formulation will be inflated as a 6 ω ω 2 var u var u over the anderson et al 2005 value of ω now with survival defined as in eq 8 we can establish the equivalence between our and the anderson et al formulations by taking the logarithm of the probability of survival as a 7 x 2 ω 2 t 2 λ x 2 ω 2 t 2 λ where λ is the mean free path length between predator encounters for equation a 7 to hold since x 2 ω 2 t 2 x 2 ω 2 t 2 we must have λ λ and a 8 λ x 2 ω 2 t 2 x 2 ω 2 t 2 λ λ u 2 ω 2 2 var u var u u 2 ω 2 λ thus in our formulation the ω parameter is inflated by variance due to stochasticity of overground motions in addition to the random encounter speeds of predator prey interactions and consequently the λ parameter is inflated to recover the actual survival rates appendix b description of eptm behavior modules in section 3 we described the active swimming orientation holding and mortality modules in the eptm we also showed the outcomes for each module as a function of the instantaneous water velocity by holding all the parameters at their calibrated values and looking at the response of the specific module in fig 3 here we describe the construction of fig 3 for these calculations we first obtained the lengths x of each region from google earth as the shortest along river distance from the upstream end to the downstream end of the region for the period of 1990 to 2016 we collected water velocities estimated within each dsm2 channel in each delta region fig 2 and constructed histograms of water velocities fig 3a we then classified the regions into three macro regions i nonreversing macro region comprising of regions 1 and 2 weakly reversing macro region comprising of regions 3 to 6 and strongly reversing macro region comprising of regions 7 8 and 9 based on the ratio of subtidal low pass filtered water velocities to root mean squared variability in water velocities in all subsequent parts of fig 3 we used the optimal parameter values in each macro region to compute the response over a period of five days or 480 15 minute timesteps of each behavior module for a single simulated fish to the water velocity bins in each macro region we did this by averaging the response in each region within a macro region weighted by the total along stream length of the regions we then smoothed the behavior responses as a function of water velocity using a 6 hour or 25 point savitsky golay filter to highlight the signals in fig 3 in fig 3b we used the optimal values of u s and σ u s to estimate the probability density function of log normally distributed swimming speeds according to eq 3 for each macro region we developed a lognormal mixture distribution b 1 lnn μ σ i 1 n χ i lnn μ i σ i where χ i x i i 1 n x i is the relative length of region i for each water velocity bin bin centers of the water velocity histogram we then drew 480 swimming speeds from the weighted distributions in each macro region and performed bernoulli draws to determine fish orientation and holding relative to flow for each of these draws from the estimates in figs 3c and 3d below in fig 3c we estimated what the likelihood of orienting with the flow we set an initial orientation with flow and then ran a matlab simulation over 480 timesteps in which at each timestep first a bernoulli trial using the optimal value of p m for the region determined if the orientation persists if the orientation needed to be changed then we used the optimal values of p rheotaxis c and b section 3 5 with the specified water velocity to find the probability of orienting with the flow we then performed a second bernoulli trial using this probability to decide if the orientation remains the same or changes at each timestep we kept track of the orientation we then repeated these steps with an initial orientation against the flow we then obtained the overall probability of orienting with the flow over a five day period as the ratio of the total number of timesteps that the simulated fish was oriented with the flow from both starting conditions and 960 in fig 3d we estimated what the likelihood of holding is as follows we started a matlab simulation with one individual from day one at 00 00 h to day four at 23 45 h in which daylight hours were set from 07 00 h to 19 00 h at each timestep an individual would hold position if the water velocity was lower than the optimal u f for the region and if a bernoulli trial with the optimal value of p h was successful or if the timestep fell during the day and a bernoulli trial with the optimal value of p d s was unsuccessful we then obtained the overall probability of holding over a five day period as the ratio of the total number of timesteps that the simulated fish was holding and 480 in fig 3e we estimated what the survival probability is for a passive drifter near the water surface in the nonreversing macro region the distance traveled by the individual x x and the travel time in the to traverse this distance is nominally b 2 t x u h then we apply eq 8 to estimate the survival in the reversing macro regions we estimated the travel time required to traverse one tidal excursion e x as b 3 t x e x u h however over one tidal excursion the actual displacement of the individual after substitution of equation b 3 for t x is only b 4 x t x u s t x u s u h e x where u s 1 1429 2 η 0 h u is the stokes drift velocity near the water surface for shallow water tidal waves sridharan 2018b g 9 81 m s 2 is the acceleration due to gravity η 0 is the amplitude of the tide h is the average depth of the water column and u is the high frequency tidal fluctuations about the subtidal water velocity η 0 h and u were obtained from dsm2 as respectively twice the standard deviation of water depths the average water depth and twice the standard deviation of water velocities in all the channels comprising of the region then the total travel time after substitution of equations b 3 and b 4 respectively for t x and x t x is b 5 t t x x x t x 1 24 h η 0 x u s and the total distance traveled by the individual after substitution of equations b 3 and b 5 respectively for t x and t is b 6 x t t x e x 1 24 h η 0 u h u s x then we apply eq 8 to estimate the survival two interesting feature of equations b 2 and b 6 are that in the nonreversing macro region as lim u h 0 t so that survival dips whereas in the reversing macro regions as lim u h 0 x min x so that survival peaks in table b 1 we show conceptually how relaxing various hypothesized model structures will lead to simpler model formulations and behavior implications this demonstrates how flexible the eptm is in capturing a wide suite of fish behaviors appendix c rationale for constrains on model parameters here we discuss the choice of constraints set on the eptm parameters outlined in section 4 3 we surveyed the literature on sustained swimming speeds of chinook smolts dougan 1993 anglea et al 2004 brown et al 2006 walker et al 2016 lehman et al 2017 to set the constraints on u s and σ u s all of these studies report a maximum sustained swimming speed of about 5 body lengths per second blps based on these studies we assumed an average fork length of approximately 100 mm which produces a maximum value of this parameter of 0 5 m s table 1 setting the maximum σ u s also to 0 5 m s table 1 results in more than 95 of the draws rarely exceeding a speed of 10blps for a 100 mm smolt which is the maximum instantaneous swimming speed observed in the high resolution fish tracks in the delta lehmann et al 2017 assigning constraints on the orientation parameters was more subjective for c and b there are no analogues in the literature we set these ranges to allow the logistic curve to take on a variety of shapes from linear growth to exponentially saturating within 95 of the range of dsm2 modeled water velocities within the delta between 1962 and 2017 while there is some background in the literature on diel holding patterns this is not directly translatable into the holding parameters in the model for california central valley chinook chapman et al 2013 reported that the proportion of fish detected during the daytime versus the nighttime varied as a function of where they were in the system from 10 to 75 so we set the bounds on p d s to encompass these fractions the tidally driven holding parameters are more difficult to constrain based on the literature we therefore computed the peak tidal water velocity modeled in the delta between 1962 and 2017 using dsm2 to be 1 5 m s and set this value as the upper limit for u f the lower limit for u f was set at 0 m s which would indicate a propensity for individuals to hold even during slack water table 1 it is reasonable to expect that not every individual would hold at all times during opposing flow but p h could not be directly estimated we therefore allowed it to vary between 0 and 1 table 1 the bounds on the survival parameters were estimated using a set of toy ptm simulations over three regions representing the delta in a coarse manner section c 1 in the simulations these parameters were allowed to vary over a range of values that produced aggregated survival estimates spanning the range of values reported in the mmr estimates in perry et al 2018 the range of these values was then used to bracket the survival parameters in the eptm calibration c 1 toy ptm for initial analysis and screening in section 4 3 we referenced a simplified random walk model the toy ptm this was implemented in the r programming language to screen model parameter interactions and determine the parameter value bounds for optimizing some model parameters this was implemented as a three region one junction highly simplified representation of the delta fig c 1 the toy ptm simulates fish movement routing and survival through the three regions an additional region was included within each route solely for the purposes of providing two detection stations within each route which was required for separately estimating survival in regions 2 and 3 from acoustic telemetry detection data for this last region survival is set to one the movement of individuals from region 1 into regions 2 or 3 is by random chance based on routing probabilities ψ for region 2 and 1 ψ for region 3 which are equal to the ratios of flows through the regions and the flow in region 1 the xt model formulation of anderson et al 2005 was adopted to model survival through the regions the behavior model in the toy ptm is identical to that in the eptm all behavioral and mortality parameters are region specific the toy ptm uses water velocities from the sacramento river from october 2018 to march 2019 to drive the random walk of simulated fish region 1 uses water velocities from the sacramento river at freeport region 2 uses velocities from sacramento river below the delta cross channel and region 3 uses velocities from the sacramento river at rio vista fig 2 we performed multiple runs of the toy ptm with 500 simulated fish each time appendix d details of the calibration and validation as we outlined in section 4 4 we applied a 4 stage calibration process first we deduced that the movement swimming orientation and holding parameters could be fit independently of the survival parameters see below using the morris method elementary effects analysis second to identify the movement parameter set that produced predictions that best aligned with data we used several methods for evaluating model goodness of fit in a 2 level multiobjective optimization refinement the 2 level refinement was necessary because the goodness of fit surfaces contain many local optima we used three goodness of fit measures based on three perspectives in the multiobjective optimization framework these were the earthmover s distance an information theoretic measure between observed and modeled travel times levina and bickel 2001 the log likelihood a maximum likelihood measure of observed travel times conditional on eptm parameters section d 1 and the intersection over union of the observed and predicted travel time distributions or the jaccard index a visual comparison chung et al 2019 for each region in the dataset we defined the overall goodness of fit by the sum of the goodness of fit measure over all release groups observed in that region while this results in an exact mathematic value for the log likelihood it is only approximately correct in the case of the earthmover s distance and the jaccard index to calculate the earthmover s distance we used the matlab toolbox developed by yilmaz 2021 we first selected 5000 design points parameter value sets using the maximum separation space filling approach to perform a grid search over in the three dimensional space of the three goodness of fit measures we identified the top 10 design points along the pareto front of performance and selected the top ten of these design points this pareto front is the set of design points with the lowest negative log likelihood the maximum jaccard index and the minimum earthmover s distance summed over all releases after identifying these candidate optima we then performed a third step in which we selected 500 new design points each in the vicinity of each candidate optimum using the maximum separation space filling approach as before to obtain a revised candidate set of 5000 design points we then repeated the multiobjective analysis as before to identify the top 10 of design points along the new pareto front within the neighborhoods of the optima from the first iteration the top performing set of parameter values as defined by the earthmover s index was then chosen as the global optimum for each region we chose to use the earthmover s distance for selecting the global optima because of its robustness to a small number of fish 100 within most mmr regions fourth to fit λ and ω we used optimal values of all the other parameters and selected 625 design points each defined by a pair of values for λ and ω the goodness of fit measure was defined as the sum of the absolute differences between modeled and mmr predicted survivals for all the releases within a region the goodness of fit surface for the λ and ω parameters is well behaved and has a well resolved peak so that a single stage optimization sufficed d 1 log likelihood goodness of fit measure for travel time distributions in section 4 4 we outlined the model calibration process in which one of the goodness of fit measures was a log likelihood of travel time distributions here we show how this is estimated there are x releases in y regions with n i j fish released in the i th release in the j th region of the released fish the number that arrive at the downstream end of the region are n i j these arrive at ordered times t i j t i j 1 t i j 2 t i j k t i j n i j for release i and region j and for a given design eptm parameter set there are m replicates for each of the n i j fish for the k th fish let there be m k replicate simulated arrivals at ordered times τ i j k 1 τ i j k 2 τ i j k m k from this set of ordered times we produce an arrival time distribution f i j k s t for the k th fish over all the m replicate fish then the probability of the travel time of the k th individual being t i j k is p t i j k θ s f i j k s τ t i j k θ s d τ then the likelihood of the observed travel time distribution for region i and release j is l i j t i j 1 t i j 2 t i j n i j θ s k 1 n i j p t i j k θ s d τ n i j k 1 n i j f i j k s τ t i j k θ s so that the log likelihood is d 1 log l i j t i j 1 t i j 2 t i j n i j θ s n i j log d τ k 1 n i j log f i j k s τ t i j k θ s now the log likelihood across all releases within a given region for θ s is d 2 log l j i 1 j x t i j θ s i 1 x n i j log d τ i 1 x k 1 n i j log f i j k s τ t i j k θ s let the set θ j optimal be the set of values of θ s that maximizes log l j i 1 j x t i j θ s now the overall log likelihood of the data is to be maximized given different parameter combinations in the various regions and releases is d 3 log l i 1 j 1 x y t i j θ j j 1 y log l j i 1 j x t i j θ j clearly the θ j optimal s will also maximize the overall log likelihood of the data d 2 evaluation of space filling algorithms for initial parameter selection to select the optimal space filling algorithm in section 4 4 we compared 11 algorithms using the r package diceeval dupuy et al 2015 random selection naïve and maximin latin hypercube sampling halton sobol sobol owen sobol faure tesuka and sobol owen faure tezuka filters maximum separation criterion and wsp and strauss methods we performed an initial screening with 20 2d points and compared two measures of volume occupancy i the greenwood statistic which measures how clumped points are when projected onto a line slicing the 2d plane at various angles and ii the distribution of points along the direction in which the points are most clumped together based on this initial assessment we selected the random selection maximin latin hypercube sampling maximum separation criterion wsp and strauss methods as promising candidates for a full evaluation with the 5000 design points we subsequently used four measures of volume occupancy i the mesh ratio which measures the closeness of the designated points to a uniform n dimensional mesh ii the minimum multidimensional euclidean separation between points which goes from 0 to 1 iii the coverage which measures the deviation of minimum multidimensional separation between points to the mean separation between points and iv the clumpiness of points in all possible two dimensional projections of the multidimensional points using the maximum separation method with a minimum separation criterion of 0 244 produced the best overall performance fig d 1 d 3 calibration results we present the detailed calibration parameter values alluded to in section 5 1 here in figs d 2 d 3 and d 4 estimates of model parameters are shown for each delta region in fig d 2 in fig d 3 we show how the optimal parameter values for each process within the eptm evolve through a simplified schematic network representation of the delta the combinations of these parameter values in the eptm s behavioral modules results in migration patterns that are consistent with the data collected in the delta fig d 4 we motivate the subsequent discussion using the spatial patterns in fig d 3 and the information in fig d 4 for various delta salmonids in figure d 4a we show the distribution of observed swimming speeds in figure d 4b we show that observed fish movements relative to the flow in the high resolution tracking data are autocorrelated for long periods of time in figure d 4c we show how the migration rate changes as a function of flow in figure d 4d we show how the dispersal of fish changes as a function of flow in figure d 4e we show how fish arrivals vary as a function of the tide phase our analysis of the high resolution fish tracks in the delta indicated that there is a large distribution typically between 0 and 10blps in swimming speeds of fish relative to the flow figure d 4a moreover we also found that juvenile salmonid movements are temporally autocorrelated for a few minutes on average with several fish exhibiting long term autocorrelation patterns as well figure d 4b the patterns of large scale migration rate relative to the mean flow indicate a shift from migration rates that are slower than mean flow to rates that exceed mean flow as fish move from nonreversing to more tidally reversing conditions figure d 4c we also observed that the dispersal of fish increases as the animals move closer to the ocean figure d 4d these findings indicate a shift in behavior of salmonids with spatial proximity to the ocean in the tidally reversing macro regions there is strong evidence that both steelhead and chinook salmon move oceanward preferentially during the ebb tide figure d 4e d 4 delta wide xt model in section 5 2 to evaluate the flow survival relationship predicted by eptm we developed a delta wide xt model as follows we rewrote the x in eq 8 as u t and simplified the resulting expression to p survival e t u 2 ω 2 λ here u is the mean overground movement rate between delta entry and chipps island λ is the delta wide lengthscale of survival decay and x 99 2 km is the distance between sacramento and chipps island along the sacramento river multiplying and dividing the term within the exponentiation by u and taking the denominator within the square root we get p survival e x λ 1 ω 2 u 2 a reasonable expectation over the entire scale of the migration distance is that u should be proportional to the river flow q and should be a monotonically increasing function of q if we assume the simplest possible relationship i e u q a for some delta wide average cross sectional area a then after simplifying we get d 4 p survival e x λ 1 a ω 2 q 2 we fit this model by treating λ and a ω as tuning parameters appendix e global sensitivity analysis for the eptm in sections 4 4 and 5 4 we applied two gsa approaches outlined below e 1 morris method the morris method starts at a random set of model parameters and cycles through parameter sets by perturbing the value of each parameter a preset number of times while holding the values of the other parameters fixed until all the parameter values have been perturbed this process is repeated for a number of trajectories so for 33 parameters in the three region toy ptm we began at 100 randomly chosen parameter value sets within specified bounds section 4 4 and ran the toy ptm 100 33 1 3 400 times in each run ten simulated fish were release every two hours over 13 days for a total of 1560 individuals and the simulations were carried out for three months to screen the parameters contributing to the travel time distributions and survival we used the mean travel time and survival predicted in each region by the toy ptm respectively the morris method allows us to simultaneously evaluate the importance of each parameter and its interaction with every other parameter as follows if the mean of the gradient in the model results with respect to a parameter called the elementary effect over all the trajectories is small then this parameter is unimportant on its own if it is large then it is important on its own if the standard deviation in the elementary effect over all the trajectories is small i e the gradient with respect to this parameter does not change by much when the other parameters change then this parameter does not interact with other parameters a large standard deviation likely means that this parameter interacts with other parameters by performing this analysis with the toy ptm we discovered that travel times are insensitive to the survival parameters and survival is largely sensitive only to the mortality parameters fig e 1 e 2 sobol indices we introduced sobol indices in the context of anova in section 5 4 sobol indices are the first and total order effects estimated using k n 2 model calls for an n parameter model at sequentially perturbed parameter values baudin et al 2016 the sequential perturbation of model parameters differentiates this approach from true monte carlo sampling k depends on n but is typically chosen to be 1 000 these model calls result in three matrices of model results at the set of perturbed values for the i th parameter i two matrices a and b containing model results corresponding to independent perturbations of the parameters and ii a matrix a b i in which the i th column of a is replaced by the i th column of b then the first order effect of the i th parameter can be computed by summing the variance in b and a b i which results in saltelli et al 2010 e 1 s i 1 k j 1 k f b j f b j i variance due to i th parameter 1 k j 1 k f b j f a b i i square of quasi monte carlo model mean f 0 2 square of model mean the last two terms cancel as lim k the total order effect can be computed by summing the variance in results of the matrices a and a b i which results in saltelli et al 2010 e 2 s t i 1 k j 1 k f a j f b j i square of quasi monte carlo model mean 1 k j 1 k f a j f a b i i variance due to i th parameter interacting with other parameters f 0 2 square of model mean again the last two terms cancel there are many approaches to estimating the first order and total order sobol indices here we used the martinez estimator which uses the sum of correlation coefficients between the sets b and a b and between the sets a and a b subtracted from 1 respectively to estimate the first order and total order sobol indices for each of the parameters this is a stable and robust estimator of the sobol indices which does not suffer from ill conditioning in many competing approaches baudin et al 2016 
24160,juvenile salmonids migrate hundreds of kilometers from their natal streams to mature in the ocean throughout this migration they respond to environmental cues such as local water velocities and other stimuli to direct and modulate their movements often through heavily modified riverine and estuarine habitats management strategies in an uncertain future of climate change and altered land use regimes depend heavily on being able to reliably predict their ocean entry timings route use and survival rates through rivers and estuaries we developed a spatially explicit agent based model of fish movement in response to hydrodynamic flows that uses movement dynamics gleaned from multi dimensional tracking datasets of acoustically tagged juveniles moving through an urbanized branched tidal estuary we demonstrate how such models can be calibrated and we apply it to the sacramento san joaquin delta in central california the quality of the out of sample validation of the model to predict juvenile salmon survival and route selection indicates that the model is versatile and flexible enough to be used in novel hydroclimatological conditions keywords agent based model particle tracking model salmonid migration ecological model estuary hydrodynamics ecological management water resources management climate change data availability simulating the migration dynamics of juvenile salmonids through rivers and estuaries using a hydrodynamically driven enhanced particle tracking model github 1 introduction the loss of estuarine habitat for iconic endangered and economically important marine organisms is extensive around the world leaving decision makers with the difficult task of ensuring reliable water supply for human uses while maintaining ecosystem services while much is known about how rearing and migrating anadromous fish use estuarine habitats at present we have limited ability to make quantitative predictions about how these fish are likely to respond to changes to their estuarine environment therefore ecological models that provide sound understanding of the behaviors of aquatic species and contribute to realistic quantification of the population dynamics under altered hydroclimatologies are required for better understanding the resiliency of these species to changing landscapes and for optimal water management in this paper we describe the development of the enhanced particle tracking model eptm a data and theory driven agent based model of anadromous juvenile salmonid migration through rivers and estuaries using the outputs of a system scale hydrodynamic flow model in this model we develop behavior agencies that are consistent across multiple scales of motion tens of meters over a few minutes to hundreds of kilometers over several days and can be inferred from observations to demonstrate an application we calibrate and validate this model for migrating juvenile chinook salmon in the sacramento san joaquin delta hereafter the delta in central california globally salmonid species are widespread along temperate and subarctic coastlines and contributed nearly 15 billion dollars to the global fisheries in 2016 irarrazával and bustos gallardo 2019 many of the salmonid stocks are overexploited and a significant number of salmonid species are either threatened or critically endangered yeakley and hughes 2014 pauly 2018 habitat stewardship is a common and significant component of freshwater and marine management plans for salmonids yeakley and hughes 2014 in the delta facilitating successful salmonid migrations is a water management goal that often conflicts with other demands on the system such as extracting water from the estuary for agricultural or municipal use delta stewardship council 2019 every year four seasonal runs fall late fall winter and spring of juvenile chinook salmon johnson et al 2017 and steelhead migrate to the pacific ocean through the delta macfarlane and norton 2002 chapman et al 2013 moving through diverse habitats encountering predators interacting with highly dynamic flows and passing a multitude of human made structures survival of juvenile salmonids migrating through the delta can be extremely low e g perry et al 2010 perry et al 2014 michel et al 2015 perry et al 2018 buchanan and skalski 2020 as a result tools for predicting how water management actions will affect migrating salmonids are urgently needed delta stewardship council 2022 historically juvenile salmonid migration rates and survival through rivers and estuaries have been estimated using statistical models e g newman 2003 perry et al 2018 hance et al 2020 or phenomenological models that represent net migration rates overall dispersal and mortality through physically inspired fate and transport models e g zabel and anderson 1997 zabel et al 2008 sridharan and hein 2019 statistical models only reliably describe patterns over the observed range of conditions do not have emergent behaviors and therefore have limited use in novel hydroclimatological and management conditions at the other end of the spectrum are models that describe complex systems with dynamics that emerge due to the interactions of animal behavior in response to environmental stimuli these include cognitive models of fish movement e g hein et al 2018 jhawar et al 2020 nadler et al 2021 and fine scale computational fluid dynamics and coupled biological random walk models goodwin et al 2006 gross et al 2021 or simulated fish whose behavior is governed by machine learning arenas et al 2015 or artificial intelligence olivetti et al 2021 however these models are too computationally intensive and are either too abstract hein et al 2018 jhawar et al 2020 nadler et al 2021 or too domain specific olivetti et al 2021 gross et al 2021 to be useful as decision support tools agent based models with realistic behaviors driven by system scale flow models such as the eptm can help bridge the gap between simple models and highly refined models and have the potential to predict migration dynamics under novel conditions agent based models have been developed for fish movement and migration in the past e g massoudieh et al 2011 bracis and anderson 2012 kimmerer and rose 2018 gross et al 2020 morrice et al 2020 lai 2022 but have typically involved simple or ad hoc animal behaviors the behavioral complexity represented in the eptm is based on tagged salmonid migration data and theoretical expectations from the literature these behaviors allow us to capture the shifts in behavior of salmonids as they migrate through complex estuaries and to physically represent real world systems these features are likely limited in simpler models or are abstracted from intuitive understanding in artificial intelligence based models and in the case of ad hoc agent based models cannot be explained directly using the available data we organize the paper as follows in section 2 we provide a brief background of the migration dynamics of juvenile anadromous salmonids in section 3 we use the insights gained from section 2 to describe the structure of the eptm in sections 4 and 5 we calibrate and validate the model for a specific system and evaluating the sensitivity of the migration statistics to the model parameters in section 6 we present ways in which the model can be used as a numerical laboratory as well as a decision support tool for water management 2 juvenile salmonid migration and survival dynamics in order to build our migration model we i reviewed the literature on anadromous juvenile salmonid migration to identify common patterns in animal movement ii engaged with local and regional stakeholders in central california to incorporate anecdotal evidence about the natural history of salmonids and iii performed our own analyses of datasets obtained in the delta from acoustic telemetry arrays which provided system wide coverage in the form of detection histories of fish at various points along the river system perry et al 2010 san joaquin river group authority 2013 perry et al 2018 notch et al 2020 and high resolution planar two dimensional fish tracks aecom et al 2015 california department of water resources dwr 2015 r w dwr 2016 from two locations to quantify the key aspects of migration behavior directly from data raimondi et al 2021 using these datasets we identified five key behavioral elements of salmonid migration i active swimming ii orientation towards or away from the ocean iii holding relative to the flow iv routing at channel junctions and v mortality due to predation we subsequently discuss these elements as they apply to model design 2 1 active swimming behavior while larval life stages of some fish species passively drift with the flow nagel et al 2021 migrating juvenile salmonids actively propel themselves relative to the flow to describe fish movement in this paper we define swimming velocity directed or speed undirected as the movement rate of the fish relative to the water over a short timescale a few minutes the overground movement velocity as the directed combined movement rate of the fish and the water over a short timescale and the migration rate as the displacement per unit time of the fish through the river system over a long timescale several days several studies have shown some common patterns in salmonid migration i movement away from their natal streams e g sturrock et al 2015 ii swimming velocities within individual fish that vary over time e g lehman et al 2017 and iii in regions of estuaries where the tidal flow reverses migration rates that are faster when flow oceanward is faster and slower when flow oceanward is slower mccormick et al 1998 these results indicate that salmonid swimming speeds vary both spatially and temporally throughout the system and among individuals 2 2 orientation toward or away from the ocean orientation relative to the flow in tidal estuaries has received much attention in the acoustic tagging literature numerous studies have found that until they encounter a salinity threshold close to the point of ocean entry fish swim actively with the direction of flow during the ebb or oceanward flow phase of the tide and do not effectively move during the flood or landward flow phase of the tide mccleave 1978 solomon 1978 healey 1980 mccormick et al 1998 moore et al 1998 hedger et al 2008 in the lower estuary close to the ocean downstream of this salinity threshold fish mostly swim towards the ocean lacroix and mccurdy 1996 mccormick et al 1998 moore et al 1998 hedger et al 2008 in tidally reversing regions kelly and klimley 2012 reported that non salmonid anadromous fish orient somewhat randomly during slackwater or periods of low flows between tidal reversals acoustic telemetry studies in tidal parts of the delta have also reported positive rheotaxis or orientations against the flow in regions with strongly unidirectional oceanward flow as well as fish tracks exhibiting back and forth lateral movements across the river during low freshwater flows dwr 2015 r w dwr 2016 these results indicate a potential shift in the behavior of salmonids in response to the transition from unidirectional river flows to bidirectional flows in the estuary 2 3 holding relative to the flow in this paper we define holding as a behavior that results in no net displacement over some short period over a few minutes authors have reported two types of holding behaviors i holding related to flow and ii holding related to the day night cycle in general holding is likely governed by proximity to the ocean in regions where the tidal flow reverses fish have been observed to hold against the flow or move slowly oceanward during the landward phase of the flow lacroix and mccurdy 1996 miller and sadro 2003 lacroix et al 2005 some studies have reported a statistically significant preference among juvenile salmonids to migrate oceanward at night in regions of the river system where the flow is non reversing and a more photo period agnostic migration pattern throughout the whole day as fish move closer to the ocean moser et al 1991 lacroix and mccurdy 1996 hedger et al 2008 chapman et al 2013 some of these behaviors were also corroborated by observations by domain experts national marine fisheries service 2021 in particular selective holding of fish during the landward phase of the tide forward and tankersley 2001 verhelst et al 2018 preferential nighttime migration in the non reversing tidal regions of the delta and more uniform migration patterns throughout the day in the tidal parts of the system were observed by domain experts 2 4 routing at river junctions in general migratory fish do not move through channel junctions in river networks or branched tidal estuaries as neutrally buoyant suspended material steel et al 2013 ramόn et al 2018 recently two models have represented route selection processes significantly better than models which allow fish to randomly select a migration route the critical streakline perry et al 2014 r w 2016 see their box 3 for a summary hance et al 2020 and the bifurcating streamline sridharan et al 2018a models both allow fish to enter a channel depending on its position relative to the streamline that bifurcates the flow into downstream channels at a river junction 2 5 mortality due to predation past analyses suggest that mortality due to predation is important in estuaries such as the delta resulting in relatively low survival perry et al 2018 pope et al 2021 that is spatially variable perry et al 2018 hance et al 2020 michel et al 2020 c j michel et al 2021 notch et al 2020 anderson et al 2005 proposed a mean field theory of predation driven mortality the xt model in which survival is a function of local predator density the distance traveled by migrants through the predator field x the exposure time of migrants to predators t and the random velocities of predators and prey this model has been shown to be consistent with survival patterns of chinook salmon migrating through the snake and columbia rivers anderson et al 2005 and in the sacramento river steel et al 2020 3 model structure the eptm written in modular object oriented style in java is a three dimensional coupled physical biological lagrangian particle tracking model that simulates the movements and mortality of juvenile salmonids through a river or estuary sridharan et al 2021 the advantage of agent based models such as the eptm is the relative ease of specifying and modifying different behaviors one might wish simulated fish to follow in the eptm the behaviors of simulated fish combine additively with the local water velocity see also olivetti et al 2021 a feature that makes it easy to modify assumptions about physical forcing the processes that determine locomotion or both formally this decomposition allows us to write the overground movement velocity of a given individual within a simulation timestep as 1 u u s u h where u 0 is oceanward movement and u 0 is landward movement u s is an individual s swimming velocity and u h is the hydrodynamic velocity of the water in the individual s vicinity there are four major assumptions in the eptm i very small scale auto correlated sensory responses at sub second timescales are assumed to be represented by stochastic noise codling et al 2008 ii there is only a one way coupling between the flow and fish movement i e fluid structure interactions through which fish may alter the flow field are not modeled iii all simulated individuals follow the same stochastic behavioral rules and iv interactions among individuals are weak enough that a reasonable approximation of migration behavior can be achieved by simulating many non interacting individuals but see berdahl et al 2016 for timescales on the order of 15 min the typical timestep size at which movement is represented in the eptm the modifications of the flow field by the fish will average out so that fluid structure interactions e g filella et al 2018 can be safely ignored sridharan and hein 2019 showed that the application of a one dimensional advection dispersion model that is based on these assumptions is able to recover the distribution of travel times of migrating steelhead in the delta the structure of the eptm is designed around five behavior modules to simulate the key processes related to juvenile salmonid migration discussed in section 2 fig 1 at each simulation timestep simulated fish move through the water body where they are located experience a probability of mortality due to predation and if they are in the vicinity of a river junction move into one downstream water body or the other by iterating this process over many timesteps the eptm produces predictions about how populations of migrants move and when and where mortality occurs 3 1 model domain in order to explore the structure of a model as complex as the eptm we ground truthed it in the sacramento san joaquin delta fig 2 the delta is an estuary that has been highly modified by diking channelization water extraction invasive species and land reclamation and is vulnerable to climate change land subsidence sea level rise and salinity intrusion mortality of migrants is very high in the delta likely due to increased predation in highly channelized habitats with invasive aquatic plants moyle et al 2010 michel et al 2020 alterations of natural flows by water operations kimmerer 2008 and favorable thermal tolerance regimes of native and invasive predators c j michel et al 2021 however recent studies have shown that there is a positive relationship between freshwater inflow and survival of migrating salmonids in the delta perry et al 2018 buchanan and skalski 2020 hance et al 2020 michel et al 2015 c j 2021 indicating that the high mortality might likely be alleviated by favorable flow conditions the delta is an inverted alluvial fan estuary at the confluence of the sacramento and san joaquin rivers with its oceanward end at san francisco bay both the sacramento and san joaquin rivers are rain and snow fed and heavily regulated by dams with flows typically ranging from 200 to 2000 m3 s in the sacramento river and about 10 to 20 of that in the san joaquin river california state and federal pumping facilities in the south delta withdraw 10 to 50 of the inflow of freshwater from the system fig 2 by operating sluice gates in the north delta at the delta cross channel which feed pumps that supply a network of canals moving water south fig 2 sridharan et al 2018b discuss the hydrodynamics of this system in detail 3 2 hydrodynamics and physical forcing on simulated fish we based the eptm on the california department of water resources dwr delta simulation model ii dsm2 particle tracking module dwr 1998 dsm2 is a one dimensional subgrid shallow water equation solver that provides the mean along stream water velocities at grid points spaced roughly 1 5km apart and is used to drive the behaviors in the eptm in the eptm we disaggregate these mean velocities for both straight and curved channels the lateral and vertical water velocity structures are parametrized as described in appendix a dwr 1998 the eptm uses numerical methods that ensure consistency with the underlying model assumptions sridharan et al 2018a and most importantly it incorporates data and theory driven models of juvenile salmonid behavior during migration although the positional variable of primary interest is the along stream location of each individual x t we also track the location of each individual at each time in the lateral y t and vertical z t dimensions y t is specified as positive from the channel centerline to the right bank looking downstream and z t is specified as positive from the channel bottom to the free surface over a small time δ t positions are updated according to the following equations visser 1997 2 x t 1 x t u h u s δ t y t 1 y t r y 2 ε h δ t d ε h d y δ t z t 1 z t r z 2 ε v δ t d ε v d z δ t here u h u s and the vertical gradient of the vertical eddy diffusivity d ε v d z are all evaluated at the point x t y t z t t while the spatially variable vertical eddy diffusivity is evaluated at the point x t y t z t 1 2 d ε v d z δ t t ε h the spatially variable horizontal eddy diffusivity is evaluated at the point x t y t 1 2 d ε h d y δ t z t t r y and r z are uniformly distributed random numbers between 1 and 1 in the eptm we have included channel curvature water velocity and turbulent mixing profiles with at least as much realism as a one dimensional hydrodynamic model with a zeroth order turbulence closure will allow section a 1 in appendix a in order to represent particle trajectories realistically and balance the requirements of fidelity and performance we tuned several model settings see appendix a the profiles of u h ε h and ε v are obtained under the parametrizations in appendix a the rationale behind the formulation in the system of equations 2 is that simulated fish are pushed laterally and vertically due to random turbulent fluctuations in reality fish also move actively laterally and vertically within the water column in ways that likely depend on the morphologies of specific areas within the domain olivetti et al 2021 gross et al 2021 the net effect of the system of equations 2 is that behavior is adopted in the streamwise direction and passive particle like movements are applied in the lateral and vertical directions this compromise retains the generality of the model 3 3 simulation timescales the eptm model simulates processes with two distinct timesteps the primary timestep τ is 15 min and the sub timestep δ t is 20 s at every timestep the behavioral decisions of each individual are updated and mortality is evaluated while at every sub timestep the positions of each individual are updated see section a 2 in appendix a this finer time resolution helps resolve uncorrelated movements relative to flows and total path length during a 15 minute interval we chose the 15 minute timestep to ensure scalability in multi decadal water management scenario evaluations in which millions of fish have to be simulated over long durations given the 15 minute timestep simulated fish behaviors in the eptm should be interpreted as temporally coarsened representations of cognitive responses to instantaneous local stimuli exhibited by migrants which vary on spatial scales of a few meters and temporal scales of a few seconds olivetti et al 2021 however variability among individual migrants is maintained in the model the outcome of behavioral decisions at each timestep is stochastic and they are produced by a set of behavioral functions that result in actions based on the location of the animal within the system and the environmental conditions at that location we selected the forms of these functions on the basis of a review of the literature on migrating salmonids as well as empirical evidence from our analyses of salmonid migration behavior in the delta section 2 these functions also represent a tradeoff with the simplifying assumptions that is necessary to ensure that parameters are statistically identifiable and that computation times are tractable 3 4 active swimming behavior active swimming in the eptm involves only along stream movements induced by fish behavior locomotion in eptm involves a sequence of behavioral choices each individual makes at each timestep we represent these behaviors as a hierarchy of stochastic decisions to i first either hold position relative to the flow or swim and ii subsequently if they decide to swim then to select the swimming direction and the swimming speed the swimming speeds of migratory salmonids vary over time across environmental conditions and in different regions of an estuary olivetti et al 2021 to allow swimming speed to vary from one timestep to another and among individuals we draw a random swimming speed for each individual that is not holding at each point in time the swimming speed u s for each individual at each timestep is drawn from a log normal distribution of the form 3 lnn μ σ 1 u s σ 2 π e ln u s μ 2 2 σ 2 where the parameters are given by 4 μ 2 ln u s 1 2 ln σ u s 2 u s 2 σ ln σ u s 2 u s 2 2 ln u s in which the mean swimming speed and standard deviation in observed swimming speeds are respectively u s and σ u s 2 table 1 as salmonid swimming behavior could change over the course of migration with proximity to the ocean we allow the parameters of the log normal distribution to vary among different regions of the estuary as the simulated fish move through the system to ensure that randomly drawn swimming speeds remain within the range of biologically plausible speeds the log normal distribution is truncated at the 95th percentile and rescaled appropriately 3 5 orientation towards or away from the ocean the direction of along stream swimming relative to flow varies across the system and over environmental conditions olivetti et al 2021 to allow this in the eptm we incorporate a probabilistic swimming direction rule that determines each individual s swimming direction at each timestep the swimming direction is influenced by the individual s previous swimming direction as well as the flow it experiences the structure of this rule is based on empirical patterns in the high resolution fish tracks aecom et al 2015 dwr 2015 r w 2016 while migrants regularly turn to direct locomotion landward oceanward or toward channel banks they also exhibit a tendency to persist in a given swimming direction for long periods of time olivetti et al 2021 to capture this tendency to persist an individual is allowed to continue moving along its previous swimming direction either oceanward or landward at each simulation timestep with probability p m table 1 the decision to persist is then determined by a bernoulli trial with probability p m if the bernoulli draw to determine persistence results in a zero the individual s swimming direction is determined by a stochastic decision based on the flow it experiences during the current timestep this is motivated by the observation that fish in different flow regimes exhibit different tendencies to swim with or against prevailing flow olivetti et al 2021 a range of processes have been attributed to flow detection by fish liao 2007 burke et al 2014 klimley et al 2017 oteiza et al 2017 lohmann and lohmann 2019 miles et al 2021 regardless of the sensory mechanisms strong flows are significantly easier to perceive compared to very weak flows a simple way to represent this flow strength based perception is to model the probability of orienting in the direction of prevailing flow as a function of the dimensionless water velocity magnitude 5 u u h u h where u h is the instantaneous water velocity magnitude at the migrant s location and u h is the historical average water velocity in the system the quantity u h serves simply to normalize u to a consistent range of values and any other constant could be used in its place without loss of generality i e we are not assuming that fish have knowledge of the historical average water velocity we assume water velocity magnitude is related to the individual s probability of orienting in the direction of the prevailing flow according to the function 6 p swf t 0 5 p rheotaxis 0 5 1 1 e c b log u where p swf is the probability of orienting in the direction of flow p rheotaxis read as the complement of the probability of rheotaxis is a calibration parameter determined by where the migrant is located in the system c is half saturation point the abscissa of the inflection point and b is the slope of the steepest part of the curve table 1 if an individual is not holding and not persisting in its previous movement direction its direction relative to the flow is determined by a bernoulli draw with probability given by p swf t from eq 6 for positive values of c and small values of b simulated fish exhibit sluggish responses to flow signals i e an individual will make decisions that are not random only at very strong water speeds for negative values of c and large values of b simulated fish exhibit very sharp responses to small changes in the flow i e decisions will be nonrandom even for weak flows the p rheotaxis parameter determines if the individual is likely to orient with or against the flow if p rheotaxis 0 then as flows become stronger individuals will have a tendency to orient against the flow or perform positive rheotaxis if p rheotaxis 0 5 orientation decisions will be random if p rheotaxis 1 then as flows become stronger individuals will have a tendency to orient with the flow or perform negative rheotaxis by allowing these parameters to vary in different regions of the system spatial variation in responses to flows can be captured 3 6 holding relative to the flow in the eptm whether an individual will hold or swim during a given simulation timestep is determined by two factors the time of day and the phase of the tide these dependencies are implemented by the following equations 7 p hold p h u h u f i t d 1 p d s u h u f where p h is a probability that the individual holds u f is a landward flow threshold above which simulated fish are assumed to hold i t d is an indicator function denoting whether it is day 1 or night 0 and p d s is the probability of swimming during the daytime chapman et al 2013 table 1 a migrant s decision to hold is determined by a bernoulli trial with probability p hold at each timestep this allows the model to capture different types of holding behavior observed in the system 3 7 routing at river junctions in the eptm we allow simulated fish to move into downstream water bodies at junctions depending on their lateral position relative to the critical streakline or bifurcating streamline appendix a when a migrant reaches the end of a river channel within a sub timestep the routing process is invoked and it is moved into a downstream river or open water body such as a flooded island or shallow lake subsequently the remaining trajectory computation is completed for that sub timestep in the new channel beginning from a random cross sectional position if an individual enters an open water body it waits for a random length of time smaller than one day and then leaves the open water body randomly into a connecting downstream water body while it would be straightforward to implement stochastic routing decisions that depend on the flow the individual s lateral position and other system and species specific attributes see steel et al 2013 hance et al 2020 but we have not implemented this in the eptm as we wanted to retain generality across species and flow conditions recently nonphysical barriers and fish guidance mechanisms such as bubble curtains and strobe lights have been investigated to steer fish into favorable migration routes in the delta perry et al 2014 dwr 2015 r w dwr 2016 these mechanisms work by directing fish away from a potentially deleterious route without altering the flow and operate with some efficiency η we implement such mechanisms in the model as a synthetic barrier which restricts simulated fish from entering a specific water body during some fraction η of the time any number of barriers can be applied at any junction in the system domain with specified efficiencies over the duration of a simulation such barriers will simply divert a fraction of simulated fish η into the next nearest downstream water body that does not have a barrier while not fully realistic the barrier mechanism nevertheless allows us to capture the leading order function of such barriers see section 5 3 below 3 8 predation and mortality survival in the eptm is modeled using a modified version of the xt model developed in anderson et al 2005 the modification arises because we compute survival over the actual path of an individual in our model rather than over a fixed distance see appendix a this modification follows from tracking simulated fish trajectories in the eptm the basic assumption of the xt model is that on average the risk that prey migrating through a field of resident predators will be eaten by predators within a region can be expressed as constant per unit distance and per unit time rates our model computes survival probability of each individual in each 15 minute timestep as a function of two quantities the total distance traveled by that individual in the timestep x and the duration of the timestep as 8 p survival e x 2 ω 2 t 2 λ in the model t τ here the free parameters λ and ω respectively quantify how survival decays with distance traveled through a region and represent stochasticity in the predator prey encounters table 1 the difference between λ in eq 8 and in the anderson et al 2005 formulation is that in the former case this parameter has to be inflated as a consequence of using the distance over migrant trajectories instead of river reach lengths appendix a the difference in ω in the eptm is that this parameter also captures the stochasticity in flow and fish trajectories appendix a thus the parameter values in eq 8 will generally be much larger than in the conventional formulation of the xt model typically smaller values of λ represent denser predator fields while larger values represent sparse predator distributions small values of ω represent a smaller contribution of the random undirected components of predator and prey movements to the overall encounter rates conceptually small values of ω may be thought of as representative of stationary predators whereas large values as representative of roving predators in the eptm as we allow these parameters to spatially vary the home ranges of different types of predators can be potentially represented in the model in standard applications if a random draw from a uniform distribution is smaller than the probability of survival an individual continues to move through the system otherwise it is killed and the simulation terminates for that individual an alternate mode is also available in the model wherein particles are not removed from the computation but rather continue to be simulated survival estimates can then be provided for each region and compounded over the course of migration using a fixed population of simulated migrants 3 9 eptm behavior kinetics the functional responses of the behavior modules described in sections 3 4 to 3 6 and 3 8 to local environmental conditions observed by simulated fish i e instantaneous water velocities calibrated for salmonids migrating through the delta indicate the biological realism in the model these responses are sketched in fig 3 see appendix b for details on how the responses were sketched the parameter estimation process and optimal parameter values are reported below in sections 4 and 5 to simplify the subsequent discussion we grouped areas in the delta into three macro regions based on the flow characteristics modeled using dsm2 these are the nonreversing flow weakly reversing flow and strongly reversing flow macro regions which each have distinctive instantaneous water velocity histograms fig 3a in all subsequent rows of fig 3 we aggregated behavior responses within all regions constituting each macro region mean migration rate relative to the flow orientation holding and mortality dynamics are illustrated in figs 3b c d and e by assuming that simulated fish experience constant water velocities in each bin of the histograms shown in fig 3a over a period of five days by applying the swimming speed distribution in eq 2 and by using the orientation and holding probabilities from eqs 6 and 7 we obtain the mean relative migration rate as a function of water velocity in fig 3b see appendix b from nonreversing to reversing macro regions the mean relative migration rate generally increases monotonically from slower to slightly faster than the water velocity the probability of orienting with the flow estimated using eq 6 is typically much lower than random in the nonreversing and weakly reversing macro regions except during slack water indicating a tendency for positive rheotaxis in these regions in the strongly reversing macro region this probability is close to random fig 3c see appendix b very rarely do water velocities ever exceed the flood phase holding threshold under historic conditions the combined probability of holding due to strong flood phase landward flows and daylight estimated using eq 7 is typically about 0 75 without an appreciable trend through the domain fig 3d see appendix b mortality due to predation estimated using eq 8 and by assuming that simulated fish i drift passively towards the ocean with the unidirectional freshwater current in the nonreversing macro region and ii experience tidal excursions and a net oceanward stokes drift smythe 2020 in the reversing macro regions is typically low in the nonreversing macro region and significantly increases in the tidally reversing macro regions fig 3e see appendix b this is due to the increased path lengths and travel times in the reversing macro regions survival in the nonreversing macro region dips near slack water because the travel time approaches infinity whereas in the reversing macro regions survival increases near slack water as the distance traveled approaches its minimum value appendix 4b together the mechanisms of these behavior modules interact to produce realistic and well explained migration and survival dynamics the model incorporates behavioral dynamics that have been observed in juvenile salmon across numerous systems however every module might not be observed in every system thus the model can be simplified by turning off a module by setting parameters to specific values this is a strength that allows the model enough flexibility to emulate observed behavior in a given system table b 1 4 model calibration we applied the eptm to study migration through the delta of sacramento river juvenile chinook salmon we calibrated the model by comparing the distribution of travel times and survival obtained from releases of acoustically tagged fish into the system and eptm model simulations with matched simulated fish releases to calibrate the model we searched for optimal parameter values using a customized search process 4 1 calibration data to calibrate the eptm for salmonid migration in the delta we used data from tagging studies of late fall run chinook salmon 2006 2010 released in the sacramento river perry et al 2010 in total 1591 tagged late fall run juveniles were released in eight groups over the 5 year period table 2 these fish were tagged with vemco v5 acoustic tags and were tracked across multiple hydroacoustic receiver arrays fig 2 multistate mark recapture mmr models were fit within a hierarchical bayesian framework to concurrently estimate detection routing and survival probabilities through the different regions perry et al 2010 perry et al 2018 in addition to the regional survival estimates the data also included first detection times for each fish whenever it was detected at a receiver array we fit the model parameters to the observed travel time distributions and mmr estimated survival rates in each region 4 2 generating eptm predictions for model calibration in the eptm the model parameters can take different values in different parts of the domain this allows us to capture spatial changes in behavior along simulated fish trajectories to balance model parsimony with flexibility we imposed the restriction that parameter values should be constant within each region this does not preclude the possibility that some parameters may take on similar values across regions in total the 11 parameters in the eptm table 1 can vary across the nine regions fig 2 giving 99 model parameters that must be fit using the data to produce predictions from the eptm for fish in the calibration dataset we identified the first detection times of each fish detected in both the upstream and downstream ends of a region in the calibration data for each of these fish we released 10 simulated fish in an eptm simulation for which the dsm2 model was used to compute the flows over the migration period the durations of these simulations were set to be ten days longer than the last initial detection time of fish at the downstream end of the region for each tagged individual the fate of each simulated migrant in the region as well as the travel time through the region was recorded simulated fish were introduced into the model domain at the same locations as the telemetry stations demarcating the upstream ends of the mmr regions by performing such simulations over a large set of parameter values a representation of the model goodness of fit to the data was obtained this was used to estimate model parameters 4 3 model parameter constraints much data is available in the literature regarding animal swimming behaviors from which prior expectation can be set for the swimming parameters appendix c u s and σ u s were restricted to a range of 0 to 0 5 m s and u f to a range of 0 to 1 5 m s table 1 appendix c we allowed p m p rheotaxis p d s and p h to vary between 0 and 1 table 1 the values of c and b were bound between 10 and 10 and 0 and 10 respectively table 1 appendix c we set the lower and upper limits for u f to be 0 and 1 5 m s respectively appendix c λ and ω were allowed to vary between 10 and 1 000km and 0 and 2 m s respectively table 1 appendix c the survival parameter bounds were set based on the results in perry et al 2018 and simulations using a toy ptm model which involved a very fast random walk of simulated fish with behaviors identical to the eptm over three coarsely defined delta regions appendix c 4 4 calibration process to calibrate the model parameters with the late fall run chinook salmon data we applied a custom 4 stage process see appendix d for details first we deduced that the movement swimming orientation and holding parameters could be fit independently of the survival parameters see below second we performed a coarse grid search on a large number of movement parameter values to hone in on the best local optima defined within a multiobjective optimization framework appendix d third we performed a fine grid search in the neighborhoods of the best local optima obtained from the coarse grid search to identify the global optimum movement parameter values using the same optimization framework fourth we held the movement parameters at their optimum values and performed a grid search over the survival parameters to find the optimum values of these parameters we decided to use this custom approach due to a host of practical considerations which we discuss further in section 6 below for an 11 dimensional parameter space in each region of the model domain space filling algorithms provide an efficient way of sampling with significantly fewer points than a random selection of points which could fall on lower dimensional manifolds to select the optimal space filling algorithm we compared ten algorithms using the r package diceeval dupuy et al 2015 using the maximum separation method with a minimum separation criterion of 0 244 produced the best performance out of all the approaches across four performance metrics appendix d we compared the minimum separation criterion across 500 5000 and 50 000 sets of parameter value combinations or design points and found that the criterion value was indistinguishable between 5000 and 50 000 design points we then generated 5000 design points by sampling a standardized value of each parameter by subtracting the mean of the parameter range and dividing by its range from within the permissible range of values for that parameter using a maximum separation criterion based space filling algorithm in the r package dicedesign dupuy et al 2015 the calibration dataset contained eight release groups and survival and travel times could be computed reliably from these data for the nine regions this yielded a total of 5 000 8 9 360 000 eptm model calls as mmr analysis had been performed for each region we could fit the 11 model parameters for each region independently of the other regions but within each region to further reduce the complexity of fitting the 11 dimensional parameter set we used the toy ptm model to identify whether any parameter simplification or decoupling was possible to do this we applied the morris method of elementary effects analysis iooss and lemaitre 2015 using the global optimization toolbox developed by pianosi and wagener 2015 to study the relationships between the model parameters and the distribution of travel times and survival rates in the three regions appendix e the morris method is an efficient screening algorithm to study parameter interactions for high dimensional models which allowed us to identify parameter interactions with just 3400 toy ptm model calls appendix e based on this analysis we decoupled the model fitting process for the eptm to first fit the nine movement parameters and then fit the two survival parameters holding the movement parameters at their optimal values 5 results results of the eptm calibrated for chinook salmon migrating through the delta show strong agreement with many of the major patterns evident in the acoustic telemetry data see appendix d for a detailed presentation moreover parameter estimates reflect the behavioral patterns evident in our empirical analyses of data these agreements between model and data suggest that i the eptm is capable of capturing the salient features of salmonid migration through the delta to make accurate predictions and ii the module structures assumptions and interpretation of parameters are consistent with empirically observed behaviors of migrating fish in the system except for σ u s u f p d s and λ the spread in the top twenty best performing parameter sets is very tight fig d 2 the parameters with wide spreads were difficult to constrain as well as estimate from the data in the case of the other parameters the widest spread in the top performing parameter sets was observed in region 6 for b and p m where the flow is strong but regularly reverses so it is not unreasonable that the parameters associated with the swimming orientation should be sensitive to the timing of fish releases in this region our λ and ω parameters are significantly larger than those typically reported in the literature see section 3 8 for example while steel et al 2020 report λ 100 km and ω 0 05 m s by applying equations a 6 and a 8 with typical values of variance in water velocities in the delta we get equivalent values of λ 700 km and ω 0 2 m s these values are of comparable magnitude with our calibrated optima 5 1 calibration results the calibrated model accurately predicts travel time distributions and survival observed in the late fall run chinook salmon dataset we show regional deviations of eptm predicted survival estimates relative to mmr estimates in fig 4 a obtained by applying eq 8 to each simulated fish some regions show considerable variability in deviations between eptm predicted and mmr estimated survival within region the regions of the mainstem sacramento river and the sutter and steamboat sloughs in which the flow reverses tidally whereas others are more consistent the nonreversing regions of the sacramento river and the interior delta nevertheless in most regions parameter estimates only vary by a factor of two to three fig 4a in general predicted survival estimates are within 0 2 of mmr modeled survivals throughout the delta indicating that the model can capture survival patterns across the diverse habitat and hydrologic conditions present in different regions of the delta a second variable that can be predicted by eptm is the distribution of migrant travel times in fig 4b we show the distributions across release group of biases between observed and predicted travel time distribution means standard deviations skewness and kurtosis coefficients in the different regions the model predictions show strong agreement with travel time distributions for nearly all release by region combinations typically the bias between mean travel times predicted by the model and the mean observed travel times is less than two days except in regions 7 and 9 where only few tagged fish were left however simulated fish in the eptm travel systematically slower than equivalent tagged fish this is because of the 1591 fish used to calibrate the model 1028 were released during the four lowest flow periods in the calibration dataset this imbalance in the data has likely biased the model to predict smaller movement parameters as the larger number of fish would have skewed the goodness of fit measures particularly in regions away from the mainstem sacramento river the variation of the predicted standard deviation in travel times and the actual standard deviation in travel times is typically less than two days for migrations through regions that typically take a few days these deviations are quite small the biases in skewness and kurtoses generally fall within 1 and 3 respectively indicating that the observed and modeled travel time distributions are not significantly dissimilar in shape from each other however in regions 1 5 6 and 9 the model failed to reproduce multimodalities in the travel time distribution this pattern may be due to differences between individual fish that the model does not attempt to capture nevertheless on the whole the model is able to simulate survival and movement dynamics through the delta 5 2 out of sample validation to validate the model we selected fourteen releases of hatchery reared juvenile salmon acoustic telemetry system jsats tagged fall late fall and winter run chinook salmon between 2012 and 2017 j notch et al 2021 pope et al 2021 in which 2052 fish entered delta at sacramento table 3 these data were obtained from the california enhanced acoustic tagging project which provides arrival data and mmr survival estimates notch et al 2020 j 2021 we used data from release groups that met two criteria i at least 100 fish were released and ii the fish were observed at least at the telemetry stations at the landward and oceanward chipps island ends of the delta the validation dataset comprises of different runs of chinook salmon than the calibration dataset as well as encompasses different flow regimes 260 2150 m3 s versus 360 760m3 s in the calibration dataset and different fish forklengths 84 168 mm versus 150 166 mm in the calibration dataset survival predictions along different migratory routes for out of sample releases were produced by releasing 50 simulated fish at dsm2 nodes within each migratory route inset map in fig 5 a applying eq 8 to each individual averaging across all individuals released in each migratory route and subsequently averaging across the three releases reported in pope et al 2021 weighted by the number of fish in each release table 3 overall survival predictions from sacramento to chipps island for each release were obtained by releasing ten simulated fish for each real fish released applying eq 8 to each individual and averaging across all individuals released in these validation studies the model parameters in each region were set to their optimal values the route dependent survival estimated by the eptm captures the general trend of higher survival along the mainstem sacramento river and north delta sloughs and reduced survival in the interior delta fig 5a 95 confidence intervals on the survivals reported in pope et al 2021 and those predicted by the eptm overlap one another indicating that the model precision is comparable to that of the mmr estimates in fig 5b we show mmr estimated and predicted survival of chinook salmon passing through the delta as a function of mean flow in the sacramento river the flow survival relationship is a crucial tool that aids in overall management of water resources as it gives decision makers an understanding of what levels of flow must be maintained for providing essential ecosystem services so a reliable decision support model should be able to reproduce this relationship we fit a delta wide xt model to the mmr estimated and predicted survivals see appendix d to evaluate whether eptm is able to reliably represent this relationship the model follows from eq 8 as 9 p survival e x λ 1 a ω 2 q 2 here λ and a ω are fitting parameters which represent a delta wide lengthscale of survival decay and a flow scale respectively x 99 2 km is the distance between sacramento and chipps island along the sacramento river and q is the mean river flow during delta entry by fish the fitting parameters we obtained were λ 258 km and a ω 1 225 m 3 s for the mmr based survival estimates and λ 624 km and a ω 4 427 m 3 s for the survivals predicted by the eptm the discrepancies in these parameters may be attributed to systematic biases in the mmr estimation process and biological mechanisms not represented in eptm however both parameter sets have the same orders of magnitude and result in similar shapes for the flow versus survival relationship eptm predictions capture the major patterns evident in data firstly through delta survival predictions of the model red squares in fig 5b are similar to mmr estimates from data black circles in fig 5b in most cases the survival prediction is within 0 2 of the observed survival although there is a bias towards lower survival when flows are low this is likely because the late fall run chinook datasets used to calibrate the model were based on larger and slower moving fish than the smaller and faster moving fall and winter run chinook datasets used for validation tables 2 and 3 and inset boxplot in fig 5c resulting in slower migrations in the eptm than in the data boxplots in fig 5c this could also be because of the mean field treatment of mortality using the xt model when flows are low the water column is generally clearer and so migrants might be able to see predators earlier and avoid being eaten martin et al 2021 as the xt model within the eptm has been calibrated using typical flow conditions such nuances will not be represented in the model overall the model reproduced the shape and scale of the observed relationship between survival and mean river flow through the sacramento during migration through the delta lines and confidence intervals in fig 5b another aspect of out of sample validation is model performance in predicting migration routing to study how the model performs in predicting out of sample route use by salmon through the system we selected those releases 2014 and 2015 of the jsats program in which the endangered winter run chinook salmon passages were recorded through two key junctions along the sacramento river the mainstem sacramento river with sutter and steamboat sloughs and georgiana slough a fish guidance structure was in place in 2014 at the head of georgiana slough with an overall passage efficiency of η 0 777 r w dwr 2016 this was represented in the model as a synthetic barrier with the same efficiency results are shown in fig 6 which shows observed and predicted salmon detected along different possible routes at the two junctions to see if the model is able to reproduce routing during different phases of the tide we stratified this comparison by phase of the tide defined at the junction with sutter and steamboat sloughs with respect to the flow reversal in steamboat slough and at the junction at georgiana slough with respect to the flow reversal in georgiana slough in both years the model is able to predict the qualitative patterns in the data correctly and quantitative routing probabilities to within 20 from the observed values which is notable given that observed routing is not used to calibrate the model 5 3 behavioral implications of optimal parameter values estimates of model parameters are shown for each delta region in fig d 2 in fig d 3 we show how the optimal parameter values for each process within the eptm evolve through a simplified schematic network representation of the delta the combinations of these parameter values in the eptm s behavioral modules results in migration patterns that are consistent with the data collected in the delta fig d 4 for the active swimming component of the model the values of u s decrease from 0 44 m s in the nonreversing macro region to 0 36 m s in the tidally reversing macro regions and σ u s increase from 0 85 m s to 0 97 m s the large values of u s combined with small values of p rheotaxis and large p m s in the nonreversing macro region result in simulated fish actively swimming against strong nonreversing flows in the more tidally reversing macro regions decreasing u s increasing p rheotaxis typically exceeding 0 5 and reduced p m result in simulated fish executing either movements that are directed weakly with or against the flow fig 3c σ u s 2 generally increases with proximity to the ocean together these parameters result in actions by the simulated fish that increase migration rate and dispersion with proximity to the ocean as we observed in the acoustic telemetry datasets figs 3b and e 4 the orientation and holding parameters allow simulated fish to hold against the flow and even swim against the flow during the landward flood phase of the tide fig 3d the trends in c and b are both decreasing through the delta in the nonreversing macro region the net effect of these parameters in combination with the small values of p rheotaxis is to orient simulated fish against the flow much more often than with the flow in the parts of the system where the flow reverses tidally these parameters allow the logistic response to be small when flows are weak and thereby result in simulated fish orientations that may switch between with and against the flow in the reversing macro regions when flows are strong and oceanward the combination of c b and p rheotaxis allows simulated fish to be oriented more often with the flow during strongly landward flow reversals which are quite rare under historic conditions fig 3a u f and values p h 0 5 result in simulated fish approximately maintaining position p d s is around 0 5 with no appreciable trend through the system which is consistent with the values between 0 34 and 0 75 obtained in this region from acoustic telemetry experiments reported in chapman et al 2013 together these holding mechanisms contribute to fish typically holding about 75 of the time throughout the system fig 3d λ generally increases through the system while ω decreases in the delta predators are distributed largely in the fresh sacramento and san joaquin river waters than in the saltier western part of the system michel et al 2020 the spatial distribution of the λ and ω parameters thus represent a lower likelihood of predation in the western delta than in the eastern delta these patterns in λ and ω result in an overall increasing per timestep likelihood of survival through the tidally reversing macro regions however it typically takes significantly longer to move through these reversing flows and so the overall survival through these macro regions is lower than through the nonreversing macro region fig 3e 5 4 sensitivity analysis to evaluate the sensitivity of model predictions to parameter values we performed a global sensitivity analysis gsa with a quasi monte carlo analysis of variance anova owen 2013 decomposition of the variance in mean travel time and survival using the r package sensitivity iooss 2021 briefly the anova decomposition allows the variance in the model results to be expressed as a sum of the contribution of the conditional variance associated with each parameter or the first order effect of that parameter and the conditional variance of two three and up to n way parameter interactions this decomposition can be rewritten efficiently for each parameter into its first order effect and the sum of the variance of all its interactions with other parameters its total effect for the anova decomposition we used sobol indices sobol indices are the first and total order effects estimated using k n 2 model calls at sequentially perturbed parameter values baudin et al 2016 appendix e to evaluate the sensitivity of the model to parameters in a computationally tractable manner we used the reduced complexity toy ptm since the structure of the two models is identical and they are both driven by real flows with the only difference being the simplification of the toy ptm s model grid we expect the sensitivity of either model to the parameters to be very similar we performed 1 000 3 11 2 39 000 model calls independently over the three regions to compute the sobol indices in fig 7 we observe that in the regions upstream of georgiana slough where the flow does not usually reverse fig 7a corresponding to region 1 in the toy ptm the modeled travel times are likely most sensitive to p d s c p rheotaxis and u s the parameters with the strongest first order effects the model is relatively insensitive to b and σ u s here owing to the strong oceanward currents and low observed dispersal of fish in this region in georgiana slough the delta cross channel and the interior delta fig 7b corresponding to region 2 in the toy ptm we observe that the interactions of all the parameters contribute significantly to the sensitivity of the travel time simulation this is because of the tidally reversing flows and complex topology in this region that cause emergent behaviors that vary in response to flow and behavioral memory the sensitivity to b in this region indicates that the shape of the logistic function which dictates the rapidity of the response to changing flows is important here the dependence of the mean travel time to the survival parameters in this region only occurs through the interaction of these parameters with the movement parameters and the total effects associated with these parameters are the lowest amongst all the parameters thus our decision to decouple the movement and survival parameters during model calibration based on the elementary effects analysis of the results of the toy ptm is justified in the southwestern region of the mainstem sacramento river fig 7c corresponding to region 3 in the toy ptm the travel time simulations are most sensitive to u f p h c u s and p rheotaxis in this region the dispersion of fish in the acoustic tagging data is large and therefore the model is insensitive to values of σ u s however as the flow strongly reverses here simulated fish behaviors will be highly sensitive to assumptions about the holding and rheotaxis in all the regions the modeled survivals are primarily sensitive only to λ and ω fig 7d f thus the patterns revealed in the gsa indicates that the algorithms in the eptm result in behaviors that were anticipated from the system wide acoustic telemetry and high resolution fish tracking data 6 discussion and conclusions we have developed a data and theory driven agent based model of juvenile salmonid migration through rivers and estuaries that incorporates behaviors observed in the literature and in field studies this model allows simulated fish to move as a function of local flows and behavioral responses to environmental cues and memory of past actions when calibrated for the delta the model accurately reproduces the survival and routing patterns of multiple runs of chinook salmon as well as the flow versus survival relationships the flow versus survival relationship is a key water management metric used to plan operations such as pulsed dam releases for salmonid outmigration and diversions for agriculture industrial and municipal use given the complexity of behaviors observed in salmonids migrating through estuaries the eptm is a reasonably parsimonious model the combination of the optimized spatially variable set of behavior modules produces environment dependent behavioral responses that shift between the nonreversing and reversing flow macro regions of the delta fig 3 resulting in migration and survival patterns that reproduce observations in both in sample fig 4 and out of sample figs 5 and 6 datasets the runs of chinook and the seasons and flows that correspond to the calibration and out of sample validation are different for the calibration and validation the validation thus indicates that the mechanisms in the eptm are indeed simulating salmonid migratory movements with high fidelity in the eptm the relative importance of parameters can vary spatially as the mechanisms underlying the physical movement of fish change both the morris screening analysis fig e 1 and the sobol indices based gsa with the toy ptm fig 7 revealed similar parameter dependencies these analyses qualitatively confirm that the model is able to represent the mechanisms of fish movement outlined in section 2 animal movements predicted by the model are most sensitive to swimming memory and local flow based response parameters and their interactions in the nonreversing regions and to more complex interactions of parameters in the tidally reversing regions in the delta mortality is most sensitive to the interaction between the survival parameters the interaction of the active swimming orientation holding routing and mortality elements thus produce emergent spatial patterns in the behavior that were not explicitly assigned a priori calibrating the model exposed many challenges in optimizing complex stochastic agent based models we considered several established calibration methods before developing the pipeline used here these included particle swarm optimization poli et al 2007 emulation of the model predictions in conjunction with a monte carlo markov chain mcmc approach dancik et al 2010 and sequential monte carlo with approximate bayesian computations scranton et al 2014 based on simulations using the toy ptm we estimated that particle swarm optimization and approximate bayesian methods would require twenty to thirty million model calls to converge mcmc approaches would also require multiple chains of millions of model calls necessitating the use of an emulator the high dimensionality of the model made emulator construction challenging the workflow we have developed here is comparatively tractable and allowed us to arrive at the vicinity of the global optimum of parameter values with fewer than one million model calls we could not compute empirical confidence bounds about the optimal parameter values as this would have required at least one order of magnitude more model calls the corroboration between the spatial trends in the model parameters figure e 3 functional responses of the behavior modules to flow fig 3 and observed statistics of migration figure e 4 and the biologically plausible interactions among model parameters indicated in the gsa fig 7 together help build confidence in our estimates of the parameter values there are two difficulties in the model calibration which we could not overcome together these likely result in increasing modeled travel times and decreasing modeled survival compared to the data the first is that the calibration data was skewed disproportionately towards a greater number of fish released during lower flows table 1 this meant that a greater number of fish also survived to the interior delta during these low flow periods thus the parameter space searched was also influenced by these low flow conditions second the fish that the model was calibrated with were significantly larger than the fish that it was validated against tables 1 and 2 and inset in fig 5 in the delta the smaller fish migrate much faster relative to flow than larger fish inset in fig 5 together these two factors resulted in smaller movement parameter values than real fish are likely exhibiting longer travel times and hence reduced survivals at the time of model development the late fall run chinook salmon datasets were the only ones available to us in future iterations of the model this imbalance in the calibration will be addressed there are some limitations in the biological component of eptm which should be addressed in the future scaling arguments have been proposed for optimal and maximum cruising speeds of migratory aquatic animals that are theoretically limited by their body sizes and environmental conditions e g videler and nolet 1990 floryan et al 2018 these bioenergetic constraints are not currently incorporated in the model explicitly from fig 5c it is evident that size based movement speeds are likely to play an important role in improving travel time distribution fits and hence survival predictions the lateral movements of fish are very likely independent of the turbulent motions in the flow making the zeroth order turbulence closure model used in the eptm to stochastically move simulated fish laterally unrealistic for example kjelson et al 1982 reported that juvenile chinook in the delta are typically found near the shore during the day and offshore at night more recently goodwin et al rev have reported that some chinook salmon migrating in the sacramento river exhibit zig zagging trajectories which move from one bank to the other while others move relatively quickly along the stream centerline these types of studies indicate that individual migrants are heterogeneous it is also possible for different individuals to school and interact such inter individual heterogeneity and interactions if captured in models like the eptm may result in superior model performance than the ergodic assumption that all individuals are alike and differences in behavior are purely aleatory however care must be taken in constructing a generalizable biological random walk model for lateral and vertical movements owing to considerable ambiguity in the literature regarding the vertical placement of salmon within the water column azevedo and parkhurst 1957 mains and smith 1964 brett 1971 smith 1974 borthwick and corwin 2001 rundio et al 2017 and lack of adequate vertical resolution in the acoustic telemetry studies our application of the xt model of predation has some limitations first for fish that enter open water bodies mortality is not estimated during the time they are in such areas in places such as the interior delta where there are many submerged islands with a few entry points due to breaks in levees these open water areas may represent predation hotspots which are not represented in the eptm this could be the cause for the large deviation between modeled and observed survival in the georgiana slough route fig 5a second while migrants are actively attempting to avoid predators predators are also trying to optimize their positioning within the water column and are responding to prey movements to maximize their likelihood of catching their prey these dynamic interactions are not represented in the model and can be implemented in the future via a game theoretic formulation in which the ω parameter could be optimized by minimizing the differences between the outcomes of games played between archetypical predators and prey and observed survival rates in different parts of the system the three dimensional water velocity and mixing profiles described in section 3 2 allow for the general application of the model however for targeted applications to specific river and estuary systems we recommend developing lookup tables using measured acoustic doppler current profiler velocity and turbulent stress profiles to replace the laboratory derived profiles of gandhi et al 2016 similarly the lateral stochastic turbulent movement rules can be readily modified to include more realistic biological random walks or nonparametric models e g olivetti et al 2021 gross et al 2021 as long as the hydrodynamic model outputs are produced in a format readable by the eptm the model can be coupled with more sophisticated two and three dimensional flow models the eptm is both a scientific tool and decision support model as behaviors can interact with flow within the modular code environment it is relatively straightforward to interchange behavior modules and hydrodynamic routines for example apart from the behaviors elaborated in section 3 we also tested a suite of other behaviors such as requiring simulated fish to i always swim towards the ocean ii always swim near the water surface iii swim only during the oceanward ebb phase of the tide and iv swim in the direction of the positive salinity gradient thus the model can serve as a numerical test bed for evaluating alternative hypothesis of animal movement it is also possible to turn the behavior model off completely or assign more rudimentary circadian behaviors so that other organisms in the food web relevant to salmonids could be simulated and salmonid movements can be modeled to forage for food see table b 1 the dsm2 salinity water temperature and turbidity modules can be invoked to produce ecohydraulic simulations so that individuals can be instructed to search for optimal habitat e g dudley 2019 these latter advances would allow us to simulate both rearing and migrating juveniles in a similar vein there are no restrictions on the model structure to limit its application to salmonid migration only the behaviors can be modified to simulate the movements of other species of fish provided the three key assumptions of one way coupling between the flow and fish movements ergodicity of individuals and non interacting individuals hold models like the eptm are critical to both planning water operations and in also bridging the gap between fundamental aquatic biology and water management as water operations in multipurpose surface water systems are planned over long periods under the influence of climate change and projected water demand and can involve hundreds or even thousands of alternative management scenarios decision support tools that simulate the effects of flows and water operations on the aquatic ecosystem health over time must be fast the eptm is easily parallelizable resulting in linear performance gain with the number of computing cores and high scalability under changing landscapes sea level rise and climate change models which are not data and theory driven will likely be unreliable outside of their calibration range as we have demonstrated the eptm can perform reliably even outside its calibration range finally the temporal scale of the behaviors represented in the model are sufficiently fine to resolve biological responses to tidal and daily variability in environmental conditions but coarse enough so that autocorrelated movements that are difficult to observe in the field can be averaged over thus the eptm is able to represent behaviors which can be supported by the data and thereby justified to both scientists and managers the properties of the eptm outlined here constitute the key ingredients in the recipe of a model that can be used to both discover new science about animal movement as well as serve as management tools viz i high performance ii mechanistic with strong basis in the data and migration theory and iii operating at an intermediate scale of motion data availability statement the eptm model source code and all the data that was used to calibrate and validate the model are hosted in a github repository at https github com cvclcm eptm v2 credit authorship contribution statement vamsi krishna sridharan conceptualization methodology software validation formal analysis investigation data curation visualization writing original draft writing review editing supervision project administration funding acquisition doug jackson conceptualization methodology software validation formal analysis investigation writing original draft writing review editing andrew m hein methodology investigation formal analysis writing original draft writing review editing funding acquisition russell w perry methodology formal analysis investigation data curation writing review editing adam c pope methodology formal analysis investigation data curation writing review editing noble hendrix investigation writing review editing project administration funding acquisition eric m danner resources writing review editing supervision project administration funding acquisition steven t lindley conceptualization methodology software resources writing review editing supervision funding acquisition declaration of competing interest the authors declare the following financial interests personal relationships which may be considered as potential competing interests vamsi krishna sridharan reports financial support was provided by california department of fish and wildlife vamsi krishna sridharan reports financial support was provided by united states bureau of reclamation doug jackson reports financial support was provided by united states bureau of reclamation andrew hein reports financial support was provided by national science foundation andrew hein reports financial support was provided by california department of fish and wildlife eric danner reports financial support was provided by california department of fish and wildlife eric danner reports financial support was provided by united states bureau of reclamation steve lindley reports financial support was provided by california department of fish and wildlife steve lindley reports financial support was provided by united states bureau of reclamation russel perry reports financial support was provided by united states bureau of reclamation adam pope reports financial support was provided by united states bureau of reclamation noble hendrix reports financial support was provided by united states bureau of reclamation acknowledgements vamsi krishna sridharan acknowledges support from the california department of fish and wildlife through proposition 1 scientific grant p1896007 and from the united states bureau of reclamation through cooperative agreement r18ac00096 doug jackson acknowledges support from the united states bureau of reclamation through cooperative agreement r18ac00096 and interagency agreement r12pg20200 andrew hein acknowledges support from california department of fish and wildlife through proposition 1 scientific grant p1896007 and from the national science foundation through grant ios 1855956 russell perry and adam pope acknowledge support from the united states bureau of reclamation through interagency agreement r19pg00002 eric danner and steven lindley acknowledge support from the california department of fish and wildlife through proposition 1 scientific grant p1896007 and the united states bureau of reclamation through cooperative agreement r18ac00096 and interagency agreement r12pg20200 we thank kate le and jacob mcquirk at dwr rebecca buchanan at the university of washington seattle and sam johnston at hti sonar for providing the acoustic tracking data used in the model development discussions with pete klimley at university of california davis rebecca buchanan patricia brandes at the united states fish and wildlife service jon burau at the united states geological survey usgs rusty holleman and edward gross at resource management associates nick demetras peter dudley alyssa fitzgerald cyril michel and jeremy notch and at ucsc and dave rundio and edward dick at the national marine fisheries service nmfs improved our understanding of fish movements similarly structured engagement supported by the nmfs west coast regional office and usbr helped us leverage the domain expertise of local and regional stakeholders in california we also thank drs simone olivetti and benjamin burford at the ucsc and dalton hance at usgs who supplied additional data used in formulating and validating the model lastly we thank dr simone olivetti and ms amy hansen at usgs the journal editor and two independent reviewers for providing valuable feedback which improved the quality of this manuscript any use of trade firm or product names is for descriptive purposes only and does not imply endorsement by the u s government appendix a structure of the eptm a 1 hydrodynamic profiles and tuning parameters in section 3 2 we indicated that both straight and curved channels are implemented in the eptm we determine channel curvature with a statistical estimation procedure in which we fit both a theil sen robust linear regressor gilbert 1987 and a chernov lesort robust circular regressor chernov 2010 to a densely up sampled set of centerline coordinates of the channel if the pearson correlation coefficient value of the linear fit exceeds that of the circular fit or if the estimated radius of curvature exceeds 10km the channel is deemed straight we then determine the angle of the channel bend as the ratio of the total distance along the river and the radius of curvature here only the most significant curvature feature can be represented a straightforward way to represent smaller scale meanders is to refine the model grid as needed for straight channels the quantities in the system of equations 2 are evaluated from the following theoretical profile expressions dwr 1998 a 1 u h u f v f h f l a b 2 y w 2 c 2 y w 4 f v 1 0 1 κ 1 ln z h z h 0 01 0 z h 0 01 where w and h are respectively the cross sectional width and depth u is the mean streamwise water velocity a b c are constants specific to the river system κ 0 41 is von karman s constant f l and f v are the lateral and vertical dimensionless water velocity profiles and a 2 ε h c t h u ε v κ z h 1 z h d ε v d z κ 1 h 1 2 z h u 0 1 u where c t 0 6 is a constant and u is the friction velocity to represent flow profiles in curved channels we use the results of gandhi et al 2016 of turbulent open rectangular channel flow in bends of varying curvature up to 90o for angles beyond 90o we assume that the flow adjustment will not be significantly different blanckaert and de vriend 2004 and so we use the distribution at 90o we use the best fit regression of gandhi et al 2016 to their results to generate the flow profiles shown in figure a 1 a 3 u y log m 1 k 1 y 1 2 log m 2 k 2 1 y 2 g 1 g 2 g 3 y 1 2 α 1 1 y 2 β 1 0 1 u ξ d ξ where m 1 k 1 m 2 k 2 g 1 g 2 g 3 α and β are fitting parameters figure a 1a and ξ is the variable of lateral integration using the force balance between the turbulent eddy diffusivity and the shear stress by assuming a linear decay of the shear stress from its peak value at the channel banks to zero at the lateral position of peak flow defined from the left bank y max and similarly for the right bank a 4 ε h d u d y u 2 1 y y max where d u d y is obtained from the data and smoothing the resulting profile of ε h to remove spurious discontinuities we get profiles of the flow and mixing terms per the recommendations in ross and sharples 2004 we implemented a mixed layer near the channel banks to eliminate the problem of profile discontinuity we tested a variety of mixed layer thicknesses to evaluate the stability constraints in this approach based on this analysis we found that a near bank and near channel bottom and free surface mixed layer thickness of 20 of the channel width produces only 10 deviation from a uniformly well mixed concentration profile for passive particles that are initially well mixed laterally a 2 optimal timestep size to select the optimal value of δ t reported in section 3 2 we used the absolute value of the deviation of the location of the center of mass from the channel center of an initially uniformly distributed mass of passive particles after two days we found that a timestep of 20 s produces an optimal tradeoff between runtimes and model consistency a 3 critical streakline estimation here we outline how we estimate the position of the critical streakline introduced in section 3 7 we compute the position of the critical streakline from the right bank by convention as the location till which the flow sums to the outflow nearest to the left bank a 5 u h w y w 1 y w i u i q 1 i n f l o w i n g c h a n n e l d i r e c t e d o c e a n w a r d u h w y w 1 y w i u i q 2 i n f l o w i n g c h a n n e l d i r e c t e d l a n d w a r d when an individual reaches a channel junction it is assigned to one channel or the other based on its lateral location y t fig a 2 when there are junctions with more than three channels we implement a tree search algorithm in which the junction is dynamically deconstructed into a sequence of bifurcations with two downstream channels emanating from the channel through which the individual enters the junction a 4 xt model formulation in the eptm in section 3 8 we claimed that the parameters of the standard xt model as presented in anderson et al 2005 are slightly different from those in the eptm for a fish travelling back and forth a total distance x over n timesteps of size δ t such that t n δ t through a river reach of length x with along stream overground velocities of u i i 1 2 3 n we must have x u t and x u t where u i 1 n u i δ t t and u i 1 n u i δ t t we can write var u var u 2 e u 2 e u 2 e u 2 u 2 u 2 e u 2 var u u 2 u 2 var u var u clearly x x so that we must have u 2 u 2 or var u var u 0 to account for the dispersion due to random overground movements that includes the effects of biological and hydrodynamic fluctuations over the distance x x var u var u t in our xt model formulation in addition to the random predator prey encounters speed defined in anderson et al 2005 we must also have an additional term equal to var u var u t 2 so the value of ω in our formulation will be inflated as a 6 ω ω 2 var u var u over the anderson et al 2005 value of ω now with survival defined as in eq 8 we can establish the equivalence between our and the anderson et al formulations by taking the logarithm of the probability of survival as a 7 x 2 ω 2 t 2 λ x 2 ω 2 t 2 λ where λ is the mean free path length between predator encounters for equation a 7 to hold since x 2 ω 2 t 2 x 2 ω 2 t 2 we must have λ λ and a 8 λ x 2 ω 2 t 2 x 2 ω 2 t 2 λ λ u 2 ω 2 2 var u var u u 2 ω 2 λ thus in our formulation the ω parameter is inflated by variance due to stochasticity of overground motions in addition to the random encounter speeds of predator prey interactions and consequently the λ parameter is inflated to recover the actual survival rates appendix b description of eptm behavior modules in section 3 we described the active swimming orientation holding and mortality modules in the eptm we also showed the outcomes for each module as a function of the instantaneous water velocity by holding all the parameters at their calibrated values and looking at the response of the specific module in fig 3 here we describe the construction of fig 3 for these calculations we first obtained the lengths x of each region from google earth as the shortest along river distance from the upstream end to the downstream end of the region for the period of 1990 to 2016 we collected water velocities estimated within each dsm2 channel in each delta region fig 2 and constructed histograms of water velocities fig 3a we then classified the regions into three macro regions i nonreversing macro region comprising of regions 1 and 2 weakly reversing macro region comprising of regions 3 to 6 and strongly reversing macro region comprising of regions 7 8 and 9 based on the ratio of subtidal low pass filtered water velocities to root mean squared variability in water velocities in all subsequent parts of fig 3 we used the optimal parameter values in each macro region to compute the response over a period of five days or 480 15 minute timesteps of each behavior module for a single simulated fish to the water velocity bins in each macro region we did this by averaging the response in each region within a macro region weighted by the total along stream length of the regions we then smoothed the behavior responses as a function of water velocity using a 6 hour or 25 point savitsky golay filter to highlight the signals in fig 3 in fig 3b we used the optimal values of u s and σ u s to estimate the probability density function of log normally distributed swimming speeds according to eq 3 for each macro region we developed a lognormal mixture distribution b 1 lnn μ σ i 1 n χ i lnn μ i σ i where χ i x i i 1 n x i is the relative length of region i for each water velocity bin bin centers of the water velocity histogram we then drew 480 swimming speeds from the weighted distributions in each macro region and performed bernoulli draws to determine fish orientation and holding relative to flow for each of these draws from the estimates in figs 3c and 3d below in fig 3c we estimated what the likelihood of orienting with the flow we set an initial orientation with flow and then ran a matlab simulation over 480 timesteps in which at each timestep first a bernoulli trial using the optimal value of p m for the region determined if the orientation persists if the orientation needed to be changed then we used the optimal values of p rheotaxis c and b section 3 5 with the specified water velocity to find the probability of orienting with the flow we then performed a second bernoulli trial using this probability to decide if the orientation remains the same or changes at each timestep we kept track of the orientation we then repeated these steps with an initial orientation against the flow we then obtained the overall probability of orienting with the flow over a five day period as the ratio of the total number of timesteps that the simulated fish was oriented with the flow from both starting conditions and 960 in fig 3d we estimated what the likelihood of holding is as follows we started a matlab simulation with one individual from day one at 00 00 h to day four at 23 45 h in which daylight hours were set from 07 00 h to 19 00 h at each timestep an individual would hold position if the water velocity was lower than the optimal u f for the region and if a bernoulli trial with the optimal value of p h was successful or if the timestep fell during the day and a bernoulli trial with the optimal value of p d s was unsuccessful we then obtained the overall probability of holding over a five day period as the ratio of the total number of timesteps that the simulated fish was holding and 480 in fig 3e we estimated what the survival probability is for a passive drifter near the water surface in the nonreversing macro region the distance traveled by the individual x x and the travel time in the to traverse this distance is nominally b 2 t x u h then we apply eq 8 to estimate the survival in the reversing macro regions we estimated the travel time required to traverse one tidal excursion e x as b 3 t x e x u h however over one tidal excursion the actual displacement of the individual after substitution of equation b 3 for t x is only b 4 x t x u s t x u s u h e x where u s 1 1429 2 η 0 h u is the stokes drift velocity near the water surface for shallow water tidal waves sridharan 2018b g 9 81 m s 2 is the acceleration due to gravity η 0 is the amplitude of the tide h is the average depth of the water column and u is the high frequency tidal fluctuations about the subtidal water velocity η 0 h and u were obtained from dsm2 as respectively twice the standard deviation of water depths the average water depth and twice the standard deviation of water velocities in all the channels comprising of the region then the total travel time after substitution of equations b 3 and b 4 respectively for t x and x t x is b 5 t t x x x t x 1 24 h η 0 x u s and the total distance traveled by the individual after substitution of equations b 3 and b 5 respectively for t x and t is b 6 x t t x e x 1 24 h η 0 u h u s x then we apply eq 8 to estimate the survival two interesting feature of equations b 2 and b 6 are that in the nonreversing macro region as lim u h 0 t so that survival dips whereas in the reversing macro regions as lim u h 0 x min x so that survival peaks in table b 1 we show conceptually how relaxing various hypothesized model structures will lead to simpler model formulations and behavior implications this demonstrates how flexible the eptm is in capturing a wide suite of fish behaviors appendix c rationale for constrains on model parameters here we discuss the choice of constraints set on the eptm parameters outlined in section 4 3 we surveyed the literature on sustained swimming speeds of chinook smolts dougan 1993 anglea et al 2004 brown et al 2006 walker et al 2016 lehman et al 2017 to set the constraints on u s and σ u s all of these studies report a maximum sustained swimming speed of about 5 body lengths per second blps based on these studies we assumed an average fork length of approximately 100 mm which produces a maximum value of this parameter of 0 5 m s table 1 setting the maximum σ u s also to 0 5 m s table 1 results in more than 95 of the draws rarely exceeding a speed of 10blps for a 100 mm smolt which is the maximum instantaneous swimming speed observed in the high resolution fish tracks in the delta lehmann et al 2017 assigning constraints on the orientation parameters was more subjective for c and b there are no analogues in the literature we set these ranges to allow the logistic curve to take on a variety of shapes from linear growth to exponentially saturating within 95 of the range of dsm2 modeled water velocities within the delta between 1962 and 2017 while there is some background in the literature on diel holding patterns this is not directly translatable into the holding parameters in the model for california central valley chinook chapman et al 2013 reported that the proportion of fish detected during the daytime versus the nighttime varied as a function of where they were in the system from 10 to 75 so we set the bounds on p d s to encompass these fractions the tidally driven holding parameters are more difficult to constrain based on the literature we therefore computed the peak tidal water velocity modeled in the delta between 1962 and 2017 using dsm2 to be 1 5 m s and set this value as the upper limit for u f the lower limit for u f was set at 0 m s which would indicate a propensity for individuals to hold even during slack water table 1 it is reasonable to expect that not every individual would hold at all times during opposing flow but p h could not be directly estimated we therefore allowed it to vary between 0 and 1 table 1 the bounds on the survival parameters were estimated using a set of toy ptm simulations over three regions representing the delta in a coarse manner section c 1 in the simulations these parameters were allowed to vary over a range of values that produced aggregated survival estimates spanning the range of values reported in the mmr estimates in perry et al 2018 the range of these values was then used to bracket the survival parameters in the eptm calibration c 1 toy ptm for initial analysis and screening in section 4 3 we referenced a simplified random walk model the toy ptm this was implemented in the r programming language to screen model parameter interactions and determine the parameter value bounds for optimizing some model parameters this was implemented as a three region one junction highly simplified representation of the delta fig c 1 the toy ptm simulates fish movement routing and survival through the three regions an additional region was included within each route solely for the purposes of providing two detection stations within each route which was required for separately estimating survival in regions 2 and 3 from acoustic telemetry detection data for this last region survival is set to one the movement of individuals from region 1 into regions 2 or 3 is by random chance based on routing probabilities ψ for region 2 and 1 ψ for region 3 which are equal to the ratios of flows through the regions and the flow in region 1 the xt model formulation of anderson et al 2005 was adopted to model survival through the regions the behavior model in the toy ptm is identical to that in the eptm all behavioral and mortality parameters are region specific the toy ptm uses water velocities from the sacramento river from october 2018 to march 2019 to drive the random walk of simulated fish region 1 uses water velocities from the sacramento river at freeport region 2 uses velocities from sacramento river below the delta cross channel and region 3 uses velocities from the sacramento river at rio vista fig 2 we performed multiple runs of the toy ptm with 500 simulated fish each time appendix d details of the calibration and validation as we outlined in section 4 4 we applied a 4 stage calibration process first we deduced that the movement swimming orientation and holding parameters could be fit independently of the survival parameters see below using the morris method elementary effects analysis second to identify the movement parameter set that produced predictions that best aligned with data we used several methods for evaluating model goodness of fit in a 2 level multiobjective optimization refinement the 2 level refinement was necessary because the goodness of fit surfaces contain many local optima we used three goodness of fit measures based on three perspectives in the multiobjective optimization framework these were the earthmover s distance an information theoretic measure between observed and modeled travel times levina and bickel 2001 the log likelihood a maximum likelihood measure of observed travel times conditional on eptm parameters section d 1 and the intersection over union of the observed and predicted travel time distributions or the jaccard index a visual comparison chung et al 2019 for each region in the dataset we defined the overall goodness of fit by the sum of the goodness of fit measure over all release groups observed in that region while this results in an exact mathematic value for the log likelihood it is only approximately correct in the case of the earthmover s distance and the jaccard index to calculate the earthmover s distance we used the matlab toolbox developed by yilmaz 2021 we first selected 5000 design points parameter value sets using the maximum separation space filling approach to perform a grid search over in the three dimensional space of the three goodness of fit measures we identified the top 10 design points along the pareto front of performance and selected the top ten of these design points this pareto front is the set of design points with the lowest negative log likelihood the maximum jaccard index and the minimum earthmover s distance summed over all releases after identifying these candidate optima we then performed a third step in which we selected 500 new design points each in the vicinity of each candidate optimum using the maximum separation space filling approach as before to obtain a revised candidate set of 5000 design points we then repeated the multiobjective analysis as before to identify the top 10 of design points along the new pareto front within the neighborhoods of the optima from the first iteration the top performing set of parameter values as defined by the earthmover s index was then chosen as the global optimum for each region we chose to use the earthmover s distance for selecting the global optima because of its robustness to a small number of fish 100 within most mmr regions fourth to fit λ and ω we used optimal values of all the other parameters and selected 625 design points each defined by a pair of values for λ and ω the goodness of fit measure was defined as the sum of the absolute differences between modeled and mmr predicted survivals for all the releases within a region the goodness of fit surface for the λ and ω parameters is well behaved and has a well resolved peak so that a single stage optimization sufficed d 1 log likelihood goodness of fit measure for travel time distributions in section 4 4 we outlined the model calibration process in which one of the goodness of fit measures was a log likelihood of travel time distributions here we show how this is estimated there are x releases in y regions with n i j fish released in the i th release in the j th region of the released fish the number that arrive at the downstream end of the region are n i j these arrive at ordered times t i j t i j 1 t i j 2 t i j k t i j n i j for release i and region j and for a given design eptm parameter set there are m replicates for each of the n i j fish for the k th fish let there be m k replicate simulated arrivals at ordered times τ i j k 1 τ i j k 2 τ i j k m k from this set of ordered times we produce an arrival time distribution f i j k s t for the k th fish over all the m replicate fish then the probability of the travel time of the k th individual being t i j k is p t i j k θ s f i j k s τ t i j k θ s d τ then the likelihood of the observed travel time distribution for region i and release j is l i j t i j 1 t i j 2 t i j n i j θ s k 1 n i j p t i j k θ s d τ n i j k 1 n i j f i j k s τ t i j k θ s so that the log likelihood is d 1 log l i j t i j 1 t i j 2 t i j n i j θ s n i j log d τ k 1 n i j log f i j k s τ t i j k θ s now the log likelihood across all releases within a given region for θ s is d 2 log l j i 1 j x t i j θ s i 1 x n i j log d τ i 1 x k 1 n i j log f i j k s τ t i j k θ s let the set θ j optimal be the set of values of θ s that maximizes log l j i 1 j x t i j θ s now the overall log likelihood of the data is to be maximized given different parameter combinations in the various regions and releases is d 3 log l i 1 j 1 x y t i j θ j j 1 y log l j i 1 j x t i j θ j clearly the θ j optimal s will also maximize the overall log likelihood of the data d 2 evaluation of space filling algorithms for initial parameter selection to select the optimal space filling algorithm in section 4 4 we compared 11 algorithms using the r package diceeval dupuy et al 2015 random selection naïve and maximin latin hypercube sampling halton sobol sobol owen sobol faure tesuka and sobol owen faure tezuka filters maximum separation criterion and wsp and strauss methods we performed an initial screening with 20 2d points and compared two measures of volume occupancy i the greenwood statistic which measures how clumped points are when projected onto a line slicing the 2d plane at various angles and ii the distribution of points along the direction in which the points are most clumped together based on this initial assessment we selected the random selection maximin latin hypercube sampling maximum separation criterion wsp and strauss methods as promising candidates for a full evaluation with the 5000 design points we subsequently used four measures of volume occupancy i the mesh ratio which measures the closeness of the designated points to a uniform n dimensional mesh ii the minimum multidimensional euclidean separation between points which goes from 0 to 1 iii the coverage which measures the deviation of minimum multidimensional separation between points to the mean separation between points and iv the clumpiness of points in all possible two dimensional projections of the multidimensional points using the maximum separation method with a minimum separation criterion of 0 244 produced the best overall performance fig d 1 d 3 calibration results we present the detailed calibration parameter values alluded to in section 5 1 here in figs d 2 d 3 and d 4 estimates of model parameters are shown for each delta region in fig d 2 in fig d 3 we show how the optimal parameter values for each process within the eptm evolve through a simplified schematic network representation of the delta the combinations of these parameter values in the eptm s behavioral modules results in migration patterns that are consistent with the data collected in the delta fig d 4 we motivate the subsequent discussion using the spatial patterns in fig d 3 and the information in fig d 4 for various delta salmonids in figure d 4a we show the distribution of observed swimming speeds in figure d 4b we show that observed fish movements relative to the flow in the high resolution tracking data are autocorrelated for long periods of time in figure d 4c we show how the migration rate changes as a function of flow in figure d 4d we show how the dispersal of fish changes as a function of flow in figure d 4e we show how fish arrivals vary as a function of the tide phase our analysis of the high resolution fish tracks in the delta indicated that there is a large distribution typically between 0 and 10blps in swimming speeds of fish relative to the flow figure d 4a moreover we also found that juvenile salmonid movements are temporally autocorrelated for a few minutes on average with several fish exhibiting long term autocorrelation patterns as well figure d 4b the patterns of large scale migration rate relative to the mean flow indicate a shift from migration rates that are slower than mean flow to rates that exceed mean flow as fish move from nonreversing to more tidally reversing conditions figure d 4c we also observed that the dispersal of fish increases as the animals move closer to the ocean figure d 4d these findings indicate a shift in behavior of salmonids with spatial proximity to the ocean in the tidally reversing macro regions there is strong evidence that both steelhead and chinook salmon move oceanward preferentially during the ebb tide figure d 4e d 4 delta wide xt model in section 5 2 to evaluate the flow survival relationship predicted by eptm we developed a delta wide xt model as follows we rewrote the x in eq 8 as u t and simplified the resulting expression to p survival e t u 2 ω 2 λ here u is the mean overground movement rate between delta entry and chipps island λ is the delta wide lengthscale of survival decay and x 99 2 km is the distance between sacramento and chipps island along the sacramento river multiplying and dividing the term within the exponentiation by u and taking the denominator within the square root we get p survival e x λ 1 ω 2 u 2 a reasonable expectation over the entire scale of the migration distance is that u should be proportional to the river flow q and should be a monotonically increasing function of q if we assume the simplest possible relationship i e u q a for some delta wide average cross sectional area a then after simplifying we get d 4 p survival e x λ 1 a ω 2 q 2 we fit this model by treating λ and a ω as tuning parameters appendix e global sensitivity analysis for the eptm in sections 4 4 and 5 4 we applied two gsa approaches outlined below e 1 morris method the morris method starts at a random set of model parameters and cycles through parameter sets by perturbing the value of each parameter a preset number of times while holding the values of the other parameters fixed until all the parameter values have been perturbed this process is repeated for a number of trajectories so for 33 parameters in the three region toy ptm we began at 100 randomly chosen parameter value sets within specified bounds section 4 4 and ran the toy ptm 100 33 1 3 400 times in each run ten simulated fish were release every two hours over 13 days for a total of 1560 individuals and the simulations were carried out for three months to screen the parameters contributing to the travel time distributions and survival we used the mean travel time and survival predicted in each region by the toy ptm respectively the morris method allows us to simultaneously evaluate the importance of each parameter and its interaction with every other parameter as follows if the mean of the gradient in the model results with respect to a parameter called the elementary effect over all the trajectories is small then this parameter is unimportant on its own if it is large then it is important on its own if the standard deviation in the elementary effect over all the trajectories is small i e the gradient with respect to this parameter does not change by much when the other parameters change then this parameter does not interact with other parameters a large standard deviation likely means that this parameter interacts with other parameters by performing this analysis with the toy ptm we discovered that travel times are insensitive to the survival parameters and survival is largely sensitive only to the mortality parameters fig e 1 e 2 sobol indices we introduced sobol indices in the context of anova in section 5 4 sobol indices are the first and total order effects estimated using k n 2 model calls for an n parameter model at sequentially perturbed parameter values baudin et al 2016 the sequential perturbation of model parameters differentiates this approach from true monte carlo sampling k depends on n but is typically chosen to be 1 000 these model calls result in three matrices of model results at the set of perturbed values for the i th parameter i two matrices a and b containing model results corresponding to independent perturbations of the parameters and ii a matrix a b i in which the i th column of a is replaced by the i th column of b then the first order effect of the i th parameter can be computed by summing the variance in b and a b i which results in saltelli et al 2010 e 1 s i 1 k j 1 k f b j f b j i variance due to i th parameter 1 k j 1 k f b j f a b i i square of quasi monte carlo model mean f 0 2 square of model mean the last two terms cancel as lim k the total order effect can be computed by summing the variance in results of the matrices a and a b i which results in saltelli et al 2010 e 2 s t i 1 k j 1 k f a j f b j i square of quasi monte carlo model mean 1 k j 1 k f a j f a b i i variance due to i th parameter interacting with other parameters f 0 2 square of model mean again the last two terms cancel there are many approaches to estimating the first order and total order sobol indices here we used the martinez estimator which uses the sum of correlation coefficients between the sets b and a b and between the sets a and a b subtracted from 1 respectively to estimate the first order and total order sobol indices for each of the parameters this is a stable and robust estimator of the sobol indices which does not suffer from ill conditioning in many competing approaches baudin et al 2016 
24161,arctodiaptomus dorsalis is an invasive calanoid copepod originally from america and has recently established a population in lake taal in the philippines it has been proposed that eutrophication due to aquaculture contributes to the establishment and success of this species this study aimed to clarify this hypothesis by quantifying the effect of increasing food concentration on the reproduction of a dorsalis using an individual based model we parameterized food concentration dependent equations to simulate the effect of different food concentration on the reproductive traits latency time embryonic development time clutch size and hatching success of this species using data from the literature and simulated the reproduction of 1000 independent females for 20 days at different food concentration taking into account the variability among individuals the simulation results showed that the cumulative production of eggs and offspring increased continuously with time when the food concentration was above 3 2 104 cells ml 1 suggesting that this value was the threshold concentration required for stable reproduction of a dorsalis this value is not particularly low compared to other copepods hence our result revealed that the food use efficiency of a dorsalis is not particularly outstanding and urge the need of a comparison with native species to confirm a possible superiority we suggest that a dorsalis has filled the ecological niche left vacant by the disappearance of the original species due to the deterioration of water quality caused by the eutrophication of the lake the reproductive cycle model developed in this study constitutes a necessary step in the development of a complete population dynamics model which can help clarify the invasive abilities of a dorsalis graphical abstract image graphical abstract keywords arctodiaptomus dorsalis invasive copepod lake taal food concentration individual based model data availability data will be made available on request 1 background the rate of biological invasions has increased in recent decades due to increasing global trade and transport keith et al 2013 transoceanic introductions via ship ballast water have particularly increased and contributed to the spread of marine organisms from their native regions to many parts of the world brylinski et al 2012 one such organism is copepods copepods are one of the dominant groups of the zooplankton community in aquatic ecosystems and play a salient role in the food chain linking primary producers phytoplankton and higher trophic levels richardson 2008 they have been suggested as bioindicators because their short life cycle allows the effects of environmental stresses to appear in a short time siokou frangou 1996 hays et al 2005 kwok et al 2015 in particular copepod s abundance and reproductive traits can be a good indicator of their habitat quality de leon et al 2016 a souissi et al 2008 s souissi and souissi 2021 hence their reproduction has been the spotlight of a lot of research e g lacoste et al 2001 devreker et al 2009 jiménez melero et al 2012 liu et al 2015 pan et al 2016 grønning et al 2019 several copepods have invaded new environments through human transport for example pseudodiaptomus forbesi native to the yangtze river in china is found in the san francisco estuary and the columbia snake river system in washington sullivan and kimmerer 2013 and an asian species pseudodiaptomus marinus is found in northern europe brylinski et al 2012 arctodiaptomus dorsalis marsh 1907 the target in this study is also an invasive copepod it is a neotropical freshwater calanoid species originally described as diaptomus dorsalis from lakes near new orleans louisiana and spread its habitat through central america to northern south america reid 2007 in the philippines tuyor and baay 2001 first reported the existence of this species from laguna de bay lake mainit and lake sebu however it had already been recorded from laguna de bay in 1991 in m directo s unpublished report rizo et al 2015 tuyor and baay 2001 suggested that a dorsalis was introduced via the ballast water of ships coming from north america the presence of a dorsalis has now been confirmed in 23 out of 32 researched lakes and rivers in the philippines papa et al 2012a metillo et al 2014 rizo et al 2015 this spread could have been attributed to the transport of cultured fish juveniles to other lakes from major aquaculture sites such as laguna de bay papa et al 2012b rizo et al 2015 lake taal is one of the lakes invaded by a dorsalis it is a caldera lake surrounding the taal volcano located on the island of luzon de leon et al 2016 the aquaculture in fish cages started in 1975 aypa et al 2008 and subsequent excessive feeding led to an increase in nutrients in the lake vista et al 2006 the settlement of the invasive species a dorsalis in lake taal is considered to have been facilitated by this eutrophication papa et al 2012a when food is abundant a dorsalis can adopt a r strategy and produce a large number of small fast developing eggs elmore 1983 reid 2007 previous studies have shown that the copepod s clutch size survival rate elmore 1982 fecundity and egg production rate tordesillas et al 2018 increase as food concentration increases and the inter clutch duration becomes shorter tordesillas et al 2018 also observed this species inability to reproduce when food levels are 4000 cells ml 1 or less besides the hypothesis that the eutrophic environment benefited a dorsalis more than endemic species in terms of reproduction the other hypothesis is that increased algal density displaced endemic species that preferred an oligotrophic mesotrophic environment and provided a niche for invasive species to establish papa et al 2012a tordesillas et al 2018 to date the effects of increased algal density on a dorsalis populations remain largely unclear researching the potential impacts of food concentrations on populations is crucial this is because disruptions in the zooplankton population due to eutrophication induced water quality degradation could have ripple effects on food webs and local ecosystems population models such as individual based models ibms can link individuals to populations using mathematical equations and provide insights into how individual effects observed at different food concentrations can add up to population level effects this study aims to clarify the effect of increasing food concentration on the reproduction of a dorsalis from lake taal for that purpose we developed an ibm on the mobidyc platform ginot et al 2002 that can simulate the reproductive cycle of egg bearing copepods dur et al 2009 for the model calibration we used the results from previous studies that account for the effect of different food concentration on a dorsalis reproduction elmore 1982 tordesillas et al 2016 2018 following the calibration we used the ibm to quantify the effect of a range of food concentration on the reproduction of a cohort of 1000 a dorsalis females and to determine the optimal food concentration for reproduction we then used the model to estimate the egg and nauplii production of a cohort of 1000 independent females along the year in lake taal based on in situ temperature and phytoplankton density 2 materials and methods this model is described according to the odd overview design concepts details protocol as outlined by grimm et al al 2006 2010 2020 the ibm was constructed using the mobidyc platform ginot et al 2002 2 1 purpose and patterns the higher level purpose of this model is to quantify the effect of different food concentration on the recruitment of the invasive egg carrying copepod a dorsalis more specifically the model was designed to quantify the effect of increasing food concentration on reproductive traits of a cohort of 1000 independent females the data required to calibrate the model were obtained from the available literature the verification of the model was based on the satisfaction of the following two patterns 1 at the individual level the time required to produce eggs decreases and clutch size gradually increases as the food concentration increases 2 at the cohort level females consistently produce eggs above a certain food concentration along with this the number of offspring also increases this step cannot be considered true model validation in the strict sense of ecological modeling ideally the model output should be compared with independent observational data but there are no suitable data or previous studies for comparison therefore in the present study we have only confirmed that the model works as intended see supplemental materials figure s1 for model verification we conducted four sets of simulations to 1 estimate the effect of a range of food concentration on the reproduction of a dorsalis at constant water temperature 2 estimate the effects of longevity on a dorsalis reproduction at different water temperatures and fixed food concentration 3 estimate a dorsalis reproduction under constant monthly food concentrations and water temperatures in lake taal 4 estimate the effect of the survival rate on the reproduction estimated in 3 2 2 entities state variables and scales entities in our model refer to a dorsalis adult females each adult female has 16 attributes age longevity lgv embryonic development time edt latency time lt clutch size cs hatching success hs life alive or dead state live or die ovigerous female is having eggs or not offspring ddage ddlgv ddedt ddlt rddedt and rdd lt table 2 embryonic development time edt days is the number of days from spawning to the hatching of a clutch and latency time lt days is the number of days from the hatching to the spawning of the next clutch clutch size cs eggs clutch is the total number of eggs in a particular clutch and hatching success hs is the percentage of successfully hatched nauplii from each clutch these values of edt lt cs and hs possessed by adult females are randomly selected from normal distributions with a mean and standard deviation for each attribute see initialization section in addition the model uses degree days days approach elmessoussi et al 2007 in which the individual requires a certain amount of energy expressed in days to spawn and hatch by multiplying the time required for an organism to reproduce by the water temperature of its environment the effect of temperature variations can be considered when a parameter is multiplied by temperature its name is prefixed with rdd or dd to distinguish it from the original parameters the prefix rdd is an acronym for required degree days and once the state variable is defined it remains unchanged until updated the prefix dd is for state variables with a value that accumulates at each time step for example when ddlt accumulates and reaches the value of rddlt this individual lays eggs for the attribute life life 1 means that the copepod is alive and life 0 means that it is dead the same is true for the state but it is used when calculating survival rates similarly for ovigerous ovigerous 1 means that the individual carries eggs and 0 means that it does not the attribute offspring expressed as the product of cs and hs is used to count the number of nauplii another agent called scientist is used to record of the values of the adult female attributes the model was not spatially explicit the simulation ran with a time step fixed at three hours and lasted 20 days considering that the lifespan of an a dorsalis female at 30 c is around 17 days 2 3 process overview and scheduling 2 3 1 summary the process and scheduling are resumed below and presented as a flowchart fig 1 1 an adult female tests their survival every day 2 on its first time step of life age 0 the adult female s longevity is initialized and it remains constant throughout the simulations 3 the adult female initializes its lt when it is non ovigerous and its ddtl is set to zero each individual randomly draws an lt value from a normal distribution the value of rddlt is also calculated by multiplying the lt by the water temperature 4 the adult female increments their age by one time step i e three hours and the attributes storing energy expressed in degree days i e ddage ddlt and ddedt by one time step temperature 5 test if the lt was reached if the lt is reached ddlt rddlt the adult female spawns this task spawn sets the ovigerous status to 1 calculates a new value of cs edt and rddedt and resets the value of ddlt and ddedt to 0 the values of edt and cs are also randomly drawn from specific normal distributions one for each attribute 6 test if the edt is reached once the edt is reached ddedt rddedt the female releases her eggs in this task hatching the number of offspring is calculated by multiplying cs by hs and the attributes ovigerous cs ddedt rddedt and ddlt are reset to 0 7 a final task of adult female tests if the individual has reached its longevity ddage ddlgv if yes the adult female dies 8 the agent scientist saves the value of the clutch size age of death latency time and embryonic development time of the female at each time step and count the number of offspring produced and kills them 2 3 2 rationale the agent tests its survival first to avoid computing the other tasks when dead the definition of the lt occurs before the accumulation of energy day and time to allow the computation of a new lt for the first clutch and after each hatching process ddlt 0 spawn has to occur before hatching to allow the proper condition and timing for hatching die is the last task of the adult female to allow the hatching of a clutch just before reaching the end of its lifespan finally scientist actions take place at the end of the time step to record the results of all the tasks performed by the adult females during one time step 2 4 design concepts 2 4 1 basic principles the general hypothesis underlying this model design is that the invasion and establishment of a dorsalis in lake taal are due to the eutrophication of the lake caused by aquaculture which has provided this species with a reproductive advantage to quantify this potential advantage the model tested the effect of different food concentration and water temperature on the productivity of this species population by first running the model under increasing food concentrations representing oligotrophic to hypereutrophic conditions and then monthly food concentrations and water temperatures observed in lake taal the behavior of the agent a dorsalis is based on several references that examined the relationships between food concentration and reproduction tordesillas et al 2018 elmore 1982 or water temperature and reproduction tordesillas et al 2016 jimenez merelo et al 2012 2 4 2 emergence the key outcomes of the model are the total production and cumulated production of eggs and offspring by a cohort composed by 1000 independent females these results emerge from the integration of the effects of different food concentration on the reproductive traits of each individual 2 4 3 interactions interactions between individuals were not introduced in the present model we assumed that the mating was implicitly included in latency time since the experiment of tordesillas et al 2018 used to formulate latency time has defined the latency time as the period between the hatching of one clutch of eggs and the spawning of the next clutch males were always present in the petri dish and mating occurred in that period food availability influences the spermatophore production of male copepod bjærke et al 2016 but even at low food concentrations male copepods can maintain a constant spermatophore production over their lifespan burris and dam 2015 additionally many species with eggs sacs such as a dorsalis exhibit high production of small spermatophores that require less investment ceballos and kiørboe 2011 neither the limitations due to mating or spermatophore production nor the failure of egg fertilization was considered here 2 4 4 stochasticity variability in traits among individuals is particularly important for populations experiencing unfavorable or stressful environmental conditions potentially augmenting population persistence and stability and affecting population growth rates richmond et al 2013 latency time lt embryonic development time edt clutch size cs hatching success hs and longevity lgv are stochastically assigned to each female to express individual variability and inter clutch variability lt edt cs and hs are randomly drawn from a normal distribution while lgv is drawn from a gamma distribution gdf the mean and standard deviation of each normal distribution is a food concentration dependent equation hs is a food concentration and temperature dependent equation which was formulated using experimental results from previous studies see the submodels section for the gdf we plotted data obtained from a previous study and fitted the gamma models to estimate the values of α and β the mean value of the gamma distribution used for female longevity was expressed using a temperature dependent equation see the initialization section 2 4 5 observation in the present study our model i saves the value of the clutch size age of death latency time and embryonic development time of the females at each time step and ii counts the number of offspring produced and kills them this procedure allowed total egg and offspring production to be described 2 5 initialization each individual has 16 state variables table 1 the initial value of age was set to 0 days after confirming that the age range of females at the start of the simulation did not affect the results figure s5 the initial value of the copepod s reproductive parameters edt lt cs hs ddedt ddlt rddedt and rdd lt is set to 0 adult females are alive at the start of the simulation and have no eggs life is therefore 1 and both ovigerous and offspring are 0 due to the lack of information on adult female longevity of a dorsalis this model assumes that female longevity does not depend on food concentration and we estimated the adult female longevity of this species based on the effect of temperature on a congener s life span i e a salinus jimenez melero et al 2012 based on data published by jimenez merelo et al 2012 we calibrated the temperature dependent equation using the curve fitting toolbox in matlab r2009b the mathworks company inc the relationship between water temperature t c and longevity meanlgv days is described by the bĕlehrádek 1935 equation fig s4 as meanlgv 51 03 d c t 9 630 c 0 37 bělehrádek equation is commonly used to describe the relationship between temperature and the rate of various metabolic functions or degrees of biological activities yamakawa and matsuda 1997 we used the gdf to represent the individual variability of adult female longevity as in dur et al 2013 this study adopts the method described by souissi 2006 to separate the contribution of an extrinsic factor from the intrinsic variability we combined and normalized data obtained at three temperatures 10 20 and 25 c jiménez melero et al 2012 and fit the gamma models gamcdf x α β in matlab mathworks inc 2016 to estimate the values of α 248 60 and β 0 004 at the beginning of the simulation the mean values and standard deviation of edt lt cs are defined based on the value of food concentration and those of hs based on the value of food concentration and temperature as follow lt and edt become shorter with increasing food concentration tordesillas et al 2018 following tordesillas et al 2016 who described the development time of this species by the bělehrádek 1935 equation we replaced the temperature variable in that equation with a food concentration variable to describe lt and edt in this study fig 2 a b based on the data published by tordesillas et al 2018 we performed a regression analysis using the curve fitting toolbox in matlab mathworks inc 2016 to determine the coefficients with the highest coefficient of determination r2 the relationship between food concentration fc cells ml 1 and mean latency time meanlt days was expressed as meanlt 699 1 d c e l l s m l 1 fc 9 74 10 7 c e l l s m l 1 0 5626 the relationship between food concentration fc cell ml 1 and mean embryonic development time meanedt days was expressed as meanedt 13 24 d c e l l s m l 1 fc 1999 c e l l s m l 1 0 2136 the standard deviation of lt and edt were calculated from the data of tordesillas et al 2018 and were equal to 0 71 days and 0 79 days respectively see table s2 for the derivation method tordesillas et al 2018 could not identify a significant difference in hatching success hs and clutch size cs at the tested food concentrations but noticed an increasing trend for both traits with increasing food concentration in a dorsalis in this study we considered this increasing trend in both parameters fig 2c d the relationship between food concentration fc cells ml 1 and clutch size meancs eggs clutch 1 was expressed using the heip 1974 equation as meancs 5 316 e g g s c e l l s m l 1 f c 0 0513 regarding the hatching success tordesillas et al 2016 reported that the hatching success of a dorsalis decreased with increasing water temperature so we considered the effects of both food concentration and water temperature on the hatching success here data for food concentration and hatching success were parameterized using those published by tordesillas et al 2018 while data for water temperature and hatching success were parameterized using raw unpublished data from tordesillas et al 2016 the relationship between food concentration fc cells ml 1 water temperature t c and hatching success meanhs was expressed as meanhs 2 061 10 4 1 c e l l s m l 1 fc 6 171 1 c t 223 1 the standard deviation of cs and hs were calculated to be 3 37 eggs clutch 1 and 21 79 respectively based on the data by tordesillas et al 2018 see table s2 for the derivation method in this model the number of offspring that hatch from each clutch was expressed as the product of clutch size and hatching success the initial population was set to be 1000 independent adult females this number of individuals was selected after visualization of the stabilization of the mean and variability of the output variables supplementary materials figure s2 the simulation was repeated 15 times under each condition to account for the variability produced by the same set of parameters and initial conditions supplementary materials figure s3 the time step of all the simulations was set to 3 h and the duration to 20 days 2 6 input data to run simulations our model requires data on food concentration and water temperature we computed the monthly phytoplankton density in lake taal from the mean values of chlorophyta density for aquaculture and non aquaculture sites reported in mercurio et al 2016 and we used the monthly water temperature data from querijero and mercurio 2016 and mendoza et al 2019 to estimate monthly average temperature values these input data on phytoplankton density and water temperatures in lake taal are summarized in table s1 2 7 submodels to simulate the reproductive cycle of the females we calibrated the model of dur et al 2009 to a dorsalis the pseudocodes for each task are summarized in table 3 agent a dorsalis female starts the simulation in the state just after reaching maturity age 0 the simulation taking into account the initial age range of females is provided in the supplementary material figure s5 the task test survival calculates the daily survival rate for each individual the simulation time step is 3 h but the survival rate is calculated once each day so this task is performed every 8 time steps for simulation sets where the survival rate is not considered the survival rate is set to be 100 the task define lt and lgv determines the longevity lgv and latency time lt of each individual in this task lgv is defined only once at the start of the simulation and lt is redefined each time the eggs hatch ovigerous and ddlt 0 in this model the mating period is assumed to be part of the lt as described in section 2 4 3 interactions the defined lgv and lt are multiplied by the set water temperature values to calculate ddlgv and rddlt the task accumulate time and energy increases each individual s age ddage age multiplied by water temperature ddedt edt multiplied by water temperature and ddlt by 3 h ddedt increases when a female has eggs ovigerous 1 and ddlt increases when she has no eggs ovigerous 0 when the latency time ends ddlt rddlt the female produces an egg sac and her status defined by the ovigerous attribute changes from ovigerous 0 to ovigerous 1 in the spawn task the same task defines the clutch size cs and hatching success hs which differs for every clutch randomly sorted from a normal distribution with meancs and meanhs related to food concentration and the number of offspring defined as the product of cs and hs although the actual birth of offspring takes place in the next task hatching to simplify the code by using a predefined task in mobidyc the number of offspring is calculated in advance in this task task spawn then resets ddlt and ddedt to 0 sets rddlt to 999 to prevent females from laying eggs during edt and calculates edt and ddedt when the female has an egg sac ovigerous 1 and the edt is completed ddedt rddedt the eggs hatch and the number of offspring calculated earlier is counted as n1n3 the first three molting stages of copepods the female is then returned to the non ovigerous state ovigerous 0 and cs ddedt rddedt and ddlt are reinitialized at 0 these are performed in task hatching finally when the age of the female reaches her longevity ddage ddlgv the live dead status of the individual is set to dead life 0 in task die we could kill the agent in the predefined task in mobidyc but then all records of the individual would be lost and no simulation results would be output so life and death are represented by setting the life attribute to 0 or 1 2 8 simulation experiments simulation set 1 in order to observe the effect of increasing food concentration on egg and nauplii production we tested eight food concentration conditions 2 10 3 4 10 3 8 10 3 16 10 3 32 10 3 64 10 3 128 10 3 and 256 10 3 cells ml 1 the food concentration was kept constant throughout a simulation and after the simulation was completed at that concentration the next concentration was automatically set the water temperature was fixed at 30 c simulation set 2 we tested the effect of female longevity on egg and nauplii production for that purpose we fixed each food concentration and tested three water temperature conditions 26 c 30 c and 34 c temperatures 26 c and 34 c are respectively the minimum and maximum water temperatures in lake taal white and san diego mcglone 2008 papa and mamaril sr 2011 tordesillas et al 2016 simulation set 3 4 using the data on phytoplankton density mercurio et al 2016 and water temperature querijero and mercurio 2016 mendoza et al 2019 obtained from lake taal we estimated a dorsalis monthly egg and offspring production the phytoplankton density and temperature were kept constant throughout a simulation and after the simulation for the month was completed the next conditions were automatically set for simulation set 4 we run the simulation with temperature and food conditions similar to simulation set 3 but changed the adult female survival rate from 100 to 40 in 10 increments 2 9 analysis we used the wilcoxon rank sum wrs test to identify an effect of temperature and the related female longevity on egg and nauplii production simulation set 2 comparing the temperature conditions two by two we used the kruskal wallis test to identify differences among the months simulation sets 3 and 4 we then used dunn sidák ds post hoc test to perform multiple pairwise comparisons of the month means and identify which month is different from the others all statistical analysis were performed with matlab software mathworks inc 2016 the significance level was set at p 0 01 3 results 3 1 effect of increasing food concentration on the egg production dynamics in general a dorsalis shows increased clutch size fecundity and egg production rates at higher food concentrations and produces numerous small and fast growing eggs we found that the maximum total number of eggs produced at the lowest food concentration 0 2 10 4 cells ml 1 was 372 3 eggs and at the highest food concentration 25 6 10 4 cells ml 1 was 760 6 eggs fig 3 a the maximum total number of offspring at the lowest food concentration was 0 nauplii and at the highest food concentration was 658 9 nauplii fig 3b the cumulative egg and offspring production in the 20 day simulation were 9 24 10 4 eggs and 7 59 10 4 nauplii respectively at the highest food concentration fig 3c d compared with cumulative production at the highest food concentration the second highest concentration 12 8 10 4 cells ml 1 reduced egg production by approximately 20 and offspring production by approximately 40 3 2 10 4 cells ml 1 by 55 and 78 respectively and the lowest concentration reduced egg and offspring production by approximately 90 and 100 respectively the shape of the graph became linear for both cumulative egg and offspring production at food concentrations of 3 2 10 4 cells ml 1 and above fig 3c d first spawning occurred 12 h after the start of the simulation at the three highest food concentrations and 13 days at the lowest food concentration fig 3a 3 2 effect of different food concentration on the cumulative production the relation between food concentration and cumulative production resembles a saturation curve and could be described by a michaelis and menten 1913 type equation fig 4 both egg and nauplii cumulative production increase as food concentration increases and tend towards a maximum half of the maximum production is reached for a food concentration of 4 6 10 4 cells ml 1 for eggs and 33 9 10 4 cells ml 1 for nauplii when the food concentration was 39 8 10 4 cells ml 1 the hatching success of the cohort was 100 3 3 effect of female longevity on egg and offspring production when the food concentration was fixed and the water temperature changed to a minimum of 26 c and a maximum of 34 c the productions were significantly different wrs test p 0 01 from those obtained at 30 c except for the lowest concentration fig 5 at the highest food concentration egg and offspring production at 26 c were 7 75 and 22 2 higher than that at 30 c respectively on the other hand at 34 c both egg and offspring production decreased by 6 59 and 29 3 respectively 3 4 monthly egg and offspring production in lake taal egg production showed a similar trend to that of phytoplankton density fluctuations table s1 and offspring production reflected the effect of water temperature on hatching success fig 6 the lowest production was in august egg 0 95 104 eggs offspring 0 45 104 nauplii the lowest production of egg in august was significantly different from that in september november december april and may dunn sidák test p 0 01 the lowest production of nauplii in august was significantly lower than that in november december february march april and may in contrast the highest egg production in may egg 2 9 104 eggs was significantly higher than that in august september october january february and march dunn sidák post hoc test p 0 01 the highest offspring production was observed in november 1 2 104 nauplii which differed significantly from the values in august september and october dunn sidák post hoc test p 0 01 the offspring production in may was not significantly different from that observed from november to april dunn sidák post hoc test p 0 01 3 5 result of adding different survival rates a 10 change in survival rate resulted in an approximate 63 change in egg and offspring production fig 7 egg production in march was 2 2 10 4 eggs at 100 survival but 0 74 10 4 eggs at 90 survival a decrease of 1 46 10 4 eggs this decrease is almost the same as the difference between april fc 1 8 10 4 cells ml 1 t 30 2 c and october fc 0 5 10 4 cells ml 1 t 29 2 c at 100 survival 4 discussion the present study developed a modeling tool to identify the effect of different food concentration on the reproduction of a dorsalis in lake taal here we first defined some food dependent relationships based on the results obtained in the laboratory on a dorsalis females we then implemented those relationships in an ibm representing the reproductive cycle of egg bearing copepods dur et al 2009 the model represents a new approach to defining the minimal food concentration to induce continuous reproduction of a dorsalis and provides a mechanistic understanding of the effect of increasing food concentration on reproduction 4 1 production of a dorsalis the cumulative production of eggs and nauplii was linear at food concentrations above 3 2 104 cells ml 1 fig 3 bottom graphs suggesting that 3 2 104 cells ml 1 is the threshold for stable egg production in this species population this value is not particularly low compared to other copepods according to ban 1994 egg production of eurytemora affinis was limited at a food concentration of 104 cells ml 1 lacoste et al 2001 assumed that the food concentration required to detect the effects of food quality on the reproductive response of calanus helgolandicus is 104 105 cells ml 1 liu et al 2015 state that the minimum amount required by eodiaptomus japonicus is 260 μg c l equivalent to 103 cells ml 1 hence our result revealed that the food use efficiency of a dorsalis is not particularly outstanding nevertheless the food efficiency exhibited by a dorsalis should be compared to native species to confirm or reject the hypothesis of a competitive superiority allowing a dorsalis to invade an environment such as lake taal the alternative hypothesis is that a dorsalis is simply filling the niche left by the absence of other species due to the deterioration in water quality caused by the eutrophication of the lake papa et al 2012a various species of copepods have been reported in the past in lake taal but only thermocyclops crassus has been consistently found in the lake to the present day lopez et al 2017 papa 2011 papa et al 2012b t crassus was predominant over the two calanoid species inhabit in lake taal pseudodiaptomus brehmi and a dorsalis papa et al 2012b and has many characteristics in common with a dorsalis such as suitability for warm and eutrophic conditions strong resistance to predation pressure and similar cs and edt values maier 1989 while many copepods have disappeared from the lake the fact that a species similar to a dorsalis has survived suggests that the temporarily unused niche provided an opportunity for the successful establishment of the invader p brehmi was also found coexisting with a dorsalis in lake taal it has been displaced by a dorsalis from other lakes in the philippines but the depth of lake taal allows the two species to live separately papa et al 2017 4 2 model potential and current limitations water temperature is also an important parameter for copepods as they are ectotherms some calanoid copepods have been observed to shorten their lt and or edt with increasing water temperature dur et al 2009 liu et al 2014 and those of a dorsalis may also be affected by water temperature in the present study production decreased with increasing water temperature due to shorter longevity fig 5 but when effects on lt and edt are considered production may not generally decrease because of the faster reproductive cycle the additional implementation of the effect of temperature on a dorsalis reproductive traits in this model will allow investigation of the combined effects of a positive effect caused by the eutrophication of lake taal associated with aquaculture and a negative effect caused by the increase in lake water temperature due to global warming in the present study due to the lack of appropriate a dorsalis mortality data we simply varied the daily survival rate from 100 to 40 in 10 increments there are four possible mortality indexes food concentration dependent mortality temperature dependent mortality predation mortality and cannibalism mortality it has been observed that mortality up to adulthood decreases with increasing food concentration elmore 1982 and increases with increasing temperature tordesillas et al 2016 in simulation set 3 the highest egg production was observed in may with the highest food concentration but may was also the month with the highest water temperature so if the food concentration water temperature dependent mortality was considered the egg production would be lower than observed here just as the offspring production was affected by the hatching success expressed by the food concentration water temperature dependent equation the year round diet of sardinella tawilis the primary predator of zooplankton in lake taal consists of 58 calanoids most of which are adults of a dorsalis papa et al 2008 2017 however since this species is known to have high escape ability and can reproduce well even under strong predation pressure havens and beaver 2011 the decrease in population size due to predation might be ignored to some extent in addition as females of this species do not engage in cannibalism elmore 1982 the decrease in the number of individuals due to cannibalism could be neglected therefore future improvement of the model should also consider the implementation of the combined food concentration dependent and temperature dependent mortalities at present the model only includes a dorsalis and interactions with other agents such as competition with native species have not been incorporated the implementation of a native species in the model requires data on the effect of temperature and food concentration on the life traits of lake taal s native species these data are currently unavailable and should be acquired to develop a model suited to test a competitive advantage of a dorsalis over native species 5 conclusion compared to experimental investigation our model presents the ability to integrate the effect of different environmental parameters on all reproductive traits as well as individual variability on top of that the model has the potential to aggregate fine scale knowledge and investigate coarser scale phenomena based on the present version of the model other environmental factors such as temperature depth dissolved oxygen dissolved nitrates and phosphates could potentially be incorporated pending the availability of data in this study we only focused on the reproductive traits of adult females of copepod this model aims to determine the optimal condition for reproduction and estimate the loss and gain of change in food concentration ultimately we are aiming to create a model that represents the entire life cycle of a dorsalis the reproductive process constitutes a necessary step in the development of a complete population dynamics model prestige et al 1995 souissi et al 2005 in addition to the previously proposed improvements the perspective of the model is to be included within an already developed population dynamics model integrating all development stages dur et al 2013 this population dynamics model will be an important tool for understanding the invasive abilities of a dorsalis availability of data and materials the mobidyc platform version 2 22 including codes and tutorials is freely available in french and english for non commercial use at https mobidyc cnrs fr index php title english summary the raw data supporting the conclusions of this article will be made available by the authors without undue reservation credit authorship contribution statement amane takahashi data curation formal analysis investigation visualization writing original draft syuhei ban data curation writing review editing rey donne s papa data curation writing review editing dino t tordesillas data curation writing review editing gaël dur conceptualization methodology project administration supervision validation writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the authors thank the reviewers whose comments were used to substantially improve the quality of this paper this work was supported by the research grant from the faculty of science of shizuoka university to gd the mobidyc platform version 2 22 including codes and tutorials is freely available in french and english for non commercial use at https mobidyc cnrs fr index php title english summary the raw data supporting the conclusions of this article will be made available by the authors without undue reservation supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j ecolmodel 2023 110398 appendix supplementary materials image application 1 
24161,arctodiaptomus dorsalis is an invasive calanoid copepod originally from america and has recently established a population in lake taal in the philippines it has been proposed that eutrophication due to aquaculture contributes to the establishment and success of this species this study aimed to clarify this hypothesis by quantifying the effect of increasing food concentration on the reproduction of a dorsalis using an individual based model we parameterized food concentration dependent equations to simulate the effect of different food concentration on the reproductive traits latency time embryonic development time clutch size and hatching success of this species using data from the literature and simulated the reproduction of 1000 independent females for 20 days at different food concentration taking into account the variability among individuals the simulation results showed that the cumulative production of eggs and offspring increased continuously with time when the food concentration was above 3 2 104 cells ml 1 suggesting that this value was the threshold concentration required for stable reproduction of a dorsalis this value is not particularly low compared to other copepods hence our result revealed that the food use efficiency of a dorsalis is not particularly outstanding and urge the need of a comparison with native species to confirm a possible superiority we suggest that a dorsalis has filled the ecological niche left vacant by the disappearance of the original species due to the deterioration of water quality caused by the eutrophication of the lake the reproductive cycle model developed in this study constitutes a necessary step in the development of a complete population dynamics model which can help clarify the invasive abilities of a dorsalis graphical abstract image graphical abstract keywords arctodiaptomus dorsalis invasive copepod lake taal food concentration individual based model data availability data will be made available on request 1 background the rate of biological invasions has increased in recent decades due to increasing global trade and transport keith et al 2013 transoceanic introductions via ship ballast water have particularly increased and contributed to the spread of marine organisms from their native regions to many parts of the world brylinski et al 2012 one such organism is copepods copepods are one of the dominant groups of the zooplankton community in aquatic ecosystems and play a salient role in the food chain linking primary producers phytoplankton and higher trophic levels richardson 2008 they have been suggested as bioindicators because their short life cycle allows the effects of environmental stresses to appear in a short time siokou frangou 1996 hays et al 2005 kwok et al 2015 in particular copepod s abundance and reproductive traits can be a good indicator of their habitat quality de leon et al 2016 a souissi et al 2008 s souissi and souissi 2021 hence their reproduction has been the spotlight of a lot of research e g lacoste et al 2001 devreker et al 2009 jiménez melero et al 2012 liu et al 2015 pan et al 2016 grønning et al 2019 several copepods have invaded new environments through human transport for example pseudodiaptomus forbesi native to the yangtze river in china is found in the san francisco estuary and the columbia snake river system in washington sullivan and kimmerer 2013 and an asian species pseudodiaptomus marinus is found in northern europe brylinski et al 2012 arctodiaptomus dorsalis marsh 1907 the target in this study is also an invasive copepod it is a neotropical freshwater calanoid species originally described as diaptomus dorsalis from lakes near new orleans louisiana and spread its habitat through central america to northern south america reid 2007 in the philippines tuyor and baay 2001 first reported the existence of this species from laguna de bay lake mainit and lake sebu however it had already been recorded from laguna de bay in 1991 in m directo s unpublished report rizo et al 2015 tuyor and baay 2001 suggested that a dorsalis was introduced via the ballast water of ships coming from north america the presence of a dorsalis has now been confirmed in 23 out of 32 researched lakes and rivers in the philippines papa et al 2012a metillo et al 2014 rizo et al 2015 this spread could have been attributed to the transport of cultured fish juveniles to other lakes from major aquaculture sites such as laguna de bay papa et al 2012b rizo et al 2015 lake taal is one of the lakes invaded by a dorsalis it is a caldera lake surrounding the taal volcano located on the island of luzon de leon et al 2016 the aquaculture in fish cages started in 1975 aypa et al 2008 and subsequent excessive feeding led to an increase in nutrients in the lake vista et al 2006 the settlement of the invasive species a dorsalis in lake taal is considered to have been facilitated by this eutrophication papa et al 2012a when food is abundant a dorsalis can adopt a r strategy and produce a large number of small fast developing eggs elmore 1983 reid 2007 previous studies have shown that the copepod s clutch size survival rate elmore 1982 fecundity and egg production rate tordesillas et al 2018 increase as food concentration increases and the inter clutch duration becomes shorter tordesillas et al 2018 also observed this species inability to reproduce when food levels are 4000 cells ml 1 or less besides the hypothesis that the eutrophic environment benefited a dorsalis more than endemic species in terms of reproduction the other hypothesis is that increased algal density displaced endemic species that preferred an oligotrophic mesotrophic environment and provided a niche for invasive species to establish papa et al 2012a tordesillas et al 2018 to date the effects of increased algal density on a dorsalis populations remain largely unclear researching the potential impacts of food concentrations on populations is crucial this is because disruptions in the zooplankton population due to eutrophication induced water quality degradation could have ripple effects on food webs and local ecosystems population models such as individual based models ibms can link individuals to populations using mathematical equations and provide insights into how individual effects observed at different food concentrations can add up to population level effects this study aims to clarify the effect of increasing food concentration on the reproduction of a dorsalis from lake taal for that purpose we developed an ibm on the mobidyc platform ginot et al 2002 that can simulate the reproductive cycle of egg bearing copepods dur et al 2009 for the model calibration we used the results from previous studies that account for the effect of different food concentration on a dorsalis reproduction elmore 1982 tordesillas et al 2016 2018 following the calibration we used the ibm to quantify the effect of a range of food concentration on the reproduction of a cohort of 1000 a dorsalis females and to determine the optimal food concentration for reproduction we then used the model to estimate the egg and nauplii production of a cohort of 1000 independent females along the year in lake taal based on in situ temperature and phytoplankton density 2 materials and methods this model is described according to the odd overview design concepts details protocol as outlined by grimm et al al 2006 2010 2020 the ibm was constructed using the mobidyc platform ginot et al 2002 2 1 purpose and patterns the higher level purpose of this model is to quantify the effect of different food concentration on the recruitment of the invasive egg carrying copepod a dorsalis more specifically the model was designed to quantify the effect of increasing food concentration on reproductive traits of a cohort of 1000 independent females the data required to calibrate the model were obtained from the available literature the verification of the model was based on the satisfaction of the following two patterns 1 at the individual level the time required to produce eggs decreases and clutch size gradually increases as the food concentration increases 2 at the cohort level females consistently produce eggs above a certain food concentration along with this the number of offspring also increases this step cannot be considered true model validation in the strict sense of ecological modeling ideally the model output should be compared with independent observational data but there are no suitable data or previous studies for comparison therefore in the present study we have only confirmed that the model works as intended see supplemental materials figure s1 for model verification we conducted four sets of simulations to 1 estimate the effect of a range of food concentration on the reproduction of a dorsalis at constant water temperature 2 estimate the effects of longevity on a dorsalis reproduction at different water temperatures and fixed food concentration 3 estimate a dorsalis reproduction under constant monthly food concentrations and water temperatures in lake taal 4 estimate the effect of the survival rate on the reproduction estimated in 3 2 2 entities state variables and scales entities in our model refer to a dorsalis adult females each adult female has 16 attributes age longevity lgv embryonic development time edt latency time lt clutch size cs hatching success hs life alive or dead state live or die ovigerous female is having eggs or not offspring ddage ddlgv ddedt ddlt rddedt and rdd lt table 2 embryonic development time edt days is the number of days from spawning to the hatching of a clutch and latency time lt days is the number of days from the hatching to the spawning of the next clutch clutch size cs eggs clutch is the total number of eggs in a particular clutch and hatching success hs is the percentage of successfully hatched nauplii from each clutch these values of edt lt cs and hs possessed by adult females are randomly selected from normal distributions with a mean and standard deviation for each attribute see initialization section in addition the model uses degree days days approach elmessoussi et al 2007 in which the individual requires a certain amount of energy expressed in days to spawn and hatch by multiplying the time required for an organism to reproduce by the water temperature of its environment the effect of temperature variations can be considered when a parameter is multiplied by temperature its name is prefixed with rdd or dd to distinguish it from the original parameters the prefix rdd is an acronym for required degree days and once the state variable is defined it remains unchanged until updated the prefix dd is for state variables with a value that accumulates at each time step for example when ddlt accumulates and reaches the value of rddlt this individual lays eggs for the attribute life life 1 means that the copepod is alive and life 0 means that it is dead the same is true for the state but it is used when calculating survival rates similarly for ovigerous ovigerous 1 means that the individual carries eggs and 0 means that it does not the attribute offspring expressed as the product of cs and hs is used to count the number of nauplii another agent called scientist is used to record of the values of the adult female attributes the model was not spatially explicit the simulation ran with a time step fixed at three hours and lasted 20 days considering that the lifespan of an a dorsalis female at 30 c is around 17 days 2 3 process overview and scheduling 2 3 1 summary the process and scheduling are resumed below and presented as a flowchart fig 1 1 an adult female tests their survival every day 2 on its first time step of life age 0 the adult female s longevity is initialized and it remains constant throughout the simulations 3 the adult female initializes its lt when it is non ovigerous and its ddtl is set to zero each individual randomly draws an lt value from a normal distribution the value of rddlt is also calculated by multiplying the lt by the water temperature 4 the adult female increments their age by one time step i e three hours and the attributes storing energy expressed in degree days i e ddage ddlt and ddedt by one time step temperature 5 test if the lt was reached if the lt is reached ddlt rddlt the adult female spawns this task spawn sets the ovigerous status to 1 calculates a new value of cs edt and rddedt and resets the value of ddlt and ddedt to 0 the values of edt and cs are also randomly drawn from specific normal distributions one for each attribute 6 test if the edt is reached once the edt is reached ddedt rddedt the female releases her eggs in this task hatching the number of offspring is calculated by multiplying cs by hs and the attributes ovigerous cs ddedt rddedt and ddlt are reset to 0 7 a final task of adult female tests if the individual has reached its longevity ddage ddlgv if yes the adult female dies 8 the agent scientist saves the value of the clutch size age of death latency time and embryonic development time of the female at each time step and count the number of offspring produced and kills them 2 3 2 rationale the agent tests its survival first to avoid computing the other tasks when dead the definition of the lt occurs before the accumulation of energy day and time to allow the computation of a new lt for the first clutch and after each hatching process ddlt 0 spawn has to occur before hatching to allow the proper condition and timing for hatching die is the last task of the adult female to allow the hatching of a clutch just before reaching the end of its lifespan finally scientist actions take place at the end of the time step to record the results of all the tasks performed by the adult females during one time step 2 4 design concepts 2 4 1 basic principles the general hypothesis underlying this model design is that the invasion and establishment of a dorsalis in lake taal are due to the eutrophication of the lake caused by aquaculture which has provided this species with a reproductive advantage to quantify this potential advantage the model tested the effect of different food concentration and water temperature on the productivity of this species population by first running the model under increasing food concentrations representing oligotrophic to hypereutrophic conditions and then monthly food concentrations and water temperatures observed in lake taal the behavior of the agent a dorsalis is based on several references that examined the relationships between food concentration and reproduction tordesillas et al 2018 elmore 1982 or water temperature and reproduction tordesillas et al 2016 jimenez merelo et al 2012 2 4 2 emergence the key outcomes of the model are the total production and cumulated production of eggs and offspring by a cohort composed by 1000 independent females these results emerge from the integration of the effects of different food concentration on the reproductive traits of each individual 2 4 3 interactions interactions between individuals were not introduced in the present model we assumed that the mating was implicitly included in latency time since the experiment of tordesillas et al 2018 used to formulate latency time has defined the latency time as the period between the hatching of one clutch of eggs and the spawning of the next clutch males were always present in the petri dish and mating occurred in that period food availability influences the spermatophore production of male copepod bjærke et al 2016 but even at low food concentrations male copepods can maintain a constant spermatophore production over their lifespan burris and dam 2015 additionally many species with eggs sacs such as a dorsalis exhibit high production of small spermatophores that require less investment ceballos and kiørboe 2011 neither the limitations due to mating or spermatophore production nor the failure of egg fertilization was considered here 2 4 4 stochasticity variability in traits among individuals is particularly important for populations experiencing unfavorable or stressful environmental conditions potentially augmenting population persistence and stability and affecting population growth rates richmond et al 2013 latency time lt embryonic development time edt clutch size cs hatching success hs and longevity lgv are stochastically assigned to each female to express individual variability and inter clutch variability lt edt cs and hs are randomly drawn from a normal distribution while lgv is drawn from a gamma distribution gdf the mean and standard deviation of each normal distribution is a food concentration dependent equation hs is a food concentration and temperature dependent equation which was formulated using experimental results from previous studies see the submodels section for the gdf we plotted data obtained from a previous study and fitted the gamma models to estimate the values of α and β the mean value of the gamma distribution used for female longevity was expressed using a temperature dependent equation see the initialization section 2 4 5 observation in the present study our model i saves the value of the clutch size age of death latency time and embryonic development time of the females at each time step and ii counts the number of offspring produced and kills them this procedure allowed total egg and offspring production to be described 2 5 initialization each individual has 16 state variables table 1 the initial value of age was set to 0 days after confirming that the age range of females at the start of the simulation did not affect the results figure s5 the initial value of the copepod s reproductive parameters edt lt cs hs ddedt ddlt rddedt and rdd lt is set to 0 adult females are alive at the start of the simulation and have no eggs life is therefore 1 and both ovigerous and offspring are 0 due to the lack of information on adult female longevity of a dorsalis this model assumes that female longevity does not depend on food concentration and we estimated the adult female longevity of this species based on the effect of temperature on a congener s life span i e a salinus jimenez melero et al 2012 based on data published by jimenez merelo et al 2012 we calibrated the temperature dependent equation using the curve fitting toolbox in matlab r2009b the mathworks company inc the relationship between water temperature t c and longevity meanlgv days is described by the bĕlehrádek 1935 equation fig s4 as meanlgv 51 03 d c t 9 630 c 0 37 bělehrádek equation is commonly used to describe the relationship between temperature and the rate of various metabolic functions or degrees of biological activities yamakawa and matsuda 1997 we used the gdf to represent the individual variability of adult female longevity as in dur et al 2013 this study adopts the method described by souissi 2006 to separate the contribution of an extrinsic factor from the intrinsic variability we combined and normalized data obtained at three temperatures 10 20 and 25 c jiménez melero et al 2012 and fit the gamma models gamcdf x α β in matlab mathworks inc 2016 to estimate the values of α 248 60 and β 0 004 at the beginning of the simulation the mean values and standard deviation of edt lt cs are defined based on the value of food concentration and those of hs based on the value of food concentration and temperature as follow lt and edt become shorter with increasing food concentration tordesillas et al 2018 following tordesillas et al 2016 who described the development time of this species by the bělehrádek 1935 equation we replaced the temperature variable in that equation with a food concentration variable to describe lt and edt in this study fig 2 a b based on the data published by tordesillas et al 2018 we performed a regression analysis using the curve fitting toolbox in matlab mathworks inc 2016 to determine the coefficients with the highest coefficient of determination r2 the relationship between food concentration fc cells ml 1 and mean latency time meanlt days was expressed as meanlt 699 1 d c e l l s m l 1 fc 9 74 10 7 c e l l s m l 1 0 5626 the relationship between food concentration fc cell ml 1 and mean embryonic development time meanedt days was expressed as meanedt 13 24 d c e l l s m l 1 fc 1999 c e l l s m l 1 0 2136 the standard deviation of lt and edt were calculated from the data of tordesillas et al 2018 and were equal to 0 71 days and 0 79 days respectively see table s2 for the derivation method tordesillas et al 2018 could not identify a significant difference in hatching success hs and clutch size cs at the tested food concentrations but noticed an increasing trend for both traits with increasing food concentration in a dorsalis in this study we considered this increasing trend in both parameters fig 2c d the relationship between food concentration fc cells ml 1 and clutch size meancs eggs clutch 1 was expressed using the heip 1974 equation as meancs 5 316 e g g s c e l l s m l 1 f c 0 0513 regarding the hatching success tordesillas et al 2016 reported that the hatching success of a dorsalis decreased with increasing water temperature so we considered the effects of both food concentration and water temperature on the hatching success here data for food concentration and hatching success were parameterized using those published by tordesillas et al 2018 while data for water temperature and hatching success were parameterized using raw unpublished data from tordesillas et al 2016 the relationship between food concentration fc cells ml 1 water temperature t c and hatching success meanhs was expressed as meanhs 2 061 10 4 1 c e l l s m l 1 fc 6 171 1 c t 223 1 the standard deviation of cs and hs were calculated to be 3 37 eggs clutch 1 and 21 79 respectively based on the data by tordesillas et al 2018 see table s2 for the derivation method in this model the number of offspring that hatch from each clutch was expressed as the product of clutch size and hatching success the initial population was set to be 1000 independent adult females this number of individuals was selected after visualization of the stabilization of the mean and variability of the output variables supplementary materials figure s2 the simulation was repeated 15 times under each condition to account for the variability produced by the same set of parameters and initial conditions supplementary materials figure s3 the time step of all the simulations was set to 3 h and the duration to 20 days 2 6 input data to run simulations our model requires data on food concentration and water temperature we computed the monthly phytoplankton density in lake taal from the mean values of chlorophyta density for aquaculture and non aquaculture sites reported in mercurio et al 2016 and we used the monthly water temperature data from querijero and mercurio 2016 and mendoza et al 2019 to estimate monthly average temperature values these input data on phytoplankton density and water temperatures in lake taal are summarized in table s1 2 7 submodels to simulate the reproductive cycle of the females we calibrated the model of dur et al 2009 to a dorsalis the pseudocodes for each task are summarized in table 3 agent a dorsalis female starts the simulation in the state just after reaching maturity age 0 the simulation taking into account the initial age range of females is provided in the supplementary material figure s5 the task test survival calculates the daily survival rate for each individual the simulation time step is 3 h but the survival rate is calculated once each day so this task is performed every 8 time steps for simulation sets where the survival rate is not considered the survival rate is set to be 100 the task define lt and lgv determines the longevity lgv and latency time lt of each individual in this task lgv is defined only once at the start of the simulation and lt is redefined each time the eggs hatch ovigerous and ddlt 0 in this model the mating period is assumed to be part of the lt as described in section 2 4 3 interactions the defined lgv and lt are multiplied by the set water temperature values to calculate ddlgv and rddlt the task accumulate time and energy increases each individual s age ddage age multiplied by water temperature ddedt edt multiplied by water temperature and ddlt by 3 h ddedt increases when a female has eggs ovigerous 1 and ddlt increases when she has no eggs ovigerous 0 when the latency time ends ddlt rddlt the female produces an egg sac and her status defined by the ovigerous attribute changes from ovigerous 0 to ovigerous 1 in the spawn task the same task defines the clutch size cs and hatching success hs which differs for every clutch randomly sorted from a normal distribution with meancs and meanhs related to food concentration and the number of offspring defined as the product of cs and hs although the actual birth of offspring takes place in the next task hatching to simplify the code by using a predefined task in mobidyc the number of offspring is calculated in advance in this task task spawn then resets ddlt and ddedt to 0 sets rddlt to 999 to prevent females from laying eggs during edt and calculates edt and ddedt when the female has an egg sac ovigerous 1 and the edt is completed ddedt rddedt the eggs hatch and the number of offspring calculated earlier is counted as n1n3 the first three molting stages of copepods the female is then returned to the non ovigerous state ovigerous 0 and cs ddedt rddedt and ddlt are reinitialized at 0 these are performed in task hatching finally when the age of the female reaches her longevity ddage ddlgv the live dead status of the individual is set to dead life 0 in task die we could kill the agent in the predefined task in mobidyc but then all records of the individual would be lost and no simulation results would be output so life and death are represented by setting the life attribute to 0 or 1 2 8 simulation experiments simulation set 1 in order to observe the effect of increasing food concentration on egg and nauplii production we tested eight food concentration conditions 2 10 3 4 10 3 8 10 3 16 10 3 32 10 3 64 10 3 128 10 3 and 256 10 3 cells ml 1 the food concentration was kept constant throughout a simulation and after the simulation was completed at that concentration the next concentration was automatically set the water temperature was fixed at 30 c simulation set 2 we tested the effect of female longevity on egg and nauplii production for that purpose we fixed each food concentration and tested three water temperature conditions 26 c 30 c and 34 c temperatures 26 c and 34 c are respectively the minimum and maximum water temperatures in lake taal white and san diego mcglone 2008 papa and mamaril sr 2011 tordesillas et al 2016 simulation set 3 4 using the data on phytoplankton density mercurio et al 2016 and water temperature querijero and mercurio 2016 mendoza et al 2019 obtained from lake taal we estimated a dorsalis monthly egg and offspring production the phytoplankton density and temperature were kept constant throughout a simulation and after the simulation for the month was completed the next conditions were automatically set for simulation set 4 we run the simulation with temperature and food conditions similar to simulation set 3 but changed the adult female survival rate from 100 to 40 in 10 increments 2 9 analysis we used the wilcoxon rank sum wrs test to identify an effect of temperature and the related female longevity on egg and nauplii production simulation set 2 comparing the temperature conditions two by two we used the kruskal wallis test to identify differences among the months simulation sets 3 and 4 we then used dunn sidák ds post hoc test to perform multiple pairwise comparisons of the month means and identify which month is different from the others all statistical analysis were performed with matlab software mathworks inc 2016 the significance level was set at p 0 01 3 results 3 1 effect of increasing food concentration on the egg production dynamics in general a dorsalis shows increased clutch size fecundity and egg production rates at higher food concentrations and produces numerous small and fast growing eggs we found that the maximum total number of eggs produced at the lowest food concentration 0 2 10 4 cells ml 1 was 372 3 eggs and at the highest food concentration 25 6 10 4 cells ml 1 was 760 6 eggs fig 3 a the maximum total number of offspring at the lowest food concentration was 0 nauplii and at the highest food concentration was 658 9 nauplii fig 3b the cumulative egg and offspring production in the 20 day simulation were 9 24 10 4 eggs and 7 59 10 4 nauplii respectively at the highest food concentration fig 3c d compared with cumulative production at the highest food concentration the second highest concentration 12 8 10 4 cells ml 1 reduced egg production by approximately 20 and offspring production by approximately 40 3 2 10 4 cells ml 1 by 55 and 78 respectively and the lowest concentration reduced egg and offspring production by approximately 90 and 100 respectively the shape of the graph became linear for both cumulative egg and offspring production at food concentrations of 3 2 10 4 cells ml 1 and above fig 3c d first spawning occurred 12 h after the start of the simulation at the three highest food concentrations and 13 days at the lowest food concentration fig 3a 3 2 effect of different food concentration on the cumulative production the relation between food concentration and cumulative production resembles a saturation curve and could be described by a michaelis and menten 1913 type equation fig 4 both egg and nauplii cumulative production increase as food concentration increases and tend towards a maximum half of the maximum production is reached for a food concentration of 4 6 10 4 cells ml 1 for eggs and 33 9 10 4 cells ml 1 for nauplii when the food concentration was 39 8 10 4 cells ml 1 the hatching success of the cohort was 100 3 3 effect of female longevity on egg and offspring production when the food concentration was fixed and the water temperature changed to a minimum of 26 c and a maximum of 34 c the productions were significantly different wrs test p 0 01 from those obtained at 30 c except for the lowest concentration fig 5 at the highest food concentration egg and offspring production at 26 c were 7 75 and 22 2 higher than that at 30 c respectively on the other hand at 34 c both egg and offspring production decreased by 6 59 and 29 3 respectively 3 4 monthly egg and offspring production in lake taal egg production showed a similar trend to that of phytoplankton density fluctuations table s1 and offspring production reflected the effect of water temperature on hatching success fig 6 the lowest production was in august egg 0 95 104 eggs offspring 0 45 104 nauplii the lowest production of egg in august was significantly different from that in september november december april and may dunn sidák test p 0 01 the lowest production of nauplii in august was significantly lower than that in november december february march april and may in contrast the highest egg production in may egg 2 9 104 eggs was significantly higher than that in august september october january february and march dunn sidák post hoc test p 0 01 the highest offspring production was observed in november 1 2 104 nauplii which differed significantly from the values in august september and october dunn sidák post hoc test p 0 01 the offspring production in may was not significantly different from that observed from november to april dunn sidák post hoc test p 0 01 3 5 result of adding different survival rates a 10 change in survival rate resulted in an approximate 63 change in egg and offspring production fig 7 egg production in march was 2 2 10 4 eggs at 100 survival but 0 74 10 4 eggs at 90 survival a decrease of 1 46 10 4 eggs this decrease is almost the same as the difference between april fc 1 8 10 4 cells ml 1 t 30 2 c and october fc 0 5 10 4 cells ml 1 t 29 2 c at 100 survival 4 discussion the present study developed a modeling tool to identify the effect of different food concentration on the reproduction of a dorsalis in lake taal here we first defined some food dependent relationships based on the results obtained in the laboratory on a dorsalis females we then implemented those relationships in an ibm representing the reproductive cycle of egg bearing copepods dur et al 2009 the model represents a new approach to defining the minimal food concentration to induce continuous reproduction of a dorsalis and provides a mechanistic understanding of the effect of increasing food concentration on reproduction 4 1 production of a dorsalis the cumulative production of eggs and nauplii was linear at food concentrations above 3 2 104 cells ml 1 fig 3 bottom graphs suggesting that 3 2 104 cells ml 1 is the threshold for stable egg production in this species population this value is not particularly low compared to other copepods according to ban 1994 egg production of eurytemora affinis was limited at a food concentration of 104 cells ml 1 lacoste et al 2001 assumed that the food concentration required to detect the effects of food quality on the reproductive response of calanus helgolandicus is 104 105 cells ml 1 liu et al 2015 state that the minimum amount required by eodiaptomus japonicus is 260 μg c l equivalent to 103 cells ml 1 hence our result revealed that the food use efficiency of a dorsalis is not particularly outstanding nevertheless the food efficiency exhibited by a dorsalis should be compared to native species to confirm or reject the hypothesis of a competitive superiority allowing a dorsalis to invade an environment such as lake taal the alternative hypothesis is that a dorsalis is simply filling the niche left by the absence of other species due to the deterioration in water quality caused by the eutrophication of the lake papa et al 2012a various species of copepods have been reported in the past in lake taal but only thermocyclops crassus has been consistently found in the lake to the present day lopez et al 2017 papa 2011 papa et al 2012b t crassus was predominant over the two calanoid species inhabit in lake taal pseudodiaptomus brehmi and a dorsalis papa et al 2012b and has many characteristics in common with a dorsalis such as suitability for warm and eutrophic conditions strong resistance to predation pressure and similar cs and edt values maier 1989 while many copepods have disappeared from the lake the fact that a species similar to a dorsalis has survived suggests that the temporarily unused niche provided an opportunity for the successful establishment of the invader p brehmi was also found coexisting with a dorsalis in lake taal it has been displaced by a dorsalis from other lakes in the philippines but the depth of lake taal allows the two species to live separately papa et al 2017 4 2 model potential and current limitations water temperature is also an important parameter for copepods as they are ectotherms some calanoid copepods have been observed to shorten their lt and or edt with increasing water temperature dur et al 2009 liu et al 2014 and those of a dorsalis may also be affected by water temperature in the present study production decreased with increasing water temperature due to shorter longevity fig 5 but when effects on lt and edt are considered production may not generally decrease because of the faster reproductive cycle the additional implementation of the effect of temperature on a dorsalis reproductive traits in this model will allow investigation of the combined effects of a positive effect caused by the eutrophication of lake taal associated with aquaculture and a negative effect caused by the increase in lake water temperature due to global warming in the present study due to the lack of appropriate a dorsalis mortality data we simply varied the daily survival rate from 100 to 40 in 10 increments there are four possible mortality indexes food concentration dependent mortality temperature dependent mortality predation mortality and cannibalism mortality it has been observed that mortality up to adulthood decreases with increasing food concentration elmore 1982 and increases with increasing temperature tordesillas et al 2016 in simulation set 3 the highest egg production was observed in may with the highest food concentration but may was also the month with the highest water temperature so if the food concentration water temperature dependent mortality was considered the egg production would be lower than observed here just as the offspring production was affected by the hatching success expressed by the food concentration water temperature dependent equation the year round diet of sardinella tawilis the primary predator of zooplankton in lake taal consists of 58 calanoids most of which are adults of a dorsalis papa et al 2008 2017 however since this species is known to have high escape ability and can reproduce well even under strong predation pressure havens and beaver 2011 the decrease in population size due to predation might be ignored to some extent in addition as females of this species do not engage in cannibalism elmore 1982 the decrease in the number of individuals due to cannibalism could be neglected therefore future improvement of the model should also consider the implementation of the combined food concentration dependent and temperature dependent mortalities at present the model only includes a dorsalis and interactions with other agents such as competition with native species have not been incorporated the implementation of a native species in the model requires data on the effect of temperature and food concentration on the life traits of lake taal s native species these data are currently unavailable and should be acquired to develop a model suited to test a competitive advantage of a dorsalis over native species 5 conclusion compared to experimental investigation our model presents the ability to integrate the effect of different environmental parameters on all reproductive traits as well as individual variability on top of that the model has the potential to aggregate fine scale knowledge and investigate coarser scale phenomena based on the present version of the model other environmental factors such as temperature depth dissolved oxygen dissolved nitrates and phosphates could potentially be incorporated pending the availability of data in this study we only focused on the reproductive traits of adult females of copepod this model aims to determine the optimal condition for reproduction and estimate the loss and gain of change in food concentration ultimately we are aiming to create a model that represents the entire life cycle of a dorsalis the reproductive process constitutes a necessary step in the development of a complete population dynamics model prestige et al 1995 souissi et al 2005 in addition to the previously proposed improvements the perspective of the model is to be included within an already developed population dynamics model integrating all development stages dur et al 2013 this population dynamics model will be an important tool for understanding the invasive abilities of a dorsalis availability of data and materials the mobidyc platform version 2 22 including codes and tutorials is freely available in french and english for non commercial use at https mobidyc cnrs fr index php title english summary the raw data supporting the conclusions of this article will be made available by the authors without undue reservation credit authorship contribution statement amane takahashi data curation formal analysis investigation visualization writing original draft syuhei ban data curation writing review editing rey donne s papa data curation writing review editing dino t tordesillas data curation writing review editing gaël dur conceptualization methodology project administration supervision validation writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the authors thank the reviewers whose comments were used to substantially improve the quality of this paper this work was supported by the research grant from the faculty of science of shizuoka university to gd the mobidyc platform version 2 22 including codes and tutorials is freely available in french and english for non commercial use at https mobidyc cnrs fr index php title english summary the raw data supporting the conclusions of this article will be made available by the authors without undue reservation supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j ecolmodel 2023 110398 appendix supplementary materials image application 1 
24162,land use change luc has gained attention as a core topic of global ecological environment change research the cellular automata ca model affects the global layout through local changes and is widely used in luc however most previous studies are based on the assumption of the markov model which ignores the temporal dependency of luc in addition most researchers have used the identical transition rules when simulating luc variation across a region ignoring the spatial heterogeneity in luc studies accordingly we propose a novel ca model integrating k means convolutional neural networks cnn and long short term memory neural networks lstm to solve temporal dependency and spatial heterogeneity named k means cnn lstm ca kcl ca first in order to resolve spatial heterogeneity we divided the study area into homogeneous sub regions using k means clustering algorithm we then extracted multi year spatial neighbourhood features and assigned weights with gaussian functions according to the time sequence order to realise the fusion of multi year features lstm was used to extract the spatio temporal dependency features of historical land use data and to calculate the transition probability maps for sub regions finally ca generated the dynamic simulation results for the whole region the kcl ca model was validated based on data collected in hangzhou from 1995 to 2020 traditional logistic regression lr ca and artificial neural network ann ca were used for comparison comparing the traditional model with the results shows that the proposed kcl ca model improves the fom index by 9 86 19 43 considering the temporal dependency the fom index increased by 0 98 3 51 when considering spatial heterogeneity the fom index increased by 1 08 5 15 kcl ca can deal with the temporal dependency of spatial heterogeneity in urban land expansion simulations and can effectively predict future urban expansion the simulation results can effectively monitor the future trend of urban luc and help to provide policy support for urban planning and management for decision makers keywords cellular automata land use change spatio temporal dependency deep learning urbanisation spatial partitioning data availability the authors do not have permission to share data 1 introduction land use change luc is a prominent manifestation of human nature interactions lyu et al 2019 mwabumba et al 2022 rapid urbanisation will lead to a series of ecological problems including agricultural and grazing land loss and soil pollution sönmez et al 2016 wu et al 2021 ahmadi sani et al 2022 truong et al 2022 sourn et al 2022 with the acceleration of urbanisation researchers have paid more attention to urban luc accurate modelling and prediction of the change process of land use has become an urgent matter while it can effectively provide reference for ecological issues such as soil degradation and climate change thus achieving sustainable development of land resources akram et al 2018 turan et al 2019 2022 fahad et al 2019 urban spatial modelling is an important tool for resource managers ecological economists and planners and is highly significant for the future development orientation of regions and urban planning sun et al 2018 therefore researchers are making greater try to analyse patterns of luc and disciplines for decision planning in recent years series of methods have been proposed for dynamic luc modelling including statistical methods agent based models markov chains system dynamics models and cellular automata ca models bahmani et al 2021 noszczyk 2018 ren et al 2019 takamatsu et al 2014 ca models have been widely used in luc simulations because of their powerful spatial modelling computational capabilities shafizadeh moghadam 2019 truong et al 2022 yao et al 2017 the determination of the transition rules plays a decisive role in the exactitude of the luc model however ca models only consider the interactions among cells ignoring the influence of the driving forces which makes the simulated results difficult to interpret barreira gonzález et al 2015 feng and tong 2017 vani and prasad 2022 therefore ca models are often combined with methods such as machine learning to perform luc simulations logistic regression lr is the most common approach for optimising the weights of drivers guan et al 2019 wang et al 2019 however it is difficult to accurately simulate urban expansion as lr only extracts linear rules subsequently artificial intelligence algorithms including artificial neural networks ann support vector machines svm and random forests rf gounaridis et al 2019 karimi et al 2019 li et al 2022 liang et al 2021 mustafa et al 2018 zhang et al 2020 have been applied in urban luc simulations in combination with ca owing to their good extraction of non linear features however luc is a long term process with clear temporal and spatial heterogeneity there are two major issues involved in the modelling and prediction of dynamic future luc trends 1 effectively dividing the study area into homogeneous sub areas to resolve spatial heterogeneity and 2 simultaneously considering the impact of temporal dependency and neighbourhood effects on luc first lucs are spatially heterogeneous different regions in the same area have different regional development rates and probabilities owing to the different levels of urbanisation currently most studies tend to use the same transition rules to predict future land use in the whole region which inevitably leads to spatial heterogeneity qian et al 2020 therefore using the same transition rules for the whole region will affect the prediction results and dividing the entire region into several homogeneous sub areas plays an important role in reasonable luc prediction second the neighbourhood effect is also an important factor to be considered in luc simulations barreira gonzález and barros 2017 for instance the non built up land is unlikely to be transformed into the built up one when most of the neighbouring land use cells remain undeveloped the neighbourhood effect between cells is determined by land use type owing to spatial heterogeneity a single neighbourhood feature cannot provide sufficient support for the prediction results capturing potential luc features has an important impact on improving the reliability of predictions luc is a long term process and the expansion process of the historical period will affect the simulation results wang et al 2021 previous studies have always been based on the markov assumption the state at the next time step is only related to the state at the previous time step and the land use data used for research are always sparse which cannot effectively express the long term temporal dependency of land use change li et al 2021 wang and zheng 2022 to address the temporal dependency and spatial heterogeneity of the luc process researchers have begun to integrate deep learning techniques into ca models a long short term memory neural network lstm is a recurrent neural network rnn that can learn time series historical information liu et al 2021 attempted to deal with the temporal dependency based on the lstm ca model which effectively improved the simulation accuracy but did not consider the spatial heterogeneity of luc zhai et al 2020 used cnn to extract spatial features to address the issue of spatial heterogeneity between neighbourhoods while ignoring the temporal dependency of the luc process therefore some researchers have attempted to looking at both the spatial heterogeneity and temporal dependency of the luc process by combining cnn and lstm however the use of cnn to extract spatial features based on a single year land use map results in an insufficient number of spatial features and limited model simulation accuracy liu et al 2021 the spatial heterogeneity and time dependence of neighbourhoods are considered in the above mentioned model but the spatial heterogeneity of the study area is often not considered thus the simulation accuracy can be further improved guo et al 2020 used a combination of multilayer perception mlp markov models and zoning techniques to consider the spatial heterogeneity of different regions though the temporal dependency is not completely accounted for from this we propose a novel ca model that couples geographic partitioning using k means with cnn lstm kcl ca kcl ca adopts a partitioning strategy with the k means to generate several relatively homogeneous sub regions napoleon and pavalakodi 2011 zhou et al 2022 a cnn was adopted to carry out a two dimensional convolution of the time series land use maps and weighted fusion was performed according to a gaussian function to capture the potential spatial features furthermore taking the driving factors neighbourhoods and learned spatial features as input a long short term memory lstm ca model was used in every homogeneous sub region to simulate land use change over the entire study area in addition the traditional lr ca ann ca cnn ca and lstm ca models used as control variables for comparison were developed on the same test data to assess the performance of the kcl ca the main research contents of this paper are as follows 1 we propose a kcl ca model that can handle spatial and temporal dependency for luc simulation 2 we employed a simpler and more popular k means clustering algorithm to deal with the spatial heterogeneity by partitioning the study area to homogeneous sub regions 3 we used the cnn lstm to extract time series spatial features from and the temporal dependency the remainder of this paper is organised as follows section 2 shows the components framework and detailed parameters of the developed kcl ca model section 3 describes the driving factors used and study area in this study section 4 analyses the experimental results and compares the models using the control variable method to verify the advantages of the new model section 5 concludes the study and offers an outlook for future research 2 methodology the kcl ca model proposed in this study consists of three modules fig 1 geospatial partition feature extraction and ca prediction the geographic partitioning module divides the study area to a number of homogeneous sub regions based on k means which has been discussed in detail in section 2 1 1 the cnn is utilised to extract spatial features by convolution of time series land use maps which has been described in section 2 1 2 the extracted spatial features slope elevation and other driving factors are input into the lstm model to train the development probability map of each sub region further details are presented in section 2 1 3 finally by integrating the constraints neighbourhood factors and stochastic factors with ca the simulation results were obtained which are further presented in section 2 2 the evaluation metrics for the experimental results are presented in section 2 3 2 1 introduction of kcl ca model 2 1 1 partitioning strategy based on k means within the luc process unbalanced urban development rates are common phenomena among regions and the geographical partitioning of the study area is usually used to deal with spatial heterogeneity chen et al 2022 qian et al 2020 as the most popular and simple partitioning algorithm we applied k means to divide the study area into homogeneous sub regions in accordance with the principles of mutual exclusivity and rationality of partitioning the pre experiment partitions the study area based on townships streets and grids township street based geographic zoning is affected by administrative regions and cannot fully account for spatial heterogeneity and dependency the study area was finally divided into 5 km2 grids for the given observation x x i i 1 2 each grid has m dimensional attributes and all grids are separated into k clusters c c k k 1 2 k the purpose of k means is aggregate all grid objects to specified k class clusters according to the similitude between objects and every object be part of only one class cluster whose distance from the centre of the class cluster is the smallest assuming that v k is the mean of cluster c k the euclidean distance between v k and all the points belonging to c k is defined as follows 1 d c k x i c k x i v k 2 as a result of k means we are able to solve the optimal problem for all k clusters in the following 2 c k mi n k k 1 k x i c k x i v k 2 by initialising k cluster centres the distance from each object to each cluster centre was successively compared and the objects were assigned to the cluster with the closest cluster centre in order to generate and modify the partition the new centroid for each cluster and the new euclidean distance between each centroid and each point are calculated the process ends when a cluster member is stable or conditionally terminated 2 1 2 fusion spatial feature extraction based on convolutional neural network urban land use change has a spatial temporal dependency and the potential spatial features in each sub region will have an impact on the final outcome aburas et al 2016 most studies at this stage extract features by convolution for a particular year of land use map xing et al 2020 which is not sufficient to capture the temporal dependency of time series historical land use data therefore in our study a 2d cnn was conducted based on the muti year land use maps separately to obtain a set of temporal potential spatial feature data the computing formula for the 2d cnn is given by eq 3 3 z a b l f m i 0 g j 0 k w i j l m x a i b j i 1 m b l here z a b l denotes the output at the current position g is the height of the convolution kernel k is the width of the convolution kernel m denotes the feature maps number in layer l 1 w i j l m denotes the value at the current position f is the activation function and b l denotes bias to make the convolutional filter fully pick up the spatial features of the land use maps the cnn structure in this study used only the convolutional and fully connected layers with a channel number of 1 the cnn model applied a 3 3 convolutional kernel the input layer of the cnn is time series land use maps while the first convolutional layer employs 64 3 3 convolutional kernels the second convolutional layer is parameterised by 128 3 3 the third layer is fully connected and incorporates dropout to prevent overfitting and the output layer is the latent spatial feature that we capture for use as drivers the specific framework of the cnn model is explained in fig 2 considering that using the time series spatial features as one of the driving factors will greatly increase the amount of calculation and it is hard to realize the expected calculation effect the convolutional time series feature maps were weighted and fused in this study our study refers to the improved maximum weighted voting method for assigning weights to the obtained time series latent space feature maps the core idea is that spatial features that are closer to the research year are distributed greater weights in our study the research year is 2020 the time interval between 2015 and 2020 is the shortest the weight is the largest the data in 2010 is the second and so on let h 1 h 2 h n be a time series potential spatial feature maps β 1 β 2 β n donate the weight corresponding to the former then there are fused space features h as in eq 4 4 h β 1 h 1 β 2 h 2 β n h n according to the weight order determined above each weight value is approximately subject to a normal distribution and the sum of each weight value is 1 thereby obtaining the weights as shown in eqs 5 and 6 5 β 1 β 2 β n 1 6 f β 1 2 π σ exp β μ 2 2 σ 2 here μ σ are the position and scale parameters respectively 2 1 3 the lstm neural network model the lstm is a variant of a recurrent neural network rnn that can effectively deal with long term time dependant problems and has wide applications in the fields of air quality index prediction zhang et al 2021 and multi task learning sentiment classification jin et al 2020 in this study the long term urban luc map is a large scale time series and lstm has a good effect on learning the temporal dependency in the series xing et al 2020 as shown in fig 3 each unit of the lstm model include an input gate output gate and oblivion gate the main working principles are as follows 1 when connecting the information of the previous and present time steps the forget gate accepts the connection result and uses the sigmoid activation function to remap thereby deleting redundant data in a targeted manner 2 the input gate receives the connection result in step 1 uses the activation function again to store the data and passes it to the tanh function and outputs the data to be stored to calculate the new storage unit 3 finally the output gate determines the hidden state of the next time and the tanh function mapping determines which data are selected to be passed down as shown in eqs 7 12 7 f t s i g m o i d w f h t 1 x t b f 8 i t s i g m o i d w i h t 1 x t b i 9 o t s i g m o i d w o h t 1 x t b o 10 c t t a n h w c h t 1 x t b c 11 c t f t c t 1 i t c t 12 h t o t tanh c t here w denotes the weight matrix b denotes the bias f t i t o t denote the forget input and output gates respectively x t represents the status of the current time step cell h t 1 represents the hidden status of the previous time step h t is the hidden status of the current time step c t 1 is the storage unit of the previous time step and c t is the storage unit for the current time step in this study lstm incorporates all previously available information trains the entire model and makes predictions for training lstm employs driving factors and time series urban land use maps as the input data the terminating year land use map as the output and randomly selects 5 of the data as the training set zhang and xia 2022 the lstm structure consists of two lstm layers with loop kernels of 64 and 96 the first layer performs output at each time step and the second layer only accepts output at the last time step in the fully connected layer dropout was set to 0 2 to prevent overfitting tanh was chosen as the activation function classical mean square error was selected for the loss function and adaptive moment estimation adam was chosen as the optimiser finally a neural network was used to calculate the development probability of the cell 2 2 integration of fusion model and cellular automata the predicted probability of each cell was calculated by the lstm network and the predicted probability map was used as one of the inputs of the cellular automaton to simulate and predict future land use the status of the next cell t 1 was determined by the transition rule at time t when the transition probability of a cell is greater than a predefined threshold at 0 1 the cell type is converted the development probability of the traditional cellular automata model at time t 1 is shown in eq 13 13 p i j t 1 s i j t y i j t l i j t r where p i j t 1 denotes the probability of exploitation of the cell at position i j at moment t 1 s i j t denotes the transition probability calculated by the fused lstm model for the cell at position i j at moment t 1 y i j t denotes the constraints on the cell at location i j at moment t 1 such as policy factors and water constraints l i j t denotes the constraints on the cell at location i j at moment t 1 such as policy factors and water constraints l i j t denotes the neighbourhood effect of the cell at position i j at moment t 1 and r denotes the random perturbation owing to random factors 2 3 model evaluation to assess the function of the developed model we employed overall accuracy oa kappa coefficient and figure of merit fom index the equations are as follows 14 17 14 oa t p t n t p t n f p f n tp represents the cells that are actually converted into correct cells by prediction transformation fp represents the cells that are not transformed by prediction transformation tn represents the cells that are not transformed by prediction and are not transformed and fn represents the cells that are not transformed by prediction and are actually transformed 15 p e a 1 b 1 a 2 b 2 a n b n n 2 16 kappa p o p e 1 p e where p o denotes the sum of correctly classified samples per class divided by the number of samples a 1 a 2 a n denotes the true number of samples per category b 1 b 2 b n denotes the true number of samples per category b 1 b 2 b n denotes the number of predictions for each category of samples and n is the total number of samples 17 fom b a b c d the number a represents the number of cells that are predicted to change during observation but did not change during b is the number of cells that correctly changed both in the simulation and observation c denotes the number of cells that incorrectly changed both in the simulation and observation and d denotes the number of cells that changed in the simulation but not in the observation 3 study area and datasets hangzhou is located in the middle and lower reaches of the yangtze river and is the political economic and cultural centre of zhejiang province hangzhou is a major city in the yangtze river delta from 1995 to 2020 the resident population of the city increased from 1 8 to 11 936 million and the city s regional gdp increased from 80 billion yuan to 1 61 trillion yuan over the last decade hangzhou s urban land area has grown rapidly because of its location and policy support nine districts of hangzhou shangcheng gongshu binjiang xiaoshan xihu yuhang linping qiantang and fuyang with a total area of 4876 km² were selected for the study fig 4 the remaining parts of hangzhou lin an tonglu jiande and chun an were not included in the study due to their geographical location being far from the centre of hangzhou the high proportion of mountains and water areas within their jurisdiction and the small proportion of urban land 3 1 land use maps time series land use maps of hangzhou were extracted based on remote sensing images of landsat4 5 tm from 1995 landsat 7 etm from 2000 landsat 5 tm from 2005 to 2010 and landsat 8 oli 30 30 m from 2015 to 2020 pre processing including geometric alignment atmospheric correction radiometric calibration and image cropping of remote sensing images in different periods was realised using the envi software in order to conduct the supervised classification published land cover data was used as well as historical images of google earth interpreted visually and referring to the resource and environmental science data center s classification system for land use monitoring six categories as arable forest grass water built up and unused land were selected a total of 85 classification accuracy and 80 kappa coefficient were achieved after supervised classification and post classification processing as shown in fig 5 arable land is decreasing annually while built up land is expanding rapidly 3 2 driving factors referring to previous luc studies we selected four major types of driving factors transportation network public facilities geographical environment and potential spatial features extracted by the cnn generally speaking the cells along the traffic network are more likely to develop into urban land and the greater the density of the road network the higher the probability of the cells developing into urban land the more complete the public facilities are the easier it is to attract people to promote the development of urban land chen et al 2019 geographical environment has a distinct impact on urban land use and areas with higher elevations and steep slopes are difficult to develop into urban land gounaridis et al 2019 the spatial features extracted by the cnn were also input as one of the driving factors specific driving factors are listed in table 1 the resolution of all data was resampled to 100 m and normalised a schematic of the driving factors is shown in fig 6 4 experimental results and discussions 4 1 model implementation and comparison in the geographic partitioning stage the composition matrix of 265 standardised driving factors with the 5 5 km grid was applied as the input data for k means and the count of categories was 10 as this showed a large variability between categories while keeping the integrity of each category the partitioning results showed large fragmentation and uncertainty when the count of categories was 10 or more finally hangzhou was divided into 10 homogeneous sub regions as shown in fig 7 comparing the partitioning results in fig 7 with the real administrative divisions of hangzhou we can see that the administrative scope of region 4 and linping district are consistent and that of regions 3 and 10 are consistent with yuhang district from a socioeconomic perspective region 1 the dajiangdong region of hangzhou has a small proportion of urban land and a large proportion of arable land regions 2 and 3 approximately correspond to the two major economic centres in hangzhou these two regions have large amounts of urban land use and rapid urban expansion rates the mountainous areas in regions 9 and 10 have a large proportion of forested land and less urban land therefore the possibility of large scale expansion of urban land is unlikely it can be seen that each sub region is relatively homogeneous and the geographical division can effectively improve the simulation effect in order to verify the overall performance of the kcl ca model developed in this study two traditional models lr ca and ann ca were developed for comparison additionally to explore the effect of spatio temporal dependency lstm ca cnn ca fcnn ca and fcnn lstm ca were developed for quantitative comparison experiments the cnn ca uses potential spatial features from a single year as the influence factor input unlike ann ca in fcnn ca the input driver was changed to a multi year latent spatial feature fcnn lstm ca adapts the training network from ann to lstm unlike fcnn ca these models did not adopt a geographical partitioning strategy kcl ca adds a geographical partitioning method the model comparison results are shown in table 2 the results in table 2 demonstrate the following 1 the simulation results of lr ca were the lowest for all indicators with an fom value of only 0 1944 it can be seen that the logistic regression method is not as good as the machine learning method in dealing with non linear processes such as spatio temporal luc 2 cnn ca used potential spatial features from a single year as the influence factor input and all indicators were improved compared with ann ca with the fom index improving by 1 08 this indicates that potential spatial features have some influence on luc 3 the driving factors of the fcnn ca input were changed to multi year potential spatial features which added the consideration of the time dimension compared with that in cnn ca which was improved by 0 98 partially solving the effect of temporal dependency on luc to some extent 4 lstm ca takes into account long term time effects and therefore the state of each step is no longer only related to the previous time step the fom index improved by 3 51 compared to the ann ca model with a significant improvement in simulation accuracy when the potential spatial features were considered the developed model fcnn lstm ca exhibited a 4 71 improvement in the fom index compared to annca temporal and spatial heterogeneities were also considered the accuracy can be further improved by combining these two methods 5 the kcl ca model developed in this study combines fcnn lstm ca with a geographic partitioning method the results showed that geographic partitioning significantly improved the overall accuracy of this study and all indices improved significantly the fom index improved by 19 43 for lr ca and by 9 86 for ann ca it is clear that the kcl ca model has certain advantages as shown in fig 8 the simulated map of a local area is selected for comparison with the real land use map for 2020 it is clear that the simulation results of the traditional lr ca and ann ca models are substantially different from the real scenario the fcnn lstm ca can improve the range of poor lstm ca simulation results when it takes into account the potential spatial features but the part of urban land with less sprawl appears to be overspread kcl ca solves this problem more effectively and is the closest to the real land use situation 4 2 time steps performance exploration table 3 shows the influence of each model based on different time series land use maps as input data on the simulation accuracy we can see that the accuracy of the fcnn ca model for extracting potential spatial features based on time series land use data is higher than that of the traditional model for extracting spatial features based on a single year cnn ca and the fom index increased by 0 98 this is because during the lstm training prediction process land use maps with a longer time span can provide more historical information resulting in better experimental results for example the cnn ca model convolved only the 2015 land use map to extract latent features fcnn ca fuses the spatial features between 1995 and 2015 and considers the temporal dependence of the features which improves accuracy in the kcl ca model the input data from 2010 to 2015 only changed in a single step where the input data from 1995 to 2015 considered the time dependence of the land use map and the fom index increased by 1 27 from this we can conclude that more historical data inputs can lead to better simulation results 5 conclusions this paper proposes a novel ca model named k means cnn lstm ca kcl ca which integrates geographic partitioning with deep learning techniques the model can consider the spatio temporal dependency of the luc more effectively and provides better simulation results and providing reference for ecological issues such as soil degradation and climate change the main contributions of this study are as follows 1 a novel ca model with mixed spatio temporal features is proposed which uses a combination of geographic partitioning techniques and deep learning techniques to deal with spatial heterogeneity among sub regions 2 in this model potential spatial features were extracted from fusion using a cnn for multi year land use maps the issue of temporal dependency can be considered as opposed to extracting features for a single year simultaneously the integrated lstm trains the model to further learn the spatiotemporal dependency finally the study area was simulated in conjunction with ca 3 nine administrative districts in hangzhou were selected as case studies to evaluate the performance of the proposed model developed in this study the results express that the kcl ca has a significant improvement in the prediction accuracy of luc compared with the traditional cellular automata model while the fom index improved by 9 86 19 43 considering temporal dependency the fom index increased by 0 98 3 51 and increased by 1 08 5 15 when considering spatial heterogeneity the overall accuracy kappa coefficient and fom index were 0 9569 0 8654 and 0 3887 respectively this shows that our model can effectively consider the spatiotemporal dependence of luc and has an excellent simulation effect however several aspects need to be addressed first the driving factors selected in this study did not consider socio economic political and cultural factors which are closely related to land use therefore considering additional driving factors could further enhance the simulation in addition this study focussed is on the transformation of non urban land into urban land and there is a lack of information of the transformation of land use categories other than urban land credit authorship contribution statement ye zhou conceptualization methodology writing review editing chen huang software formal analysis writing original draft tao wu formal analysis writing review editing and funding acquisition mingyue zhang data acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this study was supported by the hubei changjiang national cultural park construction research project hubei provincial department of culture and tourism hcyk2022y08 and wuhan science and technology bureau 2022010801020310 
24162,land use change luc has gained attention as a core topic of global ecological environment change research the cellular automata ca model affects the global layout through local changes and is widely used in luc however most previous studies are based on the assumption of the markov model which ignores the temporal dependency of luc in addition most researchers have used the identical transition rules when simulating luc variation across a region ignoring the spatial heterogeneity in luc studies accordingly we propose a novel ca model integrating k means convolutional neural networks cnn and long short term memory neural networks lstm to solve temporal dependency and spatial heterogeneity named k means cnn lstm ca kcl ca first in order to resolve spatial heterogeneity we divided the study area into homogeneous sub regions using k means clustering algorithm we then extracted multi year spatial neighbourhood features and assigned weights with gaussian functions according to the time sequence order to realise the fusion of multi year features lstm was used to extract the spatio temporal dependency features of historical land use data and to calculate the transition probability maps for sub regions finally ca generated the dynamic simulation results for the whole region the kcl ca model was validated based on data collected in hangzhou from 1995 to 2020 traditional logistic regression lr ca and artificial neural network ann ca were used for comparison comparing the traditional model with the results shows that the proposed kcl ca model improves the fom index by 9 86 19 43 considering the temporal dependency the fom index increased by 0 98 3 51 when considering spatial heterogeneity the fom index increased by 1 08 5 15 kcl ca can deal with the temporal dependency of spatial heterogeneity in urban land expansion simulations and can effectively predict future urban expansion the simulation results can effectively monitor the future trend of urban luc and help to provide policy support for urban planning and management for decision makers keywords cellular automata land use change spatio temporal dependency deep learning urbanisation spatial partitioning data availability the authors do not have permission to share data 1 introduction land use change luc is a prominent manifestation of human nature interactions lyu et al 2019 mwabumba et al 2022 rapid urbanisation will lead to a series of ecological problems including agricultural and grazing land loss and soil pollution sönmez et al 2016 wu et al 2021 ahmadi sani et al 2022 truong et al 2022 sourn et al 2022 with the acceleration of urbanisation researchers have paid more attention to urban luc accurate modelling and prediction of the change process of land use has become an urgent matter while it can effectively provide reference for ecological issues such as soil degradation and climate change thus achieving sustainable development of land resources akram et al 2018 turan et al 2019 2022 fahad et al 2019 urban spatial modelling is an important tool for resource managers ecological economists and planners and is highly significant for the future development orientation of regions and urban planning sun et al 2018 therefore researchers are making greater try to analyse patterns of luc and disciplines for decision planning in recent years series of methods have been proposed for dynamic luc modelling including statistical methods agent based models markov chains system dynamics models and cellular automata ca models bahmani et al 2021 noszczyk 2018 ren et al 2019 takamatsu et al 2014 ca models have been widely used in luc simulations because of their powerful spatial modelling computational capabilities shafizadeh moghadam 2019 truong et al 2022 yao et al 2017 the determination of the transition rules plays a decisive role in the exactitude of the luc model however ca models only consider the interactions among cells ignoring the influence of the driving forces which makes the simulated results difficult to interpret barreira gonzález et al 2015 feng and tong 2017 vani and prasad 2022 therefore ca models are often combined with methods such as machine learning to perform luc simulations logistic regression lr is the most common approach for optimising the weights of drivers guan et al 2019 wang et al 2019 however it is difficult to accurately simulate urban expansion as lr only extracts linear rules subsequently artificial intelligence algorithms including artificial neural networks ann support vector machines svm and random forests rf gounaridis et al 2019 karimi et al 2019 li et al 2022 liang et al 2021 mustafa et al 2018 zhang et al 2020 have been applied in urban luc simulations in combination with ca owing to their good extraction of non linear features however luc is a long term process with clear temporal and spatial heterogeneity there are two major issues involved in the modelling and prediction of dynamic future luc trends 1 effectively dividing the study area into homogeneous sub areas to resolve spatial heterogeneity and 2 simultaneously considering the impact of temporal dependency and neighbourhood effects on luc first lucs are spatially heterogeneous different regions in the same area have different regional development rates and probabilities owing to the different levels of urbanisation currently most studies tend to use the same transition rules to predict future land use in the whole region which inevitably leads to spatial heterogeneity qian et al 2020 therefore using the same transition rules for the whole region will affect the prediction results and dividing the entire region into several homogeneous sub areas plays an important role in reasonable luc prediction second the neighbourhood effect is also an important factor to be considered in luc simulations barreira gonzález and barros 2017 for instance the non built up land is unlikely to be transformed into the built up one when most of the neighbouring land use cells remain undeveloped the neighbourhood effect between cells is determined by land use type owing to spatial heterogeneity a single neighbourhood feature cannot provide sufficient support for the prediction results capturing potential luc features has an important impact on improving the reliability of predictions luc is a long term process and the expansion process of the historical period will affect the simulation results wang et al 2021 previous studies have always been based on the markov assumption the state at the next time step is only related to the state at the previous time step and the land use data used for research are always sparse which cannot effectively express the long term temporal dependency of land use change li et al 2021 wang and zheng 2022 to address the temporal dependency and spatial heterogeneity of the luc process researchers have begun to integrate deep learning techniques into ca models a long short term memory neural network lstm is a recurrent neural network rnn that can learn time series historical information liu et al 2021 attempted to deal with the temporal dependency based on the lstm ca model which effectively improved the simulation accuracy but did not consider the spatial heterogeneity of luc zhai et al 2020 used cnn to extract spatial features to address the issue of spatial heterogeneity between neighbourhoods while ignoring the temporal dependency of the luc process therefore some researchers have attempted to looking at both the spatial heterogeneity and temporal dependency of the luc process by combining cnn and lstm however the use of cnn to extract spatial features based on a single year land use map results in an insufficient number of spatial features and limited model simulation accuracy liu et al 2021 the spatial heterogeneity and time dependence of neighbourhoods are considered in the above mentioned model but the spatial heterogeneity of the study area is often not considered thus the simulation accuracy can be further improved guo et al 2020 used a combination of multilayer perception mlp markov models and zoning techniques to consider the spatial heterogeneity of different regions though the temporal dependency is not completely accounted for from this we propose a novel ca model that couples geographic partitioning using k means with cnn lstm kcl ca kcl ca adopts a partitioning strategy with the k means to generate several relatively homogeneous sub regions napoleon and pavalakodi 2011 zhou et al 2022 a cnn was adopted to carry out a two dimensional convolution of the time series land use maps and weighted fusion was performed according to a gaussian function to capture the potential spatial features furthermore taking the driving factors neighbourhoods and learned spatial features as input a long short term memory lstm ca model was used in every homogeneous sub region to simulate land use change over the entire study area in addition the traditional lr ca ann ca cnn ca and lstm ca models used as control variables for comparison were developed on the same test data to assess the performance of the kcl ca the main research contents of this paper are as follows 1 we propose a kcl ca model that can handle spatial and temporal dependency for luc simulation 2 we employed a simpler and more popular k means clustering algorithm to deal with the spatial heterogeneity by partitioning the study area to homogeneous sub regions 3 we used the cnn lstm to extract time series spatial features from and the temporal dependency the remainder of this paper is organised as follows section 2 shows the components framework and detailed parameters of the developed kcl ca model section 3 describes the driving factors used and study area in this study section 4 analyses the experimental results and compares the models using the control variable method to verify the advantages of the new model section 5 concludes the study and offers an outlook for future research 2 methodology the kcl ca model proposed in this study consists of three modules fig 1 geospatial partition feature extraction and ca prediction the geographic partitioning module divides the study area to a number of homogeneous sub regions based on k means which has been discussed in detail in section 2 1 1 the cnn is utilised to extract spatial features by convolution of time series land use maps which has been described in section 2 1 2 the extracted spatial features slope elevation and other driving factors are input into the lstm model to train the development probability map of each sub region further details are presented in section 2 1 3 finally by integrating the constraints neighbourhood factors and stochastic factors with ca the simulation results were obtained which are further presented in section 2 2 the evaluation metrics for the experimental results are presented in section 2 3 2 1 introduction of kcl ca model 2 1 1 partitioning strategy based on k means within the luc process unbalanced urban development rates are common phenomena among regions and the geographical partitioning of the study area is usually used to deal with spatial heterogeneity chen et al 2022 qian et al 2020 as the most popular and simple partitioning algorithm we applied k means to divide the study area into homogeneous sub regions in accordance with the principles of mutual exclusivity and rationality of partitioning the pre experiment partitions the study area based on townships streets and grids township street based geographic zoning is affected by administrative regions and cannot fully account for spatial heterogeneity and dependency the study area was finally divided into 5 km2 grids for the given observation x x i i 1 2 each grid has m dimensional attributes and all grids are separated into k clusters c c k k 1 2 k the purpose of k means is aggregate all grid objects to specified k class clusters according to the similitude between objects and every object be part of only one class cluster whose distance from the centre of the class cluster is the smallest assuming that v k is the mean of cluster c k the euclidean distance between v k and all the points belonging to c k is defined as follows 1 d c k x i c k x i v k 2 as a result of k means we are able to solve the optimal problem for all k clusters in the following 2 c k mi n k k 1 k x i c k x i v k 2 by initialising k cluster centres the distance from each object to each cluster centre was successively compared and the objects were assigned to the cluster with the closest cluster centre in order to generate and modify the partition the new centroid for each cluster and the new euclidean distance between each centroid and each point are calculated the process ends when a cluster member is stable or conditionally terminated 2 1 2 fusion spatial feature extraction based on convolutional neural network urban land use change has a spatial temporal dependency and the potential spatial features in each sub region will have an impact on the final outcome aburas et al 2016 most studies at this stage extract features by convolution for a particular year of land use map xing et al 2020 which is not sufficient to capture the temporal dependency of time series historical land use data therefore in our study a 2d cnn was conducted based on the muti year land use maps separately to obtain a set of temporal potential spatial feature data the computing formula for the 2d cnn is given by eq 3 3 z a b l f m i 0 g j 0 k w i j l m x a i b j i 1 m b l here z a b l denotes the output at the current position g is the height of the convolution kernel k is the width of the convolution kernel m denotes the feature maps number in layer l 1 w i j l m denotes the value at the current position f is the activation function and b l denotes bias to make the convolutional filter fully pick up the spatial features of the land use maps the cnn structure in this study used only the convolutional and fully connected layers with a channel number of 1 the cnn model applied a 3 3 convolutional kernel the input layer of the cnn is time series land use maps while the first convolutional layer employs 64 3 3 convolutional kernels the second convolutional layer is parameterised by 128 3 3 the third layer is fully connected and incorporates dropout to prevent overfitting and the output layer is the latent spatial feature that we capture for use as drivers the specific framework of the cnn model is explained in fig 2 considering that using the time series spatial features as one of the driving factors will greatly increase the amount of calculation and it is hard to realize the expected calculation effect the convolutional time series feature maps were weighted and fused in this study our study refers to the improved maximum weighted voting method for assigning weights to the obtained time series latent space feature maps the core idea is that spatial features that are closer to the research year are distributed greater weights in our study the research year is 2020 the time interval between 2015 and 2020 is the shortest the weight is the largest the data in 2010 is the second and so on let h 1 h 2 h n be a time series potential spatial feature maps β 1 β 2 β n donate the weight corresponding to the former then there are fused space features h as in eq 4 4 h β 1 h 1 β 2 h 2 β n h n according to the weight order determined above each weight value is approximately subject to a normal distribution and the sum of each weight value is 1 thereby obtaining the weights as shown in eqs 5 and 6 5 β 1 β 2 β n 1 6 f β 1 2 π σ exp β μ 2 2 σ 2 here μ σ are the position and scale parameters respectively 2 1 3 the lstm neural network model the lstm is a variant of a recurrent neural network rnn that can effectively deal with long term time dependant problems and has wide applications in the fields of air quality index prediction zhang et al 2021 and multi task learning sentiment classification jin et al 2020 in this study the long term urban luc map is a large scale time series and lstm has a good effect on learning the temporal dependency in the series xing et al 2020 as shown in fig 3 each unit of the lstm model include an input gate output gate and oblivion gate the main working principles are as follows 1 when connecting the information of the previous and present time steps the forget gate accepts the connection result and uses the sigmoid activation function to remap thereby deleting redundant data in a targeted manner 2 the input gate receives the connection result in step 1 uses the activation function again to store the data and passes it to the tanh function and outputs the data to be stored to calculate the new storage unit 3 finally the output gate determines the hidden state of the next time and the tanh function mapping determines which data are selected to be passed down as shown in eqs 7 12 7 f t s i g m o i d w f h t 1 x t b f 8 i t s i g m o i d w i h t 1 x t b i 9 o t s i g m o i d w o h t 1 x t b o 10 c t t a n h w c h t 1 x t b c 11 c t f t c t 1 i t c t 12 h t o t tanh c t here w denotes the weight matrix b denotes the bias f t i t o t denote the forget input and output gates respectively x t represents the status of the current time step cell h t 1 represents the hidden status of the previous time step h t is the hidden status of the current time step c t 1 is the storage unit of the previous time step and c t is the storage unit for the current time step in this study lstm incorporates all previously available information trains the entire model and makes predictions for training lstm employs driving factors and time series urban land use maps as the input data the terminating year land use map as the output and randomly selects 5 of the data as the training set zhang and xia 2022 the lstm structure consists of two lstm layers with loop kernels of 64 and 96 the first layer performs output at each time step and the second layer only accepts output at the last time step in the fully connected layer dropout was set to 0 2 to prevent overfitting tanh was chosen as the activation function classical mean square error was selected for the loss function and adaptive moment estimation adam was chosen as the optimiser finally a neural network was used to calculate the development probability of the cell 2 2 integration of fusion model and cellular automata the predicted probability of each cell was calculated by the lstm network and the predicted probability map was used as one of the inputs of the cellular automaton to simulate and predict future land use the status of the next cell t 1 was determined by the transition rule at time t when the transition probability of a cell is greater than a predefined threshold at 0 1 the cell type is converted the development probability of the traditional cellular automata model at time t 1 is shown in eq 13 13 p i j t 1 s i j t y i j t l i j t r where p i j t 1 denotes the probability of exploitation of the cell at position i j at moment t 1 s i j t denotes the transition probability calculated by the fused lstm model for the cell at position i j at moment t 1 y i j t denotes the constraints on the cell at location i j at moment t 1 such as policy factors and water constraints l i j t denotes the constraints on the cell at location i j at moment t 1 such as policy factors and water constraints l i j t denotes the neighbourhood effect of the cell at position i j at moment t 1 and r denotes the random perturbation owing to random factors 2 3 model evaluation to assess the function of the developed model we employed overall accuracy oa kappa coefficient and figure of merit fom index the equations are as follows 14 17 14 oa t p t n t p t n f p f n tp represents the cells that are actually converted into correct cells by prediction transformation fp represents the cells that are not transformed by prediction transformation tn represents the cells that are not transformed by prediction and are not transformed and fn represents the cells that are not transformed by prediction and are actually transformed 15 p e a 1 b 1 a 2 b 2 a n b n n 2 16 kappa p o p e 1 p e where p o denotes the sum of correctly classified samples per class divided by the number of samples a 1 a 2 a n denotes the true number of samples per category b 1 b 2 b n denotes the true number of samples per category b 1 b 2 b n denotes the number of predictions for each category of samples and n is the total number of samples 17 fom b a b c d the number a represents the number of cells that are predicted to change during observation but did not change during b is the number of cells that correctly changed both in the simulation and observation c denotes the number of cells that incorrectly changed both in the simulation and observation and d denotes the number of cells that changed in the simulation but not in the observation 3 study area and datasets hangzhou is located in the middle and lower reaches of the yangtze river and is the political economic and cultural centre of zhejiang province hangzhou is a major city in the yangtze river delta from 1995 to 2020 the resident population of the city increased from 1 8 to 11 936 million and the city s regional gdp increased from 80 billion yuan to 1 61 trillion yuan over the last decade hangzhou s urban land area has grown rapidly because of its location and policy support nine districts of hangzhou shangcheng gongshu binjiang xiaoshan xihu yuhang linping qiantang and fuyang with a total area of 4876 km² were selected for the study fig 4 the remaining parts of hangzhou lin an tonglu jiande and chun an were not included in the study due to their geographical location being far from the centre of hangzhou the high proportion of mountains and water areas within their jurisdiction and the small proportion of urban land 3 1 land use maps time series land use maps of hangzhou were extracted based on remote sensing images of landsat4 5 tm from 1995 landsat 7 etm from 2000 landsat 5 tm from 2005 to 2010 and landsat 8 oli 30 30 m from 2015 to 2020 pre processing including geometric alignment atmospheric correction radiometric calibration and image cropping of remote sensing images in different periods was realised using the envi software in order to conduct the supervised classification published land cover data was used as well as historical images of google earth interpreted visually and referring to the resource and environmental science data center s classification system for land use monitoring six categories as arable forest grass water built up and unused land were selected a total of 85 classification accuracy and 80 kappa coefficient were achieved after supervised classification and post classification processing as shown in fig 5 arable land is decreasing annually while built up land is expanding rapidly 3 2 driving factors referring to previous luc studies we selected four major types of driving factors transportation network public facilities geographical environment and potential spatial features extracted by the cnn generally speaking the cells along the traffic network are more likely to develop into urban land and the greater the density of the road network the higher the probability of the cells developing into urban land the more complete the public facilities are the easier it is to attract people to promote the development of urban land chen et al 2019 geographical environment has a distinct impact on urban land use and areas with higher elevations and steep slopes are difficult to develop into urban land gounaridis et al 2019 the spatial features extracted by the cnn were also input as one of the driving factors specific driving factors are listed in table 1 the resolution of all data was resampled to 100 m and normalised a schematic of the driving factors is shown in fig 6 4 experimental results and discussions 4 1 model implementation and comparison in the geographic partitioning stage the composition matrix of 265 standardised driving factors with the 5 5 km grid was applied as the input data for k means and the count of categories was 10 as this showed a large variability between categories while keeping the integrity of each category the partitioning results showed large fragmentation and uncertainty when the count of categories was 10 or more finally hangzhou was divided into 10 homogeneous sub regions as shown in fig 7 comparing the partitioning results in fig 7 with the real administrative divisions of hangzhou we can see that the administrative scope of region 4 and linping district are consistent and that of regions 3 and 10 are consistent with yuhang district from a socioeconomic perspective region 1 the dajiangdong region of hangzhou has a small proportion of urban land and a large proportion of arable land regions 2 and 3 approximately correspond to the two major economic centres in hangzhou these two regions have large amounts of urban land use and rapid urban expansion rates the mountainous areas in regions 9 and 10 have a large proportion of forested land and less urban land therefore the possibility of large scale expansion of urban land is unlikely it can be seen that each sub region is relatively homogeneous and the geographical division can effectively improve the simulation effect in order to verify the overall performance of the kcl ca model developed in this study two traditional models lr ca and ann ca were developed for comparison additionally to explore the effect of spatio temporal dependency lstm ca cnn ca fcnn ca and fcnn lstm ca were developed for quantitative comparison experiments the cnn ca uses potential spatial features from a single year as the influence factor input unlike ann ca in fcnn ca the input driver was changed to a multi year latent spatial feature fcnn lstm ca adapts the training network from ann to lstm unlike fcnn ca these models did not adopt a geographical partitioning strategy kcl ca adds a geographical partitioning method the model comparison results are shown in table 2 the results in table 2 demonstrate the following 1 the simulation results of lr ca were the lowest for all indicators with an fom value of only 0 1944 it can be seen that the logistic regression method is not as good as the machine learning method in dealing with non linear processes such as spatio temporal luc 2 cnn ca used potential spatial features from a single year as the influence factor input and all indicators were improved compared with ann ca with the fom index improving by 1 08 this indicates that potential spatial features have some influence on luc 3 the driving factors of the fcnn ca input were changed to multi year potential spatial features which added the consideration of the time dimension compared with that in cnn ca which was improved by 0 98 partially solving the effect of temporal dependency on luc to some extent 4 lstm ca takes into account long term time effects and therefore the state of each step is no longer only related to the previous time step the fom index improved by 3 51 compared to the ann ca model with a significant improvement in simulation accuracy when the potential spatial features were considered the developed model fcnn lstm ca exhibited a 4 71 improvement in the fom index compared to annca temporal and spatial heterogeneities were also considered the accuracy can be further improved by combining these two methods 5 the kcl ca model developed in this study combines fcnn lstm ca with a geographic partitioning method the results showed that geographic partitioning significantly improved the overall accuracy of this study and all indices improved significantly the fom index improved by 19 43 for lr ca and by 9 86 for ann ca it is clear that the kcl ca model has certain advantages as shown in fig 8 the simulated map of a local area is selected for comparison with the real land use map for 2020 it is clear that the simulation results of the traditional lr ca and ann ca models are substantially different from the real scenario the fcnn lstm ca can improve the range of poor lstm ca simulation results when it takes into account the potential spatial features but the part of urban land with less sprawl appears to be overspread kcl ca solves this problem more effectively and is the closest to the real land use situation 4 2 time steps performance exploration table 3 shows the influence of each model based on different time series land use maps as input data on the simulation accuracy we can see that the accuracy of the fcnn ca model for extracting potential spatial features based on time series land use data is higher than that of the traditional model for extracting spatial features based on a single year cnn ca and the fom index increased by 0 98 this is because during the lstm training prediction process land use maps with a longer time span can provide more historical information resulting in better experimental results for example the cnn ca model convolved only the 2015 land use map to extract latent features fcnn ca fuses the spatial features between 1995 and 2015 and considers the temporal dependence of the features which improves accuracy in the kcl ca model the input data from 2010 to 2015 only changed in a single step where the input data from 1995 to 2015 considered the time dependence of the land use map and the fom index increased by 1 27 from this we can conclude that more historical data inputs can lead to better simulation results 5 conclusions this paper proposes a novel ca model named k means cnn lstm ca kcl ca which integrates geographic partitioning with deep learning techniques the model can consider the spatio temporal dependency of the luc more effectively and provides better simulation results and providing reference for ecological issues such as soil degradation and climate change the main contributions of this study are as follows 1 a novel ca model with mixed spatio temporal features is proposed which uses a combination of geographic partitioning techniques and deep learning techniques to deal with spatial heterogeneity among sub regions 2 in this model potential spatial features were extracted from fusion using a cnn for multi year land use maps the issue of temporal dependency can be considered as opposed to extracting features for a single year simultaneously the integrated lstm trains the model to further learn the spatiotemporal dependency finally the study area was simulated in conjunction with ca 3 nine administrative districts in hangzhou were selected as case studies to evaluate the performance of the proposed model developed in this study the results express that the kcl ca has a significant improvement in the prediction accuracy of luc compared with the traditional cellular automata model while the fom index improved by 9 86 19 43 considering temporal dependency the fom index increased by 0 98 3 51 and increased by 1 08 5 15 when considering spatial heterogeneity the overall accuracy kappa coefficient and fom index were 0 9569 0 8654 and 0 3887 respectively this shows that our model can effectively consider the spatiotemporal dependence of luc and has an excellent simulation effect however several aspects need to be addressed first the driving factors selected in this study did not consider socio economic political and cultural factors which are closely related to land use therefore considering additional driving factors could further enhance the simulation in addition this study focussed is on the transformation of non urban land into urban land and there is a lack of information of the transformation of land use categories other than urban land credit authorship contribution statement ye zhou conceptualization methodology writing review editing chen huang software formal analysis writing original draft tao wu formal analysis writing review editing and funding acquisition mingyue zhang data acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this study was supported by the hubei changjiang national cultural park construction research project hubei provincial department of culture and tourism hcyk2022y08 and wuhan science and technology bureau 2022010801020310 
24163,natural ecosystems provide many different services such as carbon sequestration regulation of climate change biodiversity and aesthetic value ecosystem functions are significantly impacted by both natural and man made processes such as sediment and nutrient deposition the lake tana basin faces significant problems with soil depletion sedimentation and degradation thus this study is designed to assess the effects of climate and land use change on the export of sediment and nutrients as well as their retention in the basin this study used different data sources such as satellite data for land use and land cover and watershed preparation climate data from climate hazards group infrared precipitation with station data chirps and climate model intercomparison project phase five cmip5 soil data from ministry of water irrigation and electricity mowie and field data for model calibration five different global climate models gcms were employed to produce climate projections using the long ashton research station weather generator lars wg for the basin the cellular automata ca and markov chain has then been employed for future projections of changes in land use finally the integrated valuation of ecosystem services and tradeoff invest sediment delivery ratio sdr and nutrient delivery ratio ndr models have been applied to assess the changes in sediment and nutrient export between the baseline and future time periods the findings indicated that between 1990 and 2019 there was a change in land use that led to an increase in sediment exports of 60 5 and a decrease in sediment retention of 12 8 projecting into the future the amount of exported and retained sediment increases under the rcp4 5 and rcp8 5 scenarios in the 2040s by 8 4 and 17 8 respectively due to the combined effects of climate and land use change equally nitrogen and phosphorus exports rose under land use change scenarios but are projected to decrease under climate and integrated climate and land use change scenarios out of the 12 sub watersheds that were designated five were found to have a high mean annual rate of sediment and nutrient export and were then ranked in terms of priority level for conservation planning hence this research shows that the integration of spatial data with the invest model can be used to aid land use planning and decision making to combat nutrient and sediment exports and prioritize watersheds keywords ecosystems invest cmip5 ca markov chain sediment nutrient climate change lake tana basin data availability data will be made available on request 1 introduction natural ecosystems provide ecosystem services like carbon sequestration zhan 2015 climate control biodiversity and aesthetic value which humans depend upon tan et al 2020 however such ecosystem functions can be significantly impacted by both natural and man made processes such as sediment and nutrient deposition uwimana et al 2018 thus soil erosion needs to be mitigated as well as the retention of sediment and nutrients in order to preserve ecosystem services quality of water and agricultural production han et al 2020 zhan 2015 soils in freshwater wetlands serve as significant sinks for phosphorus nitrogen organic carbon and sediment vymazal 2015 according to funk et al 2015 and geng et al 2015b sediment and nutrient export and retention are significantly influenced by the interaction of climate and land use moreover the two most significant factors influencing the change in ecosystems are changes in land use and climate fenta et al 2021 gebresilassie 2020 getachew et al 2021a polasky et al 2012 tang et al 2018 such environmental change has become more severe as a result of changes in rainfall patterns and intensity caused by climate change bangash et al 2013 sardari et al 2019 ethiopia s national and regional governments established projects such as community based integrated natural resources management to reduce soil erosion degradation of land climate change mitigation and enhance water quality however cultivated and built up lands have increased due to population pressure furthermore climate change has become a prominent feature due to global warming thus the basin s sustainable development efforts have been significantly impacted by dramatic changes in climate and land which may affect nutrient and sediment delivery capacity han et al 2020 many areas of the world have studied how changes in climate and land use affect ecosystems such as lakes wetlands forests ponds etc han et al 2020 sample et al 2016 schirpke et al 2019 the potential impact of future climate change and land use on ecosystem services however needs more studies lake tana is affected by water hyacinth due to sediment and nutrient deposition from upstream sources within its basin the lake tana basin faces significant problems with soil depletion sedimentation and degradation of land getachew et al 2021a lemma et al 2019 2020 setegn et al 2009 the surrounding agricultural lands of the basin are also affected by water hyacinth besides lake tana basin fishery activities aquatic life lake water quantity and quality tourism and recreational value of the basin are severely affected by sediment and nutrient influx from the basin s upstream sub watershed tsegaye and bharti 2021 therefore assessing the current and projected potential sources of sediment and nutrient load as well as retention areas are crucial to improve ecosystem services and values different models are available for quantifying and modelling sediment yield and soil erosion mapping such as the agricultural non point source model revised universal soil loss equation rusle agnps watene et al 2021 sediment river network model sednet thomas et al 2018 and require different data the natural capital project www naturalcapitalproject org established the integrated valuation of environmental services and tradeoffs invest model geng et al 2015a which has been extensively adopted globally rukundo et al 2018 su and fu 2013 to model ecosystem services such as carbon sequestration santos 2014 crop production pollination water yield water quality soil retention tourism and recreation etc which provides spatial information for land management practices from grid scale to watershed furthermore unlike the above models the ability to identify the sediment paths from hill slopes to waterbodies makes the invest model useful for the integrated analysis of loss of soil export and retention of both nutrient and sediment in a particular watershed degife et al 2021 dersseh et al 2022 this model has therefore been employed to assess the effects of climate and land use change on the export of sediment and nutrients and their effect downstream as well as retention in the lake tana basin ecological services mapping and evaluation can help to manage natural resources sustainably geneletti et al 2020 promote environmental awareness aid spatial planning and develop environment solutions maes et al 2014 moreover it helps to target ecosystem restoration and management measures by providing a better understanding of ecosystem status and trends plans for river basin management have been directly influenced by mapping nutrient retention and maintaining the chemical quality of freshwater maes et al 2014 ruskule et al 2018 models can estimate services of ecosystem such as sequestration of carbon crop production pollination santos 2014 yield of water quality of water retention of soil tamire et al 2023 tourism recreation and more wei et al 2021 this data can also be used to inform land management practices from a grid scale up to a watershed level humans and climate drivers can both influence land cover changes new settlements increasing which can lead to the permanent loss of natural and working lands which can drastically affect weather patterns including precipitation and temperature fluctuations sleeter et al 2018 it is expected that climate change have a direct and indirect effect on land use and cover by altering disturbance patterns species distributions and the suitability of land for different purposes zhao et al 2020 additionally zondag and borsboom 2009 point out that demographics societal values and trends technology economy climate change energy transition and policies drive land use change lack of market and financial infrastructure poverty issues with land tenure security population growth and the expansion of agricultural land are the key variables influencing land use woldesenbet et al 2017 most ecosystem service changes have been caused by changes in land use climate population invasive species policymakers lack of attention and a lack of awareness amongst the public and government tamire et al 2023 the aim of this research therefore is to evaluate the invest model for the lake tana basin in order to quantify how individual and combined changes in climate and land use affect the export and retention of nutrients and sediment the model measures loss of soil in overland flows such as sheet and rill erosion but not in gullies channels or streams even though only overland flow is measured using the invest model the research findings are considered significant which will inform policy makers and ultimately lead to an improvement in ecosystem services in the upper blue nile river basin 2 description of the study area the lake tana basin has a total area of about 15 096 km2 which includes the lake fig 1 geographically the research region is situated between latitudes 10055 and 12045 n and longitudes 36040 to 38020 e the lake tana basin has extraordinary national importance the fogara and debian plains the tiss abay and tana beles hydroelectric power plants high value crops particularly cash crops and livestock and ecotourism all contribute to the region s great potential getachew and manjunatha 2022a lake tana a natural reservoir in this area is where the blue nile river begins the lake which is 84 km long 66 km wide and just 15 m deep is situated in the nation s northwest highlands getachew et al 2020 a natural freshwater lake lake tana has a surface area of 3 000 3 600 km2 and is located at a height of 1784 m above sea level the megech ribb gilgel abay and gumera are the lake tana s four main tributaries getachew et al 2021b this study demonstrates that these four inflow rivers account for more than 93 of the yearly lake water budget the blue nile abay river has an annual flow volume of 4 billion cubic meters m3 year at the bahir dar gauging station tigabu 2020 in addition lake tana outflows emanated from 8 7 of the overall catchment area and contributed 8 1 of the total blue nile flow conway 2000 about 1280 mm of precipitation fall on the basin each year setegn et al 2008 in the basin there is only one rainy season which runs from mid june to mid september tropical highland monsoon dominates the basin s climate getachew and manjunatha 2022b the mean yearly temperature of the basin is roughly 20 c despite considerable diurnal temperature changes and small annual and seasonal differences ademe et al 2022 the basin experiences unimodal rainfall distributions the basin contains five main types of soil chromic luvisols lithic leptosols eutric fluvisols haplic nitisols eutric vertisols and haplic luvisols climate change invasive species deforestation sedimentation soil erosion wetland deforestation eutrophication poor solid and liquid waste management stakeholder conflict and hydrological changes are just a few of the problems these basins confront stave et al 2017 3 materials and methods an empirical study design has been developed to model the impacts of climate and land use change on nutrient and sediment export and retention in the lake tana basin data was collected from different sources such as national meteorological agency sahle et al 2019a ministry of water irrigation and electricity mowie united states geological survey usgs net cap field data were collected for effective analysis of the proposed objectives sediment and nutrient export data from four major river outlet of lake tana basin tributaries at the outlets of gilgel abay gumera ribb and megech were collected and used to calibrate the invest model 3 1 data types at a grid or watershed scale a variety of parameters such as land use and land cover lulc soil and topography climate and management practices have an effect on the rate of nutrient and sediment export and retention negese 2021 hence different datasets such as spatial non spatial and field data were collected lulc data watershed boundary data rainfall erosivity r factor soil erodibility factor k factor wu and fan 2022 digital elevation model dem biophysical table were used 3 1 1 watershed boundary and dem an arcgis10 4 software programme was used to extract the watershed boundary from the dem that was used in the invest model the national aeronautics and space administration nasa website https dwtkns com srtm30m provided access to the 30 m shuttle radar topographic mission srtm getachew and manjunatha 2022b furthermore this dem data was used to prepare ls factor maps of the rusle which is a major input of the invest model 3 1 2 lulc data the usgs website https earth explorer usgs gov provided the baseline land use map for the research region for 2019 and 1990 which was created using data from landsat 8 s operational land inventory oli and landsat 7 s enhanced thematic mapper plus etm getachew et al 2021b at a spatial resolution of a 30 m respectively before classifying the image datasets pre processing of image such as layer stacking sub setting mosaicking image enhancement atmospheric and radiometric correction was performed then lulc classification was performed using the maximum likelihood algorithm in idrisi selva 17 0 software package using ground controlling point gcp data the classification accuracy of lulc classes was assessed future land use change simulations were carried out in addition to future climate change projections for accurate modelling of sediment and nutrient retention therefore to predict the change in lulc in the study for the 2040s baseline maps from 1990 to 2019 were employed prior to projecting future land change several input parameters such as factors and limitations maps were created these parameters were created using a multi criteria evaluation process then utilizing software packages from idrisi selva 17 0 a cellular automaton ca markov chain model was used for the future projection of land use change 3 1 3 rainfall erosivity r factor the rainfall erosivity r factor quantifies how easily rain can cause erosion of soil degife et al 2021 the formula to calculate rainfall erosivity is different for different countries as a result the r factor was calculated using the mathematical equation recommended by hurni 1985 for ethiopia 1 r 8 12 0 562 q where r is the erosivity of rainfall and q is the annual mean rainfall mm the datasets used to prepare the r factor was obtained from climate hazard infrared precipitation satellite station chirps however the ground station data has many missing data thus to overcome this problem chirps data was used after that gridded rainfall data was made using the inverse distance weighted idw interpolation techniques in arcgis environment future climate change data was downscaled from the latest 4 5 and 8 5 radiative forcing scenarios rcps climate model intercomparison project phase five cmip5 in this study five different gcms were employed to produce climate projections using the long ashton research station weather generator lars wg due to the fact that it can fill gaps caused by both rcms and gcms getachew et al 2021a therefore canesm2 mpi esm mr ipsl cm5a mr mri cgcm3 and csiro mk3 6 0 gcms from two 4 5 and 8 5 rcps are the five gcms employed in this study an ensemble means of five downscaled gcms was used to minimize uncertainty of downscaled climate change projection table 1 presents the cmip the rcps 4 5 and rcp8 5 for two time periods 3 1 4 soil erodibility k factor a soil s erodibility factor k is calculated based on its physical and chemical characteristics k values range from 0 1 for the least erodible soils to approaching 1 for the soils that are most prone to erosion getachew et al 2021a zerihun et al 2018 the datasets required to prepare the k factor was obtained from ministry of water irrigation and electricity mowie aneseyee 2021 the soil erodibility k factor was calculated using the williams 1995 methodology from a fao digital soil map of the world on the basis of soil texture and organic matter content the soil erodibility factor was calculated using map algebra in a raster calculator in a arcgis environment fig 2 2 k u s l e f c s a n d f c i s i f o r g f h i s a n d where f c s a n d is a component that produces high values for soils with minimal sand and low values for soils with a large proportion of coarse sand f c i s i is a component that reduces soil erodibility for soils with high clay to silt ratios f o r g is a component that makes soils with a high organic carbon concentration less erodible and f h i s a n d is a component that makes soils with incredibly high sand levels less erodible the factors are calculated k u s l e 3 f c s a n d 0 2 0 3 exp 0 256 m s 1 m s i l t 100 4 f c i s i m s i l t m c m s i l t 0 3 5 f o r g 1 0 0256 o r g c o r g c e x p 3 72 2 95 o r g c 6 f h i s a n d 1 0 7 1 m s 100 1 m s 100 e x p 5 51 22 9 1 m s 100 where m s is the percent of sand content 0 05 2 0 mm diameter particles m s i l t is the percent of silt content 0 002 0 05 mm diameter particles m c is the percent of clay content 0 002 mm diameter particles and o r g c is the percent of the organic carbon content of the layer in the soil erodibility factor for the basin is therefore predicted to range from 0 to 0 18 using the equation above fig 2 displays the watershed s soil erodibility map 3 1 5 biophysical table a csv table containing information on the cover management c factor and support practice p factor variables corresponding to each classified lulc class was necessary for the computation of erosion sediment and nutrient yield as well as retention thus for this study both usle p and usle c was adopted from the literature as suggested by wischmeier and smith 1978 hence usle c is a cover management factor for the usle a floating point value between 0 and 1 while usle p is a support practice factor for the usle a floating point value between 0 and 1 3 2 invest model to run the invest model each dataset must have the same reference systems spatial resolution and projection and so arcgis software was used the invest 3 8 9 model was then used to add up all the variables and make a final estimate of export and retention of sediment and nutrient in the lake tana basin the invest model uses topography ls soil erodibility k support and conservation practices p rainfall erosivity r cover and management c parameters for the calculation of soil loss while sediment retention was calculated using maximum potential soil losses han et al 2020 which hypothesize that landscape is bare minus the actual soil loss usle leh et al 2013 consequently the following equation was used to compute sediment retention 1 7 sediment retention services r k l s usle 8 usle r k l s c p c is the cover management factor and p is supporting practice factor ls is the slope length slope steepness factor r is the rainfall erosivity factor mj mm ha 1 h 1 y 1 k is the soil erodibility factor t ha h ha 1 mj 1 mm 1 getachew et al 2021a 3 3 scenario model in this research three scenarios were considered for the analysis of nutrient and sediment export and retention in lake tana basin using the invest model the first scenario only considered land use change but no climate change from 2021 to 2040 the second scenario only considered climate change but no land use change from 2021 to 2040 the third scenario considered both climate and land use change from 2021 to 2040 all other parameters such as soil erodibility k and ls factor etc were assumed to be unchanged for simulation of sediment and nutrient retention for the future time periods in the physical based models the level of uncertainty has been reduced using a variety of techniques hence by averaging five gcms the uncertainty for the climate projection model was decreased controlling the input data during the model s calibration and assessment phases helped lower the uncertainty for the ca and invest models 4 results and discussion 4 1 climate change scenarios 4 1 1 calibration and validation of the lars wg model the monthly means and standard deviations of baseline rainfall chirps data and projected rainfall lars wg model downscaled data for the stations in bahir dar dangila debre tabor and gonder are visually compared in figs 3 and 4 respectively this shows an underestimation of mean daily rainfall and rainfall variance in april july and september at bahir dar may july and september at dangila march april july and august at debre tabor station and july and october at gonder station furthermore the graphic comparison also shows that certain months mean and standard deviation of monthly rainfall was overestimated for instance during may june august october and november at bahir dar april june august and november at dangila may june september and november at debre tabor and april august september and november at gonder were relatively overestimated compared to the observed data the results were considered acceptable even though give the generally good matches between the monthly averages of the observed and simulated rainfall the basin saw an annual mean rainfall of 1288 mm from 1981 to 2019 varying between 1658 mm and 964 mm this can be compared to the projected annual mean rainfall in the basin in the 2040s of between 1423 mm and 1430 mm getachew et al 2021a getachew and manjunatha 2021 in the basin the baseline r factor varies from 534 to 895 mj mm ha 1 h 1 y 1 the r factor ranges for the 2040s under rcp4 5 scenarios are 679 8 to 913 2 mj mm ha 1 h 1 y 1 whereas under rcp8 5 the r factor ranges for the 2040s are 749 7 to 967 7 mj mm ha 1 h 1 y 1 fig 5 getachew et al 2021a 4 2 simulation of land use change land cover classification and mapping are essential to understanding earth s biophysical systems anderson et al 1976 consequently the study area is classified into the seven most general land use categories fig 6 shows the basin s classified maps from 1990 2019 and projected lulc of 2040s lulc maps of 2019 have been used for accuracy assessment and the kappa coefficient and user accuracies were 89 3 and 90 8 respectively water bodies shrublands grasslands forest built up areas barren lands and agricultural lands were the seven categories used to classify the lulc in the basin fig 6 as can be seen in table 2 the percentage of built up cultivated land and forested land grew while the percentage of bare land water bodies and grasslands declined using the ca markov model future land use cover simulations have been projected for the year 2040s before conducting lulc simulations some inputs were prepared the first input was the preparation of two basic land cover maps that should be used for the likelihood of transfer and transition suitability maps as the second input factor and constraint maps were created to create the required image set some land use classes are projected to shrink as a result of an increase in settlements and cultivated land getachew et al 2021a 4 3 spatiotemporal distribution and change of nutrients and sediment the results reveal that there has been a change in the spatial distribution of phosphorus and nitrogen between 1990 and 2019 with lake tana experiencing an increase in phosphorus and nitrogen exports over that time period see fig 7 as shown in fig 8 sediment exports decreased while sediment retention increased cultivated land and built up areas dominate the north and west of the lake tana basin where nitrogen and phosphorus are exported most frequently a change in the spatial distribution of phosphorus and nitrogen is projected between 2019 and 2040 lake tana has experienced an increase in phosphorus and nitrogen exports since 1990 as shown in fig 8 phosphorus and nitrogen exports gradually increased from 2019 to 2040 equally the sediment exports increased while sediment retention decreased under climate change scenarios fig 9 fig 10 displays the regional distribution of nutrients and sediment under climate and land use change in this study nutrient exports were explained by phosphorus and nitrogen exports between 2019 and 2040 the average phosphorus and nitrogen exports for the entire region dropped nitrogen exports decreased more slowly than phosphorus exports throughout the same period many of the watersheds in the lake tana basin indicated a decline in nitrogen exports from 2019 to 2040 apart from a handful in the basin s central and southern regions the exports of phosphate and nitrogen from the basin sharply decreased 4 4 changes in sediment and nutrient retention under the three different scenarios 4 4 1 impact of land use change between 1990 and 2019 there was a change in land use that led to an increase in sediment exports of 60 5 and a decrease in sediment retention of 12 8 table 6 this mostly resulted from the growth of agricultural lands at the loss of shrublands grasslands and forests equally nitrogen and phosphorus exports also increased by 32 5 and 26 9 respectively in 2019 compared to the land cover and land use of the study region in 1990 as a result of land use change scenarios sediment export increased by 3 5 while sediment retention decreased by 5 4 from 2019 to 2040 under land use change scenarios the amount of nitrogen and phosphorus exported rose by 0 6 and 6 respectively the total amount of sediment exported in 1990 was 69 183 088 tonnes and the total amount retained was 284 947 397 4 tonnes table 3 sediment exports increased by 60 5 in 2019 however sediment retention decreased by 12 8 the largest contributor to sediment exports in 1990 was farmland which accounted for 82 4 of total sediment exports while bare lands and built up areas contribute 10 9 and 2 9 of the total sediment export respectively the highest contributors to sediment retention in 1990 were farmlands 57 2 shrublands 26 6 and grasslands 12 2 in 1990 there were total exports of 27 456 030 tonnes of nitrogen and 624 670 1 tonnes of phosphorus farmland accounted for most of the phosphate and nitrogen exports in the catchment with p and n exports from cultivated land representing over 90 and 76 8 while exports from grassland built up areas shrublands and bare lands were less than 5 water bodies made up 19 8 the second highest share of the nitrogen export from the research region total sediment export and retention in 2019 were 102 941 914 7 tonnes and 253 939 089 6 tonnes respectively this amount of sediment export was projected to decrease in 2040 under land use change scenarios while sediment retention was shown to increase in 2040 using baseline scenarios i e 2019 farmlands contribute 95 and 90 to sediment export and retention respectively built up areas account for 3 5 and 9 of sediment exports under baseline and land use change scenarios respectively forests grasslands and shrublands were next to farmlands as top contributors to sediment retention under baseline scenarios contributing 5 2 6 and 2 3 respectively similarly forest areas grasslands and shrublands contributed the most to sediment retention at 4 8 2 6 and 1 5 respectively in 2019 total exports of nitrogen and phosphorus were 36 366 443 tonnes and 792 757 7 tonnes this will increase to 36 549 711 tonnes and 839 339 7 tonnes in 2040 under land use change projections the primary source of nitrogen and phosphorus exports is farmland on cultivated land the phosphorus and nitrogen exports represent over 96 and 85 of the total amounts in baseline and simulated change of land use change respectively while on grassland bare lands shrublands and built up areas the nitrogen and phosphorus exports are relatively less than 1 the second largest contributor to nitrogen export in the study area was water bodies which accounted for 14 of total nitrogen exports nonetheless phosphorus and nitrogen exports from forest land grasslands and bare lands are very small hardly affecting nutrient exports in the basin based on results from field water quality collection and analysis the amount of sediment exported at lake tana s outlet was estimated at 784 mg l under baseline scenarios the total nitrate and phosphate exports in the basin were estimated to be 8 8 µg l and 275 8 µg l under baseline scenarios respectively 4 4 2 impact of climate change the amount of exported sediment increases under the rcp4 5 and rcp8 5 scenarios by 8 4 and 17 8 respectively and the amount of retained sediment increased by 8 0 and 17 3 respectively while exports of phosphorus decreased by 2 and 1 9 and exports of nitrogen decreased by 0 6 and 0 5 respectively table 6 total sediment export and retention under climate change rcp4 5 radiative forcing scenarios were 115 917 227 tonnes and 260 036 115 tonnes respectively table 4 this amount of sediment export and retention also increased in rcp8 5 radiative forcing scenarios while sediment retention was increased under rcp8 5 scenarios using rcp4 5 scenarios farmlands contribute 78 and 92 to sediment export and retention respectively as a result of rcp8 5 scenarios farmlands had a 92 contribution to sediment export and 91 to sediment retention forests grasslands and shrublands were next to farmlands as top contributors to sediment retention under rcp4 5 scenarios contributing 4 2 and 1 7 respectively under rcp8 5 scenarios forest areas grasslands and shrublands contributed the most to sediment retention at 4 2 and 1 7 respectively in general farmlands contributed 78 under rcp4 5 and 90 5 under the rcp8 5 radiative force scenarios climate change scenarios resulted in a decrease of both nitrate and phosphorus exports from the basin 4 4 3 combined impacts of climate and land use changes the retention and export of sediment increased due to the integrated effects of climate and land use change in this scenario the percentage of exported sediment increased by 12 6 and 22 3 while the amount of retained sediment increased by 2 4 and 11 2 under the rcp4 5 and rcp8 5 scenarios respectively on the other hand the percentage of nitrogen exported increased by 0 02 and 0 08 while phosphorus exports increased by 4 1 and 4 3 under the rcp4 5 and rcp8 5 scenarios respectively table 6 under this scenarios total sediment and retention were 115 579 532 tonnes and 259 135 244 tonnes under rcp4 5 scenarios and 8 6 and 8 6 125 559 354 tonnes and 281 445 814 tonnes higher under rcp8 5 radiative forcing scenarios table 5 nonetheless under the land use and climate change scenarios farmlands were the largest contributors to sediment export and retention hence farmlands contribute around 90 and 91 1 of the total sediment export and retention under the combined effects of land use and climate change under rcp4 5 radiative forcing scenarios total nitrogen and phosphorus exports are projected to be 36 337 075 tonnes and 824 788 tonnes respectively however under the rcp8 5 they are projected to be 0 1 and 0 1 higher 36 376 918 tonnes and 825 887 tonnes exports of nitrogen and phosphorus respectively similarly to sediment export and retention the highest contributors to nitrogen and phosphorus export were farmlands for instance 84 3 and 85 7 of nitrogen and phosphorus were produced under the rcp4 5 and rcp8 5 scenarios respectively 4 5 sub watershed s sediment and nutrient export mapping and prioritization since it s hard to put conservation measures in place at the same time in all parts of a watershed it s important to find and rank the places where sediment and nutrients leave the watershed in order that future activities can be more targeted therefore the integrate impacts of land use and climate under the rcp8 5 scenario have been used to prioritize sediment and nutrient export conservation planning interventions twelve sub watersheds table 7 were identified to prioritize soil conservation as shown in table 7 the sw 9 sub watershed created 0 9 t ha 1 year 1 of sediment while the sw 6 sub watershed generated 71 1 t ha 1 year 1 of sediment on average out of the 12 sub watersheds that were designated sw6 sw7 sw3 sw6 and sw12 were found to have a high mean annual rate of sediment export table 7 and were given the priority levels of first second third fourth and fifth respectively for conservation planning a total of 637 516 03 ha 42 5 of the whole watershed is covered by these sub watersheds which contribute 75 7 of the sediment export to the watershed each year in order to prioritize sediment retention twelve sub watersheds table 8 were established the annual mean sediment retention rate of the sub watersheds ranged from 2 6 t ha 1 year 1 created by the sw 9 to 38 4 t ha 1 year 1 generated by the sw 7 as shown in table 8 the sw7 sw6 sw12 sw1 and sw2 sub watersheds were given priority levels of first second third fourth and fifth respectively out of the 12 designated sub watersheds due to their modelled high mean annual rate of sediment retention table 8 a total of 713 890 1 ha 47 5 of the whole watershed is covered by these sub watersheds which contribute 81 8 of the sediment retention to the watershed each year twelve sub watersheds tables 9 and 10 were identified to prioritize nitrogen and phosphorus exports the annual mean nitrogen export rate of sub watersheds ranged from 0 2 t ha 1 year 1 for sw 3 to 3 1 t ha 1 year 1 for sw 7 while the mean annual export rate of phosphorus from sub watersheds ranged from 0 2 t ha 1 year 1 produced by sw 5 to 0 09 t ha 1 year 1 generated by sw 7 out of the 12 sub watersheds that were defined sw7 and sw12 were found to have high mean annual rates of nitrogen and phosphorus exports tables 9 and 10 and were given the priority levels of first and second for conservation planning a total of 294 162 8 19 6 of the whole watershed is covered by these sub watersheds which contribute 25 3 of the nitrogen and 30 1 of phosphorus to the watershed each year 5 discussion in this research the export of sediment and nutrients was simulated over a 50 year period using the invest model additionally it examined the relationships between annual patterns of land cover climatic change nutrients and sediment monitoring the quality of water is useful for monitoring ecosystem integrity and determining whether water is suitable for its intended use research has indicated that lake tana s trophic state has steadily changed from mesotrophic to eutrophic as a result of nutrient inputs goshu et al 2017 lake tana faces the threat of sedimentation the shores of the lake and the mouths of rivers are contaminated with faeces and toxic cyanobacteria goshu et al 2017 2020 stave et al 2017 the main sources of nitrogen and phosphorus include sediment fertilizers animal waste and waste from production the primary factors contributing to the decline in water quality in lakes rivers and groundwater are phosphorus and nitrogen entering the water through erosion surface runoff leaching and agricultural drainage yang et al 2019 hence the increase in sediment and nutrient exports is particularly attributed to changes in the land use of the basin in line with this study with mereta et al 2020 reporting that human activities like farming grazing solid waste dumping and clay mining were the main things that affected how much total suspended solids and nutrients were kept in the soil the increase in agricultural land in the basin has augmented the export of sediment and nutrients thereby adversely affecting the water quality of the lake as well as its major tributaries in certain land uses forests grasslands shrublands only a small portion of the sediment is retained it would have significant implications for water quality in general as well as ecosystem services in particular to fix the impacts of change in land use on the export of sediment and nutrients strong corrective steps are needed in line with this study raji et al 2020 highlighted that chemical fertilizers that are used to increase crop yields contain a lot of nitrogen n and phosphorus p if these elements aren t managed well they can seriously harm the water supply the conversion of non agricultural land into farmlands may lead to increased sediment and nutrient transport that is removed from the soil along with surface runoff kandel et al 2023 aneseyee et al 2020a indicated a strong relationship between loss of soil and sediment delivery and the growth of agricultural areas p 0 001 according to han et al 2020 change in land use had a greater impact on nutrient retention climate change was more prominent in the retention of sediment this study has revealed that the combined impacts on the export of sediment and nutrients are quite minor when compared to the impacts of climate change and land use change independently additionally the outcomes demonstrated that between 2001 and 2016 surface runoff and sediment rose by 11 8 and 47 07 respectively therefore the yearly water balance of the watershed is impacted by land cover change pastures grasslands shrublands or barren lands changes in forest land as well as sediment movement from mining fields pastures and buildings could be used to explain changes in sediment and runoff khoi and suetsugi 2014 approximately 2 to 19 t ha 1 year 1 of sediment were exported annually from 14 microdam basins in northern ethiopia haregeweyn et al 2012 sahle et al 2019b also found that sediment exports from the catchment of wabe river the gibe basin ranged from 0 to 33 t ha 1 year 1 aneseyee et al 2020b observed that there is a decline in ecosystem service values due to land conversion which suggests that sustainable development projects should be undertaken to improve the environment the projected export value of sediment was very low as compared to the baseline data the research locations different terrain drainage density elevation climate soil type and condition geology watershed size and level of land use may all be contributing factors to the variances observations made on the ground indicate that soil materials taken from the watershed s steep slopes have collected in the downstream regions these sediment exports led to issues with lake sedimentation water body contamination and silt deposition on working agricultural fields degife et al 2021 according to kulsoontornrat and ongsomwang 2021 differences in lulc types and areas have an effect on the characteristics of the biophysical table and are responsible for fluctuations in nitrogen and phosphorus exports the output of the invest model according to aneseyee et al 2020a shows that soil erodibility particle size rainfall erosivity and cover c are additional factors that affect sediment delivery tools for modelling ecosystem services can help land managers and policymakers evaluate how different management approaches or changes in how land is used will affect the provision of ecosystem services sharps et al 2017 based on the sensitivity analysis it appears that each of these factors contributes differently to soil erosion the parameters alter over time as a result of modifications to the lulc the invest model can also give decision makers useful information about nutrient flows particularly in terms of the relative variances between catchments redhead et al 2018 the analyses of the sediment budget and coastal change provide a framework for evaluating opportunities to boost resilience in a number of coastal land use sectors that are prominent in low lying deltas all over the world grossman et al 2020 chiang et al 2019 also discussed that loads of sediment were primarily influenced by sediment concentration watershed soil properties and typhoon courses large scale development projects the higher watershed the eradication of forests and an excess of sediment gravels that adversely affect river the balance of sediment are just a few examples of the major scouring of siltation in rivers that contribute to many sediment disasters li et al 2018 indicated that the reed canal system was able to remove total nitrogen and total phosphorus during the 1998 irrigation season the duration of conservation structures are further threatened by the severely damaged river banks and bed scours that are frequently brought on by stormflows excessive sediment outputs chiang et al 2019 the proportion of nutrients added to basins that are subsequently exported by rivers to coastal waters may be affected by changes in hydrology climate change river damming or consumptive water use could all have an impact on how rivers discharge in the future tysmans et al 2013 according to johnes 1996 for instance it was noted that the effects of temporal changes in land use and management on water quality in both catchments were taken into account the issues with nutrient retention in wetland ecosystems have been a major theme in a variety of landscape ecological subjects lane et al 2017 agriculture intensification may speed up the rapid disappearance of wetlands by increasing the concentration of sediments and fertilizers in water bodies to ensure there is adequate food for everyone diversification and the coexistence of wetland provisioning and regulatory services can be helpful uwimana 2019 positive net nutrient and sediment yields were found in valley bottoms with ponds reservoirs and a predominance of grass or forest while negative net yields were found in valley bottoms with agricultural land covering leading to net export uwimana 2019 in the different lulc categories there were clear differences in sediment and nutrient yields in order to compare model results with the baseline model result several future climate and land use scenarios were run ecosystem services outcomes mapping and evaluation can support environmental education the development of nature based solutions and the sustainable management of natural resources ruskul et al 2018 so areas with high sediment and nutrient exports are potential targets for restoration the agricultural productivity and the cost of water quality purification is reduced of the sub watershed if restoration is conducted however conservation could focus on areas with low sediment and nutrient exports therefore to maintain ecosystem services sediment and nutrient export and retention areas was maintained in the sub basin of the watershed based on the model outputs it is possible to improve a variety of services such as provisioning services food freshwater regulating services climate regulation water purification cultural services aesthetic educational recreational values and supportive services nutrient cycling soil formation and primary production costanza et al 2014 ruskule et al 2018 after evaluating the integrated and separate effects of land use and climate change on nutrients and sediment yields better land management options were proposed if fertilizers and sediment are kept in the field using better land management techniques the agricultural yield will increase as nutrients and silt are prevented from being carried and deposited in the water the quality of the water has also improved there is a substantial spatial variation in the drivers of change that affect and modify ecosystem functions and processes changes in land use patterns fragmentation of land and agricultural intensification ruskule et al 2018 to predict possible impacts on sediment and nutrient exports and retentions hypotheses of land management land cover change climate change etc need to be simulated surface water quality is crucial for the retention service since it has effects on both the economy and society land use planners at governmental organizations and environmental organizations must understand how ecosystems trap and degrade pollutants before they enter lakes rivers streams and seas to successfully minimize pollution of water according to some studies climate change and land use are amongst the most significant environmental pressures brought on by human activity at many different scales these pressures have a big effect on how well ecosystems do their important jobs like storing carbon regulating water flow and making food and fibre zhan 2015 the study showed that in general under land use changes sediment and nutrient exports are likely to increase while the amount of sediment retained tends to decline in the same way climate change scenarios predict that sediment export and retention tend to increase while nutrient export will go down on the other hand under scenarios of climate and land use change the basin is expected to experience an increase in sediment export and retention as well as nutrient exports 6 conclusion land use and land cover changes between 1990 2019 and 2040 can be accurately classified and identified using post classification comparative change detection methods and supervised classification with maximum likelihood then lulc data were projected using a ca markov chain model for the years 2019 through 2040 therefore land use change projections were considered a variety of social and technological advancements for example certain constraints open water cities and protected areas and factors road slope population was considered the actual 1990 lulc data used as the baseline data and the projected lulc data under three scenarios between 2019 and 2040 were then utilized to quantify ecosystem services in terms of sediment and nutrient exports using the ndr and sdr models furthermore under the rcp4 5 and rcp8 5 scenarios climate change projection utilizing lars wg has been successfully employed to project from cmip5 in order to predict the 2040s under the rcp4 5 and rcp8 5 scenarios models canesm2 csiro mk36 mpi esm mr ipsl cm5a and mri cgcm3 have been used an ensemble means of the five gcms has been utilized to assess the effects of climate change on nutrient and sediment export and retention in order to avoid the uncertainty of these diverse climate model projections the integration of these two scenarios was then taken into consideration for this study to evaluate their effects on nutrient and sediment export and retention after climate change and land use projections in order to measure ecosystem services at the watershed scale especially nutrient and sediment export and to identify priority sub watersheds for sediment and nutrient reduction advanced geospatial models such as the ca markov chain sdr and ndr models climate models such as lars wg can be utilized the findings of this study indicate that not all sub catchments exported the same quantity of sediment and nutrients for instance compared to other sub watersheds sub watersheds seven six twelve and one export the most sediment and nutrients these sub watersheds therefore have the most erodible soil and the most intensive farming practices as well as generally sloping topography and little vegetation cover however sub watersheds nine four five and eight produce less sediment and nutrients have the least erodible soil have better vegetation cover and employ the lower agricultural practices so in order to keep the ecosystem working well ecosystem services need to be restored with a focus on the sub watersheds that export out the most sediment and nutrients ethics approval and consent to participate not applicable credit authorship contribution statement birhan getachew tikuye conceptualization data curation formal analysis funding acquisition investigation methodology project administration resources software supervision validation visualization writing original draft writing review editing laurence gill supervision writing review editing milos rusnak supervision writing review editing busnur r manjunatha supervision writing review editing declaration of competing interest the authors declare that they have no competing interests acknowledgements this research was financially supported by the international foundation for science ifs grant no i2 w 6696 1 we would like to thank the national meteorological services agency of ethiopia and hydrology department of the ministry of water irrigation and electricity of ethiopia and ministry of agriculture for providing the meteorological data discharge data and soil data respectively united states geological survey usgs and https earthexplorer usgs gov were very helpful for downloading elevation and landsat data 
24163,natural ecosystems provide many different services such as carbon sequestration regulation of climate change biodiversity and aesthetic value ecosystem functions are significantly impacted by both natural and man made processes such as sediment and nutrient deposition the lake tana basin faces significant problems with soil depletion sedimentation and degradation thus this study is designed to assess the effects of climate and land use change on the export of sediment and nutrients as well as their retention in the basin this study used different data sources such as satellite data for land use and land cover and watershed preparation climate data from climate hazards group infrared precipitation with station data chirps and climate model intercomparison project phase five cmip5 soil data from ministry of water irrigation and electricity mowie and field data for model calibration five different global climate models gcms were employed to produce climate projections using the long ashton research station weather generator lars wg for the basin the cellular automata ca and markov chain has then been employed for future projections of changes in land use finally the integrated valuation of ecosystem services and tradeoff invest sediment delivery ratio sdr and nutrient delivery ratio ndr models have been applied to assess the changes in sediment and nutrient export between the baseline and future time periods the findings indicated that between 1990 and 2019 there was a change in land use that led to an increase in sediment exports of 60 5 and a decrease in sediment retention of 12 8 projecting into the future the amount of exported and retained sediment increases under the rcp4 5 and rcp8 5 scenarios in the 2040s by 8 4 and 17 8 respectively due to the combined effects of climate and land use change equally nitrogen and phosphorus exports rose under land use change scenarios but are projected to decrease under climate and integrated climate and land use change scenarios out of the 12 sub watersheds that were designated five were found to have a high mean annual rate of sediment and nutrient export and were then ranked in terms of priority level for conservation planning hence this research shows that the integration of spatial data with the invest model can be used to aid land use planning and decision making to combat nutrient and sediment exports and prioritize watersheds keywords ecosystems invest cmip5 ca markov chain sediment nutrient climate change lake tana basin data availability data will be made available on request 1 introduction natural ecosystems provide ecosystem services like carbon sequestration zhan 2015 climate control biodiversity and aesthetic value which humans depend upon tan et al 2020 however such ecosystem functions can be significantly impacted by both natural and man made processes such as sediment and nutrient deposition uwimana et al 2018 thus soil erosion needs to be mitigated as well as the retention of sediment and nutrients in order to preserve ecosystem services quality of water and agricultural production han et al 2020 zhan 2015 soils in freshwater wetlands serve as significant sinks for phosphorus nitrogen organic carbon and sediment vymazal 2015 according to funk et al 2015 and geng et al 2015b sediment and nutrient export and retention are significantly influenced by the interaction of climate and land use moreover the two most significant factors influencing the change in ecosystems are changes in land use and climate fenta et al 2021 gebresilassie 2020 getachew et al 2021a polasky et al 2012 tang et al 2018 such environmental change has become more severe as a result of changes in rainfall patterns and intensity caused by climate change bangash et al 2013 sardari et al 2019 ethiopia s national and regional governments established projects such as community based integrated natural resources management to reduce soil erosion degradation of land climate change mitigation and enhance water quality however cultivated and built up lands have increased due to population pressure furthermore climate change has become a prominent feature due to global warming thus the basin s sustainable development efforts have been significantly impacted by dramatic changes in climate and land which may affect nutrient and sediment delivery capacity han et al 2020 many areas of the world have studied how changes in climate and land use affect ecosystems such as lakes wetlands forests ponds etc han et al 2020 sample et al 2016 schirpke et al 2019 the potential impact of future climate change and land use on ecosystem services however needs more studies lake tana is affected by water hyacinth due to sediment and nutrient deposition from upstream sources within its basin the lake tana basin faces significant problems with soil depletion sedimentation and degradation of land getachew et al 2021a lemma et al 2019 2020 setegn et al 2009 the surrounding agricultural lands of the basin are also affected by water hyacinth besides lake tana basin fishery activities aquatic life lake water quantity and quality tourism and recreational value of the basin are severely affected by sediment and nutrient influx from the basin s upstream sub watershed tsegaye and bharti 2021 therefore assessing the current and projected potential sources of sediment and nutrient load as well as retention areas are crucial to improve ecosystem services and values different models are available for quantifying and modelling sediment yield and soil erosion mapping such as the agricultural non point source model revised universal soil loss equation rusle agnps watene et al 2021 sediment river network model sednet thomas et al 2018 and require different data the natural capital project www naturalcapitalproject org established the integrated valuation of environmental services and tradeoffs invest model geng et al 2015a which has been extensively adopted globally rukundo et al 2018 su and fu 2013 to model ecosystem services such as carbon sequestration santos 2014 crop production pollination water yield water quality soil retention tourism and recreation etc which provides spatial information for land management practices from grid scale to watershed furthermore unlike the above models the ability to identify the sediment paths from hill slopes to waterbodies makes the invest model useful for the integrated analysis of loss of soil export and retention of both nutrient and sediment in a particular watershed degife et al 2021 dersseh et al 2022 this model has therefore been employed to assess the effects of climate and land use change on the export of sediment and nutrients and their effect downstream as well as retention in the lake tana basin ecological services mapping and evaluation can help to manage natural resources sustainably geneletti et al 2020 promote environmental awareness aid spatial planning and develop environment solutions maes et al 2014 moreover it helps to target ecosystem restoration and management measures by providing a better understanding of ecosystem status and trends plans for river basin management have been directly influenced by mapping nutrient retention and maintaining the chemical quality of freshwater maes et al 2014 ruskule et al 2018 models can estimate services of ecosystem such as sequestration of carbon crop production pollination santos 2014 yield of water quality of water retention of soil tamire et al 2023 tourism recreation and more wei et al 2021 this data can also be used to inform land management practices from a grid scale up to a watershed level humans and climate drivers can both influence land cover changes new settlements increasing which can lead to the permanent loss of natural and working lands which can drastically affect weather patterns including precipitation and temperature fluctuations sleeter et al 2018 it is expected that climate change have a direct and indirect effect on land use and cover by altering disturbance patterns species distributions and the suitability of land for different purposes zhao et al 2020 additionally zondag and borsboom 2009 point out that demographics societal values and trends technology economy climate change energy transition and policies drive land use change lack of market and financial infrastructure poverty issues with land tenure security population growth and the expansion of agricultural land are the key variables influencing land use woldesenbet et al 2017 most ecosystem service changes have been caused by changes in land use climate population invasive species policymakers lack of attention and a lack of awareness amongst the public and government tamire et al 2023 the aim of this research therefore is to evaluate the invest model for the lake tana basin in order to quantify how individual and combined changes in climate and land use affect the export and retention of nutrients and sediment the model measures loss of soil in overland flows such as sheet and rill erosion but not in gullies channels or streams even though only overland flow is measured using the invest model the research findings are considered significant which will inform policy makers and ultimately lead to an improvement in ecosystem services in the upper blue nile river basin 2 description of the study area the lake tana basin has a total area of about 15 096 km2 which includes the lake fig 1 geographically the research region is situated between latitudes 10055 and 12045 n and longitudes 36040 to 38020 e the lake tana basin has extraordinary national importance the fogara and debian plains the tiss abay and tana beles hydroelectric power plants high value crops particularly cash crops and livestock and ecotourism all contribute to the region s great potential getachew and manjunatha 2022a lake tana a natural reservoir in this area is where the blue nile river begins the lake which is 84 km long 66 km wide and just 15 m deep is situated in the nation s northwest highlands getachew et al 2020 a natural freshwater lake lake tana has a surface area of 3 000 3 600 km2 and is located at a height of 1784 m above sea level the megech ribb gilgel abay and gumera are the lake tana s four main tributaries getachew et al 2021b this study demonstrates that these four inflow rivers account for more than 93 of the yearly lake water budget the blue nile abay river has an annual flow volume of 4 billion cubic meters m3 year at the bahir dar gauging station tigabu 2020 in addition lake tana outflows emanated from 8 7 of the overall catchment area and contributed 8 1 of the total blue nile flow conway 2000 about 1280 mm of precipitation fall on the basin each year setegn et al 2008 in the basin there is only one rainy season which runs from mid june to mid september tropical highland monsoon dominates the basin s climate getachew and manjunatha 2022b the mean yearly temperature of the basin is roughly 20 c despite considerable diurnal temperature changes and small annual and seasonal differences ademe et al 2022 the basin experiences unimodal rainfall distributions the basin contains five main types of soil chromic luvisols lithic leptosols eutric fluvisols haplic nitisols eutric vertisols and haplic luvisols climate change invasive species deforestation sedimentation soil erosion wetland deforestation eutrophication poor solid and liquid waste management stakeholder conflict and hydrological changes are just a few of the problems these basins confront stave et al 2017 3 materials and methods an empirical study design has been developed to model the impacts of climate and land use change on nutrient and sediment export and retention in the lake tana basin data was collected from different sources such as national meteorological agency sahle et al 2019a ministry of water irrigation and electricity mowie united states geological survey usgs net cap field data were collected for effective analysis of the proposed objectives sediment and nutrient export data from four major river outlet of lake tana basin tributaries at the outlets of gilgel abay gumera ribb and megech were collected and used to calibrate the invest model 3 1 data types at a grid or watershed scale a variety of parameters such as land use and land cover lulc soil and topography climate and management practices have an effect on the rate of nutrient and sediment export and retention negese 2021 hence different datasets such as spatial non spatial and field data were collected lulc data watershed boundary data rainfall erosivity r factor soil erodibility factor k factor wu and fan 2022 digital elevation model dem biophysical table were used 3 1 1 watershed boundary and dem an arcgis10 4 software programme was used to extract the watershed boundary from the dem that was used in the invest model the national aeronautics and space administration nasa website https dwtkns com srtm30m provided access to the 30 m shuttle radar topographic mission srtm getachew and manjunatha 2022b furthermore this dem data was used to prepare ls factor maps of the rusle which is a major input of the invest model 3 1 2 lulc data the usgs website https earth explorer usgs gov provided the baseline land use map for the research region for 2019 and 1990 which was created using data from landsat 8 s operational land inventory oli and landsat 7 s enhanced thematic mapper plus etm getachew et al 2021b at a spatial resolution of a 30 m respectively before classifying the image datasets pre processing of image such as layer stacking sub setting mosaicking image enhancement atmospheric and radiometric correction was performed then lulc classification was performed using the maximum likelihood algorithm in idrisi selva 17 0 software package using ground controlling point gcp data the classification accuracy of lulc classes was assessed future land use change simulations were carried out in addition to future climate change projections for accurate modelling of sediment and nutrient retention therefore to predict the change in lulc in the study for the 2040s baseline maps from 1990 to 2019 were employed prior to projecting future land change several input parameters such as factors and limitations maps were created these parameters were created using a multi criteria evaluation process then utilizing software packages from idrisi selva 17 0 a cellular automaton ca markov chain model was used for the future projection of land use change 3 1 3 rainfall erosivity r factor the rainfall erosivity r factor quantifies how easily rain can cause erosion of soil degife et al 2021 the formula to calculate rainfall erosivity is different for different countries as a result the r factor was calculated using the mathematical equation recommended by hurni 1985 for ethiopia 1 r 8 12 0 562 q where r is the erosivity of rainfall and q is the annual mean rainfall mm the datasets used to prepare the r factor was obtained from climate hazard infrared precipitation satellite station chirps however the ground station data has many missing data thus to overcome this problem chirps data was used after that gridded rainfall data was made using the inverse distance weighted idw interpolation techniques in arcgis environment future climate change data was downscaled from the latest 4 5 and 8 5 radiative forcing scenarios rcps climate model intercomparison project phase five cmip5 in this study five different gcms were employed to produce climate projections using the long ashton research station weather generator lars wg due to the fact that it can fill gaps caused by both rcms and gcms getachew et al 2021a therefore canesm2 mpi esm mr ipsl cm5a mr mri cgcm3 and csiro mk3 6 0 gcms from two 4 5 and 8 5 rcps are the five gcms employed in this study an ensemble means of five downscaled gcms was used to minimize uncertainty of downscaled climate change projection table 1 presents the cmip the rcps 4 5 and rcp8 5 for two time periods 3 1 4 soil erodibility k factor a soil s erodibility factor k is calculated based on its physical and chemical characteristics k values range from 0 1 for the least erodible soils to approaching 1 for the soils that are most prone to erosion getachew et al 2021a zerihun et al 2018 the datasets required to prepare the k factor was obtained from ministry of water irrigation and electricity mowie aneseyee 2021 the soil erodibility k factor was calculated using the williams 1995 methodology from a fao digital soil map of the world on the basis of soil texture and organic matter content the soil erodibility factor was calculated using map algebra in a raster calculator in a arcgis environment fig 2 2 k u s l e f c s a n d f c i s i f o r g f h i s a n d where f c s a n d is a component that produces high values for soils with minimal sand and low values for soils with a large proportion of coarse sand f c i s i is a component that reduces soil erodibility for soils with high clay to silt ratios f o r g is a component that makes soils with a high organic carbon concentration less erodible and f h i s a n d is a component that makes soils with incredibly high sand levels less erodible the factors are calculated k u s l e 3 f c s a n d 0 2 0 3 exp 0 256 m s 1 m s i l t 100 4 f c i s i m s i l t m c m s i l t 0 3 5 f o r g 1 0 0256 o r g c o r g c e x p 3 72 2 95 o r g c 6 f h i s a n d 1 0 7 1 m s 100 1 m s 100 e x p 5 51 22 9 1 m s 100 where m s is the percent of sand content 0 05 2 0 mm diameter particles m s i l t is the percent of silt content 0 002 0 05 mm diameter particles m c is the percent of clay content 0 002 mm diameter particles and o r g c is the percent of the organic carbon content of the layer in the soil erodibility factor for the basin is therefore predicted to range from 0 to 0 18 using the equation above fig 2 displays the watershed s soil erodibility map 3 1 5 biophysical table a csv table containing information on the cover management c factor and support practice p factor variables corresponding to each classified lulc class was necessary for the computation of erosion sediment and nutrient yield as well as retention thus for this study both usle p and usle c was adopted from the literature as suggested by wischmeier and smith 1978 hence usle c is a cover management factor for the usle a floating point value between 0 and 1 while usle p is a support practice factor for the usle a floating point value between 0 and 1 3 2 invest model to run the invest model each dataset must have the same reference systems spatial resolution and projection and so arcgis software was used the invest 3 8 9 model was then used to add up all the variables and make a final estimate of export and retention of sediment and nutrient in the lake tana basin the invest model uses topography ls soil erodibility k support and conservation practices p rainfall erosivity r cover and management c parameters for the calculation of soil loss while sediment retention was calculated using maximum potential soil losses han et al 2020 which hypothesize that landscape is bare minus the actual soil loss usle leh et al 2013 consequently the following equation was used to compute sediment retention 1 7 sediment retention services r k l s usle 8 usle r k l s c p c is the cover management factor and p is supporting practice factor ls is the slope length slope steepness factor r is the rainfall erosivity factor mj mm ha 1 h 1 y 1 k is the soil erodibility factor t ha h ha 1 mj 1 mm 1 getachew et al 2021a 3 3 scenario model in this research three scenarios were considered for the analysis of nutrient and sediment export and retention in lake tana basin using the invest model the first scenario only considered land use change but no climate change from 2021 to 2040 the second scenario only considered climate change but no land use change from 2021 to 2040 the third scenario considered both climate and land use change from 2021 to 2040 all other parameters such as soil erodibility k and ls factor etc were assumed to be unchanged for simulation of sediment and nutrient retention for the future time periods in the physical based models the level of uncertainty has been reduced using a variety of techniques hence by averaging five gcms the uncertainty for the climate projection model was decreased controlling the input data during the model s calibration and assessment phases helped lower the uncertainty for the ca and invest models 4 results and discussion 4 1 climate change scenarios 4 1 1 calibration and validation of the lars wg model the monthly means and standard deviations of baseline rainfall chirps data and projected rainfall lars wg model downscaled data for the stations in bahir dar dangila debre tabor and gonder are visually compared in figs 3 and 4 respectively this shows an underestimation of mean daily rainfall and rainfall variance in april july and september at bahir dar may july and september at dangila march april july and august at debre tabor station and july and october at gonder station furthermore the graphic comparison also shows that certain months mean and standard deviation of monthly rainfall was overestimated for instance during may june august october and november at bahir dar april june august and november at dangila may june september and november at debre tabor and april august september and november at gonder were relatively overestimated compared to the observed data the results were considered acceptable even though give the generally good matches between the monthly averages of the observed and simulated rainfall the basin saw an annual mean rainfall of 1288 mm from 1981 to 2019 varying between 1658 mm and 964 mm this can be compared to the projected annual mean rainfall in the basin in the 2040s of between 1423 mm and 1430 mm getachew et al 2021a getachew and manjunatha 2021 in the basin the baseline r factor varies from 534 to 895 mj mm ha 1 h 1 y 1 the r factor ranges for the 2040s under rcp4 5 scenarios are 679 8 to 913 2 mj mm ha 1 h 1 y 1 whereas under rcp8 5 the r factor ranges for the 2040s are 749 7 to 967 7 mj mm ha 1 h 1 y 1 fig 5 getachew et al 2021a 4 2 simulation of land use change land cover classification and mapping are essential to understanding earth s biophysical systems anderson et al 1976 consequently the study area is classified into the seven most general land use categories fig 6 shows the basin s classified maps from 1990 2019 and projected lulc of 2040s lulc maps of 2019 have been used for accuracy assessment and the kappa coefficient and user accuracies were 89 3 and 90 8 respectively water bodies shrublands grasslands forest built up areas barren lands and agricultural lands were the seven categories used to classify the lulc in the basin fig 6 as can be seen in table 2 the percentage of built up cultivated land and forested land grew while the percentage of bare land water bodies and grasslands declined using the ca markov model future land use cover simulations have been projected for the year 2040s before conducting lulc simulations some inputs were prepared the first input was the preparation of two basic land cover maps that should be used for the likelihood of transfer and transition suitability maps as the second input factor and constraint maps were created to create the required image set some land use classes are projected to shrink as a result of an increase in settlements and cultivated land getachew et al 2021a 4 3 spatiotemporal distribution and change of nutrients and sediment the results reveal that there has been a change in the spatial distribution of phosphorus and nitrogen between 1990 and 2019 with lake tana experiencing an increase in phosphorus and nitrogen exports over that time period see fig 7 as shown in fig 8 sediment exports decreased while sediment retention increased cultivated land and built up areas dominate the north and west of the lake tana basin where nitrogen and phosphorus are exported most frequently a change in the spatial distribution of phosphorus and nitrogen is projected between 2019 and 2040 lake tana has experienced an increase in phosphorus and nitrogen exports since 1990 as shown in fig 8 phosphorus and nitrogen exports gradually increased from 2019 to 2040 equally the sediment exports increased while sediment retention decreased under climate change scenarios fig 9 fig 10 displays the regional distribution of nutrients and sediment under climate and land use change in this study nutrient exports were explained by phosphorus and nitrogen exports between 2019 and 2040 the average phosphorus and nitrogen exports for the entire region dropped nitrogen exports decreased more slowly than phosphorus exports throughout the same period many of the watersheds in the lake tana basin indicated a decline in nitrogen exports from 2019 to 2040 apart from a handful in the basin s central and southern regions the exports of phosphate and nitrogen from the basin sharply decreased 4 4 changes in sediment and nutrient retention under the three different scenarios 4 4 1 impact of land use change between 1990 and 2019 there was a change in land use that led to an increase in sediment exports of 60 5 and a decrease in sediment retention of 12 8 table 6 this mostly resulted from the growth of agricultural lands at the loss of shrublands grasslands and forests equally nitrogen and phosphorus exports also increased by 32 5 and 26 9 respectively in 2019 compared to the land cover and land use of the study region in 1990 as a result of land use change scenarios sediment export increased by 3 5 while sediment retention decreased by 5 4 from 2019 to 2040 under land use change scenarios the amount of nitrogen and phosphorus exported rose by 0 6 and 6 respectively the total amount of sediment exported in 1990 was 69 183 088 tonnes and the total amount retained was 284 947 397 4 tonnes table 3 sediment exports increased by 60 5 in 2019 however sediment retention decreased by 12 8 the largest contributor to sediment exports in 1990 was farmland which accounted for 82 4 of total sediment exports while bare lands and built up areas contribute 10 9 and 2 9 of the total sediment export respectively the highest contributors to sediment retention in 1990 were farmlands 57 2 shrublands 26 6 and grasslands 12 2 in 1990 there were total exports of 27 456 030 tonnes of nitrogen and 624 670 1 tonnes of phosphorus farmland accounted for most of the phosphate and nitrogen exports in the catchment with p and n exports from cultivated land representing over 90 and 76 8 while exports from grassland built up areas shrublands and bare lands were less than 5 water bodies made up 19 8 the second highest share of the nitrogen export from the research region total sediment export and retention in 2019 were 102 941 914 7 tonnes and 253 939 089 6 tonnes respectively this amount of sediment export was projected to decrease in 2040 under land use change scenarios while sediment retention was shown to increase in 2040 using baseline scenarios i e 2019 farmlands contribute 95 and 90 to sediment export and retention respectively built up areas account for 3 5 and 9 of sediment exports under baseline and land use change scenarios respectively forests grasslands and shrublands were next to farmlands as top contributors to sediment retention under baseline scenarios contributing 5 2 6 and 2 3 respectively similarly forest areas grasslands and shrublands contributed the most to sediment retention at 4 8 2 6 and 1 5 respectively in 2019 total exports of nitrogen and phosphorus were 36 366 443 tonnes and 792 757 7 tonnes this will increase to 36 549 711 tonnes and 839 339 7 tonnes in 2040 under land use change projections the primary source of nitrogen and phosphorus exports is farmland on cultivated land the phosphorus and nitrogen exports represent over 96 and 85 of the total amounts in baseline and simulated change of land use change respectively while on grassland bare lands shrublands and built up areas the nitrogen and phosphorus exports are relatively less than 1 the second largest contributor to nitrogen export in the study area was water bodies which accounted for 14 of total nitrogen exports nonetheless phosphorus and nitrogen exports from forest land grasslands and bare lands are very small hardly affecting nutrient exports in the basin based on results from field water quality collection and analysis the amount of sediment exported at lake tana s outlet was estimated at 784 mg l under baseline scenarios the total nitrate and phosphate exports in the basin were estimated to be 8 8 µg l and 275 8 µg l under baseline scenarios respectively 4 4 2 impact of climate change the amount of exported sediment increases under the rcp4 5 and rcp8 5 scenarios by 8 4 and 17 8 respectively and the amount of retained sediment increased by 8 0 and 17 3 respectively while exports of phosphorus decreased by 2 and 1 9 and exports of nitrogen decreased by 0 6 and 0 5 respectively table 6 total sediment export and retention under climate change rcp4 5 radiative forcing scenarios were 115 917 227 tonnes and 260 036 115 tonnes respectively table 4 this amount of sediment export and retention also increased in rcp8 5 radiative forcing scenarios while sediment retention was increased under rcp8 5 scenarios using rcp4 5 scenarios farmlands contribute 78 and 92 to sediment export and retention respectively as a result of rcp8 5 scenarios farmlands had a 92 contribution to sediment export and 91 to sediment retention forests grasslands and shrublands were next to farmlands as top contributors to sediment retention under rcp4 5 scenarios contributing 4 2 and 1 7 respectively under rcp8 5 scenarios forest areas grasslands and shrublands contributed the most to sediment retention at 4 2 and 1 7 respectively in general farmlands contributed 78 under rcp4 5 and 90 5 under the rcp8 5 radiative force scenarios climate change scenarios resulted in a decrease of both nitrate and phosphorus exports from the basin 4 4 3 combined impacts of climate and land use changes the retention and export of sediment increased due to the integrated effects of climate and land use change in this scenario the percentage of exported sediment increased by 12 6 and 22 3 while the amount of retained sediment increased by 2 4 and 11 2 under the rcp4 5 and rcp8 5 scenarios respectively on the other hand the percentage of nitrogen exported increased by 0 02 and 0 08 while phosphorus exports increased by 4 1 and 4 3 under the rcp4 5 and rcp8 5 scenarios respectively table 6 under this scenarios total sediment and retention were 115 579 532 tonnes and 259 135 244 tonnes under rcp4 5 scenarios and 8 6 and 8 6 125 559 354 tonnes and 281 445 814 tonnes higher under rcp8 5 radiative forcing scenarios table 5 nonetheless under the land use and climate change scenarios farmlands were the largest contributors to sediment export and retention hence farmlands contribute around 90 and 91 1 of the total sediment export and retention under the combined effects of land use and climate change under rcp4 5 radiative forcing scenarios total nitrogen and phosphorus exports are projected to be 36 337 075 tonnes and 824 788 tonnes respectively however under the rcp8 5 they are projected to be 0 1 and 0 1 higher 36 376 918 tonnes and 825 887 tonnes exports of nitrogen and phosphorus respectively similarly to sediment export and retention the highest contributors to nitrogen and phosphorus export were farmlands for instance 84 3 and 85 7 of nitrogen and phosphorus were produced under the rcp4 5 and rcp8 5 scenarios respectively 4 5 sub watershed s sediment and nutrient export mapping and prioritization since it s hard to put conservation measures in place at the same time in all parts of a watershed it s important to find and rank the places where sediment and nutrients leave the watershed in order that future activities can be more targeted therefore the integrate impacts of land use and climate under the rcp8 5 scenario have been used to prioritize sediment and nutrient export conservation planning interventions twelve sub watersheds table 7 were identified to prioritize soil conservation as shown in table 7 the sw 9 sub watershed created 0 9 t ha 1 year 1 of sediment while the sw 6 sub watershed generated 71 1 t ha 1 year 1 of sediment on average out of the 12 sub watersheds that were designated sw6 sw7 sw3 sw6 and sw12 were found to have a high mean annual rate of sediment export table 7 and were given the priority levels of first second third fourth and fifth respectively for conservation planning a total of 637 516 03 ha 42 5 of the whole watershed is covered by these sub watersheds which contribute 75 7 of the sediment export to the watershed each year in order to prioritize sediment retention twelve sub watersheds table 8 were established the annual mean sediment retention rate of the sub watersheds ranged from 2 6 t ha 1 year 1 created by the sw 9 to 38 4 t ha 1 year 1 generated by the sw 7 as shown in table 8 the sw7 sw6 sw12 sw1 and sw2 sub watersheds were given priority levels of first second third fourth and fifth respectively out of the 12 designated sub watersheds due to their modelled high mean annual rate of sediment retention table 8 a total of 713 890 1 ha 47 5 of the whole watershed is covered by these sub watersheds which contribute 81 8 of the sediment retention to the watershed each year twelve sub watersheds tables 9 and 10 were identified to prioritize nitrogen and phosphorus exports the annual mean nitrogen export rate of sub watersheds ranged from 0 2 t ha 1 year 1 for sw 3 to 3 1 t ha 1 year 1 for sw 7 while the mean annual export rate of phosphorus from sub watersheds ranged from 0 2 t ha 1 year 1 produced by sw 5 to 0 09 t ha 1 year 1 generated by sw 7 out of the 12 sub watersheds that were defined sw7 and sw12 were found to have high mean annual rates of nitrogen and phosphorus exports tables 9 and 10 and were given the priority levels of first and second for conservation planning a total of 294 162 8 19 6 of the whole watershed is covered by these sub watersheds which contribute 25 3 of the nitrogen and 30 1 of phosphorus to the watershed each year 5 discussion in this research the export of sediment and nutrients was simulated over a 50 year period using the invest model additionally it examined the relationships between annual patterns of land cover climatic change nutrients and sediment monitoring the quality of water is useful for monitoring ecosystem integrity and determining whether water is suitable for its intended use research has indicated that lake tana s trophic state has steadily changed from mesotrophic to eutrophic as a result of nutrient inputs goshu et al 2017 lake tana faces the threat of sedimentation the shores of the lake and the mouths of rivers are contaminated with faeces and toxic cyanobacteria goshu et al 2017 2020 stave et al 2017 the main sources of nitrogen and phosphorus include sediment fertilizers animal waste and waste from production the primary factors contributing to the decline in water quality in lakes rivers and groundwater are phosphorus and nitrogen entering the water through erosion surface runoff leaching and agricultural drainage yang et al 2019 hence the increase in sediment and nutrient exports is particularly attributed to changes in the land use of the basin in line with this study with mereta et al 2020 reporting that human activities like farming grazing solid waste dumping and clay mining were the main things that affected how much total suspended solids and nutrients were kept in the soil the increase in agricultural land in the basin has augmented the export of sediment and nutrients thereby adversely affecting the water quality of the lake as well as its major tributaries in certain land uses forests grasslands shrublands only a small portion of the sediment is retained it would have significant implications for water quality in general as well as ecosystem services in particular to fix the impacts of change in land use on the export of sediment and nutrients strong corrective steps are needed in line with this study raji et al 2020 highlighted that chemical fertilizers that are used to increase crop yields contain a lot of nitrogen n and phosphorus p if these elements aren t managed well they can seriously harm the water supply the conversion of non agricultural land into farmlands may lead to increased sediment and nutrient transport that is removed from the soil along with surface runoff kandel et al 2023 aneseyee et al 2020a indicated a strong relationship between loss of soil and sediment delivery and the growth of agricultural areas p 0 001 according to han et al 2020 change in land use had a greater impact on nutrient retention climate change was more prominent in the retention of sediment this study has revealed that the combined impacts on the export of sediment and nutrients are quite minor when compared to the impacts of climate change and land use change independently additionally the outcomes demonstrated that between 2001 and 2016 surface runoff and sediment rose by 11 8 and 47 07 respectively therefore the yearly water balance of the watershed is impacted by land cover change pastures grasslands shrublands or barren lands changes in forest land as well as sediment movement from mining fields pastures and buildings could be used to explain changes in sediment and runoff khoi and suetsugi 2014 approximately 2 to 19 t ha 1 year 1 of sediment were exported annually from 14 microdam basins in northern ethiopia haregeweyn et al 2012 sahle et al 2019b also found that sediment exports from the catchment of wabe river the gibe basin ranged from 0 to 33 t ha 1 year 1 aneseyee et al 2020b observed that there is a decline in ecosystem service values due to land conversion which suggests that sustainable development projects should be undertaken to improve the environment the projected export value of sediment was very low as compared to the baseline data the research locations different terrain drainage density elevation climate soil type and condition geology watershed size and level of land use may all be contributing factors to the variances observations made on the ground indicate that soil materials taken from the watershed s steep slopes have collected in the downstream regions these sediment exports led to issues with lake sedimentation water body contamination and silt deposition on working agricultural fields degife et al 2021 according to kulsoontornrat and ongsomwang 2021 differences in lulc types and areas have an effect on the characteristics of the biophysical table and are responsible for fluctuations in nitrogen and phosphorus exports the output of the invest model according to aneseyee et al 2020a shows that soil erodibility particle size rainfall erosivity and cover c are additional factors that affect sediment delivery tools for modelling ecosystem services can help land managers and policymakers evaluate how different management approaches or changes in how land is used will affect the provision of ecosystem services sharps et al 2017 based on the sensitivity analysis it appears that each of these factors contributes differently to soil erosion the parameters alter over time as a result of modifications to the lulc the invest model can also give decision makers useful information about nutrient flows particularly in terms of the relative variances between catchments redhead et al 2018 the analyses of the sediment budget and coastal change provide a framework for evaluating opportunities to boost resilience in a number of coastal land use sectors that are prominent in low lying deltas all over the world grossman et al 2020 chiang et al 2019 also discussed that loads of sediment were primarily influenced by sediment concentration watershed soil properties and typhoon courses large scale development projects the higher watershed the eradication of forests and an excess of sediment gravels that adversely affect river the balance of sediment are just a few examples of the major scouring of siltation in rivers that contribute to many sediment disasters li et al 2018 indicated that the reed canal system was able to remove total nitrogen and total phosphorus during the 1998 irrigation season the duration of conservation structures are further threatened by the severely damaged river banks and bed scours that are frequently brought on by stormflows excessive sediment outputs chiang et al 2019 the proportion of nutrients added to basins that are subsequently exported by rivers to coastal waters may be affected by changes in hydrology climate change river damming or consumptive water use could all have an impact on how rivers discharge in the future tysmans et al 2013 according to johnes 1996 for instance it was noted that the effects of temporal changes in land use and management on water quality in both catchments were taken into account the issues with nutrient retention in wetland ecosystems have been a major theme in a variety of landscape ecological subjects lane et al 2017 agriculture intensification may speed up the rapid disappearance of wetlands by increasing the concentration of sediments and fertilizers in water bodies to ensure there is adequate food for everyone diversification and the coexistence of wetland provisioning and regulatory services can be helpful uwimana 2019 positive net nutrient and sediment yields were found in valley bottoms with ponds reservoirs and a predominance of grass or forest while negative net yields were found in valley bottoms with agricultural land covering leading to net export uwimana 2019 in the different lulc categories there were clear differences in sediment and nutrient yields in order to compare model results with the baseline model result several future climate and land use scenarios were run ecosystem services outcomes mapping and evaluation can support environmental education the development of nature based solutions and the sustainable management of natural resources ruskul et al 2018 so areas with high sediment and nutrient exports are potential targets for restoration the agricultural productivity and the cost of water quality purification is reduced of the sub watershed if restoration is conducted however conservation could focus on areas with low sediment and nutrient exports therefore to maintain ecosystem services sediment and nutrient export and retention areas was maintained in the sub basin of the watershed based on the model outputs it is possible to improve a variety of services such as provisioning services food freshwater regulating services climate regulation water purification cultural services aesthetic educational recreational values and supportive services nutrient cycling soil formation and primary production costanza et al 2014 ruskule et al 2018 after evaluating the integrated and separate effects of land use and climate change on nutrients and sediment yields better land management options were proposed if fertilizers and sediment are kept in the field using better land management techniques the agricultural yield will increase as nutrients and silt are prevented from being carried and deposited in the water the quality of the water has also improved there is a substantial spatial variation in the drivers of change that affect and modify ecosystem functions and processes changes in land use patterns fragmentation of land and agricultural intensification ruskule et al 2018 to predict possible impacts on sediment and nutrient exports and retentions hypotheses of land management land cover change climate change etc need to be simulated surface water quality is crucial for the retention service since it has effects on both the economy and society land use planners at governmental organizations and environmental organizations must understand how ecosystems trap and degrade pollutants before they enter lakes rivers streams and seas to successfully minimize pollution of water according to some studies climate change and land use are amongst the most significant environmental pressures brought on by human activity at many different scales these pressures have a big effect on how well ecosystems do their important jobs like storing carbon regulating water flow and making food and fibre zhan 2015 the study showed that in general under land use changes sediment and nutrient exports are likely to increase while the amount of sediment retained tends to decline in the same way climate change scenarios predict that sediment export and retention tend to increase while nutrient export will go down on the other hand under scenarios of climate and land use change the basin is expected to experience an increase in sediment export and retention as well as nutrient exports 6 conclusion land use and land cover changes between 1990 2019 and 2040 can be accurately classified and identified using post classification comparative change detection methods and supervised classification with maximum likelihood then lulc data were projected using a ca markov chain model for the years 2019 through 2040 therefore land use change projections were considered a variety of social and technological advancements for example certain constraints open water cities and protected areas and factors road slope population was considered the actual 1990 lulc data used as the baseline data and the projected lulc data under three scenarios between 2019 and 2040 were then utilized to quantify ecosystem services in terms of sediment and nutrient exports using the ndr and sdr models furthermore under the rcp4 5 and rcp8 5 scenarios climate change projection utilizing lars wg has been successfully employed to project from cmip5 in order to predict the 2040s under the rcp4 5 and rcp8 5 scenarios models canesm2 csiro mk36 mpi esm mr ipsl cm5a and mri cgcm3 have been used an ensemble means of the five gcms has been utilized to assess the effects of climate change on nutrient and sediment export and retention in order to avoid the uncertainty of these diverse climate model projections the integration of these two scenarios was then taken into consideration for this study to evaluate their effects on nutrient and sediment export and retention after climate change and land use projections in order to measure ecosystem services at the watershed scale especially nutrient and sediment export and to identify priority sub watersheds for sediment and nutrient reduction advanced geospatial models such as the ca markov chain sdr and ndr models climate models such as lars wg can be utilized the findings of this study indicate that not all sub catchments exported the same quantity of sediment and nutrients for instance compared to other sub watersheds sub watersheds seven six twelve and one export the most sediment and nutrients these sub watersheds therefore have the most erodible soil and the most intensive farming practices as well as generally sloping topography and little vegetation cover however sub watersheds nine four five and eight produce less sediment and nutrients have the least erodible soil have better vegetation cover and employ the lower agricultural practices so in order to keep the ecosystem working well ecosystem services need to be restored with a focus on the sub watersheds that export out the most sediment and nutrients ethics approval and consent to participate not applicable credit authorship contribution statement birhan getachew tikuye conceptualization data curation formal analysis funding acquisition investigation methodology project administration resources software supervision validation visualization writing original draft writing review editing laurence gill supervision writing review editing milos rusnak supervision writing review editing busnur r manjunatha supervision writing review editing declaration of competing interest the authors declare that they have no competing interests acknowledgements this research was financially supported by the international foundation for science ifs grant no i2 w 6696 1 we would like to thank the national meteorological services agency of ethiopia and hydrology department of the ministry of water irrigation and electricity of ethiopia and ministry of agriculture for providing the meteorological data discharge data and soil data respectively united states geological survey usgs and https earthexplorer usgs gov were very helpful for downloading elevation and landsat data 
24164,foraging behaviour is known to be a key element in ecology and evolution increased foraging intensity increases energy intake which is useful for growth and reproduction but comes at the cost of higher mortality risk due to increased exposure to predators here we investigate these trade offs through an individual based mechanistic modelling framework adapted to the northeast arctic cod the model incorporates a series of life history traits survival trade offs and heritability which allow evolution to occur and optimal strategies to emerge due to individual trait combinations and their fitness consequences by altering the relationship between foraging intensity and mortality risk we find that increased risk causes evolution towards lower foraging effort leading to lower growth and in turn earlier maturation and a faster pace of life these results build on previous studies by demonstrating behavioural evolution without direct anthropogenic stressors natural mortality among fish is poorly understood and these results highlight an interesting point of further research that could help future modelling approaches make more accurate assumptions about natural mortality and its components keywords eco evolutionary dynamics eco genetic demo genetic agent based data availability data will be made available on request 1 introduction 1 1 the ecology of foraging all animals require energy to survive and reproduce as energy is used in a multitude of processes ranging from basal metabolism to tissue repair and synthesis while some animals can passively acquire energy even when stationary most animals will need to actively seek out food an activity known as foraging foraging provides an interesting behavioural framework to consider the cost benefit of performing an activity emlen 1966 macarthur and pianka 1966 on one hand the more time spent foraging the more energy an individual could feasibly obtain energy that could be used for faster growth stores or reproduction likely leading to more offspring this makes the benefit of foraging clear and had there been no downsides one would expect individuals to forage continuously barring other limitations such as digestive capacity fall and fiksen 2020 however there are costs associated with foraging which take on two primary forms first off foraging is active and requires energy the energy gained must exceed the energy cost to be worth foraging secondly foraging individuals are more exposed to predation since they must venture away from potential hiding spots to find food this leads to an increase in mortality with an increase in foraging effort toms et al 2010 individual differences in willingness to engage in risky behaviour have been found in a wide variety of species harcourt et al 2009 ward et al 2004 wilson et al 1994 this risk taking also includes a willingness to accept greater risks when foraging dammhahn and almeling 2012 which can remain consistent within individuals suggesting that this is an intrinsic trait furthermore studies have highlighted interactions between these behavioural patterns and environmental factors such as temperature biro et al 2010 killen et al 2013 making understanding these behaviours increasingly relevant in our warming climate such traits have been linked to personality often categorised as being either shy or bold toms et al 2010 with risk averse individuals generally categorised as shy and risk accepting individuals being categorised as bold alternative frameworks have also been suggested such as risk taking being characterised by a fear hunger trade off budaev et al 2018 regardless of terminology personality differences are well documented within fish and there is good reason to suspect at least partial heritability of personality traits dochtermann et al 2015 wilson et al 1994 1 2 anticipating evolution fish evolve in response to stressors and the evolution of various life history traits has the potential to not only alter demographic parameters such as growth crozier and hutchings 2014 enberg et al 2012 holt and jørgensen 2014 and age at maturity dieckmann and heino 2007 heino et al 2002b but these changes may in turn affect the relationship between recruitment and indices such as spawning stock biomass enberg et al 2010 which in turn can lead to mismanagement if not accounted for it becomes apparent then that proper consideration of evolution should be included in management and conservation efforts jørgensen et al 2007 given that individuals will differ in willingness to forage under varying degrees of risk and that these differences are heritable we have reason to suspect that time spent foraging and subsequent energy acquisition would evolve in response to varying foraging risk stephens 2008 fig 1 which might vary due to changing community structure or physical environment building on this changes in energy intake might in turn lead to shifts in optimal life history mechanistic models are tools that aim to simulate the natural processes and trade offs that impact survival and subsequent lifetime fecundity when properly calibrated this allows us to calculate optimal strategies for any scenario we wish to test by assuming that strategies maximising lifetime fecundity will be favoured by evolution when changing input parameters such as temperature or foraging risk new optimal strategies might emerge indicating the direction we can expect evolution to drive the population among mechanistic models individual based models ibms sometimes referred to as agent based models are particularly suited to studying evolution as they can simulate evolution by including inter individual variability in inherited traits that influence fitness allowing individuals to reproduce and die according to their life histories e g enberg et al 2009 however to our knowledge no evolutionary ibms for fish have been created that include realistic physiology with oxygen limitation such physiological frameworks have been included in other types of models for instance dynamic optimization holt and jørgensen 2014 but including it in an ibm will allow us to more realistically simulate actual population responses to stressors rather than describing optimal behaviour additionally few evolutionary models have included costs associated with foraging leading to a lack of mechanistic understanding of how risk might impact optimal life history 1 3 aim of the study this study aims to build on previous evolutionary modelling efforts using atlantic cod gadus morhua specifically the northeast arctic nea cod stock as the focal population the nea cod stock is not only commercially important accounting for 796 000 tonnes of catches annually between 2010 and 2020 ices 2021 but is also well researched with a large body of literature available on maturation schedule heino et al 2002b temperature growth response björnsson et al 2007 brander 1995 behaviour freitas et al 2015 as well as expected evolution in response to both climate holt and jørgensen 2014 and fisheries heino et al 2002b jørgensen et al 2007 2009 to name a few through the lens of nea cod we explore the relationship between foraging risk and the evolution of foraging effort and maturation schedule as well as the emerging life histories in doing so we develop an ibm that includes explicit energy budgeting sensitive to temperature suitable for studying evolutionary responses to fisheries and climate as such the model does include complexity that is not strictly necessary to study the effects of foraging risk but is useful for increased versatility in future model applications 2 model description we introduce an individual based model based on the framework previously published by enberg et al 2009 adding explicit energetics and oxygen budget for nea cod within a stochastic food environment drawn mainly from holt and jørgensen 2014 the inclusion of explicit energetics and oxygen budget allows for better accounting of what effect temperature can be expected to have on the population for use in future applications of the model each individual carries traits that impact their life history through maturation growth reproductive investment and mortality while population dynamics and fitness are allowed to emerge from the interactions of all these individuals fig 2 each of these sections are described in more detail below and a full list of parameters can be found in table 1 2 1 purpose the model aims to simulate the evolution of the maturation scheme and somatic energy allocation life history by including genetic traits that influence the phenotypic expression with a measure of stochasticity to mimic environmental variability which impacts survival the model also introduces the inherited trait appetite which takes the form of desired energy intake in turn governing foraging activity as such individuals with high appetites are comparable to bold individuals on the bold shy spectrum toms et al 2010 or hungry individuals in the fear hunger framework budaev et al 2018 while the inverse is true for individuals with low appetites surviving individuals reproduce passing on their genetic traits to the next generation this method allows for evolutionary patterns to emerge over time as individuals with favourable traits will survive and produce more offspring over their lifetimes simulating natural selection using this model we will test evolutionary responses to varying degrees of foraging risk represented by the variable foraging risk exponent e2 as explained below 2 2 process overview the model simulates 2000 years in annual time steps every year individuals are first faced with the possibility of maturing after which energetics are calculated based on trade offs in these sections mortality survival probability is determined recruitment and inheritance is then performed based on gonadal energy allocation followed by model upkeep removing dead individuals and ageing the remaining ones individuals are allowed to live for 20 years after which they are removed and recruits are added as 1 year olds 2 3 initializing the model to initialize the model we first ran it for 5000 years to let the population stabilize using a foraging risk exponent e 2 1 8 explained in more detail below 5000 years is used to make sure that the initial population is evolutionarily stable and does not carry trends into the simulation experiments the risk exponent value e 2 1 8 was chosen because it best replicated observed growth patterns and proportion mature at age when comparing the model against observed data ices 2021 fig 3 from the barents sea and lofoten between 2004 and 2018 while the fit is not perfect it should be noted that the nea cod has been fished for many generations likely explaining this small discrepancy as the proportion of mature individuals better fit with the data from 1946 before fisheries were intensified fig 3 b the resulting population 305 470 individuals was used as a starting point for all future runs for every value of e 2 tested the model was run for 2000 years and each run was done 20 times with different random seeds to act as replicates two thousand years was chosen because that was the earliest point in which inherited traits were stabilised and evolutionary trends were visible 2 4 input the model includes several sources of stochasticity phenotypic expression of genetic traits variability in the food environment temperature and recruitment and offspring variability compared to mid parental values for simplicity all of these are assumed to be normally distributed around their respective values with a standard deviation of 5 except for offspring variability described below as sensitivity analysis showed that none of them were driving results temperature is centred around 4 c which is the average annual temperature in the barents sea as measured along the kola hydrographical transect 0 200 m 1900 2020 boitzov et al 2012 2 5 full process description 2 5 1 maturation the maturation scheme is based on a probabilistic maturation reaction norm pmrn heino et al 2002b shown in eqs 1 3 the probability of maturation for individual i pmat i within year y is dependent on the intercept and slope of the maturation reaction norm 1 p m a t y i 1 1 exp l y i l p 50 i θ where ly is the length of individual i in year y lp 50 is the length at 50 maturity eq 3 and θ is based on reaction norm width as follows 2 θ w l o g i t p u l o g i t p l where w is the pmrn width pu and pl being the upper and lower probability bonds respectively generally set to 0 75 and 0 25 the length at 50 maturity lp 50 is calculated as 3 l p 50 i l i i a g e y 1 i l s where li and ls are the intercept and slope of the reaction norm respectively and agey 1 is the age prior to year y while enberg et al 2009 allowed both intercept li and slope ls to evolve they also found that the evolution of slope added little explanatory value hence in this study only the l1 is an inherited trait slope ls is set to 2 cm year 1 and width w is set to 40 cm as this resulted in a reasonable maturation schedule when compared to available data ices 2021 when interpreting results higher li means late maturation at a larger size while low li means earlier maturation at a smaller size the slope parameter ls influences how dependant the maturation process is on length and age relatively if slope is 0 it is only the size that impacts maturation probability whereas increasingly negative slope values mean that age start playing increasingly important role in the maturation probability for more information on pmrns please refer to heino et al 2002b 2 6 energetics all individuals i forage until they reach their predetermined energy intake ϕ determined as follows 4 ϕ i ζ i w β i where ζ is the appetite described earlier for individual i w is weight and β is an allometric exponent this model then includes a modified energetics framework based on the wisconsin bioenergetics framework hewett and johnson 1992 previously parametrized for nea cod by holt and jørgensen 2014 eqs 5 12 eq 6 modified to account for density dependence for every year a food environment ωy is set 5 ω y χ 1 c d d 1 c d d 2 σ w i where χ 1 is a stochastic function normally distributed around 1 with a standard deviation of 0 05 and σ w is the total population biomass to simulate competition for food density dependence the total energy intake for individual i in any year ϕy i is then determined by 6 ϕ y i ω y c f 1 f i n t i 1 c f 2 f i n t i b s m r i where fint is the foraging intensity which individuals scale to reach the desired energy intake set by ζ and cf 1 and cf 2 are constants for ease of interpretation fint is given in units of standard metabolic rate bsmr based on the food intake we can construct an energy budget for individual i 7 n y i ϕ y i b s d a i b s m r i b ϕ i c r where ny is the net available energy for growth in year y bsda is the energy lost by specific dynamic action digestion etc bsmr is the standard metabolic rate based on weight and temperature bϕ is the energetic cost associated with foraging and cr is the efficiency of converting energy to new tissue bsda bsmr and bϕ are calculated as follows 8 bsda i c sda ϕ y i 9 bsmr i c smr f t w β i 10 b ϕ i c ϕ f i n t i b s m r i where csda csmr and cϕ are constants table 1 and f t is an arrhenius function of temperature 11 f t c t 1 exp c t 2 c t 3 t 273 15 ct 1 ct 2 and ct 3 are constants table 1 the available energy ny is then divided based on the maturity status of the fish for immature fish all the energy is allocated to somatic growth gs 12 g s i n y i ρ s where ρs is the energy density of somatic tissue for mature individuals a somatic growth allocation function pt is used to describe the decreasing allocation to somatic growth as the fish ages quince et al 2008 resulting in increased gonadal allocation 13 p t c d 1 i c d 2 a i a m i where cd 1 is the initial investment to somatic growth cd 2 is the rate of somatic growth allocation decay a is the current age and am is the age at maturation initial investment cd 1 is an evolving trait in the model energy is then divided between somatic growth gs and gonad growth gg as in holt and jørgensen 2014 14 g s i n y i p t ρ s 15 g g i n y i 1 p t b m i ρ g where bm is the energy used for spawning migration and ρg is the energy density of gonadal tissue mature individuals of nea cod undertake annual spawning migrations of 780 km each way to spawn near the lofoten islands opdal et al 2011 bm is modelled based on the swimming speed bioenergetics published by ware et al 1978 where optimal swimming speed is a function of length body lengths per second uopt i cu lb 2 i where cu and b 2 are constants the cost of transport is then calculated as a function of length and optimal swimming speed cm i ccot lb 3 i u opt b 4 i where ccot b 3 and b 4 are constants table 1 the total energetic cost of spawning migration then becomes 16 b m i c m i 2 d m where dm is the migratory distance undertaken twice for the round trip a minimum amount of energy allocated to gonads ny 1 pt is required for the fish to undertake the spawning migration here calculated as having enough energy to reach a gonadosomatic index of at least 0 1 post migration this value was chosen in order to achieve a realistic number of spawning skippers based on personal experience if an individual does not meet this energy threshold it instead allocates all energy to somatic growth and skips spawning for the year growth in length is derived from the growth in weight by allometric scaling 17 w i k l 3 i where k is a constant table 1 in addition to this energy budget the model includes a budget for oxygen adapted from claireaux et al 2000 eqs 18 20 the maximum oxygen uptake vmax of individual i is calculated as 18 v m a x i v 1 t v 2 t v 3 v 4 w s o m b i where v 1 4 are all constants and wsom is the somatic weight excluding gonad weight oxygen consumption vy is defined as the sum of the metabolic processes 19 v y i b sda i b smr i b ϕ i b grow th i where bgrowth is metabolic work associated with converting energy cr 20 v y i b sda i b smr i b ϕ i b grow th i 2 7 mortality since many of the activities accounted for in the energetics section above impact mortality the trade offs must be included in the model as such mortality in the model is split into several compartments based on previous modelling efforts by holt and jørgensen 2014 eqs 21 26 21 z i m pred ation i m ϕ i m repr oduc tion i m resp irat ion i m fixed where mfixed is a fixed rate of size independent natural mortality and the remaining factors are the mortalities associated with predation foraging reproduction and respiration respectively for any given individual i the probability of surviving s i in a given year is 22 s i e x p z i predation mortality is the primary size dependant mortality in the form of the increased risk of being preyed upon as smaller individuals 23 m p r e d a t i o n i c p r e d a t i o n l e 1 i where cpredation and e 1 are constants table 1 and l is the length of the fish in cm foraging mortality comes primarily in the form of increased risk of being preyed upon when increasing foraging intensity fint and is therefore related directly to mpredation 24 m ϕ c ϕ f i n t e 2 i m p r e d a t i o n i where cϕ and e 2 are constants the risk associated with foraging is governed by e 2 the foraging risk exponent which is the focus of this paper by changing e2 we alter the relationship between foraging effort and mortality as seen in fig 4 reproductive mortality relates to decreased swimming capacity due to the change in form factor and additional risk taking behaviour during courtship and mating 25 m r e p r o d u c t i o n i g s i i g s i r e f i e 3 m p r e d a t i o n i where gsiref is the gsi at which mreproduction mpredation and e3 is a constant respiration mortality is the result of limited respiratory capacity in relation to respiratory demand essentially exhaustion 26 m r e s p i r a t i o n i c r e s p i r a t i o n v i v m a x i c 4 m p r e d a t i o n i where crespiration and e 4 are constants table 1 2 8 recruitment the number of recruits in year t is calculated using beverton holt recruitment beverton and holt 1993 based on total fecundity σq i t adapted for atlantic cod by enberg et al 2009 eqs 27 28 as follows 27 n 0 t c r 1 q i t 1 c r 2 q i t e λ r t where cr 1 and cr 2 are constants table 1 determining survival at low fecundity and strength of density dependence respectively and eλr t describes inter annual environmental variability in practice larger individuals are expected to dedicate more energy to gonads making individual fecundity weight dependant inheritance of traits is simplified in the model as it is in enberg et al 2009 due to the often highly polygenic nature of life history traits roff 1993 conner and hartl 2004 for every recruit two parents are chosen from mature individuals by random sampling weighted by gonad growth gg i this makes a fish more likely to be chosen as a parent the more it contributed to the total fecundity of the population evolving traits are then calculated based on mid parental values as shown here for appetite ζ 28 ζ i 1 2 ζ p a r e n t 1 ζ p a r e n t 2 χ 2 where χ 2 is a stochastic function normally distributed around 1 with a standard deviation of 0 14 this stochastic function aims to simulate the effects of mutation segregation and recombination generating heterogeneity in offspring for selection to act upon the standard deviation of 0 14 was chosen as it yielded emergent heritability of approximately 0 2 calculated as the linear correlation between mid parental values and offspring values for both length and age at maturation which is within the range typically seen for life history traits gjedrem 1983 law 2000 carlson and seamons 2008 note that the model does not separate between males and females but only has a single sex this is considered to be an acceptable simplification when male and female life histories and demography are similar dunlop et al 2009 which we believe is the case for nea cod 3 results we found that an increase in foraging risk leads to evolution towards lower appetite and thereby lower growth fig 5 a comparing the runs over time 2000 years appetite rapidly within 250 years diverged and stabilised around new means indicating strong selection the highest mean appetites were found for the lowest risks 16 100 kj kg 1 while increasing risk decreased mean appetite up to 12 14 200 kj kg 1 in the highest risk scenario a consistent trend for all results was that values of foraging risk e 2 between 1 0 and 1 8 were more similar than the highest values e 2 2 2 and 2 6 this is likely because foraging risk increases exponentially with increasing e 2 increasing the foraging risk even higher leads to the population crashing due to too high mortality in the early years results not shown in extension of the reduced appetite growth was consistently lower in the higher risk scenarios as seen by the lower size at age fig 5 b individuals in the lowest risk scenario grow to reach 100 cm in length by age 10 while individuals in the highest risk scenario reached 9 cm there were no clear differences between the three lowest risk scenarios implying that growth is not significantly impacted until risk reaches a certain threshold mortality increased notably in the two high risk scenarios a trend that is particularly apparent for the younger fish fig 5 c likely due to mortality being scaled by length dependant predation mortality eq 23 for the one year old fish the rate of mortality was 0 28 y 1 in the lowest risk scenario but 0 61 y 1 in the highest risk more than a twofold increase while this difference diminishes as the fish ages it doesn t disappear until the fish reaches 14 years of age at which point the fish have already matured and reproduced fig 6 this also translates to a smaller population size measured both as total biomass and as the number of individuals appendix c the changes in energy acquisition and mortality lead to changes in life history specifically by favouring a reduction in pmrn intercept after stabilization fig 6 a in this case the clustering of low risk scenarios compared to high risk scenarios is even more pronounced than for appetite the average intercept for low risk scenarios ranges from 113 to 107 cm while the highest risk scenario leads to an intercept of 95 cm unlike the other evolving traits appetite and pmrn intercept the initial gonadal allocation cd 1 did not seem to change significantly with increasing risk e 2 fig 6 b while the higher e 2 values did at first lead to an increase in the initial allocation allocation started decreasing again once pmrn intercept and appetite had stabilised around year 4 500 appendix b and even when the difference between risks is largest average allocation only differs by 1 percentage point after stabilization differences appear negligible the initial increase in gonadal allocation in high risk scenarios is likely driven by the sudden increase in mortality making investing in reproduction over growth more beneficial once appetite stabilises this pressure is relaxed and allocation once again decreases to see how these changes in pmrn intercept translated into changes in the actual life histories we considered age and length at maturation which follows the same trend fig 6 c d as risk increases mean length and age at maturation decrease with this effect being more pronounced for higher risks however while the overall trend is similar the variability of length and age at maturation is notably higher than for the pmrn intercept implying that other processes also influence the maturation schedule this can happen because the pmrn intercept is directly inherited while the emergent traits such as length age at maturation result from more processes and traits also involving stochasticity this is the case for e g age at maturation which is not directly controlled by the pmrn intercept but is also influenced by appetite that controls energy acquisition which drives growth and in turn maturation 4 discussion we found that with increasing foraging risk evolution selected for lower appetite and earlier maturation both leading to lower growth this is expected as higher mortality associated with energy acquisition should select for individuals with lower appetite which forage less further the fitness benefit associated with late maturation is offset by lower overall survival due to higher foraging risk causing a selection towards earlier maturation while it seems intuitive that an increase in foraging risk and a decrease in energy intake would lead to reduced growth and higher mortality respectively these points still warrant further consideration since we are not enforcing a lower limit for appetite the fish can theoretically maintain lower mortalities even in high risk scenarios by foraging less and accepting slower growth similarly they could have accepted higher mortality risks to maintain growth but it seems that the optimal strategy is a combination of the two these results highlight a critical life history trade off related to optimal foraging behaviour given that overall mortality is higher for smaller individuals a selection towards fast growth early in life mcgurk 1986 shepherd and cushing 1980 ware 1975 motivates foraging however foraging is a risky activity so high foraging effort will lead to higher mortality risk this dissuades foraging stephens 2008 this is further complicated by larger individuals having higher relative fecundity hixon et al 2014 morita et al 1999 further motivating foraging however fisheries may nullify this factor by targeting larger individuals jørgensen et al 2009 a similar trade off has been considered by claireaux et al 2018 who used a dynamic optimization to simulate evolutionary endpoints when fisheries target certain behaviours on the bold shy spectrum they found that any increase in fishing mortality even unselective caused evolution towards reduced growth and age length at maturity however when explicitly targeting bold hungry individuals the selection became stronger and also selected for reduced foraging effort this is an interesting comparison to our study while the sources of mortality predators vs fisheries and the modelling framework ibm vs dynamic optimization differ the experiments are quite analogous increasing mortality disproportionately for foraging individuals in both studies this leads to lower foraging rates and a faster pace of life as such our study expands on claireaux et al 2018 by using an ibm to simulate actual life histories and by showing that this sensitivity to foraging risk is not limited to fisheries but is fundamental to optimal foraging theory it is a commonly found trend that higher mortality leads to earlier maturation e g heino et al 2002a law 2000 2007 jørgensen et al 2009 claireaux et al 2018 andersen et al 2018 when life expectancy is reduced the associated benefits of large body size and late maturation diminish heino et al 2015 this aligns with our findings that high risk scenarios and increased mortality select for earlier maturation life histories adaptation to an increase in external mortality like fishing mortality has been shown to lead to increased natural mortality jørgensen and fiksen 2010 jørgensen and holt 2013 and even though in our study the increase in natural mortality is due to adaptation to higher foraging risk which could be caused by for example increased predator population the bottom line is that while a population is adapting to increased external mortality it can lead to an increase in total natural mortality rates our results along with those of claireaux et al 2018 highlight the need to consider the coupling between energy acquisition and mortality it becomes clear that when mortality is coupled with foraging attempts to decrease mortality risk associated with being small comes at the cost of increased mortality risk from foraging other studies have found that increased selection pressure for small or intermediate sizes e g gillnet fishing can favour later maturation since late maturing fish will more quickly grow out of the vulnerable size range huse 2000 jørgensen et al 2009 stepputtis et al 2016 this trend however is only found at moderate fishing pressure allowing fish to grow past the vulnerable size range in the past couple of decades fisheries selection for behavioural patterns has been getting more attention as different gear types have been shown to select for bold shy behaviour cooke et al 2007 uusi heikkilä et al 2008 biro and stamps 2008 diaz pauli and sih 2017 arlinghaus et al 2017 claireaux et al 2018 as such changes in behavioural patterns and the effects they have on life history evolution are becoming known our results further build on this by showing that the evolution of behaviour e g foraging activity is not limited to direct anthropogenic stressors such as fisheries but can also result from other changes to the ecosystem for instance foraging risk might change due to new species altering community structure or changes in the physical environment that either reduce opportunities for seeking shelter or make foraging more time consuming knowledge of what behavioural phenotype is favoured by natural selection would allow managers to make better informed decisions about which gears to use the current model is an amalgamation of two earlier models an eco evolutionary individual based model with rich population dynamics including density dependence several evolving life history traits but no explicitly physiological relationship climate enberg et al 2009 and an optimization model with detailed physiological mechanisms including oxygen budget holt and jørgensen 2014 even though not fully taken advantage of in the current study this model is a powerful tool for modelling the concurrent contemporary evolution and eco evolutionary dynamics of the nea cod in relation to fishing and climate warming future studies should include investigations of the relative importance of these anthropogenic drivers and which harvest strategies might be most suitable and least harmful for the long term sustainability of the fished population in summary this study shows that increasing foraging risk leads to a decrease in appetite foraging activity and energy acquisition these changes in turn lead to an increase in mortality and subsequent selection for faster life histories this builds on previous studies showing that foraging behaviour is subject to evolution in response to stressors and expands the field by demonstrating that even without direct anthropogenic influence such as fisheries ecological factors may select for bold or shy foraging strategies for fisheries and their managers this avenue of potential evolution should be addressed as knowing which behavioural phenotype is most favoured locally allow for more informed decision making credit authorship contribution statement henrik h jessen methodology software formal analysis writing original draft writing review editing conceptualization anders f opdal conceptualization methodology writing review editing katja enberg conceptualization methodology writing review editing funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we acknowledge funding from the research council of norway afo by the project terracoast rcn 287490 and ke by the project how can fisheries contribute more to a sustainable future rcn 326896 we thank sergei budaev for his help getting the code for the model running and for providing us access to his fortran library and two anonymous reviewers for their comments that significantly improved our manuscript appendix a initial population equilibrium fig a1 appendix b maturation schedule evolution fig b1 appendix c population demography fig c1 
24164,foraging behaviour is known to be a key element in ecology and evolution increased foraging intensity increases energy intake which is useful for growth and reproduction but comes at the cost of higher mortality risk due to increased exposure to predators here we investigate these trade offs through an individual based mechanistic modelling framework adapted to the northeast arctic cod the model incorporates a series of life history traits survival trade offs and heritability which allow evolution to occur and optimal strategies to emerge due to individual trait combinations and their fitness consequences by altering the relationship between foraging intensity and mortality risk we find that increased risk causes evolution towards lower foraging effort leading to lower growth and in turn earlier maturation and a faster pace of life these results build on previous studies by demonstrating behavioural evolution without direct anthropogenic stressors natural mortality among fish is poorly understood and these results highlight an interesting point of further research that could help future modelling approaches make more accurate assumptions about natural mortality and its components keywords eco evolutionary dynamics eco genetic demo genetic agent based data availability data will be made available on request 1 introduction 1 1 the ecology of foraging all animals require energy to survive and reproduce as energy is used in a multitude of processes ranging from basal metabolism to tissue repair and synthesis while some animals can passively acquire energy even when stationary most animals will need to actively seek out food an activity known as foraging foraging provides an interesting behavioural framework to consider the cost benefit of performing an activity emlen 1966 macarthur and pianka 1966 on one hand the more time spent foraging the more energy an individual could feasibly obtain energy that could be used for faster growth stores or reproduction likely leading to more offspring this makes the benefit of foraging clear and had there been no downsides one would expect individuals to forage continuously barring other limitations such as digestive capacity fall and fiksen 2020 however there are costs associated with foraging which take on two primary forms first off foraging is active and requires energy the energy gained must exceed the energy cost to be worth foraging secondly foraging individuals are more exposed to predation since they must venture away from potential hiding spots to find food this leads to an increase in mortality with an increase in foraging effort toms et al 2010 individual differences in willingness to engage in risky behaviour have been found in a wide variety of species harcourt et al 2009 ward et al 2004 wilson et al 1994 this risk taking also includes a willingness to accept greater risks when foraging dammhahn and almeling 2012 which can remain consistent within individuals suggesting that this is an intrinsic trait furthermore studies have highlighted interactions between these behavioural patterns and environmental factors such as temperature biro et al 2010 killen et al 2013 making understanding these behaviours increasingly relevant in our warming climate such traits have been linked to personality often categorised as being either shy or bold toms et al 2010 with risk averse individuals generally categorised as shy and risk accepting individuals being categorised as bold alternative frameworks have also been suggested such as risk taking being characterised by a fear hunger trade off budaev et al 2018 regardless of terminology personality differences are well documented within fish and there is good reason to suspect at least partial heritability of personality traits dochtermann et al 2015 wilson et al 1994 1 2 anticipating evolution fish evolve in response to stressors and the evolution of various life history traits has the potential to not only alter demographic parameters such as growth crozier and hutchings 2014 enberg et al 2012 holt and jørgensen 2014 and age at maturity dieckmann and heino 2007 heino et al 2002b but these changes may in turn affect the relationship between recruitment and indices such as spawning stock biomass enberg et al 2010 which in turn can lead to mismanagement if not accounted for it becomes apparent then that proper consideration of evolution should be included in management and conservation efforts jørgensen et al 2007 given that individuals will differ in willingness to forage under varying degrees of risk and that these differences are heritable we have reason to suspect that time spent foraging and subsequent energy acquisition would evolve in response to varying foraging risk stephens 2008 fig 1 which might vary due to changing community structure or physical environment building on this changes in energy intake might in turn lead to shifts in optimal life history mechanistic models are tools that aim to simulate the natural processes and trade offs that impact survival and subsequent lifetime fecundity when properly calibrated this allows us to calculate optimal strategies for any scenario we wish to test by assuming that strategies maximising lifetime fecundity will be favoured by evolution when changing input parameters such as temperature or foraging risk new optimal strategies might emerge indicating the direction we can expect evolution to drive the population among mechanistic models individual based models ibms sometimes referred to as agent based models are particularly suited to studying evolution as they can simulate evolution by including inter individual variability in inherited traits that influence fitness allowing individuals to reproduce and die according to their life histories e g enberg et al 2009 however to our knowledge no evolutionary ibms for fish have been created that include realistic physiology with oxygen limitation such physiological frameworks have been included in other types of models for instance dynamic optimization holt and jørgensen 2014 but including it in an ibm will allow us to more realistically simulate actual population responses to stressors rather than describing optimal behaviour additionally few evolutionary models have included costs associated with foraging leading to a lack of mechanistic understanding of how risk might impact optimal life history 1 3 aim of the study this study aims to build on previous evolutionary modelling efforts using atlantic cod gadus morhua specifically the northeast arctic nea cod stock as the focal population the nea cod stock is not only commercially important accounting for 796 000 tonnes of catches annually between 2010 and 2020 ices 2021 but is also well researched with a large body of literature available on maturation schedule heino et al 2002b temperature growth response björnsson et al 2007 brander 1995 behaviour freitas et al 2015 as well as expected evolution in response to both climate holt and jørgensen 2014 and fisheries heino et al 2002b jørgensen et al 2007 2009 to name a few through the lens of nea cod we explore the relationship between foraging risk and the evolution of foraging effort and maturation schedule as well as the emerging life histories in doing so we develop an ibm that includes explicit energy budgeting sensitive to temperature suitable for studying evolutionary responses to fisheries and climate as such the model does include complexity that is not strictly necessary to study the effects of foraging risk but is useful for increased versatility in future model applications 2 model description we introduce an individual based model based on the framework previously published by enberg et al 2009 adding explicit energetics and oxygen budget for nea cod within a stochastic food environment drawn mainly from holt and jørgensen 2014 the inclusion of explicit energetics and oxygen budget allows for better accounting of what effect temperature can be expected to have on the population for use in future applications of the model each individual carries traits that impact their life history through maturation growth reproductive investment and mortality while population dynamics and fitness are allowed to emerge from the interactions of all these individuals fig 2 each of these sections are described in more detail below and a full list of parameters can be found in table 1 2 1 purpose the model aims to simulate the evolution of the maturation scheme and somatic energy allocation life history by including genetic traits that influence the phenotypic expression with a measure of stochasticity to mimic environmental variability which impacts survival the model also introduces the inherited trait appetite which takes the form of desired energy intake in turn governing foraging activity as such individuals with high appetites are comparable to bold individuals on the bold shy spectrum toms et al 2010 or hungry individuals in the fear hunger framework budaev et al 2018 while the inverse is true for individuals with low appetites surviving individuals reproduce passing on their genetic traits to the next generation this method allows for evolutionary patterns to emerge over time as individuals with favourable traits will survive and produce more offspring over their lifetimes simulating natural selection using this model we will test evolutionary responses to varying degrees of foraging risk represented by the variable foraging risk exponent e2 as explained below 2 2 process overview the model simulates 2000 years in annual time steps every year individuals are first faced with the possibility of maturing after which energetics are calculated based on trade offs in these sections mortality survival probability is determined recruitment and inheritance is then performed based on gonadal energy allocation followed by model upkeep removing dead individuals and ageing the remaining ones individuals are allowed to live for 20 years after which they are removed and recruits are added as 1 year olds 2 3 initializing the model to initialize the model we first ran it for 5000 years to let the population stabilize using a foraging risk exponent e 2 1 8 explained in more detail below 5000 years is used to make sure that the initial population is evolutionarily stable and does not carry trends into the simulation experiments the risk exponent value e 2 1 8 was chosen because it best replicated observed growth patterns and proportion mature at age when comparing the model against observed data ices 2021 fig 3 from the barents sea and lofoten between 2004 and 2018 while the fit is not perfect it should be noted that the nea cod has been fished for many generations likely explaining this small discrepancy as the proportion of mature individuals better fit with the data from 1946 before fisheries were intensified fig 3 b the resulting population 305 470 individuals was used as a starting point for all future runs for every value of e 2 tested the model was run for 2000 years and each run was done 20 times with different random seeds to act as replicates two thousand years was chosen because that was the earliest point in which inherited traits were stabilised and evolutionary trends were visible 2 4 input the model includes several sources of stochasticity phenotypic expression of genetic traits variability in the food environment temperature and recruitment and offspring variability compared to mid parental values for simplicity all of these are assumed to be normally distributed around their respective values with a standard deviation of 5 except for offspring variability described below as sensitivity analysis showed that none of them were driving results temperature is centred around 4 c which is the average annual temperature in the barents sea as measured along the kola hydrographical transect 0 200 m 1900 2020 boitzov et al 2012 2 5 full process description 2 5 1 maturation the maturation scheme is based on a probabilistic maturation reaction norm pmrn heino et al 2002b shown in eqs 1 3 the probability of maturation for individual i pmat i within year y is dependent on the intercept and slope of the maturation reaction norm 1 p m a t y i 1 1 exp l y i l p 50 i θ where ly is the length of individual i in year y lp 50 is the length at 50 maturity eq 3 and θ is based on reaction norm width as follows 2 θ w l o g i t p u l o g i t p l where w is the pmrn width pu and pl being the upper and lower probability bonds respectively generally set to 0 75 and 0 25 the length at 50 maturity lp 50 is calculated as 3 l p 50 i l i i a g e y 1 i l s where li and ls are the intercept and slope of the reaction norm respectively and agey 1 is the age prior to year y while enberg et al 2009 allowed both intercept li and slope ls to evolve they also found that the evolution of slope added little explanatory value hence in this study only the l1 is an inherited trait slope ls is set to 2 cm year 1 and width w is set to 40 cm as this resulted in a reasonable maturation schedule when compared to available data ices 2021 when interpreting results higher li means late maturation at a larger size while low li means earlier maturation at a smaller size the slope parameter ls influences how dependant the maturation process is on length and age relatively if slope is 0 it is only the size that impacts maturation probability whereas increasingly negative slope values mean that age start playing increasingly important role in the maturation probability for more information on pmrns please refer to heino et al 2002b 2 6 energetics all individuals i forage until they reach their predetermined energy intake ϕ determined as follows 4 ϕ i ζ i w β i where ζ is the appetite described earlier for individual i w is weight and β is an allometric exponent this model then includes a modified energetics framework based on the wisconsin bioenergetics framework hewett and johnson 1992 previously parametrized for nea cod by holt and jørgensen 2014 eqs 5 12 eq 6 modified to account for density dependence for every year a food environment ωy is set 5 ω y χ 1 c d d 1 c d d 2 σ w i where χ 1 is a stochastic function normally distributed around 1 with a standard deviation of 0 05 and σ w is the total population biomass to simulate competition for food density dependence the total energy intake for individual i in any year ϕy i is then determined by 6 ϕ y i ω y c f 1 f i n t i 1 c f 2 f i n t i b s m r i where fint is the foraging intensity which individuals scale to reach the desired energy intake set by ζ and cf 1 and cf 2 are constants for ease of interpretation fint is given in units of standard metabolic rate bsmr based on the food intake we can construct an energy budget for individual i 7 n y i ϕ y i b s d a i b s m r i b ϕ i c r where ny is the net available energy for growth in year y bsda is the energy lost by specific dynamic action digestion etc bsmr is the standard metabolic rate based on weight and temperature bϕ is the energetic cost associated with foraging and cr is the efficiency of converting energy to new tissue bsda bsmr and bϕ are calculated as follows 8 bsda i c sda ϕ y i 9 bsmr i c smr f t w β i 10 b ϕ i c ϕ f i n t i b s m r i where csda csmr and cϕ are constants table 1 and f t is an arrhenius function of temperature 11 f t c t 1 exp c t 2 c t 3 t 273 15 ct 1 ct 2 and ct 3 are constants table 1 the available energy ny is then divided based on the maturity status of the fish for immature fish all the energy is allocated to somatic growth gs 12 g s i n y i ρ s where ρs is the energy density of somatic tissue for mature individuals a somatic growth allocation function pt is used to describe the decreasing allocation to somatic growth as the fish ages quince et al 2008 resulting in increased gonadal allocation 13 p t c d 1 i c d 2 a i a m i where cd 1 is the initial investment to somatic growth cd 2 is the rate of somatic growth allocation decay a is the current age and am is the age at maturation initial investment cd 1 is an evolving trait in the model energy is then divided between somatic growth gs and gonad growth gg as in holt and jørgensen 2014 14 g s i n y i p t ρ s 15 g g i n y i 1 p t b m i ρ g where bm is the energy used for spawning migration and ρg is the energy density of gonadal tissue mature individuals of nea cod undertake annual spawning migrations of 780 km each way to spawn near the lofoten islands opdal et al 2011 bm is modelled based on the swimming speed bioenergetics published by ware et al 1978 where optimal swimming speed is a function of length body lengths per second uopt i cu lb 2 i where cu and b 2 are constants the cost of transport is then calculated as a function of length and optimal swimming speed cm i ccot lb 3 i u opt b 4 i where ccot b 3 and b 4 are constants table 1 the total energetic cost of spawning migration then becomes 16 b m i c m i 2 d m where dm is the migratory distance undertaken twice for the round trip a minimum amount of energy allocated to gonads ny 1 pt is required for the fish to undertake the spawning migration here calculated as having enough energy to reach a gonadosomatic index of at least 0 1 post migration this value was chosen in order to achieve a realistic number of spawning skippers based on personal experience if an individual does not meet this energy threshold it instead allocates all energy to somatic growth and skips spawning for the year growth in length is derived from the growth in weight by allometric scaling 17 w i k l 3 i where k is a constant table 1 in addition to this energy budget the model includes a budget for oxygen adapted from claireaux et al 2000 eqs 18 20 the maximum oxygen uptake vmax of individual i is calculated as 18 v m a x i v 1 t v 2 t v 3 v 4 w s o m b i where v 1 4 are all constants and wsom is the somatic weight excluding gonad weight oxygen consumption vy is defined as the sum of the metabolic processes 19 v y i b sda i b smr i b ϕ i b grow th i where bgrowth is metabolic work associated with converting energy cr 20 v y i b sda i b smr i b ϕ i b grow th i 2 7 mortality since many of the activities accounted for in the energetics section above impact mortality the trade offs must be included in the model as such mortality in the model is split into several compartments based on previous modelling efforts by holt and jørgensen 2014 eqs 21 26 21 z i m pred ation i m ϕ i m repr oduc tion i m resp irat ion i m fixed where mfixed is a fixed rate of size independent natural mortality and the remaining factors are the mortalities associated with predation foraging reproduction and respiration respectively for any given individual i the probability of surviving s i in a given year is 22 s i e x p z i predation mortality is the primary size dependant mortality in the form of the increased risk of being preyed upon as smaller individuals 23 m p r e d a t i o n i c p r e d a t i o n l e 1 i where cpredation and e 1 are constants table 1 and l is the length of the fish in cm foraging mortality comes primarily in the form of increased risk of being preyed upon when increasing foraging intensity fint and is therefore related directly to mpredation 24 m ϕ c ϕ f i n t e 2 i m p r e d a t i o n i where cϕ and e 2 are constants the risk associated with foraging is governed by e 2 the foraging risk exponent which is the focus of this paper by changing e2 we alter the relationship between foraging effort and mortality as seen in fig 4 reproductive mortality relates to decreased swimming capacity due to the change in form factor and additional risk taking behaviour during courtship and mating 25 m r e p r o d u c t i o n i g s i i g s i r e f i e 3 m p r e d a t i o n i where gsiref is the gsi at which mreproduction mpredation and e3 is a constant respiration mortality is the result of limited respiratory capacity in relation to respiratory demand essentially exhaustion 26 m r e s p i r a t i o n i c r e s p i r a t i o n v i v m a x i c 4 m p r e d a t i o n i where crespiration and e 4 are constants table 1 2 8 recruitment the number of recruits in year t is calculated using beverton holt recruitment beverton and holt 1993 based on total fecundity σq i t adapted for atlantic cod by enberg et al 2009 eqs 27 28 as follows 27 n 0 t c r 1 q i t 1 c r 2 q i t e λ r t where cr 1 and cr 2 are constants table 1 determining survival at low fecundity and strength of density dependence respectively and eλr t describes inter annual environmental variability in practice larger individuals are expected to dedicate more energy to gonads making individual fecundity weight dependant inheritance of traits is simplified in the model as it is in enberg et al 2009 due to the often highly polygenic nature of life history traits roff 1993 conner and hartl 2004 for every recruit two parents are chosen from mature individuals by random sampling weighted by gonad growth gg i this makes a fish more likely to be chosen as a parent the more it contributed to the total fecundity of the population evolving traits are then calculated based on mid parental values as shown here for appetite ζ 28 ζ i 1 2 ζ p a r e n t 1 ζ p a r e n t 2 χ 2 where χ 2 is a stochastic function normally distributed around 1 with a standard deviation of 0 14 this stochastic function aims to simulate the effects of mutation segregation and recombination generating heterogeneity in offspring for selection to act upon the standard deviation of 0 14 was chosen as it yielded emergent heritability of approximately 0 2 calculated as the linear correlation between mid parental values and offspring values for both length and age at maturation which is within the range typically seen for life history traits gjedrem 1983 law 2000 carlson and seamons 2008 note that the model does not separate between males and females but only has a single sex this is considered to be an acceptable simplification when male and female life histories and demography are similar dunlop et al 2009 which we believe is the case for nea cod 3 results we found that an increase in foraging risk leads to evolution towards lower appetite and thereby lower growth fig 5 a comparing the runs over time 2000 years appetite rapidly within 250 years diverged and stabilised around new means indicating strong selection the highest mean appetites were found for the lowest risks 16 100 kj kg 1 while increasing risk decreased mean appetite up to 12 14 200 kj kg 1 in the highest risk scenario a consistent trend for all results was that values of foraging risk e 2 between 1 0 and 1 8 were more similar than the highest values e 2 2 2 and 2 6 this is likely because foraging risk increases exponentially with increasing e 2 increasing the foraging risk even higher leads to the population crashing due to too high mortality in the early years results not shown in extension of the reduced appetite growth was consistently lower in the higher risk scenarios as seen by the lower size at age fig 5 b individuals in the lowest risk scenario grow to reach 100 cm in length by age 10 while individuals in the highest risk scenario reached 9 cm there were no clear differences between the three lowest risk scenarios implying that growth is not significantly impacted until risk reaches a certain threshold mortality increased notably in the two high risk scenarios a trend that is particularly apparent for the younger fish fig 5 c likely due to mortality being scaled by length dependant predation mortality eq 23 for the one year old fish the rate of mortality was 0 28 y 1 in the lowest risk scenario but 0 61 y 1 in the highest risk more than a twofold increase while this difference diminishes as the fish ages it doesn t disappear until the fish reaches 14 years of age at which point the fish have already matured and reproduced fig 6 this also translates to a smaller population size measured both as total biomass and as the number of individuals appendix c the changes in energy acquisition and mortality lead to changes in life history specifically by favouring a reduction in pmrn intercept after stabilization fig 6 a in this case the clustering of low risk scenarios compared to high risk scenarios is even more pronounced than for appetite the average intercept for low risk scenarios ranges from 113 to 107 cm while the highest risk scenario leads to an intercept of 95 cm unlike the other evolving traits appetite and pmrn intercept the initial gonadal allocation cd 1 did not seem to change significantly with increasing risk e 2 fig 6 b while the higher e 2 values did at first lead to an increase in the initial allocation allocation started decreasing again once pmrn intercept and appetite had stabilised around year 4 500 appendix b and even when the difference between risks is largest average allocation only differs by 1 percentage point after stabilization differences appear negligible the initial increase in gonadal allocation in high risk scenarios is likely driven by the sudden increase in mortality making investing in reproduction over growth more beneficial once appetite stabilises this pressure is relaxed and allocation once again decreases to see how these changes in pmrn intercept translated into changes in the actual life histories we considered age and length at maturation which follows the same trend fig 6 c d as risk increases mean length and age at maturation decrease with this effect being more pronounced for higher risks however while the overall trend is similar the variability of length and age at maturation is notably higher than for the pmrn intercept implying that other processes also influence the maturation schedule this can happen because the pmrn intercept is directly inherited while the emergent traits such as length age at maturation result from more processes and traits also involving stochasticity this is the case for e g age at maturation which is not directly controlled by the pmrn intercept but is also influenced by appetite that controls energy acquisition which drives growth and in turn maturation 4 discussion we found that with increasing foraging risk evolution selected for lower appetite and earlier maturation both leading to lower growth this is expected as higher mortality associated with energy acquisition should select for individuals with lower appetite which forage less further the fitness benefit associated with late maturation is offset by lower overall survival due to higher foraging risk causing a selection towards earlier maturation while it seems intuitive that an increase in foraging risk and a decrease in energy intake would lead to reduced growth and higher mortality respectively these points still warrant further consideration since we are not enforcing a lower limit for appetite the fish can theoretically maintain lower mortalities even in high risk scenarios by foraging less and accepting slower growth similarly they could have accepted higher mortality risks to maintain growth but it seems that the optimal strategy is a combination of the two these results highlight a critical life history trade off related to optimal foraging behaviour given that overall mortality is higher for smaller individuals a selection towards fast growth early in life mcgurk 1986 shepherd and cushing 1980 ware 1975 motivates foraging however foraging is a risky activity so high foraging effort will lead to higher mortality risk this dissuades foraging stephens 2008 this is further complicated by larger individuals having higher relative fecundity hixon et al 2014 morita et al 1999 further motivating foraging however fisheries may nullify this factor by targeting larger individuals jørgensen et al 2009 a similar trade off has been considered by claireaux et al 2018 who used a dynamic optimization to simulate evolutionary endpoints when fisheries target certain behaviours on the bold shy spectrum they found that any increase in fishing mortality even unselective caused evolution towards reduced growth and age length at maturity however when explicitly targeting bold hungry individuals the selection became stronger and also selected for reduced foraging effort this is an interesting comparison to our study while the sources of mortality predators vs fisheries and the modelling framework ibm vs dynamic optimization differ the experiments are quite analogous increasing mortality disproportionately for foraging individuals in both studies this leads to lower foraging rates and a faster pace of life as such our study expands on claireaux et al 2018 by using an ibm to simulate actual life histories and by showing that this sensitivity to foraging risk is not limited to fisheries but is fundamental to optimal foraging theory it is a commonly found trend that higher mortality leads to earlier maturation e g heino et al 2002a law 2000 2007 jørgensen et al 2009 claireaux et al 2018 andersen et al 2018 when life expectancy is reduced the associated benefits of large body size and late maturation diminish heino et al 2015 this aligns with our findings that high risk scenarios and increased mortality select for earlier maturation life histories adaptation to an increase in external mortality like fishing mortality has been shown to lead to increased natural mortality jørgensen and fiksen 2010 jørgensen and holt 2013 and even though in our study the increase in natural mortality is due to adaptation to higher foraging risk which could be caused by for example increased predator population the bottom line is that while a population is adapting to increased external mortality it can lead to an increase in total natural mortality rates our results along with those of claireaux et al 2018 highlight the need to consider the coupling between energy acquisition and mortality it becomes clear that when mortality is coupled with foraging attempts to decrease mortality risk associated with being small comes at the cost of increased mortality risk from foraging other studies have found that increased selection pressure for small or intermediate sizes e g gillnet fishing can favour later maturation since late maturing fish will more quickly grow out of the vulnerable size range huse 2000 jørgensen et al 2009 stepputtis et al 2016 this trend however is only found at moderate fishing pressure allowing fish to grow past the vulnerable size range in the past couple of decades fisheries selection for behavioural patterns has been getting more attention as different gear types have been shown to select for bold shy behaviour cooke et al 2007 uusi heikkilä et al 2008 biro and stamps 2008 diaz pauli and sih 2017 arlinghaus et al 2017 claireaux et al 2018 as such changes in behavioural patterns and the effects they have on life history evolution are becoming known our results further build on this by showing that the evolution of behaviour e g foraging activity is not limited to direct anthropogenic stressors such as fisheries but can also result from other changes to the ecosystem for instance foraging risk might change due to new species altering community structure or changes in the physical environment that either reduce opportunities for seeking shelter or make foraging more time consuming knowledge of what behavioural phenotype is favoured by natural selection would allow managers to make better informed decisions about which gears to use the current model is an amalgamation of two earlier models an eco evolutionary individual based model with rich population dynamics including density dependence several evolving life history traits but no explicitly physiological relationship climate enberg et al 2009 and an optimization model with detailed physiological mechanisms including oxygen budget holt and jørgensen 2014 even though not fully taken advantage of in the current study this model is a powerful tool for modelling the concurrent contemporary evolution and eco evolutionary dynamics of the nea cod in relation to fishing and climate warming future studies should include investigations of the relative importance of these anthropogenic drivers and which harvest strategies might be most suitable and least harmful for the long term sustainability of the fished population in summary this study shows that increasing foraging risk leads to a decrease in appetite foraging activity and energy acquisition these changes in turn lead to an increase in mortality and subsequent selection for faster life histories this builds on previous studies showing that foraging behaviour is subject to evolution in response to stressors and expands the field by demonstrating that even without direct anthropogenic influence such as fisheries ecological factors may select for bold or shy foraging strategies for fisheries and their managers this avenue of potential evolution should be addressed as knowing which behavioural phenotype is most favoured locally allow for more informed decision making credit authorship contribution statement henrik h jessen methodology software formal analysis writing original draft writing review editing conceptualization anders f opdal conceptualization methodology writing review editing katja enberg conceptualization methodology writing review editing funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we acknowledge funding from the research council of norway afo by the project terracoast rcn 287490 and ke by the project how can fisheries contribute more to a sustainable future rcn 326896 we thank sergei budaev for his help getting the code for the model running and for providing us access to his fortran library and two anonymous reviewers for their comments that significantly improved our manuscript appendix a initial population equilibrium fig a1 appendix b maturation schedule evolution fig b1 appendix c population demography fig c1 
