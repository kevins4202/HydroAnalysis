index,text
23845,it is well known that ocean acidification oa inhibits growth of marine calcifying organisms therefore the adverse effects of acidification on marine ecosystems and aquaculture such as oyster farming are of concern since eelgrass beds in neritic areas have a high potential for carbon assimilation this study focuses on local scale mitigation of oa effects using a three dimensional lower trophic system ecosystem model we modeled nitrogen and carbon cycles and the dynamics of carbonate parameters in a subarctic shallow lagoon and bay where nitrogen availability limits the photosynthesis of primary producers simulation of the present conditions allowed reproduction of spatiotemporal variations in water quality and by assuming future environmental changes quantitatively revealed that the progress of oa significantly elevated the probability of shell malformation in juvenile oysters the results represent the spatiotemporal variations in carbonate parameters inside and outside eelgrass beds and enable the evaluation of the alleviation effect on local acidification by the presence of a dense eelgrass bed our study shows that in the absence of the eelgrass bed scenario the effect of oa on oysters became more remarkable the simulations revealed that maintaining eelgrass beds is essential to mitigate the effects of acidification on oysters keywords ocean acidification mitigation ecosystem model material cycle eelgrass oyster 1 introduction the intergovernmental panel on climate change intergovernmental panel on climate change ipcc 2019 suggests that an increase in emissions of greenhouse gases such as carbon dioxide co2 results in climate change approximately 30 of the emitted anthropogenic co2 is absorbed by the oceans which contributes to the alleviation of global warming orr et al 2005 the elevation of co2 concentrations not only changes the chemical composition of seawater i e ocean acidification oa but can also directly affect some marine organisms doney et al 2009 because oa increases the energetic cost of calcification fabry et al 2008 wood et al 2008 the resultant growth inhibition of marine calcifiers and shifts in ecosystem structure have become issues of concern orr et al 2005 doney et al 2009 kroeker et al 2013 agostini et al 2018 oa affects not only natural ecosystems but also aquaculture and laboratory experiments that have projected future co2 conditions have shown potential negative impacts on bivalve survival and growth e g kurihara et al 2007 range et al 2011 barton et al 2012 guo et al 2016 this is especially problematic as bivalves are cultured in many areas of the world and oysters are one of the most productive and important species botta et al 2020 results of several laboratory experiments evaluating the effects of acidification on oysters have shown that acidification significantly inhibits initial growth and causes malformation kurihara et al 2007 barton et al 2012 barros et al 2013 waldbusser et al 2013 shell malformations can have a significant impact on the oyster population miller et al 2020 mass mortality of oysters due to upwelling of low ph bottom water has also been reported on the california coast hollarsmith et al 2020 these concerns about the impact of oa on aquaculture production or ecosystems can begin to be addressed through regional impact assessments although the negative effects on calcified organisms have been studied increased co2 may also promote the photosynthetic activity of primary producers such as microalgae and seagrasses e g beer and koch 1996 thom 1996 shi et al 2009 buapet et al 2013 under conditions of progressing acidification the high photosynthetic rate of primary producers is expected to increase ph and mitigate the negative effects on shellfish therefore it is important to quantitatively project future changes in the complex responses brought about by the increase in co2 concentration especially how it affects water quality and primary production and evaluate its effects on bivalves seagrass meadows that form in shallow and calm coastal areas have high levels of primary productivity duarte and chiscano 1999 this community has a variety of ecosystem functions such as nutrient uptake nurseries for juvenile fish and lessening the effects of wave and sediment resuspension short and mcroy 1984 heck et al 2003 hasegawa et al 2008 eelgrass beds which are widely distributed from the temperate to subarctic zones of the northern hemisphere green and short 2003 have significant potential over the long term for storage of carbon from the air into sediment via settling and sedimentation of organic carbon that they produce in this way they contribute to the carbon cycle for sequestration in coastal areas fourqurean et al 2012 garrard and beaumont 2014 tokoro et al 2014 najjar et al 2018 the dynamics of carbonate parameters such as ph are more complex in coastal areas especially in seagrass beds and river mouth areas than in the open ocean hofmann et al 2011 since the mechanism of variation of carbonate parameters may depend on the physicochemical conditions and ecosystem structure a separate evaluation should be conducted for each area although local mitigation effects of seagrass photosynthesis on oa have been reported through laboratory experiments and in situ observations hendriks et al 2014 koweek et al 2018 it is difficult to evaluate the effect on a regional scale 1 km using these methods in such cases numerical models three dimensional hydrodynamic ecosystem coupled models validated with observed data are advantageous although there are several studies on the dynamics of both the carbon cycle and carbonate parameters focusing on coastal areas e g omstedt et al 2009 sohma et al 2018 shen et al 2019 fujii et al 2021 it is essential to build a model that meets the specific characteristics of the region using models that represent regionally specific ecosystems we will be able to assess the role of seagrass beds in acidifying environments and the effects of acidification on bivalves in the western north pacific oa has been observed in monitoring surveys since the 1980s ono et al 2019 a long term downward trend in ph has also been reported in the coastal areas of japan ishizu et al 2019 for this study we focused on akkeshi ko lagoon and akkeshi bay both located in eastern hokkaido northern japan fig 1a eelgrass beds are widely distributed throughout the lagoon namba and nakaoka 2018 in addition bivalve aquaculture pacific oyster and manila clam is conducted in the lagoon and bay abe et al 2015 smith et al 2018 abe 2021 this makes it suitable for assessing the role of eelgrass beds in mitigating acidification as well as the impact of acidification on the growth and survival of bivalves fig 1b c although there is neither long term observational data to indicate the progress of acidification in the lagoon and bay nor reports on the effects of acidification on aquaculture it is essential to conduct a forecast evaluation in light of future changes the first aim of this study was to comprehend the dynamics of the present spatial temporal inorganic carbon system parameters dic dissolved inorganic carbon ta total alkalinity pco2 partial pressure of co2 ω arg aragonite saturation state in an estuarine system the second was to project future changes under different representative concentration pathway rcp scenarios using ecosystem modeling and then evaluate the effects on oyster malformation the final aim was to quantitatively estimate the role of eelgrass beds in mitigating the effects of acidification on oyster malformation 2 material and methods 2 1 study site akkeshi ko lagoon 32 km2 is shallow with a mean depth of ca 1 5 m three rivers bekanbeushi obetsu and oboro rivers flow into the northwestern part of the lagoon and the largest inflow river is the bekanbeushi river akabane et al 2003 open ocean water also inflows via a narrow channel ca 500 m from akkeshi bay 102 km2 which faces the pacific ocean monthly precipitation ranges from 50 to 200 mm with maximum between july and october however there are no apparent wet and dry seasons eelgrass beds are distributed over most of the lagoon except in river mouths hasegawa et al 2007 namba and nakaoka 2018 although the abundance and biomass may change across seasons and years seasonal and interannual changes in the distribution area are not apparent momota and nakaoka 2017 biodiversity center of japan ministry of the environment 2018 there is intensive aquaculture of both pacific oyster magallana gigas and manila clam ruditapes philippinarum in the study areas fig 1b c oysters especially are cultivated in almost all areas of the lagoon except for the river mouths and the center of the bay these bivalves have a significant impact on the material cycle of the lagoon through their filtration and excretion abe et al 2015 abe 2021 there are a number of characteristics of the study area including the mixing of river water with coastal water and the influence of eelgrass beds and bivalves on the material cycle isada et al 2021 fig 1c for this area a lower trophic ecosystem model focusing on the role of eelgrass beds yoon et al 2011 and microalgae abe 2016 on the growth of oysters abe 2021 and clams abe et al 2015 has been applied furthermore since very little attention has been paid to the dynamics of carbonate parameters and their modeling this study focuses on the dynamics of both carbon and nitrogen this is especially important because in subarctic estuarine waters photosynthesis by primary producers is often limited more by availability of din than that of dic e g moore et al 2013 cloern et al 2014 furthermore quantifying nitrogen dynamics is also important for understanding the material cycle 2 2 field observations field surveys of the akkeshi ko lagoon and akkeshi bay were conducted prior to constructing the ecosystem model these were key to understanding the spatiotemporal variability of water quality and to obtaining data for initial conditions boundary conditions and validation of the model sampling stations were established in the lagoon bay and inflow rivers fig 1 further monthly observations for water quality were conducted from april to november 2017 by using a conductivity temperature depth ctd profiler astd 102 jfe advantech to obtain vertical profiles 0 1 m intervals of water temperature and salinity the surface temperature and salinity of the rivers was measured using a hand held conductivity and salinity meter ec300 a ysi surface waters at all stations were sampled using a bucket and bottom waters were obtained using a van dorn water sampler at ab16 bay mouth n 1 in the event that water sampling at the bay mouth could not be conducted due to bad weather e g april 2017 water sampling was conducted in multiple layers at the station closest to the bay mouth the measurement items for the water samples were chlorophyll a chl a dissolved inorganic nutrients see below dissolved organic carbon doc dissolved organic nitrogen don particulate organic carbon poc particulate organic nitrogen pon dic concentrations and ta water samples were filtered using disposable membrane filters 0 45 μ m pore size dismic 25cs advantec and stored in a deep freezer 80 c until analysis nutrient nh4 n no2 n no2 no3 n po4 p and sio2 si and total dissolved nitrogen tdn concentrations were measured colorimetrically using a continuous flow injection analyzer aacs 4 bl tech following the method described by strickland and parsons 1972 the don concentration was determined by subtracting the sum of inorganic nitrogen from the tdn concentration to determine chl a concentration of the water a known volume of water sample was filtered using a whatman gf f filter 0 70 μ m pore size the filter was soaked in 6 ml of n n dimethylformamide dmf in a test tube and stored in a deep freezer suzuki and ishimaru 1990 then a fluorometer 10 au turner design was used to determine the concentration in the supernatant of the tube according to the welschmeyer method welschmeyer 1994 for the doc analysis water samples were filtered through precombusted gf f filters doc samples were then filtered directly into precombusted glass vials fixed with 50 μ l of 2n hcl and stored in the laboratory the measurements were performed using a shimadzu toc v cph analyzer for analyses of poc and pon a known volume of seawater was filtered through a 47 mm precombusted 450 c 5 h gf f filter after the elimination of the inorganic carbon remaining on the filter by fuming with hcl it was dried in a vacuum desiccator the poc and pon concentrations were measured simultaneously using an elemental analyzer na1500 fison samples for carbonate parameters were dispensed into 250 ml schott duran bottles which following protocol suggested in dickson et al 2007 were poisoned with mercuric chloride 200 μ l per bottle this was done to prevent changes in dic due to biological activity the ta and dic concentrations were determined using a batch sample analyzer att 15 kimoto electric all carbonate parameters except ta and dic were estimated using co2sys excel macro lewis and wallace 1998 pierrot et al 2006 provided by the carbon dioxide information analysis center cdiac the following available inputs were used set of constants k 1 and k 2 from mehrbach et al 1973 refit by dickson and millero 1987 khso4 dickson 1990 ph scale nbs scale mol kg 1 seawater and total boron uppström 1974 data of normalized ta nta to salinity of 35 were derived using the ctd salinity data since the changes in nta are caused by processes such as caco3 skeleton formation and biological degradation influences other than physical dilution can be inferred to evaluate the effects of mixing and dilution processes of river water and open ocean water for ta dic and doc regression equations with salinity were developed for each month following song et al 2013 2 3 numerical simulation 2 3 1 model configuration a lower trophic ecosystem model fig 2 coupled to a three dimensional hydrodynamic model princeton ocean model blumberg and mellor 1987 was used to simulate the spatiotemporal variations in nitrogen and carbon the model domain covered akkeshi ko lagoon and akkeshi bay and the area ca 20 km 11 km was discretized horizontally using a uniform mesh of 42 23 cells of 475 m resolution fig 3a b vertical discretization was based on eight vertical equidistant levels sigma coordinates the open boundary was set between the akkeshi bay and the pacific ocean the time step of the model was 2 s for the external mode 2d and 60 s for the internal model 3d the simulation period was limited to between april and november due to the ice cover in winter over most of the lagoon it is important to note that the model did not perform calculations for the winter season when ω arg is particularly low in subarctic seas e g fujii et al 2021 the ecosystem model considered the interaction between biochemical elements table 1 in the water column and sediments fig 2 and then simulated the spatiotemporal variability of each element this ecosystem model was based on one developed to represent the ecosystem and material cycles of the lagoon and bay yoon et al 2011 abe et al 2015 abe 2016 2021 phytoplankton phy aboveground eelgrass eel ag and epiphytes epi in the water column and microphytobenthos and belowground eelgrass eel bg in the sediment were included kasim and mukai 2006 revealed that the community composition of microalgae in the water column of the lagoon was dominated by diatoms and that in addition to phytoplankton centric diatoms resuspended benthic microalgae pennate diatoms were dominant therefore the resuspension process of microphytobenthos has also been considered abe et al 2015 we considered zooplankton zoo oysters oys and clams mc as consumers the distribution areas of the eelgrass bed oyster and clam are shown in fig 3 the model assumes that the distribution areas of the organisms do not change with the seasons although oysters and clams are calcifying organisms that are likely to be strongly affected by acidification in the study area the reasons for only evaluating the effects on oysters are presented at the end of section 2 3 4 since photosynthesis of the primary producer is limited by the din concentration in the study area hasegawa et al 2001 2005 it is necessary to simulate the nitrogen dynamics simultaneously when considering carbon dynamics details of the hydrodynamic and nitrogen models can be found in yoon et al 2011 abe et al 2015 and abe 2016 2021 the calculation method for the carbon cycle and carbonate parameter dynamics is described hereafter 2 3 2 carbon cycle model direct measurement of carbonate parameters of seawater is possible for total alkalinity ta dic ph and partial pressure of co2 pco2 or fco2 however if two of these four carbonate parameters can be observed the other two parameters can be derived based on the chemical equilibria of carbonate parameters in seawater zeebe and wolf gladrow 2001 in our ecosystem model dic was simulated ta was estimated from salinity and the other parameters were obtained using the program released by oregon state university https andreasschmittner github io models mobi index html accessed on august 26 2021 while ta fluctuates based on variables such as photosynthesis respiration and calcium dissolution precipitation zeebe and wolf gladrow 2001 a strong positive correlation is typically found between salinity and ta in regions of freshwater influence rofi millero et al 1998 schneider et al 2007 fassbender et al 2017 because of the large salinity gradient between the akkeshi ko lagoon and the akkeshi bay ta in the model was estimated from modeled salinity using the relationship between observed salinity in the range of 12 1 33 4 obtained by ctd and ta ta μ mol kg 1 49 102 salinity 619 67 r 0 99 p 0 001 n 121 fig s 1 by using this conversion formula ta can be estimated with high accuracy leading to an improvement in the computational accuracy of the carbon model as shown in table 1 and fig 2 the ecosystem model computed changes in dic concentrations while other factors necessary for calculating calcium carbonate saturation were computed in a separate program the chemical equilibria for co2 hco 3 bicarbonate ion and co 3 2 carbonate ion composing dic are expressed as follows co 2 h 2 o h 2 co 3 h 2 co 3 h hco 3 hco 3 h co 3 2 co 2 co 2 a q h 2 co 3 the formation of caco3 is difficult when the co 3 2 concentration decreases the saturation state of caco3 ω arg is expressed as follows ca 2 co 3 2 caco 3 ω a r g ca 2 co 3 2 k s p where k sp is the stoichiometric solubility product for the mineral phase of caco3 aragonite and the value of k sp is also influenced by temperature and salinity thus ω arg can vary without any change in the carbonate concentration ω arg values greater than 1 indicate that aragonite precipitation is thermodynamically favored over aragonite dissolution the reverse is true for values less than 1 carter et al 2014 time variations in dic doc and poc in the water column except for advection and diffusion processes were calculated as follows fig 2b d d i c d t e x c h a n g e b e t w e e n a i r a n d w a t e r c o l u m n m i n e r a l i z a t i o n o f d o c a n d p o c p h o t o s y n t h e s i s r e s p i r a t i o n e x c h a n g e b e t w e e n w a t e r c o l u m n a n d s e d i m e n t d d o c d t m i n e r a l i z a t i o n i n t o d i c d e c o m p o s i t i o n e x t r a c e l l u l a r e x c r e t i o n e x c h a n g e b e t w e e n w a t e r c o l u m n a n d s e d i m e n t d p o c d t d e c o m p o s i t i o n i n t o d o c m i n e r a l i z a t i o n i n t o d i c e g e s t i o n m o r t a l i t y g r a z i n g s e t t l i n g the relationship between the co2 concentration in air ppm and the partial pressure of co2 in surface water pco2 μ atm is described as follows p c o 2 p e c o 2 where p pa is the air pressure and e pa is the water vapor pressure the air sea co2 flux was computed using the following equation co 2 f l u x α k δ p co 2 where α mmol m 3 μ atm 1 is the solubility of co2 in seawater k m day 1 is the gas exchange rate for co2 and δ pco2 μ atm is the difference between air and surface water pco2 parameters α and k were calculated according to weiss 1974 and wanninkhof 2014 respectively α is expressed as a function of water temperature and salinity and k is a function of water temperature and wind speed an eelgrass submodel calculating the above and belowground biomass and nitrogen content of leaves was developed in abe 2016 the structure of the submodel and the results of verification of calculation accuracy are described in supplement b in this section we explain how we improved the model by considering the effects of acidification the photosynthesis rate was controlled by the water temperature light intensity and din availability in the model direct uptake of gaseous co2 by submerged eelgrass leaves leuschner et al 1998 watanabe and kuwae 2015b was not considered in our model since an increase in dic concentration can promote eelgrass growth beer and koch 1996 thom 1996 zayas santiago et al 2020 the dic limitation function was also considered the photosynthesis rate of aboveground eelgrass is expressed as follows p h o t o s y n t h e s i s a g μ e e l a g μ v m a x f t f i f n c o n f d i c where μ day 1 is the growth rate v max day 1 is the maximum growth rate f t f i f n c o n and f dic no dimension are the limitation indices for water temperature light intensity nitrogen availability obtained from the nitrogen content of leaves and dic concentration respectively and eel ag is aboveground biomass f dic was obtained according to the relationship between dic concentration and eelgrass photosynthetic rate beer and koch 1996 f d i c 1 1478 log d i c 7 6149 we did not consider the effect of dic concentration on photosynthetic rate for primary producers other than eelgrass phytoplankton epiphytes and microphytobenthos following previous studies that discussed the relationship between the carbon uptake rate of diatoms and carbonate parameters kim et al 2006 yang and gao 2012 the other biogeochemical processes affecting the carbon cycle such as respiration by living organisms i e dic release decomposition poc into doc and mineralization poc into dic and doc into dic closely followed the same equations used for nitrogen and carbon flux of each cycle which were derived from each individual c n ratio for example the applied c n molar ratios of each primary producer were 7 0 for phytoplankton redfield et al 1963 11 0 for epiphytes hasegawa et al 2007 and 15 7 43 9 for eelgrass leaves yoon et al 2011 in the model the c dw of eelgrass ranged from 33 2 to 35 9 with slight seasonal variations yoon et al 2011 ecosystem models calculate nitrogen and carbon fluxes but the biomass of microalgae is often expressed in terms of chl a in our model different types of microalgae were given different ratios of c chl a as follows 50 0 1 for phytoplankton kawamiya et al 1995 43 0 1 for epiphytes hasegawa et al 2007 and 33 7 1 for microphytobenthos montani et al 2003 multiple year classes were considered in the oyster and clam submodels and individual weights and densities were calculated for each year class abe et al 2015 abe 2021 the amount of carbon based organic matter uptake was calculated from the filtration rate and the organic matter concentration release rates for dic and poc were calculated on a nitrogen basis and converted to carbon using the cn molar ratios of the respective bivalves 6 16 for oyster and 4 84 for clam 2 3 3 calculation scenario the calculation scenarios are listed in table 2 the year 2017 when monthly routine observations were conducted section 2 2 was selected as the standard case case 1 2017 pv the concentrations of dic doc and poc at the open boundary and rivers in the 2017 calculations were set based on monthly observations table 3 the model performance was confirmed based on this case two different ipcc ar5 rcp scenarios were used for future projections rcp2 6 mitigation scenario and rcp8 5 business as usual scenario moss et al 2010 which provide projections till the 2090s are referred to as case 2 2090s rcp2 6 pv and case 3 2090s rcp8 5 pv respectively apart from oa climate change is expected to cause a variety of environmental changes such as increased water temperature sea level rise and water quality changes intergovernmental panel on climate change ipcc 2019 it is desirable to cover these phenomena when conducting rigorous forecasting however in addition to the difficulty of preparing all the boundary conditions changing too many calculation conditions would have diverted the purpose of the study and made it infeasible to verify the acidification mitigation effect of the presence of eelgrass beds therefore in the present study only the response to acidification was evaluated as part of future projections for simplicity only gaseous co2 and dic concentrations for the rivers and the open boundary were changed i e adding the increase compared to the standard case based on the same conditions described in nakamura et al 2018 table 2 to evaluate the role of eelgrass beds eelgrass and epiphytes pv presence of vegetation in the material cycle and water quality variation simulations that did not include the eelgrass bed av absence of vegetation were carried out as a sensitivity analysis case 4 2017 av case 5 2090s rcp8 5 av in the av calculation case the conditions of physical parameters such as bottom roughness were not changed in the hydrodynamics simulation 2 3 4 model validation and evaluation of oa impact model performance was assessed by comparing the simulated results with the observed values water temperature salinity no3 nh4 chl a dic doc poc ta ph pco2 and ω arg in the surface water at ab08 bay center al1 lagoon mouth al2 lagoon center and al5 inner lagoon fig 3c ab08 al2 and al5 are located within the oyster farm of which eelgrass is distributed in al2 and al5 al1 is a location that is strongly affected by the mixing of river water and seawater from the bay a quantitative evaluation of model performance using the bias bias and root mean square error rmse was also conducted these two indices are calculated as follows b i a s 1 n i 1 n s i o i r m s e 1 n i 1 n s i o i 2 where n represents the number of model observation data pairs and s and o represent the simulation and observation respectively the poc concentrations obtained from the water samples during field observations included various suspended solids such as living microalgae and detritus that were collected by the filter in the model several sources of poc were considered fig 2 one of which was detritus from eelgrass it should be noted that the model does not distinguish between freshly withered leaves and finely decomposed leaves therefore when comparing the observed poc concentration with the value obtained by the simulation it may overestimate the simulated poc concentration when considering freshly withered eelgrass leaves to verify the accuracy of the calculation we decided to express simulated poc concentrations both with and without detritus derived from eelgrass see fig 5c after the model validation the impact of acidification was evaluated based on the following three indices i water quality mainly carbonate parameters ii primary production and iii early shell development of oysters the proportion of abnormally developed shells malformation p abn was calculated as follows waldbusser et al 2015 p a b n 1 0 610 1 ω a r g 0 820 5 753 according to this equation p abn ranges from 0 39 to 1 0 39 100 moreover kurihara et al 2007 reported on the relationship between ph and oyster larval growth with results suggesting that reduced larval size at ph values less than 7 4 due to inhibition of shell synthesis although experimental results on the effects of acidification on oyster shell growth rate i e calcification rate have been reported previously e g gazeau et al 2007 no findings quantifying the effects over several years from larval to harvest size were available in addition since the calculation period in this study was from april to november it could not represent the dynamics in winter when ω arg is particularly low in the subarctic region fujii et al 2021 we aimed to assess the risk of early growth in the lagoon and bay however our simulations using the two indices presented in waldbusser et al 2015 and kurihara et al 2007 may overestimate the impact of acidification though clams are cultured in the lagoon effective indicators of acidification effects on clams could not be obtained and the reproducibility of carbonate parameters in the tidal flat and pore water where clams are cultured could not be verified therefore no evaluation of acidification effects on clams was conducted in this study 3 results 3 1 spatiotemporal variations in water quality by field observations results of this study showed large spatiotemporal variations in water quality figs s 2 and 4 there was a marked seasonal variation in water temperature and a considerable spatial variation between temperatures in the central and inner parts of the lagoon during the summer months fig s 2a salinity was consistently low in the river mouths and higher towards the mouth of the bay fig s 2b while lower salinity was observed in april than in the other months while no3 was generally the highest in the river water seasonal changes showed that lagoons and bays tended to be higher in october and november fig s 2c nh4 concentrations were high from july to august although the trend was unclear due to large variations among months and stations fig s 2d chl a was found to be locally high in the lagoon exceeding 10 μ g l 1 with no apparent seasonal variation fig s 2e in contrast the chl a concentration in the bay tended to increase from august to september nta was higher in the lagoon and tended to be lower towards the mouth of the bay ca 2400 with highest values in the lagoon being seen in april fig 4a dic concentrations were low in rivers and river mouth areas ca 1500 μ m ol l 1 and high in akkeshi bay with seasonal variations where concentrations tended to be lower from april to june fig 4b doc concentrations tended to decrease from the mouth of the river to the mouth of the bay and were often slightly higher in the eastern part of the lagoon fig 4c the ph was generally below 7 in river water while it was approximately 7 7 8 1 in the lagoon and bay further when compared to the bay there was more variability among survey periods and stations in the lagoon fig 4d and a high ph 8 2 was observed around the middle of the lagoon in june pco2 was highly variable between the stations and seasons river water tended to be well above 1000 μ atm in all months while values in the lagoon tended to be higher than 400 μ atm after july except for al5 inner lagoon on the other hand the pco2 in the bay was approximately equal to or less than 400 μ atm fig 4e the 2017 data for akkeshi ko lagoon and akkeshi bay showed a positive correlation between salinity and dic concentrations in each month r 0 85 1 0 p 0 001 n 11 15 except for november r 0 40 p 0 31 n 15 data not shown further there was a negative correlation between salinity and doc r 0 58 0 94 p 0 05 n 14 15 except in the months of april r 0 49 p 0 13 n 11 may r 0 28 p 0 32 n 15 and november r 0 37 p 0 16 n 15 data not shown 3 2 numerical simulation 3 2 1 model validation comparisons of simulated and observed values for water quality at representative points of akkeshi ko lagoon al1 of lagoon mouth al2 of lagoon center and al5 of inner lagoon and akkeshi bay ab08 of bay center are shown in fig s 3 water temperature salinity no3 nh4 and chl a and fig 5 dic doc poc ta ph pco2 and ω arg in addition table s 1 shows the results of the model performance verification based on the bias and rmse for all the items mentioned here except poc at the four sites where the simulation results were compared the reproducibility of water temperature and salinity was low at al1 for the biochemical components relatively high accuracy was obtained for ab08 except for chl a the difference in reproducibility between sites within the lagoon was not apparent modeled water temperatures ranged from 0 to 30 c and reproduced seasonal variations and large spatial gradients from the bay to the lagoon fig s 3a salinity was highly reproducible expect in april and it dropped to levels below 25 during flooding near the mouth of inflow rivers fig s 3b the model tended to overestimate no3 concentration in september and october from the center to the inner part of the lagoon but showed good agreement between calculated and observed concentrations for both the lagoon and bay during other seasons fig s 3c the nh4 concentration had a low reproducibility of high observed values exceeding 4 μ m ol l 1 fig s 3d similar to nh4 chl a concentration was not well reproduced in the model for the observed data as high as 6 μ g l 1 though both modeled and observed values were of the same order fig s 3e in terms of dic concentrations the model reproduced the characteristics of small monthly variations in the bay and large variations in the lagoon with comparable simulated and observed concentrations fig 5a further simulated doc concentrations were relatively well reproduced in both the lagoon and bay fig 5b the simulated and observed poc concentrations were generally of the same order of magnitude although the calculated values varied greatly depending on the inclusion of eelgrass derived detritus fig 5c the ta values themselves were estimated from the salinity in the model and were highly consistent except for the november data at al2 fig 5d the ph was generally well reproducible except for the higher values ca 8 3 observed at al2 fig 5e the high observed values of pco2 at al1 above 600 μ atm from august to september were not reproducible but at the other stations and months it showed good reproducibility fig 5f the model was able to describe the trend of low seasonal variability of ω arg saturation state of aragonite in the bay and high seasonal variability in the lagoon however the model tended to slightly overestimate the values in comparison to the observed values in the lagoon fig 5 g for items for which values were not obtained by our field observations the validity was verified by comparing with the values in the reported literature even though the environmental conditions may be very different from those the study area considered in the present study simulated organic carbon content of the sediment poc sd mpb was ca 10 50 mg c g 1 dw at ab08 and ca 2 6 mg c g 1 dw at al2 these values were at the same level as those in hasegawa et al 2008 for the same station in akkeshi ko lagoon simulated dic concentrations in porewater ca 1000 2000 μ m ol c l 1 in the central lagoon and ca 3000 4000 μ m ol c l 1 in the central bay were similar to those reported in previous studies rysgaard et al 1998 engström et al 2005 the simulation results for doc concentration in porewater ca 2000 9000 μ m ol c l 1 in the central lagoon and ca 1200 2000 μ m ol c l 1 in the central bay were similar or slightly higher than the value reported in the literature burdige et al 1992 3 2 2 fluctuations of carbonate parameters within a day and material cycle in the lagoon the simulated carbonate parameters in the lagoon showed both seasonal variation and a more significant day night variation than those in the bay the daily variation in ph the difference between the minimum and maximum values within a day was about 0 05 in the bay while it exceeded 0 2 in the lagoon during july and august fig 6 the maximum ph values were generally obtained during the day and evening results show that eelgrass contributed greatly to the material cycle in the lagoon photosynthesis respiration extracellular excretion and mortality rates of aboveground eelgrass in the whole lagoon are shown in fig 7a the photosynthesis rate was high from june to august and respiration and mortality rates were highest in august net carbon flux photosynthesis minus respiration extracellular excretion and mortality was generally positive except during late august and october it was especially high in june and july fig 7b during the decomposition and mineralization stages withered eelgrass leaves are transported and settled in the water column figs 2 and 3 the annual april november outflux of eelgrass derived poc poc eel from the lagoon to the bay was 971 ton c and the flux of poc eel settled from the water column to the surface sediment was 704 ton c however not all of the settled poc eel was buried deep in the sediment there were some characteristic features of din and dic uptake flux by primary producers in the lagoon daily din i e no3 nh4 uptake rates by primary producers in the water column phytoplankton aboveground eelgrass and epiphytes showed seasonal variation with maxima during july and august data not shown among the primary producers epiphytes were the largest din sink and eelgrass was the second largest although the daily uptake rate of dic showed the same tendency in seasonality as din fig 7c the largest sink of dic was eelgrass annual over 8 months co2 fluxes under the present simulation scenario were 22 9 mol m 2 at the river mouths of the lagoon 4 1 mol m 2 in the eelgrass bed and 6 2 mol m 2 in akkeshi bay with the exception of the river mouths of the lagoon the coastal area the lagoon and the bay was a co2 sink but including eelgrass beds the values tended to be greater in the bay than in the lagoon 3 2 3 effects of oa and eelgrass beds in addition to the simulation of the present situation case 1 calculations under the conditions of acidification progression such as boundary conditions of co2 and dic concentrations equivalent to those in rcp2 6 and rcp8 5 in the 2090s were conducted as a sensitivity analysis cases 2 and 3 calculations were performed under av conditions to verify the acidification mitigation potential of the eelgrass bed under the present and rcp8 5 scenario cases 4 and 5 the horizontal distributions of the minimum ph and ω arg values during the simulation period april to november for the four calculation scenarios cases 1 5 table 2 are shown in fig 8 the results of the present condition 2017 case 1 simulation showed that the minimum ph value was low in the river mouths but increased from the lagoon to the bay mouth fig 8a similarly the minimum values of ω arg were lower in the river mouths and higher in the bay than in the lagoon calculations under the rcp2 6 scenario case 2 showed a slight difference from 2017 fig 8b but those under the rcp8 5 scenario case 3 showed a large change in both ph and ω arg fig 8c in the 2017 av scenario case 4 focusing on changes with and without eelgrass beds there was a small change in water quality in the bay but in the lagoon the ph was below 7 8 and the number of grids with ω arg values below one was increased fig 8d in the rcp8 5 projection under av conditions case 5 the minimum ph was below 7 2 in many grids in the lagoon fig 8e fig 9 compares the minimum values of ph and ω arg between the 2090s under the rcp2 6 scenario and 2017 and between the 2090s under the rcp8 5 scenario and 2017 considering the vegetation for each scenario and parameter the difference was small near the mouth of inflow rivers in the rcp2 6 scenario the range of decrease in ph was 0 1 0 3 in the lagoon and 0 1 in the bay except for the river mouth and the range of decrease in ω arg was up to 0 3 in the innermost part of the lagoon in the rcp8 5 scenario ph decreased by about 0 4 0 5 and ω arg decreased by about 0 6 in the lagoon and 1 0 in the bay in addition the differences between the lowest values of ph and ω arg when vegetation was not considered in 2017 and rcp8 5 scenarios were also compared fig 9b in the absence of eelgrass beds ph and ω arg decreased by 0 1 0 4 and 0 1 0 2 respectively in the inner bay and most of the lagoon except for the river mouth and the innermost part in the case not considering the eelgrass beds the decrease in ph and ω arg tended to be slightly larger in the current scenario 2017 than in the future scenario 2090s rcp8 5 spatial and temporal differences in the maximum and minimum values of ph and ω arg over a day in the presence and absence of vegetation were assessed in two scenarios 2017 and 2090s under the rcp8 5 figs s 4 and s 5 in both scenarios there was little difference in ph and ω arg due to vegetation for either maximum or minimum values at ab08 at the stations in the lagoon both the maximum and minimum values of ph and ω arg were greatly reduced when eelgrass beds were not considered from may to october progressive acidification accelerated the photosynthetic rate of eelgrass the dic limitation for eelgrass photosynthesis f dic was 0 88 1 11 at present the year 2017 0 90 1 12 for rcp2 6 in the 2090s and 1 00 1 17 for rcp8 5 conditions data not shown although eelgrass biomass was highly dependent on factors other than dic compared to the present simulation the annual mean and maximum values of abundance increased by approximately 30 40 under rcp8 5 conditions the amount of dic uptake by primary producers in the water column for the whole lagoon varied greatly depending on the presence or absence of eelgrass beds under rcp8 5 conditions case 3 vs case 5 fig 10 the maximum daily uptake was approximately 1000 ton c for case 3 and 200 ton c for case 5 constituting a decrease to approximately 1 5 the original value in the absence of eelgrass beds when comparing the time series changes in ph ω arg and p abn proportion of abnormally developed shells for oyster in the four simulation scenarios there was not much difference between the present conditions and the 2090s under rcp2 6 fig 11 on the other hand the 2090s under rcp8 5 showed a large change in the lagoon there was a decrease of about 0 3 0 4 in ph compared to the present while the differences between scenarios were smaller in the bay in the bay the changes in ph ω arg and p abn due to the presence or absence of eelgrass beds were small but ph and ω arg decreased significantly in the lagoon when eelgrass beds were not considered resulting in a large increase in p abn especially during the summer in cases 1 and 2 the ph did not fall below the threshold value 7 4 kurihara et al 2007 at these four stations on the other hand in case 5 the ph was occasionally less than 7 4 between july and august focusing on p abn in cases 1 and 2 there was a high value at al1 but the value was low 45 at the other stations further in case 3 high values 70 were observed in april and november when water temperatures were low in case 5 as well a high p abn was observed that exceeded 50 during any season in the lagoon and was over 80 for a long period 4 discussion the carbonate parameters and other water quality variables showed large spatial and seasonal variations between the river lagoon and bay both present 2017 spatiotemporal variations in water quality as well as future projections based on the assumed increase in greenhouse gases are well represented through a three dimensional ecosystem model a sensitivity analysis using the model showed that the acidification process has a large negative impact on the shell formation of cultured bivalves however this effect was mitigated by the presence of high primary production in the eelgrass beds 4 1 observed spatiotemporal variations in water quality in the study area results showed large spatiotemporal variations in the water quality over the course of the study lagoon water was characterized by lower values of dic concentration and ph but higher doc concentration and pco2 when compared to open ocean water fig 6b e in various cases a linear relationship between these parameters and salinity has been reported in other coastal waters e g fukushima et al 2001 suzumura and ogawa 2001 in most months there was a positive correlation between salinity and dic and a negative correlation between salinity and doc these results indicate the strong contribution of physical mixing and dilution to the spatial distribution of carbonate parameters and doc concentrations in the lagoon and bay the doc concentrations in the lagoon tended to be higher within the eelgrass beds consistent with the findings of previous studies which suggest that seagrass beds serve as a source of doc velimirov 1986 barrón et al 2014 watanabe and kuwae 2015a while the pco2 in the lagoon was generally low below 400 μ atm from april to june it tended to exceed 400 μ atm from july fig 6e consequently early spring in akkeshi ko lagoon and akkeshi bay is characterized by phytoplankton blooms taguchi et al 1977 while the late spring early summer period is characterized by high growth rates of eelgrass hasegawa et al 2007 additionally such dynamics of carbon system parameters in the lagoon can show the transition from the production phase to the decomposition phase after early summer 4 2 factors controlling water quality and flux in the lagoon and bay values of carbonate parameters which are affected by water temperature and salinity can show the complex dynamics of estuarine areas where the water depth is shallow and river water flows in our simulations show the lowest ph values in july and august when the water temperature fig s 3a and pco2 was high fig 5f because of the decomposition and mineralization of organic matter considering that ta dic pco2 and salinity remain unchanged the ph decreases with higher water temperatures therefore it is necessary to consider both physical and biochemical processes when discussing the mechanism of variation in carbonate parameters simulation results showed that ph substantially fluctuates not only seasonally but also within a day fig 6 with more variability in the lagoon especially in the eelgrass beds than in the bay hofmann et al 2011 suggest a more significant variation in ph in coastal areas than in the open ocean especially in the estuary and seaweed beds simulations carried out in this study were able to simultaneously represent the dynamics of carbonate parameters in lagoons and bays over a wide range of seasons from spring to early winter in doing so our model aimed to represent the seasonal and spatial variability from river mouths to the open sea however the impact of short term events remains to be thoroughly examined for example the high and spiky values observed for nh4 and chl a in the lagoon cannot be adequately reproduced by the simulations fig s 3d e some studies suggest that the high chl a concentration may be due to the resuspension of epiphytes and or microphytobenthos kasim and mukai 2006 abe et al 2015 however one observation per month is not enough to determine what causes this phenomenon and whether it occurs frequently instead routine surveys and continuous observations are needed to better examine the effects on productivity and carbonate parameters the characteristics of air ocean co2 fluxes in the lagoon and bay under the present scenario can be summarized as follows though high absorption fluxes occur within the eelgrass bed in the lagoon the bay has a greater absorption potential table s 2 because it is characterized by lower water temperatures and much deeper water the absence of river inflow also contributes to the larger absorption flux in the bay as it leads to less decomposition of the supplied organic matter than in the lagoon in various cases estuaries act as sources of co2 to the atmosphere because of the degradation of riverine organic carbon frankignoulle et al 1998 borges et al 2006 chen and borges 2009 on the other hand chen et al 2013 suggest that estuaries in subarctic and arctic areas tend to become co2 sinks compared to those in other climatic zones in addition the estimated co2 flux in the open ocean off hokkaido has been reported to be several mol m 2 yr 1 takahashi et al 2002 the fluxes obtained from the simulations in this study were from april to november but since most of the lagoon surface is iced over in winter the annual flux is assumed to be similar compared with previous studies on sinks in neritic seas the co2 uptake rates seem to be slightly higher in the study area table s 2 the major factors leading to this are i no large river loadings of organic matter ii high primary productivity by phytoplankton eelgrass and epiphytes and iii low decomposition rate due to the low water temperature although the river mouth areas of akkeshi ko lagoon are a co2 source table s 2 the flux was comparable to that in a previous review chen et al 2013 for mid estuaries salinity range 2 25 4 3 role of eelgrass beds in oa mitigation and shellfish aquaculture mitigation and adaptation measures for coastal ecosystems have been widely discussed as a strategy to tackle the effects of climate change e g duarte et al 2013 2017 however it is difficult to mitigate oa that accompanies an increase in air co2 on a large scale therefore actions that mitigate oa locally or prevent their effects i e adaptation are needed in places where the effects of oa occur markedly and the concept of oa refugia has been proposed in several studies manzello et al 2012 kapsenberg and cyronak 2019 however an adequate predictive evaluation is essential prior to considering appropriate measures for mitigation and adaptation the results of our study show that an increase in the atmospheric co2 concentration to more than double that of the present ca 400 ppm may results in changes in the carbonate parameter values in the water column such as an increase in dic and a decrease in ph assuming the rcp8 5 scenario photosynthetic activity of eelgrass was stimulated by the progress of acidification dic concentration increase and an approximately 30 40 increase in eelgrass biomass was projected by the 2090s furthermore while negative impacts of oa have been projected for coral reef ecosystems hoegh guldberg et al 2017 allemand and osborn 2019 and phytoplankton especially coccolithophores communities furukawa et al 2018 seagrass primary production will be promoted to some extent assuming conditions with increased water temperature and acidification zimmerman et al 2015 conducted a predictive assessment for eelgrass they indicated that although high water temperature would have a negative impact on growth the effect would be offset by enhanced photosynthesis resulting from elevated dic concentration therefore either a positive or a negative impact can be expected depending on the ecosystem and or region between july and august under av conditions the ph values in the lagoon decreased to a level that would affect oyster larvae ph 7 4 kurihara et al 2007 the results of our model figs 8 9 and 11 show that the presence of dense eelgrass beds can raise the ph and ω arg locally regardless of daytime or nighttime hours in both current and future scenarios in recent decades through laboratory experiments and in situ experiments and observations studies have shown that photosynthesis by seagrass decreases seawater acidity hendriks et al 2014 miller et al 2017 bergstrom et al 2019 ricart et al 2021 revealed that higher shoot density of seagrass resulted in higher daytime ph but nighttime ph was not affected by density moreover wahl et al 2018 and ricart et al 2021 pointed out that macrophytes can mitigate the adverse effects of acidification the same effect was observed in our simulation although seed introduction from the miyagi prefecture has been the main source for the aquaculture of oysters in akkeshi seed production on land using mature oysters has been actively conducted in recent years hasegawa et al 2015 juvenile oysters are put into the sea in spring and harvested between two to three years because the effects of oa seem to have greater influence on the malformation and mortality rates in the larval and juvenile stages it is important to be especially careful during these periods green et al 2009 talmage and gobler 2010 our simulation showed that the periods most susceptible to acidification were the seasons with lower temperatures and the period of high decomposition was in summer fig 11 it should be noted that in the study area the spawning period of oysters occurs in summer hasegawa et al 2015 given this control of water quality that prevents ph decline is essential for larvae growth in indoor aquariums in addition for fisherman trying in situ natural seed collection and early development of oysters the akkeshi bay is more favorable than the akkeshi ko lagoon fig 8 in the lagoon the ph and ω arg levels tend to decrease at the mouth of the river and the innermost part of the lagoon making the central and southern parts of the lagoon which overlap with the distribution area of eelgrass more suitable environments for aquaculture a number of global climate models gcms have projected enhanced oa in the open ocean e g hartin et al 2016 lavoie et al 2019 the ipcc s special report on the ocean and cryosphere in a changing climate srocc predicts a global average decrease in ph of less than 0 1 for rcp2 6 and 0 3 for rcp8 5 intergovernmental panel on climate change ipcc 2019 the simulations of this study agree with this and assuming the progression of acidification show that for the lagoon the range of ph decrease for the 2090s is about 0 1 0 3 for rcp2 6 and 0 3 0 5 for rcp8 5 respectively fig 9a the mitigation effect of the eelgrass bed was examined based on the calculation of the presence and absence of vegetation which resulted in a further decrease in ph of about 0 2 on average and a maximum decrease of about 0 4 for the case without the eelgrass bed under the rcp8 5 scenario figs 9 and 11 however it should be noted that our projections did not consider the effects of rising water temperatures although seagrass beds are well known to have high ecosystem services nordlund et al 2016 ruiz frau et al 2017 they are sensitive to environmental changes and the decline in seagrass meadows has been reported worldwide orth et al 2006 waycott et al 2009 since oyster farming often overlaps with the distribution of seagrass meadows e g eelgrass in many lagoons and estuaries conservation of seagrass beds is important in various respects 4 4 limitations of this study and future tasks in this study the dynamics of carbonate parameters akkeshi ko lagoon and akkeshi bay were identified and future forecast simulations regarding oa and the impact assessment on the oysters were conducted however there remains scope for improvement in the future the negative impact of oa on calcifying organisms is a well known phenomenon e g doney et al 2009 in our simulations we evaluated the effect of oa on the early shell formation of bivalves using two indices proposed by kurihara et al 2007 and waldbusser et al 2015 respectively however we did not establish any specific indices that would describe the relationship between carbonate parameters and oyster mortality growth rate and production as we did not evaluate these variables since the cultivation period of oysters in the target area is two to three years it is required to calculate the calcification rate from juvenile to adult and express the response to acidification for multiple years including winter hence in discussing the impact on aquaculture it is necessary to consider the changes in the oyster productivity parameters quantifying uncertainty is important for evaluation using numerical simulations e g allen et al 2007 uusitalo et al 2015 it is possible to analyze the degree of variability in the results obtained from the simulation through sensitivity analysis of the parameters and evaluation of the response to different forcing of the initial and boundary conditions furthermore the assessment of uncertainty is also important in climate change projections jones 2000 and multiple emission scenarios should be considered in our sensitivity analysis we only performed calculations for the 2090s assuming two scenarios rcp2 6 and rcp8 5 however calculations for the near future are also needed only the effects of increasing atmospheric co2 concentrations and progressing acidification were considered for future projections in this study however the increase in water temperature will undoubtedly bring about significant changes in many variables including carbonate parameters the dynamics of carbonate parameters are controlled by both 1 physical and chemical equilibrium processes and 2 involve biological processes for instance co2 solubility in seawater decreases with an increase in water temperature weiss 1974 and an increase in water temperature results in a ph decline millero et al 1998 in addition water temperature affects all processes in living organisms eppley 1972 therefore rigorous future simulations of various environmental changes e g elevated water temperature sea level rise and decrease in salinity due to heavy rainfall should be tested 5 conclusions in the study area although currently it is unclear whether the effects of oa are occurring or not at the present time advance evaluation of the risk to calcified organisms is important we improved a three dimensional ecosystem model to focus on the carbon cycle including carbonate parameter dynamics and represent the spatiotemporal variations in carbonate parameters in the lagoon and bay here an increase in co2 concentration in air and dic concentration in the boundaries led to the acidification in neritic waters and simulations identified when and where the effects of this acidification were most likely to occur in the early stages of oyster shell formation although acidification greatly affects the early growth of oysters we showed that the presence of eelgrass beds can mitigate these effects considering this conservation of eelgrass which has a mitigation effect on local acidification is an important adaptive strategy to realize sustainable shellfish aquaculture credit authorship contribution statement hiroya abe conceptualization methodology software validation formal analysis data curation writing original draft visualization minako abe ito methodology formal analysis data curation hyojin ahn methodology investigation data curation masahiro nakaoka conceptualization writing review editing supervision project administration funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments we would like to thank s hamano and h katsuragawa for their help with the fieldwork and dr t isada for his kind support with analysis the calculations were performed using the supercomputer system hpe apollo 2000 belonging to the national institute for environmental studies japan nies this study was partially supported by the environment research and technology development fund s 15 predicting and assessing natural capital and ecosystem services pances ministry of the environment japan the japan society for the promotion of science jsps kakenhi grant numbers jp 16h01792 and jp 21k19854 and the climate change adaptation research program of nies appendix a supplementary data supplementary material related to this article can be found online at https doi org 10 1016 j ocemod 2022 101992 appendix a supplementary data the following is the supplementary material related to this article mmc s1 
23845,it is well known that ocean acidification oa inhibits growth of marine calcifying organisms therefore the adverse effects of acidification on marine ecosystems and aquaculture such as oyster farming are of concern since eelgrass beds in neritic areas have a high potential for carbon assimilation this study focuses on local scale mitigation of oa effects using a three dimensional lower trophic system ecosystem model we modeled nitrogen and carbon cycles and the dynamics of carbonate parameters in a subarctic shallow lagoon and bay where nitrogen availability limits the photosynthesis of primary producers simulation of the present conditions allowed reproduction of spatiotemporal variations in water quality and by assuming future environmental changes quantitatively revealed that the progress of oa significantly elevated the probability of shell malformation in juvenile oysters the results represent the spatiotemporal variations in carbonate parameters inside and outside eelgrass beds and enable the evaluation of the alleviation effect on local acidification by the presence of a dense eelgrass bed our study shows that in the absence of the eelgrass bed scenario the effect of oa on oysters became more remarkable the simulations revealed that maintaining eelgrass beds is essential to mitigate the effects of acidification on oysters keywords ocean acidification mitigation ecosystem model material cycle eelgrass oyster 1 introduction the intergovernmental panel on climate change intergovernmental panel on climate change ipcc 2019 suggests that an increase in emissions of greenhouse gases such as carbon dioxide co2 results in climate change approximately 30 of the emitted anthropogenic co2 is absorbed by the oceans which contributes to the alleviation of global warming orr et al 2005 the elevation of co2 concentrations not only changes the chemical composition of seawater i e ocean acidification oa but can also directly affect some marine organisms doney et al 2009 because oa increases the energetic cost of calcification fabry et al 2008 wood et al 2008 the resultant growth inhibition of marine calcifiers and shifts in ecosystem structure have become issues of concern orr et al 2005 doney et al 2009 kroeker et al 2013 agostini et al 2018 oa affects not only natural ecosystems but also aquaculture and laboratory experiments that have projected future co2 conditions have shown potential negative impacts on bivalve survival and growth e g kurihara et al 2007 range et al 2011 barton et al 2012 guo et al 2016 this is especially problematic as bivalves are cultured in many areas of the world and oysters are one of the most productive and important species botta et al 2020 results of several laboratory experiments evaluating the effects of acidification on oysters have shown that acidification significantly inhibits initial growth and causes malformation kurihara et al 2007 barton et al 2012 barros et al 2013 waldbusser et al 2013 shell malformations can have a significant impact on the oyster population miller et al 2020 mass mortality of oysters due to upwelling of low ph bottom water has also been reported on the california coast hollarsmith et al 2020 these concerns about the impact of oa on aquaculture production or ecosystems can begin to be addressed through regional impact assessments although the negative effects on calcified organisms have been studied increased co2 may also promote the photosynthetic activity of primary producers such as microalgae and seagrasses e g beer and koch 1996 thom 1996 shi et al 2009 buapet et al 2013 under conditions of progressing acidification the high photosynthetic rate of primary producers is expected to increase ph and mitigate the negative effects on shellfish therefore it is important to quantitatively project future changes in the complex responses brought about by the increase in co2 concentration especially how it affects water quality and primary production and evaluate its effects on bivalves seagrass meadows that form in shallow and calm coastal areas have high levels of primary productivity duarte and chiscano 1999 this community has a variety of ecosystem functions such as nutrient uptake nurseries for juvenile fish and lessening the effects of wave and sediment resuspension short and mcroy 1984 heck et al 2003 hasegawa et al 2008 eelgrass beds which are widely distributed from the temperate to subarctic zones of the northern hemisphere green and short 2003 have significant potential over the long term for storage of carbon from the air into sediment via settling and sedimentation of organic carbon that they produce in this way they contribute to the carbon cycle for sequestration in coastal areas fourqurean et al 2012 garrard and beaumont 2014 tokoro et al 2014 najjar et al 2018 the dynamics of carbonate parameters such as ph are more complex in coastal areas especially in seagrass beds and river mouth areas than in the open ocean hofmann et al 2011 since the mechanism of variation of carbonate parameters may depend on the physicochemical conditions and ecosystem structure a separate evaluation should be conducted for each area although local mitigation effects of seagrass photosynthesis on oa have been reported through laboratory experiments and in situ observations hendriks et al 2014 koweek et al 2018 it is difficult to evaluate the effect on a regional scale 1 km using these methods in such cases numerical models three dimensional hydrodynamic ecosystem coupled models validated with observed data are advantageous although there are several studies on the dynamics of both the carbon cycle and carbonate parameters focusing on coastal areas e g omstedt et al 2009 sohma et al 2018 shen et al 2019 fujii et al 2021 it is essential to build a model that meets the specific characteristics of the region using models that represent regionally specific ecosystems we will be able to assess the role of seagrass beds in acidifying environments and the effects of acidification on bivalves in the western north pacific oa has been observed in monitoring surveys since the 1980s ono et al 2019 a long term downward trend in ph has also been reported in the coastal areas of japan ishizu et al 2019 for this study we focused on akkeshi ko lagoon and akkeshi bay both located in eastern hokkaido northern japan fig 1a eelgrass beds are widely distributed throughout the lagoon namba and nakaoka 2018 in addition bivalve aquaculture pacific oyster and manila clam is conducted in the lagoon and bay abe et al 2015 smith et al 2018 abe 2021 this makes it suitable for assessing the role of eelgrass beds in mitigating acidification as well as the impact of acidification on the growth and survival of bivalves fig 1b c although there is neither long term observational data to indicate the progress of acidification in the lagoon and bay nor reports on the effects of acidification on aquaculture it is essential to conduct a forecast evaluation in light of future changes the first aim of this study was to comprehend the dynamics of the present spatial temporal inorganic carbon system parameters dic dissolved inorganic carbon ta total alkalinity pco2 partial pressure of co2 ω arg aragonite saturation state in an estuarine system the second was to project future changes under different representative concentration pathway rcp scenarios using ecosystem modeling and then evaluate the effects on oyster malformation the final aim was to quantitatively estimate the role of eelgrass beds in mitigating the effects of acidification on oyster malformation 2 material and methods 2 1 study site akkeshi ko lagoon 32 km2 is shallow with a mean depth of ca 1 5 m three rivers bekanbeushi obetsu and oboro rivers flow into the northwestern part of the lagoon and the largest inflow river is the bekanbeushi river akabane et al 2003 open ocean water also inflows via a narrow channel ca 500 m from akkeshi bay 102 km2 which faces the pacific ocean monthly precipitation ranges from 50 to 200 mm with maximum between july and october however there are no apparent wet and dry seasons eelgrass beds are distributed over most of the lagoon except in river mouths hasegawa et al 2007 namba and nakaoka 2018 although the abundance and biomass may change across seasons and years seasonal and interannual changes in the distribution area are not apparent momota and nakaoka 2017 biodiversity center of japan ministry of the environment 2018 there is intensive aquaculture of both pacific oyster magallana gigas and manila clam ruditapes philippinarum in the study areas fig 1b c oysters especially are cultivated in almost all areas of the lagoon except for the river mouths and the center of the bay these bivalves have a significant impact on the material cycle of the lagoon through their filtration and excretion abe et al 2015 abe 2021 there are a number of characteristics of the study area including the mixing of river water with coastal water and the influence of eelgrass beds and bivalves on the material cycle isada et al 2021 fig 1c for this area a lower trophic ecosystem model focusing on the role of eelgrass beds yoon et al 2011 and microalgae abe 2016 on the growth of oysters abe 2021 and clams abe et al 2015 has been applied furthermore since very little attention has been paid to the dynamics of carbonate parameters and their modeling this study focuses on the dynamics of both carbon and nitrogen this is especially important because in subarctic estuarine waters photosynthesis by primary producers is often limited more by availability of din than that of dic e g moore et al 2013 cloern et al 2014 furthermore quantifying nitrogen dynamics is also important for understanding the material cycle 2 2 field observations field surveys of the akkeshi ko lagoon and akkeshi bay were conducted prior to constructing the ecosystem model these were key to understanding the spatiotemporal variability of water quality and to obtaining data for initial conditions boundary conditions and validation of the model sampling stations were established in the lagoon bay and inflow rivers fig 1 further monthly observations for water quality were conducted from april to november 2017 by using a conductivity temperature depth ctd profiler astd 102 jfe advantech to obtain vertical profiles 0 1 m intervals of water temperature and salinity the surface temperature and salinity of the rivers was measured using a hand held conductivity and salinity meter ec300 a ysi surface waters at all stations were sampled using a bucket and bottom waters were obtained using a van dorn water sampler at ab16 bay mouth n 1 in the event that water sampling at the bay mouth could not be conducted due to bad weather e g april 2017 water sampling was conducted in multiple layers at the station closest to the bay mouth the measurement items for the water samples were chlorophyll a chl a dissolved inorganic nutrients see below dissolved organic carbon doc dissolved organic nitrogen don particulate organic carbon poc particulate organic nitrogen pon dic concentrations and ta water samples were filtered using disposable membrane filters 0 45 μ m pore size dismic 25cs advantec and stored in a deep freezer 80 c until analysis nutrient nh4 n no2 n no2 no3 n po4 p and sio2 si and total dissolved nitrogen tdn concentrations were measured colorimetrically using a continuous flow injection analyzer aacs 4 bl tech following the method described by strickland and parsons 1972 the don concentration was determined by subtracting the sum of inorganic nitrogen from the tdn concentration to determine chl a concentration of the water a known volume of water sample was filtered using a whatman gf f filter 0 70 μ m pore size the filter was soaked in 6 ml of n n dimethylformamide dmf in a test tube and stored in a deep freezer suzuki and ishimaru 1990 then a fluorometer 10 au turner design was used to determine the concentration in the supernatant of the tube according to the welschmeyer method welschmeyer 1994 for the doc analysis water samples were filtered through precombusted gf f filters doc samples were then filtered directly into precombusted glass vials fixed with 50 μ l of 2n hcl and stored in the laboratory the measurements were performed using a shimadzu toc v cph analyzer for analyses of poc and pon a known volume of seawater was filtered through a 47 mm precombusted 450 c 5 h gf f filter after the elimination of the inorganic carbon remaining on the filter by fuming with hcl it was dried in a vacuum desiccator the poc and pon concentrations were measured simultaneously using an elemental analyzer na1500 fison samples for carbonate parameters were dispensed into 250 ml schott duran bottles which following protocol suggested in dickson et al 2007 were poisoned with mercuric chloride 200 μ l per bottle this was done to prevent changes in dic due to biological activity the ta and dic concentrations were determined using a batch sample analyzer att 15 kimoto electric all carbonate parameters except ta and dic were estimated using co2sys excel macro lewis and wallace 1998 pierrot et al 2006 provided by the carbon dioxide information analysis center cdiac the following available inputs were used set of constants k 1 and k 2 from mehrbach et al 1973 refit by dickson and millero 1987 khso4 dickson 1990 ph scale nbs scale mol kg 1 seawater and total boron uppström 1974 data of normalized ta nta to salinity of 35 were derived using the ctd salinity data since the changes in nta are caused by processes such as caco3 skeleton formation and biological degradation influences other than physical dilution can be inferred to evaluate the effects of mixing and dilution processes of river water and open ocean water for ta dic and doc regression equations with salinity were developed for each month following song et al 2013 2 3 numerical simulation 2 3 1 model configuration a lower trophic ecosystem model fig 2 coupled to a three dimensional hydrodynamic model princeton ocean model blumberg and mellor 1987 was used to simulate the spatiotemporal variations in nitrogen and carbon the model domain covered akkeshi ko lagoon and akkeshi bay and the area ca 20 km 11 km was discretized horizontally using a uniform mesh of 42 23 cells of 475 m resolution fig 3a b vertical discretization was based on eight vertical equidistant levels sigma coordinates the open boundary was set between the akkeshi bay and the pacific ocean the time step of the model was 2 s for the external mode 2d and 60 s for the internal model 3d the simulation period was limited to between april and november due to the ice cover in winter over most of the lagoon it is important to note that the model did not perform calculations for the winter season when ω arg is particularly low in subarctic seas e g fujii et al 2021 the ecosystem model considered the interaction between biochemical elements table 1 in the water column and sediments fig 2 and then simulated the spatiotemporal variability of each element this ecosystem model was based on one developed to represent the ecosystem and material cycles of the lagoon and bay yoon et al 2011 abe et al 2015 abe 2016 2021 phytoplankton phy aboveground eelgrass eel ag and epiphytes epi in the water column and microphytobenthos and belowground eelgrass eel bg in the sediment were included kasim and mukai 2006 revealed that the community composition of microalgae in the water column of the lagoon was dominated by diatoms and that in addition to phytoplankton centric diatoms resuspended benthic microalgae pennate diatoms were dominant therefore the resuspension process of microphytobenthos has also been considered abe et al 2015 we considered zooplankton zoo oysters oys and clams mc as consumers the distribution areas of the eelgrass bed oyster and clam are shown in fig 3 the model assumes that the distribution areas of the organisms do not change with the seasons although oysters and clams are calcifying organisms that are likely to be strongly affected by acidification in the study area the reasons for only evaluating the effects on oysters are presented at the end of section 2 3 4 since photosynthesis of the primary producer is limited by the din concentration in the study area hasegawa et al 2001 2005 it is necessary to simulate the nitrogen dynamics simultaneously when considering carbon dynamics details of the hydrodynamic and nitrogen models can be found in yoon et al 2011 abe et al 2015 and abe 2016 2021 the calculation method for the carbon cycle and carbonate parameter dynamics is described hereafter 2 3 2 carbon cycle model direct measurement of carbonate parameters of seawater is possible for total alkalinity ta dic ph and partial pressure of co2 pco2 or fco2 however if two of these four carbonate parameters can be observed the other two parameters can be derived based on the chemical equilibria of carbonate parameters in seawater zeebe and wolf gladrow 2001 in our ecosystem model dic was simulated ta was estimated from salinity and the other parameters were obtained using the program released by oregon state university https andreasschmittner github io models mobi index html accessed on august 26 2021 while ta fluctuates based on variables such as photosynthesis respiration and calcium dissolution precipitation zeebe and wolf gladrow 2001 a strong positive correlation is typically found between salinity and ta in regions of freshwater influence rofi millero et al 1998 schneider et al 2007 fassbender et al 2017 because of the large salinity gradient between the akkeshi ko lagoon and the akkeshi bay ta in the model was estimated from modeled salinity using the relationship between observed salinity in the range of 12 1 33 4 obtained by ctd and ta ta μ mol kg 1 49 102 salinity 619 67 r 0 99 p 0 001 n 121 fig s 1 by using this conversion formula ta can be estimated with high accuracy leading to an improvement in the computational accuracy of the carbon model as shown in table 1 and fig 2 the ecosystem model computed changes in dic concentrations while other factors necessary for calculating calcium carbonate saturation were computed in a separate program the chemical equilibria for co2 hco 3 bicarbonate ion and co 3 2 carbonate ion composing dic are expressed as follows co 2 h 2 o h 2 co 3 h 2 co 3 h hco 3 hco 3 h co 3 2 co 2 co 2 a q h 2 co 3 the formation of caco3 is difficult when the co 3 2 concentration decreases the saturation state of caco3 ω arg is expressed as follows ca 2 co 3 2 caco 3 ω a r g ca 2 co 3 2 k s p where k sp is the stoichiometric solubility product for the mineral phase of caco3 aragonite and the value of k sp is also influenced by temperature and salinity thus ω arg can vary without any change in the carbonate concentration ω arg values greater than 1 indicate that aragonite precipitation is thermodynamically favored over aragonite dissolution the reverse is true for values less than 1 carter et al 2014 time variations in dic doc and poc in the water column except for advection and diffusion processes were calculated as follows fig 2b d d i c d t e x c h a n g e b e t w e e n a i r a n d w a t e r c o l u m n m i n e r a l i z a t i o n o f d o c a n d p o c p h o t o s y n t h e s i s r e s p i r a t i o n e x c h a n g e b e t w e e n w a t e r c o l u m n a n d s e d i m e n t d d o c d t m i n e r a l i z a t i o n i n t o d i c d e c o m p o s i t i o n e x t r a c e l l u l a r e x c r e t i o n e x c h a n g e b e t w e e n w a t e r c o l u m n a n d s e d i m e n t d p o c d t d e c o m p o s i t i o n i n t o d o c m i n e r a l i z a t i o n i n t o d i c e g e s t i o n m o r t a l i t y g r a z i n g s e t t l i n g the relationship between the co2 concentration in air ppm and the partial pressure of co2 in surface water pco2 μ atm is described as follows p c o 2 p e c o 2 where p pa is the air pressure and e pa is the water vapor pressure the air sea co2 flux was computed using the following equation co 2 f l u x α k δ p co 2 where α mmol m 3 μ atm 1 is the solubility of co2 in seawater k m day 1 is the gas exchange rate for co2 and δ pco2 μ atm is the difference between air and surface water pco2 parameters α and k were calculated according to weiss 1974 and wanninkhof 2014 respectively α is expressed as a function of water temperature and salinity and k is a function of water temperature and wind speed an eelgrass submodel calculating the above and belowground biomass and nitrogen content of leaves was developed in abe 2016 the structure of the submodel and the results of verification of calculation accuracy are described in supplement b in this section we explain how we improved the model by considering the effects of acidification the photosynthesis rate was controlled by the water temperature light intensity and din availability in the model direct uptake of gaseous co2 by submerged eelgrass leaves leuschner et al 1998 watanabe and kuwae 2015b was not considered in our model since an increase in dic concentration can promote eelgrass growth beer and koch 1996 thom 1996 zayas santiago et al 2020 the dic limitation function was also considered the photosynthesis rate of aboveground eelgrass is expressed as follows p h o t o s y n t h e s i s a g μ e e l a g μ v m a x f t f i f n c o n f d i c where μ day 1 is the growth rate v max day 1 is the maximum growth rate f t f i f n c o n and f dic no dimension are the limitation indices for water temperature light intensity nitrogen availability obtained from the nitrogen content of leaves and dic concentration respectively and eel ag is aboveground biomass f dic was obtained according to the relationship between dic concentration and eelgrass photosynthetic rate beer and koch 1996 f d i c 1 1478 log d i c 7 6149 we did not consider the effect of dic concentration on photosynthetic rate for primary producers other than eelgrass phytoplankton epiphytes and microphytobenthos following previous studies that discussed the relationship between the carbon uptake rate of diatoms and carbonate parameters kim et al 2006 yang and gao 2012 the other biogeochemical processes affecting the carbon cycle such as respiration by living organisms i e dic release decomposition poc into doc and mineralization poc into dic and doc into dic closely followed the same equations used for nitrogen and carbon flux of each cycle which were derived from each individual c n ratio for example the applied c n molar ratios of each primary producer were 7 0 for phytoplankton redfield et al 1963 11 0 for epiphytes hasegawa et al 2007 and 15 7 43 9 for eelgrass leaves yoon et al 2011 in the model the c dw of eelgrass ranged from 33 2 to 35 9 with slight seasonal variations yoon et al 2011 ecosystem models calculate nitrogen and carbon fluxes but the biomass of microalgae is often expressed in terms of chl a in our model different types of microalgae were given different ratios of c chl a as follows 50 0 1 for phytoplankton kawamiya et al 1995 43 0 1 for epiphytes hasegawa et al 2007 and 33 7 1 for microphytobenthos montani et al 2003 multiple year classes were considered in the oyster and clam submodels and individual weights and densities were calculated for each year class abe et al 2015 abe 2021 the amount of carbon based organic matter uptake was calculated from the filtration rate and the organic matter concentration release rates for dic and poc were calculated on a nitrogen basis and converted to carbon using the cn molar ratios of the respective bivalves 6 16 for oyster and 4 84 for clam 2 3 3 calculation scenario the calculation scenarios are listed in table 2 the year 2017 when monthly routine observations were conducted section 2 2 was selected as the standard case case 1 2017 pv the concentrations of dic doc and poc at the open boundary and rivers in the 2017 calculations were set based on monthly observations table 3 the model performance was confirmed based on this case two different ipcc ar5 rcp scenarios were used for future projections rcp2 6 mitigation scenario and rcp8 5 business as usual scenario moss et al 2010 which provide projections till the 2090s are referred to as case 2 2090s rcp2 6 pv and case 3 2090s rcp8 5 pv respectively apart from oa climate change is expected to cause a variety of environmental changes such as increased water temperature sea level rise and water quality changes intergovernmental panel on climate change ipcc 2019 it is desirable to cover these phenomena when conducting rigorous forecasting however in addition to the difficulty of preparing all the boundary conditions changing too many calculation conditions would have diverted the purpose of the study and made it infeasible to verify the acidification mitigation effect of the presence of eelgrass beds therefore in the present study only the response to acidification was evaluated as part of future projections for simplicity only gaseous co2 and dic concentrations for the rivers and the open boundary were changed i e adding the increase compared to the standard case based on the same conditions described in nakamura et al 2018 table 2 to evaluate the role of eelgrass beds eelgrass and epiphytes pv presence of vegetation in the material cycle and water quality variation simulations that did not include the eelgrass bed av absence of vegetation were carried out as a sensitivity analysis case 4 2017 av case 5 2090s rcp8 5 av in the av calculation case the conditions of physical parameters such as bottom roughness were not changed in the hydrodynamics simulation 2 3 4 model validation and evaluation of oa impact model performance was assessed by comparing the simulated results with the observed values water temperature salinity no3 nh4 chl a dic doc poc ta ph pco2 and ω arg in the surface water at ab08 bay center al1 lagoon mouth al2 lagoon center and al5 inner lagoon fig 3c ab08 al2 and al5 are located within the oyster farm of which eelgrass is distributed in al2 and al5 al1 is a location that is strongly affected by the mixing of river water and seawater from the bay a quantitative evaluation of model performance using the bias bias and root mean square error rmse was also conducted these two indices are calculated as follows b i a s 1 n i 1 n s i o i r m s e 1 n i 1 n s i o i 2 where n represents the number of model observation data pairs and s and o represent the simulation and observation respectively the poc concentrations obtained from the water samples during field observations included various suspended solids such as living microalgae and detritus that were collected by the filter in the model several sources of poc were considered fig 2 one of which was detritus from eelgrass it should be noted that the model does not distinguish between freshly withered leaves and finely decomposed leaves therefore when comparing the observed poc concentration with the value obtained by the simulation it may overestimate the simulated poc concentration when considering freshly withered eelgrass leaves to verify the accuracy of the calculation we decided to express simulated poc concentrations both with and without detritus derived from eelgrass see fig 5c after the model validation the impact of acidification was evaluated based on the following three indices i water quality mainly carbonate parameters ii primary production and iii early shell development of oysters the proportion of abnormally developed shells malformation p abn was calculated as follows waldbusser et al 2015 p a b n 1 0 610 1 ω a r g 0 820 5 753 according to this equation p abn ranges from 0 39 to 1 0 39 100 moreover kurihara et al 2007 reported on the relationship between ph and oyster larval growth with results suggesting that reduced larval size at ph values less than 7 4 due to inhibition of shell synthesis although experimental results on the effects of acidification on oyster shell growth rate i e calcification rate have been reported previously e g gazeau et al 2007 no findings quantifying the effects over several years from larval to harvest size were available in addition since the calculation period in this study was from april to november it could not represent the dynamics in winter when ω arg is particularly low in the subarctic region fujii et al 2021 we aimed to assess the risk of early growth in the lagoon and bay however our simulations using the two indices presented in waldbusser et al 2015 and kurihara et al 2007 may overestimate the impact of acidification though clams are cultured in the lagoon effective indicators of acidification effects on clams could not be obtained and the reproducibility of carbonate parameters in the tidal flat and pore water where clams are cultured could not be verified therefore no evaluation of acidification effects on clams was conducted in this study 3 results 3 1 spatiotemporal variations in water quality by field observations results of this study showed large spatiotemporal variations in water quality figs s 2 and 4 there was a marked seasonal variation in water temperature and a considerable spatial variation between temperatures in the central and inner parts of the lagoon during the summer months fig s 2a salinity was consistently low in the river mouths and higher towards the mouth of the bay fig s 2b while lower salinity was observed in april than in the other months while no3 was generally the highest in the river water seasonal changes showed that lagoons and bays tended to be higher in october and november fig s 2c nh4 concentrations were high from july to august although the trend was unclear due to large variations among months and stations fig s 2d chl a was found to be locally high in the lagoon exceeding 10 μ g l 1 with no apparent seasonal variation fig s 2e in contrast the chl a concentration in the bay tended to increase from august to september nta was higher in the lagoon and tended to be lower towards the mouth of the bay ca 2400 with highest values in the lagoon being seen in april fig 4a dic concentrations were low in rivers and river mouth areas ca 1500 μ m ol l 1 and high in akkeshi bay with seasonal variations where concentrations tended to be lower from april to june fig 4b doc concentrations tended to decrease from the mouth of the river to the mouth of the bay and were often slightly higher in the eastern part of the lagoon fig 4c the ph was generally below 7 in river water while it was approximately 7 7 8 1 in the lagoon and bay further when compared to the bay there was more variability among survey periods and stations in the lagoon fig 4d and a high ph 8 2 was observed around the middle of the lagoon in june pco2 was highly variable between the stations and seasons river water tended to be well above 1000 μ atm in all months while values in the lagoon tended to be higher than 400 μ atm after july except for al5 inner lagoon on the other hand the pco2 in the bay was approximately equal to or less than 400 μ atm fig 4e the 2017 data for akkeshi ko lagoon and akkeshi bay showed a positive correlation between salinity and dic concentrations in each month r 0 85 1 0 p 0 001 n 11 15 except for november r 0 40 p 0 31 n 15 data not shown further there was a negative correlation between salinity and doc r 0 58 0 94 p 0 05 n 14 15 except in the months of april r 0 49 p 0 13 n 11 may r 0 28 p 0 32 n 15 and november r 0 37 p 0 16 n 15 data not shown 3 2 numerical simulation 3 2 1 model validation comparisons of simulated and observed values for water quality at representative points of akkeshi ko lagoon al1 of lagoon mouth al2 of lagoon center and al5 of inner lagoon and akkeshi bay ab08 of bay center are shown in fig s 3 water temperature salinity no3 nh4 and chl a and fig 5 dic doc poc ta ph pco2 and ω arg in addition table s 1 shows the results of the model performance verification based on the bias and rmse for all the items mentioned here except poc at the four sites where the simulation results were compared the reproducibility of water temperature and salinity was low at al1 for the biochemical components relatively high accuracy was obtained for ab08 except for chl a the difference in reproducibility between sites within the lagoon was not apparent modeled water temperatures ranged from 0 to 30 c and reproduced seasonal variations and large spatial gradients from the bay to the lagoon fig s 3a salinity was highly reproducible expect in april and it dropped to levels below 25 during flooding near the mouth of inflow rivers fig s 3b the model tended to overestimate no3 concentration in september and october from the center to the inner part of the lagoon but showed good agreement between calculated and observed concentrations for both the lagoon and bay during other seasons fig s 3c the nh4 concentration had a low reproducibility of high observed values exceeding 4 μ m ol l 1 fig s 3d similar to nh4 chl a concentration was not well reproduced in the model for the observed data as high as 6 μ g l 1 though both modeled and observed values were of the same order fig s 3e in terms of dic concentrations the model reproduced the characteristics of small monthly variations in the bay and large variations in the lagoon with comparable simulated and observed concentrations fig 5a further simulated doc concentrations were relatively well reproduced in both the lagoon and bay fig 5b the simulated and observed poc concentrations were generally of the same order of magnitude although the calculated values varied greatly depending on the inclusion of eelgrass derived detritus fig 5c the ta values themselves were estimated from the salinity in the model and were highly consistent except for the november data at al2 fig 5d the ph was generally well reproducible except for the higher values ca 8 3 observed at al2 fig 5e the high observed values of pco2 at al1 above 600 μ atm from august to september were not reproducible but at the other stations and months it showed good reproducibility fig 5f the model was able to describe the trend of low seasonal variability of ω arg saturation state of aragonite in the bay and high seasonal variability in the lagoon however the model tended to slightly overestimate the values in comparison to the observed values in the lagoon fig 5 g for items for which values were not obtained by our field observations the validity was verified by comparing with the values in the reported literature even though the environmental conditions may be very different from those the study area considered in the present study simulated organic carbon content of the sediment poc sd mpb was ca 10 50 mg c g 1 dw at ab08 and ca 2 6 mg c g 1 dw at al2 these values were at the same level as those in hasegawa et al 2008 for the same station in akkeshi ko lagoon simulated dic concentrations in porewater ca 1000 2000 μ m ol c l 1 in the central lagoon and ca 3000 4000 μ m ol c l 1 in the central bay were similar to those reported in previous studies rysgaard et al 1998 engström et al 2005 the simulation results for doc concentration in porewater ca 2000 9000 μ m ol c l 1 in the central lagoon and ca 1200 2000 μ m ol c l 1 in the central bay were similar or slightly higher than the value reported in the literature burdige et al 1992 3 2 2 fluctuations of carbonate parameters within a day and material cycle in the lagoon the simulated carbonate parameters in the lagoon showed both seasonal variation and a more significant day night variation than those in the bay the daily variation in ph the difference between the minimum and maximum values within a day was about 0 05 in the bay while it exceeded 0 2 in the lagoon during july and august fig 6 the maximum ph values were generally obtained during the day and evening results show that eelgrass contributed greatly to the material cycle in the lagoon photosynthesis respiration extracellular excretion and mortality rates of aboveground eelgrass in the whole lagoon are shown in fig 7a the photosynthesis rate was high from june to august and respiration and mortality rates were highest in august net carbon flux photosynthesis minus respiration extracellular excretion and mortality was generally positive except during late august and october it was especially high in june and july fig 7b during the decomposition and mineralization stages withered eelgrass leaves are transported and settled in the water column figs 2 and 3 the annual april november outflux of eelgrass derived poc poc eel from the lagoon to the bay was 971 ton c and the flux of poc eel settled from the water column to the surface sediment was 704 ton c however not all of the settled poc eel was buried deep in the sediment there were some characteristic features of din and dic uptake flux by primary producers in the lagoon daily din i e no3 nh4 uptake rates by primary producers in the water column phytoplankton aboveground eelgrass and epiphytes showed seasonal variation with maxima during july and august data not shown among the primary producers epiphytes were the largest din sink and eelgrass was the second largest although the daily uptake rate of dic showed the same tendency in seasonality as din fig 7c the largest sink of dic was eelgrass annual over 8 months co2 fluxes under the present simulation scenario were 22 9 mol m 2 at the river mouths of the lagoon 4 1 mol m 2 in the eelgrass bed and 6 2 mol m 2 in akkeshi bay with the exception of the river mouths of the lagoon the coastal area the lagoon and the bay was a co2 sink but including eelgrass beds the values tended to be greater in the bay than in the lagoon 3 2 3 effects of oa and eelgrass beds in addition to the simulation of the present situation case 1 calculations under the conditions of acidification progression such as boundary conditions of co2 and dic concentrations equivalent to those in rcp2 6 and rcp8 5 in the 2090s were conducted as a sensitivity analysis cases 2 and 3 calculations were performed under av conditions to verify the acidification mitigation potential of the eelgrass bed under the present and rcp8 5 scenario cases 4 and 5 the horizontal distributions of the minimum ph and ω arg values during the simulation period april to november for the four calculation scenarios cases 1 5 table 2 are shown in fig 8 the results of the present condition 2017 case 1 simulation showed that the minimum ph value was low in the river mouths but increased from the lagoon to the bay mouth fig 8a similarly the minimum values of ω arg were lower in the river mouths and higher in the bay than in the lagoon calculations under the rcp2 6 scenario case 2 showed a slight difference from 2017 fig 8b but those under the rcp8 5 scenario case 3 showed a large change in both ph and ω arg fig 8c in the 2017 av scenario case 4 focusing on changes with and without eelgrass beds there was a small change in water quality in the bay but in the lagoon the ph was below 7 8 and the number of grids with ω arg values below one was increased fig 8d in the rcp8 5 projection under av conditions case 5 the minimum ph was below 7 2 in many grids in the lagoon fig 8e fig 9 compares the minimum values of ph and ω arg between the 2090s under the rcp2 6 scenario and 2017 and between the 2090s under the rcp8 5 scenario and 2017 considering the vegetation for each scenario and parameter the difference was small near the mouth of inflow rivers in the rcp2 6 scenario the range of decrease in ph was 0 1 0 3 in the lagoon and 0 1 in the bay except for the river mouth and the range of decrease in ω arg was up to 0 3 in the innermost part of the lagoon in the rcp8 5 scenario ph decreased by about 0 4 0 5 and ω arg decreased by about 0 6 in the lagoon and 1 0 in the bay in addition the differences between the lowest values of ph and ω arg when vegetation was not considered in 2017 and rcp8 5 scenarios were also compared fig 9b in the absence of eelgrass beds ph and ω arg decreased by 0 1 0 4 and 0 1 0 2 respectively in the inner bay and most of the lagoon except for the river mouth and the innermost part in the case not considering the eelgrass beds the decrease in ph and ω arg tended to be slightly larger in the current scenario 2017 than in the future scenario 2090s rcp8 5 spatial and temporal differences in the maximum and minimum values of ph and ω arg over a day in the presence and absence of vegetation were assessed in two scenarios 2017 and 2090s under the rcp8 5 figs s 4 and s 5 in both scenarios there was little difference in ph and ω arg due to vegetation for either maximum or minimum values at ab08 at the stations in the lagoon both the maximum and minimum values of ph and ω arg were greatly reduced when eelgrass beds were not considered from may to october progressive acidification accelerated the photosynthetic rate of eelgrass the dic limitation for eelgrass photosynthesis f dic was 0 88 1 11 at present the year 2017 0 90 1 12 for rcp2 6 in the 2090s and 1 00 1 17 for rcp8 5 conditions data not shown although eelgrass biomass was highly dependent on factors other than dic compared to the present simulation the annual mean and maximum values of abundance increased by approximately 30 40 under rcp8 5 conditions the amount of dic uptake by primary producers in the water column for the whole lagoon varied greatly depending on the presence or absence of eelgrass beds under rcp8 5 conditions case 3 vs case 5 fig 10 the maximum daily uptake was approximately 1000 ton c for case 3 and 200 ton c for case 5 constituting a decrease to approximately 1 5 the original value in the absence of eelgrass beds when comparing the time series changes in ph ω arg and p abn proportion of abnormally developed shells for oyster in the four simulation scenarios there was not much difference between the present conditions and the 2090s under rcp2 6 fig 11 on the other hand the 2090s under rcp8 5 showed a large change in the lagoon there was a decrease of about 0 3 0 4 in ph compared to the present while the differences between scenarios were smaller in the bay in the bay the changes in ph ω arg and p abn due to the presence or absence of eelgrass beds were small but ph and ω arg decreased significantly in the lagoon when eelgrass beds were not considered resulting in a large increase in p abn especially during the summer in cases 1 and 2 the ph did not fall below the threshold value 7 4 kurihara et al 2007 at these four stations on the other hand in case 5 the ph was occasionally less than 7 4 between july and august focusing on p abn in cases 1 and 2 there was a high value at al1 but the value was low 45 at the other stations further in case 3 high values 70 were observed in april and november when water temperatures were low in case 5 as well a high p abn was observed that exceeded 50 during any season in the lagoon and was over 80 for a long period 4 discussion the carbonate parameters and other water quality variables showed large spatial and seasonal variations between the river lagoon and bay both present 2017 spatiotemporal variations in water quality as well as future projections based on the assumed increase in greenhouse gases are well represented through a three dimensional ecosystem model a sensitivity analysis using the model showed that the acidification process has a large negative impact on the shell formation of cultured bivalves however this effect was mitigated by the presence of high primary production in the eelgrass beds 4 1 observed spatiotemporal variations in water quality in the study area results showed large spatiotemporal variations in the water quality over the course of the study lagoon water was characterized by lower values of dic concentration and ph but higher doc concentration and pco2 when compared to open ocean water fig 6b e in various cases a linear relationship between these parameters and salinity has been reported in other coastal waters e g fukushima et al 2001 suzumura and ogawa 2001 in most months there was a positive correlation between salinity and dic and a negative correlation between salinity and doc these results indicate the strong contribution of physical mixing and dilution to the spatial distribution of carbonate parameters and doc concentrations in the lagoon and bay the doc concentrations in the lagoon tended to be higher within the eelgrass beds consistent with the findings of previous studies which suggest that seagrass beds serve as a source of doc velimirov 1986 barrón et al 2014 watanabe and kuwae 2015a while the pco2 in the lagoon was generally low below 400 μ atm from april to june it tended to exceed 400 μ atm from july fig 6e consequently early spring in akkeshi ko lagoon and akkeshi bay is characterized by phytoplankton blooms taguchi et al 1977 while the late spring early summer period is characterized by high growth rates of eelgrass hasegawa et al 2007 additionally such dynamics of carbon system parameters in the lagoon can show the transition from the production phase to the decomposition phase after early summer 4 2 factors controlling water quality and flux in the lagoon and bay values of carbonate parameters which are affected by water temperature and salinity can show the complex dynamics of estuarine areas where the water depth is shallow and river water flows in our simulations show the lowest ph values in july and august when the water temperature fig s 3a and pco2 was high fig 5f because of the decomposition and mineralization of organic matter considering that ta dic pco2 and salinity remain unchanged the ph decreases with higher water temperatures therefore it is necessary to consider both physical and biochemical processes when discussing the mechanism of variation in carbonate parameters simulation results showed that ph substantially fluctuates not only seasonally but also within a day fig 6 with more variability in the lagoon especially in the eelgrass beds than in the bay hofmann et al 2011 suggest a more significant variation in ph in coastal areas than in the open ocean especially in the estuary and seaweed beds simulations carried out in this study were able to simultaneously represent the dynamics of carbonate parameters in lagoons and bays over a wide range of seasons from spring to early winter in doing so our model aimed to represent the seasonal and spatial variability from river mouths to the open sea however the impact of short term events remains to be thoroughly examined for example the high and spiky values observed for nh4 and chl a in the lagoon cannot be adequately reproduced by the simulations fig s 3d e some studies suggest that the high chl a concentration may be due to the resuspension of epiphytes and or microphytobenthos kasim and mukai 2006 abe et al 2015 however one observation per month is not enough to determine what causes this phenomenon and whether it occurs frequently instead routine surveys and continuous observations are needed to better examine the effects on productivity and carbonate parameters the characteristics of air ocean co2 fluxes in the lagoon and bay under the present scenario can be summarized as follows though high absorption fluxes occur within the eelgrass bed in the lagoon the bay has a greater absorption potential table s 2 because it is characterized by lower water temperatures and much deeper water the absence of river inflow also contributes to the larger absorption flux in the bay as it leads to less decomposition of the supplied organic matter than in the lagoon in various cases estuaries act as sources of co2 to the atmosphere because of the degradation of riverine organic carbon frankignoulle et al 1998 borges et al 2006 chen and borges 2009 on the other hand chen et al 2013 suggest that estuaries in subarctic and arctic areas tend to become co2 sinks compared to those in other climatic zones in addition the estimated co2 flux in the open ocean off hokkaido has been reported to be several mol m 2 yr 1 takahashi et al 2002 the fluxes obtained from the simulations in this study were from april to november but since most of the lagoon surface is iced over in winter the annual flux is assumed to be similar compared with previous studies on sinks in neritic seas the co2 uptake rates seem to be slightly higher in the study area table s 2 the major factors leading to this are i no large river loadings of organic matter ii high primary productivity by phytoplankton eelgrass and epiphytes and iii low decomposition rate due to the low water temperature although the river mouth areas of akkeshi ko lagoon are a co2 source table s 2 the flux was comparable to that in a previous review chen et al 2013 for mid estuaries salinity range 2 25 4 3 role of eelgrass beds in oa mitigation and shellfish aquaculture mitigation and adaptation measures for coastal ecosystems have been widely discussed as a strategy to tackle the effects of climate change e g duarte et al 2013 2017 however it is difficult to mitigate oa that accompanies an increase in air co2 on a large scale therefore actions that mitigate oa locally or prevent their effects i e adaptation are needed in places where the effects of oa occur markedly and the concept of oa refugia has been proposed in several studies manzello et al 2012 kapsenberg and cyronak 2019 however an adequate predictive evaluation is essential prior to considering appropriate measures for mitigation and adaptation the results of our study show that an increase in the atmospheric co2 concentration to more than double that of the present ca 400 ppm may results in changes in the carbonate parameter values in the water column such as an increase in dic and a decrease in ph assuming the rcp8 5 scenario photosynthetic activity of eelgrass was stimulated by the progress of acidification dic concentration increase and an approximately 30 40 increase in eelgrass biomass was projected by the 2090s furthermore while negative impacts of oa have been projected for coral reef ecosystems hoegh guldberg et al 2017 allemand and osborn 2019 and phytoplankton especially coccolithophores communities furukawa et al 2018 seagrass primary production will be promoted to some extent assuming conditions with increased water temperature and acidification zimmerman et al 2015 conducted a predictive assessment for eelgrass they indicated that although high water temperature would have a negative impact on growth the effect would be offset by enhanced photosynthesis resulting from elevated dic concentration therefore either a positive or a negative impact can be expected depending on the ecosystem and or region between july and august under av conditions the ph values in the lagoon decreased to a level that would affect oyster larvae ph 7 4 kurihara et al 2007 the results of our model figs 8 9 and 11 show that the presence of dense eelgrass beds can raise the ph and ω arg locally regardless of daytime or nighttime hours in both current and future scenarios in recent decades through laboratory experiments and in situ experiments and observations studies have shown that photosynthesis by seagrass decreases seawater acidity hendriks et al 2014 miller et al 2017 bergstrom et al 2019 ricart et al 2021 revealed that higher shoot density of seagrass resulted in higher daytime ph but nighttime ph was not affected by density moreover wahl et al 2018 and ricart et al 2021 pointed out that macrophytes can mitigate the adverse effects of acidification the same effect was observed in our simulation although seed introduction from the miyagi prefecture has been the main source for the aquaculture of oysters in akkeshi seed production on land using mature oysters has been actively conducted in recent years hasegawa et al 2015 juvenile oysters are put into the sea in spring and harvested between two to three years because the effects of oa seem to have greater influence on the malformation and mortality rates in the larval and juvenile stages it is important to be especially careful during these periods green et al 2009 talmage and gobler 2010 our simulation showed that the periods most susceptible to acidification were the seasons with lower temperatures and the period of high decomposition was in summer fig 11 it should be noted that in the study area the spawning period of oysters occurs in summer hasegawa et al 2015 given this control of water quality that prevents ph decline is essential for larvae growth in indoor aquariums in addition for fisherman trying in situ natural seed collection and early development of oysters the akkeshi bay is more favorable than the akkeshi ko lagoon fig 8 in the lagoon the ph and ω arg levels tend to decrease at the mouth of the river and the innermost part of the lagoon making the central and southern parts of the lagoon which overlap with the distribution area of eelgrass more suitable environments for aquaculture a number of global climate models gcms have projected enhanced oa in the open ocean e g hartin et al 2016 lavoie et al 2019 the ipcc s special report on the ocean and cryosphere in a changing climate srocc predicts a global average decrease in ph of less than 0 1 for rcp2 6 and 0 3 for rcp8 5 intergovernmental panel on climate change ipcc 2019 the simulations of this study agree with this and assuming the progression of acidification show that for the lagoon the range of ph decrease for the 2090s is about 0 1 0 3 for rcp2 6 and 0 3 0 5 for rcp8 5 respectively fig 9a the mitigation effect of the eelgrass bed was examined based on the calculation of the presence and absence of vegetation which resulted in a further decrease in ph of about 0 2 on average and a maximum decrease of about 0 4 for the case without the eelgrass bed under the rcp8 5 scenario figs 9 and 11 however it should be noted that our projections did not consider the effects of rising water temperatures although seagrass beds are well known to have high ecosystem services nordlund et al 2016 ruiz frau et al 2017 they are sensitive to environmental changes and the decline in seagrass meadows has been reported worldwide orth et al 2006 waycott et al 2009 since oyster farming often overlaps with the distribution of seagrass meadows e g eelgrass in many lagoons and estuaries conservation of seagrass beds is important in various respects 4 4 limitations of this study and future tasks in this study the dynamics of carbonate parameters akkeshi ko lagoon and akkeshi bay were identified and future forecast simulations regarding oa and the impact assessment on the oysters were conducted however there remains scope for improvement in the future the negative impact of oa on calcifying organisms is a well known phenomenon e g doney et al 2009 in our simulations we evaluated the effect of oa on the early shell formation of bivalves using two indices proposed by kurihara et al 2007 and waldbusser et al 2015 respectively however we did not establish any specific indices that would describe the relationship between carbonate parameters and oyster mortality growth rate and production as we did not evaluate these variables since the cultivation period of oysters in the target area is two to three years it is required to calculate the calcification rate from juvenile to adult and express the response to acidification for multiple years including winter hence in discussing the impact on aquaculture it is necessary to consider the changes in the oyster productivity parameters quantifying uncertainty is important for evaluation using numerical simulations e g allen et al 2007 uusitalo et al 2015 it is possible to analyze the degree of variability in the results obtained from the simulation through sensitivity analysis of the parameters and evaluation of the response to different forcing of the initial and boundary conditions furthermore the assessment of uncertainty is also important in climate change projections jones 2000 and multiple emission scenarios should be considered in our sensitivity analysis we only performed calculations for the 2090s assuming two scenarios rcp2 6 and rcp8 5 however calculations for the near future are also needed only the effects of increasing atmospheric co2 concentrations and progressing acidification were considered for future projections in this study however the increase in water temperature will undoubtedly bring about significant changes in many variables including carbonate parameters the dynamics of carbonate parameters are controlled by both 1 physical and chemical equilibrium processes and 2 involve biological processes for instance co2 solubility in seawater decreases with an increase in water temperature weiss 1974 and an increase in water temperature results in a ph decline millero et al 1998 in addition water temperature affects all processes in living organisms eppley 1972 therefore rigorous future simulations of various environmental changes e g elevated water temperature sea level rise and decrease in salinity due to heavy rainfall should be tested 5 conclusions in the study area although currently it is unclear whether the effects of oa are occurring or not at the present time advance evaluation of the risk to calcified organisms is important we improved a three dimensional ecosystem model to focus on the carbon cycle including carbonate parameter dynamics and represent the spatiotemporal variations in carbonate parameters in the lagoon and bay here an increase in co2 concentration in air and dic concentration in the boundaries led to the acidification in neritic waters and simulations identified when and where the effects of this acidification were most likely to occur in the early stages of oyster shell formation although acidification greatly affects the early growth of oysters we showed that the presence of eelgrass beds can mitigate these effects considering this conservation of eelgrass which has a mitigation effect on local acidification is an important adaptive strategy to realize sustainable shellfish aquaculture credit authorship contribution statement hiroya abe conceptualization methodology software validation formal analysis data curation writing original draft visualization minako abe ito methodology formal analysis data curation hyojin ahn methodology investigation data curation masahiro nakaoka conceptualization writing review editing supervision project administration funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments we would like to thank s hamano and h katsuragawa for their help with the fieldwork and dr t isada for his kind support with analysis the calculations were performed using the supercomputer system hpe apollo 2000 belonging to the national institute for environmental studies japan nies this study was partially supported by the environment research and technology development fund s 15 predicting and assessing natural capital and ecosystem services pances ministry of the environment japan the japan society for the promotion of science jsps kakenhi grant numbers jp 16h01792 and jp 21k19854 and the climate change adaptation research program of nies appendix a supplementary data supplementary material related to this article can be found online at https doi org 10 1016 j ocemod 2022 101992 appendix a supplementary data the following is the supplementary material related to this article mmc s1 
23846,in this study we propose a new method for simulating complex surface waves interacting with a large amplitude internal solitary wave our model is based on a high order spectral method for surface waves with the bottom boundary conditions computed from an internal wave solver the convergence of the model is first tested using an internal wave case without surface waves we then perform simulations of a canonical nonlinear wave interaction case involving two surface wave components and a prescribed internal wave component the initial wave energy growth rate of the resonant wave component is found to agree with the analytical value predicted by the perturbation theory we also use the model to simulate the interaction between surface waves and a weakly nonlinear internal wave and the result is nearly identical to that calculated using a two layer model finally we show the application of our model in a multiscale nested modeling framework where the internal wave parameters are extracted from the mesoscale simulation using a nonhydrostatic ocean model the evolution of the spatial variations of the surface roughness is captured and the surface wave orbital velocity also changes in space due to the surface motions induced by the internal wave our phase resolved model provides a computationally efficient tool for simulating complex surface wave fields in the background of internal waves of large amplitudes keywords surface wave internal wave interaction internal solitary wave nonlinear resonant wave interaction 1 introduction internal solitary waves isw are widely observed in oceans through their manifestations at the sea surface see e g osborne and burch 1980 jackson et al 2013 xue et al 2013 bai et al 2014 celona et al 2021 lenain and pizzo 2021 because an internal wave iw can travel for a long distance from the place of generation in the deep ocean before it eventually breaks nearshore its impact on the energy and nutrient redistribution is significant alford et al 2015 woodson 2018 the interaction dynamics between surface and internal waves has been an important research topic for tracking the propagation of internal solitary waves helfrich and melville 2006 while the short internal waves directly associated with the buoyancy frequency are also ubiquitous in a stratified ocean their time and length scales are much smaller than those of nondispersive solitary waves and thus have different physical properties in this study we limit our discussions to the long internal solitary waves and for brevity they are referred to as internal waves unless otherwise noted the models for simulating internal waves can be divided into two categories based on the treatment of oceanic stratifications in the first type of models the ocean is simplified to a two layer fluid system where the interface is roughly the pycnocline and the effects of viscosity and continuous buoyancy are neglected while in the second type the density profile is continuous when the internal wave nonlinearity is small a i h 1 and the internal wave is sufficiently long h λ 1 one can derive the korteweg de vries kdv benjamin 1966 djordjevic and redekopp 1978 ostrovsky and stepanyants 1989 equation from the euler equations here a i and λ are the amplitude and the length scale of the internal wave respectively and h is a vertical length scale for instance the upper layer depth note that the amplitude a i is generally taken as the maximum isopycnal displacement however internal waves in the ocean often have large vertical displacements stanton and ostrovsky 1998 duda et al 2004 therefore it is more appropriate to account for this strong nonlinearity a i h o 1 and retain only the weak dispersion assumption h λ 1 which leads to the mcc miyata choi camassa model miyata 1985 choi and camassa 1999 the mcc model provides an apparent improvement in modeling the large amplitude internal wave profile and propagation speed compared with the predictions based on the kdv models while the mcc model may suffer from numerical instability issues at high wave numbers for sufficiently large internal wave amplitude helfrich and melville 2006 its overall performance agrees well with laboratory observational and other numerical results in addition to the kdv and mcc models the original euler equations of the two layer fluid system can be directly solved for a solitary wave solution the euler equation results however can be accurately predicted by the mcc model over a wide range of parameters for a more comprehensive review of the two layer models the reader is referred to helfrich and melville 2006 a major deficiency of the two layer models is the simplified oceanic stratifications for example compared with the continuously stratified model the two layer model predicts a less accurate location when the fission of internal waves occurs bai et al 2019 additionally when the nonlinearity is strong i e a i h 1 the perturbation expansion is no longer applicable the second type of internal wave model takes into account the continuous stratification under the boussinesq approximation one can derive the dubreil jacotin long djl equation dubreil jacotin 1934 long 1953 which describes the isopycnal displacement from the undisturbed position unlike the kdv type of waves that assume weak nonlinearity the djl equation produces a fully nonlinear internal wave of the permanent form turkington et al 1991 developed an iterative algorithm to calculate the fully nonlinear solution see also stastna and lamb 2002 dunphy et al 2011 applied the fourier spectral method to the turkington et al 1991 algorithm and achieved a significant improvement in the convergence and efficiency performance a major application of the djl solution is to serve as the initial condition for isws in the turbulence resolving simulations e g sakai et al 2020a it should be noted that the isw of permanent forms cannot reveal the unsteady dynamics of the isw itself but also the finer scale motions that develop across the water column from the free surface to the bottom boundary layer for this purpose the euler equation and navier stokes equations can be directly solved to capture these processes depending on the application of interest e g the internal wave breaking caused by the depth variation for the inviscid fluid stastna and peltier 2004 the turbulence effect in internal wave breaking can be resolved by using the direct numerical simulation dns of the navier stokes equations venayagamoorthy and fringer 2006 2007 arthur and fringer 2014 2016 recently sakai et al 2020a b performed large eddy simulation les of a large amplitude internal wave propagating against a background barotropic current to reduce the computational cost required to capture the features of the turbulence scale much smaller than the driving isw they focused on the development of the bottom turbulent boundary layer diamantopoulos 2021 studied convectively breaking shoaling isws over a gentle slope in the south china sea the isws at the production scale have also been studied by models based on the reynolds averaged navier stokes equations with the boussinesq approximation for instance the stanford unstructured nonhydrostatic terrain following adaptive navier stokes simulator suntans fringer et al 2006 rogers et al 2019 davis et al 2020 the computational cost is a major concern if les is used to capture both the turbulence and internal waves in a stratified ocean because the grid resolution must be fine enough to resolve the ozmidov scale fringer et al 2019 motivated by the recent lower resolution three dimensional simulations of rivera rosario et al 2022 significant progress was made recently by diamantopoulos 2021 where 1 km long isws propagating 80 km with resolutions between 0 25 and 1 m in all three directions in the region of isw breaking were simulated within the affordable computational cost to simulate dispersive surface gravity waves over a nondispersive internal wave the main challenge is to address the issue of scale separation in early studies the interactions between surface waves and internal waves have been treated in the framework of wave current interactions where the internal wave dynamics are simplified to a prescribed spatially varying surface current peregrine 1976 alpers 1985 the propagation of the surface waves in this inhomogeneous current is usually tracked in a phase averaged manner following the geometric optics approach bakhanov and ostrovsky 2002 while the phase averaged method produces a surface wave sw energy change similar to the surface roughness variations induced by the internal wave it is restricted by the assumption that the surface waves changes slowly which may not be the case because of wave reflection craig et al 2012 to overcome this limitation some recent studies explored the surface wave internal wave interaction from a phase resolved perspective based on a two layer model for instance the two layer model is transformed into the nonlinear schrödinger equation coupled with the kdv equation which reveals the impact of an internal wave on a narrow banded surface wave packet craig et al 2012 in another example a second order approximation to the two layer model is derived based on the long wave approximation neglecting the short surface wave dynamics jiang et al 2019 the first direct numerical evidence of the surface roughness manifestations induced by the internal wave has recently been produced by hao and shen 2020 through the direct simulation of the two layer model without the narrow band surface wave and long wave assumptions the physical parameters including the layer depths and the density ratio are comparable to those in a field observation stanton and ostrovsky 1998 except that the internal wave amplitude is only one fifth of the actual value in the present study we present a new model for simulating surface waves over a large amplitude internal wave with a i h o 1 the maximum amplitude can be as large as 20 40 of the total water depth the surface waves are modeled using a phase resolved high order spectral method considering that the mcc model can produce a reasonably well isw dynamics we use it to generate the isw boundary condition to force the surface wave solver another advantage of the mcc model is easy implementation because our solver is modified from the numerical solver for a two layer fluid system alam et al 2009 and the mcc model was also developed under the same two layer ocean stratification assumption in contrast to the fully coupled surface wave internal wave dynamics in the two layer model the internal wave is independent of the surface waves in our model our focus is therefore on the upper layer which can be seen as an analogy to the strategy used by sakai et al 2020a b to address the scale separation in turbulence isw interaction in the context of the isw induced bottom boundary layer by retaining the one way impact of the internal wave on the surface waves we can reduce the computational cost encountered in simulations based on the two layer model hao and shen 2020 meanwhile because the mcc model used in this study does not require a weak nonlinearity assumption it is more suitable for resolving the dynamics of realistic ocean internal waves compared with the kdv type of internal wave treatment in hao and shen 2020 while the mcc model was established on the weak dispersion assumption and neglects the isw deformation evolution we expect the dispersion effect to be minor because the isw induced surface patterns are generated within a short time duration of a few characteristic surface wave periods the remainder of this paper is organized as follows in section 2 we present the mathematical formulations for the high order spectral method in section 3 we perform three types of simulations to validate the model including a simple internal wave the nonlinear triad interaction problem and a benchmark test against the full two layer model in section 4 we perform a simulation of surface waves over a large amplitude internal wave where the parameters are extracted from a large scale suntans simulation conclusions are given in section 5 2 mathematical formulation the physical system is equivalent to the upper layer in the canonical two layer ocean model and the bottom boundary corresponds to the interface elevation the difference and connections between the two layer model and the present model are illustrated in fig 1 a and b in the appendix we provide the details of the governing equations for the two layer model our model includes a solver for capturing the evolution of the surface wave field and the mcc model for providing the information of the isw as the boundary condition of the surface wave solver 2 1 surface wave solver in this section we present the numerical scheme for the surface wave solver the horizontal coordinates are denoted by x and y and the vertical coordinate is denoted by z the still water level is at z 0 the fluid is assumed to be incompressible and inviscid the potential flow assumption yields the laplace equation 2 φ 0 for the velocity potential φ and the dynamic and kinematic boundary conditions of the sea surface can be written as dean and dalrymple 1991 1 η t x φ x η φ z 0 z η x y t 2 φ t g η 1 2 φ φ 0 z η x y t where η x y t denotes the ocean surface elevation x y z is the full gradient operator and x x y is the gradient operator in horizontal directions following zakharov 1968 the above two boundary conditions can be reformulated in terms of η x y t and the surface velocity potential φ s x y t φ x y z η t as 3 η t x φ s x η 1 x η x η φ z 0 z η 4 φ s t g η 1 2 x φ s x φ s 1 2 1 x η x η φ z 2 0 z η the kinematic boundary condition at the bottom is 5 φ φ b x y t z h η b x y t where h is the mean water depth η b x y t is the prescribed bottom elevation and φ b x y t is the prescribed velocity potential at the bottom this equation serves as the dirichlet boundary condition for the velocity potential in the upper layer fluid as shown in fig 1 b the velocity potential can be written as the perturbation series with respect to wave steepness 6 φ x y z t m 1 m φ m x y z t h η b z η where φ m m 1 2 m denotes the m th order value at each time step φ s x y t and φ b x y t are first calculated from the previous time step as the dirichlet boundary conditions for the velocity potential let ϕ m φ m x y z 0 t and ψ m φ m x y z h t the dirichlet boundary condition at surface is expanded in taylor series around z 0 and ϕ m can then be calculated successively 7 ϕ 1 φ s ϕ m l 1 m 1 η l l l φ m l z l z 0 m 2 3 m similarly we can solve for ψ m at the bottom 8 ψ 1 φ b ψ m l 1 m 1 η b l l l φ m l z l z h m 2 3 m to calculate the derivatives in eqs 7 and 8 we write φ m as the sum of eigenfunctions of the system liu and yue 1998 9 φ m x z t n 1 n α n m t sinh k n z h sinh k n h β n m t sinh k n z sinh k n h e i k n x where α n m t and β n m t are coefficients to be determined x x y is the horizontal coordinate vector and k n k n x k n y is the wavenumber vector corresponding to the n th eigenfunction substituting the expressions of ϕ m and ψ m into eq 9 we can readily obtain ϕ m n 1 n α n m t e i k n x and ψ m n 1 n β n m t e i k n x therefore α n m t and β n m t are the fourier coefficients of ϕ m and ψ m in the spectral space respectively the vertical velocity at the surface is calculated as 10 φ x z η t z m 1 m l 0 m m η l l l 1 z l 1 φ m x 0 t the numerical scheme for solving eqs 7 and 8 follows the original high order spectral method for waves in deep water and finite depth water dommermuth and yue 1987 liu and yue 1998 compared with the numerical method for the two layer model with four governing equations alam et al 2009 the present model only need to solve two evolution equations at each time step the vertical velocity is first calculated from eq 10 and the nonlinear terms are calculated directly in the physical space the fast fourier transform is used to calculate the fourier coefficients of a physical quantity and vice versa the wave field is then advanced in time by using the runge kutta fourth order scheme 2 2 internal wave solver in this section we introduce the internal wave solver which provides the dirichlet boundary condition at the bottom including the values of η b and φ b for long internal waves when the nonlinearity is weak a i h u 1 a kdv equation can be derived from the two layer model depending on the treatment of the small parameters such as the ratio of the amplitude to the upper layer depth the specific form of the equation and thus the solution vary an example is djordjevic and redekopp 1978 11 η i x a i sech 2 x c i t λ where a i is the amplitude c i c i r h u h l g is the wave speed r ρ u ρ l is the ratio of the upper layer density to the lower layer density see fig 1 and λ λ r h u h l g is a length scale of the solitary wave in hao and shen 2020 the kdv solution is used as the initial condition in the direct simulation of a two layer model when the internal wave amplitude increases the solution obtained from the kdv equation becomes less accurate helfrich and melville 2006 in fact in situ observations have shown that the amplitude of the oceanic internal waves is often large for example the maximum amplitude normalized by the total water depth a i h u h l was found to be 0 40 off the oregon coast moum et al 2003 0 20 on the new jersey shelves teague et al 2011 and 0 22 in the south china sea tang et al 2015 according to michallet and barthélemy 1998 the mcc prediction is nearly identical to the fully nonlinear result even when a i h u h l 0 4 therefore it is applicable to generate the dynamics of typical large amplitude isws from the mcc model and provide them as the boundary condition to the surface wave solver in the mcc model the internal wave elevation in the frame of reference moving at the propagation speed is 12 d η i d ξ 2 3 η i 2 c i 2 r h 2 η i c i 2 h 1 η i g 1 r h 1 η i h 2 η i c 2 r h 1 2 h 2 η i h 2 2 h 1 η i where c i c 0 h 1 a i h 2 a i h 1 h 2 a i c 0 2 g is the wave speed c 0 g h 1 h 2 1 r r h 2 h 1 is the leading order approximation to c i in the long wave limit h 1 ξ h u η i ξ and h 2 ξ h l η i ξ are the local fluid depths and ξ x c i t is the coordinate moving with the internal wave given the internal wave amplitude a i we can set η i ξ 0 a i and η i ξ 0 to solve eq 12 we define 13 g η i d η i d ξ 2 3 η i 2 c i 2 r h 2 η i c i 2 h 1 η i g 1 r h 1 η i h 2 η i c 2 r h 1 2 h 2 η i h 2 2 h 1 η i here g η i is a functional of η i and eq 12 is equivalent to g η i 0 the newton s method is then used to search for the optimal η i the kdv solution is used as the initial guess η l 0 in each iteration we perform the update by η l i 1 η l i j g η l i 1 g η l i where η l i and η l i 1 are the internal wave profile in two consecutive iteration steps and j g η l i denotes the jacobian matrix of g η l i with respect to η l i note that the internal wave profile η i ξ calculated here has a nonzero mean which needs to be removed in our computational domain after the internal wave elevation and speed are calculated they can be decomposed into the sum of the eigenfunctions of the two layer system and the velocity potential of the upper layer fluid at the interface can be obtained hao and shen 2020 then the bottom boundary quantities that propagate at the internal wave speed c i in the present model are matched with the interface quantities 14 η b x c i t y η i x y 15 φ b x c i t y φ u x y z h u η i 3 cases for model validation in this section we present three different cases to validate our model in the first two cases we focus on the convergence performance and accuracy of the solver against theoretical prediction for this purpose we use relatively simple wave configurations the parameters of which are summarized in table 1 in the third case we perform a benchmark test of the model against the simulations of a realistic broadband surface wave field over isw using the two layer model see parameters in table 2 3 1 convergence test we first perform a convergence test on the surface motions induced by the mcc type of internal wave to isolate the effect of the internal wave we set the amplitudes of the surface wave components in the initial condition to zero the surface velocity potential then propagates at the same speed as the internal wave the simulations are performed at multiple grid resolutions in the x direction while the grid number in the y direction is fixed see table 1 as explained above we use the newton s method to calculate the internal wave profile the iteration stops when the error defined as g η i d η i d ξ 2 is smaller than 10 3 the process towards convergence is shown in fig 2 owing to symmetry we only plot half of the internal wave profile while the error decreases continuously see the inset figure in fig 2 the difference in η i becomes indistinguishable after approximately six iterations compared with the converged result i e the mcc solution the initial guess i e the kdv solution significantly overestimates the change of η i with respect to ξ resulting in a much steeper profile which is a well known limitation of the kdv model e g stastna and lamb 2008 hence we use the mcc solution as the initial condition of the grid convergence test for the wave simulation hereafter the grid number in the newton s method is 1024 and the internal wave profile is filtered according to different grid numbers in the wave simulation we then calculate the surface current as u x d φ s x d x as shown in fig 3 a when the grid number is small e g n x 16 there is a noticeable deviation near the maximum and minimum of u x the results converge at large grid numbers e g n x 512 in fact the deviation becomes visually indistinguishable even when n x 64 the l 2 error decreases substantially with the growing grid number as shown in fig 3 b and thus confirms the convergence in all of the following simulation cases with both large scale internal solitons and surface waves the main challenge is to resolve the small scale surface wave dynamics therefore we use a larger grid number e g n x 12 288 in the second case in table 2 than the test cases in this section and we expect their grid resolutions to be sufficiently fine to resolve the internal wave dynamics and the associated surface current while the isw also induces a surface displacement it is significantly smaller than the surface wave heights under realistic ocean conditions for example moum and smyth 2006 found that the surface displacement induced by a typical isw off the oregon coast is less than 1 cm 3 2 nonlinear triad interaction in this section we test the framework i e a surface wave model coupled with a prescribed internal wave via a nonlinear physical process we do not use the mcc model to prescribe an internal solitary wave but instead only consider sinusoidal internal waves of small amplitude and steepness the main objective is to demonstrate that nonlinear triad interactions can form in the present model system and further validate our model by comparing the energy transfer in this nonlinear process against the theoretical prediction it has been known that nonlinear resonant interaction can occur among three wave components when certain conditions are satisfied ball 1964 joyce 1974 wen 1995 hill and foda 1996 alam 2012 this phenomenon is also known as the triad interaction and energy is transferred continuously among the three waves in resonance it may also lead to the broadening of the bandwidth of wave spectrum with the generation of resonant components tanaka and wakayama 2015 because the physical system in our model is slightly different from the original two layer model the conclusions obtained for triad interaction in those previous studies cannot be directly applied here in the surface wave solver the bottom condition is fixed and unaffected by the surface wave dynamics therefore we expect the triad interaction to be similar to the resonance interaction between surface waves in shallow water and bottom ripples liu and yue 1998 given the dispersion relation of a wave system the resonant condition required for the triad interaction to occur can be determined from the governing equations the dispersion relation of the two layer fluid system is determined by the density ratio r ρ u ρ l and the layer depths h u and h l and can be written as 16 ω 4 r coth k h u coth k h l ω 2 g k coth k h u coth k h l g 2 k 2 1 r 0 where each wavenumber k corresponds to two solutions of frequency ω and thus two different eigenmodes of the system i e the fast surface wave mode and the slow internal wave mode apel 1988 now suppose that in our system shown in fig 1 b there is a free surface wave component k s ω s where ω s 2 g k s tanh k s h and a prescribed internal wave component k i ω i satisfying eq 16 the resonant condition states that a second surface wave component k r ω r is generated when 17 k s k i k r 18 ω s ω i ω r 19 ω r 2 g k r tanh k r h given the values of k s ω s and k i ω i the resonant wave component properties k r ω r can be calculated by solving eqs 17 19 numerically fig 4 a shows an example of the resonant triad components the new surface wave generated in resonance has a larger wavenumber and frequency than the existing surface wave in the system another example is shown in fig 5 a where the wavenumber and frequency of the resonant component are smaller than those of the existing component these two examples correspond to the sum and difference type of triad interaction shown in eq 17 respectively in the triad interaction both the existing component k s ω s and the resonant component k r ω r are fast surface wave modes and fall onto the surface wave dispersion relation curve to perform a quantitative analysis on the wave energy transfer we use perturbation expansion to solve the governing equation following liu and yue 1998 by combining eqs 1 and 2 and eliminating the surface elevation η we can obtain a single evolution equation written in terms of the velocity potential 20 2 φ t 2 g φ z 2 φ φ t 1 2 φ φ φ 0 this equation is then expanded to the first order and the second order as in eq 6 21 2 φ 1 t 2 g φ 1 z 0 22 2 φ 2 t 2 g φ 2 z η 1 z 2 φ 1 t 2 g 2 φ 1 z 2 2 φ 1 φ 1 t now we consider the general solution to the first order system described by eq 21 suppose there is a surface wave component and an internal wave component prescribed by the bottom boundary condition and the solution can be written as 23 η 1 a s cos k s x ω s t a i cos k i x ω i t 24 φ 1 a s g ω e k z sin k s x ω s t a i g ω i cosh k i z ω i k i sinh k i z sin k i x ω i t where a s and a i are the amplitudes of the surface wave component and the internal wave component respectively in the following theoretical analysis we use the eigenfunction in the deep water e k z sin k s x ω s t for the surface wave component to facilitate the analysis this simplification holds for the examples in figs 4 a and 5 a noticing that k s h 4 note that the deep water assumption is not imposed in our simulation when a triad solution of eqs 17 and 19 exists the nonlinear terms on the right hand side of eq 22 generates a resonant forcing term we first consider the triad resonance k r k s k i and ω r ω s ω i shown in fig 4 a substituting the first order solution into eq 22 and neglecting the non resonant terms we have 25 φ t t 2 g φ z 2 a i a s f sin k r x ω r t 26 f ω i 3 2 g 2 k 2 2 ω i g 2 k s k i ω s g k s ω i g k s ω i 2 ω s g 2 k s k i ω i similarly we can compute the resonant forcing term corresponding to the triad waves k r k s k i and ω r ω s ω i shown in fig 5 a 27 φ t t 2 g φ z 2 a i a s f sin k r x ω r t 28 f ω i 3 2 g 2 k 2 2 ω i g 2 k s k i ω s g k s ω i g k s ω i 2 ω s g 2 k s k i ω i the forcing terms in eqs 25 and 27 generate secular solutions with an energy growth in the resonant component the asymptotic solution at t 0 is φ a i a s f 2 ω r t cos k r x ω r t because η φ t g we can obtain the initial growth rate of a r i e the amplitude of the resonant component 29 γ a i a s f 2 g to compare the theoretical and numerical solutions we perform two numerical experiments which correspond to the resonance quantified by eqs 25 and 27 respectively because the triad interaction is a high order nonlinear process we use a strong stratification of r 0 5 following alam et al 2009 to increase its strength and better present the validation result therefore we expect the dynamic coupling in this case to be much stronger than those in choi et al 2021 where the density ratios are 0 86 and 0 99 for the same type of resonance the initial wave field is the first order solution consisting of a surface wave component and an internal wave component as defined in eqs 23 and 24 the internal wave properties are calculated for a given set of parameters of the two layer system for both cases we choose the same internal wave properties the normalized water depth is k i h 2 5 to match the upper layer depth in the two layer model because the triad resonant interaction occurs at the second order the perturbation order needs to be m 2 to ensure the nonlinear dynamics be resolved in each experiment we repeat the runs for different perturbation order m 2 3 4 all simulations run for a total time duration of 84 t i at a time step of 0 008 t i with t i being the period of the internal wave component other parameters can be found in table 1 the simulation results are shown in figs 4 b and 5 b despite the small wave amplitude in the initial condition see table 1 a resonant wave component is generated in both cases suggesting the existence of the nonlinear triad interaction the curves collapse for various perturbation orders because the second order nonlinear forcing terms dominate the energy transfer in triad interaction initially there is indeed a linear growth stage in the amplitude of the resonant wave component and the growth rate agrees well with the theoretical prediction denoted by the black dashed line in the entire simulation duration the amplitude of the resonant wave component fluctuates periodically in time as shown the time scale of this amplitude oscillation is larger than the fast wave oscillations by one to two orders of magnitude this behavior is in general consistent with the triad interactions among the surface wave and internal wave components found in the full two layer fluid system ball 1964 alam 2012 3 3 benchmark test against the two layer model result we further perform a benchmark test against the two layer model result besides the high order spectral method proposed by alam et al 2009 the explicit hamiltonian system developed by taklo and choi 2020 can also capture the dynamic coupling between surface waves and internal waves in the two layer fluid system theoretically these two methods are equivalent up to the second order in this test case the two layer model result refers to the simulation data obtained by the high order spectral method hao and shen 2020 and we set up our simulation with the same initial condition and numerical parameters e g the grid numbers and the time steps as their study the surface wave components are specified by the empirical joint north sea wave project jonswap spectrum hasselmann et al 1973 and the directional spreading function the two layer parameters i e the density ratio and the layer depth are extracted from field observations stanton and ostrovsky 1998 the internal wave component is constructed from kdv solution the parameters used in the present model are listed in table 2 to validate the boundary condition described in eqs 5 14 and 15 we compare the internal wave profiles and the boundary values of the velocity potential calculated from our model and the two layer model the definitions of these boundary quantities can be found in fig 1 for convenience we only compare the results at the center of the computational domain y l y 2 which is reasonable because the variations of the isws in the y direction are negligible as shown in fig 6 a and b our result agrees well with the two layer model result with slight deviations we also calculate the correlation coefficients c η for the isw profile and c φ for the boundary value of the velocity potential between the results from different models see fig 6c throughout the simulation duration we find that c η 0 998 and c φ 0 995 which again supports the boundary condition in the present model fig 7 shows a comparison of the instantaneous surface wave elevation overall the surface roughness variations computed with the present model agree well with the two layer model result fig 8 a b and c compare the 1d distribution of the surface elevation at three cross sections denoted by the black lines in fig 7 a the difference in η x y l y 2 shown in fig 8 a and η y smooth shown in fig 8 b is small and the relative error is roughly within 5 in contrast we find the deviations in η y rough shown in fig 8 c to be slightly larger note that the deviations are mainly local while the large scale portion of η y rough are largely consistent following hao and shen 2020 we compute the steepness ratio defined as r s η rough η smooth where denotes the spatial average similar to the two layer model result the value of r s increases linearly first and then saturates in the present model the growth rate of r s in the present model as indicated by the initial slope of the curve is slower than that in the two layer model this is associated with the difference in the internal wave speed predicted by the kdv model and that computed using the two layer model hao 2019 hao and shen 2020 in summary the benchmark test shows that the present model captures the dynamic coupling between the surface waves and the isw induced surface motions and achieves a comparable accuracy as the high order spectral method based on the two layer model 4 simulation of surface waves over a large amplitude internal wave 4 1 problem setup in this section we present the simulation of surface waves over a large amplitude internal wave of realistic parameters extracted from the simulation results of the nonhydrostatic suntans model nested within a regional model rogers et al 2019 since the curvature of the isw front is weak we choose to neglect it and only consider unidirectional isw in the following analysis fig 9 shows the spatial distribution of the density along the x direction the internal wave is observed by the displaced contour shape of the density in the region 5 x 0 km with the suntans data we can determine the key parameters required for prescribing the internal wave in the present model we choose a density ratio of 1020 1024 0 996 in the two layer ocean model the upper layer depth is usually taken as the pycnocline depth where the vertical gradient of the density reaches its maximal value equivalently this is the depth where the background buoyancy frequency is also maximal and we find its value to be around 50 m see the buoyancy frequency profile in rogers et al 2019 since the ocean depth is approximately 500 m there we choose a lower layer depth of 450 m note that the layer depths here refer to h 1 and h 2 which are different from the layer depths h u and h l used in the simulation table 2 as explained in section 2 2 we set the internal wave amplitude at 100 m corresponding to the maximal density contour displacement shown in fig 9 with the capability of resolving the large amplitude internal wave in the present model there is no need to reduce the internal wave amplitude for the convergence of the perturbation expansion which has been adopted in previous studies based on the weakly nonlinear kdv model stanton and ostrovsky 1998 hao and shen 2020 we can estimate the dispersion property of the isw by calculating γ 1 h 1 a i l and γ 2 h 2 a i l where l is the characteristic length scale of isw taking l 2500 m we can get γ 1 0 06 and γ 2 0 14 therefore the assumption of γ 1 4 1 and γ 2 4 1 used in the mcc model is satisfied see e g miyata 1985 the initial surface wave field is also constructed from the jonswap spectrum hasselmann et al 1973 with a peak wavelength of 35 m after accounting for the aliasing error the effective grid size is approximately 30 cm in both directions more information on the parameter settings can be found in table 2 4 2 nonlinearity of internal wave profile we first compare the internal wave profiles predicted by the kdv model and the mcc model fig 10 a shows a noticeable difference in the internal wave widths at the present simulation setup the kdv model underestimates the width and the internal wave steepness is overestimated note that this discrepancy also varies with other parameters such as the layer depth ratio in fig 10 b we plot the maximum steepness of the internal wave as a function of the normalized amplitude as expected stastna and lamb 2008 for all three layer depth ratios h u h l 0 02 0 05 0 1 the kdv model predicts a significantly faster steepness ε growth with the increasing amplitude α a i h u compared with the mcc model for the parameter setting in the present case see table 2 the steepness predicted by the kdv model is nearly 0 6 the unphysical steepness leads to a numerical instability because the perturbation expansion shown in eq 6 assumes that ε is not too large and that η and η b can be expanded to the same order in terms of ε by using the mcc model we can obtain the correct internal wave profile 4 3 result the effects of the strongly nonlinear internal wave on the surface waves can be observed directly from the surface wave field the time history of a cross section of the surface wave field η x y l y 2 is shown in fig 11 according to hao and shen 2020 the time scale of the surface manifestation formation is much smaller than that of the internal wave for the present case the surface roughness variations pattern also forms within 4 t p the boundary between the smooth region and the rough region is clearly seen by the location corresponding to the internal wave trough denoted by the black dashed line in fig 11 the formation of the smooth and rough regions is known to be a result of the nonlinear interaction of the surface waves with the current field induced by the internal wave since the present physical system in fig 1 b is uniquely determined by the quantities at the surface and the bottom boundary namely η φ s η b and φ b a full grid is needed for the discretization of the vertical space to compute the full 3d velocity field from these boundary variables for an arbitrary grid the computational cost is high because the velocity potential can only be calculated at each grid point from eq 9 with the surface quantities η and φ s obtained from our simulation we can calculate the 3d velocity field by defining a boundary fitted grid 30 ζ x y z z η x y h η b x y η x y then ζ 0 and ζ 1 correspond to the surface z η and the bottom z h η b respectively for a given ζ between 0 and 1 it defines a curved plane with a mean value of z ζ h the velocity potential on this plane is then calculated using fast fourier transform from eq 9 we remark that the velocity field and the grid are not required in the simulation and can be generated on demand in post processing therefore their calculations do not affect the computational efficiency of our model a cross section of the instantaneous velocity field in the x z plane is shown in figs 12 and 13 note that the full velocity field is a combination of the velocity induced by the internal wave and the orbital velocity of the surface wave field they can be separately identified from the contours by the difference in their length scales the streamwise velocity induced by the internal wave is nearly invariant with the depth and comparable to the surface wave orbital velocity while the vertical velocity induced by the internal wave is weaker than the streamwise velocity 5 conclusions in this study we have developed an efficient phase resolved model for simulating the surface waves interacting with a large amplitude internal wave the surface wave solver in our model is based on the direct computation of the laplace equation in terms of the velocity potential by performing the perturbation expansion and taylor expansion the surface and bottom quantities are written as the sums of the eigenfunctions of the system such that the nonlinear terms can be calculated using the spectral method the surface wave solver is therefore capable of simulating a general broadband dispersive surface wave field the internal wave solver i e the mcc model provides the bottom boundary condition to the surface wave solver to test the present model we have performed three different types of simulations in the first test case we choose a small amplitude internal wave and eliminate the surface wave in the initial condition the surface velocity potential associated with the internal wave converges as the grid number increases we have also examined the nonlinear feature of the model we show the existence of the resonant triads by examining the dispersion relation of the surface wave and internal wave components by solving the governing equations with perturbation expansions to the second order we derive the initial growth rate of the resonant wave amplitude the simulations based on the present model produce the nonlinear resonance phenomenon and the initial wave amplitude growth rate is consistent with the theoretical prediction the third case is a benchmark test against the simulations based on the full two layer model we find the surface wave elevation computed using the present model to be consistent with the two layer model result we have shown the application of the present model in combination with the large scale model suntans to set up the simulation we extract the layer depths the water density ratio and the internal wave amplitude from the suntans result we compare the internal wave profile computed from the kdv model and the mcc model and the result confirms the well known finding that the mcc model result gives a more reasonable local wave steepness of moderately nonlinear isws as compared to the kdv model the roughness variation pattern has been identified from the time evolution of the surface elevation we have also computed the full velocity field from the surface and bottom quantities it is found that the streamwise velocity component induced by the internal wave has the same order of magnitude as the surface wave orbital velocity while the vertical velocity component is smaller finally the zoomed in view of the velocity field near the surface also exhibits a spatial variation in the surface wave orbital velocity that is associated with the surface motions induced by the internal wave our model can solve a complex wave field in the presence of a large amplitude internal wave and thus address the scale separation issue compared with the two layer model that has four evolution equations i e eqs a 10 a 13 our model only solves two equations i e eqs 3 and 4 and is therefore computationally more efficient note that the computational cost required for prescribing the boundary condition using the mcc solver is negligibly small compared with that for solving the evolution equations we remark that the enhanced computational efficiency is important for resolving the short surface wave dynamics above the long isw the computational cost caused by scale separation is not a serious issue in previous studies based on the two layer model because the relatively simple wave configurations require much fewer grid points for example the maximum numbers of grid points are 2 1 0 3 in alam 2012 2 6 1 0 5 in tanaka and wakayama 2015 and 5 1 0 5 in choi et al 2021 respectively as a comparison the grid number used in our final case is 3 8 1 0 7 therefore our model can be used for a quick estimation of the internal wave properties in oceanic applications we also remark that with the increase in computing power the continuous stratification effect neglected in the present study may be incorporated in future studies by combining a submesoscale les that resolves the short ocean surface waves xuan and shen 2019 and the large scale model suntans fringer et al 2006 following the nested modeling framework rogers et al 2019 the present model also neglects the finer scale deformations due to turbulence instability however isws in the field are often highly turbulent in their core via convective instabilities lien et al 2012 2014 and along the pycnocline in the form of shear instabilities barad and fringer 2010 chang 2021 as a result the boundary value of the velocity potential φ b see fig 1b may be multiply defined because of turbulent distortions additionally the diffuse pycnocline in continuous stratification can lead to uncertainties in the layer depth h and the internal wave profile η b the effects of these processes on the surface roughness variation may be assessed by a sensitivity analysis based on our model and the cross validation against les based studies in the future finally the modulation of the capillary gravity surface waves by internal wave beams or packets is important in marine engineering applications the capillary effect has been incorporated into the two layer model hao and shen 2020 and the present model can be modified in the same spirit however it is challenging to further extend these potential flow based models to the simulation of the shorter internal waves in the continuous stratification and dns les is more appropriate to capture the resulting surface manifestation zhou and diamessis 2016 credit authorship contribution statement xuanting hao conceptualization methodology software validation formal analysis visualization writing original draft writing review editing jie wu conceptualization methodology justin s rogers methodology software writing review editing oliver b fringer methodology software writing review editing lian shen conceptualization writing review editing supervision project administration funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research is supported by onr usa with grants to l s and o f the authors gratefully acknowledge the reviewers for their valuable comments appendix governing equations for two layer model we give a brief review of the governing equations obtained by alam et al 2009 to simulate the wave dynamics in the two layer system fig 1a for the incompressible inviscid and immiscible two layer fluids the poisson equations for the velocity potential are a 1 ϕ u 2 x 2 ϕ u 2 y 2 ϕ u 2 z 2 0 a 2 ϕ l 2 x 2 ϕ l 2 y 2 ϕ l 2 z 2 0 the kinematics and dynamics boundary conditions at the surface z η u are a 3 η u t x η u x ϕ u ϕ u z 0 a 4 ϕ u t g η u 1 2 x ϕ u x ϕ u 0 at the interface z h u η i the boundary conditions yield a 5 η i t x η i x ϕ u ϕ u z 0 a 6 η i t x η i x ϕ l ϕ l z 0 a 7 ϕ u t g η l 1 2 x ϕ u x ϕ u p u ρ u 0 a 8 ϕ l t g η l 1 2 x ϕ l x ϕ l p l ρ l 0 a 9 p l p u where p u and p l are the interface pressure on the upper layer and the lower layer side respectively the above boundary conditions can be reorganized into four evolution equations a 10 η u t x η u x ϕ u s 1 x η u 2 ϕ u z a 11 ϕ u s t g η u 1 2 x ϕ u s 2 1 2 1 x η u 2 ϕ u z 2 a 12 η l t x η i x ϕ u i 1 x η i 2 ϕ u z a 13 ψ i t 1 2 r x ϕ u i 2 x ϕ l i 2 g η i 1 r 1 2 1 x η i 2 ϕ l z 2 r ϕ u z 2 where ϕ u s x y t ϕ u x y z η u x t t and ψ i x y t ϕ l x y z η i h u t r ϕ u x y z η i h u t the two layer system is then uniquely determined by a group of four quantities at the surface and interface η u η i ϕ u s and ψ i 
23846,in this study we propose a new method for simulating complex surface waves interacting with a large amplitude internal solitary wave our model is based on a high order spectral method for surface waves with the bottom boundary conditions computed from an internal wave solver the convergence of the model is first tested using an internal wave case without surface waves we then perform simulations of a canonical nonlinear wave interaction case involving two surface wave components and a prescribed internal wave component the initial wave energy growth rate of the resonant wave component is found to agree with the analytical value predicted by the perturbation theory we also use the model to simulate the interaction between surface waves and a weakly nonlinear internal wave and the result is nearly identical to that calculated using a two layer model finally we show the application of our model in a multiscale nested modeling framework where the internal wave parameters are extracted from the mesoscale simulation using a nonhydrostatic ocean model the evolution of the spatial variations of the surface roughness is captured and the surface wave orbital velocity also changes in space due to the surface motions induced by the internal wave our phase resolved model provides a computationally efficient tool for simulating complex surface wave fields in the background of internal waves of large amplitudes keywords surface wave internal wave interaction internal solitary wave nonlinear resonant wave interaction 1 introduction internal solitary waves isw are widely observed in oceans through their manifestations at the sea surface see e g osborne and burch 1980 jackson et al 2013 xue et al 2013 bai et al 2014 celona et al 2021 lenain and pizzo 2021 because an internal wave iw can travel for a long distance from the place of generation in the deep ocean before it eventually breaks nearshore its impact on the energy and nutrient redistribution is significant alford et al 2015 woodson 2018 the interaction dynamics between surface and internal waves has been an important research topic for tracking the propagation of internal solitary waves helfrich and melville 2006 while the short internal waves directly associated with the buoyancy frequency are also ubiquitous in a stratified ocean their time and length scales are much smaller than those of nondispersive solitary waves and thus have different physical properties in this study we limit our discussions to the long internal solitary waves and for brevity they are referred to as internal waves unless otherwise noted the models for simulating internal waves can be divided into two categories based on the treatment of oceanic stratifications in the first type of models the ocean is simplified to a two layer fluid system where the interface is roughly the pycnocline and the effects of viscosity and continuous buoyancy are neglected while in the second type the density profile is continuous when the internal wave nonlinearity is small a i h 1 and the internal wave is sufficiently long h λ 1 one can derive the korteweg de vries kdv benjamin 1966 djordjevic and redekopp 1978 ostrovsky and stepanyants 1989 equation from the euler equations here a i and λ are the amplitude and the length scale of the internal wave respectively and h is a vertical length scale for instance the upper layer depth note that the amplitude a i is generally taken as the maximum isopycnal displacement however internal waves in the ocean often have large vertical displacements stanton and ostrovsky 1998 duda et al 2004 therefore it is more appropriate to account for this strong nonlinearity a i h o 1 and retain only the weak dispersion assumption h λ 1 which leads to the mcc miyata choi camassa model miyata 1985 choi and camassa 1999 the mcc model provides an apparent improvement in modeling the large amplitude internal wave profile and propagation speed compared with the predictions based on the kdv models while the mcc model may suffer from numerical instability issues at high wave numbers for sufficiently large internal wave amplitude helfrich and melville 2006 its overall performance agrees well with laboratory observational and other numerical results in addition to the kdv and mcc models the original euler equations of the two layer fluid system can be directly solved for a solitary wave solution the euler equation results however can be accurately predicted by the mcc model over a wide range of parameters for a more comprehensive review of the two layer models the reader is referred to helfrich and melville 2006 a major deficiency of the two layer models is the simplified oceanic stratifications for example compared with the continuously stratified model the two layer model predicts a less accurate location when the fission of internal waves occurs bai et al 2019 additionally when the nonlinearity is strong i e a i h 1 the perturbation expansion is no longer applicable the second type of internal wave model takes into account the continuous stratification under the boussinesq approximation one can derive the dubreil jacotin long djl equation dubreil jacotin 1934 long 1953 which describes the isopycnal displacement from the undisturbed position unlike the kdv type of waves that assume weak nonlinearity the djl equation produces a fully nonlinear internal wave of the permanent form turkington et al 1991 developed an iterative algorithm to calculate the fully nonlinear solution see also stastna and lamb 2002 dunphy et al 2011 applied the fourier spectral method to the turkington et al 1991 algorithm and achieved a significant improvement in the convergence and efficiency performance a major application of the djl solution is to serve as the initial condition for isws in the turbulence resolving simulations e g sakai et al 2020a it should be noted that the isw of permanent forms cannot reveal the unsteady dynamics of the isw itself but also the finer scale motions that develop across the water column from the free surface to the bottom boundary layer for this purpose the euler equation and navier stokes equations can be directly solved to capture these processes depending on the application of interest e g the internal wave breaking caused by the depth variation for the inviscid fluid stastna and peltier 2004 the turbulence effect in internal wave breaking can be resolved by using the direct numerical simulation dns of the navier stokes equations venayagamoorthy and fringer 2006 2007 arthur and fringer 2014 2016 recently sakai et al 2020a b performed large eddy simulation les of a large amplitude internal wave propagating against a background barotropic current to reduce the computational cost required to capture the features of the turbulence scale much smaller than the driving isw they focused on the development of the bottom turbulent boundary layer diamantopoulos 2021 studied convectively breaking shoaling isws over a gentle slope in the south china sea the isws at the production scale have also been studied by models based on the reynolds averaged navier stokes equations with the boussinesq approximation for instance the stanford unstructured nonhydrostatic terrain following adaptive navier stokes simulator suntans fringer et al 2006 rogers et al 2019 davis et al 2020 the computational cost is a major concern if les is used to capture both the turbulence and internal waves in a stratified ocean because the grid resolution must be fine enough to resolve the ozmidov scale fringer et al 2019 motivated by the recent lower resolution three dimensional simulations of rivera rosario et al 2022 significant progress was made recently by diamantopoulos 2021 where 1 km long isws propagating 80 km with resolutions between 0 25 and 1 m in all three directions in the region of isw breaking were simulated within the affordable computational cost to simulate dispersive surface gravity waves over a nondispersive internal wave the main challenge is to address the issue of scale separation in early studies the interactions between surface waves and internal waves have been treated in the framework of wave current interactions where the internal wave dynamics are simplified to a prescribed spatially varying surface current peregrine 1976 alpers 1985 the propagation of the surface waves in this inhomogeneous current is usually tracked in a phase averaged manner following the geometric optics approach bakhanov and ostrovsky 2002 while the phase averaged method produces a surface wave sw energy change similar to the surface roughness variations induced by the internal wave it is restricted by the assumption that the surface waves changes slowly which may not be the case because of wave reflection craig et al 2012 to overcome this limitation some recent studies explored the surface wave internal wave interaction from a phase resolved perspective based on a two layer model for instance the two layer model is transformed into the nonlinear schrödinger equation coupled with the kdv equation which reveals the impact of an internal wave on a narrow banded surface wave packet craig et al 2012 in another example a second order approximation to the two layer model is derived based on the long wave approximation neglecting the short surface wave dynamics jiang et al 2019 the first direct numerical evidence of the surface roughness manifestations induced by the internal wave has recently been produced by hao and shen 2020 through the direct simulation of the two layer model without the narrow band surface wave and long wave assumptions the physical parameters including the layer depths and the density ratio are comparable to those in a field observation stanton and ostrovsky 1998 except that the internal wave amplitude is only one fifth of the actual value in the present study we present a new model for simulating surface waves over a large amplitude internal wave with a i h o 1 the maximum amplitude can be as large as 20 40 of the total water depth the surface waves are modeled using a phase resolved high order spectral method considering that the mcc model can produce a reasonably well isw dynamics we use it to generate the isw boundary condition to force the surface wave solver another advantage of the mcc model is easy implementation because our solver is modified from the numerical solver for a two layer fluid system alam et al 2009 and the mcc model was also developed under the same two layer ocean stratification assumption in contrast to the fully coupled surface wave internal wave dynamics in the two layer model the internal wave is independent of the surface waves in our model our focus is therefore on the upper layer which can be seen as an analogy to the strategy used by sakai et al 2020a b to address the scale separation in turbulence isw interaction in the context of the isw induced bottom boundary layer by retaining the one way impact of the internal wave on the surface waves we can reduce the computational cost encountered in simulations based on the two layer model hao and shen 2020 meanwhile because the mcc model used in this study does not require a weak nonlinearity assumption it is more suitable for resolving the dynamics of realistic ocean internal waves compared with the kdv type of internal wave treatment in hao and shen 2020 while the mcc model was established on the weak dispersion assumption and neglects the isw deformation evolution we expect the dispersion effect to be minor because the isw induced surface patterns are generated within a short time duration of a few characteristic surface wave periods the remainder of this paper is organized as follows in section 2 we present the mathematical formulations for the high order spectral method in section 3 we perform three types of simulations to validate the model including a simple internal wave the nonlinear triad interaction problem and a benchmark test against the full two layer model in section 4 we perform a simulation of surface waves over a large amplitude internal wave where the parameters are extracted from a large scale suntans simulation conclusions are given in section 5 2 mathematical formulation the physical system is equivalent to the upper layer in the canonical two layer ocean model and the bottom boundary corresponds to the interface elevation the difference and connections between the two layer model and the present model are illustrated in fig 1 a and b in the appendix we provide the details of the governing equations for the two layer model our model includes a solver for capturing the evolution of the surface wave field and the mcc model for providing the information of the isw as the boundary condition of the surface wave solver 2 1 surface wave solver in this section we present the numerical scheme for the surface wave solver the horizontal coordinates are denoted by x and y and the vertical coordinate is denoted by z the still water level is at z 0 the fluid is assumed to be incompressible and inviscid the potential flow assumption yields the laplace equation 2 φ 0 for the velocity potential φ and the dynamic and kinematic boundary conditions of the sea surface can be written as dean and dalrymple 1991 1 η t x φ x η φ z 0 z η x y t 2 φ t g η 1 2 φ φ 0 z η x y t where η x y t denotes the ocean surface elevation x y z is the full gradient operator and x x y is the gradient operator in horizontal directions following zakharov 1968 the above two boundary conditions can be reformulated in terms of η x y t and the surface velocity potential φ s x y t φ x y z η t as 3 η t x φ s x η 1 x η x η φ z 0 z η 4 φ s t g η 1 2 x φ s x φ s 1 2 1 x η x η φ z 2 0 z η the kinematic boundary condition at the bottom is 5 φ φ b x y t z h η b x y t where h is the mean water depth η b x y t is the prescribed bottom elevation and φ b x y t is the prescribed velocity potential at the bottom this equation serves as the dirichlet boundary condition for the velocity potential in the upper layer fluid as shown in fig 1 b the velocity potential can be written as the perturbation series with respect to wave steepness 6 φ x y z t m 1 m φ m x y z t h η b z η where φ m m 1 2 m denotes the m th order value at each time step φ s x y t and φ b x y t are first calculated from the previous time step as the dirichlet boundary conditions for the velocity potential let ϕ m φ m x y z 0 t and ψ m φ m x y z h t the dirichlet boundary condition at surface is expanded in taylor series around z 0 and ϕ m can then be calculated successively 7 ϕ 1 φ s ϕ m l 1 m 1 η l l l φ m l z l z 0 m 2 3 m similarly we can solve for ψ m at the bottom 8 ψ 1 φ b ψ m l 1 m 1 η b l l l φ m l z l z h m 2 3 m to calculate the derivatives in eqs 7 and 8 we write φ m as the sum of eigenfunctions of the system liu and yue 1998 9 φ m x z t n 1 n α n m t sinh k n z h sinh k n h β n m t sinh k n z sinh k n h e i k n x where α n m t and β n m t are coefficients to be determined x x y is the horizontal coordinate vector and k n k n x k n y is the wavenumber vector corresponding to the n th eigenfunction substituting the expressions of ϕ m and ψ m into eq 9 we can readily obtain ϕ m n 1 n α n m t e i k n x and ψ m n 1 n β n m t e i k n x therefore α n m t and β n m t are the fourier coefficients of ϕ m and ψ m in the spectral space respectively the vertical velocity at the surface is calculated as 10 φ x z η t z m 1 m l 0 m m η l l l 1 z l 1 φ m x 0 t the numerical scheme for solving eqs 7 and 8 follows the original high order spectral method for waves in deep water and finite depth water dommermuth and yue 1987 liu and yue 1998 compared with the numerical method for the two layer model with four governing equations alam et al 2009 the present model only need to solve two evolution equations at each time step the vertical velocity is first calculated from eq 10 and the nonlinear terms are calculated directly in the physical space the fast fourier transform is used to calculate the fourier coefficients of a physical quantity and vice versa the wave field is then advanced in time by using the runge kutta fourth order scheme 2 2 internal wave solver in this section we introduce the internal wave solver which provides the dirichlet boundary condition at the bottom including the values of η b and φ b for long internal waves when the nonlinearity is weak a i h u 1 a kdv equation can be derived from the two layer model depending on the treatment of the small parameters such as the ratio of the amplitude to the upper layer depth the specific form of the equation and thus the solution vary an example is djordjevic and redekopp 1978 11 η i x a i sech 2 x c i t λ where a i is the amplitude c i c i r h u h l g is the wave speed r ρ u ρ l is the ratio of the upper layer density to the lower layer density see fig 1 and λ λ r h u h l g is a length scale of the solitary wave in hao and shen 2020 the kdv solution is used as the initial condition in the direct simulation of a two layer model when the internal wave amplitude increases the solution obtained from the kdv equation becomes less accurate helfrich and melville 2006 in fact in situ observations have shown that the amplitude of the oceanic internal waves is often large for example the maximum amplitude normalized by the total water depth a i h u h l was found to be 0 40 off the oregon coast moum et al 2003 0 20 on the new jersey shelves teague et al 2011 and 0 22 in the south china sea tang et al 2015 according to michallet and barthélemy 1998 the mcc prediction is nearly identical to the fully nonlinear result even when a i h u h l 0 4 therefore it is applicable to generate the dynamics of typical large amplitude isws from the mcc model and provide them as the boundary condition to the surface wave solver in the mcc model the internal wave elevation in the frame of reference moving at the propagation speed is 12 d η i d ξ 2 3 η i 2 c i 2 r h 2 η i c i 2 h 1 η i g 1 r h 1 η i h 2 η i c 2 r h 1 2 h 2 η i h 2 2 h 1 η i where c i c 0 h 1 a i h 2 a i h 1 h 2 a i c 0 2 g is the wave speed c 0 g h 1 h 2 1 r r h 2 h 1 is the leading order approximation to c i in the long wave limit h 1 ξ h u η i ξ and h 2 ξ h l η i ξ are the local fluid depths and ξ x c i t is the coordinate moving with the internal wave given the internal wave amplitude a i we can set η i ξ 0 a i and η i ξ 0 to solve eq 12 we define 13 g η i d η i d ξ 2 3 η i 2 c i 2 r h 2 η i c i 2 h 1 η i g 1 r h 1 η i h 2 η i c 2 r h 1 2 h 2 η i h 2 2 h 1 η i here g η i is a functional of η i and eq 12 is equivalent to g η i 0 the newton s method is then used to search for the optimal η i the kdv solution is used as the initial guess η l 0 in each iteration we perform the update by η l i 1 η l i j g η l i 1 g η l i where η l i and η l i 1 are the internal wave profile in two consecutive iteration steps and j g η l i denotes the jacobian matrix of g η l i with respect to η l i note that the internal wave profile η i ξ calculated here has a nonzero mean which needs to be removed in our computational domain after the internal wave elevation and speed are calculated they can be decomposed into the sum of the eigenfunctions of the two layer system and the velocity potential of the upper layer fluid at the interface can be obtained hao and shen 2020 then the bottom boundary quantities that propagate at the internal wave speed c i in the present model are matched with the interface quantities 14 η b x c i t y η i x y 15 φ b x c i t y φ u x y z h u η i 3 cases for model validation in this section we present three different cases to validate our model in the first two cases we focus on the convergence performance and accuracy of the solver against theoretical prediction for this purpose we use relatively simple wave configurations the parameters of which are summarized in table 1 in the third case we perform a benchmark test of the model against the simulations of a realistic broadband surface wave field over isw using the two layer model see parameters in table 2 3 1 convergence test we first perform a convergence test on the surface motions induced by the mcc type of internal wave to isolate the effect of the internal wave we set the amplitudes of the surface wave components in the initial condition to zero the surface velocity potential then propagates at the same speed as the internal wave the simulations are performed at multiple grid resolutions in the x direction while the grid number in the y direction is fixed see table 1 as explained above we use the newton s method to calculate the internal wave profile the iteration stops when the error defined as g η i d η i d ξ 2 is smaller than 10 3 the process towards convergence is shown in fig 2 owing to symmetry we only plot half of the internal wave profile while the error decreases continuously see the inset figure in fig 2 the difference in η i becomes indistinguishable after approximately six iterations compared with the converged result i e the mcc solution the initial guess i e the kdv solution significantly overestimates the change of η i with respect to ξ resulting in a much steeper profile which is a well known limitation of the kdv model e g stastna and lamb 2008 hence we use the mcc solution as the initial condition of the grid convergence test for the wave simulation hereafter the grid number in the newton s method is 1024 and the internal wave profile is filtered according to different grid numbers in the wave simulation we then calculate the surface current as u x d φ s x d x as shown in fig 3 a when the grid number is small e g n x 16 there is a noticeable deviation near the maximum and minimum of u x the results converge at large grid numbers e g n x 512 in fact the deviation becomes visually indistinguishable even when n x 64 the l 2 error decreases substantially with the growing grid number as shown in fig 3 b and thus confirms the convergence in all of the following simulation cases with both large scale internal solitons and surface waves the main challenge is to resolve the small scale surface wave dynamics therefore we use a larger grid number e g n x 12 288 in the second case in table 2 than the test cases in this section and we expect their grid resolutions to be sufficiently fine to resolve the internal wave dynamics and the associated surface current while the isw also induces a surface displacement it is significantly smaller than the surface wave heights under realistic ocean conditions for example moum and smyth 2006 found that the surface displacement induced by a typical isw off the oregon coast is less than 1 cm 3 2 nonlinear triad interaction in this section we test the framework i e a surface wave model coupled with a prescribed internal wave via a nonlinear physical process we do not use the mcc model to prescribe an internal solitary wave but instead only consider sinusoidal internal waves of small amplitude and steepness the main objective is to demonstrate that nonlinear triad interactions can form in the present model system and further validate our model by comparing the energy transfer in this nonlinear process against the theoretical prediction it has been known that nonlinear resonant interaction can occur among three wave components when certain conditions are satisfied ball 1964 joyce 1974 wen 1995 hill and foda 1996 alam 2012 this phenomenon is also known as the triad interaction and energy is transferred continuously among the three waves in resonance it may also lead to the broadening of the bandwidth of wave spectrum with the generation of resonant components tanaka and wakayama 2015 because the physical system in our model is slightly different from the original two layer model the conclusions obtained for triad interaction in those previous studies cannot be directly applied here in the surface wave solver the bottom condition is fixed and unaffected by the surface wave dynamics therefore we expect the triad interaction to be similar to the resonance interaction between surface waves in shallow water and bottom ripples liu and yue 1998 given the dispersion relation of a wave system the resonant condition required for the triad interaction to occur can be determined from the governing equations the dispersion relation of the two layer fluid system is determined by the density ratio r ρ u ρ l and the layer depths h u and h l and can be written as 16 ω 4 r coth k h u coth k h l ω 2 g k coth k h u coth k h l g 2 k 2 1 r 0 where each wavenumber k corresponds to two solutions of frequency ω and thus two different eigenmodes of the system i e the fast surface wave mode and the slow internal wave mode apel 1988 now suppose that in our system shown in fig 1 b there is a free surface wave component k s ω s where ω s 2 g k s tanh k s h and a prescribed internal wave component k i ω i satisfying eq 16 the resonant condition states that a second surface wave component k r ω r is generated when 17 k s k i k r 18 ω s ω i ω r 19 ω r 2 g k r tanh k r h given the values of k s ω s and k i ω i the resonant wave component properties k r ω r can be calculated by solving eqs 17 19 numerically fig 4 a shows an example of the resonant triad components the new surface wave generated in resonance has a larger wavenumber and frequency than the existing surface wave in the system another example is shown in fig 5 a where the wavenumber and frequency of the resonant component are smaller than those of the existing component these two examples correspond to the sum and difference type of triad interaction shown in eq 17 respectively in the triad interaction both the existing component k s ω s and the resonant component k r ω r are fast surface wave modes and fall onto the surface wave dispersion relation curve to perform a quantitative analysis on the wave energy transfer we use perturbation expansion to solve the governing equation following liu and yue 1998 by combining eqs 1 and 2 and eliminating the surface elevation η we can obtain a single evolution equation written in terms of the velocity potential 20 2 φ t 2 g φ z 2 φ φ t 1 2 φ φ φ 0 this equation is then expanded to the first order and the second order as in eq 6 21 2 φ 1 t 2 g φ 1 z 0 22 2 φ 2 t 2 g φ 2 z η 1 z 2 φ 1 t 2 g 2 φ 1 z 2 2 φ 1 φ 1 t now we consider the general solution to the first order system described by eq 21 suppose there is a surface wave component and an internal wave component prescribed by the bottom boundary condition and the solution can be written as 23 η 1 a s cos k s x ω s t a i cos k i x ω i t 24 φ 1 a s g ω e k z sin k s x ω s t a i g ω i cosh k i z ω i k i sinh k i z sin k i x ω i t where a s and a i are the amplitudes of the surface wave component and the internal wave component respectively in the following theoretical analysis we use the eigenfunction in the deep water e k z sin k s x ω s t for the surface wave component to facilitate the analysis this simplification holds for the examples in figs 4 a and 5 a noticing that k s h 4 note that the deep water assumption is not imposed in our simulation when a triad solution of eqs 17 and 19 exists the nonlinear terms on the right hand side of eq 22 generates a resonant forcing term we first consider the triad resonance k r k s k i and ω r ω s ω i shown in fig 4 a substituting the first order solution into eq 22 and neglecting the non resonant terms we have 25 φ t t 2 g φ z 2 a i a s f sin k r x ω r t 26 f ω i 3 2 g 2 k 2 2 ω i g 2 k s k i ω s g k s ω i g k s ω i 2 ω s g 2 k s k i ω i similarly we can compute the resonant forcing term corresponding to the triad waves k r k s k i and ω r ω s ω i shown in fig 5 a 27 φ t t 2 g φ z 2 a i a s f sin k r x ω r t 28 f ω i 3 2 g 2 k 2 2 ω i g 2 k s k i ω s g k s ω i g k s ω i 2 ω s g 2 k s k i ω i the forcing terms in eqs 25 and 27 generate secular solutions with an energy growth in the resonant component the asymptotic solution at t 0 is φ a i a s f 2 ω r t cos k r x ω r t because η φ t g we can obtain the initial growth rate of a r i e the amplitude of the resonant component 29 γ a i a s f 2 g to compare the theoretical and numerical solutions we perform two numerical experiments which correspond to the resonance quantified by eqs 25 and 27 respectively because the triad interaction is a high order nonlinear process we use a strong stratification of r 0 5 following alam et al 2009 to increase its strength and better present the validation result therefore we expect the dynamic coupling in this case to be much stronger than those in choi et al 2021 where the density ratios are 0 86 and 0 99 for the same type of resonance the initial wave field is the first order solution consisting of a surface wave component and an internal wave component as defined in eqs 23 and 24 the internal wave properties are calculated for a given set of parameters of the two layer system for both cases we choose the same internal wave properties the normalized water depth is k i h 2 5 to match the upper layer depth in the two layer model because the triad resonant interaction occurs at the second order the perturbation order needs to be m 2 to ensure the nonlinear dynamics be resolved in each experiment we repeat the runs for different perturbation order m 2 3 4 all simulations run for a total time duration of 84 t i at a time step of 0 008 t i with t i being the period of the internal wave component other parameters can be found in table 1 the simulation results are shown in figs 4 b and 5 b despite the small wave amplitude in the initial condition see table 1 a resonant wave component is generated in both cases suggesting the existence of the nonlinear triad interaction the curves collapse for various perturbation orders because the second order nonlinear forcing terms dominate the energy transfer in triad interaction initially there is indeed a linear growth stage in the amplitude of the resonant wave component and the growth rate agrees well with the theoretical prediction denoted by the black dashed line in the entire simulation duration the amplitude of the resonant wave component fluctuates periodically in time as shown the time scale of this amplitude oscillation is larger than the fast wave oscillations by one to two orders of magnitude this behavior is in general consistent with the triad interactions among the surface wave and internal wave components found in the full two layer fluid system ball 1964 alam 2012 3 3 benchmark test against the two layer model result we further perform a benchmark test against the two layer model result besides the high order spectral method proposed by alam et al 2009 the explicit hamiltonian system developed by taklo and choi 2020 can also capture the dynamic coupling between surface waves and internal waves in the two layer fluid system theoretically these two methods are equivalent up to the second order in this test case the two layer model result refers to the simulation data obtained by the high order spectral method hao and shen 2020 and we set up our simulation with the same initial condition and numerical parameters e g the grid numbers and the time steps as their study the surface wave components are specified by the empirical joint north sea wave project jonswap spectrum hasselmann et al 1973 and the directional spreading function the two layer parameters i e the density ratio and the layer depth are extracted from field observations stanton and ostrovsky 1998 the internal wave component is constructed from kdv solution the parameters used in the present model are listed in table 2 to validate the boundary condition described in eqs 5 14 and 15 we compare the internal wave profiles and the boundary values of the velocity potential calculated from our model and the two layer model the definitions of these boundary quantities can be found in fig 1 for convenience we only compare the results at the center of the computational domain y l y 2 which is reasonable because the variations of the isws in the y direction are negligible as shown in fig 6 a and b our result agrees well with the two layer model result with slight deviations we also calculate the correlation coefficients c η for the isw profile and c φ for the boundary value of the velocity potential between the results from different models see fig 6c throughout the simulation duration we find that c η 0 998 and c φ 0 995 which again supports the boundary condition in the present model fig 7 shows a comparison of the instantaneous surface wave elevation overall the surface roughness variations computed with the present model agree well with the two layer model result fig 8 a b and c compare the 1d distribution of the surface elevation at three cross sections denoted by the black lines in fig 7 a the difference in η x y l y 2 shown in fig 8 a and η y smooth shown in fig 8 b is small and the relative error is roughly within 5 in contrast we find the deviations in η y rough shown in fig 8 c to be slightly larger note that the deviations are mainly local while the large scale portion of η y rough are largely consistent following hao and shen 2020 we compute the steepness ratio defined as r s η rough η smooth where denotes the spatial average similar to the two layer model result the value of r s increases linearly first and then saturates in the present model the growth rate of r s in the present model as indicated by the initial slope of the curve is slower than that in the two layer model this is associated with the difference in the internal wave speed predicted by the kdv model and that computed using the two layer model hao 2019 hao and shen 2020 in summary the benchmark test shows that the present model captures the dynamic coupling between the surface waves and the isw induced surface motions and achieves a comparable accuracy as the high order spectral method based on the two layer model 4 simulation of surface waves over a large amplitude internal wave 4 1 problem setup in this section we present the simulation of surface waves over a large amplitude internal wave of realistic parameters extracted from the simulation results of the nonhydrostatic suntans model nested within a regional model rogers et al 2019 since the curvature of the isw front is weak we choose to neglect it and only consider unidirectional isw in the following analysis fig 9 shows the spatial distribution of the density along the x direction the internal wave is observed by the displaced contour shape of the density in the region 5 x 0 km with the suntans data we can determine the key parameters required for prescribing the internal wave in the present model we choose a density ratio of 1020 1024 0 996 in the two layer ocean model the upper layer depth is usually taken as the pycnocline depth where the vertical gradient of the density reaches its maximal value equivalently this is the depth where the background buoyancy frequency is also maximal and we find its value to be around 50 m see the buoyancy frequency profile in rogers et al 2019 since the ocean depth is approximately 500 m there we choose a lower layer depth of 450 m note that the layer depths here refer to h 1 and h 2 which are different from the layer depths h u and h l used in the simulation table 2 as explained in section 2 2 we set the internal wave amplitude at 100 m corresponding to the maximal density contour displacement shown in fig 9 with the capability of resolving the large amplitude internal wave in the present model there is no need to reduce the internal wave amplitude for the convergence of the perturbation expansion which has been adopted in previous studies based on the weakly nonlinear kdv model stanton and ostrovsky 1998 hao and shen 2020 we can estimate the dispersion property of the isw by calculating γ 1 h 1 a i l and γ 2 h 2 a i l where l is the characteristic length scale of isw taking l 2500 m we can get γ 1 0 06 and γ 2 0 14 therefore the assumption of γ 1 4 1 and γ 2 4 1 used in the mcc model is satisfied see e g miyata 1985 the initial surface wave field is also constructed from the jonswap spectrum hasselmann et al 1973 with a peak wavelength of 35 m after accounting for the aliasing error the effective grid size is approximately 30 cm in both directions more information on the parameter settings can be found in table 2 4 2 nonlinearity of internal wave profile we first compare the internal wave profiles predicted by the kdv model and the mcc model fig 10 a shows a noticeable difference in the internal wave widths at the present simulation setup the kdv model underestimates the width and the internal wave steepness is overestimated note that this discrepancy also varies with other parameters such as the layer depth ratio in fig 10 b we plot the maximum steepness of the internal wave as a function of the normalized amplitude as expected stastna and lamb 2008 for all three layer depth ratios h u h l 0 02 0 05 0 1 the kdv model predicts a significantly faster steepness ε growth with the increasing amplitude α a i h u compared with the mcc model for the parameter setting in the present case see table 2 the steepness predicted by the kdv model is nearly 0 6 the unphysical steepness leads to a numerical instability because the perturbation expansion shown in eq 6 assumes that ε is not too large and that η and η b can be expanded to the same order in terms of ε by using the mcc model we can obtain the correct internal wave profile 4 3 result the effects of the strongly nonlinear internal wave on the surface waves can be observed directly from the surface wave field the time history of a cross section of the surface wave field η x y l y 2 is shown in fig 11 according to hao and shen 2020 the time scale of the surface manifestation formation is much smaller than that of the internal wave for the present case the surface roughness variations pattern also forms within 4 t p the boundary between the smooth region and the rough region is clearly seen by the location corresponding to the internal wave trough denoted by the black dashed line in fig 11 the formation of the smooth and rough regions is known to be a result of the nonlinear interaction of the surface waves with the current field induced by the internal wave since the present physical system in fig 1 b is uniquely determined by the quantities at the surface and the bottom boundary namely η φ s η b and φ b a full grid is needed for the discretization of the vertical space to compute the full 3d velocity field from these boundary variables for an arbitrary grid the computational cost is high because the velocity potential can only be calculated at each grid point from eq 9 with the surface quantities η and φ s obtained from our simulation we can calculate the 3d velocity field by defining a boundary fitted grid 30 ζ x y z z η x y h η b x y η x y then ζ 0 and ζ 1 correspond to the surface z η and the bottom z h η b respectively for a given ζ between 0 and 1 it defines a curved plane with a mean value of z ζ h the velocity potential on this plane is then calculated using fast fourier transform from eq 9 we remark that the velocity field and the grid are not required in the simulation and can be generated on demand in post processing therefore their calculations do not affect the computational efficiency of our model a cross section of the instantaneous velocity field in the x z plane is shown in figs 12 and 13 note that the full velocity field is a combination of the velocity induced by the internal wave and the orbital velocity of the surface wave field they can be separately identified from the contours by the difference in their length scales the streamwise velocity induced by the internal wave is nearly invariant with the depth and comparable to the surface wave orbital velocity while the vertical velocity induced by the internal wave is weaker than the streamwise velocity 5 conclusions in this study we have developed an efficient phase resolved model for simulating the surface waves interacting with a large amplitude internal wave the surface wave solver in our model is based on the direct computation of the laplace equation in terms of the velocity potential by performing the perturbation expansion and taylor expansion the surface and bottom quantities are written as the sums of the eigenfunctions of the system such that the nonlinear terms can be calculated using the spectral method the surface wave solver is therefore capable of simulating a general broadband dispersive surface wave field the internal wave solver i e the mcc model provides the bottom boundary condition to the surface wave solver to test the present model we have performed three different types of simulations in the first test case we choose a small amplitude internal wave and eliminate the surface wave in the initial condition the surface velocity potential associated with the internal wave converges as the grid number increases we have also examined the nonlinear feature of the model we show the existence of the resonant triads by examining the dispersion relation of the surface wave and internal wave components by solving the governing equations with perturbation expansions to the second order we derive the initial growth rate of the resonant wave amplitude the simulations based on the present model produce the nonlinear resonance phenomenon and the initial wave amplitude growth rate is consistent with the theoretical prediction the third case is a benchmark test against the simulations based on the full two layer model we find the surface wave elevation computed using the present model to be consistent with the two layer model result we have shown the application of the present model in combination with the large scale model suntans to set up the simulation we extract the layer depths the water density ratio and the internal wave amplitude from the suntans result we compare the internal wave profile computed from the kdv model and the mcc model and the result confirms the well known finding that the mcc model result gives a more reasonable local wave steepness of moderately nonlinear isws as compared to the kdv model the roughness variation pattern has been identified from the time evolution of the surface elevation we have also computed the full velocity field from the surface and bottom quantities it is found that the streamwise velocity component induced by the internal wave has the same order of magnitude as the surface wave orbital velocity while the vertical velocity component is smaller finally the zoomed in view of the velocity field near the surface also exhibits a spatial variation in the surface wave orbital velocity that is associated with the surface motions induced by the internal wave our model can solve a complex wave field in the presence of a large amplitude internal wave and thus address the scale separation issue compared with the two layer model that has four evolution equations i e eqs a 10 a 13 our model only solves two equations i e eqs 3 and 4 and is therefore computationally more efficient note that the computational cost required for prescribing the boundary condition using the mcc solver is negligibly small compared with that for solving the evolution equations we remark that the enhanced computational efficiency is important for resolving the short surface wave dynamics above the long isw the computational cost caused by scale separation is not a serious issue in previous studies based on the two layer model because the relatively simple wave configurations require much fewer grid points for example the maximum numbers of grid points are 2 1 0 3 in alam 2012 2 6 1 0 5 in tanaka and wakayama 2015 and 5 1 0 5 in choi et al 2021 respectively as a comparison the grid number used in our final case is 3 8 1 0 7 therefore our model can be used for a quick estimation of the internal wave properties in oceanic applications we also remark that with the increase in computing power the continuous stratification effect neglected in the present study may be incorporated in future studies by combining a submesoscale les that resolves the short ocean surface waves xuan and shen 2019 and the large scale model suntans fringer et al 2006 following the nested modeling framework rogers et al 2019 the present model also neglects the finer scale deformations due to turbulence instability however isws in the field are often highly turbulent in their core via convective instabilities lien et al 2012 2014 and along the pycnocline in the form of shear instabilities barad and fringer 2010 chang 2021 as a result the boundary value of the velocity potential φ b see fig 1b may be multiply defined because of turbulent distortions additionally the diffuse pycnocline in continuous stratification can lead to uncertainties in the layer depth h and the internal wave profile η b the effects of these processes on the surface roughness variation may be assessed by a sensitivity analysis based on our model and the cross validation against les based studies in the future finally the modulation of the capillary gravity surface waves by internal wave beams or packets is important in marine engineering applications the capillary effect has been incorporated into the two layer model hao and shen 2020 and the present model can be modified in the same spirit however it is challenging to further extend these potential flow based models to the simulation of the shorter internal waves in the continuous stratification and dns les is more appropriate to capture the resulting surface manifestation zhou and diamessis 2016 credit authorship contribution statement xuanting hao conceptualization methodology software validation formal analysis visualization writing original draft writing review editing jie wu conceptualization methodology justin s rogers methodology software writing review editing oliver b fringer methodology software writing review editing lian shen conceptualization writing review editing supervision project administration funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research is supported by onr usa with grants to l s and o f the authors gratefully acknowledge the reviewers for their valuable comments appendix governing equations for two layer model we give a brief review of the governing equations obtained by alam et al 2009 to simulate the wave dynamics in the two layer system fig 1a for the incompressible inviscid and immiscible two layer fluids the poisson equations for the velocity potential are a 1 ϕ u 2 x 2 ϕ u 2 y 2 ϕ u 2 z 2 0 a 2 ϕ l 2 x 2 ϕ l 2 y 2 ϕ l 2 z 2 0 the kinematics and dynamics boundary conditions at the surface z η u are a 3 η u t x η u x ϕ u ϕ u z 0 a 4 ϕ u t g η u 1 2 x ϕ u x ϕ u 0 at the interface z h u η i the boundary conditions yield a 5 η i t x η i x ϕ u ϕ u z 0 a 6 η i t x η i x ϕ l ϕ l z 0 a 7 ϕ u t g η l 1 2 x ϕ u x ϕ u p u ρ u 0 a 8 ϕ l t g η l 1 2 x ϕ l x ϕ l p l ρ l 0 a 9 p l p u where p u and p l are the interface pressure on the upper layer and the lower layer side respectively the above boundary conditions can be reorganized into four evolution equations a 10 η u t x η u x ϕ u s 1 x η u 2 ϕ u z a 11 ϕ u s t g η u 1 2 x ϕ u s 2 1 2 1 x η u 2 ϕ u z 2 a 12 η l t x η i x ϕ u i 1 x η i 2 ϕ u z a 13 ψ i t 1 2 r x ϕ u i 2 x ϕ l i 2 g η i 1 r 1 2 1 x η i 2 ϕ l z 2 r ϕ u z 2 where ϕ u s x y t ϕ u x y z η u x t t and ψ i x y t ϕ l x y z η i h u t r ϕ u x y z η i h u t the two layer system is then uniquely determined by a group of four quantities at the surface and interface η u η i ϕ u s and ψ i 
23847,a high resolution unstructured swan model has been implemented for the changjiang river estuary cre five different winds are adopted to assess their quality over the cre including era5 cfsv2 gfs ccmp nrt and a newly available high resolution 9 km wind product from aprcp asia pacific regional coupled prediction system the performance of the five winds together with four wind input source functions is evaluated by comparing with satellite altimeter observations and multiple in situ observations systemic difference is presented in the four input source functions with the janssen and komen packages outperformingwst in terms of significant wave height h s over the cre the default st6 has comparative skill as janssen during fair weather conditions but tends to predict higher h s during extreme weather events all winds have the tendency to underestimate the altimeter observed h s during fair weather conditions part of the negative bias attributes to the overestimation of altimeter observations while the boundary conditions only play a minor role given a relatively large model domain extending to about 135 e the cfsv2 gfs wind has the best performance during fair weather conditions but overestimates the extreme wave height during typhoon events the era5 on the other hand underestimates h s during both fair and extreme weather conditions in terms of extreme waves ccmp nrt generally agrees best with observations the high resolution aprcp behaves significantly different from other wind forcings and shows poorer performance in wave simulation but high resolution winds have the advantage in resolving the detail wind structure and show better performance in reproducing the high frequency wave fluctuations adjacent to the cre in addition the deviation due to different wind forcings is more distinct than the different input source functions nevertheless given a certain wind forcing calibrations would further improve the model performance this study provides a good start to build a hindcast and forecast system for the cre region keywords wave modeling wind forcing wave growth formulation swan changjiang river estuary 1 introduction good prediction of ocean wave generations and propagations is essential for the interpretation of coastal processes as well as everyday practices such as coastal planning aquaculture disaster risk reduction and engineering applications the changjiang river estuary cre is one of most economically active areas of china several big ports are on the coast or on islands with bridge connecting to the mainland the anchoring area is located right off the cre it experiences severe typhoon storms almost every year presenting coastal hazards such as high waves and surges guo et al 2009 feng et al 2012 yin et al 2018 extreme ocean waves continue to be a threat to all marine related activities and hence their accurate prediction is still a topic among wave forecasts moreover the geometry adjacent to the cre is complex due to islands sea reclamation and ongoing human projects making accurate monitoring and predicting of waves a challenging issue significant advances have been made in understanding the wave physical processes and numerical modeling of surface waves since the first wave model was established cavaleri et al 2020 operational wave hindcasting and forecasting systems have been implemented worldwide on both global and regional scales e g the era5 ocean wave data from the ecmwf european centre for medium range weather forecasts integrated forecast system ifs coupled with wam bidlot et al 2002 2019 bell et al 2021 the global forecast system wave with the wavewatch iii wave model chawla et al 2013 campos et al 2020 and chinese global operational oceanography forecasting system cgofs wang et al 2016b and many others martin et al 2007 tolman et al 2013 balakrishnan nair et al 2013 breivik et al 2015 tonani et al 2015 wang et al 2016a barbariol et al 2019 liu et al 2021 many hindcast and reanalysis datasets have shown good quality in offshore locations but generally have poor resolution and performance in nearshore regions mainly due to poor representation of local winds topography and coastlines e g cavaleri and bertotti 2003 lavidas et al 2017 pallares et al 2017 amarouche et al 2019 galanis et al 2019 wang et al 2019 christakos et al 2020 the quality of the wave forecasts in the coastal and semi enclosed seas is not as high as for the open sea cavaleri et al 2018 for the inner shelf nearshore region a third generation wave model simulating wave nearshore swan has been widely used to simulate the wave generation propagation dissipation diffraction and wave wave interactions booij et al 1999 ris et al 1999 the quality of the dynamical simulation however has been found to depend on a number of factors e g the quality and spatial and temporal resolution of wind forcing cavaleri and bertotti 2004 feng et al 2006 akpinar and ponce de león 2016 he et al 2018 janssen and bidlot 2018 the wave model s grid spatial resolution and representation of coastal features rogers et al 2007 ponce de león et al 2012 the source term input packages and numerical schemes amarouche et al 2019 christakos et al 2021 the performance of swan depends strongly on the wind forcing and may magnify the wind errors teixeira et al 1995 cavaleri and bertotti 2006 alves et al 2014 various studies have been devoted to analyze the sensitivity of wave predictions to different wind fields in regional applications e g feng et al 2006 moeini et al 2010 akpinar and ponce de león 2016 wu et al 2020 the performance of a particular wind reanalysis however behaves differently in various regions van vledder and akpınar 2015 kutupoğlu et al 2018 beyramzade et al 2019 a study in lake michigan showed that a wind performing poor in the middle lake reproduced the shallow water waves more accurately mao et al 2016 indicating that there may be even no optimizable wind for the whole model domain in a specific application a finer spatial and temporal resolution wind generally improves the model prediction especially for coastal regions with complex coastlines and terrain and large difference has been seen in the coastal zone because of the improved representation of coastline and in turn the atmospheric boundary layer cavaleri and bertotti 2004 sirisha et al 2019 christakos et al 2020 in contrast several studies found that little improvement was observed when the atmospheric forcing moving from 4 km to 1 km rusu et al 2009 bricheno et al 2013 nevertheless the result is not convincing because of the lack of high resolution observations to evaluate the model the evaluation of the model performance has been found to rely on the observational data used and may sometimes misleading akpinar and ponce de león 2016 showed that the cfsr climate forecast system reanalysis performed better in the black sea when validated against satellite observation but era reanalysis gave best skills when compared with in situ buoys this may either due to the uncertainty of altimeter observations especially when approaching land dumont et al 2017 or due to the relatively sparse coverage of buoys given a certain wind forcing recalibration of the parameterizations of the physical processes will further improve the model performance many studies have been dedicated to optimize the model parameters and numerical schemes e g jarosz et al 2007 zijlema et al 2012 stopa et al 2016 multi parameters sensitivity analysis has also been applied to find the key model parameters e g huang et al 2013 amarouche et al 2019 xu et al 2020 unfortunately there seems to be no unanimously optimal physics setting when comparing with multiple observations xu et al 2020 suggesting that the model parameters and numerical schemes may be related to water depth and wind conditions nevertheless the source term parameterizations are considered to be the most important factor in terms of significant wave height h s hereafter ardhuin and roland 2013 roland and ardhuin 2014 the source terms are empirical approximations of the processes that contribute to wind wave growth decay and spectral evolution several different approaches have been developed and implemented to swan swan team 2020 their performances indeed are regionally dependent mao et al 2016 amarouche et al 2019 xu et al 2020 various studies have identified the advantages of unstructured meshes e g hsu et al 2005 zijlema 2010 zijlema 2010 presented an unstructured grid algorithm for swan in detail and found that the unstructured meshes stood out in an efficient and stable manner a well designed unstructured mesh had the same accuracy as regular nested mesh but was more efficient therefore reducing the computational time pallares et al 2017 mao et al 2016 investigated the model sensitivity to the two different meshes in lake michigan and found that the mesh types affected the model performance substantially while both of the regular and the unstructured meshes captured the wave processes accurately in deep regions the unstructured mesh outperformed the regular one in nearshore regions significantly there are hundreds of islands near the cre and the coastlines are extremely complicated an ultra high resolution of unstructured triangular mesh is thus an appropriate option to improve the simulation accuracy several studies have been devoted to understand the wave dynamics in the east china sea ecs or focus on regions adjacent to the cre a study in the ecs found that the era interim reanalysis outperformed ncep national centers for environmental prediction reanalysis winds on extreme wave statistics due to the relatively higher resolution but both showed poor performance in shallow waters li et al 2016 several studies adopted idealized typhoon winds to predict the extreme waves but generally showed poor performance in revealing the spatial wave structure zhang and nie 2016 xu et al 2008 the wave model performance can be improved by incorporating the idealized typhoon wind to the observational or numerical wind field and by carefully adjusting the shape parameters in the theoretical typhoon model shen et al 2019 wang et al 2020 coupling of the circulation model with the wave model shows that the water level may also affect the wave heights yang et al 2020b although a certain level of success has been repetitively claimed we still often miss the h s peak values especially for typhoons whose solution depends on higher quality of wind fields and on further improvement of the source functions cavaleri 2009 cavaleri et al 2020 a recent study by wu et al 2020 showed that era5 performed better in the coastal nearshore region but ccmpv2 cross calibrated multi platform version 2 performed better in the central shelf region however most of this study focuses on the continental shelves given the relatively poor resolution 0 1 the bad representation of topography etopo1 the rectangular grid adopted and the lack of accurate and comparable observations poor performance is presented in shallow waters wu et al 2020 besides the wind input source functions are shown to be regionally dependent wang et al 2019 xu et al 2020 their performance has not been extensively evaluated in complex coastal areas such as regions adjacent to the cre where the presence of islands and shallow water areas makes the wave prediction more complicated moreover a high resolution wind product li et al 2020a b zhang et al 2020 is recently available and its performance over the cre needs further investigation the objective of the present work is to implement a high resolution wave model for the cre and assess the ability of the model in reproducing the waves in regions adjacent to the cre an unstructured model grid will be developed to resolve the complex geometry multiple wind fields will be adopted to test their performance over the cre region we will also quantify the model performance by using a recently available high resolution wind product of 9 km from a regional atmosphere ocean coupled system li et al 2020a b zhang et al 2020 different source term packages in swan will be used to simulate the wave dynamics over the cre model results are compared with altimeter observations and in situ buoy measurements the long term goal is to develop an operational wave forecasting system for the cre region the rest of the paper is organized as follows section 2 describes the model configuration and the multiple winds and wave data used section 3 presents the assessment of model performance corresponding to different wind fields and model physics discussion is given in section 4 and conclusions in section 5 2 methodology 2 1 the swan model the wave model used is swan swan is a third generation shallow water spectral wave model that includes wave propagation refraction due to currents and depth generation by wind dissipation white capping bottom friction depth induced breaking and nonlinear wave wave interactions booij et al 1999 zijlema 2010 swan team 2020 swan solves the evolution of the action density equation as follows n t c x n x c y n y c σ n σ c θ n θ s t o t σ where n is the wave action spectral density which is equal to the energy density divided by the relative frequency c x c y are x y components of the group velocity in geographic space and c σ c θ are the group velocity in spectral space σ θ with σ θ denoting the intrinsic frequency and the wave direction respectively the term on the right side s t o t is the source term and is expressed as follows s t o t s i n s n l 3 s n l 4 s d s w s d s b s d s b r these six terms representing wave energy sources and sinks are wave growth by wind nonlinear wave energy transfer through triad wave wave interactions and quadruplet wave wave interactions wave decay due to white capping bottom friction and depth induced wave breaking respectively details of these processes can be found in the swan scientific and technical documentation swan team 2020 the swan version 41 31 integrated in adcirc has been used for facilitation of parallel computing dietrich et al 2011 day and dietrich 2022 the wind input term has been demonstrated to be essential in setting up the wave energy and many formulations have been proposed however the performance of different packages varies across different regions huang et al 2013 akpinar and ponce de león 2016 kutupoğlu et al 2018 amarouche et al 2019 wang et al 2019 the komen and janssen wind input and white capping formulations are the two most commonly used komen et al 1984 janssen 1989 1991 both komen and janssen consist of a linear growth term and an exponential part in komen package the linear grow term is calculated according to cavaleri and malanotte rizzoli 1981 and the exponential part is a function of wind friction velocity and wave phase speed komen et al 1984 the janssen option uses the same linear growth term as komen but adopts an alternative formulation for the exponential part in which the two way interaction of wind and wave is considered janssen 1989 1991 another commonly used wind input and white capping option wst is presented by van der westhuysen et al 2007 wst is a refit to the empirical equation of wind input expression based on yan 1987 in which a nonlinear saturated base white capping equation was employed for the dissipation term wst is proposed to correct the overprediction of energy at the high frequency tail of the wave spectrum in komen and janssen van der westhuysen et al 2007 we will compare the performance of the three wind input options and identify the optimal package for the cre the performance of a most recent source package st6 will be discussed in section 4 3 rogers et al 2012 for other options the jonswap bottom friction is used with cfjon setting to 0 038 hasselmann et al 1973 the triad wave wave interactions are estimated by lumped triad approximation lta using the lower threshold for ursell number as 0 01 eldeberky 1996 the nonlinear quadruplet wave interactions are estimated by explicit discrete interaction approximation dia with lambda and cnl4 setting to 0 25 and 3 1 0 7 respectively hasselmann et al 1985 the bore model of battjes and janssen 1978 is adopted to parameterize the depth induced wave breaking and the ratio of maximum individual wave height over depth equals 0 73 details of the model physics and the corresponding parameters are given in table 1 2 2 study area this study focuses on the cre and the adjacent shelf region the geography near the cre is complicated and keeps changing with time due to ongoing sea reclamation project and deep navigation channel regulation project hundreds of islands locate on the southern side of cre e g the zhoushan islands which can largely influence the wave characteristics during propagation through refraction diffraction shoaling dissipation and nonlinear effects a flexible unstructured mesh grid is designed for a model domain that includes the cre the china east sea the yellow sea the bohai sea and a part of continental shelf break opening up to the north pacific ocean fig 1 the whole east china sea and part of the open ocean are included because both summer typhoon waves coming from south southeast and winter cold air waves from north are significant in setting up the disastrous waves over the cre region li et al 2016 comparative runs confirm that the present model domain could account for most of the swells from distant typhoons see section 4 1 for details high resolution is placed in the inner shelf region to resolve the highly irregular coasts and island shorelines with the highest in the cre and the surrounding islands the resolution is of about 100 m in the estuary but increases gradually to 75 km at the open ocean the total mesh has 321610 elements and 170390 nodes the latest digital bathymetric survey data is used in the cre and the inner shelf region with the highest resolution of about 20 m provided by shanghai municipal oceanic bureau for the middle and outer shelf data from electronic navigation chart are used with a resolution of about 1 km the bathymetry used for the open ocean is obtained from gebco general bathymetric chart of the oceans with a grid resolution of 30 arc seconds all the bathymetry data have been adjusted to the local mean sea level and interpolated to swan mesh cells fig 2 shows the combined bathymetry for the model domain and the cre region as shown in fig 2b the cre has complex geography and bathymetry the dams of the deep channel lie at the cre multiple small scale deep channels present in the bathymetry and a deep submarine canyon locates further offshore wave transformation during propagation is mostly dominated by the bathymetry in the intermediate and shallow water huang et al 2013 xu et al 2020 the irregular and steep bathymetry is likely to increase wave transformations and thus affect the wave simulation in the cre region 2 3 wind forcings accuracy of wind forcing is essential in the simulation and prediction of waves five different wind products are adopted in this study to evaluate their performance over the cre region including the reanalysis winds of era5 the modeled analysis winds of cfsv2 climate forecast system version 2 and aprcp asia pacific regional coupled prediction system the observational analysis winds of ccmp nrt cross calibrated multi platform near real time and the gfs global forecast system forecast winds table 2 era5 is a replacement of era interim since september 2019 and is the latest atmospheric reanalysis data produced by ecmwf the move from era interim to era5 represents a step change in overall quality and level of detail hersbach et al 2020 specially era5 has a higher horizontal resolution than era interim hourly analysis fields are available at horizontal resolution of 31 km on 137 vertical levels compared to 75 km and 60 levels for era interim the hourly 0 25 degree era5 winds during june to september 2019 are used in this study cfsv2 is a fully coupled global model representing interactions between earth atmosphere oceans land and sea ice developed by ncep and made operational since march 2011 the atmospheric component of cfsv2 has a spectral triangular truncation of 126 waves t126 0 937 in the horizontal and a finite difference in the vertical with 64 sigma pressure hybrid layers saha et al 2014 in the present study the selected hourly cfsv2 operational analysis combining the four daily initializations and one through five hour forecasts are used which are downloaded from http rda ucar edu datasets ds094 1 aprcp is a regional atmosphere ocean coupled forecasting system developed by ocean university of china which covers the indian ocean the south china sea and western pacific 16 s 63 n 38 e 178 e li et al 2020a b zhang et al 2020 the atmospheric component used in aprcp is the weather research and forecasting model wrf and the oceanic component is the regional ocean modeling system roms two version aprcp with different resolutions have been conducted and run quasi operationally at the pilot national laboratory for marine science and technology qingdao china the coarse version consists of a low resolution wrf 27 km and roms 9 km while the higher version increases to 9 km and 3 km respectively li et al 2020a both of them run once a day and produce the nowcast analysis and 18 day forecasts advantage of the regional coupled ocean atmospheric models has been discussed by zhang et al 2018 2020 we expect the high resolution aprcp product to resolve the fine scale wind structure in this region ccmp is a level 3 ocean vector wind analysis produced by remote sensing systems rss wentz 2015 ccmp nrt a real time version of ccmp combines version 7 rss radiometer wind speeds quikscat and ascat scatterometer wind vectors moored buoy wind data and background wind fields from the operational 0 25 degree ncep analysis winds to produce a gap free gridded wind estimation at a spatial resolution of 0 25 degree every 6 h ccmp nrt is routinely processed within 48 h which provides a modest improvement over the background ncep wind in regions where satellite observations are available although the agreement with buoy measurements is slightly poorer than ccmpv2 mears et al 2019 ccmp nrt covers a longer period than ccmpv2 from 2015 to present and is available at http www remss com measurements ccmp gfs is a weather forecast model maintained by ncep the dynamic core of gfs is fv3 finite volume cubed sphere with a resolution of 13 km in horizontal and 64 layers in vertical han et al 2017 the assimilation system used in gfs is gdas global data assimilation system which assimilates both satellite and conventional observations from global sources to optimize the forecasts gfs is running four times a day to produce forecasts up to 16 days the 3 hourly gfs products with a resolution of 0 25 are used from https www nco ncep noaa gov pmb products gfs the first two times 00 03 of each forecast 00z 06z 12z 18z are used to conduct a quasi analysis wind 2 4 observation data a wind observations wind measurements from two nearshore stations around the cre are used to evaluate the general performance of different wind products the two stations used are baozhen and luchaogang and their locations are shown in fig 2b the hourly wind vectors are used in this study b altimeter observations the altimeter observed h s used to evaluate the model performance are from jason 3 gdr geophysical data record dataset which is a level 2 product conducted under a cooperation of four institutes cnes french space agency centre national d etudes spatiales nasa the united states national aeronautics and space administration eumetsat the european organization for the exploitation of meteorological satellites and noaa the national oceanic and atmospheric administration dumont et al 2017 the along track gdr has been fully calibrated using a precise orbit and the best environmental correction and is available per repeat cycle with a latency of 90 days both ku band and c band are used for the monitoring of h s however the ku band is considered to have higher accuracy as compared to c band dumont et al 2017 performance of satellite products in the open sea has been assessed in many previous studies and shows reasonable skills though the bias may become larger approaching the coast cavaleri and bertotti 2003 feng et al 2012 wiese et al 2018 in the present study the along track ku band h s is used to evaluate the swan model performance especially in the offshore region c in situ wave buoys h s from six in situ wave buoys is available for the inner shelf region during the study period provided by the shanghai municipal oceanic bureau and the national marine environmental forecasting center locations of the buoys are shown in fig 2b detail information of the buoys is given in table 3 water depths at the buoy stations increase from 10 m to 70 m in about 250 km indicating a rapid change of bathymetry approaching the cre 2 5 design of simulations simulation of waves depends on both winds and model configurations generally higher quality winds produce better simulations of waves however it is usually difficult to judge whether the winds are good or not as observations are insufficient or wind performance are regionally dependent e g akpinar and ponce de león 2016 beyramzade et al 2019 wu et al 2020 besides the selected physical options may systemically overestimate or underestimate the wave height which are apt to further distort the assessment of models amarouche et al 2019 xu et al 2020 for example based on ncep reanalysis wind and the holland typhoon model wang et al 2019 demonstrated that the komen scheme performed best in reproducing h s during typhoons in the yellow sea and the ecs while wu et al 2020 claimed that the komen option tended to increase the negative bias when the era5 and ccmpv2 winds were adopted a study in the red sea indicated that the janssen formulation together with the era5 winds was the most successful formulation of wind input and white capping terms in swan beyramzade et al 2019 a similar study in the west mediterranean basin however concluded that the janssen wind wave growth formulation tended to overestimate h s and the most plausible option was komen amarouche et al 2019 in the present study cross comparison of the five different wind products are conducted firstly to investigate the possible systematic difference then the five winds together with the four input source functions are conducted to examine the wind and model performance the overall performance of the input source options and skills of different wind products over the cre will thus be revealed we focus our study on the period of june 1 to september 30 2019 as most wave data are available and four typhoons passing through the east chinas seas during this period including danas 2019 07 16 14 00 2019 07 20 20 00 ltc hereafter lekima 2019 08 04 14 00 2019 08 12 20 00 lingling 2019 09 02 08 00 2019 09 08 02 00 tapah 2019 09 19 08 00 2019 09 23 05 00 which provide good opportunities to investigate the model performance during extreme events 3 results 3 1 skill metrics several metrics have been employed to evaluate the model skill including root mean square error rmse scatter index si bias mean absolute error mae and correlation coefficient cc these statistical metrics are defined as follows r m s e i 1 n x o i x m i 2 n s i r m s e x o b i a s i 1 n x m i x o i n m a e i 1 n x m i x o i n c c i 1 n x o i x o x m i x m i 1 n x o i x o 2 i 1 n x m i x m 2 where o and m represent the observations and model simulations respectively rmse represents the standard deviation of the difference between the simulated values and observed values and serves to aggregate the magnitudes of the errors for various times into a single measure of predictive power si represents the percentage of rmse with respect to the mean of observations and quantifies the percentage of expected error for the parameter bias indicates the overall degree of overprediction or underprediction mae measures the average magnitude of the errors in a set of forecasts without considering their direction cc quantifies the strength of the linear relationship between the simulations and the references in a correlation analysis 3 2 wind assessment the five wind products are compared with the nearshore stations firstly to investigate their general performance during june 1 to september 30 2019 fig 3 shows the comparison of observed wind vectors with era5 at luchaogang and baozhen respectively table 4 summarizes the skill metrics between the observations and the wind products the overall agreements between observations and wind analysis are fairly good both for wind magnitude and wind directions especially at luchaogang table 4 the skill of cc for era5 is 0 77 at luchaogang and 0 66 at baozhen the observed wind at baozhen is of about 1 24 m s lower than luchaogang during fair weather conditions however all wind products fail to catch this variation and overpredict the wind speed table 4 the systematic overestimation at baozhen is considered to be related to the low resolution and thus the poor representation of land sea boundaries given the good agreement between luchaogang and the wind products observations at luchaogang are taken to evaluate the wind performance at the first place the assessment here is to examine the possible systematic difference of the five wind products the wind statistics are summarized as taylor diagrams shown in fig 4 the taylor diagrams provide a concise statistical summary of correspondence degree between simulated and observed fields by plotting the cc and the centered pattern root mean square difference rmsd between the two patterns along with the ratio of standard deviations on a single diagram taylor 2001 the summer season wind speed is generally less than 10 m s except if typhoon affecting the cre region as shown in fig 4a all five wind products overestimate the wind speed at luchaogang the overestimation of cfsv2 and aprcp is more distinct than gfs ccmp nrt and era5 among the five products aprcp exhibits the largest rmsd and scatter and cfsv2 is the second place after aprcp ccmp nrt gfs and era5 have better skills than cfsv2 and aprcp and exhibit higher correlation lower rmsd and less positive bias note that both cfsv2 and aprcp are wind products from coupled atmosphere ocean models it is unclear whether the positive bias is caused by the coupling dynamics though comparisons with in situ observations do indicate the performance of different wind products somehow they fail to provide their spatial disparities the bias of different wind products is calculated and shown in fig 5 by taking era5 as a reference as shown in fig 5a the summer wind speed in the ecs is about 1 5 2 times larger than in the yellow sea and bohai sea a basin wide positive bias is shown in aprcp cfsv2 and gfs the bias is generally less than 0 5 m s but are as high as 1 0 m s in aprcp conversely the ccmp nrt wind exhibits negative bias over most of the shelves except for the kuroshio region fig 4b summarizes the pattern difference between era5 and the rest four wind products ccmp nrt generally agrees best with era5 which has a slightly higher correlation with era5 and has the same standard deviation as era5 gfs and cfsv2 show similar skills each with about the same rmsd cc and standard deviation but have variations larger than era5 aprcp produces much larger variations than era5 resulting in the largest rmsd and the lowest pattern correlation further decomposing the winds to fair weather conditions and extreme weather conditions shows that the aprcp cfsv2 and gfs outweigh the era5 in both situations particularly in extreme weather conditions not shown the ccmp nrt though weaker than era5 during fair weather conditions outweighs the era5 wind during typhoon events in terms of the magnitude the wind products during fair weather conditions can be ranked as follows aprcp cfsv2 gfs era5 and ccmp nrt while during extreme events all other wind products outweigh the era5 among the five wind products aprcp is the only data produced by regional atmosphere ocean coupled models with the highest resolution 9 km we expect that the high resolution aprcp would advance the wind and wave prediction with improved coupling dynamics however large scatter and bias are revealed when compared to observations and other wind products its effects on the performance of wave simulation will be discussed in section 3 3 3 3 wave assessment both wind forcings and input source functions affect evaluation of the model performance to discern the effects of winds and wind input formulations in swan fifteen runs that is five different wind products in combination with three different swan wind input formulations i e janssen komen and wst have been conducted to assess the model performance in the cre region the model simulations are compared with along track altimeter observations and in situ buoy data a systematic difference between input source functions in swan the performance of the three commonly used input source strategies is assessed by comparing the simulated h s with altimeter observed h s fig 6 shows the scatter density plots between the simulated h s with different input source strategies and altimeter observations taken the era5 wind as an example the linear regression coefficients for janssen komen and wst are 0 84 0 82 and 0 72 respectively fig 6 when the cfsv2 is adopted the linear regression coefficients for janssen komen and wst change to 1 00 0 99 and 0 89 in general the h s using the janssen formulation is slightly higher than komen and much higher than wst formulation the wst formulation produces the lowest wave height for all wind products systematically lower than altimeter observations in all wind cases it has been reported that the wind input energy is similar in janssen and komen in previous studies however the janssen formulation has been demonstrated to perform better in reproducing the wave period siadatmousavi et al 2011 beyramzade et al 2019 besides the default komen formulation may pump disproportionate amount of energy to high energy part of the wave spectrum due to insufficient dissipation rogers et al 2003 though tuning the white capping formulation in komen may account for the weak dissipation at lower frequencies inappropriate representation of the rate of white capping dissipation may generate unreal wave height beyond the theoretical limits proposed by pierson and moskowitz 1964 and swan team 2020 given this the janssen wind input formulation may be a more proper option in our application here the altimeter observations mainly represent waves in the middle and outer shelves the input source function is essential in setting up the rate of wave growth but maybe less important in shallow waters where depth induced breaking dominates to test this the depth dependence of h s using the three input source functions forced by era5 are shown in fig 7 as shown in fig 7 the mean h s is of about 1 2 m over the outer shelf 100 m and decreases rapidly when propagating onshore the discrepancies between janssen and komen are relatively small but large discrepancies exist between wst and janssen komen as expected the discrepancies decrease with depth the difference between janssen and komen decreases from 3 2 cm at the outer shelf to less than 1 5 cm in the inner shelf 30 m the difference between wst and komen reaches 15 cm at the outer shelf and remains as high as 10 cm when approaching the inner shelf indicating a severe underestimation over the continental shelves underestimation of h s by wst formulation has been reported in several previous studies mao et al 2016 kutupoğlu et al 2018 the wst formulation employed a nonlinear saturated base white capping equation for the dissipation term and was designed to improve the underestimation of wave period in janssen and komen package van der westhuysen et al 2007 unfortunately no measured data is available to test the performance of wst in reproducing the wave period given the input source options and parameters used in this section there are systematic difference between the three wind energy input formulations the janssen option produces the highest h s compared to others and the wst underestimates the h s in all cases further calibrations may improve the model performance and will be discussed in section 4 3 however we will show that the model performance is more sensitive to the wind diversity than the input source functions and corresponding parameters the janssen wind input formulation is thus recommended and adopted in the following analysis b model sensitivity to different wind fields in addition to the input source functions fig 6 also presents the wave statistics from different wind products as shown in fig 6 the deviation from different wind forcings is more distinct than the difference due to input source formulations and the variation of skill metrics is 2 4 times larger than the uncertainty resulting from input source terms taken the janssen wave formulation as an example all wind products have the tendency to underestimate h s during fair weather condition the predicted h s is of about 22 cm 25 cm 8 cm 10 cm and 13 cm lower than the altimeter observations for era5 ccmp nrt cfsv2 gfs and aprcp respectively when the observed wave height is lower than 4 m however the bias is of about 51 cm 2 cm 83 cm 54 cm and 18 cm when the observed h s is greater than 4 m during extreme weather conditions it indicates that while cfsv2 and gfs underestimate the altimeter observed h s during fair weather conditions they overestimate it during extreme wave events the era5 and ccmp nrt on the other hand underestimate the altimeter observed h s on both fair and extreme weather conditions the piecewise variation is clearly shown by the quantile quantile q q plots superimposed in fig 6 the gfs cfsv2 generally agrees best with altimeter during fair weather conditions but overestimates h s larger than 4 m during extreme events counterintuitively the higher wind intensity in aprcp only yields slight positive bias we note that the both the aprcp wind and the resulting h s have the largest scatter index table 3 and fig 6 indicating that there is spatial and or phase mismatch between the aprcp wind and others this can further be seen from fig 9 when superimposing the altimeter observation on the model simulations the track mismatch and the relatively poor coverage of altimeter observations together distort the skill statistics the underestimation of h s compared to altimeter observations has been reported elsewhere for example in the red sea beyramzade et al 2019 the black sea van vledder and akpınar 2015 and the east china seas wu et al 2020 however the altimeter observed h s may have been overestimated particularly for low wave conditions wiese et al 2018 park et al 2013 yang et al 2020a based on more than 150 in situ buoys observations in the northern atlantic wiese et al 2018 concluded that the satellite altimeter overestimated the h s by about 7 to 26 cm a similar study covering the pacific ocean also revealed that the altimeters including sentinel 3a 3b and jason 3 overestimated the in situ observed h s by about 5 cm when h s was less than 4 m and the accuracy further decreased when the h s exceeding 4 m yang et al 2020a given the possible errors in altimeter observations the statistics presented in fig 6 mainly represents the difference rather than the errors and are referred to representation errors sometimes which are distinct form the measurement errors and the model errors janjić et al 2017 both the mismatch between the scales represented in observations and models and the error due to observation operators contribute to such basic difference oke and sakov 2008 janjić et al 2017 nevertheless fig 6 reveals the general performance and the difference of diverse wind products over the ecs their performance over the cre will be further identified by in situ wave buoys in next sub section the potential geographical dependence of the winds is further investigated fig 8 shows the distribution of model altimeter bias with respect to the water depth and observed h s as shown in fig 8a the model altimeter bias ranges between 5cm to 30cm and is negative through the continental shelves indicating that all wind products tend to underestimate the overall h s the cfsv2 and gfs show relatively lower negative bias compared to ccmp nrt and era5 a critical wave height of about 4 m has also been found as shown in fig 8b all five wind products underestimate h s at low h s less than 4 m but the negative bias turns smaller or positive when h s increases to higher than 4 m this may either due to the shift of the accuracy of altimeters or the performance of wind products during different weather conditions in addition fig 8b further reveals that cfsv2 produces the highest h s and the era5 winds predict the lowest h s during summer season of 2019 as compared to others the wind performance during extreme weather events is further examined during typhoon lekima fig 9 shows the distribution of h s on august 9 2019 at 10 00 ltc when typhoon lekima affected ecs the core area with extremely high wave height is much larger in cfsv2 and gfs as compared to others in contrast the era5 produces much lower h s than others the along track satellite observed h s is also superimposed in fig 9 the predicted h s by cfsv2 gfs is comparable with altimeters but is substantially underestimated by era5 fig 9a the ccmp nrt though weaker than era5 during fair weather conditions is stronger than it during extreme events and produce relatively larger waves fig 9b in addition to the amplitude substantial difference is presented in the spatial structure a large central calm area is presented in cfsv2 and era5 in agreement with the along track observed high low distributions but not in gfs and others the aprcp though with highest resolution exhibits a significant track shift as compared to observations and other wind forcings the spatial mismatch generates a relatively higher discrepancy between simulations and observations and thus the higher scatter index as already shown in fig 6 c model performance over the cre region the altimeter data may be contaminated in the vicinity of coastlines cavaleri et al 2019 observations from in situ wave buoys are used to assess the model performance adjacent to the cre there are six buoys available around the cre during june 1 to september 30 2019 and their locations are given in fig 2b with the corresponding water depth increasing from 9 25 m at hu01 to 69 81 m at mf06001 table 2 fig 10 shows the time series of the observed h s four extreme wind waves are recorded by hu02 mf04001 mf05001 mf05003 and mf06001 during typhoon danas lekima lingling and tapah respectively however in the nearshore site hu01 high h s is only observed during typhoon lekima with a maximum of 2 61 m about half of h s at hu02 120 km further offshore fig 10 also shows the comparison of buoy observed h s with the model predictions using janssen wind input formulation forced by cfsv2 and era5 winds respectively as shown in fig 10 the model predictions follow the observations closely the tidal frequency wave fluctuations are observed at hu01 but no such signals are presented in simulations the wave fluctuations at hu01 could reach of about 60 cm which may distort the skill analysis at hu01 high frequency fluctuations on the other five sites are relatively small the model performance during extreme weather conditions is further shown in fig 11 by taking typhoon tapah as an example the h s decreases as the water depth becomes shallower towards the shore highest h s of about 8 0 m is observed at mf06001 during tapah mf05001 and hu02 have similar h s and are of about 1 0 1 5 m lower than mf06001 the h s further decreases by about 1 0 m at mf05003 and mf4001 and lowest h s of about 1 0 m is observed at hu01 among the different winds cfsv2 gfs and aprcp predict the highest h s during typhoon events and tend to overestimate the highest wave height the era5 on the other hand underestimates the observed highest h s by about 1 2 m during typhoon tapah the skill metrics of the model are summarized in a taylor diagram shown in fig 12 the five different symbols denote the different wind forcings and the different colors represent the six buoys all wind forcings perform better in the exposed sites hu02 mf04001 mf05001 mf05003 and mf06001 than the inner site hu01 which has the lowest correlation and largest rmsd the cc is decreasing from exposed to inner locations in terms of winds the aprcp has lowest correlation and largest rmsd although cfsv2 gfs ccmp nrt and era5 have about the same correlation with observations ccmp nrt and era5 simulate the amplitude of the variations i e the standard deviation lower than cfsv2 and gfs resulting in a smaller rmsd ccmp nrt and era5 generally agree best with observations each with about the same rmsd the ccmp nrt however has the same standard deviation as the observed whereas era5 has too little variability we have also calculated the model skills against buoys during different weather conditions not shown the ccmp nrt and era5 underestimate the h s during both fair and extreme weather conditions cfsv2 and gfs have better skills over fair weather conditions but have the tendency to overestimate the higher h s 4 discussion 4 1 impact of boundary truncation we have shown in section 3 that the wave model underestimates the altimeter observed h s during fair weather conditions part of the underestimation may attribute to the representation error of the altimeter observations and the quality of winds and boundary conditions may also play roles the ecs is dominated by southeast monsoon in summer with the waves mainly propagating onshore from the open ocean to the continental shelves the model domains should be sufficiently large to account for the large scale wave signals to discern the effects of wave energy input from model boundaries a comparative run with larger model domain is conducted with an outward expansion of about 300 km fig 1 the difference of h s between the two comparative runs forced by era5 is shown in fig 13 as shown in fig 13 the difference of h s is negligible over the cre comparison with the in situ buoys confirms that the contribution is much less than the uncertainty due to winds thus we conclude that the small mesh grid is capable of predicting the h s in regions adjacent to the cre fig 13 also presents the wave estimation provided by ecmwf from the global era5 wam model ifs 2020 era5 wam is produced by the wam wave model and is part of the ecmwf ifs the difference between the era5 wam and era5 swan appears to reflect the effects of boundary truncation and varied numerical schemes the hourly era5 wam reanalysis of h s with a spatial resolution of 0 5 has been superimposed in fig 13 its comparison with the observation is generally poorer than swan especially at the inner buoy hu02 fig 13a era5 wam underestimates the h s at the inner buoy hu02 especially during typhoon events similar results have also been found at other inner buoys mf04001 mf05003 and mf05001 given the relatively lower horizontal resolution of era5 wam the results over the inner shelf are questionable and the poor performance is expected the era5 wam shows better performance at the outer buoy mf06001 than the inner buoys fig 13b and the peak h s agrees well with observations and is larger than era5 swan the relatively higher peak of era5 wam than swan may attribute to the assimilation of altimeter observed h s since similar overestimation has been found in satellite observations wiese et al 2018 park et al 2013 yang et al 2020a moreover though era5 winds have relatively weak intensity the wind speed which is actually seen by era5 wam model is different than the 10 m wind seen by the swan model as the radar altimeter data assimilation scheme is such that it produces increments for wave heights but also for wind speeds ifs 2020 it should be noted that the peak waves of era5 wam at the outer shelf though slightly higher than era5 swan are still generally lower than observations fig 9f besides we also find that era5 wam overestimates the h s during low wave conditions h s 2 m at buoy mf06001 for example during september 9 16 and 24 30 fig 13b similar results have been found in previous studies shi et al 2021 have evaluated the performance of era5 wam in china s coastal waters and found that era5 wam overestimated the h s based on annual average but underestimated the h s substantially during extreme wave events which is consistent with our results here 4 2 importance of high resolution winds the quality of wind forcing is essential in the prediction of surface ocean waves especially in coastal waters with complex coastlines and islands and its importance has been emphasized elsewhere e g bricheno et al 2013 sirisha et al 2019 validations in this study show that the overall performance of the wave model based on different wind forcing is good but obviously depends on the quality of the forcing wind fields the newly available aprcp has the highest resolution as compared to other wind products and does show some finer structure when compared to others and a 27 km version of aprcp li et al 2020b figure 14 given the lack of direct in situ observations to verify the high resolution winds especially during extreme typhoon events the wave analysis provides circumstantial evidence to evaluate the atmospheric models however the swan model skill adopting aprcp is generally poorer than other wind forcings indicating that further efforts are needed to improve the aprcp model performance we find that though the high resolution aprcp produces finer wind structure the storm track in aprcp deviates from observed track by about 1 2 degrees worst among the five wind products fig 9 and fig 14 nevertheless spatial variability of wind forcing is a key factor for the small scale features which coarse resolution models are not able to resolve christakos et al 2020 a higher resolution wind of 3 km has also been conducted for typhoon lekima during august 5 25 2019 fig 14 presents the comparison of winds from aprcp with different resolutions substantial difference is present in winds with different resolutions both in terms of magnitude and structure the higher resolution winds are not necessarily better than the coarse one as indicated by the track bias fig 14 skill analysis against the wave buoys over the cre confirms that the model skills turn better at hu01 mf04001 and mf05003 but turn worse at others fig 15 a notable improvement is that the 3 km aprcp reproduces the tidal frequency fluctuations at hu01 better than the 9 km aprcp a recent study adopting a wave surge tide coupled model over the cre revealed that the tidal frequency wave fluctuations over the cre could not be completely reproduced by the coupled model and inferred that the high resolution winds also played a role chi and rong 2021 our analysis here further confirms the importance of high resolution winds in nearshore wave simulations 4 3 potential improvement from recalibration and st6 we have shown that the performance of swan appears more dependent on wind forcings than input energy source term packages identifying the quality of the wind fields is thus an essential first step for further calibration of model parameters though it is impractical to get optimal settings for all winds and applications recalibration has been frequently implemented given the janssen source function and the cfsv2 winds four additional runs have been conducted to discuss the improvement by calibrating the parameters in the white capping and the depth limited breaking terms which are considered to be the key parameters with highest sensitivity mao et al 2016 xu et al 2020 the parameter cds1 determining the rate of white capping dissipation and ratio gamma determining the maximum individual wave height over depth have been adjusted 20 to check the potential improvement table 1 xu et al 2020 the lower cds1 corresponding to a weaker dissipation leads to higher h s which does improve the model performance during fair weather conditions but further magnify the wind error during extreme wind events not shown increasing gamma in the wave breaking term has similar effects but only plays roles in the very nearshore region with depth less than 20 m the wave model deviations from different model parameters are much less than the cases with different input source functions which further confirm that the ways of source term parameterizations are the most important factor in terms of h s ardhuin and roland 2013 roland and ardhuin 2014 a new package of wave physics referent to as st6 physics has been implemented in swan by rogers et al 2012 several new terms based on observational studies have been introduced in st6 including the new parametrizations of wind input the observation consistent white capping the swell dissipation the wind speed scaling and other processes rogers et al 2012 several recent studies indicate that st6 might become the preferred physic package for swan aijaz et al 2016 aydoğan and ayat 2021 day and dietrich 2022 no comprehensive comparison and validation of st6 over the ecs and the cre have been conducted yet partly because that many parameterizations have been changed in st6 and thorough evaluations are needed liu et al 2017 2019 aydoğan and ayat 2021 here we present a preliminary comparison of the default st6 with janssen to give a ground for further studies detail analysis and calibration of st6 deserve future works fig 16 shows the comparison between altimeter observations and model simulations with janssen and st6 by using the cfsv2 winds the default st6 has comparative skills with janssen when h s is less than 4 m but tends to predict higher h s during extreme wave events further magnifying the potential error of cfsv2 during extreme weather conditions fig 6 and fig 8 however as we have shown the model performance depends on the quality of wind fields the parameters in the default st6 may have been adjusted to account for the missed wave peaks cavaleri 2009 cavaleri et al 2020 better performance may be achieved by alternative winds or by calibrated parameters aydoğan and ayat 2021 5 conclusion accurate modeling of wave conditions in complex coastal waters remains a challenging issue the model performance depends on multiple factors including the quality of wind forcing the wave model physics boundary conditions etc in this study a high resolution unstructured wave model swan has been implemented for the cre five wind products the era5 ccmp nrt cfsv2 gfs and aprcp have been used as forcing and their performance over the cre have been assessed in addition the choice of four different source term packages has been investigated the model performance has been evaluated by comparing with altimeter observations and in situ buoy measurements several potential sources of model errors have been discussed comparison with in situ observed winds shows that all wind products agree fairly well with observations cross comparison of different wind products shows that cfsv2 and gfs are stronger than era5 during both fair and extreme weather conditions ccmp nrt on the other hand is lightly lower than era5 over most the continental shelves during fair weather conditions but outweighs era5 during typhoon events among the five wind products the era5 presents the lowest wind intensity during typhoons the aprcp though having the highest spatial resolution behaves significantly different from land observations and era5 the model performance of the five wind products together with three commonly used input source term packages janssen komen and wst has been evaluated firstly there is systematic difference between the three wind input formulations the default janssen and komen show comparative capability in reproducing the h s while wst underestimates the h s substantially given the outperformance of janssen in white capping dissipation the janssen formulation is adopted and recommended for application over the cre though the janssen formulation produces the highest h s all wind products using with janssen nevertheless underestimate the observed h s during fair weather conditions when comparing with satellite observations the negative bias decreases when comparing with the in situ buoy measurements indicating that part of the negative bias may be attributed to the overestimation of satellite retrieval which has been demonstrated in several previous studies the performance of the wave model depends significantly on the quality of wind forcing the deviation due to different wind forcings is about 2 4 times larger than the uncertainty resulting from input energy source term packages the h s when cfsv2 and gfs are employed with janssen formulation exhibits best agreement with altimeter observations and in situ buoy data during fair weather conditions however the cfsv2 and gfs winds overestimate the h s during extreme weather events the era5 on the other hand underestimates the h s during both fair and extreme weather conditions the ccmp nrt though underestimates the h s during fair weather conditions has the best performance during extreme wave events default parameters of the source term packages have been used in this study given a certain wind forcing it is possible to achieve better performance by further calibration of model parameters however the deviations from different model parameters are much less than the source functions the choice of source functions appears to be the most important factor in terms of h s the default st6 has much the same skill as janssen during fair weather conditions but tends to produce higher h s during extreme weather events indicating that the default parameters of st6 may have been tuned to account for the missed wave peaks results from this work provide a good start to build a hindcast and forecast system for the cre region high resolution both spatial and temporal winds have been demonstrated to be essential in reproducing the finer scale feature of waves however the 9 km aprcp wind product from a regional atmosphere ocean coupled model exhibits relatively poorer performance than other wind forcings indicating that further work is needed to improve the coupling architecture in aprcp nevertheless the 9 km and refined 3 km products show some detail structure of typhoons their effects on the prediction of wave model need further investigations specially a case study during typhoon lekima emphasizes the importance of high resolution winds in reproducing the high frequency wave fluctuations adjacent to the cre which cannot be fully explained by tide wave fluctuations there are several works keeping improving the regional atmosphere ocean coupling framework li et al 2020a the wave hindcast and forecast is expected to benefit from the upgrading of aprcp credit authorship contribution statement yan jiang conceptualization methodology validation formal analysis writing original draft zengrui rong conceptualization supervision writing review editing project administration pixue li resources data curation investigation tao qin data curation investigation xiaolin yu resources data curation yutao chi software validation zhiyi gao resources investigation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work was supported by the national key research and development program of china 2016yfc1402000 and the major scientific and technological innovation project mstip of shandong 2021cxgc010705 
23847,a high resolution unstructured swan model has been implemented for the changjiang river estuary cre five different winds are adopted to assess their quality over the cre including era5 cfsv2 gfs ccmp nrt and a newly available high resolution 9 km wind product from aprcp asia pacific regional coupled prediction system the performance of the five winds together with four wind input source functions is evaluated by comparing with satellite altimeter observations and multiple in situ observations systemic difference is presented in the four input source functions with the janssen and komen packages outperformingwst in terms of significant wave height h s over the cre the default st6 has comparative skill as janssen during fair weather conditions but tends to predict higher h s during extreme weather events all winds have the tendency to underestimate the altimeter observed h s during fair weather conditions part of the negative bias attributes to the overestimation of altimeter observations while the boundary conditions only play a minor role given a relatively large model domain extending to about 135 e the cfsv2 gfs wind has the best performance during fair weather conditions but overestimates the extreme wave height during typhoon events the era5 on the other hand underestimates h s during both fair and extreme weather conditions in terms of extreme waves ccmp nrt generally agrees best with observations the high resolution aprcp behaves significantly different from other wind forcings and shows poorer performance in wave simulation but high resolution winds have the advantage in resolving the detail wind structure and show better performance in reproducing the high frequency wave fluctuations adjacent to the cre in addition the deviation due to different wind forcings is more distinct than the different input source functions nevertheless given a certain wind forcing calibrations would further improve the model performance this study provides a good start to build a hindcast and forecast system for the cre region keywords wave modeling wind forcing wave growth formulation swan changjiang river estuary 1 introduction good prediction of ocean wave generations and propagations is essential for the interpretation of coastal processes as well as everyday practices such as coastal planning aquaculture disaster risk reduction and engineering applications the changjiang river estuary cre is one of most economically active areas of china several big ports are on the coast or on islands with bridge connecting to the mainland the anchoring area is located right off the cre it experiences severe typhoon storms almost every year presenting coastal hazards such as high waves and surges guo et al 2009 feng et al 2012 yin et al 2018 extreme ocean waves continue to be a threat to all marine related activities and hence their accurate prediction is still a topic among wave forecasts moreover the geometry adjacent to the cre is complex due to islands sea reclamation and ongoing human projects making accurate monitoring and predicting of waves a challenging issue significant advances have been made in understanding the wave physical processes and numerical modeling of surface waves since the first wave model was established cavaleri et al 2020 operational wave hindcasting and forecasting systems have been implemented worldwide on both global and regional scales e g the era5 ocean wave data from the ecmwf european centre for medium range weather forecasts integrated forecast system ifs coupled with wam bidlot et al 2002 2019 bell et al 2021 the global forecast system wave with the wavewatch iii wave model chawla et al 2013 campos et al 2020 and chinese global operational oceanography forecasting system cgofs wang et al 2016b and many others martin et al 2007 tolman et al 2013 balakrishnan nair et al 2013 breivik et al 2015 tonani et al 2015 wang et al 2016a barbariol et al 2019 liu et al 2021 many hindcast and reanalysis datasets have shown good quality in offshore locations but generally have poor resolution and performance in nearshore regions mainly due to poor representation of local winds topography and coastlines e g cavaleri and bertotti 2003 lavidas et al 2017 pallares et al 2017 amarouche et al 2019 galanis et al 2019 wang et al 2019 christakos et al 2020 the quality of the wave forecasts in the coastal and semi enclosed seas is not as high as for the open sea cavaleri et al 2018 for the inner shelf nearshore region a third generation wave model simulating wave nearshore swan has been widely used to simulate the wave generation propagation dissipation diffraction and wave wave interactions booij et al 1999 ris et al 1999 the quality of the dynamical simulation however has been found to depend on a number of factors e g the quality and spatial and temporal resolution of wind forcing cavaleri and bertotti 2004 feng et al 2006 akpinar and ponce de león 2016 he et al 2018 janssen and bidlot 2018 the wave model s grid spatial resolution and representation of coastal features rogers et al 2007 ponce de león et al 2012 the source term input packages and numerical schemes amarouche et al 2019 christakos et al 2021 the performance of swan depends strongly on the wind forcing and may magnify the wind errors teixeira et al 1995 cavaleri and bertotti 2006 alves et al 2014 various studies have been devoted to analyze the sensitivity of wave predictions to different wind fields in regional applications e g feng et al 2006 moeini et al 2010 akpinar and ponce de león 2016 wu et al 2020 the performance of a particular wind reanalysis however behaves differently in various regions van vledder and akpınar 2015 kutupoğlu et al 2018 beyramzade et al 2019 a study in lake michigan showed that a wind performing poor in the middle lake reproduced the shallow water waves more accurately mao et al 2016 indicating that there may be even no optimizable wind for the whole model domain in a specific application a finer spatial and temporal resolution wind generally improves the model prediction especially for coastal regions with complex coastlines and terrain and large difference has been seen in the coastal zone because of the improved representation of coastline and in turn the atmospheric boundary layer cavaleri and bertotti 2004 sirisha et al 2019 christakos et al 2020 in contrast several studies found that little improvement was observed when the atmospheric forcing moving from 4 km to 1 km rusu et al 2009 bricheno et al 2013 nevertheless the result is not convincing because of the lack of high resolution observations to evaluate the model the evaluation of the model performance has been found to rely on the observational data used and may sometimes misleading akpinar and ponce de león 2016 showed that the cfsr climate forecast system reanalysis performed better in the black sea when validated against satellite observation but era reanalysis gave best skills when compared with in situ buoys this may either due to the uncertainty of altimeter observations especially when approaching land dumont et al 2017 or due to the relatively sparse coverage of buoys given a certain wind forcing recalibration of the parameterizations of the physical processes will further improve the model performance many studies have been dedicated to optimize the model parameters and numerical schemes e g jarosz et al 2007 zijlema et al 2012 stopa et al 2016 multi parameters sensitivity analysis has also been applied to find the key model parameters e g huang et al 2013 amarouche et al 2019 xu et al 2020 unfortunately there seems to be no unanimously optimal physics setting when comparing with multiple observations xu et al 2020 suggesting that the model parameters and numerical schemes may be related to water depth and wind conditions nevertheless the source term parameterizations are considered to be the most important factor in terms of significant wave height h s hereafter ardhuin and roland 2013 roland and ardhuin 2014 the source terms are empirical approximations of the processes that contribute to wind wave growth decay and spectral evolution several different approaches have been developed and implemented to swan swan team 2020 their performances indeed are regionally dependent mao et al 2016 amarouche et al 2019 xu et al 2020 various studies have identified the advantages of unstructured meshes e g hsu et al 2005 zijlema 2010 zijlema 2010 presented an unstructured grid algorithm for swan in detail and found that the unstructured meshes stood out in an efficient and stable manner a well designed unstructured mesh had the same accuracy as regular nested mesh but was more efficient therefore reducing the computational time pallares et al 2017 mao et al 2016 investigated the model sensitivity to the two different meshes in lake michigan and found that the mesh types affected the model performance substantially while both of the regular and the unstructured meshes captured the wave processes accurately in deep regions the unstructured mesh outperformed the regular one in nearshore regions significantly there are hundreds of islands near the cre and the coastlines are extremely complicated an ultra high resolution of unstructured triangular mesh is thus an appropriate option to improve the simulation accuracy several studies have been devoted to understand the wave dynamics in the east china sea ecs or focus on regions adjacent to the cre a study in the ecs found that the era interim reanalysis outperformed ncep national centers for environmental prediction reanalysis winds on extreme wave statistics due to the relatively higher resolution but both showed poor performance in shallow waters li et al 2016 several studies adopted idealized typhoon winds to predict the extreme waves but generally showed poor performance in revealing the spatial wave structure zhang and nie 2016 xu et al 2008 the wave model performance can be improved by incorporating the idealized typhoon wind to the observational or numerical wind field and by carefully adjusting the shape parameters in the theoretical typhoon model shen et al 2019 wang et al 2020 coupling of the circulation model with the wave model shows that the water level may also affect the wave heights yang et al 2020b although a certain level of success has been repetitively claimed we still often miss the h s peak values especially for typhoons whose solution depends on higher quality of wind fields and on further improvement of the source functions cavaleri 2009 cavaleri et al 2020 a recent study by wu et al 2020 showed that era5 performed better in the coastal nearshore region but ccmpv2 cross calibrated multi platform version 2 performed better in the central shelf region however most of this study focuses on the continental shelves given the relatively poor resolution 0 1 the bad representation of topography etopo1 the rectangular grid adopted and the lack of accurate and comparable observations poor performance is presented in shallow waters wu et al 2020 besides the wind input source functions are shown to be regionally dependent wang et al 2019 xu et al 2020 their performance has not been extensively evaluated in complex coastal areas such as regions adjacent to the cre where the presence of islands and shallow water areas makes the wave prediction more complicated moreover a high resolution wind product li et al 2020a b zhang et al 2020 is recently available and its performance over the cre needs further investigation the objective of the present work is to implement a high resolution wave model for the cre and assess the ability of the model in reproducing the waves in regions adjacent to the cre an unstructured model grid will be developed to resolve the complex geometry multiple wind fields will be adopted to test their performance over the cre region we will also quantify the model performance by using a recently available high resolution wind product of 9 km from a regional atmosphere ocean coupled system li et al 2020a b zhang et al 2020 different source term packages in swan will be used to simulate the wave dynamics over the cre model results are compared with altimeter observations and in situ buoy measurements the long term goal is to develop an operational wave forecasting system for the cre region the rest of the paper is organized as follows section 2 describes the model configuration and the multiple winds and wave data used section 3 presents the assessment of model performance corresponding to different wind fields and model physics discussion is given in section 4 and conclusions in section 5 2 methodology 2 1 the swan model the wave model used is swan swan is a third generation shallow water spectral wave model that includes wave propagation refraction due to currents and depth generation by wind dissipation white capping bottom friction depth induced breaking and nonlinear wave wave interactions booij et al 1999 zijlema 2010 swan team 2020 swan solves the evolution of the action density equation as follows n t c x n x c y n y c σ n σ c θ n θ s t o t σ where n is the wave action spectral density which is equal to the energy density divided by the relative frequency c x c y are x y components of the group velocity in geographic space and c σ c θ are the group velocity in spectral space σ θ with σ θ denoting the intrinsic frequency and the wave direction respectively the term on the right side s t o t is the source term and is expressed as follows s t o t s i n s n l 3 s n l 4 s d s w s d s b s d s b r these six terms representing wave energy sources and sinks are wave growth by wind nonlinear wave energy transfer through triad wave wave interactions and quadruplet wave wave interactions wave decay due to white capping bottom friction and depth induced wave breaking respectively details of these processes can be found in the swan scientific and technical documentation swan team 2020 the swan version 41 31 integrated in adcirc has been used for facilitation of parallel computing dietrich et al 2011 day and dietrich 2022 the wind input term has been demonstrated to be essential in setting up the wave energy and many formulations have been proposed however the performance of different packages varies across different regions huang et al 2013 akpinar and ponce de león 2016 kutupoğlu et al 2018 amarouche et al 2019 wang et al 2019 the komen and janssen wind input and white capping formulations are the two most commonly used komen et al 1984 janssen 1989 1991 both komen and janssen consist of a linear growth term and an exponential part in komen package the linear grow term is calculated according to cavaleri and malanotte rizzoli 1981 and the exponential part is a function of wind friction velocity and wave phase speed komen et al 1984 the janssen option uses the same linear growth term as komen but adopts an alternative formulation for the exponential part in which the two way interaction of wind and wave is considered janssen 1989 1991 another commonly used wind input and white capping option wst is presented by van der westhuysen et al 2007 wst is a refit to the empirical equation of wind input expression based on yan 1987 in which a nonlinear saturated base white capping equation was employed for the dissipation term wst is proposed to correct the overprediction of energy at the high frequency tail of the wave spectrum in komen and janssen van der westhuysen et al 2007 we will compare the performance of the three wind input options and identify the optimal package for the cre the performance of a most recent source package st6 will be discussed in section 4 3 rogers et al 2012 for other options the jonswap bottom friction is used with cfjon setting to 0 038 hasselmann et al 1973 the triad wave wave interactions are estimated by lumped triad approximation lta using the lower threshold for ursell number as 0 01 eldeberky 1996 the nonlinear quadruplet wave interactions are estimated by explicit discrete interaction approximation dia with lambda and cnl4 setting to 0 25 and 3 1 0 7 respectively hasselmann et al 1985 the bore model of battjes and janssen 1978 is adopted to parameterize the depth induced wave breaking and the ratio of maximum individual wave height over depth equals 0 73 details of the model physics and the corresponding parameters are given in table 1 2 2 study area this study focuses on the cre and the adjacent shelf region the geography near the cre is complicated and keeps changing with time due to ongoing sea reclamation project and deep navigation channel regulation project hundreds of islands locate on the southern side of cre e g the zhoushan islands which can largely influence the wave characteristics during propagation through refraction diffraction shoaling dissipation and nonlinear effects a flexible unstructured mesh grid is designed for a model domain that includes the cre the china east sea the yellow sea the bohai sea and a part of continental shelf break opening up to the north pacific ocean fig 1 the whole east china sea and part of the open ocean are included because both summer typhoon waves coming from south southeast and winter cold air waves from north are significant in setting up the disastrous waves over the cre region li et al 2016 comparative runs confirm that the present model domain could account for most of the swells from distant typhoons see section 4 1 for details high resolution is placed in the inner shelf region to resolve the highly irregular coasts and island shorelines with the highest in the cre and the surrounding islands the resolution is of about 100 m in the estuary but increases gradually to 75 km at the open ocean the total mesh has 321610 elements and 170390 nodes the latest digital bathymetric survey data is used in the cre and the inner shelf region with the highest resolution of about 20 m provided by shanghai municipal oceanic bureau for the middle and outer shelf data from electronic navigation chart are used with a resolution of about 1 km the bathymetry used for the open ocean is obtained from gebco general bathymetric chart of the oceans with a grid resolution of 30 arc seconds all the bathymetry data have been adjusted to the local mean sea level and interpolated to swan mesh cells fig 2 shows the combined bathymetry for the model domain and the cre region as shown in fig 2b the cre has complex geography and bathymetry the dams of the deep channel lie at the cre multiple small scale deep channels present in the bathymetry and a deep submarine canyon locates further offshore wave transformation during propagation is mostly dominated by the bathymetry in the intermediate and shallow water huang et al 2013 xu et al 2020 the irregular and steep bathymetry is likely to increase wave transformations and thus affect the wave simulation in the cre region 2 3 wind forcings accuracy of wind forcing is essential in the simulation and prediction of waves five different wind products are adopted in this study to evaluate their performance over the cre region including the reanalysis winds of era5 the modeled analysis winds of cfsv2 climate forecast system version 2 and aprcp asia pacific regional coupled prediction system the observational analysis winds of ccmp nrt cross calibrated multi platform near real time and the gfs global forecast system forecast winds table 2 era5 is a replacement of era interim since september 2019 and is the latest atmospheric reanalysis data produced by ecmwf the move from era interim to era5 represents a step change in overall quality and level of detail hersbach et al 2020 specially era5 has a higher horizontal resolution than era interim hourly analysis fields are available at horizontal resolution of 31 km on 137 vertical levels compared to 75 km and 60 levels for era interim the hourly 0 25 degree era5 winds during june to september 2019 are used in this study cfsv2 is a fully coupled global model representing interactions between earth atmosphere oceans land and sea ice developed by ncep and made operational since march 2011 the atmospheric component of cfsv2 has a spectral triangular truncation of 126 waves t126 0 937 in the horizontal and a finite difference in the vertical with 64 sigma pressure hybrid layers saha et al 2014 in the present study the selected hourly cfsv2 operational analysis combining the four daily initializations and one through five hour forecasts are used which are downloaded from http rda ucar edu datasets ds094 1 aprcp is a regional atmosphere ocean coupled forecasting system developed by ocean university of china which covers the indian ocean the south china sea and western pacific 16 s 63 n 38 e 178 e li et al 2020a b zhang et al 2020 the atmospheric component used in aprcp is the weather research and forecasting model wrf and the oceanic component is the regional ocean modeling system roms two version aprcp with different resolutions have been conducted and run quasi operationally at the pilot national laboratory for marine science and technology qingdao china the coarse version consists of a low resolution wrf 27 km and roms 9 km while the higher version increases to 9 km and 3 km respectively li et al 2020a both of them run once a day and produce the nowcast analysis and 18 day forecasts advantage of the regional coupled ocean atmospheric models has been discussed by zhang et al 2018 2020 we expect the high resolution aprcp product to resolve the fine scale wind structure in this region ccmp is a level 3 ocean vector wind analysis produced by remote sensing systems rss wentz 2015 ccmp nrt a real time version of ccmp combines version 7 rss radiometer wind speeds quikscat and ascat scatterometer wind vectors moored buoy wind data and background wind fields from the operational 0 25 degree ncep analysis winds to produce a gap free gridded wind estimation at a spatial resolution of 0 25 degree every 6 h ccmp nrt is routinely processed within 48 h which provides a modest improvement over the background ncep wind in regions where satellite observations are available although the agreement with buoy measurements is slightly poorer than ccmpv2 mears et al 2019 ccmp nrt covers a longer period than ccmpv2 from 2015 to present and is available at http www remss com measurements ccmp gfs is a weather forecast model maintained by ncep the dynamic core of gfs is fv3 finite volume cubed sphere with a resolution of 13 km in horizontal and 64 layers in vertical han et al 2017 the assimilation system used in gfs is gdas global data assimilation system which assimilates both satellite and conventional observations from global sources to optimize the forecasts gfs is running four times a day to produce forecasts up to 16 days the 3 hourly gfs products with a resolution of 0 25 are used from https www nco ncep noaa gov pmb products gfs the first two times 00 03 of each forecast 00z 06z 12z 18z are used to conduct a quasi analysis wind 2 4 observation data a wind observations wind measurements from two nearshore stations around the cre are used to evaluate the general performance of different wind products the two stations used are baozhen and luchaogang and their locations are shown in fig 2b the hourly wind vectors are used in this study b altimeter observations the altimeter observed h s used to evaluate the model performance are from jason 3 gdr geophysical data record dataset which is a level 2 product conducted under a cooperation of four institutes cnes french space agency centre national d etudes spatiales nasa the united states national aeronautics and space administration eumetsat the european organization for the exploitation of meteorological satellites and noaa the national oceanic and atmospheric administration dumont et al 2017 the along track gdr has been fully calibrated using a precise orbit and the best environmental correction and is available per repeat cycle with a latency of 90 days both ku band and c band are used for the monitoring of h s however the ku band is considered to have higher accuracy as compared to c band dumont et al 2017 performance of satellite products in the open sea has been assessed in many previous studies and shows reasonable skills though the bias may become larger approaching the coast cavaleri and bertotti 2003 feng et al 2012 wiese et al 2018 in the present study the along track ku band h s is used to evaluate the swan model performance especially in the offshore region c in situ wave buoys h s from six in situ wave buoys is available for the inner shelf region during the study period provided by the shanghai municipal oceanic bureau and the national marine environmental forecasting center locations of the buoys are shown in fig 2b detail information of the buoys is given in table 3 water depths at the buoy stations increase from 10 m to 70 m in about 250 km indicating a rapid change of bathymetry approaching the cre 2 5 design of simulations simulation of waves depends on both winds and model configurations generally higher quality winds produce better simulations of waves however it is usually difficult to judge whether the winds are good or not as observations are insufficient or wind performance are regionally dependent e g akpinar and ponce de león 2016 beyramzade et al 2019 wu et al 2020 besides the selected physical options may systemically overestimate or underestimate the wave height which are apt to further distort the assessment of models amarouche et al 2019 xu et al 2020 for example based on ncep reanalysis wind and the holland typhoon model wang et al 2019 demonstrated that the komen scheme performed best in reproducing h s during typhoons in the yellow sea and the ecs while wu et al 2020 claimed that the komen option tended to increase the negative bias when the era5 and ccmpv2 winds were adopted a study in the red sea indicated that the janssen formulation together with the era5 winds was the most successful formulation of wind input and white capping terms in swan beyramzade et al 2019 a similar study in the west mediterranean basin however concluded that the janssen wind wave growth formulation tended to overestimate h s and the most plausible option was komen amarouche et al 2019 in the present study cross comparison of the five different wind products are conducted firstly to investigate the possible systematic difference then the five winds together with the four input source functions are conducted to examine the wind and model performance the overall performance of the input source options and skills of different wind products over the cre will thus be revealed we focus our study on the period of june 1 to september 30 2019 as most wave data are available and four typhoons passing through the east chinas seas during this period including danas 2019 07 16 14 00 2019 07 20 20 00 ltc hereafter lekima 2019 08 04 14 00 2019 08 12 20 00 lingling 2019 09 02 08 00 2019 09 08 02 00 tapah 2019 09 19 08 00 2019 09 23 05 00 which provide good opportunities to investigate the model performance during extreme events 3 results 3 1 skill metrics several metrics have been employed to evaluate the model skill including root mean square error rmse scatter index si bias mean absolute error mae and correlation coefficient cc these statistical metrics are defined as follows r m s e i 1 n x o i x m i 2 n s i r m s e x o b i a s i 1 n x m i x o i n m a e i 1 n x m i x o i n c c i 1 n x o i x o x m i x m i 1 n x o i x o 2 i 1 n x m i x m 2 where o and m represent the observations and model simulations respectively rmse represents the standard deviation of the difference between the simulated values and observed values and serves to aggregate the magnitudes of the errors for various times into a single measure of predictive power si represents the percentage of rmse with respect to the mean of observations and quantifies the percentage of expected error for the parameter bias indicates the overall degree of overprediction or underprediction mae measures the average magnitude of the errors in a set of forecasts without considering their direction cc quantifies the strength of the linear relationship between the simulations and the references in a correlation analysis 3 2 wind assessment the five wind products are compared with the nearshore stations firstly to investigate their general performance during june 1 to september 30 2019 fig 3 shows the comparison of observed wind vectors with era5 at luchaogang and baozhen respectively table 4 summarizes the skill metrics between the observations and the wind products the overall agreements between observations and wind analysis are fairly good both for wind magnitude and wind directions especially at luchaogang table 4 the skill of cc for era5 is 0 77 at luchaogang and 0 66 at baozhen the observed wind at baozhen is of about 1 24 m s lower than luchaogang during fair weather conditions however all wind products fail to catch this variation and overpredict the wind speed table 4 the systematic overestimation at baozhen is considered to be related to the low resolution and thus the poor representation of land sea boundaries given the good agreement between luchaogang and the wind products observations at luchaogang are taken to evaluate the wind performance at the first place the assessment here is to examine the possible systematic difference of the five wind products the wind statistics are summarized as taylor diagrams shown in fig 4 the taylor diagrams provide a concise statistical summary of correspondence degree between simulated and observed fields by plotting the cc and the centered pattern root mean square difference rmsd between the two patterns along with the ratio of standard deviations on a single diagram taylor 2001 the summer season wind speed is generally less than 10 m s except if typhoon affecting the cre region as shown in fig 4a all five wind products overestimate the wind speed at luchaogang the overestimation of cfsv2 and aprcp is more distinct than gfs ccmp nrt and era5 among the five products aprcp exhibits the largest rmsd and scatter and cfsv2 is the second place after aprcp ccmp nrt gfs and era5 have better skills than cfsv2 and aprcp and exhibit higher correlation lower rmsd and less positive bias note that both cfsv2 and aprcp are wind products from coupled atmosphere ocean models it is unclear whether the positive bias is caused by the coupling dynamics though comparisons with in situ observations do indicate the performance of different wind products somehow they fail to provide their spatial disparities the bias of different wind products is calculated and shown in fig 5 by taking era5 as a reference as shown in fig 5a the summer wind speed in the ecs is about 1 5 2 times larger than in the yellow sea and bohai sea a basin wide positive bias is shown in aprcp cfsv2 and gfs the bias is generally less than 0 5 m s but are as high as 1 0 m s in aprcp conversely the ccmp nrt wind exhibits negative bias over most of the shelves except for the kuroshio region fig 4b summarizes the pattern difference between era5 and the rest four wind products ccmp nrt generally agrees best with era5 which has a slightly higher correlation with era5 and has the same standard deviation as era5 gfs and cfsv2 show similar skills each with about the same rmsd cc and standard deviation but have variations larger than era5 aprcp produces much larger variations than era5 resulting in the largest rmsd and the lowest pattern correlation further decomposing the winds to fair weather conditions and extreme weather conditions shows that the aprcp cfsv2 and gfs outweigh the era5 in both situations particularly in extreme weather conditions not shown the ccmp nrt though weaker than era5 during fair weather conditions outweighs the era5 wind during typhoon events in terms of the magnitude the wind products during fair weather conditions can be ranked as follows aprcp cfsv2 gfs era5 and ccmp nrt while during extreme events all other wind products outweigh the era5 among the five wind products aprcp is the only data produced by regional atmosphere ocean coupled models with the highest resolution 9 km we expect that the high resolution aprcp would advance the wind and wave prediction with improved coupling dynamics however large scatter and bias are revealed when compared to observations and other wind products its effects on the performance of wave simulation will be discussed in section 3 3 3 3 wave assessment both wind forcings and input source functions affect evaluation of the model performance to discern the effects of winds and wind input formulations in swan fifteen runs that is five different wind products in combination with three different swan wind input formulations i e janssen komen and wst have been conducted to assess the model performance in the cre region the model simulations are compared with along track altimeter observations and in situ buoy data a systematic difference between input source functions in swan the performance of the three commonly used input source strategies is assessed by comparing the simulated h s with altimeter observed h s fig 6 shows the scatter density plots between the simulated h s with different input source strategies and altimeter observations taken the era5 wind as an example the linear regression coefficients for janssen komen and wst are 0 84 0 82 and 0 72 respectively fig 6 when the cfsv2 is adopted the linear regression coefficients for janssen komen and wst change to 1 00 0 99 and 0 89 in general the h s using the janssen formulation is slightly higher than komen and much higher than wst formulation the wst formulation produces the lowest wave height for all wind products systematically lower than altimeter observations in all wind cases it has been reported that the wind input energy is similar in janssen and komen in previous studies however the janssen formulation has been demonstrated to perform better in reproducing the wave period siadatmousavi et al 2011 beyramzade et al 2019 besides the default komen formulation may pump disproportionate amount of energy to high energy part of the wave spectrum due to insufficient dissipation rogers et al 2003 though tuning the white capping formulation in komen may account for the weak dissipation at lower frequencies inappropriate representation of the rate of white capping dissipation may generate unreal wave height beyond the theoretical limits proposed by pierson and moskowitz 1964 and swan team 2020 given this the janssen wind input formulation may be a more proper option in our application here the altimeter observations mainly represent waves in the middle and outer shelves the input source function is essential in setting up the rate of wave growth but maybe less important in shallow waters where depth induced breaking dominates to test this the depth dependence of h s using the three input source functions forced by era5 are shown in fig 7 as shown in fig 7 the mean h s is of about 1 2 m over the outer shelf 100 m and decreases rapidly when propagating onshore the discrepancies between janssen and komen are relatively small but large discrepancies exist between wst and janssen komen as expected the discrepancies decrease with depth the difference between janssen and komen decreases from 3 2 cm at the outer shelf to less than 1 5 cm in the inner shelf 30 m the difference between wst and komen reaches 15 cm at the outer shelf and remains as high as 10 cm when approaching the inner shelf indicating a severe underestimation over the continental shelves underestimation of h s by wst formulation has been reported in several previous studies mao et al 2016 kutupoğlu et al 2018 the wst formulation employed a nonlinear saturated base white capping equation for the dissipation term and was designed to improve the underestimation of wave period in janssen and komen package van der westhuysen et al 2007 unfortunately no measured data is available to test the performance of wst in reproducing the wave period given the input source options and parameters used in this section there are systematic difference between the three wind energy input formulations the janssen option produces the highest h s compared to others and the wst underestimates the h s in all cases further calibrations may improve the model performance and will be discussed in section 4 3 however we will show that the model performance is more sensitive to the wind diversity than the input source functions and corresponding parameters the janssen wind input formulation is thus recommended and adopted in the following analysis b model sensitivity to different wind fields in addition to the input source functions fig 6 also presents the wave statistics from different wind products as shown in fig 6 the deviation from different wind forcings is more distinct than the difference due to input source formulations and the variation of skill metrics is 2 4 times larger than the uncertainty resulting from input source terms taken the janssen wave formulation as an example all wind products have the tendency to underestimate h s during fair weather condition the predicted h s is of about 22 cm 25 cm 8 cm 10 cm and 13 cm lower than the altimeter observations for era5 ccmp nrt cfsv2 gfs and aprcp respectively when the observed wave height is lower than 4 m however the bias is of about 51 cm 2 cm 83 cm 54 cm and 18 cm when the observed h s is greater than 4 m during extreme weather conditions it indicates that while cfsv2 and gfs underestimate the altimeter observed h s during fair weather conditions they overestimate it during extreme wave events the era5 and ccmp nrt on the other hand underestimate the altimeter observed h s on both fair and extreme weather conditions the piecewise variation is clearly shown by the quantile quantile q q plots superimposed in fig 6 the gfs cfsv2 generally agrees best with altimeter during fair weather conditions but overestimates h s larger than 4 m during extreme events counterintuitively the higher wind intensity in aprcp only yields slight positive bias we note that the both the aprcp wind and the resulting h s have the largest scatter index table 3 and fig 6 indicating that there is spatial and or phase mismatch between the aprcp wind and others this can further be seen from fig 9 when superimposing the altimeter observation on the model simulations the track mismatch and the relatively poor coverage of altimeter observations together distort the skill statistics the underestimation of h s compared to altimeter observations has been reported elsewhere for example in the red sea beyramzade et al 2019 the black sea van vledder and akpınar 2015 and the east china seas wu et al 2020 however the altimeter observed h s may have been overestimated particularly for low wave conditions wiese et al 2018 park et al 2013 yang et al 2020a based on more than 150 in situ buoys observations in the northern atlantic wiese et al 2018 concluded that the satellite altimeter overestimated the h s by about 7 to 26 cm a similar study covering the pacific ocean also revealed that the altimeters including sentinel 3a 3b and jason 3 overestimated the in situ observed h s by about 5 cm when h s was less than 4 m and the accuracy further decreased when the h s exceeding 4 m yang et al 2020a given the possible errors in altimeter observations the statistics presented in fig 6 mainly represents the difference rather than the errors and are referred to representation errors sometimes which are distinct form the measurement errors and the model errors janjić et al 2017 both the mismatch between the scales represented in observations and models and the error due to observation operators contribute to such basic difference oke and sakov 2008 janjić et al 2017 nevertheless fig 6 reveals the general performance and the difference of diverse wind products over the ecs their performance over the cre will be further identified by in situ wave buoys in next sub section the potential geographical dependence of the winds is further investigated fig 8 shows the distribution of model altimeter bias with respect to the water depth and observed h s as shown in fig 8a the model altimeter bias ranges between 5cm to 30cm and is negative through the continental shelves indicating that all wind products tend to underestimate the overall h s the cfsv2 and gfs show relatively lower negative bias compared to ccmp nrt and era5 a critical wave height of about 4 m has also been found as shown in fig 8b all five wind products underestimate h s at low h s less than 4 m but the negative bias turns smaller or positive when h s increases to higher than 4 m this may either due to the shift of the accuracy of altimeters or the performance of wind products during different weather conditions in addition fig 8b further reveals that cfsv2 produces the highest h s and the era5 winds predict the lowest h s during summer season of 2019 as compared to others the wind performance during extreme weather events is further examined during typhoon lekima fig 9 shows the distribution of h s on august 9 2019 at 10 00 ltc when typhoon lekima affected ecs the core area with extremely high wave height is much larger in cfsv2 and gfs as compared to others in contrast the era5 produces much lower h s than others the along track satellite observed h s is also superimposed in fig 9 the predicted h s by cfsv2 gfs is comparable with altimeters but is substantially underestimated by era5 fig 9a the ccmp nrt though weaker than era5 during fair weather conditions is stronger than it during extreme events and produce relatively larger waves fig 9b in addition to the amplitude substantial difference is presented in the spatial structure a large central calm area is presented in cfsv2 and era5 in agreement with the along track observed high low distributions but not in gfs and others the aprcp though with highest resolution exhibits a significant track shift as compared to observations and other wind forcings the spatial mismatch generates a relatively higher discrepancy between simulations and observations and thus the higher scatter index as already shown in fig 6 c model performance over the cre region the altimeter data may be contaminated in the vicinity of coastlines cavaleri et al 2019 observations from in situ wave buoys are used to assess the model performance adjacent to the cre there are six buoys available around the cre during june 1 to september 30 2019 and their locations are given in fig 2b with the corresponding water depth increasing from 9 25 m at hu01 to 69 81 m at mf06001 table 2 fig 10 shows the time series of the observed h s four extreme wind waves are recorded by hu02 mf04001 mf05001 mf05003 and mf06001 during typhoon danas lekima lingling and tapah respectively however in the nearshore site hu01 high h s is only observed during typhoon lekima with a maximum of 2 61 m about half of h s at hu02 120 km further offshore fig 10 also shows the comparison of buoy observed h s with the model predictions using janssen wind input formulation forced by cfsv2 and era5 winds respectively as shown in fig 10 the model predictions follow the observations closely the tidal frequency wave fluctuations are observed at hu01 but no such signals are presented in simulations the wave fluctuations at hu01 could reach of about 60 cm which may distort the skill analysis at hu01 high frequency fluctuations on the other five sites are relatively small the model performance during extreme weather conditions is further shown in fig 11 by taking typhoon tapah as an example the h s decreases as the water depth becomes shallower towards the shore highest h s of about 8 0 m is observed at mf06001 during tapah mf05001 and hu02 have similar h s and are of about 1 0 1 5 m lower than mf06001 the h s further decreases by about 1 0 m at mf05003 and mf4001 and lowest h s of about 1 0 m is observed at hu01 among the different winds cfsv2 gfs and aprcp predict the highest h s during typhoon events and tend to overestimate the highest wave height the era5 on the other hand underestimates the observed highest h s by about 1 2 m during typhoon tapah the skill metrics of the model are summarized in a taylor diagram shown in fig 12 the five different symbols denote the different wind forcings and the different colors represent the six buoys all wind forcings perform better in the exposed sites hu02 mf04001 mf05001 mf05003 and mf06001 than the inner site hu01 which has the lowest correlation and largest rmsd the cc is decreasing from exposed to inner locations in terms of winds the aprcp has lowest correlation and largest rmsd although cfsv2 gfs ccmp nrt and era5 have about the same correlation with observations ccmp nrt and era5 simulate the amplitude of the variations i e the standard deviation lower than cfsv2 and gfs resulting in a smaller rmsd ccmp nrt and era5 generally agree best with observations each with about the same rmsd the ccmp nrt however has the same standard deviation as the observed whereas era5 has too little variability we have also calculated the model skills against buoys during different weather conditions not shown the ccmp nrt and era5 underestimate the h s during both fair and extreme weather conditions cfsv2 and gfs have better skills over fair weather conditions but have the tendency to overestimate the higher h s 4 discussion 4 1 impact of boundary truncation we have shown in section 3 that the wave model underestimates the altimeter observed h s during fair weather conditions part of the underestimation may attribute to the representation error of the altimeter observations and the quality of winds and boundary conditions may also play roles the ecs is dominated by southeast monsoon in summer with the waves mainly propagating onshore from the open ocean to the continental shelves the model domains should be sufficiently large to account for the large scale wave signals to discern the effects of wave energy input from model boundaries a comparative run with larger model domain is conducted with an outward expansion of about 300 km fig 1 the difference of h s between the two comparative runs forced by era5 is shown in fig 13 as shown in fig 13 the difference of h s is negligible over the cre comparison with the in situ buoys confirms that the contribution is much less than the uncertainty due to winds thus we conclude that the small mesh grid is capable of predicting the h s in regions adjacent to the cre fig 13 also presents the wave estimation provided by ecmwf from the global era5 wam model ifs 2020 era5 wam is produced by the wam wave model and is part of the ecmwf ifs the difference between the era5 wam and era5 swan appears to reflect the effects of boundary truncation and varied numerical schemes the hourly era5 wam reanalysis of h s with a spatial resolution of 0 5 has been superimposed in fig 13 its comparison with the observation is generally poorer than swan especially at the inner buoy hu02 fig 13a era5 wam underestimates the h s at the inner buoy hu02 especially during typhoon events similar results have also been found at other inner buoys mf04001 mf05003 and mf05001 given the relatively lower horizontal resolution of era5 wam the results over the inner shelf are questionable and the poor performance is expected the era5 wam shows better performance at the outer buoy mf06001 than the inner buoys fig 13b and the peak h s agrees well with observations and is larger than era5 swan the relatively higher peak of era5 wam than swan may attribute to the assimilation of altimeter observed h s since similar overestimation has been found in satellite observations wiese et al 2018 park et al 2013 yang et al 2020a moreover though era5 winds have relatively weak intensity the wind speed which is actually seen by era5 wam model is different than the 10 m wind seen by the swan model as the radar altimeter data assimilation scheme is such that it produces increments for wave heights but also for wind speeds ifs 2020 it should be noted that the peak waves of era5 wam at the outer shelf though slightly higher than era5 swan are still generally lower than observations fig 9f besides we also find that era5 wam overestimates the h s during low wave conditions h s 2 m at buoy mf06001 for example during september 9 16 and 24 30 fig 13b similar results have been found in previous studies shi et al 2021 have evaluated the performance of era5 wam in china s coastal waters and found that era5 wam overestimated the h s based on annual average but underestimated the h s substantially during extreme wave events which is consistent with our results here 4 2 importance of high resolution winds the quality of wind forcing is essential in the prediction of surface ocean waves especially in coastal waters with complex coastlines and islands and its importance has been emphasized elsewhere e g bricheno et al 2013 sirisha et al 2019 validations in this study show that the overall performance of the wave model based on different wind forcing is good but obviously depends on the quality of the forcing wind fields the newly available aprcp has the highest resolution as compared to other wind products and does show some finer structure when compared to others and a 27 km version of aprcp li et al 2020b figure 14 given the lack of direct in situ observations to verify the high resolution winds especially during extreme typhoon events the wave analysis provides circumstantial evidence to evaluate the atmospheric models however the swan model skill adopting aprcp is generally poorer than other wind forcings indicating that further efforts are needed to improve the aprcp model performance we find that though the high resolution aprcp produces finer wind structure the storm track in aprcp deviates from observed track by about 1 2 degrees worst among the five wind products fig 9 and fig 14 nevertheless spatial variability of wind forcing is a key factor for the small scale features which coarse resolution models are not able to resolve christakos et al 2020 a higher resolution wind of 3 km has also been conducted for typhoon lekima during august 5 25 2019 fig 14 presents the comparison of winds from aprcp with different resolutions substantial difference is present in winds with different resolutions both in terms of magnitude and structure the higher resolution winds are not necessarily better than the coarse one as indicated by the track bias fig 14 skill analysis against the wave buoys over the cre confirms that the model skills turn better at hu01 mf04001 and mf05003 but turn worse at others fig 15 a notable improvement is that the 3 km aprcp reproduces the tidal frequency fluctuations at hu01 better than the 9 km aprcp a recent study adopting a wave surge tide coupled model over the cre revealed that the tidal frequency wave fluctuations over the cre could not be completely reproduced by the coupled model and inferred that the high resolution winds also played a role chi and rong 2021 our analysis here further confirms the importance of high resolution winds in nearshore wave simulations 4 3 potential improvement from recalibration and st6 we have shown that the performance of swan appears more dependent on wind forcings than input energy source term packages identifying the quality of the wind fields is thus an essential first step for further calibration of model parameters though it is impractical to get optimal settings for all winds and applications recalibration has been frequently implemented given the janssen source function and the cfsv2 winds four additional runs have been conducted to discuss the improvement by calibrating the parameters in the white capping and the depth limited breaking terms which are considered to be the key parameters with highest sensitivity mao et al 2016 xu et al 2020 the parameter cds1 determining the rate of white capping dissipation and ratio gamma determining the maximum individual wave height over depth have been adjusted 20 to check the potential improvement table 1 xu et al 2020 the lower cds1 corresponding to a weaker dissipation leads to higher h s which does improve the model performance during fair weather conditions but further magnify the wind error during extreme wind events not shown increasing gamma in the wave breaking term has similar effects but only plays roles in the very nearshore region with depth less than 20 m the wave model deviations from different model parameters are much less than the cases with different input source functions which further confirm that the ways of source term parameterizations are the most important factor in terms of h s ardhuin and roland 2013 roland and ardhuin 2014 a new package of wave physics referent to as st6 physics has been implemented in swan by rogers et al 2012 several new terms based on observational studies have been introduced in st6 including the new parametrizations of wind input the observation consistent white capping the swell dissipation the wind speed scaling and other processes rogers et al 2012 several recent studies indicate that st6 might become the preferred physic package for swan aijaz et al 2016 aydoğan and ayat 2021 day and dietrich 2022 no comprehensive comparison and validation of st6 over the ecs and the cre have been conducted yet partly because that many parameterizations have been changed in st6 and thorough evaluations are needed liu et al 2017 2019 aydoğan and ayat 2021 here we present a preliminary comparison of the default st6 with janssen to give a ground for further studies detail analysis and calibration of st6 deserve future works fig 16 shows the comparison between altimeter observations and model simulations with janssen and st6 by using the cfsv2 winds the default st6 has comparative skills with janssen when h s is less than 4 m but tends to predict higher h s during extreme wave events further magnifying the potential error of cfsv2 during extreme weather conditions fig 6 and fig 8 however as we have shown the model performance depends on the quality of wind fields the parameters in the default st6 may have been adjusted to account for the missed wave peaks cavaleri 2009 cavaleri et al 2020 better performance may be achieved by alternative winds or by calibrated parameters aydoğan and ayat 2021 5 conclusion accurate modeling of wave conditions in complex coastal waters remains a challenging issue the model performance depends on multiple factors including the quality of wind forcing the wave model physics boundary conditions etc in this study a high resolution unstructured wave model swan has been implemented for the cre five wind products the era5 ccmp nrt cfsv2 gfs and aprcp have been used as forcing and their performance over the cre have been assessed in addition the choice of four different source term packages has been investigated the model performance has been evaluated by comparing with altimeter observations and in situ buoy measurements several potential sources of model errors have been discussed comparison with in situ observed winds shows that all wind products agree fairly well with observations cross comparison of different wind products shows that cfsv2 and gfs are stronger than era5 during both fair and extreme weather conditions ccmp nrt on the other hand is lightly lower than era5 over most the continental shelves during fair weather conditions but outweighs era5 during typhoon events among the five wind products the era5 presents the lowest wind intensity during typhoons the aprcp though having the highest spatial resolution behaves significantly different from land observations and era5 the model performance of the five wind products together with three commonly used input source term packages janssen komen and wst has been evaluated firstly there is systematic difference between the three wind input formulations the default janssen and komen show comparative capability in reproducing the h s while wst underestimates the h s substantially given the outperformance of janssen in white capping dissipation the janssen formulation is adopted and recommended for application over the cre though the janssen formulation produces the highest h s all wind products using with janssen nevertheless underestimate the observed h s during fair weather conditions when comparing with satellite observations the negative bias decreases when comparing with the in situ buoy measurements indicating that part of the negative bias may be attributed to the overestimation of satellite retrieval which has been demonstrated in several previous studies the performance of the wave model depends significantly on the quality of wind forcing the deviation due to different wind forcings is about 2 4 times larger than the uncertainty resulting from input energy source term packages the h s when cfsv2 and gfs are employed with janssen formulation exhibits best agreement with altimeter observations and in situ buoy data during fair weather conditions however the cfsv2 and gfs winds overestimate the h s during extreme weather events the era5 on the other hand underestimates the h s during both fair and extreme weather conditions the ccmp nrt though underestimates the h s during fair weather conditions has the best performance during extreme wave events default parameters of the source term packages have been used in this study given a certain wind forcing it is possible to achieve better performance by further calibration of model parameters however the deviations from different model parameters are much less than the source functions the choice of source functions appears to be the most important factor in terms of h s the default st6 has much the same skill as janssen during fair weather conditions but tends to produce higher h s during extreme weather events indicating that the default parameters of st6 may have been tuned to account for the missed wave peaks results from this work provide a good start to build a hindcast and forecast system for the cre region high resolution both spatial and temporal winds have been demonstrated to be essential in reproducing the finer scale feature of waves however the 9 km aprcp wind product from a regional atmosphere ocean coupled model exhibits relatively poorer performance than other wind forcings indicating that further work is needed to improve the coupling architecture in aprcp nevertheless the 9 km and refined 3 km products show some detail structure of typhoons their effects on the prediction of wave model need further investigations specially a case study during typhoon lekima emphasizes the importance of high resolution winds in reproducing the high frequency wave fluctuations adjacent to the cre which cannot be fully explained by tide wave fluctuations there are several works keeping improving the regional atmosphere ocean coupling framework li et al 2020a the wave hindcast and forecast is expected to benefit from the upgrading of aprcp credit authorship contribution statement yan jiang conceptualization methodology validation formal analysis writing original draft zengrui rong conceptualization supervision writing review editing project administration pixue li resources data curation investigation tao qin data curation investigation xiaolin yu resources data curation yutao chi software validation zhiyi gao resources investigation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work was supported by the national key research and development program of china 2016yfc1402000 and the major scientific and technological innovation project mstip of shandong 2021cxgc010705 
23848,accurate parameter estimation for the global tide and surge model gtsm benefits from observations with long time series however increasing the number of measurements leads to a large computation demand and increased memory requirements especially for the ensemble based methods that assimilate the measurements at one batch in this study a memory efficient parameter estimation scheme using model order reduction in time patterns is developed for a high resolution global tide model we propose using projection onto empirical time patterns to reduce the model output time series to a much smaller linear subspace then to further improve the estimation accuracy we introduce an outer loop similar to incremental 4d var to evaluate model increments at a lower resolution and subsequently reduce the computational cost the inner loop optimizes parameters using the lower resolution model and an iterative least squares estimation algorithm called dud the outer loop updates the initial output from the high resolution model with updated parameters from the converged inner loop and then restarts the inner loop we performed experiments to adjust the bathymetry with observations from the fes2014 dataset results show that the time patterns of the tide series can be successfully projected to a lower dimensional subspace and memory requirements are reduced by a factor of 22 for our experiments the estimation is converged after three outer iterations in our experiment and tide representation is significantly improved achieving a 34 5 reduction of error the model s improvement is not only shown for the calibration dataset but also for several validation datasets consisting of one year of time series from fes2014 and uhslc tide gauges keywords global tide and surge model parameter estimation model order reduction 1 introduction the risk from coastal flooding generally increases due to the sea level rise and climate changes jongman et al 2012 muis et al 2017 the sea level can reach especially high values where tidal amplitudes are large it is even more destructive especially when the storm surge coincides with the high water during spring tide pugh 1996 hydrodynamic tide and storm surge models play an important role in assessments of flood risk and sea level rise and for forecasting extreme sea levels are often a combination of high tides and a storm surge the accuracy of the reproduction of both tides and storm surge is important for these applications ward et al 2015 in deep water tides and storm surge can be modeled independently but in shallow water non linear interactions are more prominent with the future aim to model these interactions we develop a combined global tide and surge model gtsm however this paper focuses on the tides and considers tides separately stammer et al 2014 summarized the developments in global tide modeling and compared a number of global tide models regarding their physical processes grid resolution and so on there are still a number of sources of model errors remaining such as neglected physics in the model formulation uncertainty parameters e g bathymetry bottom friction and internal tides friction that are not accurately known data assimilation is a promising approach for reducing parameter uncertainties with available observation data e g altimeter and tide gauge measurements several successful applications of data assimilation for improving tide model performance have been reported in literatures edwards et al 2015 with the adjoint methods das and lardner 1991 bannister 2017 heemink et al 2002 zaron 2019 and ensemble methods barth et al 2010 mayo et al 2014 ngodock et al 2016 zijl et al 2013 in a comparison of several assimilative and non assimilative models stammer et al 2014 reported that data assimilation can contribute significantly to the accuracy of global tide models in our previous study we proposed a computation efficient parameter estimation scheme to estimate bathymetry for a high resolution global tide and surge model gtsm wang et al 2021 gtsm is a 2d tide and surge model with an unstructured grid the model is running operationally to forecast storm surges worldwide another application of gtsm is the assessment of flood risks and the potential impacts of sea level rise to extreme storm tides verlaan et al 2015 in wang et al 2021 after the parameter estimation tide representation in gtsm was improved significantly using an ensemble type algorithm without the adjoint called dud ralston and jennrich 1978 dud does not use derivative is a derivative free calibration algorithm that works in an iterative way in the estimation procedure observation is compared with the model output in the time series formula tidal constituents are widely used as model output in estimation applications such as the estimation of the fes model lyard et al 2021 but tidal constituents cannot be directly computed in gtsm because gtsm is a time stepping model the time stepping model allows a more accurate representation of non linear interactions at the coast which is also recognized by lyard et al 2021 to obtain accurate tidal analysis results we have to simulate the gtsm for a year based on the rayleigh criterion to separate diurnal constituent s1 from k1 if one would include seasonal constituents sa and ssa several years would be required since they show large inter annual variability harmonic analysis needs a careful consideration of which tidal constituents to be included when the length of the time series is not an integer multiple of the period given by the frequency difference of two constituents or a large non integer value then the estimation is potentially poorly conditioned and the estimates will influence each other in contrast the proposed time series pod method will produce accurate orthogonal approximations without any user intervention and regardless of the length of the time series in addition hundreds of model runs would be simulated in the estimation process therefore parameter estimation in tidal constituents is not feasible with the computational facilities available to us the use of time series for weeks or a month can significantly reduce the simulation time and computational complexity but the simulation time length of two weeks one spring neap cycle is short and leads to estimates that over fit the data to some extent wang et al 2021 however longer time series imply larger memory requirements in the analysis step which is not feasible for the current implementation and computational cluster therefore an efficient approach has to designed which can reduce the memory requirement and enable a longer simulation time length for ensemble based data assimilation methods evensen 1994 the memory use is proportional to the number of measurements assimilated in one batch multiplied by the number of perturbed model runs called ensemble members this also applies to the method used in this paper observations are often assimilated in one batch to maintain consistency between the estimated parameters and model output after the estimation evensen and van leeuwen 2000 emerick and reynolds 2013 which cannot be guaranteed for incremental assimilation in smaller batches however this leads to a large size of the linearized model outputs o n n t n s where n n t n s are the number of ensembles number of observation time steps and number of locations respectively when we attempt to include more observations and to estimate more parameters this can result in a huge memory usage on a single compute node there are at least two ways to ease the huge memory usage problem 1 parallelization of the linear solver and 2 reducing the size of the problem by approximation here we follow the second approach by using model order reduction methods note that variational methods have different characteristics in terms of memory usage model order reduction mor is a collection of methods that can be used to reduce the computational complexity of mathematical models in numerical simulations with an approximation of the original model antoulas et al 2015 in this paper we develop a new method time pod which aims to reduce the size of the model output so that the memory needed for data assimilation can be reduced the method was inspired by the proper orthogonal decomposition pod chatterjee 2000 which projects the spatial patterns of the state onto the leading singular vectors here we project onto the leading singular vectors of the time patterns instead pod is one of the mor techniques first introduced in fluid dynamics by lumley 1967 it was already known as the karhunen loève expansion kosambi 1943 in statistics and also as principal component analysis pca jolliffe and cadima 2016 or empirical orthogonal functions eof monahan et al 2009 in meteorology pod methods liang et al 2002 such as the karhunen loève decomposition kld pca and singular value decomposition svd have been applied in various fields such as fluid dynamics cazemier et al 1998 pattern recognition kopp et al 1997 and more recently in control theory and inverse problems mor has been applied in both ensemble based and variational data assimilation systems cane et al 1996 farrell and ioannou 2001 beck and ehrendorfer 2005 cao et al 2007 the typical application of mor is projected based on truncated characteristic vectors in spatial patterns of model state variables for instance a dual weighted proper orthogonal decomposition dwpod is proposed combining with four dimensional variational method 4dvar to reduce state space orders in a global shallow water model daescu and navon 2008 lin and mclaughlin 2014 reduced the parameter dimension by pod for an enkf data assimilation system in this study we proposed two new developments based on our previous estimation scheme wang et al 2021 firstly a low memory storage estimation approach is implemented using the model order reduction techniques in the time patterns secondly the implementation of outer iteration improves the estimation accuracy the reason is to better deal with the optimization of non linear models dud is an iterative smoother type estimation algorithm the memory needed is linearly increased with the simulation time length the total data size is in the order of o 1 0 9 when the time length is larger than one month in this application which leads to memory issues therefore we developed a time pod approach to reduce the dimension of the model output by projecting the time space of the model output onto a smaller subspace the main advantage of the time pod is that the simulation required is not restricted by the rayleigh criterion which normally requires a year s simulation for accurate estimation of tidal constituents the projection reduces the memory requirements while still accurately representing the time signal for any simulation length the required length of the time span considered then becomes limited by other considerations in our previous experiments a length of two weeks leads to some over fitting for that time period wang et al 2021 in this study we performed the time pod calibration experiments covering the one month simulation time span it provides significant improvements to the model accuracy and reduce the over fitting of data used in the estimation process furthermore parameter estimation accuracy is also affected by the calibration algorithm the approach of using a lower resolution model in the estimation is similar to incremental 4dvar and an outer loop iteration can further improve the estimation accuracy by updating the reference using a new fine resolution simulation with the updated parameters emerick and reynolds 2013 chen and oliver 2013 the incremental 4d var method consists of nested inner loops and outer loops to reduce computational cost for data assimilation it is applied successfully in the assimilation system at the ecmwf courtier et al 1994 mahfouf and rabier 2000 trémolet 2007 in this study we use a very similar structure coarse incremental estimation wang et al 2021 uses a coarser grid to represent the model increments between the initial model and model with updated parameters the outer loop uses the high resolution model with the updated parameters from the converged inner loop to restart the estimation process it is expected that this will result in a better match between the observations and the fine grid model in section 2 the global tide and surge model gtsm is introduced section 3 describes the parameter estimation scheme including the time pod application to temporal patterns and the outer loop implementation section 4 describes the experiment configuration including parameter selection observations model and experiments set up in section 5 pod performance is evaluated by firstly analyzing the accuracy of projected and reconstructed model output and secondly comparing the bathymetry estimation results with or without the application of mor we also perform a parameter estimation experiment with an extended simulation time of one month model validation for the year 2014 is presented in section 6 finally discussions and conclusions follow in section 7 2 global tide and surge model gtsm is a depth averaged hydrodynamic model that simulates tide and surges it plays an important role in the global storm surge information system glossis to provide water level and storm surge forecasts the model is forced by tide generating forces without any lateral boundaries the governing equations of the model are 1 u t 1 h h uu u h u f u g ζ ζ e q ζ s a l ν u u t τ h h t h u 0 where h is the total water depth u represents the depth averaged horizontal velocity vector f is the coriolis force g is the gravitational acceleration ν is the horizontally eddy viscosity ζ is the water level ζ e q is the equilibrium tide ζ s a l refers to the self attraction and loading effect sal the term τ denotes parameterizations of the friction stress most of the global tide energy dissipation comes from the bottom friction and we use chézy quadratic formulation with the coefficient of 77 m 1 2 s 1 in the model furthermore internal tide friction is parameterized because there is approximately 1 tw energy dissipation about 25 30 of the total occurring in the deep ocean through internal wave drag maraldi et al 2011 gtsm can also model surge using additional wind and air pressure conditions as the model forcing pugh and woodworth 2014 we combined different datasets for the bathymetry emodnet bathymetry with a resolution of about 250 m is implemented as the input of bathymetry in europe general bathymetric chart of the ocean dataset gebco 2019 with 15 arc second resolution is used at the rest of the globe however there is still a large uncertainty in bathymetry even though bathymetry can be measured directly large areas of the oceans are unsurveyed and only estimated by satellite altimetry with a much lower effective resolution of 8 9 km weatherall et al 2015 tozer et al 2019 an essential characteristic of delft3d fm is unstructured grids kernkamp et al 2011 the scale of tidal components is usually more prominent in the nearshore than in the deep ocean high resolution is required in the coastal region to provide highly accurate modeling pringle et al 2021 also reported that the mesh refinement in shallow waters where the coast and at steep topography is important for the global accuracy of the simulated astronomical tide here we use gtsm with two different resolutions gtsm with the coarse grid and gtsm with the fine grid hereinafter table 1 reports the computation time of the coarse and fine resolution models as expected gtsm with the fine grid has a longer computational time but more accurate tide forecasts however many fine model simulations needed in the parameter estimation procedure would require weeks or even months of computational time which is unbearable 3 parameter estimation with model order reduction 3 1 parameter estimation framework we design an efficient and low memory usage parameter estimation scheme with model order reduction for the high resolution tide models to reduce parameter uncertainties and improve forecast accuracy the flowchart of this parameter estimation scheme is shown in fig 1 the basic estimation algorithm applied here is called dud does not use derivatives in a generic data assimilation toolbox openda ralston and jennrich 1978 karri et al 2013 it optimizes the parameters by iteratively minimizing the following cost function 2 j x 1 2 x x b t b 1 x x b 1 2 y h x t r 1 y h x where y is the field observation vector including all time steps in t t 1 t n t and all stations 1 n s x is the vector of parameters to be estimated with the dimension of n h x is the model output vector matching observation locations for all time steps x b is the initial parameter vector b and r are the background and observation error covariances respectively the dimension of observation y and model output h x in all space points and time steps is as o n s n t the first term on the right hand of the cost function eqs 2 is the background term j b constraining the changes to the initial parameters the second term is the observation term j o representing the difference between model output and observations for the brief introduction of the dud algorithm and parameter estimation scheme we only describe the observation term of the cost function in the following sections fig 1 shows the flowchart of the parameter estimation scheme connecting the components dud time pod and outer loop dud is implemented in the inner loop combining with the coarse to fine strategy and time pod application dud is a gauss newton similar algorithm but derivative free it started from the model simulation of first guesses for the parameters x 0 x b and n simulations with each parameter perturbed as x 1 x b δ e 1 x 2 x b δ e 2 x n x b δ e n parameter is updated for an approximate linear model that fits exactly through the model output for x 0 x 1 x n dud iteratively finds the parameters that minimize the sum of squares between model output and observations we propose to improve estimation performance while reducing the computational cost and memory requirement based on the original dud algorithm they are several methods developed the coarse to fine strategy model order reduction in time patterns and introduction of outer loop iterations in our previous study wang et al 2021 a coarse to fine strategy called coarse incremental calibration is proposed to reduce the computational cost it is also applied here using a coarser grid model to replace the increments between the output from the initial model and the model with modified parameters terms h f x and h c x are defined as the model output with the fine and coarse grid respectively h f x can be approximated with h f x b h c x h c x b thus the cost function is represented as 3 j o x 1 2 y h f x b h c x b h c x t r 1 y h f x b h c x b h c x therefore gtsm with the fine grid is only simulated to generate the initial model output h f x b other simulations in the inner iterations use gtsm with the coarse grid instead which reduces the computing time to approximately 36 of the original in this research we consider reducing the dimension of the model output by mor the dimension of model output h x 0 h x 1 h x n 1 and observations y is huge which requires a huge memory especially when the model has a long simulation time length for example if the number of observations n s is o 1 0 3 and with the number of time steps n t is o 1 0 3 then the dimension of the model output h x and observations y is o 1 0 6 if we assume the parameter dimension n is in the order of o 1 0 2 the parameter dimension is the length of the vector with the parameters estimated in this paper we define spatial subdomains where a single multiplicative adjustment is applied each of these subdomains adds an element to the parameter vector thus the dimension of the model output in the analysis step is o 1 0 8 such a huge memory usage is unacceptable in practice therefore we apply pod in the time patterns for model output and observations to reduce memory usage in the estimation procedure that will be further explained in section 3 2 moreover we use the dud process in the inner loop to obtain the updated parameters at a lower resolution see fig 1 with the coarse incremental calibration approach high resolution gtsm only plays a role as the initial output h f x b in eqs 3 while instead by the coarse grid model h c x for iterative update even though our previous experiments demonstrate that coarse grid increments can well represent the fine grid increments wang et al 2021 the results after the estimation can still be significantly affected by the model with the coarse grid therefore we introduce the outer loop to take the high resolution model states into account the updated parameters obtained from the previous converged dud process are used as the new first guess to update the initial model output the cost function can be rewritten as 4 j o x 1 2 y h f x b k h c x b k h c x t r 1 y h f x b k h c x b k h c x where k is the iteration number of the outer loop x b k is set to be the optimized parameters x a k 1 from the previous dud process the estimation process terminates once the cost function has converged compared to the computation efficient parameter estimation scheme we proposed in the previous study wang et al 2021 the estimation scheme in this paper also contributes to memory reduction with the time pod algorithm and estimation accuracy improvement by the outer loop iterations the combination of these methods gives a computation efficient and memory reduced parameter estimation framework the parameter estimation process with time pod application and outer loops as shown in fig 1 can be summarized as follows 1 define first guess parameter set x 0 x 1 x n 2 analyze initial model output h f x b h c x b determine the corresponding pod reduced model output h ˆ f x b h ˆ c x b with the truncated basis matrix u n p 3 convert the original observations to corresponding observation y ˆ based on the truncated projection matrix 4 simulate the coarse grid model with the first guess parameter set generate the pod reduced model states h ˆ c x 0 h ˆ c x 1 h ˆ c x 2 h ˆ c x n and evaluate the cost function 5 find the new parameters x for an approximate linear model that fits exactly through the model output for x 0 x 1 x n 6 if the dud stop criteria are not satisfied then perform a model simulation with updated parameters x and do model order reduction for model output h ˆ c x and return to step 5 7 if model outputs with optimization results do not reach the outer loop stop criteria then return to step 1 with the optimized parameters as a new first guess for the next iteration of the dud process 8 output optimal estimation of parameters x a in the last outer loop 3 2 proper orthogonal decomposition pod in this section details of the application of pod to reduce model dimensions in time patterns are described the time pod reduced model is introduced first then we define the corresponding observation term and error covariance finally the complete parameter estimation procedure is summarized 3 2 1 time pod reduced model pod reduces the model order by identifying several modes with the most energies from a high dimension system and uses these modes as a lower dimension subspace approximation usually the discrete pod is derived with snapshots to find a smaller subspace for states in spatial patterns a snapshot is the value of the model state vector at a certain time however the vast memory requirement in our application comes from the model output h f x h c x and observation y containing the data both in space and time patterns in the order of o n s n t as the simulation time increases the dimension in time scale n t is usually much larger than that in the spatial scale n s thus reducing the order in the time patterns is crucial in the brief description of model order reduction below we use h x to represent the model output without considering the model resolution in this section in section 3 1 h x is a vector representing output in one model simulation for all observation locations and time steps to better explain the mor applied to model output of time patterns we rewrite the vector h x into a two dimensional array h n t n s x h 1 x h 2 x h n s x r n t n s to distinguish the time and space fields h i x is the vector of model output for all time steps at the i th observation location now we want to find a projection matrix k r n t n t from r n t to a smaller subspace which minimizes the error 5 h n t n s x k h n t n s x 2 2 σ i 1 n s h i x k h i x 2 where an optimal orthonormal projection matrix k is given by 6 k u n p u n p t u n p u 1 u 2 u n p r n t n p is an orthogonal matrix containing the n p eigenvectors of the correlation matrix h n t n s h n t n s t corresponding to the n p largest eigenvalues starting from the largest eigenvalue corresponding to u 1 in decreasing order the pod modes are the optimal ordered orthogonal matrix of basis vectors u n p in the least square sense the truncated singular values decomposition svd is applied to derive the pod modes it is the factorization of the matrix that generalizes the eigen decomposition via an extension of the polar decomposition 7 h n t n s x u σ v t where u u 1 u 2 u n t r n t n t and v v 1 v 2 v n s r n s n s are the orthogonal matrices σ r n t n s is a diagonal matrix with rank r and diagonal values σ 1 σ 2 σ r are the singular values of h n t n s therefore a new matrix h ˆ n p n s can be defined by projecting the model output onto a smaller subspace using the truncated orthogonal matrices u n p it is 8 h ˆ n p n s x u n p t h n t n s x r n p n s we define the truncated orthogonal matrices u n p r n t n p by keeping the first n p columns of the matrix u which correspond to the n p modes with the highest energy of the dynamic system in general h ˆ n p n s x has a much smaller dimension compared to the model output h n t n s x while retains the most important features after the time pod application the two dimensional matrix h ˆ n p n s x is reshaped into the vector h ˆ x with a dimension of o n p n s 9 h ˆ x u n p t h 1 x u n p t h 2 x u n p t h n s x h ˆ x is defined as the reduced model output vector used for the parameter estimation process 3 2 2 observation term conversion in section 3 2 1 the order of model output has been reduced to a corresponding model h ˆ n p n s x with a set of data identified on time patterns instead of the real time series to match the model output matrix formula we denote a two dimensional array y n t n s y 1 y 2 y n s r n t n s as the observation term that y i is a vector containing time series in i th location we have 10 y ˆ n p n s u n p t y n t n s the truncated basis matrix u n p used here is from the initial model since both the model and observations have a strong resemblance to the tidal constituents in time patterns the projection and reconstruction accuracy is further analyzed in section 5 1 1 the reduced observation vector y ˆ is 11 y ˆ u n p t y 1 u n p t y 2 u n p t y n s the observation error term has to be identified corresponding to the reduced observation term we define the statistic of observation error at i th location over all time steps as follows 12 r i e y i e y i y i e y i t where e y i y t i is a vector of the truth at all discrete times at location i the pod based observation error covariance r ˆ i is r ˆ i e y ˆ i y ˆ t i y ˆ i y ˆ t i t e u n p t y i u n p t y t i u n p t y i u n p t y t i t 13 u n p t r i u n p in this application we assume observation error is time invariant the covariance matrix r j is a diagonal matrix with σ 2 as diagonal values σ is the observation uncertainty and we set its value as 0 05 m in this application so r j σ 2 i n t therefore after the model order reduction the new observation error covariance for location i is r ˆ j σ 2 i n p r ˆ is the diagonal matrix including observation error covariance at all observation locations we rewrite the cost function with the order reduced model output and observation terms as follows 14 j o x 1 2 y ˆ h ˆ f x b k h ˆ c x b k h ˆ c x t r ˆ 1 y ˆ h ˆ f x b k h ˆ c x b k h ˆ c x 4 experiment configuration in this section we describe the experiment configuration including the parameter selection model setup observations and the setup of three experiments 4 1 parameters with uncertainties bathymetry is known as the parameter with the largest uncertainties for gtsm especially in deep oceans compared to bottom friction and internal tides drag coefficient wang et al 2021 constrained by limited observations computational sources and storage memory it is very hard to accurately estimate the bathymetry in over o 1 0 6 grid cells to reduce the parameter dimension we partitioned the global ocean into 110 subdomains based on the study of tide propagation length and bathymetry sensitivity test results wang et al 2021 a specified correction factor with uniform values is defined for each subdomain the equation for adjusting the bathymetry in the subdomain s i i 1 n is 15 d j 1 x i d j f o r j s i where d j is the bathymetry of the j th grid in the subdomain s i and x i is the i th element of the parameter vector x the initial guess for each parameter element is zero in this study the parameter x comprises the bathymetry correction factors in the 110 subdomains for instance if x 1 0 05 the bathymetry in region s 1 will be increased by 5 by assuming a constant adjusting correction factor in each subdomain the parameter dimension is reduced to an acceptable size parameter uncertainties are defined as 5 to ensure a realistic bathymetry estimation we impose three constraints for the experiments firstly using the background term 1 2 x x b t b 1 x x b t in the cost function as the weak constraint to prevent the adjusted parameter departs far away from the original values while only improving the estimate a little secondly a two degree transition area is applied between neighboring subdomains to avoid the correction factor jumps between different subdomains values for each grid cell in the transition areas are automatically interpolated by the model leading to smoother correction factors around the partition boundary thirdly a hard constraint of 10 is set for all parameters to ensure the changes are kept between 10 and 10 4 2 model set up in this study gtsm calibration is only based on the tide representation for two reasons firstly it is not easy to obtain globally distributed surge observations and the fes2014 dataset we used only provides tidal components secondly surge is more sensitive to the wind and air pressure but less to the bathymetry wang et al 2021 demonstrated it by comparing the surge simulation after the bathymetry estimation to the initial model with the uhslc dataset after the estimation the water level forecast is improved from the higher tide forecast accuracy and the changes of surge simulation are not significant thus we use the tide representation of gtsm for bathymetry estimation gtsm is forced by the tidal potential with the doodson number ranging from 57 565 to 375 575 we set the minimum threshold for the tidal spherical harmonic amplitude to 0 03 m leading to a set of 58 tidal generating frequencies long term tide components sa and ssa are removed from the tidal frequencies because they are still affected by non gravitational influences estimation accuracy is strongly related to the simulation time length used in the estimation procedure in principle it has to be long enough such as a month or even a year to capture the essential tide frequencies however available computer memory cannot store the large amount of model output from many simulations with long simulation time lengths in the iterative optimization algorithm a previous experiment selects one spring neap cycle 14 days which fits into the memory of 32 gb on our cluster however experiment results showed the problem of over fitting due to the insufficient simulation time length wang et al 2021 in the current experiments we use a simulation time of two weeks between 1 to 14 january 2014 to compare the estimation performance with and without the time pod model reduction after that the final model estimation covers the simulation of two spring neap cycles 1 month with time pod and outer loop application therefore the simulation starts from 1 to 31 january 2014 with a two week spin up before january 1 the time interval is set as 10 min which results in 4465 time steps 4 3 observation network for calibration and validation our parameter estimation uses the tide series derived from the fes2014 dataset in the deep ocean tide gauge data from the university of hawaii sea level centre uhslc is applied for the model validation caldwell et al 2015 the fes2014 dataset comes from the fes finite element solution tide model consisting of about 2 9 million nodes carrere et al 2013 long altimeter time series tide gauges improved modeling and data assimilation techniques have provided an accurate solution for fes2014 fes2014 performs better than gtsm when comparing with deep ocean bottom pressure recorder data wang et al 2021 stammer et al 2014 and fes2014 has an advantage in deep ocean calibration because of its ease of obtaining arbitrary time series and locations globally therefore the fes2014 dataset is selected as the observations for model calibration 1973 time series with 32 tide constituents excluding long term constituents sa and ssa are derived from the fes2014 dataset for the model calibration these 1973 locations are almost evenly distributed in the ocean the uhslc dataset is a collection of approximately 500 distributed tide gauge time series covering different years across the globe the specific amount of available data varies over the years two levels of quality control fast delivery fd and research quality data rqd are provided in the uhslc dataset tide gauges are somewhat irregularly distributed and most of them are in the coastal regions which leads the data more suitable for model validation than global model calibration we retrieved the 283 tide gauge series from the hourly rqd in the year 2014 after the tide analysis with tidal analysis software tidegui and visual inspection of the tide and surge representations against the measured series in the tide analysis procedure tide representations with a set of 93 components from 230 tide gauge stations are finally used for the model validation it is worth noting that long term tidal constituents sa and ssa are removed from fes2014 and uhslc tide representations to ensure the consistency between observations and model output also even though some tide gauge data are assimilated in the fes2014 dataset it is still reasonable to assume that fes is independent of uhslc data on the one hand most of the tide gauges are in the coastal regions while the 1973 time series we derived are for the deep ocean on the other hand uhslc data in this application is used to evaluate the estimated model performance in the coastal regions 4 4 experiments set up three experiments are set up to investigate the performance of the time pod parameter estimation scheme for gtsm as table 2 shows ex1 is the experiment with a short simulation time of two weeks without pod implementation and the outer loop it is very similar to the experiment in approach 2 of wang et al 2021 the memory needed for the total model output in this scheme to estimate 110 parameters is approximately 3 5 gb ex2 has the same settings as ex1 but with the implementation of pod it aims to evaluate the influence on the accuracy by applying pod the memory use is significantly reduced when compared to ex1 finally the experiment denoted as ex3 follows the parameter estimation scheme in fig 1 covering a 1 month simulation time length from 1 to 31 january 2014 without mor the data size of h c x 0 h c x 1 h c x n and observation was about 7 35 gb and the total memory use was more than 20 gb for this experiment with the proposed pod approach the memory use is sharply reduced to 4 5 after the pod application 5 numerical experiments and results to assess the performance of pod we first evaluate the projection and reconstruction accuracy of the model output and observations followed by a comparison of results between ex1 and ex2 at last the estimation results in ex3 are analyzed 5 1 pod performance analysis 5 1 1 reconstruction accuracy the accuracy of parameter estimation with mor depends on the reconstruction accuracy of the model output and observations the reconstructed model output and observation terms are in the formula of u n p u n p t h n s n t x the term k h n s n t x in eqs 5 and u n p u n p t y the basis matrix u n p is obtained by truncated svd from the initial model output or observations fig 2 shows the root mean square error rmse between the original and the reconstructed model output observation with different number of modes time series is from 1 to 31 january 2014 in general the rmse is decreased with the increase of the truncation size basis matrix from observation fig 2c shows slower downtrends than others fig 2a b one possible reason is the model has more tidal components that are not included in the observations there are 32 tidal constituents in observations while 58 tide potential frequencies are in the model but that will not affect the estimation results because the rmse for reconstructed model and observations without truncation is less than 5 1 0 4 m it means the missing components in observation would lead to at most 5 1 0 4 m water level changes while the observation error we defined is 0 05 m which is 100 times larger fig 2a shows the excellent accuracy of the reconstructed coarse model the reconstructed fine model and observations have similar performance when the truncation size varies fig 2b is opposite to fig 2a for the coarse model we use the basis matrix from the coarse model with 200 modes for the calibration process because most of the model simulation in the estimation iteration is on the coarse grid reducing the coarse model output with 200 modes sharply reduces the data size while the high accuracy for the coarse model with rmse of 2 64 1 0 4 m is attained and the reconstructed observation error is also smaller than the observation uncertainty tidal analysis can also be used to reduce the data size but in comparison the time pattern projection has two advantages firstly tidal analysis requires the selection of a set of tidal constituents these constituents should respect the rayleigh criterion the projection method has only one parameter to which is quite insensitive for example time series of reconstructed model output and observations for modes 1 to 3 fig 3a c in an observation location provide similar waves to the harmonic implying the patterns in the projection method work similarly as the tide analysis does but without the restriction to separating the independent tide components secondly the projection method gives almost identical results to the time series approach the reconstructed fine grid model output with projection on the first three modes fig 3d is close to the original data when more modes 200 modes we selected are included the reconstruction error would become very small we also performed a tidal analysis for the time series from the model output for this location and after projection onto modes 1 3 as shown in table 3 the projection on modes 1 and 2 mainly shows large amplitudes for the semi diurnal tides n2 m2 s2 k2 the contributions from n2 and m2 add up to a large part of the n2 m2 signal while this is a bit less for s2 and k2 mode 3 mainly shows diurnal constituents where the p1 and k1 amplitudes are close to the values for the full signal the time projection thus shows some resemblance to tidal analysis 5 1 2 experiments with time pod application fig 4 shows the cost function fig 4a and optimized bathymetry correction factors of ex1 fig 4b and ex2 fig 4c ex2 estimation with time pod shows a similar behavior of the cost function in each iteration as ex1 and nearly the same correction factors the rmse for both experiments decreases from 5 23 cm to 3 49 cm in the calibration period while the required memory in ex2 is reduced by a factor of 10 fig 5 illustrates the difference of rmse at different observation locations between the initial model and the estimated model in ex2 i e rmse between the initial model and observations rmse between the estimated model and observations it reports nearly the same improvement after the estimation as in ex1 not shown here therefore model order reduction is an efficient approach to reduce memory requirements for parameter estimation without causing any loss of estimation accuracy the purpose of parameter estimation is to improve the gtsm long term forecast accuracy however the interaction of tidal constituents varies during different periods for example the rmse between estimated model output and observations is 3 49 cm from 1 to 14 january while the rsme in the forecast increases to 4 33 cm for the period from 15 to 31 january 2014 a short simulation time length would lead to over fit the data in the estimation period wang et al 2021 after assessing model order reduction performance we selected a longer simulation time of 1 month and experimented in section 5 2 5 2 parameter estimation results analysis ex3 covers a simulation time length of 1 month for gtsm to estimate bathymetry fig 6a illustrates the changes in the cost function in each simulation in the three outer loop iterations in every outer loop the cost functions of the first 111 runs include one initial simulation and 110 independent simulations each corresponding to perturbing one of the 110 parameters parameters are iteratively updated after the first 111 simulations the simulation experiment was run using 200 cores for about 12 days with a total of approximately 57600 h cpu times in the first outer loop color red in fig 6a the cost function has a sharp reduction from 7 21 1 0 6 to 3 17 1 0 6 and then slowly reduced to 3 00 1 0 6 at the end of the second outer loop color blue compared with the first outer loop the cost function in the second outer loop only reduces slightly it looks that the estimation results are converged to a certain value in the third out loop the difference of cost functions in each simulation is very slight making the dud process difficult to continue leading to a stop after several iterations with a value of 2 95 1 0 6 it is in the same magnitude as that in the second outer loop gtsm parameter estimation is converged in the third outer loop iteration moreover sensitivity for each parameter can be observed from the variability of the cost function for the initial 111 perturbation runs in each outer loop this is strongly decreased in the third outer loop indicating that the estimated parameters are close to the minimum the final relative change to the bathymetry which is the correction factor x in eqs 15 is shown in fig 6b the value varies between 0 1 to 0 1 within the range of hard constraints estimation performance is analyzed by comparing the model output with the fes2014 dataset for the comparison of the model performance in ex3 and ex1 rmse of two time periods is summarized in table 4 rmse is used to represent the difference between model output and observations to access model performance the bias difference between model and observations is negligible not shown here as expected gtsm with the fine grid has better performance than that with the coarse grid comparing the coarse grid gtsm ex3 works better than ex1 in all outer loops and time periods in the fine grid gtsm ex1 performs slightly better than ex3 in the period 1 to 14 january but worse in 15 to 31 january 2014 this can be explained that ex1 estimates with a two week simulation time 1 to 14 january 2014 resulting in an over fitting of data in the calibration period the rmse is reduced from 5 23 cm to 3 49 cm in the period 1 to 14 january while the reduction in the period 15 to 31 january is clearly less from 5 84 cm to 4 33 cm in the 15 to 31 january with a longer simulation time length of 1 month in ex3 the rmse of the estimated fine model in these two periods is close to each other namely 3 62 cm and 3 66 cm implying the overfitting is reduced the spatial distribution of rmse for the fine gtsm in january is shown in fig 7 fig 7a is the rmse between the estimated fine grid model output in ex3 and fes2014 observations the differences of rmse between the model before and after the estimation are shown in fig 7b it can be observed that the estimated model has been significantly improved in most regions a few areas that are not improved or a bit worse than the initial model see the areas with yellow colors negative values of rmse difference in fig 7b possibly not only bathymetry but also other effects such as the lack of resolution play a role here the regions getting worse only takes up a small part of the ocean in addition estimation by ex3 outperforms ex1 in most ocean sea as fig 7c shows generally the estimated model significantly overperforms the initial model in summary the calibrated model in ex3 is in better agreement with the measurements than ex1 model order reduction reduces the memory requirement by a factor of 22 while keeping a better estimation accuracy long simulation time is beneficial for parameter estimation in gtsm and the implementation of the outer loop further improves the tide forecast accuracy 6 model validation to validate the model performance more independently from the simulation period and data we used in the estimation procedure we analyzed the tide components from gtsm and compared them against the fes2014 dataset in the frequency domain the tide forecast of gtsm for the whole year of 2014 is also compared with observations from the fes2014 and uhslc datasets 6 1 tide analysis comparison against fes2014 dataset for 2014 model performance is evaluated in the frequency domain tide forecast from gtsm in the year 2014 for 1973 observation locations is analyzed with tidegui software we use the root mean square rms to assess the difference between model output and observations for major tide components with the formula 16 r m s a m c o s ω t ϕ m a o c o s ω t ϕ o 2 the terms a m and a o are the amplitudes from model output and observations respectively ϕ m ϕ o are terms of phases lag ω is the tide frequency the overbar shows the computation over one full cycle of the constituent ω t varying from 0 to 2 π in all locations detailed results for 8 major tide components are summarized in table 5 root sum square rss for these 8 constituents is also analyzed it can be observed that rss and rms for all 8 major components are reduced after the estimation in ex1 and three outer loop iterations of ex3 when comparing with the initial model after the estimation m2 is the component that significantly improved in ex3 reduced from 4 50 cm to 1 89 cm whereas it is 2 54 cm in ex1 the other 7 components in ex3 are nearly the same or slightly better than that in ex1 the rss over these eight components in ex3 is sharply reduced from 6 05 cm to 3 52 cm the differences in the amplitude and phase between the model output and fes2014 dataset for m2 component are shown in fig 8 the difference in amplitudes and phases compared to fes2014 dataset is much smaller for the estimated models in ex1 and ex3 than for the initial model ex3 has a better agreement with fes2014 dataset than ex1 especially in the phase domain fig 8e f consequently ex3 has a smaller rms than ex1 initial gtsm performs better in deep ocean comparing with deep ocean bottom pressure recorder bpr observation than most of the purely hydrodynamic models described in table 3 of stammer et al 2014 but not as accurate as the assimilative tide models wang et al 2021 in this study gtsm is significantly improved after our parameter estimation to bathymetry in the deep ocean it overperforms the purely hydrodynamic models especially in the m2 constituent but still not better than the assimilative tide models this result is expected because firstly observation locations are limited in the estimation process and secondly not only bathymetry but other effects such as resolutions other parameters like bottom friction would also affect the model performance however compared to other tide models gtsm after parameter estimation has the advantage to access the effect of sea level rise and climate changes because it can include surge simulation when meteorological forcing wind and air pressure additions are added therefore the high accuracy tide representations also benefit the complete water level forecast 6 2 monthly comparison against fes2014 time series for 2014 gtsm is also validated through long term tide forecasts showing the model performance in different time periods model forecast in the whole year of 2014 is firstly analyzed with the fes2014 dataset fig 9 shows the regional rmse of the fine gtsm after the estimation in ex1 and ex3 for each month of year 2014 the regional rmse between gtsm with the fine grid and fes2014 dataset is shown in fig 9a g the global average of rmse in 1973 locations is shown in fig 9h compared to the initial model the rmse for all the regions is significantly reduced in ex1 and ex3 rmse in ex1 is larger than that in ex3 in the year 2014 except for some months in the indian ocean forecast results also report that estimation with a longer simulation length works better than that with a short time window when comparing the rmse in ex1 and the first outer loop of ex3 as the number of outer loop iterations increases the model performs better throughout 2014 the 1 year forecast comparison with the fes2014 dataset demonstrates the estimated model can be used for the high accuracy long term forecast one can also observe a seasonal pattern in the rmse in fig 9 both before and after the calibration a possible reason is that tide constituents interact differently for different periods leading to a large or small difference between the data and the model for each month after calibration this seasonal pattern is smaller in ex3 than ex1 indicating long simulation time length can weaken it and result in a better agreement to model and observations however it remains challenging to verify whether using a more extended time period such as one year can further improve the model accuracy and eliminate over fitting due to the excessive computational demand but we see no clear signals of over fitting problem in ex3 and the 1 month calibration provides sufficient calibration accuracy 6 3 monthly comparison against uhslc time series for 2014 in the following the performance of gtsm is assessed using a dataset that is not used in the estimation stage model performance in the coastal areas is evaluated by comparing with the uhslc dataset in 2014 fig 10 shows the monthly averaged rmse in 2014 between model output and the uhslc measurement the rmse before the estimation is approximately 12 5 14 cm in each month and it is reduced to about 10 11 5 cm after the estimation in both ex1 and ex3 it indicates the bathymetry estimation for the deep ocean can improve the accuracy in the nearshore as expected the results in ex3 are better than in ex1 the difference between the three outer loops is not significant but the second outer loop is slightly better than the third outer loop it can also be observed from the mean rmse of the whole year of 2014 fig 10 the second loop has a value of 10 84 cm smaller than the third outer loop with 10 94 cm one possible reason is the bathymetry estimation mainly works on the deep ocean after three outer loop iterations the parameter estimation overfits a bit the deep water observation used in the calibration process also some other effects such as bottom friction play a role in shallow waters but they are left out of consideration in this study future works can continue on the parameter estimation for shallow waters fig 11 shows the spatial distribution of rmse between the initial fine model and uhslc dataset in the year of 2014 fig 11a and the rmse difference between the model before and after estimation in ex3 fig 11b results in ex1 reported similar distribution as ex3 but with a slightly higher rmse not shown here most of the tide gauges are located in coastal areas with larger rmse than deep oceans after the global calibration model performance near the coast is improved even though the calibration mainly focuses on the deep water to further have a closer look at the tide representation in one location the time series of station wellington harbor in new zealand is used as an example fig 12a shows the tide representation from the uhslc dataset the model output of the initial ex1 and ex3 the difference between model output and observation is depicted in fig 12b the rmse for the initial model is 15 25 cm and after the estimation in ex1 it is decreased by approximately 44 2 to 8 51 cm ex3 with the rmse reduction of approximately 59 21 is marginally better than in ex1 the model validation for the whole year of 2014 shows excellent agreement with the fes2014 and uhslc datasets in frequency and time domains after applying the memory efficient estimation it illustrates that gtsm with the adjusted bathymetry can provide high accuracy long term tide forecast 7 summary and conclusion this study presented a memory efficient parameter estimation approach for the high resolution global tide model over a long time length to resolve the memory constraint of the long period model simulation time pod model order reduction is developed to project the model output time patterns onto a smaller subspace to further improve the model estimation accuracy with affordable computational cost we implemented inner outer loop iterations similar to incremental 4d var using an iterative parameter estimation algorithm called dud in the inner loop with the lower resolution model simulation the outer loop uses optimized parameters from the previous inner dud process as a new reference run with the initial high resolution model this parameter estimation scheme is implemented for the global tide and surge model gtsm to correct bathymetry and substantially improve the model performance our previous investigation showed that the accuracy of the calibrated model would probably benefit from a calibration period longer than the two weeks one spring neap cycle used there but the huge memory required was limiting an extension in practice wang et al 2021 here we use time pod model order reduction to project the gtsm output onto a limited number of time patterns this projection reduces the memory usage by more than an order of magnitude in our experiments while our experiments for gtsm show that parameter estimation with mor achieves the same model accuracy as without mor this approach has the advantage of keeping the reduced model output size small when extending the simulation time length finally a parameter estimation experiment for gtsm with the implementation of mor and inner outer loop iterations is performed it covers a simulation time of 1 month while memory demand is reduced by a factor of 22 due to model order reduction for time fields experiment results show that the ocean tide is better represented in the calibration period the cost function is converged within three outer loop iterations in this study model validation from the frequency domains illustrates the m2 component is significantly better estimated with the set up of 1 month simulation length and the outer loop implementation model tide forecast in the whole year of 2014 is compared with the fes2014 and uhslc datasets it demonstrates that a long simulation period in the estimation procedure improves the performance for long term tide forecasting the outer loop iterations contribute to further improvement of the model forecast but can lead to a bit of overfitting to the data in the third outer loop in summary parameter estimation leads to significant performance improvements for gtsm the memory requirements are significantly reduced which allowed us to extend the time span used for calibration this resulted in a more accurate reproduction of tides in gtsm bathymetry calibration contributes more to the deep ocean but also benefits a bit for shallow waters moreover the time pod parameter estimation is a general technique that can be widely used in many global or regional numerical models to estimate different parameters compared to harmonic analysis method model simulation time length in time pod estimation is not limited by the rayleigh criterion we have presented a case study of bathymetry estimation in a global tide and surge model even when only tide is simulated in the gtsm the efficient estimation also benefits the complete water level forecasts including the tide and surge in addition this parameter estimation scheme can also be used to calibrate different parameters simultaneously e g bathymetry internal tide friction and bottom friction combined in particular to estimate the bottom friction in shallow water with more tide gauge data credit authorship contribution statement xiaohui wang conceptualization methodology software writing original draft martin verlaan conceptualization writing review editing supervision maialen irazoqui apecechea software hai xiang lin writing review editing supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the first author wishes to thank the china scholarship council for providing financial support in terms of a scholarship grant this work was carried out on the dutch national e infrastructure with the support of surf the fes2014 dataset was acquired from https www aviso altimetry fr research quality data of uhslc is made available at the university of hawaii sea level centre with the link ftp ftp soest hawaii edu uhslc rqds bathymetry data is available from https www gebco net data and products gridded bathymetry data gebco 2019 and https emodnet ec europa eu en bathymetry emodnet 
23848,accurate parameter estimation for the global tide and surge model gtsm benefits from observations with long time series however increasing the number of measurements leads to a large computation demand and increased memory requirements especially for the ensemble based methods that assimilate the measurements at one batch in this study a memory efficient parameter estimation scheme using model order reduction in time patterns is developed for a high resolution global tide model we propose using projection onto empirical time patterns to reduce the model output time series to a much smaller linear subspace then to further improve the estimation accuracy we introduce an outer loop similar to incremental 4d var to evaluate model increments at a lower resolution and subsequently reduce the computational cost the inner loop optimizes parameters using the lower resolution model and an iterative least squares estimation algorithm called dud the outer loop updates the initial output from the high resolution model with updated parameters from the converged inner loop and then restarts the inner loop we performed experiments to adjust the bathymetry with observations from the fes2014 dataset results show that the time patterns of the tide series can be successfully projected to a lower dimensional subspace and memory requirements are reduced by a factor of 22 for our experiments the estimation is converged after three outer iterations in our experiment and tide representation is significantly improved achieving a 34 5 reduction of error the model s improvement is not only shown for the calibration dataset but also for several validation datasets consisting of one year of time series from fes2014 and uhslc tide gauges keywords global tide and surge model parameter estimation model order reduction 1 introduction the risk from coastal flooding generally increases due to the sea level rise and climate changes jongman et al 2012 muis et al 2017 the sea level can reach especially high values where tidal amplitudes are large it is even more destructive especially when the storm surge coincides with the high water during spring tide pugh 1996 hydrodynamic tide and storm surge models play an important role in assessments of flood risk and sea level rise and for forecasting extreme sea levels are often a combination of high tides and a storm surge the accuracy of the reproduction of both tides and storm surge is important for these applications ward et al 2015 in deep water tides and storm surge can be modeled independently but in shallow water non linear interactions are more prominent with the future aim to model these interactions we develop a combined global tide and surge model gtsm however this paper focuses on the tides and considers tides separately stammer et al 2014 summarized the developments in global tide modeling and compared a number of global tide models regarding their physical processes grid resolution and so on there are still a number of sources of model errors remaining such as neglected physics in the model formulation uncertainty parameters e g bathymetry bottom friction and internal tides friction that are not accurately known data assimilation is a promising approach for reducing parameter uncertainties with available observation data e g altimeter and tide gauge measurements several successful applications of data assimilation for improving tide model performance have been reported in literatures edwards et al 2015 with the adjoint methods das and lardner 1991 bannister 2017 heemink et al 2002 zaron 2019 and ensemble methods barth et al 2010 mayo et al 2014 ngodock et al 2016 zijl et al 2013 in a comparison of several assimilative and non assimilative models stammer et al 2014 reported that data assimilation can contribute significantly to the accuracy of global tide models in our previous study we proposed a computation efficient parameter estimation scheme to estimate bathymetry for a high resolution global tide and surge model gtsm wang et al 2021 gtsm is a 2d tide and surge model with an unstructured grid the model is running operationally to forecast storm surges worldwide another application of gtsm is the assessment of flood risks and the potential impacts of sea level rise to extreme storm tides verlaan et al 2015 in wang et al 2021 after the parameter estimation tide representation in gtsm was improved significantly using an ensemble type algorithm without the adjoint called dud ralston and jennrich 1978 dud does not use derivative is a derivative free calibration algorithm that works in an iterative way in the estimation procedure observation is compared with the model output in the time series formula tidal constituents are widely used as model output in estimation applications such as the estimation of the fes model lyard et al 2021 but tidal constituents cannot be directly computed in gtsm because gtsm is a time stepping model the time stepping model allows a more accurate representation of non linear interactions at the coast which is also recognized by lyard et al 2021 to obtain accurate tidal analysis results we have to simulate the gtsm for a year based on the rayleigh criterion to separate diurnal constituent s1 from k1 if one would include seasonal constituents sa and ssa several years would be required since they show large inter annual variability harmonic analysis needs a careful consideration of which tidal constituents to be included when the length of the time series is not an integer multiple of the period given by the frequency difference of two constituents or a large non integer value then the estimation is potentially poorly conditioned and the estimates will influence each other in contrast the proposed time series pod method will produce accurate orthogonal approximations without any user intervention and regardless of the length of the time series in addition hundreds of model runs would be simulated in the estimation process therefore parameter estimation in tidal constituents is not feasible with the computational facilities available to us the use of time series for weeks or a month can significantly reduce the simulation time and computational complexity but the simulation time length of two weeks one spring neap cycle is short and leads to estimates that over fit the data to some extent wang et al 2021 however longer time series imply larger memory requirements in the analysis step which is not feasible for the current implementation and computational cluster therefore an efficient approach has to designed which can reduce the memory requirement and enable a longer simulation time length for ensemble based data assimilation methods evensen 1994 the memory use is proportional to the number of measurements assimilated in one batch multiplied by the number of perturbed model runs called ensemble members this also applies to the method used in this paper observations are often assimilated in one batch to maintain consistency between the estimated parameters and model output after the estimation evensen and van leeuwen 2000 emerick and reynolds 2013 which cannot be guaranteed for incremental assimilation in smaller batches however this leads to a large size of the linearized model outputs o n n t n s where n n t n s are the number of ensembles number of observation time steps and number of locations respectively when we attempt to include more observations and to estimate more parameters this can result in a huge memory usage on a single compute node there are at least two ways to ease the huge memory usage problem 1 parallelization of the linear solver and 2 reducing the size of the problem by approximation here we follow the second approach by using model order reduction methods note that variational methods have different characteristics in terms of memory usage model order reduction mor is a collection of methods that can be used to reduce the computational complexity of mathematical models in numerical simulations with an approximation of the original model antoulas et al 2015 in this paper we develop a new method time pod which aims to reduce the size of the model output so that the memory needed for data assimilation can be reduced the method was inspired by the proper orthogonal decomposition pod chatterjee 2000 which projects the spatial patterns of the state onto the leading singular vectors here we project onto the leading singular vectors of the time patterns instead pod is one of the mor techniques first introduced in fluid dynamics by lumley 1967 it was already known as the karhunen loève expansion kosambi 1943 in statistics and also as principal component analysis pca jolliffe and cadima 2016 or empirical orthogonal functions eof monahan et al 2009 in meteorology pod methods liang et al 2002 such as the karhunen loève decomposition kld pca and singular value decomposition svd have been applied in various fields such as fluid dynamics cazemier et al 1998 pattern recognition kopp et al 1997 and more recently in control theory and inverse problems mor has been applied in both ensemble based and variational data assimilation systems cane et al 1996 farrell and ioannou 2001 beck and ehrendorfer 2005 cao et al 2007 the typical application of mor is projected based on truncated characteristic vectors in spatial patterns of model state variables for instance a dual weighted proper orthogonal decomposition dwpod is proposed combining with four dimensional variational method 4dvar to reduce state space orders in a global shallow water model daescu and navon 2008 lin and mclaughlin 2014 reduced the parameter dimension by pod for an enkf data assimilation system in this study we proposed two new developments based on our previous estimation scheme wang et al 2021 firstly a low memory storage estimation approach is implemented using the model order reduction techniques in the time patterns secondly the implementation of outer iteration improves the estimation accuracy the reason is to better deal with the optimization of non linear models dud is an iterative smoother type estimation algorithm the memory needed is linearly increased with the simulation time length the total data size is in the order of o 1 0 9 when the time length is larger than one month in this application which leads to memory issues therefore we developed a time pod approach to reduce the dimension of the model output by projecting the time space of the model output onto a smaller subspace the main advantage of the time pod is that the simulation required is not restricted by the rayleigh criterion which normally requires a year s simulation for accurate estimation of tidal constituents the projection reduces the memory requirements while still accurately representing the time signal for any simulation length the required length of the time span considered then becomes limited by other considerations in our previous experiments a length of two weeks leads to some over fitting for that time period wang et al 2021 in this study we performed the time pod calibration experiments covering the one month simulation time span it provides significant improvements to the model accuracy and reduce the over fitting of data used in the estimation process furthermore parameter estimation accuracy is also affected by the calibration algorithm the approach of using a lower resolution model in the estimation is similar to incremental 4dvar and an outer loop iteration can further improve the estimation accuracy by updating the reference using a new fine resolution simulation with the updated parameters emerick and reynolds 2013 chen and oliver 2013 the incremental 4d var method consists of nested inner loops and outer loops to reduce computational cost for data assimilation it is applied successfully in the assimilation system at the ecmwf courtier et al 1994 mahfouf and rabier 2000 trémolet 2007 in this study we use a very similar structure coarse incremental estimation wang et al 2021 uses a coarser grid to represent the model increments between the initial model and model with updated parameters the outer loop uses the high resolution model with the updated parameters from the converged inner loop to restart the estimation process it is expected that this will result in a better match between the observations and the fine grid model in section 2 the global tide and surge model gtsm is introduced section 3 describes the parameter estimation scheme including the time pod application to temporal patterns and the outer loop implementation section 4 describes the experiment configuration including parameter selection observations model and experiments set up in section 5 pod performance is evaluated by firstly analyzing the accuracy of projected and reconstructed model output and secondly comparing the bathymetry estimation results with or without the application of mor we also perform a parameter estimation experiment with an extended simulation time of one month model validation for the year 2014 is presented in section 6 finally discussions and conclusions follow in section 7 2 global tide and surge model gtsm is a depth averaged hydrodynamic model that simulates tide and surges it plays an important role in the global storm surge information system glossis to provide water level and storm surge forecasts the model is forced by tide generating forces without any lateral boundaries the governing equations of the model are 1 u t 1 h h uu u h u f u g ζ ζ e q ζ s a l ν u u t τ h h t h u 0 where h is the total water depth u represents the depth averaged horizontal velocity vector f is the coriolis force g is the gravitational acceleration ν is the horizontally eddy viscosity ζ is the water level ζ e q is the equilibrium tide ζ s a l refers to the self attraction and loading effect sal the term τ denotes parameterizations of the friction stress most of the global tide energy dissipation comes from the bottom friction and we use chézy quadratic formulation with the coefficient of 77 m 1 2 s 1 in the model furthermore internal tide friction is parameterized because there is approximately 1 tw energy dissipation about 25 30 of the total occurring in the deep ocean through internal wave drag maraldi et al 2011 gtsm can also model surge using additional wind and air pressure conditions as the model forcing pugh and woodworth 2014 we combined different datasets for the bathymetry emodnet bathymetry with a resolution of about 250 m is implemented as the input of bathymetry in europe general bathymetric chart of the ocean dataset gebco 2019 with 15 arc second resolution is used at the rest of the globe however there is still a large uncertainty in bathymetry even though bathymetry can be measured directly large areas of the oceans are unsurveyed and only estimated by satellite altimetry with a much lower effective resolution of 8 9 km weatherall et al 2015 tozer et al 2019 an essential characteristic of delft3d fm is unstructured grids kernkamp et al 2011 the scale of tidal components is usually more prominent in the nearshore than in the deep ocean high resolution is required in the coastal region to provide highly accurate modeling pringle et al 2021 also reported that the mesh refinement in shallow waters where the coast and at steep topography is important for the global accuracy of the simulated astronomical tide here we use gtsm with two different resolutions gtsm with the coarse grid and gtsm with the fine grid hereinafter table 1 reports the computation time of the coarse and fine resolution models as expected gtsm with the fine grid has a longer computational time but more accurate tide forecasts however many fine model simulations needed in the parameter estimation procedure would require weeks or even months of computational time which is unbearable 3 parameter estimation with model order reduction 3 1 parameter estimation framework we design an efficient and low memory usage parameter estimation scheme with model order reduction for the high resolution tide models to reduce parameter uncertainties and improve forecast accuracy the flowchart of this parameter estimation scheme is shown in fig 1 the basic estimation algorithm applied here is called dud does not use derivatives in a generic data assimilation toolbox openda ralston and jennrich 1978 karri et al 2013 it optimizes the parameters by iteratively minimizing the following cost function 2 j x 1 2 x x b t b 1 x x b 1 2 y h x t r 1 y h x where y is the field observation vector including all time steps in t t 1 t n t and all stations 1 n s x is the vector of parameters to be estimated with the dimension of n h x is the model output vector matching observation locations for all time steps x b is the initial parameter vector b and r are the background and observation error covariances respectively the dimension of observation y and model output h x in all space points and time steps is as o n s n t the first term on the right hand of the cost function eqs 2 is the background term j b constraining the changes to the initial parameters the second term is the observation term j o representing the difference between model output and observations for the brief introduction of the dud algorithm and parameter estimation scheme we only describe the observation term of the cost function in the following sections fig 1 shows the flowchart of the parameter estimation scheme connecting the components dud time pod and outer loop dud is implemented in the inner loop combining with the coarse to fine strategy and time pod application dud is a gauss newton similar algorithm but derivative free it started from the model simulation of first guesses for the parameters x 0 x b and n simulations with each parameter perturbed as x 1 x b δ e 1 x 2 x b δ e 2 x n x b δ e n parameter is updated for an approximate linear model that fits exactly through the model output for x 0 x 1 x n dud iteratively finds the parameters that minimize the sum of squares between model output and observations we propose to improve estimation performance while reducing the computational cost and memory requirement based on the original dud algorithm they are several methods developed the coarse to fine strategy model order reduction in time patterns and introduction of outer loop iterations in our previous study wang et al 2021 a coarse to fine strategy called coarse incremental calibration is proposed to reduce the computational cost it is also applied here using a coarser grid model to replace the increments between the output from the initial model and the model with modified parameters terms h f x and h c x are defined as the model output with the fine and coarse grid respectively h f x can be approximated with h f x b h c x h c x b thus the cost function is represented as 3 j o x 1 2 y h f x b h c x b h c x t r 1 y h f x b h c x b h c x therefore gtsm with the fine grid is only simulated to generate the initial model output h f x b other simulations in the inner iterations use gtsm with the coarse grid instead which reduces the computing time to approximately 36 of the original in this research we consider reducing the dimension of the model output by mor the dimension of model output h x 0 h x 1 h x n 1 and observations y is huge which requires a huge memory especially when the model has a long simulation time length for example if the number of observations n s is o 1 0 3 and with the number of time steps n t is o 1 0 3 then the dimension of the model output h x and observations y is o 1 0 6 if we assume the parameter dimension n is in the order of o 1 0 2 the parameter dimension is the length of the vector with the parameters estimated in this paper we define spatial subdomains where a single multiplicative adjustment is applied each of these subdomains adds an element to the parameter vector thus the dimension of the model output in the analysis step is o 1 0 8 such a huge memory usage is unacceptable in practice therefore we apply pod in the time patterns for model output and observations to reduce memory usage in the estimation procedure that will be further explained in section 3 2 moreover we use the dud process in the inner loop to obtain the updated parameters at a lower resolution see fig 1 with the coarse incremental calibration approach high resolution gtsm only plays a role as the initial output h f x b in eqs 3 while instead by the coarse grid model h c x for iterative update even though our previous experiments demonstrate that coarse grid increments can well represent the fine grid increments wang et al 2021 the results after the estimation can still be significantly affected by the model with the coarse grid therefore we introduce the outer loop to take the high resolution model states into account the updated parameters obtained from the previous converged dud process are used as the new first guess to update the initial model output the cost function can be rewritten as 4 j o x 1 2 y h f x b k h c x b k h c x t r 1 y h f x b k h c x b k h c x where k is the iteration number of the outer loop x b k is set to be the optimized parameters x a k 1 from the previous dud process the estimation process terminates once the cost function has converged compared to the computation efficient parameter estimation scheme we proposed in the previous study wang et al 2021 the estimation scheme in this paper also contributes to memory reduction with the time pod algorithm and estimation accuracy improvement by the outer loop iterations the combination of these methods gives a computation efficient and memory reduced parameter estimation framework the parameter estimation process with time pod application and outer loops as shown in fig 1 can be summarized as follows 1 define first guess parameter set x 0 x 1 x n 2 analyze initial model output h f x b h c x b determine the corresponding pod reduced model output h ˆ f x b h ˆ c x b with the truncated basis matrix u n p 3 convert the original observations to corresponding observation y ˆ based on the truncated projection matrix 4 simulate the coarse grid model with the first guess parameter set generate the pod reduced model states h ˆ c x 0 h ˆ c x 1 h ˆ c x 2 h ˆ c x n and evaluate the cost function 5 find the new parameters x for an approximate linear model that fits exactly through the model output for x 0 x 1 x n 6 if the dud stop criteria are not satisfied then perform a model simulation with updated parameters x and do model order reduction for model output h ˆ c x and return to step 5 7 if model outputs with optimization results do not reach the outer loop stop criteria then return to step 1 with the optimized parameters as a new first guess for the next iteration of the dud process 8 output optimal estimation of parameters x a in the last outer loop 3 2 proper orthogonal decomposition pod in this section details of the application of pod to reduce model dimensions in time patterns are described the time pod reduced model is introduced first then we define the corresponding observation term and error covariance finally the complete parameter estimation procedure is summarized 3 2 1 time pod reduced model pod reduces the model order by identifying several modes with the most energies from a high dimension system and uses these modes as a lower dimension subspace approximation usually the discrete pod is derived with snapshots to find a smaller subspace for states in spatial patterns a snapshot is the value of the model state vector at a certain time however the vast memory requirement in our application comes from the model output h f x h c x and observation y containing the data both in space and time patterns in the order of o n s n t as the simulation time increases the dimension in time scale n t is usually much larger than that in the spatial scale n s thus reducing the order in the time patterns is crucial in the brief description of model order reduction below we use h x to represent the model output without considering the model resolution in this section in section 3 1 h x is a vector representing output in one model simulation for all observation locations and time steps to better explain the mor applied to model output of time patterns we rewrite the vector h x into a two dimensional array h n t n s x h 1 x h 2 x h n s x r n t n s to distinguish the time and space fields h i x is the vector of model output for all time steps at the i th observation location now we want to find a projection matrix k r n t n t from r n t to a smaller subspace which minimizes the error 5 h n t n s x k h n t n s x 2 2 σ i 1 n s h i x k h i x 2 where an optimal orthonormal projection matrix k is given by 6 k u n p u n p t u n p u 1 u 2 u n p r n t n p is an orthogonal matrix containing the n p eigenvectors of the correlation matrix h n t n s h n t n s t corresponding to the n p largest eigenvalues starting from the largest eigenvalue corresponding to u 1 in decreasing order the pod modes are the optimal ordered orthogonal matrix of basis vectors u n p in the least square sense the truncated singular values decomposition svd is applied to derive the pod modes it is the factorization of the matrix that generalizes the eigen decomposition via an extension of the polar decomposition 7 h n t n s x u σ v t where u u 1 u 2 u n t r n t n t and v v 1 v 2 v n s r n s n s are the orthogonal matrices σ r n t n s is a diagonal matrix with rank r and diagonal values σ 1 σ 2 σ r are the singular values of h n t n s therefore a new matrix h ˆ n p n s can be defined by projecting the model output onto a smaller subspace using the truncated orthogonal matrices u n p it is 8 h ˆ n p n s x u n p t h n t n s x r n p n s we define the truncated orthogonal matrices u n p r n t n p by keeping the first n p columns of the matrix u which correspond to the n p modes with the highest energy of the dynamic system in general h ˆ n p n s x has a much smaller dimension compared to the model output h n t n s x while retains the most important features after the time pod application the two dimensional matrix h ˆ n p n s x is reshaped into the vector h ˆ x with a dimension of o n p n s 9 h ˆ x u n p t h 1 x u n p t h 2 x u n p t h n s x h ˆ x is defined as the reduced model output vector used for the parameter estimation process 3 2 2 observation term conversion in section 3 2 1 the order of model output has been reduced to a corresponding model h ˆ n p n s x with a set of data identified on time patterns instead of the real time series to match the model output matrix formula we denote a two dimensional array y n t n s y 1 y 2 y n s r n t n s as the observation term that y i is a vector containing time series in i th location we have 10 y ˆ n p n s u n p t y n t n s the truncated basis matrix u n p used here is from the initial model since both the model and observations have a strong resemblance to the tidal constituents in time patterns the projection and reconstruction accuracy is further analyzed in section 5 1 1 the reduced observation vector y ˆ is 11 y ˆ u n p t y 1 u n p t y 2 u n p t y n s the observation error term has to be identified corresponding to the reduced observation term we define the statistic of observation error at i th location over all time steps as follows 12 r i e y i e y i y i e y i t where e y i y t i is a vector of the truth at all discrete times at location i the pod based observation error covariance r ˆ i is r ˆ i e y ˆ i y ˆ t i y ˆ i y ˆ t i t e u n p t y i u n p t y t i u n p t y i u n p t y t i t 13 u n p t r i u n p in this application we assume observation error is time invariant the covariance matrix r j is a diagonal matrix with σ 2 as diagonal values σ is the observation uncertainty and we set its value as 0 05 m in this application so r j σ 2 i n t therefore after the model order reduction the new observation error covariance for location i is r ˆ j σ 2 i n p r ˆ is the diagonal matrix including observation error covariance at all observation locations we rewrite the cost function with the order reduced model output and observation terms as follows 14 j o x 1 2 y ˆ h ˆ f x b k h ˆ c x b k h ˆ c x t r ˆ 1 y ˆ h ˆ f x b k h ˆ c x b k h ˆ c x 4 experiment configuration in this section we describe the experiment configuration including the parameter selection model setup observations and the setup of three experiments 4 1 parameters with uncertainties bathymetry is known as the parameter with the largest uncertainties for gtsm especially in deep oceans compared to bottom friction and internal tides drag coefficient wang et al 2021 constrained by limited observations computational sources and storage memory it is very hard to accurately estimate the bathymetry in over o 1 0 6 grid cells to reduce the parameter dimension we partitioned the global ocean into 110 subdomains based on the study of tide propagation length and bathymetry sensitivity test results wang et al 2021 a specified correction factor with uniform values is defined for each subdomain the equation for adjusting the bathymetry in the subdomain s i i 1 n is 15 d j 1 x i d j f o r j s i where d j is the bathymetry of the j th grid in the subdomain s i and x i is the i th element of the parameter vector x the initial guess for each parameter element is zero in this study the parameter x comprises the bathymetry correction factors in the 110 subdomains for instance if x 1 0 05 the bathymetry in region s 1 will be increased by 5 by assuming a constant adjusting correction factor in each subdomain the parameter dimension is reduced to an acceptable size parameter uncertainties are defined as 5 to ensure a realistic bathymetry estimation we impose three constraints for the experiments firstly using the background term 1 2 x x b t b 1 x x b t in the cost function as the weak constraint to prevent the adjusted parameter departs far away from the original values while only improving the estimate a little secondly a two degree transition area is applied between neighboring subdomains to avoid the correction factor jumps between different subdomains values for each grid cell in the transition areas are automatically interpolated by the model leading to smoother correction factors around the partition boundary thirdly a hard constraint of 10 is set for all parameters to ensure the changes are kept between 10 and 10 4 2 model set up in this study gtsm calibration is only based on the tide representation for two reasons firstly it is not easy to obtain globally distributed surge observations and the fes2014 dataset we used only provides tidal components secondly surge is more sensitive to the wind and air pressure but less to the bathymetry wang et al 2021 demonstrated it by comparing the surge simulation after the bathymetry estimation to the initial model with the uhslc dataset after the estimation the water level forecast is improved from the higher tide forecast accuracy and the changes of surge simulation are not significant thus we use the tide representation of gtsm for bathymetry estimation gtsm is forced by the tidal potential with the doodson number ranging from 57 565 to 375 575 we set the minimum threshold for the tidal spherical harmonic amplitude to 0 03 m leading to a set of 58 tidal generating frequencies long term tide components sa and ssa are removed from the tidal frequencies because they are still affected by non gravitational influences estimation accuracy is strongly related to the simulation time length used in the estimation procedure in principle it has to be long enough such as a month or even a year to capture the essential tide frequencies however available computer memory cannot store the large amount of model output from many simulations with long simulation time lengths in the iterative optimization algorithm a previous experiment selects one spring neap cycle 14 days which fits into the memory of 32 gb on our cluster however experiment results showed the problem of over fitting due to the insufficient simulation time length wang et al 2021 in the current experiments we use a simulation time of two weeks between 1 to 14 january 2014 to compare the estimation performance with and without the time pod model reduction after that the final model estimation covers the simulation of two spring neap cycles 1 month with time pod and outer loop application therefore the simulation starts from 1 to 31 january 2014 with a two week spin up before january 1 the time interval is set as 10 min which results in 4465 time steps 4 3 observation network for calibration and validation our parameter estimation uses the tide series derived from the fes2014 dataset in the deep ocean tide gauge data from the university of hawaii sea level centre uhslc is applied for the model validation caldwell et al 2015 the fes2014 dataset comes from the fes finite element solution tide model consisting of about 2 9 million nodes carrere et al 2013 long altimeter time series tide gauges improved modeling and data assimilation techniques have provided an accurate solution for fes2014 fes2014 performs better than gtsm when comparing with deep ocean bottom pressure recorder data wang et al 2021 stammer et al 2014 and fes2014 has an advantage in deep ocean calibration because of its ease of obtaining arbitrary time series and locations globally therefore the fes2014 dataset is selected as the observations for model calibration 1973 time series with 32 tide constituents excluding long term constituents sa and ssa are derived from the fes2014 dataset for the model calibration these 1973 locations are almost evenly distributed in the ocean the uhslc dataset is a collection of approximately 500 distributed tide gauge time series covering different years across the globe the specific amount of available data varies over the years two levels of quality control fast delivery fd and research quality data rqd are provided in the uhslc dataset tide gauges are somewhat irregularly distributed and most of them are in the coastal regions which leads the data more suitable for model validation than global model calibration we retrieved the 283 tide gauge series from the hourly rqd in the year 2014 after the tide analysis with tidal analysis software tidegui and visual inspection of the tide and surge representations against the measured series in the tide analysis procedure tide representations with a set of 93 components from 230 tide gauge stations are finally used for the model validation it is worth noting that long term tidal constituents sa and ssa are removed from fes2014 and uhslc tide representations to ensure the consistency between observations and model output also even though some tide gauge data are assimilated in the fes2014 dataset it is still reasonable to assume that fes is independent of uhslc data on the one hand most of the tide gauges are in the coastal regions while the 1973 time series we derived are for the deep ocean on the other hand uhslc data in this application is used to evaluate the estimated model performance in the coastal regions 4 4 experiments set up three experiments are set up to investigate the performance of the time pod parameter estimation scheme for gtsm as table 2 shows ex1 is the experiment with a short simulation time of two weeks without pod implementation and the outer loop it is very similar to the experiment in approach 2 of wang et al 2021 the memory needed for the total model output in this scheme to estimate 110 parameters is approximately 3 5 gb ex2 has the same settings as ex1 but with the implementation of pod it aims to evaluate the influence on the accuracy by applying pod the memory use is significantly reduced when compared to ex1 finally the experiment denoted as ex3 follows the parameter estimation scheme in fig 1 covering a 1 month simulation time length from 1 to 31 january 2014 without mor the data size of h c x 0 h c x 1 h c x n and observation was about 7 35 gb and the total memory use was more than 20 gb for this experiment with the proposed pod approach the memory use is sharply reduced to 4 5 after the pod application 5 numerical experiments and results to assess the performance of pod we first evaluate the projection and reconstruction accuracy of the model output and observations followed by a comparison of results between ex1 and ex2 at last the estimation results in ex3 are analyzed 5 1 pod performance analysis 5 1 1 reconstruction accuracy the accuracy of parameter estimation with mor depends on the reconstruction accuracy of the model output and observations the reconstructed model output and observation terms are in the formula of u n p u n p t h n s n t x the term k h n s n t x in eqs 5 and u n p u n p t y the basis matrix u n p is obtained by truncated svd from the initial model output or observations fig 2 shows the root mean square error rmse between the original and the reconstructed model output observation with different number of modes time series is from 1 to 31 january 2014 in general the rmse is decreased with the increase of the truncation size basis matrix from observation fig 2c shows slower downtrends than others fig 2a b one possible reason is the model has more tidal components that are not included in the observations there are 32 tidal constituents in observations while 58 tide potential frequencies are in the model but that will not affect the estimation results because the rmse for reconstructed model and observations without truncation is less than 5 1 0 4 m it means the missing components in observation would lead to at most 5 1 0 4 m water level changes while the observation error we defined is 0 05 m which is 100 times larger fig 2a shows the excellent accuracy of the reconstructed coarse model the reconstructed fine model and observations have similar performance when the truncation size varies fig 2b is opposite to fig 2a for the coarse model we use the basis matrix from the coarse model with 200 modes for the calibration process because most of the model simulation in the estimation iteration is on the coarse grid reducing the coarse model output with 200 modes sharply reduces the data size while the high accuracy for the coarse model with rmse of 2 64 1 0 4 m is attained and the reconstructed observation error is also smaller than the observation uncertainty tidal analysis can also be used to reduce the data size but in comparison the time pattern projection has two advantages firstly tidal analysis requires the selection of a set of tidal constituents these constituents should respect the rayleigh criterion the projection method has only one parameter to which is quite insensitive for example time series of reconstructed model output and observations for modes 1 to 3 fig 3a c in an observation location provide similar waves to the harmonic implying the patterns in the projection method work similarly as the tide analysis does but without the restriction to separating the independent tide components secondly the projection method gives almost identical results to the time series approach the reconstructed fine grid model output with projection on the first three modes fig 3d is close to the original data when more modes 200 modes we selected are included the reconstruction error would become very small we also performed a tidal analysis for the time series from the model output for this location and after projection onto modes 1 3 as shown in table 3 the projection on modes 1 and 2 mainly shows large amplitudes for the semi diurnal tides n2 m2 s2 k2 the contributions from n2 and m2 add up to a large part of the n2 m2 signal while this is a bit less for s2 and k2 mode 3 mainly shows diurnal constituents where the p1 and k1 amplitudes are close to the values for the full signal the time projection thus shows some resemblance to tidal analysis 5 1 2 experiments with time pod application fig 4 shows the cost function fig 4a and optimized bathymetry correction factors of ex1 fig 4b and ex2 fig 4c ex2 estimation with time pod shows a similar behavior of the cost function in each iteration as ex1 and nearly the same correction factors the rmse for both experiments decreases from 5 23 cm to 3 49 cm in the calibration period while the required memory in ex2 is reduced by a factor of 10 fig 5 illustrates the difference of rmse at different observation locations between the initial model and the estimated model in ex2 i e rmse between the initial model and observations rmse between the estimated model and observations it reports nearly the same improvement after the estimation as in ex1 not shown here therefore model order reduction is an efficient approach to reduce memory requirements for parameter estimation without causing any loss of estimation accuracy the purpose of parameter estimation is to improve the gtsm long term forecast accuracy however the interaction of tidal constituents varies during different periods for example the rmse between estimated model output and observations is 3 49 cm from 1 to 14 january while the rsme in the forecast increases to 4 33 cm for the period from 15 to 31 january 2014 a short simulation time length would lead to over fit the data in the estimation period wang et al 2021 after assessing model order reduction performance we selected a longer simulation time of 1 month and experimented in section 5 2 5 2 parameter estimation results analysis ex3 covers a simulation time length of 1 month for gtsm to estimate bathymetry fig 6a illustrates the changes in the cost function in each simulation in the three outer loop iterations in every outer loop the cost functions of the first 111 runs include one initial simulation and 110 independent simulations each corresponding to perturbing one of the 110 parameters parameters are iteratively updated after the first 111 simulations the simulation experiment was run using 200 cores for about 12 days with a total of approximately 57600 h cpu times in the first outer loop color red in fig 6a the cost function has a sharp reduction from 7 21 1 0 6 to 3 17 1 0 6 and then slowly reduced to 3 00 1 0 6 at the end of the second outer loop color blue compared with the first outer loop the cost function in the second outer loop only reduces slightly it looks that the estimation results are converged to a certain value in the third out loop the difference of cost functions in each simulation is very slight making the dud process difficult to continue leading to a stop after several iterations with a value of 2 95 1 0 6 it is in the same magnitude as that in the second outer loop gtsm parameter estimation is converged in the third outer loop iteration moreover sensitivity for each parameter can be observed from the variability of the cost function for the initial 111 perturbation runs in each outer loop this is strongly decreased in the third outer loop indicating that the estimated parameters are close to the minimum the final relative change to the bathymetry which is the correction factor x in eqs 15 is shown in fig 6b the value varies between 0 1 to 0 1 within the range of hard constraints estimation performance is analyzed by comparing the model output with the fes2014 dataset for the comparison of the model performance in ex3 and ex1 rmse of two time periods is summarized in table 4 rmse is used to represent the difference between model output and observations to access model performance the bias difference between model and observations is negligible not shown here as expected gtsm with the fine grid has better performance than that with the coarse grid comparing the coarse grid gtsm ex3 works better than ex1 in all outer loops and time periods in the fine grid gtsm ex1 performs slightly better than ex3 in the period 1 to 14 january but worse in 15 to 31 january 2014 this can be explained that ex1 estimates with a two week simulation time 1 to 14 january 2014 resulting in an over fitting of data in the calibration period the rmse is reduced from 5 23 cm to 3 49 cm in the period 1 to 14 january while the reduction in the period 15 to 31 january is clearly less from 5 84 cm to 4 33 cm in the 15 to 31 january with a longer simulation time length of 1 month in ex3 the rmse of the estimated fine model in these two periods is close to each other namely 3 62 cm and 3 66 cm implying the overfitting is reduced the spatial distribution of rmse for the fine gtsm in january is shown in fig 7 fig 7a is the rmse between the estimated fine grid model output in ex3 and fes2014 observations the differences of rmse between the model before and after the estimation are shown in fig 7b it can be observed that the estimated model has been significantly improved in most regions a few areas that are not improved or a bit worse than the initial model see the areas with yellow colors negative values of rmse difference in fig 7b possibly not only bathymetry but also other effects such as the lack of resolution play a role here the regions getting worse only takes up a small part of the ocean in addition estimation by ex3 outperforms ex1 in most ocean sea as fig 7c shows generally the estimated model significantly overperforms the initial model in summary the calibrated model in ex3 is in better agreement with the measurements than ex1 model order reduction reduces the memory requirement by a factor of 22 while keeping a better estimation accuracy long simulation time is beneficial for parameter estimation in gtsm and the implementation of the outer loop further improves the tide forecast accuracy 6 model validation to validate the model performance more independently from the simulation period and data we used in the estimation procedure we analyzed the tide components from gtsm and compared them against the fes2014 dataset in the frequency domain the tide forecast of gtsm for the whole year of 2014 is also compared with observations from the fes2014 and uhslc datasets 6 1 tide analysis comparison against fes2014 dataset for 2014 model performance is evaluated in the frequency domain tide forecast from gtsm in the year 2014 for 1973 observation locations is analyzed with tidegui software we use the root mean square rms to assess the difference between model output and observations for major tide components with the formula 16 r m s a m c o s ω t ϕ m a o c o s ω t ϕ o 2 the terms a m and a o are the amplitudes from model output and observations respectively ϕ m ϕ o are terms of phases lag ω is the tide frequency the overbar shows the computation over one full cycle of the constituent ω t varying from 0 to 2 π in all locations detailed results for 8 major tide components are summarized in table 5 root sum square rss for these 8 constituents is also analyzed it can be observed that rss and rms for all 8 major components are reduced after the estimation in ex1 and three outer loop iterations of ex3 when comparing with the initial model after the estimation m2 is the component that significantly improved in ex3 reduced from 4 50 cm to 1 89 cm whereas it is 2 54 cm in ex1 the other 7 components in ex3 are nearly the same or slightly better than that in ex1 the rss over these eight components in ex3 is sharply reduced from 6 05 cm to 3 52 cm the differences in the amplitude and phase between the model output and fes2014 dataset for m2 component are shown in fig 8 the difference in amplitudes and phases compared to fes2014 dataset is much smaller for the estimated models in ex1 and ex3 than for the initial model ex3 has a better agreement with fes2014 dataset than ex1 especially in the phase domain fig 8e f consequently ex3 has a smaller rms than ex1 initial gtsm performs better in deep ocean comparing with deep ocean bottom pressure recorder bpr observation than most of the purely hydrodynamic models described in table 3 of stammer et al 2014 but not as accurate as the assimilative tide models wang et al 2021 in this study gtsm is significantly improved after our parameter estimation to bathymetry in the deep ocean it overperforms the purely hydrodynamic models especially in the m2 constituent but still not better than the assimilative tide models this result is expected because firstly observation locations are limited in the estimation process and secondly not only bathymetry but other effects such as resolutions other parameters like bottom friction would also affect the model performance however compared to other tide models gtsm after parameter estimation has the advantage to access the effect of sea level rise and climate changes because it can include surge simulation when meteorological forcing wind and air pressure additions are added therefore the high accuracy tide representations also benefit the complete water level forecast 6 2 monthly comparison against fes2014 time series for 2014 gtsm is also validated through long term tide forecasts showing the model performance in different time periods model forecast in the whole year of 2014 is firstly analyzed with the fes2014 dataset fig 9 shows the regional rmse of the fine gtsm after the estimation in ex1 and ex3 for each month of year 2014 the regional rmse between gtsm with the fine grid and fes2014 dataset is shown in fig 9a g the global average of rmse in 1973 locations is shown in fig 9h compared to the initial model the rmse for all the regions is significantly reduced in ex1 and ex3 rmse in ex1 is larger than that in ex3 in the year 2014 except for some months in the indian ocean forecast results also report that estimation with a longer simulation length works better than that with a short time window when comparing the rmse in ex1 and the first outer loop of ex3 as the number of outer loop iterations increases the model performs better throughout 2014 the 1 year forecast comparison with the fes2014 dataset demonstrates the estimated model can be used for the high accuracy long term forecast one can also observe a seasonal pattern in the rmse in fig 9 both before and after the calibration a possible reason is that tide constituents interact differently for different periods leading to a large or small difference between the data and the model for each month after calibration this seasonal pattern is smaller in ex3 than ex1 indicating long simulation time length can weaken it and result in a better agreement to model and observations however it remains challenging to verify whether using a more extended time period such as one year can further improve the model accuracy and eliminate over fitting due to the excessive computational demand but we see no clear signals of over fitting problem in ex3 and the 1 month calibration provides sufficient calibration accuracy 6 3 monthly comparison against uhslc time series for 2014 in the following the performance of gtsm is assessed using a dataset that is not used in the estimation stage model performance in the coastal areas is evaluated by comparing with the uhslc dataset in 2014 fig 10 shows the monthly averaged rmse in 2014 between model output and the uhslc measurement the rmse before the estimation is approximately 12 5 14 cm in each month and it is reduced to about 10 11 5 cm after the estimation in both ex1 and ex3 it indicates the bathymetry estimation for the deep ocean can improve the accuracy in the nearshore as expected the results in ex3 are better than in ex1 the difference between the three outer loops is not significant but the second outer loop is slightly better than the third outer loop it can also be observed from the mean rmse of the whole year of 2014 fig 10 the second loop has a value of 10 84 cm smaller than the third outer loop with 10 94 cm one possible reason is the bathymetry estimation mainly works on the deep ocean after three outer loop iterations the parameter estimation overfits a bit the deep water observation used in the calibration process also some other effects such as bottom friction play a role in shallow waters but they are left out of consideration in this study future works can continue on the parameter estimation for shallow waters fig 11 shows the spatial distribution of rmse between the initial fine model and uhslc dataset in the year of 2014 fig 11a and the rmse difference between the model before and after estimation in ex3 fig 11b results in ex1 reported similar distribution as ex3 but with a slightly higher rmse not shown here most of the tide gauges are located in coastal areas with larger rmse than deep oceans after the global calibration model performance near the coast is improved even though the calibration mainly focuses on the deep water to further have a closer look at the tide representation in one location the time series of station wellington harbor in new zealand is used as an example fig 12a shows the tide representation from the uhslc dataset the model output of the initial ex1 and ex3 the difference between model output and observation is depicted in fig 12b the rmse for the initial model is 15 25 cm and after the estimation in ex1 it is decreased by approximately 44 2 to 8 51 cm ex3 with the rmse reduction of approximately 59 21 is marginally better than in ex1 the model validation for the whole year of 2014 shows excellent agreement with the fes2014 and uhslc datasets in frequency and time domains after applying the memory efficient estimation it illustrates that gtsm with the adjusted bathymetry can provide high accuracy long term tide forecast 7 summary and conclusion this study presented a memory efficient parameter estimation approach for the high resolution global tide model over a long time length to resolve the memory constraint of the long period model simulation time pod model order reduction is developed to project the model output time patterns onto a smaller subspace to further improve the model estimation accuracy with affordable computational cost we implemented inner outer loop iterations similar to incremental 4d var using an iterative parameter estimation algorithm called dud in the inner loop with the lower resolution model simulation the outer loop uses optimized parameters from the previous inner dud process as a new reference run with the initial high resolution model this parameter estimation scheme is implemented for the global tide and surge model gtsm to correct bathymetry and substantially improve the model performance our previous investigation showed that the accuracy of the calibrated model would probably benefit from a calibration period longer than the two weeks one spring neap cycle used there but the huge memory required was limiting an extension in practice wang et al 2021 here we use time pod model order reduction to project the gtsm output onto a limited number of time patterns this projection reduces the memory usage by more than an order of magnitude in our experiments while our experiments for gtsm show that parameter estimation with mor achieves the same model accuracy as without mor this approach has the advantage of keeping the reduced model output size small when extending the simulation time length finally a parameter estimation experiment for gtsm with the implementation of mor and inner outer loop iterations is performed it covers a simulation time of 1 month while memory demand is reduced by a factor of 22 due to model order reduction for time fields experiment results show that the ocean tide is better represented in the calibration period the cost function is converged within three outer loop iterations in this study model validation from the frequency domains illustrates the m2 component is significantly better estimated with the set up of 1 month simulation length and the outer loop implementation model tide forecast in the whole year of 2014 is compared with the fes2014 and uhslc datasets it demonstrates that a long simulation period in the estimation procedure improves the performance for long term tide forecasting the outer loop iterations contribute to further improvement of the model forecast but can lead to a bit of overfitting to the data in the third outer loop in summary parameter estimation leads to significant performance improvements for gtsm the memory requirements are significantly reduced which allowed us to extend the time span used for calibration this resulted in a more accurate reproduction of tides in gtsm bathymetry calibration contributes more to the deep ocean but also benefits a bit for shallow waters moreover the time pod parameter estimation is a general technique that can be widely used in many global or regional numerical models to estimate different parameters compared to harmonic analysis method model simulation time length in time pod estimation is not limited by the rayleigh criterion we have presented a case study of bathymetry estimation in a global tide and surge model even when only tide is simulated in the gtsm the efficient estimation also benefits the complete water level forecasts including the tide and surge in addition this parameter estimation scheme can also be used to calibrate different parameters simultaneously e g bathymetry internal tide friction and bottom friction combined in particular to estimate the bottom friction in shallow water with more tide gauge data credit authorship contribution statement xiaohui wang conceptualization methodology software writing original draft martin verlaan conceptualization writing review editing supervision maialen irazoqui apecechea software hai xiang lin writing review editing supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the first author wishes to thank the china scholarship council for providing financial support in terms of a scholarship grant this work was carried out on the dutch national e infrastructure with the support of surf the fes2014 dataset was acquired from https www aviso altimetry fr research quality data of uhslc is made available at the university of hawaii sea level centre with the link ftp ftp soest hawaii edu uhslc rqds bathymetry data is available from https www gebco net data and products gridded bathymetry data gebco 2019 and https emodnet ec europa eu en bathymetry emodnet 
23849,we use modelling and assimilation tools to explore the impact of biogeochemistry on physics in the shelf sea environment using north west european shelf nwes as a case study we demonstrate that such impact is significant the attenuation of light by biogeochemical substances heats up the upper 20 m of the ocean by up to 1 c and by a similar margin cools down the ocean within the 20 200 m range of depths we demonstrate that these changes to sea temperature influence mixing in the upper ocean and feed back into marine biology by influencing the timing of the phytoplankton bloom as suggested by the critical turbulence hypothesis we compare different light schemes representing the impact of biogeochemistry on physics and show that the physics is sensitive to both the spectral resolution of radiances and the represented optically active constituents we introduce a new development into the research version of the operational model for the nwes in which we calculate the heat fluxes based on the spectrally resolved attenuation by the simulated biogeochemical tracers establishing a two way coupling between biogeochemistry and physics we demonstrate that in the late spring summer the two way coupled model increases heating in the upper oceanic layer compared to the existing model and improves by 1 3 days the timing of the simulated phytoplankton bloom this improvement is relatively small compared with the existing model bias in bloom timing but is sufficient to have a visible impact on model skill in the free run we also validate the skill of the two way coupling in the context of the weakly coupled physical biogeochemical assimilation currently used for operational forecasting of the nwes we show that the change to the skill is negligible for analyses but it remains to be seen how much it differs for the forecasts keywords impact of biogeochemistry on physics two way coupled physical biogeochemical model ocean chlorophyll concentration sea surface temperature phytoplankton spring bloom north west european shelf 10e 10w 40n 68n data assimilation operational systems 1 introduction within the earth system physics and biology mutually interact in many non trivial ways in the marine environment biological processes are driven by physical transport mixing temperature salinity and the incoming light whereas biology impacts physics through its role in the carbon cycle microbial and biological pump e g riebesell et al 2009 oceanic albedo jin et al 2004 underwater light attenuation morel 1988 simonot et al 1988 sathyendranath et al 1991 edwards et al 2004 oschlies 2004 manizza et al 2005 marzeion et al 2005 sweeney et al 2005 lengaigne et al 2007 jochum et al 2010 zhai et al 2011 turner et al 2012 and its influence on cloud condensation nuclei through the production of dimethyl sulphide dms lovelock et al 1972 charlson et al 1987 six et al 2013 schwinger et al 2017 or through bubble formation wilson et al 2015 while the impact of physics on biology is never neglected or disputed the impact of biology on physics became often a matter of controversy for example in connection with the gaia hypothesis lovelock 1979 2000 which proposes that life plays a central role in regulating climate marine model development largely reflects this underlying scientific attitude i e the common way to simplify complex coupled physical biogeochemical dynamics is to neglect the impact of the simulated biogeochemistry on physics heinze and gehlen 2013 gehlen et al 2015 ford et al 2018 so that the physical component can be run entirely independently of the biogeochemical model we will further call such models one way coupled the most obvious source of biogeochemical feedback to physics in coupled physical biogeochemical ocean models is the attenuation of underwater radiances by optically active biogeochemical tracers and the subsequent impact on heat fluxes temperature and mixed layer depth mld one way coupled models either do not represent this effect at all or they incorporate it offline based on external forcing such as using observational products for surface diffuse attenuation coefficients e g madec et al 2015 however since our overall goal is to realistically represent environmental processes or to produce reliable global climate projections it is a matter of importance to better understand both the biogeochemical impact on ocean physics and the sensitivity of the simulated physics to how precisely such an impact is incorporated into the physical model only by answering these two questions can we see to what extent the simplifications usually adopted in our models are justified studies have looked at the impact of biogeochemical light attenuation on marine physics e g in the north atlantic oschlies 2004 tropical pacific lengaigne et al 2007 and globally manizza et al 2005 demonstrating that the impact can be substantial but regionally dependent however the studies so far largely focused on the open ocean that dominates the global scales and there is a lack of a more detailed study of such impact in the shelf sea environment shelf seas are highly productive parts of the ocean borges et al 2006 jahnke 2010 which makes them particularly relevant to study the complex interaction between biogeochemistry and physics in this study we will employ state of the art modelling tools e g skákala et al 2020 to estimate the impact of biogeochemical tracers on vertical light and heat attenuation on the north west european shelf nwes a region of particular interest for the european economy pauly et al 2002 and carbon cycle borges et al 2006 jahnke 2010 furthermore we will determine how sensitive the physical model of the nwes is to the adopted light scheme used to drive the heat fluxes in the water column as part of the work described in this study we implemented into the physical model within a research version of the copernicus marine environment monitoring service cmems operational system for the nwes a state of the art representation of underwater radiances this uses the spectrally resolved bio optical module from skákala et al 2020 based on the oasim model of gregg and casey 2009 since the attenuation in the newly implemented module is calculated using the simulated biogeochemical tracers the physics now depends on the simulated biogeochemistry henceforth we will refer to such models as two way coupled for examples see oschlies 2004 manizza et al 2005 lengaigne et al 2007 we will provide a detailed evaluation of the updated system performance including the weakly coupled physical biogeochemical data assimilation the aim of this evaluation is to provide a recommendation of whether the new set up should be considered for operational use a specific problem of focus for this study is the impact of the changed physics within the newly introduced two way coupled model on the simulated biogeochemistry the existing cmems operational system is one way coupled and it has been argued skákala et al 2020 that it may be underestimating the heating in the upper ocean at least relative to the newly introduced two way coupled model the expected increase in upper ocean heating due to two way coupling is likely to reduce convective mixing in the upper ocean taylor and ferrari 2011 smyth et al 2014 which may change the timing of the spring phytoplankton bloom as per the critical turbulence hypothesis huisman et al 1999 waniek 2003 to be more specific although many factors can influence the bloom timing including biological drivers such as zooplankton grazing e g behrenfeld and boss 2018 the critical turbulence hypothesis is one of the leading hypotheses for how blooms are triggered in the north atlantic suggesting that the bloom happens when the effective mixing depth is fully contained within the lit layer reducing convective mixing can then reduce the effective mixing depth and trigger an earlier phytoplankton bloom for the mechanism see the schematic in fig 1 which would be desirable as the current operational model is known to produce late and intense spring blooms skákala et al 2020 2021 since a spring bloom is a major ecosystem driver on the nwes lutz et al 2007 henson et al 2009 any improvements in bloom timing could have an important knock on effect on the biogeochemical model skill the questions outlined in this study will be addressed by analysing outputs of a number of suitably designed free and assimilative runs the paper will be structured as follows firstly we will describe the model light scheme and if present the assimilation set up for the different simulations as well as the methodology on how to validate and compare those different simulations this will be followed by the section describing the results on the sensitivity of temperature to the light attenuation by the biogeochemical tracers as well as to the adopted light scheme and also on the impact of two way coupling and assimilation on the coupled physical biogeochemical model skill in the last part we will discuss our results and outline the directions for future research 2 methods 2 1 the physical model nucleus for european modelling of the ocean nemo the nemo ocean physics component opa is a finite difference hydrostatic primitive equation ocean general circulation model madec et al 2015 the nemo configuration used in this study is similar to the one used by ford et al 2017 skákala et al 2018 2020 and identical to the configuration used in skákala et al 2021 we use the co6 nemo version based on nemov3 6 a development of the co5 configuration explained in detail by o dea et al 2017 the model has 7 km spatial resolution on the atlantic margin model amm7 domain using a terrain following z σ coordinate system with 51 vertical levels siddorn and furner 2013 the lateral boundary conditions for physical variables at the atlantic boundary were taken from the outputs of the met office operational 1 12 north atlantic model natl12 storkey et al 2010 the baltic boundary values were derived from a reanalysis produced by the danish meteorological institute for cmems we used river discharge based on data from lenhart et al 2010 the model was forced at the surface by atmospheric fluxes provided by an hourly and 31 km resolution realization hres of the era5 data set https www ecmwf int this paper compares several light schemes previously used in the literature to calculate the nemo oceanic heat fluxes for the summary see table 1 i the existing reanalysis version of the operational one way coupled model e g skákala et al 2018 which takes the total incoming net shortwave radiation from the era5 data splits it into visible 400 700 nm and invisible fractions with the visible fraction attenuated inside the water column based on the k d for 490 nm wavelength supplied by a monthly climatology from an ocean color climate change initiative oc cci product of european space agency esa version 4 1 https www esa oceancolour cci org and the invisible waveband attenuated with a constant e folding depth of 0 35 m ii the red green blue rgb scheme by lengaigne et al 2007 which uses the visible fraction of light spectrally resolved into 3 wavebands blue 400 500 nm green 500 600 nm and red 600 700 nm and attenuates it by the sea water and phytoplankton chlorophyll by default chlorophyll is taken to be a constant 0 05 mg m3 a minimal value representative of oligotrophic waters as in lengaigne et al 2007 o dea et al 2017 graham et al 2018 alternatively chlorophyll can be simulated by a biogeochemical model as in lengaigne et al 2007 both these chlorophyll schemes will be included into our study iii the two way coupled run using the implementation of a bio optical module based on the oasim model gregg and casey 2007 gregg and rousseaux 2016 skákala et al 2020 providing spectrally in 33 wavebands resolved radiance decomposed into direct and diffuse streams for a detailed description of the bio optical module and the attenuation scheme see the next section describing the european regional seas ecosystem model ersem model iv we will also use the scheme based on the bio optical module to simulate the attenuation by clear water only to provide a baseline run for the comparison of how biology and the different light schemes impact physics on the nwes in each of the previous cases the underwater radiances are at every vertical level integrated by nemo to calculate the heating within each vertical layer as 1 d t d t d i d z 1 c ρ where t is temperature t is time d i is for each vertical model layer the difference between the irradiance penetrating the top of a grid box and that leaving the bottom d z is the vertical distance between the top and bottom of the grid box c is heat capacity and ρ is the reference water density 2 2 the ecosystem model the european regional seas ecosystem model ersem ersem baretta et al 1995 butenschön et al 2016 marine systems modelling group 2020 is a lower trophic level ecosystem model for marine biogeochemistry pelagic plankton and benthic fauna blackford 1997 in this study ersem is coupled to the physical model nemo using framework for aquatic biogeochemical models fabm bruggeman and bolding 2014 2020 ersem splits phytoplankton into four functional types largely based on their size baretta et al 1995 picophytoplankton nanophytoplankton diatoms and dinoflagellates ersem uses variable stoichiometry for the simulated plankton groups geider et al 1997 baretta bekker et al 1997 and each phytoplankton functional type pft biomass is represented in terms of chlorophyll carbon nitrogen and phosphorus with diatoms also represented by silicon ersem predators are composed of three zooplankton types mesozooplankton microzooplankton and heterotrophic nanoflagellates with organic material being decomposed by one functional type of heterotrophic bacteria butenschön et al 2016 the ersem inorganic component consists of nutrients nitrate phosphate silicate ammonium and carbon and dissolved oxygen the carbonate system is also included in the model artioli et al 2012 we applied in this study the ersem configuration from skákala et al 2021 based on a new ersem version 20 10 which has an updated benthic component with respect to butenschön et al 2016 the ersem parametrization is identical to the one described in butenschön et al 2016 the atlantic boundary values for nitrate phosphate silicate and oxygen were taken from world ocean atlas garcia et al 2013 and dissolved inorganic carbon from the glodap gridded dataset key et al 2015 lauvset et al 2016 while plankton and detritus variables were set to have zero fluxes at the atlantic boundary the irradiance at the ocean surface was calculated for all the runs using the bio optical module implemented into the nemo fabm ersem amm7 configuration by skákala et al 2020 the bio optical module resolves irradiance spectrally 33 wavebands in the 250 3700 nm range and distinguishes between downwelling direct and diffuse streams the module is forced by the era5 atmospheric inputs https www ecmwf int for total vertically integrated ozone water vapour cloud cover cloud liquid water and sea level air pressure as well as by a satellite product for aerosol optical thickness moderate resolution imaging spectroradiometer modis https modis gsfc nasa gov data dataprod and also by data for surface wind speed air humidity and air temperature all provided by the nemo atmospheric era5 forcing the attenuation of the irradiance was described in detail by gregg and rousseaux 2016 skákala et al 2020 here it is briefly summarized the module distinguishes between the absorption and scattering by the sea water and the 4 pfts based on the wavelength dependent absorption total scattering and backscattering coefficients from gregg and rousseaux 2016 although we included the impact of backscattering on the light attenuation similarly to skákala et al 2020 we argue that explicitly tracking the upwelling stream can be reasonably neglected besides the clear sea water and pfts we included into the light attenuation also the absorption by pom cdom and sediment which was the same as in skákala et al 2020 forced by an external product extrapolated from the 443 nm data of smyth and artioli 2010 the bio optical module was extensively validated in skákala et al 2020 and was shown to be skilled in its representation of swr par and the underwater irradiances finally all the ersem simulations in this study used the bio optical module described in the previous paragraph but in the case of the no bgc run for abbreviations see table 1 all the attenuation except by the clear sea water was removed the choice of ersem light scheme for the different simulations is justified as follows a the 1 way and 2 way configurations using the bio optical module to force ersem correspond to the latest research version of the cmems system on the nwes the 1 way configuration see skákala et al 2020 and the currently most advanced version of the coupled nemo fabm ersem model on the nwes the 2 way configuration b to sensibly compare the impact of biogeochemistry on physics it is important that the 2 way rgb sc run table 1 uses the same ersem light module as the 2 way run this ensures that the simulated biogeochemical tracers are between the different two way coupled runs consistent to a maximum possible degree in the sense that the only differences in the ersem tracers are caused by the differences in the nemo physics transport mixing temperature triggered by the different nemo light schemes c in case of both no bgc and 1 way rgb cc runs nemo is entirely independent from ersem it is also expected that the physics in the no bgc and 1 way rgb cc will be the most different from the remaining three free simulations to estimate the size of the impact of the nemo simulated physical state on the ersem simulated biogeochemistry relative to the size of the impact of the radiances seen by ersem whilst minimizing the number of necessary simulations included in the study we decided to use the same ersem light scheme for the 1 way rgb cc run as for the 1 way 2 way and 2 way rgb sc runs but using the same light scheme for ersem as in nemo for the no bgc run 2 3 the assimilative system nemovar nemovar is a variational in this study a 3dvar da system mogensen et al 2009 2012 waters et al 2015 used at the met office for operational forecasting and reanalyses on the nwe shelf the assimilation of ocean colour derived chlorophyll using nemovar is highly successful in improving the nwe shelf phytoplankton phenology pft community structure using pft chlorophyll assimilation underwater irradiance and to a more limited degree also carbon cycle skákala et al 2018 2020 kay et al 2019 nemovar includes capability to assimilate multi platform satellite in situ data which has been established first for physics e g waters et al 2015 king et al 2018 and subsequently for biogeochemistry ford 2021 including validating the multi platform da system for the nwes skákala et al 2021 the nemovar set up used in this study for the multi platform physical biogeochemical assimilation is the same as the one described in detail by skákala et al 2021 here we offer only a short summary the 3dvar version of nemovar uses a first guess at appropriate time fgat to calculate a daily set of increments for the directly updated variables waters et al 2015 king et al 2018 in the physical da application nemovar applies balancing relationships within the assimilation step and delivers a set of increments for temperature salinity sea surface height ssh and the horizontal velocity components for the total chlorophyll assimilation nemovar calculates a set of log chlorophyll increments and then a balancing scheme is used to distribute those increments into the pft components chlorophyll carbon nitrogen phosphorus and for diatoms also silicon all of which are updated based on the background community structure and stoichiometric ratios e g skákala et al 2018 2020 2021 after the assimilation step the model is re run with the increments applied to the model variables gradually at each model time step using incremental analysis updates iau bloom et al 1996 nemovar uses externally supplied spatio temporally varying observation and background error variances with the background error variances typically 1 3 times larger than the observational error variances skákala et al 2021 the system combines two horizontal correlation length scales one fixed at 100 km and the other based on the baroclinic rossby radius of deformation king et al 2018 the vertical length scales follow the scheme from king et al 2018 where nemovar calculates directly the set of 3d increments using flow dependent vertical length scales ℓ which are at the surface equal to half of the mld decreasing in the mixed layer to become two times the vertical model grid spacing at and beneath the mld 2 4 observations assimilated and validation data 2 4 1 assimilated data in the physical data assimilation component we have included a sea surface temperature data from the gcom w1 amsr 2 noaa avhrr metop avhrr msg seviri sentinel 3 slstr suomi npp viirs satellite products and in situ sst observations from ships surface drifters and moorings distributed over the global telecommunication system gts in near real time b temperature and salinity from the en4 dataset good et al 2013 which includes in situ profiles from argo floats fixed moored arrays xbts ctds gliders marine mammals and c temperature and salinity data from a specific slocum glider cabot unit 345 see skákala et al 2021 that was deployed in the central north sea during 08 05 2018 15 08 2018 as a part of the alternative framework to assess marine ecosystem functioning in shelf seas altereco programme https altereco ac uk the satellite sst was bias corrected following the scheme from while and martin 2019 using the viirs and in situ sst data as the reference in the biogeochemical data assimilation we have included total log chlorophyll derived from the version 4 2 of the european space agency esa ocean colour oc climate change initiative cci product sathyendranath et al 2019 and also log chlorophyll derived from the quenching corrected fluorescence measurements by the same altereco glider cabot that was used in the physical data assimilation the assimilation is performed for log chlorophyll rather than chlorophyll as chlorophyll is widely known to be log normally distributed campbell 1995 the assimilated in situ en4 and glider observations were thinned to a resolution of 0 08 en4 or up scaled to the amm7 grid glider with additional temporal averaging applied to the same day glider observations the thinning up scaling is performed to avoid assimilating many observations at higher resolution than the model can represent after the thinning up scaling there were o 1 0 5 en4 and o 1 0 4 cabot glider data points to assimilate throughout the year 2018 2 4 2 validation data the assimilated data mentioned in the previous section were also used to validate every experiment where they were excluded from the assimilation e g assimilated chlorophyll data were used to validate free runs and the physical data assimilative runs however we excluded the bias corrected satellite sst from the temperature validation so that the only assimilated sst data used for validation were a the high quality sst data from the viirs satellite product and from ships drifters and moorings we will call this viirs in situ sst data and the sst that was part of b en4 and c cabot glider data besides the assimilated observations all the experiments were validated with other non assimilated altereco glider data for temperature salinity chlorophyll oxygen and the sum of nitrate and nitrite all the gliders included in the validation are listed in table 2 the processing of the physical chlorophyll and oxygen data was described in skákala et al 2021 the sum of nitrate and nitrite concentrations abbreviated as no x no 3 no 2 were determined using a lab on chip loc analyser designed and fabricated at the national oceanography centre beaton et al 2012 which was implemented by the altereco team into seagliders following a similar protocol as used by vincent et al 2018 the combined uncertainty random and systematic errors of measurements made using these loc analysers has been calculated as 5 coverage interval k 1 birchill et al 2019 the nitrite concentrations were relatively negligible compared to the nitrate concentrations so the no x data were used to validate model nitrate outputs all the data used here is from altereco gliders that were in operation in the central north sea during 2018 for both the glider and the en4 data locations see fig s1 of the supporting information si moving throughout the whole water column similar to the assimilated cabot glider the remaining glider data were up scaled onto the model grid on a daily basis and after the up scaling there remained o 1 0 4 altereco glider observations for each variable in 2018 the en4 data set contained subsurface observations that were approximately homogeneously distributed both with depth and in time with a slightly lower number of observations towards the end of the year november december 2018 beyond the assimilated data and the altereco data we used for validation a 1960 2014 monthly climatological dataset for total chlorophyll oxygen nitrate phosphate and silicate concentrations compiled during the north sea biogeochemical climatology nsbc project hinrichs et al 2017 the nsbc dataset covers most of the nwe shelf and the full range of depths finally we also included validation of surface co2 fugacity using 2018 socat v2019 data https www socat info index php about 2 5 the experiments as outlined in table 1 we have run multiple free simulations including both one way coupled and two way coupled runs we also tested the impact of assimilating different types of data physical only biogeochemical only and physical and biogeochemical jointly see table 3 on the skill of both 1 way and the 2 way models the various free and assimilative experiments used exactly the same model configuration apart from the differences outlined in tables 1 and 3 the experiments all started from the same initial value conditions on the 01 09 2017 to allow a 4 month spin up time for the final 2018 simulation the initial values were provided by the 2016 2018 free simulation using bio optical module from the study of skákala et al 2020 2 6 skill metrics the performance of the different simulations is evaluated using two skill metrics the first metric is the model bias δ q m o 2 δ q m o q m q o where q o are the observations mapped into the model grid and the q m are the corresponding model outputs the second metric is the bias corrected root mean square difference bc rmsd δ r d q m o 3 δ r d q m o q m q o δ q m o 2 3 results 3 1 the impact of biogeochemistry on physics on the nwes to determine the overall impact of biogeochemical light attenuation on the nwes temperature vertical profiles we compare the simulation based on the bio optical module using only clear water attenuation no bgc with the two way coupled run using the bio optical module and assimilating chlorophyll into the model chl da 2 way the chl da 2 way run is chosen because it provides us with the best representation of the biogeochemical feedback to physics including the most realistic simulation of the phytoplankton distributions fig 2 shows that nwes biogeochemistry has a substantial impact on the simulated temperature in the late spring summer heating up the upper 20 m in the water column and cooling down the water column beneath the mixed layer almost down to the 200 m depth the temperature variations due to biogeochemistry are in the warmest summer period on the scale of 1 c the geographical impact of biogeochemistry on temperature fig 3 a is largest in the northern part of the north sea conversely it is by far the lowest in the english channel and the southern part of the north sea the heating of the uppermost ocean layer has an important impact up to 20 on the mixing depth which is consistently shallowed by the biogeochemistry across the whole nwes fig 3 c all the results presented in this section are broadly consistent with the findings of manizza et al 2005 for the global domain and oschlies 2004 more specifically for the north atlantic domain 3 2 comparing the impact of different light schemes on physics we compare the sensitivity of simulated temperature and mld to the light schemes incorporating the impact of biogeochemistry on the light attenuation seen by the nemo physical model table 1 figs 4 and 5 compare the temperature of all the simulations using different light schemes to the no bgc run fig 4 shows that the two way coupled model based on the bio optical module 2 way panel d produces an increase of near surface attenuation and hence sea temperature when compared to the one way coupled run forced by an external satellite product 1 way panel b for direct comparison between the two runs see also fig s2 of the supporting information si since the physical model skill depends on many components within the complex model there can be many error compensations skákala et al 2020 it is therefore hard to validate the performance of the nemo light scheme independently of the specific context in which it was implemented however fig 5 should still give an indication of how the different light schemes compare with the 3d glider observations along the glider trajectory fig 5 illustrates that neglecting the biogeochemical impact on light attenuation in the no bgc run produces a spurious heating effect of up to 3 c beneath the upper 30 m in the water column including biogeochemical impact on the temperature reduces this model bias to below 1 c fig 5 b e 3 3 the sensitivity of biogeochemistry to the changes in underwater radiance and mixing ersem is known to simulate a late phytoplankton spring bloom on the nwes e g figs 6 and 7 as suggested by the critical turbulence hypothesis the bloom timing depends on both the light seen by the phytoplankton and vertical mixing e g fig 1 the ersem sensitivity to light is demonstrated by the no bgc simulation due to absence of biogeochemical impact on the underwater radiances in the no bgc run there is an excess of light deep within the water column and this provides despite the deep winter mixing good phytoplankton growth conditions over the winter with an early bloom triggered around late february fig 6 b the only seriously limiting factor to the surface chlorophyll abundance in the no bgc run seem to be nutrients in the post bloom period fig 6 b in the remaining free run simulations ersem always uses the same light scheme but the physical nemo model does not the different light schemes in the physical model produce different vertical mixing and slightly modify the timing of the phytoplankton bloom fig 6 c d for example the increased near surface absorption in the 2 way model increases heating in the upper oceanic layer with respect to the 1 way run fig 4 b d reduces convective mixing and for most of the nwes moves the model bloom towards the start of the year by 1 3 days but in some specific locations e g in the central north sea the bloom can be as much as 5 days earlier in the 2 way run than in the 1 way run fig 6 c e fig 7 c fig 8 3 4 the potential impact of two way coupling on the skill of the cmems operational system introducing two way coupling into the cmems operational model would correspond to a transition from the 1 way to the 2 way model set up but also include the assimilation of physical and biogeochemical data as previously discussed in the free run the transition from 1 way to 2 way run produces extra heating in the upper 20 m of the ocean increasing sea temperature by around 1 c and by a similar margin cooling down the 20 100 m layer beneath the surface compare fig 4 a and fig 4 d fig s2 b of the si this marginally shallows the mld fig 4 e in the summer may october when the impact of two way coupling is largest the 2 way run reduces the temperature bias of the 1 way run however it increases the sst bias and bc rmsd fig 9 a in the winter november april the impact of two way coupling on the model temperature is also mixed fig 9 b as it is for salinity throughout the whole year fig 9 c d the changes to physics introduced by the 2 way set up relative to 1 way have a positive impact on the timing of the phytoplankton bloom fig 6 c e fig 7 c which leads to improvement in model skill in representing phytoplankton chlorophyll a fig 10 a interestingly correcting phytoplankton phenology through the oc chlorophyll assimilation has also a positive impact on the simulated temperature and salinity in the 2 way run fig 9 fig 9 also demonstrates that the physical temperature and salinity assimilation substantially improves model skill in representing both temperature fig 9 a b and salinity fig 9 c d the physical data assimilation influences the simulated temperature more evenly across the water column than the bio optical module fig s2 of si which is likely a combination of model dynamical response to the temperature increments in the mixed layer and some assimilated sub surface data en4 and cabot glider the chlorophyll assimilation improves the simulated chlorophyll fig 10 a and dominates over both physical assimilation and two way coupling in its impact on the simulated chlorophyll concentrations across the whole water column over the whole simulation year fig s3 of si that this would be the case is not obvious as the chlorophyll assimilation is almost entirely based on the satellite oc and chlorophyll beneath the mixed layer is updated mostly through the model dynamical adjustment the bloom dynamics is also corrected by the chlorophyll assimilation fig s4 of si which is consistent with the previous studies skákala et al 2020 2021 to get a more complete view of the impact of two way coupling on the simulated biogeochemistry we also looked at the available data for oxygen co2 fugacity nitrate phosphate and silicate fig 10 shows that the two way coupling may also improve the modelled oxygen fig 10 b and co2 fugacity fig 10 c which is in both cases a combined result of changes to air sea fluxes due to changes in sea temperature and therefore gas saturation levels to the primary productivity change to bloom timing and consequently also changes to respiration levels physical and chlorophyll a assimilation tend to have additional positive impact on oxygen and co2 fugacity fig 10 b c the impact of the two way coupled model on nutrients is mostly driven by the changes to primary productivity and phytoplankton and is shown to be fairly negligible fig 10 c f these results are broadly consistent with the previous literature skákala et al 2018 2020 which showed that chlorophyll a assimilation can have an important impact on the nutrient concentrations but often has a mixed effect in terms of the model skill to represent nutrients fig 10 4 discussion on the nwes there is a strong seasonal dependence of the biogeochemical impact on temperature fig 2 which can be easily understood in the late autumn to early spring period the water column is very well mixed and this averages out the vertical changes to heating caused by the presence of biogeochemical tracers in the late spring when the water column becomes much more stratified the biogeochemical substances trap light and heat in the uppermost layer gradually cooling down the ocean beneath the upper 20 m however due to oceanic inertia the impact of extra near surface heating introduced by the biogeochemical substances propagates only slowly downwards producing an increasingly delayed response approximately on a monthly scale as one looks deeper into the water column fig 2 c similarly to the winter period the lack of biogeochemical impact on physics around the english channel fig 3 can be explained by the high levels of vertical mixing in this area see o dea et al 2012 the 2 way run produces large extra heating in the uppermost layer also relative to the 1 way run fig 4 a d although in theory the bio optical module used to drive biogeochemistry produces different incoming radiation than the era5 forcing data used to force physics in the 1 way run it has been shown that there is a negligible mutual bias between the module and era5 skákala et al 2020 therefore the temperature increase is likely a consequence of an increased rate of absorption inside the upper oceanic layer rather than resulting from an enhanced shortwave radiation flux into the water column the increased absorption in the 2 way run was anticipated since a in a previous study skákala et al 2020 the bio optical module appeared to have higher levels of light attenuation near the water surface than the satellite observations used to force the physics in the one way coupled run b the broadband visible light attenuation in the 1 way run was represented by the satellite k d for 490 nm wavelength but k d at 490 nm wavelength is clearly an underestimate of the k d for the 400 700 nm waveband see fig 5 b of skákala et al 2020 we can also understand the gradually increasing impact of biogeochemistry on temperature between the 1 way rgb cc 2 way rgb sc and 2 way runs fig 4 b d the rgb scheme using constant chlorophyll 1 way rgb cc fig 4 b used in lengaigne et al 2007 o dea et al 2017 graham et al 2018 to represent oligotrophic open ocean waters clearly underestimates the overall chlorophyll concentrations in the shelf seas and leads to unrealistically small attenuation of underwater radiance the attenuation is increased by the more realistic simulated chlorophyll in the 2 way rgb sc run fig 4 c but it remains weak when compared to the 2 way scheme since 2 way rgb sc neglects the impact of pom cdom and sediment on the light attenuation these non living optically active constituents can be potentially neglected in the open ocean e g lengaigne et al 2007 but become more relevant in the coastal and shelf sea waters as these results demonstrate the 2 way scheme fig 4 d incorporates the impact of all phytoplankton pom cdom and sediment on the underwater radiance and therefore demonstrates the greatest impact of biogeochemistry on temperature the sensitivity of physics to biogeochemical attenuation scheme that we observed here is also broadly consistent with an older modelling study of baird et al 2007 focusing on the seas near the south eastern coast of australia which has found that the simulated temperature vertical profiles and some ocean circulation patterns were significantly impacted by the chlorophyll vertical attenuation scheme the shift in the bloom timing shown in fig 8 nicely matches with the regions where there is the largest biogeochemical impact on temperature fig 3 a this indicates that although the bloom timing was shown not to be very sensitive to the changes in convective mixing e g fig 6 the small changes to the bloom timing can be understood from the critical turbulence hypothesis as outlined in fig 1 in reality the late bloom could be explained by multiple components within the physical biogeochemical coupled model such as atmospheric wind stress forcing nemo upper ocean mixing scheme vertical stratification thermocline and pycnocline incoming surface par underwater light attenuation the phytoplankton growth response to light e g ersem parameters such as p i curves or maximum pft chlorophyll to carbon ratios ersem representation of top down grazing or missing processes such as mixotrophy e g leles et al 2018 from the variety of drivers that could contribute to the bloom timing only a small fraction was so far addressed i e skákala et al 2020 have showed that the late bloom is most likely not related to a problem with the underwater radiances whilst in this study we similarly addressed the vertical stratification diagnosing the true cause of the late phytoplankton bloom thus remains a challenge for the future although the modest improvements to the simulated chlorophyll by the 2 way model originate from its changes to the simulated physics i e vertical mixing it might seem surprising that the physical data assimilation which substantially improves the simulated physics fig 9 does not improve and even slightly degrades the model skill in chlorophyll fig 10 a this is likely because the physical data assimilation is for the large part an assimilation of sst the improvement in the ecosystem model skill depends mostly on the vertical mixing and limited changes to vertical mixing are expected by assimilating sst assimilated subsurface temperature and salinity data are quite sparse and have only a limited impact on the modelled biogeochemistry in the case of the cabot glider case study the glider temperature and salinity assimilation did not improve the simulated chlorophyll at the glider locations fig 10 a mostly because the impact of physics on biogeochemistry needs some spin up time in fact in the last part of the glider mission period late july august the physical assimilation has some potential to improve the chlorophyll concentrations as was demonstrated by the assimilation of the same cabot glider data in fig 6e of skákala et al 2021 there is only negligible difference in the skill between the phys chl da 1 way and phys chl da 2 way runs figs 9 and 10 this suggests that physical and chlorophyll assimilation dominates over the two way coupling and hence for an operational system that includes assimilation of both physics and biogeochemistry the transition to two way coupling may produce only marginal difference in the system skill such difference might certainly be more significant for system forecasts than for the analyses forecasting was not explored in this study however on the 1 day time scale the forecast differences were captured by the difference in innovations defined as background minus observations and this was found to be negligible e g the 2018 and spatial mean difference in the sst innovations between the phys chl da 1 way and phys chl da 2 way runs was found to be less than 0 01 c 5 summary in this work we used a recent implementation of an oasim based spectrally resolved bio optical module into a physical biogeochemical model of the north west european shelf nwes skákala et al 2020 and expanded it to drive also the oceanic heat fluxes introducing a feedback from the biogeochemical model to the physics we call the models with such feedback two way coupled models we used this development to estimate the scale of the biogeochemical impact on physics on the nwes and we have shown that during late spring and summer when the water column is stratified biogeochemical tracers can heat up the upper 20 m of the water column by 1 c and cool down the ocean beneath the upper 20 m by a similar margin the seasonal impact of biogeochemistry on physics propagates deeper into the water column with oceanic inertia and is visible down to 200 m depth impact of biogeochemistry on heating of the uppermost oceanic layer influences ocean vertical mixing and shallows the mixing depth across the nwes by up to 20 these results suggest that it is important to represent the coupling from biogeochemistry to physics adequately in our models we have looked at different light schemes used in the literature e g lengaigne et al 2007 o dea et al 2017 graham et al 2018 skákala et al 2018 that incorporate biogeochemical impact on light attenuation either within a two way coupled model or as an external parametrization or forcing e g using 490 nm k d satellite product we have shown that the simulated physics is reasonably sensitive to the different light schemes i e both to spectral resolution and the number of represented bio optical tracers in the last part of this study we discussed the likely impact of introducing two way coupling into the present operational cmems system for the nwes we have shown that the newly developed two way coupled model based on the spectrally resolved bio optical module increases the heat captured in the upper part of the water column relative to the existing system which represents the underwater attenuation by an external 490 nm k d satellite product the two way coupling steepens the vertical temperature gradient shallows the mixed layer depth and reduces convective mixing the reduced vertical mixing has a modest but positive impact on the timing of the late bloom displayed by the biogeochemical model in line with the critical turbulence hypothesis the shift in the timing of the bloom in the two way coupled model improves the model skill in representing chlorophyll we conclude that for a more substantial improvement of the timing of the bloom it will be necessary to either improve the physical model mixing scheme or to improve the process description or parametrization of the biogeochemical model we have expanded our analysis to include other biogeochemical tracers and found that the two way coupled model and the physical data assimilation may sometimes help improve the agreement of simulated oxygen concentrations and co2 fugacity with observations both due to improved simulation of the sea water temperature saturation levels and productivity although the two way coupled model performs slightly better than the existing one way coupled model it was found that the difference between those two becomes negligible whenever we include assimilation of physical data and chlorophyll in the future it would be desirable to explore how much the impact of the two way coupling increases during the 6 day operational forecasting period moreover physical biogeochemical assimilative runs on the nwes including this work are typically only weakly coupled for one recent exception see goodliff et al 2019 in the sense that the physical and the biogeochemical variables are updated independently and interact only through the model dynamics the interaction between physics and biogeochemistry would be much more efficient if the assimilative updates to the physics and biogeochemistry interacted directly through their cross covariances or a balancing component within the data assimilation system such scheme is called strongly coupled and would provide the physical assimilation with both faster and greater impact on the biogeochemical model skill and vice versa future work will use the improved physical biogeochemical coupling in the two way coupled model to inform the development of the data assimilation scheme to include such strong coupling in our operational system credit authorship contribution statement jozef skákala conceptualization formal analysis investigation methodology software validation visualization writing original draft writing review editing jorn bruggeman funding acquisition software supervision david ford conceptualization software supervision writing original draft writing review editing sarah wakelin software writing review editing anıl akpınar data curation writing original draft tom hull data curation writing original draft jan kaiser data curation writing original draft benjamin r loveday data curation writing original draft writing review editing enda o dea supervision charlotte a j williams data curation writing original draft stefano ciavatta funding acquisition project administration writing original draft declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this work was supported by a natural environment research council nerc funded project of the marine integrated autonomous observing systems miaos programme combining autonomous observations and models for predicting and understanding shelf seas campus it also benefitted from another nerc funded project alternative framework to assess marine ecosystem functioning in shelf seas altereco http projects noc ac uk altereco grant no ne p013899 1 the work also benefited from the copernicus marine environment monitoring service cmems funded projects optical data modelling and assimilation optima and nowmaps furthermore this work was also partially funded by the seamless project which received funding from the european union s horizon 2020 research and innovation programme under grant agreement no 101004032 we would like to thank dawn ashby for drawing the schematic fig 1 the ocean colour data were provided by the european space agency climate initiative ocean color https esa oceancolour cci org the glider data used in the study http dx doi org 10 5285 b57d215e 065f 7f81 e053 6c86abc01a82 and http dx doi org 10 5285 b58e83f0 d8f3 4a83 e053 6c86abc0bbb5 are publicly available on https www bodc ac uk data published data library catalogue we also used l4 time series for chlorophyll a concentrations provided by the western channel observatory https www westernchannelobservatory org uk the model was forced by the atmospheric era5 product of the european centre for medium range weather forecasts ecmwf https www ecmwf int the river forcing data used by the model were prepared by sonja van leeuwen and helen powley as part of uk shelf seas biogeochemistry programme contract no ne k001876 1 of the nerc and the department for environment food and rural affairs defra we acknowledge use of the monsoon system a collaborative facility supplied under the joint weather and climate research programme a strategic partnership between the met office and the nerc the different outputs for the free run simulations and reanalyses are stored on the monsoon storage facility mass and can be obtained upon request appendix a supplementary data supplementary material related to this article can be found online at https doi org 10 1016 j ocemod 2022 101976 appendix a supplementary data the following is the supplementary material related to this article mmc s1 supplementary material containing 4 additional figures 
23849,we use modelling and assimilation tools to explore the impact of biogeochemistry on physics in the shelf sea environment using north west european shelf nwes as a case study we demonstrate that such impact is significant the attenuation of light by biogeochemical substances heats up the upper 20 m of the ocean by up to 1 c and by a similar margin cools down the ocean within the 20 200 m range of depths we demonstrate that these changes to sea temperature influence mixing in the upper ocean and feed back into marine biology by influencing the timing of the phytoplankton bloom as suggested by the critical turbulence hypothesis we compare different light schemes representing the impact of biogeochemistry on physics and show that the physics is sensitive to both the spectral resolution of radiances and the represented optically active constituents we introduce a new development into the research version of the operational model for the nwes in which we calculate the heat fluxes based on the spectrally resolved attenuation by the simulated biogeochemical tracers establishing a two way coupling between biogeochemistry and physics we demonstrate that in the late spring summer the two way coupled model increases heating in the upper oceanic layer compared to the existing model and improves by 1 3 days the timing of the simulated phytoplankton bloom this improvement is relatively small compared with the existing model bias in bloom timing but is sufficient to have a visible impact on model skill in the free run we also validate the skill of the two way coupling in the context of the weakly coupled physical biogeochemical assimilation currently used for operational forecasting of the nwes we show that the change to the skill is negligible for analyses but it remains to be seen how much it differs for the forecasts keywords impact of biogeochemistry on physics two way coupled physical biogeochemical model ocean chlorophyll concentration sea surface temperature phytoplankton spring bloom north west european shelf 10e 10w 40n 68n data assimilation operational systems 1 introduction within the earth system physics and biology mutually interact in many non trivial ways in the marine environment biological processes are driven by physical transport mixing temperature salinity and the incoming light whereas biology impacts physics through its role in the carbon cycle microbial and biological pump e g riebesell et al 2009 oceanic albedo jin et al 2004 underwater light attenuation morel 1988 simonot et al 1988 sathyendranath et al 1991 edwards et al 2004 oschlies 2004 manizza et al 2005 marzeion et al 2005 sweeney et al 2005 lengaigne et al 2007 jochum et al 2010 zhai et al 2011 turner et al 2012 and its influence on cloud condensation nuclei through the production of dimethyl sulphide dms lovelock et al 1972 charlson et al 1987 six et al 2013 schwinger et al 2017 or through bubble formation wilson et al 2015 while the impact of physics on biology is never neglected or disputed the impact of biology on physics became often a matter of controversy for example in connection with the gaia hypothesis lovelock 1979 2000 which proposes that life plays a central role in regulating climate marine model development largely reflects this underlying scientific attitude i e the common way to simplify complex coupled physical biogeochemical dynamics is to neglect the impact of the simulated biogeochemistry on physics heinze and gehlen 2013 gehlen et al 2015 ford et al 2018 so that the physical component can be run entirely independently of the biogeochemical model we will further call such models one way coupled the most obvious source of biogeochemical feedback to physics in coupled physical biogeochemical ocean models is the attenuation of underwater radiances by optically active biogeochemical tracers and the subsequent impact on heat fluxes temperature and mixed layer depth mld one way coupled models either do not represent this effect at all or they incorporate it offline based on external forcing such as using observational products for surface diffuse attenuation coefficients e g madec et al 2015 however since our overall goal is to realistically represent environmental processes or to produce reliable global climate projections it is a matter of importance to better understand both the biogeochemical impact on ocean physics and the sensitivity of the simulated physics to how precisely such an impact is incorporated into the physical model only by answering these two questions can we see to what extent the simplifications usually adopted in our models are justified studies have looked at the impact of biogeochemical light attenuation on marine physics e g in the north atlantic oschlies 2004 tropical pacific lengaigne et al 2007 and globally manizza et al 2005 demonstrating that the impact can be substantial but regionally dependent however the studies so far largely focused on the open ocean that dominates the global scales and there is a lack of a more detailed study of such impact in the shelf sea environment shelf seas are highly productive parts of the ocean borges et al 2006 jahnke 2010 which makes them particularly relevant to study the complex interaction between biogeochemistry and physics in this study we will employ state of the art modelling tools e g skákala et al 2020 to estimate the impact of biogeochemical tracers on vertical light and heat attenuation on the north west european shelf nwes a region of particular interest for the european economy pauly et al 2002 and carbon cycle borges et al 2006 jahnke 2010 furthermore we will determine how sensitive the physical model of the nwes is to the adopted light scheme used to drive the heat fluxes in the water column as part of the work described in this study we implemented into the physical model within a research version of the copernicus marine environment monitoring service cmems operational system for the nwes a state of the art representation of underwater radiances this uses the spectrally resolved bio optical module from skákala et al 2020 based on the oasim model of gregg and casey 2009 since the attenuation in the newly implemented module is calculated using the simulated biogeochemical tracers the physics now depends on the simulated biogeochemistry henceforth we will refer to such models as two way coupled for examples see oschlies 2004 manizza et al 2005 lengaigne et al 2007 we will provide a detailed evaluation of the updated system performance including the weakly coupled physical biogeochemical data assimilation the aim of this evaluation is to provide a recommendation of whether the new set up should be considered for operational use a specific problem of focus for this study is the impact of the changed physics within the newly introduced two way coupled model on the simulated biogeochemistry the existing cmems operational system is one way coupled and it has been argued skákala et al 2020 that it may be underestimating the heating in the upper ocean at least relative to the newly introduced two way coupled model the expected increase in upper ocean heating due to two way coupling is likely to reduce convective mixing in the upper ocean taylor and ferrari 2011 smyth et al 2014 which may change the timing of the spring phytoplankton bloom as per the critical turbulence hypothesis huisman et al 1999 waniek 2003 to be more specific although many factors can influence the bloom timing including biological drivers such as zooplankton grazing e g behrenfeld and boss 2018 the critical turbulence hypothesis is one of the leading hypotheses for how blooms are triggered in the north atlantic suggesting that the bloom happens when the effective mixing depth is fully contained within the lit layer reducing convective mixing can then reduce the effective mixing depth and trigger an earlier phytoplankton bloom for the mechanism see the schematic in fig 1 which would be desirable as the current operational model is known to produce late and intense spring blooms skákala et al 2020 2021 since a spring bloom is a major ecosystem driver on the nwes lutz et al 2007 henson et al 2009 any improvements in bloom timing could have an important knock on effect on the biogeochemical model skill the questions outlined in this study will be addressed by analysing outputs of a number of suitably designed free and assimilative runs the paper will be structured as follows firstly we will describe the model light scheme and if present the assimilation set up for the different simulations as well as the methodology on how to validate and compare those different simulations this will be followed by the section describing the results on the sensitivity of temperature to the light attenuation by the biogeochemical tracers as well as to the adopted light scheme and also on the impact of two way coupling and assimilation on the coupled physical biogeochemical model skill in the last part we will discuss our results and outline the directions for future research 2 methods 2 1 the physical model nucleus for european modelling of the ocean nemo the nemo ocean physics component opa is a finite difference hydrostatic primitive equation ocean general circulation model madec et al 2015 the nemo configuration used in this study is similar to the one used by ford et al 2017 skákala et al 2018 2020 and identical to the configuration used in skákala et al 2021 we use the co6 nemo version based on nemov3 6 a development of the co5 configuration explained in detail by o dea et al 2017 the model has 7 km spatial resolution on the atlantic margin model amm7 domain using a terrain following z σ coordinate system with 51 vertical levels siddorn and furner 2013 the lateral boundary conditions for physical variables at the atlantic boundary were taken from the outputs of the met office operational 1 12 north atlantic model natl12 storkey et al 2010 the baltic boundary values were derived from a reanalysis produced by the danish meteorological institute for cmems we used river discharge based on data from lenhart et al 2010 the model was forced at the surface by atmospheric fluxes provided by an hourly and 31 km resolution realization hres of the era5 data set https www ecmwf int this paper compares several light schemes previously used in the literature to calculate the nemo oceanic heat fluxes for the summary see table 1 i the existing reanalysis version of the operational one way coupled model e g skákala et al 2018 which takes the total incoming net shortwave radiation from the era5 data splits it into visible 400 700 nm and invisible fractions with the visible fraction attenuated inside the water column based on the k d for 490 nm wavelength supplied by a monthly climatology from an ocean color climate change initiative oc cci product of european space agency esa version 4 1 https www esa oceancolour cci org and the invisible waveband attenuated with a constant e folding depth of 0 35 m ii the red green blue rgb scheme by lengaigne et al 2007 which uses the visible fraction of light spectrally resolved into 3 wavebands blue 400 500 nm green 500 600 nm and red 600 700 nm and attenuates it by the sea water and phytoplankton chlorophyll by default chlorophyll is taken to be a constant 0 05 mg m3 a minimal value representative of oligotrophic waters as in lengaigne et al 2007 o dea et al 2017 graham et al 2018 alternatively chlorophyll can be simulated by a biogeochemical model as in lengaigne et al 2007 both these chlorophyll schemes will be included into our study iii the two way coupled run using the implementation of a bio optical module based on the oasim model gregg and casey 2007 gregg and rousseaux 2016 skákala et al 2020 providing spectrally in 33 wavebands resolved radiance decomposed into direct and diffuse streams for a detailed description of the bio optical module and the attenuation scheme see the next section describing the european regional seas ecosystem model ersem model iv we will also use the scheme based on the bio optical module to simulate the attenuation by clear water only to provide a baseline run for the comparison of how biology and the different light schemes impact physics on the nwes in each of the previous cases the underwater radiances are at every vertical level integrated by nemo to calculate the heating within each vertical layer as 1 d t d t d i d z 1 c ρ where t is temperature t is time d i is for each vertical model layer the difference between the irradiance penetrating the top of a grid box and that leaving the bottom d z is the vertical distance between the top and bottom of the grid box c is heat capacity and ρ is the reference water density 2 2 the ecosystem model the european regional seas ecosystem model ersem ersem baretta et al 1995 butenschön et al 2016 marine systems modelling group 2020 is a lower trophic level ecosystem model for marine biogeochemistry pelagic plankton and benthic fauna blackford 1997 in this study ersem is coupled to the physical model nemo using framework for aquatic biogeochemical models fabm bruggeman and bolding 2014 2020 ersem splits phytoplankton into four functional types largely based on their size baretta et al 1995 picophytoplankton nanophytoplankton diatoms and dinoflagellates ersem uses variable stoichiometry for the simulated plankton groups geider et al 1997 baretta bekker et al 1997 and each phytoplankton functional type pft biomass is represented in terms of chlorophyll carbon nitrogen and phosphorus with diatoms also represented by silicon ersem predators are composed of three zooplankton types mesozooplankton microzooplankton and heterotrophic nanoflagellates with organic material being decomposed by one functional type of heterotrophic bacteria butenschön et al 2016 the ersem inorganic component consists of nutrients nitrate phosphate silicate ammonium and carbon and dissolved oxygen the carbonate system is also included in the model artioli et al 2012 we applied in this study the ersem configuration from skákala et al 2021 based on a new ersem version 20 10 which has an updated benthic component with respect to butenschön et al 2016 the ersem parametrization is identical to the one described in butenschön et al 2016 the atlantic boundary values for nitrate phosphate silicate and oxygen were taken from world ocean atlas garcia et al 2013 and dissolved inorganic carbon from the glodap gridded dataset key et al 2015 lauvset et al 2016 while plankton and detritus variables were set to have zero fluxes at the atlantic boundary the irradiance at the ocean surface was calculated for all the runs using the bio optical module implemented into the nemo fabm ersem amm7 configuration by skákala et al 2020 the bio optical module resolves irradiance spectrally 33 wavebands in the 250 3700 nm range and distinguishes between downwelling direct and diffuse streams the module is forced by the era5 atmospheric inputs https www ecmwf int for total vertically integrated ozone water vapour cloud cover cloud liquid water and sea level air pressure as well as by a satellite product for aerosol optical thickness moderate resolution imaging spectroradiometer modis https modis gsfc nasa gov data dataprod and also by data for surface wind speed air humidity and air temperature all provided by the nemo atmospheric era5 forcing the attenuation of the irradiance was described in detail by gregg and rousseaux 2016 skákala et al 2020 here it is briefly summarized the module distinguishes between the absorption and scattering by the sea water and the 4 pfts based on the wavelength dependent absorption total scattering and backscattering coefficients from gregg and rousseaux 2016 although we included the impact of backscattering on the light attenuation similarly to skákala et al 2020 we argue that explicitly tracking the upwelling stream can be reasonably neglected besides the clear sea water and pfts we included into the light attenuation also the absorption by pom cdom and sediment which was the same as in skákala et al 2020 forced by an external product extrapolated from the 443 nm data of smyth and artioli 2010 the bio optical module was extensively validated in skákala et al 2020 and was shown to be skilled in its representation of swr par and the underwater irradiances finally all the ersem simulations in this study used the bio optical module described in the previous paragraph but in the case of the no bgc run for abbreviations see table 1 all the attenuation except by the clear sea water was removed the choice of ersem light scheme for the different simulations is justified as follows a the 1 way and 2 way configurations using the bio optical module to force ersem correspond to the latest research version of the cmems system on the nwes the 1 way configuration see skákala et al 2020 and the currently most advanced version of the coupled nemo fabm ersem model on the nwes the 2 way configuration b to sensibly compare the impact of biogeochemistry on physics it is important that the 2 way rgb sc run table 1 uses the same ersem light module as the 2 way run this ensures that the simulated biogeochemical tracers are between the different two way coupled runs consistent to a maximum possible degree in the sense that the only differences in the ersem tracers are caused by the differences in the nemo physics transport mixing temperature triggered by the different nemo light schemes c in case of both no bgc and 1 way rgb cc runs nemo is entirely independent from ersem it is also expected that the physics in the no bgc and 1 way rgb cc will be the most different from the remaining three free simulations to estimate the size of the impact of the nemo simulated physical state on the ersem simulated biogeochemistry relative to the size of the impact of the radiances seen by ersem whilst minimizing the number of necessary simulations included in the study we decided to use the same ersem light scheme for the 1 way rgb cc run as for the 1 way 2 way and 2 way rgb sc runs but using the same light scheme for ersem as in nemo for the no bgc run 2 3 the assimilative system nemovar nemovar is a variational in this study a 3dvar da system mogensen et al 2009 2012 waters et al 2015 used at the met office for operational forecasting and reanalyses on the nwe shelf the assimilation of ocean colour derived chlorophyll using nemovar is highly successful in improving the nwe shelf phytoplankton phenology pft community structure using pft chlorophyll assimilation underwater irradiance and to a more limited degree also carbon cycle skákala et al 2018 2020 kay et al 2019 nemovar includes capability to assimilate multi platform satellite in situ data which has been established first for physics e g waters et al 2015 king et al 2018 and subsequently for biogeochemistry ford 2021 including validating the multi platform da system for the nwes skákala et al 2021 the nemovar set up used in this study for the multi platform physical biogeochemical assimilation is the same as the one described in detail by skákala et al 2021 here we offer only a short summary the 3dvar version of nemovar uses a first guess at appropriate time fgat to calculate a daily set of increments for the directly updated variables waters et al 2015 king et al 2018 in the physical da application nemovar applies balancing relationships within the assimilation step and delivers a set of increments for temperature salinity sea surface height ssh and the horizontal velocity components for the total chlorophyll assimilation nemovar calculates a set of log chlorophyll increments and then a balancing scheme is used to distribute those increments into the pft components chlorophyll carbon nitrogen phosphorus and for diatoms also silicon all of which are updated based on the background community structure and stoichiometric ratios e g skákala et al 2018 2020 2021 after the assimilation step the model is re run with the increments applied to the model variables gradually at each model time step using incremental analysis updates iau bloom et al 1996 nemovar uses externally supplied spatio temporally varying observation and background error variances with the background error variances typically 1 3 times larger than the observational error variances skákala et al 2021 the system combines two horizontal correlation length scales one fixed at 100 km and the other based on the baroclinic rossby radius of deformation king et al 2018 the vertical length scales follow the scheme from king et al 2018 where nemovar calculates directly the set of 3d increments using flow dependent vertical length scales ℓ which are at the surface equal to half of the mld decreasing in the mixed layer to become two times the vertical model grid spacing at and beneath the mld 2 4 observations assimilated and validation data 2 4 1 assimilated data in the physical data assimilation component we have included a sea surface temperature data from the gcom w1 amsr 2 noaa avhrr metop avhrr msg seviri sentinel 3 slstr suomi npp viirs satellite products and in situ sst observations from ships surface drifters and moorings distributed over the global telecommunication system gts in near real time b temperature and salinity from the en4 dataset good et al 2013 which includes in situ profiles from argo floats fixed moored arrays xbts ctds gliders marine mammals and c temperature and salinity data from a specific slocum glider cabot unit 345 see skákala et al 2021 that was deployed in the central north sea during 08 05 2018 15 08 2018 as a part of the alternative framework to assess marine ecosystem functioning in shelf seas altereco programme https altereco ac uk the satellite sst was bias corrected following the scheme from while and martin 2019 using the viirs and in situ sst data as the reference in the biogeochemical data assimilation we have included total log chlorophyll derived from the version 4 2 of the european space agency esa ocean colour oc climate change initiative cci product sathyendranath et al 2019 and also log chlorophyll derived from the quenching corrected fluorescence measurements by the same altereco glider cabot that was used in the physical data assimilation the assimilation is performed for log chlorophyll rather than chlorophyll as chlorophyll is widely known to be log normally distributed campbell 1995 the assimilated in situ en4 and glider observations were thinned to a resolution of 0 08 en4 or up scaled to the amm7 grid glider with additional temporal averaging applied to the same day glider observations the thinning up scaling is performed to avoid assimilating many observations at higher resolution than the model can represent after the thinning up scaling there were o 1 0 5 en4 and o 1 0 4 cabot glider data points to assimilate throughout the year 2018 2 4 2 validation data the assimilated data mentioned in the previous section were also used to validate every experiment where they were excluded from the assimilation e g assimilated chlorophyll data were used to validate free runs and the physical data assimilative runs however we excluded the bias corrected satellite sst from the temperature validation so that the only assimilated sst data used for validation were a the high quality sst data from the viirs satellite product and from ships drifters and moorings we will call this viirs in situ sst data and the sst that was part of b en4 and c cabot glider data besides the assimilated observations all the experiments were validated with other non assimilated altereco glider data for temperature salinity chlorophyll oxygen and the sum of nitrate and nitrite all the gliders included in the validation are listed in table 2 the processing of the physical chlorophyll and oxygen data was described in skákala et al 2021 the sum of nitrate and nitrite concentrations abbreviated as no x no 3 no 2 were determined using a lab on chip loc analyser designed and fabricated at the national oceanography centre beaton et al 2012 which was implemented by the altereco team into seagliders following a similar protocol as used by vincent et al 2018 the combined uncertainty random and systematic errors of measurements made using these loc analysers has been calculated as 5 coverage interval k 1 birchill et al 2019 the nitrite concentrations were relatively negligible compared to the nitrate concentrations so the no x data were used to validate model nitrate outputs all the data used here is from altereco gliders that were in operation in the central north sea during 2018 for both the glider and the en4 data locations see fig s1 of the supporting information si moving throughout the whole water column similar to the assimilated cabot glider the remaining glider data were up scaled onto the model grid on a daily basis and after the up scaling there remained o 1 0 4 altereco glider observations for each variable in 2018 the en4 data set contained subsurface observations that were approximately homogeneously distributed both with depth and in time with a slightly lower number of observations towards the end of the year november december 2018 beyond the assimilated data and the altereco data we used for validation a 1960 2014 monthly climatological dataset for total chlorophyll oxygen nitrate phosphate and silicate concentrations compiled during the north sea biogeochemical climatology nsbc project hinrichs et al 2017 the nsbc dataset covers most of the nwe shelf and the full range of depths finally we also included validation of surface co2 fugacity using 2018 socat v2019 data https www socat info index php about 2 5 the experiments as outlined in table 1 we have run multiple free simulations including both one way coupled and two way coupled runs we also tested the impact of assimilating different types of data physical only biogeochemical only and physical and biogeochemical jointly see table 3 on the skill of both 1 way and the 2 way models the various free and assimilative experiments used exactly the same model configuration apart from the differences outlined in tables 1 and 3 the experiments all started from the same initial value conditions on the 01 09 2017 to allow a 4 month spin up time for the final 2018 simulation the initial values were provided by the 2016 2018 free simulation using bio optical module from the study of skákala et al 2020 2 6 skill metrics the performance of the different simulations is evaluated using two skill metrics the first metric is the model bias δ q m o 2 δ q m o q m q o where q o are the observations mapped into the model grid and the q m are the corresponding model outputs the second metric is the bias corrected root mean square difference bc rmsd δ r d q m o 3 δ r d q m o q m q o δ q m o 2 3 results 3 1 the impact of biogeochemistry on physics on the nwes to determine the overall impact of biogeochemical light attenuation on the nwes temperature vertical profiles we compare the simulation based on the bio optical module using only clear water attenuation no bgc with the two way coupled run using the bio optical module and assimilating chlorophyll into the model chl da 2 way the chl da 2 way run is chosen because it provides us with the best representation of the biogeochemical feedback to physics including the most realistic simulation of the phytoplankton distributions fig 2 shows that nwes biogeochemistry has a substantial impact on the simulated temperature in the late spring summer heating up the upper 20 m in the water column and cooling down the water column beneath the mixed layer almost down to the 200 m depth the temperature variations due to biogeochemistry are in the warmest summer period on the scale of 1 c the geographical impact of biogeochemistry on temperature fig 3 a is largest in the northern part of the north sea conversely it is by far the lowest in the english channel and the southern part of the north sea the heating of the uppermost ocean layer has an important impact up to 20 on the mixing depth which is consistently shallowed by the biogeochemistry across the whole nwes fig 3 c all the results presented in this section are broadly consistent with the findings of manizza et al 2005 for the global domain and oschlies 2004 more specifically for the north atlantic domain 3 2 comparing the impact of different light schemes on physics we compare the sensitivity of simulated temperature and mld to the light schemes incorporating the impact of biogeochemistry on the light attenuation seen by the nemo physical model table 1 figs 4 and 5 compare the temperature of all the simulations using different light schemes to the no bgc run fig 4 shows that the two way coupled model based on the bio optical module 2 way panel d produces an increase of near surface attenuation and hence sea temperature when compared to the one way coupled run forced by an external satellite product 1 way panel b for direct comparison between the two runs see also fig s2 of the supporting information si since the physical model skill depends on many components within the complex model there can be many error compensations skákala et al 2020 it is therefore hard to validate the performance of the nemo light scheme independently of the specific context in which it was implemented however fig 5 should still give an indication of how the different light schemes compare with the 3d glider observations along the glider trajectory fig 5 illustrates that neglecting the biogeochemical impact on light attenuation in the no bgc run produces a spurious heating effect of up to 3 c beneath the upper 30 m in the water column including biogeochemical impact on the temperature reduces this model bias to below 1 c fig 5 b e 3 3 the sensitivity of biogeochemistry to the changes in underwater radiance and mixing ersem is known to simulate a late phytoplankton spring bloom on the nwes e g figs 6 and 7 as suggested by the critical turbulence hypothesis the bloom timing depends on both the light seen by the phytoplankton and vertical mixing e g fig 1 the ersem sensitivity to light is demonstrated by the no bgc simulation due to absence of biogeochemical impact on the underwater radiances in the no bgc run there is an excess of light deep within the water column and this provides despite the deep winter mixing good phytoplankton growth conditions over the winter with an early bloom triggered around late february fig 6 b the only seriously limiting factor to the surface chlorophyll abundance in the no bgc run seem to be nutrients in the post bloom period fig 6 b in the remaining free run simulations ersem always uses the same light scheme but the physical nemo model does not the different light schemes in the physical model produce different vertical mixing and slightly modify the timing of the phytoplankton bloom fig 6 c d for example the increased near surface absorption in the 2 way model increases heating in the upper oceanic layer with respect to the 1 way run fig 4 b d reduces convective mixing and for most of the nwes moves the model bloom towards the start of the year by 1 3 days but in some specific locations e g in the central north sea the bloom can be as much as 5 days earlier in the 2 way run than in the 1 way run fig 6 c e fig 7 c fig 8 3 4 the potential impact of two way coupling on the skill of the cmems operational system introducing two way coupling into the cmems operational model would correspond to a transition from the 1 way to the 2 way model set up but also include the assimilation of physical and biogeochemical data as previously discussed in the free run the transition from 1 way to 2 way run produces extra heating in the upper 20 m of the ocean increasing sea temperature by around 1 c and by a similar margin cooling down the 20 100 m layer beneath the surface compare fig 4 a and fig 4 d fig s2 b of the si this marginally shallows the mld fig 4 e in the summer may october when the impact of two way coupling is largest the 2 way run reduces the temperature bias of the 1 way run however it increases the sst bias and bc rmsd fig 9 a in the winter november april the impact of two way coupling on the model temperature is also mixed fig 9 b as it is for salinity throughout the whole year fig 9 c d the changes to physics introduced by the 2 way set up relative to 1 way have a positive impact on the timing of the phytoplankton bloom fig 6 c e fig 7 c which leads to improvement in model skill in representing phytoplankton chlorophyll a fig 10 a interestingly correcting phytoplankton phenology through the oc chlorophyll assimilation has also a positive impact on the simulated temperature and salinity in the 2 way run fig 9 fig 9 also demonstrates that the physical temperature and salinity assimilation substantially improves model skill in representing both temperature fig 9 a b and salinity fig 9 c d the physical data assimilation influences the simulated temperature more evenly across the water column than the bio optical module fig s2 of si which is likely a combination of model dynamical response to the temperature increments in the mixed layer and some assimilated sub surface data en4 and cabot glider the chlorophyll assimilation improves the simulated chlorophyll fig 10 a and dominates over both physical assimilation and two way coupling in its impact on the simulated chlorophyll concentrations across the whole water column over the whole simulation year fig s3 of si that this would be the case is not obvious as the chlorophyll assimilation is almost entirely based on the satellite oc and chlorophyll beneath the mixed layer is updated mostly through the model dynamical adjustment the bloom dynamics is also corrected by the chlorophyll assimilation fig s4 of si which is consistent with the previous studies skákala et al 2020 2021 to get a more complete view of the impact of two way coupling on the simulated biogeochemistry we also looked at the available data for oxygen co2 fugacity nitrate phosphate and silicate fig 10 shows that the two way coupling may also improve the modelled oxygen fig 10 b and co2 fugacity fig 10 c which is in both cases a combined result of changes to air sea fluxes due to changes in sea temperature and therefore gas saturation levels to the primary productivity change to bloom timing and consequently also changes to respiration levels physical and chlorophyll a assimilation tend to have additional positive impact on oxygen and co2 fugacity fig 10 b c the impact of the two way coupled model on nutrients is mostly driven by the changes to primary productivity and phytoplankton and is shown to be fairly negligible fig 10 c f these results are broadly consistent with the previous literature skákala et al 2018 2020 which showed that chlorophyll a assimilation can have an important impact on the nutrient concentrations but often has a mixed effect in terms of the model skill to represent nutrients fig 10 4 discussion on the nwes there is a strong seasonal dependence of the biogeochemical impact on temperature fig 2 which can be easily understood in the late autumn to early spring period the water column is very well mixed and this averages out the vertical changes to heating caused by the presence of biogeochemical tracers in the late spring when the water column becomes much more stratified the biogeochemical substances trap light and heat in the uppermost layer gradually cooling down the ocean beneath the upper 20 m however due to oceanic inertia the impact of extra near surface heating introduced by the biogeochemical substances propagates only slowly downwards producing an increasingly delayed response approximately on a monthly scale as one looks deeper into the water column fig 2 c similarly to the winter period the lack of biogeochemical impact on physics around the english channel fig 3 can be explained by the high levels of vertical mixing in this area see o dea et al 2012 the 2 way run produces large extra heating in the uppermost layer also relative to the 1 way run fig 4 a d although in theory the bio optical module used to drive biogeochemistry produces different incoming radiation than the era5 forcing data used to force physics in the 1 way run it has been shown that there is a negligible mutual bias between the module and era5 skákala et al 2020 therefore the temperature increase is likely a consequence of an increased rate of absorption inside the upper oceanic layer rather than resulting from an enhanced shortwave radiation flux into the water column the increased absorption in the 2 way run was anticipated since a in a previous study skákala et al 2020 the bio optical module appeared to have higher levels of light attenuation near the water surface than the satellite observations used to force the physics in the one way coupled run b the broadband visible light attenuation in the 1 way run was represented by the satellite k d for 490 nm wavelength but k d at 490 nm wavelength is clearly an underestimate of the k d for the 400 700 nm waveband see fig 5 b of skákala et al 2020 we can also understand the gradually increasing impact of biogeochemistry on temperature between the 1 way rgb cc 2 way rgb sc and 2 way runs fig 4 b d the rgb scheme using constant chlorophyll 1 way rgb cc fig 4 b used in lengaigne et al 2007 o dea et al 2017 graham et al 2018 to represent oligotrophic open ocean waters clearly underestimates the overall chlorophyll concentrations in the shelf seas and leads to unrealistically small attenuation of underwater radiance the attenuation is increased by the more realistic simulated chlorophyll in the 2 way rgb sc run fig 4 c but it remains weak when compared to the 2 way scheme since 2 way rgb sc neglects the impact of pom cdom and sediment on the light attenuation these non living optically active constituents can be potentially neglected in the open ocean e g lengaigne et al 2007 but become more relevant in the coastal and shelf sea waters as these results demonstrate the 2 way scheme fig 4 d incorporates the impact of all phytoplankton pom cdom and sediment on the underwater radiance and therefore demonstrates the greatest impact of biogeochemistry on temperature the sensitivity of physics to biogeochemical attenuation scheme that we observed here is also broadly consistent with an older modelling study of baird et al 2007 focusing on the seas near the south eastern coast of australia which has found that the simulated temperature vertical profiles and some ocean circulation patterns were significantly impacted by the chlorophyll vertical attenuation scheme the shift in the bloom timing shown in fig 8 nicely matches with the regions where there is the largest biogeochemical impact on temperature fig 3 a this indicates that although the bloom timing was shown not to be very sensitive to the changes in convective mixing e g fig 6 the small changes to the bloom timing can be understood from the critical turbulence hypothesis as outlined in fig 1 in reality the late bloom could be explained by multiple components within the physical biogeochemical coupled model such as atmospheric wind stress forcing nemo upper ocean mixing scheme vertical stratification thermocline and pycnocline incoming surface par underwater light attenuation the phytoplankton growth response to light e g ersem parameters such as p i curves or maximum pft chlorophyll to carbon ratios ersem representation of top down grazing or missing processes such as mixotrophy e g leles et al 2018 from the variety of drivers that could contribute to the bloom timing only a small fraction was so far addressed i e skákala et al 2020 have showed that the late bloom is most likely not related to a problem with the underwater radiances whilst in this study we similarly addressed the vertical stratification diagnosing the true cause of the late phytoplankton bloom thus remains a challenge for the future although the modest improvements to the simulated chlorophyll by the 2 way model originate from its changes to the simulated physics i e vertical mixing it might seem surprising that the physical data assimilation which substantially improves the simulated physics fig 9 does not improve and even slightly degrades the model skill in chlorophyll fig 10 a this is likely because the physical data assimilation is for the large part an assimilation of sst the improvement in the ecosystem model skill depends mostly on the vertical mixing and limited changes to vertical mixing are expected by assimilating sst assimilated subsurface temperature and salinity data are quite sparse and have only a limited impact on the modelled biogeochemistry in the case of the cabot glider case study the glider temperature and salinity assimilation did not improve the simulated chlorophyll at the glider locations fig 10 a mostly because the impact of physics on biogeochemistry needs some spin up time in fact in the last part of the glider mission period late july august the physical assimilation has some potential to improve the chlorophyll concentrations as was demonstrated by the assimilation of the same cabot glider data in fig 6e of skákala et al 2021 there is only negligible difference in the skill between the phys chl da 1 way and phys chl da 2 way runs figs 9 and 10 this suggests that physical and chlorophyll assimilation dominates over the two way coupling and hence for an operational system that includes assimilation of both physics and biogeochemistry the transition to two way coupling may produce only marginal difference in the system skill such difference might certainly be more significant for system forecasts than for the analyses forecasting was not explored in this study however on the 1 day time scale the forecast differences were captured by the difference in innovations defined as background minus observations and this was found to be negligible e g the 2018 and spatial mean difference in the sst innovations between the phys chl da 1 way and phys chl da 2 way runs was found to be less than 0 01 c 5 summary in this work we used a recent implementation of an oasim based spectrally resolved bio optical module into a physical biogeochemical model of the north west european shelf nwes skákala et al 2020 and expanded it to drive also the oceanic heat fluxes introducing a feedback from the biogeochemical model to the physics we call the models with such feedback two way coupled models we used this development to estimate the scale of the biogeochemical impact on physics on the nwes and we have shown that during late spring and summer when the water column is stratified biogeochemical tracers can heat up the upper 20 m of the water column by 1 c and cool down the ocean beneath the upper 20 m by a similar margin the seasonal impact of biogeochemistry on physics propagates deeper into the water column with oceanic inertia and is visible down to 200 m depth impact of biogeochemistry on heating of the uppermost oceanic layer influences ocean vertical mixing and shallows the mixing depth across the nwes by up to 20 these results suggest that it is important to represent the coupling from biogeochemistry to physics adequately in our models we have looked at different light schemes used in the literature e g lengaigne et al 2007 o dea et al 2017 graham et al 2018 skákala et al 2018 that incorporate biogeochemical impact on light attenuation either within a two way coupled model or as an external parametrization or forcing e g using 490 nm k d satellite product we have shown that the simulated physics is reasonably sensitive to the different light schemes i e both to spectral resolution and the number of represented bio optical tracers in the last part of this study we discussed the likely impact of introducing two way coupling into the present operational cmems system for the nwes we have shown that the newly developed two way coupled model based on the spectrally resolved bio optical module increases the heat captured in the upper part of the water column relative to the existing system which represents the underwater attenuation by an external 490 nm k d satellite product the two way coupling steepens the vertical temperature gradient shallows the mixed layer depth and reduces convective mixing the reduced vertical mixing has a modest but positive impact on the timing of the late bloom displayed by the biogeochemical model in line with the critical turbulence hypothesis the shift in the timing of the bloom in the two way coupled model improves the model skill in representing chlorophyll we conclude that for a more substantial improvement of the timing of the bloom it will be necessary to either improve the physical model mixing scheme or to improve the process description or parametrization of the biogeochemical model we have expanded our analysis to include other biogeochemical tracers and found that the two way coupled model and the physical data assimilation may sometimes help improve the agreement of simulated oxygen concentrations and co2 fugacity with observations both due to improved simulation of the sea water temperature saturation levels and productivity although the two way coupled model performs slightly better than the existing one way coupled model it was found that the difference between those two becomes negligible whenever we include assimilation of physical data and chlorophyll in the future it would be desirable to explore how much the impact of the two way coupling increases during the 6 day operational forecasting period moreover physical biogeochemical assimilative runs on the nwes including this work are typically only weakly coupled for one recent exception see goodliff et al 2019 in the sense that the physical and the biogeochemical variables are updated independently and interact only through the model dynamics the interaction between physics and biogeochemistry would be much more efficient if the assimilative updates to the physics and biogeochemistry interacted directly through their cross covariances or a balancing component within the data assimilation system such scheme is called strongly coupled and would provide the physical assimilation with both faster and greater impact on the biogeochemical model skill and vice versa future work will use the improved physical biogeochemical coupling in the two way coupled model to inform the development of the data assimilation scheme to include such strong coupling in our operational system credit authorship contribution statement jozef skákala conceptualization formal analysis investigation methodology software validation visualization writing original draft writing review editing jorn bruggeman funding acquisition software supervision david ford conceptualization software supervision writing original draft writing review editing sarah wakelin software writing review editing anıl akpınar data curation writing original draft tom hull data curation writing original draft jan kaiser data curation writing original draft benjamin r loveday data curation writing original draft writing review editing enda o dea supervision charlotte a j williams data curation writing original draft stefano ciavatta funding acquisition project administration writing original draft declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this work was supported by a natural environment research council nerc funded project of the marine integrated autonomous observing systems miaos programme combining autonomous observations and models for predicting and understanding shelf seas campus it also benefitted from another nerc funded project alternative framework to assess marine ecosystem functioning in shelf seas altereco http projects noc ac uk altereco grant no ne p013899 1 the work also benefited from the copernicus marine environment monitoring service cmems funded projects optical data modelling and assimilation optima and nowmaps furthermore this work was also partially funded by the seamless project which received funding from the european union s horizon 2020 research and innovation programme under grant agreement no 101004032 we would like to thank dawn ashby for drawing the schematic fig 1 the ocean colour data were provided by the european space agency climate initiative ocean color https esa oceancolour cci org the glider data used in the study http dx doi org 10 5285 b57d215e 065f 7f81 e053 6c86abc01a82 and http dx doi org 10 5285 b58e83f0 d8f3 4a83 e053 6c86abc0bbb5 are publicly available on https www bodc ac uk data published data library catalogue we also used l4 time series for chlorophyll a concentrations provided by the western channel observatory https www westernchannelobservatory org uk the model was forced by the atmospheric era5 product of the european centre for medium range weather forecasts ecmwf https www ecmwf int the river forcing data used by the model were prepared by sonja van leeuwen and helen powley as part of uk shelf seas biogeochemistry programme contract no ne k001876 1 of the nerc and the department for environment food and rural affairs defra we acknowledge use of the monsoon system a collaborative facility supplied under the joint weather and climate research programme a strategic partnership between the met office and the nerc the different outputs for the free run simulations and reanalyses are stored on the monsoon storage facility mass and can be obtained upon request appendix a supplementary data supplementary material related to this article can be found online at https doi org 10 1016 j ocemod 2022 101976 appendix a supplementary data the following is the supplementary material related to this article mmc s1 supplementary material containing 4 additional figures 
