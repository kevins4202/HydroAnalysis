index,text
5920,the satellite precipitation products spps obtained from the satellite soil moisture data through a bottom up approach i e the sm2rain algorithm have been developed and released in recent years however the assessments and the integration of them with the conventional top down spps remain absent over china this study evaluated and integrated for the first time the bottom up sm2rain ascat sm2rasc product and the top down integrated multi satellite retrievals for global precipitation measurement imerg early run product over mainland china the evaluations were conducted at multiple temporal scales using both the continuous and categorical metrics and the integration was implemented through a nudging scheme results indicate that imerg outperforms sm2rasc in terms of cc at the daily scale meanwhile it achieves a better performance than sm2rasc in detecting precipitation events however interestingly imerg performs worse than sm2rasc in terms of cc and nrmse at the monthly scale both imerg and sm2rasc show noticeable seasonal variability regarding the performance with better qualities in the wet seasons than in the dry seasons spatially imerg performs better in the humid subregions than in the semi arid subregions in terms of cc while sm2rasc performs better in the semi arid region than in the other subregions both of them perform relatively worse in the complex mountainous subregion i e the qinghai tibetan plateau and the arid subregion the performances of the spps are closely correlated to the elevations and precipitation magnitudes the correlations and their significances however vary between imerg and sm2rasc and between different time scales and different evaluation metrics the integrated product could increase the median cc by up to 25 86 or 7 23 and reduce the median nrmse by up to 14 72 or 24 62 at the daily or monthly scale in the validation period i e 2012 2017 compared to the parent products this study demonstrated the overall good performance of sm2rasc over mainland china particularly in the semi arid region and meanwhile highlighted the strong benefits of integrating the bottom up and top down spps keywords satellite precipitation products imerg sm2rain ascat performance evaluation data integration mainland china 1 introduction precipitation typically shows strong spatio temporal variability bárdossy and pegram 2013 and is one of the major components in the hydrological cycle and land atmosphere interactions brocca et al 2016 huang et al 2016 accurate and reliable information of precipitation are therefore critical for various fields in geoscience such as hydrological and ecological modeling lima et al 2018 water resource managements supit et al 2012 climate analyses chen et al 2019 flood and drought monitoring hui mean et al 2018 yuan et al 2019 zhong et al 2019 and landslide modeling and forecast brunetti et al 2018 the rain gauge network is the conventional method used to measure precipitation at the point scale nevertheless the density and spatial patterns of the rain gauge networks diverge significantly across the globe kucera et al 2012 without or with scarce gauge stations over the remote mountainous and oceanic regions and the developing countries rozante et al 2018 the satellite precipitation products spps evolve rapidly over the last few decades and offer an alternative and promising approach for obtaining spatially distributed precipitation with relatively high spatiotemporal resolutions huffman et al 2007 xu et al 2017 the primarily advantages of the spps over the rain gauge network lie in that they could estimate precipitation over the ungauged areas and meanwhile have higher capabilities in capturing spatial variability of precipitation at large scales such as the large river basin continent and globe nevertheless because of the indirect retrieval of the precipitation the spps are inherently subjected to some drawbacks arising from the deficiency of the sensors retrieval algorithms and observing frequency ciabatta et al 2015 tian et al 2015 ebrahimi et al 2017 it is therefore necessary and essential to perform an evaluation of the spps before their applications currently there are a series of spps available to the public such as the climate precipitation center morphing method cmorph joyce et al 2004 precipitation estimation from remotely sensed information using artificial neural networks persiann hsu et al 1997 sorooshian et al 2000 and tropical rainfall measuring mission trmm multi satellite precipitation analysis tmpa products huffman et al 2007 among which tmpa is perhaps the most widely used one and brings considerable science contributions and societal benefits nevertheless the tmpa product has a planned end date of december 31 2019 https pmm nasa gov trmm building upon the success of the trmm the global precipitation measurement gpm mission initiated by nasa and the japan aerospace exploration agency jaxa provides the next generation global precipitation estimates at fine spatio temporal resolutions 0 1 0 1 and 30 min hence the integrated multi satellite retrievals for gpm imerg huffman et al 2014 as the successor to tmpa is now the recommended multi satellite dataset to use for various purposes like tmpa the precipitation estimates of the newly released imerg product are based on the conventional and top down approach through the inversion of the atmospheric signals emitted or scattered by hydrometeors kucera et al 2012 brocca et al 2016 in recent years the imerg product has been extensively evaluated against the ground based observations in different regions around the world e g tang et al 2016 dezfuli et al 2017 xu et al 2017 chiaravalloti et al 2018 omranian et al 2018 palomino ángel et al 2019 it is generally reported that imerg could reasonably capture the spatio temporal variability of precipitation and outperform its predecessor i e tmpa in addition to the conventional top down spps the bottom up ones such as sm2rain cci ciabatta et al 2018 and sm2rain ascat brocca et al 2019 have been developed and released to the public in recent years the precipitation retrievals in these spps are based on the sm2rain algorithm proposed by brocca et al 2013 an innovative and bottom up approach that uses satellite soil moisture observations to indirectly estimate rainfall over land the assumption behind this approach is very simple i e an increase of soil moisture can be closely related to rainfall events brocca et al 2016 the bottom up spps have been evaluated at both regional and global scales brocca et al 2014 obtained three new global precipitation products from the satellite soil moisture data including smos ascat and amsr and found that they could have better performance than the trmm 3b42rt product prakash 2019 have conducted the assessment of sm2rain cci across india and concluded that it underestimate precipitation considerably as compared to the gauge based observations paredes trejo et al 2019 have evaluated the sm2rain ascat sm2rain cci and tmpa products over brazil and reported that the former performs better than the latter two products rahman et al 2019b assessed sm2rain cci and sm2rain ascat over pakistan and found that both of them perform worse than tmpa across all climate regions at present however the evaluation of the bottom up spps over china is still absent which is an important motivation behind this study the top down and bottom up spps have both pros and cons in capturing different aspects of the precipitation brocca et al 2016 for example the former one has the limitations in retrieving light rainfall while the later suffers from the problems of estimating rainfall when the soil is close to saturation ciabatta et al 2017 hence the integration of them is highly desirable to increase the accuracy of rainfall estimates ciabatta et al 2015 merged sm2rian ascat and the real time 3b42 rt tmpa product over italy brocca et al 2016 integrated sm2rain smos and tmpa 3b42rt over australia tarpanelli et al 2017 implemented a two phase integration of three sm2rain derived rainfall products and the imerg product in india and italy chiaravalloti et al 2018 combined the imerg product with sm2rian ascat over complex terrain in southern italy these studies reported various degrees of performance improvements for the merged product nevertheless to our best knowledge the integration of bottom up products with the bottom up ones has not been implemented before over china which is the other important motivation of this study to fill the gaps above this research is carried out with two paramount objectives one is to evaluate the sm2rain ascat and imerg products by using the ground based observations from 701 meteorological stations across mainland china the other is to integrate the two spps and investigate the potential performance improvements for the merged product the evaluations were conducted for imerg and sm2rain ascat as well as the integrated product at multiple temporal scales by using both the continuous and categorical metrics the seasonal and spatial variabilities of the performances of the spps and the performance dependence on the elevations and precipitation magnitudes were further investigated in this study 2 study area and data 2 1 study area this study was carried out over mainland china which locates between about 15 50 n and 65 135 e and covers an area of about 9 6 million km2 fig 1 it is characterized by the large variability of elevations ranging from 152 m below the sea level in east china to 7 528 m above the sea level on the qinghai tibetan plateau qtp as shown in fig 1 mainland china could be subdivided into eight subregions chen et al 2013 chen and li 2016 according to the precipitation distribution mountain ranges and elevations they are the xinjiang region xj the qinghai tibetan plateau qtp the middle and downstream yangtze river basin yz the southwest yungui plateau ygp northwest china nwc northeast china nec north china nc and southeast china sec the arid and semi arid subregions i e xj and nec are dominated by a temperate continental climate with scarce precipitation and intensive evaporation the humid subregions yz ygp and sec on the contrary are controlled by tropical and sub tropical climates with abundant precipitation wang et al 2019b the subregions nec and nc are mainly influenced by the temperate monsoon climate of medium latitudes with hot and wet summer and cold and dry winter the qtp is characterized by very complex terrains with an average elevation higher than 4 000 m and has a distinct plateau climate features in strong radiation low temperature and highly variable precipitation patterns yu et al 2015 2 2 data 2 2 1 top down satellite precipitation product the level 3 product of gpm i e imerg was generated through the intercalibration interpolation and integration of all satellite microwave precipitation estimates precipitation gauge analyses microwave calibrated infrared ir satellite estimates and other precipitation estimators at fine spatio temporal scales for the trmm and gpm eras huffman et al 2014 compared to its predecessor tmpa the main advantage of imerg is the extended capability to measure light rain 0 5 mm hr 1 and solid precipitation the imerg product currently covers the quasi global areas ranging 60 n 60 s with a spatial resolution of 0 1 0 1 and will be extended to the fully global domain 90 n s in the future imerg has three versions i e early run late run and final run to facilitate a wide range of users the early run and late run versions are near real time with a latency of 4 h and 12 h respectively after the satellite acquisition the final run version on the other hand is post real time with a latency of 3 5 months different from the near real time product the post real time one has merged monthly ground based observations from the global precipitation climatology center gpcc network the daily accumulated imerg early run product version 6 precipitationcal subset for the period 2007 2017 was used in this study and it was collected from the national aeronautics and space administration at the goddard earth sciences data and information services center ges disc https disc gsfc nasa gov for simplicity it would be referred to imerg hereafter more information regarding the imerg product are available in huffman et al 2019 2 2 2 bottom up satellite precipitation product there are currently two available bottom up satellite precipitation products i e sm2rain cci and sm2rain ascat which were obtained by applying the sm2rain algorithm brocca et al 2013 to the ascat soil moisture observations wagner et al 2012 and the european space agency esa climate change initiative combined active and passive microwave satellite soil moisture product dorigo et al 2017 respectively the sm2rain algorithm derives the precipitation from the soil moisture data mainly based on the soil water balance brocca et al 2013 by assuming negligible runoff and evaporation during the rainy period the precipitation p could be estimated using eq 1 1 p t n z d s t dt a s t m where n is the soil porosity z is the soil layer depth mm s is the relative soil moisture t is the time days a and m are the parameters used to estimate drainage deep percolation plus subsurface runoff rate mm day the sm2rain cci product has applied a static mask to mask out the periods with high frozen soil and snow probability rainforest areas and the areas with high topographic complexity ciabatta et al 2018 which leads to a large of missing data over mainland china hence it was not used in this research the sm2rain ascat product is provided at the global scale with a high spatial resolution of 12 5 km and a daily temporal resolution the newly released version of sm2rain ascat version 1 1 which are freely available at the website https zenodo org record 3405563 was used in this study it should be noted that the sm2rain ascat data has been resampled to the grids of imerg 0 1 0 1 through the nearest neighboring algorithm in order to match the spatial resolutions the sm2rain ascat product is simply referred to sm2rasc hereafter for conciseness more information about sm2rin ascat can be found in brocca et al 2019 2 2 3 ground based observations in this study the precipitation observations from 701 meteorological stations were used to assess the performance of the spps as depicted in fig 1 the stations are very unevenly distributed across mainland china with a relatively high density in the subregions nec nc yz ygp and sec while a relatively low density in xj and nwc and a lowest density on the qtp daily precipitation observations from the meteorological stations for the period 2007 2017 provided by the national meteorological information center nmic of the china meteorological administration cma were collected from the china meteorological data service center cmdsc at the website http data cma cn the precipitations were measured mainly through the tipping bucket and weighing rain gauges qing et al 2018 of which the former be used to measure liquid precipitation i e rain and drizzle while the later be used to measure solid precipitation such as snowfall mixed rainfall and snowfall and hail wang 2017 all the precipitation measurements have undergone strict quality controls shen et al 2010 zhao and yatagai 2014 including i the extreme values check ii the spatio temporal consistency check iii the internal consistency check e g duplicated data and incorrect units and iv the manual inspection and correction hence they are believed to be robust and could be used as the ground reference the daily precipitation of the imerg and sm2rac products are both the accumulated data from 00 00 to 24 00 utc however the observations are the accumulated precipitation between 20 00 and 20 00 bejing time utc 8 we therefore recalculated the daily precipitation observations to render them to be temporally consistent with the spps this is easy to implement since that besides the accumulated precipitation for the period 20 00 20 00 bejing time utc 8 the ones for the two sub periods i e 20 00 to 8 00 and 8 00 to 20 00 are also available for each day the daily precipitation for the period 0 00 24 00 utc could be easily obtained by adding the accumulated data between 8 00 and 20 00 utc 8 in the current day and that between 20 00 and 8 00 utc 8 in the next day 3 methodology 3 1 integration of the top down and bottom up satellite precipitation products in this study an additional precipitation product was generated by integrating the top down and bottom up satellite precipitation products i e imerg and sm2rasc the integration was implemented through a simple nudging scheme massari et al 2014 ciabatta et al 2015 brocca et al 2016 as in eq 2 2 p i n t t p i m e r g t k p s m 2 r a s c t p i m e r g t where p int t is the integrated precipitation p imerg t is the imerg precipitation estimates p sm2rasc t is the sm2rasc precipitation estimates and k is the parameter that has the same role of the kalman gain in the classic data assimilation technique massari et al 2014 huang et al 2016 the parameter k ranges from 0 to 1 and the greater the value the higher the weight given to sm2rasc and lower weight given to imerg the rationale behind the integration algorithm is very similar with the multi model ensemble strategy such as the simple inverse error square averaging and the advanced bayesian model averaging which assign higher weights to the better performing predictions than the worse performing ones in order to exploit the diversified capabilities of the predictions of different models duan et al 2007 shen et al 2014 ma et al 2018 mastrantonas et al 2019 the k values were determined through a calibration process with the goal of minimizing the root mean square error rmse between the observations and the integrated results the calibration was carried out for each meteorological station during the period 2007 2011 at the daily scale by using the fmincon function in matlab after calibration the parameter k was used to estimate precipitation for the validation period 2012 2017 the integrated product would be referred to imerg sm2r hereafter 3 2 evaluation of imerg sm2rasc and imerg sm2r the evaluations of imerg sm2rasc and imerg sm2r were conducted using the grid to point technique i e the nearest neighbor method more specifically we first find out the grid of the spps that contains the meteorological station and then extract the grid precipitation values and compared them with the corresponding observations the spps were quantitatively assessed through three continuous statistical measures i correlation coefficient cc ii relative bias rbias iii normalized root mean square error nrmse which are defined as in eqs 3 4 and 5 respectively a higher cc and a lower nrmse together with a lower absolute rbias signify better agreements between the precipitation estimates and the observations and vice versa considering that the integrated product may inflate the performance over the calibration period we assessed the imerg sm2rasc and imerg sm2r products for the calibration period 2007 2011 and validation period 2012 2017 respectively 3 c c i 1 n p i obs p mean obs p i p mean i 1 n p i obs p mean obs 2 i 1 n p i p mean 2 4 r b i a s i 1 n p i p i obs i 1 n p i obs 100 5 n r m s e 1 n i 1 n p i p i obs 2 1 n i 1 n p i obs where p i and p i obs are precipitation estimates of the spps and the observations respectively at the time step i p mean and p mean obs are the mean values of precipitation estimates and the observations respectively and n is the total number of time steps moreover three categorical metrics including the probability of detection pod false alarm ratio far and critical success index csi defined as in eqs 6 8 respectively were employed to assess the capability of the spps in detecting precipitation events 6 p o d a a b 7 f a r c a c 8 c s i a a b c where a is the number of precipitation events correctly detected b is the number of the missed events and c is the number of non events that are incorrectly detected hence the pod refers to the fraction of the correctly detected precipitation events the far refers to the fraction of the predicted events that are erroneously detected and the csi is an integrated measure of the overall performance the values of pod far and csi range from 0 to 1 higher pod and csi together with a lower far signify better performance the categorical metrics were computed at each meteorological station for different precipitation thresholds i e 1 5 10 and 15 mm day besides the performance metrics at the daily and monthly scales those in different seasons i e spring march may summer june august autumn september november and winter december february were also calculated in order to analyze the seasonal variations of the performance of the three spps furthermore we depicted the performance metrics at each meteorological station over mainland china to further investigate the spatial variability of the performance in addition we further explored the performance dependence of the spps on the topography and precipitation magnitudes by conducting the correlation analyses between the performance metrics and the elevations or the annual average precipitation 4 results 4 1 calibration of the integration algorithm the spatial variability of the calibrated parameter k of the integration algorithm eq 2 is shown in fig 2 it is seen that the parameter k is greater than 0 5 at most of the stations within the subregions xj and nwc indicating that overall higher weights have been given to the sm2rasc product in the process of integration however they mainly range 0 3 to 0 6 within the subregions yz sec and ygp implying that overall higher weights have been given to imerg in the remaining subregions i e qtp nec and nc the parameter k varies greatly and shows obviously stronger spatial variability than the other subregions the median value of the parameter k is 0 51 suggesting that the integrated product originates almost equally from sm2rasc and imerg over mainland china 4 2 performance assessment over mainland china 4 2 1 continuous performance metrics fig 3 presents the box plots of the continuous performance metrics for imerg sm2rasc and imerg sm2r at the daily scale during the calibration and validation periods respectively the median cc is 0 65 or 0 67 for imerg while it is 0 56 or 0 58 for sm2rasc during the calibration or validation period hence sm2rasc performs worse than imerg at the daily scale in terms of cc however the median nrmse is almost the same for imerg and sm2rasc in both the calibration and validation periods this suggests that there is a larger systematic error and a lower random error in imerg in comparison to sm2rasc the results at the monthly scales are plotted in fig 4 the median cc are 0 83 and 0 87 respectively for imerg and sm2rasc during the calibration period and they are 0 83 and 0 85 respectively during validation period the median nrmse values are 0 67 or 0 65 and 0 59 or 0 58 respectively for imerg and sm2rasc during the calibration or validation period hence unlike the results at the daily scale sm2rasc performs better than imerg at the monthly scale in terms of rbias the median values are 8 65 and 11 18 respectively for imerg during the two sub periods indicating an overestimation of precipitation however the rbias is tiny 0 36 for sm2rasc during the calibration period while it is 3 40 during the validation period regarding the integrated product imerg sm2r it could increase the median cc by 9 23 or 8 43 and 26 79 or 3 45 respectively compared to imerg and sm2rasc respectively for the daily or monthly precipitation in the calibration period meanwhile it could reduce the nrmse by 16 90 or 16 61 and 26 87 or 16 95 respectively very similar results can be observed for the validation period these results indicate that imerg sm2r has an obviously improved performance in comparison to its parent products i e imerg and sm2rasc 4 2 2 categorical performance metrics fig 5 shows the box plots of the categorical metrics pod far and csi for the spps with the precipitation thresholds of 1 5 10 and 15 mm day respectively in the calibration period the median pod is 0 73 for imerg with the precipitation threshold of 1 mm day lower than that for sm2rasc 0 82 however the median far is 0 56 for sm2rasc obviously higher than that for imerg 0 41 this leads to a higher value of the csi for imerg than sm2rasc which are 0 47 and 0 39 respectively in line with the results when the precipitation threshold increases to 5 mm day the median pod far and csi are 0 56 or 0 51 0 45 or 0 49 and 0 48 or 0 34 respectively for imerg and are 0 43 or 0 27 0 49 or 0 47 and 0 30 or 0 21 respectively for sm2rasc when the threshold is set as 10 mm day or 15 mm day in the calibration period hence sm2rasc performs better or worse than imerg in terms of pod or far when the precipitation threshold is 10 mm day while vice versa is the case when the threshold is 10 or 15 mm day the very similar results can be found for the validation period nevertheless imerg outperforms sm2rasc for all the precipitation thresholds in terms of csi regarding the integrated product imerg sm2r the median pod is consistently higher than its parent spps when the threshold is 10 mm day while the median far is consistently lower than its parent products when the threshold is higher than 5 mm day overall the imerg sm2r product outperforms its parent spps in detecting precipitation events when threshold is higher than 1 mm day as indicated by the higher csi values the median csi could be increased by imerg sm2r with the magnitudes of 3 78 11 69 and 26 75 68 66 respectively compared to sm2rasc and imerg respectively in the calibration period as shown in fig 5 the categorical metrics for imerg sm2rasc and imerg sm2r in the validation period are very closed to the calibration period 4 3 seasonal variability of the performance as shown in fig 6 the imerg sm2rasc and imerg sm2r products show similar seasonal variability regarding the performance at the daily scale in terms of cc it has higher values in summer and autumn than in winter the median nrmse on the contrary is the largest in winter and is the lowest in summer the median cc for imerg is higher than sm2rasc in all seasons the median nrmse for sm2rasc is consistently lower than imerg in spring autumn and winter while the contrary is the case in summer the rbias shows relatively small seasonal variations nevertheless it has obviously larger ranges in winter with a lower median value compared to the other seasons in terms of csi it has the highest median value in summer followed by autumn spring and winter the imerg product has a better ability in detecting precipitation events than sm2rasc in all seasons as indicated by the higher csi values the seasonal variations of the performance metrics for the three spps at the monthly scale not shown here are in consistent to those at the daily scale with the difference that sm2rasc performs better than imerg in all season while the contrary is the case at the daily scale the integrated product imerg sm2r performs the best among the three spps in all seasons at both the daily and monthly scales as indicated by the higher cc and csi values and lower nrmse relative to the parent spps i e imerg and sm2rasc 4 4 spatial variability of the performance over mainland china fig 7 plots the spatial patterns of the performance metrics for imerg sm2rasc and imerg sm2r at the daily scale in terms of cc it shows relatively high values for imerg in the humid subregions sec ygp and yz followed by nc nec and nwc the arid subregions xj have the lowest cc on average compared to the other subregions overall the cc decreases from the humid southeast china to the arid and semi arid regions of northwest china for the imerg product regarding the sm2rasc product however the cc have higher values in the semi arid subregion nwc in comparison to the other subregions the lowest cc can be similarly observed in the arid subregion xj in terms of nrmse it decreases obviously from northwest to southeast china for both imerg and sm2rasc the subregions xj and nwc have higher nrmse values while the subregions sce yz and ygp have relatively lower nrmse values the rbias is positive for the imerg product within most of the subregions of mainland china except for qtp over which the rbias is negative and with higher magnitudes 20 with respect to sm2rasc the rbias is negative at most of the stations within the subregions nec yz and nc the rbias has large variability for sm2rasc over the remaining subregions within which both positive and negative values are widely distributed the csi values were calculated for the three spps with the precipitation threshold of 1 mm day they are relatively high greater than0 50 in yz and sey but low 0 30 in xj for the imerg product for the sm2rasc product the csi shows high values in yz sec and qtp and similarly has the lowest values in xj as depicted in fig 7 the spatial patterns of cc rbias and csi for the integrated product imerg sm2r agree well with imerg the nrmse for imerg sm2r is obviously lower than those for imerg and sm2rasc in the subregions yz and sec indicating a substantial improvement of the performance comparing the results for the three spps we can conclude that the integrated product performs better than imerg and sm2rasc at most of the stations over mainland china as indicated by the higher cc and lower nrmse values together with the lower absolute rbias values meanwhile imerg overall outperforms sm2rasc in the humid subregions i e nec yz and ygp while it performs worse than sm2rasc in the semi arid region i e nwc fig 8 depicts the spatial distributions of the cc and nrmse for the three spps at the monthly scale the cc shows high values greater than0 70 for the imerg and sm2rasc products across mainland china except for the subregion xj the higher cc at the monthly scale than the daily one can be explained by the fact both imerg and sm2rasc have been subjected to a static monthly climatological correction brocca et al 2019 huffman et al 2019 and meanwhile the variability of the monthly precipitation is considerably lower than the daily one in terms of nrmse in line with the results at the daily scale it decreases form southeast to northwest china for both imerg and sm2rasc the cc and nrmse maps of imerg sm2r are different from those of imerg and sm2rasc with obviously more stations have higher cc and lower nrmse values overall the performance metrics for the three spps have strong spatial variability at both daily and monthly scales however the spatial patterns diverge significantly between the three spps on average imerg and imerg sm2r perform better in the humid subregions i e yz sec and ygp than in the arid and semi arid subregions i e nwc and xj and the qtp however sm2rasc perform better in semi arid subregion nwc than the remaining subregions 4 5 performance dependence on the elevations and precipitation magnitudes fig 9 shows the correlations of the performance metrics with the elevations for imerg sm2rasc and imerg sm2r respectively at the daily scale the cc consistently shows a significant negative correlation with the elevations for the three spps in terms of nrmse however it presents an insignificant correlation with the elevations for all the three ssps the rbias and csi decrease significantly with the increasing elevations for imerg however the rbias increases significantly and the csi decrease insignificantly for sm2rasc the correlations of rbias and csi with the elevations are not significant for the integrated product the results at the monthly scale are shown in table 1 different from those at the daily scale the cc shows a positive correlation with the elevations for the three spps and meanwhile the nrmse correlates significantly with the elevations for the spps fig 10 plots the relationships between the performance metrics and the annual precipitation magnitudes at the daily scale the cc shows a significant positive correlation with the elevations for imerg and imerg sm2r while it has an insignificant one for sm2rasc the nrmse and rbias present significant downward trends while the csi exhibits a significant upward trend with increasing precipitation magnitudes for all the three spps the absolute rbias tends to decrease with increasing precipitation magnitudes for imerg and imerg sm2r while it tends to increase for sm2rasc at the monthly scale the cc correlates positively with the precipitation magnitudes for imerg and imerg sm2r whereas it shows an insignificant correlation for sm2rasc in terms of nrmse it consistently correlates negatively with precipitation magnitudes for the three spps at the daily and monthly scales overall these results demonstrate that the performance of the three spps depends greatly on the elevations and precipitation magnitudes 5 discussion 5 1 comparisons of the performances of imerg and sm2rasc in this study we assessed the bottom up sm2rasc product and the top down imerg product over mainland china in a timely manner the imerg product has a better performance than sm2rasc in terms of cc at the daily scale which is different from a similar study conducted over the southern italy chiaravalloti et al 2018 which reported an almost comparable performance of the two spps in contrast imerg performs worse than sm2rasc at the monthly scale the inconsistent performance at the daily and monthly scales is possibly due to the better capabilities of sm2rasc in retrieving accumulated rainfall and meanwhile the stable product accuracy of sm2rasc over time brocca et al 2019 meanwhile the monthly climatological corrections based on different benchmarks might also contribute to explain the inconsistency the imerg product was calibrated against the global precipitation climatology project gpcp data huffman et al 2019 while smrasc was corrected based on the era5 reanalysis data brocca et al 2019 it should be mentioned that the climatological correction is static or constant for each month which is different from the dynamic month by month correction implemented for the post real time imerg product in terms of the capacity in detecting precipitation events the results indicate that imerg achieved a better performance than sm2rasc which disagrees with the study of chiaravalloti et al 2018 we also found that the pod and csi values drop with the increasing precipitation thresholds for both spps indicating a deteriorate performance for detecting more intense precipitation events as reported in some other studies e g li et al 2018 rozante et al 2018 both imerg and sm2rasc show obvious seasonal variability of the performance they tend to have better performance in the wet seasons summer and autumn than the dry seasons winter and spring as reported in the previous studies e g wei et al 2018 paredes trejo et al 2019 wang et al 2019a in winter sm2rasc tend to underestimate precipitation significantly as indicated by the high negative median rbias 32 15 the underestimation by sm2rasc is possibly due to the deficiency of the sm2rain algorithm brocca et al 2013 which retrieve precipitation mainly depends on the soil moisture variations in winter the rainfall on the frozen soil might not be able to induce detectable soil moisture variation for the sensor i e ascat on board the satellite resulting in the misses of some precipitation events moreover the sm2rain algorithm could not estimate snowfall brocca et al 2019 which can also explain the underestimations of precipitation in winter the imerg and sm2rasc products also exhibit strong spatial variability of the performance the imerg product tends to have an obviously better performance in southeast china i e sec yz and ygp characterized by a humid climate than in northwest china i e xj and nwc that is controlled by arid and semi arid climates in contrast the sm2rasc product performs better in the semi arid region i e nwc than in the humid subregions this might be explained by the fact that the sm2rain algorithm can hardly estimate precipitation when the soil is close to saturation since the soil moisture would be constant in this case brocca et al 2014 compared to the semi arid region the soil over humid subregions i e sec ygp and yz are more likely to experience saturation due to the more frequent precipitation events with higher magnitudes and durations the lower performance for the sm2rain derived products in the wetter regions has also been reported in the previous studies paredes trejo et al 2019 rahman et al 2019a the sm2rasc product performs worse in the arid region i e xj relative to the other subregions in line with paredes trejo et al 2018 this might be due to the deficiency of the ascat product in estimating soil moisture under the dry climatic conditions the strong spatial variability of the performance of imerg and sm2rasc indicates that whether the former outperforms the later or not depends heavily on the regions to be studied which highlights the necessity of conducting a preliminary evaluation of the ssps before their applications the further analyses revealed that the performances of imerg and sm2rasc are closely correlated to the elevations and precipitation magnitudes agreeing with the studies of bharti and singh 2015 and xu et al 2017 the correlations however can vary significantly between imerg and sm2rasc different time scales and different evaluation metrics the performances for imerg and sm2rasc tend to decrease from the high altitude regions to the low altitude regions in terms of cc and csi at the daily scale this is reasonable considering that both imerg and sm2rasc have not taken the topographical factors into account and meanwhile could not deal well with the frozen and snow surfaces with the increasing precipitation magnitudes the imerg product exhibits significantly better performances in terms of cc nrmse and csi the sm2rasc product however shows an insignificant dependence on the precipitation magnitudes in terms of cc meanwhile it has a significant deteriorate performance in terms of rbias but a significant improved performance in terms of nrmse and csi with the increasing precipitation magnitudes 5 2 performance improvements for the integrated product we merged the imerg and sm2rasc products through a nudging scheme in the calibration or validation period the integrated product i e imerg sm2r could increase the median cc by up to 26 79 or 25 86 and 8 43 or 7 23 respectively at the daily and monthly scales compared to the parent products meanwhile the median nrmse could be reduced by up to 16 95 or 14 72 and 26 87 or 24 62 respectively at the daily and monthly scales additionally the median csi could be increased by up to 68 66 or 70 07 when the precipitation threshold is greater than 1 mm day in the calibration or validation period these results imply the strong benefits of integrating the bottom up and top down spps and confirmed the findings of the previous studies e g ciabatta et al 2015 brocca et al 2016 ciabatta et al 2017 chiaravalloti et al 2018 this is reasonable considering that the deficiencies of one spp could be compensated by the other one ciabatta et al 2017 for instance the deficiency of the bottom up product sm2rasc in capturing precipitation under wet conditions can be overcame by imerg as proved in this study the integration of imerg and sm2rasc was implemented for the daily precipitation the integrated product also shows an improved performance at the monthly scale compared to the parent products this is reasonable considering that the spatial patterns of the performance of imerg and sm2rasc at the daily scale agree well with those at the monthly scale however it should be mentioned that the condition may change if the post real time imerg product is used since the post real time product has merged monthly ground based observations the spatial patterns of its performance might diverge obviously between the daily and monthly scales depending on the number of gauge stations included in the gpcc network in this case the integration at the daily scale may not necessarily bring an improvement of the performance at the monthly scale the parameter of the integration algorithm shows strong spatial variability and therefore needs to be calibrated with the ground based observations hence the adopted integration algorithm can hardly be used to merge the spps over the ungauged regions one possible way to address this problem is to interpolate the parameters over the spatial domain which however might bring about additional biases particularly in the mountainous areas with complex terrains moreover the median value of the integration parameter k is about 0 5 in this study this indicates the merging of imerg and sm2rasc can be implemented through the simple arithmetic average of the two products over mainland china as did by chiaravalloti et al 2018 this simple approach therefore could be another way to implement the integration of the spps over the ungauged regions this efficacy of this approach however depends greatly on the regions to be studied as well as the spps to be integrated 5 3 uncertainties the spatial mismatch between the satellite precipitation estimates and the ground based observation is one of the intractable issues for the evaluations of the spps in this study we adopted a grid to point approach i e the nearest neighbor method to evaluate the performance of imerg and sm2rasc at each meteorological station with the assumption that the point scale precipitation measurements are equal to the grid averages as did in many other studies e g li et al 2013 ebrahimi et al 2017 hu et al 2018 yuan et al 2018 jiang and bauer gottwein 2019 the assumption behind the nearest neighbor method is reasonable in the flat areas with relative uniform precipitation patterns whereas it might not hold true in the mountainous areas with complex topography and nonhomogeneous precipitation patterns for instance if one gauge locates in the valley of a mountainous grid of the spps which is in accordance with the realities in most cases due to challenges of establishing and maintaining a gauge over the alpine areas it may not be able to capture precipitation for the entire grid hence the nearest neighbor method might induce some uncertainties to the results particularly in the high altitude regions such as the qtp moreover the ground based precipitation observations were implicitly assumed to be robust and error free however they are likely to be subjected to various biases such as the wetting and evaporation losses wind induced undercatch and underestimation of trace precipitation ye et al 2004 which might be another important source of the uncertainties in addition to the grid to point methods the another avenue to evaluate the spps is first to interpolate the precipitation observations to the grids of the spps and then compare them with the precipitation estimates of the spps at each grid as did in many previous studies e g chen and li 2016 tang et al 2016 chiaravalloti et al 2018 paredes trejo et al 2019 this approach has not been adopted in this study considering that the interpolation algorithms could bring some additional errors and uncertainties to the performance assessments hu et al 2018 especially in the regions with complex terrains and sparse rain gauges such as the qtp and xj as mentioned before the national level meteorological stations are very unevenly distributed over mainland china the density is relatively high in southeast china while it is low in northwest china and the qtp the varying densities of the precipitation gauges might also be an important source of the uncertainties the terrains over southeast china are relatively flat which together with the high density gauge networks could result in a robust evaluation of the spps however the terrains over the northwest china and the qtp are relatively complex which is accompanied with low density gauge networks and could bring large biases to the performance evaluations tian et al 2018 have investigated the dependency of the performance assessments on the gauge density and found a low density gauge network tends to underestimate the performance of imerg which has also been reported by tang et al 2018 this highlighted that a higher density precipitation network is more desirable for an accurate and robust assessment of the spps hence we highly recommended to carry out more regional evaluations of the spps by using the observations from not only the easily accessible national level rain gauges but also some local level ones which together would generate a denser gauge network 6 conclusions in this study we evaluated and integrated two state of the art spps i e sm2rain ascat sm2rasc and imerg over mainland china by using the ground based observations from 701 meteorological stations the primary difference between the two spps lies in that sm2rasc is obtained from the satellite soil moisture data through an innovative and bottom up approach while imerg is obtained through the conventional and top down manner the two spps were integrated through a nudging scheme resulting in an additional merged product imerg sm2r the performance of imerg and sm2rasc as well as the merged product were evaluated and compared by using both the continuous measures i e cc nrmse and rbias and categorical metrices i e pod far and csi the evaluations were carried out for the calibration period 2007 2011 and validation period 2012 2017 of the integration algorithm respectively further the seasonal and spatial variabilities of the performance and the performance dependence on the elevations and precipitation magnitudes were further explored results indicate that in terms of cc imerg outperforms sm2rasc while interestingly vice versa is the case at the monthly scale in terms of nrmse sm2rasc shows a comparable performance with imerg at the daily scale while it exhibits a better performance than imerg at the monthly scale regarding the capability in detecting precipitation events imerg also achieves a better performance than sm2rasc as indicated by the higher csi values spatially the imerg product overall outperforms sm2rasc in the humid subregions i e sec yz and ygp but it performs worse than sm2rasc in the semi arid subregion i e nwc both imerg and sm2rasc show pronounced seasonal and spatial variabilities regarding the performance they tend to perform better in the wet seasons summer and autumn than in the dry seasons winter and spring in terms of cc the imerg product performs better in the humid subregions than in the semi arid subregions followed by the complex mountainous subregion qtp and the arid subregion xj while sm2rasc performs better in the semi arid subregion than the other subregions both of them perform relatively worse in xj and qtp the further analyses demonstrate that the performance of the spps are closely correlated to the elevations and precipitation magnitudes the correlations and their significances however vary between imerg and sm2rasc and between different time scales and different evaluation metrics the integrated product imerg sm2r outperforms its parent products significantly in the validation period 2012 2017 it could increase the median cc by up to 25 86 and 7 23 respectively at the daily and monthly scales and reduce the median nrmse by up to 14 72 and 24 62 respectively compared to the parent products moreover the median csi could be increased by 4 80 70 07 when the precipitation threshold is greater than 1 mm day the results demonstrate the great potential of integrating the bottom up and top down spps for generating more accurate precipitation estimates we believe the findings of the study will not only provide useful information to the data users to select an appropriate spp but also to the data producers to further enhance their precipitation retrieval algorithms declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this study was supported by the strategic priority research program of chinese academy of sciences xda20100104 and xda19040504 the national natural science foundation of china 41901045 and 41471448 and the cas light of west china program 29y929661 the authors would like to thank the china meteorological data services center for providing ground based precipitation observations we also wish to express our gratitude to prof luca brocca for providing us with the data and for many very helpful discussions in addition we acknowledge prof yang hong and dr xi li for providing the subregion map of china 
5920,the satellite precipitation products spps obtained from the satellite soil moisture data through a bottom up approach i e the sm2rain algorithm have been developed and released in recent years however the assessments and the integration of them with the conventional top down spps remain absent over china this study evaluated and integrated for the first time the bottom up sm2rain ascat sm2rasc product and the top down integrated multi satellite retrievals for global precipitation measurement imerg early run product over mainland china the evaluations were conducted at multiple temporal scales using both the continuous and categorical metrics and the integration was implemented through a nudging scheme results indicate that imerg outperforms sm2rasc in terms of cc at the daily scale meanwhile it achieves a better performance than sm2rasc in detecting precipitation events however interestingly imerg performs worse than sm2rasc in terms of cc and nrmse at the monthly scale both imerg and sm2rasc show noticeable seasonal variability regarding the performance with better qualities in the wet seasons than in the dry seasons spatially imerg performs better in the humid subregions than in the semi arid subregions in terms of cc while sm2rasc performs better in the semi arid region than in the other subregions both of them perform relatively worse in the complex mountainous subregion i e the qinghai tibetan plateau and the arid subregion the performances of the spps are closely correlated to the elevations and precipitation magnitudes the correlations and their significances however vary between imerg and sm2rasc and between different time scales and different evaluation metrics the integrated product could increase the median cc by up to 25 86 or 7 23 and reduce the median nrmse by up to 14 72 or 24 62 at the daily or monthly scale in the validation period i e 2012 2017 compared to the parent products this study demonstrated the overall good performance of sm2rasc over mainland china particularly in the semi arid region and meanwhile highlighted the strong benefits of integrating the bottom up and top down spps keywords satellite precipitation products imerg sm2rain ascat performance evaluation data integration mainland china 1 introduction precipitation typically shows strong spatio temporal variability bárdossy and pegram 2013 and is one of the major components in the hydrological cycle and land atmosphere interactions brocca et al 2016 huang et al 2016 accurate and reliable information of precipitation are therefore critical for various fields in geoscience such as hydrological and ecological modeling lima et al 2018 water resource managements supit et al 2012 climate analyses chen et al 2019 flood and drought monitoring hui mean et al 2018 yuan et al 2019 zhong et al 2019 and landslide modeling and forecast brunetti et al 2018 the rain gauge network is the conventional method used to measure precipitation at the point scale nevertheless the density and spatial patterns of the rain gauge networks diverge significantly across the globe kucera et al 2012 without or with scarce gauge stations over the remote mountainous and oceanic regions and the developing countries rozante et al 2018 the satellite precipitation products spps evolve rapidly over the last few decades and offer an alternative and promising approach for obtaining spatially distributed precipitation with relatively high spatiotemporal resolutions huffman et al 2007 xu et al 2017 the primarily advantages of the spps over the rain gauge network lie in that they could estimate precipitation over the ungauged areas and meanwhile have higher capabilities in capturing spatial variability of precipitation at large scales such as the large river basin continent and globe nevertheless because of the indirect retrieval of the precipitation the spps are inherently subjected to some drawbacks arising from the deficiency of the sensors retrieval algorithms and observing frequency ciabatta et al 2015 tian et al 2015 ebrahimi et al 2017 it is therefore necessary and essential to perform an evaluation of the spps before their applications currently there are a series of spps available to the public such as the climate precipitation center morphing method cmorph joyce et al 2004 precipitation estimation from remotely sensed information using artificial neural networks persiann hsu et al 1997 sorooshian et al 2000 and tropical rainfall measuring mission trmm multi satellite precipitation analysis tmpa products huffman et al 2007 among which tmpa is perhaps the most widely used one and brings considerable science contributions and societal benefits nevertheless the tmpa product has a planned end date of december 31 2019 https pmm nasa gov trmm building upon the success of the trmm the global precipitation measurement gpm mission initiated by nasa and the japan aerospace exploration agency jaxa provides the next generation global precipitation estimates at fine spatio temporal resolutions 0 1 0 1 and 30 min hence the integrated multi satellite retrievals for gpm imerg huffman et al 2014 as the successor to tmpa is now the recommended multi satellite dataset to use for various purposes like tmpa the precipitation estimates of the newly released imerg product are based on the conventional and top down approach through the inversion of the atmospheric signals emitted or scattered by hydrometeors kucera et al 2012 brocca et al 2016 in recent years the imerg product has been extensively evaluated against the ground based observations in different regions around the world e g tang et al 2016 dezfuli et al 2017 xu et al 2017 chiaravalloti et al 2018 omranian et al 2018 palomino ángel et al 2019 it is generally reported that imerg could reasonably capture the spatio temporal variability of precipitation and outperform its predecessor i e tmpa in addition to the conventional top down spps the bottom up ones such as sm2rain cci ciabatta et al 2018 and sm2rain ascat brocca et al 2019 have been developed and released to the public in recent years the precipitation retrievals in these spps are based on the sm2rain algorithm proposed by brocca et al 2013 an innovative and bottom up approach that uses satellite soil moisture observations to indirectly estimate rainfall over land the assumption behind this approach is very simple i e an increase of soil moisture can be closely related to rainfall events brocca et al 2016 the bottom up spps have been evaluated at both regional and global scales brocca et al 2014 obtained three new global precipitation products from the satellite soil moisture data including smos ascat and amsr and found that they could have better performance than the trmm 3b42rt product prakash 2019 have conducted the assessment of sm2rain cci across india and concluded that it underestimate precipitation considerably as compared to the gauge based observations paredes trejo et al 2019 have evaluated the sm2rain ascat sm2rain cci and tmpa products over brazil and reported that the former performs better than the latter two products rahman et al 2019b assessed sm2rain cci and sm2rain ascat over pakistan and found that both of them perform worse than tmpa across all climate regions at present however the evaluation of the bottom up spps over china is still absent which is an important motivation behind this study the top down and bottom up spps have both pros and cons in capturing different aspects of the precipitation brocca et al 2016 for example the former one has the limitations in retrieving light rainfall while the later suffers from the problems of estimating rainfall when the soil is close to saturation ciabatta et al 2017 hence the integration of them is highly desirable to increase the accuracy of rainfall estimates ciabatta et al 2015 merged sm2rian ascat and the real time 3b42 rt tmpa product over italy brocca et al 2016 integrated sm2rain smos and tmpa 3b42rt over australia tarpanelli et al 2017 implemented a two phase integration of three sm2rain derived rainfall products and the imerg product in india and italy chiaravalloti et al 2018 combined the imerg product with sm2rian ascat over complex terrain in southern italy these studies reported various degrees of performance improvements for the merged product nevertheless to our best knowledge the integration of bottom up products with the bottom up ones has not been implemented before over china which is the other important motivation of this study to fill the gaps above this research is carried out with two paramount objectives one is to evaluate the sm2rain ascat and imerg products by using the ground based observations from 701 meteorological stations across mainland china the other is to integrate the two spps and investigate the potential performance improvements for the merged product the evaluations were conducted for imerg and sm2rain ascat as well as the integrated product at multiple temporal scales by using both the continuous and categorical metrics the seasonal and spatial variabilities of the performances of the spps and the performance dependence on the elevations and precipitation magnitudes were further investigated in this study 2 study area and data 2 1 study area this study was carried out over mainland china which locates between about 15 50 n and 65 135 e and covers an area of about 9 6 million km2 fig 1 it is characterized by the large variability of elevations ranging from 152 m below the sea level in east china to 7 528 m above the sea level on the qinghai tibetan plateau qtp as shown in fig 1 mainland china could be subdivided into eight subregions chen et al 2013 chen and li 2016 according to the precipitation distribution mountain ranges and elevations they are the xinjiang region xj the qinghai tibetan plateau qtp the middle and downstream yangtze river basin yz the southwest yungui plateau ygp northwest china nwc northeast china nec north china nc and southeast china sec the arid and semi arid subregions i e xj and nec are dominated by a temperate continental climate with scarce precipitation and intensive evaporation the humid subregions yz ygp and sec on the contrary are controlled by tropical and sub tropical climates with abundant precipitation wang et al 2019b the subregions nec and nc are mainly influenced by the temperate monsoon climate of medium latitudes with hot and wet summer and cold and dry winter the qtp is characterized by very complex terrains with an average elevation higher than 4 000 m and has a distinct plateau climate features in strong radiation low temperature and highly variable precipitation patterns yu et al 2015 2 2 data 2 2 1 top down satellite precipitation product the level 3 product of gpm i e imerg was generated through the intercalibration interpolation and integration of all satellite microwave precipitation estimates precipitation gauge analyses microwave calibrated infrared ir satellite estimates and other precipitation estimators at fine spatio temporal scales for the trmm and gpm eras huffman et al 2014 compared to its predecessor tmpa the main advantage of imerg is the extended capability to measure light rain 0 5 mm hr 1 and solid precipitation the imerg product currently covers the quasi global areas ranging 60 n 60 s with a spatial resolution of 0 1 0 1 and will be extended to the fully global domain 90 n s in the future imerg has three versions i e early run late run and final run to facilitate a wide range of users the early run and late run versions are near real time with a latency of 4 h and 12 h respectively after the satellite acquisition the final run version on the other hand is post real time with a latency of 3 5 months different from the near real time product the post real time one has merged monthly ground based observations from the global precipitation climatology center gpcc network the daily accumulated imerg early run product version 6 precipitationcal subset for the period 2007 2017 was used in this study and it was collected from the national aeronautics and space administration at the goddard earth sciences data and information services center ges disc https disc gsfc nasa gov for simplicity it would be referred to imerg hereafter more information regarding the imerg product are available in huffman et al 2019 2 2 2 bottom up satellite precipitation product there are currently two available bottom up satellite precipitation products i e sm2rain cci and sm2rain ascat which were obtained by applying the sm2rain algorithm brocca et al 2013 to the ascat soil moisture observations wagner et al 2012 and the european space agency esa climate change initiative combined active and passive microwave satellite soil moisture product dorigo et al 2017 respectively the sm2rain algorithm derives the precipitation from the soil moisture data mainly based on the soil water balance brocca et al 2013 by assuming negligible runoff and evaporation during the rainy period the precipitation p could be estimated using eq 1 1 p t n z d s t dt a s t m where n is the soil porosity z is the soil layer depth mm s is the relative soil moisture t is the time days a and m are the parameters used to estimate drainage deep percolation plus subsurface runoff rate mm day the sm2rain cci product has applied a static mask to mask out the periods with high frozen soil and snow probability rainforest areas and the areas with high topographic complexity ciabatta et al 2018 which leads to a large of missing data over mainland china hence it was not used in this research the sm2rain ascat product is provided at the global scale with a high spatial resolution of 12 5 km and a daily temporal resolution the newly released version of sm2rain ascat version 1 1 which are freely available at the website https zenodo org record 3405563 was used in this study it should be noted that the sm2rain ascat data has been resampled to the grids of imerg 0 1 0 1 through the nearest neighboring algorithm in order to match the spatial resolutions the sm2rain ascat product is simply referred to sm2rasc hereafter for conciseness more information about sm2rin ascat can be found in brocca et al 2019 2 2 3 ground based observations in this study the precipitation observations from 701 meteorological stations were used to assess the performance of the spps as depicted in fig 1 the stations are very unevenly distributed across mainland china with a relatively high density in the subregions nec nc yz ygp and sec while a relatively low density in xj and nwc and a lowest density on the qtp daily precipitation observations from the meteorological stations for the period 2007 2017 provided by the national meteorological information center nmic of the china meteorological administration cma were collected from the china meteorological data service center cmdsc at the website http data cma cn the precipitations were measured mainly through the tipping bucket and weighing rain gauges qing et al 2018 of which the former be used to measure liquid precipitation i e rain and drizzle while the later be used to measure solid precipitation such as snowfall mixed rainfall and snowfall and hail wang 2017 all the precipitation measurements have undergone strict quality controls shen et al 2010 zhao and yatagai 2014 including i the extreme values check ii the spatio temporal consistency check iii the internal consistency check e g duplicated data and incorrect units and iv the manual inspection and correction hence they are believed to be robust and could be used as the ground reference the daily precipitation of the imerg and sm2rac products are both the accumulated data from 00 00 to 24 00 utc however the observations are the accumulated precipitation between 20 00 and 20 00 bejing time utc 8 we therefore recalculated the daily precipitation observations to render them to be temporally consistent with the spps this is easy to implement since that besides the accumulated precipitation for the period 20 00 20 00 bejing time utc 8 the ones for the two sub periods i e 20 00 to 8 00 and 8 00 to 20 00 are also available for each day the daily precipitation for the period 0 00 24 00 utc could be easily obtained by adding the accumulated data between 8 00 and 20 00 utc 8 in the current day and that between 20 00 and 8 00 utc 8 in the next day 3 methodology 3 1 integration of the top down and bottom up satellite precipitation products in this study an additional precipitation product was generated by integrating the top down and bottom up satellite precipitation products i e imerg and sm2rasc the integration was implemented through a simple nudging scheme massari et al 2014 ciabatta et al 2015 brocca et al 2016 as in eq 2 2 p i n t t p i m e r g t k p s m 2 r a s c t p i m e r g t where p int t is the integrated precipitation p imerg t is the imerg precipitation estimates p sm2rasc t is the sm2rasc precipitation estimates and k is the parameter that has the same role of the kalman gain in the classic data assimilation technique massari et al 2014 huang et al 2016 the parameter k ranges from 0 to 1 and the greater the value the higher the weight given to sm2rasc and lower weight given to imerg the rationale behind the integration algorithm is very similar with the multi model ensemble strategy such as the simple inverse error square averaging and the advanced bayesian model averaging which assign higher weights to the better performing predictions than the worse performing ones in order to exploit the diversified capabilities of the predictions of different models duan et al 2007 shen et al 2014 ma et al 2018 mastrantonas et al 2019 the k values were determined through a calibration process with the goal of minimizing the root mean square error rmse between the observations and the integrated results the calibration was carried out for each meteorological station during the period 2007 2011 at the daily scale by using the fmincon function in matlab after calibration the parameter k was used to estimate precipitation for the validation period 2012 2017 the integrated product would be referred to imerg sm2r hereafter 3 2 evaluation of imerg sm2rasc and imerg sm2r the evaluations of imerg sm2rasc and imerg sm2r were conducted using the grid to point technique i e the nearest neighbor method more specifically we first find out the grid of the spps that contains the meteorological station and then extract the grid precipitation values and compared them with the corresponding observations the spps were quantitatively assessed through three continuous statistical measures i correlation coefficient cc ii relative bias rbias iii normalized root mean square error nrmse which are defined as in eqs 3 4 and 5 respectively a higher cc and a lower nrmse together with a lower absolute rbias signify better agreements between the precipitation estimates and the observations and vice versa considering that the integrated product may inflate the performance over the calibration period we assessed the imerg sm2rasc and imerg sm2r products for the calibration period 2007 2011 and validation period 2012 2017 respectively 3 c c i 1 n p i obs p mean obs p i p mean i 1 n p i obs p mean obs 2 i 1 n p i p mean 2 4 r b i a s i 1 n p i p i obs i 1 n p i obs 100 5 n r m s e 1 n i 1 n p i p i obs 2 1 n i 1 n p i obs where p i and p i obs are precipitation estimates of the spps and the observations respectively at the time step i p mean and p mean obs are the mean values of precipitation estimates and the observations respectively and n is the total number of time steps moreover three categorical metrics including the probability of detection pod false alarm ratio far and critical success index csi defined as in eqs 6 8 respectively were employed to assess the capability of the spps in detecting precipitation events 6 p o d a a b 7 f a r c a c 8 c s i a a b c where a is the number of precipitation events correctly detected b is the number of the missed events and c is the number of non events that are incorrectly detected hence the pod refers to the fraction of the correctly detected precipitation events the far refers to the fraction of the predicted events that are erroneously detected and the csi is an integrated measure of the overall performance the values of pod far and csi range from 0 to 1 higher pod and csi together with a lower far signify better performance the categorical metrics were computed at each meteorological station for different precipitation thresholds i e 1 5 10 and 15 mm day besides the performance metrics at the daily and monthly scales those in different seasons i e spring march may summer june august autumn september november and winter december february were also calculated in order to analyze the seasonal variations of the performance of the three spps furthermore we depicted the performance metrics at each meteorological station over mainland china to further investigate the spatial variability of the performance in addition we further explored the performance dependence of the spps on the topography and precipitation magnitudes by conducting the correlation analyses between the performance metrics and the elevations or the annual average precipitation 4 results 4 1 calibration of the integration algorithm the spatial variability of the calibrated parameter k of the integration algorithm eq 2 is shown in fig 2 it is seen that the parameter k is greater than 0 5 at most of the stations within the subregions xj and nwc indicating that overall higher weights have been given to the sm2rasc product in the process of integration however they mainly range 0 3 to 0 6 within the subregions yz sec and ygp implying that overall higher weights have been given to imerg in the remaining subregions i e qtp nec and nc the parameter k varies greatly and shows obviously stronger spatial variability than the other subregions the median value of the parameter k is 0 51 suggesting that the integrated product originates almost equally from sm2rasc and imerg over mainland china 4 2 performance assessment over mainland china 4 2 1 continuous performance metrics fig 3 presents the box plots of the continuous performance metrics for imerg sm2rasc and imerg sm2r at the daily scale during the calibration and validation periods respectively the median cc is 0 65 or 0 67 for imerg while it is 0 56 or 0 58 for sm2rasc during the calibration or validation period hence sm2rasc performs worse than imerg at the daily scale in terms of cc however the median nrmse is almost the same for imerg and sm2rasc in both the calibration and validation periods this suggests that there is a larger systematic error and a lower random error in imerg in comparison to sm2rasc the results at the monthly scales are plotted in fig 4 the median cc are 0 83 and 0 87 respectively for imerg and sm2rasc during the calibration period and they are 0 83 and 0 85 respectively during validation period the median nrmse values are 0 67 or 0 65 and 0 59 or 0 58 respectively for imerg and sm2rasc during the calibration or validation period hence unlike the results at the daily scale sm2rasc performs better than imerg at the monthly scale in terms of rbias the median values are 8 65 and 11 18 respectively for imerg during the two sub periods indicating an overestimation of precipitation however the rbias is tiny 0 36 for sm2rasc during the calibration period while it is 3 40 during the validation period regarding the integrated product imerg sm2r it could increase the median cc by 9 23 or 8 43 and 26 79 or 3 45 respectively compared to imerg and sm2rasc respectively for the daily or monthly precipitation in the calibration period meanwhile it could reduce the nrmse by 16 90 or 16 61 and 26 87 or 16 95 respectively very similar results can be observed for the validation period these results indicate that imerg sm2r has an obviously improved performance in comparison to its parent products i e imerg and sm2rasc 4 2 2 categorical performance metrics fig 5 shows the box plots of the categorical metrics pod far and csi for the spps with the precipitation thresholds of 1 5 10 and 15 mm day respectively in the calibration period the median pod is 0 73 for imerg with the precipitation threshold of 1 mm day lower than that for sm2rasc 0 82 however the median far is 0 56 for sm2rasc obviously higher than that for imerg 0 41 this leads to a higher value of the csi for imerg than sm2rasc which are 0 47 and 0 39 respectively in line with the results when the precipitation threshold increases to 5 mm day the median pod far and csi are 0 56 or 0 51 0 45 or 0 49 and 0 48 or 0 34 respectively for imerg and are 0 43 or 0 27 0 49 or 0 47 and 0 30 or 0 21 respectively for sm2rasc when the threshold is set as 10 mm day or 15 mm day in the calibration period hence sm2rasc performs better or worse than imerg in terms of pod or far when the precipitation threshold is 10 mm day while vice versa is the case when the threshold is 10 or 15 mm day the very similar results can be found for the validation period nevertheless imerg outperforms sm2rasc for all the precipitation thresholds in terms of csi regarding the integrated product imerg sm2r the median pod is consistently higher than its parent spps when the threshold is 10 mm day while the median far is consistently lower than its parent products when the threshold is higher than 5 mm day overall the imerg sm2r product outperforms its parent spps in detecting precipitation events when threshold is higher than 1 mm day as indicated by the higher csi values the median csi could be increased by imerg sm2r with the magnitudes of 3 78 11 69 and 26 75 68 66 respectively compared to sm2rasc and imerg respectively in the calibration period as shown in fig 5 the categorical metrics for imerg sm2rasc and imerg sm2r in the validation period are very closed to the calibration period 4 3 seasonal variability of the performance as shown in fig 6 the imerg sm2rasc and imerg sm2r products show similar seasonal variability regarding the performance at the daily scale in terms of cc it has higher values in summer and autumn than in winter the median nrmse on the contrary is the largest in winter and is the lowest in summer the median cc for imerg is higher than sm2rasc in all seasons the median nrmse for sm2rasc is consistently lower than imerg in spring autumn and winter while the contrary is the case in summer the rbias shows relatively small seasonal variations nevertheless it has obviously larger ranges in winter with a lower median value compared to the other seasons in terms of csi it has the highest median value in summer followed by autumn spring and winter the imerg product has a better ability in detecting precipitation events than sm2rasc in all seasons as indicated by the higher csi values the seasonal variations of the performance metrics for the three spps at the monthly scale not shown here are in consistent to those at the daily scale with the difference that sm2rasc performs better than imerg in all season while the contrary is the case at the daily scale the integrated product imerg sm2r performs the best among the three spps in all seasons at both the daily and monthly scales as indicated by the higher cc and csi values and lower nrmse relative to the parent spps i e imerg and sm2rasc 4 4 spatial variability of the performance over mainland china fig 7 plots the spatial patterns of the performance metrics for imerg sm2rasc and imerg sm2r at the daily scale in terms of cc it shows relatively high values for imerg in the humid subregions sec ygp and yz followed by nc nec and nwc the arid subregions xj have the lowest cc on average compared to the other subregions overall the cc decreases from the humid southeast china to the arid and semi arid regions of northwest china for the imerg product regarding the sm2rasc product however the cc have higher values in the semi arid subregion nwc in comparison to the other subregions the lowest cc can be similarly observed in the arid subregion xj in terms of nrmse it decreases obviously from northwest to southeast china for both imerg and sm2rasc the subregions xj and nwc have higher nrmse values while the subregions sce yz and ygp have relatively lower nrmse values the rbias is positive for the imerg product within most of the subregions of mainland china except for qtp over which the rbias is negative and with higher magnitudes 20 with respect to sm2rasc the rbias is negative at most of the stations within the subregions nec yz and nc the rbias has large variability for sm2rasc over the remaining subregions within which both positive and negative values are widely distributed the csi values were calculated for the three spps with the precipitation threshold of 1 mm day they are relatively high greater than0 50 in yz and sey but low 0 30 in xj for the imerg product for the sm2rasc product the csi shows high values in yz sec and qtp and similarly has the lowest values in xj as depicted in fig 7 the spatial patterns of cc rbias and csi for the integrated product imerg sm2r agree well with imerg the nrmse for imerg sm2r is obviously lower than those for imerg and sm2rasc in the subregions yz and sec indicating a substantial improvement of the performance comparing the results for the three spps we can conclude that the integrated product performs better than imerg and sm2rasc at most of the stations over mainland china as indicated by the higher cc and lower nrmse values together with the lower absolute rbias values meanwhile imerg overall outperforms sm2rasc in the humid subregions i e nec yz and ygp while it performs worse than sm2rasc in the semi arid region i e nwc fig 8 depicts the spatial distributions of the cc and nrmse for the three spps at the monthly scale the cc shows high values greater than0 70 for the imerg and sm2rasc products across mainland china except for the subregion xj the higher cc at the monthly scale than the daily one can be explained by the fact both imerg and sm2rasc have been subjected to a static monthly climatological correction brocca et al 2019 huffman et al 2019 and meanwhile the variability of the monthly precipitation is considerably lower than the daily one in terms of nrmse in line with the results at the daily scale it decreases form southeast to northwest china for both imerg and sm2rasc the cc and nrmse maps of imerg sm2r are different from those of imerg and sm2rasc with obviously more stations have higher cc and lower nrmse values overall the performance metrics for the three spps have strong spatial variability at both daily and monthly scales however the spatial patterns diverge significantly between the three spps on average imerg and imerg sm2r perform better in the humid subregions i e yz sec and ygp than in the arid and semi arid subregions i e nwc and xj and the qtp however sm2rasc perform better in semi arid subregion nwc than the remaining subregions 4 5 performance dependence on the elevations and precipitation magnitudes fig 9 shows the correlations of the performance metrics with the elevations for imerg sm2rasc and imerg sm2r respectively at the daily scale the cc consistently shows a significant negative correlation with the elevations for the three spps in terms of nrmse however it presents an insignificant correlation with the elevations for all the three ssps the rbias and csi decrease significantly with the increasing elevations for imerg however the rbias increases significantly and the csi decrease insignificantly for sm2rasc the correlations of rbias and csi with the elevations are not significant for the integrated product the results at the monthly scale are shown in table 1 different from those at the daily scale the cc shows a positive correlation with the elevations for the three spps and meanwhile the nrmse correlates significantly with the elevations for the spps fig 10 plots the relationships between the performance metrics and the annual precipitation magnitudes at the daily scale the cc shows a significant positive correlation with the elevations for imerg and imerg sm2r while it has an insignificant one for sm2rasc the nrmse and rbias present significant downward trends while the csi exhibits a significant upward trend with increasing precipitation magnitudes for all the three spps the absolute rbias tends to decrease with increasing precipitation magnitudes for imerg and imerg sm2r while it tends to increase for sm2rasc at the monthly scale the cc correlates positively with the precipitation magnitudes for imerg and imerg sm2r whereas it shows an insignificant correlation for sm2rasc in terms of nrmse it consistently correlates negatively with precipitation magnitudes for the three spps at the daily and monthly scales overall these results demonstrate that the performance of the three spps depends greatly on the elevations and precipitation magnitudes 5 discussion 5 1 comparisons of the performances of imerg and sm2rasc in this study we assessed the bottom up sm2rasc product and the top down imerg product over mainland china in a timely manner the imerg product has a better performance than sm2rasc in terms of cc at the daily scale which is different from a similar study conducted over the southern italy chiaravalloti et al 2018 which reported an almost comparable performance of the two spps in contrast imerg performs worse than sm2rasc at the monthly scale the inconsistent performance at the daily and monthly scales is possibly due to the better capabilities of sm2rasc in retrieving accumulated rainfall and meanwhile the stable product accuracy of sm2rasc over time brocca et al 2019 meanwhile the monthly climatological corrections based on different benchmarks might also contribute to explain the inconsistency the imerg product was calibrated against the global precipitation climatology project gpcp data huffman et al 2019 while smrasc was corrected based on the era5 reanalysis data brocca et al 2019 it should be mentioned that the climatological correction is static or constant for each month which is different from the dynamic month by month correction implemented for the post real time imerg product in terms of the capacity in detecting precipitation events the results indicate that imerg achieved a better performance than sm2rasc which disagrees with the study of chiaravalloti et al 2018 we also found that the pod and csi values drop with the increasing precipitation thresholds for both spps indicating a deteriorate performance for detecting more intense precipitation events as reported in some other studies e g li et al 2018 rozante et al 2018 both imerg and sm2rasc show obvious seasonal variability of the performance they tend to have better performance in the wet seasons summer and autumn than the dry seasons winter and spring as reported in the previous studies e g wei et al 2018 paredes trejo et al 2019 wang et al 2019a in winter sm2rasc tend to underestimate precipitation significantly as indicated by the high negative median rbias 32 15 the underestimation by sm2rasc is possibly due to the deficiency of the sm2rain algorithm brocca et al 2013 which retrieve precipitation mainly depends on the soil moisture variations in winter the rainfall on the frozen soil might not be able to induce detectable soil moisture variation for the sensor i e ascat on board the satellite resulting in the misses of some precipitation events moreover the sm2rain algorithm could not estimate snowfall brocca et al 2019 which can also explain the underestimations of precipitation in winter the imerg and sm2rasc products also exhibit strong spatial variability of the performance the imerg product tends to have an obviously better performance in southeast china i e sec yz and ygp characterized by a humid climate than in northwest china i e xj and nwc that is controlled by arid and semi arid climates in contrast the sm2rasc product performs better in the semi arid region i e nwc than in the humid subregions this might be explained by the fact that the sm2rain algorithm can hardly estimate precipitation when the soil is close to saturation since the soil moisture would be constant in this case brocca et al 2014 compared to the semi arid region the soil over humid subregions i e sec ygp and yz are more likely to experience saturation due to the more frequent precipitation events with higher magnitudes and durations the lower performance for the sm2rain derived products in the wetter regions has also been reported in the previous studies paredes trejo et al 2019 rahman et al 2019a the sm2rasc product performs worse in the arid region i e xj relative to the other subregions in line with paredes trejo et al 2018 this might be due to the deficiency of the ascat product in estimating soil moisture under the dry climatic conditions the strong spatial variability of the performance of imerg and sm2rasc indicates that whether the former outperforms the later or not depends heavily on the regions to be studied which highlights the necessity of conducting a preliminary evaluation of the ssps before their applications the further analyses revealed that the performances of imerg and sm2rasc are closely correlated to the elevations and precipitation magnitudes agreeing with the studies of bharti and singh 2015 and xu et al 2017 the correlations however can vary significantly between imerg and sm2rasc different time scales and different evaluation metrics the performances for imerg and sm2rasc tend to decrease from the high altitude regions to the low altitude regions in terms of cc and csi at the daily scale this is reasonable considering that both imerg and sm2rasc have not taken the topographical factors into account and meanwhile could not deal well with the frozen and snow surfaces with the increasing precipitation magnitudes the imerg product exhibits significantly better performances in terms of cc nrmse and csi the sm2rasc product however shows an insignificant dependence on the precipitation magnitudes in terms of cc meanwhile it has a significant deteriorate performance in terms of rbias but a significant improved performance in terms of nrmse and csi with the increasing precipitation magnitudes 5 2 performance improvements for the integrated product we merged the imerg and sm2rasc products through a nudging scheme in the calibration or validation period the integrated product i e imerg sm2r could increase the median cc by up to 26 79 or 25 86 and 8 43 or 7 23 respectively at the daily and monthly scales compared to the parent products meanwhile the median nrmse could be reduced by up to 16 95 or 14 72 and 26 87 or 24 62 respectively at the daily and monthly scales additionally the median csi could be increased by up to 68 66 or 70 07 when the precipitation threshold is greater than 1 mm day in the calibration or validation period these results imply the strong benefits of integrating the bottom up and top down spps and confirmed the findings of the previous studies e g ciabatta et al 2015 brocca et al 2016 ciabatta et al 2017 chiaravalloti et al 2018 this is reasonable considering that the deficiencies of one spp could be compensated by the other one ciabatta et al 2017 for instance the deficiency of the bottom up product sm2rasc in capturing precipitation under wet conditions can be overcame by imerg as proved in this study the integration of imerg and sm2rasc was implemented for the daily precipitation the integrated product also shows an improved performance at the monthly scale compared to the parent products this is reasonable considering that the spatial patterns of the performance of imerg and sm2rasc at the daily scale agree well with those at the monthly scale however it should be mentioned that the condition may change if the post real time imerg product is used since the post real time product has merged monthly ground based observations the spatial patterns of its performance might diverge obviously between the daily and monthly scales depending on the number of gauge stations included in the gpcc network in this case the integration at the daily scale may not necessarily bring an improvement of the performance at the monthly scale the parameter of the integration algorithm shows strong spatial variability and therefore needs to be calibrated with the ground based observations hence the adopted integration algorithm can hardly be used to merge the spps over the ungauged regions one possible way to address this problem is to interpolate the parameters over the spatial domain which however might bring about additional biases particularly in the mountainous areas with complex terrains moreover the median value of the integration parameter k is about 0 5 in this study this indicates the merging of imerg and sm2rasc can be implemented through the simple arithmetic average of the two products over mainland china as did by chiaravalloti et al 2018 this simple approach therefore could be another way to implement the integration of the spps over the ungauged regions this efficacy of this approach however depends greatly on the regions to be studied as well as the spps to be integrated 5 3 uncertainties the spatial mismatch between the satellite precipitation estimates and the ground based observation is one of the intractable issues for the evaluations of the spps in this study we adopted a grid to point approach i e the nearest neighbor method to evaluate the performance of imerg and sm2rasc at each meteorological station with the assumption that the point scale precipitation measurements are equal to the grid averages as did in many other studies e g li et al 2013 ebrahimi et al 2017 hu et al 2018 yuan et al 2018 jiang and bauer gottwein 2019 the assumption behind the nearest neighbor method is reasonable in the flat areas with relative uniform precipitation patterns whereas it might not hold true in the mountainous areas with complex topography and nonhomogeneous precipitation patterns for instance if one gauge locates in the valley of a mountainous grid of the spps which is in accordance with the realities in most cases due to challenges of establishing and maintaining a gauge over the alpine areas it may not be able to capture precipitation for the entire grid hence the nearest neighbor method might induce some uncertainties to the results particularly in the high altitude regions such as the qtp moreover the ground based precipitation observations were implicitly assumed to be robust and error free however they are likely to be subjected to various biases such as the wetting and evaporation losses wind induced undercatch and underestimation of trace precipitation ye et al 2004 which might be another important source of the uncertainties in addition to the grid to point methods the another avenue to evaluate the spps is first to interpolate the precipitation observations to the grids of the spps and then compare them with the precipitation estimates of the spps at each grid as did in many previous studies e g chen and li 2016 tang et al 2016 chiaravalloti et al 2018 paredes trejo et al 2019 this approach has not been adopted in this study considering that the interpolation algorithms could bring some additional errors and uncertainties to the performance assessments hu et al 2018 especially in the regions with complex terrains and sparse rain gauges such as the qtp and xj as mentioned before the national level meteorological stations are very unevenly distributed over mainland china the density is relatively high in southeast china while it is low in northwest china and the qtp the varying densities of the precipitation gauges might also be an important source of the uncertainties the terrains over southeast china are relatively flat which together with the high density gauge networks could result in a robust evaluation of the spps however the terrains over the northwest china and the qtp are relatively complex which is accompanied with low density gauge networks and could bring large biases to the performance evaluations tian et al 2018 have investigated the dependency of the performance assessments on the gauge density and found a low density gauge network tends to underestimate the performance of imerg which has also been reported by tang et al 2018 this highlighted that a higher density precipitation network is more desirable for an accurate and robust assessment of the spps hence we highly recommended to carry out more regional evaluations of the spps by using the observations from not only the easily accessible national level rain gauges but also some local level ones which together would generate a denser gauge network 6 conclusions in this study we evaluated and integrated two state of the art spps i e sm2rain ascat sm2rasc and imerg over mainland china by using the ground based observations from 701 meteorological stations the primary difference between the two spps lies in that sm2rasc is obtained from the satellite soil moisture data through an innovative and bottom up approach while imerg is obtained through the conventional and top down manner the two spps were integrated through a nudging scheme resulting in an additional merged product imerg sm2r the performance of imerg and sm2rasc as well as the merged product were evaluated and compared by using both the continuous measures i e cc nrmse and rbias and categorical metrices i e pod far and csi the evaluations were carried out for the calibration period 2007 2011 and validation period 2012 2017 of the integration algorithm respectively further the seasonal and spatial variabilities of the performance and the performance dependence on the elevations and precipitation magnitudes were further explored results indicate that in terms of cc imerg outperforms sm2rasc while interestingly vice versa is the case at the monthly scale in terms of nrmse sm2rasc shows a comparable performance with imerg at the daily scale while it exhibits a better performance than imerg at the monthly scale regarding the capability in detecting precipitation events imerg also achieves a better performance than sm2rasc as indicated by the higher csi values spatially the imerg product overall outperforms sm2rasc in the humid subregions i e sec yz and ygp but it performs worse than sm2rasc in the semi arid subregion i e nwc both imerg and sm2rasc show pronounced seasonal and spatial variabilities regarding the performance they tend to perform better in the wet seasons summer and autumn than in the dry seasons winter and spring in terms of cc the imerg product performs better in the humid subregions than in the semi arid subregions followed by the complex mountainous subregion qtp and the arid subregion xj while sm2rasc performs better in the semi arid subregion than the other subregions both of them perform relatively worse in xj and qtp the further analyses demonstrate that the performance of the spps are closely correlated to the elevations and precipitation magnitudes the correlations and their significances however vary between imerg and sm2rasc and between different time scales and different evaluation metrics the integrated product imerg sm2r outperforms its parent products significantly in the validation period 2012 2017 it could increase the median cc by up to 25 86 and 7 23 respectively at the daily and monthly scales and reduce the median nrmse by up to 14 72 and 24 62 respectively compared to the parent products moreover the median csi could be increased by 4 80 70 07 when the precipitation threshold is greater than 1 mm day the results demonstrate the great potential of integrating the bottom up and top down spps for generating more accurate precipitation estimates we believe the findings of the study will not only provide useful information to the data users to select an appropriate spp but also to the data producers to further enhance their precipitation retrieval algorithms declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this study was supported by the strategic priority research program of chinese academy of sciences xda20100104 and xda19040504 the national natural science foundation of china 41901045 and 41471448 and the cas light of west china program 29y929661 the authors would like to thank the china meteorological data services center for providing ground based precipitation observations we also wish to express our gratitude to prof luca brocca for providing us with the data and for many very helpful discussions in addition we acknowledge prof yang hong and dr xi li for providing the subregion map of china 
5921,fluid flow in rock fractures is usually theoretically and numerically investigated on the premise of no slip boundary condition bc however fluid slippage at rock surface is naturally present in some circumstances that might lead to a violation of no slip bc how and to what extent slip bc affects non darcian fracture flow remains poorly constrained this study systematically investigated the slippery flow behaviors in rock fractures under sequentially increasing pressure gradients two competing mechanisms impacting the apparent permeability k due to fluid slippage were revealed k was not only enhanced by fluid slippage at fracture walls but also was reduced by the accelerated eddy growth due to enhanced velocity field the increment in k caused by slip velocity initially dominated over the decrement caused by eddy growth during this competing process but this dominant situation could reverse given a sufficiently large pressure gradient with fully developed eddies moreover the slippery fluid flow behavior was tested to be very sensitive to the slip length based on our sensitivity analysis therefore a reasonable estimation of the slip length would be crucial to accurately determine the effects of fluid slippage this study deepens our understanding of fluid flow in rock fractures when slip bc is present and might provide theoretical guidance for organic pollution remediation oil recovery and geological carbon sequestration in fractured reservoirs keywords rock fracture fluid slippage permeability non darcian flow eddy evolution slip boundary condition 1 introduction fluid flow in rock fractures is relevant to many subsurface processes which are of great importance in geophysical and engineering applications such as enhanced oil and gas recovery berg et al 2008 christensen and tanino 2017 groundwater contamination remediation kang et al 2015 yang et al 2013 and geological carbon sequestration elkhoury et al 2013 hu et al 2018 this flow process and its key parameter permeability are usually analyzed based on no slip boundary condition bc that indicates the velocity at the fracture walls is zero notwithstanding its lack of physical origin li et al 2018 the no slip bc has been applied in a large number of flow tests in geological porous media these applications most often simply assume that rock surface is hydrophilic in subsurface environment and this assumption holds in many circumstances however this is not always the case for example when a rock surface becomes more hydrophobic lee et al 2007 2014a that would introduce a slip bc the fluid slippage s effects can be present that violate the assumption of no slip bc in fact fluid slippage in subsurface processes is present in two situations a the chemical alteration on rock surface leading to a hydrophobic surface for the wetting fluid such as water flow lee et al 2007 and b the immobile wetting film covering the rock surface for the non wetting fluid such as oil flow berg et al 2008 for example many studies reported that the surface wettability property can be switched from hydrophilic to hydrophobic after exposed to non aqueous phase liquids napls in petroleum reservoirs and napl contaminated sites or exposed to supercritical co2 in geological carbon storage christensen and tanino 2017 hu et al 2018 kim et al 2012 lee et al 2007 morrow 1990 powers and tamblin 1995 this change in hydrophilicity directly impacts the contact angle which is a crucial parameter that controls the extent of fluid slippage and determines slip length for the slip bc huang et al 2008 note that slip length is a notional distance from the surface wall to a point inside the wall where fluid velocity extrapolates to be zero brochard and de gennes 1992 lee et al 2007 the slippery bc has been tested to enhance fluid flow for example lee et al 2007 experimentally observed the water slippage on napl wetted surface of a parallel walled fracture this slip bc increased water flow rate up to 10 0 compared to that in a water wetted fracture moreover several experimental studies showed that the relative permeability k r at the saturation endpoint exceeded 1 in two phase flow berg et al 2008 christensen and tanino 2017 mcphee and arthur 1994 which is naturally assumed in the range of 0 1 because k r is defined as the ratio of one phase permeability to the absolute permeability berg et al 2008 found that these cases with k r 1 have a common situation where the non wetting phase is the majority phase and the wetting phase is only present as a thin film covering the surface i e the saturation endpoint in this situation the wetting film would make the non wetting phase slip and increase the flux of non wetting phase which could be responsible for k r 1 in above mentioned cases fluid slippage results from a slip bc where fluid velocity at the rock surface is proportional to its gradient in the direction normal to the surface rather than the commonly assumed no slip bc with zero velocity at the rock surface this type of slip bc bears important implications for both the microscale and macroscale flow behaviors in rock fractures although there are numerous investigations on fluid flow with slip bc in many fields such as nano engineering choi and kim 2006 biofluid dynamics sui et al 2001 and microfluidics bocquet and barrat 2007 how and to what extent of slip bc affects fracture flow remains poorly understood to disclose this problem lee et al 2013 derived a modified reynolds equation with slip bc for non wetting fluid flow in rock fractures the physical experiments and numerical simulations showed that this modified equation was more suitable to describe flow process than the classic one with no slip bc since fluid slippage led to an enhanced fracture permeability that was well characterized by slip bc rather than no slip bc although the enhancement of permeability due to slip bc is well known how slip bc affects non darcian flow with increasing pressure gradients is under explored and thus poorly understood indeed the non darcian flow behavior has been widely observed with increasing hydraulic gradient or flux chen et al 2015 javadi et al 2014 nowamooz et al 2009 qian et al 2011 zhou et al 2015 zimmerman et al 2004 which reduces the apparent permeability sivanesapillai et al 2014 zhou et al 2019a recent numerical and experimental studies revealed that the non darcian flow is ascribed to eddy growth shrinking the effective flow channel chaudhary et al 2011 lee et al 2014b zhou et al 2019b zou et al 2015 given that the growth of eddies is closely related to the fracture wall slip bc is thus expected to have a profound effect on eddy development and can further confound the macroscale non darcian flow behavior yet to our knowledge there is almost no investigation on the microscale eddy evolution and macroscale non darcian flow in rock fracture considering slip bc therefore whether slip bc can enhance or reduce fracture permeability is a widely open question to address the aforementioned question we systematically investigated the effect of fluid slippage on fluid flow in rock fractures under sequentially increasing pressure gradients that is the navier stokes equations were directly solved with a navier slip boundary condition with sequentially increasing pressure gradients until inertial losses and fluid slippage effects were significant a computationally tractable detection technique for precisely detecting eddies development in fractures proposed in our recent study zhou et al 2019b was adopted to analyze the resultant flow fields the dual role of fluid slippage on enhancing or reducing permeability was further elucidated our study for the first time provides a fundamental understanding of non darcian fluid flow in rock fractures at a mechanistic level where fluid slippage i e slip bc is present 2 methodology to avoid computational burden and numerical instability we focused on two dimensional 2d fractures that served as an exploratory step for deeply understanding the impact of fluid slippage on flow behavior in rough rock fractures moreover eddies in 2d flow are more easily delineated and depicted providing a descriptive investigation of microscale flow structures four 2d fractures were used in this study taken from a natural tuff fracture with a dimension of 150 mm 120 mm originated from the santana formation in trans pecos of texas usa fig 1 the fracture morphology was reconstructed via the high resolution x ray computed tomography facility at the university of texas at austin with a horizontal resolution in fracture surface of 0 24 mm and a vertical resolution in aperture of 50 μm ketcham et al 2010 the detailed geometric information of the four 2d fractures is listed in table 1 more details about this fractured tuff can be found in wang et al 2015 these 2d domains named fracture a b c and d respectively were used as the geometric inputs for direct flow simulations 2 1 direct numerical simulation for water flow the single phase flow of incompressible newtonian fluid at steady state is governed by the navier stokes equations supplemented by the continuity equation 1a ρ u u μ 2 u p 1b u 0 where ρ is the fluid density u ux uy is the velocity vector μ is dynamic viscosity and p is total pressure standard fluid properties for water were used in this study with ρ 1000 kg m3 and μ 0 001 pa s the navier stokes equations were solved directly including the inertial term on the left hand side to precisely capture the growth of eddies with increasing pressure gradients the fracture walls were set as slip bc to consider the slippage effect which can be implemented via the navier slip bc brochard and de gennes 1992 goldstein 1938 navier 1823 2 u wall l s μ τ n l s u y wall where u wall and τ n are the velocity vector and shear stress at the fracture wall respectively which are tangential to the fracture wall u y is the velocity gradient in the direction normal to the surface l s unit m is the slip length inset in fig 2 this navier slip bc has been widely used in nanoscale pores at first such as oil and gas flow in tight shale rock afsharpoor and javadpour 2016 wang et al 2016b and fluid flow in engineered nanoscale pores cheng and giordano 2002 choi and kim 2006 recent studies also confirmed its validity in relatively larger scale of pore sizes lee et al 2007 2013 tretheway and meinhart 2002 watanabe et al 1999 the navier slip bc assumes that the velocity at the solid surface is proportional to the shear stress herein when l s 0 slip bc in equation 2 reduces to the no slip case the specific values of l s for each fracture are listed in table 1 which were determined based on the calibration experiments within parallel walled fractures conducted by lee et al 2007 details of the slip length determination is provided below section 2 2 as a benchmark fluid flow with a no slip bc was also simulated for comparison the inlet and outlet of the fracture were prescribed with a pressure difference to drive flow from left to right fig 1 a series of hydraulic gradients dh dl were imposed for each fracture until the local eddies were fully developed with nonnegligible inertial effects numerical solutions to flow fields were obtained via the finite element method implemented in comsol multiphysics the fracture domain was discretized into more than 106 lagrange triangular elements with a finer mesh size 4 10 6 m 8 10 6 m near the boundaries and coarser mesh size 2 10 5 m 6 10 5 m at the middle of the domain fig 1 a boundary layers mesh 20 boundary layers was adopted to the fracture walls for accurately capturing effects induced by slip bc i e non zero velocity on the walls fig 1 prior sensitivity analysis to the mesh size showed that numerical dispersion was trivial and numerical results were insensitive to the meshes we used here the flow simulations were run on a high performance workstation with 128 gb memory and up to 120 gb memory was used during each run 2 2 determination of the slip length as illustrated in the inset of fig 2 l s is an extrapolated length at which the tangential component of the velocity vector vanishes l s is a measure of slippery effect and thus of vital importance for fluid slippage behavior which depends on the properties of solid surface and fluid as well as their interactions many factors shape l s such as hydrophobic property of surface lee et al 2014a solid surface roughness choi and kim 2006 pore size afsharpoor and javadpour 2016 and immobile fluid film on surface berg et al 2008 to name a few the diversity of these factors suggests that there is more than one simple mechanism through which slippage maybe present and expectedly a variety of l s values ranging from nanometers to micrometers has been reported in the literature ehrenworth 2003 huang et al 2008 li et al 2018 regardless of the physical mechanism resulting in fluid slippage the channel size is another important factor affecting l s lee et al 2007 therefore for the sake of simplicity and without loss of generality we only considered the positive dependence of l s on the channel size i e aperture size in this study as supported by many researches cheng and giordano 2002 lee et al 2007 watanabe et al 1999 specifically l s was determined based on the flow experiment of creosote wetted parallel walled fractures with a series of nominal aperture sizes conducted by lee et al 2007 the parallel walled fracture experiments enable one to evaluate the flow rate contribution from fluid slippage and consequently to calculate apparent l s the estimated l s was found to be functionally related to the aperture size fig 2 3 l s c 1 c 2 c 3 b where b is aperture size c 1 8 9648 c 2 1 1573 and c 3 0 9956 with a high coefficient of determination r2 0 9545 note that the units of slip length l s and b in equation 3 are μm according to this function and the mean mechanical aperture b l s of each 2d fracture used in this study was satisfactorily determined table 1 it should be mentioned that l s is expected to be different at different fracture locations since aperture varied from point to point however we started with a simple situation by using a uniform l s over the entire fracture domain which was usually adopted in many previous studies e g afsharpoor and javadpour 2016 cui et al 2019 lee et al 2013 a sensitive analysis of uniform l s on flow behavior was further conducted to assess the effects of l s 3 results 3 1 microscale eddy evolution with increasing pressure gradient it is now well known that eddies are commonly present near the rough surface walls at high external hydraulic gradients cardenas et al 2009 lee et al 2014a zhou et al 2019b to quantitatively estimate the impact of fluid slippage on microscale flow structures a recently proposed eddy detection technique zhou et al 2019b was adopted to analyze the solved velocity fields of these four fractures this technique was developed based on a zero integral flux method which can precisely detect the eddy boundary and further calculate the total eddy volume interested readers can refer to zhou et al 2018 2019b for more details on this technique the accessible matlab code for this eddy detection technique can be found at https doi org 10 6084 m9 figshare 5811399 v5 typical segments with detected eddies were illustrated in the inset of fig 3 with its location marked in fig 1 with a blue color for the illustrative purpose we also demonstrated the segment where eddy firstly emerged in the fracture fig 3 as marked with a pink color in fig 1 the detected eddies for both no slip and slip bcs were prone to develop in abruptly changing aperture regions inset of fig 3 which is consistent with previous studies boutt et al 2006 cardenas et al 2009 lee et al 2014b previous study also revealed that the eddy formation and growth were largely dependent on the angle of flow entry with respect to the angle of expansion cardenas et al 2009 here the bcs were proven to have a significant impact on eddy growth and evolution with increasing pressure gradients fig 3 the eddy appeared earlier and grew faster with increasing hydraulic gradients dh dl for cases with slip bc than these with no slip bc two typical patterns of eddy shape were observed between two different bcs given the same dh dl a both of eddies shared a common start point but the slip case exhibited a tailing end point b a shifting of eddy s location occurred inset of fig 3a in any case the eddy size enlarged for the slip cases the difference in eddy size for these two bcs is more intuitive by plotting the determined total eddy volume ratio θ volume of all eddies fracture volume with increasing dh dl fig 3 clearly the gap of θ between these two bcs initially increased with dh dl and it either narrowed fig 3a or maintained fig 3b 3d with a further increase of dh dl note that for fracture b θ was not zero even if the applied dh dl was tiny fig 3b when bcs effect was trivial this kind of eddy is referred to as the moffatt or stokes eddies kitanidis and dykaar 1997 moffatt 1964 which can form around the sharp corners in the viscous flow regime and is entirely dependent on the geometry cardenas et al 2009 chaudhary et al 2011 physically fluid slippage plays a role of lubrication in eddy development eddies can develop for no slip cases as long as inertial effect was significant at large values of dh dl fig 3 whereas slip bc lubricated the boundaries and further contributed to the enhanced growth of eddies the lubrication effect was fundamentally attributed to the non zero velocity at the fracture walls fig 4 for direct numerical simulations the slippage or lubrication was realized by applying the slip velocity in equation 2 which was zero for no slip bc the profiles of velocity magnitude u were different under different dh dl as demonstrated by a section of fracture a that is the slip velocity u at fracture wall solid points in fig 4 increased with dh dl this is in line with equation 2 as a higher dh dl results in a higher velocity gradient and consequently leads to a larger slip velocity at the wall surface the difference in microscale flow structures of these two bc cases was compared at the same dh dl above moreover we plotted θ versus reynolds number re fig 5 an important dimensionless number indicating the flow regimes where re is defined as ρq μ where q unit m2 s 1 is the specific flux at the outlet different from the significant gap between two bc cases fig 3 the θ re curves almost overlapped with a subtle difference between no slip and slip bcs fig 5 this is reasonable as θ inherently signifies the reduced effective flow region and thus is indirectly related to q at the outlet and re was directly estimated based on q therefore fluid slippage barely affected the relationship between re and θ in fact the shape of θ re curves mainly depended on the fracture roughness where at the beginning before the black dash line in fig 5 the rougher the fracture was table 1 the earlier and more prominently the eddies grew despite that the θ re curves may intersect with a further increasing re fig 5 it should be mentioned that this study adopted 2d rather than three dimensional 3d fracture models to explore the effect of fluid slippage because 2d models represent a simplified and tractable situation assuming that the 2d geometry in x y plane in fig 1 extends infinitely in the direction normal to the x y plane i e z axis in fig 1 for real rock fractures the fracture geometry is 3d fig 1 where the aperture field also varies in the z axis in this situation the eddy shape is 3d and its growth would be more complex than the 2d cases resulting in unresolvable quantification of eddy growth however this simplification would not affect the underlying physics we intended to investigate that is the lubrication mechanism of fluid slippage in eddy growth revealed above based on 2d models also applies to 3d situations as the underlying interaction between fluid and fracture wall is the same regardless of dimensionality 3 2 macroscale non darcian flow behavior the microscale flow structures bears significance on the macroscale flow behavior with an increase of applied dh dl the curve gradually deviated from the linear darcy s law dashed lines in fig 6 for all fractures with both no slip and slip bcs this non darcian i e nonlinear flow behavior is ascribed to the occurrence of microscale eddies induced by significant inertial effects with increasing dh dl cardenas et al 2009 lee et al 2014b the flow nonlinearity can be well described by the forchheimer equation solid lines in fig 6 forchheimer 1901 zhou et al 2015 zimmerman et al 2004 4 p μ k v β ρ v 2 where p ρg dh dl and v q b h are the pressure gradient and average velocity respectively k b h 2 12 is the intrinsic permeability β unit m 1 is the inertial resistance coefficient b h is the hydraulic aperture note that k refers to the permeability at a minuscule dh dl where the inertial effect is negligible k b h and β can be determined by fitting equation 4 using the applied dh dl and the measured q at the outlet the determined b h is listed in table 1 as expected b h in slip bc cases is larger than these no slip cases where the enhancement of b h is essentially attributed to the slip velocity at the fracture wall fig 4 to quantify the flow nonlinearity we calculated the critical reynolds number re c for each q dh dl curve in fig 6 re c indicating the onset of non darcian flow can be defined as a critical point where the nonlinear pressure drop μv k contributes to α percentage of the overall pressure drop μv k βρv 2 javadi et al 2014 zeng and grigg 2006 therefore re c is formulated as zhou et al 2015 5 r e c α b h 1 α β k following previous studies liu et al 2018 wang et al 2016a we set the factor α 5 to estimate re c table 1 considering the flow nonlinearity and range of re in this study note that α 10 was also used in the literature javadi et al 2014 wang et al 2014 but was not applied here due to two reasons 1 the determined re c did not change significantly as α varied 5 or 10 and most importantly 2 some determined values of re c using α 10 were beyond the constraints for numerical simulations i e simulations did not converge and therefore was disregarded it is worth mentioning that the method of determining re c is quantitative consistent and varying for different fractures to identify the onset of non darcian flow which is different from the commonly used re c where the characteristic length is somehow arbitrary javadi et al 2014 wang et al 2014 zhou et al 2015 for all four fractures re c of slip bc case is smaller than the no slip case this indicates that flow with slip bc is more prone to transition into the non darcian flow regime than that with no slip bc this is consistent with the microscale flow process discussed above where eddies grew earlier and faster with slip bc given the same dh dl the normalized apparent permeability k a calculated by the darcy s law p μv was plotted against re in fig 7 note that for each fracture k a with no slip and slip bcs were both normalized by the intrinsic permeability with no slip bc when inertial effects were trivial named k 0 in the following undoubtedly k a monotonically decreased with re following the non darcian behavior with the maximum reduction up to nearly 50 in our study for the slip bc the normalized k a exceeded 1 when re approached zero gray area in fig 7 indicating the intrinsic permeability in slip bc case was larger than the no slip one this could also support the argument that fluid slippage is a plausible explanation for many experimental observations of near end point k r 1 for the two phase flow berg et al 2008 christensen and tanino 2017 mcphee and arthur 1994 4 discussion 4 1 a dual role of fluid slippage it is well known that the reduction in k a is a key proxy for non darcian flow behavior which suggests a nonlinear relationship for the pressure flowrate curve chaudhary et al 2011 this reduction is fundamentally ascribed to the reduced effective flow region in the fracture caused by growing eddies here we showed that fluid slippage confound the estimation of k a based on the aforementioned macroscopic and microscopic flow phenomena at the microscale on the one hand fluid slippage can expectedly accelerate the flow and thus enhance k a on the other hand the eddy evolution for slip bc case is earlier and faster i e promoted than the no slip bc case which results in a reduced k a these two competing microscale mechanisms together shape the macroscopic evolution of k a where the increment in k a induced by slip velocity initially dominates over its decrement induced by eddy growth this was demonstrated by the relationship between the normalized k a and θ fig 8 i e the overall level of k a for the slip bc case is higher than the no slip one this suggests that although having the same θ i e the same effective flow region in the fracture the k a with slip bc is larger than the no slip one due to the slip velocity at fracture walls however this dominant effect on k a induced by slip velocity is gradually counteracted by the accelerated eddy growth because the late portion of k a θ curve for the slip bc case is steeper than the no slip one indicating a faster reduction in k a with increasing θ fig 8 consequently the gap of k a between slip and no slip bcs narrowed with increasing θ and the two k a θ curves tended to intersect dashed lines in fig 8 with a further increase of θ indicating that k a of no slip and slip bcs could be identical if dh dl or flux is sufficiently large taking fracture c for example k as of no slip and slip bcs were already very close to each other when θ exceeded 0 2 fig 8 4 2 sensitive analysis of slip length slip length is the most critical parameter determining the effects of slip bc to investigate the impact of l s on the fluid flow behavior sensitive analyses were conducted for the studied four fractures with relative changes 75 50 50 75 of initial l s the normalized apparent permeability k a k 0 θ curves demonstrated that the fluid flow behavior was greatly sensitive to l s fig 9 where k a k 0 expectedly increased with l s given the same θ the tails of k a k 0 θ curves exhibited a straight line with its slope linearly increasing with l s labeled in fig 9 and fitted in fig 10 indicating fluid slippage accelerates the reduction in k a due to promoted eddy growth which is consistent with the above mentioned results moreover the sensitive analysis further demonstrates that the effect of lubrication due to fluid slippage is increasingly significant with l s besides the intrinsic permeability also proportionally increases with l s fig 10 note that the intrinsic permeability refers to the permeability at a minuscule hydraulic gradient where there is no eddy θ 0 or only stokes eddy is present according to lee et al 2013 the intrinsic permeability for the slip bc cases is 6 k b 2 l s 2 12 therefore the normalized k is 7 k k 0 b 2 l s 2 b 2 1 2 l s b 2 due to l s b l s b 2 equation 7 can be reduced to 8 k k 0 1 4 l s b equation 8 theoretically explains the rationality of the linear relationship between the intrinsic permeability and l s fig 10 these sensitive analyses above suggest that a reasonable estimation of l s would be crucial to accurately describe the effect of fluid slippage on non darcian flow we thus recommend further efforts to evaluate l s for different rock surfaces to mimic the effects induced by a variety of fluid slippages considering the sensitivity of flow behavior to l s it is also worth mentioning that the aperture size dependent l s would be more accurate and appropriate when simulating fluid flow in rock fractures with slippery surfaces rather than the current method with uniform l s hence future study is required to evaluate the impact of varying slip lengths with locations on the flow behaviors based on the approach developed here 5 conclusions we investigated the effects of fluid slippage on eddy growth and non darcian flow behavior in rock fractures based on direct numerical simulations of water flow through four different fracture geometries with a slip boundary condition microscale flow structure analysis by an automatic eddy detection technique showed that eddies grew earlier and faster for slip boundary condition bc cases than no slip one consequently the macroscale flow for slip bc cases is more prone to transition from darcian to non darcian regimes than the no slip counterparts interestingly fluid slippage has a dual role of in altering the apparent permeability k a as k a can be enhanced by the slip velocity at fracture walls but also be reduced by the accelerated eddy growth with increasing pressure gradient k a of no slip and slip bcs could be identical given the sufficiently large pressure gradient sensitive analysis showed that the fluid flow behavior was very sensitive to the slip length moreover both the intrinsic permeability and the decreasing rate of k a were proportional to the slip length our results and findings can be of interest to geologists hydrologists and engineers who are concerned with enhanced oil recovery napl pollution remediation and geological carbon sequestration in fractured rocks where fracture surfaces with slip bc is prevalently present declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work was supported by the national key r d program of china grant no 2018yfc1507200 the national natural science foundation of china grant nos 51909247 41977161 and 41931295 the fundamental research funds for the central universities china university of geosciences wuhan and the open research fund program of state key laboratory of water resources and hydropower engineering science grant no 2018sgg03 
5921,fluid flow in rock fractures is usually theoretically and numerically investigated on the premise of no slip boundary condition bc however fluid slippage at rock surface is naturally present in some circumstances that might lead to a violation of no slip bc how and to what extent slip bc affects non darcian fracture flow remains poorly constrained this study systematically investigated the slippery flow behaviors in rock fractures under sequentially increasing pressure gradients two competing mechanisms impacting the apparent permeability k due to fluid slippage were revealed k was not only enhanced by fluid slippage at fracture walls but also was reduced by the accelerated eddy growth due to enhanced velocity field the increment in k caused by slip velocity initially dominated over the decrement caused by eddy growth during this competing process but this dominant situation could reverse given a sufficiently large pressure gradient with fully developed eddies moreover the slippery fluid flow behavior was tested to be very sensitive to the slip length based on our sensitivity analysis therefore a reasonable estimation of the slip length would be crucial to accurately determine the effects of fluid slippage this study deepens our understanding of fluid flow in rock fractures when slip bc is present and might provide theoretical guidance for organic pollution remediation oil recovery and geological carbon sequestration in fractured reservoirs keywords rock fracture fluid slippage permeability non darcian flow eddy evolution slip boundary condition 1 introduction fluid flow in rock fractures is relevant to many subsurface processes which are of great importance in geophysical and engineering applications such as enhanced oil and gas recovery berg et al 2008 christensen and tanino 2017 groundwater contamination remediation kang et al 2015 yang et al 2013 and geological carbon sequestration elkhoury et al 2013 hu et al 2018 this flow process and its key parameter permeability are usually analyzed based on no slip boundary condition bc that indicates the velocity at the fracture walls is zero notwithstanding its lack of physical origin li et al 2018 the no slip bc has been applied in a large number of flow tests in geological porous media these applications most often simply assume that rock surface is hydrophilic in subsurface environment and this assumption holds in many circumstances however this is not always the case for example when a rock surface becomes more hydrophobic lee et al 2007 2014a that would introduce a slip bc the fluid slippage s effects can be present that violate the assumption of no slip bc in fact fluid slippage in subsurface processes is present in two situations a the chemical alteration on rock surface leading to a hydrophobic surface for the wetting fluid such as water flow lee et al 2007 and b the immobile wetting film covering the rock surface for the non wetting fluid such as oil flow berg et al 2008 for example many studies reported that the surface wettability property can be switched from hydrophilic to hydrophobic after exposed to non aqueous phase liquids napls in petroleum reservoirs and napl contaminated sites or exposed to supercritical co2 in geological carbon storage christensen and tanino 2017 hu et al 2018 kim et al 2012 lee et al 2007 morrow 1990 powers and tamblin 1995 this change in hydrophilicity directly impacts the contact angle which is a crucial parameter that controls the extent of fluid slippage and determines slip length for the slip bc huang et al 2008 note that slip length is a notional distance from the surface wall to a point inside the wall where fluid velocity extrapolates to be zero brochard and de gennes 1992 lee et al 2007 the slippery bc has been tested to enhance fluid flow for example lee et al 2007 experimentally observed the water slippage on napl wetted surface of a parallel walled fracture this slip bc increased water flow rate up to 10 0 compared to that in a water wetted fracture moreover several experimental studies showed that the relative permeability k r at the saturation endpoint exceeded 1 in two phase flow berg et al 2008 christensen and tanino 2017 mcphee and arthur 1994 which is naturally assumed in the range of 0 1 because k r is defined as the ratio of one phase permeability to the absolute permeability berg et al 2008 found that these cases with k r 1 have a common situation where the non wetting phase is the majority phase and the wetting phase is only present as a thin film covering the surface i e the saturation endpoint in this situation the wetting film would make the non wetting phase slip and increase the flux of non wetting phase which could be responsible for k r 1 in above mentioned cases fluid slippage results from a slip bc where fluid velocity at the rock surface is proportional to its gradient in the direction normal to the surface rather than the commonly assumed no slip bc with zero velocity at the rock surface this type of slip bc bears important implications for both the microscale and macroscale flow behaviors in rock fractures although there are numerous investigations on fluid flow with slip bc in many fields such as nano engineering choi and kim 2006 biofluid dynamics sui et al 2001 and microfluidics bocquet and barrat 2007 how and to what extent of slip bc affects fracture flow remains poorly understood to disclose this problem lee et al 2013 derived a modified reynolds equation with slip bc for non wetting fluid flow in rock fractures the physical experiments and numerical simulations showed that this modified equation was more suitable to describe flow process than the classic one with no slip bc since fluid slippage led to an enhanced fracture permeability that was well characterized by slip bc rather than no slip bc although the enhancement of permeability due to slip bc is well known how slip bc affects non darcian flow with increasing pressure gradients is under explored and thus poorly understood indeed the non darcian flow behavior has been widely observed with increasing hydraulic gradient or flux chen et al 2015 javadi et al 2014 nowamooz et al 2009 qian et al 2011 zhou et al 2015 zimmerman et al 2004 which reduces the apparent permeability sivanesapillai et al 2014 zhou et al 2019a recent numerical and experimental studies revealed that the non darcian flow is ascribed to eddy growth shrinking the effective flow channel chaudhary et al 2011 lee et al 2014b zhou et al 2019b zou et al 2015 given that the growth of eddies is closely related to the fracture wall slip bc is thus expected to have a profound effect on eddy development and can further confound the macroscale non darcian flow behavior yet to our knowledge there is almost no investigation on the microscale eddy evolution and macroscale non darcian flow in rock fracture considering slip bc therefore whether slip bc can enhance or reduce fracture permeability is a widely open question to address the aforementioned question we systematically investigated the effect of fluid slippage on fluid flow in rock fractures under sequentially increasing pressure gradients that is the navier stokes equations were directly solved with a navier slip boundary condition with sequentially increasing pressure gradients until inertial losses and fluid slippage effects were significant a computationally tractable detection technique for precisely detecting eddies development in fractures proposed in our recent study zhou et al 2019b was adopted to analyze the resultant flow fields the dual role of fluid slippage on enhancing or reducing permeability was further elucidated our study for the first time provides a fundamental understanding of non darcian fluid flow in rock fractures at a mechanistic level where fluid slippage i e slip bc is present 2 methodology to avoid computational burden and numerical instability we focused on two dimensional 2d fractures that served as an exploratory step for deeply understanding the impact of fluid slippage on flow behavior in rough rock fractures moreover eddies in 2d flow are more easily delineated and depicted providing a descriptive investigation of microscale flow structures four 2d fractures were used in this study taken from a natural tuff fracture with a dimension of 150 mm 120 mm originated from the santana formation in trans pecos of texas usa fig 1 the fracture morphology was reconstructed via the high resolution x ray computed tomography facility at the university of texas at austin with a horizontal resolution in fracture surface of 0 24 mm and a vertical resolution in aperture of 50 μm ketcham et al 2010 the detailed geometric information of the four 2d fractures is listed in table 1 more details about this fractured tuff can be found in wang et al 2015 these 2d domains named fracture a b c and d respectively were used as the geometric inputs for direct flow simulations 2 1 direct numerical simulation for water flow the single phase flow of incompressible newtonian fluid at steady state is governed by the navier stokes equations supplemented by the continuity equation 1a ρ u u μ 2 u p 1b u 0 where ρ is the fluid density u ux uy is the velocity vector μ is dynamic viscosity and p is total pressure standard fluid properties for water were used in this study with ρ 1000 kg m3 and μ 0 001 pa s the navier stokes equations were solved directly including the inertial term on the left hand side to precisely capture the growth of eddies with increasing pressure gradients the fracture walls were set as slip bc to consider the slippage effect which can be implemented via the navier slip bc brochard and de gennes 1992 goldstein 1938 navier 1823 2 u wall l s μ τ n l s u y wall where u wall and τ n are the velocity vector and shear stress at the fracture wall respectively which are tangential to the fracture wall u y is the velocity gradient in the direction normal to the surface l s unit m is the slip length inset in fig 2 this navier slip bc has been widely used in nanoscale pores at first such as oil and gas flow in tight shale rock afsharpoor and javadpour 2016 wang et al 2016b and fluid flow in engineered nanoscale pores cheng and giordano 2002 choi and kim 2006 recent studies also confirmed its validity in relatively larger scale of pore sizes lee et al 2007 2013 tretheway and meinhart 2002 watanabe et al 1999 the navier slip bc assumes that the velocity at the solid surface is proportional to the shear stress herein when l s 0 slip bc in equation 2 reduces to the no slip case the specific values of l s for each fracture are listed in table 1 which were determined based on the calibration experiments within parallel walled fractures conducted by lee et al 2007 details of the slip length determination is provided below section 2 2 as a benchmark fluid flow with a no slip bc was also simulated for comparison the inlet and outlet of the fracture were prescribed with a pressure difference to drive flow from left to right fig 1 a series of hydraulic gradients dh dl were imposed for each fracture until the local eddies were fully developed with nonnegligible inertial effects numerical solutions to flow fields were obtained via the finite element method implemented in comsol multiphysics the fracture domain was discretized into more than 106 lagrange triangular elements with a finer mesh size 4 10 6 m 8 10 6 m near the boundaries and coarser mesh size 2 10 5 m 6 10 5 m at the middle of the domain fig 1 a boundary layers mesh 20 boundary layers was adopted to the fracture walls for accurately capturing effects induced by slip bc i e non zero velocity on the walls fig 1 prior sensitivity analysis to the mesh size showed that numerical dispersion was trivial and numerical results were insensitive to the meshes we used here the flow simulations were run on a high performance workstation with 128 gb memory and up to 120 gb memory was used during each run 2 2 determination of the slip length as illustrated in the inset of fig 2 l s is an extrapolated length at which the tangential component of the velocity vector vanishes l s is a measure of slippery effect and thus of vital importance for fluid slippage behavior which depends on the properties of solid surface and fluid as well as their interactions many factors shape l s such as hydrophobic property of surface lee et al 2014a solid surface roughness choi and kim 2006 pore size afsharpoor and javadpour 2016 and immobile fluid film on surface berg et al 2008 to name a few the diversity of these factors suggests that there is more than one simple mechanism through which slippage maybe present and expectedly a variety of l s values ranging from nanometers to micrometers has been reported in the literature ehrenworth 2003 huang et al 2008 li et al 2018 regardless of the physical mechanism resulting in fluid slippage the channel size is another important factor affecting l s lee et al 2007 therefore for the sake of simplicity and without loss of generality we only considered the positive dependence of l s on the channel size i e aperture size in this study as supported by many researches cheng and giordano 2002 lee et al 2007 watanabe et al 1999 specifically l s was determined based on the flow experiment of creosote wetted parallel walled fractures with a series of nominal aperture sizes conducted by lee et al 2007 the parallel walled fracture experiments enable one to evaluate the flow rate contribution from fluid slippage and consequently to calculate apparent l s the estimated l s was found to be functionally related to the aperture size fig 2 3 l s c 1 c 2 c 3 b where b is aperture size c 1 8 9648 c 2 1 1573 and c 3 0 9956 with a high coefficient of determination r2 0 9545 note that the units of slip length l s and b in equation 3 are μm according to this function and the mean mechanical aperture b l s of each 2d fracture used in this study was satisfactorily determined table 1 it should be mentioned that l s is expected to be different at different fracture locations since aperture varied from point to point however we started with a simple situation by using a uniform l s over the entire fracture domain which was usually adopted in many previous studies e g afsharpoor and javadpour 2016 cui et al 2019 lee et al 2013 a sensitive analysis of uniform l s on flow behavior was further conducted to assess the effects of l s 3 results 3 1 microscale eddy evolution with increasing pressure gradient it is now well known that eddies are commonly present near the rough surface walls at high external hydraulic gradients cardenas et al 2009 lee et al 2014a zhou et al 2019b to quantitatively estimate the impact of fluid slippage on microscale flow structures a recently proposed eddy detection technique zhou et al 2019b was adopted to analyze the solved velocity fields of these four fractures this technique was developed based on a zero integral flux method which can precisely detect the eddy boundary and further calculate the total eddy volume interested readers can refer to zhou et al 2018 2019b for more details on this technique the accessible matlab code for this eddy detection technique can be found at https doi org 10 6084 m9 figshare 5811399 v5 typical segments with detected eddies were illustrated in the inset of fig 3 with its location marked in fig 1 with a blue color for the illustrative purpose we also demonstrated the segment where eddy firstly emerged in the fracture fig 3 as marked with a pink color in fig 1 the detected eddies for both no slip and slip bcs were prone to develop in abruptly changing aperture regions inset of fig 3 which is consistent with previous studies boutt et al 2006 cardenas et al 2009 lee et al 2014b previous study also revealed that the eddy formation and growth were largely dependent on the angle of flow entry with respect to the angle of expansion cardenas et al 2009 here the bcs were proven to have a significant impact on eddy growth and evolution with increasing pressure gradients fig 3 the eddy appeared earlier and grew faster with increasing hydraulic gradients dh dl for cases with slip bc than these with no slip bc two typical patterns of eddy shape were observed between two different bcs given the same dh dl a both of eddies shared a common start point but the slip case exhibited a tailing end point b a shifting of eddy s location occurred inset of fig 3a in any case the eddy size enlarged for the slip cases the difference in eddy size for these two bcs is more intuitive by plotting the determined total eddy volume ratio θ volume of all eddies fracture volume with increasing dh dl fig 3 clearly the gap of θ between these two bcs initially increased with dh dl and it either narrowed fig 3a or maintained fig 3b 3d with a further increase of dh dl note that for fracture b θ was not zero even if the applied dh dl was tiny fig 3b when bcs effect was trivial this kind of eddy is referred to as the moffatt or stokes eddies kitanidis and dykaar 1997 moffatt 1964 which can form around the sharp corners in the viscous flow regime and is entirely dependent on the geometry cardenas et al 2009 chaudhary et al 2011 physically fluid slippage plays a role of lubrication in eddy development eddies can develop for no slip cases as long as inertial effect was significant at large values of dh dl fig 3 whereas slip bc lubricated the boundaries and further contributed to the enhanced growth of eddies the lubrication effect was fundamentally attributed to the non zero velocity at the fracture walls fig 4 for direct numerical simulations the slippage or lubrication was realized by applying the slip velocity in equation 2 which was zero for no slip bc the profiles of velocity magnitude u were different under different dh dl as demonstrated by a section of fracture a that is the slip velocity u at fracture wall solid points in fig 4 increased with dh dl this is in line with equation 2 as a higher dh dl results in a higher velocity gradient and consequently leads to a larger slip velocity at the wall surface the difference in microscale flow structures of these two bc cases was compared at the same dh dl above moreover we plotted θ versus reynolds number re fig 5 an important dimensionless number indicating the flow regimes where re is defined as ρq μ where q unit m2 s 1 is the specific flux at the outlet different from the significant gap between two bc cases fig 3 the θ re curves almost overlapped with a subtle difference between no slip and slip bcs fig 5 this is reasonable as θ inherently signifies the reduced effective flow region and thus is indirectly related to q at the outlet and re was directly estimated based on q therefore fluid slippage barely affected the relationship between re and θ in fact the shape of θ re curves mainly depended on the fracture roughness where at the beginning before the black dash line in fig 5 the rougher the fracture was table 1 the earlier and more prominently the eddies grew despite that the θ re curves may intersect with a further increasing re fig 5 it should be mentioned that this study adopted 2d rather than three dimensional 3d fracture models to explore the effect of fluid slippage because 2d models represent a simplified and tractable situation assuming that the 2d geometry in x y plane in fig 1 extends infinitely in the direction normal to the x y plane i e z axis in fig 1 for real rock fractures the fracture geometry is 3d fig 1 where the aperture field also varies in the z axis in this situation the eddy shape is 3d and its growth would be more complex than the 2d cases resulting in unresolvable quantification of eddy growth however this simplification would not affect the underlying physics we intended to investigate that is the lubrication mechanism of fluid slippage in eddy growth revealed above based on 2d models also applies to 3d situations as the underlying interaction between fluid and fracture wall is the same regardless of dimensionality 3 2 macroscale non darcian flow behavior the microscale flow structures bears significance on the macroscale flow behavior with an increase of applied dh dl the curve gradually deviated from the linear darcy s law dashed lines in fig 6 for all fractures with both no slip and slip bcs this non darcian i e nonlinear flow behavior is ascribed to the occurrence of microscale eddies induced by significant inertial effects with increasing dh dl cardenas et al 2009 lee et al 2014b the flow nonlinearity can be well described by the forchheimer equation solid lines in fig 6 forchheimer 1901 zhou et al 2015 zimmerman et al 2004 4 p μ k v β ρ v 2 where p ρg dh dl and v q b h are the pressure gradient and average velocity respectively k b h 2 12 is the intrinsic permeability β unit m 1 is the inertial resistance coefficient b h is the hydraulic aperture note that k refers to the permeability at a minuscule dh dl where the inertial effect is negligible k b h and β can be determined by fitting equation 4 using the applied dh dl and the measured q at the outlet the determined b h is listed in table 1 as expected b h in slip bc cases is larger than these no slip cases where the enhancement of b h is essentially attributed to the slip velocity at the fracture wall fig 4 to quantify the flow nonlinearity we calculated the critical reynolds number re c for each q dh dl curve in fig 6 re c indicating the onset of non darcian flow can be defined as a critical point where the nonlinear pressure drop μv k contributes to α percentage of the overall pressure drop μv k βρv 2 javadi et al 2014 zeng and grigg 2006 therefore re c is formulated as zhou et al 2015 5 r e c α b h 1 α β k following previous studies liu et al 2018 wang et al 2016a we set the factor α 5 to estimate re c table 1 considering the flow nonlinearity and range of re in this study note that α 10 was also used in the literature javadi et al 2014 wang et al 2014 but was not applied here due to two reasons 1 the determined re c did not change significantly as α varied 5 or 10 and most importantly 2 some determined values of re c using α 10 were beyond the constraints for numerical simulations i e simulations did not converge and therefore was disregarded it is worth mentioning that the method of determining re c is quantitative consistent and varying for different fractures to identify the onset of non darcian flow which is different from the commonly used re c where the characteristic length is somehow arbitrary javadi et al 2014 wang et al 2014 zhou et al 2015 for all four fractures re c of slip bc case is smaller than the no slip case this indicates that flow with slip bc is more prone to transition into the non darcian flow regime than that with no slip bc this is consistent with the microscale flow process discussed above where eddies grew earlier and faster with slip bc given the same dh dl the normalized apparent permeability k a calculated by the darcy s law p μv was plotted against re in fig 7 note that for each fracture k a with no slip and slip bcs were both normalized by the intrinsic permeability with no slip bc when inertial effects were trivial named k 0 in the following undoubtedly k a monotonically decreased with re following the non darcian behavior with the maximum reduction up to nearly 50 in our study for the slip bc the normalized k a exceeded 1 when re approached zero gray area in fig 7 indicating the intrinsic permeability in slip bc case was larger than the no slip one this could also support the argument that fluid slippage is a plausible explanation for many experimental observations of near end point k r 1 for the two phase flow berg et al 2008 christensen and tanino 2017 mcphee and arthur 1994 4 discussion 4 1 a dual role of fluid slippage it is well known that the reduction in k a is a key proxy for non darcian flow behavior which suggests a nonlinear relationship for the pressure flowrate curve chaudhary et al 2011 this reduction is fundamentally ascribed to the reduced effective flow region in the fracture caused by growing eddies here we showed that fluid slippage confound the estimation of k a based on the aforementioned macroscopic and microscopic flow phenomena at the microscale on the one hand fluid slippage can expectedly accelerate the flow and thus enhance k a on the other hand the eddy evolution for slip bc case is earlier and faster i e promoted than the no slip bc case which results in a reduced k a these two competing microscale mechanisms together shape the macroscopic evolution of k a where the increment in k a induced by slip velocity initially dominates over its decrement induced by eddy growth this was demonstrated by the relationship between the normalized k a and θ fig 8 i e the overall level of k a for the slip bc case is higher than the no slip one this suggests that although having the same θ i e the same effective flow region in the fracture the k a with slip bc is larger than the no slip one due to the slip velocity at fracture walls however this dominant effect on k a induced by slip velocity is gradually counteracted by the accelerated eddy growth because the late portion of k a θ curve for the slip bc case is steeper than the no slip one indicating a faster reduction in k a with increasing θ fig 8 consequently the gap of k a between slip and no slip bcs narrowed with increasing θ and the two k a θ curves tended to intersect dashed lines in fig 8 with a further increase of θ indicating that k a of no slip and slip bcs could be identical if dh dl or flux is sufficiently large taking fracture c for example k as of no slip and slip bcs were already very close to each other when θ exceeded 0 2 fig 8 4 2 sensitive analysis of slip length slip length is the most critical parameter determining the effects of slip bc to investigate the impact of l s on the fluid flow behavior sensitive analyses were conducted for the studied four fractures with relative changes 75 50 50 75 of initial l s the normalized apparent permeability k a k 0 θ curves demonstrated that the fluid flow behavior was greatly sensitive to l s fig 9 where k a k 0 expectedly increased with l s given the same θ the tails of k a k 0 θ curves exhibited a straight line with its slope linearly increasing with l s labeled in fig 9 and fitted in fig 10 indicating fluid slippage accelerates the reduction in k a due to promoted eddy growth which is consistent with the above mentioned results moreover the sensitive analysis further demonstrates that the effect of lubrication due to fluid slippage is increasingly significant with l s besides the intrinsic permeability also proportionally increases with l s fig 10 note that the intrinsic permeability refers to the permeability at a minuscule hydraulic gradient where there is no eddy θ 0 or only stokes eddy is present according to lee et al 2013 the intrinsic permeability for the slip bc cases is 6 k b 2 l s 2 12 therefore the normalized k is 7 k k 0 b 2 l s 2 b 2 1 2 l s b 2 due to l s b l s b 2 equation 7 can be reduced to 8 k k 0 1 4 l s b equation 8 theoretically explains the rationality of the linear relationship between the intrinsic permeability and l s fig 10 these sensitive analyses above suggest that a reasonable estimation of l s would be crucial to accurately describe the effect of fluid slippage on non darcian flow we thus recommend further efforts to evaluate l s for different rock surfaces to mimic the effects induced by a variety of fluid slippages considering the sensitivity of flow behavior to l s it is also worth mentioning that the aperture size dependent l s would be more accurate and appropriate when simulating fluid flow in rock fractures with slippery surfaces rather than the current method with uniform l s hence future study is required to evaluate the impact of varying slip lengths with locations on the flow behaviors based on the approach developed here 5 conclusions we investigated the effects of fluid slippage on eddy growth and non darcian flow behavior in rock fractures based on direct numerical simulations of water flow through four different fracture geometries with a slip boundary condition microscale flow structure analysis by an automatic eddy detection technique showed that eddies grew earlier and faster for slip boundary condition bc cases than no slip one consequently the macroscale flow for slip bc cases is more prone to transition from darcian to non darcian regimes than the no slip counterparts interestingly fluid slippage has a dual role of in altering the apparent permeability k a as k a can be enhanced by the slip velocity at fracture walls but also be reduced by the accelerated eddy growth with increasing pressure gradient k a of no slip and slip bcs could be identical given the sufficiently large pressure gradient sensitive analysis showed that the fluid flow behavior was very sensitive to the slip length moreover both the intrinsic permeability and the decreasing rate of k a were proportional to the slip length our results and findings can be of interest to geologists hydrologists and engineers who are concerned with enhanced oil recovery napl pollution remediation and geological carbon sequestration in fractured rocks where fracture surfaces with slip bc is prevalently present declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work was supported by the national key r d program of china grant no 2018yfc1507200 the national natural science foundation of china grant nos 51909247 41977161 and 41931295 the fundamental research funds for the central universities china university of geosciences wuhan and the open research fund program of state key laboratory of water resources and hydropower engineering science grant no 2018sgg03 
5922,the usepa united states environmental protection agency storm water management model swmm is one of the most widely used numerical models to simulate urban runoff and drainage a typical swmm project has hundreds or thousands of sub catchments and more than 20 parameters associated with six different physical processes for each sub catchment consequently model calibration is a challenging task in this study swmm was integrated with the optimization software tool for research involving computational heuristics ostrich to perform single and multi objective automatic calibration the newly developed ostrich swmm is an open source tool with dozens of parallelized optimization algorithms a catchment in buffalo ny was selected as a case study and was calibrated according to two competing criteria 1 minimizing errors in simulated peak flow and 2 minimizing errors in total flow volume the pareto front for the case study was obtained using a multi objective calibration algorithm and this allowed for evaluating tradeoffs between the peak flow and total volume criteria the results demonstrate that ostrich swmm is a promising tool for automatic calibration of swmm models keywords swmm calibration ostrich multi objective 1 introduction urbanization is associated with continuous increases in impervious land surfaces and this disrupts the water cycle potentially resulting in higher runoff volume more severe urban flooding and lower water quality within associated drainage and waterway systems fletcher et al 2013 zhu et al 2016 2017 quijano et al 2017 with regard to urban stormwater management numerical hydrologic modeling is the primary tool for evaluating and comparing alternative design plans and potential improvements salvadore et al 2015 among various available models the storm water management model swmm rossman 2015 a public domain software developed by the united states environmental protection agency is one of the most widely used and popular numerical models for managing the urban runoff quantity and quality niazi et al 2017 the swmm model can accommodate both single event and long term precipitation time series and can be applied to catchments containing storm drains combined sewer systems csss sanitary sewer systems and other urban drainage networks and features e g green infrastructure components swmm requires a large number of site specific parameters to sufficiently express the complex relationship between rainfall and runoff and various watershed and drainage system characteristics detailed information about the structure and geometric properties of a drainage network is often unavailable or incomplete which further challenges parameter specification cooper et al 2007 wani et al 2017 consequently model calibration is required to estimate swmm parameters e g using procedures that seek to minimize differences between field measured observations such as measured water depth and flow discharge in sewer pipes and corresponding model computed predictions liong et al 1991 barco et al 2008 mancipe munoz et al 2014 shamsi and koran 2017 forcing data e g rainfall used during calibration can consist of days or even years of continuous time series data shamsi and koran 2017 as well as event based subsets that consider one or more storm events extracted from continuous time series data niazi et al 2017 manual trial and error calibration is a commonly used but subjective procedure that relies on practitioner experience and expert judgement to estimate the best fit parameter values for a given model james and kuch 1998 shamsi and koran 2017 conversely automatic calibration is an objective and reproducible procedure for identifying the optimal best fit parameter values of a model dent et al 2004 barco et al 2008 mancipe munoz et al 2014 alamdari et al 2017 the first step of automatic calibration is the specification of an objective function to be optimized next an optimization search algorithm is linked with the swmm model so that it can a perturb swmm parameters b run the swmm executable and c compute the objective function using swmm outputs with this linkage in place an optimizer can iteratively adjust swmm parameter values in search of the optimal best fit configuration that minimizes the given objective function a variety of optimization search algorithms have been applied to automatic calibration including gradient based methods e g steepest descent conjugate gradient combinatorial methods e g the simplex method and heuristic methods e g genetic algorithms shuffled complex evolution algorithms in general gradient based methods require a smaller number of model runs to find the optimal values of the parameters however they may get trapped in local minimal if the initial parameter estimates are not chosen properly mancipe munoz et al 2014 the current state of practice for automatic calibration of swmm models was assessed by reviewing 21 relevant studies in the literature among these studies 18 adopted a single objective calibration approach in which a single objective function i e f x where x is a vector of model parameters formulation was optimized objective functions used in such formulations include peak flow error liong et al 1995 wan and james 2002 alamdari 2016 total flow volume error sun et al 2014a b a statistical measure such as rmse root mean squared error james and kuch 1998 dent et al 2004 fang and ball 2007 tan et al 2008 krebs et al 2013 2014 mancipe munoz et al 2014 baek et al 2015 zahmatkesh et al 2015 or combining the above objectives into one scalar function balascio et al 1998 barco et al 2008 zhao et al 2013 li et al 2014 however the results of these and other studies indicated a significant limitation of combining multiple calibration criteria into a single objective function formulation namely the alternative objectives e g minimize errors in both peak flow and total flow volume may conflict with one another vrugt et al 2003 kollat et al 2012 reed et al 2013 conflicting objectives arise when the optimal set of parameters for one objective are different from the optimal set of parameters for one or more of the alternative objectives three studies in our swmm calibration survey applied a multi objective calibration approach to address the aforementioned problem of conflicting calibration objectives as its name implies multi objective calibration is capable of simultaneously considering multiple conflicting objectives rather than delivering a single optimal parameter set multi objective calibration produces a tradeoff curve i e pareto front of the competing objectives although multi objective calibration has been applied to numerous hydrologic models in the last two decades yapo et al 1998 efstratiadis and koutsoyiannis 2010 reed et al 2013 very few studies have applied this approach in the context of swmm modeling a possible explanation for the lack of multi objective swmm applications is that tools linking swmm with multi objective search algorithms are not readily available moreover individual swmm simulations are often time consuming and multi objective optimization algorithms can require a large number of such runs to obtain good performance a new software tool has been developed that addresses the aforementioned challenges of software linkage and computational burden the newly developed tool links swmm with an open source model independent optimization tool named ostrich optimization software tool for research involving computational heuristics matott 2017 the new tool ostrich swmm provides dozens of optimization algorithms e g dynamically dimensioned search simulated annealing and genetic algorithm many of which are parallelized to run on high performance computing facilities ostrich swmm can be used for both single and multi objective automatic calibration of swmm models as well as other simulation based optimization applications such as green infrastructure siting macro et al 2019 a case study in buffalo new york was conducted to demonstrate the use of ostrich swmm for automatic calibration with both single and multiple objectives minimizing peak flow error and total flow volume error were considered as the conflicting calibration objectives 2 methodology 2 1 ostrich swmm linkage ostrich is a model independent optimization and calibration tool that can be downloaded at no cost from http www eng buffalo edu lsmatott ostrich ostrichmain html ostrich contains a wide variety of optimization algorithms applicable for automated calibration the diverse set of algorithms includes but is not limited to genetic algorithms goldberg 2006 dynamically dimensioned search dds tolson and shoemaker 2007 particle swarm optimization kennedy 2006 and powell s algorithm powell 1977 many of these algorithms are parallelized and this allows the user to take advantage of high performance computing resources such as compute clusters available at the center for computational research ccr at the university at buffalo ub http www buffalo edu ccr html ostrich has been successfully applied to several previous calibration and optimization studies involving water resources engineering groundwater remediation bartelt hunt et al 2006 matott et al 2006a b 2009 2012 matott and rabideau 2008 and regional scale integrated environmental modeling systems johnston et al 2011 haghnegahdar et al 2014 similar to other model independent calibration tools such as pest doherty 1994 and ucode poeter and hill 1999 ostrich requires the modeling program with which it is linked to utilize a text based input and output file format as swmm outputs are in binary file format a python script named swmmtoolbox https pypi python org pypi swmmtoolbox was used to conduct post processing and convert the binary output files to a text based format that is readable to ostrich ostrich is driven by a configuration file and a set of model template files in the ostrich configuration file users can a select and configure the optimization algorithm to be used b specify the model executable file c select the calibration objective function s d specify template files and corresponding model input files e define the calibration parameters along with their initial values and upper and lower bounds and f include observation data and corresponding simulated equivalents i e response variables these simulated equivalents are extracted from the swmm binary output files through the use of the swmmtoolbox application programming interface api the swmm binary output files contain flow depth and velocity at each node and link the structure of the ostrich template files should be identical to the corresponding swmm model input file e g the corresponding inp file except that the value of each calibration parameter is replaced with a unique mnemonic defined in the ostrich configuration file as illustrated in fig 1 these template files along with the swmmtoolbox api for reading model outputs are what facilitate the linkage between ostrich optimizers and the swmm model the ostrich swmm linkage software is written in the python programming language and is open source and available for download from a github repository https github com ubccr ostrich swmm for more information on ostrich and its features refer to the ostrich user manual matott 2017 2 2 optimization algorithms this study utilized both single and multi objective calibration to demonstrate the usability of ostrich swmm among the various single objective optimization algorithms embedded in ostrich dds was chosen because of its computational efficiency ability to avoid local optima and robust convergence properties tolson and shoemaker 2007 pareto archived dds pa dds was chosen for multi objective calibrations padds has been demonstrated to be an extremely effective multi objective algorithm and has won or placed i e top three in several recent optimization competitions e g gecco 2016 and emo 2017 taking advantage of the parallel versions of the aforementioned two algorithms and the parallel environment available at ub ccr parallel dds and parallel padds parapadds algorithms were used for single and multi objective calibrations respectively 3 case study 3 1 study area to demonstrate the use of ostrich swmm for swmm calibration a case study was developed by extracting and modifying a submodel from a more comprehensive swmm model under development for the city of buffalo css the hypothetical submodel was selected to represent a portion of the sewershed associated with four combined sewer overflow cso outfalls see fig 2 an important swmm application is the prediction of cso events which can occur during wet weather events when the combined volume of wastewater and stormwater exceeds the local carrying capacity these overflows can result in the discharge of untreated wastewater into receiving water bodies which negatively impacts both the city in which the cso is located and any downstream communities as such the selected case study is representative of the 772 csss located throughout the united states that service about 40 million people usepa 2011 the modeled drainage area encompasses 104 1 acres of highly urbanized and relatively flat terrain with a mixture of land uses that includes residential 46 6 transportation e g pavement 28 9 commercial industrial 16 2 and vacant 6 5 69 percent of the modeled land surface is impervious buffalo s average annual rainfall precipitation is 1028 mm with minor seasonal variability 3 2 monitoring data measurements of flow and rainfall were collected by the buffalo sewer authority bsa in 2016 2017 to characterize the flow regimes and hydrology of the city s sewer basin rainfall data served as the hydrological forcing function i e input for the swmm model while flow measurements were used to calibrate and evaluate the model using the objective functions described below seven rain gages located throughout the study domain were instrumented to collect rainfall data in 5 min intervals from 9 15 2016 to 7 1 2017 fig 3 provides the mean rainfall intensity of these gauges spatial variation was quite small during the data collection time period except for the storm event that occurred on 6 27 2017 overall storms were more frequent and larger during the second half of the collection period relative to the first half model calibration was performed using data from a single flow meter station 1 in fig 2 that collected flow velocities during both dry and wet weathers these flow measurements were taken at 5 min intervals during the periods of 9 15 2016 1 15 2017 and 3 15 2017 7 1 2017 see fig 3 the first four month period 9 15 2016 to 1 15 2017 was used for calibration while data from the subsequent three month period 3 15 2017 to 6 15 2017 were set aside and used for post calibration model assessment multiple storm flow events were implemented in this study because the calibration and post calibration model assessment processes may possibly be sensitive to the selection of individual storm flow events both low and high intensity rainfall events were included in the seven month calibration period the ability to represent continuous storm flow events in the calibration process was facilitated by the computational efficiency of ostrich swmm 3 3 base swmm model development of the bsa s swmm model was initiated in the year 2000 since that time the model has been modified on multiple occasions to better represent contemporary field conditions and to better address long term control planning and design support questions a sub basin of the bsa s 2016 version of the city wide model was used for this study the corresponding basin consists of 686 swmm sub catchments 76 conduits i e links and 75 nodes i e junctions the infiltration process was modeled within swmm using the green ampt method and flow routing was modeled using the dynamic wave method i e complete solution of the underlying one dimensional saint venant flow equations measured rainfall data and estimated daily evaporation values were provided as source and sink inputs to the swmm model respectively the base model was provided by bsa for use in this study and had already been subject to a partial manual calibration as shown in fig 3 predictions of the manually calibrated base model are generally in agreement with the observed data therefore this study explored potential changes to the calibrated parameters resulting from the use of formalized objective functions and automated search procedures 3 4 objective functions two objective formulations were considered namely minimizing peak flow error f 1 x and minimizing total flow volume error f 2 x for the single flow meter for simplicity in presenting a focused consideration of multiple objectives the peak flow and total flow volume errors were based on a single observation or summation from the monitoring period more complex functions involving the full hydrographs could be assembled in a similar fashion the objective functions are described in eqs 1 and 2 respectively these formulations motivated a series of numerical experiments involving 1 a multi objective calibration that considered both objectives f 1 x and f 2 x and evaluated their trade off 2 a single objective calibration that considered only the peak flow objective f 1 x and 3 a single objective calibration that considered only the total flow volume objective f 2 x 1 min f 1 x q obs max q sim max 2 min f 2 x i 1 n q obs i δ t obs i 1 n q sim i δ t sim where q obs max is the observed peak flow q sim max is the simulated peak flow q obs i is the observed flow at time i q sim i is the simulated flow at time i δ t is the time step and n is the total number of time steps respectively 4 results 4 1 sensitivity analysis pre calibration sensitivity analysis was performed to reduce the number of estimated parameters considered during calibration sensitivity analysis identifies the relative impact of each model input parameter on the model outputs and thereby assists in identifying influential and non influential parameters niazi et al 2017 numerous studies involving swmm models have performed parameter sensitivity analysis and one at a time sensitivity analysis i e changing the value of each input parameter while keeping all other parameters unchanged has been the most common technique james et al 2002 van der sterren et al 2014 table 1 of the supplementary materials provides a summary of previous sensitivity analysis studies involving swmm overall these studies suggest that the parameters exhibiting the greatest sensitivity are specific to the particular study site based on the review of 45 previous studies 15 swmm parameters have been most frequently reported as sensitive in the literature i e reported more than ten times out of the 45 papers that we reviewed these parameters are shown in fig 4 along with the relevant process in the swmm model note that maxrate minrate and decay are only used when infiltration is modeled using the horton equation whereas the bsa model in this case study uses the green ampt equation perturbation values for each parameter included in the sensitivity analysis are shown in table 1 and are consistent with the guidelines provided by james 2005 sensitivity analysis was performed by changing the value of one relative parameter at a time for each parameter adjustment the resulting percent change in the simulated peak flow and total flow volume were computed relative to the results obtained from a single run of the manually calibrated base model simulated peak flows and total flow volumes were extracted from cso 10 one cso outfall of the subcatchment the percentage change values i e the parameter sensitivities were sorted and ranked see table 1 and the resulting sensitivity analyses are presented in fig 5 the parameters that cause the most changes in model outputs are characterized as the most influential parameters following the same approach as barco et al 2008 the maximum percentage change was selected as the criteria and the input parameters were ranked see table 1 with respect to peak flow the most influential parameters are rough ds perv n imperv width conduct n perv and initdef and for total flow volume the most influential parameters are n imperv imp rough and width although slope was the sixth most influential parameter for predicting total flow volume it was nonetheless excluded from model calibration because the study area is very flat the zeroimp ds imperv n perv and suction parameters had minimal influence on either prediction i e peak flow and total flow volume the maximum percentage change on both peak flow and total flow volume for these four parameters were under 0 01 percent which is considered as very small therefore these parameters were also excluded from model calibration the seven most influential parameters are shown in bold font in fig 4 and the relative values of these parameters i e relnimperv relimp etc were calibrated in a series of automatic calibration exercises described below a set of initial automatic calibration trials resulted in calibrated values for n imperv and imp that were very close to the upper bounds of the parameters as defined earlier and established through guidelines provided by james 2005 therefore the bounds of these parameters were modified in order to cover a broader range the modified bounds of n imperv and imp were taken from rossman 2015 and barco et al 2008 respectively the perturbation range of n imperv was from 0 01 mm to 0 2 mm i e 33 to 1200 in terms of relnimperv the relative value calibration parameter and the perturbation range of imp was from 5 to 30 i e 50 to 180 in terms of relimp the relative value calibration parameter 4 2 single objective calibration the manual base calibration included spatial variation of model parameters across subcatchments and or pipe segments for simplicity and clarity of presentation the illustrative automatic calibration did not introduce additional spatial variation but adjusted each variable as a group without changing the spatial relationships this was accomplished by defining new intermediate variables one for each of the swmm calibration variables that represented the proportional change to all individual values of each particular variable in practice it would be straightforward to simultaneously calibrate individual values of spatially variable parameters but additional analysis would be required to select the target parameters for a given computational budget for this study the availability of a preliminary manual calibration provided a degree of parameter spatial variation therefore for simplicity a simplified relative adjustment procedure was used to constrain the computational requirement for example the rough parameter could be adjusted on a per conduit basis resulting in 76 roughness terms in the sensitivity analysis instead a single relative roughness relrough term was used corresponding to a percent change relative to the value assigned in the manually calibrated base model that was applied to the roughness value of each conduit the equation for mapping relrough values into corresponding rough values is given in eq 3 3 rough i relrough rough i 0 where rough i is the roughness value for the i th conduit relrough is the relative roughness value that was perturbed during sensitivity analysis and rough i 0 is the initial roughness value for the i th conduit as determined by the manually calibrated base model a similar approach was applied to the imp ds imperv n imperv n perv ds perv width zero imperv and slope parameters ostrich swmm was first used to calibrate the swmm model in a pair of single objective calibration exercises the first exercise sought to minimize errors in peak flow i e f 1 x the maximum flow during the calibration period while the second exercise sought to minimize errors in total flow volume i e f 2 x the optimized relative parameter values for each of these calibration exercises are presented in table 2 the results clearly show a significant difference between the parameter set that optimizes the peak flow objective vs the parameter values that optimize the total volume objective for example optimizing peak flow requires adjusting the imp parameter in each sub catchment by just 4 whereas an adjustment of 200 is required when optimizing the total flow volume the objective function values p f 1 x and v f 2 x of the calibrated single objective models are provided in table 3 along with corresponding measures for the model assessment period comparing the p and v values for the peak flow calibration and the total flow volume calibration indicates the presence of competing objectives that is minimizing the peak flow objective results in p 0 00 and v 12 11 while minimizing the total volume objective results in p 0 18 and v 8 38 thus optimizing for peak flow comes at the expense of total volume since v 12 11 v 8 38 and vice versa since p 0 18 p 0 0 in general if these objectives were non competing one would expect both optimizations to yield identical results interestingly the results suggest that the model that is calibrated using the total flow volume objective provides better predictive power during model assessment period refer to fig 3 with respect to both peak flow and total volume i e v 34 92 v 38 65 and p 0 07 p 0 12 it should be noted that this result is particular to the case study and may not be generalizable 4 3 multi objective calibration as discussed above the single objective calibration exercises indicate the presence of competing objectives e g minimizing errors in peak flow comes at the expense of increased errors in total flow volume this finding motivates the consideration of a multi objective calibration exercise to determine the trade off curve for the two competing objectives the resulting pareto front from the multi objective calibration is provided in fig 6 along with the results of the two single objective calibrations the pareto front of a multi objective problem consists of the set of non dominated solutions in which it is not possible to improve one objective without degrading the competing objective without additional criteria all pareto optimal solutions can be considered candidates for the best fit parameter set three non dominated solutions were selected from the pareto front and included in table 3 to facilitate a more detailed comparison with the single objective solutions the selected three points lie on the pareto front and are not dominated by any other points on the other hand the circle points that are not on the pareto front are dominated by the points that lie on the pareto front for each point that is not on the pareto front there is at least one point on the pareto front that outperforms it comparison of the calibration vs assessment period of these three solutions indicates that a solution that performs better for total flow volume also performs better for total flow volume in the assessment period however a solution that performs better for peak flow does not necessarily perform better for peak flow in the assessment period although these particular results may not be generalizable to other specific sites the muti objective capability of swmm ostrich allows the user to explore objective function trade offs in a similar fashion although sufficient to demonstrate ostrich swmm the calibration exercises considered in this study could be improved in a number of ways for example peak flow and total flow volume do not take advantage of all of the observation data that are available other statistical measures such as rmse that take into account all of the observations in a given time series of flow data could be added to the list of multiple objectives moreover additional types of measured data e g water depth as well as data from additional monitoring locations could also be included in the multi objective calibration these additional data streams can yield calibration results that a further constrain the estimated parameters and or b suggest areas of deficiency in the underlying model structure the multi objective capabilities of ostrich swmm can help practitioners derive the aforementioned types of insights from their calibration activity 5 conclusions an open source tool known as ostrich swmm https github com ubccr ostrich swmm was developed and demonstrated to be useful for both single and multi objective automatic calibration of swmm models the new tool implements several parallel search algorithms and is capable of calibrating event based and or small scale swmm models as well as more complex large scale and or continuously driven models the tool is open source and can be configured to support a variety of calibration criteria e g weighted sum of squared residuals peak flow error total flow volume etc the ostrich swmm tool was demonstrated using a case study involving the css in the city of buffalo new york further studies for areas with different terrain and or climatic conditions are needed more performance measures such as nash sutcliffe efficiency and rmse can also be included as calibration objectives two single objective calibration exercises examined the objectives of minimizing errors in peak flow and minimizing errors in total flow respectively results of these calibrations indicates the presence of competing objectives which motivated a subsequent multi objective calibration exercise because it provides a trade off curve for the competing objectives the multi objective calibration is regarded as yielding more informative parameter estimates than the single objective calibrations the calibrated parameters from each automatic calibration were applied to a separate model assessment period and it was found that pareto dominance relationships can be different relative to the calibration period that is a parameter set that provides a non dominated solution in the calibration period can nonetheless become dominated during the model assessment period and vice versa declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this material is based upon work supported by the u s geological survey under grant cooperative agreement no g16ap00073 we also thank university at buffalo ub renew institute seed grant and buffalo blue sky for financial support buffalo sewer authority for providing the preliminary swmm model and supporting information computational hydraulics international chi for providing a university grant to use pcswmm and ub center for computational research for providing computational resources the opinions and findings presented in this paper are solely those of the authors and do not represent the opinions of the bsa and or any other agency mentioned in the manuscript appendix a supplementary data supplementary data associated with this article can be found in the online version at https doi org 10 1016 j jhydrol 2019 124436 supplementary data the following are the supplementary data to this article supplementary data 1 
5922,the usepa united states environmental protection agency storm water management model swmm is one of the most widely used numerical models to simulate urban runoff and drainage a typical swmm project has hundreds or thousands of sub catchments and more than 20 parameters associated with six different physical processes for each sub catchment consequently model calibration is a challenging task in this study swmm was integrated with the optimization software tool for research involving computational heuristics ostrich to perform single and multi objective automatic calibration the newly developed ostrich swmm is an open source tool with dozens of parallelized optimization algorithms a catchment in buffalo ny was selected as a case study and was calibrated according to two competing criteria 1 minimizing errors in simulated peak flow and 2 minimizing errors in total flow volume the pareto front for the case study was obtained using a multi objective calibration algorithm and this allowed for evaluating tradeoffs between the peak flow and total volume criteria the results demonstrate that ostrich swmm is a promising tool for automatic calibration of swmm models keywords swmm calibration ostrich multi objective 1 introduction urbanization is associated with continuous increases in impervious land surfaces and this disrupts the water cycle potentially resulting in higher runoff volume more severe urban flooding and lower water quality within associated drainage and waterway systems fletcher et al 2013 zhu et al 2016 2017 quijano et al 2017 with regard to urban stormwater management numerical hydrologic modeling is the primary tool for evaluating and comparing alternative design plans and potential improvements salvadore et al 2015 among various available models the storm water management model swmm rossman 2015 a public domain software developed by the united states environmental protection agency is one of the most widely used and popular numerical models for managing the urban runoff quantity and quality niazi et al 2017 the swmm model can accommodate both single event and long term precipitation time series and can be applied to catchments containing storm drains combined sewer systems csss sanitary sewer systems and other urban drainage networks and features e g green infrastructure components swmm requires a large number of site specific parameters to sufficiently express the complex relationship between rainfall and runoff and various watershed and drainage system characteristics detailed information about the structure and geometric properties of a drainage network is often unavailable or incomplete which further challenges parameter specification cooper et al 2007 wani et al 2017 consequently model calibration is required to estimate swmm parameters e g using procedures that seek to minimize differences between field measured observations such as measured water depth and flow discharge in sewer pipes and corresponding model computed predictions liong et al 1991 barco et al 2008 mancipe munoz et al 2014 shamsi and koran 2017 forcing data e g rainfall used during calibration can consist of days or even years of continuous time series data shamsi and koran 2017 as well as event based subsets that consider one or more storm events extracted from continuous time series data niazi et al 2017 manual trial and error calibration is a commonly used but subjective procedure that relies on practitioner experience and expert judgement to estimate the best fit parameter values for a given model james and kuch 1998 shamsi and koran 2017 conversely automatic calibration is an objective and reproducible procedure for identifying the optimal best fit parameter values of a model dent et al 2004 barco et al 2008 mancipe munoz et al 2014 alamdari et al 2017 the first step of automatic calibration is the specification of an objective function to be optimized next an optimization search algorithm is linked with the swmm model so that it can a perturb swmm parameters b run the swmm executable and c compute the objective function using swmm outputs with this linkage in place an optimizer can iteratively adjust swmm parameter values in search of the optimal best fit configuration that minimizes the given objective function a variety of optimization search algorithms have been applied to automatic calibration including gradient based methods e g steepest descent conjugate gradient combinatorial methods e g the simplex method and heuristic methods e g genetic algorithms shuffled complex evolution algorithms in general gradient based methods require a smaller number of model runs to find the optimal values of the parameters however they may get trapped in local minimal if the initial parameter estimates are not chosen properly mancipe munoz et al 2014 the current state of practice for automatic calibration of swmm models was assessed by reviewing 21 relevant studies in the literature among these studies 18 adopted a single objective calibration approach in which a single objective function i e f x where x is a vector of model parameters formulation was optimized objective functions used in such formulations include peak flow error liong et al 1995 wan and james 2002 alamdari 2016 total flow volume error sun et al 2014a b a statistical measure such as rmse root mean squared error james and kuch 1998 dent et al 2004 fang and ball 2007 tan et al 2008 krebs et al 2013 2014 mancipe munoz et al 2014 baek et al 2015 zahmatkesh et al 2015 or combining the above objectives into one scalar function balascio et al 1998 barco et al 2008 zhao et al 2013 li et al 2014 however the results of these and other studies indicated a significant limitation of combining multiple calibration criteria into a single objective function formulation namely the alternative objectives e g minimize errors in both peak flow and total flow volume may conflict with one another vrugt et al 2003 kollat et al 2012 reed et al 2013 conflicting objectives arise when the optimal set of parameters for one objective are different from the optimal set of parameters for one or more of the alternative objectives three studies in our swmm calibration survey applied a multi objective calibration approach to address the aforementioned problem of conflicting calibration objectives as its name implies multi objective calibration is capable of simultaneously considering multiple conflicting objectives rather than delivering a single optimal parameter set multi objective calibration produces a tradeoff curve i e pareto front of the competing objectives although multi objective calibration has been applied to numerous hydrologic models in the last two decades yapo et al 1998 efstratiadis and koutsoyiannis 2010 reed et al 2013 very few studies have applied this approach in the context of swmm modeling a possible explanation for the lack of multi objective swmm applications is that tools linking swmm with multi objective search algorithms are not readily available moreover individual swmm simulations are often time consuming and multi objective optimization algorithms can require a large number of such runs to obtain good performance a new software tool has been developed that addresses the aforementioned challenges of software linkage and computational burden the newly developed tool links swmm with an open source model independent optimization tool named ostrich optimization software tool for research involving computational heuristics matott 2017 the new tool ostrich swmm provides dozens of optimization algorithms e g dynamically dimensioned search simulated annealing and genetic algorithm many of which are parallelized to run on high performance computing facilities ostrich swmm can be used for both single and multi objective automatic calibration of swmm models as well as other simulation based optimization applications such as green infrastructure siting macro et al 2019 a case study in buffalo new york was conducted to demonstrate the use of ostrich swmm for automatic calibration with both single and multiple objectives minimizing peak flow error and total flow volume error were considered as the conflicting calibration objectives 2 methodology 2 1 ostrich swmm linkage ostrich is a model independent optimization and calibration tool that can be downloaded at no cost from http www eng buffalo edu lsmatott ostrich ostrichmain html ostrich contains a wide variety of optimization algorithms applicable for automated calibration the diverse set of algorithms includes but is not limited to genetic algorithms goldberg 2006 dynamically dimensioned search dds tolson and shoemaker 2007 particle swarm optimization kennedy 2006 and powell s algorithm powell 1977 many of these algorithms are parallelized and this allows the user to take advantage of high performance computing resources such as compute clusters available at the center for computational research ccr at the university at buffalo ub http www buffalo edu ccr html ostrich has been successfully applied to several previous calibration and optimization studies involving water resources engineering groundwater remediation bartelt hunt et al 2006 matott et al 2006a b 2009 2012 matott and rabideau 2008 and regional scale integrated environmental modeling systems johnston et al 2011 haghnegahdar et al 2014 similar to other model independent calibration tools such as pest doherty 1994 and ucode poeter and hill 1999 ostrich requires the modeling program with which it is linked to utilize a text based input and output file format as swmm outputs are in binary file format a python script named swmmtoolbox https pypi python org pypi swmmtoolbox was used to conduct post processing and convert the binary output files to a text based format that is readable to ostrich ostrich is driven by a configuration file and a set of model template files in the ostrich configuration file users can a select and configure the optimization algorithm to be used b specify the model executable file c select the calibration objective function s d specify template files and corresponding model input files e define the calibration parameters along with their initial values and upper and lower bounds and f include observation data and corresponding simulated equivalents i e response variables these simulated equivalents are extracted from the swmm binary output files through the use of the swmmtoolbox application programming interface api the swmm binary output files contain flow depth and velocity at each node and link the structure of the ostrich template files should be identical to the corresponding swmm model input file e g the corresponding inp file except that the value of each calibration parameter is replaced with a unique mnemonic defined in the ostrich configuration file as illustrated in fig 1 these template files along with the swmmtoolbox api for reading model outputs are what facilitate the linkage between ostrich optimizers and the swmm model the ostrich swmm linkage software is written in the python programming language and is open source and available for download from a github repository https github com ubccr ostrich swmm for more information on ostrich and its features refer to the ostrich user manual matott 2017 2 2 optimization algorithms this study utilized both single and multi objective calibration to demonstrate the usability of ostrich swmm among the various single objective optimization algorithms embedded in ostrich dds was chosen because of its computational efficiency ability to avoid local optima and robust convergence properties tolson and shoemaker 2007 pareto archived dds pa dds was chosen for multi objective calibrations padds has been demonstrated to be an extremely effective multi objective algorithm and has won or placed i e top three in several recent optimization competitions e g gecco 2016 and emo 2017 taking advantage of the parallel versions of the aforementioned two algorithms and the parallel environment available at ub ccr parallel dds and parallel padds parapadds algorithms were used for single and multi objective calibrations respectively 3 case study 3 1 study area to demonstrate the use of ostrich swmm for swmm calibration a case study was developed by extracting and modifying a submodel from a more comprehensive swmm model under development for the city of buffalo css the hypothetical submodel was selected to represent a portion of the sewershed associated with four combined sewer overflow cso outfalls see fig 2 an important swmm application is the prediction of cso events which can occur during wet weather events when the combined volume of wastewater and stormwater exceeds the local carrying capacity these overflows can result in the discharge of untreated wastewater into receiving water bodies which negatively impacts both the city in which the cso is located and any downstream communities as such the selected case study is representative of the 772 csss located throughout the united states that service about 40 million people usepa 2011 the modeled drainage area encompasses 104 1 acres of highly urbanized and relatively flat terrain with a mixture of land uses that includes residential 46 6 transportation e g pavement 28 9 commercial industrial 16 2 and vacant 6 5 69 percent of the modeled land surface is impervious buffalo s average annual rainfall precipitation is 1028 mm with minor seasonal variability 3 2 monitoring data measurements of flow and rainfall were collected by the buffalo sewer authority bsa in 2016 2017 to characterize the flow regimes and hydrology of the city s sewer basin rainfall data served as the hydrological forcing function i e input for the swmm model while flow measurements were used to calibrate and evaluate the model using the objective functions described below seven rain gages located throughout the study domain were instrumented to collect rainfall data in 5 min intervals from 9 15 2016 to 7 1 2017 fig 3 provides the mean rainfall intensity of these gauges spatial variation was quite small during the data collection time period except for the storm event that occurred on 6 27 2017 overall storms were more frequent and larger during the second half of the collection period relative to the first half model calibration was performed using data from a single flow meter station 1 in fig 2 that collected flow velocities during both dry and wet weathers these flow measurements were taken at 5 min intervals during the periods of 9 15 2016 1 15 2017 and 3 15 2017 7 1 2017 see fig 3 the first four month period 9 15 2016 to 1 15 2017 was used for calibration while data from the subsequent three month period 3 15 2017 to 6 15 2017 were set aside and used for post calibration model assessment multiple storm flow events were implemented in this study because the calibration and post calibration model assessment processes may possibly be sensitive to the selection of individual storm flow events both low and high intensity rainfall events were included in the seven month calibration period the ability to represent continuous storm flow events in the calibration process was facilitated by the computational efficiency of ostrich swmm 3 3 base swmm model development of the bsa s swmm model was initiated in the year 2000 since that time the model has been modified on multiple occasions to better represent contemporary field conditions and to better address long term control planning and design support questions a sub basin of the bsa s 2016 version of the city wide model was used for this study the corresponding basin consists of 686 swmm sub catchments 76 conduits i e links and 75 nodes i e junctions the infiltration process was modeled within swmm using the green ampt method and flow routing was modeled using the dynamic wave method i e complete solution of the underlying one dimensional saint venant flow equations measured rainfall data and estimated daily evaporation values were provided as source and sink inputs to the swmm model respectively the base model was provided by bsa for use in this study and had already been subject to a partial manual calibration as shown in fig 3 predictions of the manually calibrated base model are generally in agreement with the observed data therefore this study explored potential changes to the calibrated parameters resulting from the use of formalized objective functions and automated search procedures 3 4 objective functions two objective formulations were considered namely minimizing peak flow error f 1 x and minimizing total flow volume error f 2 x for the single flow meter for simplicity in presenting a focused consideration of multiple objectives the peak flow and total flow volume errors were based on a single observation or summation from the monitoring period more complex functions involving the full hydrographs could be assembled in a similar fashion the objective functions are described in eqs 1 and 2 respectively these formulations motivated a series of numerical experiments involving 1 a multi objective calibration that considered both objectives f 1 x and f 2 x and evaluated their trade off 2 a single objective calibration that considered only the peak flow objective f 1 x and 3 a single objective calibration that considered only the total flow volume objective f 2 x 1 min f 1 x q obs max q sim max 2 min f 2 x i 1 n q obs i δ t obs i 1 n q sim i δ t sim where q obs max is the observed peak flow q sim max is the simulated peak flow q obs i is the observed flow at time i q sim i is the simulated flow at time i δ t is the time step and n is the total number of time steps respectively 4 results 4 1 sensitivity analysis pre calibration sensitivity analysis was performed to reduce the number of estimated parameters considered during calibration sensitivity analysis identifies the relative impact of each model input parameter on the model outputs and thereby assists in identifying influential and non influential parameters niazi et al 2017 numerous studies involving swmm models have performed parameter sensitivity analysis and one at a time sensitivity analysis i e changing the value of each input parameter while keeping all other parameters unchanged has been the most common technique james et al 2002 van der sterren et al 2014 table 1 of the supplementary materials provides a summary of previous sensitivity analysis studies involving swmm overall these studies suggest that the parameters exhibiting the greatest sensitivity are specific to the particular study site based on the review of 45 previous studies 15 swmm parameters have been most frequently reported as sensitive in the literature i e reported more than ten times out of the 45 papers that we reviewed these parameters are shown in fig 4 along with the relevant process in the swmm model note that maxrate minrate and decay are only used when infiltration is modeled using the horton equation whereas the bsa model in this case study uses the green ampt equation perturbation values for each parameter included in the sensitivity analysis are shown in table 1 and are consistent with the guidelines provided by james 2005 sensitivity analysis was performed by changing the value of one relative parameter at a time for each parameter adjustment the resulting percent change in the simulated peak flow and total flow volume were computed relative to the results obtained from a single run of the manually calibrated base model simulated peak flows and total flow volumes were extracted from cso 10 one cso outfall of the subcatchment the percentage change values i e the parameter sensitivities were sorted and ranked see table 1 and the resulting sensitivity analyses are presented in fig 5 the parameters that cause the most changes in model outputs are characterized as the most influential parameters following the same approach as barco et al 2008 the maximum percentage change was selected as the criteria and the input parameters were ranked see table 1 with respect to peak flow the most influential parameters are rough ds perv n imperv width conduct n perv and initdef and for total flow volume the most influential parameters are n imperv imp rough and width although slope was the sixth most influential parameter for predicting total flow volume it was nonetheless excluded from model calibration because the study area is very flat the zeroimp ds imperv n perv and suction parameters had minimal influence on either prediction i e peak flow and total flow volume the maximum percentage change on both peak flow and total flow volume for these four parameters were under 0 01 percent which is considered as very small therefore these parameters were also excluded from model calibration the seven most influential parameters are shown in bold font in fig 4 and the relative values of these parameters i e relnimperv relimp etc were calibrated in a series of automatic calibration exercises described below a set of initial automatic calibration trials resulted in calibrated values for n imperv and imp that were very close to the upper bounds of the parameters as defined earlier and established through guidelines provided by james 2005 therefore the bounds of these parameters were modified in order to cover a broader range the modified bounds of n imperv and imp were taken from rossman 2015 and barco et al 2008 respectively the perturbation range of n imperv was from 0 01 mm to 0 2 mm i e 33 to 1200 in terms of relnimperv the relative value calibration parameter and the perturbation range of imp was from 5 to 30 i e 50 to 180 in terms of relimp the relative value calibration parameter 4 2 single objective calibration the manual base calibration included spatial variation of model parameters across subcatchments and or pipe segments for simplicity and clarity of presentation the illustrative automatic calibration did not introduce additional spatial variation but adjusted each variable as a group without changing the spatial relationships this was accomplished by defining new intermediate variables one for each of the swmm calibration variables that represented the proportional change to all individual values of each particular variable in practice it would be straightforward to simultaneously calibrate individual values of spatially variable parameters but additional analysis would be required to select the target parameters for a given computational budget for this study the availability of a preliminary manual calibration provided a degree of parameter spatial variation therefore for simplicity a simplified relative adjustment procedure was used to constrain the computational requirement for example the rough parameter could be adjusted on a per conduit basis resulting in 76 roughness terms in the sensitivity analysis instead a single relative roughness relrough term was used corresponding to a percent change relative to the value assigned in the manually calibrated base model that was applied to the roughness value of each conduit the equation for mapping relrough values into corresponding rough values is given in eq 3 3 rough i relrough rough i 0 where rough i is the roughness value for the i th conduit relrough is the relative roughness value that was perturbed during sensitivity analysis and rough i 0 is the initial roughness value for the i th conduit as determined by the manually calibrated base model a similar approach was applied to the imp ds imperv n imperv n perv ds perv width zero imperv and slope parameters ostrich swmm was first used to calibrate the swmm model in a pair of single objective calibration exercises the first exercise sought to minimize errors in peak flow i e f 1 x the maximum flow during the calibration period while the second exercise sought to minimize errors in total flow volume i e f 2 x the optimized relative parameter values for each of these calibration exercises are presented in table 2 the results clearly show a significant difference between the parameter set that optimizes the peak flow objective vs the parameter values that optimize the total volume objective for example optimizing peak flow requires adjusting the imp parameter in each sub catchment by just 4 whereas an adjustment of 200 is required when optimizing the total flow volume the objective function values p f 1 x and v f 2 x of the calibrated single objective models are provided in table 3 along with corresponding measures for the model assessment period comparing the p and v values for the peak flow calibration and the total flow volume calibration indicates the presence of competing objectives that is minimizing the peak flow objective results in p 0 00 and v 12 11 while minimizing the total volume objective results in p 0 18 and v 8 38 thus optimizing for peak flow comes at the expense of total volume since v 12 11 v 8 38 and vice versa since p 0 18 p 0 0 in general if these objectives were non competing one would expect both optimizations to yield identical results interestingly the results suggest that the model that is calibrated using the total flow volume objective provides better predictive power during model assessment period refer to fig 3 with respect to both peak flow and total volume i e v 34 92 v 38 65 and p 0 07 p 0 12 it should be noted that this result is particular to the case study and may not be generalizable 4 3 multi objective calibration as discussed above the single objective calibration exercises indicate the presence of competing objectives e g minimizing errors in peak flow comes at the expense of increased errors in total flow volume this finding motivates the consideration of a multi objective calibration exercise to determine the trade off curve for the two competing objectives the resulting pareto front from the multi objective calibration is provided in fig 6 along with the results of the two single objective calibrations the pareto front of a multi objective problem consists of the set of non dominated solutions in which it is not possible to improve one objective without degrading the competing objective without additional criteria all pareto optimal solutions can be considered candidates for the best fit parameter set three non dominated solutions were selected from the pareto front and included in table 3 to facilitate a more detailed comparison with the single objective solutions the selected three points lie on the pareto front and are not dominated by any other points on the other hand the circle points that are not on the pareto front are dominated by the points that lie on the pareto front for each point that is not on the pareto front there is at least one point on the pareto front that outperforms it comparison of the calibration vs assessment period of these three solutions indicates that a solution that performs better for total flow volume also performs better for total flow volume in the assessment period however a solution that performs better for peak flow does not necessarily perform better for peak flow in the assessment period although these particular results may not be generalizable to other specific sites the muti objective capability of swmm ostrich allows the user to explore objective function trade offs in a similar fashion although sufficient to demonstrate ostrich swmm the calibration exercises considered in this study could be improved in a number of ways for example peak flow and total flow volume do not take advantage of all of the observation data that are available other statistical measures such as rmse that take into account all of the observations in a given time series of flow data could be added to the list of multiple objectives moreover additional types of measured data e g water depth as well as data from additional monitoring locations could also be included in the multi objective calibration these additional data streams can yield calibration results that a further constrain the estimated parameters and or b suggest areas of deficiency in the underlying model structure the multi objective capabilities of ostrich swmm can help practitioners derive the aforementioned types of insights from their calibration activity 5 conclusions an open source tool known as ostrich swmm https github com ubccr ostrich swmm was developed and demonstrated to be useful for both single and multi objective automatic calibration of swmm models the new tool implements several parallel search algorithms and is capable of calibrating event based and or small scale swmm models as well as more complex large scale and or continuously driven models the tool is open source and can be configured to support a variety of calibration criteria e g weighted sum of squared residuals peak flow error total flow volume etc the ostrich swmm tool was demonstrated using a case study involving the css in the city of buffalo new york further studies for areas with different terrain and or climatic conditions are needed more performance measures such as nash sutcliffe efficiency and rmse can also be included as calibration objectives two single objective calibration exercises examined the objectives of minimizing errors in peak flow and minimizing errors in total flow respectively results of these calibrations indicates the presence of competing objectives which motivated a subsequent multi objective calibration exercise because it provides a trade off curve for the competing objectives the multi objective calibration is regarded as yielding more informative parameter estimates than the single objective calibrations the calibrated parameters from each automatic calibration were applied to a separate model assessment period and it was found that pareto dominance relationships can be different relative to the calibration period that is a parameter set that provides a non dominated solution in the calibration period can nonetheless become dominated during the model assessment period and vice versa declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this material is based upon work supported by the u s geological survey under grant cooperative agreement no g16ap00073 we also thank university at buffalo ub renew institute seed grant and buffalo blue sky for financial support buffalo sewer authority for providing the preliminary swmm model and supporting information computational hydraulics international chi for providing a university grant to use pcswmm and ub center for computational research for providing computational resources the opinions and findings presented in this paper are solely those of the authors and do not represent the opinions of the bsa and or any other agency mentioned in the manuscript appendix a supplementary data supplementary data associated with this article can be found in the online version at https doi org 10 1016 j jhydrol 2019 124436 supplementary data the following are the supplementary data to this article supplementary data 1 
5923,the utilization of complicated water quality models is the primary approach used to forecast water quality these models however are not easy to employ because of constraints such as data limitation extensive computations and future boundary conditions long short term memory lstm can overcome such constraints however its applications in water quality forecast have rarely been explored in this study the ability of lstm to simulate the forecast capacity of a complicated water quality model i e environmental fluid dynamics code efdc is investigated first the efdc is run to produce a long term 12 years time series of six water quality variables these variables are intrinsically associated with equations embedded in the efdc that represent the dynamics of the simulated system the lstm is developed to forecast the concentration of chlorophyll a 1 31 d ahead of time using six water quality variables the generated data are thereafter employed to train a number of lstms with different model structures combinations of input variables numbers of hidden layers and lag times the lstm performances are evaluated by the nash sutcliffe efficiency coefficient and random forest is applied to identify the key drivers of lstm performance the results show that many lstms could achieve an acceptable performance level chlorophyll a water temperature and total phosphorus are identified as the key drivers of lstm performances which are consistent with limnological theories the number of hidden layers and lag time practically have no impact on the lstm performance it is thereby confirmed that an lstm with a simple structure could simulate the forecast capacity of efdc the results also reveal that the mechanism guided lstm in our study may capture certain mechanism features the lstm is thus expected to be a promising approach for water quality forecast keywords long short term memory lstm environmental fluid dynamics code efdc water quality forecast random forests rf complicated dynamics 1 introduction water quality forecasts are extremely vital in providing early warnings and taking actions ahead of time to mitigate pollution maguire et al 2016 salacinska et al 2010 the use of complicated water quality models e g environmental fluid dynamics code efdc is the primary approach employed for forecasting water quality because of the ability of these models to describe migrations and transformations of water quality variables kim et al 2017 tassin and leite 1998 vincon leite and casenave 2019 in practice however complicated water quality models are always data demanding and time consuming to develop cox et al 2006 oreskes et al 1994 wellen et al 2015 moreover the forecast accuracy of water quality models depends to a considerable extent on the forecast of boundary conditions e g weather conditions and load input jiang et al 2018 stolwijk et al 1998 which are difficult to predict water quality forecast therefore remains difficult to conduct although water quality models are extremely capable of simulating the complicated dynamics of water quality variables as an alternative the use of data driven methods can efficiently establish the relationships among water quality variables thus saving computational time and rendering the forecast of boundary conditions unnecessary maier and dandy 1996 there are apprehensions however regarding their direct application because data driven methods lack mechanism processes reichstein et al 2019 the absence of these processes in data driven methods however does not necessarily lead to the failure of water quality forecast the key question should be whether a data driven model could simulate the forecast ability of a complicated water quality model if the former model is capable then a data driven method could be utilized as an effective tool to forecast water quality even if there is no equation that represents any mechanism process a number of data driven methods could be used for time series forecast traditional statistical methods such as autoregressive moving average however are always constrained by the assumptions of stationary time series and normal error distribution thereby causing nonlinear relationships difficult to simulate maier and dandy 1996 recurrent neural network rnn can overcome the foregoing constraints coulibaly and baldwin 2005 the conventional rnn however has an inadequate capability in learning long term dependencies because of the vanishing or exploding gradient problem on the other hand long short term memory lstm as an advanced rnn is proposed to overcome this inadequacy by means of a special model structure design for information filtering and conversion hochreiter and schmidhuber 1997 kratzert et al 2018 note that although certain classical machine learning methods e g artificial neural networks palani et al 2008 could also be used for time series forecast that benefit from hand crafted features to account for time dependencies their exploitation of temporal dependencies is rarely exhaustive reichstein et al 2019 moreover their performances are always worse than that of the lstm zhang et al 2018a recently the lstm has been introduced into geoscience research reichstein et al 2019 for example the lstm has been successfully applied to predict the water table depth in an agricultural area with complex heterogeneous characteristics zhang et al 2018b considering the possible suitability of lstm on water quality forecast particularly when long term high frequency data become available in the future hipsey et al 2019 the ability of lstm to simulate the forecast capacity of a complicated water quality model is worth investigating this study has two research objectives 1 to determine whether the lstm is capable of simulating the forecast capacity of a complicated water quality model 2 and if so to determine whether it is possible to adopt a simple model structure e g a structure that only involves several input variables and several hidden layers to obtain a satisfactory model performance one of the most widely used complicated water quality models the efdc kim et al 2017 zou et al 2006 is selected as the water quality model a number of lstm models are developed and their performances are evaluated random forest breiman 2001 is further used to determine the key drivers of lstm performance and to investigate whether it is possible for a capable lstm to have a simple model structure 2 materials and methods the methodology framework is shown in fig 1 in view of the critical conditions of harmful algal blooms worldwide huisman et al 2018 chlorophyll a chl is selected as the variable to forecast the response variable of lstm as for the drivers water quality variables that impact algae growth such as water temperature tem and nutrients paerl et al 2016 are selected moreover the chl is expected to have a tight self association within some temporal intervals six variables are accordingly selected as predictors tem chl total phosphorus tp phosphate phosphorus po4 total nitrogen tn and ammonia nitrogen nh4 first the efdc is run to obtain a 12 year time series of water quality variables including a response variable to forecast and several variables as predictors complex nonlinear relationships exist between the response variable and predictors if an lstm could well forecast the response variable then this confirms that it is capable of simulating the forecast capacity of the efdc second a number of lstms with different model structures are developed their performances are thereafter evaluated based on the nash sutcliffe efficiency coefficient nse by which it can be determined whether an lstm is capable finally the key drivers of model performance are identified based on random forests rf breiman 2001 which is selected here because of its ability to determine variable importance and its high prediction accuracy cutler et al 2007 rodriguez galiano et al 2014 the rf results could aid in determining whether a capable lstm may have a simple model structure 2 1 generation of time series of water quality variables the efdc is highly capable of simulating hydrodynamics temperature and eutrophication dynamics kim et al 2017 zhao et al 2013 a detailed description of the theories and algorithms of the efdc model can be found in hamrick 1992 running a high dimensional model is computationally expensive hence a zero dimensional efdc is employed this efdc which is derived from a previously validated model on a eutrophic lake liu et al 2014 has a simplified spatial resolution the model is run to obtain 12 years of daily outputs of variables fig s1 in accordance with the results of numerous studies qian et al 2000 sondergaard et al 2017 stow et al 2015 tem chl and nutrients except for po4 clearly exhibit a seasonal cycle the basic statistics of these variables are summarized in table s1 the average chl and nutrient concentrations are all high indicating that the lake has a eutrophic state as expected the autocorrelation coefficients of water quality variables except for po4 are positively significant even when the lag time is as long as 60 d fig s2 the cross correlation coefficients between chl and its drivers except for po4 are also positively significant fig s3 indicating the long term dependencies of chl on its drivers 2 2 develop and evaluate lstms in the lstm memory blocks are introduced to replace hidden layers in traditional neural networks a memory block consists of a forget gate an input gate a memory cell and an output gate gers et al 2000 hochreiter and schmidhuber 1997 the state of a memory block at time t is illustrated in fig 2 the corresponding forward propagation process is illustrated below in the last computation at t 1 both cell state ct 1 and output ht 1 are stored by the block at time t new inputs it are available first the forget gate decides on what information to remove it also generates a value ft between 0 and 1 as a basis for determining the extent of allowing ct 1 to pass by combining ht 1 and it into the sigmoid function eq 1 1 f t σ w f h t 1 u f i t b f in the next step a new candidate cell state c t can be generated by combining ht 1 and it into the tanh function eq 2 2 c t tanh w c h t 1 u c i t b c meanwhile the input gate produces a value it as coefficient of c t according to eq 3 3 i t σ w i h t 1 u i i t b i thereafter the new cell state is determined by ct 1 and c t based on eq 4 4 c t f t c t 1 i t c t next the output gate produces a value ot to determine the parts of the cell state to output based on eq 5 5 o t σ w o h t 1 u o i t b o finally the output is determined by eq 6 6 h t o t tanh c t in eqs 1 2 3 and 5 w and u are the matrices of weights for the gates or cells with the corresponding subscripts b denotes learnable biases in addition σ represents the sigmoid function eq 7 and tanh represents the tanh function eq 8 the initial values of c 0 and h 0 are zero 7 σ x 1 1 e x 8 tanh x e x e x e x e x in the present study the time series is split into two parts training dataset first 9 years and testing dataset remaining 3 years to ensure that the input variables remain on the same scale and to guarantee a stable convergence of parameters in the lstm all input variables and the response are standardized according to eq 9 9 x ij x ij max x i where x and x represent the raw and standardized observations respectively i is the index of variables and j is the order of observations max xi is the maximum of the ith variable every possible combination of the six water quality variables could be used as the input variable s of the lstm the number of input variable combinations for the lstm is 63 26 1 certain hyperparameters of the lstm are set including the number of hidden layers and time lag which are the most related to the model structure the number of hidden layers and time lag are made to vary to explore their impacts on model performance both the number of hidden layers and time lag have eight alternatives 5 10 15 20 30 40 50 and 60 the forecast days are set to be 1 3 5 31 the number of lstms developed is therefore 64 512 63 8 8 16 these models are trained using the training dataset as for the other hyperparameters of lstm the maximal epoch is set to be 20 which means that the model will end upon convergence or the epoch reaches 20 the batch size validation fraction and learning rate are 5 0 15 and 0 001 respectively the backpropagation through a time algorithm werbos 1990 is employed to train lstms the root mean square error is selected as the loss function the nse is one of the most widely used criteria for model performance bennett et al 2013 it is expressed as eq 10 10 nse 1 i 1 n y i y i 2 i 1 n y i y i 2 where yi represents the ith observation of the chl y represents the corresponding value predicted by the lstm y is the average of observations n is the number of observations the nse varies from to 1 following ritter and munoz carpena 2013 the model is acceptable when nse 0 65 and good when nse 0 80 the testing dataset is employed to calculate the nse 2 3 identification of key drivers of lstm performance based on rf random forest is a widely used machine learning method in environmental studies cutler et al 2007 nelson et al 2018 it consists of an ensemble of classifications or regression trees de ath and fabricius 2000 it grows each tree with a bootstrap sample of observations and only uses a small random sample of predictors to define the split at each node each tree is grown to its maximum size without pruning final predictions are obtained by averaging the results of all trees overfitting is avoided by the out of bag procedure which is similar to cross validation li et al 2017 for more details on the rf theory readers are referred to breiman 2001 in this study the rf is employed to identify the key drivers of lstm performance for each forecast day a total of 16 rfs are developed the input variables of rf include six factor variables and two numerical variables number of hidden layers and time lag fig 1 the factor variable labels whether or not a water quality variable is included to forecast the chl in the lstm for each rf the number of observations is 4032 63 8 8 the permutation importance pi is a variable importance metric in the rf catherine et al 2016 mayr et al 2018 zhu and pierskalla 2016 it calculates the importance through a permuting process in which the importance of an input variable is quantified by evaluating the increase in the out of bag error when the variable is permuted altmann et al 2010 a higher pi value indicates a higher variable importance to demonstrate the change in key drivers with the increase in the number of forecast days the pi is normalized to represent the relative importance ri of variables according to eq 11 11 ri i pi i k 1 p pi k where i is the index of input variables and p is the number of input variables all computations are conducted in python and r software keras manaswi 2018 was employed to program the lstm it was written in python and runs on top of theano other python libraries used were matplotlib numpy h5py and pandas the rf is run using the ranger package wright and ziegler 2017 in r the number of trees is set to be 500 the number of trees is also increased but no significant improvement in r2 of rf is observed 3 results 3 1 nse values of lstm the distributions of nse values for each forecast day are shown in fig 3 on the one hand there are certain nse values that are larger than 0 65 the proportion of lstm models is shown by the p value in fig 3 which indicates that there are models with an acceptable performance with the increase in the number of forecast days the position of nse peak density moves towards the left and the overall performance decreases as shown by the mean and median values m and med values in fig 3 respectively of nse on the other hand there are nse values that are less than 0 65 in particular the distributions of nse are all exceedingly left tailed the median is higher than the average as shown in fig 3 there are also some extremely small nse values indicating that certain lstm models have inadequate performances the identification of key drivers of the model performance may be advantageous for building lstm models with a simple structure and high forecast accuracy 3 2 key drivers of lstm performance the results of r2 of rfs are summarized in table s2 the r2 value ranges from 0 744 to 0 854 and decreases with the increase in the number of forecast days the high r2 values that indicate large proportions of nse variations are attributed to input variables thus ensuring the reliability of variable importance results the ri results for each forecast day are shown in fig 4 an input variable of rf is identified to be a key driver if the corresponding ri is higher than 0 1 for all forecast days three key drivers are identified the inclusion or non inclusion of chl tp and tem fig 4a c for each forecast day the sum of ris of the other five input variables is lower than 0 1 fig 4d note that neither of the two hyperparameters number of hidden layers and time lag is identified as key driver with the increase in the number of forecast days the ris of the three key variables exhibit approximately monotonous trends fig 4 as the ris of chl and tp decrease the ri of tem exhibits an opposite change the order of ri also changes with the number of forecast days from day 1 to 15 the ri order of the three key variables is chl tp tem at day 17 tem replaces the position of tp and becomes the second important driver after day 23 the ri of tem exceeds the ri of chl and the ri order becomes tem chl tp the change in ris of the other five variables can be ignored because of their small values the inclusion of key variable s as the input variable significantly improves the overall forecast performance of the lstm fig 5 beanplot results that demonstrate the impact of each key driver on nse values are shown in fig s4 s6 the average nse values of lstms without any key variable are all less than 0 25 fig 5 black line when key variables are included however the average nse values considerably improve fig 5 colored lines when more key variables are included the overall model performance considerably improves the average nse value of lstms including the key variable s decreases with the increase in the number of forecast days fig 5 as shown by the decreasing trends of colored lines when the number of forecast days is less than 9 d the inclusion of one of the three key variables makes the lstm reach the acceptable performance level nse 0 65 the inclusion of more than two key variables can even make the nse exceed 0 8 for certain forecast days when the forecast time exceeds 21 d the overall performance is not acceptable regardless of whether the three key variables are included in the lstm note that when the number of forecast days is relatively high e g 21 only a small proportion of models have nse values exceeding 0 65 fig 3 the inclusion of the identified key variables could barely improve the model performance to the acceptable level further studies are thus required to improve the performance of relatively long term forecasts 4 discussion 4 1 consistency between driver identification results and limnological theories the identification results of key drivers are consistent with the classical theories of limnology the forecast of chl depends on the current state and change during lagged days the chl usually has significant autocorrelated coefficients fig s2 a and has been used to forecast future chl values palani et al 2008 with the increase in the number of forecast days the influence of the current chl state decreases as indicated by the decreasing autocorrelated coefficients leading to the decrease in chl ri fig 4a phosphorus and nitrogen are important chemical factors that control phytoplankton growth conley et al 2009 there are increasing debates between the limitation of phosphorus and co limitation of nitrogen and phosphorus in eutrophic lakes gobler et al 2016 schindler et al 2016 in our case the average tn tp ratio is 45 by mass which is considerably higher than the redfield ratio 7 2 redfield 1958 indicating that tp is more probably the limiting nutrient moreover nitrogen limitation is always seasonal ding et al 2018 dolman et al 2016 kolzau et al 2014 leading to the insufficient forecast of the year round chl based on nitrogen except for impacting phytoplankton growth tp could also be partially treated as a variable of the current chl state because a large proportion of tp is included in the phytoplankton of eutrophic lakes stow and cha 2013 the ri of tp therefore decreases as the ri of chl dose when the number of forecast days increases fig 4b one of the most important physical factors that impact phytoplankton growth is tem paerl and paul 2012 with the increase in the number of forecast days the change in chl during the lagged days increasingly becomes more important to the chl forecast in this study tem during the lagged days is not available and is thereby not an input variable of the lstm as a result of the high autocorrelation coefficients fig s2 c and stable annual pattern fig s1 a of tem the current tem is closely associated with the future tem accordingly the ri of current tem increases fig 4c it should be noted that po4 is not identified as a key driver although it is assumed to be the most bioavailable component of phosphorus dodds 2003 this is because po4 can be influenced by a number of processes e g sediment release or adsorption and uptake by phytoplankton as a result there are certain occasionally high low concentrations with a wide variation fig s1 d which makes it an inadequate predictor for chl forecast compared with po4 tem is a more robust predictor 4 2 capability of lstm with a simple structure to simulate efdc forecast capacity according to the above results an lstm with a simple structure can simulate the forecast capacity of efdc first because many lstms achieve acceptable performance they can well simulate the forecast capacity of efdc second only three water quality variables are identified as the key variables of lstm performance these water quality variables are always regularly monitored the two hyperparameters number of hidden layers and time lag have minimal impacts on the lstm performance and both can be set to small values e g 5 an lstm model with a simple structure can therefore be used to obtain high nse values fig 5 finally the consistency between driver identification results and limnological theories further supports the reliability of results although the average nse could not satisfy the required acceptable level when the number of forecast days exceeds 21 it is noteworthy that the model performance may be improved by including other water quality variables that are not explored in this study or by optimizing the hyperparameters of lstm shahriari et al 2016 4 3 mechanism guided water quality forecast using lstm the integration of physical modeling with machine learning has been recently introduced into geoscience research and is regarded as a promising modeling strategy jia et al 2018 reichstein et al 2019 in this study a typical type of integrating physical modeling with machine learning is presented the efdc is employed to generate the time series of water quality variable these data are intrinsically associated via the mechanism processes presented by mathematical equations these data are therefore the external manifestations of the complex dynamics of the simulated system when these data are used for training the lstm it learns to illustrate system dynamics using nonlinear functions e g eqs 1 8 the training of lstm is indeed guided by the mechanism processes embedded in the efdc the lstm can therefore be theoretically regarded as mechanism guided which means that the model is no longer purely data driven because of the intrinsic associations among variables used for model training in this study it is found that mechanism guided lstms can capture some mechanism features of the simulated system as indicated by the consistency between driver identification results and limnological theories that may benefit from the mechanism guided learning process we thereby argue that the applications of lstm on water quality forecast might not be criticized as purely data driven 1 currently while high frequency water quality data are scarce the integration of a complicated water quality model with the lstm could be used to overcome data limitation in view of the fact that the training is guided by a complicated water quality model the lstm is therefore mechanism guided 2 in the future when long term high frequency data with anomaly detection and disposal become available leigh et al 2019 the lstm could be directly trained by these data and be used for water quality forecast reliable high frequency water quality data are also external manifestations of the complex dynamics of the system the lstm model trained by such data is therefore also mechanism guided the lstm can simulate the forecast capacity of a complicated water quality model it could therefore be an effective tool for high accuracy water quality forecast moreover the lstm is time saving free of boundary conditions and has a simple structure thus making the model easy to implement compared with a complicated water quality model the lstm could be considerably more efficient in water quality forecast the mechanism guided training process may also allow the lstm to capture certain mechanism features thus reducing the apprehensions that the method lacks mechanism processes the lstm is therefore expected to be a potential method for water quality forecast 5 conclusions the ability of lstm to simulate the forecast capacity of efdc is investigated the results show that among the 64 512 lstms many could achieve an acceptable performance level similar to the limnological theories the key variables necessary to forecast chl are identified as chl tem and tp the number of hidden layers and lag time can be set to small values it is thus confirmed that an lstm with a simple structure e g only three input variables with five hidden layers could simulate the forecast capacity of efdc the mechanism guided lstm is expected to be a promising tool because it could be both effective and efficient in forecasting water quality future research should accordingly focus on improving the model performance when a relatively long term forecast is to be conducted author contribution liang zy zou r and liu y designed the overall framework zou r ran the efdc model and obtained the time series of water quality variables liang zy and zou r developed lstms using python liang zy developed rfs in r all the authors contributed to the results analysis and manuscript writing all the authors contribute to the reversion of the manuscript liu y received the fund declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the research was supported by the national science foundation of china 51779002 51721006 and high performance computing platform of peking university appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2019 124432 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
5923,the utilization of complicated water quality models is the primary approach used to forecast water quality these models however are not easy to employ because of constraints such as data limitation extensive computations and future boundary conditions long short term memory lstm can overcome such constraints however its applications in water quality forecast have rarely been explored in this study the ability of lstm to simulate the forecast capacity of a complicated water quality model i e environmental fluid dynamics code efdc is investigated first the efdc is run to produce a long term 12 years time series of six water quality variables these variables are intrinsically associated with equations embedded in the efdc that represent the dynamics of the simulated system the lstm is developed to forecast the concentration of chlorophyll a 1 31 d ahead of time using six water quality variables the generated data are thereafter employed to train a number of lstms with different model structures combinations of input variables numbers of hidden layers and lag times the lstm performances are evaluated by the nash sutcliffe efficiency coefficient and random forest is applied to identify the key drivers of lstm performance the results show that many lstms could achieve an acceptable performance level chlorophyll a water temperature and total phosphorus are identified as the key drivers of lstm performances which are consistent with limnological theories the number of hidden layers and lag time practically have no impact on the lstm performance it is thereby confirmed that an lstm with a simple structure could simulate the forecast capacity of efdc the results also reveal that the mechanism guided lstm in our study may capture certain mechanism features the lstm is thus expected to be a promising approach for water quality forecast keywords long short term memory lstm environmental fluid dynamics code efdc water quality forecast random forests rf complicated dynamics 1 introduction water quality forecasts are extremely vital in providing early warnings and taking actions ahead of time to mitigate pollution maguire et al 2016 salacinska et al 2010 the use of complicated water quality models e g environmental fluid dynamics code efdc is the primary approach employed for forecasting water quality because of the ability of these models to describe migrations and transformations of water quality variables kim et al 2017 tassin and leite 1998 vincon leite and casenave 2019 in practice however complicated water quality models are always data demanding and time consuming to develop cox et al 2006 oreskes et al 1994 wellen et al 2015 moreover the forecast accuracy of water quality models depends to a considerable extent on the forecast of boundary conditions e g weather conditions and load input jiang et al 2018 stolwijk et al 1998 which are difficult to predict water quality forecast therefore remains difficult to conduct although water quality models are extremely capable of simulating the complicated dynamics of water quality variables as an alternative the use of data driven methods can efficiently establish the relationships among water quality variables thus saving computational time and rendering the forecast of boundary conditions unnecessary maier and dandy 1996 there are apprehensions however regarding their direct application because data driven methods lack mechanism processes reichstein et al 2019 the absence of these processes in data driven methods however does not necessarily lead to the failure of water quality forecast the key question should be whether a data driven model could simulate the forecast ability of a complicated water quality model if the former model is capable then a data driven method could be utilized as an effective tool to forecast water quality even if there is no equation that represents any mechanism process a number of data driven methods could be used for time series forecast traditional statistical methods such as autoregressive moving average however are always constrained by the assumptions of stationary time series and normal error distribution thereby causing nonlinear relationships difficult to simulate maier and dandy 1996 recurrent neural network rnn can overcome the foregoing constraints coulibaly and baldwin 2005 the conventional rnn however has an inadequate capability in learning long term dependencies because of the vanishing or exploding gradient problem on the other hand long short term memory lstm as an advanced rnn is proposed to overcome this inadequacy by means of a special model structure design for information filtering and conversion hochreiter and schmidhuber 1997 kratzert et al 2018 note that although certain classical machine learning methods e g artificial neural networks palani et al 2008 could also be used for time series forecast that benefit from hand crafted features to account for time dependencies their exploitation of temporal dependencies is rarely exhaustive reichstein et al 2019 moreover their performances are always worse than that of the lstm zhang et al 2018a recently the lstm has been introduced into geoscience research reichstein et al 2019 for example the lstm has been successfully applied to predict the water table depth in an agricultural area with complex heterogeneous characteristics zhang et al 2018b considering the possible suitability of lstm on water quality forecast particularly when long term high frequency data become available in the future hipsey et al 2019 the ability of lstm to simulate the forecast capacity of a complicated water quality model is worth investigating this study has two research objectives 1 to determine whether the lstm is capable of simulating the forecast capacity of a complicated water quality model 2 and if so to determine whether it is possible to adopt a simple model structure e g a structure that only involves several input variables and several hidden layers to obtain a satisfactory model performance one of the most widely used complicated water quality models the efdc kim et al 2017 zou et al 2006 is selected as the water quality model a number of lstm models are developed and their performances are evaluated random forest breiman 2001 is further used to determine the key drivers of lstm performance and to investigate whether it is possible for a capable lstm to have a simple model structure 2 materials and methods the methodology framework is shown in fig 1 in view of the critical conditions of harmful algal blooms worldwide huisman et al 2018 chlorophyll a chl is selected as the variable to forecast the response variable of lstm as for the drivers water quality variables that impact algae growth such as water temperature tem and nutrients paerl et al 2016 are selected moreover the chl is expected to have a tight self association within some temporal intervals six variables are accordingly selected as predictors tem chl total phosphorus tp phosphate phosphorus po4 total nitrogen tn and ammonia nitrogen nh4 first the efdc is run to obtain a 12 year time series of water quality variables including a response variable to forecast and several variables as predictors complex nonlinear relationships exist between the response variable and predictors if an lstm could well forecast the response variable then this confirms that it is capable of simulating the forecast capacity of the efdc second a number of lstms with different model structures are developed their performances are thereafter evaluated based on the nash sutcliffe efficiency coefficient nse by which it can be determined whether an lstm is capable finally the key drivers of model performance are identified based on random forests rf breiman 2001 which is selected here because of its ability to determine variable importance and its high prediction accuracy cutler et al 2007 rodriguez galiano et al 2014 the rf results could aid in determining whether a capable lstm may have a simple model structure 2 1 generation of time series of water quality variables the efdc is highly capable of simulating hydrodynamics temperature and eutrophication dynamics kim et al 2017 zhao et al 2013 a detailed description of the theories and algorithms of the efdc model can be found in hamrick 1992 running a high dimensional model is computationally expensive hence a zero dimensional efdc is employed this efdc which is derived from a previously validated model on a eutrophic lake liu et al 2014 has a simplified spatial resolution the model is run to obtain 12 years of daily outputs of variables fig s1 in accordance with the results of numerous studies qian et al 2000 sondergaard et al 2017 stow et al 2015 tem chl and nutrients except for po4 clearly exhibit a seasonal cycle the basic statistics of these variables are summarized in table s1 the average chl and nutrient concentrations are all high indicating that the lake has a eutrophic state as expected the autocorrelation coefficients of water quality variables except for po4 are positively significant even when the lag time is as long as 60 d fig s2 the cross correlation coefficients between chl and its drivers except for po4 are also positively significant fig s3 indicating the long term dependencies of chl on its drivers 2 2 develop and evaluate lstms in the lstm memory blocks are introduced to replace hidden layers in traditional neural networks a memory block consists of a forget gate an input gate a memory cell and an output gate gers et al 2000 hochreiter and schmidhuber 1997 the state of a memory block at time t is illustrated in fig 2 the corresponding forward propagation process is illustrated below in the last computation at t 1 both cell state ct 1 and output ht 1 are stored by the block at time t new inputs it are available first the forget gate decides on what information to remove it also generates a value ft between 0 and 1 as a basis for determining the extent of allowing ct 1 to pass by combining ht 1 and it into the sigmoid function eq 1 1 f t σ w f h t 1 u f i t b f in the next step a new candidate cell state c t can be generated by combining ht 1 and it into the tanh function eq 2 2 c t tanh w c h t 1 u c i t b c meanwhile the input gate produces a value it as coefficient of c t according to eq 3 3 i t σ w i h t 1 u i i t b i thereafter the new cell state is determined by ct 1 and c t based on eq 4 4 c t f t c t 1 i t c t next the output gate produces a value ot to determine the parts of the cell state to output based on eq 5 5 o t σ w o h t 1 u o i t b o finally the output is determined by eq 6 6 h t o t tanh c t in eqs 1 2 3 and 5 w and u are the matrices of weights for the gates or cells with the corresponding subscripts b denotes learnable biases in addition σ represents the sigmoid function eq 7 and tanh represents the tanh function eq 8 the initial values of c 0 and h 0 are zero 7 σ x 1 1 e x 8 tanh x e x e x e x e x in the present study the time series is split into two parts training dataset first 9 years and testing dataset remaining 3 years to ensure that the input variables remain on the same scale and to guarantee a stable convergence of parameters in the lstm all input variables and the response are standardized according to eq 9 9 x ij x ij max x i where x and x represent the raw and standardized observations respectively i is the index of variables and j is the order of observations max xi is the maximum of the ith variable every possible combination of the six water quality variables could be used as the input variable s of the lstm the number of input variable combinations for the lstm is 63 26 1 certain hyperparameters of the lstm are set including the number of hidden layers and time lag which are the most related to the model structure the number of hidden layers and time lag are made to vary to explore their impacts on model performance both the number of hidden layers and time lag have eight alternatives 5 10 15 20 30 40 50 and 60 the forecast days are set to be 1 3 5 31 the number of lstms developed is therefore 64 512 63 8 8 16 these models are trained using the training dataset as for the other hyperparameters of lstm the maximal epoch is set to be 20 which means that the model will end upon convergence or the epoch reaches 20 the batch size validation fraction and learning rate are 5 0 15 and 0 001 respectively the backpropagation through a time algorithm werbos 1990 is employed to train lstms the root mean square error is selected as the loss function the nse is one of the most widely used criteria for model performance bennett et al 2013 it is expressed as eq 10 10 nse 1 i 1 n y i y i 2 i 1 n y i y i 2 where yi represents the ith observation of the chl y represents the corresponding value predicted by the lstm y is the average of observations n is the number of observations the nse varies from to 1 following ritter and munoz carpena 2013 the model is acceptable when nse 0 65 and good when nse 0 80 the testing dataset is employed to calculate the nse 2 3 identification of key drivers of lstm performance based on rf random forest is a widely used machine learning method in environmental studies cutler et al 2007 nelson et al 2018 it consists of an ensemble of classifications or regression trees de ath and fabricius 2000 it grows each tree with a bootstrap sample of observations and only uses a small random sample of predictors to define the split at each node each tree is grown to its maximum size without pruning final predictions are obtained by averaging the results of all trees overfitting is avoided by the out of bag procedure which is similar to cross validation li et al 2017 for more details on the rf theory readers are referred to breiman 2001 in this study the rf is employed to identify the key drivers of lstm performance for each forecast day a total of 16 rfs are developed the input variables of rf include six factor variables and two numerical variables number of hidden layers and time lag fig 1 the factor variable labels whether or not a water quality variable is included to forecast the chl in the lstm for each rf the number of observations is 4032 63 8 8 the permutation importance pi is a variable importance metric in the rf catherine et al 2016 mayr et al 2018 zhu and pierskalla 2016 it calculates the importance through a permuting process in which the importance of an input variable is quantified by evaluating the increase in the out of bag error when the variable is permuted altmann et al 2010 a higher pi value indicates a higher variable importance to demonstrate the change in key drivers with the increase in the number of forecast days the pi is normalized to represent the relative importance ri of variables according to eq 11 11 ri i pi i k 1 p pi k where i is the index of input variables and p is the number of input variables all computations are conducted in python and r software keras manaswi 2018 was employed to program the lstm it was written in python and runs on top of theano other python libraries used were matplotlib numpy h5py and pandas the rf is run using the ranger package wright and ziegler 2017 in r the number of trees is set to be 500 the number of trees is also increased but no significant improvement in r2 of rf is observed 3 results 3 1 nse values of lstm the distributions of nse values for each forecast day are shown in fig 3 on the one hand there are certain nse values that are larger than 0 65 the proportion of lstm models is shown by the p value in fig 3 which indicates that there are models with an acceptable performance with the increase in the number of forecast days the position of nse peak density moves towards the left and the overall performance decreases as shown by the mean and median values m and med values in fig 3 respectively of nse on the other hand there are nse values that are less than 0 65 in particular the distributions of nse are all exceedingly left tailed the median is higher than the average as shown in fig 3 there are also some extremely small nse values indicating that certain lstm models have inadequate performances the identification of key drivers of the model performance may be advantageous for building lstm models with a simple structure and high forecast accuracy 3 2 key drivers of lstm performance the results of r2 of rfs are summarized in table s2 the r2 value ranges from 0 744 to 0 854 and decreases with the increase in the number of forecast days the high r2 values that indicate large proportions of nse variations are attributed to input variables thus ensuring the reliability of variable importance results the ri results for each forecast day are shown in fig 4 an input variable of rf is identified to be a key driver if the corresponding ri is higher than 0 1 for all forecast days three key drivers are identified the inclusion or non inclusion of chl tp and tem fig 4a c for each forecast day the sum of ris of the other five input variables is lower than 0 1 fig 4d note that neither of the two hyperparameters number of hidden layers and time lag is identified as key driver with the increase in the number of forecast days the ris of the three key variables exhibit approximately monotonous trends fig 4 as the ris of chl and tp decrease the ri of tem exhibits an opposite change the order of ri also changes with the number of forecast days from day 1 to 15 the ri order of the three key variables is chl tp tem at day 17 tem replaces the position of tp and becomes the second important driver after day 23 the ri of tem exceeds the ri of chl and the ri order becomes tem chl tp the change in ris of the other five variables can be ignored because of their small values the inclusion of key variable s as the input variable significantly improves the overall forecast performance of the lstm fig 5 beanplot results that demonstrate the impact of each key driver on nse values are shown in fig s4 s6 the average nse values of lstms without any key variable are all less than 0 25 fig 5 black line when key variables are included however the average nse values considerably improve fig 5 colored lines when more key variables are included the overall model performance considerably improves the average nse value of lstms including the key variable s decreases with the increase in the number of forecast days fig 5 as shown by the decreasing trends of colored lines when the number of forecast days is less than 9 d the inclusion of one of the three key variables makes the lstm reach the acceptable performance level nse 0 65 the inclusion of more than two key variables can even make the nse exceed 0 8 for certain forecast days when the forecast time exceeds 21 d the overall performance is not acceptable regardless of whether the three key variables are included in the lstm note that when the number of forecast days is relatively high e g 21 only a small proportion of models have nse values exceeding 0 65 fig 3 the inclusion of the identified key variables could barely improve the model performance to the acceptable level further studies are thus required to improve the performance of relatively long term forecasts 4 discussion 4 1 consistency between driver identification results and limnological theories the identification results of key drivers are consistent with the classical theories of limnology the forecast of chl depends on the current state and change during lagged days the chl usually has significant autocorrelated coefficients fig s2 a and has been used to forecast future chl values palani et al 2008 with the increase in the number of forecast days the influence of the current chl state decreases as indicated by the decreasing autocorrelated coefficients leading to the decrease in chl ri fig 4a phosphorus and nitrogen are important chemical factors that control phytoplankton growth conley et al 2009 there are increasing debates between the limitation of phosphorus and co limitation of nitrogen and phosphorus in eutrophic lakes gobler et al 2016 schindler et al 2016 in our case the average tn tp ratio is 45 by mass which is considerably higher than the redfield ratio 7 2 redfield 1958 indicating that tp is more probably the limiting nutrient moreover nitrogen limitation is always seasonal ding et al 2018 dolman et al 2016 kolzau et al 2014 leading to the insufficient forecast of the year round chl based on nitrogen except for impacting phytoplankton growth tp could also be partially treated as a variable of the current chl state because a large proportion of tp is included in the phytoplankton of eutrophic lakes stow and cha 2013 the ri of tp therefore decreases as the ri of chl dose when the number of forecast days increases fig 4b one of the most important physical factors that impact phytoplankton growth is tem paerl and paul 2012 with the increase in the number of forecast days the change in chl during the lagged days increasingly becomes more important to the chl forecast in this study tem during the lagged days is not available and is thereby not an input variable of the lstm as a result of the high autocorrelation coefficients fig s2 c and stable annual pattern fig s1 a of tem the current tem is closely associated with the future tem accordingly the ri of current tem increases fig 4c it should be noted that po4 is not identified as a key driver although it is assumed to be the most bioavailable component of phosphorus dodds 2003 this is because po4 can be influenced by a number of processes e g sediment release or adsorption and uptake by phytoplankton as a result there are certain occasionally high low concentrations with a wide variation fig s1 d which makes it an inadequate predictor for chl forecast compared with po4 tem is a more robust predictor 4 2 capability of lstm with a simple structure to simulate efdc forecast capacity according to the above results an lstm with a simple structure can simulate the forecast capacity of efdc first because many lstms achieve acceptable performance they can well simulate the forecast capacity of efdc second only three water quality variables are identified as the key variables of lstm performance these water quality variables are always regularly monitored the two hyperparameters number of hidden layers and time lag have minimal impacts on the lstm performance and both can be set to small values e g 5 an lstm model with a simple structure can therefore be used to obtain high nse values fig 5 finally the consistency between driver identification results and limnological theories further supports the reliability of results although the average nse could not satisfy the required acceptable level when the number of forecast days exceeds 21 it is noteworthy that the model performance may be improved by including other water quality variables that are not explored in this study or by optimizing the hyperparameters of lstm shahriari et al 2016 4 3 mechanism guided water quality forecast using lstm the integration of physical modeling with machine learning has been recently introduced into geoscience research and is regarded as a promising modeling strategy jia et al 2018 reichstein et al 2019 in this study a typical type of integrating physical modeling with machine learning is presented the efdc is employed to generate the time series of water quality variable these data are intrinsically associated via the mechanism processes presented by mathematical equations these data are therefore the external manifestations of the complex dynamics of the simulated system when these data are used for training the lstm it learns to illustrate system dynamics using nonlinear functions e g eqs 1 8 the training of lstm is indeed guided by the mechanism processes embedded in the efdc the lstm can therefore be theoretically regarded as mechanism guided which means that the model is no longer purely data driven because of the intrinsic associations among variables used for model training in this study it is found that mechanism guided lstms can capture some mechanism features of the simulated system as indicated by the consistency between driver identification results and limnological theories that may benefit from the mechanism guided learning process we thereby argue that the applications of lstm on water quality forecast might not be criticized as purely data driven 1 currently while high frequency water quality data are scarce the integration of a complicated water quality model with the lstm could be used to overcome data limitation in view of the fact that the training is guided by a complicated water quality model the lstm is therefore mechanism guided 2 in the future when long term high frequency data with anomaly detection and disposal become available leigh et al 2019 the lstm could be directly trained by these data and be used for water quality forecast reliable high frequency water quality data are also external manifestations of the complex dynamics of the system the lstm model trained by such data is therefore also mechanism guided the lstm can simulate the forecast capacity of a complicated water quality model it could therefore be an effective tool for high accuracy water quality forecast moreover the lstm is time saving free of boundary conditions and has a simple structure thus making the model easy to implement compared with a complicated water quality model the lstm could be considerably more efficient in water quality forecast the mechanism guided training process may also allow the lstm to capture certain mechanism features thus reducing the apprehensions that the method lacks mechanism processes the lstm is therefore expected to be a potential method for water quality forecast 5 conclusions the ability of lstm to simulate the forecast capacity of efdc is investigated the results show that among the 64 512 lstms many could achieve an acceptable performance level similar to the limnological theories the key variables necessary to forecast chl are identified as chl tem and tp the number of hidden layers and lag time can be set to small values it is thus confirmed that an lstm with a simple structure e g only three input variables with five hidden layers could simulate the forecast capacity of efdc the mechanism guided lstm is expected to be a promising tool because it could be both effective and efficient in forecasting water quality future research should accordingly focus on improving the model performance when a relatively long term forecast is to be conducted author contribution liang zy zou r and liu y designed the overall framework zou r ran the efdc model and obtained the time series of water quality variables liang zy and zou r developed lstms using python liang zy developed rfs in r all the authors contributed to the results analysis and manuscript writing all the authors contribute to the reversion of the manuscript liu y received the fund declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the research was supported by the national science foundation of china 51779002 51721006 and high performance computing platform of peking university appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2019 124432 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
5924,accurate prediction of water level is a challenging task in high sediment load reaches because of complicated flood sediment routing mechanisms and fluctuating reach terrain we propose a hybrid machine learning framework to predict the water level and validate the framework in five representative high sediment load reaches of the lower yellow river lyr in china this framework can automatically generate ensemble prediction models for different flood sediment scenarios by integrating clustering classification and regression models we compared the proposed framework with two benchmark frameworks and evaluated performances using nash sutcliffe efficiency nse and pearson correlation coefficient pcc the results demonstrated the following 1 the water level cannot be accurately predicted nse 0 50 in the testing period using only upstream discharge and sediment load because of the fluctuating reach terrain model performance is significantly improved nse 0 85 by adding the time factor in model development 2 the proposed framework can successfully identify different flood sediment combinations with a high classification accuracy of 98 by adopting k means clustering and support vector machine svm classification models 3 the proposed framework can provide reliable water level prediction for flood early warming in the lyr with an average nse of 0 83 and 0 89 in the training and testing periods respectively it outperformed traditional single and rule based model frameworks in all reaches with different degrees of improvement between 3 and 13 the best performance indicated that the proposed framework can take advantages of different types of machine learning models and could provide reliable prediction for flood mitigation in high sediment load reaches keywords water level prediction machine learning models high sediment load reaches lower yellow river china 1 introduction sediment transport creates habitats for aquatic life and fertile floodplains for farming rybicki et al 2015 wohl et al 2015 however they also shorten the lifespan of hydraulic structures george et al 2016 juracek 2015 and exaggerate sediment related hazards by changing the geomorphometric features of the river system marchi et al 2009 because of human activities river sediment transport through soil erosion is increased by 2 3 0 6 billion metric tons per year at the global scale syvitski et al 2005 this trend is predicted to increase in the future with the frequent intensive rainfall events caused by climate change li and fang 2016 heavy sediment flow has become a common issue in many reaches globally causing a decline in transport capacity and greatly exacerbating the flood hazard miao et al 2016 developing accurate water level prediction systems plays a critical role in high sediment load reaches for flood hazard mitigation and water resources management many difficulties arise in water level prediction in high sediment load reaches because of the complicated mechanism of turbulent free surface flows with high sediment concentration guo et al 2008 ni et al 2004 a difficulty is that there is no explicit relationship between the water level and discharge so the conventional rating curve method does not work in these reaches bhattacharya and solomatine 2005 simultaneously flood routing mechanics vary with different magnitudes of sediment load zhang et al 2016 which can be regarded as a time variant problem in most rivers many physical based hydrodynamic models have been developed to simulate low concentrated or hyper concentrated sediment flow in these reaches guo et al 2008 lin and falconer 1997 ni et al 2004 tu et al 2019 tu et al 2017 van maren et al 2009 however none of these hydrodynamic models have been applied to real time predictions prediction is made immediately when the model gets the request in high sediment load reaches because of the fluctuating terrain conditions and high computational cost hu et al 2019 kong et al 2015b machine learning models such as artificial neural networks anns and support vector machines svms have demonstrated advantages in terms of timely prediction and assessment in hydrology choubin et al 2019 kisi et al 2019 malekian et al 2019 pirnia et al 2019 tehrany et al 2015 zhao et al 2019 zhao et al 2018 the accuracy of these models highly depends on the consistency of the model inputs which is not suitable for solving high variant problems some cluster based models have been proposed and successfully applied to spatial heterogeneity problems smith et al 2015 wang et al 2017 xu et al 2018 the main idea of these researches is to use clustering models to divide the study area into several heterogeneous subareas and then ensemble models are separately developed in subareas however this strategy is rarely used in prediction problems because of the difficulty of determining the cluster for future factors in terms of this ay 2014 used an ann and k means clustering model to predict the chemical oxygen demand and adopted a prior set rule to determine the cluster of future factors ay and kisi 2014 this decision rule is based on the cluster centers of the k means model and is not suitable for other clustering models the discharge in the lower yellow river lyr of china experiences obvious seasonal variation and the flood mechanism varies along with the sediment load change miao et al 2016 miao et al 2010 meanwhile the water sediment regulation scheme conducted by the yellow river conservancy commission of china has further shifted the seasonal distribution of the discharge and sediment wang et al 2006 and therefore the water level prediction in the lyr can be regarded as a typical time variant problem the time variant variables in hydrological forecasting can be reflected by different model structures or parameters in physical based hydrological models lan et al 2019 xia et al 2005 but difficult to be described in machine learning models cingolani et al 2008 by integrating the clustering classification and regression models the proposed framework can automatically generate appropriate forecasting models for different water sediment conditions previous studies in the lyr have mainly focused on the trend analysis gao et al 2011 gao et al 2010 miao et al 2010 attribution analysis miao et al 2011 wang et al 2007 and modeling ni et al 2004 van maren et al 2009 xia et al 2012 of the discharge and sediment concentration to the best of our knowledge our study for the first time integrated clustering classification and regression models for real time water level prediction considering different water sediment conditions in high sediment load reaches the objectives of this study were described as followed i a novel hybrid machine learning framework was proposed for real time water level prediction in high sediment load reaches ii the advantages of the proposed framework were compared with two benchmark model frameworks in this context the proposed framework was demonstrated in five representative high sediment load reaches in the lyr of china by adopting k means svm classification and svm regression models different upstream discharge sediment conditions were considered for framework development this framework combined the advantages of different machine learning models and proposed a promising approach to solve time variant problems for hydrological forecasting 2 study area and data description the yellow river is the second largest river in china fig 1 a with a drainage area of 795 000 km2 the mean annual suspended sediment load is approximately 1 6 109 t which ranks first among all the world s rivers kong et al 2015a wu et al 2008 the lyr flows from zhengzhou henan province china to the river mouth of the bo sea with a length of approximately 740 km fig 1 b the heavy sedimentation in the channel of the lyr leads to the perched river phenomenon which makes the study area one of the most flood prone areas in chinese history chen et al 2012 xu 2001 the lyr can be divided into three distinct reaches fig 1 c according to their geomorphological characteristics kong et al 2015a xia et al 2014 reaches a and b which have a typical braided channel pattern are called braided reaches reach c which has a channel pattern that transitions from braided to meandering is called a transitional reach reaches d and e which have a stable and well restricted meandering channel pattern are called meandering reaches the elevated riverbed and the levee along the lyr isolated the connectivity between the channel and surface runoff and the downstream water level is mainly controlled by the upstream discharge and sediment load we selected these five reaches in three different geomorphological characteristics as case studies to provide a comprehensive understanding of the reliability of the model framework with respect to the lyr six stations along the lyr that is the huayuankou jiahetan gaocun aishan luokou and lijin stations fig 1 c were selected for model development the relationship between discharge q and water level h in the lyr fluctuates along with the process of flood and sedimentation which increases the difficulty in real time water level prediction as shown in fig 2 a the q h curve has an obvious annual trend at the jiahetan station the annual trend does not manifest at the lijin station fig 2 b and the daily q h curve at lijin station demonstrates large uncertainty at water level between 11 and 12 m the water level h d at downstream station was predicted by the historical daily discharge q u and suspended sediment load s u records from the nearest upstream station data from 2008 to 2012 were selected for model training and data from 2013 to 2014 were selected for model testing the statistical parameters of discharge sediment load and water level for each observation are shown in table 1 x mean c v and c s denote the mean value variation and skewness coefficients of the time series respectively the table shows that the sediment data demonstrated an obvious skewed distribution there were different degrees of decline in the water level between the training and testing periods 3 methodology description 3 1 framework description we propose a hybrid model framework m3 and compare it with traditional single m1 and rule based m2 model frameworks the structures of these model frameworks are shown in fig 3 the m1 and m2 are standard practices in hydrological forecasting malekian et al 2019 wang et al 2006 the regression model in m1 is trained with the entire input dataset fig 3 m1 and the model result is simulated using the single trained regression model choubin et al 2018 malekian et al 2019 therefore the accuracy of m1 is highly depended on the consistency and reliability of the input dataset which limits its application in highly temporally and spatially variant problems compared with m1 the m2 introduces some prior set rules to divide the model inputs training and testing datasets into several subsets and the regression model is respectively developed based on the corresponding subset however the specific prior set rules in m2 are typically derived from expert experience or analysis of historical samples which introduces uncertainties in the prediction the m2 in this study involves two regression models fig 3 m2 which were developed by the time series of flood seasons july september and dry seasons october june respectively according to the peak flow magnitude wang et al 2006 the proposed m3 framework could automatically generate appropriate regression models for water level prediction in terms of different discharge and sediment conditions compared with m2 the m3 does not need a specific prior set rule and the subsets in the training and testing periods are identified using clustering and classification models respectively as shown in fig 3 m3 the training dataset is first divided into n sets using the clustering model and n 1 2 n is the set number second a total number of n regression models are trained based on the factors qu and su and targets hd of each set in the training period meanwhile a classification model is developed based on set number n and the factors qu and su of each set within the training dataset this classification model is validated using the 5 fold cross validation method within the training dataset and used the trained classification model to determine class number n for the testing dataset finally each set n in the testing dataset is predicted using the corresponding trained regression model n and the ensemble prediction results are evaluated by the target data hd in the testing dataset 3 2 model description the proposed framework adopts three widely used models k means model support vector classification svc model and support vector regression svr model for clustering classification and regression respectively the mechanisms of these models are described as follows and this framework could be extended easily to use other machine learning models 3 2 1 k means model the k means model is a type of prototype based clustering algorithm in data mining the first standard k means algorithm was proposed by stuart lloyd in 1957 for pulse code modulation lloyd 1982 and has been widely used in other areas including hydrology spate et al 2003 the inputs of the k means algorithm are the total number of clusters k and training samples in the present study each sample includes two types of factors upstream discharge and suspended sediment load k is selected by comparing the model performances in the testing period the input dataset is denoted by d x j j 1 2 3 m the k means algorithm first estimates k centroids c c i i 1 2 k by randomly selecting data from the input factor dataset then the algorithm iterates between the following two steps 1 data assignment step each sample x j is assigned to its nearest centroid c i based on the squared euclidean distance then input dataset d is divided into k subsets as follows 1 arg min c i c d i s c i x j 2 where dis is the function used to calculate the euclidean distance 2 centroid update step centroid c i is updated as follows 2 c i 1 n i k 1 n i x k x k a i where a i is a subset of d and n i is the number of objects in a i the k means algorithm iterates between steps 1 and 2 until the cluster assignments do not change or the maximum number of iterations 1000 in this study is reached one difficulty of using the k means algorithm is selecting the optimal k value in this study the best number of clustering classes are selected according to the model performances in the testing period 3 2 2 svc model two types of svc binary svc and multi class svc are adopted in this study the svc is developed based on the training dataset and clustering class n from the k means model and used to predict clustering class n for the testing dataset for a binary problem n 2 the main idea of svc is to construct a hyperplane to separate the two classes in this study for a given dataset x i i 1 2 p p is the number of training samples and y i 1 1 denotes the cluster classes from the k means model the support vectors are achieved as follows 3 r w t x i b w 4 w t x i b 1 y i 1 w t x i b 1 y i 1 where w and b are hyperplane parameters and r represents the distance from xi to the hyperplane the basic formula of svc is described as follows by optimizing the maximum margin between support vectors 5 min w b 1 2 w 2 s t y i w t x i b 1 i 1 2 p the optimal separating hyperplane is solved as follows by applying a kernel trick boser et al 1992 and penalty term 6 min w b ξ 1 2 w 2 c i 1 n ξ i s t y i w t ϕ x i b 1 ξ i ξ i 0 i 1 2 p where ζ i is the slack variable and represents the acceptable deviation between the function margin and data xi and c is a parameter that controls the weight of the penalty term in the objective function transformed function ϕ x fits the maximum margin hyperplane in high dimensional space for the multiple class problem n 2 the one versus one coding design weston and watkins 1998 is introduced to reduce the multiclass problem to a series of binary problems for each binary svc one class is positive 1 one class is negative 1 and the remaining classes are ignored a total of n n 1 2 binary svc models are developed and the final results are obtained based on the majority vote across all classifiers 3 2 3 svr model in this study the ε insensitive svr model is used to simulate the water level in each clustering class the ε insensitive svr model maintains the same features as svc that characterize the maximal margin algorithm vapnik 2013 for a given dataset x 1 y 1 x 2 y 2 x p y p p is the number of training samples the goal of ε insensitive svr is to determine function f x that has at most ε deviation from the observed y i thus the svr model is formulated as a convex optimization problem as follows 7 min w b 1 2 w 2 s t y i w t x i b ε w t x i b y i ε where ε is the insensitive loss and w and b are hyperplane parameters the formula for the svr model is described as follows by adding two slack variables 8 min w b ξ i ξ i 1 2 w 2 c i 1 n ξ i ξ i s t f x i y i ε ξ i y i f x i ε ξ i ξ i 0 ξ i 0 i 1 2 p where c is a parameter that controls the tradeoff between the smooth decision line and training points and ξ i and ξ i are slack variables 3 3 model implementation and evaluation the k means model was based on the kmeans function in matlab software arthur and vassilvitskii 2007 n was set to 2 3 and 4 and selected according to the highest accuracy of the forecasting models in the testing period the maximum number of iterations for the k means model was set to 1000 and the initial cluster centers were generated by k means algorithm the linear kernel svc and svr models were implemented using the statistics and machine learning toolbox in matlab https uk mathworks com help stats and the parameters in the kernel functions were automatically optimized by a heuristic procedure in the toolbox for the svc model a 5 fold cross validation method fushiki 2011 was used to test model performance the input dataset was randomly divided into five subsets for each subset the svc was trained with the data from the remaining four subsets and tested on the current subset the svc model performance was evaluated using a combined acc value for each fold the combined acc is formulated as 9 acc 1 5 i 1 5 c i c i f i 100 where acc is the combined model accuracy of the entire dataset i is the subset number c i is the number of samples correctly classified in subset i f i is the number of samples incorrectly classified in subset i for the svr model the inputted time series was divided into training and testing periods nash sutcliffe efficiency nse and pearson correlation coefficient pcc were adopted to evaluated svr model results in training and testing periods the indices were formulated as follows 10 nse 1 t 1 t h s t h o t 2 n 1 t h o n h o 2 11 pcc t 1 t h s t h s h o t h o t 1 t h s t h s 2 t 1 t h o t h o 2 where h s t is the simulated water level at time t m h o t is the observed water level at time t m h s is the mean value of the simulated water level of the time series m h o is the mean value of the observed water level of the time series m and t is the length of the time series day 4 results analysis 4 1 input selection point sources from upstream reach and non point sources from surface runoff are two major driven factors changing downstream water level in the lyr the levee along the reach and the elevated riverbed isolate the surface runoff to channel and thus the downstream water level is mainly controlled by the upstream point sources meanwhile the downstream water level is also influenced by the cumulative effect of the sediment erosion or deposition at the downstream reach section which will slowly change with time therefore the predicted factors considered in this study are upstream discharge qu upstream suspended sediment load su and the calendar date time since the beginning of the simulation known as predicted time t various combinations of these factors were examined to evaluate the impact on the model output hd the input combinations are presented in table 2 sets 1 and 2 only used a single factor qu and su respectively for prediction sets 3 4 and 5 reflected the combinations of qu and su in different time sets 6 7 and 8 added the predicted time t during model development to reflect the influence of time effects such as annual and seasonal trends on modeling the model performance in the testing period with different combinations of predicted factors above is shown in table 3 the best set of model inputs is selected by the highest nse value in testing period as shown in table 3 the average nse values of sets 1 2 3 4 and 5 were all lower than 0 50 this illustrates that the water level could not be accurately predicted with single or combined upstream discharge and sediment load data despite this model performance significantly improved for sets 6 7 and 8 nse 0 85 when the time factor t was considered as model input model performance was not sensitive to the number of predicted factors in different time specifically the best input combination for reaches a and b was set 7 with nse values of 0 95 and 0 97 respectively in the testing period the best input combination for reaches c and d was set 8 with nse values of 0 84 and 0 91 respectively in the testing period unlike these reaches the model performance of reach e demonstrated a decrease when the time factor t was considered in the prediction the best input combination for reach e was set 5 with an nse value of 0 84 in the testing period 4 2 clustering results and classification accuracy in the proposed framework the training dataset was first divided into n classes using the k means model according to the input factors an svc model was adopted to learn the relationship between class n and the input factors and then used to determine class n for the testing datasets the nse value in the training and testing periods with different numbers of class n is presented in table 4 the model performance improved as the number of classes increased in the training period the best clustering number n was selected with the best value of nse in the testing period we found that the best n of reaches b and d was 2 and that of reaches c and e was 4 the best n of reach a was 3 fig 4 shows the relationship between upstream q and s at the logarithmic scale and the acc is adopted for svc model validation in each reach as shown in the fig 4 the q s correlation relationship increases from upstream pcc 0 41 to downstream pcc 0 60 by adopting the k means and svc model in this study different q s combinations could be identified automatically the classifications are mainly based on the magnitude of the q and s and high sediment load floods are all classified as an independent class for model development the high acc value of all reaches 98 means that this classification model could be used to predict class n for the testing dataset 4 3 model performance comparison the model performances of m1 m2 and m3 in the training and testing periods were compared in five reaches in the lyr the m1 m2 and m3 represent the single rule based and proposed hybrid model frameworks respectively which are described in section 3 1 as shown in table 5 the proposed m3 framework had the highest accuracy of all reaches with an average nse value of 0 833 on the training dataset and 0 898 on the testing dataset this illustrates that the proposed framework outperformed the other two models both in terms of fitting ability and prediction accuracy compared with the m1 the m2 demonstrated a higher prediction accuracy for reaches b and e the prediction accuracy of m3 had a high degree of improvement 10 for reaches a c and e and a medium degree improvement 3 5 for reaches b and d as shown in fig 5 both the m1 m2 and m3 can capture the water level of peak flood the m3 outperforms m1 and m2 mainly on the low water level modeling 5 discussions reaches a and e were selected as examples to illustrate the change on the simulated hydrograph with and without the time factor t for reach a there was an obvious annual declining trend on the water level within the simulated period shown in figs 6 a and 2 a this decline was mainly caused by riverbed fluctuation miao et al 2016 and could not be properly reflected by upstream q and s therefore although the correlation coefficient was high pcc 0 90 there was a significant overestimation of the water level in the testing period with an nse of 0 088 this overestimation could be significantly corrected by adding time factor t with an nse of 0 937 for reach e there was no obvious trend for the water level within the simulated period shown in figs 6 c and 2 b thus both models with t and without t can correctly simulate the water level a small overestimation on the low water level was found for reach e by considering time factor t which caused the lower accuracy of reach e compared with model performance without t reach e is located near the yellow river delta and its water level is control by compound fluvial and coastal floods kong et al 2015b more factors reflecting the impact of coastal floods should be considered for water level predictionof reach e for the future study the forecasting performance under different lead times is evaluated at reach a and e fig 7 a and b a similar trend was found with the choubin et al s research that the model accuracy decreased with a longer lead time choubin et al 2018 we found that the proposed m3 framework overperformed m1 and m2 in all lead times the m2 showed higher performance than m1 at reach e and the m1 and m2 had similar performance at reach a the results revealed that the m3 framework can provide both reliable predictions nse 0 75 for early warning 3 day ahead and satisfied predictions nse 0 60 for advisory issue 7 day ahead given this week s lead time can active mitigation measures for flood minimization protection of critical infrastructures and provide active support to vulnerable groups 6 conclusions a hybrid machine learning based model framework was proposed for water level prediction in high sediment load reaches this approach can automatically generate proper models for different flood sediment scenarios by integrating clustering classification and regression models in the framework the main conclusions are summarized as follows 1 the best model inputs were selected for each reach according to the nse value in the testing period the water level could not be accurately predicted only with upstream discharge and sediment load data and had an average nse of 0 47 in testing period because of reach bed fluctuation performance could be significantly improved by considering time factor t with an average nse of 0 88 in the testing period model performance was not sensitive to the number of predicted factors 2 the correlation relationship between upstream q and s involved large uncertainty in the lyr by adopting the k means and svc models different combinations of q and s could be identified automatically within the training dataset the high acc value 98 for all reaches means that the classification model could be used to predict class n for the testing dataset 3 the proposed model framework m3 was compared with two benchmarks m1 and m2 the m3 outperform m1 and m2 particularly on peak and low water level prediction for all reaches the prediction accuracy of m3 had a high degree of improvement 10 for reaches a c and e and a middle degree improvement 3 5 for reaches b and d this illustrates that the proposed m3 could be used successfully for water level prediction in high sediment load reaches of the lyr as a proof of concept this framework was demonstrated for water level prediction for five representative high sediment load reaches considering different upstream discharge and sediment conditions in the lyr but could be extended easily to other high sediment load reaches globally this framework coupled three widely used models k means svc and svr for hydrological forecasting and it should be tested by using other machine learning models for the future study author contributions gang zhao and bo pang carried out the model development and wrote the paper zongxue xu and liyang xu proposed many useful suggestions to improve its quality declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments bo pang is supported by the national natural science foundation of china 51879008 and the china scholarship council no 201906045024 gang zhao is supported by the china scholarship council university of bristol joint phd scholarships programme no 201700260088 we thank maxine garcia phd from liwen bianji edanz group china www liwenbianji cn ac for editing the english text of a draft of this manuscript 
5924,accurate prediction of water level is a challenging task in high sediment load reaches because of complicated flood sediment routing mechanisms and fluctuating reach terrain we propose a hybrid machine learning framework to predict the water level and validate the framework in five representative high sediment load reaches of the lower yellow river lyr in china this framework can automatically generate ensemble prediction models for different flood sediment scenarios by integrating clustering classification and regression models we compared the proposed framework with two benchmark frameworks and evaluated performances using nash sutcliffe efficiency nse and pearson correlation coefficient pcc the results demonstrated the following 1 the water level cannot be accurately predicted nse 0 50 in the testing period using only upstream discharge and sediment load because of the fluctuating reach terrain model performance is significantly improved nse 0 85 by adding the time factor in model development 2 the proposed framework can successfully identify different flood sediment combinations with a high classification accuracy of 98 by adopting k means clustering and support vector machine svm classification models 3 the proposed framework can provide reliable water level prediction for flood early warming in the lyr with an average nse of 0 83 and 0 89 in the training and testing periods respectively it outperformed traditional single and rule based model frameworks in all reaches with different degrees of improvement between 3 and 13 the best performance indicated that the proposed framework can take advantages of different types of machine learning models and could provide reliable prediction for flood mitigation in high sediment load reaches keywords water level prediction machine learning models high sediment load reaches lower yellow river china 1 introduction sediment transport creates habitats for aquatic life and fertile floodplains for farming rybicki et al 2015 wohl et al 2015 however they also shorten the lifespan of hydraulic structures george et al 2016 juracek 2015 and exaggerate sediment related hazards by changing the geomorphometric features of the river system marchi et al 2009 because of human activities river sediment transport through soil erosion is increased by 2 3 0 6 billion metric tons per year at the global scale syvitski et al 2005 this trend is predicted to increase in the future with the frequent intensive rainfall events caused by climate change li and fang 2016 heavy sediment flow has become a common issue in many reaches globally causing a decline in transport capacity and greatly exacerbating the flood hazard miao et al 2016 developing accurate water level prediction systems plays a critical role in high sediment load reaches for flood hazard mitigation and water resources management many difficulties arise in water level prediction in high sediment load reaches because of the complicated mechanism of turbulent free surface flows with high sediment concentration guo et al 2008 ni et al 2004 a difficulty is that there is no explicit relationship between the water level and discharge so the conventional rating curve method does not work in these reaches bhattacharya and solomatine 2005 simultaneously flood routing mechanics vary with different magnitudes of sediment load zhang et al 2016 which can be regarded as a time variant problem in most rivers many physical based hydrodynamic models have been developed to simulate low concentrated or hyper concentrated sediment flow in these reaches guo et al 2008 lin and falconer 1997 ni et al 2004 tu et al 2019 tu et al 2017 van maren et al 2009 however none of these hydrodynamic models have been applied to real time predictions prediction is made immediately when the model gets the request in high sediment load reaches because of the fluctuating terrain conditions and high computational cost hu et al 2019 kong et al 2015b machine learning models such as artificial neural networks anns and support vector machines svms have demonstrated advantages in terms of timely prediction and assessment in hydrology choubin et al 2019 kisi et al 2019 malekian et al 2019 pirnia et al 2019 tehrany et al 2015 zhao et al 2019 zhao et al 2018 the accuracy of these models highly depends on the consistency of the model inputs which is not suitable for solving high variant problems some cluster based models have been proposed and successfully applied to spatial heterogeneity problems smith et al 2015 wang et al 2017 xu et al 2018 the main idea of these researches is to use clustering models to divide the study area into several heterogeneous subareas and then ensemble models are separately developed in subareas however this strategy is rarely used in prediction problems because of the difficulty of determining the cluster for future factors in terms of this ay 2014 used an ann and k means clustering model to predict the chemical oxygen demand and adopted a prior set rule to determine the cluster of future factors ay and kisi 2014 this decision rule is based on the cluster centers of the k means model and is not suitable for other clustering models the discharge in the lower yellow river lyr of china experiences obvious seasonal variation and the flood mechanism varies along with the sediment load change miao et al 2016 miao et al 2010 meanwhile the water sediment regulation scheme conducted by the yellow river conservancy commission of china has further shifted the seasonal distribution of the discharge and sediment wang et al 2006 and therefore the water level prediction in the lyr can be regarded as a typical time variant problem the time variant variables in hydrological forecasting can be reflected by different model structures or parameters in physical based hydrological models lan et al 2019 xia et al 2005 but difficult to be described in machine learning models cingolani et al 2008 by integrating the clustering classification and regression models the proposed framework can automatically generate appropriate forecasting models for different water sediment conditions previous studies in the lyr have mainly focused on the trend analysis gao et al 2011 gao et al 2010 miao et al 2010 attribution analysis miao et al 2011 wang et al 2007 and modeling ni et al 2004 van maren et al 2009 xia et al 2012 of the discharge and sediment concentration to the best of our knowledge our study for the first time integrated clustering classification and regression models for real time water level prediction considering different water sediment conditions in high sediment load reaches the objectives of this study were described as followed i a novel hybrid machine learning framework was proposed for real time water level prediction in high sediment load reaches ii the advantages of the proposed framework were compared with two benchmark model frameworks in this context the proposed framework was demonstrated in five representative high sediment load reaches in the lyr of china by adopting k means svm classification and svm regression models different upstream discharge sediment conditions were considered for framework development this framework combined the advantages of different machine learning models and proposed a promising approach to solve time variant problems for hydrological forecasting 2 study area and data description the yellow river is the second largest river in china fig 1 a with a drainage area of 795 000 km2 the mean annual suspended sediment load is approximately 1 6 109 t which ranks first among all the world s rivers kong et al 2015a wu et al 2008 the lyr flows from zhengzhou henan province china to the river mouth of the bo sea with a length of approximately 740 km fig 1 b the heavy sedimentation in the channel of the lyr leads to the perched river phenomenon which makes the study area one of the most flood prone areas in chinese history chen et al 2012 xu 2001 the lyr can be divided into three distinct reaches fig 1 c according to their geomorphological characteristics kong et al 2015a xia et al 2014 reaches a and b which have a typical braided channel pattern are called braided reaches reach c which has a channel pattern that transitions from braided to meandering is called a transitional reach reaches d and e which have a stable and well restricted meandering channel pattern are called meandering reaches the elevated riverbed and the levee along the lyr isolated the connectivity between the channel and surface runoff and the downstream water level is mainly controlled by the upstream discharge and sediment load we selected these five reaches in three different geomorphological characteristics as case studies to provide a comprehensive understanding of the reliability of the model framework with respect to the lyr six stations along the lyr that is the huayuankou jiahetan gaocun aishan luokou and lijin stations fig 1 c were selected for model development the relationship between discharge q and water level h in the lyr fluctuates along with the process of flood and sedimentation which increases the difficulty in real time water level prediction as shown in fig 2 a the q h curve has an obvious annual trend at the jiahetan station the annual trend does not manifest at the lijin station fig 2 b and the daily q h curve at lijin station demonstrates large uncertainty at water level between 11 and 12 m the water level h d at downstream station was predicted by the historical daily discharge q u and suspended sediment load s u records from the nearest upstream station data from 2008 to 2012 were selected for model training and data from 2013 to 2014 were selected for model testing the statistical parameters of discharge sediment load and water level for each observation are shown in table 1 x mean c v and c s denote the mean value variation and skewness coefficients of the time series respectively the table shows that the sediment data demonstrated an obvious skewed distribution there were different degrees of decline in the water level between the training and testing periods 3 methodology description 3 1 framework description we propose a hybrid model framework m3 and compare it with traditional single m1 and rule based m2 model frameworks the structures of these model frameworks are shown in fig 3 the m1 and m2 are standard practices in hydrological forecasting malekian et al 2019 wang et al 2006 the regression model in m1 is trained with the entire input dataset fig 3 m1 and the model result is simulated using the single trained regression model choubin et al 2018 malekian et al 2019 therefore the accuracy of m1 is highly depended on the consistency and reliability of the input dataset which limits its application in highly temporally and spatially variant problems compared with m1 the m2 introduces some prior set rules to divide the model inputs training and testing datasets into several subsets and the regression model is respectively developed based on the corresponding subset however the specific prior set rules in m2 are typically derived from expert experience or analysis of historical samples which introduces uncertainties in the prediction the m2 in this study involves two regression models fig 3 m2 which were developed by the time series of flood seasons july september and dry seasons october june respectively according to the peak flow magnitude wang et al 2006 the proposed m3 framework could automatically generate appropriate regression models for water level prediction in terms of different discharge and sediment conditions compared with m2 the m3 does not need a specific prior set rule and the subsets in the training and testing periods are identified using clustering and classification models respectively as shown in fig 3 m3 the training dataset is first divided into n sets using the clustering model and n 1 2 n is the set number second a total number of n regression models are trained based on the factors qu and su and targets hd of each set in the training period meanwhile a classification model is developed based on set number n and the factors qu and su of each set within the training dataset this classification model is validated using the 5 fold cross validation method within the training dataset and used the trained classification model to determine class number n for the testing dataset finally each set n in the testing dataset is predicted using the corresponding trained regression model n and the ensemble prediction results are evaluated by the target data hd in the testing dataset 3 2 model description the proposed framework adopts three widely used models k means model support vector classification svc model and support vector regression svr model for clustering classification and regression respectively the mechanisms of these models are described as follows and this framework could be extended easily to use other machine learning models 3 2 1 k means model the k means model is a type of prototype based clustering algorithm in data mining the first standard k means algorithm was proposed by stuart lloyd in 1957 for pulse code modulation lloyd 1982 and has been widely used in other areas including hydrology spate et al 2003 the inputs of the k means algorithm are the total number of clusters k and training samples in the present study each sample includes two types of factors upstream discharge and suspended sediment load k is selected by comparing the model performances in the testing period the input dataset is denoted by d x j j 1 2 3 m the k means algorithm first estimates k centroids c c i i 1 2 k by randomly selecting data from the input factor dataset then the algorithm iterates between the following two steps 1 data assignment step each sample x j is assigned to its nearest centroid c i based on the squared euclidean distance then input dataset d is divided into k subsets as follows 1 arg min c i c d i s c i x j 2 where dis is the function used to calculate the euclidean distance 2 centroid update step centroid c i is updated as follows 2 c i 1 n i k 1 n i x k x k a i where a i is a subset of d and n i is the number of objects in a i the k means algorithm iterates between steps 1 and 2 until the cluster assignments do not change or the maximum number of iterations 1000 in this study is reached one difficulty of using the k means algorithm is selecting the optimal k value in this study the best number of clustering classes are selected according to the model performances in the testing period 3 2 2 svc model two types of svc binary svc and multi class svc are adopted in this study the svc is developed based on the training dataset and clustering class n from the k means model and used to predict clustering class n for the testing dataset for a binary problem n 2 the main idea of svc is to construct a hyperplane to separate the two classes in this study for a given dataset x i i 1 2 p p is the number of training samples and y i 1 1 denotes the cluster classes from the k means model the support vectors are achieved as follows 3 r w t x i b w 4 w t x i b 1 y i 1 w t x i b 1 y i 1 where w and b are hyperplane parameters and r represents the distance from xi to the hyperplane the basic formula of svc is described as follows by optimizing the maximum margin between support vectors 5 min w b 1 2 w 2 s t y i w t x i b 1 i 1 2 p the optimal separating hyperplane is solved as follows by applying a kernel trick boser et al 1992 and penalty term 6 min w b ξ 1 2 w 2 c i 1 n ξ i s t y i w t ϕ x i b 1 ξ i ξ i 0 i 1 2 p where ζ i is the slack variable and represents the acceptable deviation between the function margin and data xi and c is a parameter that controls the weight of the penalty term in the objective function transformed function ϕ x fits the maximum margin hyperplane in high dimensional space for the multiple class problem n 2 the one versus one coding design weston and watkins 1998 is introduced to reduce the multiclass problem to a series of binary problems for each binary svc one class is positive 1 one class is negative 1 and the remaining classes are ignored a total of n n 1 2 binary svc models are developed and the final results are obtained based on the majority vote across all classifiers 3 2 3 svr model in this study the ε insensitive svr model is used to simulate the water level in each clustering class the ε insensitive svr model maintains the same features as svc that characterize the maximal margin algorithm vapnik 2013 for a given dataset x 1 y 1 x 2 y 2 x p y p p is the number of training samples the goal of ε insensitive svr is to determine function f x that has at most ε deviation from the observed y i thus the svr model is formulated as a convex optimization problem as follows 7 min w b 1 2 w 2 s t y i w t x i b ε w t x i b y i ε where ε is the insensitive loss and w and b are hyperplane parameters the formula for the svr model is described as follows by adding two slack variables 8 min w b ξ i ξ i 1 2 w 2 c i 1 n ξ i ξ i s t f x i y i ε ξ i y i f x i ε ξ i ξ i 0 ξ i 0 i 1 2 p where c is a parameter that controls the tradeoff between the smooth decision line and training points and ξ i and ξ i are slack variables 3 3 model implementation and evaluation the k means model was based on the kmeans function in matlab software arthur and vassilvitskii 2007 n was set to 2 3 and 4 and selected according to the highest accuracy of the forecasting models in the testing period the maximum number of iterations for the k means model was set to 1000 and the initial cluster centers were generated by k means algorithm the linear kernel svc and svr models were implemented using the statistics and machine learning toolbox in matlab https uk mathworks com help stats and the parameters in the kernel functions were automatically optimized by a heuristic procedure in the toolbox for the svc model a 5 fold cross validation method fushiki 2011 was used to test model performance the input dataset was randomly divided into five subsets for each subset the svc was trained with the data from the remaining four subsets and tested on the current subset the svc model performance was evaluated using a combined acc value for each fold the combined acc is formulated as 9 acc 1 5 i 1 5 c i c i f i 100 where acc is the combined model accuracy of the entire dataset i is the subset number c i is the number of samples correctly classified in subset i f i is the number of samples incorrectly classified in subset i for the svr model the inputted time series was divided into training and testing periods nash sutcliffe efficiency nse and pearson correlation coefficient pcc were adopted to evaluated svr model results in training and testing periods the indices were formulated as follows 10 nse 1 t 1 t h s t h o t 2 n 1 t h o n h o 2 11 pcc t 1 t h s t h s h o t h o t 1 t h s t h s 2 t 1 t h o t h o 2 where h s t is the simulated water level at time t m h o t is the observed water level at time t m h s is the mean value of the simulated water level of the time series m h o is the mean value of the observed water level of the time series m and t is the length of the time series day 4 results analysis 4 1 input selection point sources from upstream reach and non point sources from surface runoff are two major driven factors changing downstream water level in the lyr the levee along the reach and the elevated riverbed isolate the surface runoff to channel and thus the downstream water level is mainly controlled by the upstream point sources meanwhile the downstream water level is also influenced by the cumulative effect of the sediment erosion or deposition at the downstream reach section which will slowly change with time therefore the predicted factors considered in this study are upstream discharge qu upstream suspended sediment load su and the calendar date time since the beginning of the simulation known as predicted time t various combinations of these factors were examined to evaluate the impact on the model output hd the input combinations are presented in table 2 sets 1 and 2 only used a single factor qu and su respectively for prediction sets 3 4 and 5 reflected the combinations of qu and su in different time sets 6 7 and 8 added the predicted time t during model development to reflect the influence of time effects such as annual and seasonal trends on modeling the model performance in the testing period with different combinations of predicted factors above is shown in table 3 the best set of model inputs is selected by the highest nse value in testing period as shown in table 3 the average nse values of sets 1 2 3 4 and 5 were all lower than 0 50 this illustrates that the water level could not be accurately predicted with single or combined upstream discharge and sediment load data despite this model performance significantly improved for sets 6 7 and 8 nse 0 85 when the time factor t was considered as model input model performance was not sensitive to the number of predicted factors in different time specifically the best input combination for reaches a and b was set 7 with nse values of 0 95 and 0 97 respectively in the testing period the best input combination for reaches c and d was set 8 with nse values of 0 84 and 0 91 respectively in the testing period unlike these reaches the model performance of reach e demonstrated a decrease when the time factor t was considered in the prediction the best input combination for reach e was set 5 with an nse value of 0 84 in the testing period 4 2 clustering results and classification accuracy in the proposed framework the training dataset was first divided into n classes using the k means model according to the input factors an svc model was adopted to learn the relationship between class n and the input factors and then used to determine class n for the testing datasets the nse value in the training and testing periods with different numbers of class n is presented in table 4 the model performance improved as the number of classes increased in the training period the best clustering number n was selected with the best value of nse in the testing period we found that the best n of reaches b and d was 2 and that of reaches c and e was 4 the best n of reach a was 3 fig 4 shows the relationship between upstream q and s at the logarithmic scale and the acc is adopted for svc model validation in each reach as shown in the fig 4 the q s correlation relationship increases from upstream pcc 0 41 to downstream pcc 0 60 by adopting the k means and svc model in this study different q s combinations could be identified automatically the classifications are mainly based on the magnitude of the q and s and high sediment load floods are all classified as an independent class for model development the high acc value of all reaches 98 means that this classification model could be used to predict class n for the testing dataset 4 3 model performance comparison the model performances of m1 m2 and m3 in the training and testing periods were compared in five reaches in the lyr the m1 m2 and m3 represent the single rule based and proposed hybrid model frameworks respectively which are described in section 3 1 as shown in table 5 the proposed m3 framework had the highest accuracy of all reaches with an average nse value of 0 833 on the training dataset and 0 898 on the testing dataset this illustrates that the proposed framework outperformed the other two models both in terms of fitting ability and prediction accuracy compared with the m1 the m2 demonstrated a higher prediction accuracy for reaches b and e the prediction accuracy of m3 had a high degree of improvement 10 for reaches a c and e and a medium degree improvement 3 5 for reaches b and d as shown in fig 5 both the m1 m2 and m3 can capture the water level of peak flood the m3 outperforms m1 and m2 mainly on the low water level modeling 5 discussions reaches a and e were selected as examples to illustrate the change on the simulated hydrograph with and without the time factor t for reach a there was an obvious annual declining trend on the water level within the simulated period shown in figs 6 a and 2 a this decline was mainly caused by riverbed fluctuation miao et al 2016 and could not be properly reflected by upstream q and s therefore although the correlation coefficient was high pcc 0 90 there was a significant overestimation of the water level in the testing period with an nse of 0 088 this overestimation could be significantly corrected by adding time factor t with an nse of 0 937 for reach e there was no obvious trend for the water level within the simulated period shown in figs 6 c and 2 b thus both models with t and without t can correctly simulate the water level a small overestimation on the low water level was found for reach e by considering time factor t which caused the lower accuracy of reach e compared with model performance without t reach e is located near the yellow river delta and its water level is control by compound fluvial and coastal floods kong et al 2015b more factors reflecting the impact of coastal floods should be considered for water level predictionof reach e for the future study the forecasting performance under different lead times is evaluated at reach a and e fig 7 a and b a similar trend was found with the choubin et al s research that the model accuracy decreased with a longer lead time choubin et al 2018 we found that the proposed m3 framework overperformed m1 and m2 in all lead times the m2 showed higher performance than m1 at reach e and the m1 and m2 had similar performance at reach a the results revealed that the m3 framework can provide both reliable predictions nse 0 75 for early warning 3 day ahead and satisfied predictions nse 0 60 for advisory issue 7 day ahead given this week s lead time can active mitigation measures for flood minimization protection of critical infrastructures and provide active support to vulnerable groups 6 conclusions a hybrid machine learning based model framework was proposed for water level prediction in high sediment load reaches this approach can automatically generate proper models for different flood sediment scenarios by integrating clustering classification and regression models in the framework the main conclusions are summarized as follows 1 the best model inputs were selected for each reach according to the nse value in the testing period the water level could not be accurately predicted only with upstream discharge and sediment load data and had an average nse of 0 47 in testing period because of reach bed fluctuation performance could be significantly improved by considering time factor t with an average nse of 0 88 in the testing period model performance was not sensitive to the number of predicted factors 2 the correlation relationship between upstream q and s involved large uncertainty in the lyr by adopting the k means and svc models different combinations of q and s could be identified automatically within the training dataset the high acc value 98 for all reaches means that the classification model could be used to predict class n for the testing dataset 3 the proposed model framework m3 was compared with two benchmarks m1 and m2 the m3 outperform m1 and m2 particularly on peak and low water level prediction for all reaches the prediction accuracy of m3 had a high degree of improvement 10 for reaches a c and e and a middle degree improvement 3 5 for reaches b and d this illustrates that the proposed m3 could be used successfully for water level prediction in high sediment load reaches of the lyr as a proof of concept this framework was demonstrated for water level prediction for five representative high sediment load reaches considering different upstream discharge and sediment conditions in the lyr but could be extended easily to other high sediment load reaches globally this framework coupled three widely used models k means svc and svr for hydrological forecasting and it should be tested by using other machine learning models for the future study author contributions gang zhao and bo pang carried out the model development and wrote the paper zongxue xu and liyang xu proposed many useful suggestions to improve its quality declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments bo pang is supported by the national natural science foundation of china 51879008 and the china scholarship council no 201906045024 gang zhao is supported by the china scholarship council university of bristol joint phd scholarships programme no 201700260088 we thank maxine garcia phd from liwen bianji edanz group china www liwenbianji cn ac for editing the english text of a draft of this manuscript 
