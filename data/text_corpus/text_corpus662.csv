index,text
3310,generating reasonable heterogeneous aquifer structures is essential for understanding the physicochemical processes controlling groundwater flow and solute transport better the inversion process of aquifer structure identification is usually time consuming this study develops an integrated inversion framework which combines the geological single sample generative adversarial network geosingan the deep octave convolution dense residual network docrn and the iterative local updating ensemble smoother ilues named geosingan docrn ilues for more efficiently generating heterogeneous aquifer structures the performance of the integrated framework is illustrated by two synthetic contaminant experiments we show that geosingan can generate heterogeneous aquifer structures with geostatistical characteristics similar to those of the training sample while its training time is at least 10 times faster than that of typical approaches e g multi sample based gan the octave convolution layer and multi residual connection enable the docrn to map the heterogeneity structures to the state variable fields e g hydraulic head concentration distributions while reducing the computational cost the results show that the integrated inversion framework of geosingan and docrn can effectively and reasonably generate the heterogeneous aquifer structures keywords heterogeneous aquifer structure inversion generative adversarial network residual network deep learning 1 introduction generating realistic heterogeneous aquifer structures is crucial for accurately simulating groundwater flow and reactive solute transport in subsurface systems bianchi and zheng 2016 choi et al 2017 fiori and jankovic 2012 linde et al 2015 miller et al 2017 paniconi and putti 2015 yang et al 2014 zhang et al 2021b zhang et al 2021c typically heterogeneous aquifer structures are generated using geostatistical approaches deutsch journel 1992 dai et al 2007 straface et al 2010 that incorporate sparse field measurements e g core samples geostatistical methods in general are classified into two point and multi point methods di dato et al 2018 rubin 2003 tahmasebi 2018 the two point methods first calculate the spatial correlation of the stratigraphic facies e g indicator covariance or variogram based co kriging and then use the statistical variables to correlate the spatial distribution of facies within the heterogeneity domain deutsch journel 1992 in practice field measurements may not be sufficiently abundant to obtain a reasonable spatial correlation dai et al 2020b incorporating subjective knowledge into spatial correlation identification may be crucial to obtain reasonable heterogeneous aquifer structures carle and fogg 1996 proposed a transition probability and markov chain approach that considers the probability of transitioning from one facies to another compared to the covariance based co kriging this method can incorporate subjective attributes e g juxtapositional tendencies mean lengths volume proportions in recent years this method has been widely employed to identify heterogeneity of facies in different applications including geological co2 sequestration dai et al 2018 co2 enhanced oil recovery dai et al 2014 and delineating facies distribution of the tracer experiment field song et al 2019 the multi point method on the other hand relies on training images to generate the heterogeneous aquifer structures bai tahmasebi 2020 li et al 2016 strebelle 2021 zuo et al 2020 this method is based on extracting first the spatial distribution of the facies from the training image and then the pattern is matched with conditional data tahmasebi 2017 this method however performs poorly in representing spatial variability created by connected and conductive flow pathways particularly in non stationary formations with high heterogeneity laloy et al 2018 it is mainly because the image patterns fail to properly match the true facies distribution zhang et al 2019 importantly both two point and multi point methods rely on hard earned and costly facies type data e g core samples considering the limitations associated with geostatistical approaches proposing an inversion method combined with prior knowledge and measured hydraulic head and concentration data is often needed to obtain accurate representations of aquifer structures the inversion identification of heterogeneous aquifer structures has received extensive attention in recent years kang et al 2019 liu et al 2019 reuschen et al 2021 wang et al 2021a xiao et al 2021 xu et al 2021 zhang et al 2021a xu and gómez hernández 2018 used the ensemble kalman filter to identify the field conductivity by assimilating hydraulic head and concentration data laloy et al 2016 used a sequential geostatistical resampling algorithm namely sgr to identify the field conductivity based on multi point statistics however the process of heterogeneous aquifer structure inversion using field observations is usually high dimensional particularly in field scale in addition most inversion methods usually require performing multiple forward simulations to obtain convergent solutions which is computationally expensive chen et al 2021 dai et al 2020a dai samper 2004 to alleviate the aforementioned problems parameterization methods and surrogate models are often used for the inversion of heterogeneous aquifer structures mo et al 2020 the parameterization method uses low dimensional vectors to represent high dimensional heterogeneous aquifer structures commonly used parameterization methods include zonation harp et al 2008 level set function song et al 2019 principal component analysis pca and its variants emerick 2017 gao et al 2015 sarma chen 2009 k singular value decomposition kim et al 2018 and discrete cosine transformation jung et al 2017 in recent years the development of deep learning techniques has also yielded encouraging results especially in image processing wang et al 2021b yu et al 2020 two dimensional 2d and three dimensional 3d heterogeneous aquifer structures can be rendered as images accordingly in which deep learning techniques of image processing are applied to parametrize the heterogeneity structures azevedo et al 2020 kang et al 2021 generative adversarial network gan and variational auto encoder vae are the most popular ones canchumuni et al 2021 due to the powerful learning and generating ability of gan and vae they can generate more realistic heterogeneous aquifer structures than the traditional parameterization method canchumuni et al 2019 song et al 2021 zhang et al 2021a thus it has been widely used in the recent parameterization of heterogeneous aquifer structures using gan mosser et al 2017 reconstructed 3d heterogeneous aquifer structures at the pore scale to evaluate the variability of porous media s properties zhang et al 2019 proposed a gan based method to generate realistic 3d heterogeneous aquifer structures chan and elsheikh 2019 used wasserstein gan wgan to parametrize the channelized geologic structures together with bayesian methods to obtain the posterior structures laloy et al 2017 employed vae in the inversion of the binary heterogeneous aquifer structure canchumuni et al 2017 used vae to parametrize the binary facies model for history matching mo et al 2020 reported an adversarial autoencoder method by combining vae and gan to parameterize a non gaussian conductivity field despite their reliable performances vae and gan methods typically require many training samples representing facies distribution patterns which in reality is hard if not impossible to obtain concurrently the long training period and the instability of the training process limit the efficiency of these methods laloy et al 2018 surrogate models are computationally fast and provide similar results as high fidelity forward simulations keating et al 2016 wang et al 2021c in the inversion of heterogeneous aquifer structures surrogate models are used to find complex relationships between geologic structures and the field variables e g hydraulic heads and concentrations however these relationships are typically nonlinear because the size of both heterogeneous aquifer structure and state field e g hydraulic head field is large thus the parameters involved in the models are commonly high dimensional intensifying the technical challenges mo et al 2020 for some commonly used surrogate methods such as polynomial chaos expansion fajraoui et al 2011 jia et al 2018 kriging zhou et al 2018 and gaussian processes zhang et al 2016 it is therefore challenging to obtain the optimum results in contrast deep learning techniques due to their powerful nonlinear mapping capabilities can build surrogate models with high dimensional inputs and outputs chen et al 2018 mo et al 2019 sun 2018 used gan to build the bidirectional mappings between high dimensional permeability field and hydraulic head distribution kani and elsheikh 2019 used a residual recurrent network dr rrn to build a surrogate model representing multiphase oil and water flow in porous media in particular they found that dr rrn can provide stable and accurate approximations of high precision simulation and the computational cost is significantly reduced mo et al 2020 related the hydraulic conductivity field to the concentration and hydraulic head fields with the deep residual dense convolution network drdcn even though deep learning based surrogate models have shown inspiring results there are still some differences between the prediction results of the high fidelity and the surrogate models further the proposed models typically require a large amount of gpu memory during the training process which is a limiting factor in both traditional image processing and geoscience fields however with the rapid development of deep learning techniques in recent years some state of the art methods can alleviate these problems such as octave convolution chen et al 2019 and residual dense blocks rakotonirina rasoanaivo 2020 here we present a novel inversion framework that improves the gan based on single sample training to parameterize aquifer heterogeneity structures our proposed parameterization network is denoted as the geological single image generative adversarial network geosingan in addition a novel deep octave convolution residual network docrn is developed for the surrogate model the docrn uses octave convolution instead of the traditional convolution layer and the residual in residual dense residual block rrdrb rakotonirina rasoanaivo 2020 is used as the basic component finally geosingan and docrn modules are integrated into an iterative local updating ensemble smoother algorithm ilues zhang et al 2018 to form an integrated geosingan docrn ilues inversion framework which incorporates available observation data for identifying the heterogeneous aquifer structures for both 2d and 3d test cases section 2 presents the problem formulation of this study section 3 describes the geosingan docrn ilues inversion framework the uncertainty analysis of the unconditional simulation results of geosingan is presented in section 4 section5 presents the surrogate model performance and the inversion results section 6 discusses the advantages and limitations of the proposed inverse framework finally the conclusions are highlighted in section 7 2 problem formulation this study deals with contaminant transport in a steady state flow field the governing equation is given by bear 1979 1 c t d i v d c d i v u c s c x y t γ right 0 x y γ right c x y t γ left 0 x y γ left c x y t γ top 0 x y γ top c x y t γ bottom 0 x y γ bottom c x y 0 0 x y d s i m 2 k h 0 h x y t γ right h right x y γ right h x y t γ left h left x y γ left k h n γ top 0 k h n γ bottom 0 h x y 0 h 0 x y x y d s i m where c m l 3 is the solute concentration t t is time d l is the diffusion coefficient tensor u l t is the pore water velocity and s m l 3 t 1 is the sink source k is the hydraulic conductivity h presents the hydraulic head γ denotes the boundary and subscript is the position where the boundary is located in the 2d test case of this paper dirichlet conditions are adopted for the left and right boundaries with prescribed hydraulic heads equal to 1 l and 0 l respectively the upper and lower boundaries are impervious h 0 presents the initial hydraulic head distribution d s i m is the whole flow field the flow and solute transport equations are solved numerically using toughreact xu et al 2006 we focus on the inversion identification of the aquifer heterogenous structure using available measurements the objective function of the inversion problem is to minimize the difference between the simulated and measured hydraulic heads and concentrations here the heterogeneous aquifer structure is parameterized with a low dimensional vector therefore the inversion process is to find a series of optimal vectors used for aquifer parameterization to obtain realistic heterogeneous aquifer structures 3 integrated inversion framework the integrated inversion framework consists of three modules 1 the geosingan which converts low dimension random vectors to corresponding heterogeneous aquifer structures 2 the docrn surrogate model which improves forward simulation speed and 3 the ilues which is used for data assimilation the three components are described in detail in sections 3 1 3 3 and the workflow of this framework is presented in section 3 4 finally section 3 5 introduces some spatial statistical models for evaluating geosingan generation quality 3 1 geosingan architecture the developed geosingan architecture here is based on the concurrent single image generative adversarial network consingan hinz et al 2021 in this approach the heterogeneous aquifer structure is regarded as image data the generator can be trained with only a sample to produce realistic heterogeneity structures the dimension of the random vector in this strategy however is identical to that of the training sample thus the inversion of a field scale aquifer heterogeneity with the high dimensionality of the input vector will computationally be prohibitive to overcome these problems two vector blocks are used to map the low dimensional vector to the high dimensional one with the same shape as the object aquifer the structures are shown in fig 1 vector block 1 is used in the first stage of training and vector block 2 is used in the follow up stages see fig 2 fig 2 shows the architecture of geosingan it first learns to map a low dimensional vector to a small size heterogeneous aquifer structure fig 2 training stage 0 once completed the size of the generated model is increased via the upsampling layer to improve diversity the input vector is also added to the upscaled model through the vector block 2 the yellow blocks are shown in fig 2 this mixed model is then used as an input for the next training stage besides stage 0 a residual connection is added to connect the input model to the output of each training stage this process continues until a heterogeneous aquifer structure with the desired size is generated for the 2d case the height of the generated model in stage n is determined by hinz et al 2021 3 h n h r n 1 log n log n n 1 n 0 n 1 where h is the height of the training heterogeneous aquifer structure n is the user defined number of training stages r x min m i n h w 1 n 1 is the scaling factor x min is the minimum size of the generated model and is defined by users w is the width of the heterogeneous aquifer structure the equation to determine width resolution is similar to equation 3 by replacing h with w the discriminator architecture includes several user defined convolution blocks containing two operations convolution and activation the leakyrelu is used for both generator and discriminator as the activation function in this multi stage training process both generator and discriminator focus on global features at the low stage and finer textures at the higher stage in this study x denotes the true heterogeneity structure training sample x is the estimated heterogeneity structure obtained by the generator x g z z is the random vector selected from a specific distribution using a user defined dimension the generator and discriminator are trained consecutively with opposing targets discriminator d is trained to distinguish x from x as much as possible simultaneously the generator g learns the patterns of x and generates x to fool the discriminator into labeling x as a true heterogeneity structure at any given stage the training process is translated into the following minimization maximization loss function hinz et al 2021 4 min g n max d n l wgan gp g n d n δ l rec g n where l wgan g p g n d n is the wgan gp loss function l rec g n is the reconstruction loss and δ is the reconstruction loss weight that balances the similarity between the true and estimated models the wgan gp loss function can enhance both stability and speed of gan training gulrajani et al 2017 5 l wgan g p d n e x p train d x e x p gen d x λ e x p x x d x 2 1 2 6 l wgan g p g n e x p gen d x where p train is the training data distribution p gen denotes the generated data distribution and p x is a random sample distribution that uniformly samples along straight lines between p train and p gen λ is the penalty coefficient x d x represents the gradient of discriminator both terms of e x p train d x e x p gen d x are the wasserstein distance used to measure the space between the distributions of x and x the introduction of these terms alleviates the problem of gradient vanishing a process in which the parameter updating speed during gan training is reduced λ e x p x x d x 2 1 2 is the gradient penalty term used to ensure that the gradient of d is neither too large nor too small and further prevents explosion gradient or vanishing gradient the reconstruction loss l rec g n is used to measure the similarity between x and x the larger the value of δ the larger similarity between x and x the reconstruction loss function at a given stage is expressed by 7 l rec g n g n z rec x n where z rec is a random reconstruction vector that is randomly selected from a user defined distribution before training and remains fixed throughout the training process and x n is the downsampled version of the original training model at stage n at each stage adversarial training is completed in two consecutive steps first the parameters of g are fixed to train d three times to minimize eq 5 and subsequently g is trained three times with fixed d parameters to minimize the sum of eqs 6 and 7 after training the generator g generates a series of realistic heterogeneous aquifer structures with different random vectors 3 2 docrn for surrogate modeling a surrogate model for the forward simulation is an image to image translation process to establish a complex nonlinear relationship between the heterogeneous aquifer structure and the state field e g hydraulic head field for the 3d test case this process is given by 9 y l w h n f f x l w h where x l w h is the heterogeneous aquifer structure and y l w h n f represents the state field l w and h are the length width and height of the heterogeneous aquifer structure respectively n f represents the number of output state fields and f denotes the complex nonlinear relationship between the input and output parameters the performance of the surrogate model is improved by integrating a novel convolution structure octave convolution and a novel residual block residual in residual dense residual block rrdrb into the docrn surrogate model it should be noted that the docrn here is only designed to speed up the process of aquifer structure identification specifically to achieve rapid estimation of concentration and head data at the location of observation point based on different aquifer structures therefore the docrn only learns the highly nonlinear relationship between the aquifer structure and the state field corresponding to the moment of observation data collection during the training process 3 2 1 octave convolution the information of a natural image can be decomposed into low and high frequency information chen et al 2019 low frequency information is usually the global structure whereas more detailed information is included in the high frequency chen et al 2019 in neural network training processes some redundant low frequency information can be compressed without affecting the learning ability chen et al 2019 the traditional convolution layer is replaced with an octave convolution layer to reduce this redundancy and improve the processing of information with different frequencies the architecture of the octave convolution is shown in fig 3 the first octave convolution is used to decompose the input feature map into high and low frequency features according to 9 y h c o n v x in 10 y l c o n v a v e p o o l x in the last octave convolution however is used to recombine the high and low frequency features into the output feature map 11 y out conv x h u p s a m p l e c o n v x l the middle octave convolution operations are given by 12 y h conv x h u p s a m p l e c o n v x l 13 y l c o n v a v e p o o l x h c o n v x l where conv contains the following three operations convolution with stride 1 batch normalization and activation used to change the channel dimension of the feature map while keeping the spatial dimensions unchanged the spatial dimensions are altered by the upsampling and avepool operations where upsampling is used to expand the spatial dimension of the feature map and avepool is used to reduce it 3 2 2 octave residual in residual dense residual block rrdrb was first proposed for super resolution image generation rakotonirina rasoanaivo 2020 this approach contains three residual dense blocks rdbs which add a residual connection within every two layers blue lines in fig 4 a and enable the learning of patterns at multiple levels this multilevel residual learning increases the network capacity and ensures that the network can learn very high complex non linear relationships between the heterogeneous aquifer structure and state field mo et al 2019 concurrently the residual learning strategy alleviates the gradient vanishing problem which improves the quality of translated images generated by rdb compared to that of the simple dense block sdb approach rakotonirina and rasoanaivo 2020 to improve training stability all outputs from the rdbs are multiplied by a residual scale β we assume that β 0 2 following the values suggested by szegedy et al 2017 similar to the method of adding noise to human face generation tasks karras et al 2021 gaussian noise is multiplied by a learning scale parameter γ here γ 0 1 and is added to the scaled rdb outputs to alleviate the overfitting phenomenon of docrn the octave residual dense block octrdb is based on the aforementioned rdb which replaces the convolution layer with an octave convolution layer batch normalization bn layers are also used to improve the generalization ability of the surrogate model for octrrdrb besides replacing rdb with octrdb the first and last octave convolution layers are added to the head and tail of rrdrb fig 4 b 3 2 3 docrn based on octrrdrb octrrdrb is integrated into the docrn surrogate model docrn shown in fig 4 c adopts the same network distribution structure as that drdcn developed by mo et al 2020 this type of network structure which resembles an hourglass enables the network to learn pattern information from coarse to fine scales traditional convolution layers repeatedly learn some low frequency information which wastes a lot of computational resources while the octave convolution layer proposed here can alleviate this problem compared to residual in residual dense block rrdb additional residual connection structures and gaussian noise contribute to more accurate simulation results rakotonirina rasoanaivo 2020 zhan et al 2022 3 3 ilues for inverse modeling the purpose of heterogeneous aquifer structure inversion eq 19 is to find a series of random vectors z which can be fed into geosingan to obtain results x that are similar to the true heterogeneous aquifer structure x 14 x g e o s i n g a n z similar to mo et al 2019 and zhang et al 2018 ilues is used here for inversion in practice we can only judge whether the estimated heterogeneous aquifer structure is reasonable by comparing the borehole data and the historical responses at observation wells it is assumed that the relationship between the field measurements and the forward model output for a heterogeneous aquifer can be expressed by 15 d obs d f e where d obs are the measurements d f f g e o s i n g a n z is the simulated result of the surrogate model f e is a n obs 1 observation error vector with a mean of zero and a covariance of c d e e e t the ilues process includes two main steps first of all a prior ensemble z 0 of the n es initial parameter samples is generated 16 m 0 m 1 0 m 2 0 m n es 0 then the parameter samples within the prior ensemble are updated via eq 17 by incorporating the measurements emerick and reynolds 2013 17 m n i 1 m n i c mf i c ff i c d 1 d obs n iter e n i f g m n i where m n i 1 denotes the updated n th parameter sample after the i th iteration c d n iter c d is the inflated covariance matrix e n i c d 1 2 r n obs r n obs n 0 i n f is the n th random sample of the observation error c mf i is the cross covariance between the parameters and the simulation results in the i th iteration and c ff i is the auto covariance of the forward model predictions in the i th iteration the expressions of c mf i and c ff i are given by 18 c mf i 1 n es 1 n 1 n es m n i m i d n f i d f i t 19 c ff i 1 n es 1 n 1 n es d n f i d f i d n f l d f i t where t denotes the transpose and d n f i f g m n i is the surrogate model predictions ilues adopts a local updating scheme to avoid problems resulting from the prior or posterior distribution of unknown parameters the local ensemble of the parameter sample is identified by using the following distance metric 20 j m j f m j f max j m m j m max where j f m d f d obs c d 1 d f d obs represents the distance between the simulation results and the measurements j m m m m n i c mm 1 m m n i measures the distance between the parameters and the local ensemble sample m n i n 1 2 n es and j f max and j m max are the maximum values of j f m and j m m respectively based on the values of j a roulette wheel selection operator is used to select the local ensemble of parameters lipowski lipowska 2012 the selection probability of the n th parameter is determined by p n ν i j 1 n es ν j i 1 2 n es where ν i 1 j m i more can be found in zhang et al 2018 and mo et al 2019 3 4 the integrated geosingan docrn ilues inversion framework the geosingan model and docrn surrogate model are integrated with the ilues inverse module in this geosingan docrn ilues inversion framework the major steps are as follows 1 training the generator of geosingan g and the docrn surrogate model f based on the training samples 2 generating the initial ensemble of random vectors m 0 m 1 0 m 2 0 m n es 0 from the user defined distribution 3 obtaining the heterogeneous aquifer structure ensemble x i x 1 i x 2 i x n es i by x j i g m j i 4 running the surrogate model to obtain the simulation result ensemble d i d 1 i d 2 i d n es i from d j i f x j i 5 updating the ensemble of random vectors by assimilating field measurements with ilues 6 repeating steps 3 5 with the updated random vector ensemble m i 1 m 1 i 1 m 2 i 1 m n es i 1 until the prescribed maximum number of iterations is reached 7 obtaining the posterior heterogeneous aquifer structure ensemble x post x 1 post x 2 post x n es post from x i post g m i post 3 5 spatial statistical model for assessing generation quality some statistical characteristics are used to evaluate the quality of the heterogeneous aquifer structures generated by geosingan the statistical characteristics mainly focus on evaluating facies geometry and the spatial correlation structure of the facies the following three properties are evaluated 1 the volume proportion of each facies p i which is calculated from the proportion of the grid number of the i th facies n i and the total grid number 21 p i n i j n facies n j where n facies is the number of different facies 2 the mean length of the i th facies in the ϕ direction l i ϕ which is obtained by counting each continuous facies block s length in different directions according to 22 l i ϕ j n i ϕ l i j ϕ n i ϕ where l i j ϕ is the length of j th continuous block for the i th facies in the ϕ direction and n i ϕ is the number of continuous blocks for the i th facies in the ϕ direction 3 transition rate r ij ϕ which is used to measure the spatial correlation of the facies the transition rate can be calculated in terms of the facies volume proportion and mean length as follows dai et al 2019 23 r ij ϕ p i l i ϕ 1 p j the transition rate ranges from 0 to 1 it denotes the probability of change per unit length from facies i to j in the direction ϕ and can be used to describe the spatial correlation structure of facies distribution carle fogg 1997 ritzi et al 2004 4 uncertainty analysis of unconditional simulation results uncertainty analysis is performed here on the statistical characteristics of geosingan s unconditional simulation results to evaluate whether the geosingan can generate high quality geostatistical realizations in the unconditional simulation geosingan does not consider any soft and hard data constraints however it should be noted that geosingan can consider hard data through loss function eq 4 and assimilate soft data through ilues to realize conditional simulation 4 1 2d test case the 2d test case considered a 100 80 binary training model generated by cropping randomly the 340 200 80 heterogeneous aquifer structure representing the hydrofacies of an alluvial aquifer in the maules creek valley australia fig 5 the aquifer contains two facies with contrasting permeabilities equal to 10 10 l2 for facies 1 and 10 12 l2 for facies 2 the random vector in the geosingan is generated from a standard normal distribution in which the dimension is set 100 the training stage n of the geosingan is set to 5 see fig 2 the reconstruction loss weight is 10 and the learning rates of the generator and discriminator are equal to 0 0001 and 0 00005 respectively the geosingan was trained for 1000 epochs based on a single training model fig 6 a the training process took 220 s on an nvidia geforce gtx 3070 gpu whereas generating a 100 80 realization using the trained network takes less than 0 1 s on an intel i9 10850 k cpu the reconstructed results and some randomly selected heterogeneous aquifer structures are shown in fig 6 b e 10 000 heterogeneous aquifer structures were generated to calculate frequency distributions of volume proportion of each facies mean length in x and y directions and transition rate figs 7 9 in the meantime the statistics of the training model the sample used to train geosingan see fig 6 a and the object model the true model that we want to identify see fig 18 d are also calculated and marked with arrows in figs 7 9 all statistical features of the training model are within the distribution range which indicates that the trained geosingan successfully recovers the facies distribution of the training model and unconditional simulation results have similar patterns of the training model therefore the geosingan can be used as the parameterization method in the developed inversion framework 4 2 3d test case by cropping randomly the 340 200 80 heterogeneous aquifer structure shown in fig 5 we generate a 40 30 20 binary training model for the 3d test case fig 10 a the random vector s dimension is identical to that of the 2d test case and follows a standard normal distribution for the 3d test case the training stage n see fig 2 is set to 3 the reconstruction loss weight is 10 and the learning rates of the generator and discriminator are equal to 0 0005 and 0 00005 respectively the geosingan is trained for 1500 epochs the training time is 600 s on the used gpu and the single model generation takes 0 2 s using the aforementioned cpu fig 10 b f shows the reconstructed model and some randomly selected realizations the structure of the training model is reconstructed well and realistic heterogeneous aquifer structures are obtained the frequency distributions of the volume proportion of the two facies the mean length and the transition rates along the x y and z directions are also calculated from 10 000 3d realizations figs 11 13 show that the statistical characteristics of the geosingan generated model are within a certain range around those of the training samples therefore the geosingan can generate high quality geostatistical realizations 5 inversion framework evaluation 5 1 surrogate model training results 5 1 1 2d surrogate model for the inversion of the 2d test case we consider a hypothetical scenario in which a contaminant source is released under a steady state flow condition the size of the domain is 100 l 80 l which is uniformly discretized into 8000 grids of a unit grid size dirichlet conditions were adopted for the left and right boundaries with prescribed hydraulic heads equal to 1 l and 0 l respectively the upper and lower boundaries are impervious the initial concentration of the tracer is 0 and the inflow of water in the boundary does not contain the tracer as shown in fig 14 a there is a 3 l 7 l contaminated area yellow near the left boundary this area continuously releases tracer at a rate of 0 1 m l 3 t 1 a total of 80 monitoring wells green blocks in fig 14 a are evenly distributed within the aquifer domain the data are collected at seven different times concentrations 0 5 1 2 3 4 6 and 12 t while the hydraulic head data is only obtained at the final time 12 t the permeability values of two facies within the domain are 1 10 10 l2 and 1 10 12 l2 the porosity is 0 3 the change of pore structure is not considered during the simulation and the temperature and ph were 25 c and 7 respectively the diffusion coefficient is 3 10 9 l2 t and the adsorption of the tracer by the aquifer medium is not considered during transport the heterogeneous aquifer structures generated by the trained geosingan are incorporated into toughreact to simulate this hypothetical scenario for the 2d case 10 000 heterogeneous aquifer structures and corresponding state fields are generated to train docrn to improve the training efficiency the distribution of concentration fields is normalized using the following equation 24 c k c k c min c max c min where c k and c k are the normalized and non normalized concentrations at grid cell k respectively and c min and c max are respectively the minimum and maximum concentrations within the entire domain and all training samples the batch size of the training process is 128 and an adam optimizer is used kingma ba 2014 80 of the samples 80 of the geosingan generated aquifer structures and their corresponding concentration and distribution fields are used for training and the remaining 20 is used for the validation process to prevent overfitting in the later training stage the following exponential function was adopted to implement a learning rate decay strategy 25 r i r 0 η i where r 0 0 0005 is the initial learning rate r i is the updated learning rate in the i th epoch and η which set 0 99 is the multiplicative factor of learning rate decay the following regularized l1 loss function is used in docrn training 26 l 1 1 n grid k 1 n grid y k y k 1 φ 2 θ t θ where n grid is the number of grid cells y k is the simulated results by high precision forward simulations at grid k y k is the predicted value of docrn θ denotes the vector of docrn s trainable parameters and φ 1 10 5 is the regularization coefficient the root mean square error rmse and the coefficient of determination r 2 are also calculated to evaluate the accuracy of the surrogate model with the following equation 27 rmse 1 n grid k 1 n grid y k y k 2 2 28 r 2 i 1 n grid y i 1 n grid k 1 n grid y k 2 i 1 n grid y i 1 n grid k 1 n grid y k 2 the docrn training is conducted on an nvidia tesla v100s gpu for 500 epochs to evaluate the quality of the docrn predictions the drdcn developed by mo et al 2020 is also trained with the same super parameters setting on the same gpu the l1 loss rmse of the validation set and the occupied gpu memory are compared between docrn and drdcn table 1 all three evaluation indexes are lower for docrn in particular l1 and rmse of docrn are reduced 20 and the gpu memory cost is decreased by 11 favoring the docrn s performance over drdcn the training period for the docrn is 5 h whereas the trained network can generate the concentration and hydraulic head distribution fields in less than 0 2 s the calculated coefficients of determination r2 in 2d test cases are all greater than 0 99 see fig 16 a and b there are only some outliers at the edges of the contamination plume see fig 15 therefore the docrn can provide reasonable estimates of concentration and temperature fields the prediction of the head is more accurate than that of the concentration which indicates that the head distribution is less sensitive to the heterogeneity of the aquifer structure than the concentration field kitanidis 2015 5 1 2 3d surrogate model the aquifer domain of the 3d test case is 40 l 30 l 20 l and is uniformly discretized into 24 000 1 l 1 l grid cells the hydraulic heads were prescribed to 1 l and 0 l at right and left boundaries impervious conditions are assigned to other boundaries the initial and boundary conditions of solute transport are the same as those of the 2d test case fig 14 b shows the locations of the contaminant source the yellow zone near the right hand boundary and the observation points shown by green grid blocks the 3 l 3 l 2 l contaminated area has a continuous release rate of tracer 0 05 m l 3 t 1 48 monitoring wells shown by light green grid blocks collect field observations at 4 different depths the collected data type monitoring frequency facies permeabilities and solute transport parameters are the same as the 2d test case 5000 samples are generated for docrn training in the 3d test case concentration data were normalized according to eq 24 all super parameters e g the learning rate and the regularization coefficient are the same as the 2d case the save for the batch size is 64 the l1 loss rmse of the validation set and the gpu memory use of docrn and drdcn are listed in table 2 comparatively the l1 and rmse values for docrn are 10 smaller and the gpu memory cost is 22 smaller than those of drdcn thus it can be concluded that the docrn outperforms the drcrn in the 3d test case due to the high dimension of 3d models the docrn training process takes nearly 15 h however similar to the 2d case the trained network can generate the concentration and hydraulic head fields in less than 0 2 s in the 3d case randomly selected results of the validation set are shown in fig 17 and the calculated coefficients of determination r2 are also greater than 0 99 see fig 16 c and d assuring that the docrn can handle the solute transport simulation effectively in the 3d test case 5 2 inversion results after training the docrn the ilues is used to identify the heterogeneous aquifer structure the concentration data at seven different times and the hydraulic head data at the final time are collected at the observation points fig 14 the observation points were 80 in the 2d test case while 192 points were set in the 3d test case thus 80 8 640 and 192 8 1536 observation data were respectively used for the inversion of 2d and 3d heterogeneous aquifer structures to increase the inversion challenge no hard data e g borehole data is used however it should be noted that the geosingan can add a reconstruction loss term in a form similar to l rec see eq 7 to the total loss function eq 4 for hard data to achieve conditional simulation based on borehole data we also add a 5 observation error to each observation data the object model fig 18 d is generated by feeding a randomly selected 100 dimensional random vector z from the standard normal distribution n 0 1 into the geosingan the statistics of the geometric features and the spatial correlation structure of the object model were calculated see the arrow marks in figs 7 9 2d and figs 11 13 3d the statistics difference between the object and the training heterogeneous aquifer structure is readily apparent increasing the challenge of inversion the large ensemble size and iteration number enable the ilues to obtain relatively good results zhang et al 2018 while increasing the computational cost to balance the inversion accuracy and computational cost the ensemble size n e 3000 and the iteration number n iter 30 are used in both the 2d and 3d test cases the local ensemble factor α is 0 1 therefore both 2d and 3d test case inversions required 30 3000 90 000 solute transport simulations even though many simulations need to be run the inversion time can be significantly reduced using the docrn surrogate model the inversion time in the 2d and 3d heterogeneous aquifer structures are 2 4 h and 6 h respectively the facies probability map of facies 2 and the accuracy are used to evaluate the quality of the inversion results the accuracy is equal to the percentage of grid is assigned to the correct facies with respect to the object model the marginal probability of facies 2 is calculated by 29 p f a c i e s 2 x pr i 2 x 1 1 n mod i 1 n mod i 2 i x where i 2 x 1 if facies 2 occurs at location x and i 2 x 0 otherwise the n mod is the number of heterogeneous aquifer structures the comparison results are shown in fig 18 2d and 19 3d both 2d and 3d posterior models 2d fig 18 f 3d fig 19 f capture the underlying structure of the object model and there are only some minor differences in local features over 90 of the estimated facies grid is correct according to the object model in 2d and 3d test cases the accuracy of posterior models is much higher than that of prior ones moreover the facies probability maps also indicate that the uncertainty of posterior models can be significantly reduced by our developed inversion framework the prior model presented here figs 18 e and 20 e is heterogeneous it is because that geosingan will learn the facies volume proportion and distribution patterns of the training model during the training process thus making its generated model inherently heterogeneous even without considering the observed data furthermore we compared the predicted concentration and hydraulic head distribution fields under the same conditions based on the object and posterior models the results are shown in figs 20 2d and 21 3d although the posterior model is slightly different from the object model the contaminant plume and hydraulic head field predicted based on them are very close which indicates that the heterogeneous aquifer structure obtained by our inversion framework can honor the available observations therefore even though the hard data are absent the geosingan docrn ilues framework can still obtain accurate and realistic posterior heterogeneous aquifer structures considering the observation errors 6 discussion the results show that all modules of the geosingan docrn ilues inversion framework work effectively compared to the multi sampled based neural network chan elsheikh 2019 laloy et al 2018 liu et al 2019 the proposed geosingan has significantly increased the training efficiency for example the training of the geosingan for a 3d heterogeneous aquifer structure containing 24 000 grid cells is less than 10 min whereas for a multi sample based neural network it may take several hours laloy et al 2018 mo et al 2020 based on a single training model geosingan can generate a series of heterogeneous aquifer structures with geometric features and spatial correlation structures similar to those of the training model the accuracy of the docrn surrogate model is improved by integrating the octave convolution layer and rrdrb compared with the drdcn model which has similar network structures with docrn the octave convolution layer reduces the occupied gpu memory used by docrn during the training process enabling the inversion of field size heterogeneous aquifer structures with limited gpu memory it also permits an increase in the batch size the number of samples that the model learns at a time used in the training process improving training efficiency furthermore the additional residual connection structure helped the docrn provide more accurate predictions with a negligible increase in the network complexity in rakotonirina rasoanaivo 2020 the addition of gaussian noise does not always improve the performance of the simulation results however in our experiments the addition of gaussian noise can alleviate the overfitting phenomenon of docrn there are some limitations and future considerations to the proposed inversion framework that merit attention first compared to the multi sample based deep learning model the geosingan only requires a single sample in practice choosing a reasonable training sample still needs to be carefully considered since geosingan only learns the facies distribution patterns from a selected training sample according to the unconditional simulation results in section 4 the training sample should have similar statistical characteristics as the object model the sample can be obtained by the geostatistical inversion method zhan et al 2022 for example harp et al 2007 presented a transition probability based inversion method to identify the aquifer structure and the estimated structure has similar statistical characteristics with the true structure but the estimated structures are still uncertain due to the stochastic nature the combination of the geosingan docrn ilues framework and the geostatistical inversion method may have significant practical potential to identify heterogeneous aquifer structures the geostatistical inversion method can provide a reliable training model of geosingan then the developed framework of our study can further reduce the uncertainty of the aquifer structures zhan et al 2022 indeed for cases with large differences between the object model and the training model a lower reconstruction loss weight δ in the loss function of geosingan is suggested in practical applications multiple δ values can be tested during the inversion framework second in this paper we focus on the uncertainties of aquifer heterogeneous structure without considering the uncertainties of model parameters such as the parameters of flow and solute transport source sink terms etc however these uncertainties always exist in practical applications which may lead to difficulties in reproducing the real observations in forward simulations thus making the identified aquifer structure deviate from the real one in future studies simultaneous identification of aquifer structure and model parameters may be a more reasonable option and the developed framework can still achieve this object with a feasible extension in this case ilues needs to identify low dimensional random vectors as well as model parameters simultaneously the generation of docrn s training samples also needs to consider different model parameters simultaneously and not only the differences in aquifer structure the corresponding docrn input contains both the aquifer structure and the model parameters in this way the developed framework can consider the uncertainties of multiple factors while using the available observations to obtain reasonable aquifer structures and model parameters mo et al 2019 wang et al 2021c third the local features of the heterogeneous aquifer structures are not perfectly identified using the integrated inversion framework employed here potentially due to 1 the low dimensionality of the random vector which makes each element in the random vector controls a large region of the generated heterogeneous aquifer structure making it difficult to adjust some detail of the structure 2 the slight differences between the results of docrn and forward models 3 the field measurements error and the aquifer structure s high heterogeneity which can cause differences between the posterior and the object models under this condition the bayesian inversion method can be a better option to obtain a more accurate posterior distribution of parameters through a large number of parameter samples and can consider observation error and the deviations associated with the surrogate model laloy et al 2018 zhu zabaras 2018 however the bayesian method requires a large number of forward simulations to achieve converged solutions zhang et al 2018 mo et al 2019 fourth in the data assimilation based aquifer structure identification framework such as the one developed in this paper it is also worthwhile to carefully consider how to set up monitoring wells reasonably because it is the amount of assimilated data that affects the identification results therefore for the developed framework the accuracy of aquifer structure estimation can be better improved by placing monitoring wells within the potential distribution range of the solute plume where the solute concentration can be monitored as much as possible based on the prior information to obtain more effective monitoring data rather than simply setting smaller well spacing in practical applications besides heterogeneous aquifer structure inversion the proposed geosingan can provide an efficient way to quantify the uncertainty of aquifer heterogeneity due to its high generation speed the docrn or octrrdrb proposed here can also be used in other environmental fields including contaminant source identification monitoring network optimization and other applications which require many solute transport simulations the octave convolution layer can help deep learning models better apply to geoscience applications with high dimensional parameters introducing this layer can effectively reduce the computational costs so that some more complex deep learning models can be implemented in the inversion problem discussed here the deep learning model can be used to directly determine the relationship between the observations and the random vectors of input geosingan chen et al 2021 wang et al 2021a the corresponding random noise can be obtained by inputting the observations into the trained deep learning model then heterogeneous aquifer structure can be obtained by inputting the random noise into geosingan this approach is particularly promising when there is adequate training data and the ability of the deep learning model to identify a highly nonlinear relationship is sufficiently strong in this context it would be unnecessary to use computationally demanding inversion methods such as ensemble smoother and the bayesian inversion 7 conclusions a novel integrated inversion framework is developed here to identify complex heterogeneity structures the framework combines the geological single image generative adversarial network geosingan for conducting heterogeneous parameterization the deep octave convolution dense residual network docrn for surrogate modeling and the local update iterative ensemble smoother iluse for estimating optimal input vectors of geosingan the testing results of the inversion framework with two synthetic contaminant transport experiments show that 1 the integrated inversion framework is able to identify heterogeneous structures with an apparent reduction of computational time by state of the art deep learning methods 2 geosingan overcomes the dependence of traditional deep learning models on multiple training samples it was trained with a single heterogeneous aquifer structure within much less time compared to the multi sample based models the generated heterogeneous aquifer structure showed geometric features e g mean length and volume proportion and spatial correlation structures e g transition probability rate similar to those of the training sample this powerful learning and generating ability greatly enhances the efficiency of the ensemble based inversion 3 dodcn outperformed the drdcn deep learning model with similar structures for the application in our paper it obtained more accurate predictions and required less gpu memory thanks to the octave convolution layer the dense residual connections and gaussian noise docrn enabled the surrogate model based inversion framework to obtain approximation results based on the forward model but significantly improved the inversion speed 4 the integration of the geosingan and docrn networks enabled the efficient generation of realistic posterior heterogeneous structures by accounting for indirect observations the inversion framework can be further improved by integrating hydraulic head solute concentration and other types of measured data for aquifer structure inversion such as borehole geophysical data and expert knowledge to obtain reliable training samples of geosingan although our inversion framework has been tested with binary facies it can be readily extended to the inversion for multiple facies or continuous parameter structures by replacing the training sample of geosingan credit authorship contribution statement chuanjun zhan conceptualization data curation investigation visualization writing original draft zhenxue dai conceptualization methodology funding acquisition project administration writing review editing javier samper conceptualization writing review editing shangxian yin writing review editing reza ershadnia methodology writing review editing xiaoying zhang writing review editing yanwei wang writing review editing zhijie yang methodology writing review editing xiaoyan luan writing review editing mohamad reza soltanian conceptualization methodology writing review editing declaration of competing interest the authors declare the following financial interests personal relationships which may be considered as potential competing interests zhenxue dai and chuanjun zhan has patent 2021102281 licensed to zhenxue dai chuanjun zhan acknowledgements this work was funded by the national key r d program of china no 2018yfc1800904 the national natural science foundation of china nsfc 41772253 41972249 jilin university through an innovation project awarded to the corresponding author 45119031a035 jlu science and technology innovative research team jlustirt 2019td 35 and partially supported by the graduate innovation fund of jilin university awarded to the first author 101832020cx233 additional funding was provided by the project no qqhr 2016 06 of groundwater quality evaluation in central city of tsitsihar heilongjiang province china we thank the ilues and consingan developers for sharing their codes https github com cics nd cnn inversion https github com tohinz consingan the geologic data used to represent permeability map distribution can be found in http www trainingimages org the authors would finally like to thank the two anonymous reviewers and the editors for their constructive comments to improve the paper appendix a list of acronyms acronyms description singan single image generative adversarial network geosingan geological single sample generative adversarial network consingan concurrent single image generative adversarial network docrn deep octave convolution dense residual network drdcn deep residual dense convolution network ilues iterative local updating ensemble smoother gan generative adversarial network vae variational auto encoder wgan wasserstein generative adversarial network wgan gp wasserstein generative adversarial network with gradient penalty gpu graphics processing unit cpu central processing unit firstoctconv first octave convolution octconv middle octave convolution lastoctconv last octave convolution rdb residual dense block sdb simple dense block rrdb residual in residual dense block rrdrb residual in residual dense residual block octrdb octave residual dense block octrrdrb octave residual in residual dense residual block bn batch normalization appendix b list of symbols symbols description c solute concentration c k normalized concentrations at grid cell k c k non normalized concentrations at grid cell k c min minimum concentrations within the entire training sample set c max maximum concentrations within the entire training sample set c d covariance of observational error c d inflated covariance matrix c mf i cross covariance between the parameters and the simulation results in the i th iteration c ff i auto covariance of the forward model predictions in the i th iteration d diffusion coefficient tensor d sim flow field d discriminator x d x gradient of discriminator d f depth of feature map d in input channel dimensions d out output channel dimensions d z dimension of random vector d obs measurements d f simulated result of the forward model d i simulation result ensemble in the i th iteration d j i j th simulation result within the ensemble in the i th iteration e observation error vector e n i n th random sample of the observation error in the i th iteration e pre prediction errors of the surrogate model error prediction errors of between y true and y pre f complex nonlinear relationship f forward simulation g generator h height of the heterogeneous aquifer structure h hydraulic head h 0 initial hydraulic head field h n height of the generated model in stage n h height of the images j f m distance between the simulation results and the measurements j m m distance between the parameters and local ensemble sample l wgan g p wgan gp loss l rec reconstruction loss l 1 regularized l1 loss l length of the heterogeneous aquifer structure l i ϕ mean length of the i th facies in the ϕ direction l i j ϕ length of the j th continuous block for the i th facies in the ϕ direction m 0 prior ensemble of parameter samples m n i 1 the updated n th parameter sample after the i th iteration n f number of output state fields n obs number of observation data n user defined number of training stages n es number of parameter samples n iter number of iterations n i grid number of the i th facies n i θ number of continuous blocks for the i th facies in the θ direction n facies number of different facies n grid number of grid cells n mod number of heterogeneous aquifer structures p train training data distribution p gen generated data distribution p x random sample distribution p n selection probability of the n th parameter p i volume proportion of facies i p f a c i e s 2 marginal probability of facies 2 r scaling factor r 2 coefficient of determination r ij transition probability rate r i decayed learning rate in the i th epoch r 0 initial learning rate s sink source t time u pore water velocity w width of the images w width of the heterogeneous aquifer structure w n width of the generated model in stage n x min minimum resolution defined by users x true heterogeneity structure x estimated heterogeneity structure x n downsampled version of the original training model at stage n x l w h heterogeneous aquifer structure x in input feature maps x h input high frequency feature maps x l input low frequency feature maps x i heterogeneous structure ensemble in i th iteration x 1 i estimated heterogeneous structure within the ensemble in i th iteration x post posterior heterogeneous aquifer structure ensemble x 1 post posterior heterogeneous aquifer structure within the ensemble y l w h n f state field y out output feature maps y h output high frequency feature maps y l output low frequency feature maps y k simulated results by high precision forward simulations at grid k y k predicted value of docrn at grid k y surrogate model s results y toughreact simulation results y true simulated results based on the object model y pre predicted results based on the posterior model z random vector z rec reconstruction random vector α ratio of input feature channels used in low frequency feature maps β residual scale γ learning scaling parameter η multiplicative factor of learning rate decay θ vector of docrn s trainable parameters δ reconstruction loss weight λ penalty coefficient φ the regularization coefficient γ boundaries of flow field 
3310,generating reasonable heterogeneous aquifer structures is essential for understanding the physicochemical processes controlling groundwater flow and solute transport better the inversion process of aquifer structure identification is usually time consuming this study develops an integrated inversion framework which combines the geological single sample generative adversarial network geosingan the deep octave convolution dense residual network docrn and the iterative local updating ensemble smoother ilues named geosingan docrn ilues for more efficiently generating heterogeneous aquifer structures the performance of the integrated framework is illustrated by two synthetic contaminant experiments we show that geosingan can generate heterogeneous aquifer structures with geostatistical characteristics similar to those of the training sample while its training time is at least 10 times faster than that of typical approaches e g multi sample based gan the octave convolution layer and multi residual connection enable the docrn to map the heterogeneity structures to the state variable fields e g hydraulic head concentration distributions while reducing the computational cost the results show that the integrated inversion framework of geosingan and docrn can effectively and reasonably generate the heterogeneous aquifer structures keywords heterogeneous aquifer structure inversion generative adversarial network residual network deep learning 1 introduction generating realistic heterogeneous aquifer structures is crucial for accurately simulating groundwater flow and reactive solute transport in subsurface systems bianchi and zheng 2016 choi et al 2017 fiori and jankovic 2012 linde et al 2015 miller et al 2017 paniconi and putti 2015 yang et al 2014 zhang et al 2021b zhang et al 2021c typically heterogeneous aquifer structures are generated using geostatistical approaches deutsch journel 1992 dai et al 2007 straface et al 2010 that incorporate sparse field measurements e g core samples geostatistical methods in general are classified into two point and multi point methods di dato et al 2018 rubin 2003 tahmasebi 2018 the two point methods first calculate the spatial correlation of the stratigraphic facies e g indicator covariance or variogram based co kriging and then use the statistical variables to correlate the spatial distribution of facies within the heterogeneity domain deutsch journel 1992 in practice field measurements may not be sufficiently abundant to obtain a reasonable spatial correlation dai et al 2020b incorporating subjective knowledge into spatial correlation identification may be crucial to obtain reasonable heterogeneous aquifer structures carle and fogg 1996 proposed a transition probability and markov chain approach that considers the probability of transitioning from one facies to another compared to the covariance based co kriging this method can incorporate subjective attributes e g juxtapositional tendencies mean lengths volume proportions in recent years this method has been widely employed to identify heterogeneity of facies in different applications including geological co2 sequestration dai et al 2018 co2 enhanced oil recovery dai et al 2014 and delineating facies distribution of the tracer experiment field song et al 2019 the multi point method on the other hand relies on training images to generate the heterogeneous aquifer structures bai tahmasebi 2020 li et al 2016 strebelle 2021 zuo et al 2020 this method is based on extracting first the spatial distribution of the facies from the training image and then the pattern is matched with conditional data tahmasebi 2017 this method however performs poorly in representing spatial variability created by connected and conductive flow pathways particularly in non stationary formations with high heterogeneity laloy et al 2018 it is mainly because the image patterns fail to properly match the true facies distribution zhang et al 2019 importantly both two point and multi point methods rely on hard earned and costly facies type data e g core samples considering the limitations associated with geostatistical approaches proposing an inversion method combined with prior knowledge and measured hydraulic head and concentration data is often needed to obtain accurate representations of aquifer structures the inversion identification of heterogeneous aquifer structures has received extensive attention in recent years kang et al 2019 liu et al 2019 reuschen et al 2021 wang et al 2021a xiao et al 2021 xu et al 2021 zhang et al 2021a xu and gómez hernández 2018 used the ensemble kalman filter to identify the field conductivity by assimilating hydraulic head and concentration data laloy et al 2016 used a sequential geostatistical resampling algorithm namely sgr to identify the field conductivity based on multi point statistics however the process of heterogeneous aquifer structure inversion using field observations is usually high dimensional particularly in field scale in addition most inversion methods usually require performing multiple forward simulations to obtain convergent solutions which is computationally expensive chen et al 2021 dai et al 2020a dai samper 2004 to alleviate the aforementioned problems parameterization methods and surrogate models are often used for the inversion of heterogeneous aquifer structures mo et al 2020 the parameterization method uses low dimensional vectors to represent high dimensional heterogeneous aquifer structures commonly used parameterization methods include zonation harp et al 2008 level set function song et al 2019 principal component analysis pca and its variants emerick 2017 gao et al 2015 sarma chen 2009 k singular value decomposition kim et al 2018 and discrete cosine transformation jung et al 2017 in recent years the development of deep learning techniques has also yielded encouraging results especially in image processing wang et al 2021b yu et al 2020 two dimensional 2d and three dimensional 3d heterogeneous aquifer structures can be rendered as images accordingly in which deep learning techniques of image processing are applied to parametrize the heterogeneity structures azevedo et al 2020 kang et al 2021 generative adversarial network gan and variational auto encoder vae are the most popular ones canchumuni et al 2021 due to the powerful learning and generating ability of gan and vae they can generate more realistic heterogeneous aquifer structures than the traditional parameterization method canchumuni et al 2019 song et al 2021 zhang et al 2021a thus it has been widely used in the recent parameterization of heterogeneous aquifer structures using gan mosser et al 2017 reconstructed 3d heterogeneous aquifer structures at the pore scale to evaluate the variability of porous media s properties zhang et al 2019 proposed a gan based method to generate realistic 3d heterogeneous aquifer structures chan and elsheikh 2019 used wasserstein gan wgan to parametrize the channelized geologic structures together with bayesian methods to obtain the posterior structures laloy et al 2017 employed vae in the inversion of the binary heterogeneous aquifer structure canchumuni et al 2017 used vae to parametrize the binary facies model for history matching mo et al 2020 reported an adversarial autoencoder method by combining vae and gan to parameterize a non gaussian conductivity field despite their reliable performances vae and gan methods typically require many training samples representing facies distribution patterns which in reality is hard if not impossible to obtain concurrently the long training period and the instability of the training process limit the efficiency of these methods laloy et al 2018 surrogate models are computationally fast and provide similar results as high fidelity forward simulations keating et al 2016 wang et al 2021c in the inversion of heterogeneous aquifer structures surrogate models are used to find complex relationships between geologic structures and the field variables e g hydraulic heads and concentrations however these relationships are typically nonlinear because the size of both heterogeneous aquifer structure and state field e g hydraulic head field is large thus the parameters involved in the models are commonly high dimensional intensifying the technical challenges mo et al 2020 for some commonly used surrogate methods such as polynomial chaos expansion fajraoui et al 2011 jia et al 2018 kriging zhou et al 2018 and gaussian processes zhang et al 2016 it is therefore challenging to obtain the optimum results in contrast deep learning techniques due to their powerful nonlinear mapping capabilities can build surrogate models with high dimensional inputs and outputs chen et al 2018 mo et al 2019 sun 2018 used gan to build the bidirectional mappings between high dimensional permeability field and hydraulic head distribution kani and elsheikh 2019 used a residual recurrent network dr rrn to build a surrogate model representing multiphase oil and water flow in porous media in particular they found that dr rrn can provide stable and accurate approximations of high precision simulation and the computational cost is significantly reduced mo et al 2020 related the hydraulic conductivity field to the concentration and hydraulic head fields with the deep residual dense convolution network drdcn even though deep learning based surrogate models have shown inspiring results there are still some differences between the prediction results of the high fidelity and the surrogate models further the proposed models typically require a large amount of gpu memory during the training process which is a limiting factor in both traditional image processing and geoscience fields however with the rapid development of deep learning techniques in recent years some state of the art methods can alleviate these problems such as octave convolution chen et al 2019 and residual dense blocks rakotonirina rasoanaivo 2020 here we present a novel inversion framework that improves the gan based on single sample training to parameterize aquifer heterogeneity structures our proposed parameterization network is denoted as the geological single image generative adversarial network geosingan in addition a novel deep octave convolution residual network docrn is developed for the surrogate model the docrn uses octave convolution instead of the traditional convolution layer and the residual in residual dense residual block rrdrb rakotonirina rasoanaivo 2020 is used as the basic component finally geosingan and docrn modules are integrated into an iterative local updating ensemble smoother algorithm ilues zhang et al 2018 to form an integrated geosingan docrn ilues inversion framework which incorporates available observation data for identifying the heterogeneous aquifer structures for both 2d and 3d test cases section 2 presents the problem formulation of this study section 3 describes the geosingan docrn ilues inversion framework the uncertainty analysis of the unconditional simulation results of geosingan is presented in section 4 section5 presents the surrogate model performance and the inversion results section 6 discusses the advantages and limitations of the proposed inverse framework finally the conclusions are highlighted in section 7 2 problem formulation this study deals with contaminant transport in a steady state flow field the governing equation is given by bear 1979 1 c t d i v d c d i v u c s c x y t γ right 0 x y γ right c x y t γ left 0 x y γ left c x y t γ top 0 x y γ top c x y t γ bottom 0 x y γ bottom c x y 0 0 x y d s i m 2 k h 0 h x y t γ right h right x y γ right h x y t γ left h left x y γ left k h n γ top 0 k h n γ bottom 0 h x y 0 h 0 x y x y d s i m where c m l 3 is the solute concentration t t is time d l is the diffusion coefficient tensor u l t is the pore water velocity and s m l 3 t 1 is the sink source k is the hydraulic conductivity h presents the hydraulic head γ denotes the boundary and subscript is the position where the boundary is located in the 2d test case of this paper dirichlet conditions are adopted for the left and right boundaries with prescribed hydraulic heads equal to 1 l and 0 l respectively the upper and lower boundaries are impervious h 0 presents the initial hydraulic head distribution d s i m is the whole flow field the flow and solute transport equations are solved numerically using toughreact xu et al 2006 we focus on the inversion identification of the aquifer heterogenous structure using available measurements the objective function of the inversion problem is to minimize the difference between the simulated and measured hydraulic heads and concentrations here the heterogeneous aquifer structure is parameterized with a low dimensional vector therefore the inversion process is to find a series of optimal vectors used for aquifer parameterization to obtain realistic heterogeneous aquifer structures 3 integrated inversion framework the integrated inversion framework consists of three modules 1 the geosingan which converts low dimension random vectors to corresponding heterogeneous aquifer structures 2 the docrn surrogate model which improves forward simulation speed and 3 the ilues which is used for data assimilation the three components are described in detail in sections 3 1 3 3 and the workflow of this framework is presented in section 3 4 finally section 3 5 introduces some spatial statistical models for evaluating geosingan generation quality 3 1 geosingan architecture the developed geosingan architecture here is based on the concurrent single image generative adversarial network consingan hinz et al 2021 in this approach the heterogeneous aquifer structure is regarded as image data the generator can be trained with only a sample to produce realistic heterogeneity structures the dimension of the random vector in this strategy however is identical to that of the training sample thus the inversion of a field scale aquifer heterogeneity with the high dimensionality of the input vector will computationally be prohibitive to overcome these problems two vector blocks are used to map the low dimensional vector to the high dimensional one with the same shape as the object aquifer the structures are shown in fig 1 vector block 1 is used in the first stage of training and vector block 2 is used in the follow up stages see fig 2 fig 2 shows the architecture of geosingan it first learns to map a low dimensional vector to a small size heterogeneous aquifer structure fig 2 training stage 0 once completed the size of the generated model is increased via the upsampling layer to improve diversity the input vector is also added to the upscaled model through the vector block 2 the yellow blocks are shown in fig 2 this mixed model is then used as an input for the next training stage besides stage 0 a residual connection is added to connect the input model to the output of each training stage this process continues until a heterogeneous aquifer structure with the desired size is generated for the 2d case the height of the generated model in stage n is determined by hinz et al 2021 3 h n h r n 1 log n log n n 1 n 0 n 1 where h is the height of the training heterogeneous aquifer structure n is the user defined number of training stages r x min m i n h w 1 n 1 is the scaling factor x min is the minimum size of the generated model and is defined by users w is the width of the heterogeneous aquifer structure the equation to determine width resolution is similar to equation 3 by replacing h with w the discriminator architecture includes several user defined convolution blocks containing two operations convolution and activation the leakyrelu is used for both generator and discriminator as the activation function in this multi stage training process both generator and discriminator focus on global features at the low stage and finer textures at the higher stage in this study x denotes the true heterogeneity structure training sample x is the estimated heterogeneity structure obtained by the generator x g z z is the random vector selected from a specific distribution using a user defined dimension the generator and discriminator are trained consecutively with opposing targets discriminator d is trained to distinguish x from x as much as possible simultaneously the generator g learns the patterns of x and generates x to fool the discriminator into labeling x as a true heterogeneity structure at any given stage the training process is translated into the following minimization maximization loss function hinz et al 2021 4 min g n max d n l wgan gp g n d n δ l rec g n where l wgan g p g n d n is the wgan gp loss function l rec g n is the reconstruction loss and δ is the reconstruction loss weight that balances the similarity between the true and estimated models the wgan gp loss function can enhance both stability and speed of gan training gulrajani et al 2017 5 l wgan g p d n e x p train d x e x p gen d x λ e x p x x d x 2 1 2 6 l wgan g p g n e x p gen d x where p train is the training data distribution p gen denotes the generated data distribution and p x is a random sample distribution that uniformly samples along straight lines between p train and p gen λ is the penalty coefficient x d x represents the gradient of discriminator both terms of e x p train d x e x p gen d x are the wasserstein distance used to measure the space between the distributions of x and x the introduction of these terms alleviates the problem of gradient vanishing a process in which the parameter updating speed during gan training is reduced λ e x p x x d x 2 1 2 is the gradient penalty term used to ensure that the gradient of d is neither too large nor too small and further prevents explosion gradient or vanishing gradient the reconstruction loss l rec g n is used to measure the similarity between x and x the larger the value of δ the larger similarity between x and x the reconstruction loss function at a given stage is expressed by 7 l rec g n g n z rec x n where z rec is a random reconstruction vector that is randomly selected from a user defined distribution before training and remains fixed throughout the training process and x n is the downsampled version of the original training model at stage n at each stage adversarial training is completed in two consecutive steps first the parameters of g are fixed to train d three times to minimize eq 5 and subsequently g is trained three times with fixed d parameters to minimize the sum of eqs 6 and 7 after training the generator g generates a series of realistic heterogeneous aquifer structures with different random vectors 3 2 docrn for surrogate modeling a surrogate model for the forward simulation is an image to image translation process to establish a complex nonlinear relationship between the heterogeneous aquifer structure and the state field e g hydraulic head field for the 3d test case this process is given by 9 y l w h n f f x l w h where x l w h is the heterogeneous aquifer structure and y l w h n f represents the state field l w and h are the length width and height of the heterogeneous aquifer structure respectively n f represents the number of output state fields and f denotes the complex nonlinear relationship between the input and output parameters the performance of the surrogate model is improved by integrating a novel convolution structure octave convolution and a novel residual block residual in residual dense residual block rrdrb into the docrn surrogate model it should be noted that the docrn here is only designed to speed up the process of aquifer structure identification specifically to achieve rapid estimation of concentration and head data at the location of observation point based on different aquifer structures therefore the docrn only learns the highly nonlinear relationship between the aquifer structure and the state field corresponding to the moment of observation data collection during the training process 3 2 1 octave convolution the information of a natural image can be decomposed into low and high frequency information chen et al 2019 low frequency information is usually the global structure whereas more detailed information is included in the high frequency chen et al 2019 in neural network training processes some redundant low frequency information can be compressed without affecting the learning ability chen et al 2019 the traditional convolution layer is replaced with an octave convolution layer to reduce this redundancy and improve the processing of information with different frequencies the architecture of the octave convolution is shown in fig 3 the first octave convolution is used to decompose the input feature map into high and low frequency features according to 9 y h c o n v x in 10 y l c o n v a v e p o o l x in the last octave convolution however is used to recombine the high and low frequency features into the output feature map 11 y out conv x h u p s a m p l e c o n v x l the middle octave convolution operations are given by 12 y h conv x h u p s a m p l e c o n v x l 13 y l c o n v a v e p o o l x h c o n v x l where conv contains the following three operations convolution with stride 1 batch normalization and activation used to change the channel dimension of the feature map while keeping the spatial dimensions unchanged the spatial dimensions are altered by the upsampling and avepool operations where upsampling is used to expand the spatial dimension of the feature map and avepool is used to reduce it 3 2 2 octave residual in residual dense residual block rrdrb was first proposed for super resolution image generation rakotonirina rasoanaivo 2020 this approach contains three residual dense blocks rdbs which add a residual connection within every two layers blue lines in fig 4 a and enable the learning of patterns at multiple levels this multilevel residual learning increases the network capacity and ensures that the network can learn very high complex non linear relationships between the heterogeneous aquifer structure and state field mo et al 2019 concurrently the residual learning strategy alleviates the gradient vanishing problem which improves the quality of translated images generated by rdb compared to that of the simple dense block sdb approach rakotonirina and rasoanaivo 2020 to improve training stability all outputs from the rdbs are multiplied by a residual scale β we assume that β 0 2 following the values suggested by szegedy et al 2017 similar to the method of adding noise to human face generation tasks karras et al 2021 gaussian noise is multiplied by a learning scale parameter γ here γ 0 1 and is added to the scaled rdb outputs to alleviate the overfitting phenomenon of docrn the octave residual dense block octrdb is based on the aforementioned rdb which replaces the convolution layer with an octave convolution layer batch normalization bn layers are also used to improve the generalization ability of the surrogate model for octrrdrb besides replacing rdb with octrdb the first and last octave convolution layers are added to the head and tail of rrdrb fig 4 b 3 2 3 docrn based on octrrdrb octrrdrb is integrated into the docrn surrogate model docrn shown in fig 4 c adopts the same network distribution structure as that drdcn developed by mo et al 2020 this type of network structure which resembles an hourglass enables the network to learn pattern information from coarse to fine scales traditional convolution layers repeatedly learn some low frequency information which wastes a lot of computational resources while the octave convolution layer proposed here can alleviate this problem compared to residual in residual dense block rrdb additional residual connection structures and gaussian noise contribute to more accurate simulation results rakotonirina rasoanaivo 2020 zhan et al 2022 3 3 ilues for inverse modeling the purpose of heterogeneous aquifer structure inversion eq 19 is to find a series of random vectors z which can be fed into geosingan to obtain results x that are similar to the true heterogeneous aquifer structure x 14 x g e o s i n g a n z similar to mo et al 2019 and zhang et al 2018 ilues is used here for inversion in practice we can only judge whether the estimated heterogeneous aquifer structure is reasonable by comparing the borehole data and the historical responses at observation wells it is assumed that the relationship between the field measurements and the forward model output for a heterogeneous aquifer can be expressed by 15 d obs d f e where d obs are the measurements d f f g e o s i n g a n z is the simulated result of the surrogate model f e is a n obs 1 observation error vector with a mean of zero and a covariance of c d e e e t the ilues process includes two main steps first of all a prior ensemble z 0 of the n es initial parameter samples is generated 16 m 0 m 1 0 m 2 0 m n es 0 then the parameter samples within the prior ensemble are updated via eq 17 by incorporating the measurements emerick and reynolds 2013 17 m n i 1 m n i c mf i c ff i c d 1 d obs n iter e n i f g m n i where m n i 1 denotes the updated n th parameter sample after the i th iteration c d n iter c d is the inflated covariance matrix e n i c d 1 2 r n obs r n obs n 0 i n f is the n th random sample of the observation error c mf i is the cross covariance between the parameters and the simulation results in the i th iteration and c ff i is the auto covariance of the forward model predictions in the i th iteration the expressions of c mf i and c ff i are given by 18 c mf i 1 n es 1 n 1 n es m n i m i d n f i d f i t 19 c ff i 1 n es 1 n 1 n es d n f i d f i d n f l d f i t where t denotes the transpose and d n f i f g m n i is the surrogate model predictions ilues adopts a local updating scheme to avoid problems resulting from the prior or posterior distribution of unknown parameters the local ensemble of the parameter sample is identified by using the following distance metric 20 j m j f m j f max j m m j m max where j f m d f d obs c d 1 d f d obs represents the distance between the simulation results and the measurements j m m m m n i c mm 1 m m n i measures the distance between the parameters and the local ensemble sample m n i n 1 2 n es and j f max and j m max are the maximum values of j f m and j m m respectively based on the values of j a roulette wheel selection operator is used to select the local ensemble of parameters lipowski lipowska 2012 the selection probability of the n th parameter is determined by p n ν i j 1 n es ν j i 1 2 n es where ν i 1 j m i more can be found in zhang et al 2018 and mo et al 2019 3 4 the integrated geosingan docrn ilues inversion framework the geosingan model and docrn surrogate model are integrated with the ilues inverse module in this geosingan docrn ilues inversion framework the major steps are as follows 1 training the generator of geosingan g and the docrn surrogate model f based on the training samples 2 generating the initial ensemble of random vectors m 0 m 1 0 m 2 0 m n es 0 from the user defined distribution 3 obtaining the heterogeneous aquifer structure ensemble x i x 1 i x 2 i x n es i by x j i g m j i 4 running the surrogate model to obtain the simulation result ensemble d i d 1 i d 2 i d n es i from d j i f x j i 5 updating the ensemble of random vectors by assimilating field measurements with ilues 6 repeating steps 3 5 with the updated random vector ensemble m i 1 m 1 i 1 m 2 i 1 m n es i 1 until the prescribed maximum number of iterations is reached 7 obtaining the posterior heterogeneous aquifer structure ensemble x post x 1 post x 2 post x n es post from x i post g m i post 3 5 spatial statistical model for assessing generation quality some statistical characteristics are used to evaluate the quality of the heterogeneous aquifer structures generated by geosingan the statistical characteristics mainly focus on evaluating facies geometry and the spatial correlation structure of the facies the following three properties are evaluated 1 the volume proportion of each facies p i which is calculated from the proportion of the grid number of the i th facies n i and the total grid number 21 p i n i j n facies n j where n facies is the number of different facies 2 the mean length of the i th facies in the ϕ direction l i ϕ which is obtained by counting each continuous facies block s length in different directions according to 22 l i ϕ j n i ϕ l i j ϕ n i ϕ where l i j ϕ is the length of j th continuous block for the i th facies in the ϕ direction and n i ϕ is the number of continuous blocks for the i th facies in the ϕ direction 3 transition rate r ij ϕ which is used to measure the spatial correlation of the facies the transition rate can be calculated in terms of the facies volume proportion and mean length as follows dai et al 2019 23 r ij ϕ p i l i ϕ 1 p j the transition rate ranges from 0 to 1 it denotes the probability of change per unit length from facies i to j in the direction ϕ and can be used to describe the spatial correlation structure of facies distribution carle fogg 1997 ritzi et al 2004 4 uncertainty analysis of unconditional simulation results uncertainty analysis is performed here on the statistical characteristics of geosingan s unconditional simulation results to evaluate whether the geosingan can generate high quality geostatistical realizations in the unconditional simulation geosingan does not consider any soft and hard data constraints however it should be noted that geosingan can consider hard data through loss function eq 4 and assimilate soft data through ilues to realize conditional simulation 4 1 2d test case the 2d test case considered a 100 80 binary training model generated by cropping randomly the 340 200 80 heterogeneous aquifer structure representing the hydrofacies of an alluvial aquifer in the maules creek valley australia fig 5 the aquifer contains two facies with contrasting permeabilities equal to 10 10 l2 for facies 1 and 10 12 l2 for facies 2 the random vector in the geosingan is generated from a standard normal distribution in which the dimension is set 100 the training stage n of the geosingan is set to 5 see fig 2 the reconstruction loss weight is 10 and the learning rates of the generator and discriminator are equal to 0 0001 and 0 00005 respectively the geosingan was trained for 1000 epochs based on a single training model fig 6 a the training process took 220 s on an nvidia geforce gtx 3070 gpu whereas generating a 100 80 realization using the trained network takes less than 0 1 s on an intel i9 10850 k cpu the reconstructed results and some randomly selected heterogeneous aquifer structures are shown in fig 6 b e 10 000 heterogeneous aquifer structures were generated to calculate frequency distributions of volume proportion of each facies mean length in x and y directions and transition rate figs 7 9 in the meantime the statistics of the training model the sample used to train geosingan see fig 6 a and the object model the true model that we want to identify see fig 18 d are also calculated and marked with arrows in figs 7 9 all statistical features of the training model are within the distribution range which indicates that the trained geosingan successfully recovers the facies distribution of the training model and unconditional simulation results have similar patterns of the training model therefore the geosingan can be used as the parameterization method in the developed inversion framework 4 2 3d test case by cropping randomly the 340 200 80 heterogeneous aquifer structure shown in fig 5 we generate a 40 30 20 binary training model for the 3d test case fig 10 a the random vector s dimension is identical to that of the 2d test case and follows a standard normal distribution for the 3d test case the training stage n see fig 2 is set to 3 the reconstruction loss weight is 10 and the learning rates of the generator and discriminator are equal to 0 0005 and 0 00005 respectively the geosingan is trained for 1500 epochs the training time is 600 s on the used gpu and the single model generation takes 0 2 s using the aforementioned cpu fig 10 b f shows the reconstructed model and some randomly selected realizations the structure of the training model is reconstructed well and realistic heterogeneous aquifer structures are obtained the frequency distributions of the volume proportion of the two facies the mean length and the transition rates along the x y and z directions are also calculated from 10 000 3d realizations figs 11 13 show that the statistical characteristics of the geosingan generated model are within a certain range around those of the training samples therefore the geosingan can generate high quality geostatistical realizations 5 inversion framework evaluation 5 1 surrogate model training results 5 1 1 2d surrogate model for the inversion of the 2d test case we consider a hypothetical scenario in which a contaminant source is released under a steady state flow condition the size of the domain is 100 l 80 l which is uniformly discretized into 8000 grids of a unit grid size dirichlet conditions were adopted for the left and right boundaries with prescribed hydraulic heads equal to 1 l and 0 l respectively the upper and lower boundaries are impervious the initial concentration of the tracer is 0 and the inflow of water in the boundary does not contain the tracer as shown in fig 14 a there is a 3 l 7 l contaminated area yellow near the left boundary this area continuously releases tracer at a rate of 0 1 m l 3 t 1 a total of 80 monitoring wells green blocks in fig 14 a are evenly distributed within the aquifer domain the data are collected at seven different times concentrations 0 5 1 2 3 4 6 and 12 t while the hydraulic head data is only obtained at the final time 12 t the permeability values of two facies within the domain are 1 10 10 l2 and 1 10 12 l2 the porosity is 0 3 the change of pore structure is not considered during the simulation and the temperature and ph were 25 c and 7 respectively the diffusion coefficient is 3 10 9 l2 t and the adsorption of the tracer by the aquifer medium is not considered during transport the heterogeneous aquifer structures generated by the trained geosingan are incorporated into toughreact to simulate this hypothetical scenario for the 2d case 10 000 heterogeneous aquifer structures and corresponding state fields are generated to train docrn to improve the training efficiency the distribution of concentration fields is normalized using the following equation 24 c k c k c min c max c min where c k and c k are the normalized and non normalized concentrations at grid cell k respectively and c min and c max are respectively the minimum and maximum concentrations within the entire domain and all training samples the batch size of the training process is 128 and an adam optimizer is used kingma ba 2014 80 of the samples 80 of the geosingan generated aquifer structures and their corresponding concentration and distribution fields are used for training and the remaining 20 is used for the validation process to prevent overfitting in the later training stage the following exponential function was adopted to implement a learning rate decay strategy 25 r i r 0 η i where r 0 0 0005 is the initial learning rate r i is the updated learning rate in the i th epoch and η which set 0 99 is the multiplicative factor of learning rate decay the following regularized l1 loss function is used in docrn training 26 l 1 1 n grid k 1 n grid y k y k 1 φ 2 θ t θ where n grid is the number of grid cells y k is the simulated results by high precision forward simulations at grid k y k is the predicted value of docrn θ denotes the vector of docrn s trainable parameters and φ 1 10 5 is the regularization coefficient the root mean square error rmse and the coefficient of determination r 2 are also calculated to evaluate the accuracy of the surrogate model with the following equation 27 rmse 1 n grid k 1 n grid y k y k 2 2 28 r 2 i 1 n grid y i 1 n grid k 1 n grid y k 2 i 1 n grid y i 1 n grid k 1 n grid y k 2 the docrn training is conducted on an nvidia tesla v100s gpu for 500 epochs to evaluate the quality of the docrn predictions the drdcn developed by mo et al 2020 is also trained with the same super parameters setting on the same gpu the l1 loss rmse of the validation set and the occupied gpu memory are compared between docrn and drdcn table 1 all three evaluation indexes are lower for docrn in particular l1 and rmse of docrn are reduced 20 and the gpu memory cost is decreased by 11 favoring the docrn s performance over drdcn the training period for the docrn is 5 h whereas the trained network can generate the concentration and hydraulic head distribution fields in less than 0 2 s the calculated coefficients of determination r2 in 2d test cases are all greater than 0 99 see fig 16 a and b there are only some outliers at the edges of the contamination plume see fig 15 therefore the docrn can provide reasonable estimates of concentration and temperature fields the prediction of the head is more accurate than that of the concentration which indicates that the head distribution is less sensitive to the heterogeneity of the aquifer structure than the concentration field kitanidis 2015 5 1 2 3d surrogate model the aquifer domain of the 3d test case is 40 l 30 l 20 l and is uniformly discretized into 24 000 1 l 1 l grid cells the hydraulic heads were prescribed to 1 l and 0 l at right and left boundaries impervious conditions are assigned to other boundaries the initial and boundary conditions of solute transport are the same as those of the 2d test case fig 14 b shows the locations of the contaminant source the yellow zone near the right hand boundary and the observation points shown by green grid blocks the 3 l 3 l 2 l contaminated area has a continuous release rate of tracer 0 05 m l 3 t 1 48 monitoring wells shown by light green grid blocks collect field observations at 4 different depths the collected data type monitoring frequency facies permeabilities and solute transport parameters are the same as the 2d test case 5000 samples are generated for docrn training in the 3d test case concentration data were normalized according to eq 24 all super parameters e g the learning rate and the regularization coefficient are the same as the 2d case the save for the batch size is 64 the l1 loss rmse of the validation set and the gpu memory use of docrn and drdcn are listed in table 2 comparatively the l1 and rmse values for docrn are 10 smaller and the gpu memory cost is 22 smaller than those of drdcn thus it can be concluded that the docrn outperforms the drcrn in the 3d test case due to the high dimension of 3d models the docrn training process takes nearly 15 h however similar to the 2d case the trained network can generate the concentration and hydraulic head fields in less than 0 2 s in the 3d case randomly selected results of the validation set are shown in fig 17 and the calculated coefficients of determination r2 are also greater than 0 99 see fig 16 c and d assuring that the docrn can handle the solute transport simulation effectively in the 3d test case 5 2 inversion results after training the docrn the ilues is used to identify the heterogeneous aquifer structure the concentration data at seven different times and the hydraulic head data at the final time are collected at the observation points fig 14 the observation points were 80 in the 2d test case while 192 points were set in the 3d test case thus 80 8 640 and 192 8 1536 observation data were respectively used for the inversion of 2d and 3d heterogeneous aquifer structures to increase the inversion challenge no hard data e g borehole data is used however it should be noted that the geosingan can add a reconstruction loss term in a form similar to l rec see eq 7 to the total loss function eq 4 for hard data to achieve conditional simulation based on borehole data we also add a 5 observation error to each observation data the object model fig 18 d is generated by feeding a randomly selected 100 dimensional random vector z from the standard normal distribution n 0 1 into the geosingan the statistics of the geometric features and the spatial correlation structure of the object model were calculated see the arrow marks in figs 7 9 2d and figs 11 13 3d the statistics difference between the object and the training heterogeneous aquifer structure is readily apparent increasing the challenge of inversion the large ensemble size and iteration number enable the ilues to obtain relatively good results zhang et al 2018 while increasing the computational cost to balance the inversion accuracy and computational cost the ensemble size n e 3000 and the iteration number n iter 30 are used in both the 2d and 3d test cases the local ensemble factor α is 0 1 therefore both 2d and 3d test case inversions required 30 3000 90 000 solute transport simulations even though many simulations need to be run the inversion time can be significantly reduced using the docrn surrogate model the inversion time in the 2d and 3d heterogeneous aquifer structures are 2 4 h and 6 h respectively the facies probability map of facies 2 and the accuracy are used to evaluate the quality of the inversion results the accuracy is equal to the percentage of grid is assigned to the correct facies with respect to the object model the marginal probability of facies 2 is calculated by 29 p f a c i e s 2 x pr i 2 x 1 1 n mod i 1 n mod i 2 i x where i 2 x 1 if facies 2 occurs at location x and i 2 x 0 otherwise the n mod is the number of heterogeneous aquifer structures the comparison results are shown in fig 18 2d and 19 3d both 2d and 3d posterior models 2d fig 18 f 3d fig 19 f capture the underlying structure of the object model and there are only some minor differences in local features over 90 of the estimated facies grid is correct according to the object model in 2d and 3d test cases the accuracy of posterior models is much higher than that of prior ones moreover the facies probability maps also indicate that the uncertainty of posterior models can be significantly reduced by our developed inversion framework the prior model presented here figs 18 e and 20 e is heterogeneous it is because that geosingan will learn the facies volume proportion and distribution patterns of the training model during the training process thus making its generated model inherently heterogeneous even without considering the observed data furthermore we compared the predicted concentration and hydraulic head distribution fields under the same conditions based on the object and posterior models the results are shown in figs 20 2d and 21 3d although the posterior model is slightly different from the object model the contaminant plume and hydraulic head field predicted based on them are very close which indicates that the heterogeneous aquifer structure obtained by our inversion framework can honor the available observations therefore even though the hard data are absent the geosingan docrn ilues framework can still obtain accurate and realistic posterior heterogeneous aquifer structures considering the observation errors 6 discussion the results show that all modules of the geosingan docrn ilues inversion framework work effectively compared to the multi sampled based neural network chan elsheikh 2019 laloy et al 2018 liu et al 2019 the proposed geosingan has significantly increased the training efficiency for example the training of the geosingan for a 3d heterogeneous aquifer structure containing 24 000 grid cells is less than 10 min whereas for a multi sample based neural network it may take several hours laloy et al 2018 mo et al 2020 based on a single training model geosingan can generate a series of heterogeneous aquifer structures with geometric features and spatial correlation structures similar to those of the training model the accuracy of the docrn surrogate model is improved by integrating the octave convolution layer and rrdrb compared with the drdcn model which has similar network structures with docrn the octave convolution layer reduces the occupied gpu memory used by docrn during the training process enabling the inversion of field size heterogeneous aquifer structures with limited gpu memory it also permits an increase in the batch size the number of samples that the model learns at a time used in the training process improving training efficiency furthermore the additional residual connection structure helped the docrn provide more accurate predictions with a negligible increase in the network complexity in rakotonirina rasoanaivo 2020 the addition of gaussian noise does not always improve the performance of the simulation results however in our experiments the addition of gaussian noise can alleviate the overfitting phenomenon of docrn there are some limitations and future considerations to the proposed inversion framework that merit attention first compared to the multi sample based deep learning model the geosingan only requires a single sample in practice choosing a reasonable training sample still needs to be carefully considered since geosingan only learns the facies distribution patterns from a selected training sample according to the unconditional simulation results in section 4 the training sample should have similar statistical characteristics as the object model the sample can be obtained by the geostatistical inversion method zhan et al 2022 for example harp et al 2007 presented a transition probability based inversion method to identify the aquifer structure and the estimated structure has similar statistical characteristics with the true structure but the estimated structures are still uncertain due to the stochastic nature the combination of the geosingan docrn ilues framework and the geostatistical inversion method may have significant practical potential to identify heterogeneous aquifer structures the geostatistical inversion method can provide a reliable training model of geosingan then the developed framework of our study can further reduce the uncertainty of the aquifer structures zhan et al 2022 indeed for cases with large differences between the object model and the training model a lower reconstruction loss weight δ in the loss function of geosingan is suggested in practical applications multiple δ values can be tested during the inversion framework second in this paper we focus on the uncertainties of aquifer heterogeneous structure without considering the uncertainties of model parameters such as the parameters of flow and solute transport source sink terms etc however these uncertainties always exist in practical applications which may lead to difficulties in reproducing the real observations in forward simulations thus making the identified aquifer structure deviate from the real one in future studies simultaneous identification of aquifer structure and model parameters may be a more reasonable option and the developed framework can still achieve this object with a feasible extension in this case ilues needs to identify low dimensional random vectors as well as model parameters simultaneously the generation of docrn s training samples also needs to consider different model parameters simultaneously and not only the differences in aquifer structure the corresponding docrn input contains both the aquifer structure and the model parameters in this way the developed framework can consider the uncertainties of multiple factors while using the available observations to obtain reasonable aquifer structures and model parameters mo et al 2019 wang et al 2021c third the local features of the heterogeneous aquifer structures are not perfectly identified using the integrated inversion framework employed here potentially due to 1 the low dimensionality of the random vector which makes each element in the random vector controls a large region of the generated heterogeneous aquifer structure making it difficult to adjust some detail of the structure 2 the slight differences between the results of docrn and forward models 3 the field measurements error and the aquifer structure s high heterogeneity which can cause differences between the posterior and the object models under this condition the bayesian inversion method can be a better option to obtain a more accurate posterior distribution of parameters through a large number of parameter samples and can consider observation error and the deviations associated with the surrogate model laloy et al 2018 zhu zabaras 2018 however the bayesian method requires a large number of forward simulations to achieve converged solutions zhang et al 2018 mo et al 2019 fourth in the data assimilation based aquifer structure identification framework such as the one developed in this paper it is also worthwhile to carefully consider how to set up monitoring wells reasonably because it is the amount of assimilated data that affects the identification results therefore for the developed framework the accuracy of aquifer structure estimation can be better improved by placing monitoring wells within the potential distribution range of the solute plume where the solute concentration can be monitored as much as possible based on the prior information to obtain more effective monitoring data rather than simply setting smaller well spacing in practical applications besides heterogeneous aquifer structure inversion the proposed geosingan can provide an efficient way to quantify the uncertainty of aquifer heterogeneity due to its high generation speed the docrn or octrrdrb proposed here can also be used in other environmental fields including contaminant source identification monitoring network optimization and other applications which require many solute transport simulations the octave convolution layer can help deep learning models better apply to geoscience applications with high dimensional parameters introducing this layer can effectively reduce the computational costs so that some more complex deep learning models can be implemented in the inversion problem discussed here the deep learning model can be used to directly determine the relationship between the observations and the random vectors of input geosingan chen et al 2021 wang et al 2021a the corresponding random noise can be obtained by inputting the observations into the trained deep learning model then heterogeneous aquifer structure can be obtained by inputting the random noise into geosingan this approach is particularly promising when there is adequate training data and the ability of the deep learning model to identify a highly nonlinear relationship is sufficiently strong in this context it would be unnecessary to use computationally demanding inversion methods such as ensemble smoother and the bayesian inversion 7 conclusions a novel integrated inversion framework is developed here to identify complex heterogeneity structures the framework combines the geological single image generative adversarial network geosingan for conducting heterogeneous parameterization the deep octave convolution dense residual network docrn for surrogate modeling and the local update iterative ensemble smoother iluse for estimating optimal input vectors of geosingan the testing results of the inversion framework with two synthetic contaminant transport experiments show that 1 the integrated inversion framework is able to identify heterogeneous structures with an apparent reduction of computational time by state of the art deep learning methods 2 geosingan overcomes the dependence of traditional deep learning models on multiple training samples it was trained with a single heterogeneous aquifer structure within much less time compared to the multi sample based models the generated heterogeneous aquifer structure showed geometric features e g mean length and volume proportion and spatial correlation structures e g transition probability rate similar to those of the training sample this powerful learning and generating ability greatly enhances the efficiency of the ensemble based inversion 3 dodcn outperformed the drdcn deep learning model with similar structures for the application in our paper it obtained more accurate predictions and required less gpu memory thanks to the octave convolution layer the dense residual connections and gaussian noise docrn enabled the surrogate model based inversion framework to obtain approximation results based on the forward model but significantly improved the inversion speed 4 the integration of the geosingan and docrn networks enabled the efficient generation of realistic posterior heterogeneous structures by accounting for indirect observations the inversion framework can be further improved by integrating hydraulic head solute concentration and other types of measured data for aquifer structure inversion such as borehole geophysical data and expert knowledge to obtain reliable training samples of geosingan although our inversion framework has been tested with binary facies it can be readily extended to the inversion for multiple facies or continuous parameter structures by replacing the training sample of geosingan credit authorship contribution statement chuanjun zhan conceptualization data curation investigation visualization writing original draft zhenxue dai conceptualization methodology funding acquisition project administration writing review editing javier samper conceptualization writing review editing shangxian yin writing review editing reza ershadnia methodology writing review editing xiaoying zhang writing review editing yanwei wang writing review editing zhijie yang methodology writing review editing xiaoyan luan writing review editing mohamad reza soltanian conceptualization methodology writing review editing declaration of competing interest the authors declare the following financial interests personal relationships which may be considered as potential competing interests zhenxue dai and chuanjun zhan has patent 2021102281 licensed to zhenxue dai chuanjun zhan acknowledgements this work was funded by the national key r d program of china no 2018yfc1800904 the national natural science foundation of china nsfc 41772253 41972249 jilin university through an innovation project awarded to the corresponding author 45119031a035 jlu science and technology innovative research team jlustirt 2019td 35 and partially supported by the graduate innovation fund of jilin university awarded to the first author 101832020cx233 additional funding was provided by the project no qqhr 2016 06 of groundwater quality evaluation in central city of tsitsihar heilongjiang province china we thank the ilues and consingan developers for sharing their codes https github com cics nd cnn inversion https github com tohinz consingan the geologic data used to represent permeability map distribution can be found in http www trainingimages org the authors would finally like to thank the two anonymous reviewers and the editors for their constructive comments to improve the paper appendix a list of acronyms acronyms description singan single image generative adversarial network geosingan geological single sample generative adversarial network consingan concurrent single image generative adversarial network docrn deep octave convolution dense residual network drdcn deep residual dense convolution network ilues iterative local updating ensemble smoother gan generative adversarial network vae variational auto encoder wgan wasserstein generative adversarial network wgan gp wasserstein generative adversarial network with gradient penalty gpu graphics processing unit cpu central processing unit firstoctconv first octave convolution octconv middle octave convolution lastoctconv last octave convolution rdb residual dense block sdb simple dense block rrdb residual in residual dense block rrdrb residual in residual dense residual block octrdb octave residual dense block octrrdrb octave residual in residual dense residual block bn batch normalization appendix b list of symbols symbols description c solute concentration c k normalized concentrations at grid cell k c k non normalized concentrations at grid cell k c min minimum concentrations within the entire training sample set c max maximum concentrations within the entire training sample set c d covariance of observational error c d inflated covariance matrix c mf i cross covariance between the parameters and the simulation results in the i th iteration c ff i auto covariance of the forward model predictions in the i th iteration d diffusion coefficient tensor d sim flow field d discriminator x d x gradient of discriminator d f depth of feature map d in input channel dimensions d out output channel dimensions d z dimension of random vector d obs measurements d f simulated result of the forward model d i simulation result ensemble in the i th iteration d j i j th simulation result within the ensemble in the i th iteration e observation error vector e n i n th random sample of the observation error in the i th iteration e pre prediction errors of the surrogate model error prediction errors of between y true and y pre f complex nonlinear relationship f forward simulation g generator h height of the heterogeneous aquifer structure h hydraulic head h 0 initial hydraulic head field h n height of the generated model in stage n h height of the images j f m distance between the simulation results and the measurements j m m distance between the parameters and local ensemble sample l wgan g p wgan gp loss l rec reconstruction loss l 1 regularized l1 loss l length of the heterogeneous aquifer structure l i ϕ mean length of the i th facies in the ϕ direction l i j ϕ length of the j th continuous block for the i th facies in the ϕ direction m 0 prior ensemble of parameter samples m n i 1 the updated n th parameter sample after the i th iteration n f number of output state fields n obs number of observation data n user defined number of training stages n es number of parameter samples n iter number of iterations n i grid number of the i th facies n i θ number of continuous blocks for the i th facies in the θ direction n facies number of different facies n grid number of grid cells n mod number of heterogeneous aquifer structures p train training data distribution p gen generated data distribution p x random sample distribution p n selection probability of the n th parameter p i volume proportion of facies i p f a c i e s 2 marginal probability of facies 2 r scaling factor r 2 coefficient of determination r ij transition probability rate r i decayed learning rate in the i th epoch r 0 initial learning rate s sink source t time u pore water velocity w width of the images w width of the heterogeneous aquifer structure w n width of the generated model in stage n x min minimum resolution defined by users x true heterogeneity structure x estimated heterogeneity structure x n downsampled version of the original training model at stage n x l w h heterogeneous aquifer structure x in input feature maps x h input high frequency feature maps x l input low frequency feature maps x i heterogeneous structure ensemble in i th iteration x 1 i estimated heterogeneous structure within the ensemble in i th iteration x post posterior heterogeneous aquifer structure ensemble x 1 post posterior heterogeneous aquifer structure within the ensemble y l w h n f state field y out output feature maps y h output high frequency feature maps y l output low frequency feature maps y k simulated results by high precision forward simulations at grid k y k predicted value of docrn at grid k y surrogate model s results y toughreact simulation results y true simulated results based on the object model y pre predicted results based on the posterior model z random vector z rec reconstruction random vector α ratio of input feature channels used in low frequency feature maps β residual scale γ learning scaling parameter η multiplicative factor of learning rate decay θ vector of docrn s trainable parameters δ reconstruction loss weight λ penalty coefficient φ the regularization coefficient γ boundaries of flow field 
3311,continuous hydrologic modelling for small and ungauged basins a comparison of eight rainfall models for sub daily runoff simulations salvatore grimaldi conceptualization funding acquisition supervision writing original draft writing review editing a elena volpi conceptualization funding acquisition visualization writing original draft writing review editing b andreas langousis conceptualization methodology writing review editing c simon michael papalexiou conceptualization methodology writing review editing d e davide luciano de luca methodology writing review editing f rodolfo piscopia methodology g sofia d nerantzaki methodology writing review editing a e h georgia papacharalampous methodology writing review editing b andrea petroselli methodology writing review editing i a dibaf department tuscia university viterbo italy dibaf department tuscia university viterbo italy dibaf department tuscia university viterbo italy b department of engineering roma tre university rome italy department of engineering roma tre university rome italy department of engineering roma tre university rome italy c department of civil engineering school of engineering university of patras greece department of civil engineering school of engineering university of patras greece department of civil engineering school of engineering university of patras greece d department of civil engineering university of calgary canada department of civil engineering university of calgary canada department of civil engineering university of calgary canada e global institute for water security university of saskatchewan canada global institute for water security university of saskatchewan canada global institute for water security university of saskatchewan canada f department of informatics modelling electronics and system engineering university of calabria arcavacata di rende italy department of informatics modelling electronics and system engineering university of calabria arcavacata di rende italy department of informatics modelling electronics and system engineering university of calabria arcavacata di rende italy g freelance rome italy freelance rome italy freelance rome italy h department of civil geological and environmental engineering university of saskatchewan canada department of civil geological and environmental engineering university of saskatchewan canada department of civil geological and environmental engineering university of saskatchewan canada i deim department tuscia university 01100 viterbo italy deim department tuscia university 01100 viterbo italy deim department tuscia university 01100 viterbo italy corresponding author continuous hydrologic modelling is a natural evolution of the event based design approach in modern hydrology it improves the rainfall runoff transformation and provides the practitioner with more effective hydrological output information for risk assessment however this approach is still not widely adopted mainly because the choice of the most appropriate rainfall simulation model which is the core of continuous frameworks for the specific aim of risk analysis has not been sufficiently investigated in this paper we test eight rainfall models by evaluating the performances of the simulated rainfall time series when used as input for a simplified continuous rainfall runoff model the cosmo4sub which is particularly designed for small and ungauged basins the comparison confirms the capability of all models to provide realistic flood events and allows identifying the models to be further improved and tailored for data scarce hydrological risk applications the suggested framework is transferable to any catchment while different hydrologic and rainfall models can be used keywords continuous hydrologic modelling risk assessment small and ungauged basins rainfall models rainfall simulations 1 introduction the benefit of continuous modelling in hydrological studies is widely recognized pathiraja et al 2012 blazkova et al 2017 such an approach is particularly promising for estimating the design hydrological input for a variety of practical applications blazkova beven 2002 boughton droop 2003 the added value of this approach is to provide a large sample of synthetic scenarios tailored for risk and hazard statistical analyses and to better reproduce the design flood volumes grimaldi et al 2012a winter et al 2019 thus there is a tendency to overcome the concept of design hydrograph in favor of the design runoff simulation lamb et al 2016 grimaldi et al 2021 it is well known that the event based approach represented by the classical design hydrograph is based on several steps or modules viglione blöschl 2009 castiglioni et al 2010 sene 2012 blöschl et al 2013 haberlandt radtke 2014 grimaldi petroselli 2015 a derivation of intensity duration frequency idf curves from rainfall data b use of the idf curves from a to estimate the critical rainfall height for a selected return period t of interest and duration d equal to the concentration time of the basin c temporal disaggregation of the critical rainfall height assuming a specific design hyetograph and d rainfall runoff transformation the result is a single hydrograph related to the selected return period which is assumed to be the same as the design hyetograph however all these steps present relevant assumptions hence continuous modelling has been recently developed with the aim to mitigate the major drawbacks of the event based approach biondi de luca 2015 grimaldi et al 2012a specifically the basic concept of the continuous framework relies on avoiding the first two steps of the event based approach boughton droop 2003 grimaldi et al 2012b winter et al 2019 beneyto et al 2020 this is accomplished by using long synthetic rainfall time series as input in a rainfall runoff model which is implemented using a continuous scheme the result is a long runoff time series from which it is possible to select the desired information for the specific design problem while there are several clear and appealing advantages the continuous procedure is still not widely used the main skepticism of practitioners and researchers regards the use of rainfall simulation models also known in the literature as weather generators see e g the review in langousis kaleris 2014 that presently can be considered as the bottleneck of the procedure there are two main challenges the first one is the availability of many rainfall models without a clear suggestion on which is the most appropriate one to use in such a framework the second one is that most rainfall models are not user friendly and need a substantial theoretical background to successfully be applied yet there are efforts simplifying the application of rainfall models that can facilitate the continuous framework development either by offering regionalized parameters for specific models e g kim et al 2017 or by the development of easily applicable packages e g cosmos r in order to contribute for establishing this modern approach and to mitigate the aforementioned challenges we investigate here several rainfall generation models aiming to identify suitable candidates to use as input for a simplified continuous design framework recently it was underlined the possibility and the opportunity to apply the continuous framework also in the challenging case of small and ungauged basins blazkova beven 2002 boughton droop 2003 grimaldi et al 2012b using a simple rainfall runoff model structure necessarily calibration free it is possible to significantly improve the common techniques applied in such crucial watersheds i e the rational method in this context the aim in this paper is to identify the best rainfall simulator to be included in a specific rainfall runoff continuous model named cosmo4sub continuous simulation model for small and ungauged basin grimaldi et al 2012b 2021 designed to analyze small and ungauged watersheds the present paper focuses on evaluating the performance of eight rainfall models applied assuming the best calibration condition without any constraint due to the paucity of calibration data in future developments of our research we will focus on more challenging data scarce conditions the rainfall models selected here are two versions of the complete stochastic modelling solution cosmos 1 s and 2s abbreviated here as cs1 and cs2 see section 2 1 three versions of bootstrap based models abbreviated as bgamdcb cscb and mcgamdcb see section 2 2 the classical bartlett lewis bl and neymann scott ns rectangular pulses models see section 2 3 a mixed method based on monthly simulation and multifractal cascade disaggregation named here mrc see section 2 4 these eight models are evaluated by directly comparing the obtained results from the cosmo4sub model i e by investigating the capability to simulate appropriate runoff time series and flood statistical properties as a benchmark we use synthetic runoff time series generated by cosmo4sub using an illustrative watershed forced by the rainfall observations at uccle brussels belgium which is a 105 year long time series at 10 min resolution the paper is organized as follows section 2 describes the rainfall simulation models theoretical backgrounds and section 3 briefly illustrates the cosmo4sub framework section 4 provides details on the illustrative example and section 5 regards the comparison and the main results discussion is provided in section 6 together with some future research comments 2 the eight rainfall simulation models 2 1 complete stochastic modelling solution cosmos models cs1 and cs2 cosmos complete stochastic modelling solution is a generic modelling scheme that allows for time series or random fields generation which preserve desired linear correlation structures and marginal distributions specifically cosmos allows for univariate and multivariate simulation with discrete continuous or mixed type marginals papalexiou 2018 multiscale simulation through disaggregation dipmac papalexiou et al 2018 random fields generation with desired spatiotemporal correlation structures papalexiou serinaldi 2020 and recently advanced space time modeling with locally varying velocities and anisotropies papalexiou et al 2021a the methods are implemented in the freely available cosmos r package papalexiou et al 2021b precipitation modelling of cosmos 1 s relies on i using a mixed type marginal 1 f x x 1 p 0 f x x 0 x p 0 x 0 to describe the observed probability of zero precipitation with p 0 and the nonzero precipitation with any suitable continuous distribution f x x 0 x with x the rainfall intensity and ii a parsimonious parametric autocorrelation structure acs in order to reproduce the observed autocorrelation of the intermittent process up to any desirable lag typically up to the lag that correlation approximates zero here the weibull correlation structure will be used given by 2 ρ w τ b c e x p τ b c where τ is the lag time and b 0 and 0 c 2 are parameters the scheme s core avoiding the technical details please see the aforementioned references is based on generating gaussian time series with an acs that must be specified the gaussian acs depends on the desired mixed type marginal distribution and the acs of the observed precipitation and it is estimated by using a correlation transformation function the gaussian time series generated using autoregressive ar models of large order are transformed to precipitation by using the mixed type quantile function two variations of the cosmos model are applied here the first cosmos 1s cs1 uses the generalized gamma distribution with probability density function pdf given by 3 f g g x β γ 1 γ 2 γ 2 β γ γ 1 γ 2 x β γ 1 1 e x p x β γ 2 to describe nonzero precipitation at each month β is a scale parameter γ 1 and γ 2 are shape parameters and γ denotes the gamma function abramowitz stegun 1970 in this study the distribution is fitted to preserve the mean and standard deviation while the tail parameter is estimated by minimizing the square error of the empirical tail defined here as the 10 of the largest values so for each month of the year the cs1 model reproduces the observed probability of zero precipitation the observed fitted generalized gamma distribution to nonzero precipitation and the observed weibull acs fitted by minimizing the square error at the desired sub daily resolution in our application 20 min the second variation cosmos 2s cs2 papalexiou 2022 uses a new distribution to describe the nonzero precipitation that is the generalized exponential of type i with distribution function given by 4 f g e 1 x β γ 1 γ 2 1 e x p 1 γ 2 x β γ 1 1 1 γ 2 where β is a scale parameter while γ 1 and γ 2 are shape parameters the difference compared with cs1 is that cs2 reproduces explicitly the acs of the wet dry binary process and the acs of the wet process thus in this variation two more parameters are used two different weibull acs s are used to describe the binary and positive rainfall processes respectively this approach reproduces more accurately the wet dry spells and multiscale properties both cs1 and cs2 are not designed to explicitly reproduce the statistical properties at all time scales but are calibrated on a specific time resolution in fact using cosmos to preserve explicitly the characteristic at all time scales is feasible through a disaggregation scheme dipmac papalexiou et al 2018 yet this increases the number of parameters the computational and model complexity consequently cs1 and cs2 are here applied only in a single time scale i e at 20 min as mentioned next in section 4 in summary the cs1 parametrization requires a total of six parameters per month one for the probability of zero rainfall two for the autocorrelation structure and three for the marginal probability distribution of rainfall intensity while the cs2 requires a total of eight parameters per month it has an additional two parameter acs 2 2 bootstrap based rainfall simulation models bgamdcb cscb and mcgamdcb in this work we apply parametric stochastic methods for performing daily rainfall time series simulation and subsequently we formulate and adopt three bootstrap based models to disaggregate their daily rainfall simulations at the sub daily temporal resolution of interest 20 min in the case study analyzed herein close to those e g by lall and sharma 1996 lall et al 1996 sharma et al 1997 sharma and lall 1999 clark et al 2004 srinivas and srinivasan 2006 salas and lee 2010 namely the bgamdcb block bootstrap based and gamma distribution based simulation scheme coupled with conditional block bootstrap based disaggregation cscb cosmos simulation scheme coupled with conditional block bootstrap based disaggregation and mcgamdcb markov chain based and gamma distribution based simulation scheme coupled with conditional block bootstrap based disaggregation models these models can be reproduced in r programming language r core team 2021 following the codes by papacharalampous 2021 this sub daily rainfall simulation approach is by far preferred in the literature with respect to the alternative of performing sub daily rainfall time series simulation directly as daily rainfall time series records are usually available for longer time periods than sub daily ones arnaud et al 2007 importantly while the use of parametric methods allows for extrapolation beyond the range of the available historical observations block bootstrap schemes offer a certain degree of flexibility that leads to faithful representations of the sequences of zeros and non zeros in simulated time series e g lall et al 1996 especially for the finest sub daily temporal scales note that in our block bootstrap based simulation frameworks all modelling procedures are performed separately for each month the bgamdcb model simulates daily rainfall time series by coupling a seasonal block bootstrap scheme and the gamma distribution as detailed in papacharalampous 2021 in summary the seasonal block bootstrap scheme is similar but not identical to the one outlined by chan et al 2004 section 3 the main difference is that here we simulate binary daily time series instead of simulating time series of daily amounts moreover we use half month blocks thereby diverging further from the example given in chan et al 2004 section 3 subsequently the bgamdcb model simulates daily rainfall amounts for all the wet days by applying the gamma distribution a two parameter continuous probability distribution model that has been widely applied for modelling non zero daily rainfall amounts katz 1977 coe stern 1982 aksoy 2000 this distribution is a simplified two parameter version of the generalized gamma distribution already presented in equation 3 which writes as 5 f g x γ β β γ x γ 1 e x p x β γ γ f o r x γ β 0 following the approach by katz 1977 for each month of the year the gamma distribution is herein applied i e fitted and used in simulation mode the parameters of the gamma model are estimated separately for the two possible types of positive rainfall intensity values found in record i e those corresponding to antecedent wet and those corresponding to antecedent dry states under the assumption of conditional independence between the rainfall amounts of two consecutive wet days thus the bgamdcb model involves two parameter sets for each month of the year that is 48 parameters in total the gamma distribution is fitted via maximum likelihood estimation through the r package fitdistrplus delignette muller dutang 2015 delignette muller et al 2020 importantly the bgamdcb model can extrapolate beyond the range of the available historical observations because of its distribution model while pure block bootstrap schemes cannot the cscb model simulates daily rainfall by applying the parametric stochastic simulation framework by papalexiou 2018 with the generalized gamma distribution eq 3 and the weibull autocorrelation function eq 2 as described in section 2 1 but at the daily time scale this application is made through the r package cosmos papalexiou et al 2021b apart from the selection and fitting of its distribution model and its parametric autocorrelation function the wider framework also requires the estimation of its probability zero parameter here again simulation is conducted in a seasonal fashion therefore the daily time series simulation procedures of the cscb model involve 6 parameters i e three parameters of the generalized gamma distribution plus two parameters of the weibull autocorrelation function and one parameter for the probability at zero for 12 months a year yielding 72 parameters in total parameter estimation is performed through the default procedures of the r package cosmos papalexiou et al 2021b the mcgamdcb model of this work simulates daily rainfall by coupling a markov chain time series simulation scheme and the gamma distribution this simulation is conducted under a similar yet not identical conceptual framework to the one proposed by katz 1977 more precisely a discrete markov chain scheme is applied to simulate binary dry wet daily time series the parameters of this scheme are the transition probability from the dry state to the dry state and the transition probability from the wet state to the dry state in this work these two parameters are estimated via maximum likelihood by also applying a laplacian smoother the discrete markov chain scheme is fitted and used in simulation mode through the r package markovchain spedicato 2017 spedicato et al 2021 subsequently the gamma distribution eq 5 simulates daily rainfall amounts for all wet days for that it is applied separately to wet state values with wet previous state and to wet state values with dry previous state i e similar to what is made within the bgamdcb framework here again simulation is conducted in a seasonal fashion therefore the daily time series simulation procedures of the mcgamdcb model involve 48 parameters related to the application of the distribution model for details in the computation see the descriptions of the bgamdcb model above plus 2 parameters of the discrete markov chain scheme for 12 months a year resulting again in 72 parameters in total finally disaggregation of daily rainfall simulations to the sub daily temporal scale of interest i e the 20 min one is performed for all the bootstrap based generation schemes following a conditional block bootstrap algorithm this algorithm is inspired by the knn block bootstrap scheme adopted for instance within the probabilistic prediction frameworks by sikorska et al 2015 and quilty et al 2019 and rotates around the key idea and target of conditioning the number of rainfall episodes per day in the 20 min simulated time series as well as the duration and peaks of the rainfall episodes upon the total daily rainfall amount for its detailed formulation the reader is referred to papacharalampous 2021 2 3 clustered point process based models bl and ns one of the first theories in modeling precipitation as a continuous process is the point process theory benjamin cornell 1970 todorovic 1968 the clustered point process based models where a cluster of activities starts at every point of a point process offer realistic representations of rainfall and can represent multiple timescales at once the most popular models of this class are the bartlett lewis bl rectangular pulses model and the neymann scott ns rectangular pulses model rodriguez iturbe et al 1988 1987 wheater et al 2007 belonging to the same class bl and ns can usually provide similar performances for a selected case study when the same sample summary statistics are considered for calibration de luca galasso 2019 moreover both bl and ns are here used in their classical versions but it is clear that this analysis could be also extended to their other successive versions see e g kim onof 2020 the similarities and differences between bl and ns models rodriguez iturbe et al 1987 cowpertwait 1991 burton et al 2010 are below listed in terms of physical meaning of their parameters for both bl and ns the storms occurr according to a poisson process with a rate λ t or in an equivalent way the inter arrival time t between two consecutive storms is usually assumed to be exponential distributed 6 f t t λ t λ t e x p λ t t f o r t λ t 0 where 1 λ t represents the mean value of the inter arrival times the number n c of cells also named as bursts or pulses inside each storm is set as geometric distributed with a mean e n c θ with the goal of having at least one cell for each storm the random variable m c n c 1 is adopted with a mean value e m c θ 1 consequently the adopted probability distribution is 7 p m c m c θ 1 θ 1 1 θ m c the intensity i and the duration d of each rectancular cell are both considered as exponentially distributed as eq 6 with parameters β i and β d respectively and mean values e i 1 β i and e d 1 β d bl and ns differ in terms of occurrence of the first rain cell inside a storm in fact each storm starts with the first cell in bl and then the waiting time w between two consecutive origins of cells is considered and modelled as exponentially distributed with parameter β w and mean values e w 1 β w the origins of a storm and of its first pulse are not the same in ns which considers the waiting time s between a specific pulse origin and the origin of the associated storm s is assumed as exponentially distributed as well with parameter β s and mean values e s 1 β s overall the original versions of here applied bl and ns are characterized by 5 parameters λ t θ β i and β d are common while β w and β s are specific for both models precipitation intensity x t at time t is then calculated as the sum of all the intensities from the active pulses at time t subsequent studies re parametrized bl and ns models and randomized the storm arrivals and durations rodriguez iturbe et al 1988 as well as the cell intensity kaczmarska et al 2014 the adopted rectangular pulses are flexible in approximating discrete rainfall generally when it is aggregated over time intervals of 1 h or more e g cowpertwait et al 2007 provide a list of real world applications where the bl rectangular model is appropriate in fitting aggregated series parameters for bl and ns are estimated by using the generalized method of moments separately for each month i e 5 parameters per 12 months in a year resulting in 60 parameters to be estimated in detail for each month focusing on 20 min and daily time scales bl calibration was carried out by reproducing the sample mean variance lag 1 autocorrelation and probability of dry at 20 min and daily time scales ns calibration was carried out by considering the sample mean and variance at 20 min and daily time scales as well as the autocorrelation values at 20 min daily and 7 day time scales the objective function to be minimized was set as 8 o f φ i 1 k w i 1 μ i φ m i 2 where μ i φ are the aforementioned statistics of the aggregated precipitation derived from the model with parameters φ λ t θ β w β i β d for bl and φ λ t θ β s β i β d for ns m i are the time series empirical statistics k is the overall number of the considered statistics for different durations i e 20 min and daily time scales that is k 8 for bl and k 7 for ns and w i are the weights of the objective function for bl the weights are computed from the inverse of the covariance matrix of the statistics which here must be estimated empirically due to the complexity of the analytical expressions see kaczmarska et al 2014 for ns all the weights are simply set equal to 1 in order to assign the same importance to all the considered statistics velghe et al 1994 verhoest et al 1997 2 4 multiplicative disaggregation of monthly rainfall model mrc the suggested framework is a combination of a periodic autoregressive model of order 1 i e par 1 with gamma distributed noise for simulation of monthly rainfall totals e g bras rodriguez iturbe 1985 langousis koutsoyiannis 2006 koutsoyiannis langousis 2011 with a beta lognormal multifractal cascade see veneziano langousis 2005 veneziano et al 2006 langousis veneziano 2007 langousis et al 2009 2013 emmanouil et al 2020 for scale invariant multiplicative disaggregation of the monthly values at the sub daily level more precisely the parameters of the par 1 model are estimated from the available data so that the historical monthly means standard deviations and lag 1 correlation coefficients between different months of the year e g september with october october with november etc are reproduced the par 1 model is used to simulate synthetic time series of monthly rainfall accumulations which are subsequently disaggregated at the 20 min resolution using model 3 of langousis and veneziano 2007 see also veneziano et al 2006 and langousis et al 2013 the latter describes temporal rainfall as a sequence of independent pulses of constant duration δ u on the order of several days see veneziano et al 2006 langousis veneziano 2007 langousis et al 2009 veneziano langousis 2010 emmanouil et al 2020 with multifractal interiors produced by a mean 1 binary beta lognormal stationary multifractal cascade under this setting the average rainfall intensity x δ inside duration δ δ u satisfies 9 x δ d a r x r δ r δ u δ 1 where d denotes equality in all finite dimensional distributions δ u is the upper limit of the scaling range and random variable a r is the product of two independent random factors a factor a ln r with lognormal distribution specifically ln a ln r n μ σ 2 where μ c ln ln r and σ 2 2 c ln ln r and a discrete factor a β r such that p a β r 0 1 r c β and p a β r r c β r c β the parameters of the discrete beta lognormal representation i e c β that controls the lacunarity of the rainfall field i e c β 0 for compact rainfall c l n that controls the amplitude of the multifractal fluctuations when it rains and δ u the upper limit of the scaling range are estimated by matching the scaling of the initial moments of different orders of the average rainfall intensity with the duration δ of temporal averaging based on the specific attributes of the two combined models the resulting time series explicitly reproduce the mean value and standard deviation of monthly rainfall totals the lag 1 autocorrelation coefficient between the rainfall accumulations in different months of the year e g november with december december with january etc the statistical structure of the temporal rainfall series as embodied in the scaling of the initial moments of different orders in the range from 0 to more than 3 for all time scales between 20 min to approximately 15 days the distribution of extreme rainfall from 20 min to the upper scaling range δ u as embodied in the intensity duration frequency idf curves obtained from empirical records an important note to be made here is that the empirical idf curves of the synthetic time series produced by the model are in complete correspondence with the 4 parameter analytical idf formulation suggested by langousis et al 2009 for multifractal rainfall see also emmanouil et al 2020 3 the cosmo4sub hydrological model the continuous simulation model for small and ungauged basin cosmo4sub introduced and fully described in grimaldi et al 2012b 2021 is here briefly recalled for a better comprehension of the rainfall model comparison cosmo4sub framework can be considered as the simplest continuous scheme possible as it does not include snowmelt or evapotraspiration analysis and it does not evaluate continuously water fluxes since its aim is to be applied with the minimal input information it is composed of four sub models or modules 1 synthetic rainfall simulation 2 excess rainfall estimation 3 rainfall runoff transformation 4 the design simulation analysis 1 the first step inspired the present paper since indeed as mentioned in the introduction it is still not trivial to identify an appropriate approach it is useful to highlight that since cosmo4sub is tailored for small basin applications the time resolution of the input rainfall time series should be 10 20 min or higher 2 given the simulated rainfall time series the excess rainfall is then estimated cosmo4sub model includes a module that combines the common nrcs cn method and the green ampt equation named cn4ga grimaldi et al 2013a b that makes appropriate the application of the curve number approach on sub daily gross rainfall events compared to the event based approach the availability of simulated rainfall time series allows quantification of the antecedent moisture condition 3 in order to transform rainfall to runoff third step the wfiuh rodriguez iturbe rinaldo 1997 model is applied such an approach adapted to the ungauged conditions grimaldi et al 2012c is the most effective method currently applicable since it optimizes the hydrogeomorphic information based on the dem nowadays readily available almost everywhere thanks to the convolution integral between excess rainfall time series and wfiuh a runoff time series with the desired length is generated and the practitioner can follow several approaches for estimating the design parameters of interest for example one can a directly implement the synthetic runoff time series grimaldi et al 2013c sikorska et al 2018 b estimate the design peak discharge using common flood frequency analysis de paola et al 2018 c estimate the design hydrograph using a multivariate approach serinaldi grimaldi 2011 brunner et al 2017 or d separate the simulated hydrographs and apply a monte carlo method annis et al 2020 in the spirit of ungauged applications cosmo4sub is calibration free however it includes several parameters that are assigned through an empirical approach it was verified that some of them have a minor effect on the final results i e contributing area threshold for drainage network identification and others while others are crucial in detail c n curve number is the most influential since it is included in the excess rainfall analysis cn is quantified through look up tables and land use soil data information t s separation time included as well as in the excess rainfall step t s suggests when it is necessary to reset the initial abstraction in the nrcs cn method previous research identified 24 h as an appropriate value and finally the concentration time t c estimated using empirical equations that determines the wfiuh model base time 4 illustrative example data set description the eight rainfall models are calibrated using the uccle time series observed at 10 min resolution from 1 january 1898 to 31 december 2002 at the royal meteorological institute at uccle brussels belgium tu pham et al 2018 demareé 2003 this 105 year data set is clearly unique for its length and time resolution and moreover it is particularly accurate since measurements were provided by the same instrument in the same place and the data processing followed the same procedure ntegeka willems 2008 a summary of basic statistical characteristics of the uccle time series is available in the previously cited papers to apply the cosmo4sub model a small basin is selected in the uccle region fig 1 the watershed outlet collects a contributing area of 41 1 km2 mere cross section molenbeek river a tributary of deender river brussels west part fig 1b shows the digital elevation model dem resampled at 50 m of resolution copernicus land monitoring service eu dem the selected basin has a narrow shape and generally low slope elevation range 22 92 m a s l average slope 2 9 in order to define the drainage network a contributing area threshold at of 0 5 km2 is assumed while the concentration time t c results equal to 9 8 hours applying the nrcs equation nrcs 1997 concerning land use the corine land cover database at level iii and related to the year 2018 and look up tables nrcs 2008 allowed to quantify the nrcs curve number 64 4 the low value is mostly due to the agricultural areas 76 of the watershed area and the limited downstream urbanized region for a full catchment description see el sadek 2007 and willems 2014 in the present work the watershed is selected just to have available an illustrative example on which to apply the cosmo4sub model by using different rainfall time series as input although watersheds in belgium are affected by a variety of processes including snowfall here we limit interest to some of them as the obtained findings rely on comparative assessments in terms of the rainfall models used we believe that selected illustrative case study serves the needs of the proposed extreme event analysis in addition section 5 describes several comparison tests where the cosmo4sub input parameters are properly varied so the investigation becomes more effective 5 comparison test 5 1 experimental setup as previously stressed we do not aim to evaluate compare in general the performances of the eight rainfall models section 2 specifically we evaluate if the synthetic rainfall leads in generating realistic runoff time series and investigate which model is a good candidate to couple with the first sub model of the cosmo4sub framework indeed a universally optimal rainfall model for all hydrological studies might not exist on the contrary a detailed rainfall model evaluation should be performed in the context of specific practical applications we set two benchmarks for the comparison the observed 105 year uccle rainfall time series aggregated at 20 min resolution and the runoff time series still 105 year long at 20 min of resolution resulting from the cosmo4sub model applied using as input the observed rainfall time series since typically at least in europe rain gauge observed time series include a long period of daily data and a shorter period of sub hourly data due to the introduction of modern digital instruments we planned the rainfall model calibration assuming to have available 20 years at 20 min and 105 years at daily resolution specifically we selected the last 20 years of the observation period 1983 2002 assuming that in this period the high resolution data could be less affected by possible instrumental problems generally found at the beginning of the century note that previous analyses on the uccle time series ntegeka willems 2008 allowed to assume that it is reasonable to calibrate the rainfall models using the cycle stationarity condition in table 1 a summary of the eight rainfall models is provided listing the calibration data set not all the models are structured to use high and low time resolution rainfall data the calibration strategy and the number of parameters note that all procedures for rainfall modeling are performed separately for each month as previously mentioned in section 2 apart from mrc that accounts for the correlation between successive months this strategy is expected to facilitate the efficient modelling of the seasonal and heteroscedastic behaviors characterizing the daily and sub daily rainfall processes as the differences observed in the daily and sub daily rainfall patterns from season to season are usually considerable this strategy is usually preferred when long time series records are available salas et al 1982 papalexiou 2018 although it dramatically increases the number of the rainfall simulation model s parameters and or its algorithmic steps this is not considered an issue in the present work since it focuses on the case of favorable conditions in terms of data availability then a 1000 year long synthetic time series at 20 min resolution was simulated by each model and consequently used as input for the cosmo4sub model cosmo4sub model is applied using the basic configuration parameters see table 2 in grimaldi et al 2021 except for the cn and t c that were appropriately varied in order to achieve more representative results specifically the configuration core is cn 84 4 t c 9 8 h i e the same concentration time value estimated for the mere watershed case study but with a higher cn value we added 20 to the original value obtained from the corine land cover as described in section 4 in order to have richer sets of excess rainfall time series lower cn tends to significantly reduce the number of excess rainfall events and consequently the hydrographs this hydrological scenario is denoted in the following as hs1 we also investigate the results obtained with two additional configurations cn 74 4 and t c 9 8 h as well as cn 74 4 and t c 14 7 h which encompass a large part of the statistical variability associated with model parameter estimation see e g kaleris langousis 2017 allowing a preliminary evaluation of the model uncertainty effect in the comparison analysis these two scenarios are identified as hs2 and hs3 respectively in the following some statistical properties estimated on the simulated runoff time series are shown allowing for the comparison among models and the benchmark since cosmo4sub has the aim to provide design parameters for the hydrological application the described comparison mainly concerns the extreme value hydrographs moreover for sake of brevity comparisons among synthetic and observed rainfall time series are not included since the analysis is primarily oriented to the runoff 5 2 results all the models result in runoff time series that visually display a realistic behavior similar to that pertaining to the benchmark figure s1 of the supplementary material flood events are extracted from time series as sequences of positive discharge values without zeros each event is characterized in terms of the dry period prior to the event hereafter referred to as antecedent dry period when discharge is equal to zero due to null excess rainfall denoted here as d h the duration δ h the volume v 10 3 m3 and the peak value q m3 s those features depend on the alternation of rainy and dry periods in time the rainfall volume and its distribution in time and the cosmo4sub parameters ruling the hydrological response at the catchment scale as previously mentioned the most relevant cosmo4sub parameters are cn and t c we selected the aforementioned characteristics to provide an exhaustive overview of event properties being aware that q and v are the crucial parameters to focus on in the following we illustrate and compare through summary metrics the joint probability distributions of flood event characteristics as provided by the eight different rainfall models used to build runoff continuous time simulations and for the three different configurations of the rainfall runoff transformation i e hs1 hs2 and hs3 specifically results are described by analyzing i the average number of flood events section 5 2 1 ii the empirical marginal distributions of d δ v and q section 5 2 2 and iii the dependence structure among the flood variables δ v and q section 5 2 3 5 2 1 analysis of the average number of flood events the average number of flood events per year is reported in table 2 for each parametric configuration cn and t c for each rainfall model and compared to the benchmark uccle the number of events is close to the reference one for all the models apart from cs2 bl and mrc that significantly depart from it underestimating the reference number 35 26 25 respectively for hs1 when cn 84 4 an underestimation is obtained also with ns even smaller 18 again for hs1 results are similar for all the three cosmo4sub configurations meaning that the difference between each model and the reference time series is not due to rainfall runoff transformation obviously the number of events changes for all the models as a function of cn value which determines excess rainfall and runoff generation specifically the number of flood events decreases with cn also increasing t c influences the number of flood events by further reducing their number of flood events due to event aggregation but with a minor effect relative to cn the number of floods is expected to depend on the rainfall volume and distribution note that the average yearly rainfall amount which controls the discharge occurrence and volume apart from the hydrological losses is very similar to the uccle value for all the models with a slight overestimation by cs1 bl and ns 7 4 6 respectively and underestimation by cs2 8 see table s1 of supplementary material in this context the slight overestimation for bl and ns seems to contrast their previously mentioned underestimation for the average number of flood events but this is an expected result in fact if the calibration strategy is aimed towards good reproduction of the summary statistics of continuous sample series effective modelling of rainfall extremes is not guaranteed they are usually underestimated de luca galasso 2019 and the same holds for the magnitude and number of flood events as for rainfall distribution the alternation of dry and wet 20 min steps is very well reproduced by all models whereas larger differences 2 are observed for bl and mrc results at the daily scale are not coherent with those at the 20 min scale where one can observe generally larger differences in between 10 and 10 with the largest value being that for cs1 equal to 57 table s1 the difference between the 20 min and daily scales is due to the different organization of rainfall distribution in time provided by the models notwithstanding this results in terms of the number of discharge events are good especially for cs1 and cscb this means that the mechanism of runoff generation in the cosmo4sub framework plays a relevant smoothing effect as expected 5 2 2 analysis of empirical marginal distributions of d δ v and q figure 2 depicts the empirical probability distribution of flood event characteristics dry period d duration δ volume v and peak q expressed in terms of return periods t years i e the reciprocal of the exceedance probabilities for all the rainfall models and benchmark series we focus on return period values up to 100 years that is close to the length of the uccle time series note that the return period is not affected by the time dependence structure of d δ v and q time series volpi et al 2019 which is not negligible since all the flood events have been selected independently of their time spacing and magnitude moreover results are coherent with that pertaining to the series of annual maxima flood events figure not shown for sake of brevity the small number of flood events per year table 2 is generally associated with longer dry periods and or smaller event durations as shown in fig 2a and b cs2 generally overestimates the distribution of dry periods and slightly underestimates that of duration on the contrary bl captures satisfactorily the dry period and overestimates the duration all the other models well represent the distributions of dry period apart from mcgamdcb bgamdcb cscb and mrc that slightly underestimate the bulk of the distribution the duration of uccle flood events is well represented only by mrc and cscb while the other models generally underestimate it in terms of flood volume the models which better reproduce the benchmark are cs1 mrc and bl for return periods up to approximately 50 years for return periods equal to or larger than approximately 50 years also the cscb model performs relatively well see fig 2c and figure s2c and figure s3c of the supplementary material in terms of flood peak only cs1 mrc and cscb for return period larger than 50 years well reproduce the benchmark distribution all the other models generally underestimate both the volume and the flood peak further fig 2 refers to the reference cosmo4sub configuration hs1 cn 84 4 and t c 9 8 h but similar results have been obtained for the other two configurations hs2 and hs3 reported in figures s2 and s3 obviously when reducing cn the antecedent dry period increases while duration volume and peak slightly decrease conversely when increasing the concentration time t c the duration of the event increases also producing an increase in flood volume and a reduction of flood peak notwithstanding this the relative performance of the models with respect to uccle remains almost the same in order to provide a quantitative estimate of the model performance in terms of extremes we compute the relative error percentage with respect to the uccle benchmark related to the 20 year return period considering all the hydrological response scenarios table 3 the relative error is a measure of the simulation accuracy as for simulation uncertainty we provide a graphical quantification later on to evaluate the accuracy of the model we refer to 20 years because it is the largest return period value that could guarantee a robust quantile empirical estimate based on a 105 years length series as a matter of fact the best models for t 20 years are cscb in terms of the dry period cscb and mrc in terms of flood duration cs1 and bl in terms of flood volume and cs1 and mrc in terms of flood peak note that the error in flood peak estimation is generally larger than that pertaining to the other features note however that results are different for larger return periods see figures 2 s2 and s3 in order to provide an overview of the estimation uncertainty the empirical distribution functions for all the four investigated flood quantities are computed for each model by splitting the 1000 year simulated time series into 10 sub series of 100 years each i e approximately of the same length of the benchmark series hs1 fig 3 the figure provides a graphical estimation of the uncertainty associated with 100 year long synthetic simulations in practice we verify whether the benchmark is included in the ensemble of 100 year model scenarios or whether there exist irregular behaviors in other words the inclusion of the benchmark in the ensemble can be considered as a good sign of model capability to provide realistic simulations cs1 bl mrc and ns provide good results however bl and ns confirm to suffer due to a very high ensemble variability and somewhat unrealistic simulation of flood peaks among the bootstrap based modeling approach cscb is the only one providing good results for all flood event characteristics again the other two cosmo4sub parameter configurations hs2 and hs3 provide comparable results figure s4 s5 5 2 3 analysis of dependence structure among δ v and q to complete the description of flood events statistical distribution the dependence structure among the different variables considered is investigated fig 4 displays scatter plots among the most relevant variables i e duration δ volume v and peak q for hs1 dots i e flood events that significantly differ from the benchmark shape could represent unrealistic simulations see figures s6 and s7 for hs2 and hs3 which depict similar results the bulk of the joint distribution of duration volume and peak appears to be very well represented by all models with a larger dispersion only in the case of bl and mrc for extremes the models show larger differences for example cs1 and mrc depict a weaker dependence for large values of the variables while cs2 cscb bl and ns show a stronger correlation for clarity the dependence structure is summarized in terms of the non parametric kendall correlation coefficient τ table 4 the correlation is positive and significantly high 0 6 0 7 for the pairs δ v and δ q while that pertaining to volume and peak is even stronger being always larger than 0 9 as also emerges from fig 3 these high values are a consequence of the application of a rainfall runoff model that constrains the physical processes to the mechanisms represented note however that the correlation is only slightly affected by the model parameters that rule the generation and concentration of runoff apart from mrc that underestimates the correlation coefficients involving flood duration and cs1 and ns that overestimate them all the models reproduce satisfactorily the dependence structure on average when we limit the estimation of the correlation coefficient to the most intense events by only considering annual maxima we have correlation values generally smaller as expected yet a similar relative performance for all the methods compare table 5 to table 4 the performance of mrc is generally better for the benchmark configuration hs1 cn 84 4 t c 9 8 h kendall correlation is 0 35 0 15 and 0 75 on average for δ v δ q and v q respectively considering the entire flood sample the correlation between the variable pairs is more sensitive to the cosmo4sub parameters the most important effect is played by cn that enforces the correlation structure between all variables when its value is reduced to 74 4 6 summary and discussion following the quantitative description of the results provided in the previous section here the behavior and the performance of each model are summarized moreover in depth discussions are provided in light of the identified characteristics of the simulated rainfall time series not presented here for brevity and given our overall focus on runoff and flood event characteristics cs1 slightly overestimates the average yearly rainfall amount as it concentrates rainy spells in a few days as a consequence it produces a comparable number of flood events with respect to the uccle benchmark with appropriate antecedent dry intervals volume and peak but with a smaller duration due to the filter effect of the hydrological loss model the model provides satisfactory results realistic simulated flood events in terms of both marginal distributions and dependence structure cs2 reproduces well the rainy amount and distribution wet dry alternation and the number of flood events also the dependence structure among the characteristics of the flood events is similar to that pertaining to uccle however differently from cs1 it does not properly reproduce the marginal distributions of dry intervals duration volume and peak producing biased simulations probably because the ge1 distribution overestimated the rainfall extremes in general the bootstrap based disaggregation scheme used by bgamdcb cscb and mcgamdcb depicts a good rather expected efficiency in conditioning the number duration and peaks of the rainfall and discharge episodes in fact bgamdcb cscb and mcgamdcb behave similarly to cs2 specifically cs2 bgamdcb and mcgamdcb tend to underestimate duration volume and peaks while cscb generally overestimates these quantities the difference between the bootstrap based models can be attributed to the distribution function used which is the gamma distribution in the case of cs2 bgamdcb and mcgamdcb in fact the gamma distribution does not belong to the domain of attraction of the fréchet distribution on the contrary the cs1 and cscb frameworks simulate daily rainfall amount by utilizing the generalized gamma distribution which belongs to the domain of attraction of the fréchet distribution i e it has a sub exponential upper tail also bl and ns due to the similar modeling strategy yield comparable results with a slightly better performance of ns while depicting good rainfall statistics at the yearly scale bl and ns underestimate the number of flood events with respect to the uccle benchmark with appropriate antecedent dry intervals a slightly underestimated volume and peak but with larger bl and smaller ns duration further they provide satisfactory results in terms of marginal distribution variability and dependence structure apart from bl for which the dependence structure is somewhat unrealistic finally mrc provides generally very good results in terms of all summary metrics apart from those involving flood duration notwithstanding this and the small number of simulated flood events per year the model provides realistic simulations overall all models except for the cs2 and the three bootstrap methods are capable to reproduce in general realistic runoff time series that are coherent with the benchmark in terms of hydrograph peak and volume key quantities for the investigation of floods for return periods up to approximately 50 years therefore we identified four potential candidates for continuous hydrological modelling among the applied rainfall simulation models however while we believe that these behaviors could have general validity results could be partially conditioned upon the combinations of calibration data and strategies which are different for the various models see table 1 moreover a replacement of the gamma distribution e g with a three parameter distribution within the wider frameworks behind the bgamdcb and mcgamdcb models could be investigated in the future as it could lead to improvements in terms of extreme event characteristics and thus to new candidates for continuous hydrological modelling in fact it seems that the daily rainfall time series simulation procedures incorporated in these two models did not offer realistic flood event quantities to be allocated by the disaggregation scheme while the latter seems to be well performing in general terms as empirically proven by the performance of the cscb model further results could be partially conditioned upon the applied hydrological model here we are focusing on the specific cosmo4sub framework trying to identify one or more appropriate rainfall models to be used as input rainfall models have been designed with the aim to simulate time series of 20 min rainfall totals with statistical features comparable to the observed ones in our study area for several time scales up to 2 days with emphasis on extreme events widely studied in rainfall modelling though the design of idf curves this has been the target at that first stage as quantities related to the examination of floods would be and have been the focus after the rainfall runoff transformation looking at table 3 and fig 3 it becomes clear that several models offer promising performances and specifically the four models cs1 bl ns mrc show a percentage estimation error for the two crucial parameters i e peak and volume and return periods up to approximately 50 years see table 3 below 25 which is in line with the typical uncertainty of empirical modelling under ungauged conditions on the other hand for return periods equal to or larger than approximately 50 years the cscb model provides good performance with respect to the aforementioned criterion here again within the 20 see fig 3c d s2c d and s3c d while it mostly overestimates the two crucial quantities for smaller return periods probably because it allocates the entire volume simulated by its daily time series simulation scheme in a way that allows realistic values for larger return periods as we mention in the introduction this paper focuses on the ideal data rich condition continuous 20 year series at 20 min and 105 year at daily resolution while in the future we can assume to have such or similar availability of data in several watersheds the common condition is and will be very different we can classify two situations for the practitioner approach to study a small and ungauged basin i within or near the basin there is a rain gauge with a limited number of observations say 5 year long series at 20 min with an associated 25 year long daily series ii a rain gauge series is not available and then the practitioner who surely prefer this option refers to regional maps to extract the critical rainfall information like the embodied idf curve parameters in the first situation the rainfall model should be very parsimonious far from the configurations tested in this paper table 1 so future investigation will adapt the models or some of them creating a parsimonious version with the minimum number of parameters possible moreover such rainfall model versions could be also developed by setting up a user friendly spatial and regional tool like in kim et al 2017 for the second situation future investigation will focus on rainfall models that can be calibrated based directly on idf parameters and rainfall information at low resolution like monthly and annual that are widely available and not on the high resolution rainfall observations see de luca petroselli 2021 7 conclusions continuous modelling represents a modern approach for estimating design parameters in hydrological studies although it could offer promising advantages it has not been properly diffused in hydrologic research and engineering hydrology the main reason is probably the difficulty in identifying an appropriate and user friendly rainfall model to simulate synthetic time series at the sub daily level in order to be used as input for continuous hydrological modelling in this contribution we used a simplified continuous hydrologic model named cosmo4sub tailored for small and ungauged basins in order to feed the hydrologic model with synthetic rainfall time series we tested eight rainfall models two versions of the complete stochastic modelling solution named here cs1 and cs2 three versions of bootstrap based models named here bgamdcb cscb and mcgamdcb the classical bartlett lewis model named here bl and neymann scott rectangular pulses model named here ns and a mixed method based on monthly simulation and multifractal cascade disaggregation named here mrc assuming a data rich condition referring to one of the longest time series available at 10 min resolution we have evaluated the rainfall model simulations the comparison was performed by analyzing runoff time series obtained by the cosmo4sub model and using as input the rainfall time series simulated by the eight models and the observed ones we selected and investigated several general properties like the average number of flood events the marginal distribution of peak volume duration and the dry period prior to the flood and their dependence structure the obtained results support the conclusion that all models are capable of simulating realistic runoff time series in terms of several characteristics among them four models cs1 bl ns mrc provide an estimation error for hydrograph peak and volume compared to the benchmark for 20 year return period below 25 which is more than appropriate when compared to the uncertainty level common in ungauged applications the limitations of the proposed study which will be dealt in a follow up work relate to the choice of a simplified hydrological model that does not allow generalization of the obtained findings to the entire class of continuous modelling indeed cosmo4sub can be considered as the simplest continuous scheme possible since it does not include a variety of processes and it does not evaluate continuously water fluxes since its aim is to model extreme hydrographs with the minimal input information however the propososed framework is tranfarable to any basin and can be applied with different hydrologic models coupled with different rainfall models moreover in the illustrative example we demonstrated our framework assumed data rich conditions which is far from the typical data availability a practitioner must face for mitigating such limitations future research will focus on making the eight rainfall models more parsimonious and optimize them to be applicable for data scarce cases these efforts will include a more complete comparison of continuous hydrological modelling alternatives not limited to small and ungauged basins funding this work was supported by the italian ministry of the environment land and sea mite through the project simpro simulazione idrologico idraulico economica di progetto per la mitigazione del rischio idraulico and by the fwo project g003918n stochastic modelling of future extreme discharges as a tool for water resources engineering e v acknowledge funding from the italian ministry of education university and research miur in the frame of the departments of excellence initiative 2018 2022 attributed to the department of engineering of roma tre university credit authorship contribution statement salvatore grimaldi conceptualization funding acquisition supervision writing original draft writing review editing elena volpi conceptualization funding acquisition visualization writing original draft writing review editing andreas langousis conceptualization methodology writing review editing simon michael papalexiou conceptualization methodology writing review editing davide luciano de luca methodology writing review editing rodolfo piscopia methodology sofia d nerantzaki methodology writing review editing georgia papacharalampous methodology writing review editing andrea petroselli methodology writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 127866 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
3311,continuous hydrologic modelling for small and ungauged basins a comparison of eight rainfall models for sub daily runoff simulations salvatore grimaldi conceptualization funding acquisition supervision writing original draft writing review editing a elena volpi conceptualization funding acquisition visualization writing original draft writing review editing b andreas langousis conceptualization methodology writing review editing c simon michael papalexiou conceptualization methodology writing review editing d e davide luciano de luca methodology writing review editing f rodolfo piscopia methodology g sofia d nerantzaki methodology writing review editing a e h georgia papacharalampous methodology writing review editing b andrea petroselli methodology writing review editing i a dibaf department tuscia university viterbo italy dibaf department tuscia university viterbo italy dibaf department tuscia university viterbo italy b department of engineering roma tre university rome italy department of engineering roma tre university rome italy department of engineering roma tre university rome italy c department of civil engineering school of engineering university of patras greece department of civil engineering school of engineering university of patras greece department of civil engineering school of engineering university of patras greece d department of civil engineering university of calgary canada department of civil engineering university of calgary canada department of civil engineering university of calgary canada e global institute for water security university of saskatchewan canada global institute for water security university of saskatchewan canada global institute for water security university of saskatchewan canada f department of informatics modelling electronics and system engineering university of calabria arcavacata di rende italy department of informatics modelling electronics and system engineering university of calabria arcavacata di rende italy department of informatics modelling electronics and system engineering university of calabria arcavacata di rende italy g freelance rome italy freelance rome italy freelance rome italy h department of civil geological and environmental engineering university of saskatchewan canada department of civil geological and environmental engineering university of saskatchewan canada department of civil geological and environmental engineering university of saskatchewan canada i deim department tuscia university 01100 viterbo italy deim department tuscia university 01100 viterbo italy deim department tuscia university 01100 viterbo italy corresponding author continuous hydrologic modelling is a natural evolution of the event based design approach in modern hydrology it improves the rainfall runoff transformation and provides the practitioner with more effective hydrological output information for risk assessment however this approach is still not widely adopted mainly because the choice of the most appropriate rainfall simulation model which is the core of continuous frameworks for the specific aim of risk analysis has not been sufficiently investigated in this paper we test eight rainfall models by evaluating the performances of the simulated rainfall time series when used as input for a simplified continuous rainfall runoff model the cosmo4sub which is particularly designed for small and ungauged basins the comparison confirms the capability of all models to provide realistic flood events and allows identifying the models to be further improved and tailored for data scarce hydrological risk applications the suggested framework is transferable to any catchment while different hydrologic and rainfall models can be used keywords continuous hydrologic modelling risk assessment small and ungauged basins rainfall models rainfall simulations 1 introduction the benefit of continuous modelling in hydrological studies is widely recognized pathiraja et al 2012 blazkova et al 2017 such an approach is particularly promising for estimating the design hydrological input for a variety of practical applications blazkova beven 2002 boughton droop 2003 the added value of this approach is to provide a large sample of synthetic scenarios tailored for risk and hazard statistical analyses and to better reproduce the design flood volumes grimaldi et al 2012a winter et al 2019 thus there is a tendency to overcome the concept of design hydrograph in favor of the design runoff simulation lamb et al 2016 grimaldi et al 2021 it is well known that the event based approach represented by the classical design hydrograph is based on several steps or modules viglione blöschl 2009 castiglioni et al 2010 sene 2012 blöschl et al 2013 haberlandt radtke 2014 grimaldi petroselli 2015 a derivation of intensity duration frequency idf curves from rainfall data b use of the idf curves from a to estimate the critical rainfall height for a selected return period t of interest and duration d equal to the concentration time of the basin c temporal disaggregation of the critical rainfall height assuming a specific design hyetograph and d rainfall runoff transformation the result is a single hydrograph related to the selected return period which is assumed to be the same as the design hyetograph however all these steps present relevant assumptions hence continuous modelling has been recently developed with the aim to mitigate the major drawbacks of the event based approach biondi de luca 2015 grimaldi et al 2012a specifically the basic concept of the continuous framework relies on avoiding the first two steps of the event based approach boughton droop 2003 grimaldi et al 2012b winter et al 2019 beneyto et al 2020 this is accomplished by using long synthetic rainfall time series as input in a rainfall runoff model which is implemented using a continuous scheme the result is a long runoff time series from which it is possible to select the desired information for the specific design problem while there are several clear and appealing advantages the continuous procedure is still not widely used the main skepticism of practitioners and researchers regards the use of rainfall simulation models also known in the literature as weather generators see e g the review in langousis kaleris 2014 that presently can be considered as the bottleneck of the procedure there are two main challenges the first one is the availability of many rainfall models without a clear suggestion on which is the most appropriate one to use in such a framework the second one is that most rainfall models are not user friendly and need a substantial theoretical background to successfully be applied yet there are efforts simplifying the application of rainfall models that can facilitate the continuous framework development either by offering regionalized parameters for specific models e g kim et al 2017 or by the development of easily applicable packages e g cosmos r in order to contribute for establishing this modern approach and to mitigate the aforementioned challenges we investigate here several rainfall generation models aiming to identify suitable candidates to use as input for a simplified continuous design framework recently it was underlined the possibility and the opportunity to apply the continuous framework also in the challenging case of small and ungauged basins blazkova beven 2002 boughton droop 2003 grimaldi et al 2012b using a simple rainfall runoff model structure necessarily calibration free it is possible to significantly improve the common techniques applied in such crucial watersheds i e the rational method in this context the aim in this paper is to identify the best rainfall simulator to be included in a specific rainfall runoff continuous model named cosmo4sub continuous simulation model for small and ungauged basin grimaldi et al 2012b 2021 designed to analyze small and ungauged watersheds the present paper focuses on evaluating the performance of eight rainfall models applied assuming the best calibration condition without any constraint due to the paucity of calibration data in future developments of our research we will focus on more challenging data scarce conditions the rainfall models selected here are two versions of the complete stochastic modelling solution cosmos 1 s and 2s abbreviated here as cs1 and cs2 see section 2 1 three versions of bootstrap based models abbreviated as bgamdcb cscb and mcgamdcb see section 2 2 the classical bartlett lewis bl and neymann scott ns rectangular pulses models see section 2 3 a mixed method based on monthly simulation and multifractal cascade disaggregation named here mrc see section 2 4 these eight models are evaluated by directly comparing the obtained results from the cosmo4sub model i e by investigating the capability to simulate appropriate runoff time series and flood statistical properties as a benchmark we use synthetic runoff time series generated by cosmo4sub using an illustrative watershed forced by the rainfall observations at uccle brussels belgium which is a 105 year long time series at 10 min resolution the paper is organized as follows section 2 describes the rainfall simulation models theoretical backgrounds and section 3 briefly illustrates the cosmo4sub framework section 4 provides details on the illustrative example and section 5 regards the comparison and the main results discussion is provided in section 6 together with some future research comments 2 the eight rainfall simulation models 2 1 complete stochastic modelling solution cosmos models cs1 and cs2 cosmos complete stochastic modelling solution is a generic modelling scheme that allows for time series or random fields generation which preserve desired linear correlation structures and marginal distributions specifically cosmos allows for univariate and multivariate simulation with discrete continuous or mixed type marginals papalexiou 2018 multiscale simulation through disaggregation dipmac papalexiou et al 2018 random fields generation with desired spatiotemporal correlation structures papalexiou serinaldi 2020 and recently advanced space time modeling with locally varying velocities and anisotropies papalexiou et al 2021a the methods are implemented in the freely available cosmos r package papalexiou et al 2021b precipitation modelling of cosmos 1 s relies on i using a mixed type marginal 1 f x x 1 p 0 f x x 0 x p 0 x 0 to describe the observed probability of zero precipitation with p 0 and the nonzero precipitation with any suitable continuous distribution f x x 0 x with x the rainfall intensity and ii a parsimonious parametric autocorrelation structure acs in order to reproduce the observed autocorrelation of the intermittent process up to any desirable lag typically up to the lag that correlation approximates zero here the weibull correlation structure will be used given by 2 ρ w τ b c e x p τ b c where τ is the lag time and b 0 and 0 c 2 are parameters the scheme s core avoiding the technical details please see the aforementioned references is based on generating gaussian time series with an acs that must be specified the gaussian acs depends on the desired mixed type marginal distribution and the acs of the observed precipitation and it is estimated by using a correlation transformation function the gaussian time series generated using autoregressive ar models of large order are transformed to precipitation by using the mixed type quantile function two variations of the cosmos model are applied here the first cosmos 1s cs1 uses the generalized gamma distribution with probability density function pdf given by 3 f g g x β γ 1 γ 2 γ 2 β γ γ 1 γ 2 x β γ 1 1 e x p x β γ 2 to describe nonzero precipitation at each month β is a scale parameter γ 1 and γ 2 are shape parameters and γ denotes the gamma function abramowitz stegun 1970 in this study the distribution is fitted to preserve the mean and standard deviation while the tail parameter is estimated by minimizing the square error of the empirical tail defined here as the 10 of the largest values so for each month of the year the cs1 model reproduces the observed probability of zero precipitation the observed fitted generalized gamma distribution to nonzero precipitation and the observed weibull acs fitted by minimizing the square error at the desired sub daily resolution in our application 20 min the second variation cosmos 2s cs2 papalexiou 2022 uses a new distribution to describe the nonzero precipitation that is the generalized exponential of type i with distribution function given by 4 f g e 1 x β γ 1 γ 2 1 e x p 1 γ 2 x β γ 1 1 1 γ 2 where β is a scale parameter while γ 1 and γ 2 are shape parameters the difference compared with cs1 is that cs2 reproduces explicitly the acs of the wet dry binary process and the acs of the wet process thus in this variation two more parameters are used two different weibull acs s are used to describe the binary and positive rainfall processes respectively this approach reproduces more accurately the wet dry spells and multiscale properties both cs1 and cs2 are not designed to explicitly reproduce the statistical properties at all time scales but are calibrated on a specific time resolution in fact using cosmos to preserve explicitly the characteristic at all time scales is feasible through a disaggregation scheme dipmac papalexiou et al 2018 yet this increases the number of parameters the computational and model complexity consequently cs1 and cs2 are here applied only in a single time scale i e at 20 min as mentioned next in section 4 in summary the cs1 parametrization requires a total of six parameters per month one for the probability of zero rainfall two for the autocorrelation structure and three for the marginal probability distribution of rainfall intensity while the cs2 requires a total of eight parameters per month it has an additional two parameter acs 2 2 bootstrap based rainfall simulation models bgamdcb cscb and mcgamdcb in this work we apply parametric stochastic methods for performing daily rainfall time series simulation and subsequently we formulate and adopt three bootstrap based models to disaggregate their daily rainfall simulations at the sub daily temporal resolution of interest 20 min in the case study analyzed herein close to those e g by lall and sharma 1996 lall et al 1996 sharma et al 1997 sharma and lall 1999 clark et al 2004 srinivas and srinivasan 2006 salas and lee 2010 namely the bgamdcb block bootstrap based and gamma distribution based simulation scheme coupled with conditional block bootstrap based disaggregation cscb cosmos simulation scheme coupled with conditional block bootstrap based disaggregation and mcgamdcb markov chain based and gamma distribution based simulation scheme coupled with conditional block bootstrap based disaggregation models these models can be reproduced in r programming language r core team 2021 following the codes by papacharalampous 2021 this sub daily rainfall simulation approach is by far preferred in the literature with respect to the alternative of performing sub daily rainfall time series simulation directly as daily rainfall time series records are usually available for longer time periods than sub daily ones arnaud et al 2007 importantly while the use of parametric methods allows for extrapolation beyond the range of the available historical observations block bootstrap schemes offer a certain degree of flexibility that leads to faithful representations of the sequences of zeros and non zeros in simulated time series e g lall et al 1996 especially for the finest sub daily temporal scales note that in our block bootstrap based simulation frameworks all modelling procedures are performed separately for each month the bgamdcb model simulates daily rainfall time series by coupling a seasonal block bootstrap scheme and the gamma distribution as detailed in papacharalampous 2021 in summary the seasonal block bootstrap scheme is similar but not identical to the one outlined by chan et al 2004 section 3 the main difference is that here we simulate binary daily time series instead of simulating time series of daily amounts moreover we use half month blocks thereby diverging further from the example given in chan et al 2004 section 3 subsequently the bgamdcb model simulates daily rainfall amounts for all the wet days by applying the gamma distribution a two parameter continuous probability distribution model that has been widely applied for modelling non zero daily rainfall amounts katz 1977 coe stern 1982 aksoy 2000 this distribution is a simplified two parameter version of the generalized gamma distribution already presented in equation 3 which writes as 5 f g x γ β β γ x γ 1 e x p x β γ γ f o r x γ β 0 following the approach by katz 1977 for each month of the year the gamma distribution is herein applied i e fitted and used in simulation mode the parameters of the gamma model are estimated separately for the two possible types of positive rainfall intensity values found in record i e those corresponding to antecedent wet and those corresponding to antecedent dry states under the assumption of conditional independence between the rainfall amounts of two consecutive wet days thus the bgamdcb model involves two parameter sets for each month of the year that is 48 parameters in total the gamma distribution is fitted via maximum likelihood estimation through the r package fitdistrplus delignette muller dutang 2015 delignette muller et al 2020 importantly the bgamdcb model can extrapolate beyond the range of the available historical observations because of its distribution model while pure block bootstrap schemes cannot the cscb model simulates daily rainfall by applying the parametric stochastic simulation framework by papalexiou 2018 with the generalized gamma distribution eq 3 and the weibull autocorrelation function eq 2 as described in section 2 1 but at the daily time scale this application is made through the r package cosmos papalexiou et al 2021b apart from the selection and fitting of its distribution model and its parametric autocorrelation function the wider framework also requires the estimation of its probability zero parameter here again simulation is conducted in a seasonal fashion therefore the daily time series simulation procedures of the cscb model involve 6 parameters i e three parameters of the generalized gamma distribution plus two parameters of the weibull autocorrelation function and one parameter for the probability at zero for 12 months a year yielding 72 parameters in total parameter estimation is performed through the default procedures of the r package cosmos papalexiou et al 2021b the mcgamdcb model of this work simulates daily rainfall by coupling a markov chain time series simulation scheme and the gamma distribution this simulation is conducted under a similar yet not identical conceptual framework to the one proposed by katz 1977 more precisely a discrete markov chain scheme is applied to simulate binary dry wet daily time series the parameters of this scheme are the transition probability from the dry state to the dry state and the transition probability from the wet state to the dry state in this work these two parameters are estimated via maximum likelihood by also applying a laplacian smoother the discrete markov chain scheme is fitted and used in simulation mode through the r package markovchain spedicato 2017 spedicato et al 2021 subsequently the gamma distribution eq 5 simulates daily rainfall amounts for all wet days for that it is applied separately to wet state values with wet previous state and to wet state values with dry previous state i e similar to what is made within the bgamdcb framework here again simulation is conducted in a seasonal fashion therefore the daily time series simulation procedures of the mcgamdcb model involve 48 parameters related to the application of the distribution model for details in the computation see the descriptions of the bgamdcb model above plus 2 parameters of the discrete markov chain scheme for 12 months a year resulting again in 72 parameters in total finally disaggregation of daily rainfall simulations to the sub daily temporal scale of interest i e the 20 min one is performed for all the bootstrap based generation schemes following a conditional block bootstrap algorithm this algorithm is inspired by the knn block bootstrap scheme adopted for instance within the probabilistic prediction frameworks by sikorska et al 2015 and quilty et al 2019 and rotates around the key idea and target of conditioning the number of rainfall episodes per day in the 20 min simulated time series as well as the duration and peaks of the rainfall episodes upon the total daily rainfall amount for its detailed formulation the reader is referred to papacharalampous 2021 2 3 clustered point process based models bl and ns one of the first theories in modeling precipitation as a continuous process is the point process theory benjamin cornell 1970 todorovic 1968 the clustered point process based models where a cluster of activities starts at every point of a point process offer realistic representations of rainfall and can represent multiple timescales at once the most popular models of this class are the bartlett lewis bl rectangular pulses model and the neymann scott ns rectangular pulses model rodriguez iturbe et al 1988 1987 wheater et al 2007 belonging to the same class bl and ns can usually provide similar performances for a selected case study when the same sample summary statistics are considered for calibration de luca galasso 2019 moreover both bl and ns are here used in their classical versions but it is clear that this analysis could be also extended to their other successive versions see e g kim onof 2020 the similarities and differences between bl and ns models rodriguez iturbe et al 1987 cowpertwait 1991 burton et al 2010 are below listed in terms of physical meaning of their parameters for both bl and ns the storms occurr according to a poisson process with a rate λ t or in an equivalent way the inter arrival time t between two consecutive storms is usually assumed to be exponential distributed 6 f t t λ t λ t e x p λ t t f o r t λ t 0 where 1 λ t represents the mean value of the inter arrival times the number n c of cells also named as bursts or pulses inside each storm is set as geometric distributed with a mean e n c θ with the goal of having at least one cell for each storm the random variable m c n c 1 is adopted with a mean value e m c θ 1 consequently the adopted probability distribution is 7 p m c m c θ 1 θ 1 1 θ m c the intensity i and the duration d of each rectancular cell are both considered as exponentially distributed as eq 6 with parameters β i and β d respectively and mean values e i 1 β i and e d 1 β d bl and ns differ in terms of occurrence of the first rain cell inside a storm in fact each storm starts with the first cell in bl and then the waiting time w between two consecutive origins of cells is considered and modelled as exponentially distributed with parameter β w and mean values e w 1 β w the origins of a storm and of its first pulse are not the same in ns which considers the waiting time s between a specific pulse origin and the origin of the associated storm s is assumed as exponentially distributed as well with parameter β s and mean values e s 1 β s overall the original versions of here applied bl and ns are characterized by 5 parameters λ t θ β i and β d are common while β w and β s are specific for both models precipitation intensity x t at time t is then calculated as the sum of all the intensities from the active pulses at time t subsequent studies re parametrized bl and ns models and randomized the storm arrivals and durations rodriguez iturbe et al 1988 as well as the cell intensity kaczmarska et al 2014 the adopted rectangular pulses are flexible in approximating discrete rainfall generally when it is aggregated over time intervals of 1 h or more e g cowpertwait et al 2007 provide a list of real world applications where the bl rectangular model is appropriate in fitting aggregated series parameters for bl and ns are estimated by using the generalized method of moments separately for each month i e 5 parameters per 12 months in a year resulting in 60 parameters to be estimated in detail for each month focusing on 20 min and daily time scales bl calibration was carried out by reproducing the sample mean variance lag 1 autocorrelation and probability of dry at 20 min and daily time scales ns calibration was carried out by considering the sample mean and variance at 20 min and daily time scales as well as the autocorrelation values at 20 min daily and 7 day time scales the objective function to be minimized was set as 8 o f φ i 1 k w i 1 μ i φ m i 2 where μ i φ are the aforementioned statistics of the aggregated precipitation derived from the model with parameters φ λ t θ β w β i β d for bl and φ λ t θ β s β i β d for ns m i are the time series empirical statistics k is the overall number of the considered statistics for different durations i e 20 min and daily time scales that is k 8 for bl and k 7 for ns and w i are the weights of the objective function for bl the weights are computed from the inverse of the covariance matrix of the statistics which here must be estimated empirically due to the complexity of the analytical expressions see kaczmarska et al 2014 for ns all the weights are simply set equal to 1 in order to assign the same importance to all the considered statistics velghe et al 1994 verhoest et al 1997 2 4 multiplicative disaggregation of monthly rainfall model mrc the suggested framework is a combination of a periodic autoregressive model of order 1 i e par 1 with gamma distributed noise for simulation of monthly rainfall totals e g bras rodriguez iturbe 1985 langousis koutsoyiannis 2006 koutsoyiannis langousis 2011 with a beta lognormal multifractal cascade see veneziano langousis 2005 veneziano et al 2006 langousis veneziano 2007 langousis et al 2009 2013 emmanouil et al 2020 for scale invariant multiplicative disaggregation of the monthly values at the sub daily level more precisely the parameters of the par 1 model are estimated from the available data so that the historical monthly means standard deviations and lag 1 correlation coefficients between different months of the year e g september with october october with november etc are reproduced the par 1 model is used to simulate synthetic time series of monthly rainfall accumulations which are subsequently disaggregated at the 20 min resolution using model 3 of langousis and veneziano 2007 see also veneziano et al 2006 and langousis et al 2013 the latter describes temporal rainfall as a sequence of independent pulses of constant duration δ u on the order of several days see veneziano et al 2006 langousis veneziano 2007 langousis et al 2009 veneziano langousis 2010 emmanouil et al 2020 with multifractal interiors produced by a mean 1 binary beta lognormal stationary multifractal cascade under this setting the average rainfall intensity x δ inside duration δ δ u satisfies 9 x δ d a r x r δ r δ u δ 1 where d denotes equality in all finite dimensional distributions δ u is the upper limit of the scaling range and random variable a r is the product of two independent random factors a factor a ln r with lognormal distribution specifically ln a ln r n μ σ 2 where μ c ln ln r and σ 2 2 c ln ln r and a discrete factor a β r such that p a β r 0 1 r c β and p a β r r c β r c β the parameters of the discrete beta lognormal representation i e c β that controls the lacunarity of the rainfall field i e c β 0 for compact rainfall c l n that controls the amplitude of the multifractal fluctuations when it rains and δ u the upper limit of the scaling range are estimated by matching the scaling of the initial moments of different orders of the average rainfall intensity with the duration δ of temporal averaging based on the specific attributes of the two combined models the resulting time series explicitly reproduce the mean value and standard deviation of monthly rainfall totals the lag 1 autocorrelation coefficient between the rainfall accumulations in different months of the year e g november with december december with january etc the statistical structure of the temporal rainfall series as embodied in the scaling of the initial moments of different orders in the range from 0 to more than 3 for all time scales between 20 min to approximately 15 days the distribution of extreme rainfall from 20 min to the upper scaling range δ u as embodied in the intensity duration frequency idf curves obtained from empirical records an important note to be made here is that the empirical idf curves of the synthetic time series produced by the model are in complete correspondence with the 4 parameter analytical idf formulation suggested by langousis et al 2009 for multifractal rainfall see also emmanouil et al 2020 3 the cosmo4sub hydrological model the continuous simulation model for small and ungauged basin cosmo4sub introduced and fully described in grimaldi et al 2012b 2021 is here briefly recalled for a better comprehension of the rainfall model comparison cosmo4sub framework can be considered as the simplest continuous scheme possible as it does not include snowmelt or evapotraspiration analysis and it does not evaluate continuously water fluxes since its aim is to be applied with the minimal input information it is composed of four sub models or modules 1 synthetic rainfall simulation 2 excess rainfall estimation 3 rainfall runoff transformation 4 the design simulation analysis 1 the first step inspired the present paper since indeed as mentioned in the introduction it is still not trivial to identify an appropriate approach it is useful to highlight that since cosmo4sub is tailored for small basin applications the time resolution of the input rainfall time series should be 10 20 min or higher 2 given the simulated rainfall time series the excess rainfall is then estimated cosmo4sub model includes a module that combines the common nrcs cn method and the green ampt equation named cn4ga grimaldi et al 2013a b that makes appropriate the application of the curve number approach on sub daily gross rainfall events compared to the event based approach the availability of simulated rainfall time series allows quantification of the antecedent moisture condition 3 in order to transform rainfall to runoff third step the wfiuh rodriguez iturbe rinaldo 1997 model is applied such an approach adapted to the ungauged conditions grimaldi et al 2012c is the most effective method currently applicable since it optimizes the hydrogeomorphic information based on the dem nowadays readily available almost everywhere thanks to the convolution integral between excess rainfall time series and wfiuh a runoff time series with the desired length is generated and the practitioner can follow several approaches for estimating the design parameters of interest for example one can a directly implement the synthetic runoff time series grimaldi et al 2013c sikorska et al 2018 b estimate the design peak discharge using common flood frequency analysis de paola et al 2018 c estimate the design hydrograph using a multivariate approach serinaldi grimaldi 2011 brunner et al 2017 or d separate the simulated hydrographs and apply a monte carlo method annis et al 2020 in the spirit of ungauged applications cosmo4sub is calibration free however it includes several parameters that are assigned through an empirical approach it was verified that some of them have a minor effect on the final results i e contributing area threshold for drainage network identification and others while others are crucial in detail c n curve number is the most influential since it is included in the excess rainfall analysis cn is quantified through look up tables and land use soil data information t s separation time included as well as in the excess rainfall step t s suggests when it is necessary to reset the initial abstraction in the nrcs cn method previous research identified 24 h as an appropriate value and finally the concentration time t c estimated using empirical equations that determines the wfiuh model base time 4 illustrative example data set description the eight rainfall models are calibrated using the uccle time series observed at 10 min resolution from 1 january 1898 to 31 december 2002 at the royal meteorological institute at uccle brussels belgium tu pham et al 2018 demareé 2003 this 105 year data set is clearly unique for its length and time resolution and moreover it is particularly accurate since measurements were provided by the same instrument in the same place and the data processing followed the same procedure ntegeka willems 2008 a summary of basic statistical characteristics of the uccle time series is available in the previously cited papers to apply the cosmo4sub model a small basin is selected in the uccle region fig 1 the watershed outlet collects a contributing area of 41 1 km2 mere cross section molenbeek river a tributary of deender river brussels west part fig 1b shows the digital elevation model dem resampled at 50 m of resolution copernicus land monitoring service eu dem the selected basin has a narrow shape and generally low slope elevation range 22 92 m a s l average slope 2 9 in order to define the drainage network a contributing area threshold at of 0 5 km2 is assumed while the concentration time t c results equal to 9 8 hours applying the nrcs equation nrcs 1997 concerning land use the corine land cover database at level iii and related to the year 2018 and look up tables nrcs 2008 allowed to quantify the nrcs curve number 64 4 the low value is mostly due to the agricultural areas 76 of the watershed area and the limited downstream urbanized region for a full catchment description see el sadek 2007 and willems 2014 in the present work the watershed is selected just to have available an illustrative example on which to apply the cosmo4sub model by using different rainfall time series as input although watersheds in belgium are affected by a variety of processes including snowfall here we limit interest to some of them as the obtained findings rely on comparative assessments in terms of the rainfall models used we believe that selected illustrative case study serves the needs of the proposed extreme event analysis in addition section 5 describes several comparison tests where the cosmo4sub input parameters are properly varied so the investigation becomes more effective 5 comparison test 5 1 experimental setup as previously stressed we do not aim to evaluate compare in general the performances of the eight rainfall models section 2 specifically we evaluate if the synthetic rainfall leads in generating realistic runoff time series and investigate which model is a good candidate to couple with the first sub model of the cosmo4sub framework indeed a universally optimal rainfall model for all hydrological studies might not exist on the contrary a detailed rainfall model evaluation should be performed in the context of specific practical applications we set two benchmarks for the comparison the observed 105 year uccle rainfall time series aggregated at 20 min resolution and the runoff time series still 105 year long at 20 min of resolution resulting from the cosmo4sub model applied using as input the observed rainfall time series since typically at least in europe rain gauge observed time series include a long period of daily data and a shorter period of sub hourly data due to the introduction of modern digital instruments we planned the rainfall model calibration assuming to have available 20 years at 20 min and 105 years at daily resolution specifically we selected the last 20 years of the observation period 1983 2002 assuming that in this period the high resolution data could be less affected by possible instrumental problems generally found at the beginning of the century note that previous analyses on the uccle time series ntegeka willems 2008 allowed to assume that it is reasonable to calibrate the rainfall models using the cycle stationarity condition in table 1 a summary of the eight rainfall models is provided listing the calibration data set not all the models are structured to use high and low time resolution rainfall data the calibration strategy and the number of parameters note that all procedures for rainfall modeling are performed separately for each month as previously mentioned in section 2 apart from mrc that accounts for the correlation between successive months this strategy is expected to facilitate the efficient modelling of the seasonal and heteroscedastic behaviors characterizing the daily and sub daily rainfall processes as the differences observed in the daily and sub daily rainfall patterns from season to season are usually considerable this strategy is usually preferred when long time series records are available salas et al 1982 papalexiou 2018 although it dramatically increases the number of the rainfall simulation model s parameters and or its algorithmic steps this is not considered an issue in the present work since it focuses on the case of favorable conditions in terms of data availability then a 1000 year long synthetic time series at 20 min resolution was simulated by each model and consequently used as input for the cosmo4sub model cosmo4sub model is applied using the basic configuration parameters see table 2 in grimaldi et al 2021 except for the cn and t c that were appropriately varied in order to achieve more representative results specifically the configuration core is cn 84 4 t c 9 8 h i e the same concentration time value estimated for the mere watershed case study but with a higher cn value we added 20 to the original value obtained from the corine land cover as described in section 4 in order to have richer sets of excess rainfall time series lower cn tends to significantly reduce the number of excess rainfall events and consequently the hydrographs this hydrological scenario is denoted in the following as hs1 we also investigate the results obtained with two additional configurations cn 74 4 and t c 9 8 h as well as cn 74 4 and t c 14 7 h which encompass a large part of the statistical variability associated with model parameter estimation see e g kaleris langousis 2017 allowing a preliminary evaluation of the model uncertainty effect in the comparison analysis these two scenarios are identified as hs2 and hs3 respectively in the following some statistical properties estimated on the simulated runoff time series are shown allowing for the comparison among models and the benchmark since cosmo4sub has the aim to provide design parameters for the hydrological application the described comparison mainly concerns the extreme value hydrographs moreover for sake of brevity comparisons among synthetic and observed rainfall time series are not included since the analysis is primarily oriented to the runoff 5 2 results all the models result in runoff time series that visually display a realistic behavior similar to that pertaining to the benchmark figure s1 of the supplementary material flood events are extracted from time series as sequences of positive discharge values without zeros each event is characterized in terms of the dry period prior to the event hereafter referred to as antecedent dry period when discharge is equal to zero due to null excess rainfall denoted here as d h the duration δ h the volume v 10 3 m3 and the peak value q m3 s those features depend on the alternation of rainy and dry periods in time the rainfall volume and its distribution in time and the cosmo4sub parameters ruling the hydrological response at the catchment scale as previously mentioned the most relevant cosmo4sub parameters are cn and t c we selected the aforementioned characteristics to provide an exhaustive overview of event properties being aware that q and v are the crucial parameters to focus on in the following we illustrate and compare through summary metrics the joint probability distributions of flood event characteristics as provided by the eight different rainfall models used to build runoff continuous time simulations and for the three different configurations of the rainfall runoff transformation i e hs1 hs2 and hs3 specifically results are described by analyzing i the average number of flood events section 5 2 1 ii the empirical marginal distributions of d δ v and q section 5 2 2 and iii the dependence structure among the flood variables δ v and q section 5 2 3 5 2 1 analysis of the average number of flood events the average number of flood events per year is reported in table 2 for each parametric configuration cn and t c for each rainfall model and compared to the benchmark uccle the number of events is close to the reference one for all the models apart from cs2 bl and mrc that significantly depart from it underestimating the reference number 35 26 25 respectively for hs1 when cn 84 4 an underestimation is obtained also with ns even smaller 18 again for hs1 results are similar for all the three cosmo4sub configurations meaning that the difference between each model and the reference time series is not due to rainfall runoff transformation obviously the number of events changes for all the models as a function of cn value which determines excess rainfall and runoff generation specifically the number of flood events decreases with cn also increasing t c influences the number of flood events by further reducing their number of flood events due to event aggregation but with a minor effect relative to cn the number of floods is expected to depend on the rainfall volume and distribution note that the average yearly rainfall amount which controls the discharge occurrence and volume apart from the hydrological losses is very similar to the uccle value for all the models with a slight overestimation by cs1 bl and ns 7 4 6 respectively and underestimation by cs2 8 see table s1 of supplementary material in this context the slight overestimation for bl and ns seems to contrast their previously mentioned underestimation for the average number of flood events but this is an expected result in fact if the calibration strategy is aimed towards good reproduction of the summary statistics of continuous sample series effective modelling of rainfall extremes is not guaranteed they are usually underestimated de luca galasso 2019 and the same holds for the magnitude and number of flood events as for rainfall distribution the alternation of dry and wet 20 min steps is very well reproduced by all models whereas larger differences 2 are observed for bl and mrc results at the daily scale are not coherent with those at the 20 min scale where one can observe generally larger differences in between 10 and 10 with the largest value being that for cs1 equal to 57 table s1 the difference between the 20 min and daily scales is due to the different organization of rainfall distribution in time provided by the models notwithstanding this results in terms of the number of discharge events are good especially for cs1 and cscb this means that the mechanism of runoff generation in the cosmo4sub framework plays a relevant smoothing effect as expected 5 2 2 analysis of empirical marginal distributions of d δ v and q figure 2 depicts the empirical probability distribution of flood event characteristics dry period d duration δ volume v and peak q expressed in terms of return periods t years i e the reciprocal of the exceedance probabilities for all the rainfall models and benchmark series we focus on return period values up to 100 years that is close to the length of the uccle time series note that the return period is not affected by the time dependence structure of d δ v and q time series volpi et al 2019 which is not negligible since all the flood events have been selected independently of their time spacing and magnitude moreover results are coherent with that pertaining to the series of annual maxima flood events figure not shown for sake of brevity the small number of flood events per year table 2 is generally associated with longer dry periods and or smaller event durations as shown in fig 2a and b cs2 generally overestimates the distribution of dry periods and slightly underestimates that of duration on the contrary bl captures satisfactorily the dry period and overestimates the duration all the other models well represent the distributions of dry period apart from mcgamdcb bgamdcb cscb and mrc that slightly underestimate the bulk of the distribution the duration of uccle flood events is well represented only by mrc and cscb while the other models generally underestimate it in terms of flood volume the models which better reproduce the benchmark are cs1 mrc and bl for return periods up to approximately 50 years for return periods equal to or larger than approximately 50 years also the cscb model performs relatively well see fig 2c and figure s2c and figure s3c of the supplementary material in terms of flood peak only cs1 mrc and cscb for return period larger than 50 years well reproduce the benchmark distribution all the other models generally underestimate both the volume and the flood peak further fig 2 refers to the reference cosmo4sub configuration hs1 cn 84 4 and t c 9 8 h but similar results have been obtained for the other two configurations hs2 and hs3 reported in figures s2 and s3 obviously when reducing cn the antecedent dry period increases while duration volume and peak slightly decrease conversely when increasing the concentration time t c the duration of the event increases also producing an increase in flood volume and a reduction of flood peak notwithstanding this the relative performance of the models with respect to uccle remains almost the same in order to provide a quantitative estimate of the model performance in terms of extremes we compute the relative error percentage with respect to the uccle benchmark related to the 20 year return period considering all the hydrological response scenarios table 3 the relative error is a measure of the simulation accuracy as for simulation uncertainty we provide a graphical quantification later on to evaluate the accuracy of the model we refer to 20 years because it is the largest return period value that could guarantee a robust quantile empirical estimate based on a 105 years length series as a matter of fact the best models for t 20 years are cscb in terms of the dry period cscb and mrc in terms of flood duration cs1 and bl in terms of flood volume and cs1 and mrc in terms of flood peak note that the error in flood peak estimation is generally larger than that pertaining to the other features note however that results are different for larger return periods see figures 2 s2 and s3 in order to provide an overview of the estimation uncertainty the empirical distribution functions for all the four investigated flood quantities are computed for each model by splitting the 1000 year simulated time series into 10 sub series of 100 years each i e approximately of the same length of the benchmark series hs1 fig 3 the figure provides a graphical estimation of the uncertainty associated with 100 year long synthetic simulations in practice we verify whether the benchmark is included in the ensemble of 100 year model scenarios or whether there exist irregular behaviors in other words the inclusion of the benchmark in the ensemble can be considered as a good sign of model capability to provide realistic simulations cs1 bl mrc and ns provide good results however bl and ns confirm to suffer due to a very high ensemble variability and somewhat unrealistic simulation of flood peaks among the bootstrap based modeling approach cscb is the only one providing good results for all flood event characteristics again the other two cosmo4sub parameter configurations hs2 and hs3 provide comparable results figure s4 s5 5 2 3 analysis of dependence structure among δ v and q to complete the description of flood events statistical distribution the dependence structure among the different variables considered is investigated fig 4 displays scatter plots among the most relevant variables i e duration δ volume v and peak q for hs1 dots i e flood events that significantly differ from the benchmark shape could represent unrealistic simulations see figures s6 and s7 for hs2 and hs3 which depict similar results the bulk of the joint distribution of duration volume and peak appears to be very well represented by all models with a larger dispersion only in the case of bl and mrc for extremes the models show larger differences for example cs1 and mrc depict a weaker dependence for large values of the variables while cs2 cscb bl and ns show a stronger correlation for clarity the dependence structure is summarized in terms of the non parametric kendall correlation coefficient τ table 4 the correlation is positive and significantly high 0 6 0 7 for the pairs δ v and δ q while that pertaining to volume and peak is even stronger being always larger than 0 9 as also emerges from fig 3 these high values are a consequence of the application of a rainfall runoff model that constrains the physical processes to the mechanisms represented note however that the correlation is only slightly affected by the model parameters that rule the generation and concentration of runoff apart from mrc that underestimates the correlation coefficients involving flood duration and cs1 and ns that overestimate them all the models reproduce satisfactorily the dependence structure on average when we limit the estimation of the correlation coefficient to the most intense events by only considering annual maxima we have correlation values generally smaller as expected yet a similar relative performance for all the methods compare table 5 to table 4 the performance of mrc is generally better for the benchmark configuration hs1 cn 84 4 t c 9 8 h kendall correlation is 0 35 0 15 and 0 75 on average for δ v δ q and v q respectively considering the entire flood sample the correlation between the variable pairs is more sensitive to the cosmo4sub parameters the most important effect is played by cn that enforces the correlation structure between all variables when its value is reduced to 74 4 6 summary and discussion following the quantitative description of the results provided in the previous section here the behavior and the performance of each model are summarized moreover in depth discussions are provided in light of the identified characteristics of the simulated rainfall time series not presented here for brevity and given our overall focus on runoff and flood event characteristics cs1 slightly overestimates the average yearly rainfall amount as it concentrates rainy spells in a few days as a consequence it produces a comparable number of flood events with respect to the uccle benchmark with appropriate antecedent dry intervals volume and peak but with a smaller duration due to the filter effect of the hydrological loss model the model provides satisfactory results realistic simulated flood events in terms of both marginal distributions and dependence structure cs2 reproduces well the rainy amount and distribution wet dry alternation and the number of flood events also the dependence structure among the characteristics of the flood events is similar to that pertaining to uccle however differently from cs1 it does not properly reproduce the marginal distributions of dry intervals duration volume and peak producing biased simulations probably because the ge1 distribution overestimated the rainfall extremes in general the bootstrap based disaggregation scheme used by bgamdcb cscb and mcgamdcb depicts a good rather expected efficiency in conditioning the number duration and peaks of the rainfall and discharge episodes in fact bgamdcb cscb and mcgamdcb behave similarly to cs2 specifically cs2 bgamdcb and mcgamdcb tend to underestimate duration volume and peaks while cscb generally overestimates these quantities the difference between the bootstrap based models can be attributed to the distribution function used which is the gamma distribution in the case of cs2 bgamdcb and mcgamdcb in fact the gamma distribution does not belong to the domain of attraction of the fréchet distribution on the contrary the cs1 and cscb frameworks simulate daily rainfall amount by utilizing the generalized gamma distribution which belongs to the domain of attraction of the fréchet distribution i e it has a sub exponential upper tail also bl and ns due to the similar modeling strategy yield comparable results with a slightly better performance of ns while depicting good rainfall statistics at the yearly scale bl and ns underestimate the number of flood events with respect to the uccle benchmark with appropriate antecedent dry intervals a slightly underestimated volume and peak but with larger bl and smaller ns duration further they provide satisfactory results in terms of marginal distribution variability and dependence structure apart from bl for which the dependence structure is somewhat unrealistic finally mrc provides generally very good results in terms of all summary metrics apart from those involving flood duration notwithstanding this and the small number of simulated flood events per year the model provides realistic simulations overall all models except for the cs2 and the three bootstrap methods are capable to reproduce in general realistic runoff time series that are coherent with the benchmark in terms of hydrograph peak and volume key quantities for the investigation of floods for return periods up to approximately 50 years therefore we identified four potential candidates for continuous hydrological modelling among the applied rainfall simulation models however while we believe that these behaviors could have general validity results could be partially conditioned upon the combinations of calibration data and strategies which are different for the various models see table 1 moreover a replacement of the gamma distribution e g with a three parameter distribution within the wider frameworks behind the bgamdcb and mcgamdcb models could be investigated in the future as it could lead to improvements in terms of extreme event characteristics and thus to new candidates for continuous hydrological modelling in fact it seems that the daily rainfall time series simulation procedures incorporated in these two models did not offer realistic flood event quantities to be allocated by the disaggregation scheme while the latter seems to be well performing in general terms as empirically proven by the performance of the cscb model further results could be partially conditioned upon the applied hydrological model here we are focusing on the specific cosmo4sub framework trying to identify one or more appropriate rainfall models to be used as input rainfall models have been designed with the aim to simulate time series of 20 min rainfall totals with statistical features comparable to the observed ones in our study area for several time scales up to 2 days with emphasis on extreme events widely studied in rainfall modelling though the design of idf curves this has been the target at that first stage as quantities related to the examination of floods would be and have been the focus after the rainfall runoff transformation looking at table 3 and fig 3 it becomes clear that several models offer promising performances and specifically the four models cs1 bl ns mrc show a percentage estimation error for the two crucial parameters i e peak and volume and return periods up to approximately 50 years see table 3 below 25 which is in line with the typical uncertainty of empirical modelling under ungauged conditions on the other hand for return periods equal to or larger than approximately 50 years the cscb model provides good performance with respect to the aforementioned criterion here again within the 20 see fig 3c d s2c d and s3c d while it mostly overestimates the two crucial quantities for smaller return periods probably because it allocates the entire volume simulated by its daily time series simulation scheme in a way that allows realistic values for larger return periods as we mention in the introduction this paper focuses on the ideal data rich condition continuous 20 year series at 20 min and 105 year at daily resolution while in the future we can assume to have such or similar availability of data in several watersheds the common condition is and will be very different we can classify two situations for the practitioner approach to study a small and ungauged basin i within or near the basin there is a rain gauge with a limited number of observations say 5 year long series at 20 min with an associated 25 year long daily series ii a rain gauge series is not available and then the practitioner who surely prefer this option refers to regional maps to extract the critical rainfall information like the embodied idf curve parameters in the first situation the rainfall model should be very parsimonious far from the configurations tested in this paper table 1 so future investigation will adapt the models or some of them creating a parsimonious version with the minimum number of parameters possible moreover such rainfall model versions could be also developed by setting up a user friendly spatial and regional tool like in kim et al 2017 for the second situation future investigation will focus on rainfall models that can be calibrated based directly on idf parameters and rainfall information at low resolution like monthly and annual that are widely available and not on the high resolution rainfall observations see de luca petroselli 2021 7 conclusions continuous modelling represents a modern approach for estimating design parameters in hydrological studies although it could offer promising advantages it has not been properly diffused in hydrologic research and engineering hydrology the main reason is probably the difficulty in identifying an appropriate and user friendly rainfall model to simulate synthetic time series at the sub daily level in order to be used as input for continuous hydrological modelling in this contribution we used a simplified continuous hydrologic model named cosmo4sub tailored for small and ungauged basins in order to feed the hydrologic model with synthetic rainfall time series we tested eight rainfall models two versions of the complete stochastic modelling solution named here cs1 and cs2 three versions of bootstrap based models named here bgamdcb cscb and mcgamdcb the classical bartlett lewis model named here bl and neymann scott rectangular pulses model named here ns and a mixed method based on monthly simulation and multifractal cascade disaggregation named here mrc assuming a data rich condition referring to one of the longest time series available at 10 min resolution we have evaluated the rainfall model simulations the comparison was performed by analyzing runoff time series obtained by the cosmo4sub model and using as input the rainfall time series simulated by the eight models and the observed ones we selected and investigated several general properties like the average number of flood events the marginal distribution of peak volume duration and the dry period prior to the flood and their dependence structure the obtained results support the conclusion that all models are capable of simulating realistic runoff time series in terms of several characteristics among them four models cs1 bl ns mrc provide an estimation error for hydrograph peak and volume compared to the benchmark for 20 year return period below 25 which is more than appropriate when compared to the uncertainty level common in ungauged applications the limitations of the proposed study which will be dealt in a follow up work relate to the choice of a simplified hydrological model that does not allow generalization of the obtained findings to the entire class of continuous modelling indeed cosmo4sub can be considered as the simplest continuous scheme possible since it does not include a variety of processes and it does not evaluate continuously water fluxes since its aim is to model extreme hydrographs with the minimal input information however the propososed framework is tranfarable to any basin and can be applied with different hydrologic models coupled with different rainfall models moreover in the illustrative example we demonstrated our framework assumed data rich conditions which is far from the typical data availability a practitioner must face for mitigating such limitations future research will focus on making the eight rainfall models more parsimonious and optimize them to be applicable for data scarce cases these efforts will include a more complete comparison of continuous hydrological modelling alternatives not limited to small and ungauged basins funding this work was supported by the italian ministry of the environment land and sea mite through the project simpro simulazione idrologico idraulico economica di progetto per la mitigazione del rischio idraulico and by the fwo project g003918n stochastic modelling of future extreme discharges as a tool for water resources engineering e v acknowledge funding from the italian ministry of education university and research miur in the frame of the departments of excellence initiative 2018 2022 attributed to the department of engineering of roma tre university credit authorship contribution statement salvatore grimaldi conceptualization funding acquisition supervision writing original draft writing review editing elena volpi conceptualization funding acquisition visualization writing original draft writing review editing andreas langousis conceptualization methodology writing review editing simon michael papalexiou conceptualization methodology writing review editing davide luciano de luca methodology writing review editing rodolfo piscopia methodology sofia d nerantzaki methodology writing review editing georgia papacharalampous methodology writing review editing andrea petroselli methodology writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 127866 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
3312,we develop a hydro chemical model to simulate incipient karst generation in three dimensional 3d jointed layered carbonates the discrete fracture networks consist of fractures that are represented by two dimensional 2d planes the numerical model couples the important physical processes of fluid flow reactive transport and dissolutional growth of fracture aperture we represent the typical layered joint systems by the synthetic fracture networks composed of two jointed layers separated by a horizontal bedding plane by considering a wide range of initial flow rates and aperture distributions of the joints and bedding plane the combined effects of the penetration length and the flow localization on karst evolution are systematically investigated the simulation results confirm that different flow regimes i e joint dominated transitional and bedding plane dominated may induce distinct features of incipient karst morphologies observed in nature i e pipe like stripe like and sheet like which is attributed to the flow reorganization and the scale alteration of effective flow region we further found the diversity of morphologies also depends on the initial penetration length which plays a primary role in controlling dissolution patterns in joint dominated systems in addition introducing the second joint set results in distinct 3d flow structure and dissolutional behavior comparing to single joint system our findings highlight the importance of 3d hydro chemical modeling for realistic engineering applications as the structural complexity of 3d fractured rocks may be underrepresented by the previous studies using simplified conduit networks keywords hydro chemical modeling incipient karst generation discrete fracture network layered carbonates 3d joint network 1 introduction karstified carbonate rocks are ubiquitously present in aquifers and hydrocarbon reservoirs fluid flow and mass transport are significantly heterogeneous in such systems due to the highly permeable conduits which are created by the progressive dissolution of pre existing fracture networks thus modeling karstic generation and evolution may provide a better understanding of the spatial distribution of the hydrodynamic and transport properties in karstified carbonate rocks which is of central importance for many geo engineering applications such as groundwater remediation ruggieri et al 2017 aminnaji et al 2020 dam construction dreybrodt et al 2002 romanov et al 2012 underground excavation lei et al 2017b zhao et al 2021 carbon sequestration islam et al 2016 geothermal development goldscheider et al 2010 and hydrocarbon production la bruna et al 2021 in the past extensive investigations have been conducted to model the reactive transport and karstification processes in fractured carbonates the fundamental theory of calcite dissolution and precipitation dates back to the early first order kinetics model developed by weyl 1958 but his theory cannot properly explain the paradox that the penetration length is theoretically within a few meters but the extended conduits under realistic conditions can be up to several kilometers long white longyear 1962 to address this issue white 1977 proposed a non linear kinetics model by introducing a kinetics trigger mechanism which was confirmed by the experimental data plummer wigley 1976 plummer et al 1978 the early coupled transport and dissolution modeling began from the dissolutional growth of a single one dimensional 1d conduit dreybrodt 1990 1996 palmer 1991 groves howard 1994b subsequently karst genesis simulations were extended to 2d heterogeneous discrete fracture networks dfns with variable aperture and topology groves howard 1994a siemers dreybrodt 1998 dreybrodt gabrovšek 2019 kaufmann braun 1999 these studies indicate an important positive feedback mechanism governing the karst evolution of fractured carbonate systems flow localization leads to the emergence of preferential flow paths which experiences higher dissolutional growth and these conduits with the increased aperture in turn capture more fluid from neighboring regions further enhancing the flow localization in addition several other models were proposed to couple karst genesis simulations of fracture networks with the complex effect of rock matrix flow kaufmann braun 2000 birk et al 2003 li et al 2020a rooij 2007 unsaturated flow gabrovšek dreybrodt 2010 kaufmann 2003a mixing corrosion gabrovšek dreybrodt 2000 kaufmann 2003b and realistic recharge boundary condition bauer et al 2005 rooij et al 2013 kaufmann 2009 further extended the conduit network model to 3d scenarios to study the effect of long term karst evolution on the short term spring response however most previous studies are based on a regularly interconnected pipe conduit network model which assumes a uniform dissolution front along individual fractures for a single fracture such a 1d representation may be not realistic because even a tiny variability in aperture can inevitably lead to the emergence of a highly localized reactive front which significantly accelerates breakthrough hanna rajaram 1998 szymczak ladd 2011 furthermore szymczak and ladd 2011 suggested that the added spatial dimension i e from 1d to 2d representation is more critical in controlling flow focusing and breakthrough time than the non linear dissolution kinetics also some other studies illustrated the important role of the penetration length and degree of aperture heterogeneity in evolving dissolution patterns of rough fractures cheung rajaram 2002 upadhyay et al 2015 therefore a more realistic and acceptable modeling for karst generation in 3d fractured rocks may be to use 2d discrete fracture planes embedded into 3d rock mass recently li et al 2020a developed a 3d comprehensive hydro chemical model which is able to describe the dissolutional growth of fractures with various apertures in three dimensions nevertheless the incipient karstification processes in 3d space are still poorly understood further investigations need to focus on the effect of 3d complex network structures topologies it is well known that limestones typically exist in a form of layers frequently containing strata bound bed normal joint sets separated by bedding planes e g belayneh cosgrove 2004 corradetti et al 2018 gross eyal 2007 meier et al 2015 odling et al 1999 wu pollard 1995 until now great efforts have been devoted to investigating the fluid flow through such layered joint systems no matter whether in the direction parallel to bedding plains e g belayneh et al 2006 hardebol et al 2015 jourde et al 2007 matthäi belayneh 2004 taylor et al 1999 or perpendicular e g doolin mauldon 2001 hardebol et al 2015 jourde et al 2007 morin et al 2007 wang et al 2017 whereas less attention has been paid to the karstification modeling based on such a realistic geometrical configuration in 3d space aliouache et al 2019 rehrl et al 2008 wang et al 2021 in nature it is widely recognized that the distribution of karst cavities tends to be localized rather than pervasive over the entire bedding plane filipponi et al 2009 jacquemyn et al 2012 knez 1998 speleogenesis simulations of a single fracture further provided evidence that the cave formation may be attributed to the positive feedback mechanism induced by flow localization hanna rajaram 1998 upadhyay et al 2015 although a single fracture cannot reflect the complex controlling mechanism of network topology it implies that an insight into how heterogeneously the solution fluid is distributed in jointed layered carbonates is significantly valuable for inferring the inception pattern of karst development in this respect our recent study has found that the aperture ratio of the joint sets to the bedding plane has a critical effect on the flow localization of 3d layered fracture systems wang et al 2017 the simulation results further suggest different aperture ratio tends to generate different flow regimes i e joint dominated transitional and bedding plane dominated which may be responsible for the initiation of three incipient karst types observed in the real world pipe like stripe like and sheet like karst however it is only an inference drawn based on flow simulations and physically based reactive transport modeling was not invoked the lack of hydro chemical modeling still limits our understanding of the spatial and temporal evolution of karst morphology here we aim to reproduce the incipient karst generation in jointed layered carbonates by developing a high fidelity three dimensional hydro chemical model the developed model makes it possible to explain the causes of the diversity of incipient karst morphologies formed in nature we focus on the role of aperture contrast among different types of discontinuity i e joints and bedding plane in the evolution of dissolution patterns respectively for a single joint set system and two orthogonal joint set systems wang et al 2017 furthermore this follow up work considers another important parameter i e initial flow rate determines the penetration length and accounts for the superimposed effect of aperture contrast on the karstification processes we emphasize the analysis of karst evolution characteristics on the bedding plane which reflects the dissolution dynamics in the whole system according to the shapes of developed karstic conduits simulated in this study we classify the types of incipient karst morphologies into pipe like karst stripe like karst and sheet like karst wang et al 2017 the remainder of the paper is organized as follows in section 2 the mathematical formulation of the 3d hydro chemical model is elucidated section 3 gives the details of model setup and implementation the simulation results are presented in section 4 in section 5 further discussions are given and a brief conclusion is drawn in section 6 2 hydro chemical model 2 1 mathematical models and governing equations the incipient karst generation in 3d joint layered rocks is modeled as a hydro chemical coupling process which includes the fluid flow reaction transport of ca2 and evolution of fracture aperture since the permeability of rock matrix is typically orders of magnitude lower than that of fractures in carbonates lucia fogg 1990 we assume that flow transport and dissolution only occur in fractures and the effect of rock matrix can be neglected groves howard 1994a hanna rajaram 1998 szymczak ladd 2011 the idealized representation has been widely accepted for understanding the complex flow and transport behaviors induced by the heterogeneity of fracture networks such as anomalous transport hyman et al 2019 kang et al 2017 2019 and network topology controlled karstification aliouache et al 2019 siemers dreybrodt 1998 in addition to focus on revealing the mechanism of how flow structure impacts dissolution process the effect of buoyancy driven instability hu et al 2021 wang et al 2022 is not considered the governing equations of the hydro chemical model within discrete fracture networks are described in detail as follows single phase flow of incompressible fluids through factures is governed by the following mass conservation equation hanna rajaram 1998 1 ρ b t ρ b v 0 where b is the fracture aperture ρ is the fluid density t is the time v is the velocity vector within fractures which can be given according to the poiseuille laminar flow through parallel plates 2 v b 2 12 μ p where p is the pressure μ is the fluid dynamic viscosity p is the pressure the reactive transport equation of ca2 in fractures is described as follows 3 bc t b v c b d c 2 r c where c is the concentration of ca2 d is the diffusion tensor the source term r c on the right hand side means the reaction flux of the calcite dissolution and the factor of two represents the reactive flux is contributed from the upper and lower fracture surfaces szymczak ladd 2011 the determination of r c depends on two serial processes 1 surface reaction and 2 diffusion rate for ca2 from the fracture surface to the main flow the two processes mainly dominate the overall reaction rate in the scenarios of small and large apertures respectively here we adopt the linear reaction kinetics model described by szymczak ladd 2011 who also have demonstrated that high order kinetics does not play a prominent role in driving the conduit evolution in a 2d fracture thus the expression of r c can be written as an effective form osselin et al 2016 szymczak ladd 2011 4 r c k eff c sat c 5 k eff k 1 2 k b dsh where k eff is the effective reaction rate coefficient c sat is the concentration of ca2 at saturation k is the reaction rate constant d is the solute diffusion constant sh is the sherwood coefficient then the evolution of fracture aperture can be calculated based on the local reactive flux 6 c sol db dt 2 r c where c sol is the molar concentration of calcite 2 2 model implementation and examination the hydro chemical model is implemented based on the finite element method comsol multiphysics 2019 the solution scheme has been successfully applied to the reactive solute transport modeling in 3d fractured rock mass but without the dissolution process li et al 2020b we discretize the model domain i e the discrete fracture networks with an unstructured grid of triangular finite elements the coupled system of governing equations is solved using a segregated approach where the fluid flow ca2 transport and aperture growth are updated sequentially within a single iteration comsol multiphysics 2019 the time stepping algorithm is based on the implicit backward difference formula bdf scheme which is self adaptive specifically before the solver advances to the next step numerous iterations are executed repeatedly during each time step and the relative error gradually converges below a predefined tolerance if the tolerance cannot be satisfied when a predefined maximum number of iterations is reached the solver will reduce the time step automatically and reiterate until a convergence is achieved we constrain the time step with a maximum value of δt max and a very small initial value of δt ini δt max 104 the time step can be increased progressively from δt ini to δt max when the convergence is excellent by comparing against the numerical simulation results of szymczak ladd 2011 the accuracy of our hydro chemical model has also been verified see more details in appendix a 3 model setup and implementation we consider a two layer carbonate rock consisting of vertically distributed strata bound joints separated by a horizontal bedding plane in the middle wang et al 2017 the joints in a single layer can be constructed by extruding a 2d fracture network as shown in fig 1 a to reproduce the realistic joint spacing governed by the mechanical interaction between individual joints pollard aydin 1988 the concept of stress shadow or relaxation zone around pre existing joints bai et al 2000a b renshaw pollard 1994 is integrated into the random fracture network generation process here we employ the generic dfn generator wang et al 2017 which has been further developed by considering truncation and extension of intersecting fractures sun et al 2021 the size of the model domain is 2 m length 2 m width 0 1 m height where the thickness of the top and bottom layers is the same i e 0 05 m here we consider a typical dimension ratio of jointed layered carbonates odonne et al 2007 and in the sequential analysis see section 4 3 a dimensionless penetration length defined by the ratio of initial penetration length to the model height is introduced to generalize the simulation results the joint trace lengths follow a lognormal distribution einstein baecher 1983 hudson priest 1983 where the mean value is 0 3 m and the variance is 0 3 two scenarios of the joint orientation are considered in this work 1 single joint set 2 two orthogonal joint sets fig 1b it is known that aperture distribution in a 3d fracture system is heterogeneous due to the fracture roughness hanna and rajaram 1998 li et al 2020a or stress loading lei et al 2015 lei et al 2017a however for simplification we assume a uniform aperture field for each discontinuity joint or bedding plane the aperture value for joints is identical while that of the bedding plane is defined separately such a setup may mimic the different geomechanical responses of jointed layered rocks under various differential stress conditions lei et al 2015 specifically we explore a range of aperture contrast ratios between the bedding plane and joint sets i e b bed b joint from 0 01 to 10 by fixing b joint 0 2 mm and varying b bed since the previous work has indicated that compared to b bed b joint the fracture intensity contrast between the two joint layers plays a secondary role in affecting the flow localization of the bedding plain wang et al 2017 thus we only consider one kind of scenario that the fracture intensities of the two layers are identical i e 200 joints are generated and p 32 defined as the ratio of the total surface area of joints to the rock volume is about 14 5 m 1 for every single layer for the flow boundary conditions a constant pressure gradient is imposed from the top fracture boundaries to the bottom ones fig 1c by adjusting the value of pressure gradient a desired initial total flow rate q 0 can be set up and then the pressure gradient is fixed during the whole reactive transport simulation here we further explore a range of q 0 from 5 10 8 m3 s to 1 10 6 m3 s for each case with a different b bed b joint no flow condition is assumed for the other outer boundaries fig 1c for the transport boundary conditions we assume the ca2 concentration at the inflow top boundary is 0 mol m3 other parameters of the hydro chemical model are listed in table 1 szymczak ladd 2011 we discretize the simulation domain using an unstructured grid of triangular finite elements with an element size of 0 005 m the number of triangular elements is around 960 000 and the number of degrees of freedom to be solved is up to 3 400 000 the predefined maximum time step δt max is 0 05 a we also have confirmed that using smaller values of mesh size and δt max have a minor effect on the trends in breakthrough time q q 0 3 and dissolution patterns for different cases the maximum number of iterations for each time step is 30 and the tolerance for controlling relative errors is 0 005 the solver is set to be terminated automatically once breakthrough or turbulent flow occurs the detection of turbulent flow is based on the first occurrence of a reynolds number 2100 i e re ρvb μ 2100 in anywhere within the computational domain according to the local flow velocity and aperture aliouache et al 2019 hanna rajaram 1998 4 results 4 1 influence of joint set number figure 2 shows the spatial distributions of aperture and local flow rate q bv at the breakthrough time for the different joint set models under the condition of q 0 2 5 10 7 m3 s and b joint b bed 0 2 mm the average initial penetration lengths i e l p0 q 0 2k at the inlet boundaries for the two cases are both 0 0085 m maximums are both 0 0175 m which are much less than the model height i e h 0 1 m at breakthrough although the aperture distribution is homogeneous in the whole domain many favored developed karstic conduits form within many joints fig 2a and c due to flow inhomogeneity induced by the geometrical structure high flow rates preferential spots of dissolution are concentrated on the regions that can efficiently transmit the fluid from the upper layer into the lower ones i e the shortest flow pathways fig 2e and g the bedding plane serves as an intermediate flow path where the highly localized dissolution pattern has a strong link with the geometrical distribution of the joints fig 2b and d it is noted that the dissolution regimes in the two cases are distinctive for the single joint set model the concentrated dissolution on the bedding plane takes place in the area between the adjacent upper and lower joints as a result the developed karst conduits tend to exhibit a narrow stripe like shape on the bedding plane fig 2b by contrast for the two joint sets model karst generation initiates directly from the intersections between the differently oriented upper and lower joints which leads to circle like vugs on the bedding plane fig 2d to quantitatively characterize the degree of heterogeneity of dissolution patterns on the bedding plane we further adopt the analysis of correlation dimension d 2 wang et al 2017 aliouache et al 2019 jiang et al 2019 which reveals the spatial distribution of a physical quantity on a geometric support bonnet et al 2001 the correlation dimension of aperture on the bedding plane d 2 b bed can be defined according to the generalized fractal dimension bonnet et al 2001 sanderson zhang 1999 7 d 2 b bed lim r 0 log i 1 n p i 2 log r where p i is the proportion of the cumulative amount of aperture within the i th square box of size r n is the total number of square boxes here we use a 20 by 20 grid superimposed on the bedding plane for the calculation of d 2 b bed a lower d 2 b bed indicates a higher degree of aperture heterogeneity on the bedding plane fig 3 shows the evolutions of correlation dimension of aperture on the bedding plane d 2 b bed and the breakthrough curves q q 0 for different joint set models furthermore to visualize the shape of developed karstic conduits on the bedding plane we also exhibit the aperture distribution normalized by its mean value b bed b bed b bed in 3d space at four different times in fig 4 at the early stage of karst generation t 0 1 a as the dissolution front does not arrive at the bedding plane the distribution of b bed remains uniform i e b bed 1 and d 2 b bed 2 figs 3 4a and e when the dissolution front arrives at the bedding plane t 1 a some small vugs emerge fig 4b and f and d 2 b bed starts to fall due to the heterogenous dissolutional growth fig 3 it is observed that a larger proportion of developed vugs tend to exhibit a circle shaped feature for the two joint sets case in comparison to the single joint set case where more vugs have a long length in y direction fig 4b and f as dissolution proceeds the small vugs progressively evolve into pipe shaped conduits fig 4c and g and d 2 b bed continues to decrease until t 2 5 a when d 2 b bed reaches the lowest value fig 3 during this period t 1 2 5 a the slope of d 2 b bed first gradually increases indicating the positive feedback mechanism accelerates the evolution procedure as the dissolution fronts on the bedding plane penetrate deeper some favored karstic conduits start to merge and then the slope becomes gentler after t 2 5 a due to the larger merged area d 2 b bed turns to increase fig 3 and a more sheet like karst rather than a pipe tends to form fig 4d and h overall there is no distinguishable difference between the two cases for the evolutions of d 2 b bed and q q 0 but the orientation of the developed conduits is controlled by the joint geometry 4 2 influence of aperture contrast ratio between the bedding plane and joints figure 5 shows the evolutions of q q 0 and d 2 b bed for different joint set models with various bedding plane to joint aperture ratios b bed b joint here the initial flow rates of these cases are fixed at 2 5 10 7 m3 s which means the average penetration length along inlet boundaries is initially the same for different cases furthermore we also exhibit their normalized aperture distributions on the bedding plane b bed at the breakthrough time in fig 6 the corresponding aperture distributions of joints are provided in the supplementary material figure s1 for the single flow models our simulation results confirm the inference of the previous work wang et al 2017 first wang et al 2017 indicated as b bed b joint increases from 0 01 to 10 the flow regime of the jointed layered rocks varies from the joint dominated flow to the transition zone and then to the bedding dominated flow and the flow field becomes less localized as a result the competition for flow among dissolved conduits becomes stronger aliouache et al 2019 cheung rajaram 2002 which further delays the breakthrough time significantly note the logarithmic time scale of fig 5a second the three flow regimes correspond well to the distinctive incipient karst types pipe like karst stripe like karst and sheet like karst quantified by an increasing final value of d 2 b bed fig 5b and fig 6 especially it is visible that as b bed b joint is reduced from 0 1 to 0 01 the number of preferential channels on the bedding plane decreases or spacing between them increases correspondingly the same number of preferential channels emerges on the joints for various b bed b joint cases and more uniform dissolutional front forms as the increase of b bed b joint figure s1 by contrast for the two joint sets models a distinctive reactive transport behavior occurs when b bed b joint 0 1 first the reduction of breakthrough time is much less sensitive to the decrease of b bed b joint fig 5a more interestingly we found that the breakthrough time even delays when b bed b joint decreases from 0 1 to 0 01 second although the trend that dissolution pattern becomes flatter with the increase of b bed b joint remains the location and number of developed conduits seem to be the same between the cases of b bed b joint 0 1 and 0 01 fig 6e and f moreover compared to the single joint set model the shape of the karstic pipes on the bedding plane tends to exhibit a feature like strings of beads to clearly show the intensity of competition among the preferentially developed conduits we normalize the time of d 2 b bed curves by their respective breakthrough time and further define t d as the normalized time when d 2 b bed starts to drop fig 5c a large t d means a small time proportion for favored karst conduits to develop from initiating to completely dominate the flow discharge of the system which also indicates that the number of competing candidates or developed conduits is small thus the system with a larger t d tends to form a larger spacing between developed karstic conduits see more evidence in the analysis of q 0 in section 4 3 note that t d is very large in the cases of b bed b joint 10 although the dissolution patterns are rather even it is because joints are grouped into several unions by the high conductivity bedding plane see the dotted lines in fig 6d and 6 h and figures s1d and h interestingly we found for the single joint set models t d first decreases and then increases with the decreasing of b bed b joint while for the two joints set models t d always decreases and become much less sensitive to the variation of b bed b joint once b bed b joint 1 fig 5c we also notice that for the single joint set case of b bed b joint 0 01 the evolution of d 2 b bed seems not to reach the valley point at breakthrough see the purple dotted circles marked in fig 5 which further indicates a large spacing between preferentially developed conduits the above phenomena highlight the critical role of the geometrical configuration of joints in the incipient karst generation of jointed layered rocks further explanation in section 5 4 3 influence of initial flow rate this section is to examine the effect of initial flow rate q 0 for the models of different flow regimes in this work q 0 is considered over a large range from 5 10 8 m3 s to 1 10 6 m3 s to generalize the simulation results we non dimensionalize the magnitude of q 0 by defining l p0 which is the average initial penetration length normalized by the model height i e l p0 l p0 h for single fracture models fig 7 shows the evolutions of d 2 b bed and breakthrough curves with various b bed b joint and initial flow rates q 0 and fig 8 exhibits the corresponding dissolution patterns on the bedding plane at breakthrough time here we respectively select an exemplary value of b bed b joint for each flow regime i e b bed b joint 0 01 0 5 and 10 and analyze the effect of four different flow rates i e q 0 5 10 8 m3 s 1 10 7 m3 s 5 10 7 m3 s and 1 10 6 m3 s corresponding to l p0 0 017 0 034 0 17 and 0 34 in general reducing the initial flow rate means a later breakthrough and more discernible conduits quantified by the increasing d 2 b bed figs 7 and 8 for joints see figure s2 simulation results indicate that the incipient karst type not only depends on the flow localization but also on the initial flow rate taking the b bed b joint 0 5 for example as l p0 increases from 0 017 to 0 34 the dissolution pattern first exhibits a pipe like feature and then a sheet like fig 8b k however we observe that if the system is joint dominated b bed b joint 0 01 it seems to present a pipe like shape even under a high l p0 fig 8g and if the system is bedding plane dominated b bed b joint 10 an almost uniform dissolution happens on the bedding plane i e d 2 b bed always keeps 2 once l p0 exceeds 0 17 fig 8i and l especially in the cases of b bed b joint 0 01 or 10 with a low l p0 0 034 an extremely abrupt breakthrough almost perpendicular to the time axis occurs see the orange dotted circles marked in fig 7 also the evolution paths of d 2 b bed do not reach the valley point see the purple dotted circles marked in fig 7 we notice that these cases are characterized by a large t d accompanied with the formation of only one or two preferential conduits fig 8a c d and f thus in such a condition of the initial flow and the aperture distribution a few but significantly large holes are likely to be induced by the strong flow focusing further explanation about the high heterogeneity of the developed karstic conduits can be found in the discussion section similar simulations are also conducted in the cases of two joint sets models which are shown in figs 9 and 10 in such two joint sets systems the distinguishable differences in comparison with the single joint set ones mainly exist in the joint dominated flow regime i e b bed b joint 0 01 in this condition although it is the same for the trend that fewer preferential paths develop t d increase with the decreasing of l p0 the sensitivity is significantly reduced and a great number of paths forms even under a low l p0 fig 10a and d for joints see figure s3 accompanied with the presence of a valley in the d 2 b bed curves fig 9d and g also it is observed that the sensitivity of breakthrough time to the variation of l p0 is largely reduced but the sensitivity of d 2 b bed at breakthrough is still high in addition as the flow regime transitions from joint dominated flow to bedding plane dominated flow the disparity between the two different joint set scenarios gradually narrows which highlights the controlling of the bedding plane to karstification processes of the jointed layered systems 5 discussion based on the simulation results we found that incipient karst conduits in 3d jointed layered rocks are controlled jointly by initial flow rates determines the initial penetration length and aperture contrast between the bedding plane and joints determines the degree of flow localization the effects of the initial penetration length and the flow localization on dissolution patterns are similar to observations from single fractures cheung rajaram 2002 szymczak ladd 2009 thus an intuitive conjecture arises that similar dissolution patterns may be achieved by similar parameter combinations of l p0 and b bed b joint to confirm the conjecture we plot the variation of d 2 b bed at the breakthrough time as a function of l p0 and b bed b joint for different joint set scenarios in fig 11 a and c it is observed that d 2 b bed at breakthrough decrease with the decreasing of l p0 and b bed b joint same values of d 2 b bed may be achieved by different combinations of the two parameters shown as the contours in fig 11 we further select six examples two for each flow regime in different joint set scenarios respectively fig 11a and c the values of d 2 b bed at breakthrough of these examples are all located in the color range of 1 8 d 2 b bed 1 9 which goes through all the explored b bed b joint from 0 01 to 10 the corresponding dissolution patterns are shown in fig 11b and d results indicate that the aforementioned conjecture is valid only when the two compared systems have a close b bed b joint or flow regime if the b bed b joint is large 5 the dissolution patterns of the bedding plane dominated regime exhibit a significant difference in comparison with the other two regimes which reveals a fundamental alteration of the flow structure may exist in addition we found that if the flow regime is joint dominated d 2 b bed is more sensitive to l p0 this phenomenon confirms that in such a system with high flow localization wang et al 2017 the initial flow rate has a primary control on the size and spacing of developed conduits szymczak ladd 2009 while the aperture contrast only poses a second order impact moreover this tendency seems to be more pronounced for the two joint sets model see the smaller slope of contours when d 2 b bed 1 8 in fig 11a to elucidate the combined effects of fracture geometry topology and flow structure alteration on the incipient karst type we plot the initial flow fields of the bedding plane for the different joint set models with b bed b joint 0 01 and b bed b joint 10 respectively in fig 12 the flow rate q 0 is normalized by the respective mean value for the models with small b bed b joint 0 01 the high flow rates are constrained around the intersections between the bedding plane and joints such a highly localized flow regime forms numerous small flow units high flow regions each involving several neighboring joints which tend to be the preferential sites for generating pipe shaped karsts by contrast if b bed b joint is large 10 the flow is rather evenly distributed along the bedding plane the boundaries among low flow regions become blurred and these regions tend to merge to focus a larger amount of flow as a result this transition leads to a qualitative alteration of the competition mechanism from among numerous narrow channels around individual joints to among a few large joint clusters see figure s2c and s3c eventually a single large dissolution area is likely to form under low initial flow rates see fig 8c and 10c this finding highlights the bedding plane induced scale alteration of effective potentially competing flow regions which is transformed from the scale of individual joints to the scale of the entire bedding plane appendix b also we found that flow reorganization may cause some high flow velocity regions in the cases of b bed b joint 0 01 to disappear in b bed b joint 10 see the red boxes in fig 12 and details in appendix b which explains that the location of major karstic conduits varies with various b bed b joint see fig 9 a and c based on the flow fields of the bedding plane in the cases of b bed b joint 10 fig 12c and d we also noticed that there is a similar flow structure between the single joint set and two joint sets models the similarity of the two systems can also be revealed from the almost same trend of the variation of d 2 b bed at breakthrough vs l p and b bed b joint in the class of bedding plane dominated flow regime fig 11a and c this phenomenon implies that the dissolution patterns in bedding plane dominated jointed layered carbonates seem to be insensitive to the orientations of joints in other words in such a configuration of b bed b joint geological observations about fracture length and intensity may be the most critical factor to the prediction of karst dissolution patterns as these parameters directly determine the bulk permeability and flow magnitude while the effects of fracture interconnectivity can be ignored by contrast when the value of b bed b joint is small 0 01 flow patterns exhibit different modes for the two different types of systems we further draw a simplified illustration of the two characteristic flow structures induced by the 3d geometrical configuration of joints in fig 13 for the single joint set models the high velocity regions exhibit a shape of narrow pipes with different sizes fig 12a it is because for such a fracture network topology fluid has to successively pass through three regions i the top layer ii the bedding plane and iii the bottom layer fig 13a and c and the size of region ii depends on the relative position of two neighboring upper and bottom joints fig 12a the key point for this system is that the different sizes of regions ii lead to disparities among individual flow units channels consequently when the initial flow rate is small dissolutional growth of the least resistant flow path tends to be amplified fig 8 similarly a higher degree of contrast between b bed and b joint also exists in the bedding plane dominated flow regime while its flow is limited by the joints rather than the bedding plane this competition mechanism between the bedding plane and joints interprets that the number of developed karstic conduits may first increase and then decrease with the decreasing of b bed b joint from 10 to 0 01 see the variation of t d in fig 5c and dissolution patterns in fig 8a c or d f in addition for the system with the t like junctions a recent study based on a 2d natural layered fracture network indicated the initial penetration length has a minor influence in the favored positions for enhanced karstification aliouache et al 2019 this phenomenon is also observed in the present study fig 8 a and d different from the single joint set models the main characteristic of flow structure in the two joint sets models is that some through going channels form due to the intersection between the top layer joints and the bottom layer joints fig 13b and d therefore more flow is focused to these intersections fig 12b in such a system these shortest channels are the main flow paths while the horizontal bedding plane induces local flow exchange among them fig 13b as b bed b joint decreases from 10 to 0 01 the effect of the bedding plane tends to be weakened when b bed b joint is 1 the transverse flow will be significantly limited such that the bedding plane only produces a secondary impact on the karstification process in comparison to the initial penetration length fig 11c a similar trend was also observed in a recent study about reactive flow in an anisotropic lattice grid roded et al 2020 in addition as b bed b joint decreases although more flow is concentrated in the through going channels and flow localization is enhanced wang et al 2017 high similarity among these channels still exists and even grows due to the similar flow paths which induces a stronger competition of preferentially developed conduits t d decreases in fig 5c as a result the reduction of breakthrough time is less pronounced in comparison to the single set model fig 5a even when b bed b joint 0 01 the breakthrough is delayed due to the sustained intense competition among similar flow channels cheung rajaram 2002 upadhyay et al 2015 our study highlights the critical importance of 3d hydro chemical modeling in understanding incipient karst generation in layered fractured carbonates many previous studies about speleogenesis simulations in fracture networks have been conducted based on a 2d lattice grid e g bauer et al 2005 dreybrodt gabrovšek 2019 roded et al 2020 where the flow is organized in a way like fig 13d although the simplified computational grid may provide useful insight into the critical role of penetration length and aperture heterogeneity in karstification processes two important mechanisms may be significantly underrepresented flow structure induced by network structural heterogeneity and flow focusing within individual fractures recently based on a 2d natural fracture network the important effect of network topology on the conduit evolution has been considered aliouache et al 2019 nevertheless the 2d structural heterogeneity still cannot sufficiently represent the complexity of realistic 3d geological structures for example fracture planes of different layers can cross at a point and one fracture can build connections with multiple neighboring fractures by the bedding plane in addition the understanding of wormhole formation in 2d single fractures cheung rajaram 2002 upadhyay et al 2015 needs to be extended to 3d our simulation results clearly show that only focusing on the penetration length of single fractures while without considering the aperture contrast between vertical joints and horizontal bedding planes we may incorrectly predict the dissolution patterns and breakthrough time for jointed layered carbonates moreover the findings in this study imply in situ stresses may play a critical role in the karst evolution of fractured carbonates because anisotropic stress conditions always induce distinctive responses of mechanical aperture for fractures of different orientations and dips lei et al 2015 lei et al 2017a for example the in situ stress scenario that vertical stress is much larger than horizontal ones may lead to the joint dominated flow regime due to the closure of the bedding plane we are also aware that because of the structural complexity of fractured rocks more efforts need to be taken to gain a deeper understanding of karstification processes in 3d in the future in the present work the fracture network is assumed to be highly idealized with a uniform aperture field within each individual fracture such an assumption is adopted to emphasize the effect of the geometrical configuration on flow origination and dissolution patterns it is true that fracture surfaces are rather rough and aperture distributions are spatially correlated szymczak ladd 2009 the realistic natural fracture networks may exhibit a much more complex feature such as fractal organization bonnet et al 2001 and vertical persistence of joints josnin et al 2002 moreover more realistic boundary conditions in nature fracture systems may gradually transition from the constant pressure gradient into the constant flow rate starchenko et al 2016 and the karstification processes may involve many complex physical and chemical mechanisms such as water rock co2 interaction li et al 2020a and buoyancy driven instability hu et al 2021 wang et al 2022 it is of great interest to incorporate these important geological characteristics and hydro chemical processes in modeling incipient karst generation in fractured carbonates which will be a focus of our follow up research 6 conclusions in this paper we developed a three dimensional hydro chemical model which represents the essential physical processes during incipient karst development i e fluid flow reactive transport and aperture growth this useful simulation tool allows us to well capture the karstification process in more realistic three dimensional discrete fracture networks consisting of fractures represented as low dimensional rectangular planes going beyond the previous modeling work mainly focusing on a single fracture surface and pipe conduit networks by exploring a large range of initial flow rates and aperture distributions of the joints and the bedding plane we have systematically investigated how penetration length and flow structure impact the evolution characteristics of incipient karst generation in 3d jointed fractured rocks we have confirmed that increasing the aperture contrast ratio of the bedding plane to joint sets tends to induce the transformation of incipient karst type on bedding surfaces from a pipe shaped feature to stripe shaped and then to sheet shaped a similar trend was also observed with the elevation of initial flow rate a proper combination of the two parameters can lead to a similar dissolution pattern but this is only true under certain flow regimes for the bedding plane dominated flow regime the high conductivity bedding plane strengthens the flow exchange among joints and reorganizes the flow structure by merging local small flow units into large ones the dissolution patterns in this flow regime tend to become insensitive to the orientation of joints for the joint dominated flow regime the initial flow rate has a primary control on dissolution patterns while the bedding plane to joint aperture ratio poses a second order impact the distinctive flow structure between models of single joint set and two joint sets lead to significantly different dissolution characteristics the breakthrough time in the former models decreases with the decreasing of aperture contrast and initial flow rates with a much higher sensitivity than the latter ones where even a delayed breakthrough was found at a small aperture contrast value credit authorship contribution statement chuanyin jiang formal analysis methodology writing original draft xiaoguang wang conceptualization formal analysis software writing review editing shengyan pu software writing review editing herve jourde resources writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments c j is supported by the china scholarship council csc from the ministry of education of p r china no 202006450151 x w is grateful for the support from national key research and development program of china china grant no 2020yfc1808300 national natural science foundation of china china grant no 42102300 science technology department of sichuan province grant nos 2021zycd004 2022yfsy0008 and state key laboratory of geohazard prevention and geoenvironment protection grant no sklgp2022k024 s p is grateful for the national natural science foundation of china grant no 41772264 the national key research and development program of china grant no 2020yfc1808300 and the research fund of state key laboratory of geohazard prevention and geoenvironment protection grant no sklgp2020z002 appendix a model validation we validate the hydro chemical model against the numerical simulation results reported by szymczak and ladd 2011 here both the one dimensional and two dimensional dissolutions of a single fracture are validated using the mechanical models as well as parameters consistent with their study in the one dimensional model of a single fracture the fracture is regarded as a 1d conduit with a length of 20 m and a uniform initial aperture of 0 2 mm in the two dimensional model the model domain is a 20 m 10 m fracture surface where the initial aperture field follows a normal distribution with a mean of 0 2 mm and a variance of 20 nm the resolution of the mesh grid is 5 cm the other parameters are the same as table 1 the initial volumetric flux q 0 q 0 b 0 v 0 is set as 10 7 m2 s corresponding to a hydraulic gradient of 0 01 and a damköhler number da kb 0 q 0 of 0 05 fig a1 a shows the comparison between analytical and numerical results for initial concentration distribution in a 1d single fracture our numerical model shows an excellent match with the analytical result which is given as szymczak ladd 2011 8 c 0 x c sat 1 e x l p fig a1b shows the evolution of concentration fields of our 2d model at different times the obtained wavelength and front thickness are similar to those of szymczak and ladd 2011 under the same condition of damköhler number fig a1c shows the evolutions of outlet volumetric flux with the assumption of linear kinetics which also indicates that our simulation results have a good match to those of szymczak and ladd 2011 appendix b alteration of the scale of effective flow region and dissolution area to more clearly show the alteration of the scale of effective flow regions with the variation of b bed b joint we plot the variation of p q 0 as a function of q 0 for the single joint set models with b bed b joint 0 01 and b bed b joint 10 in fig b1 a p q 0 means the area proportion of normalized flow rate larger than q 0 on the bedding plane for the model with a low b bed b joint the curve of p q 0 vs q 0 exhibits a large variation in the flow rate distribution and the high velocities are concentrated in some local areas by contrast for the model with a high b bed b joint the zone of significant decrease of p q 0 is narrowed implying an attenuation of the flow localization we further define the regions of q 0 0 5 as the effective flow regions which are the preferential sites for generating karstic conduits furthermore fig b1b and c exhibit the corresponding distributions of main flow regions in black and fig b1d and b1e exhibit the corresponding distributions of flow velocity vector for b bed b joint 0 01 p q 0 0 5 is 51 16 fig b1b and the effective flow region is organized as a network with the scale close to the joint network fig b1d however for b bed b joint 10 p q 0 0 5 is up to 82 02 fig b1c it is worth noting that the flow structure is reorganized to form a large effective flow network whose scale is close to the bedding plane fig b1e appendix c supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 127831 appendix c supplementary data the following are the supplementary data to this article supplementary data 1 
3312,we develop a hydro chemical model to simulate incipient karst generation in three dimensional 3d jointed layered carbonates the discrete fracture networks consist of fractures that are represented by two dimensional 2d planes the numerical model couples the important physical processes of fluid flow reactive transport and dissolutional growth of fracture aperture we represent the typical layered joint systems by the synthetic fracture networks composed of two jointed layers separated by a horizontal bedding plane by considering a wide range of initial flow rates and aperture distributions of the joints and bedding plane the combined effects of the penetration length and the flow localization on karst evolution are systematically investigated the simulation results confirm that different flow regimes i e joint dominated transitional and bedding plane dominated may induce distinct features of incipient karst morphologies observed in nature i e pipe like stripe like and sheet like which is attributed to the flow reorganization and the scale alteration of effective flow region we further found the diversity of morphologies also depends on the initial penetration length which plays a primary role in controlling dissolution patterns in joint dominated systems in addition introducing the second joint set results in distinct 3d flow structure and dissolutional behavior comparing to single joint system our findings highlight the importance of 3d hydro chemical modeling for realistic engineering applications as the structural complexity of 3d fractured rocks may be underrepresented by the previous studies using simplified conduit networks keywords hydro chemical modeling incipient karst generation discrete fracture network layered carbonates 3d joint network 1 introduction karstified carbonate rocks are ubiquitously present in aquifers and hydrocarbon reservoirs fluid flow and mass transport are significantly heterogeneous in such systems due to the highly permeable conduits which are created by the progressive dissolution of pre existing fracture networks thus modeling karstic generation and evolution may provide a better understanding of the spatial distribution of the hydrodynamic and transport properties in karstified carbonate rocks which is of central importance for many geo engineering applications such as groundwater remediation ruggieri et al 2017 aminnaji et al 2020 dam construction dreybrodt et al 2002 romanov et al 2012 underground excavation lei et al 2017b zhao et al 2021 carbon sequestration islam et al 2016 geothermal development goldscheider et al 2010 and hydrocarbon production la bruna et al 2021 in the past extensive investigations have been conducted to model the reactive transport and karstification processes in fractured carbonates the fundamental theory of calcite dissolution and precipitation dates back to the early first order kinetics model developed by weyl 1958 but his theory cannot properly explain the paradox that the penetration length is theoretically within a few meters but the extended conduits under realistic conditions can be up to several kilometers long white longyear 1962 to address this issue white 1977 proposed a non linear kinetics model by introducing a kinetics trigger mechanism which was confirmed by the experimental data plummer wigley 1976 plummer et al 1978 the early coupled transport and dissolution modeling began from the dissolutional growth of a single one dimensional 1d conduit dreybrodt 1990 1996 palmer 1991 groves howard 1994b subsequently karst genesis simulations were extended to 2d heterogeneous discrete fracture networks dfns with variable aperture and topology groves howard 1994a siemers dreybrodt 1998 dreybrodt gabrovšek 2019 kaufmann braun 1999 these studies indicate an important positive feedback mechanism governing the karst evolution of fractured carbonate systems flow localization leads to the emergence of preferential flow paths which experiences higher dissolutional growth and these conduits with the increased aperture in turn capture more fluid from neighboring regions further enhancing the flow localization in addition several other models were proposed to couple karst genesis simulations of fracture networks with the complex effect of rock matrix flow kaufmann braun 2000 birk et al 2003 li et al 2020a rooij 2007 unsaturated flow gabrovšek dreybrodt 2010 kaufmann 2003a mixing corrosion gabrovšek dreybrodt 2000 kaufmann 2003b and realistic recharge boundary condition bauer et al 2005 rooij et al 2013 kaufmann 2009 further extended the conduit network model to 3d scenarios to study the effect of long term karst evolution on the short term spring response however most previous studies are based on a regularly interconnected pipe conduit network model which assumes a uniform dissolution front along individual fractures for a single fracture such a 1d representation may be not realistic because even a tiny variability in aperture can inevitably lead to the emergence of a highly localized reactive front which significantly accelerates breakthrough hanna rajaram 1998 szymczak ladd 2011 furthermore szymczak and ladd 2011 suggested that the added spatial dimension i e from 1d to 2d representation is more critical in controlling flow focusing and breakthrough time than the non linear dissolution kinetics also some other studies illustrated the important role of the penetration length and degree of aperture heterogeneity in evolving dissolution patterns of rough fractures cheung rajaram 2002 upadhyay et al 2015 therefore a more realistic and acceptable modeling for karst generation in 3d fractured rocks may be to use 2d discrete fracture planes embedded into 3d rock mass recently li et al 2020a developed a 3d comprehensive hydro chemical model which is able to describe the dissolutional growth of fractures with various apertures in three dimensions nevertheless the incipient karstification processes in 3d space are still poorly understood further investigations need to focus on the effect of 3d complex network structures topologies it is well known that limestones typically exist in a form of layers frequently containing strata bound bed normal joint sets separated by bedding planes e g belayneh cosgrove 2004 corradetti et al 2018 gross eyal 2007 meier et al 2015 odling et al 1999 wu pollard 1995 until now great efforts have been devoted to investigating the fluid flow through such layered joint systems no matter whether in the direction parallel to bedding plains e g belayneh et al 2006 hardebol et al 2015 jourde et al 2007 matthäi belayneh 2004 taylor et al 1999 or perpendicular e g doolin mauldon 2001 hardebol et al 2015 jourde et al 2007 morin et al 2007 wang et al 2017 whereas less attention has been paid to the karstification modeling based on such a realistic geometrical configuration in 3d space aliouache et al 2019 rehrl et al 2008 wang et al 2021 in nature it is widely recognized that the distribution of karst cavities tends to be localized rather than pervasive over the entire bedding plane filipponi et al 2009 jacquemyn et al 2012 knez 1998 speleogenesis simulations of a single fracture further provided evidence that the cave formation may be attributed to the positive feedback mechanism induced by flow localization hanna rajaram 1998 upadhyay et al 2015 although a single fracture cannot reflect the complex controlling mechanism of network topology it implies that an insight into how heterogeneously the solution fluid is distributed in jointed layered carbonates is significantly valuable for inferring the inception pattern of karst development in this respect our recent study has found that the aperture ratio of the joint sets to the bedding plane has a critical effect on the flow localization of 3d layered fracture systems wang et al 2017 the simulation results further suggest different aperture ratio tends to generate different flow regimes i e joint dominated transitional and bedding plane dominated which may be responsible for the initiation of three incipient karst types observed in the real world pipe like stripe like and sheet like karst however it is only an inference drawn based on flow simulations and physically based reactive transport modeling was not invoked the lack of hydro chemical modeling still limits our understanding of the spatial and temporal evolution of karst morphology here we aim to reproduce the incipient karst generation in jointed layered carbonates by developing a high fidelity three dimensional hydro chemical model the developed model makes it possible to explain the causes of the diversity of incipient karst morphologies formed in nature we focus on the role of aperture contrast among different types of discontinuity i e joints and bedding plane in the evolution of dissolution patterns respectively for a single joint set system and two orthogonal joint set systems wang et al 2017 furthermore this follow up work considers another important parameter i e initial flow rate determines the penetration length and accounts for the superimposed effect of aperture contrast on the karstification processes we emphasize the analysis of karst evolution characteristics on the bedding plane which reflects the dissolution dynamics in the whole system according to the shapes of developed karstic conduits simulated in this study we classify the types of incipient karst morphologies into pipe like karst stripe like karst and sheet like karst wang et al 2017 the remainder of the paper is organized as follows in section 2 the mathematical formulation of the 3d hydro chemical model is elucidated section 3 gives the details of model setup and implementation the simulation results are presented in section 4 in section 5 further discussions are given and a brief conclusion is drawn in section 6 2 hydro chemical model 2 1 mathematical models and governing equations the incipient karst generation in 3d joint layered rocks is modeled as a hydro chemical coupling process which includes the fluid flow reaction transport of ca2 and evolution of fracture aperture since the permeability of rock matrix is typically orders of magnitude lower than that of fractures in carbonates lucia fogg 1990 we assume that flow transport and dissolution only occur in fractures and the effect of rock matrix can be neglected groves howard 1994a hanna rajaram 1998 szymczak ladd 2011 the idealized representation has been widely accepted for understanding the complex flow and transport behaviors induced by the heterogeneity of fracture networks such as anomalous transport hyman et al 2019 kang et al 2017 2019 and network topology controlled karstification aliouache et al 2019 siemers dreybrodt 1998 in addition to focus on revealing the mechanism of how flow structure impacts dissolution process the effect of buoyancy driven instability hu et al 2021 wang et al 2022 is not considered the governing equations of the hydro chemical model within discrete fracture networks are described in detail as follows single phase flow of incompressible fluids through factures is governed by the following mass conservation equation hanna rajaram 1998 1 ρ b t ρ b v 0 where b is the fracture aperture ρ is the fluid density t is the time v is the velocity vector within fractures which can be given according to the poiseuille laminar flow through parallel plates 2 v b 2 12 μ p where p is the pressure μ is the fluid dynamic viscosity p is the pressure the reactive transport equation of ca2 in fractures is described as follows 3 bc t b v c b d c 2 r c where c is the concentration of ca2 d is the diffusion tensor the source term r c on the right hand side means the reaction flux of the calcite dissolution and the factor of two represents the reactive flux is contributed from the upper and lower fracture surfaces szymczak ladd 2011 the determination of r c depends on two serial processes 1 surface reaction and 2 diffusion rate for ca2 from the fracture surface to the main flow the two processes mainly dominate the overall reaction rate in the scenarios of small and large apertures respectively here we adopt the linear reaction kinetics model described by szymczak ladd 2011 who also have demonstrated that high order kinetics does not play a prominent role in driving the conduit evolution in a 2d fracture thus the expression of r c can be written as an effective form osselin et al 2016 szymczak ladd 2011 4 r c k eff c sat c 5 k eff k 1 2 k b dsh where k eff is the effective reaction rate coefficient c sat is the concentration of ca2 at saturation k is the reaction rate constant d is the solute diffusion constant sh is the sherwood coefficient then the evolution of fracture aperture can be calculated based on the local reactive flux 6 c sol db dt 2 r c where c sol is the molar concentration of calcite 2 2 model implementation and examination the hydro chemical model is implemented based on the finite element method comsol multiphysics 2019 the solution scheme has been successfully applied to the reactive solute transport modeling in 3d fractured rock mass but without the dissolution process li et al 2020b we discretize the model domain i e the discrete fracture networks with an unstructured grid of triangular finite elements the coupled system of governing equations is solved using a segregated approach where the fluid flow ca2 transport and aperture growth are updated sequentially within a single iteration comsol multiphysics 2019 the time stepping algorithm is based on the implicit backward difference formula bdf scheme which is self adaptive specifically before the solver advances to the next step numerous iterations are executed repeatedly during each time step and the relative error gradually converges below a predefined tolerance if the tolerance cannot be satisfied when a predefined maximum number of iterations is reached the solver will reduce the time step automatically and reiterate until a convergence is achieved we constrain the time step with a maximum value of δt max and a very small initial value of δt ini δt max 104 the time step can be increased progressively from δt ini to δt max when the convergence is excellent by comparing against the numerical simulation results of szymczak ladd 2011 the accuracy of our hydro chemical model has also been verified see more details in appendix a 3 model setup and implementation we consider a two layer carbonate rock consisting of vertically distributed strata bound joints separated by a horizontal bedding plane in the middle wang et al 2017 the joints in a single layer can be constructed by extruding a 2d fracture network as shown in fig 1 a to reproduce the realistic joint spacing governed by the mechanical interaction between individual joints pollard aydin 1988 the concept of stress shadow or relaxation zone around pre existing joints bai et al 2000a b renshaw pollard 1994 is integrated into the random fracture network generation process here we employ the generic dfn generator wang et al 2017 which has been further developed by considering truncation and extension of intersecting fractures sun et al 2021 the size of the model domain is 2 m length 2 m width 0 1 m height where the thickness of the top and bottom layers is the same i e 0 05 m here we consider a typical dimension ratio of jointed layered carbonates odonne et al 2007 and in the sequential analysis see section 4 3 a dimensionless penetration length defined by the ratio of initial penetration length to the model height is introduced to generalize the simulation results the joint trace lengths follow a lognormal distribution einstein baecher 1983 hudson priest 1983 where the mean value is 0 3 m and the variance is 0 3 two scenarios of the joint orientation are considered in this work 1 single joint set 2 two orthogonal joint sets fig 1b it is known that aperture distribution in a 3d fracture system is heterogeneous due to the fracture roughness hanna and rajaram 1998 li et al 2020a or stress loading lei et al 2015 lei et al 2017a however for simplification we assume a uniform aperture field for each discontinuity joint or bedding plane the aperture value for joints is identical while that of the bedding plane is defined separately such a setup may mimic the different geomechanical responses of jointed layered rocks under various differential stress conditions lei et al 2015 specifically we explore a range of aperture contrast ratios between the bedding plane and joint sets i e b bed b joint from 0 01 to 10 by fixing b joint 0 2 mm and varying b bed since the previous work has indicated that compared to b bed b joint the fracture intensity contrast between the two joint layers plays a secondary role in affecting the flow localization of the bedding plain wang et al 2017 thus we only consider one kind of scenario that the fracture intensities of the two layers are identical i e 200 joints are generated and p 32 defined as the ratio of the total surface area of joints to the rock volume is about 14 5 m 1 for every single layer for the flow boundary conditions a constant pressure gradient is imposed from the top fracture boundaries to the bottom ones fig 1c by adjusting the value of pressure gradient a desired initial total flow rate q 0 can be set up and then the pressure gradient is fixed during the whole reactive transport simulation here we further explore a range of q 0 from 5 10 8 m3 s to 1 10 6 m3 s for each case with a different b bed b joint no flow condition is assumed for the other outer boundaries fig 1c for the transport boundary conditions we assume the ca2 concentration at the inflow top boundary is 0 mol m3 other parameters of the hydro chemical model are listed in table 1 szymczak ladd 2011 we discretize the simulation domain using an unstructured grid of triangular finite elements with an element size of 0 005 m the number of triangular elements is around 960 000 and the number of degrees of freedom to be solved is up to 3 400 000 the predefined maximum time step δt max is 0 05 a we also have confirmed that using smaller values of mesh size and δt max have a minor effect on the trends in breakthrough time q q 0 3 and dissolution patterns for different cases the maximum number of iterations for each time step is 30 and the tolerance for controlling relative errors is 0 005 the solver is set to be terminated automatically once breakthrough or turbulent flow occurs the detection of turbulent flow is based on the first occurrence of a reynolds number 2100 i e re ρvb μ 2100 in anywhere within the computational domain according to the local flow velocity and aperture aliouache et al 2019 hanna rajaram 1998 4 results 4 1 influence of joint set number figure 2 shows the spatial distributions of aperture and local flow rate q bv at the breakthrough time for the different joint set models under the condition of q 0 2 5 10 7 m3 s and b joint b bed 0 2 mm the average initial penetration lengths i e l p0 q 0 2k at the inlet boundaries for the two cases are both 0 0085 m maximums are both 0 0175 m which are much less than the model height i e h 0 1 m at breakthrough although the aperture distribution is homogeneous in the whole domain many favored developed karstic conduits form within many joints fig 2a and c due to flow inhomogeneity induced by the geometrical structure high flow rates preferential spots of dissolution are concentrated on the regions that can efficiently transmit the fluid from the upper layer into the lower ones i e the shortest flow pathways fig 2e and g the bedding plane serves as an intermediate flow path where the highly localized dissolution pattern has a strong link with the geometrical distribution of the joints fig 2b and d it is noted that the dissolution regimes in the two cases are distinctive for the single joint set model the concentrated dissolution on the bedding plane takes place in the area between the adjacent upper and lower joints as a result the developed karst conduits tend to exhibit a narrow stripe like shape on the bedding plane fig 2b by contrast for the two joint sets model karst generation initiates directly from the intersections between the differently oriented upper and lower joints which leads to circle like vugs on the bedding plane fig 2d to quantitatively characterize the degree of heterogeneity of dissolution patterns on the bedding plane we further adopt the analysis of correlation dimension d 2 wang et al 2017 aliouache et al 2019 jiang et al 2019 which reveals the spatial distribution of a physical quantity on a geometric support bonnet et al 2001 the correlation dimension of aperture on the bedding plane d 2 b bed can be defined according to the generalized fractal dimension bonnet et al 2001 sanderson zhang 1999 7 d 2 b bed lim r 0 log i 1 n p i 2 log r where p i is the proportion of the cumulative amount of aperture within the i th square box of size r n is the total number of square boxes here we use a 20 by 20 grid superimposed on the bedding plane for the calculation of d 2 b bed a lower d 2 b bed indicates a higher degree of aperture heterogeneity on the bedding plane fig 3 shows the evolutions of correlation dimension of aperture on the bedding plane d 2 b bed and the breakthrough curves q q 0 for different joint set models furthermore to visualize the shape of developed karstic conduits on the bedding plane we also exhibit the aperture distribution normalized by its mean value b bed b bed b bed in 3d space at four different times in fig 4 at the early stage of karst generation t 0 1 a as the dissolution front does not arrive at the bedding plane the distribution of b bed remains uniform i e b bed 1 and d 2 b bed 2 figs 3 4a and e when the dissolution front arrives at the bedding plane t 1 a some small vugs emerge fig 4b and f and d 2 b bed starts to fall due to the heterogenous dissolutional growth fig 3 it is observed that a larger proportion of developed vugs tend to exhibit a circle shaped feature for the two joint sets case in comparison to the single joint set case where more vugs have a long length in y direction fig 4b and f as dissolution proceeds the small vugs progressively evolve into pipe shaped conduits fig 4c and g and d 2 b bed continues to decrease until t 2 5 a when d 2 b bed reaches the lowest value fig 3 during this period t 1 2 5 a the slope of d 2 b bed first gradually increases indicating the positive feedback mechanism accelerates the evolution procedure as the dissolution fronts on the bedding plane penetrate deeper some favored karstic conduits start to merge and then the slope becomes gentler after t 2 5 a due to the larger merged area d 2 b bed turns to increase fig 3 and a more sheet like karst rather than a pipe tends to form fig 4d and h overall there is no distinguishable difference between the two cases for the evolutions of d 2 b bed and q q 0 but the orientation of the developed conduits is controlled by the joint geometry 4 2 influence of aperture contrast ratio between the bedding plane and joints figure 5 shows the evolutions of q q 0 and d 2 b bed for different joint set models with various bedding plane to joint aperture ratios b bed b joint here the initial flow rates of these cases are fixed at 2 5 10 7 m3 s which means the average penetration length along inlet boundaries is initially the same for different cases furthermore we also exhibit their normalized aperture distributions on the bedding plane b bed at the breakthrough time in fig 6 the corresponding aperture distributions of joints are provided in the supplementary material figure s1 for the single flow models our simulation results confirm the inference of the previous work wang et al 2017 first wang et al 2017 indicated as b bed b joint increases from 0 01 to 10 the flow regime of the jointed layered rocks varies from the joint dominated flow to the transition zone and then to the bedding dominated flow and the flow field becomes less localized as a result the competition for flow among dissolved conduits becomes stronger aliouache et al 2019 cheung rajaram 2002 which further delays the breakthrough time significantly note the logarithmic time scale of fig 5a second the three flow regimes correspond well to the distinctive incipient karst types pipe like karst stripe like karst and sheet like karst quantified by an increasing final value of d 2 b bed fig 5b and fig 6 especially it is visible that as b bed b joint is reduced from 0 1 to 0 01 the number of preferential channels on the bedding plane decreases or spacing between them increases correspondingly the same number of preferential channels emerges on the joints for various b bed b joint cases and more uniform dissolutional front forms as the increase of b bed b joint figure s1 by contrast for the two joint sets models a distinctive reactive transport behavior occurs when b bed b joint 0 1 first the reduction of breakthrough time is much less sensitive to the decrease of b bed b joint fig 5a more interestingly we found that the breakthrough time even delays when b bed b joint decreases from 0 1 to 0 01 second although the trend that dissolution pattern becomes flatter with the increase of b bed b joint remains the location and number of developed conduits seem to be the same between the cases of b bed b joint 0 1 and 0 01 fig 6e and f moreover compared to the single joint set model the shape of the karstic pipes on the bedding plane tends to exhibit a feature like strings of beads to clearly show the intensity of competition among the preferentially developed conduits we normalize the time of d 2 b bed curves by their respective breakthrough time and further define t d as the normalized time when d 2 b bed starts to drop fig 5c a large t d means a small time proportion for favored karst conduits to develop from initiating to completely dominate the flow discharge of the system which also indicates that the number of competing candidates or developed conduits is small thus the system with a larger t d tends to form a larger spacing between developed karstic conduits see more evidence in the analysis of q 0 in section 4 3 note that t d is very large in the cases of b bed b joint 10 although the dissolution patterns are rather even it is because joints are grouped into several unions by the high conductivity bedding plane see the dotted lines in fig 6d and 6 h and figures s1d and h interestingly we found for the single joint set models t d first decreases and then increases with the decreasing of b bed b joint while for the two joints set models t d always decreases and become much less sensitive to the variation of b bed b joint once b bed b joint 1 fig 5c we also notice that for the single joint set case of b bed b joint 0 01 the evolution of d 2 b bed seems not to reach the valley point at breakthrough see the purple dotted circles marked in fig 5 which further indicates a large spacing between preferentially developed conduits the above phenomena highlight the critical role of the geometrical configuration of joints in the incipient karst generation of jointed layered rocks further explanation in section 5 4 3 influence of initial flow rate this section is to examine the effect of initial flow rate q 0 for the models of different flow regimes in this work q 0 is considered over a large range from 5 10 8 m3 s to 1 10 6 m3 s to generalize the simulation results we non dimensionalize the magnitude of q 0 by defining l p0 which is the average initial penetration length normalized by the model height i e l p0 l p0 h for single fracture models fig 7 shows the evolutions of d 2 b bed and breakthrough curves with various b bed b joint and initial flow rates q 0 and fig 8 exhibits the corresponding dissolution patterns on the bedding plane at breakthrough time here we respectively select an exemplary value of b bed b joint for each flow regime i e b bed b joint 0 01 0 5 and 10 and analyze the effect of four different flow rates i e q 0 5 10 8 m3 s 1 10 7 m3 s 5 10 7 m3 s and 1 10 6 m3 s corresponding to l p0 0 017 0 034 0 17 and 0 34 in general reducing the initial flow rate means a later breakthrough and more discernible conduits quantified by the increasing d 2 b bed figs 7 and 8 for joints see figure s2 simulation results indicate that the incipient karst type not only depends on the flow localization but also on the initial flow rate taking the b bed b joint 0 5 for example as l p0 increases from 0 017 to 0 34 the dissolution pattern first exhibits a pipe like feature and then a sheet like fig 8b k however we observe that if the system is joint dominated b bed b joint 0 01 it seems to present a pipe like shape even under a high l p0 fig 8g and if the system is bedding plane dominated b bed b joint 10 an almost uniform dissolution happens on the bedding plane i e d 2 b bed always keeps 2 once l p0 exceeds 0 17 fig 8i and l especially in the cases of b bed b joint 0 01 or 10 with a low l p0 0 034 an extremely abrupt breakthrough almost perpendicular to the time axis occurs see the orange dotted circles marked in fig 7 also the evolution paths of d 2 b bed do not reach the valley point see the purple dotted circles marked in fig 7 we notice that these cases are characterized by a large t d accompanied with the formation of only one or two preferential conduits fig 8a c d and f thus in such a condition of the initial flow and the aperture distribution a few but significantly large holes are likely to be induced by the strong flow focusing further explanation about the high heterogeneity of the developed karstic conduits can be found in the discussion section similar simulations are also conducted in the cases of two joint sets models which are shown in figs 9 and 10 in such two joint sets systems the distinguishable differences in comparison with the single joint set ones mainly exist in the joint dominated flow regime i e b bed b joint 0 01 in this condition although it is the same for the trend that fewer preferential paths develop t d increase with the decreasing of l p0 the sensitivity is significantly reduced and a great number of paths forms even under a low l p0 fig 10a and d for joints see figure s3 accompanied with the presence of a valley in the d 2 b bed curves fig 9d and g also it is observed that the sensitivity of breakthrough time to the variation of l p0 is largely reduced but the sensitivity of d 2 b bed at breakthrough is still high in addition as the flow regime transitions from joint dominated flow to bedding plane dominated flow the disparity between the two different joint set scenarios gradually narrows which highlights the controlling of the bedding plane to karstification processes of the jointed layered systems 5 discussion based on the simulation results we found that incipient karst conduits in 3d jointed layered rocks are controlled jointly by initial flow rates determines the initial penetration length and aperture contrast between the bedding plane and joints determines the degree of flow localization the effects of the initial penetration length and the flow localization on dissolution patterns are similar to observations from single fractures cheung rajaram 2002 szymczak ladd 2009 thus an intuitive conjecture arises that similar dissolution patterns may be achieved by similar parameter combinations of l p0 and b bed b joint to confirm the conjecture we plot the variation of d 2 b bed at the breakthrough time as a function of l p0 and b bed b joint for different joint set scenarios in fig 11 a and c it is observed that d 2 b bed at breakthrough decrease with the decreasing of l p0 and b bed b joint same values of d 2 b bed may be achieved by different combinations of the two parameters shown as the contours in fig 11 we further select six examples two for each flow regime in different joint set scenarios respectively fig 11a and c the values of d 2 b bed at breakthrough of these examples are all located in the color range of 1 8 d 2 b bed 1 9 which goes through all the explored b bed b joint from 0 01 to 10 the corresponding dissolution patterns are shown in fig 11b and d results indicate that the aforementioned conjecture is valid only when the two compared systems have a close b bed b joint or flow regime if the b bed b joint is large 5 the dissolution patterns of the bedding plane dominated regime exhibit a significant difference in comparison with the other two regimes which reveals a fundamental alteration of the flow structure may exist in addition we found that if the flow regime is joint dominated d 2 b bed is more sensitive to l p0 this phenomenon confirms that in such a system with high flow localization wang et al 2017 the initial flow rate has a primary control on the size and spacing of developed conduits szymczak ladd 2009 while the aperture contrast only poses a second order impact moreover this tendency seems to be more pronounced for the two joint sets model see the smaller slope of contours when d 2 b bed 1 8 in fig 11a to elucidate the combined effects of fracture geometry topology and flow structure alteration on the incipient karst type we plot the initial flow fields of the bedding plane for the different joint set models with b bed b joint 0 01 and b bed b joint 10 respectively in fig 12 the flow rate q 0 is normalized by the respective mean value for the models with small b bed b joint 0 01 the high flow rates are constrained around the intersections between the bedding plane and joints such a highly localized flow regime forms numerous small flow units high flow regions each involving several neighboring joints which tend to be the preferential sites for generating pipe shaped karsts by contrast if b bed b joint is large 10 the flow is rather evenly distributed along the bedding plane the boundaries among low flow regions become blurred and these regions tend to merge to focus a larger amount of flow as a result this transition leads to a qualitative alteration of the competition mechanism from among numerous narrow channels around individual joints to among a few large joint clusters see figure s2c and s3c eventually a single large dissolution area is likely to form under low initial flow rates see fig 8c and 10c this finding highlights the bedding plane induced scale alteration of effective potentially competing flow regions which is transformed from the scale of individual joints to the scale of the entire bedding plane appendix b also we found that flow reorganization may cause some high flow velocity regions in the cases of b bed b joint 0 01 to disappear in b bed b joint 10 see the red boxes in fig 12 and details in appendix b which explains that the location of major karstic conduits varies with various b bed b joint see fig 9 a and c based on the flow fields of the bedding plane in the cases of b bed b joint 10 fig 12c and d we also noticed that there is a similar flow structure between the single joint set and two joint sets models the similarity of the two systems can also be revealed from the almost same trend of the variation of d 2 b bed at breakthrough vs l p and b bed b joint in the class of bedding plane dominated flow regime fig 11a and c this phenomenon implies that the dissolution patterns in bedding plane dominated jointed layered carbonates seem to be insensitive to the orientations of joints in other words in such a configuration of b bed b joint geological observations about fracture length and intensity may be the most critical factor to the prediction of karst dissolution patterns as these parameters directly determine the bulk permeability and flow magnitude while the effects of fracture interconnectivity can be ignored by contrast when the value of b bed b joint is small 0 01 flow patterns exhibit different modes for the two different types of systems we further draw a simplified illustration of the two characteristic flow structures induced by the 3d geometrical configuration of joints in fig 13 for the single joint set models the high velocity regions exhibit a shape of narrow pipes with different sizes fig 12a it is because for such a fracture network topology fluid has to successively pass through three regions i the top layer ii the bedding plane and iii the bottom layer fig 13a and c and the size of region ii depends on the relative position of two neighboring upper and bottom joints fig 12a the key point for this system is that the different sizes of regions ii lead to disparities among individual flow units channels consequently when the initial flow rate is small dissolutional growth of the least resistant flow path tends to be amplified fig 8 similarly a higher degree of contrast between b bed and b joint also exists in the bedding plane dominated flow regime while its flow is limited by the joints rather than the bedding plane this competition mechanism between the bedding plane and joints interprets that the number of developed karstic conduits may first increase and then decrease with the decreasing of b bed b joint from 10 to 0 01 see the variation of t d in fig 5c and dissolution patterns in fig 8a c or d f in addition for the system with the t like junctions a recent study based on a 2d natural layered fracture network indicated the initial penetration length has a minor influence in the favored positions for enhanced karstification aliouache et al 2019 this phenomenon is also observed in the present study fig 8 a and d different from the single joint set models the main characteristic of flow structure in the two joint sets models is that some through going channels form due to the intersection between the top layer joints and the bottom layer joints fig 13b and d therefore more flow is focused to these intersections fig 12b in such a system these shortest channels are the main flow paths while the horizontal bedding plane induces local flow exchange among them fig 13b as b bed b joint decreases from 10 to 0 01 the effect of the bedding plane tends to be weakened when b bed b joint is 1 the transverse flow will be significantly limited such that the bedding plane only produces a secondary impact on the karstification process in comparison to the initial penetration length fig 11c a similar trend was also observed in a recent study about reactive flow in an anisotropic lattice grid roded et al 2020 in addition as b bed b joint decreases although more flow is concentrated in the through going channels and flow localization is enhanced wang et al 2017 high similarity among these channels still exists and even grows due to the similar flow paths which induces a stronger competition of preferentially developed conduits t d decreases in fig 5c as a result the reduction of breakthrough time is less pronounced in comparison to the single set model fig 5a even when b bed b joint 0 01 the breakthrough is delayed due to the sustained intense competition among similar flow channels cheung rajaram 2002 upadhyay et al 2015 our study highlights the critical importance of 3d hydro chemical modeling in understanding incipient karst generation in layered fractured carbonates many previous studies about speleogenesis simulations in fracture networks have been conducted based on a 2d lattice grid e g bauer et al 2005 dreybrodt gabrovšek 2019 roded et al 2020 where the flow is organized in a way like fig 13d although the simplified computational grid may provide useful insight into the critical role of penetration length and aperture heterogeneity in karstification processes two important mechanisms may be significantly underrepresented flow structure induced by network structural heterogeneity and flow focusing within individual fractures recently based on a 2d natural fracture network the important effect of network topology on the conduit evolution has been considered aliouache et al 2019 nevertheless the 2d structural heterogeneity still cannot sufficiently represent the complexity of realistic 3d geological structures for example fracture planes of different layers can cross at a point and one fracture can build connections with multiple neighboring fractures by the bedding plane in addition the understanding of wormhole formation in 2d single fractures cheung rajaram 2002 upadhyay et al 2015 needs to be extended to 3d our simulation results clearly show that only focusing on the penetration length of single fractures while without considering the aperture contrast between vertical joints and horizontal bedding planes we may incorrectly predict the dissolution patterns and breakthrough time for jointed layered carbonates moreover the findings in this study imply in situ stresses may play a critical role in the karst evolution of fractured carbonates because anisotropic stress conditions always induce distinctive responses of mechanical aperture for fractures of different orientations and dips lei et al 2015 lei et al 2017a for example the in situ stress scenario that vertical stress is much larger than horizontal ones may lead to the joint dominated flow regime due to the closure of the bedding plane we are also aware that because of the structural complexity of fractured rocks more efforts need to be taken to gain a deeper understanding of karstification processes in 3d in the future in the present work the fracture network is assumed to be highly idealized with a uniform aperture field within each individual fracture such an assumption is adopted to emphasize the effect of the geometrical configuration on flow origination and dissolution patterns it is true that fracture surfaces are rather rough and aperture distributions are spatially correlated szymczak ladd 2009 the realistic natural fracture networks may exhibit a much more complex feature such as fractal organization bonnet et al 2001 and vertical persistence of joints josnin et al 2002 moreover more realistic boundary conditions in nature fracture systems may gradually transition from the constant pressure gradient into the constant flow rate starchenko et al 2016 and the karstification processes may involve many complex physical and chemical mechanisms such as water rock co2 interaction li et al 2020a and buoyancy driven instability hu et al 2021 wang et al 2022 it is of great interest to incorporate these important geological characteristics and hydro chemical processes in modeling incipient karst generation in fractured carbonates which will be a focus of our follow up research 6 conclusions in this paper we developed a three dimensional hydro chemical model which represents the essential physical processes during incipient karst development i e fluid flow reactive transport and aperture growth this useful simulation tool allows us to well capture the karstification process in more realistic three dimensional discrete fracture networks consisting of fractures represented as low dimensional rectangular planes going beyond the previous modeling work mainly focusing on a single fracture surface and pipe conduit networks by exploring a large range of initial flow rates and aperture distributions of the joints and the bedding plane we have systematically investigated how penetration length and flow structure impact the evolution characteristics of incipient karst generation in 3d jointed fractured rocks we have confirmed that increasing the aperture contrast ratio of the bedding plane to joint sets tends to induce the transformation of incipient karst type on bedding surfaces from a pipe shaped feature to stripe shaped and then to sheet shaped a similar trend was also observed with the elevation of initial flow rate a proper combination of the two parameters can lead to a similar dissolution pattern but this is only true under certain flow regimes for the bedding plane dominated flow regime the high conductivity bedding plane strengthens the flow exchange among joints and reorganizes the flow structure by merging local small flow units into large ones the dissolution patterns in this flow regime tend to become insensitive to the orientation of joints for the joint dominated flow regime the initial flow rate has a primary control on dissolution patterns while the bedding plane to joint aperture ratio poses a second order impact the distinctive flow structure between models of single joint set and two joint sets lead to significantly different dissolution characteristics the breakthrough time in the former models decreases with the decreasing of aperture contrast and initial flow rates with a much higher sensitivity than the latter ones where even a delayed breakthrough was found at a small aperture contrast value credit authorship contribution statement chuanyin jiang formal analysis methodology writing original draft xiaoguang wang conceptualization formal analysis software writing review editing shengyan pu software writing review editing herve jourde resources writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments c j is supported by the china scholarship council csc from the ministry of education of p r china no 202006450151 x w is grateful for the support from national key research and development program of china china grant no 2020yfc1808300 national natural science foundation of china china grant no 42102300 science technology department of sichuan province grant nos 2021zycd004 2022yfsy0008 and state key laboratory of geohazard prevention and geoenvironment protection grant no sklgp2022k024 s p is grateful for the national natural science foundation of china grant no 41772264 the national key research and development program of china grant no 2020yfc1808300 and the research fund of state key laboratory of geohazard prevention and geoenvironment protection grant no sklgp2020z002 appendix a model validation we validate the hydro chemical model against the numerical simulation results reported by szymczak and ladd 2011 here both the one dimensional and two dimensional dissolutions of a single fracture are validated using the mechanical models as well as parameters consistent with their study in the one dimensional model of a single fracture the fracture is regarded as a 1d conduit with a length of 20 m and a uniform initial aperture of 0 2 mm in the two dimensional model the model domain is a 20 m 10 m fracture surface where the initial aperture field follows a normal distribution with a mean of 0 2 mm and a variance of 20 nm the resolution of the mesh grid is 5 cm the other parameters are the same as table 1 the initial volumetric flux q 0 q 0 b 0 v 0 is set as 10 7 m2 s corresponding to a hydraulic gradient of 0 01 and a damköhler number da kb 0 q 0 of 0 05 fig a1 a shows the comparison between analytical and numerical results for initial concentration distribution in a 1d single fracture our numerical model shows an excellent match with the analytical result which is given as szymczak ladd 2011 8 c 0 x c sat 1 e x l p fig a1b shows the evolution of concentration fields of our 2d model at different times the obtained wavelength and front thickness are similar to those of szymczak and ladd 2011 under the same condition of damköhler number fig a1c shows the evolutions of outlet volumetric flux with the assumption of linear kinetics which also indicates that our simulation results have a good match to those of szymczak and ladd 2011 appendix b alteration of the scale of effective flow region and dissolution area to more clearly show the alteration of the scale of effective flow regions with the variation of b bed b joint we plot the variation of p q 0 as a function of q 0 for the single joint set models with b bed b joint 0 01 and b bed b joint 10 in fig b1 a p q 0 means the area proportion of normalized flow rate larger than q 0 on the bedding plane for the model with a low b bed b joint the curve of p q 0 vs q 0 exhibits a large variation in the flow rate distribution and the high velocities are concentrated in some local areas by contrast for the model with a high b bed b joint the zone of significant decrease of p q 0 is narrowed implying an attenuation of the flow localization we further define the regions of q 0 0 5 as the effective flow regions which are the preferential sites for generating karstic conduits furthermore fig b1b and c exhibit the corresponding distributions of main flow regions in black and fig b1d and b1e exhibit the corresponding distributions of flow velocity vector for b bed b joint 0 01 p q 0 0 5 is 51 16 fig b1b and the effective flow region is organized as a network with the scale close to the joint network fig b1d however for b bed b joint 10 p q 0 0 5 is up to 82 02 fig b1c it is worth noting that the flow structure is reorganized to form a large effective flow network whose scale is close to the bedding plane fig b1e appendix c supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 127831 appendix c supplementary data the following are the supplementary data to this article supplementary data 1 
3313,salt pollution in semi arid landscapes is detrimental to food production ecosystem biodiversity soil health and water supply high desert watersheds due to natural salt deposits are a key source of salinity in river basins although studies have aimed at simulating and estimating salt movement in these landscapes approaches have relied on lumped statistical procedures that treat salt as a conservative solute rather than a collection of reactive salt ions these approaches are limited in quantifying the source transport and fate of salt under both historical and future conditions this study presents a new physically based spatially distributed salinity transport model for watershed systems of various spatial scales the model combines the watershed model apex the groundwater model modflow the groundwater reactive transport model rt3d and a new salinity module to simulate the fate and reactive transport of eight major ions so4 2 cl co3 2 hco3 ca2 na mg2 k in soils aquifers and streams of a complex watershed system salt loading to streams occurs via surface runoff erosion runoff soil lateral flow and groundwater discharge the linked apex modflow salt model is applied to the price river watershed prw 4 886 km2 utah usa a portion of the salinity laden upper colorado river basin to estimate spatio temporal loadings from the various hydrologic pathways and total salt yield in the river during 1995 2015 results indicate that the vast majority 89 of dissolved salt in the price river and its tributaries is loaded by groundwater and that more than half of the salt is in the form of sulfate so4 erosion runoff due to rainfall events is responsible for only 1 5 of total salt yield in the prw total annual dissolved salt loading from the prw through its outlet is approximately 63 500 mg from the results we conclude that managing salinity in the prw may need to focus principally on groundwater and its sources keywords apex salinity modflow groundwater colorado river basin 1 introduction salinity in soils groundwater and surface waters threatens food production soil health ecosystem biodiversity and overall use of water resources in many regions of the world and has become a global water quality challenge thorslund and van vliet 2020 in particular soil salinization is a global threat to agricultural production i e crop yield decrease and soil fertility ivushkin et al 2019 hassani et al 2020 with approximately 10 of arable land affected by salinity and sodicity shahid et al 2018 total affected areas are approximately 1 billion hectares with salinity increasing in the western united states eastern australia mexico the middle east china mongolia and north and east africa abbas et al 2013 ivushkin et al 2019 high salinity in the colorado river system in the western u s annually causes approximately 300 million in economic damages bureau of reclamation 2013 salinization occurs both by natural primary and anthropogenic secondary causes with the latter due to irrigation vegetation clearing mining activities the use of road salt for deicing cañedo argüelles et al 2013 dugan et al 2017 and effluent from wastewater treatment plants primary salinization occurs due to natural weathering of rocks and soils williams 1999 hassani et al 2020 laden with salt minerals such as calcium sulfate caso4 calcium carbonate caco3 and sodium chloride nacl among many others the minerals dissolve in rainfall runoff soil water groundwater and stream water with the resulting salt ion mass transported via these hydrologic pathways to nearby streams rivers lakes and reservoirs primary salinization often occurs in closed drainage areas harper et al 2021 in semi arid and arid regions such as in australia china the middle east and the western u s and can be a major component of basin salt export for example in the upper colorado river basin ucrb more than half of the total salt loaded in the river network originates from natural non irrigated rangelands bureau of reclamation 2013 miller et al 2017 this paper focuses on primary salinization several studies have attempted to quantify the loading of salt from a watershed landscape to receiving waters these studies typically rely on computational methods to assess salinity storage and movement under historical conditions for a variety of reasons to determine the source and origin of salt to determine the transport pathways of salt and to investigate the influence of landscape type land use human population and climate on salt fate and transport whereas many modeling studies have been applied to salinity fate and transport in irrigated watersheds e g schoups et al 2005 burkhalter and gates 2006 singh and panda 2012 bailey et al 2019 relatively few studies have investigated salinity storage and transport in multiple use rangelands nauman et al 2019 used 30 m resolution maps of soil property and cover maps in conjunction with random forest regressions to relate in stream annual salinity loads to watershed features in the ucrb this approach assessed salt as a single constituent not accounting for chemical reactions such as precipitation dissolution of individual salt ions tuteja et al 2003 used the combined modeling platform of catsalt salt mobilization and washoff tuteja et al 2002 hydrus 2d soil water flow and salt transport at highly discretized steps šimůnek et al 1999 and flowtube one dimensional groundwater flow dawes et al 2000 to quantify water and salt balance for the mandagery creek catchment 1 688 km2 in southeastern australia tirabadi et al 2021 used a modified version of the swat model soil and water assessment tool arnold et al 1998 swat s to simulate a lumped salt transport method in a natural system the shour river basin 622 km2 in southern iran similar to the statistical applications in the ucrb these two studies do not consider individual salt ions and their respective chemical reactivity while swat s does simulate a variety of hydrologic processes in a process based manner the model uses the simplified groundwater module of swat to simulate groundwater transfer from the aquifer to streams in individual subbasins as groundwater salt loading to streams can be a major component of in stream salt mass groundwater flow and salt transport should be modeled in a spatially distributed manner according to the accepted groundwater flow theory there is no available approach that uses physically based and spatially distributed modeling for salt ion fate and reactive transport in coupled surface subsurface hydrologic systems such a tool is essential for investigating salt mobilization transport and export in both historical and predictive settings this paper presents a new coupled surface subsurface hydro chemical numerical model to quantify the fate and transport of salt ion species in high desert landscapes the model is comprised of a combination of three base modeling codes apex hydrologic model for watershed systems williams and izaurralde 2010 modflow groundwater flow in aquifer systems harbaugh 2005 niswonger et al 2011 and rt3d reactive transport of solutes in aquifer systems clement 1997 the linkage between apex and modflow has been demonstrated previously bailey et al 2021 this study uses a new version of apex modflow that includes rt3d subroutines to simulate solute transport in the aquifer system and a new salinity module that simulates the chemical fate and transport of eight major ions sulfate chloride carbonate bicarbonate calcium sodium magnesium and potassium in the soil aquifer and stream systems the new modeling system is referred to as apex modflow salt the model is applied to the price river watershed prw 4 886 km2 utah usa one of 99 subbasins of the ucrb to simulate salt ion storage and transport due to surface runoff rainfall driven erosion transport soil lateral flow percolation from the soil profile to the aquifer groundwater flow groundwater surface water interactions and precipitation dissolution of salt minerals in soil and aquifer material the model is tested against measured in stream salt ion loading and groundwater salt ion concentrations and used to estimate the hydrologic pathway of salt mass that enters the stream system and is thereby exported from the subbasin in section 2 we provide details of the apex modflow salt model in section 3 we present its application to the prw and discuss results within the context of the upper colorado river basin 2 model description apex modflow salt this section provides an overview of the apex modflow modeling framework and the inclusion of 1 the rt3d modeling code and 2 the salinity module the apex modflow linked hydrologic model has been tested previously for the price river subbasin the animas river watershed colorado usa and the middle bosque river watershed texas usa bailey et al 2021 section 2 1 provides an overview of the workflow of the apex modflow salt modeling code sections 2 2 2 5 provide details of the individual modeling codes and section 2 6 returns to the apex modflow salt workflow for further details and documentation 2 1 model overview the hydro chemical processes and workflow of the apex modflow salt model are summarized in figs 1 and 2 these will be explained in more detail in later sections the black text represents processes simulated by apex evapotranspiration et surface runoff soil lateral flow percolation channel routing and plant growth blue text represents geohydrologic processes groundwater flow groundwater surface water exchange and state variables groundwater head simulated by modflow red text represents salt ion transport processes simulated by rt3d salt ion transport concentration in groundwater salt ion mass exchange between groundwater and surface water and apex salt mass in surface runoff soil lateral flow erosion runoff and streamflow salt chemistry in the soil profile for all processes salt refers to eight individual salt ions so4 2 cl co3 2 hco3 ca2 na mg2 and k each ion is treated as an individual solute and can undergo chemical reactions during storage and transport whereas apex simulates water and salt transport at the catchment scale modflow and rt3d concurrently track groundwater volume and salt ion mass and associated groundwater head and salt ion concentration using a collection of grid cells that overlay the watershed area bailey et al 2021 these features are discussed in more detail in the following sections 2 2 apex model watershed modeling the apex model is a distributed continuous daily time step model capable of simulating hydrologic and water quality processes at the field to watershed scale according to 12 major components climate hydrology crop growth pesticide fate nutrient cycling erosion sedimentation carbon cycling management practices soil temperature economic budgets and subarea watershed routing the watershed is divided into subareas with surface runoff soil lateral flow and groundwater return flow simulated from the landscape of each subarea to the subarea stream subarea streams are connected throughout the watershed for routing of water from upstream to downstream nutrients pesticides and sediment are transported through the various hydrologic pathways the apex code is written in fortran and is freely available to the public https epicapex tamu edu model executables groundwater routines in the original apex modeling code are relatively simplistic hence a previous study bailey et al 2021 linked apex with modflow to simulate physically based spatially distributed groundwater modeling and groundwater surface water interactions see section 2 4 for details regarding this coupled model 2 3 modflow model groundwater modeling modflow niswonger et al 2011 is a groundwater flow model created and maintained by the united states geological survey the model solves the following conservation of mass equations wherein groundwater mass is accounted for in representative volumes of an unconfined aquifer 1 x f s k xx h x y f s k yy h y z f f k zz h z w φ f s t f s s s h t where y z are the three dimensions in the aquifer h is groundwater head l k is hydraulic conductivity l t ss is specific storage 1 t φ is porosity l3 l3 and is assumed equal to specific yield sy l3 l3 fs is the fraction of the cell thickness that is saturated and f f is a function of fs set to 1 for niswonger et al 2011 modflow also solves the conservation of mass equation for groundwater in confined aquifers but this study focuses on the interaction between land surface hydrologic processes as simulated by apex and groundwater in underlying unconfined aquifers equation 1 represents a water balance for a given volume of the aquifer with groundwater flow in out in the y and z directions sources and sinks e g recharge pumping discharge to streams seepage from streams represented by w and storage changes represented by the terms on the right hand side to calculate groundwater head h throughout an aquifer system i e solve equation 1 the aquifer domain is divided into cubic grid cells and the water balance of equation 1 is used to update groundwater storage and associated groundwater head h in each cell during each time step of a transient simulation the updated h values for each cell are then used to estimate groundwater flow direction and groundwater travel time throughout the aquifer 2 4 apex modflow the loose coupling between apex and modflow was presented by bailey et al 2021 as shown in fig 1 apex routines simulate surface runoff et plant growth soil lateral flow and deep percolation whereas modflow routines simulate groundwater storage groundwater head h and groundwater surface water interactions loose coupling occurs as apex passes soil percolation i e recharge from each subarea to the collection of modflow grid cells that reside within the subarea geographic boundaries see fig 2 for an example representation of four subareas in a small watershed and the grid cells that intersect each of these subareas gis intersection routines are used to geographically connect subareas to grid cells for the condition where a single cell intersects two subareas i e along the border of adjacent subareas the intersection is used to calculate a weighted averaged value of recharge to the grid cell modflow uses these recharge values in the w term in equation 1 along with cell by cell values of hydraulic conductivity specific yield and specific storage to simulate new groundwater storage and h values for each grid cell these new h values are used to calculate water exchange between grid cells and apex subarea streams for cells that intersect these streams using darcy s law more details are provided in bailey et al 2021 the linkage between apex subareas and modflow grid cells occurs on a daily time step modflow subroutines and necessary linkage subroutines are imbedded inside the apex modeling code to provide a single fortran code and executable the linked apex modflow model was tested for streamflow and groundwater head in the animas river watershed colorado new mexico 3 542 km2 the price river watershed utah 4 886 km2 and the middle bosque river watershed texas 470 km2 in bailey et al 2021 the calibrated and tested apex modflow model for the price river watershed is used in this study amended with the apex salinity module and rt3d code 2 5 new salinity module for apex as part of the watershed wide simulation of salinity fate and transport in this study a new salinity module was incorporated into the apex modeling code the module accounts for the transport of eight dissolved ions so4 2 cl co3 2 hco3 ca2 na mg2 and k within hydrologic pathways across the landscape in stream channels within the soil profile and within the saturated zone of the aquifer system chemical transport in the vadose zone is not simulated rather deep percolation and salt ion mass leaching are routed to the water table via a groundwater delay function reactive transport via groundwater flow is detailed in section 2 6 the salt ions are transported via surface runoff erosion runoff soil lateral flow and streamflow for surface runoff soil lateral flow and streamflow transport of each salt ion via water movement is simulated in apex in the same manner as nitrate no3 however each ion undergoes chemical reactions as detailed below for erosion runoff a new routine was added to simulate the concentration mg l of total dissolved solids tds in the runoff water based on rainfall runoff experiments performed by the blm colorado river basin report blm 2015 in the desert shrublands of the ucrb the following polygon regression relationship was developed kim et al 2021 and incorporated into the apex code 2 tds 160256 1 246 x 1 0 0901 x 2 2 0 00031 x 2 3 1 296 x 3 17 44 x 4 0 1557 x 4 2 1 287 x 5 60865 x 6 7659 x 6 2 319 x 6 3 171 x 7 14 03 x 7 2 where tds is in mg l x1 mm of runoff during a rain event x2 sediment concentration g l x3 rock fraction of the soil x4 sodium adsorption ratio sar x5 cation exchange capacity cec mg l x6 ph of the soil water and x7 electrical conductivity ec of the soil water runoff mm and sediment concentration g l are simulated by apex during a rainfall event the sar and cec equations are calculated using simulated ion concentrations for the user defined top soil layer in the watershed according to 3 sar n a 0 5 m g 2 c a 2 4 cec c ca c mg c k c na where c represents the concentration of the salt ions usually from a soil paste extraction method rock fraction electrical conductivity and ph are assumed constant and obtained from soil surveys of the watershed once the tds concentration is estimated during a rain event the concentration of each salt ion in the runoff is calculated by taking the ratio of salt ion to tds in the soil water of the top soil layer as with salt ion mass in surface runoff and soil lateral flow the salt ion mass associated with erosion runoff is transported to the subarea stream to be routed through the river system of the watershed the salinity chemistry implemented into apex is based on the salinity equilibrium chemistry sec module of shapiro and shapley 1965 and tavakoli kivi et al 2019 developed for soil and aquifer systems equations for salt ion solution chemistry are similar to those in other water chemistry models e g unsatchem šimůnek et al 2012 phreeqc parkhurst and appelo 2013 these equations are applicable for both soil and water salt mineral dissolution the sec module includes five salt minerals and eight ions that are dissolved from these minerals caso4 caco3 mgco3 nacl mgso4 the concentration of species at equilibrium is calculated using a stoichiometric algorithm approach solving mass balance and mass action equations simultaneously lindsay 1979 parkhust and appelo 2013 the mass balance and mass action equations are provided in shapiro and shapley 1965 lindsay 1979 and tavakoli kivi et al 2019 a key feature of the sec module is the ideal simulation of precipitation and dissolution of salt minerals due to the prevalence in soils and aquifers of many landscapes for example gypsum caso4 can dissolve or precipitate according to the stoichiometric reaction 5 cas o 4 ca 2 so 4 2 the caso4 will dissolve if the solution is under saturated in regards to ca2 and so4 2 and will precipitate if the solution is super saturated with a solubility product constant 6 k s p cas o 4 ca 2 so 4 2 caso 4 similar equations are included for the other salt minerals caco3 mgco3 mgso4 and nacl within the module minerals are added to the apex soil layers with the solubility limits of each mineral used to determine the direction of each reaction precipitation or dissolution salt ion chemistry for soil layers is simulated in the new salt chem soil f subroutine in the apex code 2 6 rt3d salt reactive transport of salt ions in groundwater reactive transport of salt ions in groundwater is simulated using the rt3d reactive transport in 3 dimensions modeling code included in the apex modflow code as a subroutine that is called on a daily time step once the modflow routines have finished the rt3d code was modified for this study to include the transport of the eight salt ions the rt3d model simulates the reactive transport of solutes according to advection dispersion and chemical reactions using the groundwater head h cell by cell flow data and groundwater source sink flow rates w from modflow the mass of each solute is tracked according to the following conservation of mass advection dispersion reaction equation 7 ϕ c k t x i ϕ v i c k x i ϕ d ij c k x j q s c s k ρ b c k t ϕ r k 1 2 m where m is the total number of solutes ck is the concentration of the k th species mflf 3 where f denotes the fluid phase dij is the hydrodynamic dispersion coefficient l2t 1 v is the average seepage velocity lbt 1 provided by modflow where b denotes bulk aquifer material ϕ is soil porosity lf 3lb 3 qs is the volumetric flux of water representing sources and sinks as provided by modflow lf 3t 1lb 3 c s k is the concentration of the source or sink mflf 3 r represents the rate of all reactions that occur in the aqueous phase for the k th species mflf 3t 1 ρb is the bulk density of the porous media mblb 3 and c k is the concentration of the k th species sorbed on solids mf mb 1 the concentration c of each solute is solved for at each grid cell of the aquifer domain using the same grid as modflow for this study equation 7 is repeated for each of the 8 salt ions resulting in a system of equations that is solved during each daily time step for example the equation for so4 is 8 ϕ c s o 4 t x i ϕ v i c s o 4 x i ϕ d ij c s o 4 x j q rech c s o 4 a p e x q gw s w c s o 4 q sw g w c s o 4 a p e x where rech gw sw and sw gw represent volumetric flow rate of recharge groundwater discharge to streams and stream seepage to groundwater the subscript apex indicates that the concentration of the salt ion comes from the apex subroutines therefore the concentration of so4 in the recharge water is based on the so4 mass that leaches from the subarea soil profile to the rt3d grid cells similarly the concentration of so4 in the stream seepage water is based on the so4 mass in the subarea stream salt ion chemistry in the aquifer system is simulated in the same manner as in the apex subarea soil layers using the equations of the sec module for each time step rt3d first solves for the concentration of each salt ion at each grid cell according to equation 7 with these concentrations then provided to the sec module to update salt ion concentrations according to the equilibrium chemistry equations 2 7 apex modflow salt the modeling framework constructed in this study uses the apex modflow code of bailey et al 2021 the new salinity module for apex soil and water processes and rt3d as modified to simulate salt ion reactive transport in the aquifer system the new apex modflow salt modeling code is detailed in fig 2 inputs include standard apex model inputs daily weather data soil data topographic slope via a dem and land use standard modflow inputs cell size aquifer hydraulic conductivity specific yield porosity and initial groundwater head for each grid cell inputs for the salinity module in the apex routines soil salt mineral fractions solubility constant for each salt mineral and initial soil water salt ion concentrations and inputs for the salinity module in the rt3d routines aquifer salt mineral fractions solubility constants and initial groundwater salt ion concentrations the salinity inputs are provided in two files salt input for soil data and rt3d salt for groundwater data the code structure fig 2 follows the original apex code for land surface and soil hydrologic and chemical simulations with the addition of a subroutine for soil salt ion chemistry followed by the call to the modflow subroutine which then calls rt3d as a subroutine before modflow and rt3d are called linking subroutines are called that prepare apex data soil percolation channel stage soil percolation salt ion mass in channel salt ion concentration for use by modflow and rt3d at the conclusion of the modflow and rt3d routines groundwater surface water exchange rates and groundwater surface water salt ion exchange mass are provided to the subarea channels along with surface runoff erosion runoff and soil lateral flow the water and salt ion mass added to the subareas from these sources are then routed from subarea to subarea through the watershed channel network the apex modflow rt3d routines and routing are performed on a daily time step key hydrologic outputs include surface runoff soil lateral flow subarea river discharge groundwater head and groundwater surface water exchange rates salinity outputs include daily mass fluxes kg day in each transport pathway surface runoff rainfall erosion soil lateral flow and groundwater surface water exchange and state variables such as soil water salt ion concentration mg l in river salt ion concentrations and groundwater salt ion concentration mg l daily mass budgets are tracked for salt ion mass in surface runoff soil lateral flow erosion runoff soil layers precipitation dissolution soil leaching groundwater discharge to streams and stream seepage to groundwater and output according to subarea and the entire watershed salt ion mass budget calculations are stored in the new salt budget f subroutine in the apex code 3 model application price river watershed ucrb 3 1 study region overview the price river watershed utah is one of 99 huc8 subbasins in the upper colorado river basin ucrb see fig 3 a for a map of the ucrb subbasins with the prw outlined in red due to a natural landscape with salt laden geologic materials the ucrb discharges millions of tons of salt to the lower colorado river basin annually resulting in approximately 300 million in damages to crop yield irrigation systems and public supply water systems per year bureau of reclamation 2013 the principal source of salt in the ucrb is natural salt minerals in the volcanic and sedimentary parent rock which dissolve due to runoff and infiltration of rainwater snowmelt and irrigation water once dissolved salt mass can be transported to streams via hydrologic pathways surface runoff soil lateral flow groundwater and saline springs salt mass in surface soils can also be transported via rainfall erosion weltz et al 2014 cadaret et al 2016 the price river watershed prw fig 3b covers 4 886 km2 in carbon emery utah wasatch sanpete and duchesne counties utah elevation ranges from 3 293 m to 1 408 m the inset in fig 3 shows the topographic elevation from the mountain areas to the lower elevation areas the climate is semi arid with an average rainfall of 395 mm yr and an average snowfall of 580 mm yr with average monthly temperatures ranging from 15 6 c january to 32 7 c july the majority of streamflow originates from snowmelt from the wasatch plateau west and the book cliffs east with the price river flowing to the southeast to its outlet to the green river fig 3b the prw is comprised of forested mountain areas high desert shrubland and irrigated cultivation along river and tributary corridors in the lower elevation areas of the watershed the primary landcover type is shrubland 59 evergreen forest 24 and deciduous forest 11 fig 3c shows an example of the arid nature of the landscape the soils of the prw have a high content of calcium carbonate caco3 and gypsum caso4 see soil mineral maps in section 3 2 geologic units include sandstone shale siltstone mudstone in both the upper and lower regions of the prw with slope wash deposits and alluvium clay silt sand granules pebbles and cobbles along the drainage areas of the price river stream system see hydraulic conductivity map in section 3 2 salt loading is high in the prw stream system for the usgs stream site 09 314 500 for the price river at woodside utah https waterdata usgs gov nwis usgs 2021 at the outlet of the watershed see fig 3b for 71 days between june 2007 and december 2015 for which salt ion concentrations were measured average salt loading is approximately 200 000 kg day of this dissolved salt approximately 65 is in the form of so4 average in stream concentration of dissolved so4 is 970 mg l ranging from 149 to 2 330 mg l and average of dissolved ca is 147 mg l ranging from 24 to 272 mg l groundwater data groundwater levels water quality measurements were obtained from the usgs https waterdata usgs gov nwis gw usgs 2021 for the network of 32 monitoring wells shown in fig 3b groundwater levels range from a few meters below the ground surface near the streams to tens of meters below the ground surface groundwater salt ion concentrations are available for these same wells with one sample for each well between september 17 1975 and april 27 1989 3 2 model construction and simulation the construction calibration and testing of the apex modflow model of the prw were presented in bailey et al 2021 this coupled model was used as the baseline hydrologic model for this study fig 4 shows the basic setup of the apex modflow salt model the center map shows the watershed boundary apex subareas apex streams the modflow grid same grid as used by rt3d and modflow cells that intersect apex streams i e river cells groundwater surface water exchange rates and salt ion mass exchange are simulated only for river cells the modflow rt3d grid cells are specified as 1000 m on a side resulting in 99 rows and 91 columns with a single layer representing the unconfined aquifer there are a total of 1 036 river cells the watershed was divided into 169 subareas based on a 30 m national elevation dataset http ned usgs gov subarea areas range from 0 002 km2 to 119 km2 with an average of 26 9 km2 daily precipitation and maximum and minimum air temperature were obtained from the noaa national climate data center as described in worqlul et al 2021 and white et al 2017 datasets used in constructing the apex modflow salt model are listed in table 1 with spatial resolution and sources the maps on the left in fig 4 show example input for apex precipitation annual average precipitation is shown to provide context for spatial weather patterns but daily weather data are used by the model and soil survey geographic database ssurgo available online at https websoilsurvey sc egov usda gov app homepage htm accessed march 15 2019 salt mineral fraction maps provided by the usda natural resources conservation service https datagateway nrcs usda gov for salt mineral fractions values of caco3 and gypsum were spatially averaged over each subarea for model input the maps on the right show input for modflow hydraulic conductivity based on geologic maps of the prw ground surface elevation from a dem and aquifer thickness the depth to bedrock m for each grid cell i e the thickness of the aquifer was provided by the 250 m resolution aquifer thickness map of shangguan et al 2017 http globalchange bnu edu cn research dtb jsp resolved into the grid cell size for each model bailey et al 2021 hydraulic conductivity m day for each cell was calculated based on the permeability maps o huscroft et al 2018 https dataverse scholarsportal info dataset xhtml persistentid doi 10 5683 sp2 ttjniu for unconsolidated near surface units the simulation period of apex modflow salt is 1990 2015 with the first 5 years used as a warm up period to limit the influence of initial conditions soil water soil salt content streamflow groundwater levels groundwater salt ion concentrations from influencing conditions during 1995 2015 streamflow at the woodside utah stream gage site number 09314500 i e outlet of watershed and groundwater levels at the monitoring well sites were used to test the apex modflow model described in bailey et al 2021 in stream salt ion loading at the woodside utah stream gage and groundwater salt ion concentrations are used to test the apex modflow salt model for in stream loading daily measured salt ion loadings kg day are compared to simulated loads for corresponding days measured loadings are calculated by multiplying the daily averaged flow rate m3 day by the discrete concentration measurement g m3 of each salt ion assumed to represent the average value for the day daily concentrations are available for 72 days between june 5 2007 and december 17 2015 usgs 2021 for ca mg na k cl and so4 model corroboration is performed for these six salt ions through visual analysis of daily time series of salt loadings correlation coefficients between daily measured and simulated loadings and summed salt loading for the 72 days for which measurements are available for groundwater salt ion concentrations simulated results from the simulation period are compared to results of the 32 water quality samples taken between 1975 and 1989 in addition the fraction of salt loading in the streams the originates from groundwater is compared to results from previous ucrb studies although data are limited to the watershed outlet and several monitoring well locations and therefore we cannot corroborate salt transport pathways more accurately within the interior of the watershed we feel this approach is adequate as a first attempt at model salt transport in the ucrb see section 3 5 for more discussion regarding model limitations 3 3 results 3 3 1 salinity fluxes results for streamflow and groundwater head are provided in bailey et al 2021 here we report only salinity results maps of so4 loading in the various hydrologic pathways and mineral dissolution fig 5 a and a schematic of so4 mass balance in the watershed soil system fig 5b suggest that dissolution of salt minerals to soil water and leaching to the water table provide the largest fluxes of so4 mass with high values of dissolution leading to an increase in salt storage in the soil profile so4 mass in groundwater is principally from this dissolution of salt minerals fig 5a with dissolved salt mass then leaching to the water table with recharge water the annual time series of so4 loading to streams and associated pie chart fig 5c demonstrate that loading to the streams occurs mainly from groundwater with groundwater discharge equal to approximately 89 of total so4 reaching the stream system and principally from the central southeast portions of the watershed along the corridor of the price river however this so4 baseflow fraction fig 5c ranges from 83 2000 to 95 2011 referring to the gw sw map in fig 5a areas of high groundwater so4 loading to the price river correspond to areas of high caso4 soil fractions see fig 4 caso4 soil fraction map soil lateral flow accounts for 8 5 of so4 loading to streams 4 to 13 followed by erosion runoff at 1 7 0 5 to 3 and surface runoff at 0 9 0 4 to 1 5 notice that although rainfall erosion has been prescribed as a significant conveyor of salt in the ucrb e g cadaret et al 2016 this process accounts for on annual average only 1 7 of total so4 mass loading to the price river stream network however we note that due to the use of daily summed precipitation data as model input the model may not account for the effect of short duration high intensity storms that instigate large volumes of runoff leading to an underestimation of salt movement via rainfall erosion subdaily hydrologic processes and their effect on salt mobilization and transport should be investigated in future studies corresponding maps of total salinity i e the sum of all eight salt ions fig 6 show a similar spatial and temporal pattern to so4 fig 5 due to so4 being the dominant ion in the prw soil groundwater and stream system the salinity baseflow fraction is 88 9 followed by lateral flow 8 4 erosion runoff 1 6 and surface runoff 1 1 total salt loadings by subarea fig 7 indicate areas of high loading 3 5 of total watershed wide loading through the central and southeastern regions of the watershed whereas fluxes in surface runoff erosion runoff and lateral flow are driven by rainfall events fig 8 salt loading via groundwater occurs continuously due to maintained groundwater gradients to the streams although loads do increase when recharge events from rainfall increase the gradient and drive more groundwater into the streams so4 makes up the majority 49 to 58 of salinity in all loadings fig 9 followed by ca na cl and mg although na makes up approximately 12 of the salinity loadings to streams via groundwater discharge it only makes up 4 of the salinity loading in surface runoff due to the smaller build up of na in the top soil layer compared to the aquifer the dominance of so4 is evident in both stream and groundwater sampling usgs 2021 likely due to the presence of gypsum caso4 in the watershed soils the model is able to account for this particularly through the inclusion of precipitation dissolution reactions a feature missing in other modeling approaches that treat total salt as a single conservative solute compared to groundwater discharge to streams stream seepage to groundwater accounts for a small fraction of total salt movement in the watershed for total salt from 1995 to 2015 model results indicate that approximately 20 times more salt loads from the aquifer to the streams 1 314 106 kg than from the streams to the aquifer 68 106 kg this can be seen in the annual loadings shown in fig 6c depending on changing groundwater gradients due to local recharge patterns and geologic formations some of the seeped salt may in turn load back to the streams and vice versa 3 3 2 groundwater salt concentrations based on a visual inspection of maps and histograms of simulated and observed groundwater concentration values of so4 ca and tds are very similar to the measured values in both magnitude and spatial distribution fig 10 although groundwater concentration data are limited to before 1989 the distributions are similar in spread indicating that the model provides reasonable results for the aquifer furthermore the 89 baseflow salt fraction see fig 6 is comparable to the statistical modeling results of rumsey et al 2017 for the ucrb see section 3 4 for more discussion therefore although groundwater data are limited regarding salt ion concentrations and are available only for years before the 1990 2015 simulation period preventing a direct temporal comparison between simulated and measured concentration values the simulated groundwater salt ion concentrations are sufficient in magnitude to produce an accurate representation of groundwater salt loading and in river salt loadings see section 3 3 3 we conclude that the simulated groundwater concentration values are within the range of expected values from the real system the raster maps of simulated values fig 10 indicate hotspots of so4 and ca concentration in the aquifer particularly the central south area and the southeast area by the watershed outlet as with the groundwater salinity loadings shown in figs 5 and 6 areas of high salt ion concentration coincide with areas of high caso4 soil fraction see fig 4 the caso4 dissolves into soil water within the soil profile with ca and so4 then leaching to the water table increasing ca and so4 groundwater concentrations the ca and so4 mass is then transported to nearby streams and loaded to the streams via groundwater surface water exchange without the presence of salt minerals in the model and the accompanying precipitation dissolution reactions see equations 5 and 6 the high concentrations of ca and so4 in soil water and groundwater would not be achieved and simulated in stream loads would be much lower than the observed in stream loads see section 3 3 3 models that treat salt as a single conservative solute would rely on initial conditions of concentration in soil water and groundwater to drive loads not accounting for additional salt sources via salt mineral dissolution 3 3 3 in river salt loadings and watershed salt yield the model captures the main temporal trend of the observed loadings fig 11 coefficient of determination r2 values are provided between measured and simulated values on the days for which measurements are available ranging from 0 07 for k to 0 42 for mg correlation coefficient values range from 0 28 to 0 65 1 1 plots for daily values are shown in figure s1 of supplementary data although the r2 values are low indicative of the difficulty in matching daily snap shot values the model captures the main temporal trend of the observed loadings there are certain days e g july 30 2014 when the model does not capture the high magnitude of the measured loading see chart for so4 and ca however as the measured in stream so4 concentration is 680 mg l and the simulated concentration is 1 070 mg l the difference is due to an underestimation in streamflow for this particular day the bottom two plots in fig 11 shows the relative frequency distribution of measured and simulated loadings for so4 and ca for days n 71 with measurement data for both ions the most frequent values simulated by the model are higher in load magnitude than the observed values this is also seen in the time series plots in the same figure with for example the measured loads on the ca chart consistently below the simulated values although the temporal trend is matched the total loading kg of each salt ion for days on which measured concentration data are available total 71 days is in the bar chart in fig 11 measured so4 loading in the river is 9 1 106 kg compared to a simulated loading of 8 4 106 loading a difference of 7 7 summing up loadings for the six ions the total measured loading for these 71 days is 1 398 107 kg compared to 1 395 107 kg a negligible difference 0 25 therefore we conclude that the model taken as a regional flow and salt transport tool is a good estimator for total salt yield from the prw maps of cumulative 1990 2015 and daily may 23 2011 day of high rainfall subarea scale in stream loadings for so4 and tds fig 12 show that tributaries to the price river do have considerable amounts of salt and the majority of salt moves through the main stem of the price river these loads are due to salt loading from the landscape via the pathways of surface runoff erosion runoff soil lateral flow and groundwater discharge see the spatial loading maps of figs 5 and 6 with groundwater being the largest contributor a plot of in river salt load as a function of distance along the price river fig 13 indicates a sharp increase in in river salt loading at the distance 135 km this location of in river loading increase coincides with the areas of high groundwater loading along the price river corridor in the southeast area of the watershed see gw sw loading map in figs 5 and 6 which in turn is a result of the extensive dissolution and dissemination of gypsum ions in soil leaching and groundwater transport to the river total daily and annual salt yield kg by salt ion is presented in fig 14 for 1995 2015 the pie chart in fig 14a has the percent contribution of each salt ion to the total salt yielded from the prw table 2 lists the average annual yield mg for each salt ion during the 1995 2015 period assuming the model provides accurate simulations of salt loadings on average approximately 63 500 mg total salt is loaded annually through the outlet of the prw of which 35 000 mg is so4 3 4 discussion of results as simulated by apex modflow salt salt loading in the price river is primarily from groundwater discharge 89 on average comprised mostly of so4 55 on average and occurs mainly in the lower elevation areas of the watershed groundwater loadings to the river system are consistent whereas loadings from surface runoff erosion runoff and soil lateral flow are sporadic depending on rainfall events to drive hydrologic fluxes erosion runoff comprises about 1 5 of the total salt loading these overall results compare well with reports from other studies rumsey et al 2017 in a statistical modeling study of the ucrb reported that baseflow typically accounts for less than 50 of streamflow but that 89 of dissolved solids in the river system is loaded via groundwater discharge surprisingly and without using this as a calibration target results from apex modflow salt simulated the same salinity baseflow fraction of 89 see figs 5 and 6 although we note that our results are for the prw whereas the results of rumsey et al 2017 are for the entire ucrb however from these general results we have confidence that 1 the model is simulating the hydrologic and salt ion fluxes for the data tested and 2 for the modeling period of 1995 2015 simulated dissolution leaching and groundwater transport mechanisms are providing the correct range of groundwater salt ion concentrations the overwhelming presence of a continual salt bearing source salt mineral dissolution throughout the surface water ground water as evidenced by physical data and model simulations by the coupled apex modflow salt model and the salinity baseflow fraction of 89 are in agreement with nauman et al 2019 and rumsey et al 2017 who found that there can be more significant contributions of salinity than just from surface waters to overland flow the findings of our study support this assessment and provide quantified spatio temporal patterns of salt loading from a process based model that indicate how and why it occurs regarding salt loading in runoff we estimated 1 6 of total salinity is from surface erosion runoff and 1 1 is from surface runoff for a total of 2 7 this compares well to the statistical modeling results of nauman et al 2019 for the entire ucrb which estimated that 1 4 of total in river loading comes from the exposed bare ground via surface runoff and erosion runoff on average the prw contains a higher fraction of bare ground than the watershed average in the ucrb and hence the slightly higher contribution from these two sources as rumsey et al 2017 suggests salinity management should target baseflow and its sources with an unfortunate consequence that improvements in in stream salinity loading may be delayed due to groundwater travel times rumsey et al 2017 nauman et al 2019 reported an average annual salt yield of 5 430 000 mg of salt from the ucrb our model results provide an estimate of 63 500 mg of salt loaded annually from the prw or 1 2 of the total estimated by nauman et al 2019 as the prw is one of 99 subareas in the ucrb see fig 3a and the area of the prw is 1 1 of the ucrb spatial area 4 886 km2 454 839 km2 the estimate of 63 500 mg as 1 2 of the total ucrb salt yield seems quite reasonable another indication that the apex modflow salt model as constructed and used in this study is a good simulator of salt yield from high desert natural landscapes further studies will employ the model in heavily irrigated areas 3 5 limitations of study although we are confident based on relevant results and comparisons with measured physical data and findings from other ucrb studies that the apex modflow salt model captures the main hydrologic and salt ion fate and transport processes errors and uncertainty persist however using physical data for determing hydrologic and chemical processes spatial scaling parameters value boundaries reduces type i and ii errors specific limitations certain aspects of salt ion chemistry in the soil profile has been simplified in this first use of the model for example the exclusion of metals that may influence salt ion concentrations and ph dependency these features will be included in future applications of apex modflow salt the available data for this study were streamflow and in river salt ion concentrations at the price river outlet and groundwater salt ion concentrations from an earlier period ideally if additional streamflow and salt ion data at other points in the river and tributaries were available in addition to groundwater salt ion data from a network of currently monitored observation wells the model could be tested further the next proposed application of the apex modflow salt is to other watersheds in the ucrb that contain these data thereby providing further testing of the model the model can be used in any watershed given salt mineral fraction data from soil maps and an estimate of initial groundwater salt ion concentrations however soil map data e g caco3 gypsum fractions are inherently uncertain and in the method proposed in this study averaged over each subarea future studies can investigate the sensitivity and uncertainty of model output to these input data as indicated at the end of section 3 4 employing the model in heavily irrigated areas with corresponding nearby field measurements of streamflow in stream loading and groundwater salt ion concentrations will provide valuable insights into the effect of irrigation on salt loading to streams this again points to the need to elucidate salt transport pathways with the help of model corroboration against interior watershed stream and groundwater measurements the use of daily summed precipitation data may not adequately capture the effect of monsoonal storm events which may increase salt mobilization and loading due to erosional runoff subdaily hydrological processes could be simulated in future studies to determine the importance of these high intensity rain events results of the salinity module salinity concentrations and loads depend on hydrologic fluxes simulated by apex modflow if groundwater return flows and stream discharge are not simulated correctly in space and time salt ion concentrations and loads will not be accurate based on the application of apex modflow to the prw bailey et al 2021 baseflow often was overestimated leading to the overestimation of in stream salt ion loading e g ca in fig 11 a re assessment of the hydrologic model may be required before the apex modflow salt model can be used for scenario analysis e g impacts of changes in climate land use and water management 4 summary and conclusions in this paper we present a new watershed salinity transport model apex modflow salt and use it to estimate salinity loadings in the price river watershed prw utah usa one of 99 subbasins in the upper colorado river basin ucrb the model combines a previously linked hydrologic apex modflow modeling code bailey et al 2021 with rt3d for groundwater salt ion transport and includes a new salinity module for salt ion chemistry and transport in apex subareas the model accounts for eight major ions so4 2 cl co3 2 hco3 ca2 na mg2 k and can be applied to other saline and sodic watersheds to quantify salinity sourcing salinity transport and impacts of salinity management practices the model is applied to the prw for the 1995 2015 time period with model results used to gain insights into spatio temporal patterns of salinity loading to the price river and its tributaries via surface runoff erosion runoff soil lateral flow and groundwater discharge specific insights include the vast majority 89 of salt in the price river is loaded by groundwater discharge this is the same result as obtained by rumsey et al 2017 in a study of the entire ucrb the loading from groundwater occurs mainly in the central to southeast areas of the watershed the majority 55 of salt yielded from the prw is so4 followed by ca 15 na 11 hco3 8 and mg 5 the prevalence of so4 and ca in all hydrologic pathways of the prw is due to the presence of gypsum caso4 in soils and aquifer sediments salt in erosion runoff i e erosion that occurs due to rainfall events accounts for approximately only 1 6 of salinity in the river system therefore although this type of transport has been assumed to be a major source of salt to the ucrb river system it is likely less compared to groundwater loading this result corroborates the ucrb study results of rumsey et al 2017 and nauman et al 2019 therefore at least for the prw salinity management should target baseflow and its sources the average annual salt loading from the prw during the 1995 2015 time period is approximately 63 500 mg equal to 1 2 of the total estimated salt load from the ucrb nauman et al 2019 the apex modflow salt model can be applied to other salt impacted watersheds to quantify salinity sourcing salinity transport and impacts of salinity management practices credit authorship contribution statement ryan t bailey conceptualization methodology software validation visualization writing original draft jaehak jeong conceptualization data curation funding acquisition writing review editing seonggyu park data curation methodology software colleen h m green conceptualization supervision writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement financial support for this study was provided by the united states department of interior bureau of land management federal award l17ac00125 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 127873 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
3313,salt pollution in semi arid landscapes is detrimental to food production ecosystem biodiversity soil health and water supply high desert watersheds due to natural salt deposits are a key source of salinity in river basins although studies have aimed at simulating and estimating salt movement in these landscapes approaches have relied on lumped statistical procedures that treat salt as a conservative solute rather than a collection of reactive salt ions these approaches are limited in quantifying the source transport and fate of salt under both historical and future conditions this study presents a new physically based spatially distributed salinity transport model for watershed systems of various spatial scales the model combines the watershed model apex the groundwater model modflow the groundwater reactive transport model rt3d and a new salinity module to simulate the fate and reactive transport of eight major ions so4 2 cl co3 2 hco3 ca2 na mg2 k in soils aquifers and streams of a complex watershed system salt loading to streams occurs via surface runoff erosion runoff soil lateral flow and groundwater discharge the linked apex modflow salt model is applied to the price river watershed prw 4 886 km2 utah usa a portion of the salinity laden upper colorado river basin to estimate spatio temporal loadings from the various hydrologic pathways and total salt yield in the river during 1995 2015 results indicate that the vast majority 89 of dissolved salt in the price river and its tributaries is loaded by groundwater and that more than half of the salt is in the form of sulfate so4 erosion runoff due to rainfall events is responsible for only 1 5 of total salt yield in the prw total annual dissolved salt loading from the prw through its outlet is approximately 63 500 mg from the results we conclude that managing salinity in the prw may need to focus principally on groundwater and its sources keywords apex salinity modflow groundwater colorado river basin 1 introduction salinity in soils groundwater and surface waters threatens food production soil health ecosystem biodiversity and overall use of water resources in many regions of the world and has become a global water quality challenge thorslund and van vliet 2020 in particular soil salinization is a global threat to agricultural production i e crop yield decrease and soil fertility ivushkin et al 2019 hassani et al 2020 with approximately 10 of arable land affected by salinity and sodicity shahid et al 2018 total affected areas are approximately 1 billion hectares with salinity increasing in the western united states eastern australia mexico the middle east china mongolia and north and east africa abbas et al 2013 ivushkin et al 2019 high salinity in the colorado river system in the western u s annually causes approximately 300 million in economic damages bureau of reclamation 2013 salinization occurs both by natural primary and anthropogenic secondary causes with the latter due to irrigation vegetation clearing mining activities the use of road salt for deicing cañedo argüelles et al 2013 dugan et al 2017 and effluent from wastewater treatment plants primary salinization occurs due to natural weathering of rocks and soils williams 1999 hassani et al 2020 laden with salt minerals such as calcium sulfate caso4 calcium carbonate caco3 and sodium chloride nacl among many others the minerals dissolve in rainfall runoff soil water groundwater and stream water with the resulting salt ion mass transported via these hydrologic pathways to nearby streams rivers lakes and reservoirs primary salinization often occurs in closed drainage areas harper et al 2021 in semi arid and arid regions such as in australia china the middle east and the western u s and can be a major component of basin salt export for example in the upper colorado river basin ucrb more than half of the total salt loaded in the river network originates from natural non irrigated rangelands bureau of reclamation 2013 miller et al 2017 this paper focuses on primary salinization several studies have attempted to quantify the loading of salt from a watershed landscape to receiving waters these studies typically rely on computational methods to assess salinity storage and movement under historical conditions for a variety of reasons to determine the source and origin of salt to determine the transport pathways of salt and to investigate the influence of landscape type land use human population and climate on salt fate and transport whereas many modeling studies have been applied to salinity fate and transport in irrigated watersheds e g schoups et al 2005 burkhalter and gates 2006 singh and panda 2012 bailey et al 2019 relatively few studies have investigated salinity storage and transport in multiple use rangelands nauman et al 2019 used 30 m resolution maps of soil property and cover maps in conjunction with random forest regressions to relate in stream annual salinity loads to watershed features in the ucrb this approach assessed salt as a single constituent not accounting for chemical reactions such as precipitation dissolution of individual salt ions tuteja et al 2003 used the combined modeling platform of catsalt salt mobilization and washoff tuteja et al 2002 hydrus 2d soil water flow and salt transport at highly discretized steps šimůnek et al 1999 and flowtube one dimensional groundwater flow dawes et al 2000 to quantify water and salt balance for the mandagery creek catchment 1 688 km2 in southeastern australia tirabadi et al 2021 used a modified version of the swat model soil and water assessment tool arnold et al 1998 swat s to simulate a lumped salt transport method in a natural system the shour river basin 622 km2 in southern iran similar to the statistical applications in the ucrb these two studies do not consider individual salt ions and their respective chemical reactivity while swat s does simulate a variety of hydrologic processes in a process based manner the model uses the simplified groundwater module of swat to simulate groundwater transfer from the aquifer to streams in individual subbasins as groundwater salt loading to streams can be a major component of in stream salt mass groundwater flow and salt transport should be modeled in a spatially distributed manner according to the accepted groundwater flow theory there is no available approach that uses physically based and spatially distributed modeling for salt ion fate and reactive transport in coupled surface subsurface hydrologic systems such a tool is essential for investigating salt mobilization transport and export in both historical and predictive settings this paper presents a new coupled surface subsurface hydro chemical numerical model to quantify the fate and transport of salt ion species in high desert landscapes the model is comprised of a combination of three base modeling codes apex hydrologic model for watershed systems williams and izaurralde 2010 modflow groundwater flow in aquifer systems harbaugh 2005 niswonger et al 2011 and rt3d reactive transport of solutes in aquifer systems clement 1997 the linkage between apex and modflow has been demonstrated previously bailey et al 2021 this study uses a new version of apex modflow that includes rt3d subroutines to simulate solute transport in the aquifer system and a new salinity module that simulates the chemical fate and transport of eight major ions sulfate chloride carbonate bicarbonate calcium sodium magnesium and potassium in the soil aquifer and stream systems the new modeling system is referred to as apex modflow salt the model is applied to the price river watershed prw 4 886 km2 utah usa one of 99 subbasins of the ucrb to simulate salt ion storage and transport due to surface runoff rainfall driven erosion transport soil lateral flow percolation from the soil profile to the aquifer groundwater flow groundwater surface water interactions and precipitation dissolution of salt minerals in soil and aquifer material the model is tested against measured in stream salt ion loading and groundwater salt ion concentrations and used to estimate the hydrologic pathway of salt mass that enters the stream system and is thereby exported from the subbasin in section 2 we provide details of the apex modflow salt model in section 3 we present its application to the prw and discuss results within the context of the upper colorado river basin 2 model description apex modflow salt this section provides an overview of the apex modflow modeling framework and the inclusion of 1 the rt3d modeling code and 2 the salinity module the apex modflow linked hydrologic model has been tested previously for the price river subbasin the animas river watershed colorado usa and the middle bosque river watershed texas usa bailey et al 2021 section 2 1 provides an overview of the workflow of the apex modflow salt modeling code sections 2 2 2 5 provide details of the individual modeling codes and section 2 6 returns to the apex modflow salt workflow for further details and documentation 2 1 model overview the hydro chemical processes and workflow of the apex modflow salt model are summarized in figs 1 and 2 these will be explained in more detail in later sections the black text represents processes simulated by apex evapotranspiration et surface runoff soil lateral flow percolation channel routing and plant growth blue text represents geohydrologic processes groundwater flow groundwater surface water exchange and state variables groundwater head simulated by modflow red text represents salt ion transport processes simulated by rt3d salt ion transport concentration in groundwater salt ion mass exchange between groundwater and surface water and apex salt mass in surface runoff soil lateral flow erosion runoff and streamflow salt chemistry in the soil profile for all processes salt refers to eight individual salt ions so4 2 cl co3 2 hco3 ca2 na mg2 and k each ion is treated as an individual solute and can undergo chemical reactions during storage and transport whereas apex simulates water and salt transport at the catchment scale modflow and rt3d concurrently track groundwater volume and salt ion mass and associated groundwater head and salt ion concentration using a collection of grid cells that overlay the watershed area bailey et al 2021 these features are discussed in more detail in the following sections 2 2 apex model watershed modeling the apex model is a distributed continuous daily time step model capable of simulating hydrologic and water quality processes at the field to watershed scale according to 12 major components climate hydrology crop growth pesticide fate nutrient cycling erosion sedimentation carbon cycling management practices soil temperature economic budgets and subarea watershed routing the watershed is divided into subareas with surface runoff soil lateral flow and groundwater return flow simulated from the landscape of each subarea to the subarea stream subarea streams are connected throughout the watershed for routing of water from upstream to downstream nutrients pesticides and sediment are transported through the various hydrologic pathways the apex code is written in fortran and is freely available to the public https epicapex tamu edu model executables groundwater routines in the original apex modeling code are relatively simplistic hence a previous study bailey et al 2021 linked apex with modflow to simulate physically based spatially distributed groundwater modeling and groundwater surface water interactions see section 2 4 for details regarding this coupled model 2 3 modflow model groundwater modeling modflow niswonger et al 2011 is a groundwater flow model created and maintained by the united states geological survey the model solves the following conservation of mass equations wherein groundwater mass is accounted for in representative volumes of an unconfined aquifer 1 x f s k xx h x y f s k yy h y z f f k zz h z w φ f s t f s s s h t where y z are the three dimensions in the aquifer h is groundwater head l k is hydraulic conductivity l t ss is specific storage 1 t φ is porosity l3 l3 and is assumed equal to specific yield sy l3 l3 fs is the fraction of the cell thickness that is saturated and f f is a function of fs set to 1 for niswonger et al 2011 modflow also solves the conservation of mass equation for groundwater in confined aquifers but this study focuses on the interaction between land surface hydrologic processes as simulated by apex and groundwater in underlying unconfined aquifers equation 1 represents a water balance for a given volume of the aquifer with groundwater flow in out in the y and z directions sources and sinks e g recharge pumping discharge to streams seepage from streams represented by w and storage changes represented by the terms on the right hand side to calculate groundwater head h throughout an aquifer system i e solve equation 1 the aquifer domain is divided into cubic grid cells and the water balance of equation 1 is used to update groundwater storage and associated groundwater head h in each cell during each time step of a transient simulation the updated h values for each cell are then used to estimate groundwater flow direction and groundwater travel time throughout the aquifer 2 4 apex modflow the loose coupling between apex and modflow was presented by bailey et al 2021 as shown in fig 1 apex routines simulate surface runoff et plant growth soil lateral flow and deep percolation whereas modflow routines simulate groundwater storage groundwater head h and groundwater surface water interactions loose coupling occurs as apex passes soil percolation i e recharge from each subarea to the collection of modflow grid cells that reside within the subarea geographic boundaries see fig 2 for an example representation of four subareas in a small watershed and the grid cells that intersect each of these subareas gis intersection routines are used to geographically connect subareas to grid cells for the condition where a single cell intersects two subareas i e along the border of adjacent subareas the intersection is used to calculate a weighted averaged value of recharge to the grid cell modflow uses these recharge values in the w term in equation 1 along with cell by cell values of hydraulic conductivity specific yield and specific storage to simulate new groundwater storage and h values for each grid cell these new h values are used to calculate water exchange between grid cells and apex subarea streams for cells that intersect these streams using darcy s law more details are provided in bailey et al 2021 the linkage between apex subareas and modflow grid cells occurs on a daily time step modflow subroutines and necessary linkage subroutines are imbedded inside the apex modeling code to provide a single fortran code and executable the linked apex modflow model was tested for streamflow and groundwater head in the animas river watershed colorado new mexico 3 542 km2 the price river watershed utah 4 886 km2 and the middle bosque river watershed texas 470 km2 in bailey et al 2021 the calibrated and tested apex modflow model for the price river watershed is used in this study amended with the apex salinity module and rt3d code 2 5 new salinity module for apex as part of the watershed wide simulation of salinity fate and transport in this study a new salinity module was incorporated into the apex modeling code the module accounts for the transport of eight dissolved ions so4 2 cl co3 2 hco3 ca2 na mg2 and k within hydrologic pathways across the landscape in stream channels within the soil profile and within the saturated zone of the aquifer system chemical transport in the vadose zone is not simulated rather deep percolation and salt ion mass leaching are routed to the water table via a groundwater delay function reactive transport via groundwater flow is detailed in section 2 6 the salt ions are transported via surface runoff erosion runoff soil lateral flow and streamflow for surface runoff soil lateral flow and streamflow transport of each salt ion via water movement is simulated in apex in the same manner as nitrate no3 however each ion undergoes chemical reactions as detailed below for erosion runoff a new routine was added to simulate the concentration mg l of total dissolved solids tds in the runoff water based on rainfall runoff experiments performed by the blm colorado river basin report blm 2015 in the desert shrublands of the ucrb the following polygon regression relationship was developed kim et al 2021 and incorporated into the apex code 2 tds 160256 1 246 x 1 0 0901 x 2 2 0 00031 x 2 3 1 296 x 3 17 44 x 4 0 1557 x 4 2 1 287 x 5 60865 x 6 7659 x 6 2 319 x 6 3 171 x 7 14 03 x 7 2 where tds is in mg l x1 mm of runoff during a rain event x2 sediment concentration g l x3 rock fraction of the soil x4 sodium adsorption ratio sar x5 cation exchange capacity cec mg l x6 ph of the soil water and x7 electrical conductivity ec of the soil water runoff mm and sediment concentration g l are simulated by apex during a rainfall event the sar and cec equations are calculated using simulated ion concentrations for the user defined top soil layer in the watershed according to 3 sar n a 0 5 m g 2 c a 2 4 cec c ca c mg c k c na where c represents the concentration of the salt ions usually from a soil paste extraction method rock fraction electrical conductivity and ph are assumed constant and obtained from soil surveys of the watershed once the tds concentration is estimated during a rain event the concentration of each salt ion in the runoff is calculated by taking the ratio of salt ion to tds in the soil water of the top soil layer as with salt ion mass in surface runoff and soil lateral flow the salt ion mass associated with erosion runoff is transported to the subarea stream to be routed through the river system of the watershed the salinity chemistry implemented into apex is based on the salinity equilibrium chemistry sec module of shapiro and shapley 1965 and tavakoli kivi et al 2019 developed for soil and aquifer systems equations for salt ion solution chemistry are similar to those in other water chemistry models e g unsatchem šimůnek et al 2012 phreeqc parkhurst and appelo 2013 these equations are applicable for both soil and water salt mineral dissolution the sec module includes five salt minerals and eight ions that are dissolved from these minerals caso4 caco3 mgco3 nacl mgso4 the concentration of species at equilibrium is calculated using a stoichiometric algorithm approach solving mass balance and mass action equations simultaneously lindsay 1979 parkhust and appelo 2013 the mass balance and mass action equations are provided in shapiro and shapley 1965 lindsay 1979 and tavakoli kivi et al 2019 a key feature of the sec module is the ideal simulation of precipitation and dissolution of salt minerals due to the prevalence in soils and aquifers of many landscapes for example gypsum caso4 can dissolve or precipitate according to the stoichiometric reaction 5 cas o 4 ca 2 so 4 2 the caso4 will dissolve if the solution is under saturated in regards to ca2 and so4 2 and will precipitate if the solution is super saturated with a solubility product constant 6 k s p cas o 4 ca 2 so 4 2 caso 4 similar equations are included for the other salt minerals caco3 mgco3 mgso4 and nacl within the module minerals are added to the apex soil layers with the solubility limits of each mineral used to determine the direction of each reaction precipitation or dissolution salt ion chemistry for soil layers is simulated in the new salt chem soil f subroutine in the apex code 2 6 rt3d salt reactive transport of salt ions in groundwater reactive transport of salt ions in groundwater is simulated using the rt3d reactive transport in 3 dimensions modeling code included in the apex modflow code as a subroutine that is called on a daily time step once the modflow routines have finished the rt3d code was modified for this study to include the transport of the eight salt ions the rt3d model simulates the reactive transport of solutes according to advection dispersion and chemical reactions using the groundwater head h cell by cell flow data and groundwater source sink flow rates w from modflow the mass of each solute is tracked according to the following conservation of mass advection dispersion reaction equation 7 ϕ c k t x i ϕ v i c k x i ϕ d ij c k x j q s c s k ρ b c k t ϕ r k 1 2 m where m is the total number of solutes ck is the concentration of the k th species mflf 3 where f denotes the fluid phase dij is the hydrodynamic dispersion coefficient l2t 1 v is the average seepage velocity lbt 1 provided by modflow where b denotes bulk aquifer material ϕ is soil porosity lf 3lb 3 qs is the volumetric flux of water representing sources and sinks as provided by modflow lf 3t 1lb 3 c s k is the concentration of the source or sink mflf 3 r represents the rate of all reactions that occur in the aqueous phase for the k th species mflf 3t 1 ρb is the bulk density of the porous media mblb 3 and c k is the concentration of the k th species sorbed on solids mf mb 1 the concentration c of each solute is solved for at each grid cell of the aquifer domain using the same grid as modflow for this study equation 7 is repeated for each of the 8 salt ions resulting in a system of equations that is solved during each daily time step for example the equation for so4 is 8 ϕ c s o 4 t x i ϕ v i c s o 4 x i ϕ d ij c s o 4 x j q rech c s o 4 a p e x q gw s w c s o 4 q sw g w c s o 4 a p e x where rech gw sw and sw gw represent volumetric flow rate of recharge groundwater discharge to streams and stream seepage to groundwater the subscript apex indicates that the concentration of the salt ion comes from the apex subroutines therefore the concentration of so4 in the recharge water is based on the so4 mass that leaches from the subarea soil profile to the rt3d grid cells similarly the concentration of so4 in the stream seepage water is based on the so4 mass in the subarea stream salt ion chemistry in the aquifer system is simulated in the same manner as in the apex subarea soil layers using the equations of the sec module for each time step rt3d first solves for the concentration of each salt ion at each grid cell according to equation 7 with these concentrations then provided to the sec module to update salt ion concentrations according to the equilibrium chemistry equations 2 7 apex modflow salt the modeling framework constructed in this study uses the apex modflow code of bailey et al 2021 the new salinity module for apex soil and water processes and rt3d as modified to simulate salt ion reactive transport in the aquifer system the new apex modflow salt modeling code is detailed in fig 2 inputs include standard apex model inputs daily weather data soil data topographic slope via a dem and land use standard modflow inputs cell size aquifer hydraulic conductivity specific yield porosity and initial groundwater head for each grid cell inputs for the salinity module in the apex routines soil salt mineral fractions solubility constant for each salt mineral and initial soil water salt ion concentrations and inputs for the salinity module in the rt3d routines aquifer salt mineral fractions solubility constants and initial groundwater salt ion concentrations the salinity inputs are provided in two files salt input for soil data and rt3d salt for groundwater data the code structure fig 2 follows the original apex code for land surface and soil hydrologic and chemical simulations with the addition of a subroutine for soil salt ion chemistry followed by the call to the modflow subroutine which then calls rt3d as a subroutine before modflow and rt3d are called linking subroutines are called that prepare apex data soil percolation channel stage soil percolation salt ion mass in channel salt ion concentration for use by modflow and rt3d at the conclusion of the modflow and rt3d routines groundwater surface water exchange rates and groundwater surface water salt ion exchange mass are provided to the subarea channels along with surface runoff erosion runoff and soil lateral flow the water and salt ion mass added to the subareas from these sources are then routed from subarea to subarea through the watershed channel network the apex modflow rt3d routines and routing are performed on a daily time step key hydrologic outputs include surface runoff soil lateral flow subarea river discharge groundwater head and groundwater surface water exchange rates salinity outputs include daily mass fluxes kg day in each transport pathway surface runoff rainfall erosion soil lateral flow and groundwater surface water exchange and state variables such as soil water salt ion concentration mg l in river salt ion concentrations and groundwater salt ion concentration mg l daily mass budgets are tracked for salt ion mass in surface runoff soil lateral flow erosion runoff soil layers precipitation dissolution soil leaching groundwater discharge to streams and stream seepage to groundwater and output according to subarea and the entire watershed salt ion mass budget calculations are stored in the new salt budget f subroutine in the apex code 3 model application price river watershed ucrb 3 1 study region overview the price river watershed utah is one of 99 huc8 subbasins in the upper colorado river basin ucrb see fig 3 a for a map of the ucrb subbasins with the prw outlined in red due to a natural landscape with salt laden geologic materials the ucrb discharges millions of tons of salt to the lower colorado river basin annually resulting in approximately 300 million in damages to crop yield irrigation systems and public supply water systems per year bureau of reclamation 2013 the principal source of salt in the ucrb is natural salt minerals in the volcanic and sedimentary parent rock which dissolve due to runoff and infiltration of rainwater snowmelt and irrigation water once dissolved salt mass can be transported to streams via hydrologic pathways surface runoff soil lateral flow groundwater and saline springs salt mass in surface soils can also be transported via rainfall erosion weltz et al 2014 cadaret et al 2016 the price river watershed prw fig 3b covers 4 886 km2 in carbon emery utah wasatch sanpete and duchesne counties utah elevation ranges from 3 293 m to 1 408 m the inset in fig 3 shows the topographic elevation from the mountain areas to the lower elevation areas the climate is semi arid with an average rainfall of 395 mm yr and an average snowfall of 580 mm yr with average monthly temperatures ranging from 15 6 c january to 32 7 c july the majority of streamflow originates from snowmelt from the wasatch plateau west and the book cliffs east with the price river flowing to the southeast to its outlet to the green river fig 3b the prw is comprised of forested mountain areas high desert shrubland and irrigated cultivation along river and tributary corridors in the lower elevation areas of the watershed the primary landcover type is shrubland 59 evergreen forest 24 and deciduous forest 11 fig 3c shows an example of the arid nature of the landscape the soils of the prw have a high content of calcium carbonate caco3 and gypsum caso4 see soil mineral maps in section 3 2 geologic units include sandstone shale siltstone mudstone in both the upper and lower regions of the prw with slope wash deposits and alluvium clay silt sand granules pebbles and cobbles along the drainage areas of the price river stream system see hydraulic conductivity map in section 3 2 salt loading is high in the prw stream system for the usgs stream site 09 314 500 for the price river at woodside utah https waterdata usgs gov nwis usgs 2021 at the outlet of the watershed see fig 3b for 71 days between june 2007 and december 2015 for which salt ion concentrations were measured average salt loading is approximately 200 000 kg day of this dissolved salt approximately 65 is in the form of so4 average in stream concentration of dissolved so4 is 970 mg l ranging from 149 to 2 330 mg l and average of dissolved ca is 147 mg l ranging from 24 to 272 mg l groundwater data groundwater levels water quality measurements were obtained from the usgs https waterdata usgs gov nwis gw usgs 2021 for the network of 32 monitoring wells shown in fig 3b groundwater levels range from a few meters below the ground surface near the streams to tens of meters below the ground surface groundwater salt ion concentrations are available for these same wells with one sample for each well between september 17 1975 and april 27 1989 3 2 model construction and simulation the construction calibration and testing of the apex modflow model of the prw were presented in bailey et al 2021 this coupled model was used as the baseline hydrologic model for this study fig 4 shows the basic setup of the apex modflow salt model the center map shows the watershed boundary apex subareas apex streams the modflow grid same grid as used by rt3d and modflow cells that intersect apex streams i e river cells groundwater surface water exchange rates and salt ion mass exchange are simulated only for river cells the modflow rt3d grid cells are specified as 1000 m on a side resulting in 99 rows and 91 columns with a single layer representing the unconfined aquifer there are a total of 1 036 river cells the watershed was divided into 169 subareas based on a 30 m national elevation dataset http ned usgs gov subarea areas range from 0 002 km2 to 119 km2 with an average of 26 9 km2 daily precipitation and maximum and minimum air temperature were obtained from the noaa national climate data center as described in worqlul et al 2021 and white et al 2017 datasets used in constructing the apex modflow salt model are listed in table 1 with spatial resolution and sources the maps on the left in fig 4 show example input for apex precipitation annual average precipitation is shown to provide context for spatial weather patterns but daily weather data are used by the model and soil survey geographic database ssurgo available online at https websoilsurvey sc egov usda gov app homepage htm accessed march 15 2019 salt mineral fraction maps provided by the usda natural resources conservation service https datagateway nrcs usda gov for salt mineral fractions values of caco3 and gypsum were spatially averaged over each subarea for model input the maps on the right show input for modflow hydraulic conductivity based on geologic maps of the prw ground surface elevation from a dem and aquifer thickness the depth to bedrock m for each grid cell i e the thickness of the aquifer was provided by the 250 m resolution aquifer thickness map of shangguan et al 2017 http globalchange bnu edu cn research dtb jsp resolved into the grid cell size for each model bailey et al 2021 hydraulic conductivity m day for each cell was calculated based on the permeability maps o huscroft et al 2018 https dataverse scholarsportal info dataset xhtml persistentid doi 10 5683 sp2 ttjniu for unconsolidated near surface units the simulation period of apex modflow salt is 1990 2015 with the first 5 years used as a warm up period to limit the influence of initial conditions soil water soil salt content streamflow groundwater levels groundwater salt ion concentrations from influencing conditions during 1995 2015 streamflow at the woodside utah stream gage site number 09314500 i e outlet of watershed and groundwater levels at the monitoring well sites were used to test the apex modflow model described in bailey et al 2021 in stream salt ion loading at the woodside utah stream gage and groundwater salt ion concentrations are used to test the apex modflow salt model for in stream loading daily measured salt ion loadings kg day are compared to simulated loads for corresponding days measured loadings are calculated by multiplying the daily averaged flow rate m3 day by the discrete concentration measurement g m3 of each salt ion assumed to represent the average value for the day daily concentrations are available for 72 days between june 5 2007 and december 17 2015 usgs 2021 for ca mg na k cl and so4 model corroboration is performed for these six salt ions through visual analysis of daily time series of salt loadings correlation coefficients between daily measured and simulated loadings and summed salt loading for the 72 days for which measurements are available for groundwater salt ion concentrations simulated results from the simulation period are compared to results of the 32 water quality samples taken between 1975 and 1989 in addition the fraction of salt loading in the streams the originates from groundwater is compared to results from previous ucrb studies although data are limited to the watershed outlet and several monitoring well locations and therefore we cannot corroborate salt transport pathways more accurately within the interior of the watershed we feel this approach is adequate as a first attempt at model salt transport in the ucrb see section 3 5 for more discussion regarding model limitations 3 3 results 3 3 1 salinity fluxes results for streamflow and groundwater head are provided in bailey et al 2021 here we report only salinity results maps of so4 loading in the various hydrologic pathways and mineral dissolution fig 5 a and a schematic of so4 mass balance in the watershed soil system fig 5b suggest that dissolution of salt minerals to soil water and leaching to the water table provide the largest fluxes of so4 mass with high values of dissolution leading to an increase in salt storage in the soil profile so4 mass in groundwater is principally from this dissolution of salt minerals fig 5a with dissolved salt mass then leaching to the water table with recharge water the annual time series of so4 loading to streams and associated pie chart fig 5c demonstrate that loading to the streams occurs mainly from groundwater with groundwater discharge equal to approximately 89 of total so4 reaching the stream system and principally from the central southeast portions of the watershed along the corridor of the price river however this so4 baseflow fraction fig 5c ranges from 83 2000 to 95 2011 referring to the gw sw map in fig 5a areas of high groundwater so4 loading to the price river correspond to areas of high caso4 soil fractions see fig 4 caso4 soil fraction map soil lateral flow accounts for 8 5 of so4 loading to streams 4 to 13 followed by erosion runoff at 1 7 0 5 to 3 and surface runoff at 0 9 0 4 to 1 5 notice that although rainfall erosion has been prescribed as a significant conveyor of salt in the ucrb e g cadaret et al 2016 this process accounts for on annual average only 1 7 of total so4 mass loading to the price river stream network however we note that due to the use of daily summed precipitation data as model input the model may not account for the effect of short duration high intensity storms that instigate large volumes of runoff leading to an underestimation of salt movement via rainfall erosion subdaily hydrologic processes and their effect on salt mobilization and transport should be investigated in future studies corresponding maps of total salinity i e the sum of all eight salt ions fig 6 show a similar spatial and temporal pattern to so4 fig 5 due to so4 being the dominant ion in the prw soil groundwater and stream system the salinity baseflow fraction is 88 9 followed by lateral flow 8 4 erosion runoff 1 6 and surface runoff 1 1 total salt loadings by subarea fig 7 indicate areas of high loading 3 5 of total watershed wide loading through the central and southeastern regions of the watershed whereas fluxes in surface runoff erosion runoff and lateral flow are driven by rainfall events fig 8 salt loading via groundwater occurs continuously due to maintained groundwater gradients to the streams although loads do increase when recharge events from rainfall increase the gradient and drive more groundwater into the streams so4 makes up the majority 49 to 58 of salinity in all loadings fig 9 followed by ca na cl and mg although na makes up approximately 12 of the salinity loadings to streams via groundwater discharge it only makes up 4 of the salinity loading in surface runoff due to the smaller build up of na in the top soil layer compared to the aquifer the dominance of so4 is evident in both stream and groundwater sampling usgs 2021 likely due to the presence of gypsum caso4 in the watershed soils the model is able to account for this particularly through the inclusion of precipitation dissolution reactions a feature missing in other modeling approaches that treat total salt as a single conservative solute compared to groundwater discharge to streams stream seepage to groundwater accounts for a small fraction of total salt movement in the watershed for total salt from 1995 to 2015 model results indicate that approximately 20 times more salt loads from the aquifer to the streams 1 314 106 kg than from the streams to the aquifer 68 106 kg this can be seen in the annual loadings shown in fig 6c depending on changing groundwater gradients due to local recharge patterns and geologic formations some of the seeped salt may in turn load back to the streams and vice versa 3 3 2 groundwater salt concentrations based on a visual inspection of maps and histograms of simulated and observed groundwater concentration values of so4 ca and tds are very similar to the measured values in both magnitude and spatial distribution fig 10 although groundwater concentration data are limited to before 1989 the distributions are similar in spread indicating that the model provides reasonable results for the aquifer furthermore the 89 baseflow salt fraction see fig 6 is comparable to the statistical modeling results of rumsey et al 2017 for the ucrb see section 3 4 for more discussion therefore although groundwater data are limited regarding salt ion concentrations and are available only for years before the 1990 2015 simulation period preventing a direct temporal comparison between simulated and measured concentration values the simulated groundwater salt ion concentrations are sufficient in magnitude to produce an accurate representation of groundwater salt loading and in river salt loadings see section 3 3 3 we conclude that the simulated groundwater concentration values are within the range of expected values from the real system the raster maps of simulated values fig 10 indicate hotspots of so4 and ca concentration in the aquifer particularly the central south area and the southeast area by the watershed outlet as with the groundwater salinity loadings shown in figs 5 and 6 areas of high salt ion concentration coincide with areas of high caso4 soil fraction see fig 4 the caso4 dissolves into soil water within the soil profile with ca and so4 then leaching to the water table increasing ca and so4 groundwater concentrations the ca and so4 mass is then transported to nearby streams and loaded to the streams via groundwater surface water exchange without the presence of salt minerals in the model and the accompanying precipitation dissolution reactions see equations 5 and 6 the high concentrations of ca and so4 in soil water and groundwater would not be achieved and simulated in stream loads would be much lower than the observed in stream loads see section 3 3 3 models that treat salt as a single conservative solute would rely on initial conditions of concentration in soil water and groundwater to drive loads not accounting for additional salt sources via salt mineral dissolution 3 3 3 in river salt loadings and watershed salt yield the model captures the main temporal trend of the observed loadings fig 11 coefficient of determination r2 values are provided between measured and simulated values on the days for which measurements are available ranging from 0 07 for k to 0 42 for mg correlation coefficient values range from 0 28 to 0 65 1 1 plots for daily values are shown in figure s1 of supplementary data although the r2 values are low indicative of the difficulty in matching daily snap shot values the model captures the main temporal trend of the observed loadings there are certain days e g july 30 2014 when the model does not capture the high magnitude of the measured loading see chart for so4 and ca however as the measured in stream so4 concentration is 680 mg l and the simulated concentration is 1 070 mg l the difference is due to an underestimation in streamflow for this particular day the bottom two plots in fig 11 shows the relative frequency distribution of measured and simulated loadings for so4 and ca for days n 71 with measurement data for both ions the most frequent values simulated by the model are higher in load magnitude than the observed values this is also seen in the time series plots in the same figure with for example the measured loads on the ca chart consistently below the simulated values although the temporal trend is matched the total loading kg of each salt ion for days on which measured concentration data are available total 71 days is in the bar chart in fig 11 measured so4 loading in the river is 9 1 106 kg compared to a simulated loading of 8 4 106 loading a difference of 7 7 summing up loadings for the six ions the total measured loading for these 71 days is 1 398 107 kg compared to 1 395 107 kg a negligible difference 0 25 therefore we conclude that the model taken as a regional flow and salt transport tool is a good estimator for total salt yield from the prw maps of cumulative 1990 2015 and daily may 23 2011 day of high rainfall subarea scale in stream loadings for so4 and tds fig 12 show that tributaries to the price river do have considerable amounts of salt and the majority of salt moves through the main stem of the price river these loads are due to salt loading from the landscape via the pathways of surface runoff erosion runoff soil lateral flow and groundwater discharge see the spatial loading maps of figs 5 and 6 with groundwater being the largest contributor a plot of in river salt load as a function of distance along the price river fig 13 indicates a sharp increase in in river salt loading at the distance 135 km this location of in river loading increase coincides with the areas of high groundwater loading along the price river corridor in the southeast area of the watershed see gw sw loading map in figs 5 and 6 which in turn is a result of the extensive dissolution and dissemination of gypsum ions in soil leaching and groundwater transport to the river total daily and annual salt yield kg by salt ion is presented in fig 14 for 1995 2015 the pie chart in fig 14a has the percent contribution of each salt ion to the total salt yielded from the prw table 2 lists the average annual yield mg for each salt ion during the 1995 2015 period assuming the model provides accurate simulations of salt loadings on average approximately 63 500 mg total salt is loaded annually through the outlet of the prw of which 35 000 mg is so4 3 4 discussion of results as simulated by apex modflow salt salt loading in the price river is primarily from groundwater discharge 89 on average comprised mostly of so4 55 on average and occurs mainly in the lower elevation areas of the watershed groundwater loadings to the river system are consistent whereas loadings from surface runoff erosion runoff and soil lateral flow are sporadic depending on rainfall events to drive hydrologic fluxes erosion runoff comprises about 1 5 of the total salt loading these overall results compare well with reports from other studies rumsey et al 2017 in a statistical modeling study of the ucrb reported that baseflow typically accounts for less than 50 of streamflow but that 89 of dissolved solids in the river system is loaded via groundwater discharge surprisingly and without using this as a calibration target results from apex modflow salt simulated the same salinity baseflow fraction of 89 see figs 5 and 6 although we note that our results are for the prw whereas the results of rumsey et al 2017 are for the entire ucrb however from these general results we have confidence that 1 the model is simulating the hydrologic and salt ion fluxes for the data tested and 2 for the modeling period of 1995 2015 simulated dissolution leaching and groundwater transport mechanisms are providing the correct range of groundwater salt ion concentrations the overwhelming presence of a continual salt bearing source salt mineral dissolution throughout the surface water ground water as evidenced by physical data and model simulations by the coupled apex modflow salt model and the salinity baseflow fraction of 89 are in agreement with nauman et al 2019 and rumsey et al 2017 who found that there can be more significant contributions of salinity than just from surface waters to overland flow the findings of our study support this assessment and provide quantified spatio temporal patterns of salt loading from a process based model that indicate how and why it occurs regarding salt loading in runoff we estimated 1 6 of total salinity is from surface erosion runoff and 1 1 is from surface runoff for a total of 2 7 this compares well to the statistical modeling results of nauman et al 2019 for the entire ucrb which estimated that 1 4 of total in river loading comes from the exposed bare ground via surface runoff and erosion runoff on average the prw contains a higher fraction of bare ground than the watershed average in the ucrb and hence the slightly higher contribution from these two sources as rumsey et al 2017 suggests salinity management should target baseflow and its sources with an unfortunate consequence that improvements in in stream salinity loading may be delayed due to groundwater travel times rumsey et al 2017 nauman et al 2019 reported an average annual salt yield of 5 430 000 mg of salt from the ucrb our model results provide an estimate of 63 500 mg of salt loaded annually from the prw or 1 2 of the total estimated by nauman et al 2019 as the prw is one of 99 subareas in the ucrb see fig 3a and the area of the prw is 1 1 of the ucrb spatial area 4 886 km2 454 839 km2 the estimate of 63 500 mg as 1 2 of the total ucrb salt yield seems quite reasonable another indication that the apex modflow salt model as constructed and used in this study is a good simulator of salt yield from high desert natural landscapes further studies will employ the model in heavily irrigated areas 3 5 limitations of study although we are confident based on relevant results and comparisons with measured physical data and findings from other ucrb studies that the apex modflow salt model captures the main hydrologic and salt ion fate and transport processes errors and uncertainty persist however using physical data for determing hydrologic and chemical processes spatial scaling parameters value boundaries reduces type i and ii errors specific limitations certain aspects of salt ion chemistry in the soil profile has been simplified in this first use of the model for example the exclusion of metals that may influence salt ion concentrations and ph dependency these features will be included in future applications of apex modflow salt the available data for this study were streamflow and in river salt ion concentrations at the price river outlet and groundwater salt ion concentrations from an earlier period ideally if additional streamflow and salt ion data at other points in the river and tributaries were available in addition to groundwater salt ion data from a network of currently monitored observation wells the model could be tested further the next proposed application of the apex modflow salt is to other watersheds in the ucrb that contain these data thereby providing further testing of the model the model can be used in any watershed given salt mineral fraction data from soil maps and an estimate of initial groundwater salt ion concentrations however soil map data e g caco3 gypsum fractions are inherently uncertain and in the method proposed in this study averaged over each subarea future studies can investigate the sensitivity and uncertainty of model output to these input data as indicated at the end of section 3 4 employing the model in heavily irrigated areas with corresponding nearby field measurements of streamflow in stream loading and groundwater salt ion concentrations will provide valuable insights into the effect of irrigation on salt loading to streams this again points to the need to elucidate salt transport pathways with the help of model corroboration against interior watershed stream and groundwater measurements the use of daily summed precipitation data may not adequately capture the effect of monsoonal storm events which may increase salt mobilization and loading due to erosional runoff subdaily hydrological processes could be simulated in future studies to determine the importance of these high intensity rain events results of the salinity module salinity concentrations and loads depend on hydrologic fluxes simulated by apex modflow if groundwater return flows and stream discharge are not simulated correctly in space and time salt ion concentrations and loads will not be accurate based on the application of apex modflow to the prw bailey et al 2021 baseflow often was overestimated leading to the overestimation of in stream salt ion loading e g ca in fig 11 a re assessment of the hydrologic model may be required before the apex modflow salt model can be used for scenario analysis e g impacts of changes in climate land use and water management 4 summary and conclusions in this paper we present a new watershed salinity transport model apex modflow salt and use it to estimate salinity loadings in the price river watershed prw utah usa one of 99 subbasins in the upper colorado river basin ucrb the model combines a previously linked hydrologic apex modflow modeling code bailey et al 2021 with rt3d for groundwater salt ion transport and includes a new salinity module for salt ion chemistry and transport in apex subareas the model accounts for eight major ions so4 2 cl co3 2 hco3 ca2 na mg2 k and can be applied to other saline and sodic watersheds to quantify salinity sourcing salinity transport and impacts of salinity management practices the model is applied to the prw for the 1995 2015 time period with model results used to gain insights into spatio temporal patterns of salinity loading to the price river and its tributaries via surface runoff erosion runoff soil lateral flow and groundwater discharge specific insights include the vast majority 89 of salt in the price river is loaded by groundwater discharge this is the same result as obtained by rumsey et al 2017 in a study of the entire ucrb the loading from groundwater occurs mainly in the central to southeast areas of the watershed the majority 55 of salt yielded from the prw is so4 followed by ca 15 na 11 hco3 8 and mg 5 the prevalence of so4 and ca in all hydrologic pathways of the prw is due to the presence of gypsum caso4 in soils and aquifer sediments salt in erosion runoff i e erosion that occurs due to rainfall events accounts for approximately only 1 6 of salinity in the river system therefore although this type of transport has been assumed to be a major source of salt to the ucrb river system it is likely less compared to groundwater loading this result corroborates the ucrb study results of rumsey et al 2017 and nauman et al 2019 therefore at least for the prw salinity management should target baseflow and its sources the average annual salt loading from the prw during the 1995 2015 time period is approximately 63 500 mg equal to 1 2 of the total estimated salt load from the ucrb nauman et al 2019 the apex modflow salt model can be applied to other salt impacted watersheds to quantify salinity sourcing salinity transport and impacts of salinity management practices credit authorship contribution statement ryan t bailey conceptualization methodology software validation visualization writing original draft jaehak jeong conceptualization data curation funding acquisition writing review editing seonggyu park data curation methodology software colleen h m green conceptualization supervision writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement financial support for this study was provided by the united states department of interior bureau of land management federal award l17ac00125 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 127873 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
3314,urban evapotranspiration estimation based on anthropogenic activities and modified penman monteith model jiahao chen conceptualization methodology software writing original draft writing review editing a b jingyi bu conceptualization methodology writing review editing supervision a b yanxin su writing review editing a b mengjia yuan writing review editing a b kexin cao software writing review editing b c yanchun gao conceptualization writing review editing supervision funding acquisition project administration a a key laboratory of water cycle and related land surface processes institute of geographical sciences and natural resources research chinese academy of sciences beijing 100101 china key laboratory of water cycle and related land surface processes institute of geographical sciences and natural resources research chinese academy of sciences beijing 100101 china key laboratory of water cycle and related land surface processes institute of geographical sciences and natural resources research chinese academy of sciences beijing 100101 china b university of the chinese academy of sciences beijing 100049 china university of the chinese academy of sciences beijing 100049 china university of the chinese academy of sciences beijing 100049 china c key laboratory of regional sustainable development modeling institute of geographic sciences and nature resources research chinese academy of sciences beijing 100101 china key laboratory of regional sustainable development modeling institute of geographic sciences and nature resources research chinese academy of sciences beijing 100101 china key laboratory of regional sustainable development modeling institute of geographic sciences and nature resources research chinese academy of sciences beijing 100101 china corresponding authors at key laboratory of water cycle and related land surface processes institute of geographical sciences and natural resources research chinese academy of sciences beijing 100101 china j bu y gao key laboratory of water cycle and related land surface processes institute of geographical sciences and natural resources research chinese academy of sciences beijing 100101 china urban evapotranspiration et is an essential part of the hydrological cycle a complete understanding of urban et is necessary to understand the interaction between the atmosphere and the urban surface however estimating urban et is challenging due to the influence of urban surface heterogeneity and human activities in urban areas therefore this paper proposed an improved multisource parallel model pm urban based on the penman monteith model which is suitable for the et estimation for the underlying surface of the city the pm urban model takes into account the violent human activities in the city and its main characteristics are 1 the anthropogenic heat flux ahf was included in the surface energy balance formula 2 the building water dissipation was considered in this paper taking shenzhen one of the cities with the fastest urbanization process globally as an example seven urban et maps of shenzhen were generated using landsat 8 images the model was verified using pan evaporation data corrected by complementary relationships the results showed that 1 the et of each land use type has the following relationship water body vegetation bare soil no building impervious surface and the value of building water dissipation varies due to the height and type of buildings significant 2 the pm urban model that considers ahf is better than the original model that ignores ahf 3 this model can describe the characteristics of urban et well and explain the phenomenon of high water consumption in cities our research results provide a new perspective for calculating the urban et which can be applied to urban management planning and reducing the urban heat island effect keywords urban evapotranspiration pm urban model anthropogenic heat flux building water dissipation landsat 8 1 introduction urban residents worldwide are increasingly affected by climate change and water scarcity liu and jensen 2018 more than half of the population now lives in urban areas and this proportion is expected to exceed 70 by 2050 bratman et al 2015 the natural terrain is continuously transformed into urban landscapes to meet the growing demand of the urban population yang et al 2014 urbanization has changed the surface and atmospheric conditions in urban areas leading to considerable changes in regional hydroclimate and energy balance yang et al 2016 zhang et al 2009 zhong et al 2015 the increasing population has produced more anthropogenic heat sources causing a series of problems such as the heat island effect and urban waterlogging therefore further understanding of the urban water cycle and energy balance is necessary for future water resources planning evapotranspiration et is a crucial component of the hydrological cycle and energy balance connecting land water and ground energy exchange wang and dickinson 2012 the surface energy flux in the urban environment is always changing due to land cover heterogeneity weng et al 2014 in addition the heat production of human activities affects the surface energy balance and makes the urban water cycle show a natural society duality song et al 2019 sound knowledge of the spatial variations in urban et is essential for understanding the interaction between the atmosphere and urban surfaces kustas and norman 1996 improving urban water management and predicting water consumption under various geographic conditions wagle et al 2017 a variety of methods for estimating regional et have been developed including the water balance method alley 1984 granier et al 1999 long and singh 2010 palmroth et al 2010 senay et al 2011 the meteorological method mcmahon et al 2013 penman 1948 sumner and jacobs 2005 and remote sensing energy balance model allen et al 2007 bastiaanssen et al 1998 roerink et al 2000 su 2002 there have been some studies on surface et in urban areas gao 2012 saher et al 2020 tang et al 2013 wang et al 2020 zhang 2018 zhang et al 2017 zhao 2015 zheng 2012 zhou 2015 gao 2012 calculated the surface et in beijing based on the simulating model for urban water cycle urmod however this model requires high spatial resolution of remote sensing images and relies on local parameters which limited its application and promotion in addition some studies have calculated the urban et tang et al 2013 zhao 2015 but these studies only apply the traditional et model to the city directly they often conclude that urban et is smaller than forests et and farmland et tang et al 2013 zhao 2015 which cannot explain the phenomenon of high water consumption in cities zhou 2015 considering the surface heterogeneity of urban zheng 2012 proposed the modified multisource parallel model mmp which fully considers the diversity of the urban underlying surface however the mmp model ignores the spectral heterogeneity of the city s impervious surface zhang 2018 based on zheng s model zhang et al 2017 proposed a modified multisource parallel model and achieved good results however the model can only rely on aster or modis data with multiple thermal infrared bands zhang et al 2017 the dependence on specific remote sensing data restricts the application of this model therefore zhang 2018 established an urban rs pm model based on the research by mu et al 2011 combined with spectral mixing analysis compared with the mmp model the urban rs pm model simplifies the calculation process and provides acceptable accuracy therefore the urban rs pm model is an effective tool for exploring the effect of et on the urban heat island on a regional scale wang et al 2020 it is worth noting that the above studies ignored the influence of anthropogenic heat flux ahf on the energy balance although the average terrestrial ahf is much lower than the net solar radiation on the global and continental scales human metabolism vehicle and building heat emissions make essential contributions to the urban surface energy budget allen et al 2011 mccarthy et al 2010 sailor 2011 in 2018 the average ahf of the 100 largest cities in the world was 19 56 w m2 which was about 12 of net solar radiation jin et al 2020 and the extreme ahf in tokyo s business districts was even as high as 1590 w m2 flanner 2009 ichinose et al 1999 therefore ahf cannot be ignored and should be included in the surface energy balance of highly urbanized areas cong et al 2017 there are three main methods to estimate ahf energy budget closure method zhou et al 2012 source list method dong et al 2017 zheng and weng 2018 and numerical simulation method assimakopoulos et al 2007 dhakal and hanaki 2002 heiple 2008 hsieh et al 2011 liu et al 2012 the energy budget closure methods are including direct observation from eddy covariance tower and indirect calculation chow et al 2014 the eddy covariance tower can observe the heat flux for the former but it is expensive and challenging chow et al 2014 cui and chui 2021 for the latter ahf can be calculated from the surface energy balance model zhou et al 2012 however the uncertainty of parameters may lead to bias in estimating ahf zhou et al 2012 the source list methods are including the top down method and the bottom up method the advantage of the bottom up approach is that it can provide different ahf at any time and spatial resolution zheng and weng 2018 however this method is time consuming and requires a lot of data to obtain heterogeneous fine scale ahf the top down approach is building a relationship between energy consumption and downscaling indicators such as nighttime light data ntl yang et al 2017 yu et al 2021 ntl related data chen et al 2019 urban functional area sun et al 2018 population density map jin et al 2020 air pollutants afshari et al 2018 numerical models use energy consumption equations to derive the ahf of different types of buildings they are more used to calculate the ahf emission law of a single building which requires a large amount of calculation such models include doe 2 dhakal and hanaki 2002 equest heiple 2008 trnsys assimakopoulos et al 2007 energyplus hsieh et al 2011 cfd liu et al 2012 etc according to the dual water cycle urban et not only includes et on the natural side of grassland shrubs and other vegetation covering the ground järvi et al 2011 but also includes the evaporation generated by indoor human activities zhou et al 2019 and the latter not well reflected in traditional urban et models building water dissipation is the water dissipation generated by anthropogenic and it is the main part of urban social water consumption zhou et al 2019 proposed the urban water dissipation uwd model to cover the water use of various city regions and evaluated the et in xiamen the results showed that the accuracy produced by uwd model is significantly higher than that by traditional remote sensing retrieval methods however this method calculates the urban et from two perspectives of energy balance and water balance and the process is complicated without considering ahf to sum up there is a lack of research that considers both urban ahf and internal dissipation in buildings the objectives of this study were 1 combining ahf and internal dissipation of buildings to build an improved rs pm model from now on referred to as pm urban 2 taking shenzhen as an example estimating urban et based on pm urban model and exploring the impact of ahf and building water dissipation on urban et 2 study area and data 2 1 study area shenzhen is one of the cities with the fastest urbanization in china and even worldwide therefore this study selects shenzhen guangdong province except dapeng new district shenzhen shantou special cooperation zone and pingshan district as the study area the study area is located in the southern part of guangdong province china 113 43 114 21 e and 22 27 22 51 n fig 1 with a total area of 1535 78 km2 the study area has a subtropical oceanic climate with the annual average temperature of 22 4 and the average yearly rainfall of 1933 3 mm li et al 2016 according to the seventh census of china national bureau of statistics 2021 the total population of the study area reached 16 79 million 2 2 data 2 2 1 satellite data seven sets of landsat 8 operational land imager oli 30 m resolution and thermal infrared sensor tirs 100 m resolution images roy et al 2014 table 1 for the period 2013 2021 were selected for inversing urban et in the study area due to a large amount of cloud cover in the study area in summer the chosen images were primarily in autumn and winter based on the acquisition date of landsat 8 data two phases of google earth imagery in futian district and luohu district of shenzhen acquired on november 17 2014 and october 23 2017 respectively were selected to verify the results of linear spectral mixing analysis in addition the 4 level modis global leaf area index product mod15a2h myneni et al 2002 was used to calculate the canopy conductance of vegetation the product uses an 8 day cycle to select the best pixel from all the pixels obtained by the terra sensor for synthesis 2 2 2 meteorological data based on the pm urban model the inversion of urban et requires meteorological observation data including temperature tair relative air humidity rh atmospheric pressure pa wind speed uz and water vapor pressure e we obtained all meteorological data corresponding to the acquisition time of landsat 8 images from the shenzhen municipal government data open platform https opendata sz gov cn table 2 2 2 3 pan evaporation data due to the lack of flux measurement towers in the study area the e601b type pan evaporation observation data from the basic weather station in shenzhen was be used for model verification pan evaporation observation data represents the amount of water loss from the earth to the atmosphere in the form of water vapor during a period mm day with an unlimited supply of water sun et al 2011 it is worth noting that the pan evaporation data is not the actual et le value but can be regarded as the potential et lep therefore le can be calculated using the complementary relationship theory the complementary relationship correction method is shown in section 3 8 2 2 4 socioeconomic data the building distribution map and building height data in shenzhen come from amap figure s1 https www amap com the energy consumption data comes from the shenzhen statistical yearbook https www sz gov cn cn xxgk zfxxgj tjsj tjnj water consumption data comes from shenzhen water resources bulletin http swj sz gov cn sjfb szygb the population distribution data adopts gpwv411 gridded population of the world version 4 11 its original spatial resolution is 0 5 min 0 5 min and the nearest neighbor method cover and hart 1967 is used to downscale it to 30 m 30 m which is used to calculate the heat flux generated by humans metabolism in the grid 3 methodology based on the urban rs pm model of zhang 2018 we established a new urban et model pm urban by combining ahf and building water dissipation in this model we take the neglected ahf into account in the conventional energy balance equation 1 r n a h l e g where r n is the net surface radiation a is the anthropogenic heat flux h is the sensible heat flux le is the latent heat flux and g is the soil heat flux in addition we assumed that the mixed pixels in urban areas were composed of vegetation bare soil and impervious surfaces water bodies generally exist independently in isolated patches and can be removed by the water index method chen et al 2020 the distribution of buildings can be determined using the building distribution map of shenzhen the original model ignored the et from the impervious surface estimating the et of the urban mixed pixel as the sum of vegetation component transpiration and soil component evaporation still it ignored the dissipation inside the building on the impervious surface in this article we expressed the urban et as the sum of vegetation transpiration soil evaporation water surface evaporation and building water dissipation as follows 2 et e t v e t s e t w e t b among them etv and ets are the vegetation component transpiration and soil component evaporation in urban mixed pixels etw represents water surface evaporation and etb is the internal dissipation of buildings considering the pixel components heterogeneity the pm urban model used the re derived penman monteith algorithm which incorporates the dual source parallel surface energy balance model considering ahf based on this estimating the transpiration of vegetation components and soil components evaporation is possible in the mixed urban pixels water surface evaporation is calculated using the penman formula see section 3 7 for the calculation method of building water dissipation the calculation formula for each component of urban et is as follows 3 et v f v δ r n ν a ρ c p e s e a r ah ν δ γ 1 r s ν r ah ν 4 et s f s δ r n s a g s ρ c p e s e a r ah s δ γ 1 r s s r ah s rh 100 e s e a 1000 5 et w δ r n w a δ γ γ δ γ 6 43 1 0 536 u 2 e s e a λ where fv and fs are the proportions of vegetation and bare soil components in the mixed pixels respectively λ j kg 1 is the latent heat of vaporization of water δ is the slope of the saturated water vapor pressure curve pa k 1 r n ν r n s and r n w w m 2 are net radiation of pure vegetation pixels pure soil pixels and pure water bodies respectively a w m 2 is ahf g s w m 2 is the soil heat flux in a pure soil pixel ρ kg m 3 cp j kg 1 k 1 es pa and ea pa are air density air specific heat capacity saturated vapor pressure and actual vapor pressure respectively r ah ν and r ah s s m 1 are the aerodynamic heat transfer resistance of vegetation and soil respectively γ is the psychrometric constant r s v s m 1 is the surface resistance of the vegetation canopy r s s s m 1 is the sum of the air resistance of the soil surface rh is the air relative humidity u 2 is the wind speed at the height of two meters 3 1 linear spectral mixture analysis a normalized linear spectral mixture analysis nsma wu 2004 wu and murray 2003 was applied to extract each mixed pixel s fv fs and fimp the surface component fractions are the fundamental parameters of the pm urban and should be evaluated before calculating other parameters two high resolution images of google earth 2014 11 17 and 2017 10 23 were obtained to verify the accuracy of the pixel decomposition results a total of 100 validation samples were randomly generated on the google earth image and three surface component fractions of each validation sample were extracted by manual interpretation the results of component fractions verification are shown in section 4 1 3 2 component net radiation inversion the net radiant flux on the surface can be expressed as 6 r n 1 a s d ε air σ t air 4 ε λ σ t sur 4 where a is albedo s d w m 2 is the downward short wave radiation ε air and ε λ are the effective atmospheric emissivity and surface emissivity respectively σ is the stefan boltzmann constant tair k is the average atmospheric temperature and tsur k is the average surface temperature zhang 2018 expressed the net radiant flux of the four components as 7 r n v 1 a v s d ε air σ t air 4 ε v σ t v 4 8 r n s 1 a s s d ε air σ t air 4 ε s σ t s 4 9 r n i m p 1 a imp s d ε air σ t air 4 ε imp σ t imp 4 10 r n w 1 a w s d ε air σ t air 4 ε w σ t w 4 where r n v r n s r n i m p r n w represent the net radiation flux of vegetation soil impervious and water surface respectively a v a s a imp a w represent the albedo of vegetation soil impervious and water surface respectively ε v ε s ε imp ε w represent the emissivity of vegetation soil impervious surface and water surface tv ts timp tw represent the temperature of vegetation soil component impervious surface and water surface respectively 3 3 component aerodynamic resistance inversion we adopted the model proposed by kustasa and norman 1999 to calculate the aerodynamic resistance for vegetation components and bare soil components r ah v r ah s the aerodynamic resistance can be expressed as 11 r ah i 1 k 2 u z l n z d 0 i z 0 m i ψ m i l n z d 0 i z 0 h i ψ h i where r ah i is aerodynamic resistance i v i s represents vegetation and bare soil respectively k is van karman constant 0 41 z is the reference height u z is the wind speed observed at height z d 0 i is the zero plane displacement z 0 m i z 0 h i are the roughnesses for momentum and sensible heat respectively ψ m i ψ h i are the stability correction functions for momentum and heat respectively for specific calculation methods please refer to the supplementary material 3 4 component surface resistance inversion the component surface resistance was calculated using the vegetation canopy and soil surface resistance model proposed by mu et al 2007 by calculating canopy conductance mu et al 2007 developed a method for estimating vegetation canopy surface resistance rs v as follows 12 g s c l m t min m v p d 13 g c g s l a i where the leaf area index lai was used to convert stomatal conductance g s to canopy conductance g c and r s v is the inverse of g c c l is the mean potential stomatal conductance per unit leaf area which can be taken as 0 0013 according to leuning et al 2009 research t min is minimum air temperatures vpd is saturated air vapor pressure m t min and m v p d are the temperature and water vapor pressure stress functions for soil surfaces the surface resistance formula is as follows 14 r s s r totc 1 0 273 15 t 293 15 1 75 101 3 p a where r totc is the constant based on ground observations the value is 107 0 m s wallace and holwill 1997 3 5 soil heat flux inversion based on the observational data of soil heat flux and soil component net radiation friedl 1996 found that there is a functional relationship between the soil heat flux g s the soil component net radiation r n s and the solar zenith angle θ which can be expressed as 15 g s 0 25 r n s c o s θ 3 6 anthropogenic heat flux calculation we used the method of liu et al 2021 to calculate ahf in shenzhen it assumes that all consumed energy is eventually converted into heat flux between land and air and ignores the delay between energy utilization and conversion into heat energy lu et al 2017 pigeon et al 2007 we divided the ahf into three components building heat flux vehicle heat flux and human metabolism heat flux equation 16 then we estimated the annual average ahf of the three components and then used a series of downscaling methods to reduce it to the instantaneous scale of the imaging moment 16 a a b a v a m where a is total ahf ab is building heat flux av is vehicle heat flux am is human metabolism heat flux 3 6 1 ahf from building based on the available statistical data liu et al 2021 discovered the relationship between the volume and energy consumption of different buildings and then could downscale the statistical building energy consumption data to the level of a single building first according to shenzhen poi data buildings are divided into seven types industrial buildings commercial buildings government office buildings residential buildings business office buildings hospitals and educational buildings after reducing the energy consumption to the level of a single building the ahf calculation formula for each building is 17 a by i e i c a i t 18 e k i e k total v k total v k i where a by i w m2 is the annual average ahf of building i e i tec is the total annual energy consumption of building i calculated in a ton of standard coal equivalent c j is standard coal heat which equals 29 27 109j a i m2 is the base area of building i t s is the total seconds in a year e k i tec is the energy consumption of type k building i k 1 2 3 4 5 6 7 representing industrial buildings commercial buildings government office buildings residential buildings business office buildings hospital and educational buildings respectively e k total tec is the total energy consumption of type k buildings v k total m3 is the total volume of type k buildings v k i m3 is the volume of type k building i first downscale the annual building ahf to the monthly building ahf liu et al 2021 19 a bm a by a m 20 a m β m m 1 12 β m 12 21 β m t m t b 0 03 1 t m t b t b t m 0 05 1 t m t b where a bm is the monthly building ahf a m is the monthly weighting coefficient of building ahf β m is the monthly weighting coefficient of monthly energy consumption based on local temperature t m is the monthly mean temperature of the study area t b is the air temperature equilibrium point in this study shenzhen s multi year average temperature 22 c was selected as t b then downscale the monthly scale building ahf to the daily scale and further downscale it to the instantaneous building ahf zheng and weng 2018 22 a bd k a bm k n w n n n w ε k n n ε k w o r k d a y a bm k n w n n n w ε k n n n o n w o r k d a y 23 a bh k a bd k r k where a bd k is the average daily ahf of the type k building w m2 n w is the number of workdays in a month n n is the number of non workdays in a month ε k is the ratio of the ahf of building type k in workdays to non workdays table 3 chung and park 2015 quah and roth 2012 xia et al 2014 zheng and weng 2018 zhou et al 2015 a bh k is ahf for type k buildings w m2 at 11 am the imaging time of the 7 landsat data are around 11 am r k is the ratio of ahf from building type k to the workday and non workday mean ahf at 11 am table 3 chung and park 2015 quah and roth 2012 xia et al 2014 zheng and weng 2018 zhou et al 2015 3 6 2 ahf from vehicle a vy can be estimated based on the number of vehicles the average annual driving distance and the road area chen et al 2019 24 a vy v d ρ f e β a r t where v is the number of vehicles in the study area d is the annual average driving distance per vehicle v and d derived from shenzhen traffic development report 2013 2020 ρ f is fuel density 0 85 kg l e is automobile fuel efficiency 0 12 l km β is the net heat emission of automotive vehicles 4 5 107 j kg ρ f e and β were derived from quah and roth 2012 a r is the road area 189 23 km2 then annual traffic ahf can be downscaled to monthly traffic ahf 25 a vm a vy γ m 26 γ m δ m m 1 12 δ m 12 27 δ m β m ρ m where a vm is monthly scale vehicle ahf γ m is the monthly adjustment weighting factor of the vehicle ahf δ m is the monthly weight coefficient of vehicle energy consumption ρ m is the ratio of the vehicles in use in each month to the monthly mean vehicles in use downscale the monthly scale vehicle ahf to the daily scale and further down scale it to the instantaneous traffic ahf zheng and weng 2018 28 a vd a vm n w n n n w ε n n ε w o r k d a y a vm n w n n n w ε n n n o n w o r k d a y 29 a vh a vd r where a vd is the average daily ahf of the vehicle w m2 ε is the ratio of the ahf of vehicles in workdays to non workdays table 3 wen et al 2014 a vh is the hourly mean ahf of vehicles w m2 r is the ratio of the ahf of the vehicle at 11 am to the ahf of the whole day table 3 wen et al 2014 3 6 3 ahf from human metabolism a m can be estimated based on population density and metabolic rate allen et al 2011 30 a m ρ grid q d where ρ grid is population density within a pixel q d is the human body s daily metabolic rate which is 175 w according to the study of sailor and lu 2004 3 7 estimation of building water dissipation we used the water balance equation to calculate internal building dissipation ignoring product carryover and soil absorption 31 et b s d w where s is the anthropogenic water supply d is the wastewater discharge and w is the water dissipation the building water dissipation was divided into three categories industrial building dissipation residential building dissipation and public building dissipation and then calculated based on the total dissipation and total volume of different categories of buildings 32 et b l i w l total v l total v l i t et b l i is the dissipation of category l building i l 1 2 3 representing industrial buildings residential buildings and public buildings respectively w l total m3 is the total dissipation of category l building v l total m3 is the total volume of category l buildings v l i m3 is the volume of category l building i t s is the total time in a given year 3 8 correction of pan evaporation data the complementary relationship between le and lep can be expressed as 33 b l e w l e l e p l e w where b is a proportional coefficient to measure the impact of the change in actual evapotranspiration on potential evaporation lew is the wet environment et usually the priestley taylor equation brutsaert and stricker 1979 is used to calculate lew 34 lew α δ r n g δ γ where α is the priestley taylor coefficient it is usually used as a calibration coefficient still to reduce the degree of freedom brutsaert and stricker 1979 its value is fixed to 1 26 in this paper to determine the value of the complementary coefficient b zuo et al 2016 defined the pan evaporation heterogeneity intensity index ie which represents the unevenness of the pan evaporation water body and the surrounding ground surface it is the ratio of pan evaporation lepan to penman potential evaporation leppman namely 35 i e le pan le ppman zuo et al 2016 proved that the complementary coefficient b is linearly related to ie through experiments that is 36 b 2 59 i e 1 23 after calculation the complementary coefficient b of the e601b type pan evaporation in the shenzhen area is 1 49 substituting into equation 33 the pan evaporation data after the correction of the complementary relationship can be obtained since the pan evaporation data is daily scale data we used the evaporation ratio invariance method brutsaert and sugita 1992 to upscale the instantaneous et values of the pixel where the evaporating pan is located to the daily scale 4 results 4 1 accuracy verification of component fractions using the nsma model the component fraction decomposition of seven landsat 8 images was carried out and finally the surface component fractions of each endmember were obtained the component fractions of the three endmembers after the mixed pixel decomposition of the 7 period images are shown in figure s2 to figure s4 respectively make a two dimensional scatter plot of the component fraction inversion and actual values from the visual interpretation and perform linear regression analyses the result is shown in fig 2 figure 2 shows that there are some extreme points whose y coordinate value did not change with the coordinate value due to the proximity effect richter 1998 specifically some pure vegetation bare soil pixels were influenced by the surrounding mixed pixels that also exhibited the characteristics of other components nevertheless the correlation r between the retrieval value and the actual value of the vegetation and bare soil component fractions were all larger than 0 89 indicating a high correlation since all seven images used the same mixed pixel decomposition method the verification results of these 2 phases were random sampling inspection therefore it could be judged that the mixed pixel decomposition result of the seven images could meet the accuracy requirements of the pm urban model and further calculations could be carried out 4 2 the spatiotemporal variation of ahf we used the socioeconomic data of shenzhen to obtain the 7 period ahf retrieval results fig 3 to explore the spatial distribution pattern of ahf in shenzhen the ahf retrieval result of 2014 11 16 was selected for further analysis as shown in fig 4 areas with high ahf values were located in the southern and western parts of the city such as futian fig 4g luohu fig 4h nanshan fig 4f and baoan fig 4d the low value areas of ahf were distributed in the northeast and central mountainous regions such as yantian fig 4e areas with very high ahf were usually located in dense business office areas and industrial parks fig 4d f h especially in the ultra high commercial buildings in futian district the tallest building is 592 5 m the average ahf could reach almost 500 w m2 and the highest value could even reach 1678 w m2 it is worth noting that compared with other studies jin et al 2020 liu et al 2021 yu et al 2021 on ahf the ahf in this study was higher this was because the resolution in this study was 30 m which was higher than in other studies the higher the resolution the better the heterogeneity of ahf and vice versa according to the climatological season division method zhong 1995 spring 02 06 04 20 summer 04 21 11 02 autumn 11 03 01 12 winter 01 13 02 05 there was one spring 2016 02 07 two summer 2015 10 18 2017 10 23 three autumn 2013 11 29 2014 11 16 2019 11 14 and one winter 2021 01 19 in selected seven phases the ahf results in different seasons were counted and the average ahf values in different seasons had the following relationship spring 12 31 w m2 winter 11 20 w m2 summer 9 44 w m2 autumn 8 69 w m2 this may be because the temperature in spring and winter is lower and additional heat sources were needed for heating the interior of the building in summer the temperature is higher and additional energy is needed inside the building for cooling in autumn the temperature is suitable so there is no need to manually adjust the indoor temperature it is worth noting that the summer images 2015 10 18 2017 10 23 selected in this study were all in late summer due to the cloudy summer in the study area the cooling energy consumed was less than that in the midsummer period so theoretically the maximum ahf should occur in summer rather than spring to investigate the effect of individual ahf components on total ahf we plotted stacked histograms of individual ahf components for each period of data fig 5 among the three components of ahf the average proportion of ahf from building ab in the total ahf was the largest 51 2 followed by ahf from vehicle av 34 6 and ahf from human metabolism am was minimal 14 2 as the total energy consumption in the study area was increasing year by year ab is on an overall trend of increasing except for the data in 2016 02 07 this is due to the lower temperature and the greater consumption of energy in february as the road area and the number of vehicles increased year by year the av should also show an increasing trend however the results showed that the av of 2014 11 16 2015 10 18 and 2016 02 07 were higher than that of the latter three phases it was because these three data were all from non working days and the traffic flow at 11 am on non working days was much higher than working days wen et al 2014 am showed a slight upward trend year by year which was due to the yearly increase of the population in the study area 4 3 et estimated by pm urban the instantaneous et of the study area in 7 periods is shown in fig 6 to explore the spatial distribution pattern of et in shenzhen the results of the 2014 11 16 et were selected for further analysis fig 7 it could be observed that the et of each land use type figure s5 had the following relationship water 1 53 mm d trees 1 33 mm d mangrove 1 17 mm d grassland 1 09 mm d shrubland 0 92 mm d cropland 0 80 mm d wetland 0 67 mm d bare soil 0 54 mm d built up 0 43 mm d due to the height and type of the building the value of the internal dissipation of the building varied greatly 0 06 13 9 mm d in terms of broad land use categories there are the following relationships water body 1 53 mm d vegetation 1 18 mm d bare soil 0 54 mm d no building impervious surface 0 43 mm d the buildings with higher et values than water surface et were primarily distributed in the dense commercial centers and industrial areas of nanshan district futian district and luohu district fig 7f h the et results in different seasons were counted and the average et values in different seasons were as follows spring 6 51 mm d summer 4 72 mm d autumn 3 83 mm d winter 2 71 mm d this was because the transpiration intensity of vegetation components was generally summer spring autumn winter the result for spring et summer et may be since we only selected one spring data it was possible that the selected spring data were extreme values and could not explain the general problem 4 4 accuracy verification of et the daily scale et inversion value and the pan evaporation data corrected by the complementary relationship were linearly fitted the two dimensional scatter plots and linear fitting results of the two are shown in fig 8 according to fig 8 there was a systematic underestimation of the et inversion value which may be due to the impervious surface in the pixel where the pan evaporation was located the average fimp of this pixel in the 7 periods is 0 211 and the impervious surface did not produce evapotranspiration in the period of no precipitation although the et inversion value was systematically underestimated compared to the pan evaporation observations the scatter points between the predicted et values and the pan evaporation observations were evenly distributed around the linear fitting line the linear fit line had a slight deviation from the 1 1 line and the correlation coefficient between the two was high r 0 966 the root mean square error rmse and mean absolute error mae were both low rmse 0 24 mm d mae 0 202 mm d therefore the pm urban model had achieved good accuracy in the inversion of urban surface et 5 discussion 5 1 impact of ahf on urban et considering strong human activities in the city this study incorporated ahf into the surface energy balance formula to explore the influence of ahf on urban et inversion we used the data of 2021 01 19 to draw the et spatial distribution map considering ahf and ignoring ahf and the distribution map of differences between et with ahf and without ahf fig 9 the average et value considering ahf 0 78 mm d was 0 02 mm d higher than the average et value ignoring ahf 0 76 mm d in the whole study area the difference between fig 9a and fig 9b was mainly in the buildings and roads covered by dense street trees on tree covered buildings the et considering ahf was 0 05 3 29 mm d higher than ignoring ahf which was about 0 7 50 8 of net solar radiation on tree covered roads the et considering ahf was 0 24 0 88 mm d higher than the et ignoring ahf which was about 3 7 13 6 of net solar radiation however this difference is not reflected in areas with high ahf as these areas are mainly concentrated on impervious surfaces in the city center where et is very small without considering the internal dissipation of the building the impact of ahf on et was different for different land cover types as shown in fig 10 mangroves were most affected by ahf among the various land cover type and the et can be underestimated by 4 59 0 05 mm d without considering ahf the water bodies were the least affected by ahf and the et can be underestimated by 0 17 0 003 mm d without considering ahf this may be because the mangroves were located in the core urban area of shenzhen figure s5 where the ahf was extremely large while the water body was generally far away from the center of human activities the et of the water body was less affected by ahf to further explore the influence of ahf on the estimation of urban et the pan evaporation data corrected by the complementary relationship was used to verify the et ignoring ahf fig 11 although the scatter points between the predicted et of ignoring ahf values and the pan evaporation observations were evenly distributed around the linear fitting line the correlation coefficient r 0 934 of the two was lower than that of considering ahf r 0 966 and the rmse and mae were both higher rmse 0 247 mm d mae 0 209 mm d therefore considering ahf could improve the estimation of urban et and it was crucial to add ahf to the energy balance budget similar to our conclusions cong et al 2017 used the sebs urban model to calculate the et in beijing the sebs urban model also considered the impact of ahf on the energy balance proving that ahf had a significant impact on urban et faridatul et al 2020 proposed an improved usebal suitable for cities and found that the calculation results were better than traditional sebal after considering the type of urban underlying surface and ahf 5 2 impact of building dissipation on urban et the buildings are the main underlying surface in the city and the interior is an essential water consuming place for the social water cycle water use inside buildings accounts for a large part of the city s total water consumption the main water activities for urban residents occur inside the building and the water dissipated in these processes is called the building water dissipation zhou et al 2019 some indoor water vapor enters the outdoors through channels such as doors and windows and participates in the atmospheric water cycle especially on sunny days when the indoor relative humidity rh is usually higher than the outdoor rh but this part of the water dissipation was ignored in previous studies of urban et and urban water cycle zhou et al 2019 which made much research of urban et faridatul et al 2020 wang et al 2020 zhang et al 2017 cannot explain the phenomenon of high water consumption in cities to explore the impact of building water dissipation on the et inversion results we used the data of 2021 01 19 to draw the et spatial distribution map considering or ignoring the building water dissipation and the differences between et with and without building dissipation consider ahf fig 12 different from fig 12a b shows the heterogeneity of urban et spatial distribution especially in the central business districts of futian and luohu in the areas with buildings the et considering building water dissipation was 0 15 13 44 mm d higher than the et ignoring building water dissipation the excessive et value occurs in super high buildings which was about 2 3 209 0 of net solar radiation in the entire study area the average et considering building water dissipation 0 78 mm d was 0 06 mm d higher than the average et ignoring building water dissipation 0 71 mm d which also explained the high water consumption in the city the impact of building water dissipation on et was different in different land cover types as shown in fig 13 the et of the built up area was most affected by the building water dissipation and ignoring the building water dissipation would make the et underestimated by 19 88 0 09 mm d while the et of the shrubland was the least affected by the building water dissipation ignoring building water dissipation would underestimate et by 0 37 0 003 mm d this was because most of the buildings were located in built up areas and ignoring the building water dissipation would seriously underestimate the et of the built up areas while the buildings in the shrubland were the least so the shrubland et was least affected by the building water dissipation zhou et al 2019 divided xiamen urban et into the natural and social components they found that the contribution of the social components to et exceeded 40 in 2015 and is still increasing year by year therefore to explain the phenomenon of high water consumption in cities and realize the refined mapping of urban et social water consumption and natural evapotranspiration should be considered at the same time 5 3 uncertainty analysis and outlook it is worth noting that there were some uncertainties in this study the three dimensional features of tall buildings inevitably would cause the complexity of the urban solar short wave radiation transmission process pigeon et al 2014 the complex characteristics of urban buildings and their energy storage characteristics are the two main factors affecting the urban radiation energy budget however we ignored the complex three dimensional characteristics of the city which may affect the accuracy of net radiation in this study that was because the result of remote sensing retrieval is the comprehensive effect of the underlying surface for the city which cannot explain the coupling process of multiple radiations between the wall and the ground cao et al 2018 this study assumed that ahf was wholly converted into heat flux however ahf is emitted from various anthropogenic heat sources and is not entirely converted into land atmosphere heat flux and the measured meteorological data such as air temperature air humidity etc already contains the result of the ahf influence so adding the ahf term to the energy balance budget directly will cause some duplication in this study the pan evaporation data corrected by the complementary relationship was used to evaluate the performance of the proposed method model performance indicators showed that the simulation results of considering ahf were better than those with ahf ignored it should be noted that the lack of flux observation towers in the study area limited the robustness of the model validation with an increasingly sophisticated urban flux observation system this model is expected to be further validated in addition this study only used the meteorological parameters of one weather station and lacked data sets from different locations however the urban environment is heterogeneous and leads to substantial changes in the microclimate digiovanni et al 2018 this study acknowledges areas of future work in using datasets from multiple locations in an urban environment to assess the impact of meteorological parameters on et in future applications pm urban can reduce thermal risks to urban residents and can also be used to accurately fill the gaps in urban ec flux data and generate long term et time series which can better understand the seasonality and trend of urban et foltýnová et al 2019 6 conclusions understanding urban et s spatial and temporal patterns is vital for urban landscape and microclimate management and urban water pressure investigation however current studies rarely estimate et in typical urban environments based on the rs pm model the pm urban model was purposed in this study comprehensively considering the impact of ahf and building water dissipation on urban et we used the pm urban model to generate 7 phases of shenzhen urban et maps and the following conclusions can be drawn 1 the et value of each land use type has the following relationship water body vegetation bare soil no building impervious surface however due to different heights and types of buildings the value of building water dissipation varies greatly 2 considering ahf can improve the estimation of urban et for the highly urbanized areas ahf should be included in the surface energy balance 3 considering the water dissipation of buildings can explain the phenomenon of high water consumption in cities and realize the fine mapping of urban et our research results provide a new perspective for calculating the urban et which can be applied to urban management planning and reducing the urban heat island effect however this study did not consider the three dimensional structure of the city in the next step we will consider the urban canyon effect and finely characterize the net solar radiation of urban to obtain better performance credit authorship contribution statement jiahao chen conceptualization methodology software writing original draft writing review editing jingyi bu conceptualization methodology writing review editing supervision yanxin su writing review editing mengjia yuan writing review editing kexin cao software writing review editing yanchun gao conceptualization writing review editing supervision funding acquisition project administration declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research was funded by the national natural science foundation of china no 41430861 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 127879 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
3314,urban evapotranspiration estimation based on anthropogenic activities and modified penman monteith model jiahao chen conceptualization methodology software writing original draft writing review editing a b jingyi bu conceptualization methodology writing review editing supervision a b yanxin su writing review editing a b mengjia yuan writing review editing a b kexin cao software writing review editing b c yanchun gao conceptualization writing review editing supervision funding acquisition project administration a a key laboratory of water cycle and related land surface processes institute of geographical sciences and natural resources research chinese academy of sciences beijing 100101 china key laboratory of water cycle and related land surface processes institute of geographical sciences and natural resources research chinese academy of sciences beijing 100101 china key laboratory of water cycle and related land surface processes institute of geographical sciences and natural resources research chinese academy of sciences beijing 100101 china b university of the chinese academy of sciences beijing 100049 china university of the chinese academy of sciences beijing 100049 china university of the chinese academy of sciences beijing 100049 china c key laboratory of regional sustainable development modeling institute of geographic sciences and nature resources research chinese academy of sciences beijing 100101 china key laboratory of regional sustainable development modeling institute of geographic sciences and nature resources research chinese academy of sciences beijing 100101 china key laboratory of regional sustainable development modeling institute of geographic sciences and nature resources research chinese academy of sciences beijing 100101 china corresponding authors at key laboratory of water cycle and related land surface processes institute of geographical sciences and natural resources research chinese academy of sciences beijing 100101 china j bu y gao key laboratory of water cycle and related land surface processes institute of geographical sciences and natural resources research chinese academy of sciences beijing 100101 china urban evapotranspiration et is an essential part of the hydrological cycle a complete understanding of urban et is necessary to understand the interaction between the atmosphere and the urban surface however estimating urban et is challenging due to the influence of urban surface heterogeneity and human activities in urban areas therefore this paper proposed an improved multisource parallel model pm urban based on the penman monteith model which is suitable for the et estimation for the underlying surface of the city the pm urban model takes into account the violent human activities in the city and its main characteristics are 1 the anthropogenic heat flux ahf was included in the surface energy balance formula 2 the building water dissipation was considered in this paper taking shenzhen one of the cities with the fastest urbanization process globally as an example seven urban et maps of shenzhen were generated using landsat 8 images the model was verified using pan evaporation data corrected by complementary relationships the results showed that 1 the et of each land use type has the following relationship water body vegetation bare soil no building impervious surface and the value of building water dissipation varies due to the height and type of buildings significant 2 the pm urban model that considers ahf is better than the original model that ignores ahf 3 this model can describe the characteristics of urban et well and explain the phenomenon of high water consumption in cities our research results provide a new perspective for calculating the urban et which can be applied to urban management planning and reducing the urban heat island effect keywords urban evapotranspiration pm urban model anthropogenic heat flux building water dissipation landsat 8 1 introduction urban residents worldwide are increasingly affected by climate change and water scarcity liu and jensen 2018 more than half of the population now lives in urban areas and this proportion is expected to exceed 70 by 2050 bratman et al 2015 the natural terrain is continuously transformed into urban landscapes to meet the growing demand of the urban population yang et al 2014 urbanization has changed the surface and atmospheric conditions in urban areas leading to considerable changes in regional hydroclimate and energy balance yang et al 2016 zhang et al 2009 zhong et al 2015 the increasing population has produced more anthropogenic heat sources causing a series of problems such as the heat island effect and urban waterlogging therefore further understanding of the urban water cycle and energy balance is necessary for future water resources planning evapotranspiration et is a crucial component of the hydrological cycle and energy balance connecting land water and ground energy exchange wang and dickinson 2012 the surface energy flux in the urban environment is always changing due to land cover heterogeneity weng et al 2014 in addition the heat production of human activities affects the surface energy balance and makes the urban water cycle show a natural society duality song et al 2019 sound knowledge of the spatial variations in urban et is essential for understanding the interaction between the atmosphere and urban surfaces kustas and norman 1996 improving urban water management and predicting water consumption under various geographic conditions wagle et al 2017 a variety of methods for estimating regional et have been developed including the water balance method alley 1984 granier et al 1999 long and singh 2010 palmroth et al 2010 senay et al 2011 the meteorological method mcmahon et al 2013 penman 1948 sumner and jacobs 2005 and remote sensing energy balance model allen et al 2007 bastiaanssen et al 1998 roerink et al 2000 su 2002 there have been some studies on surface et in urban areas gao 2012 saher et al 2020 tang et al 2013 wang et al 2020 zhang 2018 zhang et al 2017 zhao 2015 zheng 2012 zhou 2015 gao 2012 calculated the surface et in beijing based on the simulating model for urban water cycle urmod however this model requires high spatial resolution of remote sensing images and relies on local parameters which limited its application and promotion in addition some studies have calculated the urban et tang et al 2013 zhao 2015 but these studies only apply the traditional et model to the city directly they often conclude that urban et is smaller than forests et and farmland et tang et al 2013 zhao 2015 which cannot explain the phenomenon of high water consumption in cities zhou 2015 considering the surface heterogeneity of urban zheng 2012 proposed the modified multisource parallel model mmp which fully considers the diversity of the urban underlying surface however the mmp model ignores the spectral heterogeneity of the city s impervious surface zhang 2018 based on zheng s model zhang et al 2017 proposed a modified multisource parallel model and achieved good results however the model can only rely on aster or modis data with multiple thermal infrared bands zhang et al 2017 the dependence on specific remote sensing data restricts the application of this model therefore zhang 2018 established an urban rs pm model based on the research by mu et al 2011 combined with spectral mixing analysis compared with the mmp model the urban rs pm model simplifies the calculation process and provides acceptable accuracy therefore the urban rs pm model is an effective tool for exploring the effect of et on the urban heat island on a regional scale wang et al 2020 it is worth noting that the above studies ignored the influence of anthropogenic heat flux ahf on the energy balance although the average terrestrial ahf is much lower than the net solar radiation on the global and continental scales human metabolism vehicle and building heat emissions make essential contributions to the urban surface energy budget allen et al 2011 mccarthy et al 2010 sailor 2011 in 2018 the average ahf of the 100 largest cities in the world was 19 56 w m2 which was about 12 of net solar radiation jin et al 2020 and the extreme ahf in tokyo s business districts was even as high as 1590 w m2 flanner 2009 ichinose et al 1999 therefore ahf cannot be ignored and should be included in the surface energy balance of highly urbanized areas cong et al 2017 there are three main methods to estimate ahf energy budget closure method zhou et al 2012 source list method dong et al 2017 zheng and weng 2018 and numerical simulation method assimakopoulos et al 2007 dhakal and hanaki 2002 heiple 2008 hsieh et al 2011 liu et al 2012 the energy budget closure methods are including direct observation from eddy covariance tower and indirect calculation chow et al 2014 the eddy covariance tower can observe the heat flux for the former but it is expensive and challenging chow et al 2014 cui and chui 2021 for the latter ahf can be calculated from the surface energy balance model zhou et al 2012 however the uncertainty of parameters may lead to bias in estimating ahf zhou et al 2012 the source list methods are including the top down method and the bottom up method the advantage of the bottom up approach is that it can provide different ahf at any time and spatial resolution zheng and weng 2018 however this method is time consuming and requires a lot of data to obtain heterogeneous fine scale ahf the top down approach is building a relationship between energy consumption and downscaling indicators such as nighttime light data ntl yang et al 2017 yu et al 2021 ntl related data chen et al 2019 urban functional area sun et al 2018 population density map jin et al 2020 air pollutants afshari et al 2018 numerical models use energy consumption equations to derive the ahf of different types of buildings they are more used to calculate the ahf emission law of a single building which requires a large amount of calculation such models include doe 2 dhakal and hanaki 2002 equest heiple 2008 trnsys assimakopoulos et al 2007 energyplus hsieh et al 2011 cfd liu et al 2012 etc according to the dual water cycle urban et not only includes et on the natural side of grassland shrubs and other vegetation covering the ground järvi et al 2011 but also includes the evaporation generated by indoor human activities zhou et al 2019 and the latter not well reflected in traditional urban et models building water dissipation is the water dissipation generated by anthropogenic and it is the main part of urban social water consumption zhou et al 2019 proposed the urban water dissipation uwd model to cover the water use of various city regions and evaluated the et in xiamen the results showed that the accuracy produced by uwd model is significantly higher than that by traditional remote sensing retrieval methods however this method calculates the urban et from two perspectives of energy balance and water balance and the process is complicated without considering ahf to sum up there is a lack of research that considers both urban ahf and internal dissipation in buildings the objectives of this study were 1 combining ahf and internal dissipation of buildings to build an improved rs pm model from now on referred to as pm urban 2 taking shenzhen as an example estimating urban et based on pm urban model and exploring the impact of ahf and building water dissipation on urban et 2 study area and data 2 1 study area shenzhen is one of the cities with the fastest urbanization in china and even worldwide therefore this study selects shenzhen guangdong province except dapeng new district shenzhen shantou special cooperation zone and pingshan district as the study area the study area is located in the southern part of guangdong province china 113 43 114 21 e and 22 27 22 51 n fig 1 with a total area of 1535 78 km2 the study area has a subtropical oceanic climate with the annual average temperature of 22 4 and the average yearly rainfall of 1933 3 mm li et al 2016 according to the seventh census of china national bureau of statistics 2021 the total population of the study area reached 16 79 million 2 2 data 2 2 1 satellite data seven sets of landsat 8 operational land imager oli 30 m resolution and thermal infrared sensor tirs 100 m resolution images roy et al 2014 table 1 for the period 2013 2021 were selected for inversing urban et in the study area due to a large amount of cloud cover in the study area in summer the chosen images were primarily in autumn and winter based on the acquisition date of landsat 8 data two phases of google earth imagery in futian district and luohu district of shenzhen acquired on november 17 2014 and october 23 2017 respectively were selected to verify the results of linear spectral mixing analysis in addition the 4 level modis global leaf area index product mod15a2h myneni et al 2002 was used to calculate the canopy conductance of vegetation the product uses an 8 day cycle to select the best pixel from all the pixels obtained by the terra sensor for synthesis 2 2 2 meteorological data based on the pm urban model the inversion of urban et requires meteorological observation data including temperature tair relative air humidity rh atmospheric pressure pa wind speed uz and water vapor pressure e we obtained all meteorological data corresponding to the acquisition time of landsat 8 images from the shenzhen municipal government data open platform https opendata sz gov cn table 2 2 2 3 pan evaporation data due to the lack of flux measurement towers in the study area the e601b type pan evaporation observation data from the basic weather station in shenzhen was be used for model verification pan evaporation observation data represents the amount of water loss from the earth to the atmosphere in the form of water vapor during a period mm day with an unlimited supply of water sun et al 2011 it is worth noting that the pan evaporation data is not the actual et le value but can be regarded as the potential et lep therefore le can be calculated using the complementary relationship theory the complementary relationship correction method is shown in section 3 8 2 2 4 socioeconomic data the building distribution map and building height data in shenzhen come from amap figure s1 https www amap com the energy consumption data comes from the shenzhen statistical yearbook https www sz gov cn cn xxgk zfxxgj tjsj tjnj water consumption data comes from shenzhen water resources bulletin http swj sz gov cn sjfb szygb the population distribution data adopts gpwv411 gridded population of the world version 4 11 its original spatial resolution is 0 5 min 0 5 min and the nearest neighbor method cover and hart 1967 is used to downscale it to 30 m 30 m which is used to calculate the heat flux generated by humans metabolism in the grid 3 methodology based on the urban rs pm model of zhang 2018 we established a new urban et model pm urban by combining ahf and building water dissipation in this model we take the neglected ahf into account in the conventional energy balance equation 1 r n a h l e g where r n is the net surface radiation a is the anthropogenic heat flux h is the sensible heat flux le is the latent heat flux and g is the soil heat flux in addition we assumed that the mixed pixels in urban areas were composed of vegetation bare soil and impervious surfaces water bodies generally exist independently in isolated patches and can be removed by the water index method chen et al 2020 the distribution of buildings can be determined using the building distribution map of shenzhen the original model ignored the et from the impervious surface estimating the et of the urban mixed pixel as the sum of vegetation component transpiration and soil component evaporation still it ignored the dissipation inside the building on the impervious surface in this article we expressed the urban et as the sum of vegetation transpiration soil evaporation water surface evaporation and building water dissipation as follows 2 et e t v e t s e t w e t b among them etv and ets are the vegetation component transpiration and soil component evaporation in urban mixed pixels etw represents water surface evaporation and etb is the internal dissipation of buildings considering the pixel components heterogeneity the pm urban model used the re derived penman monteith algorithm which incorporates the dual source parallel surface energy balance model considering ahf based on this estimating the transpiration of vegetation components and soil components evaporation is possible in the mixed urban pixels water surface evaporation is calculated using the penman formula see section 3 7 for the calculation method of building water dissipation the calculation formula for each component of urban et is as follows 3 et v f v δ r n ν a ρ c p e s e a r ah ν δ γ 1 r s ν r ah ν 4 et s f s δ r n s a g s ρ c p e s e a r ah s δ γ 1 r s s r ah s rh 100 e s e a 1000 5 et w δ r n w a δ γ γ δ γ 6 43 1 0 536 u 2 e s e a λ where fv and fs are the proportions of vegetation and bare soil components in the mixed pixels respectively λ j kg 1 is the latent heat of vaporization of water δ is the slope of the saturated water vapor pressure curve pa k 1 r n ν r n s and r n w w m 2 are net radiation of pure vegetation pixels pure soil pixels and pure water bodies respectively a w m 2 is ahf g s w m 2 is the soil heat flux in a pure soil pixel ρ kg m 3 cp j kg 1 k 1 es pa and ea pa are air density air specific heat capacity saturated vapor pressure and actual vapor pressure respectively r ah ν and r ah s s m 1 are the aerodynamic heat transfer resistance of vegetation and soil respectively γ is the psychrometric constant r s v s m 1 is the surface resistance of the vegetation canopy r s s s m 1 is the sum of the air resistance of the soil surface rh is the air relative humidity u 2 is the wind speed at the height of two meters 3 1 linear spectral mixture analysis a normalized linear spectral mixture analysis nsma wu 2004 wu and murray 2003 was applied to extract each mixed pixel s fv fs and fimp the surface component fractions are the fundamental parameters of the pm urban and should be evaluated before calculating other parameters two high resolution images of google earth 2014 11 17 and 2017 10 23 were obtained to verify the accuracy of the pixel decomposition results a total of 100 validation samples were randomly generated on the google earth image and three surface component fractions of each validation sample were extracted by manual interpretation the results of component fractions verification are shown in section 4 1 3 2 component net radiation inversion the net radiant flux on the surface can be expressed as 6 r n 1 a s d ε air σ t air 4 ε λ σ t sur 4 where a is albedo s d w m 2 is the downward short wave radiation ε air and ε λ are the effective atmospheric emissivity and surface emissivity respectively σ is the stefan boltzmann constant tair k is the average atmospheric temperature and tsur k is the average surface temperature zhang 2018 expressed the net radiant flux of the four components as 7 r n v 1 a v s d ε air σ t air 4 ε v σ t v 4 8 r n s 1 a s s d ε air σ t air 4 ε s σ t s 4 9 r n i m p 1 a imp s d ε air σ t air 4 ε imp σ t imp 4 10 r n w 1 a w s d ε air σ t air 4 ε w σ t w 4 where r n v r n s r n i m p r n w represent the net radiation flux of vegetation soil impervious and water surface respectively a v a s a imp a w represent the albedo of vegetation soil impervious and water surface respectively ε v ε s ε imp ε w represent the emissivity of vegetation soil impervious surface and water surface tv ts timp tw represent the temperature of vegetation soil component impervious surface and water surface respectively 3 3 component aerodynamic resistance inversion we adopted the model proposed by kustasa and norman 1999 to calculate the aerodynamic resistance for vegetation components and bare soil components r ah v r ah s the aerodynamic resistance can be expressed as 11 r ah i 1 k 2 u z l n z d 0 i z 0 m i ψ m i l n z d 0 i z 0 h i ψ h i where r ah i is aerodynamic resistance i v i s represents vegetation and bare soil respectively k is van karman constant 0 41 z is the reference height u z is the wind speed observed at height z d 0 i is the zero plane displacement z 0 m i z 0 h i are the roughnesses for momentum and sensible heat respectively ψ m i ψ h i are the stability correction functions for momentum and heat respectively for specific calculation methods please refer to the supplementary material 3 4 component surface resistance inversion the component surface resistance was calculated using the vegetation canopy and soil surface resistance model proposed by mu et al 2007 by calculating canopy conductance mu et al 2007 developed a method for estimating vegetation canopy surface resistance rs v as follows 12 g s c l m t min m v p d 13 g c g s l a i where the leaf area index lai was used to convert stomatal conductance g s to canopy conductance g c and r s v is the inverse of g c c l is the mean potential stomatal conductance per unit leaf area which can be taken as 0 0013 according to leuning et al 2009 research t min is minimum air temperatures vpd is saturated air vapor pressure m t min and m v p d are the temperature and water vapor pressure stress functions for soil surfaces the surface resistance formula is as follows 14 r s s r totc 1 0 273 15 t 293 15 1 75 101 3 p a where r totc is the constant based on ground observations the value is 107 0 m s wallace and holwill 1997 3 5 soil heat flux inversion based on the observational data of soil heat flux and soil component net radiation friedl 1996 found that there is a functional relationship between the soil heat flux g s the soil component net radiation r n s and the solar zenith angle θ which can be expressed as 15 g s 0 25 r n s c o s θ 3 6 anthropogenic heat flux calculation we used the method of liu et al 2021 to calculate ahf in shenzhen it assumes that all consumed energy is eventually converted into heat flux between land and air and ignores the delay between energy utilization and conversion into heat energy lu et al 2017 pigeon et al 2007 we divided the ahf into three components building heat flux vehicle heat flux and human metabolism heat flux equation 16 then we estimated the annual average ahf of the three components and then used a series of downscaling methods to reduce it to the instantaneous scale of the imaging moment 16 a a b a v a m where a is total ahf ab is building heat flux av is vehicle heat flux am is human metabolism heat flux 3 6 1 ahf from building based on the available statistical data liu et al 2021 discovered the relationship between the volume and energy consumption of different buildings and then could downscale the statistical building energy consumption data to the level of a single building first according to shenzhen poi data buildings are divided into seven types industrial buildings commercial buildings government office buildings residential buildings business office buildings hospitals and educational buildings after reducing the energy consumption to the level of a single building the ahf calculation formula for each building is 17 a by i e i c a i t 18 e k i e k total v k total v k i where a by i w m2 is the annual average ahf of building i e i tec is the total annual energy consumption of building i calculated in a ton of standard coal equivalent c j is standard coal heat which equals 29 27 109j a i m2 is the base area of building i t s is the total seconds in a year e k i tec is the energy consumption of type k building i k 1 2 3 4 5 6 7 representing industrial buildings commercial buildings government office buildings residential buildings business office buildings hospital and educational buildings respectively e k total tec is the total energy consumption of type k buildings v k total m3 is the total volume of type k buildings v k i m3 is the volume of type k building i first downscale the annual building ahf to the monthly building ahf liu et al 2021 19 a bm a by a m 20 a m β m m 1 12 β m 12 21 β m t m t b 0 03 1 t m t b t b t m 0 05 1 t m t b where a bm is the monthly building ahf a m is the monthly weighting coefficient of building ahf β m is the monthly weighting coefficient of monthly energy consumption based on local temperature t m is the monthly mean temperature of the study area t b is the air temperature equilibrium point in this study shenzhen s multi year average temperature 22 c was selected as t b then downscale the monthly scale building ahf to the daily scale and further downscale it to the instantaneous building ahf zheng and weng 2018 22 a bd k a bm k n w n n n w ε k n n ε k w o r k d a y a bm k n w n n n w ε k n n n o n w o r k d a y 23 a bh k a bd k r k where a bd k is the average daily ahf of the type k building w m2 n w is the number of workdays in a month n n is the number of non workdays in a month ε k is the ratio of the ahf of building type k in workdays to non workdays table 3 chung and park 2015 quah and roth 2012 xia et al 2014 zheng and weng 2018 zhou et al 2015 a bh k is ahf for type k buildings w m2 at 11 am the imaging time of the 7 landsat data are around 11 am r k is the ratio of ahf from building type k to the workday and non workday mean ahf at 11 am table 3 chung and park 2015 quah and roth 2012 xia et al 2014 zheng and weng 2018 zhou et al 2015 3 6 2 ahf from vehicle a vy can be estimated based on the number of vehicles the average annual driving distance and the road area chen et al 2019 24 a vy v d ρ f e β a r t where v is the number of vehicles in the study area d is the annual average driving distance per vehicle v and d derived from shenzhen traffic development report 2013 2020 ρ f is fuel density 0 85 kg l e is automobile fuel efficiency 0 12 l km β is the net heat emission of automotive vehicles 4 5 107 j kg ρ f e and β were derived from quah and roth 2012 a r is the road area 189 23 km2 then annual traffic ahf can be downscaled to monthly traffic ahf 25 a vm a vy γ m 26 γ m δ m m 1 12 δ m 12 27 δ m β m ρ m where a vm is monthly scale vehicle ahf γ m is the monthly adjustment weighting factor of the vehicle ahf δ m is the monthly weight coefficient of vehicle energy consumption ρ m is the ratio of the vehicles in use in each month to the monthly mean vehicles in use downscale the monthly scale vehicle ahf to the daily scale and further down scale it to the instantaneous traffic ahf zheng and weng 2018 28 a vd a vm n w n n n w ε n n ε w o r k d a y a vm n w n n n w ε n n n o n w o r k d a y 29 a vh a vd r where a vd is the average daily ahf of the vehicle w m2 ε is the ratio of the ahf of vehicles in workdays to non workdays table 3 wen et al 2014 a vh is the hourly mean ahf of vehicles w m2 r is the ratio of the ahf of the vehicle at 11 am to the ahf of the whole day table 3 wen et al 2014 3 6 3 ahf from human metabolism a m can be estimated based on population density and metabolic rate allen et al 2011 30 a m ρ grid q d where ρ grid is population density within a pixel q d is the human body s daily metabolic rate which is 175 w according to the study of sailor and lu 2004 3 7 estimation of building water dissipation we used the water balance equation to calculate internal building dissipation ignoring product carryover and soil absorption 31 et b s d w where s is the anthropogenic water supply d is the wastewater discharge and w is the water dissipation the building water dissipation was divided into three categories industrial building dissipation residential building dissipation and public building dissipation and then calculated based on the total dissipation and total volume of different categories of buildings 32 et b l i w l total v l total v l i t et b l i is the dissipation of category l building i l 1 2 3 representing industrial buildings residential buildings and public buildings respectively w l total m3 is the total dissipation of category l building v l total m3 is the total volume of category l buildings v l i m3 is the volume of category l building i t s is the total time in a given year 3 8 correction of pan evaporation data the complementary relationship between le and lep can be expressed as 33 b l e w l e l e p l e w where b is a proportional coefficient to measure the impact of the change in actual evapotranspiration on potential evaporation lew is the wet environment et usually the priestley taylor equation brutsaert and stricker 1979 is used to calculate lew 34 lew α δ r n g δ γ where α is the priestley taylor coefficient it is usually used as a calibration coefficient still to reduce the degree of freedom brutsaert and stricker 1979 its value is fixed to 1 26 in this paper to determine the value of the complementary coefficient b zuo et al 2016 defined the pan evaporation heterogeneity intensity index ie which represents the unevenness of the pan evaporation water body and the surrounding ground surface it is the ratio of pan evaporation lepan to penman potential evaporation leppman namely 35 i e le pan le ppman zuo et al 2016 proved that the complementary coefficient b is linearly related to ie through experiments that is 36 b 2 59 i e 1 23 after calculation the complementary coefficient b of the e601b type pan evaporation in the shenzhen area is 1 49 substituting into equation 33 the pan evaporation data after the correction of the complementary relationship can be obtained since the pan evaporation data is daily scale data we used the evaporation ratio invariance method brutsaert and sugita 1992 to upscale the instantaneous et values of the pixel where the evaporating pan is located to the daily scale 4 results 4 1 accuracy verification of component fractions using the nsma model the component fraction decomposition of seven landsat 8 images was carried out and finally the surface component fractions of each endmember were obtained the component fractions of the three endmembers after the mixed pixel decomposition of the 7 period images are shown in figure s2 to figure s4 respectively make a two dimensional scatter plot of the component fraction inversion and actual values from the visual interpretation and perform linear regression analyses the result is shown in fig 2 figure 2 shows that there are some extreme points whose y coordinate value did not change with the coordinate value due to the proximity effect richter 1998 specifically some pure vegetation bare soil pixels were influenced by the surrounding mixed pixels that also exhibited the characteristics of other components nevertheless the correlation r between the retrieval value and the actual value of the vegetation and bare soil component fractions were all larger than 0 89 indicating a high correlation since all seven images used the same mixed pixel decomposition method the verification results of these 2 phases were random sampling inspection therefore it could be judged that the mixed pixel decomposition result of the seven images could meet the accuracy requirements of the pm urban model and further calculations could be carried out 4 2 the spatiotemporal variation of ahf we used the socioeconomic data of shenzhen to obtain the 7 period ahf retrieval results fig 3 to explore the spatial distribution pattern of ahf in shenzhen the ahf retrieval result of 2014 11 16 was selected for further analysis as shown in fig 4 areas with high ahf values were located in the southern and western parts of the city such as futian fig 4g luohu fig 4h nanshan fig 4f and baoan fig 4d the low value areas of ahf were distributed in the northeast and central mountainous regions such as yantian fig 4e areas with very high ahf were usually located in dense business office areas and industrial parks fig 4d f h especially in the ultra high commercial buildings in futian district the tallest building is 592 5 m the average ahf could reach almost 500 w m2 and the highest value could even reach 1678 w m2 it is worth noting that compared with other studies jin et al 2020 liu et al 2021 yu et al 2021 on ahf the ahf in this study was higher this was because the resolution in this study was 30 m which was higher than in other studies the higher the resolution the better the heterogeneity of ahf and vice versa according to the climatological season division method zhong 1995 spring 02 06 04 20 summer 04 21 11 02 autumn 11 03 01 12 winter 01 13 02 05 there was one spring 2016 02 07 two summer 2015 10 18 2017 10 23 three autumn 2013 11 29 2014 11 16 2019 11 14 and one winter 2021 01 19 in selected seven phases the ahf results in different seasons were counted and the average ahf values in different seasons had the following relationship spring 12 31 w m2 winter 11 20 w m2 summer 9 44 w m2 autumn 8 69 w m2 this may be because the temperature in spring and winter is lower and additional heat sources were needed for heating the interior of the building in summer the temperature is higher and additional energy is needed inside the building for cooling in autumn the temperature is suitable so there is no need to manually adjust the indoor temperature it is worth noting that the summer images 2015 10 18 2017 10 23 selected in this study were all in late summer due to the cloudy summer in the study area the cooling energy consumed was less than that in the midsummer period so theoretically the maximum ahf should occur in summer rather than spring to investigate the effect of individual ahf components on total ahf we plotted stacked histograms of individual ahf components for each period of data fig 5 among the three components of ahf the average proportion of ahf from building ab in the total ahf was the largest 51 2 followed by ahf from vehicle av 34 6 and ahf from human metabolism am was minimal 14 2 as the total energy consumption in the study area was increasing year by year ab is on an overall trend of increasing except for the data in 2016 02 07 this is due to the lower temperature and the greater consumption of energy in february as the road area and the number of vehicles increased year by year the av should also show an increasing trend however the results showed that the av of 2014 11 16 2015 10 18 and 2016 02 07 were higher than that of the latter three phases it was because these three data were all from non working days and the traffic flow at 11 am on non working days was much higher than working days wen et al 2014 am showed a slight upward trend year by year which was due to the yearly increase of the population in the study area 4 3 et estimated by pm urban the instantaneous et of the study area in 7 periods is shown in fig 6 to explore the spatial distribution pattern of et in shenzhen the results of the 2014 11 16 et were selected for further analysis fig 7 it could be observed that the et of each land use type figure s5 had the following relationship water 1 53 mm d trees 1 33 mm d mangrove 1 17 mm d grassland 1 09 mm d shrubland 0 92 mm d cropland 0 80 mm d wetland 0 67 mm d bare soil 0 54 mm d built up 0 43 mm d due to the height and type of the building the value of the internal dissipation of the building varied greatly 0 06 13 9 mm d in terms of broad land use categories there are the following relationships water body 1 53 mm d vegetation 1 18 mm d bare soil 0 54 mm d no building impervious surface 0 43 mm d the buildings with higher et values than water surface et were primarily distributed in the dense commercial centers and industrial areas of nanshan district futian district and luohu district fig 7f h the et results in different seasons were counted and the average et values in different seasons were as follows spring 6 51 mm d summer 4 72 mm d autumn 3 83 mm d winter 2 71 mm d this was because the transpiration intensity of vegetation components was generally summer spring autumn winter the result for spring et summer et may be since we only selected one spring data it was possible that the selected spring data were extreme values and could not explain the general problem 4 4 accuracy verification of et the daily scale et inversion value and the pan evaporation data corrected by the complementary relationship were linearly fitted the two dimensional scatter plots and linear fitting results of the two are shown in fig 8 according to fig 8 there was a systematic underestimation of the et inversion value which may be due to the impervious surface in the pixel where the pan evaporation was located the average fimp of this pixel in the 7 periods is 0 211 and the impervious surface did not produce evapotranspiration in the period of no precipitation although the et inversion value was systematically underestimated compared to the pan evaporation observations the scatter points between the predicted et values and the pan evaporation observations were evenly distributed around the linear fitting line the linear fit line had a slight deviation from the 1 1 line and the correlation coefficient between the two was high r 0 966 the root mean square error rmse and mean absolute error mae were both low rmse 0 24 mm d mae 0 202 mm d therefore the pm urban model had achieved good accuracy in the inversion of urban surface et 5 discussion 5 1 impact of ahf on urban et considering strong human activities in the city this study incorporated ahf into the surface energy balance formula to explore the influence of ahf on urban et inversion we used the data of 2021 01 19 to draw the et spatial distribution map considering ahf and ignoring ahf and the distribution map of differences between et with ahf and without ahf fig 9 the average et value considering ahf 0 78 mm d was 0 02 mm d higher than the average et value ignoring ahf 0 76 mm d in the whole study area the difference between fig 9a and fig 9b was mainly in the buildings and roads covered by dense street trees on tree covered buildings the et considering ahf was 0 05 3 29 mm d higher than ignoring ahf which was about 0 7 50 8 of net solar radiation on tree covered roads the et considering ahf was 0 24 0 88 mm d higher than the et ignoring ahf which was about 3 7 13 6 of net solar radiation however this difference is not reflected in areas with high ahf as these areas are mainly concentrated on impervious surfaces in the city center where et is very small without considering the internal dissipation of the building the impact of ahf on et was different for different land cover types as shown in fig 10 mangroves were most affected by ahf among the various land cover type and the et can be underestimated by 4 59 0 05 mm d without considering ahf the water bodies were the least affected by ahf and the et can be underestimated by 0 17 0 003 mm d without considering ahf this may be because the mangroves were located in the core urban area of shenzhen figure s5 where the ahf was extremely large while the water body was generally far away from the center of human activities the et of the water body was less affected by ahf to further explore the influence of ahf on the estimation of urban et the pan evaporation data corrected by the complementary relationship was used to verify the et ignoring ahf fig 11 although the scatter points between the predicted et of ignoring ahf values and the pan evaporation observations were evenly distributed around the linear fitting line the correlation coefficient r 0 934 of the two was lower than that of considering ahf r 0 966 and the rmse and mae were both higher rmse 0 247 mm d mae 0 209 mm d therefore considering ahf could improve the estimation of urban et and it was crucial to add ahf to the energy balance budget similar to our conclusions cong et al 2017 used the sebs urban model to calculate the et in beijing the sebs urban model also considered the impact of ahf on the energy balance proving that ahf had a significant impact on urban et faridatul et al 2020 proposed an improved usebal suitable for cities and found that the calculation results were better than traditional sebal after considering the type of urban underlying surface and ahf 5 2 impact of building dissipation on urban et the buildings are the main underlying surface in the city and the interior is an essential water consuming place for the social water cycle water use inside buildings accounts for a large part of the city s total water consumption the main water activities for urban residents occur inside the building and the water dissipated in these processes is called the building water dissipation zhou et al 2019 some indoor water vapor enters the outdoors through channels such as doors and windows and participates in the atmospheric water cycle especially on sunny days when the indoor relative humidity rh is usually higher than the outdoor rh but this part of the water dissipation was ignored in previous studies of urban et and urban water cycle zhou et al 2019 which made much research of urban et faridatul et al 2020 wang et al 2020 zhang et al 2017 cannot explain the phenomenon of high water consumption in cities to explore the impact of building water dissipation on the et inversion results we used the data of 2021 01 19 to draw the et spatial distribution map considering or ignoring the building water dissipation and the differences between et with and without building dissipation consider ahf fig 12 different from fig 12a b shows the heterogeneity of urban et spatial distribution especially in the central business districts of futian and luohu in the areas with buildings the et considering building water dissipation was 0 15 13 44 mm d higher than the et ignoring building water dissipation the excessive et value occurs in super high buildings which was about 2 3 209 0 of net solar radiation in the entire study area the average et considering building water dissipation 0 78 mm d was 0 06 mm d higher than the average et ignoring building water dissipation 0 71 mm d which also explained the high water consumption in the city the impact of building water dissipation on et was different in different land cover types as shown in fig 13 the et of the built up area was most affected by the building water dissipation and ignoring the building water dissipation would make the et underestimated by 19 88 0 09 mm d while the et of the shrubland was the least affected by the building water dissipation ignoring building water dissipation would underestimate et by 0 37 0 003 mm d this was because most of the buildings were located in built up areas and ignoring the building water dissipation would seriously underestimate the et of the built up areas while the buildings in the shrubland were the least so the shrubland et was least affected by the building water dissipation zhou et al 2019 divided xiamen urban et into the natural and social components they found that the contribution of the social components to et exceeded 40 in 2015 and is still increasing year by year therefore to explain the phenomenon of high water consumption in cities and realize the refined mapping of urban et social water consumption and natural evapotranspiration should be considered at the same time 5 3 uncertainty analysis and outlook it is worth noting that there were some uncertainties in this study the three dimensional features of tall buildings inevitably would cause the complexity of the urban solar short wave radiation transmission process pigeon et al 2014 the complex characteristics of urban buildings and their energy storage characteristics are the two main factors affecting the urban radiation energy budget however we ignored the complex three dimensional characteristics of the city which may affect the accuracy of net radiation in this study that was because the result of remote sensing retrieval is the comprehensive effect of the underlying surface for the city which cannot explain the coupling process of multiple radiations between the wall and the ground cao et al 2018 this study assumed that ahf was wholly converted into heat flux however ahf is emitted from various anthropogenic heat sources and is not entirely converted into land atmosphere heat flux and the measured meteorological data such as air temperature air humidity etc already contains the result of the ahf influence so adding the ahf term to the energy balance budget directly will cause some duplication in this study the pan evaporation data corrected by the complementary relationship was used to evaluate the performance of the proposed method model performance indicators showed that the simulation results of considering ahf were better than those with ahf ignored it should be noted that the lack of flux observation towers in the study area limited the robustness of the model validation with an increasingly sophisticated urban flux observation system this model is expected to be further validated in addition this study only used the meteorological parameters of one weather station and lacked data sets from different locations however the urban environment is heterogeneous and leads to substantial changes in the microclimate digiovanni et al 2018 this study acknowledges areas of future work in using datasets from multiple locations in an urban environment to assess the impact of meteorological parameters on et in future applications pm urban can reduce thermal risks to urban residents and can also be used to accurately fill the gaps in urban ec flux data and generate long term et time series which can better understand the seasonality and trend of urban et foltýnová et al 2019 6 conclusions understanding urban et s spatial and temporal patterns is vital for urban landscape and microclimate management and urban water pressure investigation however current studies rarely estimate et in typical urban environments based on the rs pm model the pm urban model was purposed in this study comprehensively considering the impact of ahf and building water dissipation on urban et we used the pm urban model to generate 7 phases of shenzhen urban et maps and the following conclusions can be drawn 1 the et value of each land use type has the following relationship water body vegetation bare soil no building impervious surface however due to different heights and types of buildings the value of building water dissipation varies greatly 2 considering ahf can improve the estimation of urban et for the highly urbanized areas ahf should be included in the surface energy balance 3 considering the water dissipation of buildings can explain the phenomenon of high water consumption in cities and realize the fine mapping of urban et our research results provide a new perspective for calculating the urban et which can be applied to urban management planning and reducing the urban heat island effect however this study did not consider the three dimensional structure of the city in the next step we will consider the urban canyon effect and finely characterize the net solar radiation of urban to obtain better performance credit authorship contribution statement jiahao chen conceptualization methodology software writing original draft writing review editing jingyi bu conceptualization methodology writing review editing supervision yanxin su writing review editing mengjia yuan writing review editing kexin cao software writing review editing yanchun gao conceptualization writing review editing supervision funding acquisition project administration declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research was funded by the national natural science foundation of china no 41430861 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 127879 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
