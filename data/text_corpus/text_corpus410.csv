index,text
2050,the snowpack on the tibetan plateau tp which feeds ten major rivers and supplies freshwater to heavily populated downstream areas is undergoing major changes owing to climate change however the impact of climate change on snowpacks is debated because of the lack of quantitative knowledge about snow mass on the tp in this study we collected long time series data of the snowpack 1961 2018 from 143 stations on the tp at elevations of 1100 4800 m asl and calculated the snow water equivalent based on the observed snow depths and simulated snow densities to examine the snow mass trends transition patterns of the trends and their climatic causes the results show that snow mass on the tp experienced a large increase 1 56 mm y until 1981 and a decrease 0 58 mm y after 1981 the snow mass trends exhibited three transition patterns before and after 1981 increasing snow mass trends intensified and decreasing trends weakened on the north edge of the tp snow loss intensified in the northeast region and snow mass trends reversed from increasing to decreasing in the south north of 35 n the snow mass variability was controlled by precipitation changes south of 35 n warming affected only a few stations below 3000 m before 1981 and the reinforced warming then resulted in increased snow mass loss at almost all the stations after 1981 warming driven snow mass reversals and the continued warming on the tp could lead to significant water management challenges in densely populated downstream areas abbreviations cma chinese meteorological administration mk mann kendall swe snow water equivalent tp tibetan plateau keywords snow mass change snow water equivalent pattern transition trend reversals climatic causes data availability data will be made available on request 1 introduction seasonal snow is a fundamental component of both global energy and water cycle bormann et al 2018 the snowpack on the tibetan plateau tp plays a critical role in regulating the regional and global climate by influencing the energy exchange between the land surface and atmosphere xu et al 2017 snowmelt from the tp feeds ten major rivers and supplies freshwater to densely populated downstream areas for extensive irrigated agriculture municipal and industrial uses yao et al 2019 over the past few decades the tp has experienced considerable climate change with significant warming and wetting or drying of extensive areas kraaijenbrink et al 2021 under the present climate change scenario persistent changes in the regional snowpack can have significant even disruptive social and economic impacts bormann et al 2018 immerzeel et al 2020 therefore understanding current snow dynamics and their climate drivers is necessary to prepare for future changes in water resources of the tp previous studies have reported variations in the snow cover distribution mean snow depth and seasonal snow water equivalent swe on the tp from the 1950s or 1960s to the 1990s the in situ observations of snow cover and snow depth exhibited increasing trends qin et al 2006 which were accompanied by increased precipitation and land surface cooling zhang et al 2004 however during the great warming in the 1980s and 1990s western china including the tp did not experience a continual decrease in snow cover no correlation was observed between the snow variability and temperature or precipitation during this period qin et al 2006 during 1961 2010 in situ observations showed weak negative trends for snow cover mean daily snow depth and number of snow cover days shen et al 2015 xu et al 2017 these variations were in accordance with the snowfall record but inconsistent with the warming trend xu et al 2017 meanwhile satellite data have indicated decreasing snow mass trends during 1972 2006 the persistent time of snow cover significantly declined in the western tp zhang and ma 2018 during 1987 2009 the swe obtained from the special sensor microwave imager showed an overall decrease in high mountainous areas in asia smith and bookhagen 2018 during 2000 2014 the snow cover area snow cover duration and swe on the tp exhibited decreasing trends which were accompanied by decreased snowfall increased rainfall and increased temperature huang et al 2017 however during 2000 2015 moderate resolution imaging spectroradiomete daily products of the snow cover area did not detect a conspicuous decrease in the snow cover wang et al 2017 you et al 2020 while the decrease in the snow cover area occurred mainly in the central and eastern parts of the tp notarnicola 2020 in the past two decades the data from integrated multi satellite retrievals for global precipitation measurement version 6 have indicated that snow cover increased in most regions of the tp li et al 2022 the above mentioned studies mostly focused on snow characteristics such as snow cover or depth which provide only a limited hydrological context snow change over a relatively short period can be sensitive to the statistical period reliable quantitative information about the snow mass on the tp is scarce hence the impact of climate change on snowpacks is still under debate smith and bookhagen 2018 therefore we collected long time series data of the snowpack and concurrent temperature and precipitation data from 143 stations on the tp from 1961 to 2018 estimated the swe and annual snow mass by combining the observed snow depth and modeled snow bulk density examined the spatial and temporal heterogeneities of snow characteristics and snow mass changes revealed the major climate drivers of snow mass variability and explored the sensitivity of snow mass variability to regional warming 2 study area data and methods 2 1 study area the tp is a high altitude area in asia stretching from the pamirs and hindu kush in the west to the himalayas in the south hengduan mountains in the east and qilian and kunlun mountains in the north gao et al 2018 ten major rivers originate from the tp and are fed by the snow and glacier melts on the tp the climate over the tp is primarily influenced by the asian monsoon and the mid latitude westerlies the annual mean temperature across the tp is generally below 0 c and decreases from east to west frauenfeld et al 2005 precipitation distribution on the tp is uneven with significant spatial differences decreasing from the southeast to the northwest the central and eastern tp and southern himalayas experience maximum and minimum precipitation in summer and winter respectively more than 50 80 of the annual precipitation occurs between july and october including monsoonal and convective precipitation however the western tp experiences the maximum precipitation in winter and is dominated by mid latitude westerlies more than 60 of the annual precipitation occurs between december and april curio and scherer 2016 2 2 data continuous and high quality data of the daily snow depth average air temperature and total precipitation recorded at 143 stations on the tp were selected in this study all data were strictly processed quality controlled and adjusted for homogeneity before being released by the china meteorological administration to utilize more surface data for long term snow studies we selected 80 stations with continuous data from 1961 to 2018 and another 63 new stations with data from 1981 to 2018 a snow year is defined as the period from september 1 to august 31 of the following year for instance the snow year in 1961 was the period from september 1 1960 to august 31 1961 the selection criteria is that the station should have complete records for the snow years 1961 2018 or 1981 2018 the spatial distribution of 143 stations with elevations from 1100 to 4800 m is shown in fig 1 the stations were primarily located in the nine major upper catchments of tarim ⅰ hexi ⅱ qaidam iii yellow river iv yangtze v mekong salween ⅵ tp interior ⅶ yarlungzangbo viii and ganges ix there are no stations with long time series of observations above 4800 m and in the snow rich amu darya and indus rivers in the western part of the plateau which limits the analysis of long term snow trends in the high altitude area snow depth is the vertical depth from the snow surface to the ground surface it is regularly measured manually by the professional staff of the cma all of whom are trained with the same standards when more than half of the area around the station is covered with snow snow depth is measured using a snow gauge at 8 am the recorded snow depth is typically the average of the measurements taken at minimum three different points and is depicted as an integer in units of centimeter to guarantee the completeness and consistency of the snow depth missing records of daily snow depth were filled using the following procedure first we checked the snow records for missing days if the record showed no snow the missing record was denoted as 0 if it showed snow and the daily mean air temperature was below 0 c the daily snow depth was filled by the value of the sum of the daily precipitation and the snow depth of the previous day if the temperature was between 0 and 2 c the snow depth was filled by the value of the sum of half the daily precipitation and the snow depth of the previous day xu et al 2017 and there were no records of snow at temperatures above 2 c missing records accounted for only 0 04 of the data used in our study therefore the impact of filling the missing records was negligible the daily total precipitation was automatically recorded by 8 inch rain gauges the daily mean air temperature was averaged from hourly observations of the land surface air temperature from an automatic weather station more than 30 80 of the annual precipitation in different areas of the tp occurred from june to september however snowfall rarely occurred during these months compared to the annual climatic characteristics temperature and precipitation changes during the snow season directly affected the snow mass variability based on the amount and percentage of snow mass in different months we divided the stations into four categories defining the snow season in each category from november to march october to april september to may and september to june supplementary fig 1 see supplementary materials for details 2 3 methods in the stable snow areas of the western united states and european alpine one major long snow cycle is observed each year seasonal snow accumulation begins in the fall or winter and typically reaches a maximum around april of the following year fig 2 a the swe on april 1 marty et al 2017 mote et al 2018 or the annual maximum swe skaugen et al 2012 fyfe et al 2017 is approximated as the total annual snow runoff and used to study the snowpack variability in these regions however most areas in the tp are unstable snow areas qin et al 2006 li et al 2018 generally multiple snowfall snowmelt processes with comparable swe values are observed each year and each process only last for a few days or for several dozen days fig 2b therefore traditional metrics such as the swe on april 1or the annual maximum swe were not representative of the annual snow mass to integrate the various snowfall snowmelt processes in the unstable snow areas we calculated and cumulated the maximum swe for each snow cycle and used it to quantify the total amount of water derived from the snowpack on the tp this new metric is defined as the cumulative value of the maximum swe per snow cycle in millimeters water equivalent mm w e which represents the annual snow mass daily swe can be calculated by measuring the snow depth cm multiplied by the modeled snow bulk density using equation 1 1 s w e s n o w d e p t h 10 ρ s ρ w where ρs and ρw are the modeled snow bulk density kg m3 and density of liquid water 1000 kg m3 at 0 c respectively the snow bulk density was simulated using an artificial neural network model wherein the snow cover duration and snow depth were the input parameters this model was developed based on 7 516 measured swe snow depth pairs from the tp over nearly four decades and established to be the best model with minimal errors supplementary fig 2 see supplementary materials for details to analyze the possible long term snow mass trends temperature and precipitation during the snow season we used the non parametric mann kendall mk test this test is based on rank transformed time series data and considers only the relative magnitudes of the measurements marty et al 2017 the positive and negative mk values indicate increasing and decreasing trends respectively in this study a confidence level of 95 was used as the threshold to classify a significant trend p 0 05 whereas that of 80 was used to classify a weakly significant trend 0 05 p 0 2 subsequently we calculated the absolute and relative trends during 1961 2018 and the two sub phases of 1961 1981 and 1981 2018 furthermore the pearson correlation coefficient r between the snow mass trends and concurrent temperature and precipitation changes was calculated to investigate the climatic causes of the snowpack variability sospedra alfonso et al 2015 the pearson correlation coefficient examines the degree of correlation between two data sets the range of the pearson correlation coefficient is between 1 to 1 where 1 is an overall positive correlation 0 is no correlation and 1 is an overall negative correlation 3 results and discussions 3 1 snowpack characteristics of the tp on the tp 80 and 63 stations recorded snow data in the snow years of 1961 2018 and 1981 2018 respectively as more stations can better represent the regional characteristics of the snowpack we used data from these 143 stations in the snow years of 1981 2018 to calculate the mean snow cover days the number of days in a snow year with snow depth 1 cm and mean snow mass fig 3 the mean snow cover days and snow masses of the 143 stations on the tp from 1981 to 2018 were 24 d and 37 mm w e respectively the snow distribution on the tp exhibited spatial heterogeneity wherein 13 stations had a mean annual snow mass greater than 85 mm w e distributed in five catchments blue dots in fig 3a among these stations turgat of tarim i on the northwestern tp had the longest number of snow cover days 133 d and a snow mass of 145 mm w e notably nyalam on the southern slopes of the himalayas in the ganges ix had the highest snow mass of 289 mm w e whereas cona and pagri in this catchment had snow masses of 123 and 94 mm w e respectively the mean number of snow cover days in these three stations was approximately 70 d lhari in yarlungzangbo viii had snow mass and snow cover days of 175 mm w e and 92 d respectively three stations of yangtze v in the eastern part of the tp qingshuihe shiqu and seda had snow masses and snow cover days of 115 111 and 88 mm w e and 100 76 54 d respectively the other five stations of yellow river iv in the northeast tp hongyuan jigzi wuxiaolin gande and dari had similar snow masses and snow cover days of 107 100 94 92 and 91 mm w e and 61 59 70 77 and 70 d respectively snowpack characteristics in the same climatic region are typically closely related to the altitude for example in the same region areas at higher altitudes showed earlier start dates and later end dates of snow cover and had longer snow cover days xu et al 2017 thus we summarized the snow cover days fig 3b and snow masses fig 3c at six altitude intervals 1000 2000 2000 3000 3000 3500 3500 4000 4000 4500 and 4500 5000 m to analyze the snow characteristics the 3500 4000 m intervals of tarim ⅰ in the northwestern tp and ganges ix in the southern tp were areas with the largest snow masses as observed by stations on the tp with values of 145 and 120 mm w e respectively however their mean snow cover days greatly differed 133 and 40 d respectively yarlungzangbo viii in the southern tp had snow cover and snow mass values of less than 10 d and 10 mm w e at most stations except one high altitude station at lhari which indicated that the middle and upper reaches of yarlungzangbo viii were the areas with the least amount of snow cover days and the lowest snow mass the eastern part of the tp hexi ⅱ yellow river iv yangtze v and mekong salween vi had similar snow cover days and snow masses at the same elevation interval however the values of the snow cover days and snow masses in qaidam iii and tp interior ⅶ located further inland were smaller compared to those at the same elevation intervals in previous areas 3 2 snow mass changes and their altitudinal dependence the changes in snow mass on the tp exhibited clear spatio temporal heterogeneity fig 4 during 1961 to 2018 43 of the 80 stations on the tp exhibited significant decreasing snow mass trends and only 3 exhibited significant increasing trends with mean values of 0 24 and 0 22 mm y respectively fig 4a and 4e the stations with significant decreasing snow mass trends were primarily concentrated in the yellow river iv and yangtze v in the eastern tp and the stations with unchanging or increasing snow mass trends were primarily present in tarim i in the northwestern tp however a few stations in other regions with increasing snow mass trends were located above 4200 m the analysis and comparison of the trends in the two sub phases 1961 1981 and 1981 2018 revealed that the snow masses at most stations exhibited increasing and decreasing trends in sub phases 1 and 2 respectively blue triangles in fig 4b and 4f and red triangles in fig 4c and 4 g from 1961 to 1981 10 and 15 of the stations exhibited significant decreasing and increasing snow mass trends respectively 0 65 and 1 56 mm y respectively spatially this can be roughly bounded by the 35 n latitude wherein most stations north and south of 35 n exhibited decreasing and increasing trends respectively fig 4b and 4f from 1981 to 2018 49 of the stations exhibited significant decreasing snow mass trends except tarim ⅰ where most stations exhibited increasing snow mass trends 0 58 and 0 21 mm y fig 4c 4 g most of the 63 new stations established after 1981 were located further inland in the yellow river iv yangtze v and yarlungzangbo viii 65 of which exhibited significant decreasing snow mass trends 0 60 mm y thus 56 of the 143 stations exhibited significant decreasing trends in the snow mass after 1981 fig 4d and 4 h fig 5 shows the altitudinal dependence of absolute and relative changes in the snow mass during 1961 2018 and the two sub phases the absolute change in snow mass increases with increasing altitude however the relative change in snow mass decreases with altitude except for the sites with increased snow mass in 1961 1981 fig 5 in sub phase 1 1961 1981 3000 m can be roughly used as the dividing line most stations exhibiting significant increasing snow mass trends were located above 3000 m while decreasing trends were below 3000 m fig 5b and 5f in sub phase 2 1981 2018 the snowpack exhibited significant decreasing trends with increasing altitude the absolute and relative losses of snow mass increased and decreased respectively and the magnitude of the change was large fig 5c 5d 5 g and 5 h 3 3 transition patterns in snow mass trends a further comparison of the snow mass trends at the stations in each catchment on the tp in sub phases 1 1961 1981 and 2 1981 2018 revealed three transition patterns fig 6 increasing snow mass trends intensified and decreasing trends weakened on the north edge of the tp snow loss intensified in the northeast region and snow mass trends reversed from increasing to decreasing in the south the first pattern primarily occurred in tarim i and hexi ii on the northern edge of the tp in tarim i 40 and 50 of the stations exhibited decreasing 0 24 mm y and increasing 0 12 mm y snow mass trends during sub phase 1 respectively alternatively 20 and 80 of the stations exhibited weakly decreasing 0 13 mm y and increasing 0 15 mm y trends during sub phase 2 respectively in hexi ii all the stations exhibited decreasing trends 0 58 mm y during sub phase 1 whereas only 60 of the stations exhibited weakly decreasing trends 0 19 mm y 40 of the stations exhibited increasing trends 0 07 mm y during sub phase 2 the changes in snow mass in these two regions showed that the increasing trends were strengthened and the decreasing trends were weakened the second pattern primarily occurred in qaidam iii and yellow river iv located in the northeastern part of the tp in qaidam iii 33 of the stations exhibited decreasing snow mass trends 0 24 mm y whereas the other 33 exhibited increasing snow mass trends 0 71 mm y during sub phase 1 however all stations exhibited decreasing trends 0 26 mm y during sub phase 2 in yellow river iv 62 and 34 of the stations exhibited decreasing 0 38 mm y and increasing 0 89 mm y trends during sub phase 1 respectively alternatively 83 and 10 of the stations exhibited significant decreasing trends 0 49 mm y and weakly increasing trends 0 02 mm y during sub phase 2 respectively snow loss in these regions intensified over time shifting from decreasing trends at some stations to significantly decreasing trends at almost all the stations the third pattern primarily occurred in the southeastern and southern regions of the tp including yangtze v meikong salween ⅵ tp interior ⅶ yarlungzangbo viii and ganges ix in yangtze v 24 and 65 of the stations exhibited decreasing 0 17 mm y and increasing 0 59 mm y snow mass trends during sub phase 1 respectively alternatively during sub phase 2 83 of the stations exhibited significant decreasing trends 0 46 mm y in snow mass and the trends in other stations remained unchanged in meikong salween vi the changes in snow masses at all stations reversed from increasing trends 0 82 mm y during sub phase 1 to decreasing trends 0 62 mm y during sub phase 2 in the tp interior ⅶ the snow masses at all the stations also changed from being unchanged during sub phase 1 to significantly decreased during sub phase 2 0 35 mm y in yarlungzangbo viii the snow masses in 43 of the stations exhibited weakly decreasing trends 0 07 mm y whereas those in other stations exhibited increasing trends 1 57 mm y during sub phase 1 alternatively 72 of the stations exhibited significant decreasing snow mass trends 0 62 mm y whereas the trends at other stations remained unchanged during sub phase 2 the snow masses at the stations in ganges ix exhibited no significant trend in either of the sub phase however the snow masses at five of the six new stations established after 1981 exhibited significant decreasing trends 1 18 mm y thus snow mass trends in these regions reversed from increasing at most stations to significantly decreasing at almost all the stations 3 4 climate change and connections to snow mass temperature and precipitation are the major factors controlling the snowpack formation in a complex manner from the 1960 s to 2013 the climate of the tp exhibited rapid warming and wetting trends yao et al 2019 you et al 2020 compared to the annual average conditions climate changes during the snow season directly affected the snow mass variability therefore we analyzed the trends in temperature and precipitation during the snow season of the tp fig 7 and further explored their impact on the snow mass variability fig 8 from 1961 to 2018 all the stations exhibited significant increasing trends in temperature warming with an average rate of 0 04 c y and 69 of the stations exhibited increasing trends in precipitation wetting of which 60 exhibited significant increasing trends with an average rate of 0 45 mm y fig 7a and 7e for the two sub phases 1961 1981 and 1981 2018 46 and 98 of the stations exhibited significant warming trends respectively fig 7b and 7c the number of stations with warming trends exceeding 0 04 c y 0 06 c y increased from 27 to 59 from 9 to 22 these results indicate that the signal and magnitude of warming in the tp have become more intense fig 7b and 7c during sub phase 1 the precipitation increased 0 99 mm y and decreased 0 88 mm y at 53 and 47 of the stations respectively alternatively during sub phase 2 the precipitation increased 0 52 mm y and decreased 0 44 mm y at 80 and 16 of the stations respectively fig 7f and 7 g from sub phases 1 to 2 the number of stations with increased precipitation increased by 22 however the magnitude of increase reduced by almost half to clarify whether the stations with the most significant changes in snow mass were located in regions with specific climatic background or were driven by specific changes in the climate we mapped the snow mass trends at each station with their mean temperature and total precipitation over the snow season as well as with the trends in temperature and precipitation fig 8 stations with upward or downward trends were not concentrated in particular locations however those experiencing more precipitation were more likely to show larger changes in snow mass the snow mass trends on the tp were clearly driven by the changes in the temperature and precipitation particularly during the two sub phases from 1961 to 1981 the rate of warming in stations with increased snow mass was generally less than 0 04 c y when precipitation increased snow mass increased at most stations when precipitation decreased snow mass decreased at most stations and snow loss intensified with an increase in warming from 1981 to 2018 when the warming rate was less than 0 04 c y the increase in precipitation was likely to increase the snow mass conversely when the rate of warming exceeded 0 04 c y snow mass decreased regardless of the change in precipitation 3 5 correlation of snow mass change with temperature precipitation change changes in snow mass are generally negatively and positively correlated with the changes in temperature and precipitation respectively marty et al 2017 for each station we generated annual values of the snow index 1961 2018 and calculated pearson correlations of the time series with the corresponding meteorological indices temperature or precipitation during the snow season for the three periods 1961 2018 1961 1981 1981 2018 respectively fig 9 the results in 1961 2018 indicated that the correlations are roughly bounded by 35 n fig 9a the changes in snow mass at most stations north of 35 n are controlled by the precipitation variability snow mass increased and decreased with the increase and decrease in precipitation respectively meanwhile some stations exhibited little correlation with either temperature or precipitation in contrast most stations south of 35 n exhibited decreasing trends in the snow mass which were primarily controlled by warming snow masses at the three stations located at high elevations such as yellow river iv yangtze v and ganges ix exhibited increasing trends which were positively correlated with increase in precipitation in sub phase 1 1961 1981 snow mass changes at most stations north of 35 n were controlled by precipitation changes fig 9b in tarim ⅰ and hexi ⅱ four stations exhibited increased precipitation and snow mass and six stations exhibited decreased precipitation and snow mass in qaidam iii two stations exhibited increased precipitation snow mass and two stations exhibited decreased precipitation snow mass in the northern part of yellow river iv nine stations exhibited decreased precipitation and snow mass changes in snow mass during this period are consistent with the result of spatial contrasts in streamflow variability dry north wet south wu et al 2022 snow mass changes at stations south of 35 n were partly controlled by temperature and partly by precipitation in the southern part of yellow river iv snow mass was primarily reduced and such reductions at 12 stations were significantly related to warming in the other regions located south of 35 n snow masses were controlled by warming at eight stations at lower elevations whereas 14 stations at elevations above 3000 m exhibited increased snow masses which were closely associated with increased precipitation in sub phase 2 1981 2018 precipitation variability was the determining climatic cause of snow mass changes in regions north of 35 n whereas temperature variability determined the snow mass changes in regions south of 35 n fig 9c in tarim ⅰ and hexi ⅱ precipitation increased at 10 stations thereby increasing the snow masses in qaidam iii precipitation decreased at the four stations thereby decreasing the snow mass in the northern part of the yellow river iv the decrease in snow masses at the two stations was caused by decreased precipitation whereas that at the other five stations was caused by warming in the regions south of 35 n majority of the stations exhibited decreasing snow mass trends notably 31 stations with snow loss were driven by warming and the changes in snow mass at only six stations were associated with the precipitation variability for all 143 stations changes in the snow mass north of 35 n were controlled by the precipitation variability whereas those in regions south of 35 n were controlled by the temperature variability additionally the decrease in snow mass at 13 stations in the southern tp was correlated with the decrease in precipitation fig 9d from sub phase1 to 2 the three transition patterns in snow mass trends are associated with changes in the deterministic climate control factors in tarim ⅰ and hexi ⅱ on the northern edge of the tp snow mass variability was controlled by precipitation precipitation trends reversed from decreasing to increasing thereby enhancing the increasing snow mass trends and weakening the decreasing trends the first pattern in qaidam iii and yellow river iv on the northeastern tp the intensification of snow loss the second pattern was associated with two different climatic factors the intensified snow loss in qaidam iii was caused by reduced precipitation whereas that in yellow iv was primarily driven by the evident increase in temperature particularly the stepped warming after 1981 in other regions of the southern tp warming in sub phase 1 led to decreases in snow mass at eight stations below 3000 m while at 14 stations at higher elevations snow mass increased due to increased precipitation however the enhanced warming in sub phase 2 led to a significant decrease or no change in snow mass resulting in the reversal of snow mass trends from increasing to decreasing the third pattern this transition means that snow mass changes at higher elevations are controlled by warming at least from 3000 m to 4800 m although snow mass increases may occur at higher elevations without in situ observations this finding may reflect the altitudinal dependence of the process of snow mass variability driven by climate change at high altitudes although the temperature rises winter temperatures are still low enough for snow to form and accumulate so precipitation predominantly controls the snow mass morán tejeda et al 2013 at lower elevations areas at or below the 0 c isotherm changes in snow mass are primarily driven by warming leading to a decrease in the snow rain ratio and snow mass rebetez and reinhard 2008 serquet et al 2013 4 conclusions accurate and long term information on the amount of water stored in the snowpack of the tp is essential for understanding the water balance of the region and its future changes the snowpack on the tp is strongly influenced by frequent snowmelt processes and experiences multiple snow cycles therefore commonly used indices such as the swe on april 1or annual maximum swe cannot represent the annual snow mass on the tp this study used the cumulative value of the maximum swe for each snow cycle to estimate the annual snow mass which can effectively reflect the characteristics of snow variability and can be used as a key indicator for water resource management or snow load in areas with similar snow characteristics from 1961 to 2018 snow mass on the tp exhibited significant decreasing trends as well as some weakly increasing trends 43 0 24 mm y and 3 0 22 mm y stations exhibiting significant decrease in snow mass were concentrated in the yellow river iv and yangtze v regions and those exhibiting increase or no changes were concentrated in tarim ⅰ in sub phase 1 from 1961 to 1981 snow mass decreased and increased at most stations north and south of 35 n respectively 0 65 and 1 56 mm y respectively in sub phase 2 from 1981 to 2018 snow mass significantly decreased at most stations except for some stations in tarim ⅰ that exhibited increase in the snow mass 0 58 and 0 21 mm y respectively therefore we identified three transition patterns in snow mass trends from sub phases 1 to 2 on the tp in tarim ⅰ and hexi ⅱ located on the northern edge of the tp the increasing snow mass trends intensified and the decreasing trends weakened snow loss intensified in qaidam iii and yellow river iv on the northeastern tp in the remaining regions of the south the snow mass trends reversed from increasing to decreasing the variability of snow mass on the tp was mainly driven by changes in temperature and precipitation when warming does not exceed the threshold of snow rain conversion increased precipitation may increase the snow mass north of 35 n snow mass trends were controlled by the changes in precipitation the reversal in precipitation trends from decreasing to increasing in tarim ⅰ and hexi ⅱ shifted the snow mass trends from decreasing to increasing south of 35 n warming during 1961 1981 controlled the snow mass at only a few stations below 3000 m most stations at higher elevations were affected by increased precipitation which increased the snow mass however when the warming rate exceeded 0 04 c y the increased temperature inhibited the precipitation to occur as snowfall even when the precipitation increased thus although the precipitation increased from 1981 to 2018 reinforced warming led to a significant decrease in the snow mass at almost all stations in the coming decades continued warming could lead to further reductions in the projected snow mass and alter the seasonal distribution of streamflow thereby affecting the hydropower municipal services and agriculture in densely populated downstream areas due to the inherent spatial and temporal representativeness of station observations there remains an urgent need to implement robust missions and develop new retrieval techniques to obtain reliable swe for the complex terrain and high altitude mountains declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work was supported by the natural science foundation of china grant number 42171136 the second tibetan plateau scientific expedition and research step program grant number 2019qzkk0201 basic science center for tibetan plateau earth system bsctpes nsfc grant number 41988101 03 we would like to thank the chinese meteorological administration cma for providing snow observation information and data appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2023 129438 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
2050,the snowpack on the tibetan plateau tp which feeds ten major rivers and supplies freshwater to heavily populated downstream areas is undergoing major changes owing to climate change however the impact of climate change on snowpacks is debated because of the lack of quantitative knowledge about snow mass on the tp in this study we collected long time series data of the snowpack 1961 2018 from 143 stations on the tp at elevations of 1100 4800 m asl and calculated the snow water equivalent based on the observed snow depths and simulated snow densities to examine the snow mass trends transition patterns of the trends and their climatic causes the results show that snow mass on the tp experienced a large increase 1 56 mm y until 1981 and a decrease 0 58 mm y after 1981 the snow mass trends exhibited three transition patterns before and after 1981 increasing snow mass trends intensified and decreasing trends weakened on the north edge of the tp snow loss intensified in the northeast region and snow mass trends reversed from increasing to decreasing in the south north of 35 n the snow mass variability was controlled by precipitation changes south of 35 n warming affected only a few stations below 3000 m before 1981 and the reinforced warming then resulted in increased snow mass loss at almost all the stations after 1981 warming driven snow mass reversals and the continued warming on the tp could lead to significant water management challenges in densely populated downstream areas abbreviations cma chinese meteorological administration mk mann kendall swe snow water equivalent tp tibetan plateau keywords snow mass change snow water equivalent pattern transition trend reversals climatic causes data availability data will be made available on request 1 introduction seasonal snow is a fundamental component of both global energy and water cycle bormann et al 2018 the snowpack on the tibetan plateau tp plays a critical role in regulating the regional and global climate by influencing the energy exchange between the land surface and atmosphere xu et al 2017 snowmelt from the tp feeds ten major rivers and supplies freshwater to densely populated downstream areas for extensive irrigated agriculture municipal and industrial uses yao et al 2019 over the past few decades the tp has experienced considerable climate change with significant warming and wetting or drying of extensive areas kraaijenbrink et al 2021 under the present climate change scenario persistent changes in the regional snowpack can have significant even disruptive social and economic impacts bormann et al 2018 immerzeel et al 2020 therefore understanding current snow dynamics and their climate drivers is necessary to prepare for future changes in water resources of the tp previous studies have reported variations in the snow cover distribution mean snow depth and seasonal snow water equivalent swe on the tp from the 1950s or 1960s to the 1990s the in situ observations of snow cover and snow depth exhibited increasing trends qin et al 2006 which were accompanied by increased precipitation and land surface cooling zhang et al 2004 however during the great warming in the 1980s and 1990s western china including the tp did not experience a continual decrease in snow cover no correlation was observed between the snow variability and temperature or precipitation during this period qin et al 2006 during 1961 2010 in situ observations showed weak negative trends for snow cover mean daily snow depth and number of snow cover days shen et al 2015 xu et al 2017 these variations were in accordance with the snowfall record but inconsistent with the warming trend xu et al 2017 meanwhile satellite data have indicated decreasing snow mass trends during 1972 2006 the persistent time of snow cover significantly declined in the western tp zhang and ma 2018 during 1987 2009 the swe obtained from the special sensor microwave imager showed an overall decrease in high mountainous areas in asia smith and bookhagen 2018 during 2000 2014 the snow cover area snow cover duration and swe on the tp exhibited decreasing trends which were accompanied by decreased snowfall increased rainfall and increased temperature huang et al 2017 however during 2000 2015 moderate resolution imaging spectroradiomete daily products of the snow cover area did not detect a conspicuous decrease in the snow cover wang et al 2017 you et al 2020 while the decrease in the snow cover area occurred mainly in the central and eastern parts of the tp notarnicola 2020 in the past two decades the data from integrated multi satellite retrievals for global precipitation measurement version 6 have indicated that snow cover increased in most regions of the tp li et al 2022 the above mentioned studies mostly focused on snow characteristics such as snow cover or depth which provide only a limited hydrological context snow change over a relatively short period can be sensitive to the statistical period reliable quantitative information about the snow mass on the tp is scarce hence the impact of climate change on snowpacks is still under debate smith and bookhagen 2018 therefore we collected long time series data of the snowpack and concurrent temperature and precipitation data from 143 stations on the tp from 1961 to 2018 estimated the swe and annual snow mass by combining the observed snow depth and modeled snow bulk density examined the spatial and temporal heterogeneities of snow characteristics and snow mass changes revealed the major climate drivers of snow mass variability and explored the sensitivity of snow mass variability to regional warming 2 study area data and methods 2 1 study area the tp is a high altitude area in asia stretching from the pamirs and hindu kush in the west to the himalayas in the south hengduan mountains in the east and qilian and kunlun mountains in the north gao et al 2018 ten major rivers originate from the tp and are fed by the snow and glacier melts on the tp the climate over the tp is primarily influenced by the asian monsoon and the mid latitude westerlies the annual mean temperature across the tp is generally below 0 c and decreases from east to west frauenfeld et al 2005 precipitation distribution on the tp is uneven with significant spatial differences decreasing from the southeast to the northwest the central and eastern tp and southern himalayas experience maximum and minimum precipitation in summer and winter respectively more than 50 80 of the annual precipitation occurs between july and october including monsoonal and convective precipitation however the western tp experiences the maximum precipitation in winter and is dominated by mid latitude westerlies more than 60 of the annual precipitation occurs between december and april curio and scherer 2016 2 2 data continuous and high quality data of the daily snow depth average air temperature and total precipitation recorded at 143 stations on the tp were selected in this study all data were strictly processed quality controlled and adjusted for homogeneity before being released by the china meteorological administration to utilize more surface data for long term snow studies we selected 80 stations with continuous data from 1961 to 2018 and another 63 new stations with data from 1981 to 2018 a snow year is defined as the period from september 1 to august 31 of the following year for instance the snow year in 1961 was the period from september 1 1960 to august 31 1961 the selection criteria is that the station should have complete records for the snow years 1961 2018 or 1981 2018 the spatial distribution of 143 stations with elevations from 1100 to 4800 m is shown in fig 1 the stations were primarily located in the nine major upper catchments of tarim ⅰ hexi ⅱ qaidam iii yellow river iv yangtze v mekong salween ⅵ tp interior ⅶ yarlungzangbo viii and ganges ix there are no stations with long time series of observations above 4800 m and in the snow rich amu darya and indus rivers in the western part of the plateau which limits the analysis of long term snow trends in the high altitude area snow depth is the vertical depth from the snow surface to the ground surface it is regularly measured manually by the professional staff of the cma all of whom are trained with the same standards when more than half of the area around the station is covered with snow snow depth is measured using a snow gauge at 8 am the recorded snow depth is typically the average of the measurements taken at minimum three different points and is depicted as an integer in units of centimeter to guarantee the completeness and consistency of the snow depth missing records of daily snow depth were filled using the following procedure first we checked the snow records for missing days if the record showed no snow the missing record was denoted as 0 if it showed snow and the daily mean air temperature was below 0 c the daily snow depth was filled by the value of the sum of the daily precipitation and the snow depth of the previous day if the temperature was between 0 and 2 c the snow depth was filled by the value of the sum of half the daily precipitation and the snow depth of the previous day xu et al 2017 and there were no records of snow at temperatures above 2 c missing records accounted for only 0 04 of the data used in our study therefore the impact of filling the missing records was negligible the daily total precipitation was automatically recorded by 8 inch rain gauges the daily mean air temperature was averaged from hourly observations of the land surface air temperature from an automatic weather station more than 30 80 of the annual precipitation in different areas of the tp occurred from june to september however snowfall rarely occurred during these months compared to the annual climatic characteristics temperature and precipitation changes during the snow season directly affected the snow mass variability based on the amount and percentage of snow mass in different months we divided the stations into four categories defining the snow season in each category from november to march october to april september to may and september to june supplementary fig 1 see supplementary materials for details 2 3 methods in the stable snow areas of the western united states and european alpine one major long snow cycle is observed each year seasonal snow accumulation begins in the fall or winter and typically reaches a maximum around april of the following year fig 2 a the swe on april 1 marty et al 2017 mote et al 2018 or the annual maximum swe skaugen et al 2012 fyfe et al 2017 is approximated as the total annual snow runoff and used to study the snowpack variability in these regions however most areas in the tp are unstable snow areas qin et al 2006 li et al 2018 generally multiple snowfall snowmelt processes with comparable swe values are observed each year and each process only last for a few days or for several dozen days fig 2b therefore traditional metrics such as the swe on april 1or the annual maximum swe were not representative of the annual snow mass to integrate the various snowfall snowmelt processes in the unstable snow areas we calculated and cumulated the maximum swe for each snow cycle and used it to quantify the total amount of water derived from the snowpack on the tp this new metric is defined as the cumulative value of the maximum swe per snow cycle in millimeters water equivalent mm w e which represents the annual snow mass daily swe can be calculated by measuring the snow depth cm multiplied by the modeled snow bulk density using equation 1 1 s w e s n o w d e p t h 10 ρ s ρ w where ρs and ρw are the modeled snow bulk density kg m3 and density of liquid water 1000 kg m3 at 0 c respectively the snow bulk density was simulated using an artificial neural network model wherein the snow cover duration and snow depth were the input parameters this model was developed based on 7 516 measured swe snow depth pairs from the tp over nearly four decades and established to be the best model with minimal errors supplementary fig 2 see supplementary materials for details to analyze the possible long term snow mass trends temperature and precipitation during the snow season we used the non parametric mann kendall mk test this test is based on rank transformed time series data and considers only the relative magnitudes of the measurements marty et al 2017 the positive and negative mk values indicate increasing and decreasing trends respectively in this study a confidence level of 95 was used as the threshold to classify a significant trend p 0 05 whereas that of 80 was used to classify a weakly significant trend 0 05 p 0 2 subsequently we calculated the absolute and relative trends during 1961 2018 and the two sub phases of 1961 1981 and 1981 2018 furthermore the pearson correlation coefficient r between the snow mass trends and concurrent temperature and precipitation changes was calculated to investigate the climatic causes of the snowpack variability sospedra alfonso et al 2015 the pearson correlation coefficient examines the degree of correlation between two data sets the range of the pearson correlation coefficient is between 1 to 1 where 1 is an overall positive correlation 0 is no correlation and 1 is an overall negative correlation 3 results and discussions 3 1 snowpack characteristics of the tp on the tp 80 and 63 stations recorded snow data in the snow years of 1961 2018 and 1981 2018 respectively as more stations can better represent the regional characteristics of the snowpack we used data from these 143 stations in the snow years of 1981 2018 to calculate the mean snow cover days the number of days in a snow year with snow depth 1 cm and mean snow mass fig 3 the mean snow cover days and snow masses of the 143 stations on the tp from 1981 to 2018 were 24 d and 37 mm w e respectively the snow distribution on the tp exhibited spatial heterogeneity wherein 13 stations had a mean annual snow mass greater than 85 mm w e distributed in five catchments blue dots in fig 3a among these stations turgat of tarim i on the northwestern tp had the longest number of snow cover days 133 d and a snow mass of 145 mm w e notably nyalam on the southern slopes of the himalayas in the ganges ix had the highest snow mass of 289 mm w e whereas cona and pagri in this catchment had snow masses of 123 and 94 mm w e respectively the mean number of snow cover days in these three stations was approximately 70 d lhari in yarlungzangbo viii had snow mass and snow cover days of 175 mm w e and 92 d respectively three stations of yangtze v in the eastern part of the tp qingshuihe shiqu and seda had snow masses and snow cover days of 115 111 and 88 mm w e and 100 76 54 d respectively the other five stations of yellow river iv in the northeast tp hongyuan jigzi wuxiaolin gande and dari had similar snow masses and snow cover days of 107 100 94 92 and 91 mm w e and 61 59 70 77 and 70 d respectively snowpack characteristics in the same climatic region are typically closely related to the altitude for example in the same region areas at higher altitudes showed earlier start dates and later end dates of snow cover and had longer snow cover days xu et al 2017 thus we summarized the snow cover days fig 3b and snow masses fig 3c at six altitude intervals 1000 2000 2000 3000 3000 3500 3500 4000 4000 4500 and 4500 5000 m to analyze the snow characteristics the 3500 4000 m intervals of tarim ⅰ in the northwestern tp and ganges ix in the southern tp were areas with the largest snow masses as observed by stations on the tp with values of 145 and 120 mm w e respectively however their mean snow cover days greatly differed 133 and 40 d respectively yarlungzangbo viii in the southern tp had snow cover and snow mass values of less than 10 d and 10 mm w e at most stations except one high altitude station at lhari which indicated that the middle and upper reaches of yarlungzangbo viii were the areas with the least amount of snow cover days and the lowest snow mass the eastern part of the tp hexi ⅱ yellow river iv yangtze v and mekong salween vi had similar snow cover days and snow masses at the same elevation interval however the values of the snow cover days and snow masses in qaidam iii and tp interior ⅶ located further inland were smaller compared to those at the same elevation intervals in previous areas 3 2 snow mass changes and their altitudinal dependence the changes in snow mass on the tp exhibited clear spatio temporal heterogeneity fig 4 during 1961 to 2018 43 of the 80 stations on the tp exhibited significant decreasing snow mass trends and only 3 exhibited significant increasing trends with mean values of 0 24 and 0 22 mm y respectively fig 4a and 4e the stations with significant decreasing snow mass trends were primarily concentrated in the yellow river iv and yangtze v in the eastern tp and the stations with unchanging or increasing snow mass trends were primarily present in tarim i in the northwestern tp however a few stations in other regions with increasing snow mass trends were located above 4200 m the analysis and comparison of the trends in the two sub phases 1961 1981 and 1981 2018 revealed that the snow masses at most stations exhibited increasing and decreasing trends in sub phases 1 and 2 respectively blue triangles in fig 4b and 4f and red triangles in fig 4c and 4 g from 1961 to 1981 10 and 15 of the stations exhibited significant decreasing and increasing snow mass trends respectively 0 65 and 1 56 mm y respectively spatially this can be roughly bounded by the 35 n latitude wherein most stations north and south of 35 n exhibited decreasing and increasing trends respectively fig 4b and 4f from 1981 to 2018 49 of the stations exhibited significant decreasing snow mass trends except tarim ⅰ where most stations exhibited increasing snow mass trends 0 58 and 0 21 mm y fig 4c 4 g most of the 63 new stations established after 1981 were located further inland in the yellow river iv yangtze v and yarlungzangbo viii 65 of which exhibited significant decreasing snow mass trends 0 60 mm y thus 56 of the 143 stations exhibited significant decreasing trends in the snow mass after 1981 fig 4d and 4 h fig 5 shows the altitudinal dependence of absolute and relative changes in the snow mass during 1961 2018 and the two sub phases the absolute change in snow mass increases with increasing altitude however the relative change in snow mass decreases with altitude except for the sites with increased snow mass in 1961 1981 fig 5 in sub phase 1 1961 1981 3000 m can be roughly used as the dividing line most stations exhibiting significant increasing snow mass trends were located above 3000 m while decreasing trends were below 3000 m fig 5b and 5f in sub phase 2 1981 2018 the snowpack exhibited significant decreasing trends with increasing altitude the absolute and relative losses of snow mass increased and decreased respectively and the magnitude of the change was large fig 5c 5d 5 g and 5 h 3 3 transition patterns in snow mass trends a further comparison of the snow mass trends at the stations in each catchment on the tp in sub phases 1 1961 1981 and 2 1981 2018 revealed three transition patterns fig 6 increasing snow mass trends intensified and decreasing trends weakened on the north edge of the tp snow loss intensified in the northeast region and snow mass trends reversed from increasing to decreasing in the south the first pattern primarily occurred in tarim i and hexi ii on the northern edge of the tp in tarim i 40 and 50 of the stations exhibited decreasing 0 24 mm y and increasing 0 12 mm y snow mass trends during sub phase 1 respectively alternatively 20 and 80 of the stations exhibited weakly decreasing 0 13 mm y and increasing 0 15 mm y trends during sub phase 2 respectively in hexi ii all the stations exhibited decreasing trends 0 58 mm y during sub phase 1 whereas only 60 of the stations exhibited weakly decreasing trends 0 19 mm y 40 of the stations exhibited increasing trends 0 07 mm y during sub phase 2 the changes in snow mass in these two regions showed that the increasing trends were strengthened and the decreasing trends were weakened the second pattern primarily occurred in qaidam iii and yellow river iv located in the northeastern part of the tp in qaidam iii 33 of the stations exhibited decreasing snow mass trends 0 24 mm y whereas the other 33 exhibited increasing snow mass trends 0 71 mm y during sub phase 1 however all stations exhibited decreasing trends 0 26 mm y during sub phase 2 in yellow river iv 62 and 34 of the stations exhibited decreasing 0 38 mm y and increasing 0 89 mm y trends during sub phase 1 respectively alternatively 83 and 10 of the stations exhibited significant decreasing trends 0 49 mm y and weakly increasing trends 0 02 mm y during sub phase 2 respectively snow loss in these regions intensified over time shifting from decreasing trends at some stations to significantly decreasing trends at almost all the stations the third pattern primarily occurred in the southeastern and southern regions of the tp including yangtze v meikong salween ⅵ tp interior ⅶ yarlungzangbo viii and ganges ix in yangtze v 24 and 65 of the stations exhibited decreasing 0 17 mm y and increasing 0 59 mm y snow mass trends during sub phase 1 respectively alternatively during sub phase 2 83 of the stations exhibited significant decreasing trends 0 46 mm y in snow mass and the trends in other stations remained unchanged in meikong salween vi the changes in snow masses at all stations reversed from increasing trends 0 82 mm y during sub phase 1 to decreasing trends 0 62 mm y during sub phase 2 in the tp interior ⅶ the snow masses at all the stations also changed from being unchanged during sub phase 1 to significantly decreased during sub phase 2 0 35 mm y in yarlungzangbo viii the snow masses in 43 of the stations exhibited weakly decreasing trends 0 07 mm y whereas those in other stations exhibited increasing trends 1 57 mm y during sub phase 1 alternatively 72 of the stations exhibited significant decreasing snow mass trends 0 62 mm y whereas the trends at other stations remained unchanged during sub phase 2 the snow masses at the stations in ganges ix exhibited no significant trend in either of the sub phase however the snow masses at five of the six new stations established after 1981 exhibited significant decreasing trends 1 18 mm y thus snow mass trends in these regions reversed from increasing at most stations to significantly decreasing at almost all the stations 3 4 climate change and connections to snow mass temperature and precipitation are the major factors controlling the snowpack formation in a complex manner from the 1960 s to 2013 the climate of the tp exhibited rapid warming and wetting trends yao et al 2019 you et al 2020 compared to the annual average conditions climate changes during the snow season directly affected the snow mass variability therefore we analyzed the trends in temperature and precipitation during the snow season of the tp fig 7 and further explored their impact on the snow mass variability fig 8 from 1961 to 2018 all the stations exhibited significant increasing trends in temperature warming with an average rate of 0 04 c y and 69 of the stations exhibited increasing trends in precipitation wetting of which 60 exhibited significant increasing trends with an average rate of 0 45 mm y fig 7a and 7e for the two sub phases 1961 1981 and 1981 2018 46 and 98 of the stations exhibited significant warming trends respectively fig 7b and 7c the number of stations with warming trends exceeding 0 04 c y 0 06 c y increased from 27 to 59 from 9 to 22 these results indicate that the signal and magnitude of warming in the tp have become more intense fig 7b and 7c during sub phase 1 the precipitation increased 0 99 mm y and decreased 0 88 mm y at 53 and 47 of the stations respectively alternatively during sub phase 2 the precipitation increased 0 52 mm y and decreased 0 44 mm y at 80 and 16 of the stations respectively fig 7f and 7 g from sub phases 1 to 2 the number of stations with increased precipitation increased by 22 however the magnitude of increase reduced by almost half to clarify whether the stations with the most significant changes in snow mass were located in regions with specific climatic background or were driven by specific changes in the climate we mapped the snow mass trends at each station with their mean temperature and total precipitation over the snow season as well as with the trends in temperature and precipitation fig 8 stations with upward or downward trends were not concentrated in particular locations however those experiencing more precipitation were more likely to show larger changes in snow mass the snow mass trends on the tp were clearly driven by the changes in the temperature and precipitation particularly during the two sub phases from 1961 to 1981 the rate of warming in stations with increased snow mass was generally less than 0 04 c y when precipitation increased snow mass increased at most stations when precipitation decreased snow mass decreased at most stations and snow loss intensified with an increase in warming from 1981 to 2018 when the warming rate was less than 0 04 c y the increase in precipitation was likely to increase the snow mass conversely when the rate of warming exceeded 0 04 c y snow mass decreased regardless of the change in precipitation 3 5 correlation of snow mass change with temperature precipitation change changes in snow mass are generally negatively and positively correlated with the changes in temperature and precipitation respectively marty et al 2017 for each station we generated annual values of the snow index 1961 2018 and calculated pearson correlations of the time series with the corresponding meteorological indices temperature or precipitation during the snow season for the three periods 1961 2018 1961 1981 1981 2018 respectively fig 9 the results in 1961 2018 indicated that the correlations are roughly bounded by 35 n fig 9a the changes in snow mass at most stations north of 35 n are controlled by the precipitation variability snow mass increased and decreased with the increase and decrease in precipitation respectively meanwhile some stations exhibited little correlation with either temperature or precipitation in contrast most stations south of 35 n exhibited decreasing trends in the snow mass which were primarily controlled by warming snow masses at the three stations located at high elevations such as yellow river iv yangtze v and ganges ix exhibited increasing trends which were positively correlated with increase in precipitation in sub phase 1 1961 1981 snow mass changes at most stations north of 35 n were controlled by precipitation changes fig 9b in tarim ⅰ and hexi ⅱ four stations exhibited increased precipitation and snow mass and six stations exhibited decreased precipitation and snow mass in qaidam iii two stations exhibited increased precipitation snow mass and two stations exhibited decreased precipitation snow mass in the northern part of yellow river iv nine stations exhibited decreased precipitation and snow mass changes in snow mass during this period are consistent with the result of spatial contrasts in streamflow variability dry north wet south wu et al 2022 snow mass changes at stations south of 35 n were partly controlled by temperature and partly by precipitation in the southern part of yellow river iv snow mass was primarily reduced and such reductions at 12 stations were significantly related to warming in the other regions located south of 35 n snow masses were controlled by warming at eight stations at lower elevations whereas 14 stations at elevations above 3000 m exhibited increased snow masses which were closely associated with increased precipitation in sub phase 2 1981 2018 precipitation variability was the determining climatic cause of snow mass changes in regions north of 35 n whereas temperature variability determined the snow mass changes in regions south of 35 n fig 9c in tarim ⅰ and hexi ⅱ precipitation increased at 10 stations thereby increasing the snow masses in qaidam iii precipitation decreased at the four stations thereby decreasing the snow mass in the northern part of the yellow river iv the decrease in snow masses at the two stations was caused by decreased precipitation whereas that at the other five stations was caused by warming in the regions south of 35 n majority of the stations exhibited decreasing snow mass trends notably 31 stations with snow loss were driven by warming and the changes in snow mass at only six stations were associated with the precipitation variability for all 143 stations changes in the snow mass north of 35 n were controlled by the precipitation variability whereas those in regions south of 35 n were controlled by the temperature variability additionally the decrease in snow mass at 13 stations in the southern tp was correlated with the decrease in precipitation fig 9d from sub phase1 to 2 the three transition patterns in snow mass trends are associated with changes in the deterministic climate control factors in tarim ⅰ and hexi ⅱ on the northern edge of the tp snow mass variability was controlled by precipitation precipitation trends reversed from decreasing to increasing thereby enhancing the increasing snow mass trends and weakening the decreasing trends the first pattern in qaidam iii and yellow river iv on the northeastern tp the intensification of snow loss the second pattern was associated with two different climatic factors the intensified snow loss in qaidam iii was caused by reduced precipitation whereas that in yellow iv was primarily driven by the evident increase in temperature particularly the stepped warming after 1981 in other regions of the southern tp warming in sub phase 1 led to decreases in snow mass at eight stations below 3000 m while at 14 stations at higher elevations snow mass increased due to increased precipitation however the enhanced warming in sub phase 2 led to a significant decrease or no change in snow mass resulting in the reversal of snow mass trends from increasing to decreasing the third pattern this transition means that snow mass changes at higher elevations are controlled by warming at least from 3000 m to 4800 m although snow mass increases may occur at higher elevations without in situ observations this finding may reflect the altitudinal dependence of the process of snow mass variability driven by climate change at high altitudes although the temperature rises winter temperatures are still low enough for snow to form and accumulate so precipitation predominantly controls the snow mass morán tejeda et al 2013 at lower elevations areas at or below the 0 c isotherm changes in snow mass are primarily driven by warming leading to a decrease in the snow rain ratio and snow mass rebetez and reinhard 2008 serquet et al 2013 4 conclusions accurate and long term information on the amount of water stored in the snowpack of the tp is essential for understanding the water balance of the region and its future changes the snowpack on the tp is strongly influenced by frequent snowmelt processes and experiences multiple snow cycles therefore commonly used indices such as the swe on april 1or annual maximum swe cannot represent the annual snow mass on the tp this study used the cumulative value of the maximum swe for each snow cycle to estimate the annual snow mass which can effectively reflect the characteristics of snow variability and can be used as a key indicator for water resource management or snow load in areas with similar snow characteristics from 1961 to 2018 snow mass on the tp exhibited significant decreasing trends as well as some weakly increasing trends 43 0 24 mm y and 3 0 22 mm y stations exhibiting significant decrease in snow mass were concentrated in the yellow river iv and yangtze v regions and those exhibiting increase or no changes were concentrated in tarim ⅰ in sub phase 1 from 1961 to 1981 snow mass decreased and increased at most stations north and south of 35 n respectively 0 65 and 1 56 mm y respectively in sub phase 2 from 1981 to 2018 snow mass significantly decreased at most stations except for some stations in tarim ⅰ that exhibited increase in the snow mass 0 58 and 0 21 mm y respectively therefore we identified three transition patterns in snow mass trends from sub phases 1 to 2 on the tp in tarim ⅰ and hexi ⅱ located on the northern edge of the tp the increasing snow mass trends intensified and the decreasing trends weakened snow loss intensified in qaidam iii and yellow river iv on the northeastern tp in the remaining regions of the south the snow mass trends reversed from increasing to decreasing the variability of snow mass on the tp was mainly driven by changes in temperature and precipitation when warming does not exceed the threshold of snow rain conversion increased precipitation may increase the snow mass north of 35 n snow mass trends were controlled by the changes in precipitation the reversal in precipitation trends from decreasing to increasing in tarim ⅰ and hexi ⅱ shifted the snow mass trends from decreasing to increasing south of 35 n warming during 1961 1981 controlled the snow mass at only a few stations below 3000 m most stations at higher elevations were affected by increased precipitation which increased the snow mass however when the warming rate exceeded 0 04 c y the increased temperature inhibited the precipitation to occur as snowfall even when the precipitation increased thus although the precipitation increased from 1981 to 2018 reinforced warming led to a significant decrease in the snow mass at almost all stations in the coming decades continued warming could lead to further reductions in the projected snow mass and alter the seasonal distribution of streamflow thereby affecting the hydropower municipal services and agriculture in densely populated downstream areas due to the inherent spatial and temporal representativeness of station observations there remains an urgent need to implement robust missions and develop new retrieval techniques to obtain reliable swe for the complex terrain and high altitude mountains declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work was supported by the natural science foundation of china grant number 42171136 the second tibetan plateau scientific expedition and research step program grant number 2019qzkk0201 basic science center for tibetan plateau earth system bsctpes nsfc grant number 41988101 03 we would like to thank the chinese meteorological administration cma for providing snow observation information and data appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2023 129438 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
2051,despite the wide application of the weather research and forecasting wrf model in extreme precipitation simulations there is a lack of consensus and clear guidance on identifying the suitable length of spin up time in this study the wrf model was used to simulate the extreme precipitation events that happened on the 4 november 2015 at alexandria of the nile delta according to the observation from the integrated multi satellite retrievals for global precipitation measurement imerg 21 spin up time experiments of the 3 level nested domain scenario and 21 spin up time experiments of the 2 level nested domain scenario were designed to explore the relationship between model required spin up time and initial conditions the simulation performances were evaluated by seven verification metrics and one overall performance score here we try to provide guidelines on how to determine the optimal spin up time through satellite data without too many trial and error tests an optimal spin up time identifying osti framework with possible weather situations and spin up time determining steps is proposed to help future work it is found that the occurrences of disturbing weather events strengthen the influence of initial conditions on simulation outputs and increase model requirements for spin up time lengths moreover this framework is more useful for precipitation events with strong synoptic backgrounds because their simulation performances depend largely on the development of appropriate atmospheric circulations and physical equilibrium states in the model keywords wrf spin up time osti framework era5 imerg 1 introduction global and regional climate models gcms and rcms are becoming established tools for providing reliable information for climate predictions however the high resolution simulations of gcms are very computationally expensive in contrast rcms have shown their ability to effectively downscale global information and accurately reproduce mesoscale and local features over a limited region with affordable computational costs rummukainen 2010 jacob et al 2014 schewe et al 2019 the mesoscale atmospheric weather research and forecasting wrf model is a typical rcm that numerically solves a set of differential equations describing the climate system over a selected domain after required discretization and parameterization processes to perform dynamical downscaling wrf needs initial and boundary conditions ic and bc provided by global reanalysis datasets to initialise and drive atmospheric variables through their domain boundaries compared to the larger gridded meteorological datasets that poorly represent atmospheric patterns running dynamical downscaling wrf with high resolution can help resolve the spatial variability of key variables and surface atmosphere exchanges because heterogeneous land fluxes and near land meteorological parameters are better resolved talbot et al 2012 it is commonly believed that wrf may forget the ic after a certain execution time to save computational resources and reduce delivery time the whole simulation period is usually divided into subperiods with spin up periods followed by continuous executions gómez navarro et al 2011 jerez et al 2018 the spin up time is necessary to avoid inhomogeneities when connecting subperiods as well as decrease the masking effects of ic issues on model results in wrf extreme precipitation simulations spin up time allows the model to adjust from the ic to a state that is consistent with its own numerics and physics and to develop appropriate large scale circulations jankov et al 2007 skamarock and klemp 2008 therefore spin up time is the required execution time that allows the wrf to reach a physical equilibrium state following the path defined by the bc while forgetting about the ic yang et al 1995 giorgi and mearns 1999 denis et al 2002 moreover until reach the equilibrium state the results can be easily tainted by spin up induced biases the model outputs will not be realistic and must be discarded cosgrove et al 2003 to prevent instabilities in the wrf model jankov et al 2007 found that at least 12 h spin up time should be used and this spin up time is often regarded as a suitable choice directly without enough verification in many wrf studies huva et al 2012 dzebre et al 2019 afshar et al 2020 furthermore the lengths of spin up time used in some other studies vary widely from a minimum of 6 h to a maximum of 1 year cha and wang 2013 naabil et al 2017 zhuo et al 2019 in fact the length of spin up depends on the quality of initial inputs and the soil conditions because the soil moisture content and latent heat flux will influence precipitation processes kleczek et al 2014 if the ic is very complex and impressive the model will take more time to forget it and get away from its masking effects therefore the optimal spin up time is not fixed and should be different for each event with different ic in addition the study by hwang et al 2019 found that using multiple hydrometeors as input in the bc can reduce spin up time and accelerate precipitation initialization their sensitive experiments were conducted with different numbers of hydrometeors including specific humidity specific cloud liquid water specific cloud ice water specific rain water and specific snow water the results show that this method has a good effect on short range precipitation simulation however most weather prediction studies ignore the effect of initial weather conditions and directly use 12 h spin up time because conducting too much trial and error testing before the formal simulation is computationally expensive in fact it is very difficult to determine the wrf optimal spin up time for different events since it depends on many factors first of all the climate system has a large number of components with various response times for example soil moisture responds much slower than atmospheric variables to dynamical and thermo dynamical processes skamarock 2004 de elia et al 2002 doblas reyes et al 2013 the second factor is the size of the simulated domains since the bc effect decays as we move away from the boundaries leduc and laprise 2009 third wrf has many physical schemes that can be used the choice of physical scheme often results in differences in the internal variability of simulations awan et al 2011 evans et al 2012 ji et al 2014 fourth the ic of wrf is obtained by spatial interpolating the global datasets to the selected regions the greater the inconsistencies between ic and model physics the longer the spin up time required turco et al 2013 the last factor is the model spin up would be affected by extreme conditions like extremely hot or cold temperatures extremely dry air and so on day et al 2014 seck et al 2015 in this study to solve the lack of consensus on the choice of wrf spin up time 42 sensitivity experiments with different ic are evaluated to explore the effects of disturbing weather on required spin up times disturbing weather refers to the other weather event that occurs within the spin up window which causes large scale changes in the synoptic background at the initial time moreover an optimal spin up time identifying osti framework is proposed to provide guidelines for future simulation work the purpose of this study is to help other researchers to avoid unfavourable ic and determine suitable spin up times for their wrf precipitation simulations this study aims to address the following two key research questions does the occurrence of disturbing weather events weaken or strengthen the influence of initial conditions on simulation outputs why does wrf s optimal spin up time vary by event and situation how can a structured selecting framework help to determine suitable wrf spin up time more efficiently the significance of this study is to highlight the importance of spin up time and show a guiding framework that can determine spin up time more efficiently before simulation without the need for too much trial and error testing this study is organized as follows a brief description of the study area and event are provided in section 2 the datasets experimental design verification metrics framework planning are illustrated in section 3 the results and discussions of different experiments are shown in section 4 the detailed osti framework and framework application is explained in section 5 finally the summary and conclusions of this study are presented in section 6 2 study area and event alexandria in the nile delta was selected as the study area due to the influence of the mediterranean climate this area has long dry summers and short mild winters in recent decades this area becomes a vulnerable zone that faces growing pluvial flooding hazards however the inadequate coverage of radars and rain gauges makes the development of a hydrometeorological early warning system in egypt very difficult wrf model is an effective way to simulate extreme precipitation by downscaling global nwp products to interesting areas which is very suitable and feasible for countries like egypt our previous study has investigated the sensitivities of various model configurations and obtained some useful findings liu et al 2021 but the hypothesis that regional weather conditions may impact the time required for model initialization has not been fully confirmed therefore further exploration of the relationship between wrf spin up time and weather conditions through the extreme event in this area would be meaningful for egypt and other similar regions the study event happened on the 4 november 2015 which was a 50 year storm that caused 60 of the city area to be flooded as well as the stagnant water in some low lying areas remained for more than 15 days some places even recorded more than 200 mm of precipitation in 2 h zevenbergen et al 2017 the main extreme precipitation of this event lasted for about 18 h from 06 00 to 24 00 utc the centred latitude and longitude of this event are at 31 5 n and 30 e this extreme precipitation event caused a devastating flood that has been reported as the worst flooding of alexandria city over the past decades in terms of the number of people affected and the amount of economic damage ihe delft 2017 the terrain of the study area and the location of the surrounding red sea and the mediterranean sea are shown in fig 1 b c the detailed descriptions of the nested domain and study event locations are presented in section 3 2 furthermore the proposed framework is also applied and verified through three other extreme precipitation events that happened around hurghada egypt 26 and 27 october 2016 antalya turkey 28 december 2013 and beirut lebanon 25 october 2015 these precipitation events have different intensities distributions and synoptic backgrounds which is very helpful to explore the generalization ability of the osti framework 3 materials and methods 3 1 datasets 3 1 1 initial and lateral boundary dataset the european centre for medium range weather forecasts ecmwf global climate reanalysis v5 era5 was used to provide the initial and lateral boundary meteorological conditions in the wrf simulations era5 is a newly developed dataset since early 2016 and has replaced the old reanalysis dataset era interim this dataset spans the period from 1 january 1950 onwards era5 offers over 240 parameters related to the atmosphere land and ocean climate etc on the surface and vertical levels which are much more than 100 parameters in era interim furthermore the spatiotemporal resolution of the era5 dataset hourly 31 km grid spacing analysis fields is significantly better than the era interim dataset 6 hourly 80 km grid spacing analysis fields hersbach et al 2020 along with the development of this new dataset there have been some studies using era5 as a lateral boundary condition for wrf simulations in egypt and the surrounding area of the mediterranean sea duzenli et al 2021 liu et al 2021 papavasileiou et al 2022 ludwig and hochman 2022 the detailed introduction of the era5 reanalysis dataset and its parameters can be found in the ecmwf documentation https confluence ecmwf int display ckb era5 3a data documentation the era5 reanalysis dataset can be downloaded on the ecmwf website https www ecmwf int en forecasts datasets reanalysis datasets era5 3 1 2 observational data the integrated multi satellite retrievals for global precipitation measurement imerg version 06b was used for simulation verification it combines precipitation estimates from geosynchronous infrared observations from geo ir satellites all passive microwave sensors of the global precipitation measurement gpm constellation and ground based measurements from precipitation gauges huffman et al 2015 imerg provides the quasi global precipitation estimates with 0 1 0 1 spatial resolution and 30 min temporal resolution according to the differences in latency and accuracy imerg has three sequences called early run near real time low latency gridded global multi satellite precipitation estimates 4 h latency late run near real time gridded global multi satellite precipitation estimates with quasi lagrangian time interpolation 12 h latency and final run research quality gridded global multi satellite precipitation estimates with quasi lagrangian time interpolation gauge data and climatological adjustment 3 5 months latency particularly the imerg final run product has a month to month climatological correction through the global precipitation climatology centre gpcc precipitation gauge analysis hou et al 2014 huffman et al 2015 since imerg product s release in early 2015 a substantial number of studies have used and recommended it for various applications such as analysis of extreme precipitation events huang et al 2019 streamflow simulation tang et al 2016 and flood forecasting wang et al 2017 and a large number of studies have evaluated the performance of imerg precipitation products at various temporal and spatial scales e g wang et al 2023 navarro et al 2019 palomino ángel et al 2019 prakash et al 2018 manz et al 2017 considering the insufficient coverage of surface observations radar and rain gauges in egypt imerg is a useful alternative dataset to be adopted in this study due to its fine spatial and temporal resolutions which favour simulation evaluations and its stable performance as evidenced in previous studies in this study the imerg final run product is used because it generally has advantages over the uncalibrated early run and late run products imerg products can be downloaded on the gpm website https gpm nasa gov data directory and detailed introductions can be found in huffman et al 2015 3 2 experimental design the precipitation simulation experiments of this study were conducted by the wrf arw version 4 0 skamarock et al 2019 the model configuration settings are listed in table 1 first all experiments were simulated using a two way interactive nested configuration with the 1 3 3 downscaling ratio and 58 vertical levels the physical parameterization schemes used in all model domains and experiments are the wrf single moment 6 class microphysics scheme hong and lim 2006 the mellor yamada janjic planetary boundary layer scheme janjić 1994 the rapid radiative transfer scheme rrtm mlawer et al 1997 and the unified noah land surface model chen and dudhia 2001 ek et al 2003 all the settings mentioned above are the optimal configurations for this simulation region summarized by liu et al 2021 next refer to the study by hwang et al 2019 all experiments used era5 data with additional hydrometeors all five available hydrometeors as input conditions to help observe the changes in the model required spin up times therefore the kain fritsch cumulus scheme kain 2004 with more moisture tendencies qc qr qi and qs was used in this study instead of the grell freitas cumulus scheme grell and freitas 2014 suggested by liu et al 2021 the time step used for the lateral boundary condition file is one hour the history output files of each domain are logged hourly to evaluate the effects of synoptic conditions all 42 experiments were divided into two scenarios the 3 level nested scenario s1 case 1 case 21 and the 2 level nested scenario s2 case 1 case 21 all nested domains are centred on the same latitude and longitude 31 5 n 30 e and employ lambert conformal projection fig 1 b c fig 1 a shows the imerg observed accumulated precipitation around the study area from 06 00 on 30th oct to 00 00 on 5th nov which occurs within the 120 h spin up period and the 18 h event duration in this study we refer to the precipitation other than the study event as disturbing precipitation for this simulation in order to differentiate indicated within the red box are the disturbing precipitations that occurred around the domain boundary during the model spin up time while the study event is the central precipitation therefore s1 and s2 were designed as comparison simulations that introduced the unsettled and calm weather conditions respectively taking case 1 c1 of s1 as an example it is a 3 level nested simulation with horizontal grid sizes of 31 5 km 10 km and 3 5 km for the outermost domain d01 middle domain d02 and innermost domain d03 respectively fig 1 b the d03 covers the study area of alexandria and the adjacent areas besides the grid points and domain sizes for d01 d02 and d03 are 80 80 about 6 19 million km2 112 112 about 1 36 million km2 and 88 88 about 0 09 million km2 respectively in comparison with c1 case 1 c1 of s2 is a 2 level nested simulation that only has the outermost domain d01 and innermost domain d02 with horizontal grid sizes of 10 km and 3 5 km respectively fig 1 c the horizontal sizes grid points and domain sizes for d01 d02 are the same as d02 and d03 the study event happened in the centre of d03 d02 hence the only difference between s1 experiments and s2 experiments is the presence or absence of the largest domain d01 according to the imerg observations it is assumed that the d01 of s1 experiments have more complex synoptic conditions than the d01 of s2 experiments after determining the domain and physical configurations case 1 case 21 c1 c21 of s1 and case 1 case 21 c1 c21 of s2 were simulated with different spin up times their spin up times increase from 0 to 120 h with a 6 hour time increment which makes these experiments introduce different ic at the beginning times by conducting the above comparative experiments the relationships between synoptic conditions as well as lengths of spin up times and final target simulation performances would be drawn 3 3 verification method to show the spatiotemporal performance changes of these experiments this study uses seven error metrics and one overall performance score to evaluate wrf simulations with respect to the imerg observations seven error metrics include the probability of detection pod the false alarm ratio far the critical success index csi the frequency bias index fbi the root mean square error rmse the mean bias error mbe and the standard deviation sd the first four metrics are spatial metrics they represent the probability of detecting precipitation and generating false precipitation the critical performance and the tendency to overestimate or underestimate precipitation respectively the calculation of these metrics is based on the rainfall contingency table as shown in table 2 rr nr rn and nn represent the grid numbers of hits misses false alarms and correct negatives respectively then the metric values can be obtained through equations 1 4 in these equations i and n refer to each time step and the total time step of the simulation run considering different thresholds may help to further investigate the simulation accuracy of extreme precipitation the precipitation above 0 1 mm is used to calculate pod fbi csi and far in this study the other three metrics are temporal metrics that indicate the average magnitude of error between simulations and observations the average bias of cumulative error and the magnitude of random error respectively the ranges and the ideal value of these error metrics are shown in table 3 a detailed description of the seven metrics can be found in liu et al 2012 in this study they are calculated by interpolating wrf simulations to the imerg final run observation grid at a 3 hour time step in d03 d02 1 pod 1 n i 1 n r r i r r i n r i 2 fbi 1 n i 1 n r r i r n i r r i n r i 3 far 1 n i 1 n r n i r r i r n i 4 csi 1 n i 1 n r r i r r i r n i n r i since every metric show different performance characteristics in spatial or temporal dimensions it is difficult to identify how the overall simulation performance changes with spin up times the relative closeness value of technique for order of preference by similarity to ideal solution topsis rcv proposed by hwang and yoon 1981 and further developed by liu et al 2021 is applied to evaluate the overall performance of each experiment in this study in order to have a uniform score with a value of 0 representing the worst and 1 representing the best all seven metric values are scaled to a range from 0 to 1 and assigned equal weights to calculate the topsis rcv so the possible range of topsis rcv is 0 1 and the perfect value is 1 in this way topsis rcv could easily show the total performance of wrf simulations under different weather conditions the detailed calculation method for uniform score could be found in liu et al 2021 3 4 framework planning the aim of this study is to take the shape of a wrf optimal spin up time identifying framework to achieve this goal the following work was conducted first the proposed framework is inspired by the above mentioned different nested level simulations over alexandria egypt these 42 extreme precipitation simulations revealed the relationship between regional model ic and optimal spin up time in section 4 1 the impact of unsettled weather on the study event and the thermodynamic and dynamic processes during different spin up times are discussed then seven spatiotemporal performance metrics and the overall performance score topsis rcv were used to further evaluate the performance of precipitation simulations and determine the optimal spin up time by analysing the variation of these metrics the concept of three standard periods critical period minimum period and adequate period of model spin up time is introduced in section 4 2 based on the knowledge of unsettled weather influences and three standard periods a simple optimal spin up time identifying framework that considers the different situations the wrf simulation set up will meet and the corresponding solutions could use is designed in section 5 1 the possible weather situations were classified regarding the time between wrf target precipitation and disturbing weather at the same time according to the critical minimum and adequate periods of the wrf model in the study area determine the recommended unrecommended unnecessary and cautious model spin up periods finally in section 5 2 three additional precipitation events around the mediterranean sea were used to test the proposed framework and show how to apply this framework these test events have different precipitation distributions precipitation intensities and synoptic backgrounds which is very helpful in understanding the generalization ability of this framework however further research is needed to refine the details of the framework particularly the spin up critical period minimum period and adequate period which may vary in different regions with different geographical features a comprehensive global list of these standard periods would be very useful for the osti framework to be generalised and applied to other events around the world 4 results and discussions 4 1 results of simulated precipitation patterns under different weather conditions the accumulated precipitation during the study event 18 h of the 3 level nested simulations scenario and the 2 level nested simulations scenario are shown in fig 2 and fig 3 the first subfigure i e fig 2 a and fig 3 a present the imerg observation as the validation for wrf experiments the other eleven subfigures i e fig 2 b l and fig 3 b l display the wrf results of simulations run with spin up times of 0 h c1 and c1 12 h c3 and c3 24 h c5 and c5 36 h c7 and c7 48 h c9 and c9 60 h c11 and c11 72 h c13 and c13 84 h c15 and c15 96 h c17 and c17 108 h c19 and c19 and 120 h c21 and c21 respectively they are plotted in the d02 domain of s1 and d01 domain of s2 which have the same size and for best visual comparisons next the disturbing precipitations precipitation rates estimated by imerg around the study area at the start times of wrf experiments are illustrated in fig 4 fig 4 a is the total precipitation from 06 00 on 30th oct to 00 00 on 5th nov which accumulated in the maximum 120 h spin up period and 18 h study event duration fig 4 b l correspond to the disturbing precipitation rate at different time points happened in wrf experiments of s1 and s2 these different onset time points also indicate that different lengths of spin up time were used in the wrf experiments for example wrf simulations c21 and c21 that run with 120 h spin up time spin up the model from 06 00 on oct 30 to 06 00 on nov 4 and then simulated the 18 h study event from 06 00 on nov 4 to 00 00 on nov 5 finally the synoptic weather patterns in the d01 domains at different start times of wrf experiments are displayed in fig 5 d01 domain is the largest domain that contains the area of d02 d01 and d03 d02 for better viewing domain boundaries are not drawn in fig 5 fig 5 a present surface temperature and sea level pressure averaged over the same 138 h as in fig 4 a fig 5 b l show geo potential heights wind speeds and relative humidity at 500 hpa which also correspond to the different ic at different time points used in wrf experiments of s1 and s2 fig 4 and fig 5 will help to understand the weather conditions around the domain boundaries for the entire study period as shown in fig 2 b f five experiments c1 c3 c5 c7 and c9 of s1 show the wrf simulation improves significantly with the increases in spin up time and gradually stabilizes around the 36 h and 48 h it is because the suitable spin up times can help the model to adjust its own numerics and develop appropriate circulations jankov et al 2007 skamarock and klemp 2008 however the simulation performances of c11 c13 c15 c17 c19 and c21 fig 2 g l are decreased instead when the spin up time is extended over 48 h in particular fig 2 i l the simulated precipitations become very unreasonably scattered toward the domain boundary instead of accumulating within d03 the potential reason for it could be that the model struggled to solve the inconsistency in its numerics and physics under unsettled weather conditions in contrast the improvements between the nine experiments c1 c3 c5 c7 c9 c11 c13 c15 c17 c19 and c21 of s2 are better and in line with our common understanding of model spin up time that is model performance grows with the increases in spin up time fig 3 b f and precipitation patterns become stable after reaching a certain level fig 3 g l even though the 11 experiments of s1 and 11 experiments of s2 are simulated under the same 18 hour study event precipitation their performance varies widely when considering the impacts from disturbing precipitation and synoptic backgrounds at different start times displayed in fig 4 and fig 5 the differences in simulation outputs between s1 and s2 experiments seem to be explained thermodynamically the study event was driven by the convergence of moist air from the mediterranean sea and colder air from the surrounding land the collision of these air masses created a zone of instability in the atmosphere which allowed for the development of the intense storm this storm was intensified by the upward vertical motion of air and the release of heat and energy through condensation which finally led to heavy precipitation and a flash flood in alexandria egypt as shown in fig 5 a the mediterranean sea surface is very warm and averages 22 during the whole spin up period while the land north of the sea averages only 10 and the land south of the sea averages 16 these large temperature gaps between ocean and land promoted the formation of extreme precipitation in both s1 and s2 simulations but due to the occurrence of disturbing precipitation and different domain sizes of s1 and s2 scenarios the atmospheric humidities in the initial fields of 42 experiments are very different for s1 experiments from 06 00 on oct 30 to 06 00 on nov 2 fig 4 f l there is disturbing precipitation occurring in the area between the boundaries of d01 and d02 d01 during the spin up period and its intensity is very high up to 25 mm h according to the study of rago et al 2017 and the news from floodlist 2015 the disturbing precipitation severely affected southern italy regions with more than 100 mm of precipitation in 24 h therefore the impact and intensity of the italy disturbing precipitation event are no less than the alexandria study event with the dissipation of this disturbing precipitation the relative humidity at the height of 500 hpa gradually decreases and the remaining moist air moves to the centre of the domains fig 5 f l however the areas where the disturbing precipitation was formed and the air humidity fluctuations it caused around the domain boundary were not included in the s2 experiment dynamically the alexandria event was driven by the low pressure system over the eastern mediterranean sea the low pressure system caused strong winds to develop in the lower atmosphere which helped to transport the moist air into alexandria and further lead to strong atmospheric instability and thunderstorms prevalent fig 5 b d displays an obvious low pressure system starting 24 h before the study event which is characterized by a counterclockwise flow of air around a central region of low pressure it is also accompanied by cloudiness strong winds and heavy precipitation which are often referred to as cyclones but when the spin up time is longer fig 5 f l the disturbing precipitation also formed a small cyclone over the left domain boundary d01 of s1 experiments overall the research event was triggered by a low pressure system then began to precipitate at 06 00 on nov 4 and developed to the strongest 4 h later it has a relatively strong synoptic background and shows large scale atmospheric circulation patterns supporting files 1 and 2 from nasa worldview https worldview earthdata nasa gov the reason for the difference in the performance of the s1 and s2 experiments is that the model spends a lot of effort on forgetting complex ic that does not contribute much to the formation of the target event such as the high humidity and cyclone near the domain boundary caused by the disturbing event this not only delays the model to following the path indicated by bc but also allows masking effects in the model outputs due to ic issues besides suppose the spin up time is unsuitable in that case the model can not fully reach its physical equilibrium state and the model outputs for the target event also could be adversely affected as described in the experimental design of section 3 2 the s2 experiments c1 c21 remove the outermost domain of the s1 experiments c1 c21 the location of the middle domain d02 and d01 is also designed referencing the satellite observed precipitation distributions to avoid introducing complex weather conditions into s2 experiments fig 4 a this design aims to figure out whether the occurrence of disturbing weather events weakens or strengthens the influence of ic on simulation outputs and explores a method that can determine the suitable spin up time in advance the results of the s1 and s2 experiments demonstrate it is feasible to determine the optimal model spin up start points based on observation data for example when wrf users check observations and find there is disturbing precipitation that happened between 120 h and 48 h before the study event fig 4 f l they could choose to start simulations within 48 h fig 4 b e and get better performance alternatively they can directly avoid unsettled weather conditions by controlling the size and location of the simulation domains as demonstrated in the s2 experiments in addition the large performance difference between s1 and s2 experiments illustrates that it is not always the longer spin up time the better simulations the lengths of the model required spin up time should be determined by the bc and ic during the spin up period and the effect of spin up time and weather conditions on the extreme precipitation simulation performance is non negligible thus it is very important to have clear guidance or framework to help more wrf users identify optimal spin up time systemically 4 2 results of verification metrics and overall performance score apart from comparing precipitation patterns the changes in seven verification metrics and overall performance score for 42 experiments are displayed in fig 6 a h these experiments are sorted by the length of spin up time and present the performance of individual metrics over the whole study event duration as shown in fig 6 a c three spatial metrics pod fbi and csi of s1 experiments show similar variations at different spin up times these metrics all reach the highest at 36 to 48 h and drop significantly after that but these three metrics exhibit fluctuations which implies simulation performances are not very stable in contrast the pod fbi and csi of s2 experiments gradually increase to the top around 48 h and maintain a nice performance in the remaining furthermore the maximum value of these three spatial metrics for the s2 experiments is about 0 1 higher than that for the s1 another spatial metric far shows less sensitivity to spin up time than other metrics as illustrated in fig 6 d the far of s2 experiments remained at a good level of around 0 1 while the far of s1 experiments has a small raise from 60 h to 120 h on the other hand the temporal metrics rmse and mbe of s1 experiments both achieve the best values approximately 4 5 and 2 closest to the ideal value of 0 near the 48 h but become worse after that fig 6 e f in contrast to s1 the rmse and mbe of s2 experiments reach good values approximately 3 and 0 around 24 h and keep the performance thereafter as for sd it has similar evident improvements in the first 48 h for both s1 and s2 experiments fig 6 g but s1 experiments still exist small fluctuations from 3 to 2 after 48 h unlike s2 which always remains at around 2 finally the overall performance score topsis rcv trend is generally consistent with the trends of the seven metrics summarized above the uniform score method is also convenient to evaluate the impacts of spin up time and weather conditions on simulation performances as shown in fig 6 h the overall performance of s2 experiments experiences a large increase in the first 48 h and maintains at 0 727 while the overall performance of s1 is less stable which can reach the highest score of about 0 638 and the lowest of about 0 375 linking the seven metric results with topsis rcv it can be found that 12 h 24 h and 48 h are three important time points for precipitation simulation with good ic and bc s2 experiments in this study area because these three points correspond to the rapid adjustment period 0 12 h steady growth period 12 24 h and slow improvement period 24 48 h of wrf simulation performance respectively first of all the topsis rcv of s2 increased significantly from 0 497 to 0 586 in 12 h spin up time because the wrf model roughly adjusted numerics and physics using ic and bc and made basic progress on precipitation formation during this period the values of many metrics such as rmse mbe and sd fluctuated and were far from the ideal value of 0 therefore 12 h could be seen as the critical period for this study event but the wrf users are not recommended use spin up times lower than the critical period to simulate precipitation as the model performance is very unstable and poor following this the topsis rcv of s2 grew greatly to 0 692 at 24 h spin up time as the appropriate atmospheric circulations were developed as shown by the black lines in fig 6 all metrics except sd became better without fluctuations besides the current topsis rcv is already very close to the performance peak value that can be achieved by the model under the influence of spin time so 24 h could be seen as the minimum period to get good simulations for this study event which is a suitable compromise between accuracy and computational efficiency finally the topsis rcv of s2 raise slowly and peaked at 0 727 at 48 h spin up time when wrf made further refinement accordingly 48 h could be seen as the adequate period for wrf to reach the best performance in this study event the spin up times longer than the adequate period would be unnecessary as precipitation simulation cannot be further improved which would just increase unnecessary computational costs if ic are ideal enough topsis rcv could be higher after this adequate spin up period but unsettled boundary conditions can still prevent further improvement like the experiments of s1 grey lines in fig 6 overall the critical period minimum period and adequate period are important for wrf users to determine the spin up time in different circumstances but the three periods found in this study event 12 24 and 48 h could vary for other events as it depends on the geographical features of the study area besides comparing the s1 and s2 simulations in this study with additional hydrometeors as input conditions with the normal simulations without additional hydrometeors as input conditions it is found that the method of hwang et al 2019 does improve the performance of very short range simulations but hwang et al 2019 s method can t compensate for the effects of unsettled weather conditions when wrf users conduct simulations the model s spin up time should not be fixed and need to be adjusted reasonably by some steps section 5 introduces the proposed framework with several possible weather situations and processing steps for how to identify optimal spin up time for different extreme precipitation events the role of the critical period minimum period adequate period and satellite observations will also be reflected in this framework 5 osti framework 5 1 proposed framework the osti framework provides a simple spin up time identifying methodology that incorporates four steps and four possible weather situations which aims to improve the efficiency of wrf short term precipitation simulation by judging which possible weather situation the proposed simulation is the users could obtain the recommended spin up time or determine whether the proposed domain configuration is feasible besides some performance improvement methods suitable for specific situations were also introduced the detailed processing steps and the situation explanations are shown below step 1 setting appropriate nested domain locations and sizes according to study event and wrf user guidance it is recommended that the proposed domain should contain major mesoscale circulation features and have at least five grid points between adjacent nested domains for sufficient relaxation space warner 2011 step 2 checking the weather conditions around the proposed domain boundaries in the period prior to the study event observation data such as satellite and radar can be used in this study precipitation as one of the most obvious signals is used to determine the area with unsettled weather conditions but in the future study more weather elements such as humidity air temperature and pressure wind speed and direction could also be employed as the indicator of input initial weather conditions step 3 find out which of the following situation best describes the occurrence of unsettled weather conditions prior to the study event around the domain boundaries as mentioned in section 4 2 the critical period minimum period and adequate period are important standards of spin up time for wrf model initialization and advancement in fig 7 these periods are illustrated as the temporal distance from three simulation start points critical minimum and adequate to the study event respectively in addition the temporal distance from the study event to the unsettled weather conditions period is defined as stu the relationships between stu and the three standard periods are classified in the four possible weather situations in fig 7 for example if an extreme precipitation event begins on october 2 at 10 00 while the unsettled weather conditions occur on october 1 at 08 00 the stu should be 26 h and if we assume that the example event occurs at the same location as the study event and use the same model configurations then the critical minimum and adequate spin up periods are 12 h 24 h and 48 h respectively since minimum period 24 h stu 26 h adequate period 48 h it is classified as situation 2 and the recommended spin up time is between 24 h to just prior to the disturbing event the four possible weather situations and different types of spin up time ranges are explained below situation 1 stu adequate period the proposed nested domains are ideal and can conduct wrf extreme precipitation simulation by a flexible spin up time the wrf model is recommended to start to spin up within the range between the minimum point and the adequate point green bar the spin up time closest to the minimum period is with the least desirable ability less recommended while the spin up time closest to the adequate period is with the most desirable ability more recommended for the spin up times beyond the adequate period yellow bar they are considered unnecessary because of the unnecessary computational cost on the contrary the spin up times less than the minimum period striped bar should be used cautiously as the atmospheric circulations may have not been developed thoroughly if so wrf users should check the precipitation spatial distribution of simulations with observations and pay more attention to adjusting the configuration situation 2 minimum period stu adequate period the proposed domains would be affected by unsettled weather conditions when using the adequate spin up time if times and conditions allow the spin up time is recommended to be larger than the minimum period and further extended to get the best performance green bar but not extended to the unsettled weather period the unsettled weather period red bar is definitively unrecommended for wrf initialization which will introduce a large number of initial inconsistencies and make the model hard to resolve the spin up time usage in the range of the striped bar in situation 2 is the same as in situation 1 situation 3 critical period stu minimum period the explanations for the left striped bar and red bar of situation 3 are similar to those above the spin up period is recommended to be as long as possible but not overlap with the unsettled weather period green bar because the unsettled weather period is close to the study event wrf can only complete rough adjustments during the critical spin up time the proposed domains are not very ideal and other model support methods would be required for instance users can use additional hydrometeor species as input parameters to help the model to achieve balance faster hwang et al 2019 alternatively users can also use a much longer spin up time that is beyond the stu i e the right striped bar such a way will allow the model to get stable ic and allow more time to balance later disturbance s introduction however using this cautiously because the simulations with very long spin up time may exhibit a certain level of freedom and chaotic behaviour that drift away from the forcing data alexandru et al 2009 if simulation performance is poor data assimilation and nudging would be support methods otherwise go back to step 1 to set new nested domains to avoid unsettled weather conditions and perform the above steps again situation 4 stu critical period the proposed domains are not suitable and simulation performance would be severely affected by the ic no recommended spin up time for situation 4 go back to step 1 to reduce or enlarge the domain size to avoid unsettled weather conditions near the boundaries and perform these steps again step 4 conducting the wrf simulations with the recommended spin up times observe whether simulated precipitation is accumulated reasonably or scatters toward the domain boundary as shown in fig 2 j l if scatters are present adjust other configurations in wrf such as vertical and grid resolution nesting ratio and physical parameterization scheme to refine the simulation 5 2 framework application to show the generalization ability of the proposed osti framework we have carried out simulations of three additional events around the mediterranean sea considering their simulation areas have the same geographical features and similar domain sizes as the alexandria study event the optimal spin up time is determined by the same three standard periods 12 h 24 h and 48 h found before besides because the most important part of the osti framework is to determine which situation the precipitation event belongs to the example events with different stus synoptic backgrounds precipitation distribution and intensity were chosen to demonstrate firstly a precipitation event that occurred over hurghada egypt on 26 27 october 2016 is an example of situation 1 example 1 in the osti framework based on the weather maps from the nasa worldview supporting files 3 and 4 the red sea and its surrounding area were calm windless and rainless for several days prior to example 1 this event happened over a narrow inland sea between the arabian peninsula and africa which has a relatively weak synoptic background than other events due to stu adequate period the most recommended spin up time would be 48 h and longer times are unnecessary for performance improvement fig 8 a c show the accumulated precipitations in two days from imerg observation wrf simulation with 48 h recommended spin up time also adequate period and wrf simulation with 60 h unnecessary spin up time respectively it can be found that the intensity of precipitation in the centre is stable and there is not much improvement even with a longer execution time for situation 2 in the osti framework the above study event over alexandria egypt is a good example the results of s1 experiments illustrate that wrf with the 40 h spin up time has the best performance while wrf simulations have poor performances when the disturbing weather includes in the ic fig 6 h following this an event that happened in antalya turkey on 28 december 2013 is an example of situation 3 example 2 the synoptic background of this event is relatively strong and we can see obvious strong wind and atmospheric circulation moving from the left side of the mediterranean sea to the right supporting files 5 in addition the disturbing precipitation during the spin up period is not heavy but exists close to the critical time of the example 2 event supporting files 6 in this case critical period stu minimum period the wrf simulations with 12 h recommended and 24 h unrecommended spin up times are conducted respectively it should be noted that there are certain ranges of recommended and unrecommended spin up times and 12 h and 24 h are selected only as demonstrations as demonstrated in fig 8 d f the precipitation distribution and intensity of recommended simulation are much better than the unrecommended when compared with imerg observation however situation 3 is the least frequent among all possible weather scenarios of wrf simulations because it requires that the disturbing precipitation occurring around the boundary is not too strong and ends before the critical period of the target event to ensure that the performance of the wrf simulation will not be greatly affected furthermore since the recommended spin up time of this type of precipitation event is less than the minimum period the simulation performance of these events will be more limited than others finally situation 4 of the osti framework is illustrated by taking the extreme precipitation event example 3 that occurred near beirut lebanon on 25 october 2015 as an example this event has the strongest weather background the largest scale and the highest precipitation intensity among all the events in this study supporting files 7 and 8 significant large scale atmospheric circulations occurred over the mediterranean sea and surrounding lands in this case based on the framework stu critical period it is hard to get satisfied simulations by using the original small domains and it is recommended to reset domain configurations as shown in fig 8 g i even though they were simulated with the same 48 h spin up time the simulations of the larger domain exhibited a significant improvement in reproducing the centre s extensive extreme precipitation and this improvement is difficult to achieve by changing the length of model spin up times in sum the osti framework can indeed help to decide the optimal spin time for wrf simulations before performing the simulations according to time ranges indicated by the osti framework the wrf precipitation results simulated by recommended unrecommended and unnecessary spin up times are basically in line with the expectations besides this framework is more useful for precipitation events with strong synoptic backgrounds because their simulation performances depend largely on the development of appropriate atmospheric circulations and physical equilibrium states in the model such as the alexandria study event antalya example 2 event and beirut example 3 event driven by the large scale movement of air together with ocean circulation the simulated precipitation intensity and distribution vary greatly under different initial conditions and spin up times in contrast the precipitation scale of hurghada example 1 event with a relatively weak synoptic background is small and shows less sensitivity to the spin up times than others 6 summary and conclusions this study focuses on exploring the relationship between the wrf model required spin up times and weather conditions in particular 21 3 level nested experiments and 21 2 level nested experiments for the extreme precipitation event that occurred on the 4 november 2015 in alexandria are conducted for comparative analysis firstly the simulated precipitation distributions of s1 experiments with unsettled weather conditions are compared to the s2 experiments with calm weather conditions these results are also analysed and linked to the time and location of disturbing precipitation then to quantify the wrf performances under different spin up times seven error metrics pod fbi csi far rmse mbe sd and an overall performance score topsis rcv are calculated to show the differences between s1 and s2 experiments finally the optimal spin up time identifying osti framework is proposed to help wrf users understand and choose a suitable spin up time for each precipitation event the application and verification of this framework are also presented by three other extreme precipitation events around the mediterranean sea the whole study aims to highlight the relationship between spin up times and weather conditions and give clear guidelines on how to determine optimal spin up time without too much trial and error testing by evaluating the results of the s1 and s2 experiments it is demonstrated that even simulated with the same spin on time the spatiotemporal and overall performance of wrf simulations varies greatly under the influence of different ic specifically the greatest differences of pod fbi csi and far are about 0 5 78 h spin up time c14 compared to c14 0 5 78 h spin up time c14 compared to c14 0 45 78 h spin up time c14 and c14 and 0 1 102 h spin up time c18 and c18 respectively moreover the rmse is improved by up to 70 5 and the overall performance score topsis rcv improves from about 0 375 to 0 732 at most the timing of these large differences in performance is all related to the timing of the italy extreme precipitation event occurring around the domain boundaries since the timing and location of complex weather are uncertain the optimal spin up time for wrf should vary by study event and domain configuration on the other hand other factors could also have contributed to the simulation performance of s1 being worse than s2 such as model internal variability which is well known to increase with domain size giorgi and bi 2000 alexandru et al 2007 but comparing the 21 s1 simulations with same domain configurations the model performance can change significantly in very short times which exceeds the level of internal model variability thus the main reason for the model performance degradation in the larger domain simulations with long spin up times should still be due to synoptic conditions overall the wrf spin up time should not be too short as it is hard to develop the appropriate atmospheric circulations but not the longer the better either because it depends on the quality of ic a solution for this problem is to avoid unsettled weather conditions by using observations as guidance radar satellite etc as well as determine the appropriate spin up time based on the critical period minimum period and adequate period for the study area by referring to previous literature carried out in the same areas of course there do exist some other methods for wrf to handle complex weather like large scale nudging but the nudging method also has some problems such as how to choose the nudging strength to preserve internal model variability and keep the error growth under control besides nudging could not yield perfect results because it is still unable to completely overcome the physical and dynamical deficiencies and inconsistencies in the wrf model bowden et al 2012 tang et al 2017 therefore in some cases users may consider adopting the proposed osti framework to avoid unnecessary adverse effects from complex weather conditions and improve modelling efficiency in this study the sensitivities of wrf simulations to spin up times and synoptic conditions are investigated and the framework that estimates the optimal spin up time through satellite observations is summarized however a limitation of this study is that it only investigated the effect of disturbing precipitation on simulation results in fact unsettled weather conditions can be of many kinds while precipitation is one of the easiest to identify in the future more weather elements such as humidity air temperature and pressure and wind speed could also be explored to see whether they are helpful for optimal spin up time identification in addition this study only considers the information provided by the observation data because this way is the easiest that users only need to browse the records on satellite websites but whether it is possible to obtain more information from the era5 reanalysis data and determine the optimal configuration has not been done in this study considering the study in this field is very limited and there are no clear guidelines we hope our study could provide a new idea to solve the lack of consensus on the choice of wrf spin up time moreover promote the establishment of wrf spin up time guidelines for the community users in summary the results of this study will provide a useful reference for future wrf applications in extreme precipitation simulations credit authorship contribution statement ying liu conceptualization methodology software validation formal analysis data curation writing original draft writing review editing visualization funding acquisition lu zhuo conceptualization supervision writing review editing dawei han conceptualization supervision writing review editing declaration of competing interest the authors declare the following financial interests personal relationships which may be considered as potential competing interests ying liu reports financial support was provided by china scholarship council acknowledgements the first author is grateful to the china scholarship council and the university of bristol for providing the joint scholarship csc no 201908310086 for her phd study at the university of bristol all authors acknowledge the dataset developers from nasa and ecmwf for producing and sharing the datasets employed in this study we would also like to acknowledge the advanced computing research centre at the university of bristol for providing access to the high performance computing system bluecrystal 
2051,despite the wide application of the weather research and forecasting wrf model in extreme precipitation simulations there is a lack of consensus and clear guidance on identifying the suitable length of spin up time in this study the wrf model was used to simulate the extreme precipitation events that happened on the 4 november 2015 at alexandria of the nile delta according to the observation from the integrated multi satellite retrievals for global precipitation measurement imerg 21 spin up time experiments of the 3 level nested domain scenario and 21 spin up time experiments of the 2 level nested domain scenario were designed to explore the relationship between model required spin up time and initial conditions the simulation performances were evaluated by seven verification metrics and one overall performance score here we try to provide guidelines on how to determine the optimal spin up time through satellite data without too many trial and error tests an optimal spin up time identifying osti framework with possible weather situations and spin up time determining steps is proposed to help future work it is found that the occurrences of disturbing weather events strengthen the influence of initial conditions on simulation outputs and increase model requirements for spin up time lengths moreover this framework is more useful for precipitation events with strong synoptic backgrounds because their simulation performances depend largely on the development of appropriate atmospheric circulations and physical equilibrium states in the model keywords wrf spin up time osti framework era5 imerg 1 introduction global and regional climate models gcms and rcms are becoming established tools for providing reliable information for climate predictions however the high resolution simulations of gcms are very computationally expensive in contrast rcms have shown their ability to effectively downscale global information and accurately reproduce mesoscale and local features over a limited region with affordable computational costs rummukainen 2010 jacob et al 2014 schewe et al 2019 the mesoscale atmospheric weather research and forecasting wrf model is a typical rcm that numerically solves a set of differential equations describing the climate system over a selected domain after required discretization and parameterization processes to perform dynamical downscaling wrf needs initial and boundary conditions ic and bc provided by global reanalysis datasets to initialise and drive atmospheric variables through their domain boundaries compared to the larger gridded meteorological datasets that poorly represent atmospheric patterns running dynamical downscaling wrf with high resolution can help resolve the spatial variability of key variables and surface atmosphere exchanges because heterogeneous land fluxes and near land meteorological parameters are better resolved talbot et al 2012 it is commonly believed that wrf may forget the ic after a certain execution time to save computational resources and reduce delivery time the whole simulation period is usually divided into subperiods with spin up periods followed by continuous executions gómez navarro et al 2011 jerez et al 2018 the spin up time is necessary to avoid inhomogeneities when connecting subperiods as well as decrease the masking effects of ic issues on model results in wrf extreme precipitation simulations spin up time allows the model to adjust from the ic to a state that is consistent with its own numerics and physics and to develop appropriate large scale circulations jankov et al 2007 skamarock and klemp 2008 therefore spin up time is the required execution time that allows the wrf to reach a physical equilibrium state following the path defined by the bc while forgetting about the ic yang et al 1995 giorgi and mearns 1999 denis et al 2002 moreover until reach the equilibrium state the results can be easily tainted by spin up induced biases the model outputs will not be realistic and must be discarded cosgrove et al 2003 to prevent instabilities in the wrf model jankov et al 2007 found that at least 12 h spin up time should be used and this spin up time is often regarded as a suitable choice directly without enough verification in many wrf studies huva et al 2012 dzebre et al 2019 afshar et al 2020 furthermore the lengths of spin up time used in some other studies vary widely from a minimum of 6 h to a maximum of 1 year cha and wang 2013 naabil et al 2017 zhuo et al 2019 in fact the length of spin up depends on the quality of initial inputs and the soil conditions because the soil moisture content and latent heat flux will influence precipitation processes kleczek et al 2014 if the ic is very complex and impressive the model will take more time to forget it and get away from its masking effects therefore the optimal spin up time is not fixed and should be different for each event with different ic in addition the study by hwang et al 2019 found that using multiple hydrometeors as input in the bc can reduce spin up time and accelerate precipitation initialization their sensitive experiments were conducted with different numbers of hydrometeors including specific humidity specific cloud liquid water specific cloud ice water specific rain water and specific snow water the results show that this method has a good effect on short range precipitation simulation however most weather prediction studies ignore the effect of initial weather conditions and directly use 12 h spin up time because conducting too much trial and error testing before the formal simulation is computationally expensive in fact it is very difficult to determine the wrf optimal spin up time for different events since it depends on many factors first of all the climate system has a large number of components with various response times for example soil moisture responds much slower than atmospheric variables to dynamical and thermo dynamical processes skamarock 2004 de elia et al 2002 doblas reyes et al 2013 the second factor is the size of the simulated domains since the bc effect decays as we move away from the boundaries leduc and laprise 2009 third wrf has many physical schemes that can be used the choice of physical scheme often results in differences in the internal variability of simulations awan et al 2011 evans et al 2012 ji et al 2014 fourth the ic of wrf is obtained by spatial interpolating the global datasets to the selected regions the greater the inconsistencies between ic and model physics the longer the spin up time required turco et al 2013 the last factor is the model spin up would be affected by extreme conditions like extremely hot or cold temperatures extremely dry air and so on day et al 2014 seck et al 2015 in this study to solve the lack of consensus on the choice of wrf spin up time 42 sensitivity experiments with different ic are evaluated to explore the effects of disturbing weather on required spin up times disturbing weather refers to the other weather event that occurs within the spin up window which causes large scale changes in the synoptic background at the initial time moreover an optimal spin up time identifying osti framework is proposed to provide guidelines for future simulation work the purpose of this study is to help other researchers to avoid unfavourable ic and determine suitable spin up times for their wrf precipitation simulations this study aims to address the following two key research questions does the occurrence of disturbing weather events weaken or strengthen the influence of initial conditions on simulation outputs why does wrf s optimal spin up time vary by event and situation how can a structured selecting framework help to determine suitable wrf spin up time more efficiently the significance of this study is to highlight the importance of spin up time and show a guiding framework that can determine spin up time more efficiently before simulation without the need for too much trial and error testing this study is organized as follows a brief description of the study area and event are provided in section 2 the datasets experimental design verification metrics framework planning are illustrated in section 3 the results and discussions of different experiments are shown in section 4 the detailed osti framework and framework application is explained in section 5 finally the summary and conclusions of this study are presented in section 6 2 study area and event alexandria in the nile delta was selected as the study area due to the influence of the mediterranean climate this area has long dry summers and short mild winters in recent decades this area becomes a vulnerable zone that faces growing pluvial flooding hazards however the inadequate coverage of radars and rain gauges makes the development of a hydrometeorological early warning system in egypt very difficult wrf model is an effective way to simulate extreme precipitation by downscaling global nwp products to interesting areas which is very suitable and feasible for countries like egypt our previous study has investigated the sensitivities of various model configurations and obtained some useful findings liu et al 2021 but the hypothesis that regional weather conditions may impact the time required for model initialization has not been fully confirmed therefore further exploration of the relationship between wrf spin up time and weather conditions through the extreme event in this area would be meaningful for egypt and other similar regions the study event happened on the 4 november 2015 which was a 50 year storm that caused 60 of the city area to be flooded as well as the stagnant water in some low lying areas remained for more than 15 days some places even recorded more than 200 mm of precipitation in 2 h zevenbergen et al 2017 the main extreme precipitation of this event lasted for about 18 h from 06 00 to 24 00 utc the centred latitude and longitude of this event are at 31 5 n and 30 e this extreme precipitation event caused a devastating flood that has been reported as the worst flooding of alexandria city over the past decades in terms of the number of people affected and the amount of economic damage ihe delft 2017 the terrain of the study area and the location of the surrounding red sea and the mediterranean sea are shown in fig 1 b c the detailed descriptions of the nested domain and study event locations are presented in section 3 2 furthermore the proposed framework is also applied and verified through three other extreme precipitation events that happened around hurghada egypt 26 and 27 october 2016 antalya turkey 28 december 2013 and beirut lebanon 25 october 2015 these precipitation events have different intensities distributions and synoptic backgrounds which is very helpful to explore the generalization ability of the osti framework 3 materials and methods 3 1 datasets 3 1 1 initial and lateral boundary dataset the european centre for medium range weather forecasts ecmwf global climate reanalysis v5 era5 was used to provide the initial and lateral boundary meteorological conditions in the wrf simulations era5 is a newly developed dataset since early 2016 and has replaced the old reanalysis dataset era interim this dataset spans the period from 1 january 1950 onwards era5 offers over 240 parameters related to the atmosphere land and ocean climate etc on the surface and vertical levels which are much more than 100 parameters in era interim furthermore the spatiotemporal resolution of the era5 dataset hourly 31 km grid spacing analysis fields is significantly better than the era interim dataset 6 hourly 80 km grid spacing analysis fields hersbach et al 2020 along with the development of this new dataset there have been some studies using era5 as a lateral boundary condition for wrf simulations in egypt and the surrounding area of the mediterranean sea duzenli et al 2021 liu et al 2021 papavasileiou et al 2022 ludwig and hochman 2022 the detailed introduction of the era5 reanalysis dataset and its parameters can be found in the ecmwf documentation https confluence ecmwf int display ckb era5 3a data documentation the era5 reanalysis dataset can be downloaded on the ecmwf website https www ecmwf int en forecasts datasets reanalysis datasets era5 3 1 2 observational data the integrated multi satellite retrievals for global precipitation measurement imerg version 06b was used for simulation verification it combines precipitation estimates from geosynchronous infrared observations from geo ir satellites all passive microwave sensors of the global precipitation measurement gpm constellation and ground based measurements from precipitation gauges huffman et al 2015 imerg provides the quasi global precipitation estimates with 0 1 0 1 spatial resolution and 30 min temporal resolution according to the differences in latency and accuracy imerg has three sequences called early run near real time low latency gridded global multi satellite precipitation estimates 4 h latency late run near real time gridded global multi satellite precipitation estimates with quasi lagrangian time interpolation 12 h latency and final run research quality gridded global multi satellite precipitation estimates with quasi lagrangian time interpolation gauge data and climatological adjustment 3 5 months latency particularly the imerg final run product has a month to month climatological correction through the global precipitation climatology centre gpcc precipitation gauge analysis hou et al 2014 huffman et al 2015 since imerg product s release in early 2015 a substantial number of studies have used and recommended it for various applications such as analysis of extreme precipitation events huang et al 2019 streamflow simulation tang et al 2016 and flood forecasting wang et al 2017 and a large number of studies have evaluated the performance of imerg precipitation products at various temporal and spatial scales e g wang et al 2023 navarro et al 2019 palomino ángel et al 2019 prakash et al 2018 manz et al 2017 considering the insufficient coverage of surface observations radar and rain gauges in egypt imerg is a useful alternative dataset to be adopted in this study due to its fine spatial and temporal resolutions which favour simulation evaluations and its stable performance as evidenced in previous studies in this study the imerg final run product is used because it generally has advantages over the uncalibrated early run and late run products imerg products can be downloaded on the gpm website https gpm nasa gov data directory and detailed introductions can be found in huffman et al 2015 3 2 experimental design the precipitation simulation experiments of this study were conducted by the wrf arw version 4 0 skamarock et al 2019 the model configuration settings are listed in table 1 first all experiments were simulated using a two way interactive nested configuration with the 1 3 3 downscaling ratio and 58 vertical levels the physical parameterization schemes used in all model domains and experiments are the wrf single moment 6 class microphysics scheme hong and lim 2006 the mellor yamada janjic planetary boundary layer scheme janjić 1994 the rapid radiative transfer scheme rrtm mlawer et al 1997 and the unified noah land surface model chen and dudhia 2001 ek et al 2003 all the settings mentioned above are the optimal configurations for this simulation region summarized by liu et al 2021 next refer to the study by hwang et al 2019 all experiments used era5 data with additional hydrometeors all five available hydrometeors as input conditions to help observe the changes in the model required spin up times therefore the kain fritsch cumulus scheme kain 2004 with more moisture tendencies qc qr qi and qs was used in this study instead of the grell freitas cumulus scheme grell and freitas 2014 suggested by liu et al 2021 the time step used for the lateral boundary condition file is one hour the history output files of each domain are logged hourly to evaluate the effects of synoptic conditions all 42 experiments were divided into two scenarios the 3 level nested scenario s1 case 1 case 21 and the 2 level nested scenario s2 case 1 case 21 all nested domains are centred on the same latitude and longitude 31 5 n 30 e and employ lambert conformal projection fig 1 b c fig 1 a shows the imerg observed accumulated precipitation around the study area from 06 00 on 30th oct to 00 00 on 5th nov which occurs within the 120 h spin up period and the 18 h event duration in this study we refer to the precipitation other than the study event as disturbing precipitation for this simulation in order to differentiate indicated within the red box are the disturbing precipitations that occurred around the domain boundary during the model spin up time while the study event is the central precipitation therefore s1 and s2 were designed as comparison simulations that introduced the unsettled and calm weather conditions respectively taking case 1 c1 of s1 as an example it is a 3 level nested simulation with horizontal grid sizes of 31 5 km 10 km and 3 5 km for the outermost domain d01 middle domain d02 and innermost domain d03 respectively fig 1 b the d03 covers the study area of alexandria and the adjacent areas besides the grid points and domain sizes for d01 d02 and d03 are 80 80 about 6 19 million km2 112 112 about 1 36 million km2 and 88 88 about 0 09 million km2 respectively in comparison with c1 case 1 c1 of s2 is a 2 level nested simulation that only has the outermost domain d01 and innermost domain d02 with horizontal grid sizes of 10 km and 3 5 km respectively fig 1 c the horizontal sizes grid points and domain sizes for d01 d02 are the same as d02 and d03 the study event happened in the centre of d03 d02 hence the only difference between s1 experiments and s2 experiments is the presence or absence of the largest domain d01 according to the imerg observations it is assumed that the d01 of s1 experiments have more complex synoptic conditions than the d01 of s2 experiments after determining the domain and physical configurations case 1 case 21 c1 c21 of s1 and case 1 case 21 c1 c21 of s2 were simulated with different spin up times their spin up times increase from 0 to 120 h with a 6 hour time increment which makes these experiments introduce different ic at the beginning times by conducting the above comparative experiments the relationships between synoptic conditions as well as lengths of spin up times and final target simulation performances would be drawn 3 3 verification method to show the spatiotemporal performance changes of these experiments this study uses seven error metrics and one overall performance score to evaluate wrf simulations with respect to the imerg observations seven error metrics include the probability of detection pod the false alarm ratio far the critical success index csi the frequency bias index fbi the root mean square error rmse the mean bias error mbe and the standard deviation sd the first four metrics are spatial metrics they represent the probability of detecting precipitation and generating false precipitation the critical performance and the tendency to overestimate or underestimate precipitation respectively the calculation of these metrics is based on the rainfall contingency table as shown in table 2 rr nr rn and nn represent the grid numbers of hits misses false alarms and correct negatives respectively then the metric values can be obtained through equations 1 4 in these equations i and n refer to each time step and the total time step of the simulation run considering different thresholds may help to further investigate the simulation accuracy of extreme precipitation the precipitation above 0 1 mm is used to calculate pod fbi csi and far in this study the other three metrics are temporal metrics that indicate the average magnitude of error between simulations and observations the average bias of cumulative error and the magnitude of random error respectively the ranges and the ideal value of these error metrics are shown in table 3 a detailed description of the seven metrics can be found in liu et al 2012 in this study they are calculated by interpolating wrf simulations to the imerg final run observation grid at a 3 hour time step in d03 d02 1 pod 1 n i 1 n r r i r r i n r i 2 fbi 1 n i 1 n r r i r n i r r i n r i 3 far 1 n i 1 n r n i r r i r n i 4 csi 1 n i 1 n r r i r r i r n i n r i since every metric show different performance characteristics in spatial or temporal dimensions it is difficult to identify how the overall simulation performance changes with spin up times the relative closeness value of technique for order of preference by similarity to ideal solution topsis rcv proposed by hwang and yoon 1981 and further developed by liu et al 2021 is applied to evaluate the overall performance of each experiment in this study in order to have a uniform score with a value of 0 representing the worst and 1 representing the best all seven metric values are scaled to a range from 0 to 1 and assigned equal weights to calculate the topsis rcv so the possible range of topsis rcv is 0 1 and the perfect value is 1 in this way topsis rcv could easily show the total performance of wrf simulations under different weather conditions the detailed calculation method for uniform score could be found in liu et al 2021 3 4 framework planning the aim of this study is to take the shape of a wrf optimal spin up time identifying framework to achieve this goal the following work was conducted first the proposed framework is inspired by the above mentioned different nested level simulations over alexandria egypt these 42 extreme precipitation simulations revealed the relationship between regional model ic and optimal spin up time in section 4 1 the impact of unsettled weather on the study event and the thermodynamic and dynamic processes during different spin up times are discussed then seven spatiotemporal performance metrics and the overall performance score topsis rcv were used to further evaluate the performance of precipitation simulations and determine the optimal spin up time by analysing the variation of these metrics the concept of three standard periods critical period minimum period and adequate period of model spin up time is introduced in section 4 2 based on the knowledge of unsettled weather influences and three standard periods a simple optimal spin up time identifying framework that considers the different situations the wrf simulation set up will meet and the corresponding solutions could use is designed in section 5 1 the possible weather situations were classified regarding the time between wrf target precipitation and disturbing weather at the same time according to the critical minimum and adequate periods of the wrf model in the study area determine the recommended unrecommended unnecessary and cautious model spin up periods finally in section 5 2 three additional precipitation events around the mediterranean sea were used to test the proposed framework and show how to apply this framework these test events have different precipitation distributions precipitation intensities and synoptic backgrounds which is very helpful in understanding the generalization ability of this framework however further research is needed to refine the details of the framework particularly the spin up critical period minimum period and adequate period which may vary in different regions with different geographical features a comprehensive global list of these standard periods would be very useful for the osti framework to be generalised and applied to other events around the world 4 results and discussions 4 1 results of simulated precipitation patterns under different weather conditions the accumulated precipitation during the study event 18 h of the 3 level nested simulations scenario and the 2 level nested simulations scenario are shown in fig 2 and fig 3 the first subfigure i e fig 2 a and fig 3 a present the imerg observation as the validation for wrf experiments the other eleven subfigures i e fig 2 b l and fig 3 b l display the wrf results of simulations run with spin up times of 0 h c1 and c1 12 h c3 and c3 24 h c5 and c5 36 h c7 and c7 48 h c9 and c9 60 h c11 and c11 72 h c13 and c13 84 h c15 and c15 96 h c17 and c17 108 h c19 and c19 and 120 h c21 and c21 respectively they are plotted in the d02 domain of s1 and d01 domain of s2 which have the same size and for best visual comparisons next the disturbing precipitations precipitation rates estimated by imerg around the study area at the start times of wrf experiments are illustrated in fig 4 fig 4 a is the total precipitation from 06 00 on 30th oct to 00 00 on 5th nov which accumulated in the maximum 120 h spin up period and 18 h study event duration fig 4 b l correspond to the disturbing precipitation rate at different time points happened in wrf experiments of s1 and s2 these different onset time points also indicate that different lengths of spin up time were used in the wrf experiments for example wrf simulations c21 and c21 that run with 120 h spin up time spin up the model from 06 00 on oct 30 to 06 00 on nov 4 and then simulated the 18 h study event from 06 00 on nov 4 to 00 00 on nov 5 finally the synoptic weather patterns in the d01 domains at different start times of wrf experiments are displayed in fig 5 d01 domain is the largest domain that contains the area of d02 d01 and d03 d02 for better viewing domain boundaries are not drawn in fig 5 fig 5 a present surface temperature and sea level pressure averaged over the same 138 h as in fig 4 a fig 5 b l show geo potential heights wind speeds and relative humidity at 500 hpa which also correspond to the different ic at different time points used in wrf experiments of s1 and s2 fig 4 and fig 5 will help to understand the weather conditions around the domain boundaries for the entire study period as shown in fig 2 b f five experiments c1 c3 c5 c7 and c9 of s1 show the wrf simulation improves significantly with the increases in spin up time and gradually stabilizes around the 36 h and 48 h it is because the suitable spin up times can help the model to adjust its own numerics and develop appropriate circulations jankov et al 2007 skamarock and klemp 2008 however the simulation performances of c11 c13 c15 c17 c19 and c21 fig 2 g l are decreased instead when the spin up time is extended over 48 h in particular fig 2 i l the simulated precipitations become very unreasonably scattered toward the domain boundary instead of accumulating within d03 the potential reason for it could be that the model struggled to solve the inconsistency in its numerics and physics under unsettled weather conditions in contrast the improvements between the nine experiments c1 c3 c5 c7 c9 c11 c13 c15 c17 c19 and c21 of s2 are better and in line with our common understanding of model spin up time that is model performance grows with the increases in spin up time fig 3 b f and precipitation patterns become stable after reaching a certain level fig 3 g l even though the 11 experiments of s1 and 11 experiments of s2 are simulated under the same 18 hour study event precipitation their performance varies widely when considering the impacts from disturbing precipitation and synoptic backgrounds at different start times displayed in fig 4 and fig 5 the differences in simulation outputs between s1 and s2 experiments seem to be explained thermodynamically the study event was driven by the convergence of moist air from the mediterranean sea and colder air from the surrounding land the collision of these air masses created a zone of instability in the atmosphere which allowed for the development of the intense storm this storm was intensified by the upward vertical motion of air and the release of heat and energy through condensation which finally led to heavy precipitation and a flash flood in alexandria egypt as shown in fig 5 a the mediterranean sea surface is very warm and averages 22 during the whole spin up period while the land north of the sea averages only 10 and the land south of the sea averages 16 these large temperature gaps between ocean and land promoted the formation of extreme precipitation in both s1 and s2 simulations but due to the occurrence of disturbing precipitation and different domain sizes of s1 and s2 scenarios the atmospheric humidities in the initial fields of 42 experiments are very different for s1 experiments from 06 00 on oct 30 to 06 00 on nov 2 fig 4 f l there is disturbing precipitation occurring in the area between the boundaries of d01 and d02 d01 during the spin up period and its intensity is very high up to 25 mm h according to the study of rago et al 2017 and the news from floodlist 2015 the disturbing precipitation severely affected southern italy regions with more than 100 mm of precipitation in 24 h therefore the impact and intensity of the italy disturbing precipitation event are no less than the alexandria study event with the dissipation of this disturbing precipitation the relative humidity at the height of 500 hpa gradually decreases and the remaining moist air moves to the centre of the domains fig 5 f l however the areas where the disturbing precipitation was formed and the air humidity fluctuations it caused around the domain boundary were not included in the s2 experiment dynamically the alexandria event was driven by the low pressure system over the eastern mediterranean sea the low pressure system caused strong winds to develop in the lower atmosphere which helped to transport the moist air into alexandria and further lead to strong atmospheric instability and thunderstorms prevalent fig 5 b d displays an obvious low pressure system starting 24 h before the study event which is characterized by a counterclockwise flow of air around a central region of low pressure it is also accompanied by cloudiness strong winds and heavy precipitation which are often referred to as cyclones but when the spin up time is longer fig 5 f l the disturbing precipitation also formed a small cyclone over the left domain boundary d01 of s1 experiments overall the research event was triggered by a low pressure system then began to precipitate at 06 00 on nov 4 and developed to the strongest 4 h later it has a relatively strong synoptic background and shows large scale atmospheric circulation patterns supporting files 1 and 2 from nasa worldview https worldview earthdata nasa gov the reason for the difference in the performance of the s1 and s2 experiments is that the model spends a lot of effort on forgetting complex ic that does not contribute much to the formation of the target event such as the high humidity and cyclone near the domain boundary caused by the disturbing event this not only delays the model to following the path indicated by bc but also allows masking effects in the model outputs due to ic issues besides suppose the spin up time is unsuitable in that case the model can not fully reach its physical equilibrium state and the model outputs for the target event also could be adversely affected as described in the experimental design of section 3 2 the s2 experiments c1 c21 remove the outermost domain of the s1 experiments c1 c21 the location of the middle domain d02 and d01 is also designed referencing the satellite observed precipitation distributions to avoid introducing complex weather conditions into s2 experiments fig 4 a this design aims to figure out whether the occurrence of disturbing weather events weakens or strengthens the influence of ic on simulation outputs and explores a method that can determine the suitable spin up time in advance the results of the s1 and s2 experiments demonstrate it is feasible to determine the optimal model spin up start points based on observation data for example when wrf users check observations and find there is disturbing precipitation that happened between 120 h and 48 h before the study event fig 4 f l they could choose to start simulations within 48 h fig 4 b e and get better performance alternatively they can directly avoid unsettled weather conditions by controlling the size and location of the simulation domains as demonstrated in the s2 experiments in addition the large performance difference between s1 and s2 experiments illustrates that it is not always the longer spin up time the better simulations the lengths of the model required spin up time should be determined by the bc and ic during the spin up period and the effect of spin up time and weather conditions on the extreme precipitation simulation performance is non negligible thus it is very important to have clear guidance or framework to help more wrf users identify optimal spin up time systemically 4 2 results of verification metrics and overall performance score apart from comparing precipitation patterns the changes in seven verification metrics and overall performance score for 42 experiments are displayed in fig 6 a h these experiments are sorted by the length of spin up time and present the performance of individual metrics over the whole study event duration as shown in fig 6 a c three spatial metrics pod fbi and csi of s1 experiments show similar variations at different spin up times these metrics all reach the highest at 36 to 48 h and drop significantly after that but these three metrics exhibit fluctuations which implies simulation performances are not very stable in contrast the pod fbi and csi of s2 experiments gradually increase to the top around 48 h and maintain a nice performance in the remaining furthermore the maximum value of these three spatial metrics for the s2 experiments is about 0 1 higher than that for the s1 another spatial metric far shows less sensitivity to spin up time than other metrics as illustrated in fig 6 d the far of s2 experiments remained at a good level of around 0 1 while the far of s1 experiments has a small raise from 60 h to 120 h on the other hand the temporal metrics rmse and mbe of s1 experiments both achieve the best values approximately 4 5 and 2 closest to the ideal value of 0 near the 48 h but become worse after that fig 6 e f in contrast to s1 the rmse and mbe of s2 experiments reach good values approximately 3 and 0 around 24 h and keep the performance thereafter as for sd it has similar evident improvements in the first 48 h for both s1 and s2 experiments fig 6 g but s1 experiments still exist small fluctuations from 3 to 2 after 48 h unlike s2 which always remains at around 2 finally the overall performance score topsis rcv trend is generally consistent with the trends of the seven metrics summarized above the uniform score method is also convenient to evaluate the impacts of spin up time and weather conditions on simulation performances as shown in fig 6 h the overall performance of s2 experiments experiences a large increase in the first 48 h and maintains at 0 727 while the overall performance of s1 is less stable which can reach the highest score of about 0 638 and the lowest of about 0 375 linking the seven metric results with topsis rcv it can be found that 12 h 24 h and 48 h are three important time points for precipitation simulation with good ic and bc s2 experiments in this study area because these three points correspond to the rapid adjustment period 0 12 h steady growth period 12 24 h and slow improvement period 24 48 h of wrf simulation performance respectively first of all the topsis rcv of s2 increased significantly from 0 497 to 0 586 in 12 h spin up time because the wrf model roughly adjusted numerics and physics using ic and bc and made basic progress on precipitation formation during this period the values of many metrics such as rmse mbe and sd fluctuated and were far from the ideal value of 0 therefore 12 h could be seen as the critical period for this study event but the wrf users are not recommended use spin up times lower than the critical period to simulate precipitation as the model performance is very unstable and poor following this the topsis rcv of s2 grew greatly to 0 692 at 24 h spin up time as the appropriate atmospheric circulations were developed as shown by the black lines in fig 6 all metrics except sd became better without fluctuations besides the current topsis rcv is already very close to the performance peak value that can be achieved by the model under the influence of spin time so 24 h could be seen as the minimum period to get good simulations for this study event which is a suitable compromise between accuracy and computational efficiency finally the topsis rcv of s2 raise slowly and peaked at 0 727 at 48 h spin up time when wrf made further refinement accordingly 48 h could be seen as the adequate period for wrf to reach the best performance in this study event the spin up times longer than the adequate period would be unnecessary as precipitation simulation cannot be further improved which would just increase unnecessary computational costs if ic are ideal enough topsis rcv could be higher after this adequate spin up period but unsettled boundary conditions can still prevent further improvement like the experiments of s1 grey lines in fig 6 overall the critical period minimum period and adequate period are important for wrf users to determine the spin up time in different circumstances but the three periods found in this study event 12 24 and 48 h could vary for other events as it depends on the geographical features of the study area besides comparing the s1 and s2 simulations in this study with additional hydrometeors as input conditions with the normal simulations without additional hydrometeors as input conditions it is found that the method of hwang et al 2019 does improve the performance of very short range simulations but hwang et al 2019 s method can t compensate for the effects of unsettled weather conditions when wrf users conduct simulations the model s spin up time should not be fixed and need to be adjusted reasonably by some steps section 5 introduces the proposed framework with several possible weather situations and processing steps for how to identify optimal spin up time for different extreme precipitation events the role of the critical period minimum period adequate period and satellite observations will also be reflected in this framework 5 osti framework 5 1 proposed framework the osti framework provides a simple spin up time identifying methodology that incorporates four steps and four possible weather situations which aims to improve the efficiency of wrf short term precipitation simulation by judging which possible weather situation the proposed simulation is the users could obtain the recommended spin up time or determine whether the proposed domain configuration is feasible besides some performance improvement methods suitable for specific situations were also introduced the detailed processing steps and the situation explanations are shown below step 1 setting appropriate nested domain locations and sizes according to study event and wrf user guidance it is recommended that the proposed domain should contain major mesoscale circulation features and have at least five grid points between adjacent nested domains for sufficient relaxation space warner 2011 step 2 checking the weather conditions around the proposed domain boundaries in the period prior to the study event observation data such as satellite and radar can be used in this study precipitation as one of the most obvious signals is used to determine the area with unsettled weather conditions but in the future study more weather elements such as humidity air temperature and pressure wind speed and direction could also be employed as the indicator of input initial weather conditions step 3 find out which of the following situation best describes the occurrence of unsettled weather conditions prior to the study event around the domain boundaries as mentioned in section 4 2 the critical period minimum period and adequate period are important standards of spin up time for wrf model initialization and advancement in fig 7 these periods are illustrated as the temporal distance from three simulation start points critical minimum and adequate to the study event respectively in addition the temporal distance from the study event to the unsettled weather conditions period is defined as stu the relationships between stu and the three standard periods are classified in the four possible weather situations in fig 7 for example if an extreme precipitation event begins on october 2 at 10 00 while the unsettled weather conditions occur on october 1 at 08 00 the stu should be 26 h and if we assume that the example event occurs at the same location as the study event and use the same model configurations then the critical minimum and adequate spin up periods are 12 h 24 h and 48 h respectively since minimum period 24 h stu 26 h adequate period 48 h it is classified as situation 2 and the recommended spin up time is between 24 h to just prior to the disturbing event the four possible weather situations and different types of spin up time ranges are explained below situation 1 stu adequate period the proposed nested domains are ideal and can conduct wrf extreme precipitation simulation by a flexible spin up time the wrf model is recommended to start to spin up within the range between the minimum point and the adequate point green bar the spin up time closest to the minimum period is with the least desirable ability less recommended while the spin up time closest to the adequate period is with the most desirable ability more recommended for the spin up times beyond the adequate period yellow bar they are considered unnecessary because of the unnecessary computational cost on the contrary the spin up times less than the minimum period striped bar should be used cautiously as the atmospheric circulations may have not been developed thoroughly if so wrf users should check the precipitation spatial distribution of simulations with observations and pay more attention to adjusting the configuration situation 2 minimum period stu adequate period the proposed domains would be affected by unsettled weather conditions when using the adequate spin up time if times and conditions allow the spin up time is recommended to be larger than the minimum period and further extended to get the best performance green bar but not extended to the unsettled weather period the unsettled weather period red bar is definitively unrecommended for wrf initialization which will introduce a large number of initial inconsistencies and make the model hard to resolve the spin up time usage in the range of the striped bar in situation 2 is the same as in situation 1 situation 3 critical period stu minimum period the explanations for the left striped bar and red bar of situation 3 are similar to those above the spin up period is recommended to be as long as possible but not overlap with the unsettled weather period green bar because the unsettled weather period is close to the study event wrf can only complete rough adjustments during the critical spin up time the proposed domains are not very ideal and other model support methods would be required for instance users can use additional hydrometeor species as input parameters to help the model to achieve balance faster hwang et al 2019 alternatively users can also use a much longer spin up time that is beyond the stu i e the right striped bar such a way will allow the model to get stable ic and allow more time to balance later disturbance s introduction however using this cautiously because the simulations with very long spin up time may exhibit a certain level of freedom and chaotic behaviour that drift away from the forcing data alexandru et al 2009 if simulation performance is poor data assimilation and nudging would be support methods otherwise go back to step 1 to set new nested domains to avoid unsettled weather conditions and perform the above steps again situation 4 stu critical period the proposed domains are not suitable and simulation performance would be severely affected by the ic no recommended spin up time for situation 4 go back to step 1 to reduce or enlarge the domain size to avoid unsettled weather conditions near the boundaries and perform these steps again step 4 conducting the wrf simulations with the recommended spin up times observe whether simulated precipitation is accumulated reasonably or scatters toward the domain boundary as shown in fig 2 j l if scatters are present adjust other configurations in wrf such as vertical and grid resolution nesting ratio and physical parameterization scheme to refine the simulation 5 2 framework application to show the generalization ability of the proposed osti framework we have carried out simulations of three additional events around the mediterranean sea considering their simulation areas have the same geographical features and similar domain sizes as the alexandria study event the optimal spin up time is determined by the same three standard periods 12 h 24 h and 48 h found before besides because the most important part of the osti framework is to determine which situation the precipitation event belongs to the example events with different stus synoptic backgrounds precipitation distribution and intensity were chosen to demonstrate firstly a precipitation event that occurred over hurghada egypt on 26 27 october 2016 is an example of situation 1 example 1 in the osti framework based on the weather maps from the nasa worldview supporting files 3 and 4 the red sea and its surrounding area were calm windless and rainless for several days prior to example 1 this event happened over a narrow inland sea between the arabian peninsula and africa which has a relatively weak synoptic background than other events due to stu adequate period the most recommended spin up time would be 48 h and longer times are unnecessary for performance improvement fig 8 a c show the accumulated precipitations in two days from imerg observation wrf simulation with 48 h recommended spin up time also adequate period and wrf simulation with 60 h unnecessary spin up time respectively it can be found that the intensity of precipitation in the centre is stable and there is not much improvement even with a longer execution time for situation 2 in the osti framework the above study event over alexandria egypt is a good example the results of s1 experiments illustrate that wrf with the 40 h spin up time has the best performance while wrf simulations have poor performances when the disturbing weather includes in the ic fig 6 h following this an event that happened in antalya turkey on 28 december 2013 is an example of situation 3 example 2 the synoptic background of this event is relatively strong and we can see obvious strong wind and atmospheric circulation moving from the left side of the mediterranean sea to the right supporting files 5 in addition the disturbing precipitation during the spin up period is not heavy but exists close to the critical time of the example 2 event supporting files 6 in this case critical period stu minimum period the wrf simulations with 12 h recommended and 24 h unrecommended spin up times are conducted respectively it should be noted that there are certain ranges of recommended and unrecommended spin up times and 12 h and 24 h are selected only as demonstrations as demonstrated in fig 8 d f the precipitation distribution and intensity of recommended simulation are much better than the unrecommended when compared with imerg observation however situation 3 is the least frequent among all possible weather scenarios of wrf simulations because it requires that the disturbing precipitation occurring around the boundary is not too strong and ends before the critical period of the target event to ensure that the performance of the wrf simulation will not be greatly affected furthermore since the recommended spin up time of this type of precipitation event is less than the minimum period the simulation performance of these events will be more limited than others finally situation 4 of the osti framework is illustrated by taking the extreme precipitation event example 3 that occurred near beirut lebanon on 25 october 2015 as an example this event has the strongest weather background the largest scale and the highest precipitation intensity among all the events in this study supporting files 7 and 8 significant large scale atmospheric circulations occurred over the mediterranean sea and surrounding lands in this case based on the framework stu critical period it is hard to get satisfied simulations by using the original small domains and it is recommended to reset domain configurations as shown in fig 8 g i even though they were simulated with the same 48 h spin up time the simulations of the larger domain exhibited a significant improvement in reproducing the centre s extensive extreme precipitation and this improvement is difficult to achieve by changing the length of model spin up times in sum the osti framework can indeed help to decide the optimal spin time for wrf simulations before performing the simulations according to time ranges indicated by the osti framework the wrf precipitation results simulated by recommended unrecommended and unnecessary spin up times are basically in line with the expectations besides this framework is more useful for precipitation events with strong synoptic backgrounds because their simulation performances depend largely on the development of appropriate atmospheric circulations and physical equilibrium states in the model such as the alexandria study event antalya example 2 event and beirut example 3 event driven by the large scale movement of air together with ocean circulation the simulated precipitation intensity and distribution vary greatly under different initial conditions and spin up times in contrast the precipitation scale of hurghada example 1 event with a relatively weak synoptic background is small and shows less sensitivity to the spin up times than others 6 summary and conclusions this study focuses on exploring the relationship between the wrf model required spin up times and weather conditions in particular 21 3 level nested experiments and 21 2 level nested experiments for the extreme precipitation event that occurred on the 4 november 2015 in alexandria are conducted for comparative analysis firstly the simulated precipitation distributions of s1 experiments with unsettled weather conditions are compared to the s2 experiments with calm weather conditions these results are also analysed and linked to the time and location of disturbing precipitation then to quantify the wrf performances under different spin up times seven error metrics pod fbi csi far rmse mbe sd and an overall performance score topsis rcv are calculated to show the differences between s1 and s2 experiments finally the optimal spin up time identifying osti framework is proposed to help wrf users understand and choose a suitable spin up time for each precipitation event the application and verification of this framework are also presented by three other extreme precipitation events around the mediterranean sea the whole study aims to highlight the relationship between spin up times and weather conditions and give clear guidelines on how to determine optimal spin up time without too much trial and error testing by evaluating the results of the s1 and s2 experiments it is demonstrated that even simulated with the same spin on time the spatiotemporal and overall performance of wrf simulations varies greatly under the influence of different ic specifically the greatest differences of pod fbi csi and far are about 0 5 78 h spin up time c14 compared to c14 0 5 78 h spin up time c14 compared to c14 0 45 78 h spin up time c14 and c14 and 0 1 102 h spin up time c18 and c18 respectively moreover the rmse is improved by up to 70 5 and the overall performance score topsis rcv improves from about 0 375 to 0 732 at most the timing of these large differences in performance is all related to the timing of the italy extreme precipitation event occurring around the domain boundaries since the timing and location of complex weather are uncertain the optimal spin up time for wrf should vary by study event and domain configuration on the other hand other factors could also have contributed to the simulation performance of s1 being worse than s2 such as model internal variability which is well known to increase with domain size giorgi and bi 2000 alexandru et al 2007 but comparing the 21 s1 simulations with same domain configurations the model performance can change significantly in very short times which exceeds the level of internal model variability thus the main reason for the model performance degradation in the larger domain simulations with long spin up times should still be due to synoptic conditions overall the wrf spin up time should not be too short as it is hard to develop the appropriate atmospheric circulations but not the longer the better either because it depends on the quality of ic a solution for this problem is to avoid unsettled weather conditions by using observations as guidance radar satellite etc as well as determine the appropriate spin up time based on the critical period minimum period and adequate period for the study area by referring to previous literature carried out in the same areas of course there do exist some other methods for wrf to handle complex weather like large scale nudging but the nudging method also has some problems such as how to choose the nudging strength to preserve internal model variability and keep the error growth under control besides nudging could not yield perfect results because it is still unable to completely overcome the physical and dynamical deficiencies and inconsistencies in the wrf model bowden et al 2012 tang et al 2017 therefore in some cases users may consider adopting the proposed osti framework to avoid unnecessary adverse effects from complex weather conditions and improve modelling efficiency in this study the sensitivities of wrf simulations to spin up times and synoptic conditions are investigated and the framework that estimates the optimal spin up time through satellite observations is summarized however a limitation of this study is that it only investigated the effect of disturbing precipitation on simulation results in fact unsettled weather conditions can be of many kinds while precipitation is one of the easiest to identify in the future more weather elements such as humidity air temperature and pressure and wind speed could also be explored to see whether they are helpful for optimal spin up time identification in addition this study only considers the information provided by the observation data because this way is the easiest that users only need to browse the records on satellite websites but whether it is possible to obtain more information from the era5 reanalysis data and determine the optimal configuration has not been done in this study considering the study in this field is very limited and there are no clear guidelines we hope our study could provide a new idea to solve the lack of consensus on the choice of wrf spin up time moreover promote the establishment of wrf spin up time guidelines for the community users in summary the results of this study will provide a useful reference for future wrf applications in extreme precipitation simulations credit authorship contribution statement ying liu conceptualization methodology software validation formal analysis data curation writing original draft writing review editing visualization funding acquisition lu zhuo conceptualization supervision writing review editing dawei han conceptualization supervision writing review editing declaration of competing interest the authors declare the following financial interests personal relationships which may be considered as potential competing interests ying liu reports financial support was provided by china scholarship council acknowledgements the first author is grateful to the china scholarship council and the university of bristol for providing the joint scholarship csc no 201908310086 for her phd study at the university of bristol all authors acknowledge the dataset developers from nasa and ecmwf for producing and sharing the datasets employed in this study we would also like to acknowledge the advanced computing research centre at the university of bristol for providing access to the high performance computing system bluecrystal 
2052,using the reservoir model theory this study developed an equation for the relationship between the transfer and recession coefficients under a matrix restrained flow regime assuming darcy s law the proposed equation was developed based on conventional parameters of karst systems such as recession coefficient specific yield and catchment area firstly the equation was evaluated through forward and inverse modeling of an idealized karst system with modflow 2005 conduit flow process cfp and karstmod respectively then calibration of a karstmod and a cfp model of the baget karstic watershed in france was carried out to check the efficiency of the developed equation results of the first step showed that the optimal value of the transfer coefficient based on karstmod for the linear transfer flow is very close to the baseflow recession coefficient values therefore the transfer coefficient in karstmod may be considered as the recession coefficient from the matrix to the conduit compartment moreover substituting these two coefficients in the developed equation caused less than 10 errors in estimating the transfer coefficients assigned to the idealized models in cfp in addition adding the recession coefficient as prior information in the calibration process affects the recession coefficient of the simulated time series and provides a reliable evaluation of the internal dynamics of the system therefore the results of this research show that the recession coefficients can be used as an initial estimate of the transfer coefficient in the baseflow condition this achievement can significantly assist the discrete continuum model calibration and further support the water balance calculations based on the recession data keywords karst system transfer coefficient baseflow recession coefficient spring hydrograph matrix restrained flow regime data availability data will be made available on request 1 introduction karst systems constitute an important drinking water resource for approximately 9 2 of the world population stevanović 2019 distributed in all climate zones and continents goldscheider et al 2020 stevanović 2018 as a result of the dissolution of soluble rocks such as dolomite and limestone the preferential flow paths are formed in the matrix but the geometry and the location are difficult to handle therefore high heterogeneity and anisotropy in the hydraulic properties of karst systems lead to the possibility of a wide range of flow regimes from darcy flow in the matrix to turbulent flow in preferred flow paths burdon and papakis 1963 schuster and white 1971 atkinson 1977 ghasemizadeh et al 2012 generally the water pressure gradient between the preferential flow paths conduits and the matrix leads to the transfer flow white 2003 therefore the karst system as a natural system attempts to balance the system by the transfer flow between the preferred flow paths conduits and the matrix the flow between matrix and conduit is introduced as exchange flow in most studies but the authors of this article believe that exchange flow is a bidirectional flow in out at the same time and the special place of course transfer can occur in both directions but not simultaneously for the particular place therefore the concept of transfer flow between matrix and conduit is used in this article the transfer flow concept has been already used in the literature based on various hydrogeological issues e g bailly comte et al 2010 frank et al 2019 bauer et al 2003 hosseiny sohi et al 2018 assari and mohammadi 2017 hill 2008 moreover the transfer function has been already compared in term of performance in the modeling processes of the karst system hill 2008 reimann et al 2011 giese et al 2020 two modeling methods can be used to investigate the transfer flow between discrete karst conduits and the matrix continuum 1 discrete conduit continuum approaches representing distributed parameter models e g modflow 2005 conduit flow process mode 1 shoemaker et al 2008 reimann et al 2014 boyce et al 2020 this approach relies on the availability of information and spatial data concerning the discrete conduits and the matrix continuum therefore it is relatively difficult to implement in karst hydrogeology zhang et al 2017 martínez santos and andreu 2010 2 lumped parameter approaches are independent of the spatial distribution of the parameters accordingly the modeling process becomes easier scanlon et al 2003 this modeling method combines several transfer functions martínez santos and andreu 2010 which show the relationships between discharge and precipitation by compartments i e conceptual reservoirs chang et al 2017 zhang et al 2017 the karstmod modeling platform mazzilli et al 2019 developed by the french national observation services karst jourde et al 2018 can be considered for this purpose the amount of the transfer flow depends on a linear relationship between the transfer coefficient and the difference in hydraulic head between the matrix and the conduit barenblatt et al 1960 bauer et al 2003 in most numerical models the linear darcy flow equation was conventionally applied to quantify the transfer flow temporal fluctuations but zhao et al 2022 showed that the relationship of transfer flow with the square root of the hydraulic head differences constitutes a better fit than a linear relationship the transfer coefficient is representative of the lumped hydraulic and of the geometrical properties of the karst system that depends on the conduit geometry the transfer surface between the conduit and the matrix continuum and the hydraulic conductivity of the matrix bauer et al 2003 saller et al 2013 giese 2017 transfer coefficient is defined as a function of the matrix hydraulic conductivity conduit length and a dimensionless transfer factor reimann et al 2011 in distributed numerical models transfer flow and transfer coefficient are mainly influenced by the matrix coefficients spatial discretization reimann et al 2011 giese et al 2020 moreover the structure of the compartments was used to model the transfer flow in which the volume difference between the two compartments is used instead of the head difference according to this the transfer coefficient is defined in terms of days hartmann et al 2012 zhang et al 2017 following schmidt et al 2014 the transfer coefficient was defined as the product of the transfer surface atransfer m2 and the slope of the recession coefficient α d 1 although the prove of this equation has not been presented the slope of the recession curve is introduced as a component in the equation for calculating the transfer coefficient by schmidt et al 2014 shirafkan et al 2021 based on an idealized model with modflow 2005 conduit flow process cfp investigated the effect of the transfer coefficient on the slope of the recession curve they show that the recession curve is characterized by segments with steeper slopes α and a wider range of variations when the transfer coefficient increases according to the uncertainty and insufficient information about the geometry of conduits many characteristics of the karst system such as conduits network and transfer coefficient are still unknown and cannot be fully characterized by conventional methods previous studies on transfer coefficient identification gallegos et al 2013 saller et al 2013 mohammadi et al 2018 chang et al 2019 kavousi et al 2020 pacheco castro et al 2020 proposed a calibration based on cfp linked to pest model independent parameter estimation doherty 2004 ucode 2005 poeter et al 2008 or ucode 2014 poeter et al 2014 however as shown by pacheco castro et al 2020 the calibration of the transfer coefficient is not straightforward based on the limited knowledge of conduits and matrix continuum since the transfer flow constitutes an important component of the water balance in numerical models incorrect estimation of the transfer coefficient causes the inefficiency of numerical models in interpreting different hydrological studies of the karst system it has been shown in various studies that the recession coefficient of the hydrograph is a good tool for interpreting the internal dynamics of the system and calculating the balance components in karst systems raeisi 2008 kavousi and raeisi 2015 2016 therefore in this study we want to evaluate if the recession coefficient can be used to interpret the transfer coefficient this study presents a method to estimate the transfer coefficient in karst systems the main objectives include 1 evaluating the relationship between the transfer coefficient and the recession coefficient of the baseflow by developing an equation to highlight their relationship 2 assessing the reliability of the proposed equation by applying it in an idealized karst model and 3 applying the proposed equation as primary information in the calibration process of karstmod and cfp models in baget karst spring as the case study 2 material and methods 2 1 case study the baget karstic watershed located in the pyrenees mountains ariège france is characterized by a recharge area of about 13 2 km2 and a median elevation of about 940 m above sea level a s l fig 1 this karstic watershed belongs to the carbonate belt bordering the north of french pyrenees sivelle and labat 2019 its altitude ranges from 498 to 1417 m a s l and slopes are very steep ulloa cedamanos et al 2020 daily spring discharge is required for distributed modeling of the baget karstic watershed 2 1 1 water resources the lachein valley lies along the longitudinal axis of the watershed parallel to the limestone flysch contact in the upper valley the surface flow is established only during significant rainfall events and when the water level is high las hountas consists of the perennial spring of the baget karst system mangin 1975 genthon et al 2005 sivelle 2019 sivelle et al 2020 streams flowing on the flysch in the upper valley disappear at the contact of limestone formations recharging rainwater to the karst system genthon et al 2005 through sinkholes in the downstream valley ulloa cedamanos et al 2020 sinkholes and temporary resurgences in the downstream parts of the watershed are restrained area of around 1 km2 fig 1 sivelle et al 2020 labat and mangin 2015 in the baget karstic system voids consist of joints and open fractures as the main drainage system and dissolution caves as annexe drainage systems mangin 1975 marsaud 1997 the main drainage systems consist of the most transmissive part with short residence time while the annexe drainage systems include voids and caves connected to the main drainage system characterized by a much longer residence time although several caves were recognized and mapped whithin the baget karstic system such as caves of st catherine la peyrère genthon et al 2005 and part of the system between la peyrère p2 loss and moulo de jaur brehier 2019 personal communication the underground drainage system of the baget valley has not been completely explored finally it is worth noting that the possible direction of development and pathing of underground water lies in the direction of the river oriented east west sisavath et al 2004 also the watershed is subject to quick infiltration and rapid transit time between infiltration and outlet points sivelle at al 2019 2 2 analyzation of the recession curve in any given system such as an aquifer or stream individual recession segments recorded at different times may have different slopes depending on the variability in storage evapotranspiration and recharge rates posavec et al 2006 however it is possible to compile individual recessions into a single recession curve that provides an average characterization of heads flows or other observed variable responses and creates a structure called the master recession curve mrc posavec et al 2006 for this purpose the continuous time series is divided into short segments corresponding to individual recession events recession segments are sorted from the highest to the lowest value according to the initial value of each recession segment the sorting process is such that the absolute time of each part is converted into relative time by five equations which is equal to zero at the beginning of each part of the recession curve posavec et al 2006 in this study the recession analysis is performed according to mangin s method 1975 to calculate the volume of fast flow primarily through karstic conduits and baseflow mainly through the matrix continuum in the case study eq a 5 and a 6 in appendix a this method has been widely used to analyze the karst systems recession curves and propose a typology karst hydrodynamic behavior cinkus et al 2021 olarinoye et al 2022 2 3 numerical modeling tools 2 3 1 karstmod model karstmod mazzilli et al 2019 consists of an adjustable platform dedicated to daily and hourly lumped parameter rainfall discharge modeling of karst aquifers developed by the french sno karst jourde et al 2018 it is also used for analyzing the hydrodynamic characteristics of the compartments considered in the model based on the governing equations given in mazzilli et al 2019 and mazzilli et al 2022 the equation of the transfer flow between matrix and conduit compartments defined as follow 1 q mc k mc h m h c l ref α m c where kmc l t 1 is the specific discharge coefficient transfer coefficient hm and hc l are the water levels in the compartments m and c respectively lref l is a unit length and αmc is the positive exponent qmc l t 1 is defined as the algebraic flow from compartment m to compartment c per unit area the negative values of qmc mean that the current flow direction is from c to m karstmod has been successfully applied to reproduce matrix conduit transfers in various catchments sivelle et al 2019 duran et al 2020 frank 2020 labat et al 2022 sivelle et al 2022 2 3 2 cfp computational program modflow 2005 conduit flow process cfp mode 1 liedl et al 2003 shoemaker et al 2008 boyce et al 2020 computes groundwater movement in karst systems under consideration of darcy s law for laminar flow in the matrix continuum harbaugh 2005 and the darcy weisbach equation for laminar and turbulent flow in discrete conduits the discrete conduit network within the matrix continuum is defined as pipes characterized by diameter tortuosity roughness and a linear water transfer coefficient depending on the reynolds number the flow in the pipes can be either turbulent or laminar finally the conservation of volumetric flow is calculated according to kirchhoff s law for any node which connects several pipes this law expresses the sum of volumetric flows to nodes including pipe flows qip transfer flow qtransfer direct recharge qr and changes in storage qs the sum of these volumetric flows must be equal to zero the transfer flow between dissolution conduits and the matrix is calculated by a linear approach and based on the darcy law depending on the hydraulic head difference between the matrix and conduits barenblatt et al 1960 cfpv2 considers some additional modification to the flow subroutine in modflow 2005 cfp mode 1 for example the conduit associated drainable storage cads reimann et al 2014 and the limited head boundary condition lh reimann et al 2013 cads can be considered as the numerical representation of annex systems to drains asd in mangin s 1975 conceptual model lh boundary condition can be used to provide a limitation for the node head e g flooded sinkhole reimann et al 2013 for more information see the documentation by reimann et al 2013 2014 2 3 3 evaluation of the model performance the lumped parameter rainfall discharge model is calibrated using a quasi monte carlo procedure with a sobol sequence sampling of the parameter space mazzilli et al 2019 the best parameter sets for the model are those leading to the best objective function value here the objective function wobj for the calibration procedure consists of a weighted sum of the nash sutcliff efficiency nse nash and sutcliffe 1970 and balance error be perrin et al 2001 performance criteria such as wobj w nse 1 w be where w is the weight determined by the user w is chosen based on what combination of the different weights of these two criteria leads to the calibration of the time series with the largest highest objective function in addition w has been chosen according to past studies by various researchers in this regard baudement et al 2017 sivelle et al 2019 duran et al 2020 considering past studies a higher weight on the nse criteria is due to reproduce the highly dynamic behavior of the karst baudement et al 2017 the larger is the objective function higher nse and be the greater is the consistency between model and observations and the smaller is the model errors in addition to the objective function the kling gupta efficiency coefficient kge gupta et al 2009 was also calculated to further evaluate the model performance the calibration and estimation of the optimal parameter set in distributed parameter model of the baget karstic watershed is done based on the weighted least squares objective function in model independent parameter estimation pest code in fact the objective function is the sum of the squared residuals between the observations produced by the model and the experimental observations the smaller is this number referred to as the objective function the greater is the consistency between model and observations and the greater is our confidence that the parameter set determined on the basis of these observations is the correct doherty 2004 in addition the model performance is evaluated according to the various performance criteria nse be and kge 2 4 formulation of the transfer coefficient under various hydrological conditions three flow regimes may influence the recession curve of the spring hydrograph including 1 matrix restrained flow regime mrfr when the conduit network act similarly to a defined head boundary conditions and the drainage process is controlled by the matrix alone 2 conduit influenced flow regime cifr when the hydraulic gradient in the conduits is not negligible during the recession process and the recession process depends on the hydraulic parameters of matrix and conduit network kovács et al 2005 chang et al 2015 and 3 conduit flow regime cfr when the hydraulic head in the conduit is greater than the hydraulic head in the matrix bailly comte et al 2010 therefore the recession coefficient of the hydrograph is affected by the flow regimes kovács et al 2005 bailly comte et al 2010 shirafkan et al 2021 moreover karst spring displays a complex recession behavior including periods with linear and exponential recession coefficients one may be observed several different recession coefficients in the exponential period different recession coefficients are attributed to the variable hydraulic head and the stored groundwater volume in different compartments of the karst system i e matrix and conduits schmidt et al 2014 the baseflow recession can be influenced by mrfr or cifr kovács et al 2005 kováccs and perrochet 2008 since the matrix restrained flow regime mrfr is typical for highly karstified systems mature karst systems during baseflow periods kovács et al 2005 therefore in this study the recession coefficient equation defined by fiorillo 2011 based on the darcy reservoir model is used to find the relationship between the transfer coefficient and the recession coefficient related to mrfr fiorillo 2011 investigated the discharge from a linear reservoir based on darcy s law to simulate the real shape of the hydrograph of karst springs the used compartment is a cylinder with a base surface a1 l2 water filled to the height h0 l also drainage occurs through a pipe with hydraulic conductivity k lt 1 surface a2 l2 and length l l fig 2 considering fluid viscosity and friction forces the discharge at any time decreases exponentially with time and follows the maillet equation 1905 fiorillo 2011 defined the recession coefficient α t 1 eq 2 in maillet s equation eq a 2 in appendix a 2 α k l a 2 a 1 the darcy reservoir model introduced in fiorillo s study 2011 was only used with the approach of simulating the recession curve of the hydrograph and obtaining the equation of the recession coefficient eq 2 in the study of fiorillo 2011 the concept of transfer flow and coefficient had not been investigated but in this study it has been tried by an innovative method the darcy reservoir model and the recession coefficient equation eq 2 defined by fiorillo 2011 are used in order to find the relationship between the transfer coefficient defined by bauer et al 2003 and the recession coefficient related to mrfr for this purpose to create a different approach in using darcy s reservoir model in addition to the assumptions of fiorillo 2011 the change of the volume of compartment a1 and the characteristics of the pipe with hydraulic resistance affect the spring discharge should be added other a few assumptions as presented in fig 2 which includes the following another compartment with surface a3 is assumed to be in relation with the compartment of a1 through a pipe with hydraulic resistance and surface a2 it is assumed that transfer flow is unidirectional from the compartment with a1 area and hydraulic head varying with time to the compartment with a3 area and defined hydraulic head as it is in the baseflow conditions from the matrix to the conduit and the drainage process is controlled by the matrix alone mrfr therefore there is no violation in fiorillo s assumptions to calculate the transfer coefficient αtransfer l2t 1 the defined parameters in eq 4 l k and atransfer introduced by bauer et al 2003 can be considered equal to the characteristic of the hydraulic parameters of the pipe with hydraulic resistance e g l k and a2 fig 2 finally the proof of the relationship between the transfer coefficient and recession coefficient is presented by eqs 3 to 8 in this study eq 2 introduced by fiorillo 2011 based on the darcy reservoir model is rearranged to separate the ratio of k l as eq 3 combining the introduced formula by bauer et al 2003 with eq 3 provides an equation for αtransfer eq 5 3 k l α a 1 a 2 4 α transfer 1 l k a transfer b a u e r e t a l 2003 5 α transfer α a 1 a 2 a transfer a transfer a 2 in eq 5 a2 can be defined as the area of transfer i e atransfer therefore the ratio atransfer a2 becomes equal to unity and eq 5 is rearranged as eq 6 6 α transfer α a 1 in darcy reservoir model introduced by fiorillo 2011 is assumed that the catchment area of springs corresponds to the area occupied by water table and he considered a1 as the product of catchment area ac and the mean effective porosity n eff so here substituting of a1 ac n eff in eq 6 provides a clear relation between αtransfer and α 7 α transfer α a c n eff eq 7 shows the relationship between the transfer coefficient and the recession coefficient of the baseflow in the condition that the direction of the transfer flow is from the matrix to the conduit in this study the recession coefficient α is computed based on the spring hydrographs of idealized modeling or real case study however the transfer coefficient αtransfer is optimized by applying eqs 7 and 8 through modeling by karstmod and pest linked to cfp from two points of view the optimized transfer coefficient in karstmod kmc lref can be considered as the recession coefficient α of the baseflow in the mrfr including 1 the optimized transfer coefficient in the karstmod is conceptually defined as the discharge coefficient from the matrix compartment to the conduit compartment sivelle et al 2019 and 2 the dimension of both coefficients kmc lref and α is t 1 the relation between the optimized transfer coefficient in the karstmod kmc lref and the recession coefficient α of the baseflow is assessed by idealized modeling approach in the next sections as it is known eq 7 is based on the reservoir model which is a lumped parameter model and is defined for the total length of the conduits however the cfp model is a spatially distributed model that allows the individual definition of all parameters for each cell and node therefore the transfer coefficient αtransfer computed based on eq 7 should be modified by dividing by the number of conduit nodes to be applicable as the assigned transfer coefficient αtransfer in cfp eq 8 so that the corresponding transfer coefficient αtransfer is defined for each node 8 α transfer d i s t r i b u t e d l 2 t α transfer lumped the n u m b e r o f c o n d u i t n o d e s kmc lref 1 t o r α 1 t a c l 2 n eff o r s y the n u m b e r o f c o n d u i t n o d e s in this equation the transfer coefficient can be computed using the specific yield of the matrix instead of effective porosity the percentage of error of the estimated transfer coefficient and assigned to cfp is calculated according to eq 9 9 e r r o r estimated α transfer α transfer i n c f p α transfer i n c f p 100 in this study the relation between the recession coefficient of the baseflow and the transfer coefficient as defined by bauer et al 2003 and also used in modflow 2005 conduit flow process cfp is reformulated in order to find a reliable estimation of the transfer coefficient firstly an equation is developed to define the relation between the recession coefficient of the baseflow and the transfer coefficient then the reliability of the suggested equation is evaluated by two approaches including 1 idealized modeling fig 3 and 2 using a real case study fig 4 the idealized modeling approach using cfp and karstmod is planned to compare the optimized transfer coefficient to the recession coefficient of idealized spring hydrographs considering the suggested equation fig 3 the idealized modeling approach includes different steps 1 a number of hypothetical hydrographs are produced by cfp assigning different transfer coefficients 2 the recession coefficient of the baseflow associated with the produced hypothetical hydrographs and also the optimized transfer coefficient in karstmod by inverse modeling are substituted to in the developed equation to estimate the initial transfer coefficient assigned to cfp fig 3 in the second approach the modeling of the selected case study is done based on the real measured data e g the time series of the spring hydrograph as presented in fig 4 assessing the reliability of the suggested equation in the case study include two main steps fig 4 including 1 comparing the optimized transfer coefficient by the lumped modeling approach i e karstmod code to the baseflow coefficient of the studied spring obtained using master recession curve and 2 comparing the estimated baseflow coefficient by linking pest to the distributed modeling approach i e cfp to the studied spring in the case study it was attempted to investigate the effect of applying the developed equation on the calibration process of the spring hydrograph 3 model representations 3 1 forward idealized modeling using cfp a series of spring hydrographs were produced to evaluate the relationship between the transfer coefficient and the recession coefficient assuming an idealized karst aquifer the dimensions and geometry of the idealized model are analogous to the characteristics of hypothetical models used in previous research bauer et al 2003 reimann et al 2011 chang et al 2015 dufoyer et al 2019 shirafkan et al 2021 the idealized karst aquifer is conceptualized as a single unconfined layer with a thickness of 100 m an area of 1 096 500 m2 and 562 active cells the finite difference cell size of the aquifer is set to a constant of 50 50 m2 except for seven rows adjacent to the conduit where the width of rows decreases from 50 to 35 25 10 and 5 m respectively values of 1 10 3 and 8 64 10 2 md 1 are assigned to the specific yield and the hydraulic conductivity respectively the karst conduit is located at an elevation of 10 m and is divided into 33 straight pipes further the karst conduit is assumed as fully saturated the discharge point of the model at the model s boundary last node is defined by a first type boundary condition defined head with a head value of 20 m the characteristics of the karst conduit including tortuosity coefficient and roughness coefficient are set with constant values of 1 and 0 01 m respectively the different values are assigned to the transfer coefficient 8 64 10 1 4 752 10 1 8 64 10 2 4 752 10 2 and 8 64 10 3 m2d 1 a value of 5 m is assigned to the diameter of the karst conduit to minimize the effect of the hydraulic gradient throughout the karst conduit defined head conditions for a wide range of changes in the transfer coefficient and establishing a matrix restrained flow regime moreover 20 rainfall events are considered under gaussian distribution to simulate diffuse recharge the whole simulation period of the model and the time step were set to 10 years and one day respectively assuming that the spring discharge is mainly affected by the direction of transfer flow from the matrix to the conduit under mrfr conditions therefore the main recharge act as diffuse recharge including about 99 9 the recession curve s duration is considered long enough to evaluate the characteristics of the aquifer especially the transfer coefficient 3 2 site specific model of the baget karstic watershed using cfp 3 2 1 conceptual model the baget karstic watershed includes large and independent resurgences with an average volume of about 60 000 m3 marsaud 1997 these resurgences include la peyrère resurgence a in figs 1 and 5 p2 loss resurgence b in figs 1 and 5 la hillière resurgence c in figs 1 and 5 and moulo de jaur resurgence d in figs 1 and 5 that are located at a distance of 840 777 692 and 511 m from the permanent spring respectively sivelle 2019 la peyrère resurgence is considered a tilted cylinder with a slope of 30 degrees and a diameter of 5 m genthon 2005 fig 5 in low water conditions the piezometric surface in the la peyrère resurgence is located 3 m higher than the outlet therefore it seems that most of the resurgence is located below the outlet level marsaud 1997 also speleological investigations and tracing tests showed that resurgences are connected to the main drainage system that goes to the spring sivelle 2019 during high flow conditions the water flow in the lachein river in the upstream part of the watershed sinks in p2 loss and la peyrère and then overflows in moulo de jaur and la hillière and subsequently flows on the surface towards the permanent spring finally it is measured at station b1 which is located 100 m from the spring fig 1 in contrast during low flow conditions the overflow process will not continue sivelle 2019 surface runoff is lost at different levels according to the importance of the floods and the performance of resurgence can be inverted in terms of loss and overflow mangin 1975 mangin 1975 explains the function of the overflow in the baget karstic watershed in this way when a flow in a pipe is suddenly stopped the kinetic energy of the liquid is removed this kinetic energy is converted into potential energy of the pressure an additional pressure or overpressure produces a shock wave which is named water hammer when an outlet is upward and presents a strong head loss then water can be violently expelled then this rising gallery acts as an equilibrium chimney the water level in them is higher than the karst piezometric levels due to the phenomenon of water hammer this phenomenon can be observed in the baget karstic watershed sivelle 2019 based on geophysical studies showed that the moulo de jaur overflow can be considered as evidence for the saturation state of the underground drainage network if the overflow is active the system can be considered as saturated and conversely when the overflow is no longer active the drainage network is no longer considered as saturated with water so that moulo de jaur as a temporary resurgence can still be active in intermediate conditions when hillière is not necessarily active and there is no surface flow in the lachain river the upstream of moulo de jaur then when the water level in it decreases moulo de jaur is deactivated progressively at first the water level is not enough for the water going out of the moulo de jaur but it is saturated finally when the water level decreases it will no longer be saturated and flow is underground towards the permanent spring las hountas 3 2 2 numerical model in cfp in order to develop the numerical model fig 5 the baget karst system is comprised by two formations 1 limestone and 2 flysch which is considered as impermeable layer therefore the limestone formation is considered as active cells 2670 active cells with an area of about 9 6 km2 and the rest of the cells are considered inactive the width of both columns δx and rows δy was set to 60 m the baget aquifer is considered as a convertible layer with impermeable boundaries neumann type no flow at the la peyrère the depth reached by the karstification exceeds 50 m below the level of the spring however based on geological data the probability of exceeding the depth of 100 m is low marsaud 1997 therefore the thickness of the karst aquifer is considered up to 100 m below the spring level information related to the conduit network was only captured for the area of 1 km2 of the watershed and there is no information for the rest of the watershed therefore in areas where there is no information a hypothetical and horizontal conduit can be considered along the longitudinal axis of the watershed and the river path in the area of 1 km2 two groups of conduits can be recognized which include 1 the real path of the cave brehier 2019 personal communication which is red colored fig 5 2 parts of the conduits that were extracted by inverse modeling and based on the artificial tracer tests sivelle et al 2020 which were marked with black color sivelle et al 2020 determined potential conduit geometry by simulation of the flow and transport using storm water management model swmm gironás et al 2010 which was considered no lateral transfers according to fig 5 there are five points of losses and temporary resurgences points a b c d and e in the watershed the runoff can be lost in losses of the points a and b losses of la peyrère and p2 loss respectively with the entrance elevation of 560 and 516 m respectively points c and d la hillière and moulo de jaur are overflow springs with an entrance elevation of 520 m and 507 m and point e is a permanent spring of las hountas with an elevation of 498 m in the baget karstic watershed the water storage in the form of snow is limited and snowmelt has no significant influence on the spring discharge ulloa cedamanos et al 2020 the lachein river flows as a sinking river along the interface between limestone and flysch formations towards the underground karst system therefore the contribution of surface runoff is mainly assumed to act as concentrated point recharge to make a proper modeling of the baget karstic watershed scenarios with different characteristics regarding recharge and discharge were tested finally based on the results a scenario was selected in which the percentage of the concentrated and the diffused recharge was calculated through the master recession curve see table a 2 in appendix a and applied to the numerical model based on eqs 10 and 11 in each time step the total amount of recharge m3d 1 is obtained from the product of the net recharge rate md 1 in each time step by the total area of recharge m2 the recharge area is considered 18 22 km2 based on the water balance equation and considering potential evapotranspiration 10 rch total r e c h a r g e i n e a c h t i m e s t e p q u i c k f l o w area o f c e l l s c o n t a i n e d b y c o n d u i t 11 uzf total r e c h a r g e i n e a c h t i m e s t e p b a s e f l o w area o f a c t i v e c e l l s o r a r e a o f l i m e s t o n e f o r m a t i o n according to eq 10 the amount of concentrated recharge rate is obtained for each time step then this rate is introduced to the numerical model at points a and b losses of la peyrère and p2 loss respectively by diffuse matrix recharge in modflow 2005 rch package the concentrated recharge component is defined for two points a and b losses of la peyrère and p2 loss respectively by cads rch within the crch2 functionality of cfpv2 reimann et al 2013 cads rch indicates direct recharge to the cads whereas cads was presumed to be located beneath the conduit system part 1 real path of the cave and part 2 conduits that were extracted by inverse modeling by sivelle et al 2020 accordingly the width of the cads in part 1 wcads1 is considered larger than the width of the cads in part 2 wcads2 due to the existence of caves in part 1 the cads rch recharge fraction reimann et al 2013 can vary between 0 and 1 and affects the assigned areal matrix recharge through rch in modflow 2005 the cads rch fraction of 1 i e diversion of all areal matrix recharge from rch to cads rch is assigned for sinking rivers and concentrated recharge according to eq 11 the diffused recharge rate is obtained for each time step then these rates are introduced to the numerical model at the active cells i e karstified formation by the unsaturated zone flow uzf functionality of modflow 2005 niswonger et al 2006 uzf reflects unsaturated zone hydraulics by a 1d kinematic wave approach of richards equation and accounts for process based infiltration passing through the unsaturated zone uzf assumes uniform unsaturated hydraulic properties for each vertical column on top of the respective model cells for more information see niswonger et al 2006 a limited head lh boundary condition and a defined head boundary for the outflow of the baget karstic watershed were considered for the springs in the numerical model in the baget karstic watershed overflow springs may appear in different places under different conditions of the flow regime but points c and d la hillière and moulo de jaur are mainly introduced as overflow springs with an entrance elevation of 520 m and 507 m but running different models by cfpv2 it is understandable that because there is a hydraulic connection between the points c and d la hillière and moulo de jaur in the numerical model and the entrance elevation of the point d is less than it in the point c therefore the hydraulic head in point of c does not reach the desired elevation 520 m due to the outflow from the point d accordinlgy only point d moulo de jaur is applied to the numerical model as the overflow spring and boundary conditions lh also point e las hountas with an elevation of 498 m is introduced to the model as a permanent spring with a defined head boundary condition in general fourteen parameters are calibrated by pest whereas the following nine parameters are considered for the conduits hypothetical conduit diameter dc1 cave diameter dc2 diameter of the conduit according to sivelle et al 2020 dc3 conduit tortuosity τc mean roughness height of conduit walls kc transfer coefficient αtransfer width of conduit associated drainable storage wcads1 and wcads2 over flow node lh boundary another three parameters are considered for matrix continuum matrix hydraulic conductivity k storage coefficient ss matrix specific yield sy and two parameters are considered for unsaturated zone saturated vertical hydraulic conductivity of unsaturated zone vks and saturated water content of the unsaturated zone thts 3 3 inverse idealized and realistic modeling by karstmod model the required information for modeling by karstmod includes the time series of discharge precipitation evapotranspiration and the catchment area drained by the main spring the following assumptions should be considered for the reliable estimate of the transfer coefficient by karstmod sivelle et al 2019 in order to make a correct estimate of the transfer coefficient a suitable conceptual structure should be created in karstmod for the aquifer with no flow boundary and one main spring it seems that the only suitable structure that can estimate the transfer coefficient properly is as shown in fig 6 to avoid initialisation bias in the lumped parameter model calibration the warmup period is set over to 2 years based on the periods given in sivelle et al 2019 karstmod is run for of both the idealized and the realistic karst aquifers using the model structure presented in the fig 6 the objective function consists of the weighted sum of nse and be such as wobj 0 7 nse 0 3 be the parameter estimation procedure is set up to identify the parameter set providing a minimal wobj value of 0 6 according to the time series obtained using the idealized karst aquifer the warm up the calibration and the evaluation periods were set to 1400 1100 and 1150 days respectively finally the transfer coefficient is calibrated and optimized according to observed time series of the spring discharge produced by the idealized modeling using cfp for real karst aquifer the baget karstic watershed the warm up period is about 1005 days from january 1968 to september 1970 the calibration period is about 3653 days from october 1970 to september 1980 and the evaluation period is about 13239 days from october 1980 to december 2016 4 results and discussions 4 1 forward and inverse idealized models 4 1 1 estimation of transfer coefficient based on idealized model hydrographs different values of the transfer coefficient e g 8 64 10 1 4 752 10 1 8 64 10 2 4 752 10 2 and 8 64 10 3 m2d 1 were assigned to the idealized karst model to produce different spring hydrographs fig 7 the area of the idealized aquifer the specific yield or effective porosity and the number of nodes of conduit are the same with the values of 1 096 500 m2 1 10 3 and 34 respectively for all runs of cfp given the spring hydrographs fig 7 the recession coefficient of the baseflow is used to estimate the value of the transfer coefficient based on eq 8 a small error is an evidence and proof of eq 8 as the relationship between the recession coefficient of the baseflow under mrfr conditions and the transfer coefficient table 1 according to table 1 although error of estimation of the transfer coefficient based on eq 8 in idealized spring hydrographs assuming the transfer coefficients of 4 752 10 1 and 8 64 10 1 m2d 1 are more than 10 other spring hydrographs e g assuming transfer coefficients of 8 64 10 2 4 752 10 2 and 8 64 10 3 m2d 1 show small error according to the cfp results fig 8 it is clear that by assigning larger transfer coefficients e g 4 752 10 1 and 8 64 10 1 m2d 1 the influence of the hydraulic head difference between the matrix and the conduit hm hc is diminished because the karst conduit no longer acted as fixed head in this condition the flow regime changed to cifr and the drainage of the matrix is affected by karst conduit eq 8 was developed by assuming mrfr condition in which karst conduit act as fixed head therefore allocating large values of the transfer flow to the idealized karst aquifer of interest caused increasing of error in estimation of the transfer coefficient based on eq 8 due to changing the flow regime from mrfr to cifr therefore it can be noted that similar to recession coefficient the transfer coefficient is also affected by the flow regime accordingly the relationship between them modify by changing the flow regime 4 1 2 estimation of the transfer coefficient in the idealized model by karstmod time series of spring discharge from the idealized aquifer are introduced as observed time series for calibrating the lumped idealized model using karstmod the results are given in fig 9 and table 2 according to fig 9 the calibration process is performed for all transfer coefficients with a wobj of more than 0 9 also in the graph of the transfer coefficient against the objective function kmc vs wobj it is shown that the transfer coefficients were well calibrated so that the curve is bell shaped or a straight line shaped as well as the optimized value of the transfer coefficient shows the maximum of the objective function table 2 compare the value of the transfer coefficient allocated to cfp and the optimized transfer coefficient by karstmod in the eq 8 the results of table 2 show that error for transfer coefficients of 4 752 10 1 and 8 64 10 1 18 56 and 32 80 respectively is more than other the transfer coefficients as explained in section 4 1 1 the estimation error is small under the mrfr condition when the transfer coefficient assumed less than 4 752 10 1 m2d 1 in the idealized models however increasing the transfer coefficient caused changing the flow regime to cifr and increasing the estimation error table 2 the small error is interpreted as an evidence and proof of the proposed eq 8 suggesting the relationship between the recession coefficient of the baseflow under mrfr conditions and the transfer coefficient table 2 in short assigning large values of the transfer coefficient to the idealized karst model e g 4 752 10 1 and 8 64 10 1 m2d 1 leads to the diminish of the hydraulic head difference between the matrix and the conduit hm hc therefore the drainage process is dependent on the entire aquifer matrix and conduit these conditions approach the flow regime conditions defined by kovács et al 2005 as cifr they introduced this flow regime for fissured systems or weakly karstified systems i e early karst systems during baseflow also assigning small values of the transfer coefficient to the idealized karst model e g 8 64 10 2 4 752 10 2 and 864 10 3 m2d 1 the hydraulic head difference between the matrix and the conduit hm hc is increased so that the drainage process is controlled by matrix alone and conduit do not longer influence the drainage of the matrix conduit behave as defined head boundary conditions these conditions approach the flow regime conditions defined by kovács et al 2005 as mrfr they introduced this flow regime for highly karstified systems i e mature karst systems during baseflow according to the results tables 1 and 2 values of kmc lref d 1 are similar to the recession coefficients of the baseflow for each idealized spring hydrograph assuming different transfer coefficients it seems that kmc lref d 1 is a reliable indication of the recession coefficient that shows the flow discharge from compartment m matrix to c conduit therefore for aquifers with impermeable boundaries and a main spring i e like the assumed idealized karst aquifer the most ideal condition for the estimation of the transfer coefficient is the low flow conditions when the duration of the recession curve is sufficiently long 4 2 inverse realistic models as results of the idealized modeling revealed a reliable relationship i e eq 8 was suggested between the transfer coefficient and the slope of the recession curve of the baseflow based on the study of kovács et al 2005 matrix restrained flow regime mrfr is typical for highly karstified systems i e mature karst systems during baseflow periods available data elucidated that the baget karstic system is highly karstified and it is expected the baseflow recession curve is mainly influenced by mrfr therefore the assumptions of the proposed eq 8 are probably consistent with this case study despite some limitations the proposed equation has been developed in the condition that the transfer flow direction is from the matrix to the conduits and its use can be limited by reversing the transfer flow direction from conduits to matrix but according to the following explanations the developed equation can be used for a long term time scale e g daily in the baget karstic system as shirafkan et al 2021 showed that the transfer flow process from the conduit to the matrix occurred in a short period and over a restricted part of the conduit flow regime cfr when the concentrated recharge is increased conversely the transfer flow from the matrix to the conduit occurs as a long term process therefore the study of the transfer flow from conduit to the matrix in detail it should be investigated in short term scales and in most cases it is difficult to track and investigate this process in long term scales to study the relationship between the transfer coefficient and the recession coefficient under the conditions of matrix restrained flow regime mrfr long term time scales are required to complete the recession curve so that it is attained a correct estimate of the recession coefficient the purpose of this study is to develop the relationship between the transfer coefficient and the recession coefficient of the hydrograph therefore the transfer flow must participate in the discharge of the spring so that the relationship between these two coefficients can be shown when the direction of the transfer flow is from the conduit to the matrix the discharge of the spring is provided purely from the recharged water to the conduit and the transfer flow does not supply the water of the spring in this condition so it is not possible to develop a relationship between the recession coefficient and the transfer coefficient therefore the calculation of the transfer coefficient in these conditions still needs more research work whether or not the relationship between the transfer flow and head difference between the conduit and matrix is linear this topic requires more detailed research and can be suggested as an open question for further research in short it can be assumed that possible errors due to short term period of transfer flow from the conduit to the matrix can be ignored in calibration process in which is applied baseflow information in the long term time series moreover in this study the transfer coefficient is assumed to be constant throughout the simulation time as well as a linear relationship is assumed between the transfer flow and the hydraulic head difference based on this finding applying the coefficient of baseflow recession curve as a prior data is investigated in the process of calibration of the baget spring data by karstmod and cfp as well as its effect on the recession coefficient of the simulated time series is discussed 4 2 1 analysis of the recession curve based on the baget spring hydrographs according to the daily time series of discharge and rainfall from 1968 to 2016 for the baget karstic watershed it can be seen that the rainfall is consecutive and the recession curve of the baseflow is not completely formed therefore it is not ideal for estimating the transfer coefficient in the low flow conditions in such a situation the master recession curve can be used to calculate the recession coefficient of the baseflow in this research the master recession curve was created by the spreadsheet file mrctools v4 0 xlsm developed by posavec et al 2006 then by selecting the master recession curve separation option posavec et al 2010 the curve is automatically divided into parts with different slopes by the exponential equation finally the master recession curve is analyzed based on mangin s method 1975 fig 10 and table a 1 in appendix a using fig 10 the characteristics of the master recession curve that are shown in table a 1 appendix a are extracted and also i and ɛ calculated using eq a 4 in appendix a according to the value of i it is clear that the baget karstic watershed is mainly affected by rapid infiltration or concentrated recharge padilla et al 1994 showed that the importance of the unsaturated zone in response to the spring for the mayor spring with a value of ɛ equal to 8 44 10 2 d 1 was greater than that of aliou spring with a value of ɛ equal to 2 63 d 1 due to the slower circulation rate of flow in mayer spring therefore the importance of the unsaturated zone in response to the baget spring can be between the above two springs considering the value of 0 70 d 1 for ɛ according to table a 2 in appendix a it shows that about 68 and 32 of the recharge to the baget spring is drained during the quickflow and the baseflow respectively also the recession coefficient of the baseflow which is an important parameter in calculating the transfer coefficient is 2 86 10 2 d 1 4 2 2 application of baseflow recession curve information in the baget spring calibration process by karstmod considering the similarity of two coefficients kmc lref t 1 a n d α t 1 the process of calibration and estimation of transfer coefficient by karstmod can be improved according to initial information of α obtained from the recession curve of the spring hydrograph therefore before calibration of the model of the case study by karstmod it is highly recommended to pay attention to the following restrictions to choose the reliable range of parameters the first second and third hints are related to the recession curve and the fourth case is related to the water balance equation under baseflow conditions the direction of the transfer flow is from the matrix to the conduit which is known as the baseflow therefore the parameters space must be selected in such a way that the ratio of baseflow to total flow qbaseflow qtotal or in other words the ratio of qmc qtotal according to table a 2 in appendix a is 32 parameters space in karstmod should be set in such a way that the value of the optimized transfer coefficient in karstmod kmc is close to the recession coefficient of the baseflow i e the value of 2 86 10 2 d 1 the recession coefficient of the baseflow obtained from the simulated time series should be close to the observed time series since there is no surface or sub surface outflow through the boundaries of the watershed and all the outflow of the karst system is measured at station b1 sivelle 2019 therefore the effective area of the recharge is calculated as 18 22 km2 for 47 years from 1969 to 2016 based on the water balance rules and potential evapotranspiration eq 12 12 q spring a p i where a is the effective area of the recharge of the spring p is the annual precipitation and i is the infiltration percentage corresponding wobj and following the restrictions mentioned above the results and optimal values are shown in fig 11 supplementary table s1 and table 3 for the optimal values of the set of parameters the values of the objective function were attained 0 68 and 0 64 for the calibration and evaluation periods respectively table 3 the observed and the simulated time series of the discharge related to the spring of the baget karstic watershed las hountas spring as well as the changes of the transfer flow vs time are shown in fig 11 a as transfer flow from the conduit to the matrix occurred in a short period and over a restricted part of the conduit flow regime cfr shirafkan et al 2021 therefore considering fig 11a in the daily time scale for most of the time the direction of the transfer flow was positive flow direction from the matrix to the conduit that is known as baseflow increasing the recharge one can be seen peak in the discharge flow as a result it is observed decreasing the transfer flow from the matrix to the conduit baseflow and even the reverse flow fig 11 a the value of the recession coefficient of the baseflow based on master recession curve of the simulated time series fig 11 b is equal to 3 41 10 2 d 1 which is shown an acceptable error 19 compared to the value of the recession coefficient of the baseflow associated with the observed time series α3 2 86 10 2 d 1 the results show that by applying the recession curve information to the calibration process by karstmod it can be estimated a reliable estimate of the transfer coefficient and internal dynamics of the system so that the optimized transfer coefficient by karstmod is equal to 2 5 10 2 d 1 which is close to the recession coefficient of the baseflow related to master recession curve of the observed time series α3 2 86 10 2 d 1 and simulated α3 3 41 10 2 d 1 also the effective area of the recharge the ratio of the transfer flow from the matrix to the conduit baseflow to the total flow discharged by the spring qmc qcs and the ratio of the flow from the non linear compartment to the total discharge flow qec qcs are estimated respectively 19 2 km2 30 and 70 4 2 3 application of base flow recession curve information in the baget spring calibration process by cfp eq 8 is rearranged to calculate the ratio of αtransfer sy based on available kmc lref t 1 computed by karstmod or α t 1 computed by mrc the αtransfer sy ratio is applied to the calibration process of the baget spring model using cfp linked to pest the effect of two conditions including with and without the application of the αtransfer sy ratio as primary information in the calibration process are assessed with the slope of the baseflow recession curve of the simulated time series of the baget spring numerical model was calibrated by the pest code once without applying the ratio αtransfer sy condition a and once by applying it condition b and the results were analyzed the results of conditions a and b are shown in fig 12 supplementary table s2 and table 4 comparing of two assumed conditions for the baget spring i e without and with applying of αtransfer sy ratio under condition a and b respectively revealed that the αtransfer sy ratio affects the value of α3 in the condition b where this ratio is applied the value of α3 is somewhat closer to the real value and is equal to 3 6 10 2 d 1 table 4 however in the condition a where the ratio αtransfer sy is not applied the value of α3 is equal to 6 28 10 2 d 1 table 4 therefore in the case study it is also proven that the slope of the baseflow recession curve provides appropriate information regarding the transfer coefficient in this study the recession coefficient of the baseflow α3 is obtained based on the master recession curve separation assuming discharge thresholds of 0 4 and 0 9 m3s 1 as the lower and upper limits in which the overflow and high flows are activated in the baget karstic watershed according to supplementary table s2 and in the conditions a i e without applying the αtransfer sy ratio the optimal value of the transfer coefficient is 1 46 10 4 m2s 1 unlike observed time series the simulated baseflow has a lot of fluctuations so that the value of α3 is estimated 6 28 10 2 d 1 and other measurement criteria including kge nse and be are with values of 0 525 0 466 and 0 99 however in condition b by applying the αtransfer sy ratio the specific yield and the transfer coefficient values are optimized as a supervised optimization with values of 1 99 10 3 and 4 40 10 5 m2s 1 respectively although in condition b the baseflow has fluctuations α3 is optimized in a value of 3 6 10 2 d 1 that is somewhat closer to the real value of 2 86 10 2 d 1 calculated by master recession curve however in condition b the other criteria are kge nse and be with the values of 0 459 0 4405 and 0 99 respectively which are slightly lower than the criteria in condition a in addition to the value of α3 in the baseflow conditions the shape of the recession curve fig 10 can also provide information about the transfer coefficient as it was shown in the study conducted by shirafken et al 2021 in the conditions in which concentrated recharge is important in a karst system as well as the transmissivity coefficient and transfer coefficient are large enough the inflection point is located before a non arc region and the majority the discharge time series follows one alpha slope mode iii in shirafkan et al 2021 therefore the similarity of the recession curve of the hydrograph of the baget karstic watershed to mode iii in shirafken et al s study 2021 and the importance of concentrated recharge in the watershed show that the transfer coefficient and hydraulic conductivity of the matrix can be large enough for the aquifer the transfer coefficient values in conditions a and b are 1 46 10 4 and 4 4 10 5 m2s 1 respectively and the hydraulic conductivity values in conditions a and b are 4 27 10 4 and 3 58 10 4 ms 1 respectively in the calibration of the baget spring model performed by karstmod and pest high flow and low flow of the spring discharge in the baget karstic watershed were not properly simulated according to mangin s definition 1975 of the phenomenon of water hammer and equilibrium chimney in the baget karstic watershed it can be concluded that conduit reservoirs play an important role in the discharge of baget spring in low flow conditions most of the recharge water entering the baget karst watershed is stored in reservoirs and the role of storativity becomes important and as a result it increases the water pressure in the reservoirs following the subsequent recharges in high flow conditions water pressure increases and causes discharge points in the form of overflow springs the weak simulation of low flow and high flow conditions may be due to the lack of ability in the storativity process in baseflow conditions which most of the recharge goes to the spring as a result the increase of the pressure in the reservoirs will not be significant therefore high flow conditions i e peak discharges of the baget spring are not well simulated in addition mangin 1975 stated that the overflow does not act in the same way at the beginning and end of a given cycle and its rate increases at the end of the cycle so during flood overflows at the end of the cycle is faster developed than them at the beginning of the cycle because of the saturation of underground reservoirs therefore due to the lack of proper storativity the saturation of interest cannot be created accordingly high flow discharge is not simulated at spring also according to the pumping tests and geochemical and biological observations in the study of marsaud 1997 it is shown that as a result of successive pumping waters are requested from the karst system that have a longer residence time and do not participate much in the flow towards the spring this fact shows that these waters were taken from reservoirs according to the fluctuation of simulated spring discharge hydrographs under low flow conditions it can be concluded that water poorly stored and remained in the aquifer accordingly most of the recharged water is directly moved towards the spring it seems that the lack of adequate data for preparing conceptual model of the study area and or computational issues of the selected numerical model e g cfp caused unsuccessful simulation of time series of the baget spring discharge although simulation of low flow and high flow discharge at the baget karstic watershed has failed it requires more investigations based on accessing to sufficient data the weakness of numerical models to simulate baseflow has been emphasized by jeannin et al 2021 they showed that a significant part of the poorly forecasted values corresponded to base flow and this shows that modelling approaches and criteria for the calibration are too oriented towards peak flow sections of the hydrographs although in the current study the baseflow is not simulated well in different scenarios and has many fluctuations compared to the observed time series it is observed that by applying the αtransfe sy ratio based on the suggested eq 8 the recession coefficient of the simulated baseflow is somewhat closer to observed values in comparison to scenarios where this ratio is not applied 5 conclusions the estimation of the transfer coefficient under field conditions based on conventional methods is a complex and almost impossible task the main goal of this research is to obtain an indirect and simple method for estimating the transfer coefficient in a matrix restrained flow regime the transfer flow direction is from the matrix to the conduit and finally towards the spring so the transfer flow can be traced as the baseflow therefore a reliable relationship between the slope of the recession curve in the baseflow conditions and the transfer coefficient is expected in this study based on the reservoir model an equation is suggested for this relationship the suggested equation was evaluated and tested with cfp and karstmod for idealized models with varying transfer coefficients the results of the idealized models proved the efficiency of the suggested relationship in matrix restrained flow regime moreover results of inverse modeling by karstmod for the idealized models revealed that the optimized value of the transfer coefficient i e the linear transfer flow in karstmod is similar to the slope of the recession curve in the baseflow conditions therefore it can be considered equivalent to the recession coefficient of the baseflow results based on the baget karst spring as a real case study confirmed that the value of the transfer coefficient optimized by karstmod is equivalent to the recession coefficient of the baseflow furthermore the effect of the suggested equation on the slope of the baseflow recession curve of the simulated time series is highlighted by applying this relationship as prior information to calibration process of the cfp linked to pest code for the studied karst system therefore it is recommended to use the equation developed in this study and considering its results for a reliable estimation of the transfer coefficient in other studies of course estimation of transfer flow needs more research and developing other relationships especially in conduit influenced flow regime cifr and conduit flow regime cfr conditions as well as laboratory studies on the scale of laboratory models and efforts to measure the transfer coefficient credit authorship contribution statement malihe shirafkan conceptualization methodology software writing original draft zargham mohammadi supervision conceptualization methodology writing review editing alireza kavousi software validation methodology vianney sivelle visualization conceptualization methodology data curation david labat conceptualization writing review editing thomas reimann investigation writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the first and second authors would like to acknowledge the support from the iran national science foundation insf grant number 98004972 and shiraz university alireza kavousi and thomas reimann were supported by the deutsche forschungsgemeinschaft dfg for the ikarst project grant numbers li727 31 1 re4001 2 1 the authors would like to thank the french national observation services karst http sokarst org initiative at the insu cnrs which aims to strengthen the dissemination of knowledge and promotes cross disciplinary research on karst systems at the national scale for their support of the use of the karstmod model the authors would thank the associate editor and two anonymous reviewers for their constructive comments and suggestions which made a considerable improvement in this paper appendix a the calculation of the baseflow and the quick flow volume according to mangin s method 1975 the total discharge of the spring qspring at any time t during the recession curve of the hydrograph of the spring is defined by the following equation a 1 q spring φ t ψ t the first part of the equation φt is related to the saturated zone discharge under baseflow conditions and is defined by the maillet equation 1905 a 2 φ t q 0 e α t where q0 l3t 1 and φt are discharge at the initial time and time t and α t 1 is the recession coefficient of the baseflow the second part of eq a 1 is the infiltration function which translates the effects of surface recharge to the spring through the unsaturated zone somewhat modified by its passage through the saturated zone padilla et al 1994 the infiltration function is defined by an empirical function as follows a 3 where ψt l3t 1 indicates the quick flow at time t q 0 l3t 1 is the initial infiltration flow rate in other words the difference between the total discharge qmax and the baseflow component by extrapolation at time t 0 ɳ is equal to 1 ti in fact the infiltration function is defined between t 0 and ti 1 ɳ which indicates the duration of quick flow and ɛ determines the importance of the concavity of the quick flow curve in t 1 and indicates the flow heterogeneity el hakim and bakalowicz 2007 mangin defines the variable yt as follows a 4 yt at t 2 days is defined as i index infiltration delay which varies between 0 and 1 in fact i index making a distinction between systems that are affected by a mainly fast infiltration i tending toward 0 and systems that are affected by slow or delayed infiltration i tending toward 1 el hakim and bakalowicz 2007 the initial total volume v0 l3 in the beginning of the hydrograph recession curve is defined by the sum of the initial dynamic volume of the baseflow v 0 b and the quick flow volume v 0 padilla et al 1994 a 5 v 0 b q 0 α a 6 appendix b supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2023 129441 appendix b supplementary data the following are the supplementary data to this article supplementary data 1 
2052,using the reservoir model theory this study developed an equation for the relationship between the transfer and recession coefficients under a matrix restrained flow regime assuming darcy s law the proposed equation was developed based on conventional parameters of karst systems such as recession coefficient specific yield and catchment area firstly the equation was evaluated through forward and inverse modeling of an idealized karst system with modflow 2005 conduit flow process cfp and karstmod respectively then calibration of a karstmod and a cfp model of the baget karstic watershed in france was carried out to check the efficiency of the developed equation results of the first step showed that the optimal value of the transfer coefficient based on karstmod for the linear transfer flow is very close to the baseflow recession coefficient values therefore the transfer coefficient in karstmod may be considered as the recession coefficient from the matrix to the conduit compartment moreover substituting these two coefficients in the developed equation caused less than 10 errors in estimating the transfer coefficients assigned to the idealized models in cfp in addition adding the recession coefficient as prior information in the calibration process affects the recession coefficient of the simulated time series and provides a reliable evaluation of the internal dynamics of the system therefore the results of this research show that the recession coefficients can be used as an initial estimate of the transfer coefficient in the baseflow condition this achievement can significantly assist the discrete continuum model calibration and further support the water balance calculations based on the recession data keywords karst system transfer coefficient baseflow recession coefficient spring hydrograph matrix restrained flow regime data availability data will be made available on request 1 introduction karst systems constitute an important drinking water resource for approximately 9 2 of the world population stevanović 2019 distributed in all climate zones and continents goldscheider et al 2020 stevanović 2018 as a result of the dissolution of soluble rocks such as dolomite and limestone the preferential flow paths are formed in the matrix but the geometry and the location are difficult to handle therefore high heterogeneity and anisotropy in the hydraulic properties of karst systems lead to the possibility of a wide range of flow regimes from darcy flow in the matrix to turbulent flow in preferred flow paths burdon and papakis 1963 schuster and white 1971 atkinson 1977 ghasemizadeh et al 2012 generally the water pressure gradient between the preferential flow paths conduits and the matrix leads to the transfer flow white 2003 therefore the karst system as a natural system attempts to balance the system by the transfer flow between the preferred flow paths conduits and the matrix the flow between matrix and conduit is introduced as exchange flow in most studies but the authors of this article believe that exchange flow is a bidirectional flow in out at the same time and the special place of course transfer can occur in both directions but not simultaneously for the particular place therefore the concept of transfer flow between matrix and conduit is used in this article the transfer flow concept has been already used in the literature based on various hydrogeological issues e g bailly comte et al 2010 frank et al 2019 bauer et al 2003 hosseiny sohi et al 2018 assari and mohammadi 2017 hill 2008 moreover the transfer function has been already compared in term of performance in the modeling processes of the karst system hill 2008 reimann et al 2011 giese et al 2020 two modeling methods can be used to investigate the transfer flow between discrete karst conduits and the matrix continuum 1 discrete conduit continuum approaches representing distributed parameter models e g modflow 2005 conduit flow process mode 1 shoemaker et al 2008 reimann et al 2014 boyce et al 2020 this approach relies on the availability of information and spatial data concerning the discrete conduits and the matrix continuum therefore it is relatively difficult to implement in karst hydrogeology zhang et al 2017 martínez santos and andreu 2010 2 lumped parameter approaches are independent of the spatial distribution of the parameters accordingly the modeling process becomes easier scanlon et al 2003 this modeling method combines several transfer functions martínez santos and andreu 2010 which show the relationships between discharge and precipitation by compartments i e conceptual reservoirs chang et al 2017 zhang et al 2017 the karstmod modeling platform mazzilli et al 2019 developed by the french national observation services karst jourde et al 2018 can be considered for this purpose the amount of the transfer flow depends on a linear relationship between the transfer coefficient and the difference in hydraulic head between the matrix and the conduit barenblatt et al 1960 bauer et al 2003 in most numerical models the linear darcy flow equation was conventionally applied to quantify the transfer flow temporal fluctuations but zhao et al 2022 showed that the relationship of transfer flow with the square root of the hydraulic head differences constitutes a better fit than a linear relationship the transfer coefficient is representative of the lumped hydraulic and of the geometrical properties of the karst system that depends on the conduit geometry the transfer surface between the conduit and the matrix continuum and the hydraulic conductivity of the matrix bauer et al 2003 saller et al 2013 giese 2017 transfer coefficient is defined as a function of the matrix hydraulic conductivity conduit length and a dimensionless transfer factor reimann et al 2011 in distributed numerical models transfer flow and transfer coefficient are mainly influenced by the matrix coefficients spatial discretization reimann et al 2011 giese et al 2020 moreover the structure of the compartments was used to model the transfer flow in which the volume difference between the two compartments is used instead of the head difference according to this the transfer coefficient is defined in terms of days hartmann et al 2012 zhang et al 2017 following schmidt et al 2014 the transfer coefficient was defined as the product of the transfer surface atransfer m2 and the slope of the recession coefficient α d 1 although the prove of this equation has not been presented the slope of the recession curve is introduced as a component in the equation for calculating the transfer coefficient by schmidt et al 2014 shirafkan et al 2021 based on an idealized model with modflow 2005 conduit flow process cfp investigated the effect of the transfer coefficient on the slope of the recession curve they show that the recession curve is characterized by segments with steeper slopes α and a wider range of variations when the transfer coefficient increases according to the uncertainty and insufficient information about the geometry of conduits many characteristics of the karst system such as conduits network and transfer coefficient are still unknown and cannot be fully characterized by conventional methods previous studies on transfer coefficient identification gallegos et al 2013 saller et al 2013 mohammadi et al 2018 chang et al 2019 kavousi et al 2020 pacheco castro et al 2020 proposed a calibration based on cfp linked to pest model independent parameter estimation doherty 2004 ucode 2005 poeter et al 2008 or ucode 2014 poeter et al 2014 however as shown by pacheco castro et al 2020 the calibration of the transfer coefficient is not straightforward based on the limited knowledge of conduits and matrix continuum since the transfer flow constitutes an important component of the water balance in numerical models incorrect estimation of the transfer coefficient causes the inefficiency of numerical models in interpreting different hydrological studies of the karst system it has been shown in various studies that the recession coefficient of the hydrograph is a good tool for interpreting the internal dynamics of the system and calculating the balance components in karst systems raeisi 2008 kavousi and raeisi 2015 2016 therefore in this study we want to evaluate if the recession coefficient can be used to interpret the transfer coefficient this study presents a method to estimate the transfer coefficient in karst systems the main objectives include 1 evaluating the relationship between the transfer coefficient and the recession coefficient of the baseflow by developing an equation to highlight their relationship 2 assessing the reliability of the proposed equation by applying it in an idealized karst model and 3 applying the proposed equation as primary information in the calibration process of karstmod and cfp models in baget karst spring as the case study 2 material and methods 2 1 case study the baget karstic watershed located in the pyrenees mountains ariège france is characterized by a recharge area of about 13 2 km2 and a median elevation of about 940 m above sea level a s l fig 1 this karstic watershed belongs to the carbonate belt bordering the north of french pyrenees sivelle and labat 2019 its altitude ranges from 498 to 1417 m a s l and slopes are very steep ulloa cedamanos et al 2020 daily spring discharge is required for distributed modeling of the baget karstic watershed 2 1 1 water resources the lachein valley lies along the longitudinal axis of the watershed parallel to the limestone flysch contact in the upper valley the surface flow is established only during significant rainfall events and when the water level is high las hountas consists of the perennial spring of the baget karst system mangin 1975 genthon et al 2005 sivelle 2019 sivelle et al 2020 streams flowing on the flysch in the upper valley disappear at the contact of limestone formations recharging rainwater to the karst system genthon et al 2005 through sinkholes in the downstream valley ulloa cedamanos et al 2020 sinkholes and temporary resurgences in the downstream parts of the watershed are restrained area of around 1 km2 fig 1 sivelle et al 2020 labat and mangin 2015 in the baget karstic system voids consist of joints and open fractures as the main drainage system and dissolution caves as annexe drainage systems mangin 1975 marsaud 1997 the main drainage systems consist of the most transmissive part with short residence time while the annexe drainage systems include voids and caves connected to the main drainage system characterized by a much longer residence time although several caves were recognized and mapped whithin the baget karstic system such as caves of st catherine la peyrère genthon et al 2005 and part of the system between la peyrère p2 loss and moulo de jaur brehier 2019 personal communication the underground drainage system of the baget valley has not been completely explored finally it is worth noting that the possible direction of development and pathing of underground water lies in the direction of the river oriented east west sisavath et al 2004 also the watershed is subject to quick infiltration and rapid transit time between infiltration and outlet points sivelle at al 2019 2 2 analyzation of the recession curve in any given system such as an aquifer or stream individual recession segments recorded at different times may have different slopes depending on the variability in storage evapotranspiration and recharge rates posavec et al 2006 however it is possible to compile individual recessions into a single recession curve that provides an average characterization of heads flows or other observed variable responses and creates a structure called the master recession curve mrc posavec et al 2006 for this purpose the continuous time series is divided into short segments corresponding to individual recession events recession segments are sorted from the highest to the lowest value according to the initial value of each recession segment the sorting process is such that the absolute time of each part is converted into relative time by five equations which is equal to zero at the beginning of each part of the recession curve posavec et al 2006 in this study the recession analysis is performed according to mangin s method 1975 to calculate the volume of fast flow primarily through karstic conduits and baseflow mainly through the matrix continuum in the case study eq a 5 and a 6 in appendix a this method has been widely used to analyze the karst systems recession curves and propose a typology karst hydrodynamic behavior cinkus et al 2021 olarinoye et al 2022 2 3 numerical modeling tools 2 3 1 karstmod model karstmod mazzilli et al 2019 consists of an adjustable platform dedicated to daily and hourly lumped parameter rainfall discharge modeling of karst aquifers developed by the french sno karst jourde et al 2018 it is also used for analyzing the hydrodynamic characteristics of the compartments considered in the model based on the governing equations given in mazzilli et al 2019 and mazzilli et al 2022 the equation of the transfer flow between matrix and conduit compartments defined as follow 1 q mc k mc h m h c l ref α m c where kmc l t 1 is the specific discharge coefficient transfer coefficient hm and hc l are the water levels in the compartments m and c respectively lref l is a unit length and αmc is the positive exponent qmc l t 1 is defined as the algebraic flow from compartment m to compartment c per unit area the negative values of qmc mean that the current flow direction is from c to m karstmod has been successfully applied to reproduce matrix conduit transfers in various catchments sivelle et al 2019 duran et al 2020 frank 2020 labat et al 2022 sivelle et al 2022 2 3 2 cfp computational program modflow 2005 conduit flow process cfp mode 1 liedl et al 2003 shoemaker et al 2008 boyce et al 2020 computes groundwater movement in karst systems under consideration of darcy s law for laminar flow in the matrix continuum harbaugh 2005 and the darcy weisbach equation for laminar and turbulent flow in discrete conduits the discrete conduit network within the matrix continuum is defined as pipes characterized by diameter tortuosity roughness and a linear water transfer coefficient depending on the reynolds number the flow in the pipes can be either turbulent or laminar finally the conservation of volumetric flow is calculated according to kirchhoff s law for any node which connects several pipes this law expresses the sum of volumetric flows to nodes including pipe flows qip transfer flow qtransfer direct recharge qr and changes in storage qs the sum of these volumetric flows must be equal to zero the transfer flow between dissolution conduits and the matrix is calculated by a linear approach and based on the darcy law depending on the hydraulic head difference between the matrix and conduits barenblatt et al 1960 cfpv2 considers some additional modification to the flow subroutine in modflow 2005 cfp mode 1 for example the conduit associated drainable storage cads reimann et al 2014 and the limited head boundary condition lh reimann et al 2013 cads can be considered as the numerical representation of annex systems to drains asd in mangin s 1975 conceptual model lh boundary condition can be used to provide a limitation for the node head e g flooded sinkhole reimann et al 2013 for more information see the documentation by reimann et al 2013 2014 2 3 3 evaluation of the model performance the lumped parameter rainfall discharge model is calibrated using a quasi monte carlo procedure with a sobol sequence sampling of the parameter space mazzilli et al 2019 the best parameter sets for the model are those leading to the best objective function value here the objective function wobj for the calibration procedure consists of a weighted sum of the nash sutcliff efficiency nse nash and sutcliffe 1970 and balance error be perrin et al 2001 performance criteria such as wobj w nse 1 w be where w is the weight determined by the user w is chosen based on what combination of the different weights of these two criteria leads to the calibration of the time series with the largest highest objective function in addition w has been chosen according to past studies by various researchers in this regard baudement et al 2017 sivelle et al 2019 duran et al 2020 considering past studies a higher weight on the nse criteria is due to reproduce the highly dynamic behavior of the karst baudement et al 2017 the larger is the objective function higher nse and be the greater is the consistency between model and observations and the smaller is the model errors in addition to the objective function the kling gupta efficiency coefficient kge gupta et al 2009 was also calculated to further evaluate the model performance the calibration and estimation of the optimal parameter set in distributed parameter model of the baget karstic watershed is done based on the weighted least squares objective function in model independent parameter estimation pest code in fact the objective function is the sum of the squared residuals between the observations produced by the model and the experimental observations the smaller is this number referred to as the objective function the greater is the consistency between model and observations and the greater is our confidence that the parameter set determined on the basis of these observations is the correct doherty 2004 in addition the model performance is evaluated according to the various performance criteria nse be and kge 2 4 formulation of the transfer coefficient under various hydrological conditions three flow regimes may influence the recession curve of the spring hydrograph including 1 matrix restrained flow regime mrfr when the conduit network act similarly to a defined head boundary conditions and the drainage process is controlled by the matrix alone 2 conduit influenced flow regime cifr when the hydraulic gradient in the conduits is not negligible during the recession process and the recession process depends on the hydraulic parameters of matrix and conduit network kovács et al 2005 chang et al 2015 and 3 conduit flow regime cfr when the hydraulic head in the conduit is greater than the hydraulic head in the matrix bailly comte et al 2010 therefore the recession coefficient of the hydrograph is affected by the flow regimes kovács et al 2005 bailly comte et al 2010 shirafkan et al 2021 moreover karst spring displays a complex recession behavior including periods with linear and exponential recession coefficients one may be observed several different recession coefficients in the exponential period different recession coefficients are attributed to the variable hydraulic head and the stored groundwater volume in different compartments of the karst system i e matrix and conduits schmidt et al 2014 the baseflow recession can be influenced by mrfr or cifr kovács et al 2005 kováccs and perrochet 2008 since the matrix restrained flow regime mrfr is typical for highly karstified systems mature karst systems during baseflow periods kovács et al 2005 therefore in this study the recession coefficient equation defined by fiorillo 2011 based on the darcy reservoir model is used to find the relationship between the transfer coefficient and the recession coefficient related to mrfr fiorillo 2011 investigated the discharge from a linear reservoir based on darcy s law to simulate the real shape of the hydrograph of karst springs the used compartment is a cylinder with a base surface a1 l2 water filled to the height h0 l also drainage occurs through a pipe with hydraulic conductivity k lt 1 surface a2 l2 and length l l fig 2 considering fluid viscosity and friction forces the discharge at any time decreases exponentially with time and follows the maillet equation 1905 fiorillo 2011 defined the recession coefficient α t 1 eq 2 in maillet s equation eq a 2 in appendix a 2 α k l a 2 a 1 the darcy reservoir model introduced in fiorillo s study 2011 was only used with the approach of simulating the recession curve of the hydrograph and obtaining the equation of the recession coefficient eq 2 in the study of fiorillo 2011 the concept of transfer flow and coefficient had not been investigated but in this study it has been tried by an innovative method the darcy reservoir model and the recession coefficient equation eq 2 defined by fiorillo 2011 are used in order to find the relationship between the transfer coefficient defined by bauer et al 2003 and the recession coefficient related to mrfr for this purpose to create a different approach in using darcy s reservoir model in addition to the assumptions of fiorillo 2011 the change of the volume of compartment a1 and the characteristics of the pipe with hydraulic resistance affect the spring discharge should be added other a few assumptions as presented in fig 2 which includes the following another compartment with surface a3 is assumed to be in relation with the compartment of a1 through a pipe with hydraulic resistance and surface a2 it is assumed that transfer flow is unidirectional from the compartment with a1 area and hydraulic head varying with time to the compartment with a3 area and defined hydraulic head as it is in the baseflow conditions from the matrix to the conduit and the drainage process is controlled by the matrix alone mrfr therefore there is no violation in fiorillo s assumptions to calculate the transfer coefficient αtransfer l2t 1 the defined parameters in eq 4 l k and atransfer introduced by bauer et al 2003 can be considered equal to the characteristic of the hydraulic parameters of the pipe with hydraulic resistance e g l k and a2 fig 2 finally the proof of the relationship between the transfer coefficient and recession coefficient is presented by eqs 3 to 8 in this study eq 2 introduced by fiorillo 2011 based on the darcy reservoir model is rearranged to separate the ratio of k l as eq 3 combining the introduced formula by bauer et al 2003 with eq 3 provides an equation for αtransfer eq 5 3 k l α a 1 a 2 4 α transfer 1 l k a transfer b a u e r e t a l 2003 5 α transfer α a 1 a 2 a transfer a transfer a 2 in eq 5 a2 can be defined as the area of transfer i e atransfer therefore the ratio atransfer a2 becomes equal to unity and eq 5 is rearranged as eq 6 6 α transfer α a 1 in darcy reservoir model introduced by fiorillo 2011 is assumed that the catchment area of springs corresponds to the area occupied by water table and he considered a1 as the product of catchment area ac and the mean effective porosity n eff so here substituting of a1 ac n eff in eq 6 provides a clear relation between αtransfer and α 7 α transfer α a c n eff eq 7 shows the relationship between the transfer coefficient and the recession coefficient of the baseflow in the condition that the direction of the transfer flow is from the matrix to the conduit in this study the recession coefficient α is computed based on the spring hydrographs of idealized modeling or real case study however the transfer coefficient αtransfer is optimized by applying eqs 7 and 8 through modeling by karstmod and pest linked to cfp from two points of view the optimized transfer coefficient in karstmod kmc lref can be considered as the recession coefficient α of the baseflow in the mrfr including 1 the optimized transfer coefficient in the karstmod is conceptually defined as the discharge coefficient from the matrix compartment to the conduit compartment sivelle et al 2019 and 2 the dimension of both coefficients kmc lref and α is t 1 the relation between the optimized transfer coefficient in the karstmod kmc lref and the recession coefficient α of the baseflow is assessed by idealized modeling approach in the next sections as it is known eq 7 is based on the reservoir model which is a lumped parameter model and is defined for the total length of the conduits however the cfp model is a spatially distributed model that allows the individual definition of all parameters for each cell and node therefore the transfer coefficient αtransfer computed based on eq 7 should be modified by dividing by the number of conduit nodes to be applicable as the assigned transfer coefficient αtransfer in cfp eq 8 so that the corresponding transfer coefficient αtransfer is defined for each node 8 α transfer d i s t r i b u t e d l 2 t α transfer lumped the n u m b e r o f c o n d u i t n o d e s kmc lref 1 t o r α 1 t a c l 2 n eff o r s y the n u m b e r o f c o n d u i t n o d e s in this equation the transfer coefficient can be computed using the specific yield of the matrix instead of effective porosity the percentage of error of the estimated transfer coefficient and assigned to cfp is calculated according to eq 9 9 e r r o r estimated α transfer α transfer i n c f p α transfer i n c f p 100 in this study the relation between the recession coefficient of the baseflow and the transfer coefficient as defined by bauer et al 2003 and also used in modflow 2005 conduit flow process cfp is reformulated in order to find a reliable estimation of the transfer coefficient firstly an equation is developed to define the relation between the recession coefficient of the baseflow and the transfer coefficient then the reliability of the suggested equation is evaluated by two approaches including 1 idealized modeling fig 3 and 2 using a real case study fig 4 the idealized modeling approach using cfp and karstmod is planned to compare the optimized transfer coefficient to the recession coefficient of idealized spring hydrographs considering the suggested equation fig 3 the idealized modeling approach includes different steps 1 a number of hypothetical hydrographs are produced by cfp assigning different transfer coefficients 2 the recession coefficient of the baseflow associated with the produced hypothetical hydrographs and also the optimized transfer coefficient in karstmod by inverse modeling are substituted to in the developed equation to estimate the initial transfer coefficient assigned to cfp fig 3 in the second approach the modeling of the selected case study is done based on the real measured data e g the time series of the spring hydrograph as presented in fig 4 assessing the reliability of the suggested equation in the case study include two main steps fig 4 including 1 comparing the optimized transfer coefficient by the lumped modeling approach i e karstmod code to the baseflow coefficient of the studied spring obtained using master recession curve and 2 comparing the estimated baseflow coefficient by linking pest to the distributed modeling approach i e cfp to the studied spring in the case study it was attempted to investigate the effect of applying the developed equation on the calibration process of the spring hydrograph 3 model representations 3 1 forward idealized modeling using cfp a series of spring hydrographs were produced to evaluate the relationship between the transfer coefficient and the recession coefficient assuming an idealized karst aquifer the dimensions and geometry of the idealized model are analogous to the characteristics of hypothetical models used in previous research bauer et al 2003 reimann et al 2011 chang et al 2015 dufoyer et al 2019 shirafkan et al 2021 the idealized karst aquifer is conceptualized as a single unconfined layer with a thickness of 100 m an area of 1 096 500 m2 and 562 active cells the finite difference cell size of the aquifer is set to a constant of 50 50 m2 except for seven rows adjacent to the conduit where the width of rows decreases from 50 to 35 25 10 and 5 m respectively values of 1 10 3 and 8 64 10 2 md 1 are assigned to the specific yield and the hydraulic conductivity respectively the karst conduit is located at an elevation of 10 m and is divided into 33 straight pipes further the karst conduit is assumed as fully saturated the discharge point of the model at the model s boundary last node is defined by a first type boundary condition defined head with a head value of 20 m the characteristics of the karst conduit including tortuosity coefficient and roughness coefficient are set with constant values of 1 and 0 01 m respectively the different values are assigned to the transfer coefficient 8 64 10 1 4 752 10 1 8 64 10 2 4 752 10 2 and 8 64 10 3 m2d 1 a value of 5 m is assigned to the diameter of the karst conduit to minimize the effect of the hydraulic gradient throughout the karst conduit defined head conditions for a wide range of changes in the transfer coefficient and establishing a matrix restrained flow regime moreover 20 rainfall events are considered under gaussian distribution to simulate diffuse recharge the whole simulation period of the model and the time step were set to 10 years and one day respectively assuming that the spring discharge is mainly affected by the direction of transfer flow from the matrix to the conduit under mrfr conditions therefore the main recharge act as diffuse recharge including about 99 9 the recession curve s duration is considered long enough to evaluate the characteristics of the aquifer especially the transfer coefficient 3 2 site specific model of the baget karstic watershed using cfp 3 2 1 conceptual model the baget karstic watershed includes large and independent resurgences with an average volume of about 60 000 m3 marsaud 1997 these resurgences include la peyrère resurgence a in figs 1 and 5 p2 loss resurgence b in figs 1 and 5 la hillière resurgence c in figs 1 and 5 and moulo de jaur resurgence d in figs 1 and 5 that are located at a distance of 840 777 692 and 511 m from the permanent spring respectively sivelle 2019 la peyrère resurgence is considered a tilted cylinder with a slope of 30 degrees and a diameter of 5 m genthon 2005 fig 5 in low water conditions the piezometric surface in the la peyrère resurgence is located 3 m higher than the outlet therefore it seems that most of the resurgence is located below the outlet level marsaud 1997 also speleological investigations and tracing tests showed that resurgences are connected to the main drainage system that goes to the spring sivelle 2019 during high flow conditions the water flow in the lachein river in the upstream part of the watershed sinks in p2 loss and la peyrère and then overflows in moulo de jaur and la hillière and subsequently flows on the surface towards the permanent spring finally it is measured at station b1 which is located 100 m from the spring fig 1 in contrast during low flow conditions the overflow process will not continue sivelle 2019 surface runoff is lost at different levels according to the importance of the floods and the performance of resurgence can be inverted in terms of loss and overflow mangin 1975 mangin 1975 explains the function of the overflow in the baget karstic watershed in this way when a flow in a pipe is suddenly stopped the kinetic energy of the liquid is removed this kinetic energy is converted into potential energy of the pressure an additional pressure or overpressure produces a shock wave which is named water hammer when an outlet is upward and presents a strong head loss then water can be violently expelled then this rising gallery acts as an equilibrium chimney the water level in them is higher than the karst piezometric levels due to the phenomenon of water hammer this phenomenon can be observed in the baget karstic watershed sivelle 2019 based on geophysical studies showed that the moulo de jaur overflow can be considered as evidence for the saturation state of the underground drainage network if the overflow is active the system can be considered as saturated and conversely when the overflow is no longer active the drainage network is no longer considered as saturated with water so that moulo de jaur as a temporary resurgence can still be active in intermediate conditions when hillière is not necessarily active and there is no surface flow in the lachain river the upstream of moulo de jaur then when the water level in it decreases moulo de jaur is deactivated progressively at first the water level is not enough for the water going out of the moulo de jaur but it is saturated finally when the water level decreases it will no longer be saturated and flow is underground towards the permanent spring las hountas 3 2 2 numerical model in cfp in order to develop the numerical model fig 5 the baget karst system is comprised by two formations 1 limestone and 2 flysch which is considered as impermeable layer therefore the limestone formation is considered as active cells 2670 active cells with an area of about 9 6 km2 and the rest of the cells are considered inactive the width of both columns δx and rows δy was set to 60 m the baget aquifer is considered as a convertible layer with impermeable boundaries neumann type no flow at the la peyrère the depth reached by the karstification exceeds 50 m below the level of the spring however based on geological data the probability of exceeding the depth of 100 m is low marsaud 1997 therefore the thickness of the karst aquifer is considered up to 100 m below the spring level information related to the conduit network was only captured for the area of 1 km2 of the watershed and there is no information for the rest of the watershed therefore in areas where there is no information a hypothetical and horizontal conduit can be considered along the longitudinal axis of the watershed and the river path in the area of 1 km2 two groups of conduits can be recognized which include 1 the real path of the cave brehier 2019 personal communication which is red colored fig 5 2 parts of the conduits that were extracted by inverse modeling and based on the artificial tracer tests sivelle et al 2020 which were marked with black color sivelle et al 2020 determined potential conduit geometry by simulation of the flow and transport using storm water management model swmm gironás et al 2010 which was considered no lateral transfers according to fig 5 there are five points of losses and temporary resurgences points a b c d and e in the watershed the runoff can be lost in losses of the points a and b losses of la peyrère and p2 loss respectively with the entrance elevation of 560 and 516 m respectively points c and d la hillière and moulo de jaur are overflow springs with an entrance elevation of 520 m and 507 m and point e is a permanent spring of las hountas with an elevation of 498 m in the baget karstic watershed the water storage in the form of snow is limited and snowmelt has no significant influence on the spring discharge ulloa cedamanos et al 2020 the lachein river flows as a sinking river along the interface between limestone and flysch formations towards the underground karst system therefore the contribution of surface runoff is mainly assumed to act as concentrated point recharge to make a proper modeling of the baget karstic watershed scenarios with different characteristics regarding recharge and discharge were tested finally based on the results a scenario was selected in which the percentage of the concentrated and the diffused recharge was calculated through the master recession curve see table a 2 in appendix a and applied to the numerical model based on eqs 10 and 11 in each time step the total amount of recharge m3d 1 is obtained from the product of the net recharge rate md 1 in each time step by the total area of recharge m2 the recharge area is considered 18 22 km2 based on the water balance equation and considering potential evapotranspiration 10 rch total r e c h a r g e i n e a c h t i m e s t e p q u i c k f l o w area o f c e l l s c o n t a i n e d b y c o n d u i t 11 uzf total r e c h a r g e i n e a c h t i m e s t e p b a s e f l o w area o f a c t i v e c e l l s o r a r e a o f l i m e s t o n e f o r m a t i o n according to eq 10 the amount of concentrated recharge rate is obtained for each time step then this rate is introduced to the numerical model at points a and b losses of la peyrère and p2 loss respectively by diffuse matrix recharge in modflow 2005 rch package the concentrated recharge component is defined for two points a and b losses of la peyrère and p2 loss respectively by cads rch within the crch2 functionality of cfpv2 reimann et al 2013 cads rch indicates direct recharge to the cads whereas cads was presumed to be located beneath the conduit system part 1 real path of the cave and part 2 conduits that were extracted by inverse modeling by sivelle et al 2020 accordingly the width of the cads in part 1 wcads1 is considered larger than the width of the cads in part 2 wcads2 due to the existence of caves in part 1 the cads rch recharge fraction reimann et al 2013 can vary between 0 and 1 and affects the assigned areal matrix recharge through rch in modflow 2005 the cads rch fraction of 1 i e diversion of all areal matrix recharge from rch to cads rch is assigned for sinking rivers and concentrated recharge according to eq 11 the diffused recharge rate is obtained for each time step then these rates are introduced to the numerical model at the active cells i e karstified formation by the unsaturated zone flow uzf functionality of modflow 2005 niswonger et al 2006 uzf reflects unsaturated zone hydraulics by a 1d kinematic wave approach of richards equation and accounts for process based infiltration passing through the unsaturated zone uzf assumes uniform unsaturated hydraulic properties for each vertical column on top of the respective model cells for more information see niswonger et al 2006 a limited head lh boundary condition and a defined head boundary for the outflow of the baget karstic watershed were considered for the springs in the numerical model in the baget karstic watershed overflow springs may appear in different places under different conditions of the flow regime but points c and d la hillière and moulo de jaur are mainly introduced as overflow springs with an entrance elevation of 520 m and 507 m but running different models by cfpv2 it is understandable that because there is a hydraulic connection between the points c and d la hillière and moulo de jaur in the numerical model and the entrance elevation of the point d is less than it in the point c therefore the hydraulic head in point of c does not reach the desired elevation 520 m due to the outflow from the point d accordinlgy only point d moulo de jaur is applied to the numerical model as the overflow spring and boundary conditions lh also point e las hountas with an elevation of 498 m is introduced to the model as a permanent spring with a defined head boundary condition in general fourteen parameters are calibrated by pest whereas the following nine parameters are considered for the conduits hypothetical conduit diameter dc1 cave diameter dc2 diameter of the conduit according to sivelle et al 2020 dc3 conduit tortuosity τc mean roughness height of conduit walls kc transfer coefficient αtransfer width of conduit associated drainable storage wcads1 and wcads2 over flow node lh boundary another three parameters are considered for matrix continuum matrix hydraulic conductivity k storage coefficient ss matrix specific yield sy and two parameters are considered for unsaturated zone saturated vertical hydraulic conductivity of unsaturated zone vks and saturated water content of the unsaturated zone thts 3 3 inverse idealized and realistic modeling by karstmod model the required information for modeling by karstmod includes the time series of discharge precipitation evapotranspiration and the catchment area drained by the main spring the following assumptions should be considered for the reliable estimate of the transfer coefficient by karstmod sivelle et al 2019 in order to make a correct estimate of the transfer coefficient a suitable conceptual structure should be created in karstmod for the aquifer with no flow boundary and one main spring it seems that the only suitable structure that can estimate the transfer coefficient properly is as shown in fig 6 to avoid initialisation bias in the lumped parameter model calibration the warmup period is set over to 2 years based on the periods given in sivelle et al 2019 karstmod is run for of both the idealized and the realistic karst aquifers using the model structure presented in the fig 6 the objective function consists of the weighted sum of nse and be such as wobj 0 7 nse 0 3 be the parameter estimation procedure is set up to identify the parameter set providing a minimal wobj value of 0 6 according to the time series obtained using the idealized karst aquifer the warm up the calibration and the evaluation periods were set to 1400 1100 and 1150 days respectively finally the transfer coefficient is calibrated and optimized according to observed time series of the spring discharge produced by the idealized modeling using cfp for real karst aquifer the baget karstic watershed the warm up period is about 1005 days from january 1968 to september 1970 the calibration period is about 3653 days from october 1970 to september 1980 and the evaluation period is about 13239 days from october 1980 to december 2016 4 results and discussions 4 1 forward and inverse idealized models 4 1 1 estimation of transfer coefficient based on idealized model hydrographs different values of the transfer coefficient e g 8 64 10 1 4 752 10 1 8 64 10 2 4 752 10 2 and 8 64 10 3 m2d 1 were assigned to the idealized karst model to produce different spring hydrographs fig 7 the area of the idealized aquifer the specific yield or effective porosity and the number of nodes of conduit are the same with the values of 1 096 500 m2 1 10 3 and 34 respectively for all runs of cfp given the spring hydrographs fig 7 the recession coefficient of the baseflow is used to estimate the value of the transfer coefficient based on eq 8 a small error is an evidence and proof of eq 8 as the relationship between the recession coefficient of the baseflow under mrfr conditions and the transfer coefficient table 1 according to table 1 although error of estimation of the transfer coefficient based on eq 8 in idealized spring hydrographs assuming the transfer coefficients of 4 752 10 1 and 8 64 10 1 m2d 1 are more than 10 other spring hydrographs e g assuming transfer coefficients of 8 64 10 2 4 752 10 2 and 8 64 10 3 m2d 1 show small error according to the cfp results fig 8 it is clear that by assigning larger transfer coefficients e g 4 752 10 1 and 8 64 10 1 m2d 1 the influence of the hydraulic head difference between the matrix and the conduit hm hc is diminished because the karst conduit no longer acted as fixed head in this condition the flow regime changed to cifr and the drainage of the matrix is affected by karst conduit eq 8 was developed by assuming mrfr condition in which karst conduit act as fixed head therefore allocating large values of the transfer flow to the idealized karst aquifer of interest caused increasing of error in estimation of the transfer coefficient based on eq 8 due to changing the flow regime from mrfr to cifr therefore it can be noted that similar to recession coefficient the transfer coefficient is also affected by the flow regime accordingly the relationship between them modify by changing the flow regime 4 1 2 estimation of the transfer coefficient in the idealized model by karstmod time series of spring discharge from the idealized aquifer are introduced as observed time series for calibrating the lumped idealized model using karstmod the results are given in fig 9 and table 2 according to fig 9 the calibration process is performed for all transfer coefficients with a wobj of more than 0 9 also in the graph of the transfer coefficient against the objective function kmc vs wobj it is shown that the transfer coefficients were well calibrated so that the curve is bell shaped or a straight line shaped as well as the optimized value of the transfer coefficient shows the maximum of the objective function table 2 compare the value of the transfer coefficient allocated to cfp and the optimized transfer coefficient by karstmod in the eq 8 the results of table 2 show that error for transfer coefficients of 4 752 10 1 and 8 64 10 1 18 56 and 32 80 respectively is more than other the transfer coefficients as explained in section 4 1 1 the estimation error is small under the mrfr condition when the transfer coefficient assumed less than 4 752 10 1 m2d 1 in the idealized models however increasing the transfer coefficient caused changing the flow regime to cifr and increasing the estimation error table 2 the small error is interpreted as an evidence and proof of the proposed eq 8 suggesting the relationship between the recession coefficient of the baseflow under mrfr conditions and the transfer coefficient table 2 in short assigning large values of the transfer coefficient to the idealized karst model e g 4 752 10 1 and 8 64 10 1 m2d 1 leads to the diminish of the hydraulic head difference between the matrix and the conduit hm hc therefore the drainage process is dependent on the entire aquifer matrix and conduit these conditions approach the flow regime conditions defined by kovács et al 2005 as cifr they introduced this flow regime for fissured systems or weakly karstified systems i e early karst systems during baseflow also assigning small values of the transfer coefficient to the idealized karst model e g 8 64 10 2 4 752 10 2 and 864 10 3 m2d 1 the hydraulic head difference between the matrix and the conduit hm hc is increased so that the drainage process is controlled by matrix alone and conduit do not longer influence the drainage of the matrix conduit behave as defined head boundary conditions these conditions approach the flow regime conditions defined by kovács et al 2005 as mrfr they introduced this flow regime for highly karstified systems i e mature karst systems during baseflow according to the results tables 1 and 2 values of kmc lref d 1 are similar to the recession coefficients of the baseflow for each idealized spring hydrograph assuming different transfer coefficients it seems that kmc lref d 1 is a reliable indication of the recession coefficient that shows the flow discharge from compartment m matrix to c conduit therefore for aquifers with impermeable boundaries and a main spring i e like the assumed idealized karst aquifer the most ideal condition for the estimation of the transfer coefficient is the low flow conditions when the duration of the recession curve is sufficiently long 4 2 inverse realistic models as results of the idealized modeling revealed a reliable relationship i e eq 8 was suggested between the transfer coefficient and the slope of the recession curve of the baseflow based on the study of kovács et al 2005 matrix restrained flow regime mrfr is typical for highly karstified systems i e mature karst systems during baseflow periods available data elucidated that the baget karstic system is highly karstified and it is expected the baseflow recession curve is mainly influenced by mrfr therefore the assumptions of the proposed eq 8 are probably consistent with this case study despite some limitations the proposed equation has been developed in the condition that the transfer flow direction is from the matrix to the conduits and its use can be limited by reversing the transfer flow direction from conduits to matrix but according to the following explanations the developed equation can be used for a long term time scale e g daily in the baget karstic system as shirafkan et al 2021 showed that the transfer flow process from the conduit to the matrix occurred in a short period and over a restricted part of the conduit flow regime cfr when the concentrated recharge is increased conversely the transfer flow from the matrix to the conduit occurs as a long term process therefore the study of the transfer flow from conduit to the matrix in detail it should be investigated in short term scales and in most cases it is difficult to track and investigate this process in long term scales to study the relationship between the transfer coefficient and the recession coefficient under the conditions of matrix restrained flow regime mrfr long term time scales are required to complete the recession curve so that it is attained a correct estimate of the recession coefficient the purpose of this study is to develop the relationship between the transfer coefficient and the recession coefficient of the hydrograph therefore the transfer flow must participate in the discharge of the spring so that the relationship between these two coefficients can be shown when the direction of the transfer flow is from the conduit to the matrix the discharge of the spring is provided purely from the recharged water to the conduit and the transfer flow does not supply the water of the spring in this condition so it is not possible to develop a relationship between the recession coefficient and the transfer coefficient therefore the calculation of the transfer coefficient in these conditions still needs more research work whether or not the relationship between the transfer flow and head difference between the conduit and matrix is linear this topic requires more detailed research and can be suggested as an open question for further research in short it can be assumed that possible errors due to short term period of transfer flow from the conduit to the matrix can be ignored in calibration process in which is applied baseflow information in the long term time series moreover in this study the transfer coefficient is assumed to be constant throughout the simulation time as well as a linear relationship is assumed between the transfer flow and the hydraulic head difference based on this finding applying the coefficient of baseflow recession curve as a prior data is investigated in the process of calibration of the baget spring data by karstmod and cfp as well as its effect on the recession coefficient of the simulated time series is discussed 4 2 1 analysis of the recession curve based on the baget spring hydrographs according to the daily time series of discharge and rainfall from 1968 to 2016 for the baget karstic watershed it can be seen that the rainfall is consecutive and the recession curve of the baseflow is not completely formed therefore it is not ideal for estimating the transfer coefficient in the low flow conditions in such a situation the master recession curve can be used to calculate the recession coefficient of the baseflow in this research the master recession curve was created by the spreadsheet file mrctools v4 0 xlsm developed by posavec et al 2006 then by selecting the master recession curve separation option posavec et al 2010 the curve is automatically divided into parts with different slopes by the exponential equation finally the master recession curve is analyzed based on mangin s method 1975 fig 10 and table a 1 in appendix a using fig 10 the characteristics of the master recession curve that are shown in table a 1 appendix a are extracted and also i and ɛ calculated using eq a 4 in appendix a according to the value of i it is clear that the baget karstic watershed is mainly affected by rapid infiltration or concentrated recharge padilla et al 1994 showed that the importance of the unsaturated zone in response to the spring for the mayor spring with a value of ɛ equal to 8 44 10 2 d 1 was greater than that of aliou spring with a value of ɛ equal to 2 63 d 1 due to the slower circulation rate of flow in mayer spring therefore the importance of the unsaturated zone in response to the baget spring can be between the above two springs considering the value of 0 70 d 1 for ɛ according to table a 2 in appendix a it shows that about 68 and 32 of the recharge to the baget spring is drained during the quickflow and the baseflow respectively also the recession coefficient of the baseflow which is an important parameter in calculating the transfer coefficient is 2 86 10 2 d 1 4 2 2 application of baseflow recession curve information in the baget spring calibration process by karstmod considering the similarity of two coefficients kmc lref t 1 a n d α t 1 the process of calibration and estimation of transfer coefficient by karstmod can be improved according to initial information of α obtained from the recession curve of the spring hydrograph therefore before calibration of the model of the case study by karstmod it is highly recommended to pay attention to the following restrictions to choose the reliable range of parameters the first second and third hints are related to the recession curve and the fourth case is related to the water balance equation under baseflow conditions the direction of the transfer flow is from the matrix to the conduit which is known as the baseflow therefore the parameters space must be selected in such a way that the ratio of baseflow to total flow qbaseflow qtotal or in other words the ratio of qmc qtotal according to table a 2 in appendix a is 32 parameters space in karstmod should be set in such a way that the value of the optimized transfer coefficient in karstmod kmc is close to the recession coefficient of the baseflow i e the value of 2 86 10 2 d 1 the recession coefficient of the baseflow obtained from the simulated time series should be close to the observed time series since there is no surface or sub surface outflow through the boundaries of the watershed and all the outflow of the karst system is measured at station b1 sivelle 2019 therefore the effective area of the recharge is calculated as 18 22 km2 for 47 years from 1969 to 2016 based on the water balance rules and potential evapotranspiration eq 12 12 q spring a p i where a is the effective area of the recharge of the spring p is the annual precipitation and i is the infiltration percentage corresponding wobj and following the restrictions mentioned above the results and optimal values are shown in fig 11 supplementary table s1 and table 3 for the optimal values of the set of parameters the values of the objective function were attained 0 68 and 0 64 for the calibration and evaluation periods respectively table 3 the observed and the simulated time series of the discharge related to the spring of the baget karstic watershed las hountas spring as well as the changes of the transfer flow vs time are shown in fig 11 a as transfer flow from the conduit to the matrix occurred in a short period and over a restricted part of the conduit flow regime cfr shirafkan et al 2021 therefore considering fig 11a in the daily time scale for most of the time the direction of the transfer flow was positive flow direction from the matrix to the conduit that is known as baseflow increasing the recharge one can be seen peak in the discharge flow as a result it is observed decreasing the transfer flow from the matrix to the conduit baseflow and even the reverse flow fig 11 a the value of the recession coefficient of the baseflow based on master recession curve of the simulated time series fig 11 b is equal to 3 41 10 2 d 1 which is shown an acceptable error 19 compared to the value of the recession coefficient of the baseflow associated with the observed time series α3 2 86 10 2 d 1 the results show that by applying the recession curve information to the calibration process by karstmod it can be estimated a reliable estimate of the transfer coefficient and internal dynamics of the system so that the optimized transfer coefficient by karstmod is equal to 2 5 10 2 d 1 which is close to the recession coefficient of the baseflow related to master recession curve of the observed time series α3 2 86 10 2 d 1 and simulated α3 3 41 10 2 d 1 also the effective area of the recharge the ratio of the transfer flow from the matrix to the conduit baseflow to the total flow discharged by the spring qmc qcs and the ratio of the flow from the non linear compartment to the total discharge flow qec qcs are estimated respectively 19 2 km2 30 and 70 4 2 3 application of base flow recession curve information in the baget spring calibration process by cfp eq 8 is rearranged to calculate the ratio of αtransfer sy based on available kmc lref t 1 computed by karstmod or α t 1 computed by mrc the αtransfer sy ratio is applied to the calibration process of the baget spring model using cfp linked to pest the effect of two conditions including with and without the application of the αtransfer sy ratio as primary information in the calibration process are assessed with the slope of the baseflow recession curve of the simulated time series of the baget spring numerical model was calibrated by the pest code once without applying the ratio αtransfer sy condition a and once by applying it condition b and the results were analyzed the results of conditions a and b are shown in fig 12 supplementary table s2 and table 4 comparing of two assumed conditions for the baget spring i e without and with applying of αtransfer sy ratio under condition a and b respectively revealed that the αtransfer sy ratio affects the value of α3 in the condition b where this ratio is applied the value of α3 is somewhat closer to the real value and is equal to 3 6 10 2 d 1 table 4 however in the condition a where the ratio αtransfer sy is not applied the value of α3 is equal to 6 28 10 2 d 1 table 4 therefore in the case study it is also proven that the slope of the baseflow recession curve provides appropriate information regarding the transfer coefficient in this study the recession coefficient of the baseflow α3 is obtained based on the master recession curve separation assuming discharge thresholds of 0 4 and 0 9 m3s 1 as the lower and upper limits in which the overflow and high flows are activated in the baget karstic watershed according to supplementary table s2 and in the conditions a i e without applying the αtransfer sy ratio the optimal value of the transfer coefficient is 1 46 10 4 m2s 1 unlike observed time series the simulated baseflow has a lot of fluctuations so that the value of α3 is estimated 6 28 10 2 d 1 and other measurement criteria including kge nse and be are with values of 0 525 0 466 and 0 99 however in condition b by applying the αtransfer sy ratio the specific yield and the transfer coefficient values are optimized as a supervised optimization with values of 1 99 10 3 and 4 40 10 5 m2s 1 respectively although in condition b the baseflow has fluctuations α3 is optimized in a value of 3 6 10 2 d 1 that is somewhat closer to the real value of 2 86 10 2 d 1 calculated by master recession curve however in condition b the other criteria are kge nse and be with the values of 0 459 0 4405 and 0 99 respectively which are slightly lower than the criteria in condition a in addition to the value of α3 in the baseflow conditions the shape of the recession curve fig 10 can also provide information about the transfer coefficient as it was shown in the study conducted by shirafken et al 2021 in the conditions in which concentrated recharge is important in a karst system as well as the transmissivity coefficient and transfer coefficient are large enough the inflection point is located before a non arc region and the majority the discharge time series follows one alpha slope mode iii in shirafkan et al 2021 therefore the similarity of the recession curve of the hydrograph of the baget karstic watershed to mode iii in shirafken et al s study 2021 and the importance of concentrated recharge in the watershed show that the transfer coefficient and hydraulic conductivity of the matrix can be large enough for the aquifer the transfer coefficient values in conditions a and b are 1 46 10 4 and 4 4 10 5 m2s 1 respectively and the hydraulic conductivity values in conditions a and b are 4 27 10 4 and 3 58 10 4 ms 1 respectively in the calibration of the baget spring model performed by karstmod and pest high flow and low flow of the spring discharge in the baget karstic watershed were not properly simulated according to mangin s definition 1975 of the phenomenon of water hammer and equilibrium chimney in the baget karstic watershed it can be concluded that conduit reservoirs play an important role in the discharge of baget spring in low flow conditions most of the recharge water entering the baget karst watershed is stored in reservoirs and the role of storativity becomes important and as a result it increases the water pressure in the reservoirs following the subsequent recharges in high flow conditions water pressure increases and causes discharge points in the form of overflow springs the weak simulation of low flow and high flow conditions may be due to the lack of ability in the storativity process in baseflow conditions which most of the recharge goes to the spring as a result the increase of the pressure in the reservoirs will not be significant therefore high flow conditions i e peak discharges of the baget spring are not well simulated in addition mangin 1975 stated that the overflow does not act in the same way at the beginning and end of a given cycle and its rate increases at the end of the cycle so during flood overflows at the end of the cycle is faster developed than them at the beginning of the cycle because of the saturation of underground reservoirs therefore due to the lack of proper storativity the saturation of interest cannot be created accordingly high flow discharge is not simulated at spring also according to the pumping tests and geochemical and biological observations in the study of marsaud 1997 it is shown that as a result of successive pumping waters are requested from the karst system that have a longer residence time and do not participate much in the flow towards the spring this fact shows that these waters were taken from reservoirs according to the fluctuation of simulated spring discharge hydrographs under low flow conditions it can be concluded that water poorly stored and remained in the aquifer accordingly most of the recharged water is directly moved towards the spring it seems that the lack of adequate data for preparing conceptual model of the study area and or computational issues of the selected numerical model e g cfp caused unsuccessful simulation of time series of the baget spring discharge although simulation of low flow and high flow discharge at the baget karstic watershed has failed it requires more investigations based on accessing to sufficient data the weakness of numerical models to simulate baseflow has been emphasized by jeannin et al 2021 they showed that a significant part of the poorly forecasted values corresponded to base flow and this shows that modelling approaches and criteria for the calibration are too oriented towards peak flow sections of the hydrographs although in the current study the baseflow is not simulated well in different scenarios and has many fluctuations compared to the observed time series it is observed that by applying the αtransfe sy ratio based on the suggested eq 8 the recession coefficient of the simulated baseflow is somewhat closer to observed values in comparison to scenarios where this ratio is not applied 5 conclusions the estimation of the transfer coefficient under field conditions based on conventional methods is a complex and almost impossible task the main goal of this research is to obtain an indirect and simple method for estimating the transfer coefficient in a matrix restrained flow regime the transfer flow direction is from the matrix to the conduit and finally towards the spring so the transfer flow can be traced as the baseflow therefore a reliable relationship between the slope of the recession curve in the baseflow conditions and the transfer coefficient is expected in this study based on the reservoir model an equation is suggested for this relationship the suggested equation was evaluated and tested with cfp and karstmod for idealized models with varying transfer coefficients the results of the idealized models proved the efficiency of the suggested relationship in matrix restrained flow regime moreover results of inverse modeling by karstmod for the idealized models revealed that the optimized value of the transfer coefficient i e the linear transfer flow in karstmod is similar to the slope of the recession curve in the baseflow conditions therefore it can be considered equivalent to the recession coefficient of the baseflow results based on the baget karst spring as a real case study confirmed that the value of the transfer coefficient optimized by karstmod is equivalent to the recession coefficient of the baseflow furthermore the effect of the suggested equation on the slope of the baseflow recession curve of the simulated time series is highlighted by applying this relationship as prior information to calibration process of the cfp linked to pest code for the studied karst system therefore it is recommended to use the equation developed in this study and considering its results for a reliable estimation of the transfer coefficient in other studies of course estimation of transfer flow needs more research and developing other relationships especially in conduit influenced flow regime cifr and conduit flow regime cfr conditions as well as laboratory studies on the scale of laboratory models and efforts to measure the transfer coefficient credit authorship contribution statement malihe shirafkan conceptualization methodology software writing original draft zargham mohammadi supervision conceptualization methodology writing review editing alireza kavousi software validation methodology vianney sivelle visualization conceptualization methodology data curation david labat conceptualization writing review editing thomas reimann investigation writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the first and second authors would like to acknowledge the support from the iran national science foundation insf grant number 98004972 and shiraz university alireza kavousi and thomas reimann were supported by the deutsche forschungsgemeinschaft dfg for the ikarst project grant numbers li727 31 1 re4001 2 1 the authors would like to thank the french national observation services karst http sokarst org initiative at the insu cnrs which aims to strengthen the dissemination of knowledge and promotes cross disciplinary research on karst systems at the national scale for their support of the use of the karstmod model the authors would thank the associate editor and two anonymous reviewers for their constructive comments and suggestions which made a considerable improvement in this paper appendix a the calculation of the baseflow and the quick flow volume according to mangin s method 1975 the total discharge of the spring qspring at any time t during the recession curve of the hydrograph of the spring is defined by the following equation a 1 q spring φ t ψ t the first part of the equation φt is related to the saturated zone discharge under baseflow conditions and is defined by the maillet equation 1905 a 2 φ t q 0 e α t where q0 l3t 1 and φt are discharge at the initial time and time t and α t 1 is the recession coefficient of the baseflow the second part of eq a 1 is the infiltration function which translates the effects of surface recharge to the spring through the unsaturated zone somewhat modified by its passage through the saturated zone padilla et al 1994 the infiltration function is defined by an empirical function as follows a 3 where ψt l3t 1 indicates the quick flow at time t q 0 l3t 1 is the initial infiltration flow rate in other words the difference between the total discharge qmax and the baseflow component by extrapolation at time t 0 ɳ is equal to 1 ti in fact the infiltration function is defined between t 0 and ti 1 ɳ which indicates the duration of quick flow and ɛ determines the importance of the concavity of the quick flow curve in t 1 and indicates the flow heterogeneity el hakim and bakalowicz 2007 mangin defines the variable yt as follows a 4 yt at t 2 days is defined as i index infiltration delay which varies between 0 and 1 in fact i index making a distinction between systems that are affected by a mainly fast infiltration i tending toward 0 and systems that are affected by slow or delayed infiltration i tending toward 1 el hakim and bakalowicz 2007 the initial total volume v0 l3 in the beginning of the hydrograph recession curve is defined by the sum of the initial dynamic volume of the baseflow v 0 b and the quick flow volume v 0 padilla et al 1994 a 5 v 0 b q 0 α a 6 appendix b supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2023 129441 appendix b supplementary data the following are the supplementary data to this article supplementary data 1 
2053,with the development of sophisticated water quality models and the advances in computational power data assimilation da techniques especially ensemble based methods the ensemble kalman filter and particle filter are attracting considerable attention in water quality modeling for improving the estimation of state variables and parameters in water quality models the ensemble kalman filter enkf has become the most popular da method while the particle filter pf which does not rely on gaussian or quasi linearity assumptions is seldom applied in water quality modeling here we present a comparison between the pf and enkf for the update of model parameters related to river metabolism the two filters are implemented in prose pa a hydro biogeochemical software and their performance is assessed on two synthetic case studies the results indicate that pf and enkf can estimate dissolved oxygen concentrations and the posterior probability distribution function of the associated parameters either precisely for both filters in the case of a slightly nonlinear system reaeration at the air water interface or more precisely for the pf in the case of a strongly nonlinear system organic matter degradation dominated by heterotrophic bacterial activities since the pf is more accurate its usage is recommended for water quality modeling and guidelines are provided for its set up keywords water quality modeling data assimilation parameter estimation particle filter ensemble kalman filter prose pa software data availability no data was used for the research described in the article 1 introduction with the development of sophisticated water quality models warn 1987 hamrick 1992 billen et al 1994 whitehead et al 1997 even et al 1998 pelletier et al 2006 complete and complex biogeochemical processes of an aquatic system can be simulated to understand its biogeochemical functioning flipo et al 2004 vilmin et al 2015a 2016 bae and seo 2018 sadeghian et al 2018 marescaux et al 2020 however a large number of model parameters are incorporated into these models to describe exhaustively the biogeochemical processes this raises the question of prediction uncertainty beven 1989 polus et al 2011 cho et al 2020 the model parameters need to be determined experimentally in the laboratory or calibrated by minimizing a loss function which leads to problems of model validation and extrapolation arhonditsis and brett 2004 polus et al 2011 to improve model performance data assimilation techniques have been applied successfully in geosciences carrassi et al 2018 and more specifically in water quality modeling wang et al 2022 cho et al 2020 evensen et al 2022 also dedicated a book to the problem of state and parameter estimation in data assimilation the data assimilation method combines ongoing observation data and model forecasts to obtain the optimal estimates of state variables and parameters of water quality models wikle and berliner 2007 although numerous data assimilation methods exist in the literature variational methods kalman filter extended kalman filter ensemble kalman filter particle filter and have been widely applied in meteorology and hydrology modeling courtier et al 1994 kalnay et al 1996 gauthier et al 2007 moradkhani et al 2005a plaza et al 2012 abbaszadeh et al 2018 piazzi et al 2021 few applications of data assimilation can be found in surface water quality modeling cho et al 2020 the first application of data assimilation was published by beck and young 1976 using the extended kalman filter ekf the ekf was then used as the main data assimilation technique in water quality modeling until 2009 mao et al 2009 with the advances in computational power the ensemble kalman filter enkf has become the most popular data assimilation method in surface water quality modeling huang et al 2013 kim et al 2014 huang and gao 2017 page et al 2018 chen et al 2019 loos et al 2020 park et al 2020 most of the cited studies focused on the simulation of harmful algal blooms the first implementation of a particle filter pf for water quality modeling was released very recently by wang et al 2019 and offers promising perspectives that should favor its usage across the freshwater community the enkf is based on the assumption that the forecasts of water quality states and model parameters are normally distributed and it updates them by linear formulas evensen 2003 in nonlinear systems such as the modeling of an aquatic system the gaussian assumption cannot hold all the time and therefore enkf yields biased samples and estimates wikle and berliner 2007 this assumption has been questioned also in the modeling of hydrologic systems and phytoplankton dynamics plaza et al 2012 pasetto et al 2012 huang et al 2013 these authors recommended testing the pf a more advanced method in order to overcome this problem nonetheless the pf has been applied only by wang et al 2022 for assimilating dissolved oxygen do concentrations in the seine river system seemingly because the scientific community believes that the pf is more computationally demanding and is not easy to implement in addition no comparison between the pf and enkf can be found in surface water quality modeling specifically in do data assimilation and model parameter estimation which may be one of the reasons that the application of pfs in water quality modeling is so rare the aim of this paper is therefore to carry out a comparison of the pf and enkf for do data assimilation and for the estimation of model parameters the performances of the pf and enkf are evaluated on the basis of synthetic case studies using the hydro biogeochemical program prose pa wang et al 2019 first the recovery of do concentrations by reaeration in a river system is built to model a slightly nonlinear system section 2 4 1 the computational time the simulated do concentrations and the posterior distributions of the reaeration coefficient using different ensemble sizes are assessed section 3 1 second the pf and enkf are applied in a strongly nonlinear system represented by heterotrophic bacterial activities in the river section 2 4 2 the uncertainties in parameter estimation and the pf set up are finally discussed sections 4 2 and 4 3 2 material and methods 2 1 prose pa software the prose pa prose for parallel computing and data assimilation wang et al 2019 software couples the prose model even et al 1998 2004 flipo et al 2004 vilmin et al 2015a which is the historical model widely used to investigate the biogeochemical functioning of the seine river system even et al 1998 2004 2007 flipo et al 2007 polus et al 2011 raimonet et al 2015 vilmin et al 2015b 2018 with data assimilation frameworks fig 1 prose pa is composed of three independent c libraries hydrodynamic transport and biogeochemistry fig 1 the hydrodynamic library calculates water heights and discharges by solving the 1d shallow water equations advection and dispersion are modeled using the hydraulic data calculated by the hydrodynamic library the biogeochemistry library c rive is based on the community centered rive model billen et al 1994 garnier et al 1995 the rive model simulates biogeochemical processes such as the cycles of nutrients carbon and do in the water column and in an unconsolidated sediment layer to assimilate high frequency oxygen concentration and to estimate model parameters a pf was first implemented in prose pa wang et al 2019 2022 and more recently an enkf filter as well 2 2 sequential data assimilation frameworks in prose pa particle filter and ensemble kalman filter before describing each data assimilation framework we introduce the state space model on which each framework depends 2 2 1 state space model a state space model is a mathematical representation of the evolution of a system over time as a set of input output and state variables kalman 1960 in our case three equations are used to describe the evolution of do concentrations state variable in terms of physics let x be the random variable representing the model parameters and let y represent the simulated do concentrations the random variables x and y are characterized by their probability distribution function pdf 1 x t x t 1 η t 2 y t m y t 1 μ t x t ν t 3 y t hy t ϵ t lower case x and y correspond to realizations of the random variables x and y the observation vector y denotes a realization of the random variable y the variables ν t and ϵ t stand for the unknown model errors and observation errors at time t eqs 2 and 3 the relative errors of the model are of the order 10 5 or 10 6 this is far below observation errors therefore no model errors are considered ν t 0 in our case the evolution of parameter values is described by a random walk η t which concurs with the prior knowledge of the parameters eq 1 h is the linear observation operator that maps simulations to observations 2 2 2 particle filter a pf was implemented in prose pa software and its efficiency was demonstrated in a synthetic case study wang et al 2019 and in a real system wang et al 2022 the pf is a method based on the bayes theorem bayes 1763 and the markov property markov 1906 it integrates observations y at each time step into the forward model prose pa in order to approximate the posterior pdf f x y by a set of particles each associated with a weight ω for each particle the weight is calculated using the bayes theorem and markov property doucet and johansen 2011 wang et al 2019 as stated by eq 4 4 ω t f y t x ω t 1 where f y t x is the likelihood that is the probability to observe y t given x at time t ω t 1 denotes the posterior weight at time t 1 that gives the prior knowledge at time t ω t is then the posterior weight at time t to approximate the filtering distribution f x t y 1 t the normalized weights ω ˆ t i ω t i ω t i are computed the f x t y 1 t can be approximated by the ensemble particles doucet et al 2001 5 f x t y 1 t i 1 n ω ˆ t i δ x t i where n is the ensemble size and δ the dirac measure assuming that the observation errors eq 3 ϵ t are gaussian and mutually independent at each observation station we compute the likelihood f y t x i using the probability density function of the multivariate normal distribution eq 6 6 ln l y t x t i m 2 ln 2 π 1 2 ln σ 1 2 y t hy t i t σ 1 y t hy t i f y t x t i l y t x t i i 1 n l y t x t i where m is the number of monitoring stations and i represents the particle i the linear observation operator h maps the simulated do concentrations at the monitoring sites h y t i σ corresponds to the error covariance matrix of the observations since the set of observation errors is mutually independent σ is a diagonal matrix and the diagonal terms correspond to the variance of the measurement errors at each monitoring station a common problem when applying the pf is the degeneracy of the particles this means that almost all the particles get a near zero weight and only a few particles or none has a high weight after a given simulation time in such case the posterior pdf f x t y 1 t cannot be approximated adequately by the ensemble particles eq 5 to reduce the degeneracy effect a resampling procedure is used the resampling procedure roughly duplicates particles with high weights while eliminating particles with near zero weights a series of resampling methods were proposed in the literature and reviewed by li et al 2015 the systematic resampling technique kitagawa 1996 moradkhani et al 2005a li et al 2015 was chosen for the prose pa software it is not necessary to resample the particles at each time step but only when the particles show some signs of degeneracy the criterion for performing the resampling is based on the variance of the weights which indicates the degree of degeneracy kong et al 1994 defined the effective sample size n e f f to monitor the degree of degeneracy the effective sample size can be approximated as follows from the normalized weights 7 n e f f 1 i 1 n ω t i 2 the particle resampling is carried out once n e f f falls below a user defined threshold n t h r e s α n the n e f f itself has a maximum value of n number of particles and a minimum value of 1 since the systematic resampling technique is used in prose pa the weights are reset to 1 n after resampling in particle filtering we consider posterior parameter values at time t 1 as prior parameter values at time t which means that the random variable η t in eq 1 equals 0 x t x t 1 the posterior distribution f x t y 1 t evolves with the particle weights however the particles that have high weights may be duplicated many times during resampling which results in sample impoverishment to restore the diversity of the particles a random perturbation is added to the parameter values after particle resampling eq 8 8 x t 1 i x t r e s a m p l i n g i η t i η t i n 0 s φ 2 where s is a user defined parameter and φ is the range space of parameters 2 2 3 ensemble kalman filter the enkf algorithm evensen 1994 2003 like the traditional kalman filter consists of two sequential steps forecast and analysis during the forecast step the model ensemble is propagated forward in time using the prior model state and parameter values eq 2 then the model state and parameter values are updated using the linear kalman filter analysis formula eq 9 in our case only the parameter values are updated during the analysis step to ensure the continuity of mass balance which is crucial for water quality modeling 9 x t a x t f k t y t hy t 10 x t f x t 1 a η t where x t a r p n are the analysis values of the parameters posterior with p the number of parameters x t f r p n denotes the forecast parameter values prior and k t r p n represents the kalman gain matrix the forecast parameter values x t f r p n are obtained by adding the random values to the analyzed parameter values x t a r p n eq 10 the ensemble random values with ensemble mean equal to 0 are noted as η t n 0 s φ 2 the kalman gain matrix is calculated as follows burgers et al 1998 evensen et al 2022 11 k t p t f h t hp t f h t r t 1 where p t f and r t represent the error covariance matrices of forecast and observation at time t for parameter estimation the above form of kalman gain can be rewritten moradkhani et al 2005b huang et al 2013 12 k t σ t xy σ t yy σ t y y 1 where σ t xy r p m is the cross covariance matrix of the parameter ensemble x t r p n and the forecast ensemble state at monitoring stations hy t r m n σ t yy r m m denotes the error covariance matrix of the prediction at monitoring stations hy t and σ t y y r m m is the observation error covariance matrix in enkf the error statistics are represented using an ensemble model state evensen 1994 burgers et al 1998 evensen 2003 evensen et al 2022 the true state is generally unknown and estimated by the ensemble mean consequently the unknown error covariance matrix of the forecast state σ t yy can be estimated as follows 13 σ t yy 1 n 1 i 1 n h y t i hy t h y t i hy t t 1 n 1 hy t hy t hy t hy t t where σ t yy has dimension m m where m is the number of monitoring stations n is the ensemble size and h y t i r m 1 corresponds to the predicted states of the ensemble member i at m monitoring stations the ensemble mean is calculated as hy t r m 1 1 n i 1 n h y t i the observation errors defined in eq 3 can be obtained by perturbing the observation values y t i y t ϵ t i r m 1 the ensemble of perturbations with ensemble mean equal to 0 can be noted as ϵ t r m n an estimator of the observation error covariance matrix σ t y y r m m can then be constructed using the ensemble perturbations evensen 2003 evensen et al 2022 14 σ t y y 1 n 1 i 1 n ϵ t i ϵ t i t 15 1 n 1 ϵ t ϵ t t similarly the cross covariance matrix of parameter ensembles and forecast state ensembles σ t xy r p m is estimated as evensen 2003 evensen et al 2022 16 σ t xy 1 n 1 i 1 n x t i x t h y t i hy t t 1 n 1 x t x t hy t hy t t where x t r p 1 1 n i 1 n x t i the above three covariance matrix estimates are then plugged into 12 to compute an approximation of the kalman gain 2 3 description of the case study geometric and hydraulic data a trapezoid shaped river channel which is 100 km long fig 2b is conceptualized to mimic the seine river the trapezoid shaped cross section has a bottom base of 100 m and top base of 120 m fig 2a a discharge of 95 m 3 s 1 corresponding to a water velocity of 0 17 m s 1 is imposed upstream the river bed slope and water height corresponding to these values are 10 6 and 5 m respectively no inflows and dams are considered in the case study the concept of kilometric point pk is used in prose pa to represent the location of a point in the river channel the downstream and upstream points have pks of 100 and 0 respectively fig 2b 2 4 data assimilation scenarios from oxygen reaeration to bacterial activities 2 4 1 recovery of do by reaeration the physical oxygen reaeration is modeled as 17 d o 2 d t k r e a h o 2 s a t t o 2 18 k r e a d m v w h k w i n d v w i n d 2 23 d m 1 0 4 2 3 k n a v i g with k r e a reaeration coefficient m s 1 o 2 s a t t saturation concentration of do at temperature t mgo 2 l 1 o 2 do concentration mgo 2 l 1 h water height m d m molecular diffusivity of dissolved oxygen m 2 s 1 v w and v w i n d water velocity and wind speed m s 1 k w i n d and k n a v i g reaeration coefficients related to wind and navigation m s 1 the oxygen reaeration coefficient k r e a is composed of three terms molecular diffusion d m wind turbulence k w i n d and navigation turbulence k n a v i g only k n a v i g which was identified as the most influential parameter in do concentrations in winter wang et al 2018 is estimated using pf and enkf in this case the wind speed at 10 m elevation is considered null a k n a v i g value of 0 015 m h 1 as the reference parameter value is used to generate observation data a period of 15 days is simulated with prose pa to simulate varying oxygen saturation concentrations the water temperature is set to 10 c o 2 s a t 11 29 mgo 2 l 1 from day 0 to day 5 and then increases to 20 c o 2 s a t 9 11 mgo 2 l 1 on day 15 the initial and upstream oxygen concentrations are set to 3 80 mgo 2 l 1 table 1 which enables a simulation of the recovery of do by reaeration 2 4 2 bacterial activities the rive model simulates explicitly the heterotrophic bacterial activities growth respiration and mortality a monod function monod 1949 is used to describe the growth of heterotrophic bacteria limited by small monomeric substrate concentration s m s the bacterial respiration is expressed as 19 d o 2 d t τ 1 y u p t u p t 1 y μ m a x e t t o p t 2 σ 2 s m s s m s k s m s h b with τ 32 12 when considering the full oxidation of organic matter by the respiration process mgo 2 mgc y bacteria growth yield u p t uptake of small monomeric substrate for bacteria growth mgc l 1 h 1 μ m a x maximum growth rate h 1 t and t o p t water temperature and optimal water temperature for bacteria growth c k s m s half saturation constant for small monomeric substrate mgc l 1 h b heterotrophic bacterial biomass mgc l 1 the do concentrations are most sensitive to μ m a x and y when bacterial activities drive the river metabolism during low flow periods wang et al 2018 therefore only μ m a x and y are considered when evaluating the performances of pf and enkf to simulate the strong bacterial activities the water temperature is the same as the optimal temperature for the growth of bacteria t o p t 20 c during the simulation the do concentrations are initially saturated in the system 9 11 mgo 2 l 1 the upstream do concentrations are constant and saturated during the simulation table 1 the initial and upstream conditions of small monomeric substrate s m s and bacteria h b are listed in table 1 a maximum growth rate of 0 04 h 1 and a growth yield of 0 15 are used to generate observation data 2 4 3 mimicking oxygen monitoring as mentioned above only k n a v i g is considered for oxygen reaeration simulation while μ m a x and y are considered for the simulation of bacterial activities reference values of those parameters table 2 are used to generate reference oxygen data o 2 r e f every 15 min fig 2b in all model cells with a forward simulation of prose pa a random noise is added to those reference data at locations pk60 and pk90 in order to mimic data acquired by monitoring systems o 2 o b s which are entailed by observational errors the observational errors are defined in eq 20 20 o 2 o b s o 2 r e f θ θ n 0 0 01 o 2 r e f 2 2 5 statistical criteria for evaluating the performances of pf and enkf in do simulation two monitoring stations of do pk60 and pk90 and two validation stations pk50 and pk75 are modeled fig 2 the data from the monitoring stations are assimilated by prose pa either by a pf or an enkf the performances of pf and enkf in the simulation of do concentrations are evaluated through rmse root mean square error and kge kling gupta efficiency kling et al 2012 at the validation stations pk50 pk75 for completeness the values of the criteria are also provided at the monitoring stations rmse is the standard deviation of the simulation errors eq 21 the kge is based on the decomposition of the nash sutcliffe efficiency which provides the analysis of the relative importance of its different components correlation bias and variability kge ranges from inf to 1 the closer to 1 the more accurate the model 21 rmse k 1 n o b s o 2 s i m k o 2 o b s k 2 n o b s 22 kge 1 r 1 2 β 1 2 γ 1 2 where n o b s number of observations o 2 s i m k and o 2 o b s k simulated and observed do concentrations r correlation coefficient β model bias β μ s i m μ o b s with μ the mean of the do concentrations γ coefficient of variation γ σ s i m μ s i m σ o b s μ o b s with σ the standard deviation of the do concentrations 2 6 visualization of the filtering distributions of the considered parameters to visualize the filtering distributions eq 5 kernel density estimation is used to determine the results of pf while a normal distribution is assumed for the results of enkf which can be calculated using the ensemble mean and standard deviation wikle and berliner 2007 to compare the results of pf obtained using different random perturbations given the ensemble size a identical bandwidth is used in the kernel density estimation 3 results 3 1 oxygen reaeration due to navigation slightly nonlinear system 3 1 1 calculation time nine simulations with different ensemble sizes 10 30 50 100 150 200 300 400 500 are realized to compare the calculation time of pf and enkf fig 3 both pf and enkf simulations are run with 20 threads intel r xeon r cpu e5 2640 v4 2 40 ghz and a time step of 15 min for a simulation period of 15 days no significant differences in the calculation time between pf and enkf can be observed when the ensemble size is smaller than 100 fig 3 however the calculation time using pf is lower by 25 compared to the calculation time using enkf when the ensemble size is greater than 100 when the ensemble size increases more time is indeed needed to compute the error covariance matrices σ t xy and σ t yy and solve the related linear systems 3 1 2 simulated do concentrations all simulations with pf can retrieve the do concentrations very accurately at all stations even with an ensemble size of 10 given the remarkable similarity of the results obtained across all stations and ensemble sizes only the results at station pk75 are shown here fig 5 for pf a maximum rmse of 0 02 mgo 2 l 1 is estimated at station pk50 fig 4 which is rather small compared to the observation errors standard deviations between 0 038 mgo 2 l 1 and 0 08 mgo 2 l 1 eq 20 all kges are over 0 99 for pf the rmse for enkf first decreases and then increases with the ensemble size its minimum value around 0 10 mgo 2 l 1 is obtained with the ensemble sizes of 200 and 300 fig 4 while being relatively close to the observation errors with the ensemble size of 300 maximum values of kge are obtained for enkf even though the pf is remarkably accurate the two filters capture the recovery of do by reaeration and obtain satisfactory results fig 5 3 1 3 estimated posterior distributions of k n a v i g with an ensemble size of 300 both pf and enkf produce satisfactory posterior distributions of k n a v i g fig 6 the reference value of k n a v i g 0 015 m h 1 is well characterized by the modes of the distributions however the distributions estimated by pf are much narrower than those estimated by enkf which are relatively broad fig 6 the simulated oxygen concentrations and posterior distributions of k n a v i g show that pf and enkf work well for a slightly nonlinear system oxygen recovery by reaeration even though pf estimates carry less uncertainty 3 2 heterotrophic bacterial activities strongly nonlinear system in this case a series of simulations are carried out with different ensemble sizes 100 300 400 500 800 and 1000 a minimum ensemble size of 500 is deemed imperative for obtaining desirable results only the results with the ensemble size of 500 are presented in this section a perturbation of s 0 01 eq 8 yield satisfactory results for pf while a perturbation of s 0 03 is needed for enkf the results show that pf performs much better than enkf when the bacterial activities control the river metabolism strongly nonlinear system both in the identification of parameter values and in the retrieval of do concentrations 3 2 1 simulated oxygen concentrations the simulated oxygen concentrations ensemble mean show that pf performs better than enkf under conditions of strong bacterial activities fig 7 all rmses are smaller than 0 02 mgo 2 l 1 table 3 for pf while all rmses are over 0 18 mgo 2 l 1 table 3 which is higher than the observation errors around 0 08 mgo 2 l 1 the analysis of the kges confirms the fact that the pf outperforms the enkf the results indicate that enkf can capture the depletion of oxygen trend but it struggles to retrieve the do concentrations correctly 3 2 2 estimated posterior distributions the estimated posterior distribution of μ m a x and y confirms the efficiency of pf for estimating parameters in a water quality model which is usually a strongly nonlinear system the parameter values of μ m a x and y 0 04 h 1 and 0 015 respectively used to generate observation data are very well identified by the pf fig 8 while the enkf fails to identify the bacterial yield y and slightly overestimates the value of μ m a x 0 04 h 1 with a much broader pdf than the pf fig 8 4 discussion 4 1 recommendations for data assimilation in water quality modeling although the ensemble kalman filter enkf has become the most popular data assimilation method for updates of state variables and model parameters in surface water quality modeling cho et al 2020 the results of this research show that the particle filter pf outperforms the enkf for parameter inference and oxygen concentration estimation especially in a strongly nonlinear system as for heterotrophic bacteria activity which is one of the main drivers of river metabolism odum 1956 escoffier et al 2018 also in ocean biogeochemical modeling gharamti et al 2017 indicate that the uncertainty associated with the state estimates using two enkf based methods increases during the spring blooms strongly nonlinear behavior that is because the enkf assumes gaussian errors for forecast states and parameters which is not realistic for the functioning of an aquatic system lake river huang et al 2013 wang et al 2022 evensen et al 2022 p 95 also stated that commonly used ensemble data assimilation methods like the enkf only sample the posterior pdf correctly in the gauss linear case and typically fail in cases with strong nonlinearity the pf overcomes the gaussian assumption of enkf the implementation of pf into a complex hydro biogeochemical program prose pa has been proved to be realistic wang et al 2019 and its performance calculation cost do concentration updates parameter estimation has been recently evaluated for the seine river system france wang et al 2022 therefore the authors recommend the use of pf for the update of biogeochemical state variables and model parameters in surface water quality modeling 4 2 uncertainties in parameter estimation pf vs enkf both pf and enkf are able to quantify the parameter uncertainties in a slightly nonlinear system oxygen reaeration these uncertainties are characterized by the posterior pdfs of the parameters with a random perturbation of s 0 10 eqs 10 and 8 the distributions estimated by enkf are broader than those estimated by pf fig 6 and thus depict larger uncertainties that is because the ensemble members in enkf are equally weighted and the posterior distribution is assumed to be gaussian and characterized by its first two moments mean and variance wikle and berliner 2007 compared with weighted ensemble members in pf eq 5 the assumption of equally weighted samples in enkf is generally not valid and results in biased samples wikle and berliner 2007 the uncertainties in parameter estimation result from multiple reasons for pf such as observation error or perturbation after resampling eq 8 a sensitivity assessment of the perturbation parameter after resampling s eq 8 for the case of oxygen recovery is realized to compare the estimated distributions with different random walks a fixed bandwidth 0 00011 is used in the kernel density estimation fig 9 the results show that a perturbation of s 0 01 enables a perfect estimation of k n a v i g fig 9 the posterior distributions of k n a v i g are narrow which depicts small estimation uncertainties however when increasing the random walk s 0 02 s 0 05 and s 0 10 the posterior distributions become increasingly spread out fig 9 which corresponds to an increase in parameter uncertainties with larger perturbations 4 3 impact of random walk precision and capacity of pf as shown above a small perturbation s 0 01 enables a perfect estimation of oxygen concentration and parameters both in slightly nonlinear systems and strongly nonlinear systems in other words the precision of the results is high that is because the parameter values are stationary during the simulation once the posterior distribution eq 5 is well approximated by the ensemble it is no longer necessary to explore the parameter space however the capacity of the filter with a small random walk perturbation parameter to respond to fast changes in the parameters remains questionable a change of parameter values was reported in the evolution of microorganism communities especially in the development of phytoplankton mao et al 2009 huang et al 2013 wang et al 2022 to illustrate a time varying parameter an extreme scenario mimicking the shift of k n a v i g value from 0 015 m h 1 to 0 03 m h 1 on day 5 is designed fig 10 with a small random walk s 0 01 the filter needs 9 days to capture the change in k n a v i g value and large discrepancies between simulated and reference do concentrations are obtained during this period when increasing the random walk s 0 05 the filter takes 3 days to respond to the fast change in k n a v i g value and the simulated do concentrations ensemble mean are satisfactory once the filter is stabilized the precision with a small random walk is higher than that with a large random walk nevertheless the small random walk may stay stuck in a local maximum in the case of multimodal posterior distribution in this case the ensemble cannot characterize the posterior distribution adequately and larger random walks are recommended to allow for a maximum search of the posterior distribution moradkhani et al 2012 it should be also noted that a larger random walk after the resampling step could result in an overspread ensemble biased samples which cannot account adequately for the prior distribution therefore it is crucial to find a good balance between the precision and the ability of parameter space exploration in the pf further studies can focus on improving the resampling perturbation procedure using more advanced techniques such as the auxiliary particle filter pitt and shephard 1999 johansen and doucet 2008 which performs the resampling at time step t 1 using the available measurement at time step t or the mcmc moves with the metropolis acceptance ratio to determine whether to accept a proposed sample metropolis et al 1953 hastings 1970 gilks and berzuini 2001 doucet and johansen 2011 moradkhani et al 2012 5 conclusions to compare the performances of pf and enkf for the updates of water quality states and model parameters the pf and enkf implemented in the hydro biogeochemical program prose pa were assessed via two synthetic case studies the main conclusions are given below pf is recommended for the updates of do concentrations and model parameters in surface water quality modeling for quasi linear oxygen reaeration inference both pf and enkf can capture the recovery of do by reaeration and identify the reaeration coefficient but the uncertainty associated with oxygen and parameter estimates obtained using enkf is larger than that obtained using pf the calculation time using pf is lower by 25 compared to enkf when the ensemble size is more than 100 for nonlinear bacterial activities inference pf shows a high efficiency for both the simulation of do concentrations and the estimation of bacteria related parameters while it is difficult to retrieve the do concentrations and estimate the parameter values properly with the enkf the small random walk after the resampling procedure in pf yields high precision of oxygen and parameter estimates while a larger random walk is necessary to capture efficiently the fast change in the parameters it is thus important to find a good balance between precision and the ability of the parameter search credit authorship contribution statement shuaitao wang conceptualization methodology software validation formal analysis investigation writing original draft visualization nicolas flipo conceptualization methodology software formal analysis writing review editing supervision funding acquisition thomas romary conceptualization methodology formal analysis writing review editing supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work is a contribution to the piren seine research program https www piren seine fr part of the french long term socio ecological research ltser site zones ateliers seine 
2053,with the development of sophisticated water quality models and the advances in computational power data assimilation da techniques especially ensemble based methods the ensemble kalman filter and particle filter are attracting considerable attention in water quality modeling for improving the estimation of state variables and parameters in water quality models the ensemble kalman filter enkf has become the most popular da method while the particle filter pf which does not rely on gaussian or quasi linearity assumptions is seldom applied in water quality modeling here we present a comparison between the pf and enkf for the update of model parameters related to river metabolism the two filters are implemented in prose pa a hydro biogeochemical software and their performance is assessed on two synthetic case studies the results indicate that pf and enkf can estimate dissolved oxygen concentrations and the posterior probability distribution function of the associated parameters either precisely for both filters in the case of a slightly nonlinear system reaeration at the air water interface or more precisely for the pf in the case of a strongly nonlinear system organic matter degradation dominated by heterotrophic bacterial activities since the pf is more accurate its usage is recommended for water quality modeling and guidelines are provided for its set up keywords water quality modeling data assimilation parameter estimation particle filter ensemble kalman filter prose pa software data availability no data was used for the research described in the article 1 introduction with the development of sophisticated water quality models warn 1987 hamrick 1992 billen et al 1994 whitehead et al 1997 even et al 1998 pelletier et al 2006 complete and complex biogeochemical processes of an aquatic system can be simulated to understand its biogeochemical functioning flipo et al 2004 vilmin et al 2015a 2016 bae and seo 2018 sadeghian et al 2018 marescaux et al 2020 however a large number of model parameters are incorporated into these models to describe exhaustively the biogeochemical processes this raises the question of prediction uncertainty beven 1989 polus et al 2011 cho et al 2020 the model parameters need to be determined experimentally in the laboratory or calibrated by minimizing a loss function which leads to problems of model validation and extrapolation arhonditsis and brett 2004 polus et al 2011 to improve model performance data assimilation techniques have been applied successfully in geosciences carrassi et al 2018 and more specifically in water quality modeling wang et al 2022 cho et al 2020 evensen et al 2022 also dedicated a book to the problem of state and parameter estimation in data assimilation the data assimilation method combines ongoing observation data and model forecasts to obtain the optimal estimates of state variables and parameters of water quality models wikle and berliner 2007 although numerous data assimilation methods exist in the literature variational methods kalman filter extended kalman filter ensemble kalman filter particle filter and have been widely applied in meteorology and hydrology modeling courtier et al 1994 kalnay et al 1996 gauthier et al 2007 moradkhani et al 2005a plaza et al 2012 abbaszadeh et al 2018 piazzi et al 2021 few applications of data assimilation can be found in surface water quality modeling cho et al 2020 the first application of data assimilation was published by beck and young 1976 using the extended kalman filter ekf the ekf was then used as the main data assimilation technique in water quality modeling until 2009 mao et al 2009 with the advances in computational power the ensemble kalman filter enkf has become the most popular data assimilation method in surface water quality modeling huang et al 2013 kim et al 2014 huang and gao 2017 page et al 2018 chen et al 2019 loos et al 2020 park et al 2020 most of the cited studies focused on the simulation of harmful algal blooms the first implementation of a particle filter pf for water quality modeling was released very recently by wang et al 2019 and offers promising perspectives that should favor its usage across the freshwater community the enkf is based on the assumption that the forecasts of water quality states and model parameters are normally distributed and it updates them by linear formulas evensen 2003 in nonlinear systems such as the modeling of an aquatic system the gaussian assumption cannot hold all the time and therefore enkf yields biased samples and estimates wikle and berliner 2007 this assumption has been questioned also in the modeling of hydrologic systems and phytoplankton dynamics plaza et al 2012 pasetto et al 2012 huang et al 2013 these authors recommended testing the pf a more advanced method in order to overcome this problem nonetheless the pf has been applied only by wang et al 2022 for assimilating dissolved oxygen do concentrations in the seine river system seemingly because the scientific community believes that the pf is more computationally demanding and is not easy to implement in addition no comparison between the pf and enkf can be found in surface water quality modeling specifically in do data assimilation and model parameter estimation which may be one of the reasons that the application of pfs in water quality modeling is so rare the aim of this paper is therefore to carry out a comparison of the pf and enkf for do data assimilation and for the estimation of model parameters the performances of the pf and enkf are evaluated on the basis of synthetic case studies using the hydro biogeochemical program prose pa wang et al 2019 first the recovery of do concentrations by reaeration in a river system is built to model a slightly nonlinear system section 2 4 1 the computational time the simulated do concentrations and the posterior distributions of the reaeration coefficient using different ensemble sizes are assessed section 3 1 second the pf and enkf are applied in a strongly nonlinear system represented by heterotrophic bacterial activities in the river section 2 4 2 the uncertainties in parameter estimation and the pf set up are finally discussed sections 4 2 and 4 3 2 material and methods 2 1 prose pa software the prose pa prose for parallel computing and data assimilation wang et al 2019 software couples the prose model even et al 1998 2004 flipo et al 2004 vilmin et al 2015a which is the historical model widely used to investigate the biogeochemical functioning of the seine river system even et al 1998 2004 2007 flipo et al 2007 polus et al 2011 raimonet et al 2015 vilmin et al 2015b 2018 with data assimilation frameworks fig 1 prose pa is composed of three independent c libraries hydrodynamic transport and biogeochemistry fig 1 the hydrodynamic library calculates water heights and discharges by solving the 1d shallow water equations advection and dispersion are modeled using the hydraulic data calculated by the hydrodynamic library the biogeochemistry library c rive is based on the community centered rive model billen et al 1994 garnier et al 1995 the rive model simulates biogeochemical processes such as the cycles of nutrients carbon and do in the water column and in an unconsolidated sediment layer to assimilate high frequency oxygen concentration and to estimate model parameters a pf was first implemented in prose pa wang et al 2019 2022 and more recently an enkf filter as well 2 2 sequential data assimilation frameworks in prose pa particle filter and ensemble kalman filter before describing each data assimilation framework we introduce the state space model on which each framework depends 2 2 1 state space model a state space model is a mathematical representation of the evolution of a system over time as a set of input output and state variables kalman 1960 in our case three equations are used to describe the evolution of do concentrations state variable in terms of physics let x be the random variable representing the model parameters and let y represent the simulated do concentrations the random variables x and y are characterized by their probability distribution function pdf 1 x t x t 1 η t 2 y t m y t 1 μ t x t ν t 3 y t hy t ϵ t lower case x and y correspond to realizations of the random variables x and y the observation vector y denotes a realization of the random variable y the variables ν t and ϵ t stand for the unknown model errors and observation errors at time t eqs 2 and 3 the relative errors of the model are of the order 10 5 or 10 6 this is far below observation errors therefore no model errors are considered ν t 0 in our case the evolution of parameter values is described by a random walk η t which concurs with the prior knowledge of the parameters eq 1 h is the linear observation operator that maps simulations to observations 2 2 2 particle filter a pf was implemented in prose pa software and its efficiency was demonstrated in a synthetic case study wang et al 2019 and in a real system wang et al 2022 the pf is a method based on the bayes theorem bayes 1763 and the markov property markov 1906 it integrates observations y at each time step into the forward model prose pa in order to approximate the posterior pdf f x y by a set of particles each associated with a weight ω for each particle the weight is calculated using the bayes theorem and markov property doucet and johansen 2011 wang et al 2019 as stated by eq 4 4 ω t f y t x ω t 1 where f y t x is the likelihood that is the probability to observe y t given x at time t ω t 1 denotes the posterior weight at time t 1 that gives the prior knowledge at time t ω t is then the posterior weight at time t to approximate the filtering distribution f x t y 1 t the normalized weights ω ˆ t i ω t i ω t i are computed the f x t y 1 t can be approximated by the ensemble particles doucet et al 2001 5 f x t y 1 t i 1 n ω ˆ t i δ x t i where n is the ensemble size and δ the dirac measure assuming that the observation errors eq 3 ϵ t are gaussian and mutually independent at each observation station we compute the likelihood f y t x i using the probability density function of the multivariate normal distribution eq 6 6 ln l y t x t i m 2 ln 2 π 1 2 ln σ 1 2 y t hy t i t σ 1 y t hy t i f y t x t i l y t x t i i 1 n l y t x t i where m is the number of monitoring stations and i represents the particle i the linear observation operator h maps the simulated do concentrations at the monitoring sites h y t i σ corresponds to the error covariance matrix of the observations since the set of observation errors is mutually independent σ is a diagonal matrix and the diagonal terms correspond to the variance of the measurement errors at each monitoring station a common problem when applying the pf is the degeneracy of the particles this means that almost all the particles get a near zero weight and only a few particles or none has a high weight after a given simulation time in such case the posterior pdf f x t y 1 t cannot be approximated adequately by the ensemble particles eq 5 to reduce the degeneracy effect a resampling procedure is used the resampling procedure roughly duplicates particles with high weights while eliminating particles with near zero weights a series of resampling methods were proposed in the literature and reviewed by li et al 2015 the systematic resampling technique kitagawa 1996 moradkhani et al 2005a li et al 2015 was chosen for the prose pa software it is not necessary to resample the particles at each time step but only when the particles show some signs of degeneracy the criterion for performing the resampling is based on the variance of the weights which indicates the degree of degeneracy kong et al 1994 defined the effective sample size n e f f to monitor the degree of degeneracy the effective sample size can be approximated as follows from the normalized weights 7 n e f f 1 i 1 n ω t i 2 the particle resampling is carried out once n e f f falls below a user defined threshold n t h r e s α n the n e f f itself has a maximum value of n number of particles and a minimum value of 1 since the systematic resampling technique is used in prose pa the weights are reset to 1 n after resampling in particle filtering we consider posterior parameter values at time t 1 as prior parameter values at time t which means that the random variable η t in eq 1 equals 0 x t x t 1 the posterior distribution f x t y 1 t evolves with the particle weights however the particles that have high weights may be duplicated many times during resampling which results in sample impoverishment to restore the diversity of the particles a random perturbation is added to the parameter values after particle resampling eq 8 8 x t 1 i x t r e s a m p l i n g i η t i η t i n 0 s φ 2 where s is a user defined parameter and φ is the range space of parameters 2 2 3 ensemble kalman filter the enkf algorithm evensen 1994 2003 like the traditional kalman filter consists of two sequential steps forecast and analysis during the forecast step the model ensemble is propagated forward in time using the prior model state and parameter values eq 2 then the model state and parameter values are updated using the linear kalman filter analysis formula eq 9 in our case only the parameter values are updated during the analysis step to ensure the continuity of mass balance which is crucial for water quality modeling 9 x t a x t f k t y t hy t 10 x t f x t 1 a η t where x t a r p n are the analysis values of the parameters posterior with p the number of parameters x t f r p n denotes the forecast parameter values prior and k t r p n represents the kalman gain matrix the forecast parameter values x t f r p n are obtained by adding the random values to the analyzed parameter values x t a r p n eq 10 the ensemble random values with ensemble mean equal to 0 are noted as η t n 0 s φ 2 the kalman gain matrix is calculated as follows burgers et al 1998 evensen et al 2022 11 k t p t f h t hp t f h t r t 1 where p t f and r t represent the error covariance matrices of forecast and observation at time t for parameter estimation the above form of kalman gain can be rewritten moradkhani et al 2005b huang et al 2013 12 k t σ t xy σ t yy σ t y y 1 where σ t xy r p m is the cross covariance matrix of the parameter ensemble x t r p n and the forecast ensemble state at monitoring stations hy t r m n σ t yy r m m denotes the error covariance matrix of the prediction at monitoring stations hy t and σ t y y r m m is the observation error covariance matrix in enkf the error statistics are represented using an ensemble model state evensen 1994 burgers et al 1998 evensen 2003 evensen et al 2022 the true state is generally unknown and estimated by the ensemble mean consequently the unknown error covariance matrix of the forecast state σ t yy can be estimated as follows 13 σ t yy 1 n 1 i 1 n h y t i hy t h y t i hy t t 1 n 1 hy t hy t hy t hy t t where σ t yy has dimension m m where m is the number of monitoring stations n is the ensemble size and h y t i r m 1 corresponds to the predicted states of the ensemble member i at m monitoring stations the ensemble mean is calculated as hy t r m 1 1 n i 1 n h y t i the observation errors defined in eq 3 can be obtained by perturbing the observation values y t i y t ϵ t i r m 1 the ensemble of perturbations with ensemble mean equal to 0 can be noted as ϵ t r m n an estimator of the observation error covariance matrix σ t y y r m m can then be constructed using the ensemble perturbations evensen 2003 evensen et al 2022 14 σ t y y 1 n 1 i 1 n ϵ t i ϵ t i t 15 1 n 1 ϵ t ϵ t t similarly the cross covariance matrix of parameter ensembles and forecast state ensembles σ t xy r p m is estimated as evensen 2003 evensen et al 2022 16 σ t xy 1 n 1 i 1 n x t i x t h y t i hy t t 1 n 1 x t x t hy t hy t t where x t r p 1 1 n i 1 n x t i the above three covariance matrix estimates are then plugged into 12 to compute an approximation of the kalman gain 2 3 description of the case study geometric and hydraulic data a trapezoid shaped river channel which is 100 km long fig 2b is conceptualized to mimic the seine river the trapezoid shaped cross section has a bottom base of 100 m and top base of 120 m fig 2a a discharge of 95 m 3 s 1 corresponding to a water velocity of 0 17 m s 1 is imposed upstream the river bed slope and water height corresponding to these values are 10 6 and 5 m respectively no inflows and dams are considered in the case study the concept of kilometric point pk is used in prose pa to represent the location of a point in the river channel the downstream and upstream points have pks of 100 and 0 respectively fig 2b 2 4 data assimilation scenarios from oxygen reaeration to bacterial activities 2 4 1 recovery of do by reaeration the physical oxygen reaeration is modeled as 17 d o 2 d t k r e a h o 2 s a t t o 2 18 k r e a d m v w h k w i n d v w i n d 2 23 d m 1 0 4 2 3 k n a v i g with k r e a reaeration coefficient m s 1 o 2 s a t t saturation concentration of do at temperature t mgo 2 l 1 o 2 do concentration mgo 2 l 1 h water height m d m molecular diffusivity of dissolved oxygen m 2 s 1 v w and v w i n d water velocity and wind speed m s 1 k w i n d and k n a v i g reaeration coefficients related to wind and navigation m s 1 the oxygen reaeration coefficient k r e a is composed of three terms molecular diffusion d m wind turbulence k w i n d and navigation turbulence k n a v i g only k n a v i g which was identified as the most influential parameter in do concentrations in winter wang et al 2018 is estimated using pf and enkf in this case the wind speed at 10 m elevation is considered null a k n a v i g value of 0 015 m h 1 as the reference parameter value is used to generate observation data a period of 15 days is simulated with prose pa to simulate varying oxygen saturation concentrations the water temperature is set to 10 c o 2 s a t 11 29 mgo 2 l 1 from day 0 to day 5 and then increases to 20 c o 2 s a t 9 11 mgo 2 l 1 on day 15 the initial and upstream oxygen concentrations are set to 3 80 mgo 2 l 1 table 1 which enables a simulation of the recovery of do by reaeration 2 4 2 bacterial activities the rive model simulates explicitly the heterotrophic bacterial activities growth respiration and mortality a monod function monod 1949 is used to describe the growth of heterotrophic bacteria limited by small monomeric substrate concentration s m s the bacterial respiration is expressed as 19 d o 2 d t τ 1 y u p t u p t 1 y μ m a x e t t o p t 2 σ 2 s m s s m s k s m s h b with τ 32 12 when considering the full oxidation of organic matter by the respiration process mgo 2 mgc y bacteria growth yield u p t uptake of small monomeric substrate for bacteria growth mgc l 1 h 1 μ m a x maximum growth rate h 1 t and t o p t water temperature and optimal water temperature for bacteria growth c k s m s half saturation constant for small monomeric substrate mgc l 1 h b heterotrophic bacterial biomass mgc l 1 the do concentrations are most sensitive to μ m a x and y when bacterial activities drive the river metabolism during low flow periods wang et al 2018 therefore only μ m a x and y are considered when evaluating the performances of pf and enkf to simulate the strong bacterial activities the water temperature is the same as the optimal temperature for the growth of bacteria t o p t 20 c during the simulation the do concentrations are initially saturated in the system 9 11 mgo 2 l 1 the upstream do concentrations are constant and saturated during the simulation table 1 the initial and upstream conditions of small monomeric substrate s m s and bacteria h b are listed in table 1 a maximum growth rate of 0 04 h 1 and a growth yield of 0 15 are used to generate observation data 2 4 3 mimicking oxygen monitoring as mentioned above only k n a v i g is considered for oxygen reaeration simulation while μ m a x and y are considered for the simulation of bacterial activities reference values of those parameters table 2 are used to generate reference oxygen data o 2 r e f every 15 min fig 2b in all model cells with a forward simulation of prose pa a random noise is added to those reference data at locations pk60 and pk90 in order to mimic data acquired by monitoring systems o 2 o b s which are entailed by observational errors the observational errors are defined in eq 20 20 o 2 o b s o 2 r e f θ θ n 0 0 01 o 2 r e f 2 2 5 statistical criteria for evaluating the performances of pf and enkf in do simulation two monitoring stations of do pk60 and pk90 and two validation stations pk50 and pk75 are modeled fig 2 the data from the monitoring stations are assimilated by prose pa either by a pf or an enkf the performances of pf and enkf in the simulation of do concentrations are evaluated through rmse root mean square error and kge kling gupta efficiency kling et al 2012 at the validation stations pk50 pk75 for completeness the values of the criteria are also provided at the monitoring stations rmse is the standard deviation of the simulation errors eq 21 the kge is based on the decomposition of the nash sutcliffe efficiency which provides the analysis of the relative importance of its different components correlation bias and variability kge ranges from inf to 1 the closer to 1 the more accurate the model 21 rmse k 1 n o b s o 2 s i m k o 2 o b s k 2 n o b s 22 kge 1 r 1 2 β 1 2 γ 1 2 where n o b s number of observations o 2 s i m k and o 2 o b s k simulated and observed do concentrations r correlation coefficient β model bias β μ s i m μ o b s with μ the mean of the do concentrations γ coefficient of variation γ σ s i m μ s i m σ o b s μ o b s with σ the standard deviation of the do concentrations 2 6 visualization of the filtering distributions of the considered parameters to visualize the filtering distributions eq 5 kernel density estimation is used to determine the results of pf while a normal distribution is assumed for the results of enkf which can be calculated using the ensemble mean and standard deviation wikle and berliner 2007 to compare the results of pf obtained using different random perturbations given the ensemble size a identical bandwidth is used in the kernel density estimation 3 results 3 1 oxygen reaeration due to navigation slightly nonlinear system 3 1 1 calculation time nine simulations with different ensemble sizes 10 30 50 100 150 200 300 400 500 are realized to compare the calculation time of pf and enkf fig 3 both pf and enkf simulations are run with 20 threads intel r xeon r cpu e5 2640 v4 2 40 ghz and a time step of 15 min for a simulation period of 15 days no significant differences in the calculation time between pf and enkf can be observed when the ensemble size is smaller than 100 fig 3 however the calculation time using pf is lower by 25 compared to the calculation time using enkf when the ensemble size is greater than 100 when the ensemble size increases more time is indeed needed to compute the error covariance matrices σ t xy and σ t yy and solve the related linear systems 3 1 2 simulated do concentrations all simulations with pf can retrieve the do concentrations very accurately at all stations even with an ensemble size of 10 given the remarkable similarity of the results obtained across all stations and ensemble sizes only the results at station pk75 are shown here fig 5 for pf a maximum rmse of 0 02 mgo 2 l 1 is estimated at station pk50 fig 4 which is rather small compared to the observation errors standard deviations between 0 038 mgo 2 l 1 and 0 08 mgo 2 l 1 eq 20 all kges are over 0 99 for pf the rmse for enkf first decreases and then increases with the ensemble size its minimum value around 0 10 mgo 2 l 1 is obtained with the ensemble sizes of 200 and 300 fig 4 while being relatively close to the observation errors with the ensemble size of 300 maximum values of kge are obtained for enkf even though the pf is remarkably accurate the two filters capture the recovery of do by reaeration and obtain satisfactory results fig 5 3 1 3 estimated posterior distributions of k n a v i g with an ensemble size of 300 both pf and enkf produce satisfactory posterior distributions of k n a v i g fig 6 the reference value of k n a v i g 0 015 m h 1 is well characterized by the modes of the distributions however the distributions estimated by pf are much narrower than those estimated by enkf which are relatively broad fig 6 the simulated oxygen concentrations and posterior distributions of k n a v i g show that pf and enkf work well for a slightly nonlinear system oxygen recovery by reaeration even though pf estimates carry less uncertainty 3 2 heterotrophic bacterial activities strongly nonlinear system in this case a series of simulations are carried out with different ensemble sizes 100 300 400 500 800 and 1000 a minimum ensemble size of 500 is deemed imperative for obtaining desirable results only the results with the ensemble size of 500 are presented in this section a perturbation of s 0 01 eq 8 yield satisfactory results for pf while a perturbation of s 0 03 is needed for enkf the results show that pf performs much better than enkf when the bacterial activities control the river metabolism strongly nonlinear system both in the identification of parameter values and in the retrieval of do concentrations 3 2 1 simulated oxygen concentrations the simulated oxygen concentrations ensemble mean show that pf performs better than enkf under conditions of strong bacterial activities fig 7 all rmses are smaller than 0 02 mgo 2 l 1 table 3 for pf while all rmses are over 0 18 mgo 2 l 1 table 3 which is higher than the observation errors around 0 08 mgo 2 l 1 the analysis of the kges confirms the fact that the pf outperforms the enkf the results indicate that enkf can capture the depletion of oxygen trend but it struggles to retrieve the do concentrations correctly 3 2 2 estimated posterior distributions the estimated posterior distribution of μ m a x and y confirms the efficiency of pf for estimating parameters in a water quality model which is usually a strongly nonlinear system the parameter values of μ m a x and y 0 04 h 1 and 0 015 respectively used to generate observation data are very well identified by the pf fig 8 while the enkf fails to identify the bacterial yield y and slightly overestimates the value of μ m a x 0 04 h 1 with a much broader pdf than the pf fig 8 4 discussion 4 1 recommendations for data assimilation in water quality modeling although the ensemble kalman filter enkf has become the most popular data assimilation method for updates of state variables and model parameters in surface water quality modeling cho et al 2020 the results of this research show that the particle filter pf outperforms the enkf for parameter inference and oxygen concentration estimation especially in a strongly nonlinear system as for heterotrophic bacteria activity which is one of the main drivers of river metabolism odum 1956 escoffier et al 2018 also in ocean biogeochemical modeling gharamti et al 2017 indicate that the uncertainty associated with the state estimates using two enkf based methods increases during the spring blooms strongly nonlinear behavior that is because the enkf assumes gaussian errors for forecast states and parameters which is not realistic for the functioning of an aquatic system lake river huang et al 2013 wang et al 2022 evensen et al 2022 p 95 also stated that commonly used ensemble data assimilation methods like the enkf only sample the posterior pdf correctly in the gauss linear case and typically fail in cases with strong nonlinearity the pf overcomes the gaussian assumption of enkf the implementation of pf into a complex hydro biogeochemical program prose pa has been proved to be realistic wang et al 2019 and its performance calculation cost do concentration updates parameter estimation has been recently evaluated for the seine river system france wang et al 2022 therefore the authors recommend the use of pf for the update of biogeochemical state variables and model parameters in surface water quality modeling 4 2 uncertainties in parameter estimation pf vs enkf both pf and enkf are able to quantify the parameter uncertainties in a slightly nonlinear system oxygen reaeration these uncertainties are characterized by the posterior pdfs of the parameters with a random perturbation of s 0 10 eqs 10 and 8 the distributions estimated by enkf are broader than those estimated by pf fig 6 and thus depict larger uncertainties that is because the ensemble members in enkf are equally weighted and the posterior distribution is assumed to be gaussian and characterized by its first two moments mean and variance wikle and berliner 2007 compared with weighted ensemble members in pf eq 5 the assumption of equally weighted samples in enkf is generally not valid and results in biased samples wikle and berliner 2007 the uncertainties in parameter estimation result from multiple reasons for pf such as observation error or perturbation after resampling eq 8 a sensitivity assessment of the perturbation parameter after resampling s eq 8 for the case of oxygen recovery is realized to compare the estimated distributions with different random walks a fixed bandwidth 0 00011 is used in the kernel density estimation fig 9 the results show that a perturbation of s 0 01 enables a perfect estimation of k n a v i g fig 9 the posterior distributions of k n a v i g are narrow which depicts small estimation uncertainties however when increasing the random walk s 0 02 s 0 05 and s 0 10 the posterior distributions become increasingly spread out fig 9 which corresponds to an increase in parameter uncertainties with larger perturbations 4 3 impact of random walk precision and capacity of pf as shown above a small perturbation s 0 01 enables a perfect estimation of oxygen concentration and parameters both in slightly nonlinear systems and strongly nonlinear systems in other words the precision of the results is high that is because the parameter values are stationary during the simulation once the posterior distribution eq 5 is well approximated by the ensemble it is no longer necessary to explore the parameter space however the capacity of the filter with a small random walk perturbation parameter to respond to fast changes in the parameters remains questionable a change of parameter values was reported in the evolution of microorganism communities especially in the development of phytoplankton mao et al 2009 huang et al 2013 wang et al 2022 to illustrate a time varying parameter an extreme scenario mimicking the shift of k n a v i g value from 0 015 m h 1 to 0 03 m h 1 on day 5 is designed fig 10 with a small random walk s 0 01 the filter needs 9 days to capture the change in k n a v i g value and large discrepancies between simulated and reference do concentrations are obtained during this period when increasing the random walk s 0 05 the filter takes 3 days to respond to the fast change in k n a v i g value and the simulated do concentrations ensemble mean are satisfactory once the filter is stabilized the precision with a small random walk is higher than that with a large random walk nevertheless the small random walk may stay stuck in a local maximum in the case of multimodal posterior distribution in this case the ensemble cannot characterize the posterior distribution adequately and larger random walks are recommended to allow for a maximum search of the posterior distribution moradkhani et al 2012 it should be also noted that a larger random walk after the resampling step could result in an overspread ensemble biased samples which cannot account adequately for the prior distribution therefore it is crucial to find a good balance between the precision and the ability of parameter space exploration in the pf further studies can focus on improving the resampling perturbation procedure using more advanced techniques such as the auxiliary particle filter pitt and shephard 1999 johansen and doucet 2008 which performs the resampling at time step t 1 using the available measurement at time step t or the mcmc moves with the metropolis acceptance ratio to determine whether to accept a proposed sample metropolis et al 1953 hastings 1970 gilks and berzuini 2001 doucet and johansen 2011 moradkhani et al 2012 5 conclusions to compare the performances of pf and enkf for the updates of water quality states and model parameters the pf and enkf implemented in the hydro biogeochemical program prose pa were assessed via two synthetic case studies the main conclusions are given below pf is recommended for the updates of do concentrations and model parameters in surface water quality modeling for quasi linear oxygen reaeration inference both pf and enkf can capture the recovery of do by reaeration and identify the reaeration coefficient but the uncertainty associated with oxygen and parameter estimates obtained using enkf is larger than that obtained using pf the calculation time using pf is lower by 25 compared to enkf when the ensemble size is more than 100 for nonlinear bacterial activities inference pf shows a high efficiency for both the simulation of do concentrations and the estimation of bacteria related parameters while it is difficult to retrieve the do concentrations and estimate the parameter values properly with the enkf the small random walk after the resampling procedure in pf yields high precision of oxygen and parameter estimates while a larger random walk is necessary to capture efficiently the fast change in the parameters it is thus important to find a good balance between precision and the ability of the parameter search credit authorship contribution statement shuaitao wang conceptualization methodology software validation formal analysis investigation writing original draft visualization nicolas flipo conceptualization methodology software formal analysis writing review editing supervision funding acquisition thomas romary conceptualization methodology formal analysis writing review editing supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work is a contribution to the piren seine research program https www piren seine fr part of the french long term socio ecological research ltser site zones ateliers seine 
2054,this study forecasts multi step ahead potential evapotranspiration eto in india using globally available fifth generation european centre for medium range weather forecasts ecmwf gridded climate reanalysis products era5 for this purpose the potential of six machine learning approaches are examined across different agro climatic zones and cropping seasons support vector regression svr multivariate adaptive regression splines mars random forest rf multi layer perceptron mlp one dimensional convolutional neural network cnn and long short term memory lstm models are first evaluated at the station level for up to 28 day ahead prediction of daily eto using meteorological station data as well as gridded era5 products using meteorological observations at all three stations svr performs the best for a prediction horizon ph up to 2 days whereas lstm performs the best for ph of 7 days using era5 datasets as input among the three stations the best performance is observed in nagpur where the best models for real time and 28 day ahead prediction are lstm r2 0 847 and mae 0 474 mm day and rf r2 0 722 and mae 0 635 mm day respectively as the ph increases from 2 day to 28 day ahead models using era5 datasets performs better than those using station observations for most of the cases although the prediction performance drops initially with the increase in lead time the drop in performance between 7 day and 28 day ahead prediction is negligible evaluation of gridwise eto prediction across entire india using global land evaporation amsterdam model gleam dataset as a reference indicates mlp and cnn as the top performing models considering the crop seasons model performance during rabi season october march ranged from 0 103 to 0 145 mm day mae and 0 977 to 0 988 r2 which is better than the kharif season june september where mae ranged from 0 140 to 0 234 mm day and r2 ranged from 0 906 to 0 962 during the rabi season the eto prediction performance of the arid agro climatic zone is found to be superior to the other three agro climatic zones with the highest range of r2 0 939 to 0 955 and lowest range of mae 0 146 to 0 182 mm day even the worst prediction performance which is observed in the humid region during the rabi season is also reasonably good r2 0 656 to 0 79 thereby establishing the potential of the proposed models in multi step ahead eto prediction across various agro climatic zones and cropping seasons keywords reference evapotranspiration multi step ahead prediction machine learning ml multi layer perceptron mlp convolutional neural network cnn long short term memory lstm cropping season agro climatic zone data availability data will be made available on request 1 introduction the increasing global population requires progressively increasing agricultural production water required to irrigate agricultural fields is the principal consumer of freshwater supplies worldwide granata 2019 sustainable use of water in agriculture irrigation and other environmental aspects requires precise early prediction of reference evapotranspiration eto additionally eto is an indispensable component of terrestrial water energy and the carbon cycle that is very crucial for water resources planning and management tao et al 2018 evapotranspiration is the unification of two different phenomena wherein loss of water from the soil surface is called evaporation and from the vegetation is called transpiration both evaporation and transpiration are co occurring phenomena and can be distinguished only by using complex experimental methods ding et al 2013 evapotranspiration can be evaluated without considering the crop characteristics of a region by considering the concept of reference evapotranspiration eto granata 2019 eto is the atmosphere s near earth surface demand for water vapor from a moist well drained soil that is fully covered by a transpiring but dry vegetation canopy this differs from potential evapotranspiration pet as pet is simply the atmosphere s near earth surface demand for water vapor above a well moistened surface including open water fennessey and vogel 1996 eto solely depends on climatic variables as it is a climatic phenomenon solar radiation and ambient temperature ensure the supply of energy required to turn water into vapour the diffusion of water vapour in the atmosphere is enhanced by wind speed and vapour pressure deficit therefore ambient temperature solar radiation air humidity and wind speed are hydroclimatic parameters that affect the evapotranspiration process liu 2018 the actual evapotranspiration of a region can be estimated using reference evapotranspiration along with the crop coefficient of that region granata 2019 kool et al 2014 eto can be measured directly using lysimeter or estimated through empirical mathematical formulation using extensive meteorological information however these are highly expensive and difficult to implement over large areas tao et al 2018 wright 1988 the most well known mathematical formulation used for the determination of eto is the physically based model fao 56 penmen monteith fao 56 pm proposed by the food and agricultural organization fao of the united nations allen et al 1998a b fao 56 pm has been widely used in diverse regions and climates as a reference method as it considers both the aerodynamic and thermodynamic items to calculate eto granata 2019 roy 2021 tao et al 2018 tikhamarine et al 2019 wu et al 2019 zhang et al 2018 however the fao 56 pm model is a highly data intensive method and has limited use in regions with an inadequate number of meteorological stations over the past decades machine learning ml based algorithms were extensively used to describe complex hydrological phenomenon and make reliable hydrological predictions das and chanda 2020 dayal et al 2021 mohammed et al 2022 rose and chithra 2022 zhang et al 2020 for daily eto prediction across china hybrid extreme learning machine elm models with bioinspired algorithms such as ant colony optimization flower pollination algorithm and cuckoo search algorithm have been used whereas elm with flower pollination algorithm was found to be the best performing model ferreira and da cunha 2020 wu et al 2019 adaptive neuro fuzzy inference system anfis with firefly algorithm performs better than the classical anfis used for predicting daily eto over the burkina faso region tao et al 2018 similarly the performance of m5p regression tree bagging random forest rf and support vector regression svr algorithms have been evaluated in florida usa wherein three different scenarios with various input combinations of each model have been assessed input combination with the best prediction capabilities shows mp5 to be the most accurate model and rf as the worst model granata 2019 studies in serbia and montenegro show that artificial neural network ann can be used for eto prediction with high accuracy trajkovic et al 2003 mars model performed well for study regions in the mediterranean region of turkey kisi 2016 combination of mars and gene expression programming gep models with autoregressive conditional heteroscedasticity proved to perform better compared to the classical mars and gep for estimating daily eto in different climates in iran mehdizadeh 2018 bidirectional long short term memory bi lstm was applied to predict one to three weeks ahead prediction of weekly eto at three meteorological stations associated with different climatic conditions in iran karbasi et al 2022 hybrid deep learning model by combining convolutional neural network cnn and gated recurrent unit gru used to forecast multistep ahead daily eto at three selected sites in australian murray darling basin ahmed et al 2022 however investigative studies on eto prediction are rather scarce in the context of the indian hydroclimatological conditions among the recent notable studies daily eto was predicted using deep learning multilayer perceptron dl generalized linear model glm rf and gradient boosting machine gbm where the dl method appeared to be the best performing model in the hoshiarpur and patiala districts of punjab india saggi and jain 2019 two hybrid neural networks i e convolution long short term memory and convolution neural network lstm cnn lstm were adopted to develop the eto prediction model over ludhiana and amritsar in india where convolution long short term memory proved to outperform other existing models sharma et al 2022 for monthly eto computation support vector machine svm performed well at nagina and pantnagar located in uttar pradesh and uttarakhand of india rai et al 2022 the ann models showed an increased performance over gep and multiple linear regression while predicting daily eto over the pantnagar region india heramb et al 2022 lstm was found to perform better with improved accuracy than ann and empirical methods at three stations in different agro climatic zones of chhattisgarh india majhi et al 2020 while shaping the objectives for the present study it may be noted that india is an agro based economy and eto forecasting is critical for agriculture and efficient irrigation water supply spatial variation of eto and precipitation information are crucial to estimate the crop water footprint of a region dai et al 2021 tang et al 2020 this spatial distribution of crop water footprint can be used to delineate a region s water deficit and water abundance zones which can help policy makers take informed decisions in the management of water resources and efficient planning of cropping pattern and irrigation schedule tang et al 2019 zhang et al 2021a some recent studies explored the station wise multi step ahead eto prediction over very limited regions for example different machine learning methods were used to forecast eto up to seven days ahead at stations located in minas gerais brazil ferreira and da cunha 2020 multi step ahead eto forecasts were obtained at climate stations in iraq northern cyprus and turkey using ml models karbasi 2018 nourani et al 2020 ml methods were also used for multi step ahead t 3 and t 7 eto forecast using daily climatic data of hisar located in haryana state bathinda and ludhiana located in punjab state of india malik et al 2022 thus only a few eto forecasting studies exist over very limited regions in india moreover indian hydroclimatology is diverse so the predictability of eto is expected to vary across different agro climatic zones of india to investigate these issues this study aims at multi step ahead daily eto forecasting across different agro climatic regions of india to accomplish this the feasibility of six ml based algorithms is assessed the six ml algorithms svr mars rf mlp cnn and lstm are applied at a few weather stations to predict the eto using meteorological observations from that station as input and also using era5 reanalysis datasets as input subsequently the two best performing ml algorithms are selected which are used for grid wise eto prediction across the whole of india using hydroclimatological inputs from era5 reanalysis products effective ml based multi step ahead prediction of eto at station and grid scale using era5 reanalysis dataset makes the approach suitable for data scarce regions and adds to the novelty of this study 2 case study and data description 2 1 study on meteorological stations in this study daily meteorological station observations of hyderabad nagpur and bhubaneswar stations situated in krishna godavari and mahanadi river basins respectively were obtained from indian meteorological department imd the period of analysis for each station was decided based on the availability of the daily maximum and minimum temperatures tmax and tmin sunshine hour sh maximum and minimum relative humidity rhmax and rhmin and wind speed ws to build eto prediction model more details about the observation stations are provided in table 1 fig 1 a depicts the location of three stations and the elevation map of india different agro climatic zones of india classified by rao et al 2005 are shown in fig 1b the annual mean tmax ranged from 34 3 c at nagpur to 32 9 c at hyderabad mean tmin varied from 22 3 c at bhubaneswar to 20 6 c at nagpur the value of mean rhmax varied from 79 9 at bhubaneswar to 66 5 at nagpur whereas mean rhmin ranged from 69 9 at bhubaneswar to 47 7 at hyderabad again the mean value of ws varied from 2 14 m s at hyderabad to 1 05 m s at nagpur mean sh ranged from 7 26 h at nagpur to 5 0 h at bhubaneswar table 2 in this study four reanalysis datasets japanese 55 year reanalysis project jra ncep doe reanalysis 2 project ncep modern era retrospective analysis for research and applications version 2 merra and fifth generation of ecmwf atmospheric reanalysis of the global climate era5 were compared with meteorological observations from three stations the spatiotemporal resolution and other details of the four reanalysis data products are presented in table s1 fig s1 depicts the scatter plot and pearson correlation coefficient r between each reanalysis dataset with the meteorological observations at each station most variables from the era5 dataset show better agreement with station observations than other reanalysis datasets considering the r values between rhmax from observed and reanalysis data era5 shows the best correlation at nagpur r 0 82 and hyderabad r 0 76 whereas merra performs marginally better than era5 at bhubaneswar r 0 53 similarly rhmin and tmax from era5 dataset show the best agreement with observations at nagpur and hyderabad while jra performs better at bhubaneswar tmin from ncep shows better agreement with meteorological observations at all three stations although wind speed from all reanalysis sources shows the lowest agreement with observations era5 performs better at hyderabad and jra performs better at nagpur and bhubaneswar other studies have shown that era5 is of superior quality than other reanalysis datasets such as merra and ncep fersch and kunstmann 2014 xu et al 2022 moreover era5 has the finest spatial resolution of 0 25 0 25 and hourly temporal resolution among other reanalysis datasets zhang et al 2021b hence in addition to the station observations era5 dataset has been also used to develop ml models at the meteorological stations to evaluate the eto predictions against fao 56 pm eto for the three specific stations daily maximum and minimum temperatures maximum and minimum relative humidity and wind speed components from era5 datasets were linearly interpolated from the four nearest grid points more details about the variables are shown in table 2 2 2 gridwise study in india the gridded era5 datasets were extracted for entire india and used to build a gridwise eto prediction model across india daily maximum and minimum temperatures maximum and minimum relative humidity and wind speed components were obtained from era5 datasets similar to the station scale model for the gridded analysis across entire india during 2000 2019 potential evapotranspiration data from global land evaporation amsterdam model gleam was used as the target twelve years 60 and three years 15 of data for the period 2000 2014 were used for training and validation of the model respectively while the remaining five years of data 25 from 2015 to 2019 was used for testing the model the spatial resolution and source of the datasets used in this study are presented in table 3 3 methodology 3 1 empirical method for calculation of reference evapotranspiration at meteorological stations the physically based penman monteith equation penman 1948 also known as fao 56 equation is a well known empirical method for eto estimation as it consistently produces a reliable result in diverse climatic conditions allen et al 1998a b as per this method eto is given by 1 e t o 0 408 r n g γ 900 t mean 273 u 2 e s e a δ γ 1 0 34 u 2 where eto refers to the reference evapotranspiration mm d 1 rn refers to the net radiation at the crop surface mj m 2 d 1 g refers to the soil heat flux mj m 2 d 1 γ refers to the psychrometric constant kpa c 1 tmean refers to the mean daily ambient temperature at 2 m c u2 refers to the wind speed at 2 m m s 1 es refers to the saturation vapour pressure kpa ea refers to the actual vapour pressure kpa es ea refers to the saturation vapour pressure deficit kpa and δ refers to the slope of vapour pressure curve kpa c 1 eto from fao 56 penman monteith is used as reference for stations in this study as it is the most popularly used empirical equation almorox et al 2015 chen et al 2020 djaman et al 2019 there exists other similar empirical equations such as hargreaves samani hargreaves and samani 1985 priestley and taylor priestley and taylor 1972 hargreaves hargreaves 1975 and blaney criddle doorenbos and pruitt 1977 table s2 in the supplementary document lists the empirical equations used in this study all empirical models are locally calibrated using fao 56 pm as targets this calibration is done using simple linear regression model e t o f a o 56 p m a b e t o e m p i r i c a l suggested by allen et al 1998a b and used by other authors chen et al 2020 feng et al 2017 shiri et al 2014 where e t o f a o 56 p m is the eto estimated using fao 56 pm method e t o e m p i r i c a l is the eto estimated using different empirical equations a and b are regression coefficients the comparisons of multiple empirical equation at stations are shown against standard fao 56 pm equation allen et al 1998a b in fig s2 it is observed that the results obtained using other empirical models are more or less similar to the standard fao 56 pm method which being more popular is used in this study as the reference the eto calculated empirically using fao 56 pm equation eq 1 is the most reliable one for regions where detailed meteorological observations are available allen et al 2006 córdova et al 2015 paredes et al 2020 in fact in india total geographical area of india of 32 87 263 sq km only 219 agro meteorological stations record climate components to calculate reference evapotranspiration using the fao 56 pm equation jaswal et al 2014 moreover the data recorded at these agro meteorological stations also contain a significant portion of missing observations in such data scarce regions gridded globally available climatic information such as era5 reanalysis products may be modelled through machine learning ml techniques to predict eto successfully as shown in this study 3 2 gridwise evaluation of reference evapotranspiration very limited meteorological observation stations are available in india with scarce temporal coverage to assess eto at station scale in this study we have attempted to address this challenge by developing a gridwise model for the whole of india and evaluated the results for various agro climatic zones for gridwise evaluation eto from gleam is used as target and hydroclimatic components from era5 are used as input variables a total of 4647 grid points within india are modeled separately a flowchart indicating the details of the methodological steps is shown in fig 2 3 3 machine learning based regression algorithms machine learning based algorithms used in station and gridwise analysis are presented in this section in this study the potential of six ml algorithms svr mars rf ann cnn and lstm are explored to estimate eto from global gridded reanalysis datasets at first station level prediction models are developed which are later scaled up at each of the three meteorological stations hyderabad nagpur and bhubaneswar the prediction performance of each of the ml models was assessed for two sets of inputs i meteorological station observations and ii interpolated gridded reanalysis products in each case the model predictions were evaluated against the fao 56 eto calculated from station observations once the potential of the ml models are established at the station level the best performing models are further utilized for gridwise eto prediction throughout india in this case the performance is evaluated against the global gridded gleam datasets while selecting the hydroclimatic inputs for eto prediction ambient temperature and duration of sunshine were used since the energy required to turn water into vapour depends on these variables as evidenced in earlier eto modeling studies liang et al 2008 patle et al 2013 tabari and hosseinzadeh talaee 2014 additionally relative humidity and wind speed were used as these variables influence the diffusion of water vapour in the atmosphere and hence chosen in previous studies as potential predictors of eto granata 2019 tao et al 2018 wu et al 2019 in addition to portray the seasonal dynamics of eto throughout the year julian days jday was used as an input variable ferreira and da cunha 2020 grange and carslaw 2019 hence tmax tmin rhmax rhmin sh ws and jday were used as the input set of predictors while using station observations however for the models using gridded reanalysis products all the aforementioned variables except sh was used as the later is not available from the era5 reanalysis datasets more details of input parameters and sources of input and target variables for the seven prediction horizons are presented in table 4 for both station wise as well as gridwise analysis seven different prediction horizons are considered real time prediction ph0 1 day ahead ph1 2 day ahead ph2 7 day ahead ph7 14 day ahead ph14 21 day ahead ph21 and 28 day ahead ph28 a brief description of the machine learning algorithms used in this study are presented in section s1 of the supplementary document 3 4 modeling algorithms and hyperparameter tuning eto was estimated with six machine learning algorithms based on reference eto data and their corresponding predictor values that were extracted from the meteorological station and era5 data products six regression algorithms include a kernel based model svr mars algorithm tree based ensemble model rf and three neural network based models mlp cnn and lstm pedregosa et al 2011 for each of the ml algorithms used in modeling eto the hyperparameters need to be optimized first zhang et al 2020 the configuration of key hyperparameters tuned for each ml algorithm is presented in table 5 rbf is an extensively used kernel function that is strongly nonlinear and powerful for learning complex interactions between input output variables additionally it also has the advantage of high computational efficiency ahmad et al 2020 xuan et al 2015 so rbf is used as the svr kernel function in this study hence the hyperparameters for svr with rbf kernel are the regularization parameter c and kernel coefficient gamma parameter c controls the regularization of the model and the width of the error margin while gamma determines the influence of a single training sample the hyperparameters for mars algorithms are the maximum number of terms to retain in the final model max terms and the maximum degree of interaction between piecewise linear functions max degree two hyperparameters were optimized for the rf algorithm the number of trees required n estimators to build the rf algorithm and the maximum depth of a tree max depth which controls the complexity of each tree in case of the mlp model the size of the hidden layer hidden layer sizes which contains the number of hidden layers and the number of perceptrons included in each hidden layer should be optimized two hidden layers were used in case of cnn and lstm models the number of perceptrons in each layer first hidden layer sizes and second hidden layer sizes was optimized for these two models the optimum combination of hyperparameters for individual eto prediction models was determined using grid search technique with cross validation based on the configuration of hyper parameters as presented in table 5 3 5 k fold cross validation 3 5 1 cross validation at meteorological station each ml model in this study was developed using a k fold cross validation approach k was chosen as 5 while modeling eto at the selected meteorological stations the entire data set was divided into five equal portions out of these four parts have been used to train the model at a time and the remaining one part is used to validate the model this cross validation approach ensures that each fold of the data becomes new dataset or test dataset at least once the performance of each fold i e validation score for a set of hyper parameters were inspected and the set of hyper parameters with the best performance were selected using this cross validation method finally the average of the validation period performances for each fold is reported as the overall performance an explanatory flowchart of this cross validation steps is shown in fig 3 a 3 5 2 cross validation during gridwise analysis while performing the gridwise analysis with reanalysis datasets the available data was much longer than the station datasets hence in this case a separate testing period is earmarked in addition to the 5 folds of the training dataset which are used for cross validation this is explained through a flowchart fig 3b as mentioned earlier the hyperparameters of each model were tuned using the grid search method 4 results 4 1 prediction performance of ml models using meteorological station observations as input the daily eto prediction performance of the six ml models svr mars rf mlp cnn and lstm for seven different prediction horizons ph0 ph1 ph2 ph7 ph14 ph21 and ph28 at the three meteorological stations are presented in table 6 a c the scatter plots of the model predicted vs observed calculated using fao 56 pm eto for nagpur are shown in fig 4 fig 4a indicate the performance of the six models using meteorological observations from the station as input whereas the fig 4b depicts the performance of the six models using meteorological variables from era5 products as input the later are discussed further in the next subsection 4 2 figs s3 and s4 depict similar results for the stations hyderabad and bhubaneswar respectively while considering real time prediction ph0 of daily eto svr mlp and cnn show excellent performance at each of the three meteorological stations the nrmse value for svr mlp and cnn is 5 whereas the nrmse for mars and rf is upto 7 1 and for lstm 18 using station observations for 1 day ahead prediction horizons ph1 all the models show a lower performance than ph0 ref table 6 however the performances of all models are best at nagpur station the efficiency of forecasting further reduces with 2 day ahead prediction models ph2 at nagpur performance of svr is the best among all the models up to 2 day ahead prediction fig 4a and table 6a the performance statistics obtained using svr up to ph2 range from 0 999 to 0 787 r2 0 052 to 0 561 mm day mae and 1 5 to 18 4 nrmse cnn mlp and rf are the next best performing algorithms at nagpur lstm is the worst performing algorithm up to ph1 showing the highest range of nrmse 14 4 to 18 2 and mae 0 432 to 0 558 mm day lowest range of r2 0 791 to 0 869 mm day while mars performs the worst at ph2 r2 0 732 mae 0 648 mm day nrmse 20 6 the performance of the lstm model at nagpur starts to improve after the 2 day ahead forecast and is observed to outperform the other models at ph7 in general for all the models the forecasting performance is reduced up to the 7 day ahead prediction models ph7 after ph7 there is a negligible drop in performance of models at all three stations i e at hyderabad the best performing algorithm at ph7 has r2 of 0 549 mae of 0 815 mm day and nrmse of 22 8 whereas at ph28 best performing algorithm has r2 of 0 544 mae of 0 82 mm day and nrmse of 22 9 in terms of performance statistics rf outperforms other models at all three station in ph21 and ph28 where mae ranges from 0 638 to 0 826 mm day r2 ranges from 0 544 to 0 719 and nrmse ranges from 21 2 to 23 8 but considering the scatter plot the prediction efficiency of mlp and cnn can be said to be superior because rf is unable to predict eto more than a certain value 8 mm day in last two prediction horizons at hyderabad the performance of svr mlp and cnn are equally good and better than the other ml models up to 2 day ahead prediction where the performance indicators varies in the range of 0 636 to 0 999 r2 0 036 to 0 734 mm day mae and 1 to 20 4 nrmse this holds true for bhubaneswar as well although lstm based predictions in hyderabad and bhubaneswar are quite good in terms of most of the metrics it is the worst performing algorithm up to 2 day ahead prediction model the best performance of lstm is observed in the 7 day ahead prediction model at all three stations and the prediction accuracy increases in subsequent models to become equivalent to the best model overall mars is the worst performing algorithm at the three stations with performance indicator for ph0 ranging from 0 982 to 0 986 r2 0 141 to 0 161 mm day mae and 4 to 5 3 nrmse and performance matrices for ph28 are noticed to be in the range of 0 481 to 0 537 r2 0 847 to 0 9 mm day mae and 24 4 to 27 1 nrmse the bias parameter is found to be not always in accordance with the other three performance indicators while suggesting the best model this is not unexpected as a low value of bias may sometimes result due to cancellation of errors in a less accurate prediction time series plots of ml model predictions using station data with observed eto are presented in the supplementary document in figs s5 a s6 a and s7 a for nagpur hyderabad and bhubaneswar stations respectively 4 2 performance assessment of ml models using era5 reanalysis products as input the performance of the six ml models for predicting daily eto at the meteorological stations using era5 reanalysis products as inputs list of selected variables mentioned earlier in section 3 3 table 4 are provided in table 6 a c in this case overall lstm cnn and mlp are found to be the best performing models performance matrices for real time ph0 and 1 day ahead prediction using the era5 dataset across all stations are noticed to be in the range of 0 719 to 0 848 r2 0 471 to 0 598 mm day mae and 15 6 to 20 6 nrmse for ph0 and ph1 models using era5 datasets are less accurate than models with similar prediction horizons using station observations but models using era5 datasets for later prediction horizons ph2 to ph28 perform better than station observations in most cases it is observed from table 6 that the forecasting efficiency of all the models decrease with increase in the lead time i e performance at ph0 is better than that at ph1 which is again better than ph2 ph7 and later models this could be obvious due to a decrease in generalization capabilities and error propagation of the models for ph2 the values of mae ranges from 0 538 to 0 656 mm day r2 ranges from 0 668 to 0 807 and nrmse ranges from 17 5 to 22 4 where mlp is found to be the best performing model at nagpur and hyderabad and cnn at bhubaneswar the prediction performance decreases at ph7 compared to ph2 at all three stations but the performance drop between ph7 and ph28 is negligible the performance measures of the best models for ph7 are noticed to be in the range of 0 574 to 0 722 r2 0 64 to 0 794 mm day mae 21 to 23 5 nrmse similarly the ranges for ph28 are 0 547 to 0 722 r2 0 635 to 0 823 mm day and 21 to 24 nrmse among the meteorological stations nagpur has the best performance compared to the other two stations it can also be seen that the accuracy of the lstm increased at later prediction horizons ph7 to ph28 compared to the initial prediction models however cnn is found to be the best performing model for most of the prediction horizons between ph14 and ph28 at all meteorological stations table 6 for 28 day ahead forecast ph28 rf shows the best performance in nagpur r2 0 722 mae 0 635 mm day nrmse 21 bias 0 002 mm day while cnn is the best model at hyderabad and bhubaneswar station simultaneously the mlp and lstm models perform extremely well at all prediction horizons and at each meteorological station time series plots of ml model predictions using era5 dataset with observed eto are presented in figs s5 b s6 b and s7 b for nagpur hyderabad and bhubaneswar stations respectively fig 5 depicts the prediction accuracies of the various ml algorithms in the form of taylor diagram td at the three meteorological stations td uses standard deviation and correlation coefficient r of observed and modeled values to make the classification a model that presents the same amplitude of variation as the observed data and r 1 is considered to be the best the performance of almost all the models for ph0 is very good however mlp svr and cnn shows a superior performance at each of the meteorological stations exceptionally the lstm forecasts shows worst prediction capabilities at all stations when using station observations over the prediction horizon ph0 however there is a negligible fluctuation in the performance of almost all models at each station for other prediction horizons over the prediction horizons ph1 to ph28 the performance of all eto prediction models using era5 reanalysis products is very close to the performance of the models using station observations it is also evident in the taylor diagram that the models using the era5 dataset show higher performance than the models with station observations in most cases between ph2 to ph28 additionally the box plots are presented fig s8 to visualize the accuracy of ml algorithms fig s8 depicts the residuals i e observed eto predicted eto of each developed ml algorithm in the form of a boxplot after omitting the outliers it clearly shows that the distribution of the residuals are very close to zero for each real time prediction model however the residuals of svr mlp and cnn are almost negligible indicating superior performance the residuals of the models using era5 datasets are much larger compared to models using station datasets for ph0 however the comparable performance of the former are evident for all other prediction horizons as seen from the residuals fig s8 4 3 gridwise model development and performance evaluation across india from the results in the previous section it can be observed that svr mlp and cnn are the best performing models in most cases using the era5 dataset as input the ml algorithms with superior prediction capabilities at meteorological stations one classical ml models and another neural network nn based model are further used for the development of gridwise eto prediction models the svr model is selected along with the nn based model because its performance is as good as mlp cnn and lstm in addition this model is computationally less expensive and takes less time to build than the nn based models among the nn based models the cnn model performs better in all three stations at later prediction horizons i e ph14 ph21 and ph28 for the grid wise analysis considering the model building time and prediction efficiency of mlp and cnn models at different prediction horizons mlp is used for ph0 to ph7 and cnn is used in the latter prediction horizons ph14 ph21 and ph28 each grid point within india 4647 grids are tuned separately during the tuning of gridwise models and the best set of hyperparameters for each grid are identified tuned hidden layer sizes for mlp ph0 models are 64 64 and 64 16 for the best 35 875 n 74 625 e and the worst 8 375 n 77 375 e performing grid points respectively while for other prediction horizons ph1 ph2 and ph7 it varies among 16 32 and 64 similarly tuned hyperparameters for the svr models at the best and worst performing grids over all seven prediction horizons varies among regularization parameter c 10 100 1000 and kernel coefficient gamma 0 1 and 0 2 fig 6 depicts the coefficients of determination r2 between observed and predicted daily eto using svr mlp and cnn algorithms over india the prediction accuracy of nn based model mlp and cnn is comparatively better than svr across all the prediction horizons approximately 18 of grid locations have an r2 value of more than 0 8 while an additional 68 of grids have an r2 value between 0 5 and 0 8 for real time prediction ph0 of eto using mlp hence only 14 of grids have an r2 value of less than 0 5 these worst performing grid locations are mostly situated in the western coastal part of south india similarly for 1 day ahead prediction ph1 the r2 value is more than 0 8 for around 14 of the total grid points and between 0 5 and 0 8 for 56 of grids in india the prediction accuracy decreases further for 2 day ahead prediction ph2 models the total number of grids with r2 between 0 5 and 0 8 is approximately 27 while r2 0 8 is 12 accuracy is further reduced for 7 day ahead ph7 predictions the total number of grids with r2 between 0 5 and 0 8 is reduced to about 19 while r2 0 8 is 12 the worst performing grids for this prediction horizon ph7 in terms of r2 value are mostly located in the coastal region of peninsular india from fig 6 it can be observed that there is no significant decrease in r2 value for subsequent prediction models ph14 ph21 and ph28 from 7 day ahead prediction however nn based algorithms mlp and cnn outperformed svr at all prediction horizons fig 7 depicts that the mae mm day corresponding to mlp and cnn is less compared to the svr for each prediction horizon similarly the nrmse in terms of percentage in fig 8 also indicates that nn based algorithms are better than svr when predicting gridwise eto among all the grids inside india 89 have nrmse values less than 20 additionally another 10 of grid points have nrmse between 20 and 25 while predicting real time ph0 eto similarly for 1 day ahead prediction of eto the nrmse is less than 20 for approximately 45 of all grid points and an additional 48 of grid points have an nrmse values between 20 and 25 however the prediction capabilities of the ph2 model reduces as only 21 of grids have nrmse value less than 20 and 67 of grid points have nrmse between 20 and 25 this prediction capabilities further decreases as only 14 of the grids have nrmse value below 20 and another 64 have nrmse between 20 and 25 for ph7 in terms of nrmse values there is a slight decrease in performance in ph14 compared to ph7 but it remains the same for subsequent prediction horizons ph21 and ph28 the grid points over the himalayan region of india show a high r2 and low mae however the nrmse value is rather high for some of these grids fig 9 depicts the spatial distribution of the bias mm day values for the gridwise eto prediction models bias increases uniformly from real time prediction to 7 day ahead prediction and remains more or less same for subsequent prediction horizons for the svr model however fluctuation of bias is not uniform for the mlp and cnn model for instance 1 day ahead prediction model has more grids with positive bias than ph2 and ph7 models on the other hand the number of grids with negative bias values increases steadily from ph14 to ph28 in some parts of south india similar to the previous three performance statistics r2 mae and nrmse bias values also suggest nn based algorithms mlp and cnn as the most suitable algorithms for gridwise model evaluation in this study 4 4 evaluation of model performance across major cropping seasons and agro climatic zones as the prediction of eto plays an important role in planning agricultural systems the model performance is evaluated for the two main cropping seasons in india kharif june september and rabi october march birthal and hazrana 2019 fig 10 depicts the average predicted eto values as a fraction of observed for the kharif and rabi seasons for the testing period i e 2015 2019 using mlp for ph0 to ph7 and cnn ph14 to ph28 the fraction of predicted eto over observed eto for real time predictions ph0 is very close to 1 as shown in fig 10 however some parts of the arid region and northern part of the semi arid tropic region underestimates the eto for both kharif and rabi season for ph0 and ph1 eto is slightly overestimated for each crop season and prediction horizon in the eastern part of the semi arid temperate zone for ph7 the arid and northeastern part of the humid region marginally underestimates the eto while the eastern part of semi arid temperate and eastern part of semi arid tropic region slightly overestimates the eto the performance in the humid region is good and the average values in the fraction map fig 10 are very close to 1 for each prediction horizon and cropping season in the arid region eto is highly overestimated for ph1 and ph2 but it slightly reduced for ph7 and increases again for ph14 to ph28 during the rabi crop season there is no notable difference in prediction performance between ph14 and ph21 for kharif season fig 10 e and f whereas in ph28 the model highly underestimates eto in the arid region and overestimates the same in the semi arid tropics region a similar pattern is observed for the rabi season fig 10 l m in the himalayan arid zone and the northern part of the semi arid tropics predicted eto is underestimated at ph14 ph21 and ph28 during the rabi season but overestimated in the southern part of the semi arid tropics at ph28 the rabi crop season shows a better prediction than the kharif seasons over the testing periods the r2 value between observed and real time predictions ph0 of eto over the kharif and rabi seasons are 0 957 and 0 988 respectively fig s9 depicts the coefficient of determination and other performance indicators between average observed gleam eto and predicted eto during the testing period 2015 2019 over different prediction horizons ph0 to ph28 it is observed that prediction accuracy is more with lower values of eto and it reduces with the increase of eto values since the kharif season has a greater number of days with high eto the prediction performance is comparatively lower for this season than the rabi season fig 11 depicts the agro climatic zone wise performance r2 of ml models for the testing period 2015 2019 in the form of a heatmap fig s10 presents the agro climatic zone wise mae mm day of ml models for each agro climatic zone similar to the observations of the previous section 4 3 mlp and cnn are found to be the best performing model across the different agro climatic zones as well hence further discussion on the agro climatic zone wise performance is based on the mlp for ph0 to ph7 and cnn ph14 to ph28 model outputs it is observed from fig 11 and fig s9 that the rabi season shows a better model performance than the kharif season among the agro climatic zones the best performance considering r2 and mae is observed over the arid region in both the crop seasons and all the prediction horizons the semi arid temperate region is found to be the next best performing region after the arid region during the rabi season the performance statistics are noticed to be in the range of 0 739 to 0 871 r2 and 0 316 to 0 374 mm day mae considering the value of r2 humid region is the next best performing region during kharif season where r2 ranges from 0 135 to 0 565 while semi arid temperate region is the best performing region after arid region according to mae range from 0 747 to 1 041 mm day the worst performing zone in rabi and kharif season considering the r2 values are the semi arid tropics range of r2 0 524 to 0 704 and semi arid temperate range of r2 0 099 to 0 518 respectively according to the mae values the humid region is the lowest performing zone in both cropping seasons mlp cnn and svr models are able to capture the seasonal dynamics of eto and for different agro climatic zones however the mlp and cnn are superior than svr in predicting eto the findings of this study will greatly benefit agriculture and irrigation planning as an innovative modeling approach particularly in regions with limited station observations and over india where meteorological data and in situ observations are limited 5 discussions in recent literature for real time eto prediction in different climate regions of china wu et al 2019 the model performance in the best and worst performing stations are found to vary between r2 0 995 to r2 0 988 similar studies in india are restricted to only a few stations in punjab and haryana saggi and jain 2019 wherein daily eto is predicted better for patiala station r2 0 98 than hoshiarpur station r2 0 95 using deep learning methods utilizing era5 land dataset eto is derived in sicily italy with an average performance of r2 0 76 pelosi and chirico 2021 a study on prediction improvement of daily pan evaporation in three distinct agro climatic zones of chhattisgarh found best performance using lstm model ranging from 0 716 to 0 915 majhi et al 2020 in the present study the models show a very satisfactory performance wherein the lowest performance is obtained at bhubaneswar using lstm r2 0 788 and the best performance is obtained using svr and mlp at each of the three meteorological stations r2 0 999 additionally using the era5 reanalysis dataset the lowest performance is found in bhubaneswar r2 0 712 using the mars model and the best performance is found in nagpur r2 0 847 using the lstm model which are also quite satisfactory considering they do not require any station based observations in the context of multistep ahead eto predictions recent studies in meteorological stations in the minas gerais region of brazil using cnn lstm present 1 day ahead eto forecasts r2 0 62 and 2 days ahead eto forecasts with reduced performance r2 0 55 the 7 day ahead prediction further reduces with r2 around 0 5 ferreira and da cunha 2020 a 1 step ahead eto forecast study at a meteorological station located in gazipur sadar bangladesh found correlation coefficients r 0 698 and 0 999 during testing phase using lstm and bi lstm models respectively roy 2021 a multi step ahead prediction of mean monthly eto at ten meteorological stations representing different climate zones from turkey northern cyprus and iraq shows the best performance for 1 step ahead eto prediction using the anfis model at famagusta station nash sutcliffe efficiency nse 0 772 whereas the best performance for the 2 step ahead eto forecasting is obtained at kyrenia using the anfis model nse 0 764 nourani et al 2020 in a study conducted at three meteorological stations in punjab and haryana states of india 7 day ahead eto forecasting using the hybrid multivariate variational mode decomposition technique integrated with the ridge regression feature selection algorithm and kernel extreme learning machine model is found to have the best performance with nse ranging from 0 931 to 0 874 malik et al 2022 daily eto prediction study at three meteorological station located at semi arid region of central ningxia china found an average nse value of 0 988 and 0 982 for 1 day ahead and 7 day ahead prediction respectively yin et al 2020 eto forecasting study carried out in cypress swamp southern florida found best performance with lstm model ph1 r2 0 915 ph7 r2 0 910 and kobeh valley central nevada found best performance with nonlinear autoregressive network with exogenous inputs narx model ph1 r2 0 888 ph7 r2 0 881 granata and di nunno 2021 in comparison in the present study the best performance for a 1 day ahead forecast is found at nagpur r2 0 872 using svr and the worst performance is found at bhubaneswar r2 0 798 using mlp using meteorological observations as input similarly using the era5 gridded reanalysis dataset as input this study noted better performance for 1 day ahead forecasting in nagpur r2 0 848 using cnn than hyderabad r2 0 755 using mlp and bhubaneswar r2 0 721 using mlp similarly for 2 days ahead forecasting of eto using meteorological station observations as well as era5 dataset as input better accuracy is observed in nagpur than hyderabad and bhubaneswar table 6 the forecast performance for 7 day ahead and subsequent prediction horizons using the era5 dataset at all three stations is superior to that of the model using meteorological observations better performance is also found at nagpur for the 7 day ahead forecast where prediction accuracy using the era5 dataset r2 0 728 mae 0 625 mm day nrmse 20 8 is marginally better than using meteorological station observations r2 0 727 mae 0 63 mm day nrmse 20 9 while the worst performance is observed in hyderabad r2 0 569 mae 0 801 mm day nrmse 22 2 a study conducted across different seasons in zanjan iran used wavelet gpr model to obtain daily eto forecast from 1 to 30 day ahead the performance metrics for the 14 day ahead model range from 0 662 to 0 907 r2 and 13 3 to 25 2 nrmse while the accuracy for the 27 day ahead model decreases to a range of 0 436 to 0 851 r2 and 17 3 to 23 8 nrmse karbasi 2018 in the present study after ph7 insignificant fluctuations in prediction accuracy is observed for subsequent models ph14 ph21 and ph28 performance matrices ranged from 0 722 to 0 725 r2 and 20 9 to 21 nrmse notably the best performance obtained for ph14 and ph21 at nagpur is better than ph7 similarly the performance of ph14 at bhubaneswar is better than ph7 although the nse or r2 value reported by malik et al 2022 karbasi 2018 granata and di nunno 2021 and yin et al 2020 are higher than those found in the present study the cited studies uses only station observations to model eto which may not be easily and freely available in the present study the 7 day ahead and subsequent prediction model have not exhibited high accuracies however they indicate reasonable accuracy considering global gridded reanalysis datasets 6 summary and conclusions multistep ahead accurate prediction of reference evapotranspiration is crucial for irrigation planning and efficient management of available water resources in regions with inadequate number of meteorological stations where empirical methods have limited utility the development of robust prediction algorithms using globally available climate datasets is beneficial in this study the potential of six ml based algorithms support vector regression svr multivariate adaptive regression splines mars random forest rf multi layer perceptron mlp one dimensional convolutional neural network cnn and long short term memory lstm were evaluated for the prediction of eto at seven different prediction horizons ph real time ph0 1 day ahead ph1 2 day ahead ph2 7 day ahead ph7 14 day ahead ph14 21 day ahead ph21 and 28 day ahead ph28 three meteorological stations nagpur hyderabad and bhubaneswar in india were selected as test beds before scaling up the models across the whole of india across different agro climatic zones and across multiple cropping seasons using station observations the performance of all the six implemented algorithms is very high which is not unexpected as the inputs are known to be related via empirical equations mlp cnn and svr are found to capture the relationship most accurately thereby producing the best performance while overall mars proved to be the worst model the potential of the ml models is best realized when multi step ahead eto prediction is undertaken at locations without station observations using only globally available gridded era5 reanalysis datasets although the modeled eto values using gridded climatic information are slightly less accurate than the models based on direct station observations at real time and 1 day ahead prediction they are as accurate as the models based on station observations during later prediction horizons 2 day to 28 day ahead interestingly for larger prediction horizons the prediction performance is generally better using the era5 inputs than using station observations hence a fairly accurate multi step ahead daily eto prediction model can be developed using gridded climatic information as the best performances at the station level are achieved with svr cnn and mlp one neural network based model mlp for ph0 to ph7 and cnn for ph14 to ph28 and one classical ml technique svr are further used for the gridwise prediction of eto across entire india using era5 climate datasets as inputs and gleam eto values as the reference among these algorithms nn based models mlp and cnn performs better for all the seven prediction horizons the developed mlp algorithm was able to predict real time eto quite well with r2 values greater than 0 5 at approximately 86 of the total grid points the corresponding percentage for 1 day ahead prediction is approximately 70 which drops to 39 for 2 day ahead and 31 for 7 day ahead prediction however further increase in prediction horizon beyond 7 days do not cause any significant drop in prediction accuracy the number of grids with negative bias values in parts of south india continues to increase from ph14 to ph28 using cnn model considering the crop season wise performance of mlp and cnn model rabi season r2 noted to be in the range of 0 977 to 0 988 exhibits better prediction accuracy compared to the kharif season r2 ranges from 0 906 to 0 962 fig s8 considering the different agro climatic regions the best performance was observed over the arid region for mlp cnn and svr models during rabi and kharif season the next best performance is observed over the semi arid temperate region during rabi season where performance indices range from 0 316 to 0 374 mm day mae and 0 739 to 0 817 r2 using mlp and cnn algorithms thus the results endorsed the potential of svr mlp and cnn for multi step ahead prediction of daily eto using era5 reanalysis products in regions with limited meteorological observations further the model performance is found to be reasonably good across the different agro climatic zones and also for various cropping seasons these multi step ahead eto forecasts can address a fundamental need by depicting the crop water footprint of a region additionally the results of this analysis are helpful in evaluating the amount and schedule of irrigation supply in a region credit authorship contribution statement nehar mandal formal analysis investigation writing original draft kironmala chanda conceptualization supervision investigation writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we acknowledge the support provided by dst serb through the project crg 2022 007728 we acknowledge the scikit learn tensorflow and py earth machine learning libraries which were used to build the svr rf mlp cnn lstm and mars models appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2023 129418 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
2054,this study forecasts multi step ahead potential evapotranspiration eto in india using globally available fifth generation european centre for medium range weather forecasts ecmwf gridded climate reanalysis products era5 for this purpose the potential of six machine learning approaches are examined across different agro climatic zones and cropping seasons support vector regression svr multivariate adaptive regression splines mars random forest rf multi layer perceptron mlp one dimensional convolutional neural network cnn and long short term memory lstm models are first evaluated at the station level for up to 28 day ahead prediction of daily eto using meteorological station data as well as gridded era5 products using meteorological observations at all three stations svr performs the best for a prediction horizon ph up to 2 days whereas lstm performs the best for ph of 7 days using era5 datasets as input among the three stations the best performance is observed in nagpur where the best models for real time and 28 day ahead prediction are lstm r2 0 847 and mae 0 474 mm day and rf r2 0 722 and mae 0 635 mm day respectively as the ph increases from 2 day to 28 day ahead models using era5 datasets performs better than those using station observations for most of the cases although the prediction performance drops initially with the increase in lead time the drop in performance between 7 day and 28 day ahead prediction is negligible evaluation of gridwise eto prediction across entire india using global land evaporation amsterdam model gleam dataset as a reference indicates mlp and cnn as the top performing models considering the crop seasons model performance during rabi season october march ranged from 0 103 to 0 145 mm day mae and 0 977 to 0 988 r2 which is better than the kharif season june september where mae ranged from 0 140 to 0 234 mm day and r2 ranged from 0 906 to 0 962 during the rabi season the eto prediction performance of the arid agro climatic zone is found to be superior to the other three agro climatic zones with the highest range of r2 0 939 to 0 955 and lowest range of mae 0 146 to 0 182 mm day even the worst prediction performance which is observed in the humid region during the rabi season is also reasonably good r2 0 656 to 0 79 thereby establishing the potential of the proposed models in multi step ahead eto prediction across various agro climatic zones and cropping seasons keywords reference evapotranspiration multi step ahead prediction machine learning ml multi layer perceptron mlp convolutional neural network cnn long short term memory lstm cropping season agro climatic zone data availability data will be made available on request 1 introduction the increasing global population requires progressively increasing agricultural production water required to irrigate agricultural fields is the principal consumer of freshwater supplies worldwide granata 2019 sustainable use of water in agriculture irrigation and other environmental aspects requires precise early prediction of reference evapotranspiration eto additionally eto is an indispensable component of terrestrial water energy and the carbon cycle that is very crucial for water resources planning and management tao et al 2018 evapotranspiration is the unification of two different phenomena wherein loss of water from the soil surface is called evaporation and from the vegetation is called transpiration both evaporation and transpiration are co occurring phenomena and can be distinguished only by using complex experimental methods ding et al 2013 evapotranspiration can be evaluated without considering the crop characteristics of a region by considering the concept of reference evapotranspiration eto granata 2019 eto is the atmosphere s near earth surface demand for water vapor from a moist well drained soil that is fully covered by a transpiring but dry vegetation canopy this differs from potential evapotranspiration pet as pet is simply the atmosphere s near earth surface demand for water vapor above a well moistened surface including open water fennessey and vogel 1996 eto solely depends on climatic variables as it is a climatic phenomenon solar radiation and ambient temperature ensure the supply of energy required to turn water into vapour the diffusion of water vapour in the atmosphere is enhanced by wind speed and vapour pressure deficit therefore ambient temperature solar radiation air humidity and wind speed are hydroclimatic parameters that affect the evapotranspiration process liu 2018 the actual evapotranspiration of a region can be estimated using reference evapotranspiration along with the crop coefficient of that region granata 2019 kool et al 2014 eto can be measured directly using lysimeter or estimated through empirical mathematical formulation using extensive meteorological information however these are highly expensive and difficult to implement over large areas tao et al 2018 wright 1988 the most well known mathematical formulation used for the determination of eto is the physically based model fao 56 penmen monteith fao 56 pm proposed by the food and agricultural organization fao of the united nations allen et al 1998a b fao 56 pm has been widely used in diverse regions and climates as a reference method as it considers both the aerodynamic and thermodynamic items to calculate eto granata 2019 roy 2021 tao et al 2018 tikhamarine et al 2019 wu et al 2019 zhang et al 2018 however the fao 56 pm model is a highly data intensive method and has limited use in regions with an inadequate number of meteorological stations over the past decades machine learning ml based algorithms were extensively used to describe complex hydrological phenomenon and make reliable hydrological predictions das and chanda 2020 dayal et al 2021 mohammed et al 2022 rose and chithra 2022 zhang et al 2020 for daily eto prediction across china hybrid extreme learning machine elm models with bioinspired algorithms such as ant colony optimization flower pollination algorithm and cuckoo search algorithm have been used whereas elm with flower pollination algorithm was found to be the best performing model ferreira and da cunha 2020 wu et al 2019 adaptive neuro fuzzy inference system anfis with firefly algorithm performs better than the classical anfis used for predicting daily eto over the burkina faso region tao et al 2018 similarly the performance of m5p regression tree bagging random forest rf and support vector regression svr algorithms have been evaluated in florida usa wherein three different scenarios with various input combinations of each model have been assessed input combination with the best prediction capabilities shows mp5 to be the most accurate model and rf as the worst model granata 2019 studies in serbia and montenegro show that artificial neural network ann can be used for eto prediction with high accuracy trajkovic et al 2003 mars model performed well for study regions in the mediterranean region of turkey kisi 2016 combination of mars and gene expression programming gep models with autoregressive conditional heteroscedasticity proved to perform better compared to the classical mars and gep for estimating daily eto in different climates in iran mehdizadeh 2018 bidirectional long short term memory bi lstm was applied to predict one to three weeks ahead prediction of weekly eto at three meteorological stations associated with different climatic conditions in iran karbasi et al 2022 hybrid deep learning model by combining convolutional neural network cnn and gated recurrent unit gru used to forecast multistep ahead daily eto at three selected sites in australian murray darling basin ahmed et al 2022 however investigative studies on eto prediction are rather scarce in the context of the indian hydroclimatological conditions among the recent notable studies daily eto was predicted using deep learning multilayer perceptron dl generalized linear model glm rf and gradient boosting machine gbm where the dl method appeared to be the best performing model in the hoshiarpur and patiala districts of punjab india saggi and jain 2019 two hybrid neural networks i e convolution long short term memory and convolution neural network lstm cnn lstm were adopted to develop the eto prediction model over ludhiana and amritsar in india where convolution long short term memory proved to outperform other existing models sharma et al 2022 for monthly eto computation support vector machine svm performed well at nagina and pantnagar located in uttar pradesh and uttarakhand of india rai et al 2022 the ann models showed an increased performance over gep and multiple linear regression while predicting daily eto over the pantnagar region india heramb et al 2022 lstm was found to perform better with improved accuracy than ann and empirical methods at three stations in different agro climatic zones of chhattisgarh india majhi et al 2020 while shaping the objectives for the present study it may be noted that india is an agro based economy and eto forecasting is critical for agriculture and efficient irrigation water supply spatial variation of eto and precipitation information are crucial to estimate the crop water footprint of a region dai et al 2021 tang et al 2020 this spatial distribution of crop water footprint can be used to delineate a region s water deficit and water abundance zones which can help policy makers take informed decisions in the management of water resources and efficient planning of cropping pattern and irrigation schedule tang et al 2019 zhang et al 2021a some recent studies explored the station wise multi step ahead eto prediction over very limited regions for example different machine learning methods were used to forecast eto up to seven days ahead at stations located in minas gerais brazil ferreira and da cunha 2020 multi step ahead eto forecasts were obtained at climate stations in iraq northern cyprus and turkey using ml models karbasi 2018 nourani et al 2020 ml methods were also used for multi step ahead t 3 and t 7 eto forecast using daily climatic data of hisar located in haryana state bathinda and ludhiana located in punjab state of india malik et al 2022 thus only a few eto forecasting studies exist over very limited regions in india moreover indian hydroclimatology is diverse so the predictability of eto is expected to vary across different agro climatic zones of india to investigate these issues this study aims at multi step ahead daily eto forecasting across different agro climatic regions of india to accomplish this the feasibility of six ml based algorithms is assessed the six ml algorithms svr mars rf mlp cnn and lstm are applied at a few weather stations to predict the eto using meteorological observations from that station as input and also using era5 reanalysis datasets as input subsequently the two best performing ml algorithms are selected which are used for grid wise eto prediction across the whole of india using hydroclimatological inputs from era5 reanalysis products effective ml based multi step ahead prediction of eto at station and grid scale using era5 reanalysis dataset makes the approach suitable for data scarce regions and adds to the novelty of this study 2 case study and data description 2 1 study on meteorological stations in this study daily meteorological station observations of hyderabad nagpur and bhubaneswar stations situated in krishna godavari and mahanadi river basins respectively were obtained from indian meteorological department imd the period of analysis for each station was decided based on the availability of the daily maximum and minimum temperatures tmax and tmin sunshine hour sh maximum and minimum relative humidity rhmax and rhmin and wind speed ws to build eto prediction model more details about the observation stations are provided in table 1 fig 1 a depicts the location of three stations and the elevation map of india different agro climatic zones of india classified by rao et al 2005 are shown in fig 1b the annual mean tmax ranged from 34 3 c at nagpur to 32 9 c at hyderabad mean tmin varied from 22 3 c at bhubaneswar to 20 6 c at nagpur the value of mean rhmax varied from 79 9 at bhubaneswar to 66 5 at nagpur whereas mean rhmin ranged from 69 9 at bhubaneswar to 47 7 at hyderabad again the mean value of ws varied from 2 14 m s at hyderabad to 1 05 m s at nagpur mean sh ranged from 7 26 h at nagpur to 5 0 h at bhubaneswar table 2 in this study four reanalysis datasets japanese 55 year reanalysis project jra ncep doe reanalysis 2 project ncep modern era retrospective analysis for research and applications version 2 merra and fifth generation of ecmwf atmospheric reanalysis of the global climate era5 were compared with meteorological observations from three stations the spatiotemporal resolution and other details of the four reanalysis data products are presented in table s1 fig s1 depicts the scatter plot and pearson correlation coefficient r between each reanalysis dataset with the meteorological observations at each station most variables from the era5 dataset show better agreement with station observations than other reanalysis datasets considering the r values between rhmax from observed and reanalysis data era5 shows the best correlation at nagpur r 0 82 and hyderabad r 0 76 whereas merra performs marginally better than era5 at bhubaneswar r 0 53 similarly rhmin and tmax from era5 dataset show the best agreement with observations at nagpur and hyderabad while jra performs better at bhubaneswar tmin from ncep shows better agreement with meteorological observations at all three stations although wind speed from all reanalysis sources shows the lowest agreement with observations era5 performs better at hyderabad and jra performs better at nagpur and bhubaneswar other studies have shown that era5 is of superior quality than other reanalysis datasets such as merra and ncep fersch and kunstmann 2014 xu et al 2022 moreover era5 has the finest spatial resolution of 0 25 0 25 and hourly temporal resolution among other reanalysis datasets zhang et al 2021b hence in addition to the station observations era5 dataset has been also used to develop ml models at the meteorological stations to evaluate the eto predictions against fao 56 pm eto for the three specific stations daily maximum and minimum temperatures maximum and minimum relative humidity and wind speed components from era5 datasets were linearly interpolated from the four nearest grid points more details about the variables are shown in table 2 2 2 gridwise study in india the gridded era5 datasets were extracted for entire india and used to build a gridwise eto prediction model across india daily maximum and minimum temperatures maximum and minimum relative humidity and wind speed components were obtained from era5 datasets similar to the station scale model for the gridded analysis across entire india during 2000 2019 potential evapotranspiration data from global land evaporation amsterdam model gleam was used as the target twelve years 60 and three years 15 of data for the period 2000 2014 were used for training and validation of the model respectively while the remaining five years of data 25 from 2015 to 2019 was used for testing the model the spatial resolution and source of the datasets used in this study are presented in table 3 3 methodology 3 1 empirical method for calculation of reference evapotranspiration at meteorological stations the physically based penman monteith equation penman 1948 also known as fao 56 equation is a well known empirical method for eto estimation as it consistently produces a reliable result in diverse climatic conditions allen et al 1998a b as per this method eto is given by 1 e t o 0 408 r n g γ 900 t mean 273 u 2 e s e a δ γ 1 0 34 u 2 where eto refers to the reference evapotranspiration mm d 1 rn refers to the net radiation at the crop surface mj m 2 d 1 g refers to the soil heat flux mj m 2 d 1 γ refers to the psychrometric constant kpa c 1 tmean refers to the mean daily ambient temperature at 2 m c u2 refers to the wind speed at 2 m m s 1 es refers to the saturation vapour pressure kpa ea refers to the actual vapour pressure kpa es ea refers to the saturation vapour pressure deficit kpa and δ refers to the slope of vapour pressure curve kpa c 1 eto from fao 56 penman monteith is used as reference for stations in this study as it is the most popularly used empirical equation almorox et al 2015 chen et al 2020 djaman et al 2019 there exists other similar empirical equations such as hargreaves samani hargreaves and samani 1985 priestley and taylor priestley and taylor 1972 hargreaves hargreaves 1975 and blaney criddle doorenbos and pruitt 1977 table s2 in the supplementary document lists the empirical equations used in this study all empirical models are locally calibrated using fao 56 pm as targets this calibration is done using simple linear regression model e t o f a o 56 p m a b e t o e m p i r i c a l suggested by allen et al 1998a b and used by other authors chen et al 2020 feng et al 2017 shiri et al 2014 where e t o f a o 56 p m is the eto estimated using fao 56 pm method e t o e m p i r i c a l is the eto estimated using different empirical equations a and b are regression coefficients the comparisons of multiple empirical equation at stations are shown against standard fao 56 pm equation allen et al 1998a b in fig s2 it is observed that the results obtained using other empirical models are more or less similar to the standard fao 56 pm method which being more popular is used in this study as the reference the eto calculated empirically using fao 56 pm equation eq 1 is the most reliable one for regions where detailed meteorological observations are available allen et al 2006 córdova et al 2015 paredes et al 2020 in fact in india total geographical area of india of 32 87 263 sq km only 219 agro meteorological stations record climate components to calculate reference evapotranspiration using the fao 56 pm equation jaswal et al 2014 moreover the data recorded at these agro meteorological stations also contain a significant portion of missing observations in such data scarce regions gridded globally available climatic information such as era5 reanalysis products may be modelled through machine learning ml techniques to predict eto successfully as shown in this study 3 2 gridwise evaluation of reference evapotranspiration very limited meteorological observation stations are available in india with scarce temporal coverage to assess eto at station scale in this study we have attempted to address this challenge by developing a gridwise model for the whole of india and evaluated the results for various agro climatic zones for gridwise evaluation eto from gleam is used as target and hydroclimatic components from era5 are used as input variables a total of 4647 grid points within india are modeled separately a flowchart indicating the details of the methodological steps is shown in fig 2 3 3 machine learning based regression algorithms machine learning based algorithms used in station and gridwise analysis are presented in this section in this study the potential of six ml algorithms svr mars rf ann cnn and lstm are explored to estimate eto from global gridded reanalysis datasets at first station level prediction models are developed which are later scaled up at each of the three meteorological stations hyderabad nagpur and bhubaneswar the prediction performance of each of the ml models was assessed for two sets of inputs i meteorological station observations and ii interpolated gridded reanalysis products in each case the model predictions were evaluated against the fao 56 eto calculated from station observations once the potential of the ml models are established at the station level the best performing models are further utilized for gridwise eto prediction throughout india in this case the performance is evaluated against the global gridded gleam datasets while selecting the hydroclimatic inputs for eto prediction ambient temperature and duration of sunshine were used since the energy required to turn water into vapour depends on these variables as evidenced in earlier eto modeling studies liang et al 2008 patle et al 2013 tabari and hosseinzadeh talaee 2014 additionally relative humidity and wind speed were used as these variables influence the diffusion of water vapour in the atmosphere and hence chosen in previous studies as potential predictors of eto granata 2019 tao et al 2018 wu et al 2019 in addition to portray the seasonal dynamics of eto throughout the year julian days jday was used as an input variable ferreira and da cunha 2020 grange and carslaw 2019 hence tmax tmin rhmax rhmin sh ws and jday were used as the input set of predictors while using station observations however for the models using gridded reanalysis products all the aforementioned variables except sh was used as the later is not available from the era5 reanalysis datasets more details of input parameters and sources of input and target variables for the seven prediction horizons are presented in table 4 for both station wise as well as gridwise analysis seven different prediction horizons are considered real time prediction ph0 1 day ahead ph1 2 day ahead ph2 7 day ahead ph7 14 day ahead ph14 21 day ahead ph21 and 28 day ahead ph28 a brief description of the machine learning algorithms used in this study are presented in section s1 of the supplementary document 3 4 modeling algorithms and hyperparameter tuning eto was estimated with six machine learning algorithms based on reference eto data and their corresponding predictor values that were extracted from the meteorological station and era5 data products six regression algorithms include a kernel based model svr mars algorithm tree based ensemble model rf and three neural network based models mlp cnn and lstm pedregosa et al 2011 for each of the ml algorithms used in modeling eto the hyperparameters need to be optimized first zhang et al 2020 the configuration of key hyperparameters tuned for each ml algorithm is presented in table 5 rbf is an extensively used kernel function that is strongly nonlinear and powerful for learning complex interactions between input output variables additionally it also has the advantage of high computational efficiency ahmad et al 2020 xuan et al 2015 so rbf is used as the svr kernel function in this study hence the hyperparameters for svr with rbf kernel are the regularization parameter c and kernel coefficient gamma parameter c controls the regularization of the model and the width of the error margin while gamma determines the influence of a single training sample the hyperparameters for mars algorithms are the maximum number of terms to retain in the final model max terms and the maximum degree of interaction between piecewise linear functions max degree two hyperparameters were optimized for the rf algorithm the number of trees required n estimators to build the rf algorithm and the maximum depth of a tree max depth which controls the complexity of each tree in case of the mlp model the size of the hidden layer hidden layer sizes which contains the number of hidden layers and the number of perceptrons included in each hidden layer should be optimized two hidden layers were used in case of cnn and lstm models the number of perceptrons in each layer first hidden layer sizes and second hidden layer sizes was optimized for these two models the optimum combination of hyperparameters for individual eto prediction models was determined using grid search technique with cross validation based on the configuration of hyper parameters as presented in table 5 3 5 k fold cross validation 3 5 1 cross validation at meteorological station each ml model in this study was developed using a k fold cross validation approach k was chosen as 5 while modeling eto at the selected meteorological stations the entire data set was divided into five equal portions out of these four parts have been used to train the model at a time and the remaining one part is used to validate the model this cross validation approach ensures that each fold of the data becomes new dataset or test dataset at least once the performance of each fold i e validation score for a set of hyper parameters were inspected and the set of hyper parameters with the best performance were selected using this cross validation method finally the average of the validation period performances for each fold is reported as the overall performance an explanatory flowchart of this cross validation steps is shown in fig 3 a 3 5 2 cross validation during gridwise analysis while performing the gridwise analysis with reanalysis datasets the available data was much longer than the station datasets hence in this case a separate testing period is earmarked in addition to the 5 folds of the training dataset which are used for cross validation this is explained through a flowchart fig 3b as mentioned earlier the hyperparameters of each model were tuned using the grid search method 4 results 4 1 prediction performance of ml models using meteorological station observations as input the daily eto prediction performance of the six ml models svr mars rf mlp cnn and lstm for seven different prediction horizons ph0 ph1 ph2 ph7 ph14 ph21 and ph28 at the three meteorological stations are presented in table 6 a c the scatter plots of the model predicted vs observed calculated using fao 56 pm eto for nagpur are shown in fig 4 fig 4a indicate the performance of the six models using meteorological observations from the station as input whereas the fig 4b depicts the performance of the six models using meteorological variables from era5 products as input the later are discussed further in the next subsection 4 2 figs s3 and s4 depict similar results for the stations hyderabad and bhubaneswar respectively while considering real time prediction ph0 of daily eto svr mlp and cnn show excellent performance at each of the three meteorological stations the nrmse value for svr mlp and cnn is 5 whereas the nrmse for mars and rf is upto 7 1 and for lstm 18 using station observations for 1 day ahead prediction horizons ph1 all the models show a lower performance than ph0 ref table 6 however the performances of all models are best at nagpur station the efficiency of forecasting further reduces with 2 day ahead prediction models ph2 at nagpur performance of svr is the best among all the models up to 2 day ahead prediction fig 4a and table 6a the performance statistics obtained using svr up to ph2 range from 0 999 to 0 787 r2 0 052 to 0 561 mm day mae and 1 5 to 18 4 nrmse cnn mlp and rf are the next best performing algorithms at nagpur lstm is the worst performing algorithm up to ph1 showing the highest range of nrmse 14 4 to 18 2 and mae 0 432 to 0 558 mm day lowest range of r2 0 791 to 0 869 mm day while mars performs the worst at ph2 r2 0 732 mae 0 648 mm day nrmse 20 6 the performance of the lstm model at nagpur starts to improve after the 2 day ahead forecast and is observed to outperform the other models at ph7 in general for all the models the forecasting performance is reduced up to the 7 day ahead prediction models ph7 after ph7 there is a negligible drop in performance of models at all three stations i e at hyderabad the best performing algorithm at ph7 has r2 of 0 549 mae of 0 815 mm day and nrmse of 22 8 whereas at ph28 best performing algorithm has r2 of 0 544 mae of 0 82 mm day and nrmse of 22 9 in terms of performance statistics rf outperforms other models at all three station in ph21 and ph28 where mae ranges from 0 638 to 0 826 mm day r2 ranges from 0 544 to 0 719 and nrmse ranges from 21 2 to 23 8 but considering the scatter plot the prediction efficiency of mlp and cnn can be said to be superior because rf is unable to predict eto more than a certain value 8 mm day in last two prediction horizons at hyderabad the performance of svr mlp and cnn are equally good and better than the other ml models up to 2 day ahead prediction where the performance indicators varies in the range of 0 636 to 0 999 r2 0 036 to 0 734 mm day mae and 1 to 20 4 nrmse this holds true for bhubaneswar as well although lstm based predictions in hyderabad and bhubaneswar are quite good in terms of most of the metrics it is the worst performing algorithm up to 2 day ahead prediction model the best performance of lstm is observed in the 7 day ahead prediction model at all three stations and the prediction accuracy increases in subsequent models to become equivalent to the best model overall mars is the worst performing algorithm at the three stations with performance indicator for ph0 ranging from 0 982 to 0 986 r2 0 141 to 0 161 mm day mae and 4 to 5 3 nrmse and performance matrices for ph28 are noticed to be in the range of 0 481 to 0 537 r2 0 847 to 0 9 mm day mae and 24 4 to 27 1 nrmse the bias parameter is found to be not always in accordance with the other three performance indicators while suggesting the best model this is not unexpected as a low value of bias may sometimes result due to cancellation of errors in a less accurate prediction time series plots of ml model predictions using station data with observed eto are presented in the supplementary document in figs s5 a s6 a and s7 a for nagpur hyderabad and bhubaneswar stations respectively 4 2 performance assessment of ml models using era5 reanalysis products as input the performance of the six ml models for predicting daily eto at the meteorological stations using era5 reanalysis products as inputs list of selected variables mentioned earlier in section 3 3 table 4 are provided in table 6 a c in this case overall lstm cnn and mlp are found to be the best performing models performance matrices for real time ph0 and 1 day ahead prediction using the era5 dataset across all stations are noticed to be in the range of 0 719 to 0 848 r2 0 471 to 0 598 mm day mae and 15 6 to 20 6 nrmse for ph0 and ph1 models using era5 datasets are less accurate than models with similar prediction horizons using station observations but models using era5 datasets for later prediction horizons ph2 to ph28 perform better than station observations in most cases it is observed from table 6 that the forecasting efficiency of all the models decrease with increase in the lead time i e performance at ph0 is better than that at ph1 which is again better than ph2 ph7 and later models this could be obvious due to a decrease in generalization capabilities and error propagation of the models for ph2 the values of mae ranges from 0 538 to 0 656 mm day r2 ranges from 0 668 to 0 807 and nrmse ranges from 17 5 to 22 4 where mlp is found to be the best performing model at nagpur and hyderabad and cnn at bhubaneswar the prediction performance decreases at ph7 compared to ph2 at all three stations but the performance drop between ph7 and ph28 is negligible the performance measures of the best models for ph7 are noticed to be in the range of 0 574 to 0 722 r2 0 64 to 0 794 mm day mae 21 to 23 5 nrmse similarly the ranges for ph28 are 0 547 to 0 722 r2 0 635 to 0 823 mm day and 21 to 24 nrmse among the meteorological stations nagpur has the best performance compared to the other two stations it can also be seen that the accuracy of the lstm increased at later prediction horizons ph7 to ph28 compared to the initial prediction models however cnn is found to be the best performing model for most of the prediction horizons between ph14 and ph28 at all meteorological stations table 6 for 28 day ahead forecast ph28 rf shows the best performance in nagpur r2 0 722 mae 0 635 mm day nrmse 21 bias 0 002 mm day while cnn is the best model at hyderabad and bhubaneswar station simultaneously the mlp and lstm models perform extremely well at all prediction horizons and at each meteorological station time series plots of ml model predictions using era5 dataset with observed eto are presented in figs s5 b s6 b and s7 b for nagpur hyderabad and bhubaneswar stations respectively fig 5 depicts the prediction accuracies of the various ml algorithms in the form of taylor diagram td at the three meteorological stations td uses standard deviation and correlation coefficient r of observed and modeled values to make the classification a model that presents the same amplitude of variation as the observed data and r 1 is considered to be the best the performance of almost all the models for ph0 is very good however mlp svr and cnn shows a superior performance at each of the meteorological stations exceptionally the lstm forecasts shows worst prediction capabilities at all stations when using station observations over the prediction horizon ph0 however there is a negligible fluctuation in the performance of almost all models at each station for other prediction horizons over the prediction horizons ph1 to ph28 the performance of all eto prediction models using era5 reanalysis products is very close to the performance of the models using station observations it is also evident in the taylor diagram that the models using the era5 dataset show higher performance than the models with station observations in most cases between ph2 to ph28 additionally the box plots are presented fig s8 to visualize the accuracy of ml algorithms fig s8 depicts the residuals i e observed eto predicted eto of each developed ml algorithm in the form of a boxplot after omitting the outliers it clearly shows that the distribution of the residuals are very close to zero for each real time prediction model however the residuals of svr mlp and cnn are almost negligible indicating superior performance the residuals of the models using era5 datasets are much larger compared to models using station datasets for ph0 however the comparable performance of the former are evident for all other prediction horizons as seen from the residuals fig s8 4 3 gridwise model development and performance evaluation across india from the results in the previous section it can be observed that svr mlp and cnn are the best performing models in most cases using the era5 dataset as input the ml algorithms with superior prediction capabilities at meteorological stations one classical ml models and another neural network nn based model are further used for the development of gridwise eto prediction models the svr model is selected along with the nn based model because its performance is as good as mlp cnn and lstm in addition this model is computationally less expensive and takes less time to build than the nn based models among the nn based models the cnn model performs better in all three stations at later prediction horizons i e ph14 ph21 and ph28 for the grid wise analysis considering the model building time and prediction efficiency of mlp and cnn models at different prediction horizons mlp is used for ph0 to ph7 and cnn is used in the latter prediction horizons ph14 ph21 and ph28 each grid point within india 4647 grids are tuned separately during the tuning of gridwise models and the best set of hyperparameters for each grid are identified tuned hidden layer sizes for mlp ph0 models are 64 64 and 64 16 for the best 35 875 n 74 625 e and the worst 8 375 n 77 375 e performing grid points respectively while for other prediction horizons ph1 ph2 and ph7 it varies among 16 32 and 64 similarly tuned hyperparameters for the svr models at the best and worst performing grids over all seven prediction horizons varies among regularization parameter c 10 100 1000 and kernel coefficient gamma 0 1 and 0 2 fig 6 depicts the coefficients of determination r2 between observed and predicted daily eto using svr mlp and cnn algorithms over india the prediction accuracy of nn based model mlp and cnn is comparatively better than svr across all the prediction horizons approximately 18 of grid locations have an r2 value of more than 0 8 while an additional 68 of grids have an r2 value between 0 5 and 0 8 for real time prediction ph0 of eto using mlp hence only 14 of grids have an r2 value of less than 0 5 these worst performing grid locations are mostly situated in the western coastal part of south india similarly for 1 day ahead prediction ph1 the r2 value is more than 0 8 for around 14 of the total grid points and between 0 5 and 0 8 for 56 of grids in india the prediction accuracy decreases further for 2 day ahead prediction ph2 models the total number of grids with r2 between 0 5 and 0 8 is approximately 27 while r2 0 8 is 12 accuracy is further reduced for 7 day ahead ph7 predictions the total number of grids with r2 between 0 5 and 0 8 is reduced to about 19 while r2 0 8 is 12 the worst performing grids for this prediction horizon ph7 in terms of r2 value are mostly located in the coastal region of peninsular india from fig 6 it can be observed that there is no significant decrease in r2 value for subsequent prediction models ph14 ph21 and ph28 from 7 day ahead prediction however nn based algorithms mlp and cnn outperformed svr at all prediction horizons fig 7 depicts that the mae mm day corresponding to mlp and cnn is less compared to the svr for each prediction horizon similarly the nrmse in terms of percentage in fig 8 also indicates that nn based algorithms are better than svr when predicting gridwise eto among all the grids inside india 89 have nrmse values less than 20 additionally another 10 of grid points have nrmse between 20 and 25 while predicting real time ph0 eto similarly for 1 day ahead prediction of eto the nrmse is less than 20 for approximately 45 of all grid points and an additional 48 of grid points have an nrmse values between 20 and 25 however the prediction capabilities of the ph2 model reduces as only 21 of grids have nrmse value less than 20 and 67 of grid points have nrmse between 20 and 25 this prediction capabilities further decreases as only 14 of the grids have nrmse value below 20 and another 64 have nrmse between 20 and 25 for ph7 in terms of nrmse values there is a slight decrease in performance in ph14 compared to ph7 but it remains the same for subsequent prediction horizons ph21 and ph28 the grid points over the himalayan region of india show a high r2 and low mae however the nrmse value is rather high for some of these grids fig 9 depicts the spatial distribution of the bias mm day values for the gridwise eto prediction models bias increases uniformly from real time prediction to 7 day ahead prediction and remains more or less same for subsequent prediction horizons for the svr model however fluctuation of bias is not uniform for the mlp and cnn model for instance 1 day ahead prediction model has more grids with positive bias than ph2 and ph7 models on the other hand the number of grids with negative bias values increases steadily from ph14 to ph28 in some parts of south india similar to the previous three performance statistics r2 mae and nrmse bias values also suggest nn based algorithms mlp and cnn as the most suitable algorithms for gridwise model evaluation in this study 4 4 evaluation of model performance across major cropping seasons and agro climatic zones as the prediction of eto plays an important role in planning agricultural systems the model performance is evaluated for the two main cropping seasons in india kharif june september and rabi october march birthal and hazrana 2019 fig 10 depicts the average predicted eto values as a fraction of observed for the kharif and rabi seasons for the testing period i e 2015 2019 using mlp for ph0 to ph7 and cnn ph14 to ph28 the fraction of predicted eto over observed eto for real time predictions ph0 is very close to 1 as shown in fig 10 however some parts of the arid region and northern part of the semi arid tropic region underestimates the eto for both kharif and rabi season for ph0 and ph1 eto is slightly overestimated for each crop season and prediction horizon in the eastern part of the semi arid temperate zone for ph7 the arid and northeastern part of the humid region marginally underestimates the eto while the eastern part of semi arid temperate and eastern part of semi arid tropic region slightly overestimates the eto the performance in the humid region is good and the average values in the fraction map fig 10 are very close to 1 for each prediction horizon and cropping season in the arid region eto is highly overestimated for ph1 and ph2 but it slightly reduced for ph7 and increases again for ph14 to ph28 during the rabi crop season there is no notable difference in prediction performance between ph14 and ph21 for kharif season fig 10 e and f whereas in ph28 the model highly underestimates eto in the arid region and overestimates the same in the semi arid tropics region a similar pattern is observed for the rabi season fig 10 l m in the himalayan arid zone and the northern part of the semi arid tropics predicted eto is underestimated at ph14 ph21 and ph28 during the rabi season but overestimated in the southern part of the semi arid tropics at ph28 the rabi crop season shows a better prediction than the kharif seasons over the testing periods the r2 value between observed and real time predictions ph0 of eto over the kharif and rabi seasons are 0 957 and 0 988 respectively fig s9 depicts the coefficient of determination and other performance indicators between average observed gleam eto and predicted eto during the testing period 2015 2019 over different prediction horizons ph0 to ph28 it is observed that prediction accuracy is more with lower values of eto and it reduces with the increase of eto values since the kharif season has a greater number of days with high eto the prediction performance is comparatively lower for this season than the rabi season fig 11 depicts the agro climatic zone wise performance r2 of ml models for the testing period 2015 2019 in the form of a heatmap fig s10 presents the agro climatic zone wise mae mm day of ml models for each agro climatic zone similar to the observations of the previous section 4 3 mlp and cnn are found to be the best performing model across the different agro climatic zones as well hence further discussion on the agro climatic zone wise performance is based on the mlp for ph0 to ph7 and cnn ph14 to ph28 model outputs it is observed from fig 11 and fig s9 that the rabi season shows a better model performance than the kharif season among the agro climatic zones the best performance considering r2 and mae is observed over the arid region in both the crop seasons and all the prediction horizons the semi arid temperate region is found to be the next best performing region after the arid region during the rabi season the performance statistics are noticed to be in the range of 0 739 to 0 871 r2 and 0 316 to 0 374 mm day mae considering the value of r2 humid region is the next best performing region during kharif season where r2 ranges from 0 135 to 0 565 while semi arid temperate region is the best performing region after arid region according to mae range from 0 747 to 1 041 mm day the worst performing zone in rabi and kharif season considering the r2 values are the semi arid tropics range of r2 0 524 to 0 704 and semi arid temperate range of r2 0 099 to 0 518 respectively according to the mae values the humid region is the lowest performing zone in both cropping seasons mlp cnn and svr models are able to capture the seasonal dynamics of eto and for different agro climatic zones however the mlp and cnn are superior than svr in predicting eto the findings of this study will greatly benefit agriculture and irrigation planning as an innovative modeling approach particularly in regions with limited station observations and over india where meteorological data and in situ observations are limited 5 discussions in recent literature for real time eto prediction in different climate regions of china wu et al 2019 the model performance in the best and worst performing stations are found to vary between r2 0 995 to r2 0 988 similar studies in india are restricted to only a few stations in punjab and haryana saggi and jain 2019 wherein daily eto is predicted better for patiala station r2 0 98 than hoshiarpur station r2 0 95 using deep learning methods utilizing era5 land dataset eto is derived in sicily italy with an average performance of r2 0 76 pelosi and chirico 2021 a study on prediction improvement of daily pan evaporation in three distinct agro climatic zones of chhattisgarh found best performance using lstm model ranging from 0 716 to 0 915 majhi et al 2020 in the present study the models show a very satisfactory performance wherein the lowest performance is obtained at bhubaneswar using lstm r2 0 788 and the best performance is obtained using svr and mlp at each of the three meteorological stations r2 0 999 additionally using the era5 reanalysis dataset the lowest performance is found in bhubaneswar r2 0 712 using the mars model and the best performance is found in nagpur r2 0 847 using the lstm model which are also quite satisfactory considering they do not require any station based observations in the context of multistep ahead eto predictions recent studies in meteorological stations in the minas gerais region of brazil using cnn lstm present 1 day ahead eto forecasts r2 0 62 and 2 days ahead eto forecasts with reduced performance r2 0 55 the 7 day ahead prediction further reduces with r2 around 0 5 ferreira and da cunha 2020 a 1 step ahead eto forecast study at a meteorological station located in gazipur sadar bangladesh found correlation coefficients r 0 698 and 0 999 during testing phase using lstm and bi lstm models respectively roy 2021 a multi step ahead prediction of mean monthly eto at ten meteorological stations representing different climate zones from turkey northern cyprus and iraq shows the best performance for 1 step ahead eto prediction using the anfis model at famagusta station nash sutcliffe efficiency nse 0 772 whereas the best performance for the 2 step ahead eto forecasting is obtained at kyrenia using the anfis model nse 0 764 nourani et al 2020 in a study conducted at three meteorological stations in punjab and haryana states of india 7 day ahead eto forecasting using the hybrid multivariate variational mode decomposition technique integrated with the ridge regression feature selection algorithm and kernel extreme learning machine model is found to have the best performance with nse ranging from 0 931 to 0 874 malik et al 2022 daily eto prediction study at three meteorological station located at semi arid region of central ningxia china found an average nse value of 0 988 and 0 982 for 1 day ahead and 7 day ahead prediction respectively yin et al 2020 eto forecasting study carried out in cypress swamp southern florida found best performance with lstm model ph1 r2 0 915 ph7 r2 0 910 and kobeh valley central nevada found best performance with nonlinear autoregressive network with exogenous inputs narx model ph1 r2 0 888 ph7 r2 0 881 granata and di nunno 2021 in comparison in the present study the best performance for a 1 day ahead forecast is found at nagpur r2 0 872 using svr and the worst performance is found at bhubaneswar r2 0 798 using mlp using meteorological observations as input similarly using the era5 gridded reanalysis dataset as input this study noted better performance for 1 day ahead forecasting in nagpur r2 0 848 using cnn than hyderabad r2 0 755 using mlp and bhubaneswar r2 0 721 using mlp similarly for 2 days ahead forecasting of eto using meteorological station observations as well as era5 dataset as input better accuracy is observed in nagpur than hyderabad and bhubaneswar table 6 the forecast performance for 7 day ahead and subsequent prediction horizons using the era5 dataset at all three stations is superior to that of the model using meteorological observations better performance is also found at nagpur for the 7 day ahead forecast where prediction accuracy using the era5 dataset r2 0 728 mae 0 625 mm day nrmse 20 8 is marginally better than using meteorological station observations r2 0 727 mae 0 63 mm day nrmse 20 9 while the worst performance is observed in hyderabad r2 0 569 mae 0 801 mm day nrmse 22 2 a study conducted across different seasons in zanjan iran used wavelet gpr model to obtain daily eto forecast from 1 to 30 day ahead the performance metrics for the 14 day ahead model range from 0 662 to 0 907 r2 and 13 3 to 25 2 nrmse while the accuracy for the 27 day ahead model decreases to a range of 0 436 to 0 851 r2 and 17 3 to 23 8 nrmse karbasi 2018 in the present study after ph7 insignificant fluctuations in prediction accuracy is observed for subsequent models ph14 ph21 and ph28 performance matrices ranged from 0 722 to 0 725 r2 and 20 9 to 21 nrmse notably the best performance obtained for ph14 and ph21 at nagpur is better than ph7 similarly the performance of ph14 at bhubaneswar is better than ph7 although the nse or r2 value reported by malik et al 2022 karbasi 2018 granata and di nunno 2021 and yin et al 2020 are higher than those found in the present study the cited studies uses only station observations to model eto which may not be easily and freely available in the present study the 7 day ahead and subsequent prediction model have not exhibited high accuracies however they indicate reasonable accuracy considering global gridded reanalysis datasets 6 summary and conclusions multistep ahead accurate prediction of reference evapotranspiration is crucial for irrigation planning and efficient management of available water resources in regions with inadequate number of meteorological stations where empirical methods have limited utility the development of robust prediction algorithms using globally available climate datasets is beneficial in this study the potential of six ml based algorithms support vector regression svr multivariate adaptive regression splines mars random forest rf multi layer perceptron mlp one dimensional convolutional neural network cnn and long short term memory lstm were evaluated for the prediction of eto at seven different prediction horizons ph real time ph0 1 day ahead ph1 2 day ahead ph2 7 day ahead ph7 14 day ahead ph14 21 day ahead ph21 and 28 day ahead ph28 three meteorological stations nagpur hyderabad and bhubaneswar in india were selected as test beds before scaling up the models across the whole of india across different agro climatic zones and across multiple cropping seasons using station observations the performance of all the six implemented algorithms is very high which is not unexpected as the inputs are known to be related via empirical equations mlp cnn and svr are found to capture the relationship most accurately thereby producing the best performance while overall mars proved to be the worst model the potential of the ml models is best realized when multi step ahead eto prediction is undertaken at locations without station observations using only globally available gridded era5 reanalysis datasets although the modeled eto values using gridded climatic information are slightly less accurate than the models based on direct station observations at real time and 1 day ahead prediction they are as accurate as the models based on station observations during later prediction horizons 2 day to 28 day ahead interestingly for larger prediction horizons the prediction performance is generally better using the era5 inputs than using station observations hence a fairly accurate multi step ahead daily eto prediction model can be developed using gridded climatic information as the best performances at the station level are achieved with svr cnn and mlp one neural network based model mlp for ph0 to ph7 and cnn for ph14 to ph28 and one classical ml technique svr are further used for the gridwise prediction of eto across entire india using era5 climate datasets as inputs and gleam eto values as the reference among these algorithms nn based models mlp and cnn performs better for all the seven prediction horizons the developed mlp algorithm was able to predict real time eto quite well with r2 values greater than 0 5 at approximately 86 of the total grid points the corresponding percentage for 1 day ahead prediction is approximately 70 which drops to 39 for 2 day ahead and 31 for 7 day ahead prediction however further increase in prediction horizon beyond 7 days do not cause any significant drop in prediction accuracy the number of grids with negative bias values in parts of south india continues to increase from ph14 to ph28 using cnn model considering the crop season wise performance of mlp and cnn model rabi season r2 noted to be in the range of 0 977 to 0 988 exhibits better prediction accuracy compared to the kharif season r2 ranges from 0 906 to 0 962 fig s8 considering the different agro climatic regions the best performance was observed over the arid region for mlp cnn and svr models during rabi and kharif season the next best performance is observed over the semi arid temperate region during rabi season where performance indices range from 0 316 to 0 374 mm day mae and 0 739 to 0 817 r2 using mlp and cnn algorithms thus the results endorsed the potential of svr mlp and cnn for multi step ahead prediction of daily eto using era5 reanalysis products in regions with limited meteorological observations further the model performance is found to be reasonably good across the different agro climatic zones and also for various cropping seasons these multi step ahead eto forecasts can address a fundamental need by depicting the crop water footprint of a region additionally the results of this analysis are helpful in evaluating the amount and schedule of irrigation supply in a region credit authorship contribution statement nehar mandal formal analysis investigation writing original draft kironmala chanda conceptualization supervision investigation writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we acknowledge the support provided by dst serb through the project crg 2022 007728 we acknowledge the scikit learn tensorflow and py earth machine learning libraries which were used to build the svr rf mlp cnn lstm and mars models appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2023 129418 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
