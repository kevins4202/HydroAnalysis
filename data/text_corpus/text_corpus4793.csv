index,text
23965,a stochastic representation based on a physical transport principle is proposed to account for mesoscale eddy effects on the evolution of the large scale flow this framework arises from a decomposition of the lagrangian velocity into a smooth in time component and a highly oscillating term one important characteristic of this random model is that it conserves the energy of any transported scalar such an energy preserving representation is tested for the coarse simulation of a barotropic circulation in a shallow ocean basin driven by a symmetric double gyres wind forcing the empirical spatial correlation of the random small scale velocity is estimated from data of an eddy resolving simulation after reaching a turbulent equilibrium state a statistical analysis of tracers shows that the proposed random model enables us to reproduce accurately on a coarse mesh the local structures of the first four statistical moments mean variance skewness and kurtosis of the high resolution eddy resolved data keywords stochastic modeling mesoscale eddies geostrophic turbulence wind driven circulation 1 introduction mesoscale eddies contain a significant proportion of ocean energy and have an important impact on large scale circulations they are found everywhere in the ocean and are particularly intensive in the western boundary currents like the gulf stream and the antarctic circumpolar current unfortunately to fully resolve these eddies in numerical simulations a horizontal resolution of 10 km is required which is far too expensive for a large ensemble of realizations or simulations over a long time duration neglecting mesoscale eddy effects may lead to strong errors in the evolution of the large scale dynamics therefore they need to be properly modeled or parametrized a classical parametrization approach is to introduce eddy viscosity in coarse models to mimic the action of the computationally unresolved scales while simultaneously ensuring numerical stability by avoiding pile up of energy at the cutoff scale the explicit dissipation mechanism is often represented either by a harmonic or biharmonic friction term with uniform coefficient or through functional operators smagorinsky 1963 leith 1971 griffies and hallberg 2000 that depend on the resolved flow a more widely adopted approach in ocean modeling is to include the gent mcwilliams parametrization scheme gent and mcwilliams 1990 gent et al 1995 in addition to eddy viscosity to model the potential energy flux by smoothing the neutral surface height however encoding only large scale dissipation in coarse models often leads to an excessive decreasing of the resolved kinetic energy arbic et al 2013 kjellsson and zanna 2017 an alternative approach is based on stochastic parametrization berloff 2005 grooms and majda 2014 porta mana and zanna 2014 cooper and zanna 2015 grooms et al 2015 zanna et al 2017 which aims to introduce energy backscattering across scales these models provide a marked benefit in improving the internal ocean variability which can be paramount in ensemble forecasting and data assimilation as a matter of fact it is well known that models with poor variability usually lead to very low spread of the ensemble karspeck et al 2013 hence assimilation systems tend to be over confident in the model as compared to the observations however to overcome numerical instability brought by introducing random forcing specific tuning parameters are often included in these parametrized models the success of such tuning methods often does not extend into new flow regimes stochastic parametrization techniques have been proposed for reduced order climate models based on rigorous homogenization techniques frank and gottwald 2013 franzke et al 2005 franzke and majda 2006 franzke et al 2015 gottwald et al 2017 majda et al 1999 these models rely on a scale separation principle and introduce a linear stochastic ansatz model with damping terms for the nonlinear small scale evolution equation the resulting homogenized dynamics are cubic with correlated additive and multiplicative cam noises in the absence of scale separation the system usually becomes non markovian and incorporates memory terms as shown in the mori zwanzig equation givon et al 2004 gottwald et al 2017 alternatively mémin 2014 proposed a consistent stochastic framework defined from physical conservation laws this derivation keeps the full nonlinearity of the system yet relies on a strong temporal scale separation principle within this framework the lagrangian velocity is decomposed into a smooth component and a highly oscillating random field a stochastic transport principle is subsequently derived using stochastic calculus notably the resulting evolution of a random tracer includes a multiplicative random forcing a heterogeneous diffusion and an advection correction due to inhomogeneity of the random flow component with these additional terms a remarkable energy conservation property along time for any realization of the advected tracer still holds resseguier et al 2017a this stochastic transport principle has been used as a fundamental tool to derive stochastic representations of large scale geophysical dynamics resseguier et al 2017a b c chapron et al 2018 in which the missing contributions of unresolved processes are explicitly taken into account similar approaches based on the same decomposition have been also recently proposed by holm 2015 and gugole and franzke 2019 the performance of such a random model has been evaluated and analyzed in terms of uncertainty quantification and ensemble forecasting resseguier et al 2020 for a surface quasi geostrophic sqg flow a more efficient spread is produced by the proposed model compared to a deterministic model with perturbed initial condition as discussed above this ability is essential for data assimilation applications recently a stochastic barotropic quasi geostrophic qg model has been proposed bauer et al 2020 within this setting to study the structuration effect of the random field on the large scale flow numerical results illustrate that encoding an inhomogeneous random component into a propagating monochromatic rossby wave induces the formation of extra large vortices in the present work the performance of this stochastic barotropic model is assessed for the numerical simulation of an idealized double gyre wind forcing within an enclosed shallow basin at midlatitude the wind driven circulation is a classical simplified problem in oceanography vallis 2017 which produces qualitatively realistic patterns of mesoscale eddies in approximate geostrophic equilibrium a particular circulation greatbatch and nadiga 2000 living in a highly turbulent regime under weak dissipation of potential enstrophy leads to a stationary four gyre structure in a long time average sense we focus here on the ability of the proposed stochastic models to accurately represent at a coarse resolution the four first statistical moments mean variance skewness and kurtosis of the flow comparing this statistical distribution through its four moments to that predicted by the eddy resolving data enables us to qualify and quantify the accuracy of our stochastic representation of mesoscale eddy effects on large scale circulation the paper is structured as follows section 2 briefly reviews the barotropic wind driven model in adimensional form section 3 focuses on the stochastic transport principles and the derived stochastic barotopic vorticity equation section 4 details the data driven approaches adopted for the modeling of the random small scale velocity field section 5 discusses the numerical results and their long term statistics finally section 6 concludes this work and gives some outlook for future research 2 barotropic vorticity equation in this work we use a single layer qg formulation to study the wind driven circulation in an oceanic basin following vallis 2017 under this regime the dimensional barotropic vorticity equation bve can be written as 2 1a ω t j ψ ω β ψ x f d 2 1b 2 ψ ω where ω k u x v y u is the relative or kinematic vorticity henceforth referred to as vorticity with k 0 0 1 t the oceanic geostrophic velocity u can be defined by a stream function ψ such that u ψ y ψ x ψ t the nonlinear advection is transformed into a jacobian operator which is defined as j ψ ω x ψ y ω y ψ x ω the linear term β x ψ describes the advection of β planetary vorticity an active tracer in this case is given by the potential vorticity pv defined as q ω β y on the right hand side rhs of 2 1a f k τ ρ h is a forcing which adds vorticity into the gyres due to the wind stress τ over the ocean surface where ρ and h are respectively resp the basic fluid density and depth of the basin an idealized double gyre wind stress greatbatch and nadiga 2000 defined only in zonal direction is used in this work within the basin ω 0 l l l that is 2 2 τ τ 0 cos π y l 0 t where τ 0 is the magnitude of the wind this form of wind stress san et al 2011 2013 represents the meridional profile of easterly trade winds mid latitude westerlies and polar easterlies from south to north over the ocean basin the boundary layer friction d can be interpreted either as a linear drag for the ekman layer as presented in the stommel problem stommel 1948 an eddy viscosity term as presented in the munk problem munk 1950 or a combination of the two fox kemper 2005 in this work we are more interested in the munk model by assuming that the ocean has a flat bottom the eddy viscosity that we will discuss in the following will be either harmonic d ν 2 2 ω or biharmonic d ν 4 4 ω with a uniform coefficient ν 2 of unit m 2 s 1 or ν 4 of unit m 4 s 1 to simplify the problem one may scale eq 2 1a by comparing each term to the dominant β effect vallis 2017 the leading order is given by the sverdrup balance between the rotation and wind forcing i e β x ψ f which provides a characteristic size of velocity 2 3a v τ 0 ρ h π β l this leads to the following scaling of time vorticity and stream function 2 3b t l v t ω v l ω ψ v l ψ where the variables with prime symbol are adimensionalized the thickness of the munk boundary layer can be then quantified by the balance between the β effect and friction munk 1950 for instance β x ψ ν 2 2 ω gives us a harmonic boundary layer scale that is 2 3c δ 2 ν 2 β 1 3 similarly β x ψ ν 4 4 ω gives us a biharmonic boundary layer scale 2 3d δ 4 ν 4 β 1 5 the nonlinear advection term j ψ ω is smaller than the linear terms nevertheless the nonlinear effect may still be important in the boundary layer especially in the western one to measure its strength one may define a β rossby number denoted as r β as the ratio of the size of the nonlinear term to the β effect 2 3e r β v β l 2 using these scaling numbers 2 3a 2 3e for 2 1a the dimensional bve reduces to its adimensional form as 2 4 ω t j ψ ω 1 r β ψ x 1 r β sin π y 1 r β d with d δ 2 l 3 2 ω or d δ 4 l 5 4 ω resulting from 2 3c or 2 3d respectively the adimensional pv is written as q r β ω y and the poisson equation 2 1b is invariant under this adimensionalization i e 2 ψ ω for the sake of readability in the following we drop the prime for all the adimensional variables to close the problem we need one initial condition that will be discussed in section 5 1 and two boundary conditions the first boundary condition is imposed by the no normal flow condition due to the forcing form 2 5a ψ ω 0 i e u x 0 l v y l l 0 where ω denotes the basin s boundary the second one depends on the chosen eddy viscosity form for a harmonic friction i e d δ 2 l 3 2 ω we impose 2 5b ω ω 0 while for a biharmonic friction i e d δ 4 l 5 4 ω we set 2 5c ω ω 0 and 2 ω n 2 ω 0 where 2 n 2 denotes for the second derivative in normal direction note that in both cases together with the no normal flow condition we get a free slip condition 2 5d 2 ψ n 2 ω 0 i e v x x 0 l u y y l l 0 with no horizontal shear on each boundary finally we remark that the munk model 2 4 depends only on two parameters which are r β and δ 2 l resp δ 4 l 3 stochastic barotropic vorticity equation this section provides a stochastic representation of the barotropic qg flow we start by introducing the stochastic lagrangian flow x ω r d d 2 3 given by mémin 2014 3 1 d x t u x t t d t σ x t t d b t this decomposition is based on the assumption of a temporal scale separation in which the large scale component u is both spatially and temporally correlated while the small scale component σ d b t is uncorrelated in time but correlated in space in the latter component b t is a cylindrical i d wiener process da prato and zabczyk 2014 which can be interpreted as a white noise in space and a brownian process in time the spatial correlations of the small scale flow are specified through an integral operator σ with a bounded kernel σ such that 3 2a σ f x t ω σ x y t f y d y for any function f l 2 ω d and for each time parameter t r given let us note that the kernel being bounded the operator σ is hilbert schmidt on l 2 ω d the resulting small scale flow σ d b t is a centered null ensemble mean gaussian process with the well defined covariance tensor denoted as q given by 3 2b q x y t s e σ x t d b t σ y s d b s t δ t s d t ω σ x z t σ t y z s d z where e stands for the expectation and the last equality ensues from itô isometry da prato and zabczyk 2014 the variance or auto covariance tensor denoted as a is defined by the diagonal components of the covariance per unit of time a x t q x x t t d t σ σ t x t which has the unit of a diffusion tensor m 2 s 1 in addition the density of the turbulent kinetic energy tke under this framework can be defined by 1 2 tr a d t that has a unit of m 2 s 2 the previous representation 3 2 is a general way to define the small scale flow in particular the fact that σ is hilbert schmidt ensures that the covariance operator per unit of time q d t admits an orthogonal eigenfunction basis φ n t n n weighted by the eigenvalues λ n 0 such that n n λ n therefore one may equivalently define the small scale flow based on the following spectral decomposition da prato and zabczyk 2014 3 3a σ x t d b t n n φ n x t d η t n where d η t n denotes the time increments of n independent and identically distributed i i d one dimensional standard brownian motions subsequently the variance tensor reduces to 3 3b a x t 1 d t n m n φ n x t e d η t n d η t m δ n m d t φ m t x t n n φ n x t φ n t x t where δ n m denotes the kronecker symbol hereafter the rate of change of a random scalar process θ within a volume v transported by the stochastic flow 3 1 can be deduced from the itô wenzell theorem kunita 1997 under the incompressible assumption for the small scale flow σ 0 it can be written in eulerian coordinates as 3 4a d v t θ x t d x v t d t θ θ u u s d x 3 4b d t θ d t θ u u s θ d t σ d b t θ 1 2 a θ d t where d t is introduced as a stochastic transport operator resseguier et al 2017a note that d t θ θ t d t θ t stands for the forward time increment of the scalar θ at a fixed point x the turbophoresis term u s 1 2 a accounting for the effect of statistical inhomogeneity of the small scale field on the large scale current is referred to as the itô stokes drift in bauer et al 2020 this term was shown to play a crucial role in the transition from the viscous layer regime to the logarithmic layer regime in wall bounded turbulent flows pinier et al 2019 it can be considered as a generalization of the stokes drift which occurs for example in the langmuir circulation craik and leibovich 1976 leibovich 1980 as shown in mémin 2014 under a spatially heterogeneous and temporally non stationary random field in general the last term in 3 4b plays a role similar to the functional eddy viscosity as introduced in many large scale circulation models smagorinsky 1963 gent and mcwilliams 1990 in particular for a homogeneous isotropic and stationary random field in which the variance tensor a becomes a 0 i d the diffusive term boils down immediately to a harmonic friction term 1 2 a 0 2 θ with a uniform coefficient a 0 to be specified in order to ensure an isochoric flow an incompressibility constraint on the corrected large scale drift u u s 0 is additionally required a stochastic transport equation of the extensive tracer θ is directly deduced from 3 4a 3 5a d t θ 0 in resseguier et al 2017a it is shown that those incompressibility constraints enable us to establish an energy conservation property 3 5b d d t ω 1 2 θ 2 d x 1 2 ω θ a θ d x energy loss by diffusion 1 2 ω θ t a θ d x energy intake by noise 0 in which for any realization of the random tracer the global energy brought by the small scale flow is exactly compensated by that dissipated by its diffusive contribution within ideal boundary conditions note that the energy increasing term arises from itô integration by part formula the derivation of the stochastic barotropic vorticity equation fully detailed in bauer et al 2020 follows a similar strategy as in the classical framework the main steps of the derivation procedure are first the three dimensional stochastic mass and momentum equations are obtained by applying the stochastic transport principle 3 4a then a two dimensional stochastic rotating shallow water system is deduced from the classical hydrostatic assumption subsequently substituting the unknown variables written as a power series of small rossby number into the dimensionless equations we get the asymptotic solutions of each order introducing the wind forcing the eddy viscosity and assuming an infinite rossby radius of deformation poor height stratification the dimensional stochastic barotropic vorticity equation sbve reads 3 6a d t ω j ψ ω d t k d m t β x ψ d t φ d b t f d d t 3 6b d m t σ d b t u s d t u 1 2 a u d t the process d m t gathers the additional momentum terms introduced in the stochastic transport equation 3 4b due to the geostrophic balance and the doob meyer decomposition theorem kunita 1997 the small scale flow is defined from a random stream function φ d b t as σ d b t φ d b t bauer et al 2020 the curl of such a process can be expanded as 3 6c k d m t j φ d b t ω u s ω d t 1 2 a ω d t d s t 3 6d d s t i 1 2 j σ d b t i u s i d t u i 1 2 x i a u i d t where d s t stands for the source sink process of the vorticity due to the rotating interactions between the strains of the large and small scale flows resseguier et al 2017b the first term in d s t has a similar form as the additional term introduced in the barotropic leray α model studied in holm and nadiga 2003 in addition we highlight from bauer et al 2020 that without any forcing and damping the proposed model preserves the total energy which reduces in this work to the kinetic energy of the large scale flow within ideal boundary conditions a more compact form of sbve 3 8 can be obtained under stratonovich stochastic integrals in the following we give its expression in an adimensionalized form besides the scaling numbers given in section 2 we need to scale the variance tensor a a a to precise the strength of uncertainty included in the sbve as mentioned above since a has the unit of a diffusion tensor m 2 s 1 one may consider that a is proportional to v l up to a factor ϵ i e a ϵ v l hereafter this scaling number ϵ can be related to the ratio between the tke a t σ and the mean kinetic energy mke v 2 and proportional to the ratio between the small scale correlation time t σ and the large scale one t resseguier et al 2017b this reads 3 7a ϵ t σ t tke mke this leads to the following scaling of variance tensor and small scale flow 3 7b a ϵ v l a σ d b t ϵ l σ d b t the greater this scaling number the larger the variance tensor and the stronger the uncertainty furthermore as interpreted in resseguier et al 2017b and bauer et al 2020 the geostrophic balance is valid only for weak ϵ 1 to moderate ϵ 1 uncertainty in the stochastic case beyond this scaling the geostrophic balance is eventually modified and includes correction terms to isobaric velocities in the present work only moderate uncertainty is adopted under such an assumption the final dimensionless sbve in stratonovich notation is written as 3 8a d t ω j ψ d t ϵ φ d b t ω u s ω d t 1 r β x ψ d t ϵ φ d b t 1 r β f d d t d s t ϵ 3 8b d s t ϵ i 1 2 j ϵ σ d b t i ϵ u s i d t u i where d t ω ω t d t 2 ω t d t 2 stands for the central time increment and where the prime symbols have been dropped for all the adimensional variables note that compared to the explicit itô form 3 6 the diffusive terms are now implicit in the stratonovich time integral switching from itô to stratonovich integral allows us to benefit from the advantages of both integral representations the itô flow 3 1 allows us to keep a zero mean noise term whereas it is not true for stratonovich convention and provides a way to explain more easily the different physical contributions of the noise terms the stratonovich representation permits the use of the classical chain rule differentiation and leads to more efficient numerical implementation in which the diffusive contribution is implicitly taken into account cotter et al 2019 the advantages and limitations of itô and stratonovich formulations in the context of fluid flow dynamics together with their relationship are detailed in bauer et al 2020 to close the problem we assume that the small scale component σ d b t and the itô stokes drift u s have the same boundary conditions as the large scale current u given in 2 5a and 2 5d it can be remarked that canceling the source term 3 8b and the itô stokes drift in 3 8a we obtain a stochastic potential vorticity equation that corresponds exactly to the model proposed in cotter et al 2019 built upon imposing a strong circulation conservation constraint holm 2015 by definition in the absence of forcing the resulting model preserves potential vorticity while model 3 8a conserves the global energy we will see however that model 3 8a enables us to reproduce more accurately potential vorticity and enstrophy statistics highlighting in this setting the importance of energy conservation 4 data driven modeling of uncertainty in order to perform a numerical simulation of the sbve 3 8 the uncertainty field σ d b t has to be a priori modeled this results from 3 3 to construct the eigenfunction basis of the spatial covariance in practice we work with a finite set of eigenfunctions of the small scale eulerian velocity rather than with the lagrangian displacement data driven approaches are presented in this section to estimate these empirical basis functions the first method is based on the proper orthogonal decomposition pod method where the covariance is assumed to be quasi stationary moreover we propose in section 4 2 a second approach which introduces time dependent weight coefficients into the spectral decomposition pre processing of data in order to estimate the basis functions for coarse sbve model using high resolution eddy resolving data a coarse graining procedure is required to this end a collection of stream function snapshots ψ hr x t i i 1 n t provided by a high resolution simulation of the bve 2 4 with grid spacing δ hr are first filtered to a coarser resolution of grid spacing δ lr through a gaussian filter 4 1 ψ hr x t i 6 π δ 2 ω exp 6 x y 2 δ 2 ψ hr y t i d y with width δ 2 δ lr δ hr the filtered snapshots ψ hr are subsequently subsampled to give the reference data ψ o also referred to as observation data in the following at the coarse resolution the reference velocity snapshots u o x t i i 1 n t are then deduced from ψ o 4 1 pod method applying the snapshot pod procedure sirovich 1987 given in appendix a for the fluctuations u o u o u o t where the overbar t denotes a temporal average enables us to build a set of mutually orthonormal spatial modes of unit m s 1 ϕ i i 1 n t and a set of orthogonal temporal modes b i t j i j 1 n t associated with a set of decaying eigenvalues λ i i 1 n t in addition we suppose that such a set of empirical eigenfunctions has a complete or direct decomposition mémin 2014 resseguier et al 2017d such that the fluctuations u of the large scale current lives in a subspace spanned by ϕ i i 1 m 0 1 and the small scale random drift σ d b t δ t with a sufficiently small time step δ t lives in the residual subspace spanned by ϕ i i m 0 m 1 with m 0 m 1 n t such that 4 2a 1 δ t σ x d b t m m 0 m 1 λ m ϕ m x ξ m where ξ m are i i d standard gaussian variables the corresponding variance tensor is then given by 4 2b 1 δ t a x m m 0 m 1 λ m ϕ m x ϕ m t x therefore such a pod approach depends only on two parameters m 0 and m 1 the choice of these parameters depends on the energy ratio γ 0 respectively γ 1 with 0 γ 0 γ 1 1 that needs to be captured by the largest respectively the smallest spatial scales of the random flow component more precisely let us first introduce the so called relative information content ric of the eigen decomposition 4 3a ric m i 1 m λ i i 1 n t λ i m 1 n t suppose that the largest structure of the random flow is required to contain the ratio γ 0 of the total energy of the fluctuations the first truncated mode is then determined by 4 3b m 0 min m ric m γ 0 as shown in fig 1 analogously the last truncated mode m 1 can be found with a given ratio γ 1 for the smallest structure in practice this latter can be defined empirically for instance we fix it as γ 1 0 999 in this work now the problem boils down to choose adequately the ratio γ 0 we propose to estimate it by comparing the kinetic energy spectrums between the ensemble of observation data u o x t i i 1 n t and an extra collection of snapshots u lr x t i i 1 n t obtained from a simulation of the bve at the coarse resolution δ lr the parameter γ 0 is approximated by the proportion of the partial energy accumulated up to the first wavenumber κ 0 for which the two temporally averaged spectrums start to deviate cf fig 2 4 3c γ 0 κ κ 0 e ˆ o t κ κ κ c e ˆ o t κ where e ˆ o denotes the instantaneous kinetic energy spectral density of the observations and κ c π δ lr stands for the theoretical effective cutoff note that both the free slip boundary conditions and the divergence free constraint imposed in the previous section are well satisfied for the parametrized random velocity 4 2a indeed the proposed spatial modes are represented as a linear combination of the instantaneous observed velocity fields see a 1d 4 2 mode matching method the previous pod procedure is an efficient off line learning method yet it relies on a strong stationary assumption and thus leads to a sequence of random velocity fields with no temporal connection with the resolved dynamics in the following we propose a novel approach that introduces a time dependent weight coefficient α m t in the pod representation in this approach the instantaneous random velocity at each time t is now defined as 4 4a 1 δ t σ x t d b t m m 0 m 1 λ m ϕ m x α m t ξ m with the corresponding variance tensor given by 4 4b 1 δ t a x t m m 0 m 1 λ m ϕ m x ϕ m t x α m t indeed such a weighting provides an energy re distribution of the spatial modes at each time step the weighting principle proposed here consists of selecting from the reference data the set of time instances that match to the large scale structure of the current simulation to be more specific let us consider a current velocity field u l x t at a given time t of the sbve simulation the projection coefficient b 1 l of the current fluctuation u l on the first spatial mode ϕ 1 is defined by 4 5a b 1 l t u l t ϕ 1 ω where the fluctuation u l at one position is obtained by subtracting a local average of the current field around that position and where u v ω ω u v d x denotes the l 2 ω inner product as illustrated in fig 3 a collection of matching instants is constructed by identifying the current projection b 1 l to the time series of the first temporal mode b 1 s s 1 n t subject to a consistent condition of its time increments 4 5b s t s b 1 s b 1 l t c δ s b 1 δ t b 1 l 0 where c is a sufficiently small threshold and δ t b b t b t δ t stands for the temporal variation of b at time t this aims at selecting the events corresponding to the same projection coefficient and the same sign of the time increment the weight coefficient α m for each mode m m 0 m 1 is then fixed from the sample variance 4 5c α m t 1 s t 1 s s t b m s μ m t 2 μ m t 1 s t s s t b m s where s stands for the sample size these time dependent coefficients allow us to slave a set of modes on some dominant modes note that in the present study we work only with the first mode however this technique could be extended to a vector of dominant modes in order to select more complex turbulent events let us also outline that the boundary conditions and the divergence free constraint of the random flow 4 4a remain valid with this weighting method 5 numerical results in this section we discuss and compare the respective numerical simulations of the bve 2 4 and the sbve 3 8 the main motivation here is to numerically assess if the proposed random model reproduces well the long term statistics of the high resolution eddy resolving simulation all the models have been discretized with the same numerical schemes as detailed in appendix b a staggered arakawa c grid arakawa and lamb 1977 has been considered in that respect the nonlinear jacobian terms in the governing equations are discretized using arakawa s 9 points conservative scheme arakawa and lamb 1981 to invert the poisson equation 2 1b associated to the stream function an efficient discrete sine transform solver press et al 2007 is adopted for the time stepping a strong stability preserving 3 rd order runge kutta scheme gottlieb 2005 with a courant friedrichs lewy cfl number of 1 3 is considered for bve as further detailed in appendix b for the sbve we used a similar time integration scheme 5 1 model configurations and simulations in all the configurations we fix the basin length to l 1 and the rossby number to r β 0 0 6 2 for the sbve simulations the uncertainty strength parameter has been fixed to ε 1 for the high resolution eddy resolving model a regular mesh with 256 512 cells with uniform grid spacing δ hr 0 004 and a five times wider harmonic boundary layer δ 2 0 02 have been used we consider a quiescent state as the initial condition that is ψ x t 0 0 x ω for such an initial condition the dominant sverdrup balance between the forcing and rotation leads to a symmetric pv field during a short period as the nonlinear inertial term becomes more and more important a symmetry breaking phenomena occurs at t 2 which can be observed from the time series of the global kinetic energy in fig 4 this so called spin up period is then followed by a dissipation stage up to t 5 of the very high enstrophy that has been produced during the spin up immediately after the flow dynamics becomes rapidly turbulent the three subsequent snapshots in fig 4 illustrate this vigorous eddying nature at coarse resolution the subgrid dissipation model is defined through a biharmonic friction term with a grid dependent uniform coefficient we choose such a simple yet commonly used eddy viscosity scheme to single out the effects of the proposed random model and the sub grid dissipation besides as shown in appendix c our model provides a very useful technique to estimate the uniform coefficient δ 4 from the high resolution data ω o 2 ψ o the idea consists in fixing the amplitude of a specific noise with a corresponding noise diffusion of biharmonic form such that its energy matches to the observed turbulent kinetic energy this simple estimation is a very interesting by product of our stochastic setting for instance in our case the estimated values of δ 4 at coarse resolutions 64 128 32 64 and 16 32 are respectively 0 026 0 040 and 0 049 in practice all these values have shown to be very good estimates for the subgrid dissipation the numerical simulations of the sbve are performed using both the pod denoted as sbve pod technique and mode matching denoted as sbve mm approach in both simulations the spatial modes for different coarse resolutions are trained during the same period consisting of 6000 snapshots the energy proportion parameter γ 0 of the first truncated mode for the random flow is resp estimated at 0 95 and 0 92 at resolution 64 128 and 32 64 same for 16 32 as shown in fig 5 by introducing randomness into the initial symmetric double gyre circulation the symmetry breaking state is reached much earlier for the sbve simulations than for the bve hereafter in order to compare the different models and to reduce the spin up errors we use the coarse grained version of one specific eddy resolving snapshot after t 5 as the initial condition for all coarse model runs in other words the bve and the sbve at each coarse resolution are simulated from the very same initial field in which the spin up period is accounted for at the eddy resolving resolution an instantaneous illustration of the small scale random stream function denoted as ψ r 1 δ t φ d b t and the itô stokes stream function ψ s is shown in fig 6 it appears that both ψ r and ψ s based on mm are stronger and more regular than those based on pod 5 2 long term prediction of statistics although we are working in a turbulent regime the statistics of the large scale tracers ψ and q tend to reach a statistical steady state equilibrium as shown in greatbatch and nadiga 2000 a robust four gyre structure is characterized in time averaged circulation as long as the dissipation is sufficiently weak here a weak dissipation means that the boundary layer size δ 2 or δ 4 has a smaller order than the so called rhines scale r β vallis 2017 however this does not indicate that the flow dynamics are under resolved note that in under resolved simulations the contour lines of the averaged tracers would be oscillating on the other hand increasing the explicit dissipation up to the order of rhines scale would result in a conventional double gyre in this work apart from the mean structure we are also interested in the eddy energy distributions and higher order moments of the tracers such as skewness and kurtosis these two standard moments of a probability distribution characterize the asymmetry and extreme events respectively they are particularly informative when the distribution is non gaussian more precisely the first four central moments of ψ are defined by 5 1a m 1 ψ ψ t m k ψ ψ m 1 ψ k t k 2 3 4 where the superscript k denotes the power while the subscript k denotes the order of the moment similarly the central moments of q as function of the prognostic variable ω are defined by 5 1b m 1 q r β m 1 ω y m k q r β k m k ω k 2 3 4 the skewness s resp kurtosis k of ψ reduces to 5 1c s ψ m 3 ψ m 2 ψ 3 2 k ψ m 4 ψ m 2 ψ 2 3 where algebraic manipulations ensure that the kurtosis of the gaussian distribution is zero the skewness resp kurtosis of q is given by 5 1d s q s ω k q k ω we remark from 5 1 that the skewness and kurtosis of both tracers ψ and q are not defined at boundaries since the second moments are zero there in addition the eddy kinetic energy eke and the eddy potential enstrophy epe are provided through second order moments by 5 1e eke 1 2 m 2 u m 2 v epe 1 2 m 2 q in the following these statistics are computed for both bve and sbve at resolution 64 128 32 64 and 16 32 before discussing the results the convergence of each statistic at each resolution is quantified this can be done by progressively increasing the time interval and computing a global error of the statistics between two adjacent intervals more precisely let us consider a point wise statistic f obtained for a sufficiently long interval t 0 t 1 where t 1 depends on the resolution considered with a uniform partition of increment δ t we propose to measure the convergence by a relative global error ϵ between the subintervals t 0 t and t 0 t δ t 5 2 ϵ f t f t f t δ t 2 f t 1 2 where 2 ω stands for the l 2 ω norm and f t x x ω denotes the local in time point wise statistics associated to the interval t 0 t in practice we initiate this procedure from a reasonable intermediate instant t c t 0 t 1 and t 0 is a fixed time after the spin up set to t 0 20 in this work cf fig 4 and the time increment has been fixed to δ t 0 1 a statistic is considered to be converged as soon as the time series of relative global errors reaches a stable low error level as shown in fig 7 we observe that the convergence to an error less than 1 for resolutions 256 512 64 128 32 64 and 16 32 is reached approximatively after the time 140 250 350 and 500 respectively we note that the coarser the resolution the longer it takes to get converged statistics this is even more pronounced for higher moments this is likely due to higher values of the turbulent viscosity which prevent the flow to visit freely its attractor and enforce it to stay for a much longer time in the attraction basin of the equilibrium points chapron et al 2018 note also that as observed therein the convergence time for sbve is shorter for all resolutions studied here not shown therefore we choose to use for all simulations the slowest convergence time i e the one computed for bve hereafter we focus on the comparisons of the statistics obtained for the different coarse models to build a reference ref for each resolution we directly subsample the statistics computed on the eddy resolving data i e we do not smooth them in order not to lower their energy fig 8 shows that at the coarsest resolution 16 32 the four gyre structure is captured for both models yet the two outer gyres predicted by sbve are more enhanced and closer to the reference compared to those obtained by bve since the scale parameters are fixed the major contribution comes from the stochastic representation of the mixing effects incorporated through the eddy resolving data a more accurate nonlinearity is produced such that a stronger distortion of the pv field between inner and outer gyres is observed from fig 9 we observe that compared to bve sbve mm produces higher eddy energy in the front between the outer and inner gyres and higher eddy enstrophy in the region between the two inner gyres however both coarse models do not produce enough energy flux in the western and eastern boundary layers in particular the too low tracers variance in the eastern boundary layers leads to markedly higher skewness and kurtosis than those observed in the reference nevertheless the introduction of randomness enables us to increase the internal variability of the tracers for instance as shown in figs 10 and 11 the region with extreme values of skewness and kurtosis is significantly reduced for sbve mm when compared to bve as the resolution increases it can be noticed from figs 12 and 13 that the local structures of the pv statistics provided by sbve mm qualitatively converges to the reference in order to provide a more quantitative comparison we propose here a global performance index measured by the root mean squared error rmse with an a posteriori normalization to ensure a similar error level of the different statistics given a statistic f with reference f ref the normalized rmse is defined as 5 3 rmse f 1 ω f f ref 2 max x ω f ref x table 1 compares the results of the different models at the coarsest resolution 16 32 the proposed stochastic model shows a clear improvement of all the statistics w r t the references this improvement is particularly noticeable for the higher moments for instance compared to bve sbve mm has 35 87 and 39 26 less errors in skewness and kurtosis of the stream function sf respectively the mode matching strategy sbve mm performs better than the pod strategy sbve pod for all moments although the latter already reduces the bve error of the first and second moments with an improvement of 9 7 for the sf mean and 12 6 for eke both sbve mm and sbve pod reach very similar errors in terms of eke and epe with an improvement above 10 for both quantities and sbve mm is more efficient in reducing errors in the third and fourth moments these results highlight the benefits that are brought by properly incorporating into large scale simulations the effects of the small scale flow component through its statistical distribution from tables 2 and 3 we see that these rmses improvements still hold as the resolution is increased the improvements at resolution 64 128 in terms of eke and epe are still noticeable 25 the third order moment of sf continues to improve 20 while for the fourth order moments the improvement is less significant both sbve mm and sbve pod improve also the first order moments at resolution 32 64 at almost the same rate as for the coarsest resolution and 64 128 with a smaller decreasing of the errors this latter has by definition a lower noise level this illustrates that even for weak noise levels the stochastic systems lead to better results than the deterministic version we analyze now the individual effects of the itô stokes drift and the additional vorticity sources on the accuracy of the statistics to that end two particular versions of sbve have been run in the first one denoted as sbve ns ns for no itô stokes drift the terms related to u s are dropped in 3 8 in the second one denoted as sbve cp cp for circulation preserving source term d s t is removed in addition to the itô stokes drift terms this second version corresponds to the model described in cotter et al 2019 2018 for which there is no energy conservation due to the absence of the stochastic source term cf bauer et al 2020 these two models are evaluated at the resolution 32 64 with the same parameters r β 0 0 6 2 and δ 4 0 040 as before and the same pod noise note that the advection by the itô stokes drift has no effect on the resolved energy however as it can be observed in table 4 from the comparison between sbve ns and sbve pod its inclusion improves all the sf moments with a marked decrease of errors in the first and third moments these improvements outline the importance of taking into account properly the inhomogeneity of the small scale component as captured by the itô stokes drift in contrast the itô stokes drift plays no role in terms of the pv mean and epe and only leads to marginally better third and fourth order pv moments finally sbve cp provides intermediate results between the traditional large scale deterministic model and the proposed stochastic model the influence of the stochastic source term can be appreciated comparing sbve ns and sbve cp this term which guarantees the conservation of the global energy enables us to improve the sf mean and kurtosis as well as the pv skewness and kurtosis the association of both the itô stokes drift and the stochastic source terms improves the four sf moments and the third and fourth order pv moments for the barotropic regime studied here global energy conservation together with the itô stokes correction as considered in this stochastic framework provides more accurate long term statistics than models in which these two features are not taken into account in addition to the discussions above it is also important to show if the sbve on coarse mesh can reproduce the temporal correlation behaviors of the reference gugole and franzke 2019 to this end the autocorrelation functions acf for the time series of the global stream function are adopted more precisely this acf is defined as 5 4 acf τ ψ t ψ t ψ t τ ψ t t σ ψ 2 where τ stands for a time lag ψ t 1 ω ω ψ x t d x is the global stream function at time t and σ ψ is the temporal standard deviation of ψ fig 14 shows that compared to the bve at each coarse resolution both sbve pod and sbve mm capture better the acf of the reference for instance they have smaller decorrelation time scales compared to the bve besides the best results are provided by the mode matching method which is consistent with our previous conclusions 6 conclusions the approach explored in this work consists in a stochastic representation of mesoscale eddy effects on large scale ocean circulation the main result demonstrates that the large scale flow can be simulated by a coarse resolution model composed of a multiplicative random forcing a heterogeneous diffusion and an advection correction all these ingredients allow us to correctly backscatter dissipate and distribute the large scale energy such a random model built from classical conservation laws provides here an explicit eddy representation for a single layered qg model under this regime additional vorticity sources arise from the interaction of the strains between the small scale random component and the large scale current these terms are important in conserving the global energy of the resolved scales numerically the spatial correlation of the random fields in the coarse model is defined from the coherent structures of an eddy resolving simulation in order to quantify the accuracy of the proposed random model a statistical analysis of the flow tracers has been performed as expected compared to a classical coarse model the proposed stochastic model better represents the nonlinearity at the resolved scales while properly dissipating the unresolved scales leading hence to a balanced correction of excessive dissipation and the continuous increase of internal variability as a result it reproduces better on a coarse mesh the local structures of the distribution of eddy resolving tracers further analysis showed that the vorticity sources are important in locally strengthening the eddy flux of pv although the idealized barotropic model used in this work cannot describe quantitatively the real ocean they do in fact produce qualitatively realistic patterns of large scale flow in the major basins of the world as illustrated in vallis 2017 the encouraging results presented here inspire us to implement the proposed stochastic approach on more complex flow and to test more physical parameterizations for the small scale random flow two subsequent projects on the study of q gcm hogg et al 2003 and nemo nemo team 2016 are already in progress in particular we aim to parametrize the noise on the isopycnal surfaces gent and mcwilliams 1990 such that the transfer of the available potential energy to the resolved kinetic energy can be efficiently achieved success of other stochastic parameterizations grooms et al 2015 gugole and franzke 2019 porta mana and zanna 2014 zanna et al 2017 provides some confidence that the backscatter and jet enforcement can be reproduced with some success under the proposed stochastic framework besides the feasibility for the application of the mode matching strategy on these models will be analyzed all these efforts aim at progressively going toward the study of data driven stochastic ipcc class climate models and to confirm that relevant stochastic flow models contribute to improve them credit authorship contribution statement werner bauer writing review editing supervision pranav chandramouli methodology writing review editing long li conceptualization methodology software writing original draft writing review editing etienne mémin conceptualization methodology writing review editing supervision declaration of competing interest the authors declare the following financial interests personal relationships which may be considered as potential competing interests the authors are the recipients of an erc research grant in collaboration with dr darryl holm and dr dan crisan from imperial college london and dr bertrand chapron from ifremer acknowledgments the authors acknowledge the support of the laboratoires d excellence cominlabs lebesgue and mer through the seacs project and of the erc eu project 856408 stuod appendix a snapshot pod this section describes briefly the snapshot pod method sirovich 1987 let us consider a set of fluctuation snapshots u o u o u o t where the overbar denotes temporal average the corresponding temporal covariance tensor is defined as c c i j i j 1 n t such that a 1a c i j 1 n t u o t i u o t j ω 1 n t ω u o x t i u o x t j d x the eigenvalues and their associated eigenfunctions can be estimated from the following eigenvalues problem a 1b c b λ b where λ λ i i 1 n t is the set of decaying eigenvalues i e λ 1 λ 2 λ n t 0 and b b i j i j 1 n t b i j b i t j is a complete set of orthogonal eigenvectors the temporal modes b i i 1 n t are then normalized such that a 1c b i t b j t t λ i δ i j where δ i j denotes for the kronecker symbol here the spatial modes ϕ i i 1 n t given by a 1d ϕ i x b i t u o x t t are orthonormal a 1e ϕ i ϕ j ω δ i j and from this spectral decomposition each snapshot can be reconstructed by a 1f u x t j u o t x i 1 n t b i t j ϕ i x appendix b numerical schemes this section gives a brief description of the numerical methods used for solving the bve 2 4 and the sbve 3 8 as shown in fig 15 both model variables are discretized on a staggered arakawa c grid arakawa and lamb 1977 with the uniform grid spacings δ x and δ y in x and y directions the stream function ψ same for φ d b t and the vorticity ω are tabulated on the cell corners referred to as p points whereas the velocity components u and v same for the components of u s and σ d b t are placed on the horizontal and vertical cell interfaces respectively they are referred to as u points and v points respectively considering m n cells then the p grid has m 1 n 1 points with homogeneous dirichlet boundary values defined as b 1a ψ 0 ψ m ψ 0 ψ n 0 the same boundary condition is imposed on ω and φ d b t the u grid has a dimension of m 1 n 2 points together with free slip boundary values imposed as b 1b u 0 u m 0 u 0 u 1 u n 1 u n while the v grid has m 2 n 1 points with the free slip boundary values b 1c v 0 v n 0 v 0 v 1 v m 1 v m the same discrete representations apply to u s and σ d b t discretized differential operators can now be consistently built within such a specific staggered grid they are based on the following first derivative approximations b 2 x h θ i 1 2 j θ i 1 j θ i j δ x y h θ i j 1 2 θ i j 1 θ i j δ y which remains valid whether θ be defined in p u and v grid as such the velocity u resp for σ d b t can be derived from a given stream function ψ resp for φ d b t by applying the discretized perpendicular gradient h y h x h t subsequently the vorticity is given by ω h t u h t h ψ h 2 ψ where the discretized laplacian operator reads b 3 ω i j ψ i 1 j 2 ψ i j ψ i 1 j δ x 2 ψ i j 1 2 ψ i j ψ i j 1 δ y 2 for any interior i j points of the p grid conversely the stream function ψ and similarly for φ d b t can be re constructed from a current vorticity ω and the inverse of the laplacian operator h 2 1 expressed in practice in the fourier domain through an efficient discrete fourier transform solver press et al 2007 more precisely expanding the prognostic variables ψ and ω in sine waves b 4a ω ˆ k l i 1 m 1 j 1 n 1 ω i j sin π i k m sin π j l n and substituting them into the previous discretized equation b 3 yield the spectral relationship b 4b ψ ˆ k l ω ˆ k l c k l c k l 2 δ x 2 cos π k m 1 2 δ y 2 cos π l n 1 the solution in physical space for interior points is then given by the inverse sine transform b 4c ψ i j 2 m 2 n k 1 m 1 l 1 n 1 ψ ˆ k l sin π i k m sin π j l n to discretize the nonlinear jacobian terms in the bve and in the sbve we employ arakawa s 9 points conservative scheme arakawa and lamb 1981 actually such a discretization can be interpreted through interpolated derivatives on the staggered grid for instance the advection of ω by ψ can be written as b 5a j h ψ ω 1 3 x h ψ x y h ω y y h ψ y x h ω x 1 3 x h ψ y h ω y x y h ψ x h ω x y 1 3 y h ω x h ψ x y x h ω y h ψ y x where θ x i 1 2 j θ i 1 j θ i j 2 and θ y i j 1 2 θ i j 1 θ i j 2 stand for central interpolations between two neighboring points in x and y directions respectively such a discretized operator is applied in the very same way on the other advection terms of the sbve 3 8a associated to φ d b t the source terms 3 8b are otherwise discretized as b 5b j h u y u y j h v x v x where u and v denote the two components of u σ d b t u s d t the stochastic rk3 scheme of cotter et al 2019 is given by b 6a ω 1 ω n f δ t ψ n ω n g φ d b t n δ t u s n ω n h σ d b t n δ t u s n u n b 6b ω 2 3 4 ω n 1 4 ω 1 f δ t ψ 1 ω 1 g φ d b t n δ t u s n ω 1 h σ d b t n δ t u s n u 1 b 6c ω n 1 1 3 ω n 2 3 ω 2 f δ t ψ 2 ω 2 g φ d b t n δ t u s n ω 2 h σ d b t n δ t u s n u 2 where f δ t ψ ω δ t j ψ ω δ t r β f d ψ x g φ d b t δ t u s ω j φ d b t ω δ t u s ω 1 r β x φ d b t and h σ d b t δ t u s u j σ d b t δ t u s u appendix c estimation of uniform biharmonic friction coefficient we assume that there exists an additional isotropic random field living at the unresolved sub grid scales i e not represented at the considered resolution scale thus the global contribution of its variance tensor a 0 i 2 to the enstrophy dissipation can be expressed by c 1a 1 2 ω ω o a 0 2 ω o d x a 0 2 ω ω o 2 d x with parameter a 0 fixed from the mean kinetic energy of the velocity fluctuations living within the range between the cutoff scale and the high resolution grid scale weighted by a correlation time scale kadri harouna and mémin 2017 besides the global dissipation budget due to the considered biharmonic eddy viscosity model is given by c 1b ω ω o δ 4 5 4 ω o d x δ 4 5 ω 2 ω o 2 d x identifying these two budgets and applying a time average enable us to define a simple empirical estimator for δ 4 c 1c δ ˆ 4 a 0 2 ω ω o 2 d x ω 2 ω o 2 d x t 1 5 this estimator has been used systematically to automatically tune the eddy viscosity coefficient at the different resolutions considered in this work fig 16 shows a series of estimated values δ ˆ 4 from resolution 16 32 to resolution 64 128 
23965,a stochastic representation based on a physical transport principle is proposed to account for mesoscale eddy effects on the evolution of the large scale flow this framework arises from a decomposition of the lagrangian velocity into a smooth in time component and a highly oscillating term one important characteristic of this random model is that it conserves the energy of any transported scalar such an energy preserving representation is tested for the coarse simulation of a barotropic circulation in a shallow ocean basin driven by a symmetric double gyres wind forcing the empirical spatial correlation of the random small scale velocity is estimated from data of an eddy resolving simulation after reaching a turbulent equilibrium state a statistical analysis of tracers shows that the proposed random model enables us to reproduce accurately on a coarse mesh the local structures of the first four statistical moments mean variance skewness and kurtosis of the high resolution eddy resolved data keywords stochastic modeling mesoscale eddies geostrophic turbulence wind driven circulation 1 introduction mesoscale eddies contain a significant proportion of ocean energy and have an important impact on large scale circulations they are found everywhere in the ocean and are particularly intensive in the western boundary currents like the gulf stream and the antarctic circumpolar current unfortunately to fully resolve these eddies in numerical simulations a horizontal resolution of 10 km is required which is far too expensive for a large ensemble of realizations or simulations over a long time duration neglecting mesoscale eddy effects may lead to strong errors in the evolution of the large scale dynamics therefore they need to be properly modeled or parametrized a classical parametrization approach is to introduce eddy viscosity in coarse models to mimic the action of the computationally unresolved scales while simultaneously ensuring numerical stability by avoiding pile up of energy at the cutoff scale the explicit dissipation mechanism is often represented either by a harmonic or biharmonic friction term with uniform coefficient or through functional operators smagorinsky 1963 leith 1971 griffies and hallberg 2000 that depend on the resolved flow a more widely adopted approach in ocean modeling is to include the gent mcwilliams parametrization scheme gent and mcwilliams 1990 gent et al 1995 in addition to eddy viscosity to model the potential energy flux by smoothing the neutral surface height however encoding only large scale dissipation in coarse models often leads to an excessive decreasing of the resolved kinetic energy arbic et al 2013 kjellsson and zanna 2017 an alternative approach is based on stochastic parametrization berloff 2005 grooms and majda 2014 porta mana and zanna 2014 cooper and zanna 2015 grooms et al 2015 zanna et al 2017 which aims to introduce energy backscattering across scales these models provide a marked benefit in improving the internal ocean variability which can be paramount in ensemble forecasting and data assimilation as a matter of fact it is well known that models with poor variability usually lead to very low spread of the ensemble karspeck et al 2013 hence assimilation systems tend to be over confident in the model as compared to the observations however to overcome numerical instability brought by introducing random forcing specific tuning parameters are often included in these parametrized models the success of such tuning methods often does not extend into new flow regimes stochastic parametrization techniques have been proposed for reduced order climate models based on rigorous homogenization techniques frank and gottwald 2013 franzke et al 2005 franzke and majda 2006 franzke et al 2015 gottwald et al 2017 majda et al 1999 these models rely on a scale separation principle and introduce a linear stochastic ansatz model with damping terms for the nonlinear small scale evolution equation the resulting homogenized dynamics are cubic with correlated additive and multiplicative cam noises in the absence of scale separation the system usually becomes non markovian and incorporates memory terms as shown in the mori zwanzig equation givon et al 2004 gottwald et al 2017 alternatively mémin 2014 proposed a consistent stochastic framework defined from physical conservation laws this derivation keeps the full nonlinearity of the system yet relies on a strong temporal scale separation principle within this framework the lagrangian velocity is decomposed into a smooth component and a highly oscillating random field a stochastic transport principle is subsequently derived using stochastic calculus notably the resulting evolution of a random tracer includes a multiplicative random forcing a heterogeneous diffusion and an advection correction due to inhomogeneity of the random flow component with these additional terms a remarkable energy conservation property along time for any realization of the advected tracer still holds resseguier et al 2017a this stochastic transport principle has been used as a fundamental tool to derive stochastic representations of large scale geophysical dynamics resseguier et al 2017a b c chapron et al 2018 in which the missing contributions of unresolved processes are explicitly taken into account similar approaches based on the same decomposition have been also recently proposed by holm 2015 and gugole and franzke 2019 the performance of such a random model has been evaluated and analyzed in terms of uncertainty quantification and ensemble forecasting resseguier et al 2020 for a surface quasi geostrophic sqg flow a more efficient spread is produced by the proposed model compared to a deterministic model with perturbed initial condition as discussed above this ability is essential for data assimilation applications recently a stochastic barotropic quasi geostrophic qg model has been proposed bauer et al 2020 within this setting to study the structuration effect of the random field on the large scale flow numerical results illustrate that encoding an inhomogeneous random component into a propagating monochromatic rossby wave induces the formation of extra large vortices in the present work the performance of this stochastic barotropic model is assessed for the numerical simulation of an idealized double gyre wind forcing within an enclosed shallow basin at midlatitude the wind driven circulation is a classical simplified problem in oceanography vallis 2017 which produces qualitatively realistic patterns of mesoscale eddies in approximate geostrophic equilibrium a particular circulation greatbatch and nadiga 2000 living in a highly turbulent regime under weak dissipation of potential enstrophy leads to a stationary four gyre structure in a long time average sense we focus here on the ability of the proposed stochastic models to accurately represent at a coarse resolution the four first statistical moments mean variance skewness and kurtosis of the flow comparing this statistical distribution through its four moments to that predicted by the eddy resolving data enables us to qualify and quantify the accuracy of our stochastic representation of mesoscale eddy effects on large scale circulation the paper is structured as follows section 2 briefly reviews the barotropic wind driven model in adimensional form section 3 focuses on the stochastic transport principles and the derived stochastic barotopic vorticity equation section 4 details the data driven approaches adopted for the modeling of the random small scale velocity field section 5 discusses the numerical results and their long term statistics finally section 6 concludes this work and gives some outlook for future research 2 barotropic vorticity equation in this work we use a single layer qg formulation to study the wind driven circulation in an oceanic basin following vallis 2017 under this regime the dimensional barotropic vorticity equation bve can be written as 2 1a ω t j ψ ω β ψ x f d 2 1b 2 ψ ω where ω k u x v y u is the relative or kinematic vorticity henceforth referred to as vorticity with k 0 0 1 t the oceanic geostrophic velocity u can be defined by a stream function ψ such that u ψ y ψ x ψ t the nonlinear advection is transformed into a jacobian operator which is defined as j ψ ω x ψ y ω y ψ x ω the linear term β x ψ describes the advection of β planetary vorticity an active tracer in this case is given by the potential vorticity pv defined as q ω β y on the right hand side rhs of 2 1a f k τ ρ h is a forcing which adds vorticity into the gyres due to the wind stress τ over the ocean surface where ρ and h are respectively resp the basic fluid density and depth of the basin an idealized double gyre wind stress greatbatch and nadiga 2000 defined only in zonal direction is used in this work within the basin ω 0 l l l that is 2 2 τ τ 0 cos π y l 0 t where τ 0 is the magnitude of the wind this form of wind stress san et al 2011 2013 represents the meridional profile of easterly trade winds mid latitude westerlies and polar easterlies from south to north over the ocean basin the boundary layer friction d can be interpreted either as a linear drag for the ekman layer as presented in the stommel problem stommel 1948 an eddy viscosity term as presented in the munk problem munk 1950 or a combination of the two fox kemper 2005 in this work we are more interested in the munk model by assuming that the ocean has a flat bottom the eddy viscosity that we will discuss in the following will be either harmonic d ν 2 2 ω or biharmonic d ν 4 4 ω with a uniform coefficient ν 2 of unit m 2 s 1 or ν 4 of unit m 4 s 1 to simplify the problem one may scale eq 2 1a by comparing each term to the dominant β effect vallis 2017 the leading order is given by the sverdrup balance between the rotation and wind forcing i e β x ψ f which provides a characteristic size of velocity 2 3a v τ 0 ρ h π β l this leads to the following scaling of time vorticity and stream function 2 3b t l v t ω v l ω ψ v l ψ where the variables with prime symbol are adimensionalized the thickness of the munk boundary layer can be then quantified by the balance between the β effect and friction munk 1950 for instance β x ψ ν 2 2 ω gives us a harmonic boundary layer scale that is 2 3c δ 2 ν 2 β 1 3 similarly β x ψ ν 4 4 ω gives us a biharmonic boundary layer scale 2 3d δ 4 ν 4 β 1 5 the nonlinear advection term j ψ ω is smaller than the linear terms nevertheless the nonlinear effect may still be important in the boundary layer especially in the western one to measure its strength one may define a β rossby number denoted as r β as the ratio of the size of the nonlinear term to the β effect 2 3e r β v β l 2 using these scaling numbers 2 3a 2 3e for 2 1a the dimensional bve reduces to its adimensional form as 2 4 ω t j ψ ω 1 r β ψ x 1 r β sin π y 1 r β d with d δ 2 l 3 2 ω or d δ 4 l 5 4 ω resulting from 2 3c or 2 3d respectively the adimensional pv is written as q r β ω y and the poisson equation 2 1b is invariant under this adimensionalization i e 2 ψ ω for the sake of readability in the following we drop the prime for all the adimensional variables to close the problem we need one initial condition that will be discussed in section 5 1 and two boundary conditions the first boundary condition is imposed by the no normal flow condition due to the forcing form 2 5a ψ ω 0 i e u x 0 l v y l l 0 where ω denotes the basin s boundary the second one depends on the chosen eddy viscosity form for a harmonic friction i e d δ 2 l 3 2 ω we impose 2 5b ω ω 0 while for a biharmonic friction i e d δ 4 l 5 4 ω we set 2 5c ω ω 0 and 2 ω n 2 ω 0 where 2 n 2 denotes for the second derivative in normal direction note that in both cases together with the no normal flow condition we get a free slip condition 2 5d 2 ψ n 2 ω 0 i e v x x 0 l u y y l l 0 with no horizontal shear on each boundary finally we remark that the munk model 2 4 depends only on two parameters which are r β and δ 2 l resp δ 4 l 3 stochastic barotropic vorticity equation this section provides a stochastic representation of the barotropic qg flow we start by introducing the stochastic lagrangian flow x ω r d d 2 3 given by mémin 2014 3 1 d x t u x t t d t σ x t t d b t this decomposition is based on the assumption of a temporal scale separation in which the large scale component u is both spatially and temporally correlated while the small scale component σ d b t is uncorrelated in time but correlated in space in the latter component b t is a cylindrical i d wiener process da prato and zabczyk 2014 which can be interpreted as a white noise in space and a brownian process in time the spatial correlations of the small scale flow are specified through an integral operator σ with a bounded kernel σ such that 3 2a σ f x t ω σ x y t f y d y for any function f l 2 ω d and for each time parameter t r given let us note that the kernel being bounded the operator σ is hilbert schmidt on l 2 ω d the resulting small scale flow σ d b t is a centered null ensemble mean gaussian process with the well defined covariance tensor denoted as q given by 3 2b q x y t s e σ x t d b t σ y s d b s t δ t s d t ω σ x z t σ t y z s d z where e stands for the expectation and the last equality ensues from itô isometry da prato and zabczyk 2014 the variance or auto covariance tensor denoted as a is defined by the diagonal components of the covariance per unit of time a x t q x x t t d t σ σ t x t which has the unit of a diffusion tensor m 2 s 1 in addition the density of the turbulent kinetic energy tke under this framework can be defined by 1 2 tr a d t that has a unit of m 2 s 2 the previous representation 3 2 is a general way to define the small scale flow in particular the fact that σ is hilbert schmidt ensures that the covariance operator per unit of time q d t admits an orthogonal eigenfunction basis φ n t n n weighted by the eigenvalues λ n 0 such that n n λ n therefore one may equivalently define the small scale flow based on the following spectral decomposition da prato and zabczyk 2014 3 3a σ x t d b t n n φ n x t d η t n where d η t n denotes the time increments of n independent and identically distributed i i d one dimensional standard brownian motions subsequently the variance tensor reduces to 3 3b a x t 1 d t n m n φ n x t e d η t n d η t m δ n m d t φ m t x t n n φ n x t φ n t x t where δ n m denotes the kronecker symbol hereafter the rate of change of a random scalar process θ within a volume v transported by the stochastic flow 3 1 can be deduced from the itô wenzell theorem kunita 1997 under the incompressible assumption for the small scale flow σ 0 it can be written in eulerian coordinates as 3 4a d v t θ x t d x v t d t θ θ u u s d x 3 4b d t θ d t θ u u s θ d t σ d b t θ 1 2 a θ d t where d t is introduced as a stochastic transport operator resseguier et al 2017a note that d t θ θ t d t θ t stands for the forward time increment of the scalar θ at a fixed point x the turbophoresis term u s 1 2 a accounting for the effect of statistical inhomogeneity of the small scale field on the large scale current is referred to as the itô stokes drift in bauer et al 2020 this term was shown to play a crucial role in the transition from the viscous layer regime to the logarithmic layer regime in wall bounded turbulent flows pinier et al 2019 it can be considered as a generalization of the stokes drift which occurs for example in the langmuir circulation craik and leibovich 1976 leibovich 1980 as shown in mémin 2014 under a spatially heterogeneous and temporally non stationary random field in general the last term in 3 4b plays a role similar to the functional eddy viscosity as introduced in many large scale circulation models smagorinsky 1963 gent and mcwilliams 1990 in particular for a homogeneous isotropic and stationary random field in which the variance tensor a becomes a 0 i d the diffusive term boils down immediately to a harmonic friction term 1 2 a 0 2 θ with a uniform coefficient a 0 to be specified in order to ensure an isochoric flow an incompressibility constraint on the corrected large scale drift u u s 0 is additionally required a stochastic transport equation of the extensive tracer θ is directly deduced from 3 4a 3 5a d t θ 0 in resseguier et al 2017a it is shown that those incompressibility constraints enable us to establish an energy conservation property 3 5b d d t ω 1 2 θ 2 d x 1 2 ω θ a θ d x energy loss by diffusion 1 2 ω θ t a θ d x energy intake by noise 0 in which for any realization of the random tracer the global energy brought by the small scale flow is exactly compensated by that dissipated by its diffusive contribution within ideal boundary conditions note that the energy increasing term arises from itô integration by part formula the derivation of the stochastic barotropic vorticity equation fully detailed in bauer et al 2020 follows a similar strategy as in the classical framework the main steps of the derivation procedure are first the three dimensional stochastic mass and momentum equations are obtained by applying the stochastic transport principle 3 4a then a two dimensional stochastic rotating shallow water system is deduced from the classical hydrostatic assumption subsequently substituting the unknown variables written as a power series of small rossby number into the dimensionless equations we get the asymptotic solutions of each order introducing the wind forcing the eddy viscosity and assuming an infinite rossby radius of deformation poor height stratification the dimensional stochastic barotropic vorticity equation sbve reads 3 6a d t ω j ψ ω d t k d m t β x ψ d t φ d b t f d d t 3 6b d m t σ d b t u s d t u 1 2 a u d t the process d m t gathers the additional momentum terms introduced in the stochastic transport equation 3 4b due to the geostrophic balance and the doob meyer decomposition theorem kunita 1997 the small scale flow is defined from a random stream function φ d b t as σ d b t φ d b t bauer et al 2020 the curl of such a process can be expanded as 3 6c k d m t j φ d b t ω u s ω d t 1 2 a ω d t d s t 3 6d d s t i 1 2 j σ d b t i u s i d t u i 1 2 x i a u i d t where d s t stands for the source sink process of the vorticity due to the rotating interactions between the strains of the large and small scale flows resseguier et al 2017b the first term in d s t has a similar form as the additional term introduced in the barotropic leray α model studied in holm and nadiga 2003 in addition we highlight from bauer et al 2020 that without any forcing and damping the proposed model preserves the total energy which reduces in this work to the kinetic energy of the large scale flow within ideal boundary conditions a more compact form of sbve 3 8 can be obtained under stratonovich stochastic integrals in the following we give its expression in an adimensionalized form besides the scaling numbers given in section 2 we need to scale the variance tensor a a a to precise the strength of uncertainty included in the sbve as mentioned above since a has the unit of a diffusion tensor m 2 s 1 one may consider that a is proportional to v l up to a factor ϵ i e a ϵ v l hereafter this scaling number ϵ can be related to the ratio between the tke a t σ and the mean kinetic energy mke v 2 and proportional to the ratio between the small scale correlation time t σ and the large scale one t resseguier et al 2017b this reads 3 7a ϵ t σ t tke mke this leads to the following scaling of variance tensor and small scale flow 3 7b a ϵ v l a σ d b t ϵ l σ d b t the greater this scaling number the larger the variance tensor and the stronger the uncertainty furthermore as interpreted in resseguier et al 2017b and bauer et al 2020 the geostrophic balance is valid only for weak ϵ 1 to moderate ϵ 1 uncertainty in the stochastic case beyond this scaling the geostrophic balance is eventually modified and includes correction terms to isobaric velocities in the present work only moderate uncertainty is adopted under such an assumption the final dimensionless sbve in stratonovich notation is written as 3 8a d t ω j ψ d t ϵ φ d b t ω u s ω d t 1 r β x ψ d t ϵ φ d b t 1 r β f d d t d s t ϵ 3 8b d s t ϵ i 1 2 j ϵ σ d b t i ϵ u s i d t u i where d t ω ω t d t 2 ω t d t 2 stands for the central time increment and where the prime symbols have been dropped for all the adimensional variables note that compared to the explicit itô form 3 6 the diffusive terms are now implicit in the stratonovich time integral switching from itô to stratonovich integral allows us to benefit from the advantages of both integral representations the itô flow 3 1 allows us to keep a zero mean noise term whereas it is not true for stratonovich convention and provides a way to explain more easily the different physical contributions of the noise terms the stratonovich representation permits the use of the classical chain rule differentiation and leads to more efficient numerical implementation in which the diffusive contribution is implicitly taken into account cotter et al 2019 the advantages and limitations of itô and stratonovich formulations in the context of fluid flow dynamics together with their relationship are detailed in bauer et al 2020 to close the problem we assume that the small scale component σ d b t and the itô stokes drift u s have the same boundary conditions as the large scale current u given in 2 5a and 2 5d it can be remarked that canceling the source term 3 8b and the itô stokes drift in 3 8a we obtain a stochastic potential vorticity equation that corresponds exactly to the model proposed in cotter et al 2019 built upon imposing a strong circulation conservation constraint holm 2015 by definition in the absence of forcing the resulting model preserves potential vorticity while model 3 8a conserves the global energy we will see however that model 3 8a enables us to reproduce more accurately potential vorticity and enstrophy statistics highlighting in this setting the importance of energy conservation 4 data driven modeling of uncertainty in order to perform a numerical simulation of the sbve 3 8 the uncertainty field σ d b t has to be a priori modeled this results from 3 3 to construct the eigenfunction basis of the spatial covariance in practice we work with a finite set of eigenfunctions of the small scale eulerian velocity rather than with the lagrangian displacement data driven approaches are presented in this section to estimate these empirical basis functions the first method is based on the proper orthogonal decomposition pod method where the covariance is assumed to be quasi stationary moreover we propose in section 4 2 a second approach which introduces time dependent weight coefficients into the spectral decomposition pre processing of data in order to estimate the basis functions for coarse sbve model using high resolution eddy resolving data a coarse graining procedure is required to this end a collection of stream function snapshots ψ hr x t i i 1 n t provided by a high resolution simulation of the bve 2 4 with grid spacing δ hr are first filtered to a coarser resolution of grid spacing δ lr through a gaussian filter 4 1 ψ hr x t i 6 π δ 2 ω exp 6 x y 2 δ 2 ψ hr y t i d y with width δ 2 δ lr δ hr the filtered snapshots ψ hr are subsequently subsampled to give the reference data ψ o also referred to as observation data in the following at the coarse resolution the reference velocity snapshots u o x t i i 1 n t are then deduced from ψ o 4 1 pod method applying the snapshot pod procedure sirovich 1987 given in appendix a for the fluctuations u o u o u o t where the overbar t denotes a temporal average enables us to build a set of mutually orthonormal spatial modes of unit m s 1 ϕ i i 1 n t and a set of orthogonal temporal modes b i t j i j 1 n t associated with a set of decaying eigenvalues λ i i 1 n t in addition we suppose that such a set of empirical eigenfunctions has a complete or direct decomposition mémin 2014 resseguier et al 2017d such that the fluctuations u of the large scale current lives in a subspace spanned by ϕ i i 1 m 0 1 and the small scale random drift σ d b t δ t with a sufficiently small time step δ t lives in the residual subspace spanned by ϕ i i m 0 m 1 with m 0 m 1 n t such that 4 2a 1 δ t σ x d b t m m 0 m 1 λ m ϕ m x ξ m where ξ m are i i d standard gaussian variables the corresponding variance tensor is then given by 4 2b 1 δ t a x m m 0 m 1 λ m ϕ m x ϕ m t x therefore such a pod approach depends only on two parameters m 0 and m 1 the choice of these parameters depends on the energy ratio γ 0 respectively γ 1 with 0 γ 0 γ 1 1 that needs to be captured by the largest respectively the smallest spatial scales of the random flow component more precisely let us first introduce the so called relative information content ric of the eigen decomposition 4 3a ric m i 1 m λ i i 1 n t λ i m 1 n t suppose that the largest structure of the random flow is required to contain the ratio γ 0 of the total energy of the fluctuations the first truncated mode is then determined by 4 3b m 0 min m ric m γ 0 as shown in fig 1 analogously the last truncated mode m 1 can be found with a given ratio γ 1 for the smallest structure in practice this latter can be defined empirically for instance we fix it as γ 1 0 999 in this work now the problem boils down to choose adequately the ratio γ 0 we propose to estimate it by comparing the kinetic energy spectrums between the ensemble of observation data u o x t i i 1 n t and an extra collection of snapshots u lr x t i i 1 n t obtained from a simulation of the bve at the coarse resolution δ lr the parameter γ 0 is approximated by the proportion of the partial energy accumulated up to the first wavenumber κ 0 for which the two temporally averaged spectrums start to deviate cf fig 2 4 3c γ 0 κ κ 0 e ˆ o t κ κ κ c e ˆ o t κ where e ˆ o denotes the instantaneous kinetic energy spectral density of the observations and κ c π δ lr stands for the theoretical effective cutoff note that both the free slip boundary conditions and the divergence free constraint imposed in the previous section are well satisfied for the parametrized random velocity 4 2a indeed the proposed spatial modes are represented as a linear combination of the instantaneous observed velocity fields see a 1d 4 2 mode matching method the previous pod procedure is an efficient off line learning method yet it relies on a strong stationary assumption and thus leads to a sequence of random velocity fields with no temporal connection with the resolved dynamics in the following we propose a novel approach that introduces a time dependent weight coefficient α m t in the pod representation in this approach the instantaneous random velocity at each time t is now defined as 4 4a 1 δ t σ x t d b t m m 0 m 1 λ m ϕ m x α m t ξ m with the corresponding variance tensor given by 4 4b 1 δ t a x t m m 0 m 1 λ m ϕ m x ϕ m t x α m t indeed such a weighting provides an energy re distribution of the spatial modes at each time step the weighting principle proposed here consists of selecting from the reference data the set of time instances that match to the large scale structure of the current simulation to be more specific let us consider a current velocity field u l x t at a given time t of the sbve simulation the projection coefficient b 1 l of the current fluctuation u l on the first spatial mode ϕ 1 is defined by 4 5a b 1 l t u l t ϕ 1 ω where the fluctuation u l at one position is obtained by subtracting a local average of the current field around that position and where u v ω ω u v d x denotes the l 2 ω inner product as illustrated in fig 3 a collection of matching instants is constructed by identifying the current projection b 1 l to the time series of the first temporal mode b 1 s s 1 n t subject to a consistent condition of its time increments 4 5b s t s b 1 s b 1 l t c δ s b 1 δ t b 1 l 0 where c is a sufficiently small threshold and δ t b b t b t δ t stands for the temporal variation of b at time t this aims at selecting the events corresponding to the same projection coefficient and the same sign of the time increment the weight coefficient α m for each mode m m 0 m 1 is then fixed from the sample variance 4 5c α m t 1 s t 1 s s t b m s μ m t 2 μ m t 1 s t s s t b m s where s stands for the sample size these time dependent coefficients allow us to slave a set of modes on some dominant modes note that in the present study we work only with the first mode however this technique could be extended to a vector of dominant modes in order to select more complex turbulent events let us also outline that the boundary conditions and the divergence free constraint of the random flow 4 4a remain valid with this weighting method 5 numerical results in this section we discuss and compare the respective numerical simulations of the bve 2 4 and the sbve 3 8 the main motivation here is to numerically assess if the proposed random model reproduces well the long term statistics of the high resolution eddy resolving simulation all the models have been discretized with the same numerical schemes as detailed in appendix b a staggered arakawa c grid arakawa and lamb 1977 has been considered in that respect the nonlinear jacobian terms in the governing equations are discretized using arakawa s 9 points conservative scheme arakawa and lamb 1981 to invert the poisson equation 2 1b associated to the stream function an efficient discrete sine transform solver press et al 2007 is adopted for the time stepping a strong stability preserving 3 rd order runge kutta scheme gottlieb 2005 with a courant friedrichs lewy cfl number of 1 3 is considered for bve as further detailed in appendix b for the sbve we used a similar time integration scheme 5 1 model configurations and simulations in all the configurations we fix the basin length to l 1 and the rossby number to r β 0 0 6 2 for the sbve simulations the uncertainty strength parameter has been fixed to ε 1 for the high resolution eddy resolving model a regular mesh with 256 512 cells with uniform grid spacing δ hr 0 004 and a five times wider harmonic boundary layer δ 2 0 02 have been used we consider a quiescent state as the initial condition that is ψ x t 0 0 x ω for such an initial condition the dominant sverdrup balance between the forcing and rotation leads to a symmetric pv field during a short period as the nonlinear inertial term becomes more and more important a symmetry breaking phenomena occurs at t 2 which can be observed from the time series of the global kinetic energy in fig 4 this so called spin up period is then followed by a dissipation stage up to t 5 of the very high enstrophy that has been produced during the spin up immediately after the flow dynamics becomes rapidly turbulent the three subsequent snapshots in fig 4 illustrate this vigorous eddying nature at coarse resolution the subgrid dissipation model is defined through a biharmonic friction term with a grid dependent uniform coefficient we choose such a simple yet commonly used eddy viscosity scheme to single out the effects of the proposed random model and the sub grid dissipation besides as shown in appendix c our model provides a very useful technique to estimate the uniform coefficient δ 4 from the high resolution data ω o 2 ψ o the idea consists in fixing the amplitude of a specific noise with a corresponding noise diffusion of biharmonic form such that its energy matches to the observed turbulent kinetic energy this simple estimation is a very interesting by product of our stochastic setting for instance in our case the estimated values of δ 4 at coarse resolutions 64 128 32 64 and 16 32 are respectively 0 026 0 040 and 0 049 in practice all these values have shown to be very good estimates for the subgrid dissipation the numerical simulations of the sbve are performed using both the pod denoted as sbve pod technique and mode matching denoted as sbve mm approach in both simulations the spatial modes for different coarse resolutions are trained during the same period consisting of 6000 snapshots the energy proportion parameter γ 0 of the first truncated mode for the random flow is resp estimated at 0 95 and 0 92 at resolution 64 128 and 32 64 same for 16 32 as shown in fig 5 by introducing randomness into the initial symmetric double gyre circulation the symmetry breaking state is reached much earlier for the sbve simulations than for the bve hereafter in order to compare the different models and to reduce the spin up errors we use the coarse grained version of one specific eddy resolving snapshot after t 5 as the initial condition for all coarse model runs in other words the bve and the sbve at each coarse resolution are simulated from the very same initial field in which the spin up period is accounted for at the eddy resolving resolution an instantaneous illustration of the small scale random stream function denoted as ψ r 1 δ t φ d b t and the itô stokes stream function ψ s is shown in fig 6 it appears that both ψ r and ψ s based on mm are stronger and more regular than those based on pod 5 2 long term prediction of statistics although we are working in a turbulent regime the statistics of the large scale tracers ψ and q tend to reach a statistical steady state equilibrium as shown in greatbatch and nadiga 2000 a robust four gyre structure is characterized in time averaged circulation as long as the dissipation is sufficiently weak here a weak dissipation means that the boundary layer size δ 2 or δ 4 has a smaller order than the so called rhines scale r β vallis 2017 however this does not indicate that the flow dynamics are under resolved note that in under resolved simulations the contour lines of the averaged tracers would be oscillating on the other hand increasing the explicit dissipation up to the order of rhines scale would result in a conventional double gyre in this work apart from the mean structure we are also interested in the eddy energy distributions and higher order moments of the tracers such as skewness and kurtosis these two standard moments of a probability distribution characterize the asymmetry and extreme events respectively they are particularly informative when the distribution is non gaussian more precisely the first four central moments of ψ are defined by 5 1a m 1 ψ ψ t m k ψ ψ m 1 ψ k t k 2 3 4 where the superscript k denotes the power while the subscript k denotes the order of the moment similarly the central moments of q as function of the prognostic variable ω are defined by 5 1b m 1 q r β m 1 ω y m k q r β k m k ω k 2 3 4 the skewness s resp kurtosis k of ψ reduces to 5 1c s ψ m 3 ψ m 2 ψ 3 2 k ψ m 4 ψ m 2 ψ 2 3 where algebraic manipulations ensure that the kurtosis of the gaussian distribution is zero the skewness resp kurtosis of q is given by 5 1d s q s ω k q k ω we remark from 5 1 that the skewness and kurtosis of both tracers ψ and q are not defined at boundaries since the second moments are zero there in addition the eddy kinetic energy eke and the eddy potential enstrophy epe are provided through second order moments by 5 1e eke 1 2 m 2 u m 2 v epe 1 2 m 2 q in the following these statistics are computed for both bve and sbve at resolution 64 128 32 64 and 16 32 before discussing the results the convergence of each statistic at each resolution is quantified this can be done by progressively increasing the time interval and computing a global error of the statistics between two adjacent intervals more precisely let us consider a point wise statistic f obtained for a sufficiently long interval t 0 t 1 where t 1 depends on the resolution considered with a uniform partition of increment δ t we propose to measure the convergence by a relative global error ϵ between the subintervals t 0 t and t 0 t δ t 5 2 ϵ f t f t f t δ t 2 f t 1 2 where 2 ω stands for the l 2 ω norm and f t x x ω denotes the local in time point wise statistics associated to the interval t 0 t in practice we initiate this procedure from a reasonable intermediate instant t c t 0 t 1 and t 0 is a fixed time after the spin up set to t 0 20 in this work cf fig 4 and the time increment has been fixed to δ t 0 1 a statistic is considered to be converged as soon as the time series of relative global errors reaches a stable low error level as shown in fig 7 we observe that the convergence to an error less than 1 for resolutions 256 512 64 128 32 64 and 16 32 is reached approximatively after the time 140 250 350 and 500 respectively we note that the coarser the resolution the longer it takes to get converged statistics this is even more pronounced for higher moments this is likely due to higher values of the turbulent viscosity which prevent the flow to visit freely its attractor and enforce it to stay for a much longer time in the attraction basin of the equilibrium points chapron et al 2018 note also that as observed therein the convergence time for sbve is shorter for all resolutions studied here not shown therefore we choose to use for all simulations the slowest convergence time i e the one computed for bve hereafter we focus on the comparisons of the statistics obtained for the different coarse models to build a reference ref for each resolution we directly subsample the statistics computed on the eddy resolving data i e we do not smooth them in order not to lower their energy fig 8 shows that at the coarsest resolution 16 32 the four gyre structure is captured for both models yet the two outer gyres predicted by sbve are more enhanced and closer to the reference compared to those obtained by bve since the scale parameters are fixed the major contribution comes from the stochastic representation of the mixing effects incorporated through the eddy resolving data a more accurate nonlinearity is produced such that a stronger distortion of the pv field between inner and outer gyres is observed from fig 9 we observe that compared to bve sbve mm produces higher eddy energy in the front between the outer and inner gyres and higher eddy enstrophy in the region between the two inner gyres however both coarse models do not produce enough energy flux in the western and eastern boundary layers in particular the too low tracers variance in the eastern boundary layers leads to markedly higher skewness and kurtosis than those observed in the reference nevertheless the introduction of randomness enables us to increase the internal variability of the tracers for instance as shown in figs 10 and 11 the region with extreme values of skewness and kurtosis is significantly reduced for sbve mm when compared to bve as the resolution increases it can be noticed from figs 12 and 13 that the local structures of the pv statistics provided by sbve mm qualitatively converges to the reference in order to provide a more quantitative comparison we propose here a global performance index measured by the root mean squared error rmse with an a posteriori normalization to ensure a similar error level of the different statistics given a statistic f with reference f ref the normalized rmse is defined as 5 3 rmse f 1 ω f f ref 2 max x ω f ref x table 1 compares the results of the different models at the coarsest resolution 16 32 the proposed stochastic model shows a clear improvement of all the statistics w r t the references this improvement is particularly noticeable for the higher moments for instance compared to bve sbve mm has 35 87 and 39 26 less errors in skewness and kurtosis of the stream function sf respectively the mode matching strategy sbve mm performs better than the pod strategy sbve pod for all moments although the latter already reduces the bve error of the first and second moments with an improvement of 9 7 for the sf mean and 12 6 for eke both sbve mm and sbve pod reach very similar errors in terms of eke and epe with an improvement above 10 for both quantities and sbve mm is more efficient in reducing errors in the third and fourth moments these results highlight the benefits that are brought by properly incorporating into large scale simulations the effects of the small scale flow component through its statistical distribution from tables 2 and 3 we see that these rmses improvements still hold as the resolution is increased the improvements at resolution 64 128 in terms of eke and epe are still noticeable 25 the third order moment of sf continues to improve 20 while for the fourth order moments the improvement is less significant both sbve mm and sbve pod improve also the first order moments at resolution 32 64 at almost the same rate as for the coarsest resolution and 64 128 with a smaller decreasing of the errors this latter has by definition a lower noise level this illustrates that even for weak noise levels the stochastic systems lead to better results than the deterministic version we analyze now the individual effects of the itô stokes drift and the additional vorticity sources on the accuracy of the statistics to that end two particular versions of sbve have been run in the first one denoted as sbve ns ns for no itô stokes drift the terms related to u s are dropped in 3 8 in the second one denoted as sbve cp cp for circulation preserving source term d s t is removed in addition to the itô stokes drift terms this second version corresponds to the model described in cotter et al 2019 2018 for which there is no energy conservation due to the absence of the stochastic source term cf bauer et al 2020 these two models are evaluated at the resolution 32 64 with the same parameters r β 0 0 6 2 and δ 4 0 040 as before and the same pod noise note that the advection by the itô stokes drift has no effect on the resolved energy however as it can be observed in table 4 from the comparison between sbve ns and sbve pod its inclusion improves all the sf moments with a marked decrease of errors in the first and third moments these improvements outline the importance of taking into account properly the inhomogeneity of the small scale component as captured by the itô stokes drift in contrast the itô stokes drift plays no role in terms of the pv mean and epe and only leads to marginally better third and fourth order pv moments finally sbve cp provides intermediate results between the traditional large scale deterministic model and the proposed stochastic model the influence of the stochastic source term can be appreciated comparing sbve ns and sbve cp this term which guarantees the conservation of the global energy enables us to improve the sf mean and kurtosis as well as the pv skewness and kurtosis the association of both the itô stokes drift and the stochastic source terms improves the four sf moments and the third and fourth order pv moments for the barotropic regime studied here global energy conservation together with the itô stokes correction as considered in this stochastic framework provides more accurate long term statistics than models in which these two features are not taken into account in addition to the discussions above it is also important to show if the sbve on coarse mesh can reproduce the temporal correlation behaviors of the reference gugole and franzke 2019 to this end the autocorrelation functions acf for the time series of the global stream function are adopted more precisely this acf is defined as 5 4 acf τ ψ t ψ t ψ t τ ψ t t σ ψ 2 where τ stands for a time lag ψ t 1 ω ω ψ x t d x is the global stream function at time t and σ ψ is the temporal standard deviation of ψ fig 14 shows that compared to the bve at each coarse resolution both sbve pod and sbve mm capture better the acf of the reference for instance they have smaller decorrelation time scales compared to the bve besides the best results are provided by the mode matching method which is consistent with our previous conclusions 6 conclusions the approach explored in this work consists in a stochastic representation of mesoscale eddy effects on large scale ocean circulation the main result demonstrates that the large scale flow can be simulated by a coarse resolution model composed of a multiplicative random forcing a heterogeneous diffusion and an advection correction all these ingredients allow us to correctly backscatter dissipate and distribute the large scale energy such a random model built from classical conservation laws provides here an explicit eddy representation for a single layered qg model under this regime additional vorticity sources arise from the interaction of the strains between the small scale random component and the large scale current these terms are important in conserving the global energy of the resolved scales numerically the spatial correlation of the random fields in the coarse model is defined from the coherent structures of an eddy resolving simulation in order to quantify the accuracy of the proposed random model a statistical analysis of the flow tracers has been performed as expected compared to a classical coarse model the proposed stochastic model better represents the nonlinearity at the resolved scales while properly dissipating the unresolved scales leading hence to a balanced correction of excessive dissipation and the continuous increase of internal variability as a result it reproduces better on a coarse mesh the local structures of the distribution of eddy resolving tracers further analysis showed that the vorticity sources are important in locally strengthening the eddy flux of pv although the idealized barotropic model used in this work cannot describe quantitatively the real ocean they do in fact produce qualitatively realistic patterns of large scale flow in the major basins of the world as illustrated in vallis 2017 the encouraging results presented here inspire us to implement the proposed stochastic approach on more complex flow and to test more physical parameterizations for the small scale random flow two subsequent projects on the study of q gcm hogg et al 2003 and nemo nemo team 2016 are already in progress in particular we aim to parametrize the noise on the isopycnal surfaces gent and mcwilliams 1990 such that the transfer of the available potential energy to the resolved kinetic energy can be efficiently achieved success of other stochastic parameterizations grooms et al 2015 gugole and franzke 2019 porta mana and zanna 2014 zanna et al 2017 provides some confidence that the backscatter and jet enforcement can be reproduced with some success under the proposed stochastic framework besides the feasibility for the application of the mode matching strategy on these models will be analyzed all these efforts aim at progressively going toward the study of data driven stochastic ipcc class climate models and to confirm that relevant stochastic flow models contribute to improve them credit authorship contribution statement werner bauer writing review editing supervision pranav chandramouli methodology writing review editing long li conceptualization methodology software writing original draft writing review editing etienne mémin conceptualization methodology writing review editing supervision declaration of competing interest the authors declare the following financial interests personal relationships which may be considered as potential competing interests the authors are the recipients of an erc research grant in collaboration with dr darryl holm and dr dan crisan from imperial college london and dr bertrand chapron from ifremer acknowledgments the authors acknowledge the support of the laboratoires d excellence cominlabs lebesgue and mer through the seacs project and of the erc eu project 856408 stuod appendix a snapshot pod this section describes briefly the snapshot pod method sirovich 1987 let us consider a set of fluctuation snapshots u o u o u o t where the overbar denotes temporal average the corresponding temporal covariance tensor is defined as c c i j i j 1 n t such that a 1a c i j 1 n t u o t i u o t j ω 1 n t ω u o x t i u o x t j d x the eigenvalues and their associated eigenfunctions can be estimated from the following eigenvalues problem a 1b c b λ b where λ λ i i 1 n t is the set of decaying eigenvalues i e λ 1 λ 2 λ n t 0 and b b i j i j 1 n t b i j b i t j is a complete set of orthogonal eigenvectors the temporal modes b i i 1 n t are then normalized such that a 1c b i t b j t t λ i δ i j where δ i j denotes for the kronecker symbol here the spatial modes ϕ i i 1 n t given by a 1d ϕ i x b i t u o x t t are orthonormal a 1e ϕ i ϕ j ω δ i j and from this spectral decomposition each snapshot can be reconstructed by a 1f u x t j u o t x i 1 n t b i t j ϕ i x appendix b numerical schemes this section gives a brief description of the numerical methods used for solving the bve 2 4 and the sbve 3 8 as shown in fig 15 both model variables are discretized on a staggered arakawa c grid arakawa and lamb 1977 with the uniform grid spacings δ x and δ y in x and y directions the stream function ψ same for φ d b t and the vorticity ω are tabulated on the cell corners referred to as p points whereas the velocity components u and v same for the components of u s and σ d b t are placed on the horizontal and vertical cell interfaces respectively they are referred to as u points and v points respectively considering m n cells then the p grid has m 1 n 1 points with homogeneous dirichlet boundary values defined as b 1a ψ 0 ψ m ψ 0 ψ n 0 the same boundary condition is imposed on ω and φ d b t the u grid has a dimension of m 1 n 2 points together with free slip boundary values imposed as b 1b u 0 u m 0 u 0 u 1 u n 1 u n while the v grid has m 2 n 1 points with the free slip boundary values b 1c v 0 v n 0 v 0 v 1 v m 1 v m the same discrete representations apply to u s and σ d b t discretized differential operators can now be consistently built within such a specific staggered grid they are based on the following first derivative approximations b 2 x h θ i 1 2 j θ i 1 j θ i j δ x y h θ i j 1 2 θ i j 1 θ i j δ y which remains valid whether θ be defined in p u and v grid as such the velocity u resp for σ d b t can be derived from a given stream function ψ resp for φ d b t by applying the discretized perpendicular gradient h y h x h t subsequently the vorticity is given by ω h t u h t h ψ h 2 ψ where the discretized laplacian operator reads b 3 ω i j ψ i 1 j 2 ψ i j ψ i 1 j δ x 2 ψ i j 1 2 ψ i j ψ i j 1 δ y 2 for any interior i j points of the p grid conversely the stream function ψ and similarly for φ d b t can be re constructed from a current vorticity ω and the inverse of the laplacian operator h 2 1 expressed in practice in the fourier domain through an efficient discrete fourier transform solver press et al 2007 more precisely expanding the prognostic variables ψ and ω in sine waves b 4a ω ˆ k l i 1 m 1 j 1 n 1 ω i j sin π i k m sin π j l n and substituting them into the previous discretized equation b 3 yield the spectral relationship b 4b ψ ˆ k l ω ˆ k l c k l c k l 2 δ x 2 cos π k m 1 2 δ y 2 cos π l n 1 the solution in physical space for interior points is then given by the inverse sine transform b 4c ψ i j 2 m 2 n k 1 m 1 l 1 n 1 ψ ˆ k l sin π i k m sin π j l n to discretize the nonlinear jacobian terms in the bve and in the sbve we employ arakawa s 9 points conservative scheme arakawa and lamb 1981 actually such a discretization can be interpreted through interpolated derivatives on the staggered grid for instance the advection of ω by ψ can be written as b 5a j h ψ ω 1 3 x h ψ x y h ω y y h ψ y x h ω x 1 3 x h ψ y h ω y x y h ψ x h ω x y 1 3 y h ω x h ψ x y x h ω y h ψ y x where θ x i 1 2 j θ i 1 j θ i j 2 and θ y i j 1 2 θ i j 1 θ i j 2 stand for central interpolations between two neighboring points in x and y directions respectively such a discretized operator is applied in the very same way on the other advection terms of the sbve 3 8a associated to φ d b t the source terms 3 8b are otherwise discretized as b 5b j h u y u y j h v x v x where u and v denote the two components of u σ d b t u s d t the stochastic rk3 scheme of cotter et al 2019 is given by b 6a ω 1 ω n f δ t ψ n ω n g φ d b t n δ t u s n ω n h σ d b t n δ t u s n u n b 6b ω 2 3 4 ω n 1 4 ω 1 f δ t ψ 1 ω 1 g φ d b t n δ t u s n ω 1 h σ d b t n δ t u s n u 1 b 6c ω n 1 1 3 ω n 2 3 ω 2 f δ t ψ 2 ω 2 g φ d b t n δ t u s n ω 2 h σ d b t n δ t u s n u 2 where f δ t ψ ω δ t j ψ ω δ t r β f d ψ x g φ d b t δ t u s ω j φ d b t ω δ t u s ω 1 r β x φ d b t and h σ d b t δ t u s u j σ d b t δ t u s u appendix c estimation of uniform biharmonic friction coefficient we assume that there exists an additional isotropic random field living at the unresolved sub grid scales i e not represented at the considered resolution scale thus the global contribution of its variance tensor a 0 i 2 to the enstrophy dissipation can be expressed by c 1a 1 2 ω ω o a 0 2 ω o d x a 0 2 ω ω o 2 d x with parameter a 0 fixed from the mean kinetic energy of the velocity fluctuations living within the range between the cutoff scale and the high resolution grid scale weighted by a correlation time scale kadri harouna and mémin 2017 besides the global dissipation budget due to the considered biharmonic eddy viscosity model is given by c 1b ω ω o δ 4 5 4 ω o d x δ 4 5 ω 2 ω o 2 d x identifying these two budgets and applying a time average enable us to define a simple empirical estimator for δ 4 c 1c δ ˆ 4 a 0 2 ω ω o 2 d x ω 2 ω o 2 d x t 1 5 this estimator has been used systematically to automatically tune the eddy viscosity coefficient at the different resolutions considered in this work fig 16 shows a series of estimated values δ ˆ 4 from resolution 16 32 to resolution 64 128 
23966,this study is concerned with the characteristics of coherent vortices within the turbulent air flow undulated by gravity and capillary gravity water waves the flow fields from the direct numerical simulations are analyzed a formal scheme is developed to detect and classify the vortical structures the scheme uses local analysis of the velocity gradient tensor to define the vortex swirling core and adopts the topological geometry of the swirling core to classify the vortical structures three types of vortical structures are identified including quasi streamwise vortex reversed and forward head pointing upstream and downstream respectively horseshoe vortices quasi streamwise vortices are the dominant structure in the flow their distribution initiates near the wave trough extends downstream along the windward face lifts up and terminates above the wave crest more reversed horseshoe vortices are observed than the forward horseshoe vortices both cluster around the region above wave trough reversed and forward horseshoe vortices however contribute the most to the production of reynolds stress associated with sweep and ejection motions respectively the quasi streamwise vortices contribute more to producing reynolds stress associated with ejection event indicating that the elongated vortices bend inward at the downstream end and can be considered as degenerate forward horseshoe vortices the intensified distributions of horseshoe vortices near the wave trough are attributed to the combined effect of vortex turning from the spanwise turbulent component to the streamwise vortex and the vortex stretching of the streamwise vortex the strong stretching of streamwise vortex above the windward face contributes to the continuous development of quasi streamwise vortices accordingly the presence of capillary ripples on the windward face mitigates effectively the occurrence of coherent vortices in particular the quasi streamwise vortices in contrast the presence of capillary ripples on the leeward surface presents a minor effect on the mitigation of coherent vortices keywords coherent vortical structure turbulent air flow capillary gravity wave direct numerical simulation 1 introduction the flows in close proximity to the ocean atmosphere interface control the exchanges between the atmosphere and the ocean the scales of these flows including wave motions and turbulence are much smaller than that of the ocean and atmosphere the processes of turbulent flow mixing and exchange of momentum and heat within this interfacial layer however can profoundly affect the large scale oceanic and atmospheric flows in the atmospheric boundary layer above the wavy surface complex turbulent processes within the surface layer are undulated by surface waves understanding of the underlying physics remains to be a challenge due to the difficulty of conducting field observations over the open ocean in the last two decades direct numerical simulation dns has been successfully applied to study the turbulent flow over progressive surface gravity waves these include the pioneering attempt by sullivan et al 2000 and the subsequent efforts by yang and shen 2009 2010 2017 and druzhinin et al 2012 the more recent simulation conducted by the present authors druzhinin et al 2019 considered the surface capillary gravity wave and studied the effect of the parasitic capillary ripples on the turbulent air flow undulated by the carrier gravity wave among the various flow properties one distinct feature observed in the turbulent flow above surface waves is that the distribution pattern of coherent vortical structures significantly differ from that in turbulent wall layer and the distribution exhibits a strong dependence on the wave phase yang and shen 2009 2010 druzhinin et al 2019 coherent vortices in turbulent flow play crucial roles in the production of new turbulence in the transport of momentum across the mean velocity gradient and in the growth of the boundary layer through entrainment robinson 1991 various vortex identification schemes have been developed to extract coherent vortical structures in turbulent flow field produced by high resolution numerical simulations e g hunt et al 1988 chong et al 1990 jeong and hussain 1995 zhou et al 1999 the relationship and difference among these schemes have been tested in various flow fields e g dubief and delcayre 2000 chakraborty et al 2005 alfonsi and primavera 2008 pierce et al 2013 in the turbulent boundary layer next to a flat wall coherent vortical structures are dominated by quasi streamwise vortices robinson 1991 jeong et al 1997 for turbulent air flow above surface water waves quasi streamwise vortices and both forward and reversed horseshoe vortices can be observed and each type of vortex exhibits its own spatial distribution pattern yang and shen 2009 2010 druzhinin et al 2019 classifying characteristic vortices is therefore an indispensable step for conducting a quantitative analysis of various physical processes attributed to them in this study we reappraise the simulation results of turbulent air flow above gravity and capillary gravity water waves of druzhinin et al 2019 with a focus on the characteristics of coherent vortices the objective of the study therefore is two fold first a vortex identification scheme is developed for consistent extraction and classification of various types of coherent vortical structures in the turbulent flow such a scheme enables quantifying the populations of various coherent vortices and revealing their spatial distributions second the developed scheme is applied to analyze the turbulent flow above gravity and capillary gravity waves the emphasis is on understanding the effect of parasitic capillary ripples on the characteristics of identified coherent vortices the paper is organized as follows in section 2 the dnss of druzhinin et al 2019 are summarized four commonly used vortex detection criteria are briefly reviewed in section 3 the feasibility of applying these criteria to the turbulent flow undulated by the surface wave is discussed followed by statistical analyses of the extraction criterion in section 4 geometry based schemes to extract and classify quasi streamwise and horseshoe vortices from the field of detection criterion are presented utilizing the developed vortex classification schemes quantitative features of coherent vortices including the population partitions and spatial distributions of quasi streamwise reversed horseshoe and forward horseshoe vortices the correlations between the coherent vortices and the production of reynolds stress are analyzed in section 5 the impacts of parasitic capillary ripples are revealed from the analysis results 2 numerical simulation of the flow field we consider turbulent air flows above progressive gravity and gravity capillary waves the flow fields are obtained from dnss of three dimensional turbulent couette air flow over a progressive wavy water surface details of the simulations including the numerical model the computation setups and the simulation results were reported in druzhinin et al 2019 and are summarized as follows the computation is performed in a reference frame moving with the phase velocity of the progressive wave c as shown in fig 1 the lower boundary representing the wavy surface therefore is stationary the coordinates x y and z or x 1 x 2 and x 3 are in the streamwise spanwise and vertical directions respectively with the corresponding velocities u v and w or u 1 u 2 and u 3 hence the x direction is regarded as the downstream direction both the surface wave and the air flow are assumed to be periodic in the streamwise and spanwise directions as indicated in fig 1 the windward face is the interval from a wave trough p 1 to its adjacent downstream wave crest p 2 the leeward face is the interval from a wave crest p 2 to its adjacent downstream wave trough p 3 a conformal mapping is employed to transform the physical domain in the cartesian coordinates x y z to the computational domain in the curvilinear coordinates ξ y η 1 x ξ n 1 a n exp k n η sin k n ξ φ n 2 z η n 1 a n exp k n η cos k n ξ φ n where k 1 k 2 π λ is the wavenumber of the carrier gravity wave with amplitude a 1 a and phase φ 1 0 k n n k a n and φ n n 2 are wavenumbers amplitudes and phases of the harmonic components of the capillary ripples the conformal mapping is defined in the way such that the lower wavy surface boundary z z s is mapped to η 0 and the upper boundary is mapped to η 1 at the lower wavy boundary z z s x the velocities are prescribed in the form 3 u ξ y 0 c n 1 k n a n cos k n x ξ 0 φ n c 4 v ξ y 0 0 5 w ξ y 0 u ξ y 0 z ξ z η η 0 in eq 3 the amplitudes and phases of capillary ripples k n a n and φ n n 2 are prescribed so as to simulate the parasitic capillaries observed in fully nonlinear computations of gravity capillary waves by hung and tsai 2009 and tsai and hung 2010 at the upper boundary plane z l z a bulk velocity u 0 is prescribed as noted in druzhinin et al 2019 the present simulations which are similar to the earlier computations by sullivan et al 2000 yang and shen 2009 2010 2017 and druzhinin et al 2012 are posed by considering air flow above a wavy boundary with prescribed velocities of surface waves the model thus neglects the coupling between the air flow and the surface waves and also the possible nonlinearities of boundary conditions associated with the wave motions yang and shen 2009 assessed the validity of such an idealized model by performing both uncoupled computation air flow above prescribed stokes wave and air water coupled simulations air flow above a nonbreaking water surface wave evolving under the impact of the air flow the results show that the coupling does not significantly alter the properties of the air flow as compared to the uncoupled simulation this conclusion justifies the simplification of using prescribed wavy boundary for the air flow simulations both in the present and previous studies systematic variations of the ripple amplitude and phase velocity denoted by ap1 to ap10 in druzhinin et al 2019 allow for studying their effects on the air flow topological structure and statistics in these cases the surface elevations can be distinguished by two characteristic distributions of capillary ripples with respect to the carrier wave crest ripples can be distributed either uniformly over the entire surface or predominantly on the leeward side near the crest accordingly three representative two dimensional surface waves considered in druzhinin et al 2019 are analyzed in the present study as shown in fig 2 including gravity wave without capillary ripples fig 2a referred to as ap2 gravity capillary wave with maximum amplitude ripples occur near the crest and decay along the leeward side surface of the carrier wave fig 2b referred to as ap6 and gravity capillary wave with uniform capillary ripples over the entire surface of carrier wave fig 2c referred to as ap10 note that the ripple amplitude in the case ap10 is half of the maximum amplitude in the case ap6 but remains constant throughout the entire carrier wave surface the ripple amplitude in the case ap6 is maximum in the crest of the carrier wave decreases along the leeward surface and becomes nearly vanished on the windward surface on the leeward face the ripple amplitudes of ap6 case are higher than those of ap10 case on the windward face however the ripple amplitudes of ap6 case are smaller than those of ap10 case the two different distribution patterns of capillary ripples are chosen so as to study the dependence of the ripple effects along the surface of the carrier wave in all three cases the wavelength of carrier wave λ 5 cm and steepness a k 2 π a λ 0 2 the wave age c u 3 where u is the friction velocity and the reynolds number r e u 0 λ ν 10 000 where ν is the kinematic viscosity of air these are equivalent to the slow wave case considered in yang and shen 2009 2010 2017 the length width and height of the flow domain are 6 λ 4 λ and λ respectively and are discretized by 360 240 and 180 grids when normalized by the wall unit ν u the horizontal grid size δ ξ δ y 6 and the vertical grid size varies from δ η 0 3 near the upper and lower boundaries to δ η 3 in the middle of the computational domain since the flow is undulated by the wavy boundary associated with the surface water waves a property quantity of the instantaneous flow field f ξ y η t can be decomposed into f ξ y η t f η t f ξ y η t f ξ η t e g sullivan et al 2000 tsai et al 2013 yang and shen 2017 druzhinin et al 2019 f η t f ξ y η t is the average of f over the horizontal ξ y plane f ξ η t f y ξ η t f η t is the wave correlated component where f y ξ η t is the phase average of f over spanwise y f ξ y η t is the fluctuation component in the latter analyses we will primarily focus on the property variable excluding the wave correlated component which defined as f ˇ ξ y η t f η t f ξ y η t f ξ y η t f ξ η t it has been demonstrated from experimental measurements troitskaya et al 2011 2014 and numerical simulations yang and shen 2010 druzhinin et al 2012 2019 that the well pronounced separation zones in the vicinity of the wave crests which are visible in the instantaneous flow field are smoothed out if the phase average f y is done by taking an additional ensemble average over different time instances consequently as will be explained in section 3 2 comparing figs 3 and 4 the spanwise vortices attributed to flow separation from the crests of capillary ripples cannot be effectively eliminated in the instantaneous velocity field u ˇ i ξ y η t despite the flow field has reached a statistically steady state as such to focus on analyzing the coherent vortices associated with turbulent flow the averages are computed without taking the temporal ensemble in the present study 3 coherent vortical structures in the flow field 3 1 extraction of coherent vortices various methods for identifying coherent vortical structures within a flow field have been developed primarily for the turbulent wall layer they can be classified into mathematical criteria based on the local analysis of the velocity gradient tensor e g chong et al 1990 hunt et al 1988 zhou et al 1999 and on the hessian of the pressure jeong and hussain 1995 the local geometry of flow field near a critical point such as a vortex can be depicted by the characteristic equation of the velocity gradient tensor rate of deformation tensor a i j u i x j chong et al 1990 6 λ 3 p λ 2 q λ r 0 where λ is the eigenvalue p tr a i j q 1 2 tr a i j 2 tr a i j 2 and r det a i j are the three invariants in the flow of incompressible fluid p 0 and q can be expressed as 7 q 1 2 ω i j 2 s i j 2 where ω i j 1 2 u i x j u j x i is the rotational rate tensor s i j 1 2 u i x j u j x i is the strain rate tensor mathematical criterion based on local analysis of the velocity gradient tensor can then be defined to educe the vortical structures the three commonly used criteria are hunt et al 1988 defined an eddy zone as a region of large vorticity magnitude in comparison with the strain rate i e q 0 with a local pressure minimum jeong and hussain 1995 however showed that the additional low pressure condition can be neglected chong et al 1990 defined a vortex core as the region where a i j has conjugate complex eigenvalues i e the discriminant δ of the characteristic eq 6 is positive in incompressible flow the condition becomes 8 δ 1 2 r 2 1 3 q 3 0 the conjugate complex eigenvalues imply that the local flow pattern reveals a spiral or center phase portrait this flow pattern is consistent with the vortex definition proposed by robinson 1991 note that δ 0 when q 0 the inverse however is not always true the q criterion therefore is more restrictive than the δ criterion chakraborty et al 2005 similar to the δ criterion zhou et al 1999 defined the vortical structure as the region with conjugate complex eigenvalues λ c r i λ c i of the velocity gradient tensor the imaginary part of the eigenvalue λ c i represents the local strength rate of the vortex thus λ c i 0 represents the region where vortex occurs it has been observed that a vortical structure in a turbulent flow is always accompanied by a local pressure minimum however unsteady straining can create a pressure minimum in a flow without involving a swirling motion on the other hand the viscous effect can eliminate the pressure minimum with vortical motion to avoid the ambiguity jeong and hussain 1995 considered the symmetric part of the gradient of the navier stokes equation 9 d s i j d t ν s i j x k x k b i j 1 ρ p x i x j where the tensor b i j ω i k ω k j s i k s k j the existence of a local pressure minimum requires two positive eigenvalues of the hessian of pressure p x i x j by neglecting the first two terms on the left hand side of eq 9 which are associated with the unsteady and the viscous effects respectively b i j determines the existence of a local pressure minimum due to a vortical motion since b i j is symmetric all its eigenvalues are real and can be ordered as λ 1 λ 2 λ 3 the existence of a local pressure minimum i e the presence of a vortex core in the flow therefore requires the intermediate eigenvalue of b i j to be negative i e λ 2 0 3 2 preliminary observations of vortical structures with the defined detection criteria q δ λ c i and λ 2 visualization of coherent vortical structures can be achieved by plotting the isosurface of some non zero threshold value of the criterion the choice of the criteria and its threshold value however introduces some arbitrariness into vortex core identification chakraborty et al 2005 examined this issue and proposed the inter relationships of threshold values among the four criteria as 10 λ c i t h q t h 1 2 27 δ t h 1 6 λ 2 t h 1 2 where the subscript th represents the threshold the equivalent thresholds were applied to various canonical turbulent flows including forced isotropic turbulence chakraborty et al 2005 wake flow behind a sphere and channel flow chakraborty et al 2006 the results reveal remarkably similar vortical structures using the equivalent thresholds note that the equivalent thresholds of eq 10 are non optimal and can be modified for different flow cases to check how the four commonly used criteria and the equivalent thresholds perform in our simulated flows instantaneous distributions of the criterion isosurfaces for the three cases of air flows above surface waves without ripples case ap2 in the left column with large amplitude leeward side ripples case ap6 in the center column and with uniform ripples case ap10 in the right column are shown in fig 3 the threshold values of the detection criteria are q 5 first row δ 4 63 second row λ 2 5 third row and λ c i 2 5 fourth row the orange blue color of the isosurfaces represents positive negative streamwise vorticity the four methods result in similar distributions of extracted vortical structures indicating the feasibility of the equivalent thresholds nevertheless it is observed that the δ criterion is slightly nuanced revealing thicker structures and more fluctuating than the others this observation in the turbulent air flow over surface waves is similar to that observed in the turbulent channel flow alfonsi and primavera 2008 as a result with no particular preference we choose the λ c i 2 criterion to extract the coherent vortical structures in the present study comparison among the flows above three different wavy surfaces reveals two distinct features of the coherent vortex distributions first spanwise vortical structures attributed to ripples are profound in ap6 case and visible in ap10 case increasing the difficulty of observing vortical structures above them as seen in fig 3 these spanwise vortical structures can be largely eliminated by subtracting wave correlated velocity components from the velocity field while the upper structures remain intact as shown in fig 4 for this reason in the following analyses wave correlated velocity components are subtracted from all instantaneous flow fields second it is found that various types of vortical structures co exist and exhibit complex variabilities in geometry reflecting the difficulty in revealing their correlations with the phase of carrier wave and the presence of parasitic ripples this calls for a formal scheme to classify the vortical structures and to quantify their distributions since the vortical structures are visualized by plotting the isosurfaces of the λ c i 2 criterion their quantities and shapes depend on the threshold value chosen as depicted in fig 5 where the isosurfaces of λ c i 2 1 5 and 10 are plotted the quantity of detected vortices gradually increases when the threshold value is incrementally decreased adjustment of λ c i 2 threshold value therefore allows for clearer observations of vortex shape in the flow field when the threshold value is chosen too low such as the cases plotted with λ c i 2 1 in fig 5a d and g the flow fields of the three cases are all populated with both strong and very weak vortices making it impossible to observe independent structures if the threshold value is chosen appropriately such as λ c i 2 5 in fig 5b e and h the individual vortical structures can be observed manifestly in general three types of characteristic vortical structures in proximity to the wavy surface can be found in all three cases forward horseshoe vortex referred to as fhv hereafter with head points downstream labeled by a in the close up view of fig 5b reversed horseshoe vortex referred to as rhv hereafter with head points upstream labeled by b and elongated quasi streamwise vortices referred to as qsv hereafter labeled by c and d the ones indicated are dominated by negative and positive streamwise vorticity respectively if the threshold value is chosen too high only very strong vortical structures are revealed some vortical structures become separated and vanished as shown in fig 5c f and i for instance when the threshold value is increased from λ c i 2 5 to λ c i 2 10 accordingly the threshold value λ c i 2 5 is chosen for visualizing and identifying vortical structures in the present turbulent flow fields the impact of the criterion threshold value on the analyses based on the detected coherent vortices will be discussed when encountered 3 3 vortex statistics and characterization before investigating quantitative properties of the characteristic vortical structures such as their population partitions and spatial distribution patterns we first determine the preferred height and orientation tendency for the occurrence of coherent vortices by examining some statistical profiles associated with λ c i fig 6 depicts vertical variations of the mean λ c i 2 η λ c i 2 ξ y computed from u i ξ y η the total velocity field and from u ˇ i ξ y η the velocity field without the wave correlated component for the three air flows ap2 ap6 and ap10 where ξ y denotes averaging over the ξ y plane the major difference between the two λ c i 2 profiles computed from u i and u ˇ i respectively occurs in the proximity of the wavy boundary η 10 the difference is particularly pronounced for the cases of capillary gravity waves ap6 and ap10 reflecting that the parasitic capillary ripples induce stronger spanwise vortices in the air flow than the carrier gravity wave does as revealed by fig 3 filtering out the wave correlated component from the total velocity field however effectively excludes these non turbulent wave correlated spanwise vortices immediately above the wavy surface comparing figs 3 and 4 consequently λ c i 2 of the velocity field u ˇ i is reduced for η 5 reflecting that the viscous sublayer contains few coherent turbulent vortices the λ c i 2 profiles of the two velocity fields u i and u ˇ i coincide for η 10 indicating the coherent vortices attributed to wave correlated velocity are rapidly attenuated away from the wavy boundary this however does not imply that the undulation motion caused by the carrier gravity wavy surface has no impact on the formation of coherent vortices the peaks of λ c i 2 are located at η 22 20 7 and 21 8 with the values of 0 89 0 9 and 0 9 respectively for the cases ap2 ap6 and ap10 indicating that the prominence of the coherent vortices occurs in the higher buffer region it also suggests that the presence of parasitic capillary ripples might have a minor effect on mitigating the development of coherent vortices for η 30 the decreasing λ c i 2 implies that the number of vortical structures diminishes outside the buffer region the small but finite values of λ c i 2 at higher η indicate the presence of outer scale vortices which will not be considered here variations of the vorticity variances ω i 2 η computed from the total velocity field u i ξ y η and from the velocity field without the wave correlated component u ˇ i ξ y η are shown in fig 7 the distributions with and without the wave correlated components are visually indistinguishable except for the spanwise vorticity ω y 2 in proximity to the wavy surface η 10 the difference is mainly attributed to the boundary velocities of the surface waves which induce spanwise vorticity immediately next to the surface we are primarily interested in the intensive coherent vortices within the buffer region where both the criterion λ c i 2 fig 6 and the vorticity variances reach the local maximum the maximum streamwise and spanwise vorticity intensities at the wavy boundary are attributed to the opposite sign vorticities present underneath the vortices and caused by the no slip boundary condition at the wavy surface the strong spanwise vorticity variance at the wavy boundary is also caused by the strong mean shear of the air flow these strong vorticities are not associated with the coherent vortical structures of interest in this study to reveal the dominant orientation of the vortical structures vertical distributions of normalized cross correlation coefficient r i η between λ c i 2 and each component of the vorticity ω i 11 r i η λ c i 2 ω i ξ y λ c i 2 2 ξ y 1 2 ω i 2 ξ y 1 2 are computed and shown in fig 8 above the viscous sublayer η 10 the r i profiles computed from the velocity fields with and without the wave correlated component are alike for the three flows considered indicating that the wave correlated velocity component has an insignificant influence on the vortical structures outside the viscous sublayer approaching the wavy boundary the values of r i computed from the total velocity field become higher than that computed from the wave excluded flow field this confirms again that the strong vorticities next to the wavy boundary are not associated with coherent vortices within the buffer region 10 η 30 the value of r 1 is larger than those of r 2 and r 3 indicating that most vortical structures are aligned in the streamwise direction in the outer region η 100 the three r i approach similar values the vortices are isotropic and the structures have no preferred direction statistics associated with the vortex core detection criterion λ c i 2 reveal that the coherent turbulent vortices are formed outside the viscous sublayer most vortices with large swirling strength are located in the buffer region η 30 and are aligned in the quasi streamwise direction accordingly all analyses henceforth are conducted within the region of 0 η 170 which is equivalent to half of the flow domain in the vertical direction as shown in fig 5 various types of characteristic coherent vortices including qsv fhv and rhv can arise in turbulent air flow above the wavy surface previous studies yang and shen 2009 2010 2017 druzhinin et al 2019 further reveal that the distributions of these characteristic vortices exhibit spatial variability and population partition systematic investigation of these issues requires a consistent scheme to extract and classify the characteristic vortices 4 extraction and classification of characteristic coherent vortices given an instantaneous three dimensional spatial distribution of λ c i 2 coherent vortical structures are identified and classified into qsv fhv and rhv by two major steps first isolated spatial regions with λ c i 2 higher than a given threshold are identified as vortical structures as revealed by the isosurfaces in figs 3 5 second the identified vortices are then classified into the three types of characteristic vortical structures each with a different extraction procedure during this process trivial structures are discarded the variation between each procedure is based on the geometric properties of the characteristic vortical structure to classify an independent vortical structure we adopt the concept of the topological skeleton the skeleton of an identified vortical structure is defined by connecting the grid points along the minimum increment in λ c i 2 of the neighboring grids the definition of neighboring grids depends on the type of vortical structures to be classified details of the classification schemes are described in the following two sections 4 1 extraction procedure of quasi streamwise vortex fig 9 illustrates the process of searching for the skeleton of a qsv the search starts from the upstream end of each identified vortical structure by locating the grid point with a local maximum of λ c i 2 on such y η plane marked by a black cross in fig 9a once the starting grid point ξ i y j η k is found the next grid point of the skeleton is located by searching for the local λ c i maximum among the adjacent grid points ξ i 1 y j η k ξ i 1 y j 1 η k and ξ i 1 y j 1 η k where η k represents all η layers within the identified vortical structures marked by red diamonds in fig 9b in our computations the streamwise and spanwise grid spacings are nearly identical the horizontal yawing angle of the adjacent skeleton grid points therefore is within 45 to the x axis this detection process is repeated until reaching the downstream end of the structure consequently the line formed by the series of consecutive grid points marked by black dots in fig 9c all with the same sense of streamwise vorticity is defined as the skeleton of a qsv it is obvious that the streamwise length of a qsv can range from as short as two grid size to some finite extent fig 10 depicts the probability density and its corresponding cumulative probability distributions of the extracted qsv length for the three air flows considered using criterion λ c i 2 5 despite the possible difference in the vortex population three flows exhibit similar probability distributions following jeong et al 1997 an additional length threshold of 150 wall units is employed this is equivalent to considering the longest 2 elongated vortices to highlight the elongatedness of qsv 4 2 extraction procedure of horseshoe vortex similar to the above described procedure to identify qsv we also adopt the concept of the topological skeleton to extract rhv and fhv rhv and fhv are only different in their orientations therefore we will describe the procedure to extract rhv the procedure for fhv is identical but is conducted in the reversed direction fig 11 illustrates the procedure to find the skeleton of an rhv the characteristics of vorticity distribution along a rhv are that its streamwise elongated left right leg is dominated by positive negative ω x in the upstream ends these two legs bend inward and connect to form a spanwise head dominated by positive ω y hence there exists an upstream head where the two legs with positive and negative ω x intersect to find this upstream head the search starts from the upstream end of each identified vortical structure by locating the grid point with a local maximum of λ c i 2 among the nearby grid points where ω x ξ i y j η k 0 and ω x ξ i y j 1 η k 0 marked by a black cross in fig 11a once the starting grid point ξ i y j η k is located the skeletons of the two legs are tracked as follows since the left leg must extend toward the first quadrant on the ξ y plane the next grid point is located by searching for the local λ c i 2 maximum with positive ω x among the adjacent grid points ξ i 1 y j η k ξ i y j 1 η k and ξ i 1 y j 1 η k where η k represents all η layers within the identified vortical structures marked by red diamonds in fig 11b 1 this detection process is repeated until reaching the downstream end of the structure fig 11b 2 the right leg of the rhv is detected in a similar way by starting the search from ξ i y j 1 η k and proceeding in the fourth quadrant with negative ω x consequently connecting the series of consecutive grid points marked by black dots in fig 11d forms the skeleton of an rhv 4 3 demonstration of the scheme to demonstrate the effectiveness of the vortex classification scheme fig 12 shows the identified qsv rhv and fhv within the flow field of close up view in fig 5b the results reveal that the scheme accurately identifies and classifies the characteristic vortical structures one fhv labeled by a one rhv labeled by b and two qsvs labeled by c and d are found some vortices which are defined as vortex cores by the λ c i 2 threshold but do not meet the prescribed conditions are not classified into characteristic vortical structures moreover the developed scheme also identifies characteristics vortices which are hard to distinguish from the ambient vortices with the developed scheme identification and classification of characteristic coherent vortices can be done consistently and unbiasedly presenting a more objective approach to quantify the population partition and spatial distribution of the characteristic vortices 5 results 5 1 population partitions of characteristic vortices the criterion λ c i 2 represents the swirling strength of the vortex core the choice of the threshold λ c i 2 therefore affects the number of coherent vortices extracted higher lower threshold λ c i 2 results in extracting fewer more but stronger weaker vortices to understand such a dependency variations of the total number of extracted coherent vortices with the threshold λ c i 2 are depicted in fig 13a d and g for the three air flows ap2 ap6 and ap10 also shown in the results are the population partition of the characteristic vortices qsv rhv and fhv in the three air flows the populations of the three types of the identified characteristic vortices all decrease exponentially when the threshold λ c i 2 increases from 2 to 9 qsv is the dominant structure for the entire range of λ c i 2 considered this can be seen by showing the population partitions of qsv rhv and fhv in fig 13b e and h for the three air flows respectively the population of rhv is higher than that of fhv this contrasts with turbulent flow next to a plane no slip boundary in which fhv is the dominant horseshoe or hairpin vortical structure observed adrian 2007 moin and kim 1985 robinson 1991 jiménez 2018 for the three cases considered the population partitions of qsv fhv and rhv are approximately 60 15 25 respectively fig 13b e and h the comparison suggests the minor effect of capillary ripples on mitigating the formation of coherent vortical structures in turbulent air flow above a wavy surface this is consistent with our findings from the statistical properties of the flow field from dns and from the prediction by the quasi linear theoretical model druzhinin et al 2019 as the threshold λ c i 2 increases both fhv and rhv population partitions of the ap2 case reach constant levels fig 13c in contrast the rhv partition increases but the fhv partition decreases when the threshold λ c i 2 increases fig 13f i suggesting that the presence of parasitic capillary is more effective in mitigating fhv than rhv note that a threshold value of λ c i 2 4 is needed to reveal the population difference between rhv and fhv accordingly λ c i 2 5 is used for detecting vortical structures in the following analyses 5 2 spatial distribution of characteristic coherent vortices the presence of the wavy boundary modulates the spatial distribution of coherent vortices within the turbulent boundary layer e g yang and shen 2009 2010 druzhinin et al 2012 such a modulation can be further complicated by the parasitic capillary ripples to reveal the spatial distributions of characteristic coherent vortices we compute the cumulative occurrence count that a spatial coordinate x z is occupied by one of the three types of characteristic coherent vortical structure as shown in fig 14a c and e the distributions are ensemble results computed from the air flows above six carrier waves at ten independent time instances the corresponding histogram variations in wave phase θ which are calculated by summing up the occurrence counts over z are shown in fig 14b d and f the three air flows ap2 ap6 and ap10 exhibit similar distribution patterns of characteristic coherent vortices only the distributions of ap10 are slightly scarcer than those of ap2 and ap6 consistent with the previous studies on turbulent air flow above the wavy surface the distributions of characteristic vortical structures fhv rhv and qsv exhibit strong dependence on the wave phase for all three cases the fhvs cluster around the region above wave trough 90 θ 270 the peak of the cumulative occurrence count histogram is located at the lower windward face θ 180 and the histogram skews toward downstream most of the rhvs also form within the region above the wave trough but in contrast to fhv the occurrence peak occurs near the lower leeward face θ 180 and the histogram skews toward upstream the qsvs are observed above the entire wavy surface the distribution initiates near the wave trough extends downstream along the windward face lifts up above the wave crest and terminates above next leeward face the peak of the occurrence count histogram is located near the upper leeward face the presence of capillary ripples presents subtle effects on the formation and distribution of coherent vortices for the ap6 case in which the ripples with larger amplitudes accumulate near the crest on the leeward surface the effect is minimal the impact becomes more significant in particular on the qsvs above the windward surface for the ap10 case in which the uniform ripples distribute over the entire surface of the carrier wave by examining the instantaneous flow fields yang and shen 2009 identified the evolution event of vortical structures transforming from rhv above the trough of the carrier wave to qsv along the windward surface the evolution process was explained by looking into the phased averaged transport equation for the streamwise vorticity ω x 12 d ϵ ω x y d t ϵ ω x u x y ϵ ω y y u y y ϵ ω y u y y ϵ ω z u z y 1 r e ϵ 2 ω x y where ϵ sgn ω x among the components on the right hand side of eq 12 the first and third terms denoted by s 11 and t 12 respectively which represent the vortex stretching of the streamwise vortices and the vortex turning from the turbulent spanwise vortices to the streamwise vortices are the dominant transport following the analysis of yang and shen 2009 the vortex transport components s 11 and t 12 for the three air flows ap2 ap6 and ap10 are shown in fig 15a d and g and fig 15b e and h respectively the distributions of the vortex stretching and turning components are similar to that observed in yang and shen 2009 the high intensity region of s 11 begins above the trough of the carrier wave extends through the windward surface and vanishes near the crest of the leeward surface in contrast the predominant region of t 12 initiates near the crest of the carrier wave expands and extends downstream above the leeward surface and ends near the trough note that the intensified region of the vortex turning process coincides with that of the vortex stretching process near the trough of the carrier wave comparing the distribution pattern of three types of coherent vortices depicted in fig 14 with the spatial distributions of streamwise vorticity transport components shown in fig 15 reveals the possible evolutions of coherent vortices along the carrier waveform as follows above the trough of the carrier wave the horseshoe vortices are generated by turning the two end parts of the spanwise turbulent vortices towards the streamwise direction forming the two legs of the horseshoe vortices the streamwise legs of horseshoe vortices are intensified by the strong vortex stretching resulting in the high accumulative occurrence of horseshoe vortices in this region both rhv and fhv can be formed the preference is determined by the flow field in favor of the formation the spatial distributions of fhv and rhv and their corresponding histogram variations in the wave phase depicted in fig 14 reveal that the peak distribution of rhv occurs in the slightly upstream region above the wave trough θ 180 whereas the fhvs accumulated in the slightly downstream region above the trough θ 180 such an offset in the peaks of fhv and rhv distributions can be explained by examining the distributions of the phase averaged velocity field u y w y shown in fig 15c f and i the velocity field exhibits a cat s eye pattern centered about the critical layer height and upwind of the wave trough as revealed in the previous simulations by sullivan et al 2000 yang and shen 2009 and druzhinin et al 2019 in the upstream side of the cat s eye the mean velocity field is reversed within the critical layer the shear flow is in favor of the formation of rhv in contrast in the downstream part of the cat s eye the shear flow is similar to that of wall layer which supports the formation of fhv and qsv mostly degenerate or incomplete fhv with elongated vortices bend inward at the downstream end will be discussed in the next sub section note that the peak region of vortex turning from ω y to ω x t 12 term in eq 12 occurs near the wave crest the corresponding vortex stretching of ω x s 11 term in eq 12 in this region however is minimal and cannot support the continuous development of the horseshoe vortices this also explains that despite the presence of large amplitude capillary ripples near the wave crest in the ap6 case its mitigation effect on the formation of coherent vortices is insignificant the strong vortex stretching of ω x above the windward surface supports the development of fhv and qsv and results in high populated distributions of these two types of vortices as shown in fig 14 the uniform distribution of finite amplitude ripples in the ap10 case causes reduction in the populations of fhv and qsv in this region in contrast in the ap6 case the ripples with diminishing amplitudes on the windward surface result in insignificant mitigation of coherent vortices 5 3 correlation between reynolds stress and coherent vortices it is well known that coherent vortices are responsible for producing reynolds stress in turbulent wall layer e g robinson 1991 wallace et al 1972 wallace 2016 willmarth and lu 1972 specifically fhv and rhv are responsible for ejection u 0 and w 0 referred to as q2 event and sweep u 0 and w 0 referred to as q4 event motions respectively in the turbulent wall layer in turbulent flow next to the wavy surface the process can be complicated by spatial variation of the coherent vortices e g yang and shen 2009 2010 2017 the relationship between the coherent vortices and the q2 and q4 events has previously been examined by yang and shen 2009 2010 using the conditional average method these vortices induced sweep and ejection events are also found to not only enhance the local turbulence momentum flux but also the local turbulence scalar fluxes resulting in their wave phase dependent spatial distribution yang and shen 2017 distributions of the spanwise averaged reynolds stress u w y and the corresponding components attributed to q2 and q4 events are depicted in fig 16a b and c for the three flows ap2 ap6 and ap10 respectively the most intense reynolds stress occurs in the region above the wave trough the peaks attributed to q2 and q4 events are located in the vicinity of the wave trough comparing the distributions of the cumulative occurrence count of coherent vortices in fig 14 and the contours of reynolds stress in fig 16 reveals the following the reynolds stresses associated with q4 event are mainly attributed to rhvs as both regions of the maximum occurrence count of the vortex and the most intense reynolds stress coincide and are located in the lower leeward face near the trough in contrast the predominant production of reynolds stress associated with q2 event is primarily contributed by both fhv and qsv this is deduced from the observations that the region of most intense reynolds stress attributed to q2 event is located in the lower windward face near the wave trough and the intense distribution of reynolds stress extends further downstream along the windward surface and lifts up above the wave crest these two features are similar to the distributions of cumulative occurrence count of fhv and qsv respectively further consideration of the above observations however leads to two subtle issues first both the vortex population fig 13 and the space occurrence count fig 14 reveal that the quantity of qsv is much greater than fhv however the most intense production of reynolds stress associated with q2 event which occurs in the lower windward face is contributed by fhv second the qsvs are found to mainly induce q2 events to clarify the first issue the distributions of the cumulated occurrence count of three characteristic coherent vortices in fig 14 are reappraised by weighting the occurrence count with its λ c i 2 as shown in fig 17 although the quantity of qsv is the highest among the three characteristic coherent vortices the λ c i 2 weighted occurrence count of qsv however profoundly reduces in comparison with fhv this is primarily attributed to the relatively weaker swirling strength of qsv than that of horseshoe vortex which consequently induces weaker q2 or q4 motion qsv possesses a geometric structure similar to that of the horseshoe vortex but with one dominant leg and one degraded leg thus can be classified into four types based on the orientation and geometry properties as depicted in fig 18 type 1 and 2 qsvs bend in at the downstream end and can be considered as a degenerate or incomplete fhv which induces q2 motion while type 3 and 4 qsvs bend in at the upstream end thus are geometrically similar to an rhv which produces q4 event the resemblant distribution patterns between the cumulative occurrence count of qsv and the reynolds stress associated with q2 event suggest that the observed qsvs may be dominated by type 1 and 2 structures to verify such a possibility and also to clarify the second issue the identified qsvs are further classified into four types as depicted in fig 18 distributions of the cumulative occurrence count of the four types of qsv are shown in fig 19a b and c respectively for the three flows simulated in all three flows the quantities of type 1 and 2 qsvs are all higher than that of type 3 and 4 with a ratio of roughly 2 1 implying that the more qsvs contribute to q2 than to q4 events this explains the observation in fig 16 that the qsvs mainly produce reynolds stress associated with q2 event it should be emphasized that the above findings regarding the spatial distributions of characteristic coherent vortices can only be possible with the developed vortex identification and classification scheme 6 concluding remarks the current study investigates coherent vortical structures within a turbulent air flow over progressive surface water waves the flow fields are from dns performed by druzhinin et al 2019 to look into the impact of parasitic capillary ripples on the vortical structures three different waveforms are considered gravity wave without capillary ripples capillary gravity wave with increased amplitude leeward side parasitic ripples and capillary gravity wave with uniform parasitic ripples a formal scheme is implemented to identify and classify the coherent vortical structures of the turbulent flow field four types of criteria derived from local analysis of velocity gradient tensor chong et al 1990 hunt et al 1988 jeong and hussain 1995 zhou et al 1999 are implemented to define the swirling strength of vortex core they all reveal resembling field distributions of swirling criteria indicating comparability of the criteria systematic classification of the coherent vortices is then proceeded by differentiating among qsv fhv and rhv according to the geometric characteristics of the topological skeletons within the identified vortex cores with the developed scheme identification and classification of characteristic coherent vortices can be done consistently and unbiasedly presenting a more objective approach to quantify the spatial distribution and population partition of the characteristic vortices in all three turbulent flows above different gravity or capillary gravity waveforms the distributions of characteristic vortices exhibit a strong dependence on the wave phase most fhvs cluster around the region above the lower windward face and wave trough and most rhvs concentrate above the lower leeward face and the wave trough the combined effect of vortex turning from the spanwise turbulent component to the streamwise vortex and the vortex stretching of the streamwise vortex results in the intensified formation of both rhvs and fhvs in this region the qsvs are observed above the entire wavy surface the distribution initiates near the wave trough extends downstream along the windward face lifts up above the wave crest and terminates above next leeward face such a distribution pattern of qsvs is attributed to strong vortex stretching of streamwise vortices in the same region regardless of the presence of parasitic capillary ripples qsv is the dominant structure and the population of rhv is slightly greater than fhv notwithstanding that horseshoe vortices are much fewer than qsv they dominate the contributions to reynolds stress due to their geometric features and swirling strength we further find that more qsvs bend toward the spanwise direction at the downstream end type 1 and type 2 defined in fig 17 hence generate more q2 motions than q4 motions these results are consistent with the findings by yang and shen 2009 2010 2017 though we find more fhvs in our simulated flows another focus of the present study is the impact of parasitic capillary ripples on mitigating the formation of coherent vortices in the turbulent air flow undulated by surface waves the analysis results reveal that the presence of capillary ripples on the windward surface will mitigate the occurrence of characteristic coherent vortices in particular the qsvs in contrast the presence of capillary ripples on the leeward surface presents a minor effect on the population of coherent vortices the major formation of coherent vortices occurs along the windward face results in such a difference in the mitigation effect by the capillary ripples credit authorship contribution statement po chen chen methodology software formal analysis investigation visualization writing original draft wu ting tsai conceptualization methodology investigation validation writing review editing supervision project administration funding acquisition oleg druzhinin software data curation validation yuliya troitskaya validation supervision project administration funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work is supported by the russian taiwanesejoint research project through the taiwan ministry of science and technology most 105 2923 m 002 006 my3 and the russian foundation for basic research rfbr no 16 55 52022 w t tsai and p c chen are also supported by the taiwan most 107 2611 m 002 014 my3 and by the taiwan higher education sprout project of the ministry of education ntu 108l880205 yu troitskaya and o druzhinin are additionally supported by the russian rfbr grant nos 20 05 00322 19 05 00249 18 05 60299 and by the ministry of education and science of the russian federation task nos 0035 2019 0007 0030 2019 0020 
23966,this study is concerned with the characteristics of coherent vortices within the turbulent air flow undulated by gravity and capillary gravity water waves the flow fields from the direct numerical simulations are analyzed a formal scheme is developed to detect and classify the vortical structures the scheme uses local analysis of the velocity gradient tensor to define the vortex swirling core and adopts the topological geometry of the swirling core to classify the vortical structures three types of vortical structures are identified including quasi streamwise vortex reversed and forward head pointing upstream and downstream respectively horseshoe vortices quasi streamwise vortices are the dominant structure in the flow their distribution initiates near the wave trough extends downstream along the windward face lifts up and terminates above the wave crest more reversed horseshoe vortices are observed than the forward horseshoe vortices both cluster around the region above wave trough reversed and forward horseshoe vortices however contribute the most to the production of reynolds stress associated with sweep and ejection motions respectively the quasi streamwise vortices contribute more to producing reynolds stress associated with ejection event indicating that the elongated vortices bend inward at the downstream end and can be considered as degenerate forward horseshoe vortices the intensified distributions of horseshoe vortices near the wave trough are attributed to the combined effect of vortex turning from the spanwise turbulent component to the streamwise vortex and the vortex stretching of the streamwise vortex the strong stretching of streamwise vortex above the windward face contributes to the continuous development of quasi streamwise vortices accordingly the presence of capillary ripples on the windward face mitigates effectively the occurrence of coherent vortices in particular the quasi streamwise vortices in contrast the presence of capillary ripples on the leeward surface presents a minor effect on the mitigation of coherent vortices keywords coherent vortical structure turbulent air flow capillary gravity wave direct numerical simulation 1 introduction the flows in close proximity to the ocean atmosphere interface control the exchanges between the atmosphere and the ocean the scales of these flows including wave motions and turbulence are much smaller than that of the ocean and atmosphere the processes of turbulent flow mixing and exchange of momentum and heat within this interfacial layer however can profoundly affect the large scale oceanic and atmospheric flows in the atmospheric boundary layer above the wavy surface complex turbulent processes within the surface layer are undulated by surface waves understanding of the underlying physics remains to be a challenge due to the difficulty of conducting field observations over the open ocean in the last two decades direct numerical simulation dns has been successfully applied to study the turbulent flow over progressive surface gravity waves these include the pioneering attempt by sullivan et al 2000 and the subsequent efforts by yang and shen 2009 2010 2017 and druzhinin et al 2012 the more recent simulation conducted by the present authors druzhinin et al 2019 considered the surface capillary gravity wave and studied the effect of the parasitic capillary ripples on the turbulent air flow undulated by the carrier gravity wave among the various flow properties one distinct feature observed in the turbulent flow above surface waves is that the distribution pattern of coherent vortical structures significantly differ from that in turbulent wall layer and the distribution exhibits a strong dependence on the wave phase yang and shen 2009 2010 druzhinin et al 2019 coherent vortices in turbulent flow play crucial roles in the production of new turbulence in the transport of momentum across the mean velocity gradient and in the growth of the boundary layer through entrainment robinson 1991 various vortex identification schemes have been developed to extract coherent vortical structures in turbulent flow field produced by high resolution numerical simulations e g hunt et al 1988 chong et al 1990 jeong and hussain 1995 zhou et al 1999 the relationship and difference among these schemes have been tested in various flow fields e g dubief and delcayre 2000 chakraborty et al 2005 alfonsi and primavera 2008 pierce et al 2013 in the turbulent boundary layer next to a flat wall coherent vortical structures are dominated by quasi streamwise vortices robinson 1991 jeong et al 1997 for turbulent air flow above surface water waves quasi streamwise vortices and both forward and reversed horseshoe vortices can be observed and each type of vortex exhibits its own spatial distribution pattern yang and shen 2009 2010 druzhinin et al 2019 classifying characteristic vortices is therefore an indispensable step for conducting a quantitative analysis of various physical processes attributed to them in this study we reappraise the simulation results of turbulent air flow above gravity and capillary gravity water waves of druzhinin et al 2019 with a focus on the characteristics of coherent vortices the objective of the study therefore is two fold first a vortex identification scheme is developed for consistent extraction and classification of various types of coherent vortical structures in the turbulent flow such a scheme enables quantifying the populations of various coherent vortices and revealing their spatial distributions second the developed scheme is applied to analyze the turbulent flow above gravity and capillary gravity waves the emphasis is on understanding the effect of parasitic capillary ripples on the characteristics of identified coherent vortices the paper is organized as follows in section 2 the dnss of druzhinin et al 2019 are summarized four commonly used vortex detection criteria are briefly reviewed in section 3 the feasibility of applying these criteria to the turbulent flow undulated by the surface wave is discussed followed by statistical analyses of the extraction criterion in section 4 geometry based schemes to extract and classify quasi streamwise and horseshoe vortices from the field of detection criterion are presented utilizing the developed vortex classification schemes quantitative features of coherent vortices including the population partitions and spatial distributions of quasi streamwise reversed horseshoe and forward horseshoe vortices the correlations between the coherent vortices and the production of reynolds stress are analyzed in section 5 the impacts of parasitic capillary ripples are revealed from the analysis results 2 numerical simulation of the flow field we consider turbulent air flows above progressive gravity and gravity capillary waves the flow fields are obtained from dnss of three dimensional turbulent couette air flow over a progressive wavy water surface details of the simulations including the numerical model the computation setups and the simulation results were reported in druzhinin et al 2019 and are summarized as follows the computation is performed in a reference frame moving with the phase velocity of the progressive wave c as shown in fig 1 the lower boundary representing the wavy surface therefore is stationary the coordinates x y and z or x 1 x 2 and x 3 are in the streamwise spanwise and vertical directions respectively with the corresponding velocities u v and w or u 1 u 2 and u 3 hence the x direction is regarded as the downstream direction both the surface wave and the air flow are assumed to be periodic in the streamwise and spanwise directions as indicated in fig 1 the windward face is the interval from a wave trough p 1 to its adjacent downstream wave crest p 2 the leeward face is the interval from a wave crest p 2 to its adjacent downstream wave trough p 3 a conformal mapping is employed to transform the physical domain in the cartesian coordinates x y z to the computational domain in the curvilinear coordinates ξ y η 1 x ξ n 1 a n exp k n η sin k n ξ φ n 2 z η n 1 a n exp k n η cos k n ξ φ n where k 1 k 2 π λ is the wavenumber of the carrier gravity wave with amplitude a 1 a and phase φ 1 0 k n n k a n and φ n n 2 are wavenumbers amplitudes and phases of the harmonic components of the capillary ripples the conformal mapping is defined in the way such that the lower wavy surface boundary z z s is mapped to η 0 and the upper boundary is mapped to η 1 at the lower wavy boundary z z s x the velocities are prescribed in the form 3 u ξ y 0 c n 1 k n a n cos k n x ξ 0 φ n c 4 v ξ y 0 0 5 w ξ y 0 u ξ y 0 z ξ z η η 0 in eq 3 the amplitudes and phases of capillary ripples k n a n and φ n n 2 are prescribed so as to simulate the parasitic capillaries observed in fully nonlinear computations of gravity capillary waves by hung and tsai 2009 and tsai and hung 2010 at the upper boundary plane z l z a bulk velocity u 0 is prescribed as noted in druzhinin et al 2019 the present simulations which are similar to the earlier computations by sullivan et al 2000 yang and shen 2009 2010 2017 and druzhinin et al 2012 are posed by considering air flow above a wavy boundary with prescribed velocities of surface waves the model thus neglects the coupling between the air flow and the surface waves and also the possible nonlinearities of boundary conditions associated with the wave motions yang and shen 2009 assessed the validity of such an idealized model by performing both uncoupled computation air flow above prescribed stokes wave and air water coupled simulations air flow above a nonbreaking water surface wave evolving under the impact of the air flow the results show that the coupling does not significantly alter the properties of the air flow as compared to the uncoupled simulation this conclusion justifies the simplification of using prescribed wavy boundary for the air flow simulations both in the present and previous studies systematic variations of the ripple amplitude and phase velocity denoted by ap1 to ap10 in druzhinin et al 2019 allow for studying their effects on the air flow topological structure and statistics in these cases the surface elevations can be distinguished by two characteristic distributions of capillary ripples with respect to the carrier wave crest ripples can be distributed either uniformly over the entire surface or predominantly on the leeward side near the crest accordingly three representative two dimensional surface waves considered in druzhinin et al 2019 are analyzed in the present study as shown in fig 2 including gravity wave without capillary ripples fig 2a referred to as ap2 gravity capillary wave with maximum amplitude ripples occur near the crest and decay along the leeward side surface of the carrier wave fig 2b referred to as ap6 and gravity capillary wave with uniform capillary ripples over the entire surface of carrier wave fig 2c referred to as ap10 note that the ripple amplitude in the case ap10 is half of the maximum amplitude in the case ap6 but remains constant throughout the entire carrier wave surface the ripple amplitude in the case ap6 is maximum in the crest of the carrier wave decreases along the leeward surface and becomes nearly vanished on the windward surface on the leeward face the ripple amplitudes of ap6 case are higher than those of ap10 case on the windward face however the ripple amplitudes of ap6 case are smaller than those of ap10 case the two different distribution patterns of capillary ripples are chosen so as to study the dependence of the ripple effects along the surface of the carrier wave in all three cases the wavelength of carrier wave λ 5 cm and steepness a k 2 π a λ 0 2 the wave age c u 3 where u is the friction velocity and the reynolds number r e u 0 λ ν 10 000 where ν is the kinematic viscosity of air these are equivalent to the slow wave case considered in yang and shen 2009 2010 2017 the length width and height of the flow domain are 6 λ 4 λ and λ respectively and are discretized by 360 240 and 180 grids when normalized by the wall unit ν u the horizontal grid size δ ξ δ y 6 and the vertical grid size varies from δ η 0 3 near the upper and lower boundaries to δ η 3 in the middle of the computational domain since the flow is undulated by the wavy boundary associated with the surface water waves a property quantity of the instantaneous flow field f ξ y η t can be decomposed into f ξ y η t f η t f ξ y η t f ξ η t e g sullivan et al 2000 tsai et al 2013 yang and shen 2017 druzhinin et al 2019 f η t f ξ y η t is the average of f over the horizontal ξ y plane f ξ η t f y ξ η t f η t is the wave correlated component where f y ξ η t is the phase average of f over spanwise y f ξ y η t is the fluctuation component in the latter analyses we will primarily focus on the property variable excluding the wave correlated component which defined as f ˇ ξ y η t f η t f ξ y η t f ξ y η t f ξ η t it has been demonstrated from experimental measurements troitskaya et al 2011 2014 and numerical simulations yang and shen 2010 druzhinin et al 2012 2019 that the well pronounced separation zones in the vicinity of the wave crests which are visible in the instantaneous flow field are smoothed out if the phase average f y is done by taking an additional ensemble average over different time instances consequently as will be explained in section 3 2 comparing figs 3 and 4 the spanwise vortices attributed to flow separation from the crests of capillary ripples cannot be effectively eliminated in the instantaneous velocity field u ˇ i ξ y η t despite the flow field has reached a statistically steady state as such to focus on analyzing the coherent vortices associated with turbulent flow the averages are computed without taking the temporal ensemble in the present study 3 coherent vortical structures in the flow field 3 1 extraction of coherent vortices various methods for identifying coherent vortical structures within a flow field have been developed primarily for the turbulent wall layer they can be classified into mathematical criteria based on the local analysis of the velocity gradient tensor e g chong et al 1990 hunt et al 1988 zhou et al 1999 and on the hessian of the pressure jeong and hussain 1995 the local geometry of flow field near a critical point such as a vortex can be depicted by the characteristic equation of the velocity gradient tensor rate of deformation tensor a i j u i x j chong et al 1990 6 λ 3 p λ 2 q λ r 0 where λ is the eigenvalue p tr a i j q 1 2 tr a i j 2 tr a i j 2 and r det a i j are the three invariants in the flow of incompressible fluid p 0 and q can be expressed as 7 q 1 2 ω i j 2 s i j 2 where ω i j 1 2 u i x j u j x i is the rotational rate tensor s i j 1 2 u i x j u j x i is the strain rate tensor mathematical criterion based on local analysis of the velocity gradient tensor can then be defined to educe the vortical structures the three commonly used criteria are hunt et al 1988 defined an eddy zone as a region of large vorticity magnitude in comparison with the strain rate i e q 0 with a local pressure minimum jeong and hussain 1995 however showed that the additional low pressure condition can be neglected chong et al 1990 defined a vortex core as the region where a i j has conjugate complex eigenvalues i e the discriminant δ of the characteristic eq 6 is positive in incompressible flow the condition becomes 8 δ 1 2 r 2 1 3 q 3 0 the conjugate complex eigenvalues imply that the local flow pattern reveals a spiral or center phase portrait this flow pattern is consistent with the vortex definition proposed by robinson 1991 note that δ 0 when q 0 the inverse however is not always true the q criterion therefore is more restrictive than the δ criterion chakraborty et al 2005 similar to the δ criterion zhou et al 1999 defined the vortical structure as the region with conjugate complex eigenvalues λ c r i λ c i of the velocity gradient tensor the imaginary part of the eigenvalue λ c i represents the local strength rate of the vortex thus λ c i 0 represents the region where vortex occurs it has been observed that a vortical structure in a turbulent flow is always accompanied by a local pressure minimum however unsteady straining can create a pressure minimum in a flow without involving a swirling motion on the other hand the viscous effect can eliminate the pressure minimum with vortical motion to avoid the ambiguity jeong and hussain 1995 considered the symmetric part of the gradient of the navier stokes equation 9 d s i j d t ν s i j x k x k b i j 1 ρ p x i x j where the tensor b i j ω i k ω k j s i k s k j the existence of a local pressure minimum requires two positive eigenvalues of the hessian of pressure p x i x j by neglecting the first two terms on the left hand side of eq 9 which are associated with the unsteady and the viscous effects respectively b i j determines the existence of a local pressure minimum due to a vortical motion since b i j is symmetric all its eigenvalues are real and can be ordered as λ 1 λ 2 λ 3 the existence of a local pressure minimum i e the presence of a vortex core in the flow therefore requires the intermediate eigenvalue of b i j to be negative i e λ 2 0 3 2 preliminary observations of vortical structures with the defined detection criteria q δ λ c i and λ 2 visualization of coherent vortical structures can be achieved by plotting the isosurface of some non zero threshold value of the criterion the choice of the criteria and its threshold value however introduces some arbitrariness into vortex core identification chakraborty et al 2005 examined this issue and proposed the inter relationships of threshold values among the four criteria as 10 λ c i t h q t h 1 2 27 δ t h 1 6 λ 2 t h 1 2 where the subscript th represents the threshold the equivalent thresholds were applied to various canonical turbulent flows including forced isotropic turbulence chakraborty et al 2005 wake flow behind a sphere and channel flow chakraborty et al 2006 the results reveal remarkably similar vortical structures using the equivalent thresholds note that the equivalent thresholds of eq 10 are non optimal and can be modified for different flow cases to check how the four commonly used criteria and the equivalent thresholds perform in our simulated flows instantaneous distributions of the criterion isosurfaces for the three cases of air flows above surface waves without ripples case ap2 in the left column with large amplitude leeward side ripples case ap6 in the center column and with uniform ripples case ap10 in the right column are shown in fig 3 the threshold values of the detection criteria are q 5 first row δ 4 63 second row λ 2 5 third row and λ c i 2 5 fourth row the orange blue color of the isosurfaces represents positive negative streamwise vorticity the four methods result in similar distributions of extracted vortical structures indicating the feasibility of the equivalent thresholds nevertheless it is observed that the δ criterion is slightly nuanced revealing thicker structures and more fluctuating than the others this observation in the turbulent air flow over surface waves is similar to that observed in the turbulent channel flow alfonsi and primavera 2008 as a result with no particular preference we choose the λ c i 2 criterion to extract the coherent vortical structures in the present study comparison among the flows above three different wavy surfaces reveals two distinct features of the coherent vortex distributions first spanwise vortical structures attributed to ripples are profound in ap6 case and visible in ap10 case increasing the difficulty of observing vortical structures above them as seen in fig 3 these spanwise vortical structures can be largely eliminated by subtracting wave correlated velocity components from the velocity field while the upper structures remain intact as shown in fig 4 for this reason in the following analyses wave correlated velocity components are subtracted from all instantaneous flow fields second it is found that various types of vortical structures co exist and exhibit complex variabilities in geometry reflecting the difficulty in revealing their correlations with the phase of carrier wave and the presence of parasitic ripples this calls for a formal scheme to classify the vortical structures and to quantify their distributions since the vortical structures are visualized by plotting the isosurfaces of the λ c i 2 criterion their quantities and shapes depend on the threshold value chosen as depicted in fig 5 where the isosurfaces of λ c i 2 1 5 and 10 are plotted the quantity of detected vortices gradually increases when the threshold value is incrementally decreased adjustment of λ c i 2 threshold value therefore allows for clearer observations of vortex shape in the flow field when the threshold value is chosen too low such as the cases plotted with λ c i 2 1 in fig 5a d and g the flow fields of the three cases are all populated with both strong and very weak vortices making it impossible to observe independent structures if the threshold value is chosen appropriately such as λ c i 2 5 in fig 5b e and h the individual vortical structures can be observed manifestly in general three types of characteristic vortical structures in proximity to the wavy surface can be found in all three cases forward horseshoe vortex referred to as fhv hereafter with head points downstream labeled by a in the close up view of fig 5b reversed horseshoe vortex referred to as rhv hereafter with head points upstream labeled by b and elongated quasi streamwise vortices referred to as qsv hereafter labeled by c and d the ones indicated are dominated by negative and positive streamwise vorticity respectively if the threshold value is chosen too high only very strong vortical structures are revealed some vortical structures become separated and vanished as shown in fig 5c f and i for instance when the threshold value is increased from λ c i 2 5 to λ c i 2 10 accordingly the threshold value λ c i 2 5 is chosen for visualizing and identifying vortical structures in the present turbulent flow fields the impact of the criterion threshold value on the analyses based on the detected coherent vortices will be discussed when encountered 3 3 vortex statistics and characterization before investigating quantitative properties of the characteristic vortical structures such as their population partitions and spatial distribution patterns we first determine the preferred height and orientation tendency for the occurrence of coherent vortices by examining some statistical profiles associated with λ c i fig 6 depicts vertical variations of the mean λ c i 2 η λ c i 2 ξ y computed from u i ξ y η the total velocity field and from u ˇ i ξ y η the velocity field without the wave correlated component for the three air flows ap2 ap6 and ap10 where ξ y denotes averaging over the ξ y plane the major difference between the two λ c i 2 profiles computed from u i and u ˇ i respectively occurs in the proximity of the wavy boundary η 10 the difference is particularly pronounced for the cases of capillary gravity waves ap6 and ap10 reflecting that the parasitic capillary ripples induce stronger spanwise vortices in the air flow than the carrier gravity wave does as revealed by fig 3 filtering out the wave correlated component from the total velocity field however effectively excludes these non turbulent wave correlated spanwise vortices immediately above the wavy surface comparing figs 3 and 4 consequently λ c i 2 of the velocity field u ˇ i is reduced for η 5 reflecting that the viscous sublayer contains few coherent turbulent vortices the λ c i 2 profiles of the two velocity fields u i and u ˇ i coincide for η 10 indicating the coherent vortices attributed to wave correlated velocity are rapidly attenuated away from the wavy boundary this however does not imply that the undulation motion caused by the carrier gravity wavy surface has no impact on the formation of coherent vortices the peaks of λ c i 2 are located at η 22 20 7 and 21 8 with the values of 0 89 0 9 and 0 9 respectively for the cases ap2 ap6 and ap10 indicating that the prominence of the coherent vortices occurs in the higher buffer region it also suggests that the presence of parasitic capillary ripples might have a minor effect on mitigating the development of coherent vortices for η 30 the decreasing λ c i 2 implies that the number of vortical structures diminishes outside the buffer region the small but finite values of λ c i 2 at higher η indicate the presence of outer scale vortices which will not be considered here variations of the vorticity variances ω i 2 η computed from the total velocity field u i ξ y η and from the velocity field without the wave correlated component u ˇ i ξ y η are shown in fig 7 the distributions with and without the wave correlated components are visually indistinguishable except for the spanwise vorticity ω y 2 in proximity to the wavy surface η 10 the difference is mainly attributed to the boundary velocities of the surface waves which induce spanwise vorticity immediately next to the surface we are primarily interested in the intensive coherent vortices within the buffer region where both the criterion λ c i 2 fig 6 and the vorticity variances reach the local maximum the maximum streamwise and spanwise vorticity intensities at the wavy boundary are attributed to the opposite sign vorticities present underneath the vortices and caused by the no slip boundary condition at the wavy surface the strong spanwise vorticity variance at the wavy boundary is also caused by the strong mean shear of the air flow these strong vorticities are not associated with the coherent vortical structures of interest in this study to reveal the dominant orientation of the vortical structures vertical distributions of normalized cross correlation coefficient r i η between λ c i 2 and each component of the vorticity ω i 11 r i η λ c i 2 ω i ξ y λ c i 2 2 ξ y 1 2 ω i 2 ξ y 1 2 are computed and shown in fig 8 above the viscous sublayer η 10 the r i profiles computed from the velocity fields with and without the wave correlated component are alike for the three flows considered indicating that the wave correlated velocity component has an insignificant influence on the vortical structures outside the viscous sublayer approaching the wavy boundary the values of r i computed from the total velocity field become higher than that computed from the wave excluded flow field this confirms again that the strong vorticities next to the wavy boundary are not associated with coherent vortices within the buffer region 10 η 30 the value of r 1 is larger than those of r 2 and r 3 indicating that most vortical structures are aligned in the streamwise direction in the outer region η 100 the three r i approach similar values the vortices are isotropic and the structures have no preferred direction statistics associated with the vortex core detection criterion λ c i 2 reveal that the coherent turbulent vortices are formed outside the viscous sublayer most vortices with large swirling strength are located in the buffer region η 30 and are aligned in the quasi streamwise direction accordingly all analyses henceforth are conducted within the region of 0 η 170 which is equivalent to half of the flow domain in the vertical direction as shown in fig 5 various types of characteristic coherent vortices including qsv fhv and rhv can arise in turbulent air flow above the wavy surface previous studies yang and shen 2009 2010 2017 druzhinin et al 2019 further reveal that the distributions of these characteristic vortices exhibit spatial variability and population partition systematic investigation of these issues requires a consistent scheme to extract and classify the characteristic vortices 4 extraction and classification of characteristic coherent vortices given an instantaneous three dimensional spatial distribution of λ c i 2 coherent vortical structures are identified and classified into qsv fhv and rhv by two major steps first isolated spatial regions with λ c i 2 higher than a given threshold are identified as vortical structures as revealed by the isosurfaces in figs 3 5 second the identified vortices are then classified into the three types of characteristic vortical structures each with a different extraction procedure during this process trivial structures are discarded the variation between each procedure is based on the geometric properties of the characteristic vortical structure to classify an independent vortical structure we adopt the concept of the topological skeleton the skeleton of an identified vortical structure is defined by connecting the grid points along the minimum increment in λ c i 2 of the neighboring grids the definition of neighboring grids depends on the type of vortical structures to be classified details of the classification schemes are described in the following two sections 4 1 extraction procedure of quasi streamwise vortex fig 9 illustrates the process of searching for the skeleton of a qsv the search starts from the upstream end of each identified vortical structure by locating the grid point with a local maximum of λ c i 2 on such y η plane marked by a black cross in fig 9a once the starting grid point ξ i y j η k is found the next grid point of the skeleton is located by searching for the local λ c i maximum among the adjacent grid points ξ i 1 y j η k ξ i 1 y j 1 η k and ξ i 1 y j 1 η k where η k represents all η layers within the identified vortical structures marked by red diamonds in fig 9b in our computations the streamwise and spanwise grid spacings are nearly identical the horizontal yawing angle of the adjacent skeleton grid points therefore is within 45 to the x axis this detection process is repeated until reaching the downstream end of the structure consequently the line formed by the series of consecutive grid points marked by black dots in fig 9c all with the same sense of streamwise vorticity is defined as the skeleton of a qsv it is obvious that the streamwise length of a qsv can range from as short as two grid size to some finite extent fig 10 depicts the probability density and its corresponding cumulative probability distributions of the extracted qsv length for the three air flows considered using criterion λ c i 2 5 despite the possible difference in the vortex population three flows exhibit similar probability distributions following jeong et al 1997 an additional length threshold of 150 wall units is employed this is equivalent to considering the longest 2 elongated vortices to highlight the elongatedness of qsv 4 2 extraction procedure of horseshoe vortex similar to the above described procedure to identify qsv we also adopt the concept of the topological skeleton to extract rhv and fhv rhv and fhv are only different in their orientations therefore we will describe the procedure to extract rhv the procedure for fhv is identical but is conducted in the reversed direction fig 11 illustrates the procedure to find the skeleton of an rhv the characteristics of vorticity distribution along a rhv are that its streamwise elongated left right leg is dominated by positive negative ω x in the upstream ends these two legs bend inward and connect to form a spanwise head dominated by positive ω y hence there exists an upstream head where the two legs with positive and negative ω x intersect to find this upstream head the search starts from the upstream end of each identified vortical structure by locating the grid point with a local maximum of λ c i 2 among the nearby grid points where ω x ξ i y j η k 0 and ω x ξ i y j 1 η k 0 marked by a black cross in fig 11a once the starting grid point ξ i y j η k is located the skeletons of the two legs are tracked as follows since the left leg must extend toward the first quadrant on the ξ y plane the next grid point is located by searching for the local λ c i 2 maximum with positive ω x among the adjacent grid points ξ i 1 y j η k ξ i y j 1 η k and ξ i 1 y j 1 η k where η k represents all η layers within the identified vortical structures marked by red diamonds in fig 11b 1 this detection process is repeated until reaching the downstream end of the structure fig 11b 2 the right leg of the rhv is detected in a similar way by starting the search from ξ i y j 1 η k and proceeding in the fourth quadrant with negative ω x consequently connecting the series of consecutive grid points marked by black dots in fig 11d forms the skeleton of an rhv 4 3 demonstration of the scheme to demonstrate the effectiveness of the vortex classification scheme fig 12 shows the identified qsv rhv and fhv within the flow field of close up view in fig 5b the results reveal that the scheme accurately identifies and classifies the characteristic vortical structures one fhv labeled by a one rhv labeled by b and two qsvs labeled by c and d are found some vortices which are defined as vortex cores by the λ c i 2 threshold but do not meet the prescribed conditions are not classified into characteristic vortical structures moreover the developed scheme also identifies characteristics vortices which are hard to distinguish from the ambient vortices with the developed scheme identification and classification of characteristic coherent vortices can be done consistently and unbiasedly presenting a more objective approach to quantify the population partition and spatial distribution of the characteristic vortices 5 results 5 1 population partitions of characteristic vortices the criterion λ c i 2 represents the swirling strength of the vortex core the choice of the threshold λ c i 2 therefore affects the number of coherent vortices extracted higher lower threshold λ c i 2 results in extracting fewer more but stronger weaker vortices to understand such a dependency variations of the total number of extracted coherent vortices with the threshold λ c i 2 are depicted in fig 13a d and g for the three air flows ap2 ap6 and ap10 also shown in the results are the population partition of the characteristic vortices qsv rhv and fhv in the three air flows the populations of the three types of the identified characteristic vortices all decrease exponentially when the threshold λ c i 2 increases from 2 to 9 qsv is the dominant structure for the entire range of λ c i 2 considered this can be seen by showing the population partitions of qsv rhv and fhv in fig 13b e and h for the three air flows respectively the population of rhv is higher than that of fhv this contrasts with turbulent flow next to a plane no slip boundary in which fhv is the dominant horseshoe or hairpin vortical structure observed adrian 2007 moin and kim 1985 robinson 1991 jiménez 2018 for the three cases considered the population partitions of qsv fhv and rhv are approximately 60 15 25 respectively fig 13b e and h the comparison suggests the minor effect of capillary ripples on mitigating the formation of coherent vortical structures in turbulent air flow above a wavy surface this is consistent with our findings from the statistical properties of the flow field from dns and from the prediction by the quasi linear theoretical model druzhinin et al 2019 as the threshold λ c i 2 increases both fhv and rhv population partitions of the ap2 case reach constant levels fig 13c in contrast the rhv partition increases but the fhv partition decreases when the threshold λ c i 2 increases fig 13f i suggesting that the presence of parasitic capillary is more effective in mitigating fhv than rhv note that a threshold value of λ c i 2 4 is needed to reveal the population difference between rhv and fhv accordingly λ c i 2 5 is used for detecting vortical structures in the following analyses 5 2 spatial distribution of characteristic coherent vortices the presence of the wavy boundary modulates the spatial distribution of coherent vortices within the turbulent boundary layer e g yang and shen 2009 2010 druzhinin et al 2012 such a modulation can be further complicated by the parasitic capillary ripples to reveal the spatial distributions of characteristic coherent vortices we compute the cumulative occurrence count that a spatial coordinate x z is occupied by one of the three types of characteristic coherent vortical structure as shown in fig 14a c and e the distributions are ensemble results computed from the air flows above six carrier waves at ten independent time instances the corresponding histogram variations in wave phase θ which are calculated by summing up the occurrence counts over z are shown in fig 14b d and f the three air flows ap2 ap6 and ap10 exhibit similar distribution patterns of characteristic coherent vortices only the distributions of ap10 are slightly scarcer than those of ap2 and ap6 consistent with the previous studies on turbulent air flow above the wavy surface the distributions of characteristic vortical structures fhv rhv and qsv exhibit strong dependence on the wave phase for all three cases the fhvs cluster around the region above wave trough 90 θ 270 the peak of the cumulative occurrence count histogram is located at the lower windward face θ 180 and the histogram skews toward downstream most of the rhvs also form within the region above the wave trough but in contrast to fhv the occurrence peak occurs near the lower leeward face θ 180 and the histogram skews toward upstream the qsvs are observed above the entire wavy surface the distribution initiates near the wave trough extends downstream along the windward face lifts up above the wave crest and terminates above next leeward face the peak of the occurrence count histogram is located near the upper leeward face the presence of capillary ripples presents subtle effects on the formation and distribution of coherent vortices for the ap6 case in which the ripples with larger amplitudes accumulate near the crest on the leeward surface the effect is minimal the impact becomes more significant in particular on the qsvs above the windward surface for the ap10 case in which the uniform ripples distribute over the entire surface of the carrier wave by examining the instantaneous flow fields yang and shen 2009 identified the evolution event of vortical structures transforming from rhv above the trough of the carrier wave to qsv along the windward surface the evolution process was explained by looking into the phased averaged transport equation for the streamwise vorticity ω x 12 d ϵ ω x y d t ϵ ω x u x y ϵ ω y y u y y ϵ ω y u y y ϵ ω z u z y 1 r e ϵ 2 ω x y where ϵ sgn ω x among the components on the right hand side of eq 12 the first and third terms denoted by s 11 and t 12 respectively which represent the vortex stretching of the streamwise vortices and the vortex turning from the turbulent spanwise vortices to the streamwise vortices are the dominant transport following the analysis of yang and shen 2009 the vortex transport components s 11 and t 12 for the three air flows ap2 ap6 and ap10 are shown in fig 15a d and g and fig 15b e and h respectively the distributions of the vortex stretching and turning components are similar to that observed in yang and shen 2009 the high intensity region of s 11 begins above the trough of the carrier wave extends through the windward surface and vanishes near the crest of the leeward surface in contrast the predominant region of t 12 initiates near the crest of the carrier wave expands and extends downstream above the leeward surface and ends near the trough note that the intensified region of the vortex turning process coincides with that of the vortex stretching process near the trough of the carrier wave comparing the distribution pattern of three types of coherent vortices depicted in fig 14 with the spatial distributions of streamwise vorticity transport components shown in fig 15 reveals the possible evolutions of coherent vortices along the carrier waveform as follows above the trough of the carrier wave the horseshoe vortices are generated by turning the two end parts of the spanwise turbulent vortices towards the streamwise direction forming the two legs of the horseshoe vortices the streamwise legs of horseshoe vortices are intensified by the strong vortex stretching resulting in the high accumulative occurrence of horseshoe vortices in this region both rhv and fhv can be formed the preference is determined by the flow field in favor of the formation the spatial distributions of fhv and rhv and their corresponding histogram variations in the wave phase depicted in fig 14 reveal that the peak distribution of rhv occurs in the slightly upstream region above the wave trough θ 180 whereas the fhvs accumulated in the slightly downstream region above the trough θ 180 such an offset in the peaks of fhv and rhv distributions can be explained by examining the distributions of the phase averaged velocity field u y w y shown in fig 15c f and i the velocity field exhibits a cat s eye pattern centered about the critical layer height and upwind of the wave trough as revealed in the previous simulations by sullivan et al 2000 yang and shen 2009 and druzhinin et al 2019 in the upstream side of the cat s eye the mean velocity field is reversed within the critical layer the shear flow is in favor of the formation of rhv in contrast in the downstream part of the cat s eye the shear flow is similar to that of wall layer which supports the formation of fhv and qsv mostly degenerate or incomplete fhv with elongated vortices bend inward at the downstream end will be discussed in the next sub section note that the peak region of vortex turning from ω y to ω x t 12 term in eq 12 occurs near the wave crest the corresponding vortex stretching of ω x s 11 term in eq 12 in this region however is minimal and cannot support the continuous development of the horseshoe vortices this also explains that despite the presence of large amplitude capillary ripples near the wave crest in the ap6 case its mitigation effect on the formation of coherent vortices is insignificant the strong vortex stretching of ω x above the windward surface supports the development of fhv and qsv and results in high populated distributions of these two types of vortices as shown in fig 14 the uniform distribution of finite amplitude ripples in the ap10 case causes reduction in the populations of fhv and qsv in this region in contrast in the ap6 case the ripples with diminishing amplitudes on the windward surface result in insignificant mitigation of coherent vortices 5 3 correlation between reynolds stress and coherent vortices it is well known that coherent vortices are responsible for producing reynolds stress in turbulent wall layer e g robinson 1991 wallace et al 1972 wallace 2016 willmarth and lu 1972 specifically fhv and rhv are responsible for ejection u 0 and w 0 referred to as q2 event and sweep u 0 and w 0 referred to as q4 event motions respectively in the turbulent wall layer in turbulent flow next to the wavy surface the process can be complicated by spatial variation of the coherent vortices e g yang and shen 2009 2010 2017 the relationship between the coherent vortices and the q2 and q4 events has previously been examined by yang and shen 2009 2010 using the conditional average method these vortices induced sweep and ejection events are also found to not only enhance the local turbulence momentum flux but also the local turbulence scalar fluxes resulting in their wave phase dependent spatial distribution yang and shen 2017 distributions of the spanwise averaged reynolds stress u w y and the corresponding components attributed to q2 and q4 events are depicted in fig 16a b and c for the three flows ap2 ap6 and ap10 respectively the most intense reynolds stress occurs in the region above the wave trough the peaks attributed to q2 and q4 events are located in the vicinity of the wave trough comparing the distributions of the cumulative occurrence count of coherent vortices in fig 14 and the contours of reynolds stress in fig 16 reveals the following the reynolds stresses associated with q4 event are mainly attributed to rhvs as both regions of the maximum occurrence count of the vortex and the most intense reynolds stress coincide and are located in the lower leeward face near the trough in contrast the predominant production of reynolds stress associated with q2 event is primarily contributed by both fhv and qsv this is deduced from the observations that the region of most intense reynolds stress attributed to q2 event is located in the lower windward face near the wave trough and the intense distribution of reynolds stress extends further downstream along the windward surface and lifts up above the wave crest these two features are similar to the distributions of cumulative occurrence count of fhv and qsv respectively further consideration of the above observations however leads to two subtle issues first both the vortex population fig 13 and the space occurrence count fig 14 reveal that the quantity of qsv is much greater than fhv however the most intense production of reynolds stress associated with q2 event which occurs in the lower windward face is contributed by fhv second the qsvs are found to mainly induce q2 events to clarify the first issue the distributions of the cumulated occurrence count of three characteristic coherent vortices in fig 14 are reappraised by weighting the occurrence count with its λ c i 2 as shown in fig 17 although the quantity of qsv is the highest among the three characteristic coherent vortices the λ c i 2 weighted occurrence count of qsv however profoundly reduces in comparison with fhv this is primarily attributed to the relatively weaker swirling strength of qsv than that of horseshoe vortex which consequently induces weaker q2 or q4 motion qsv possesses a geometric structure similar to that of the horseshoe vortex but with one dominant leg and one degraded leg thus can be classified into four types based on the orientation and geometry properties as depicted in fig 18 type 1 and 2 qsvs bend in at the downstream end and can be considered as a degenerate or incomplete fhv which induces q2 motion while type 3 and 4 qsvs bend in at the upstream end thus are geometrically similar to an rhv which produces q4 event the resemblant distribution patterns between the cumulative occurrence count of qsv and the reynolds stress associated with q2 event suggest that the observed qsvs may be dominated by type 1 and 2 structures to verify such a possibility and also to clarify the second issue the identified qsvs are further classified into four types as depicted in fig 18 distributions of the cumulative occurrence count of the four types of qsv are shown in fig 19a b and c respectively for the three flows simulated in all three flows the quantities of type 1 and 2 qsvs are all higher than that of type 3 and 4 with a ratio of roughly 2 1 implying that the more qsvs contribute to q2 than to q4 events this explains the observation in fig 16 that the qsvs mainly produce reynolds stress associated with q2 event it should be emphasized that the above findings regarding the spatial distributions of characteristic coherent vortices can only be possible with the developed vortex identification and classification scheme 6 concluding remarks the current study investigates coherent vortical structures within a turbulent air flow over progressive surface water waves the flow fields are from dns performed by druzhinin et al 2019 to look into the impact of parasitic capillary ripples on the vortical structures three different waveforms are considered gravity wave without capillary ripples capillary gravity wave with increased amplitude leeward side parasitic ripples and capillary gravity wave with uniform parasitic ripples a formal scheme is implemented to identify and classify the coherent vortical structures of the turbulent flow field four types of criteria derived from local analysis of velocity gradient tensor chong et al 1990 hunt et al 1988 jeong and hussain 1995 zhou et al 1999 are implemented to define the swirling strength of vortex core they all reveal resembling field distributions of swirling criteria indicating comparability of the criteria systematic classification of the coherent vortices is then proceeded by differentiating among qsv fhv and rhv according to the geometric characteristics of the topological skeletons within the identified vortex cores with the developed scheme identification and classification of characteristic coherent vortices can be done consistently and unbiasedly presenting a more objective approach to quantify the spatial distribution and population partition of the characteristic vortices in all three turbulent flows above different gravity or capillary gravity waveforms the distributions of characteristic vortices exhibit a strong dependence on the wave phase most fhvs cluster around the region above the lower windward face and wave trough and most rhvs concentrate above the lower leeward face and the wave trough the combined effect of vortex turning from the spanwise turbulent component to the streamwise vortex and the vortex stretching of the streamwise vortex results in the intensified formation of both rhvs and fhvs in this region the qsvs are observed above the entire wavy surface the distribution initiates near the wave trough extends downstream along the windward face lifts up above the wave crest and terminates above next leeward face such a distribution pattern of qsvs is attributed to strong vortex stretching of streamwise vortices in the same region regardless of the presence of parasitic capillary ripples qsv is the dominant structure and the population of rhv is slightly greater than fhv notwithstanding that horseshoe vortices are much fewer than qsv they dominate the contributions to reynolds stress due to their geometric features and swirling strength we further find that more qsvs bend toward the spanwise direction at the downstream end type 1 and type 2 defined in fig 17 hence generate more q2 motions than q4 motions these results are consistent with the findings by yang and shen 2009 2010 2017 though we find more fhvs in our simulated flows another focus of the present study is the impact of parasitic capillary ripples on mitigating the formation of coherent vortices in the turbulent air flow undulated by surface waves the analysis results reveal that the presence of capillary ripples on the windward surface will mitigate the occurrence of characteristic coherent vortices in particular the qsvs in contrast the presence of capillary ripples on the leeward surface presents a minor effect on the population of coherent vortices the major formation of coherent vortices occurs along the windward face results in such a difference in the mitigation effect by the capillary ripples credit authorship contribution statement po chen chen methodology software formal analysis investigation visualization writing original draft wu ting tsai conceptualization methodology investigation validation writing review editing supervision project administration funding acquisition oleg druzhinin software data curation validation yuliya troitskaya validation supervision project administration funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work is supported by the russian taiwanesejoint research project through the taiwan ministry of science and technology most 105 2923 m 002 006 my3 and the russian foundation for basic research rfbr no 16 55 52022 w t tsai and p c chen are also supported by the taiwan most 107 2611 m 002 014 my3 and by the taiwan higher education sprout project of the ministry of education ntu 108l880205 yu troitskaya and o druzhinin are additionally supported by the russian rfbr grant nos 20 05 00322 19 05 00249 18 05 60299 and by the ministry of education and science of the russian federation task nos 0035 2019 0007 0030 2019 0020 
23967,the water masses exiting the labrador sea and in particular the dense water mass formed by convection i e labrador sea water lsw are important components of the atlantic meridional overturning circulation amoc several studies have questioned the connection of the lsw production to the amoc variability this is partly due to the limited understanding of how this locally formed water mass leaves the interior of the labrador sea in this study the pathways and the timescales of the water masses exiting the labrador sea via the boundary current are investigated by lagrangian particle tracking this method is applied to the output of a strongly eddying idealized model that is capable of representing the essential physical processes involved in the cycle of convection and restratification in the labrador sea the lagrangian trajectories reveal that prior to exiting the domain the water masses follow either a fast route within the boundary current or a slower route that involves boundary current interior exchanges the densest water masses exiting the labrador sea stem from this slow route where particles experience strong water mass transformation while in the interior in contrast the particles that follow the fast route experience water mass transformation in the boundary current at the western side of the domain only yielding a lighter product although both routes carry roughly the same transport we show that 60 of the overturning in density space is associated with the volume transport carried by particles that follow the slow route this study further highlights that the export of dense water masses which is governed by the eddy activity in the basin yields export timescales that are usually longer than a year this underlines the necessity of resolving the mesoscale features required to capture the interior boundary current exchange in order to correctly represent the export of the lsw keywords labrador sea water export convection labrador sea atlantic meridional overturning circulation lagrangian pathways 1 introduction the atlantic meridional overturning circulation amoc describes the conversion of lighter shallow atlantic water masses flowing northward into denser deep water masses flowing southward involving diabatic processes like deep convection in the marginal seas of the north atlantic the strength of the amoc is commonly estimated as the total northward transport in the upper 1000m or so of the water column and can be either viewed in depth space emphasizing the vertical transport wunsch and heimbach 2006 cunningham et al 2007 or in density space emphasizing the transformation of lighter to denser water masses e g xu et al 2016 li et al 2017 desbruyères et al 2019 lozier et al 2019 brüggemann and katsman 2019 climate model studies suggest a substantial weakening of the amoc over the 21st century collins et al 2013 weijer et al 2019 with the potential to affect the global climate therefore over the last decade there has been an increased effort to understand the drivers of amoc variability e g johnson et al 2019 lozier et al 2019 one of these potential drivers is the process of deep convection in the labrador sea resulting in the production of labrador sea water lsw one of the water masses that contribute to the lower limb of the amoc e g rhein et al 2017 while earlier modeling studies have suggested a close connection between the lsw production and amoc variability biastoch et al 2008 zhang 2010 yeager and danabasoglu 2014 up to date observations at the rapid 26 n smeed et al 2018 and osnap lozier et al 2019 arrays and recent numerical studies zou and lozier 2016 li and lozier 2018 georgiou et al 2019 have cast doubts on this suggesting a rather complex connection between the two moreover the recent study of lozier et al 2019 suggests that the variability of the overturning is dominated by the water mass transformation taking place in the eastern half of subpolar gyre rather than in the labrador sea the recent debate on the importance of the lsw for amoc variability is partly the result of limited understanding on how this water mass leaves the interior of the labrador sea in particular about its export routes and the associated timescales several studies showed that newly formed lsw is rapidly exported by spreading laterally and entraining in the deep western boundary current dwbc near the labrador coast e g talley and mccartney 1982 brandt et al 2007 feucher et al 2019 moreover a mid depth recirculation of the lsw within the subpolar gyre has been reported in a number of studies e g lavender et al 2000 pickart et al 2003 stramma et al 2004 bower et al 2009 holliday et al 2009 lozier et al 2013 last a slower export route has been suggested in the studies of straneo et al 2003 and palter et al 2008 in particular they identify the existence of a pathway which transports convected water from the interior towards the west coast of greenland these multiple export routes of lsw of which the relative importance is still unclear might result in a complex relation between the lsw formation and its export timescales and the amoc variability the recent highly idealized numerical study of a convectivemarginal sea by brüggemann and katsman 2019 clearly highlights the important role of the exchange of waters between the interior and the boundary current which in turn is governed by the eddy activity for the export pathways of convected water and the associated timescales their results indicated that the densest water masses are formed in the interior and are laterally steered towards the region of high eddy activity and then entrained in the boundary current thus following an indirect route to leave the marginal sea in addition they showed that a lighter product of convection within the boundary current itself is directly and rapidly exported via that boundary current the underlying idea of an eddy induced entrainment of lsw in the boundary current was pointed out by khatiwala and visbeck 2000 however they linked this entrainment to the summertime restratification process and the associated horizontal density gradients that is they assumed no spatial variations and by linking it to the restratification implied that this only occurs in summer in contrast both brüggemann and katsman 2019 and georgiou et al 2019 show that there is a preferred region for the re entrainment which coincides with the region where the eddy activity peaks however both studies conclude this based on an analysis of passive tracers which does not allow the investigation of the pathways and transformation of water masses which in the end determine the lsw export the direct and indirect export routes of the convected water recently identified in idealized models brüggemann and katsman 2019 georgiou et al 2019 are in line with the indications of such routes from observations e g palter et al 2008 bower et al 2009 however due to the limited number of observations the relative importance of a direct export route on the labrador side of the basin and an indirect route via the greenland coast is yet unclear in this study we analyze the origin and transformation of different water masses found within the boundary current at the exit of the labrador sea we use a lagrangian approach applied to the output from the idealized model used in georgiou et al 2019 which allows us to elucidate the complex structure of the flow bower et al 2019 from this we distinguish different pathways identify where water mass transformation occurs and assess what role the prominent eddy field plays for exporting these water masses this idealized model study provides helpful insights on the nature of the interior boundary current exchange and its role for the lsw export the results can guide the analyses of observations and more realistic model simulations thus improving our overall understanding in amoc the structure of this paper is as follows the model setup and the lagrangian approach are described in section 2 first the pathways that the water masses follow before exiting the labrador sea are analyzed in section 3 next we explore the importance of each pathway for the net overturning in depth and density space section 4 and the location where the water masses subduct section 5 in section 6 we focus on the lateral exchange between the boundary current and the interior by identifying the locations where this exchange occurs and how it affects the properties of the water masses exiting the labrador sea the associated export timescales are addressed in section 7 followed by a discussion and conclusions in section 8 2 numerical model and methods 2 1 model configuration and flow characteristics the numerical simulation analyzed in this study is carried out using a hydrostatic configuration of the mitgcm marshall et al 1997 the model configuration captures the key features of the circulation in the labrador sea like the annual cycle of the convection and restratification and the properties of the mesoscale eddy field this model and its results have been previously used in georgiou et al 2019 and we refer the reader to this study for a more detailed description of the model setup the model has a horizontal resolution of 3 75 km and 40 levels in the vertical with a resolution of 20 m in the upper layers up to 200 m at a maximum depth of 3000 m the model domain has two open boundaries each roughly 100 km wide one in the northeast and one in the southwest where a boundary current enters and exits the domain all other boundaries are closed fig 1 at the northeastern open boundary a warm boundary current is specified by a meridional temperature field t in y z and a westward flow u in y z in geostrophic balance with this prescribed temperature distribution a sinusoidal seasonally varying term is added to the inflow conditions to mimic the observed seasonal variability of the west greenland current δ u max 0 4 m s 1 with maximum and minimum in september and march respectively kulan and myers 2009 rykova et al 2015 note that total outflow transport is prescribed but the properties of the boundary current at the outflow are determined by the internal model dynamics following the topography this boundary current flows cyclonically around the basin fig 1a at the northwestern side a narrowing of the topography is present gray contours in fig 1a as observed near the west coast of greenland this steepening leads to an increased instability of the boundary current and mostly warm anticyclonic eddies are shed with similar characteristics as the irminger rings irs as shown in katsman et al 2004 gelderloos et al 2011 and georgiou et al 2019 at the surface a temporally and spatially varying surface heat flux is applied resulting in a net annual heat loss of 18 w m 2 over the entire model domain blue contours in fig 1b see georgiou et al 2019 for details a linear equation of state is used with temperature as the only active tracer note that the effects of salinity are not incorporated in the model although in reality the lateral fresh water flux carried by the irs e g de jong et al 2016 influences the properties of convection e g gelderloos et al 2012 in this study our focus is on the dynamics that control the interior boundary current exchange in the labrador sea and hence the effects of salinity are omitted in the model for simplicity as a result of the applied surface heat loss blue contours in fig 1b the model displays deep convection in the interior the winter mean mixed layer reaches a depth of 1700 m fig 1b as shown in georgiou et al 2019 the deepest mixed layers are located away from areas with strong eddy activity red contours in fig 1b albeit slightly closer to the maximum of buoyancy loss than observed in the regions of strong eddy activity the associated eddy heat transport from the boundary current towards the interior is stronger and the water column is too stratified to sustain deep convection in the model we do not consider the shelf and overflow waters or the effects of wind gelderloos et al 2011 and prescribe a transport at the inflow 19 7 sv that is weaker than estimates over the full depth 40 50 sv pickart et al 2002 fischer et al 2004 the maximum barotropic streamfunction is about 27 sv fig 1c due to some recirculation in the basin in this study we use the three dimensional velocity field from the last six years of the reference simulation i e model years 15 20 described in georgiou et al 2019 to track lagrangian particles 2 2 lagrangian particle tracking the offline lagrangian tool connectivity modeling system cms paris et al 2013 is used to investigate the possible pathways of the waters exiting the model domain and water mass transformation that occurs along these pathways to this end numerical particles are released at the outflow region in the south the only export route of the convected water mass out of the domain the particles are advected backward in time using a timestep of 1 h within the 2 day snapshots of the three dimensional velocity fields of the simulation described in the previous section the movement of the numerical particles is parameterized as described by paris et al 2013 a runge kutta 4th order stepping in time and a tricubic spatial interpolation are used to determine the location of the particles no additional horizontal diffusivity is applied to account for the increased vertical diffusion during the process of convection particles that are located within the mixed layer are moved randomly in the vertical within the mixed layer with a maximum velocity of w 10 cm s 1 van sebille et al 2013 particles are released at the outflow y 3 75 km red line in fig 2a every 2 days over a period of one year with a particle resolution of 1 km in the zonal direction and 50 m vertically doing so we track 217349 lagrangian particles over a period of 6 years since we are interested in distinguishing the pathways of the water masses in terms of volume transport a volume transport is assigned to each particle upon release and it is conserved along the trajectory van sebille et al 2018 this is determined by multiplying the meridional velocity by the area of the grid cell in which the particle is released döös 1995 ypma et al 2019 although the particles were released at the outflow and tracked backwards we will mostly refer to their trajectories forward in time 3 pathways and origin of the water masses exiting the labrador sea in this study we explore the origin of the waters found in the boundary current at the outflow of the labrador sea in particular we investigate the role of exchange water between the boundary current and the interior to this end we define a particle as being in the interior when it is offshore of the 18 sv contour line of the 5 year mean barotropic streamfunction ψ b black dashed line in figs 1 and 2a to filter out possible short and fast excursions of particles into the interior and back we also require that the particle stays offshore of this streamline for more than 20 days the results of the analyses presented in this study are not very sensitive to the exact choice made for distinguishing the boundary current from the interior the presented results are consistent for different choices of ψ b or using an isobath within the 6 year advection time 90 of the particles i e 195528 particles reach the eastern open boundary inflow since these particles travel from the inflow towards the outflow we will refer to them as wholeloop particles the 10 of the particles that remain in the basin during the 6 year simulation are referred to as interiorlong particles a particle density plot fig 2a highlights the paths that the wholeloop and interiorlong particles are prone to follow it is constructed by regridding the position of each particle at every timestep on an x y grid with a resolution of 3 75 km this particle density is calculated as described in ypma et al 2019 at each location in the new grid the transport assigned to each particle is divided by the total transport carried by the particles in the interior the particle density is enhanced at the northwestern side of the basin close to the topographic narrowing fig 2a this indicates that a significant number of particles enter the interior of the basin there suggesting a connection with the eddy activity found at this location fig 1b however such a possible connection is masked by the fact that the highest particle density occurs along the boundary current which suggests that the particles are found somewhere within the boundary current during their lifetime we therefore subdivide the wholeloop particles in two groups particles that cross the 18 sv contour line of ψ b into the interior at some location hereinafter interiorshort particles and particles that never cross the 18 sv contour line and thus never leave the boundary current hereinafter withinbc particles it appears that of all the wholeloop particles 60 falls into the interiorshort category and 40 in the withinbc category fig 3 the volume transport carried by the w i t h i n b c interiorshort and interiorlong particles amounts to 6 8 sv 8 4 sv and 2 0 sv respectively fig 3 note that at the eastern side of the domain x 800 km and y 1000 km the particle density is low 1 fig 2a this reflects the weak circulation in this part of the domain fig 1c this is a consequence of the closed southeastern boundary of the idealized model the bathymetry forces the boundary current to follow the northern and western side of the domain by construction the withinbc particles black line in fig 2b are always onshore of the 18 sv contour line of ψ b the interiorshort particles red line in fig 2b also travel from the inflow to the outflow but along their path they enter the interior purple star in fig 2b and re enter the boundary current yellow star in fig 2b before exiting the domain last the interiorlong particles recirculate in the interior of the basin for more than 6 years blue line in fig 2b most of the withinbc particles reside close to the lateral boundaries at both the inflow and the outflow black contours in fig 4 the particles that enter the interior and leave the domain within the simulated advection time interiorshort red contours in fig 4 originate farther offshore y 1020 1060 km than the withinbc particles y 1040 1080 km fig 4b since they are at the flank of the boundary current at the inflow fig 4b they can more easily leave the boundary current and enter the interior similarly when they re enter the boundary current they are found on its offshore flank fig 4a but deeper in the water column last the interiorlong particles are found in the deepest part of the boundary current blue contours in fig 4a apparently they represent the densest water masses exiting the domain 4 overturning in depth and density space the particles that represent the three pathways of water masses prior to exiting the labrador sea display a depth change fig 4 which is a reflection of overturning in depth space in the basin moreover using the same model setup it is shown from an eulerian perspective that the boundary current gets denser along its path through the labrador sea yielding a net overturning in density space georgiou et al 2019 in this section we analyze this overturning both in depth and density space from a lagrangian perspective and investigate the relative contribution of the different pathways to this net overturning 4 1 transport changes between the inflow and outflow in depth space since each of the particles represents a particular transport of water masses section 2 2 we can convert the depth changes of particles between inflow green bars and outflow orange bars to the associated volume transport fig 5 three vertical layers are defined to facilitate discussion 0 500 m 500 1500 m and 1500 3000 m black horizontal lines in fig 5a c at the inflow almost all transport carried by either the withinbc or the interiorshort particles is found shallower than 1500 m 6 8 sv and 8 2 sv respectively this view changes at the outflow of the domain the volume transport in the deepest layer 1500 3000 m increases by 1 3 sv for the withinbc and by 2 0 sv for the interiorshort particles in addition the presence of the interiorlong particles at the outflow becomes apparent in this depth layer as a volume transport of 1 8 sv 90 of the total transport these particles represent 4 2 transport changes between the inflow and outflow in density space similarly we can explore the water mass transformation that occurs between inflow and outflow from a lagrangian perspective since the density in the model is associated only with temperature variations section 2 1 we examine the temperature changes between inflow and outflow for each pathway at the inflow most of the withinbc particles carry warm water masses green bars in fig 6a a shift in transport of warmer to colder water masses between inflow and outflow reveals that water mass transformation occurs within the boundary current since the interiorshort particles originate farther offshore in the boundary current fig 4b they are characterized by lower temperatures at the inflow green bars in fig 6b also for this category the transport in colder layers increases towards the outflow indicating that the particles experience water mass transformation along their path last the interiorlong particles represent the coldest water masses at the outflow fig 6c to quantify the water mass transformation in density space the total volume transport at the inflow outflow is summarized in fig 6 for three water mass definitions surface waters t 3 5 c intermediate waters 3 2 t 3 5 c and deep waters t 3 2 c note that t 3 2 3 5 c is the temperature range corresponding to the convected water mass georgiou et al 2019 the transport change between inflow and outflow in temperature space through the 3 5 c isotherm derived from the particles amounts to 1 3 1 1 0 2 2 2 sv for withinbc fig 6a and to 3 6 2 2 2 1 0 3 3 4 sv for interiorshort fig 6b furthermore the transport of water masses below 3 5 c at the outflow is substantially higher for both the interiorshort and interiorlong particles 7 6 sv combined fig 6b c than for the withinbc 2 4 sv fig 6a 4 3 overturning from the eulerian and the lagrangian perspective based on figs 5 and 6 we can estimate the overturning in both depth and density space and compare this to the overturning calculated from the eulerian velocities the eulerian overturning in depth space is defined as the difference in time mean transport between the inflow and the outflow in model year 15 integrated over the same depth bins depth space or temperature bins density space next we calculate the lagrangian overturning for each pathway by taking the difference between the summed volume transport carried by all particles in a certain depth or density bin at the outflow and at the inflow this is done for all three particle categories since the interiorlong particles never reach the inflow the total mean lagrangian overturning estimate is based solely on the transports carried by the withinbc and interiorshort particles we do not expect the eulerian and lagrangian overturning estimates to match exactly as we lack information on the overturning associated with the interiorlong particles since we cannot follow them backwards in time towards the inflow however the overturning derived from the particles largely agrees with the overturning obtained from the time mean eulerian flow compare the purple and green lines in fig 7 which suggests that we can use the overturning split in pathways to get an impression of the importance of each route in depth space the maximum eulerian lagrangian overturning occurs at 1000 m depth and amounts to 3 8 4 1 sv fig 7b both withinbc and interiorshort particles contribute equally to the lagrangian overturning in depth space in addition the presence of the interiorlong particles at the outflow becomes apparent in depths greater than 1000 m in density space the overturning in both the eulerian and lagrangian view peaks at a temperature of 3 5 c and amounts to 3 4 and 5 4 sv respectively fig 7d when the contributions of the transport carried by each pathway to the net overturning in density space are considered it appears that 60 of the maximum overturning at t 3 5 c can be attributed to the interiorshort particles and 40 to the withinbc particles in contrast the secondary peak of 4 1 sv in the total lagrangian overturning at t 4 5 c is mainly due to the withinbc particles this confirms that the transformation of the withinbc particles results into relatively lighter water masses than the interiorshort particles notably at this temperature the eulerian overturning is negligible that is the eulerian transport of waters of this temperature at the inflow and outflow is the same while the lagrangian analysis reveals an increase in transport of this water mass this implies that an inflow of waters of this temperature exists which does not reach the outflow within six years and is thus not captured by the lagrangian backtracking calculation the temperature of this water mass corresponds to that of boundary current waters at 500 1000 m depth see fig 1b in georgiou et al 2019 we speculate that this water mass is also transported offshore from the boundary current to the interior but has a residence time longer than the six year duration of the lagrangian calculation 5 subduction as shown in fig 7 both the withinbc and the interiorshort particles experience water mass transformation here we identify the location where these water masses last change their properties by means of the local subduction rate following the analysis of brandt et al 2007 we define subduction as the process of a particle leaving the mixed layer it is calculated from the trajectories of the withinbc and interiorshort particles as the sum of all transport values assigned to the particles subducted within a certain grid box the subduction velocity fig 8 is calculated by dividing this subduction rate of each gridbox by its area the magnitude of the subduction velocity is similar to the subduction velocities reported by brandt et al 2007 with elevated values in the west the calculation of the subduction rate is performed separately for the withinbc fig 8a and interiorshort particles fig 8b the main difference between the two is the location of the peak values subduction of waters exiting the domain along the withinbc route mainly occurs in the western part of the labrador sea this is likely associated with convection that occurs within the boundary current due to the surface buoyancy forcing the total subduction of the withinbc particles amounts to 1 9 sv in contrast large subduction velocities of the particles following the interiorshort route are found in the west close to the edge of the boundary current the total subduction for the interiorshort amounts to 3 7 sv of which 76 occurs in the interior i e offshore of the 18 sv contour line of ψ b the remaining 24 subducts within the boundary current after re entering which indicates a pathway of transformed water masses within the boundary current brandt et al 2007 similar to the withinbc particles our study reveals that most of the interiorshort particles leave the mixed layer in the interior before they re entrain into the boundary current and exit the domain fig 8b in the following section we will show that the properties of the particles depend on the location where they subduct within the interior i e box 1 and box 2 in fig 8b 6 lateral exchange and water mass transformation to explore the lateral exchange between the boundary current and the interior and water mass transformation in the interior we next focus on the locations where the interiorshort particles enter and leave the interior of the domain we define the first last crossing of a particle as the location at which it crosses the 18 sv contour line of the barotropic streamfunction ψ b for the first last time after entering the domain purple and yellow stars in the example trajectory shown in fig 2b an example trajectory shows that this particle enters the basin at the eastern open boundary at a depth of 100 m fig 9c its temperature at the inflow green square in fig 9a is t inflow 4 7 c it follows the boundary current until it crosses into the interior purple star and vertical line in fig 9a and b respectively while in the interior the particle recirculates and shows a large drop in temperature fig 9b when it is in the mixed layer gray shaded area in fig 9b c there it reaches a temperature corresponding to that of the convected water t 3 2 c fig 9b once the particle is subducted fig 9c it stays below the mixed layer in the subsequent winters and no further temperature change occurs fig 9b the largest change in depth of the particle blue line in fig 9c takes place between locations 5 and 6 when the particle leaves the mixed layer without any water mass transformation this means that the particle moves adiabatically along an isopycnal isotherm to deeper layers for most of its advection time the particle s path is steered by eddies that are present in the interior fig 9a after being in the interior for more than 4 years the particle re enters the boundary current yellow star and vertical line in fig 9a b and it does so along this 3 2 c isotherm after its re entry the particle slightly rises in the water column fig 9c because the isotherms rise as the boundary current loses heat in the downstream direction straneo 2006 georgiou et al 2019 brüggemann and katsman 2019 although it takes almost 6 years for this particle to travel from inflow to outflow only nine months pass between the moment it re enters the boundary current until it exits the labrador sea next we consider the lateral exchange between the boundary current and interior for all interiorshort and interiorlong particles most particles first cross into the interior at a distance between 380 850 km from the inflow red dashed line fig 10a this peak in first crossings is found upstream of the peak in eke along the boundary 700 km downstream from the inflow blue shading in fig 10a associated with the eddy activity near the topographic narrowing fig 1c this is in agreement with the study of schulze chretien and frajka williams 2018 who used lagrangian trajectories to track the surface freshwater in the labrador sea and found that most of the freshwater leaves the shelf in the same area this indicates that the topography plays a significant role in determining the interior boundary current exchange the enhanced eke due to enhanced eddy activity along the topographic narrowing figs 1c and 10a facilitates exchanges between the boundary current and the interior most of the interiorshort particles also re enter the boundary current in the area where eke is enhanced 500 1000 km from the inflow fig 10a a secondary peak of last crossings is seen farther downstream coinciding with a secondary peak in eke distance 2500 km similarly the last crossings of the interiorlong particles blue line in fig 10a are also mostly found at the region of high eke the average temperature of the particles entering the interior within 1000 km downstream of the inflow is 3 9 c dashed line in fig 10b notably when they re enter the boundary current the particles are on average 0 2 c colder solid line this corroborates that water mass transformation occurs during their time in the interior at distances greater than 1500 km downstream of the inflow i e the western side of the domain the exchange occurs almost at the same temperature this indicates that the boundary current interior exchange at this part of the domain does not considerably affect the properties of the water masses it is noteworthy that the interiorlong particles have a mean temperature of 3 c or lower when they leave the interior fig 10c confirming once more that these particles represent the densest water mass in this model of the labrador sea to explore this connection in more detail we now focus on the export routes of the water masses that have been subducted in the interior we define two areas which represent regions of high subduction velocity fig 8b in box 1 and box 2 similarly to brandt et al 2007 and analyze only the behavior of the particles that subduct in these two boxes so the particles used for this analysis represent a fraction of the interiorshort particles i e 20 of the particles which represent 1 6 sv or 43 of the total subduction in the interior these boxes are placed in regions characterized by different dynamics box 1 is located where the deepest mixed layers are found fig 1b while box 2 is placed near the labrador coast where accordingly to previous studies e g brandt et al 2007 the newly formed lsw is rapidly exported it appears that the majority of the particles that subduct within box 1 fig 11a move towards the high eke area near the greenland coast distance 400 800 km and re enter the boundary current there before exiting the domain purple line in fig 11c in contrast a large fraction of particles that subduct within box 2 fig 11b are directly entrained in the boundary current in the west between 1600 2100 km orange line in fig 11c however the number of particles subducted in box 2 is smaller than to the number that subducts in box 1 i e 5643 particles difference that amounts to 0 5 sv in terms of volume transport this again explains the importance of the indirect export route via the west greenland coast it is clear that the particles that subduct in box 1 and re enter the boundary current where eke peaks distance between 400 1000 km show a larger temperature change than the ones that subduct in box 2 they experience a mean cooling of δ t box1 400 1000 km 0 5 c in contrast to δ t box2 400 1000 km 0 2 c fig 11d this is due to the fact that the water masses subducted in these two boxes originate from different regions fig 1b in box 1 the mixed layer is deeper and temperatures are lower than in box 2 essentially figs 10b and 11d support the view that most of the interiorshort particles are transformed during their time in the interior moreover depending on where water mass transformation occurs the particles tend to follow a different path and hence it is expected that they will display different residence times 7 residence time and export timescale in this section the residence time and export timescale of the particles are studied for each pathway first we investigate the residence time of the particles defined as the time it takes a particle to travel from the inflow to the outflow we focus on the wholeloop particles i e withinbc and interiorshort fig 3 which all leave the basin within 6 years it is clear that 90 of the withinbc particles leave the basin within one year black bars in fig 12a their maximum residence time is less than 2 years black line in fig 12b this highlights the existence of a fast route of water masses that enter the labrador sea and travel within the boundary current as expected based on fig 9b the interiorshort particles display much longer residence times of up to 6 years fig 12a b however 60 of the particles still leave the basin within 2 years red line in fig 12b next we investigate if there is any connection between the properties of the water masses that exit the domain and their residence time in the basin by displaying the temperature of the particles at the outflow as a function of their residence time fig 13 from this it is evident that most of the withinbc particles i e 60 of the particles fig 13a that leave the domain within one year correspond to lighter water masses t 3 8 c the residence time of the particles that exit the domain with temperatures lower than 3 8 c is slightly longer but restricted to a maximum of 2 years here the impact of the surface heat loss along the boundary in determining the properties of the local water mass is visible the particles with t 3 8 c likely represent water masses formed during convection within the boundary current fig 8a note that these particles are found deeper in the boundary current where its speed is weaker fig 4 thus explaining their longer residence time for the interiorshort particles the picture is different 74 of the particles exits the domain with temperatures below 3 8 c fig 13b remarkably the interiorshort particles that leave the basin within one year are particles that stay in the interior shortly and are warmer i e t residence 1 year 4 c that is the water masses that stay in the interior longer get denser i e t residence 1 year 3 6 c besides the residence time we also calculated the export timescale defined as the time it takes a particle to reach the outflow after it has subducted as expected the export time for the withinbc particles is as expected very short for 95 of the particles it is less than half a year the export time of the interiorshort particles ranges from 4 days to 5 5 years it appears that the water masses that are subducted within box 1 generally take more than one year before they exit the labrador sea only 35 of the total transport carried by these particles is exported within one year this is explained by the fact that the majority of these particles first moves towards the high eke area near the greenland coast before they re enter the boundary current and reach the outflow fig 11a in contrast the interiorshort particles that subduct in box 2 and are entrained into the boundary current in the west fig 11b exit the domain much quicker 80 of the total transport carried by these particles is exported out of the labrador sea within 150 days 8 discussion and conclusions in this study the upstream pathways of the water masses exiting the labrador sea have been investigated from a lagrangian perspective with a focus on the exchange between the boundary current and the interior and the water mass transformation that occurs within the domain to this end the output of a regional idealized model is used this model is known to capture the mesoscale eddy activity in the labrador sea which is most prominent at the west greenland coast georgiou et al 2019 the use of such an idealized model facilitates the exploration of the dynamics of this exchange between the boundary current and the interior and its role for lsw export in this study we extend the more generic study of a highly idealized marginal sea by brüggemann and katsman 2019 by quantifying the role of the interior boundary exchanges in setting the properties and the associated timescales of the water masses exiting the marginal sea in more detail by assessing the processes from a lagrangian viewpoint we show that water masses follow either a direct route within the boundary current withinbc particles or an indirect route that involves boundary current interior exchanges interiorshort and interiorlong particles from the inflow region south of greenland to the outflow region on the labrador side fig 2b that carry roughly the same transport the distribution of the particles at the inflow and outflow fig 4 shows that their position at the inflow determines their pathway and location at the outflow essentially the particles that follow the boundary current withinbc are found in the core of the boundary current with rather high velocities while particles that pass through the interior interiorshort are found on its outer flank that is our results indicate that the fate of water masses is already determined upstream this suggests that processes in the irminger basin and nordic seas impact the water mass transformation in the labrador sea building on the generic idea proposed by brüggemann and katsman 2019 on the existence of a fast and a slow route for dense water masses that exit the labrador sea the lagrangian analysis presented in this study allows us to quantify the transports associated with those two pathways the depth change of the particles between the inflow and outflow reveals that the total volume transport between 1500 3000 m increases by 1 3 sv for the withinbc particles and by 2 0 sv for the interiorshort particles fig 5 in density space which in this idealized model is represented by temperature only the lagrangian trajectories also show a substantial transport change between the inflow and outflow through the 3 5 c isotherm which amounts to 2 2 sv and 3 4 sv for the withinbc and interiorshort particles respectively fig 6 the maximum overturning derived from the eulerian quantities amounts to 3 8 sv at 1000 m depth space fig 7b and 3 4 sv at 3 5 c density space fig 7d the lagrangian particles capture the net eulerian overturning observed in this model both in depth and density space well fig 7 considering the fact that not all the particle trajectories cover the entire path between in and outflow the relative importance of the different pathways on the overturning becomes apparent in density space 60 of the maximum overturning is related to the transport carried by the interiorshort particles and only 40 by the withinbc particles fig 7c d however there is also a significant signal in the overturning in lighter layers which is only related to the relatively slow moving fraction of the withinbc particles in short the volume transport of the densest water masses is primarily carried by particles that have resided in the interior i e interiorshort and interiorlong particles while the particles that follow the fast route i e withinbc mainly transform in lighter water masses the characteristics of water mass transformation also differ for the fast and slow pathways the withinbc particles mainly subduct on the southwest side of the labrador sea fig 8a this location is downstream of the region where strong surface heat loss has reduced the stratification of the boundary current allowing the water masses to be transformed into denser water masses in contrast the interiorshort particles generally enter the interior at the greenland side fig 10a experience water mass transformation in the interior at the convection region figs 8b and 10b before re entering the boundary current fig 10 the latter occurs predominantly on the greenland side and to a lesser extent on the labrador side fig 10a depending on the location where the particle last leaves the mixed layer fig 11 this two way exchange first and last crossings at the western coast of greenland has been also identified in the recent study of pennelly et al 2019 however our study highlights that the export of the water masses that have been transformed into denser water masses in the interior occurs laterally as they are advected towards the region of high eke on the greenland side by eddy stirring the exchange between the boundary current and the interior has a direct impact on the timescales of the export of the water masses fig 13 90 of the volume transport carried by the withinbc particles exits the basin within one year while only 30 of the transport associated with the interiorshort particles exits within that time frame in observations bower et al 2009 and models brandt et al 2007 feucher et al 2019 the newly formed lsw is exported within one year our lagrangian analysis supports the idea of previous observational studies that the quickly exported lsw is likely formed within or close to the boundary current pickart et al 2002 cuny et al 2005 most of the interiorlong particles also re enter the boundary current at the region of high eke fig 10c however due to topographic constraints the lateral along isopycnal transport towards the boundary current at the high eke region cannot as easily take place for the denser interiorlong as for the lighter interiorshort particles this results in a longer residence of the interiorlong particles within the interior essentially the fact that the densest water masses which are represented by the interiorlong particles take more than six years to fully pass through the labrador sea confirms that cold signals that are exported from the labrador sea do not need to correspond to recent convective events as suggested by cuny et al 2005 thus our results suggest that the observed year to year correspondence between the properties of the water masses found in the interior of the labrador sea and in the labrador current e g rhein et al 2015 yashayaev and loder 2016 holte and straneo 2017 le bras et al 2017 reflect variations of the fast export route of lsw formed close to or within the boundary current our lagrangian results clearly extend the tracer analysis performed by georgiou et al 2019 and brüggemann and katsman 2019 as these studies mostly provided a qualitative description of the connection between strong eddy activity and convection areas the lagrangian analysis using particles instead of a passive tracer allows for conditional analysis see van sebille et al 2018 and provides a quantification of the relative importance of each pathway to water mass transformation and to the overturning in depth and density space in our study the limited model domain does not allow the investigation of the export route towards the irminger sea discussed in section 1 e g lavender et al 2000 pickart et al 2003 therefore our results may overestimate the transport of the lsw towards the west greenland coast another aspect that cannot be covered in our idealized model simulation but deserves attention is the suggestion by lozier et al 2013 that the overflow waters entering the subpolar gyre from the nordic seas also follow interior pathways that substantially lead to their equatorward export through the labrador sea we expect a minimal transformation of the overflow waters within the labrador sea since they fill the deeper layers of the basin however the presence of the overflow waters may affect the lsw pathways nevertheless the conclusion that an eddy driven transport of dense water towards the boundary exists and that it affects the export timescales of lsw is expected to hold analyses with a more realistic high resolution model are needed to explore this in more detail one of the main findings of this study is that there is a fast direct route for relatively lighter water masses compared to the slower indirect route that the denser water masses follow to exit the labrador sea in this model both routes carry roughly the same transport but the indirect route is steered by the eddy activity near the greenland coast that is a preferable region for lateral spreading of lsw and entrainment in the boundary current is identified therefore the view of a homogeneous lateral spreading and entrainment of the lsw into the boundary current is not valid in our model and this is consistent with the studies of bower et al 2009 2011 and gary et al 2012 importantly the fact that the densest water masses found in this study take more than six years to exit the labrador sea might obscure the link between the lsw formation and amoc variability in observations such as the osnap array holliday et al 2018 lozier et al 2019 the result that the interior boundary current exchange is important for the lsw export and hence contributes to the amoc variability suggests that additional observations aimed at capturing these mechanisms are needed it also raises the question how well lsw export processes their variability and their relation to amoc variability are represented in climate models which lack the resolution to resolve the mesoscale features required to capture this interior boundary current exchange credit authorship contribution statement sotiria georgiou conceptualization investigation methodology software formal analysis visualization writing original draft stefanie l ypma methodology software writing review editing nils brüggemann methodology software writing review editing juan manuel sayol methodology writing review editing julie d pietrzak supervision writing review editing caroline a katsman funding acquisition supervision conceptualization methodology writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments s georgiou s l ypma and j m sayol were supported by the netherlands organisation for scientific research nwo via vidi grant 864 13 011 awarded to c a katsman n brüggemann was also funded by the collaborative research centre the netherlands trr 181 this paper is a contribution to the project s2 improved parameterisations and numerics in climate models of the collaborative research centre trr 181 energy transfer in atmosphere and ocean funded by the deutsche forschungsgemeinschaft dfg german research foundation germany projektnummer 274762653 comments from c g van der boog on the analysis and the insightful comments and suggestions of two anonymous reviewers are greatly appreciated the model data analyzed in this study are available from the corresponding author on request 
23967,the water masses exiting the labrador sea and in particular the dense water mass formed by convection i e labrador sea water lsw are important components of the atlantic meridional overturning circulation amoc several studies have questioned the connection of the lsw production to the amoc variability this is partly due to the limited understanding of how this locally formed water mass leaves the interior of the labrador sea in this study the pathways and the timescales of the water masses exiting the labrador sea via the boundary current are investigated by lagrangian particle tracking this method is applied to the output of a strongly eddying idealized model that is capable of representing the essential physical processes involved in the cycle of convection and restratification in the labrador sea the lagrangian trajectories reveal that prior to exiting the domain the water masses follow either a fast route within the boundary current or a slower route that involves boundary current interior exchanges the densest water masses exiting the labrador sea stem from this slow route where particles experience strong water mass transformation while in the interior in contrast the particles that follow the fast route experience water mass transformation in the boundary current at the western side of the domain only yielding a lighter product although both routes carry roughly the same transport we show that 60 of the overturning in density space is associated with the volume transport carried by particles that follow the slow route this study further highlights that the export of dense water masses which is governed by the eddy activity in the basin yields export timescales that are usually longer than a year this underlines the necessity of resolving the mesoscale features required to capture the interior boundary current exchange in order to correctly represent the export of the lsw keywords labrador sea water export convection labrador sea atlantic meridional overturning circulation lagrangian pathways 1 introduction the atlantic meridional overturning circulation amoc describes the conversion of lighter shallow atlantic water masses flowing northward into denser deep water masses flowing southward involving diabatic processes like deep convection in the marginal seas of the north atlantic the strength of the amoc is commonly estimated as the total northward transport in the upper 1000m or so of the water column and can be either viewed in depth space emphasizing the vertical transport wunsch and heimbach 2006 cunningham et al 2007 or in density space emphasizing the transformation of lighter to denser water masses e g xu et al 2016 li et al 2017 desbruyères et al 2019 lozier et al 2019 brüggemann and katsman 2019 climate model studies suggest a substantial weakening of the amoc over the 21st century collins et al 2013 weijer et al 2019 with the potential to affect the global climate therefore over the last decade there has been an increased effort to understand the drivers of amoc variability e g johnson et al 2019 lozier et al 2019 one of these potential drivers is the process of deep convection in the labrador sea resulting in the production of labrador sea water lsw one of the water masses that contribute to the lower limb of the amoc e g rhein et al 2017 while earlier modeling studies have suggested a close connection between the lsw production and amoc variability biastoch et al 2008 zhang 2010 yeager and danabasoglu 2014 up to date observations at the rapid 26 n smeed et al 2018 and osnap lozier et al 2019 arrays and recent numerical studies zou and lozier 2016 li and lozier 2018 georgiou et al 2019 have cast doubts on this suggesting a rather complex connection between the two moreover the recent study of lozier et al 2019 suggests that the variability of the overturning is dominated by the water mass transformation taking place in the eastern half of subpolar gyre rather than in the labrador sea the recent debate on the importance of the lsw for amoc variability is partly the result of limited understanding on how this water mass leaves the interior of the labrador sea in particular about its export routes and the associated timescales several studies showed that newly formed lsw is rapidly exported by spreading laterally and entraining in the deep western boundary current dwbc near the labrador coast e g talley and mccartney 1982 brandt et al 2007 feucher et al 2019 moreover a mid depth recirculation of the lsw within the subpolar gyre has been reported in a number of studies e g lavender et al 2000 pickart et al 2003 stramma et al 2004 bower et al 2009 holliday et al 2009 lozier et al 2013 last a slower export route has been suggested in the studies of straneo et al 2003 and palter et al 2008 in particular they identify the existence of a pathway which transports convected water from the interior towards the west coast of greenland these multiple export routes of lsw of which the relative importance is still unclear might result in a complex relation between the lsw formation and its export timescales and the amoc variability the recent highly idealized numerical study of a convectivemarginal sea by brüggemann and katsman 2019 clearly highlights the important role of the exchange of waters between the interior and the boundary current which in turn is governed by the eddy activity for the export pathways of convected water and the associated timescales their results indicated that the densest water masses are formed in the interior and are laterally steered towards the region of high eddy activity and then entrained in the boundary current thus following an indirect route to leave the marginal sea in addition they showed that a lighter product of convection within the boundary current itself is directly and rapidly exported via that boundary current the underlying idea of an eddy induced entrainment of lsw in the boundary current was pointed out by khatiwala and visbeck 2000 however they linked this entrainment to the summertime restratification process and the associated horizontal density gradients that is they assumed no spatial variations and by linking it to the restratification implied that this only occurs in summer in contrast both brüggemann and katsman 2019 and georgiou et al 2019 show that there is a preferred region for the re entrainment which coincides with the region where the eddy activity peaks however both studies conclude this based on an analysis of passive tracers which does not allow the investigation of the pathways and transformation of water masses which in the end determine the lsw export the direct and indirect export routes of the convected water recently identified in idealized models brüggemann and katsman 2019 georgiou et al 2019 are in line with the indications of such routes from observations e g palter et al 2008 bower et al 2009 however due to the limited number of observations the relative importance of a direct export route on the labrador side of the basin and an indirect route via the greenland coast is yet unclear in this study we analyze the origin and transformation of different water masses found within the boundary current at the exit of the labrador sea we use a lagrangian approach applied to the output from the idealized model used in georgiou et al 2019 which allows us to elucidate the complex structure of the flow bower et al 2019 from this we distinguish different pathways identify where water mass transformation occurs and assess what role the prominent eddy field plays for exporting these water masses this idealized model study provides helpful insights on the nature of the interior boundary current exchange and its role for the lsw export the results can guide the analyses of observations and more realistic model simulations thus improving our overall understanding in amoc the structure of this paper is as follows the model setup and the lagrangian approach are described in section 2 first the pathways that the water masses follow before exiting the labrador sea are analyzed in section 3 next we explore the importance of each pathway for the net overturning in depth and density space section 4 and the location where the water masses subduct section 5 in section 6 we focus on the lateral exchange between the boundary current and the interior by identifying the locations where this exchange occurs and how it affects the properties of the water masses exiting the labrador sea the associated export timescales are addressed in section 7 followed by a discussion and conclusions in section 8 2 numerical model and methods 2 1 model configuration and flow characteristics the numerical simulation analyzed in this study is carried out using a hydrostatic configuration of the mitgcm marshall et al 1997 the model configuration captures the key features of the circulation in the labrador sea like the annual cycle of the convection and restratification and the properties of the mesoscale eddy field this model and its results have been previously used in georgiou et al 2019 and we refer the reader to this study for a more detailed description of the model setup the model has a horizontal resolution of 3 75 km and 40 levels in the vertical with a resolution of 20 m in the upper layers up to 200 m at a maximum depth of 3000 m the model domain has two open boundaries each roughly 100 km wide one in the northeast and one in the southwest where a boundary current enters and exits the domain all other boundaries are closed fig 1 at the northeastern open boundary a warm boundary current is specified by a meridional temperature field t in y z and a westward flow u in y z in geostrophic balance with this prescribed temperature distribution a sinusoidal seasonally varying term is added to the inflow conditions to mimic the observed seasonal variability of the west greenland current δ u max 0 4 m s 1 with maximum and minimum in september and march respectively kulan and myers 2009 rykova et al 2015 note that total outflow transport is prescribed but the properties of the boundary current at the outflow are determined by the internal model dynamics following the topography this boundary current flows cyclonically around the basin fig 1a at the northwestern side a narrowing of the topography is present gray contours in fig 1a as observed near the west coast of greenland this steepening leads to an increased instability of the boundary current and mostly warm anticyclonic eddies are shed with similar characteristics as the irminger rings irs as shown in katsman et al 2004 gelderloos et al 2011 and georgiou et al 2019 at the surface a temporally and spatially varying surface heat flux is applied resulting in a net annual heat loss of 18 w m 2 over the entire model domain blue contours in fig 1b see georgiou et al 2019 for details a linear equation of state is used with temperature as the only active tracer note that the effects of salinity are not incorporated in the model although in reality the lateral fresh water flux carried by the irs e g de jong et al 2016 influences the properties of convection e g gelderloos et al 2012 in this study our focus is on the dynamics that control the interior boundary current exchange in the labrador sea and hence the effects of salinity are omitted in the model for simplicity as a result of the applied surface heat loss blue contours in fig 1b the model displays deep convection in the interior the winter mean mixed layer reaches a depth of 1700 m fig 1b as shown in georgiou et al 2019 the deepest mixed layers are located away from areas with strong eddy activity red contours in fig 1b albeit slightly closer to the maximum of buoyancy loss than observed in the regions of strong eddy activity the associated eddy heat transport from the boundary current towards the interior is stronger and the water column is too stratified to sustain deep convection in the model we do not consider the shelf and overflow waters or the effects of wind gelderloos et al 2011 and prescribe a transport at the inflow 19 7 sv that is weaker than estimates over the full depth 40 50 sv pickart et al 2002 fischer et al 2004 the maximum barotropic streamfunction is about 27 sv fig 1c due to some recirculation in the basin in this study we use the three dimensional velocity field from the last six years of the reference simulation i e model years 15 20 described in georgiou et al 2019 to track lagrangian particles 2 2 lagrangian particle tracking the offline lagrangian tool connectivity modeling system cms paris et al 2013 is used to investigate the possible pathways of the waters exiting the model domain and water mass transformation that occurs along these pathways to this end numerical particles are released at the outflow region in the south the only export route of the convected water mass out of the domain the particles are advected backward in time using a timestep of 1 h within the 2 day snapshots of the three dimensional velocity fields of the simulation described in the previous section the movement of the numerical particles is parameterized as described by paris et al 2013 a runge kutta 4th order stepping in time and a tricubic spatial interpolation are used to determine the location of the particles no additional horizontal diffusivity is applied to account for the increased vertical diffusion during the process of convection particles that are located within the mixed layer are moved randomly in the vertical within the mixed layer with a maximum velocity of w 10 cm s 1 van sebille et al 2013 particles are released at the outflow y 3 75 km red line in fig 2a every 2 days over a period of one year with a particle resolution of 1 km in the zonal direction and 50 m vertically doing so we track 217349 lagrangian particles over a period of 6 years since we are interested in distinguishing the pathways of the water masses in terms of volume transport a volume transport is assigned to each particle upon release and it is conserved along the trajectory van sebille et al 2018 this is determined by multiplying the meridional velocity by the area of the grid cell in which the particle is released döös 1995 ypma et al 2019 although the particles were released at the outflow and tracked backwards we will mostly refer to their trajectories forward in time 3 pathways and origin of the water masses exiting the labrador sea in this study we explore the origin of the waters found in the boundary current at the outflow of the labrador sea in particular we investigate the role of exchange water between the boundary current and the interior to this end we define a particle as being in the interior when it is offshore of the 18 sv contour line of the 5 year mean barotropic streamfunction ψ b black dashed line in figs 1 and 2a to filter out possible short and fast excursions of particles into the interior and back we also require that the particle stays offshore of this streamline for more than 20 days the results of the analyses presented in this study are not very sensitive to the exact choice made for distinguishing the boundary current from the interior the presented results are consistent for different choices of ψ b or using an isobath within the 6 year advection time 90 of the particles i e 195528 particles reach the eastern open boundary inflow since these particles travel from the inflow towards the outflow we will refer to them as wholeloop particles the 10 of the particles that remain in the basin during the 6 year simulation are referred to as interiorlong particles a particle density plot fig 2a highlights the paths that the wholeloop and interiorlong particles are prone to follow it is constructed by regridding the position of each particle at every timestep on an x y grid with a resolution of 3 75 km this particle density is calculated as described in ypma et al 2019 at each location in the new grid the transport assigned to each particle is divided by the total transport carried by the particles in the interior the particle density is enhanced at the northwestern side of the basin close to the topographic narrowing fig 2a this indicates that a significant number of particles enter the interior of the basin there suggesting a connection with the eddy activity found at this location fig 1b however such a possible connection is masked by the fact that the highest particle density occurs along the boundary current which suggests that the particles are found somewhere within the boundary current during their lifetime we therefore subdivide the wholeloop particles in two groups particles that cross the 18 sv contour line of ψ b into the interior at some location hereinafter interiorshort particles and particles that never cross the 18 sv contour line and thus never leave the boundary current hereinafter withinbc particles it appears that of all the wholeloop particles 60 falls into the interiorshort category and 40 in the withinbc category fig 3 the volume transport carried by the w i t h i n b c interiorshort and interiorlong particles amounts to 6 8 sv 8 4 sv and 2 0 sv respectively fig 3 note that at the eastern side of the domain x 800 km and y 1000 km the particle density is low 1 fig 2a this reflects the weak circulation in this part of the domain fig 1c this is a consequence of the closed southeastern boundary of the idealized model the bathymetry forces the boundary current to follow the northern and western side of the domain by construction the withinbc particles black line in fig 2b are always onshore of the 18 sv contour line of ψ b the interiorshort particles red line in fig 2b also travel from the inflow to the outflow but along their path they enter the interior purple star in fig 2b and re enter the boundary current yellow star in fig 2b before exiting the domain last the interiorlong particles recirculate in the interior of the basin for more than 6 years blue line in fig 2b most of the withinbc particles reside close to the lateral boundaries at both the inflow and the outflow black contours in fig 4 the particles that enter the interior and leave the domain within the simulated advection time interiorshort red contours in fig 4 originate farther offshore y 1020 1060 km than the withinbc particles y 1040 1080 km fig 4b since they are at the flank of the boundary current at the inflow fig 4b they can more easily leave the boundary current and enter the interior similarly when they re enter the boundary current they are found on its offshore flank fig 4a but deeper in the water column last the interiorlong particles are found in the deepest part of the boundary current blue contours in fig 4a apparently they represent the densest water masses exiting the domain 4 overturning in depth and density space the particles that represent the three pathways of water masses prior to exiting the labrador sea display a depth change fig 4 which is a reflection of overturning in depth space in the basin moreover using the same model setup it is shown from an eulerian perspective that the boundary current gets denser along its path through the labrador sea yielding a net overturning in density space georgiou et al 2019 in this section we analyze this overturning both in depth and density space from a lagrangian perspective and investigate the relative contribution of the different pathways to this net overturning 4 1 transport changes between the inflow and outflow in depth space since each of the particles represents a particular transport of water masses section 2 2 we can convert the depth changes of particles between inflow green bars and outflow orange bars to the associated volume transport fig 5 three vertical layers are defined to facilitate discussion 0 500 m 500 1500 m and 1500 3000 m black horizontal lines in fig 5a c at the inflow almost all transport carried by either the withinbc or the interiorshort particles is found shallower than 1500 m 6 8 sv and 8 2 sv respectively this view changes at the outflow of the domain the volume transport in the deepest layer 1500 3000 m increases by 1 3 sv for the withinbc and by 2 0 sv for the interiorshort particles in addition the presence of the interiorlong particles at the outflow becomes apparent in this depth layer as a volume transport of 1 8 sv 90 of the total transport these particles represent 4 2 transport changes between the inflow and outflow in density space similarly we can explore the water mass transformation that occurs between inflow and outflow from a lagrangian perspective since the density in the model is associated only with temperature variations section 2 1 we examine the temperature changes between inflow and outflow for each pathway at the inflow most of the withinbc particles carry warm water masses green bars in fig 6a a shift in transport of warmer to colder water masses between inflow and outflow reveals that water mass transformation occurs within the boundary current since the interiorshort particles originate farther offshore in the boundary current fig 4b they are characterized by lower temperatures at the inflow green bars in fig 6b also for this category the transport in colder layers increases towards the outflow indicating that the particles experience water mass transformation along their path last the interiorlong particles represent the coldest water masses at the outflow fig 6c to quantify the water mass transformation in density space the total volume transport at the inflow outflow is summarized in fig 6 for three water mass definitions surface waters t 3 5 c intermediate waters 3 2 t 3 5 c and deep waters t 3 2 c note that t 3 2 3 5 c is the temperature range corresponding to the convected water mass georgiou et al 2019 the transport change between inflow and outflow in temperature space through the 3 5 c isotherm derived from the particles amounts to 1 3 1 1 0 2 2 2 sv for withinbc fig 6a and to 3 6 2 2 2 1 0 3 3 4 sv for interiorshort fig 6b furthermore the transport of water masses below 3 5 c at the outflow is substantially higher for both the interiorshort and interiorlong particles 7 6 sv combined fig 6b c than for the withinbc 2 4 sv fig 6a 4 3 overturning from the eulerian and the lagrangian perspective based on figs 5 and 6 we can estimate the overturning in both depth and density space and compare this to the overturning calculated from the eulerian velocities the eulerian overturning in depth space is defined as the difference in time mean transport between the inflow and the outflow in model year 15 integrated over the same depth bins depth space or temperature bins density space next we calculate the lagrangian overturning for each pathway by taking the difference between the summed volume transport carried by all particles in a certain depth or density bin at the outflow and at the inflow this is done for all three particle categories since the interiorlong particles never reach the inflow the total mean lagrangian overturning estimate is based solely on the transports carried by the withinbc and interiorshort particles we do not expect the eulerian and lagrangian overturning estimates to match exactly as we lack information on the overturning associated with the interiorlong particles since we cannot follow them backwards in time towards the inflow however the overturning derived from the particles largely agrees with the overturning obtained from the time mean eulerian flow compare the purple and green lines in fig 7 which suggests that we can use the overturning split in pathways to get an impression of the importance of each route in depth space the maximum eulerian lagrangian overturning occurs at 1000 m depth and amounts to 3 8 4 1 sv fig 7b both withinbc and interiorshort particles contribute equally to the lagrangian overturning in depth space in addition the presence of the interiorlong particles at the outflow becomes apparent in depths greater than 1000 m in density space the overturning in both the eulerian and lagrangian view peaks at a temperature of 3 5 c and amounts to 3 4 and 5 4 sv respectively fig 7d when the contributions of the transport carried by each pathway to the net overturning in density space are considered it appears that 60 of the maximum overturning at t 3 5 c can be attributed to the interiorshort particles and 40 to the withinbc particles in contrast the secondary peak of 4 1 sv in the total lagrangian overturning at t 4 5 c is mainly due to the withinbc particles this confirms that the transformation of the withinbc particles results into relatively lighter water masses than the interiorshort particles notably at this temperature the eulerian overturning is negligible that is the eulerian transport of waters of this temperature at the inflow and outflow is the same while the lagrangian analysis reveals an increase in transport of this water mass this implies that an inflow of waters of this temperature exists which does not reach the outflow within six years and is thus not captured by the lagrangian backtracking calculation the temperature of this water mass corresponds to that of boundary current waters at 500 1000 m depth see fig 1b in georgiou et al 2019 we speculate that this water mass is also transported offshore from the boundary current to the interior but has a residence time longer than the six year duration of the lagrangian calculation 5 subduction as shown in fig 7 both the withinbc and the interiorshort particles experience water mass transformation here we identify the location where these water masses last change their properties by means of the local subduction rate following the analysis of brandt et al 2007 we define subduction as the process of a particle leaving the mixed layer it is calculated from the trajectories of the withinbc and interiorshort particles as the sum of all transport values assigned to the particles subducted within a certain grid box the subduction velocity fig 8 is calculated by dividing this subduction rate of each gridbox by its area the magnitude of the subduction velocity is similar to the subduction velocities reported by brandt et al 2007 with elevated values in the west the calculation of the subduction rate is performed separately for the withinbc fig 8a and interiorshort particles fig 8b the main difference between the two is the location of the peak values subduction of waters exiting the domain along the withinbc route mainly occurs in the western part of the labrador sea this is likely associated with convection that occurs within the boundary current due to the surface buoyancy forcing the total subduction of the withinbc particles amounts to 1 9 sv in contrast large subduction velocities of the particles following the interiorshort route are found in the west close to the edge of the boundary current the total subduction for the interiorshort amounts to 3 7 sv of which 76 occurs in the interior i e offshore of the 18 sv contour line of ψ b the remaining 24 subducts within the boundary current after re entering which indicates a pathway of transformed water masses within the boundary current brandt et al 2007 similar to the withinbc particles our study reveals that most of the interiorshort particles leave the mixed layer in the interior before they re entrain into the boundary current and exit the domain fig 8b in the following section we will show that the properties of the particles depend on the location where they subduct within the interior i e box 1 and box 2 in fig 8b 6 lateral exchange and water mass transformation to explore the lateral exchange between the boundary current and the interior and water mass transformation in the interior we next focus on the locations where the interiorshort particles enter and leave the interior of the domain we define the first last crossing of a particle as the location at which it crosses the 18 sv contour line of the barotropic streamfunction ψ b for the first last time after entering the domain purple and yellow stars in the example trajectory shown in fig 2b an example trajectory shows that this particle enters the basin at the eastern open boundary at a depth of 100 m fig 9c its temperature at the inflow green square in fig 9a is t inflow 4 7 c it follows the boundary current until it crosses into the interior purple star and vertical line in fig 9a and b respectively while in the interior the particle recirculates and shows a large drop in temperature fig 9b when it is in the mixed layer gray shaded area in fig 9b c there it reaches a temperature corresponding to that of the convected water t 3 2 c fig 9b once the particle is subducted fig 9c it stays below the mixed layer in the subsequent winters and no further temperature change occurs fig 9b the largest change in depth of the particle blue line in fig 9c takes place between locations 5 and 6 when the particle leaves the mixed layer without any water mass transformation this means that the particle moves adiabatically along an isopycnal isotherm to deeper layers for most of its advection time the particle s path is steered by eddies that are present in the interior fig 9a after being in the interior for more than 4 years the particle re enters the boundary current yellow star and vertical line in fig 9a b and it does so along this 3 2 c isotherm after its re entry the particle slightly rises in the water column fig 9c because the isotherms rise as the boundary current loses heat in the downstream direction straneo 2006 georgiou et al 2019 brüggemann and katsman 2019 although it takes almost 6 years for this particle to travel from inflow to outflow only nine months pass between the moment it re enters the boundary current until it exits the labrador sea next we consider the lateral exchange between the boundary current and interior for all interiorshort and interiorlong particles most particles first cross into the interior at a distance between 380 850 km from the inflow red dashed line fig 10a this peak in first crossings is found upstream of the peak in eke along the boundary 700 km downstream from the inflow blue shading in fig 10a associated with the eddy activity near the topographic narrowing fig 1c this is in agreement with the study of schulze chretien and frajka williams 2018 who used lagrangian trajectories to track the surface freshwater in the labrador sea and found that most of the freshwater leaves the shelf in the same area this indicates that the topography plays a significant role in determining the interior boundary current exchange the enhanced eke due to enhanced eddy activity along the topographic narrowing figs 1c and 10a facilitates exchanges between the boundary current and the interior most of the interiorshort particles also re enter the boundary current in the area where eke is enhanced 500 1000 km from the inflow fig 10a a secondary peak of last crossings is seen farther downstream coinciding with a secondary peak in eke distance 2500 km similarly the last crossings of the interiorlong particles blue line in fig 10a are also mostly found at the region of high eke the average temperature of the particles entering the interior within 1000 km downstream of the inflow is 3 9 c dashed line in fig 10b notably when they re enter the boundary current the particles are on average 0 2 c colder solid line this corroborates that water mass transformation occurs during their time in the interior at distances greater than 1500 km downstream of the inflow i e the western side of the domain the exchange occurs almost at the same temperature this indicates that the boundary current interior exchange at this part of the domain does not considerably affect the properties of the water masses it is noteworthy that the interiorlong particles have a mean temperature of 3 c or lower when they leave the interior fig 10c confirming once more that these particles represent the densest water mass in this model of the labrador sea to explore this connection in more detail we now focus on the export routes of the water masses that have been subducted in the interior we define two areas which represent regions of high subduction velocity fig 8b in box 1 and box 2 similarly to brandt et al 2007 and analyze only the behavior of the particles that subduct in these two boxes so the particles used for this analysis represent a fraction of the interiorshort particles i e 20 of the particles which represent 1 6 sv or 43 of the total subduction in the interior these boxes are placed in regions characterized by different dynamics box 1 is located where the deepest mixed layers are found fig 1b while box 2 is placed near the labrador coast where accordingly to previous studies e g brandt et al 2007 the newly formed lsw is rapidly exported it appears that the majority of the particles that subduct within box 1 fig 11a move towards the high eke area near the greenland coast distance 400 800 km and re enter the boundary current there before exiting the domain purple line in fig 11c in contrast a large fraction of particles that subduct within box 2 fig 11b are directly entrained in the boundary current in the west between 1600 2100 km orange line in fig 11c however the number of particles subducted in box 2 is smaller than to the number that subducts in box 1 i e 5643 particles difference that amounts to 0 5 sv in terms of volume transport this again explains the importance of the indirect export route via the west greenland coast it is clear that the particles that subduct in box 1 and re enter the boundary current where eke peaks distance between 400 1000 km show a larger temperature change than the ones that subduct in box 2 they experience a mean cooling of δ t box1 400 1000 km 0 5 c in contrast to δ t box2 400 1000 km 0 2 c fig 11d this is due to the fact that the water masses subducted in these two boxes originate from different regions fig 1b in box 1 the mixed layer is deeper and temperatures are lower than in box 2 essentially figs 10b and 11d support the view that most of the interiorshort particles are transformed during their time in the interior moreover depending on where water mass transformation occurs the particles tend to follow a different path and hence it is expected that they will display different residence times 7 residence time and export timescale in this section the residence time and export timescale of the particles are studied for each pathway first we investigate the residence time of the particles defined as the time it takes a particle to travel from the inflow to the outflow we focus on the wholeloop particles i e withinbc and interiorshort fig 3 which all leave the basin within 6 years it is clear that 90 of the withinbc particles leave the basin within one year black bars in fig 12a their maximum residence time is less than 2 years black line in fig 12b this highlights the existence of a fast route of water masses that enter the labrador sea and travel within the boundary current as expected based on fig 9b the interiorshort particles display much longer residence times of up to 6 years fig 12a b however 60 of the particles still leave the basin within 2 years red line in fig 12b next we investigate if there is any connection between the properties of the water masses that exit the domain and their residence time in the basin by displaying the temperature of the particles at the outflow as a function of their residence time fig 13 from this it is evident that most of the withinbc particles i e 60 of the particles fig 13a that leave the domain within one year correspond to lighter water masses t 3 8 c the residence time of the particles that exit the domain with temperatures lower than 3 8 c is slightly longer but restricted to a maximum of 2 years here the impact of the surface heat loss along the boundary in determining the properties of the local water mass is visible the particles with t 3 8 c likely represent water masses formed during convection within the boundary current fig 8a note that these particles are found deeper in the boundary current where its speed is weaker fig 4 thus explaining their longer residence time for the interiorshort particles the picture is different 74 of the particles exits the domain with temperatures below 3 8 c fig 13b remarkably the interiorshort particles that leave the basin within one year are particles that stay in the interior shortly and are warmer i e t residence 1 year 4 c that is the water masses that stay in the interior longer get denser i e t residence 1 year 3 6 c besides the residence time we also calculated the export timescale defined as the time it takes a particle to reach the outflow after it has subducted as expected the export time for the withinbc particles is as expected very short for 95 of the particles it is less than half a year the export time of the interiorshort particles ranges from 4 days to 5 5 years it appears that the water masses that are subducted within box 1 generally take more than one year before they exit the labrador sea only 35 of the total transport carried by these particles is exported within one year this is explained by the fact that the majority of these particles first moves towards the high eke area near the greenland coast before they re enter the boundary current and reach the outflow fig 11a in contrast the interiorshort particles that subduct in box 2 and are entrained into the boundary current in the west fig 11b exit the domain much quicker 80 of the total transport carried by these particles is exported out of the labrador sea within 150 days 8 discussion and conclusions in this study the upstream pathways of the water masses exiting the labrador sea have been investigated from a lagrangian perspective with a focus on the exchange between the boundary current and the interior and the water mass transformation that occurs within the domain to this end the output of a regional idealized model is used this model is known to capture the mesoscale eddy activity in the labrador sea which is most prominent at the west greenland coast georgiou et al 2019 the use of such an idealized model facilitates the exploration of the dynamics of this exchange between the boundary current and the interior and its role for lsw export in this study we extend the more generic study of a highly idealized marginal sea by brüggemann and katsman 2019 by quantifying the role of the interior boundary exchanges in setting the properties and the associated timescales of the water masses exiting the marginal sea in more detail by assessing the processes from a lagrangian viewpoint we show that water masses follow either a direct route within the boundary current withinbc particles or an indirect route that involves boundary current interior exchanges interiorshort and interiorlong particles from the inflow region south of greenland to the outflow region on the labrador side fig 2b that carry roughly the same transport the distribution of the particles at the inflow and outflow fig 4 shows that their position at the inflow determines their pathway and location at the outflow essentially the particles that follow the boundary current withinbc are found in the core of the boundary current with rather high velocities while particles that pass through the interior interiorshort are found on its outer flank that is our results indicate that the fate of water masses is already determined upstream this suggests that processes in the irminger basin and nordic seas impact the water mass transformation in the labrador sea building on the generic idea proposed by brüggemann and katsman 2019 on the existence of a fast and a slow route for dense water masses that exit the labrador sea the lagrangian analysis presented in this study allows us to quantify the transports associated with those two pathways the depth change of the particles between the inflow and outflow reveals that the total volume transport between 1500 3000 m increases by 1 3 sv for the withinbc particles and by 2 0 sv for the interiorshort particles fig 5 in density space which in this idealized model is represented by temperature only the lagrangian trajectories also show a substantial transport change between the inflow and outflow through the 3 5 c isotherm which amounts to 2 2 sv and 3 4 sv for the withinbc and interiorshort particles respectively fig 6 the maximum overturning derived from the eulerian quantities amounts to 3 8 sv at 1000 m depth space fig 7b and 3 4 sv at 3 5 c density space fig 7d the lagrangian particles capture the net eulerian overturning observed in this model both in depth and density space well fig 7 considering the fact that not all the particle trajectories cover the entire path between in and outflow the relative importance of the different pathways on the overturning becomes apparent in density space 60 of the maximum overturning is related to the transport carried by the interiorshort particles and only 40 by the withinbc particles fig 7c d however there is also a significant signal in the overturning in lighter layers which is only related to the relatively slow moving fraction of the withinbc particles in short the volume transport of the densest water masses is primarily carried by particles that have resided in the interior i e interiorshort and interiorlong particles while the particles that follow the fast route i e withinbc mainly transform in lighter water masses the characteristics of water mass transformation also differ for the fast and slow pathways the withinbc particles mainly subduct on the southwest side of the labrador sea fig 8a this location is downstream of the region where strong surface heat loss has reduced the stratification of the boundary current allowing the water masses to be transformed into denser water masses in contrast the interiorshort particles generally enter the interior at the greenland side fig 10a experience water mass transformation in the interior at the convection region figs 8b and 10b before re entering the boundary current fig 10 the latter occurs predominantly on the greenland side and to a lesser extent on the labrador side fig 10a depending on the location where the particle last leaves the mixed layer fig 11 this two way exchange first and last crossings at the western coast of greenland has been also identified in the recent study of pennelly et al 2019 however our study highlights that the export of the water masses that have been transformed into denser water masses in the interior occurs laterally as they are advected towards the region of high eke on the greenland side by eddy stirring the exchange between the boundary current and the interior has a direct impact on the timescales of the export of the water masses fig 13 90 of the volume transport carried by the withinbc particles exits the basin within one year while only 30 of the transport associated with the interiorshort particles exits within that time frame in observations bower et al 2009 and models brandt et al 2007 feucher et al 2019 the newly formed lsw is exported within one year our lagrangian analysis supports the idea of previous observational studies that the quickly exported lsw is likely formed within or close to the boundary current pickart et al 2002 cuny et al 2005 most of the interiorlong particles also re enter the boundary current at the region of high eke fig 10c however due to topographic constraints the lateral along isopycnal transport towards the boundary current at the high eke region cannot as easily take place for the denser interiorlong as for the lighter interiorshort particles this results in a longer residence of the interiorlong particles within the interior essentially the fact that the densest water masses which are represented by the interiorlong particles take more than six years to fully pass through the labrador sea confirms that cold signals that are exported from the labrador sea do not need to correspond to recent convective events as suggested by cuny et al 2005 thus our results suggest that the observed year to year correspondence between the properties of the water masses found in the interior of the labrador sea and in the labrador current e g rhein et al 2015 yashayaev and loder 2016 holte and straneo 2017 le bras et al 2017 reflect variations of the fast export route of lsw formed close to or within the boundary current our lagrangian results clearly extend the tracer analysis performed by georgiou et al 2019 and brüggemann and katsman 2019 as these studies mostly provided a qualitative description of the connection between strong eddy activity and convection areas the lagrangian analysis using particles instead of a passive tracer allows for conditional analysis see van sebille et al 2018 and provides a quantification of the relative importance of each pathway to water mass transformation and to the overturning in depth and density space in our study the limited model domain does not allow the investigation of the export route towards the irminger sea discussed in section 1 e g lavender et al 2000 pickart et al 2003 therefore our results may overestimate the transport of the lsw towards the west greenland coast another aspect that cannot be covered in our idealized model simulation but deserves attention is the suggestion by lozier et al 2013 that the overflow waters entering the subpolar gyre from the nordic seas also follow interior pathways that substantially lead to their equatorward export through the labrador sea we expect a minimal transformation of the overflow waters within the labrador sea since they fill the deeper layers of the basin however the presence of the overflow waters may affect the lsw pathways nevertheless the conclusion that an eddy driven transport of dense water towards the boundary exists and that it affects the export timescales of lsw is expected to hold analyses with a more realistic high resolution model are needed to explore this in more detail one of the main findings of this study is that there is a fast direct route for relatively lighter water masses compared to the slower indirect route that the denser water masses follow to exit the labrador sea in this model both routes carry roughly the same transport but the indirect route is steered by the eddy activity near the greenland coast that is a preferable region for lateral spreading of lsw and entrainment in the boundary current is identified therefore the view of a homogeneous lateral spreading and entrainment of the lsw into the boundary current is not valid in our model and this is consistent with the studies of bower et al 2009 2011 and gary et al 2012 importantly the fact that the densest water masses found in this study take more than six years to exit the labrador sea might obscure the link between the lsw formation and amoc variability in observations such as the osnap array holliday et al 2018 lozier et al 2019 the result that the interior boundary current exchange is important for the lsw export and hence contributes to the amoc variability suggests that additional observations aimed at capturing these mechanisms are needed it also raises the question how well lsw export processes their variability and their relation to amoc variability are represented in climate models which lack the resolution to resolve the mesoscale features required to capture this interior boundary current exchange credit authorship contribution statement sotiria georgiou conceptualization investigation methodology software formal analysis visualization writing original draft stefanie l ypma methodology software writing review editing nils brüggemann methodology software writing review editing juan manuel sayol methodology writing review editing julie d pietrzak supervision writing review editing caroline a katsman funding acquisition supervision conceptualization methodology writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments s georgiou s l ypma and j m sayol were supported by the netherlands organisation for scientific research nwo via vidi grant 864 13 011 awarded to c a katsman n brüggemann was also funded by the collaborative research centre the netherlands trr 181 this paper is a contribution to the project s2 improved parameterisations and numerics in climate models of the collaborative research centre trr 181 energy transfer in atmosphere and ocean funded by the deutsche forschungsgemeinschaft dfg german research foundation germany projektnummer 274762653 comments from c g van der boog on the analysis and the insightful comments and suggestions of two anonymous reviewers are greatly appreciated the model data analyzed in this study are available from the corresponding author on request 
23968,river plume source front connectivity kelly l cole conceptualization a daniel g macdonald conceptualization data curation b georgia kakoulaki data curation c robert d hetland funding acquisition d a department of civil and environmental engineering university of maine orono me usa department of civil and environmental engineering university of maine orono me usa school of marine sciences university of maine orono me usa b civil and environmental engineering university of massachusetts dartmouth dartmouth ma usa civil and environmental engineering university of massachusetts dartmouth dartmouth ma usa civil and environmental engineering university of massachusetts dartmouth dartmouth ma usa c department of estuarine and ocean sciences school for marine science and technology university of massachusetts dartmouth new bedford ma usa department of estuarine and ocean sciences school for marine science and technology university of massachusetts dartmouth new bedford ma usa department of estuarine and ocean sciences school for marine science and technology university of massachusetts dartmouth new bedford ma usa d department of oceanography texas a m university college station tx usa department of oceanography texas a m university college station tx usa department of oceanography texas a m university college station tx usa corresponding author river plume source front connectivity or the relationship between processes at the source plume body and front is investigated with numerical simulations of the merrimack river plume using the regional ocean modeling system roms source water i e water discharged from the estuary during an ebb pulse overtakes the front as it propagates offshore resulting in the strong convergence that exists there model results show that much of the water released over an ebb pulse does not interact with the propagating tidal plume front suggesting that the front decouples from the source and sustains itself as a distinct water mass when a gate is closed at the estuary mouth during early ebb the overall plume structure changes gates closed late in ebb do not significantly effect the along or cross shore scale of the plume the change in plume extent is only evident hours after the early ebb gate closing when source water is no longer supplied to the front these experiments suggest that the growing distance between the highly energetic liftoff region and the radial expansion of the plume front results in a flattening of the surface gradient driving flow in the interior diminishing source front connectivity keywords coastal ocean modeling buoyancy driven flow river plumes 1 introduction and background temporal variability of fresh water discharge from estuaries is an important element of the physical environment that shapes coastal ecosystems in tidally modulated regions buoyant water of riverine origin is pulsed from an estuary mouth onto the shelf during the ebb tide the buoyant water shoals and spreads over dense receiving shelf water creating an energetic shear mixing region hetland and macdonald 2008 the plume spreads offshore as the ebb progresses and accumulations of nutrients plankton and other materials may be trapped and transported in the seaward boundary of each ebb pulse by the strong convergence that exists there scotti and pineda 2007 the seaward boundary separating the discharge from ambient ocean water is the frontal region of the river plume the interaction between source water and ambient shelf water is amplified at the tidal plume front recent studies estimate that in some estuary shelf systems the tidal plume front is where a large portion of source water mixing from fresh to ocean salinities takes place orton and jay 2005 pritchard and huntley 2006 similar to the plume behind it horner devine et al 2015 the front undergoes a transition on tidal time scales from a non rotational to a geostrophic phenomenon near the source where the density anomaly and velocity of the outflow strongly affect plume evolution a convective bore like structure is observed at the front as it emerges into the coastal ocean marmorino and trump 2000 the frontal region is characterized by a convergence zone and turbulent wake plunging to a depth several times deeper than the plume behind it kilcher and nash 2010 by the end of the tidal cycle when the front is a great distance away from the mouth the structure of the plume front has begun a transformation towards geostrophy and a structure with many similarities to a shelf break front in cross shore thermal wind balance with reduced vertical mixing e g yankovsky and chapman 1997 thus it is expected that river plume source front connectivity or the relationship between processes at the source plume body and front will exhibit variability over the ebb tide phase previous studies focus on dynamics near the river mouth e g hetland 2005 macdonald et al 2007 hetland 2010 and kilcher et al 2012 or the structure of the plume front e g marmorino and trump 2000 and jay et al 2010 but few studies examine the connection between both regions that we will address in this study early plume models garvine 1982 1987 allow information from the front to travel into the plume along characteristics so that processes at the front establish the structure of the plume body a key theme of these model results and many models that evolved from the garvine series is plume connectivity and a better understanding of the interaction between the plume front and plume interior structure although qualitatively useful these early models fall short in their ability to reproduce many details of the frontal region because of initial assumptions made about the front structure o donnell et al 1998 the goal of this study is to quantify the amount of source water or water released from the estuary over a single ebb pulse that interacts with the tidal plume front this information has been overlooked in previous studies that evaluate total plume mixing at the front through comparison of mixing measurements at the front with fresh water flux at the source the importance of the front to overall plume structure communication between the mouth and the front is achieved through source water traversing the plume and overtaking the front garvine and monk 1974 o donnell et al 1998 marmorino and trump 2000 kilcher and nash 2010 previous laboratory studies of gravity currents and observational studies of buoyant plumes show that fresh water leaves the source travels through the core of the plume and is cycled through the front this supply of buoyant water to the front is necessary to sustain frontal propagation throughout ebb despite early studies highlighting the importance of fronts and their potential for coastal water mass modification garvine and monk 1974 garvine 1982 1987 luketina and imberger 1987 chen 1980 the role of frontal processes in plume evolution is still not well understood recent studies highlight processes at the source near field or front separately but the relative importance of each region to plume propagation is unclear hetland 2010 investigates the effect of inflow variables on plume interior mixing to determine expansion the details of frontal dynamics are overlooked results from macdonald et al 2007 and hetland and macdonald 2008 suggest that g at the front is set by interior mixing as front overtaking waters traverse the plume alternatively jay et al 2010 assumes local frontal dynamics are responsible for the advancement of the plume removing interior plume dynamics in an analytical modeling study kilcher and nash 2010 link ebb discharge at the estuary mouth to frontal propagation however they do not examine the path of source water through the plume core in detail engineering studies applied to the fronts steady propagation phase the front has a convective head structure during the steady propagation phase luketina and imberger 1987 marmorino and trump 2000 kilcher and nash 2010 that can be related to engineering scale gravity currents in a tank or small scale environmental scenarios benjamin 1968 huppert and simpson 1980 rottman and simpson 1983 chen and macdonald 2006 frontal processes have been explored in engineering scale studies that ignoring the difference in aspect ratio are comparable to geophysical scale studies the anatomy of the current is fairly consistent across laboratory studies composed of a head region of uniform velocity a dissipative wake region where velocity is nonuniform and greater than the front speed exhibiting kelvin helmholtz billows generated at the head often a tail region is also identified where mixing and overtaking velocities diminish lowe et al 2002 marino et al 2005 a contribution of many studies is the development of formulae to predict frontal froude number f r f g h where g is the reduced gravity and h is the plume depth using characteristics of the flow at and around the head of the current these measures are somewhat difficult to extrapolate to geophysical flows huppert and simpson 1980 rottman and simpson 1983 theoretical values of frontal froude number are well established for the constant velocity phase and tend to be o 1 benjamin 1968 determines f r f 2 using inviscid theory and is fairly accurate in prediction of river plume front speed suggesting that the head of the current is relatively unaffected by the complicated flow trailing the front e g jay et al 2010 importance of frontal mixing to the total mixing of estuarine discharge a variety of studies have evaluated mixing within a plume front and in some cases attempted to extrapolate from these observations the importance of frontal mixing to the plume as a whole luketina and imberger 1987 measure a richardson number consistent with turbulent mixing up to 300 m behind the front in a small tidally pulsed plume orton and jay 2005 suggest that a 100 m zone behind the front is responsible for 20 of mixing in the columbia river tidal plume measured dissipation 10 4 m 2 s 3 though their measurements were later in ebb and extrapolated much more broadly pritchard and huntley 2006 suggest that mixing at the front of a small discharge entering tidally energetic waters is strong enough that a plume does not form 65 of the time during spring tides because plume water is mixed to ambient salinity by frontal processes during its early formation a goal of this study is to quantify the fraction of total source water that interacts with the front which will have implications for the importance of frontal mixing to the total ebb discharge 2 model and methods realistic and idealized numerical simulations of the merrimack river estuary shelf system are used in this study the merrimack is a medium discharge river typically 300 700 m3 s 1 that empties into the gulf of maine it is an ideal location to study plume properties because of a narrow estuary mouth and uncomplicated coastal geometry the regional ocean modeling system roms shchepetkin and mcwilliams 2005 a hydrostatic sigma coordinate model is paired with a curvilinear grid that represents the merrimack river estuary and shelf region on the coast of massachusetts and new hampshire fig 1 the grid spans the head of the merrimack estuary to 20 km offshore and ranges from 10 km upcoast of the estuary mouth to cape ann 20 km downcoast of the mouth near field mixing rates and flow characteristics have been validated in this model and it is applied in hetland and macdonald 2008 and chen et al 2009 the offshore boundary is moved farther offshore in these simulations to ensure the plume is contained in within the domain cole 2014 presents further comparison of model simulated fields with the shipboard high sampling frequency ctd tow yow transects through the core of the plume described in macdonald et al 2007 fig 2 shows some examples of these comparisons all data are linearly interpolated to a grid with 40 m spacing in the offshore direction and 0 25 m in the vertical in general the model represents the plume lift off point well and the location of the core of fresh water during late ebb the model compares to data best in interior plume stratification and plume depth during high discharge but performs well over the range of forcing during 2006 2007 freshet the model has 30 vertical layers and the spatial resolution ranges from 40 m at the mouth to 100 m at the offshore boundaries the width and average depth at the mouth is 276 m and 6 3 m respectively and the model bathymetry includes a shallow bar 300 m seaward of the estuary mouth where fresh water loses contact with the bottom during plume formation fresh water enters the domain 10 km up the river from the estuary mouth it generally takes less than 12 h for a parcel of water to travel the length of the estuary and enter the coastal ocean the model uses mpdata vertical and horizontal tracer advection smolarkiewicz and clark 1986 tracers are horizontally mixed along geopotential surfaces vertical mixing is described by k ϵ turbulence closure coupled with canuto a stability function formulation canuto et al 2001 horizontal smoothing of buoyancy and shear is implemented quadratic bottom friction is incorporated into the momentum equation and conservative parabolic spline reconstruction is used for vertical derivatives in the model a flather boundary condition flather 1976 is used for 2 d velocity components and the free surface and an orlanski boundary condition is used for 3 d velocity components and tracers at the north east and south open boundaries orlanski 1976 for realistic simulations domain wide wind forcing is applied from a noaa meteorological station at the isle of shoals 25 km northeast of the estuary mouth river discharge used in the model is recorded by the usgs at a hydrologic unit at lowell ma a southward flowing 5 cm s 1 ambient coastal current is applied at the northern open boundary waters in the gulf of maine follow a seasonal cycle with fall winter convection from surface to mid water column six major river inflows in spring and restratification in summer the saint john penobscot and kennebec rivers are located upcoast of the merrimack river all with larger discharges influencing the coastal current system the core of the western maine coastal current is typically 2 psu below the ambient salinity 0 2 m s 1 and can be located 40 km offshore however this transport significantly diminishes between penobscot bay and the merrimack estuary the early tidal evolution of the merrimack plume which is the focus of this modeling study is generally more sensitive to residual shelf stratification caused by advection and mixing of past tidal pulses than the gulf of maine coastal current system i e forced internally from within the domain rather than entering at the open boundaries more details about the ambient ocean conditions can be found in geyer et al 2004 and summarized in cole 2014 a 1 5 m semidiurnal tide is forced at the open boundaries by the free surface xtide flater 2005 a harmonic tide clock and time predictor software is used to create forcing xtide uses the same algorithm to predict tides as the us nation ocean service and the prediction at the plum island merrimack river entrance merrimack river massachusetts station is used here the tidal phase is referenced to the sea surface height at the estuary mouth in the analyses presented in this paper estuarine outflow typically starts before high water and generally persists longer than six hours in the simulations modeled physical parameters at the river mouth are presented in fig 3 gray regions highlight tidal cycles analyzed in this study and fig 4 shows surface salinity every 0 5 h over the indicated tides the model is initialized with a background ocean salinity and temperature field the entire model simulation spans the months of april and may 2011 the merrimack estuary is a strongly time dependent salt wedge geyer et al 2008 ralston et al 2010 that spins up quickly especially during freshet the first dye and particles are released 27 days after initialization to ensure a realistic estuarine initial condition realistic ambient stratification in the region near the river mouth is established once the estuary is steady by the older tidal pulses on the shelf location of the tidal plume front is determined by 1000 numerical surface drifters released in an arc behind the front when it emerges from the estuary mouth typically slightly before high water the drifters stay with the front as the plume spreads offshore since the drifters spread apart as time passes the front is linearly interpolated where the distance between drifters is more than 300 m fig 5 shows surface convergence in the plume at four times during an ebb pulse tide a in fig 3 fronts exhibit high convergence the front marked by the drifters red line follows the primary front shown in the surface convergence during ebb therefore the drifters provide a reasonable location of the tidal plume front lagrangian tracking is coded in post processing of the model simulation the surface plume velocity field is used to propagate particles forward in time from 1 u 0 x 1 x 0 δ t 2 v 0 y 1 y 0 δ t where u 0 v 0 x 0 and y 0 are the velocities and particle positions at the current time step x 1 and y 1 are the particle positions at the next time step and δ t is the time step for offline particle tracking which can be greater than the roms internal time step several values of δ t were tested with a final choice of δ t 3 min tracking the front well roms modeled fields are saved approximately every fifteen minutes so the particle tracks are interpolated over this time starting locations of the drifters are spaced across the mouth such that the particles do not overlap initially and no two drifters follow the same path since there is realistic variability amongst the drifter tracks no overlap and good resolution along the front from north to south no artificial diffusion is added to the particle tracking scheme source water pathways are investigated using surface drifter clusters and passive dye tracers released at the estuary mouth during tides a b c d e and f we focus high frequency dye release experiments on the first of the back to back tides a c and e tide a illustrates a classic downcoast turning bulge and tide c presents a relatively radial plume expansion case so they are explored in more detail dye tracers are released full water column at the mouth to study dilution of source water traversing the plume the experiments presented in this research are listed in table 1 a coastal wall is added to the grid at the estuary mouth at mid ebb in the gate experiments described in table 1 damming estuarine discharge this is achieved by running the original grid into ebb stopping the simulation during ebb and using the final simulated fields to initialize a new grid with a wall at the estuary mouth to complete the ebb simulation 3 results 3 1 how much source water reaches the plume front we consider how much dye interacts with the front over the first six hours of ebb starting when the front emerges from the estuary mouth this timing is offset from high water and the duration of ebb outflow varies as expected in a realistically forced model we analyze several ebbs during the early steady propagation frontal phase kilcher and nash 2010 note that some quantity of all dyes released interact with the front even dyes released late in ebb if given enough time however once the plume and front has assimilated into older plume waters the interaction is not relevant to source front connectivity as we have defined it surface dye concentrations and vertical structure over a cross shore transect are given in fig 6 for tide a during mid ebb experiment a3 dye concentration or source water concentration at grid cells is one when released at the mouth and decreases as it is mixed with non source water surface concentrations panels a b and c display the accumulation of dye behind the front in the core of the plume the region offshore and slightly rotated downcoast following the path of fresh water hetland and macdonald 2008 the plume spreads radially early in ebb but the front becomes asymmetric and bulges in the core of the plume by mid ebb the dye depth structure panels d e and f shows that the tail of a dye patch moves slower than dye at the surface because of the sheared current structure in the plume the vertical structure of the first release at high water pink shows the plunge of the frontal head and wake of downwelled water trailing the front the dye depth is a reasonable representation of the plume depth ranging from 5 m at the front to 2 m behind the front which compares favorably to observations it takes several hours for source water to travel through the plume as it grows and only the first dyes released interact with the front during the evolving tidal plume stage source water front interaction is also limited spatially the first dye and surface drifters released spread radially and interact with the front in all directions but the subsequent releases follow the core of the plume along the central axis such that less source water interacts with the upcoast and downcoast portion of the front this behavior may be expected as lateral density gradients weaken as the plume body fills with fresh water these trends are consistent across the ebbs investigated dye releases are performed with higher temporal resolution in experiment a12 we calculate dye concentration weighted mean plume properties for twelve dyes released in 30 min blocks over tide a initially dye releases freshen deepen and increase speed during early mid ebb along with the tidal discharge mean dye concentration in the region of frontal convergence is evaluated dye concentration in grid cells within a 300 m radius of the front are averaged o donnell et al 2008 and horner devine et al 2013 show a frontal decay scale on the order of 15 30 m in plumes of similar scale other studies find that the trailing frontal mixing zone can extend hundred of meters into the plume e g luketina and imberger 1987 the goal here is to characterize the region of water that overtakes the front that may represent a much broader region than the length scale associated with active mixing processes at the front e g the itsweire length scale l i 5 u f n where u f is the frontal propagation speed and n is the buoyancy frequency as discussed by o donnell et al 2008 typically on the order of 10 m mean dye concentration in this estimated frontal zone is evaluated by 3 c f r o n t a l z o n e t f r o n t a l z o n e d y e x y z t d x d y d z f r o n t a l z o n e d x d y d z where x y z and t are east west coordinate north south coordinate vertical coordinate and time variables respectively and dye is the source water concentration most dye released late in ebb does not reach the front until nearly the beginning of the next ebb and by this time the front is one of many discharge fronts in the far field the dye exhibiting maximum concentration in the front in experiment a12 is plotted by release and arrival time in fig 7 this result further illustrates that only water released during early ebb strongly interacts with the tidal plume front we refer to the relationship in fig 7 as the age relation showing that new source water replaces old source water in the front following an approximate linear trend interior plume mixing dilutes source water that reaches the front the frontward flux of source water over ebb q f r o n t t is calculated at a radius r f r o n t 350 m behind the front by 4 q f r o n t t p l u m e u f r o n t θ r f r o n t z t d y e θ r f r o n t z t d s d z where θ is an angle from the mouth u f r o n t is the plume radial velocity in the front following frame rotated in the θ direction d y e is the source water concentration and s θ r f r o n t is a plume arc length source water flux behind the front is evaluated during tide c experiment c1 with dye released throughout ebb the plume spreads essentially radially during tide c facilitating the calculation the flux of source water overtaking the front is shown in the top panel of fig 8 model velocities are rotated in the radial direction from the mouth the plume is divided into 5 angles from the mouth and the mean radial velocity of the front is subtracted from the plume radial velocity field within each angle to investigate plume flow in the front following frame vertical profiles of velocity and source water concentration are used to calculate the radial flux 350 m behind the front plume velocity and source water concentration are averaged 300 400 m behind the front resulting in a mean vertical profile in each angle and the flux is calculated assuming an arc length from a circular spreading front the center panel of fig 8 shows the estuarine discharge measured at the mouth the bottom panel of fig 8 shows the fraction of overtaking source water measured behind the front panel a relative to the total estuarine discharge panel b released at the same time the denominator of the metric plotted in panel c is the value shown in panel b the numerator of the metric plotted in panel c is the value shown in panel a tracked back to time of release calculated from the age relation i e panel a shifted to time of release on x axis the flux of source water behind the front is an order of magnitude smaller than the ebb discharge because much of the ebbed water is mixed in the plume body early in ebb a large percentage of source water overtakes the front overtaking velocities span the entire plume early in its formation but quickly diminish in the interior also contributing to the small percentages throughout most of ebb 3 2 does estuarine outflow influence frontal propagation we consider the front position in the core of the plume in relation to processes at the mouth the plume core is defined by the average coordinate of a propagating group of 100 numerical surface drifters released at the mouth at the start of ebb there is spatial variability in front position throughout the plume so this simplification is necessary the response of the tidal plume front when a gate closes at the estuary mouth is investigated over tide a the gate scenarios are achieved by adding a wall to the grid and re initializing the new grid during ebb wind forcing is eliminated in these cases fig 9 shows results from experiments with and without a gate the right panel shows the position of the plume fronts in both cases at 5 69 h after high water the plume front is defined by the dye concentration gradient the gate is closed at 0 78 h after high water and no additional water is released from the estuary mouth the color contours in the left panel in fig 9 show time evolution of normalized sea surface height anomaly along a transect through the core of the plume dashed line in right panel in the no gate case since the figure illustrates the sea surface over many hours we have removed the tidal height so that only the discharge sea surface anomaly relative to the tide is shown this quantity is normalized by the initial sea surface height anomaly before the plume emerges the position of the plume front along the transect is marked with the black no gate case and gray gate case lines the gray horizontal lines show the time the gate closes and when water released at that time would have reached the front according to the age relation in fig 7 the front response to the gate is not instantaneous the separation of the fronts between the two cases occurs approximately when the source water blocked by the gate would have arrived at the front indicating that overtaking velocities are relatively unaffected by the gate and the source water already released is enough to supply the front and sustain its propagation for several hours this suggests that the front propagates nearly independently of the mouth as in jay et al 2010 but eventually requires replenishing of younger water to maintain its speed 4 discussion the importance of the front to overall plume structure garvine 1982 1987 is not completely confirmed by this work as the transport of plume water after it is mixed through the front is not investigated however this study does confirm that process in the plume body and local frontal dynamics are responsible for frontal propagation throughout most of ebb consistent with macdonald et al 2007 hetland and macdonald 2008 hetland 2010 and jay et al 2010 that emphasize the dynamics of these regions in plume structure this work suggests that source discharge highlighted as a main driver of frontal propagation in kilcher and nash 2010 is important during the early formation of the plume front but diminishes in time although not evaluated directly the importance of frontal mixing to the total mixing of estuarine discharge can be extrapolated from this study simply by the diminishing source front connectivity over much of ebb shown in this study the importance of the front to the total mixing of the estuarine discharge must also be small during early ebb the front is clearly a dynamic feature driving source water mixing and plume structure but its significance decreases as the plume lifts off grows and a dynamic near field mixing region develops that appears to separate and function independently from the propagating frontal region at the seaward boundary previous studies expressing the strong importance of the front to dilution of the total discharge require a definition of a frontal zone orton and jay 2005 pritchard and huntley 2006 huguenard et al 2016 which this work now suggests could also include a connectivity parameter that incorporates the age and origin of water being mixed near the seaward boundary as ebb progresses source front connectivity decreases integrating fig 8 panel c we find 6 5 of discharge released over the first six hours of ebb interacts with the front over that time this metric is the result of summing in time the fraction of the total source water released shown as a percent in the bottom panel of fig 8 panel c since the fraction of source water that reaches the front decreases to almost zero after 1 75 h after high water the fraction of the total ebb discharge that reaches the front is small much of the water that composes the frontal region is not tagged by dye suggesting that the front essentially sustains itself after initial formation buoyancy can also be supplied to the front through entrainment of relatively fresh ambient or older source water throughout the plume when the frontal region is young i e during early ebb we expect much of the plume water behind the front to overtake the front as the plume ages the front decouples from the source this is not a complete decoupling all dyes eventually arrive at the front but in increasingly small amounts and well after six hours of ebb the gate experiments illustrated in fig 9 elucidate the independence of the front from processes at the mouth and the length of time the front can sustain itself without a supply of new plume water from the estuary this study shows that the mixing and translation of source water though the plume body changes significantly over ebb indicating that the dynamics of the front likely do as well although we do not have the capability to look at the details or number of times source water cycles through the front in this model the result has significant implications for the mixing and structure of the frontal region which has not previously been described as a region with significant variability in mixing and structure over the ebb phase of the tide however over ebb the front must transition from a small scale propagating discharge front to an intermediate scale shelf front so these findings are reasonable both non geostrophic i e radial expansion and decreasing barotropic gradients and geostrophic i e turning of streamlines parallel to the front processes can contribute to decreasing connectivity between the mouth and front wind and discharge effect plume advection and mixing and will therefore influence source front connectivity we have selected tidal cycles during light winds and comparable discharge rates to minimize these confounding influences in our analysis wind stress especially from onshore winds that may cause swell and wave breaking in a field scenario gerbi et al 2013 thomson et al 2014 waves are not modeled here will mix the plume body and frontal region and become more influential as the plume grows to increasing surface area we have selected modeled plumes that spread essentially radially to reduce the wind driven orientation of the front as well as the plume velocities behind it it is reasonable to assume that in most wind steered plume scenarios source front connectivity will decrease relative to these base cases high river discharge will increase the plume surface area and shear driven dilution source water experiences as it traverses the plume it is likely that increasing river discharge will increase source front connectivity initially as ebb begins but will then decrease source front connectivity later in ebb due to increased shear mixing in the more expansive plume interior and the relatively stronger barotropic gradient g and velocity at the front compared to these base cases although the connectivity estimate from fig 8 panel c is likely influenced by wind and discharge rate and varies somewhat for each ebb the small percentage suggests that the strong mixing pritchard and huntley 2006 and orton and jay 2005 measure at the plume front may only be representative of frontal dynamics during a snap shot of ebb it is reasonable to conclude that early in ebb the front contributes greatly to net mixing of source water while later in ebb as the maximum discharge is released shear mixing of source water in the energetic plume body is greater than frontal mixing see macdonald and geyer 2004 macdonald et al 2007 and kilcher et al 2012 on the importance of near field mixing to plume evolution as the plume becomes increasingly geostrophic shear induced mixing associated with the front will transition from velocity shear in the radial direction to velocity shear in the along front direction further decreasing the energetics of local mixing processes at the front moreover since so little of the discharge interacts with the front these experiments suggest that the front matters less than previously thought to the mixing of the total ebb discharge in comparison shear mixing in the near field becomes increasingly significant with increasing ebb velocities several ebbs shown in fig 4 demonstrate that the water overtaking the front is the same salinity of the front or saltier as the front transitions beyond the lift off region the flattening of the barotropic surface profile across the plume core can reduce source front connectivity fig 9 illustrates sea surface height anomaly along a plume core transect between the mouth and the front in the base case without a gate high sea surface height is sustained at the mouth increasing over ebb and behind the front extending into the plume several kilometers there is a growing region of low essentially constant sea surface height separating the mouth and front regions as the plume evolves this growing distance between the highly energetic liftoff region and the radial expansion of the plume front results in a flattening of the surface gradient that disconnects the frontal region from the plume core and leads to a broad diffuse region of surface divergence far behind the front this mechanism of diminishing connectivity is illustrated in fig 10 note that a hydrostatic model is limited in its ability to resolve details of the front and the associated trailing region of frontal interaction dye tracer averages over large swaths of the frontal region are reasonable but in depth dynamic analysis of connectivity is left for future work with a non hydrostatic model the response of the front to the gate experiments closed during early ebb indicate that the formation of the frontal region during early ebb influences steady propagation but even then fig 9 shows that after 6 h of ebb the difference in position of the fronts in the core of the plume is similar with and without damming the discharge the front continues to propagate offshore for several hours before it slows when it finally experiences the absence of the estuarine discharge blocked by the gate there is no immediate response in frontal propagation when the gate is closed thus early ebb estuarine discharge influences frontal propagation but with a lag throughout ebb with or without a gate it is plausible that the front propagation in the core is sustained by the local barotropic gradient at the front extending into the plume the gate appears to affect the lateral scale of the plume more than the cross shore extent with later ebb gate closings not shown only slightly affecting the lateral plume scale within a few kilometers of the estuary mouth 5 conclusion the numerical simulations in this study address the communication between the estuary mouth and the tidal plume front the translation of source water through the plume is examined the amount of source water that reaches the front over a single ebb is quantified and the role of time dependent estuarine discharge on frontal propagation is investigated the main conclusion of this study is that much of the total discharge released over an ebb pulse does not interact with the propagating tidal plume front river plume source front connectivity diminishes over ebb and the front essentially decouples from the source and sustains itself as a distinct water mass local frontal dynamics jay et al 2010 and processes in the plume body macdonald et al 2007 are responsible for the advancement of the plume communication with the source kilcher and nash 2010 is less important outside of early plume formation these experiments suggest that the growing distance between the mouth region and the plume front results in a flattening of the surface gradient driving flow in the interior diminishing source front connectivity credit authorship contribution statement kelly l cole conceptualization analysis writing editing daniel g macdonald conceptualization analysis writing editing data curation project management georgia kakoulaki data curation writing editing robert d hetland project management funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work is funded by national science foundation usa awards1756690 1756599 0850622 and 0850948 
23968,river plume source front connectivity kelly l cole conceptualization a daniel g macdonald conceptualization data curation b georgia kakoulaki data curation c robert d hetland funding acquisition d a department of civil and environmental engineering university of maine orono me usa department of civil and environmental engineering university of maine orono me usa school of marine sciences university of maine orono me usa b civil and environmental engineering university of massachusetts dartmouth dartmouth ma usa civil and environmental engineering university of massachusetts dartmouth dartmouth ma usa civil and environmental engineering university of massachusetts dartmouth dartmouth ma usa c department of estuarine and ocean sciences school for marine science and technology university of massachusetts dartmouth new bedford ma usa department of estuarine and ocean sciences school for marine science and technology university of massachusetts dartmouth new bedford ma usa department of estuarine and ocean sciences school for marine science and technology university of massachusetts dartmouth new bedford ma usa d department of oceanography texas a m university college station tx usa department of oceanography texas a m university college station tx usa department of oceanography texas a m university college station tx usa corresponding author river plume source front connectivity or the relationship between processes at the source plume body and front is investigated with numerical simulations of the merrimack river plume using the regional ocean modeling system roms source water i e water discharged from the estuary during an ebb pulse overtakes the front as it propagates offshore resulting in the strong convergence that exists there model results show that much of the water released over an ebb pulse does not interact with the propagating tidal plume front suggesting that the front decouples from the source and sustains itself as a distinct water mass when a gate is closed at the estuary mouth during early ebb the overall plume structure changes gates closed late in ebb do not significantly effect the along or cross shore scale of the plume the change in plume extent is only evident hours after the early ebb gate closing when source water is no longer supplied to the front these experiments suggest that the growing distance between the highly energetic liftoff region and the radial expansion of the plume front results in a flattening of the surface gradient driving flow in the interior diminishing source front connectivity keywords coastal ocean modeling buoyancy driven flow river plumes 1 introduction and background temporal variability of fresh water discharge from estuaries is an important element of the physical environment that shapes coastal ecosystems in tidally modulated regions buoyant water of riverine origin is pulsed from an estuary mouth onto the shelf during the ebb tide the buoyant water shoals and spreads over dense receiving shelf water creating an energetic shear mixing region hetland and macdonald 2008 the plume spreads offshore as the ebb progresses and accumulations of nutrients plankton and other materials may be trapped and transported in the seaward boundary of each ebb pulse by the strong convergence that exists there scotti and pineda 2007 the seaward boundary separating the discharge from ambient ocean water is the frontal region of the river plume the interaction between source water and ambient shelf water is amplified at the tidal plume front recent studies estimate that in some estuary shelf systems the tidal plume front is where a large portion of source water mixing from fresh to ocean salinities takes place orton and jay 2005 pritchard and huntley 2006 similar to the plume behind it horner devine et al 2015 the front undergoes a transition on tidal time scales from a non rotational to a geostrophic phenomenon near the source where the density anomaly and velocity of the outflow strongly affect plume evolution a convective bore like structure is observed at the front as it emerges into the coastal ocean marmorino and trump 2000 the frontal region is characterized by a convergence zone and turbulent wake plunging to a depth several times deeper than the plume behind it kilcher and nash 2010 by the end of the tidal cycle when the front is a great distance away from the mouth the structure of the plume front has begun a transformation towards geostrophy and a structure with many similarities to a shelf break front in cross shore thermal wind balance with reduced vertical mixing e g yankovsky and chapman 1997 thus it is expected that river plume source front connectivity or the relationship between processes at the source plume body and front will exhibit variability over the ebb tide phase previous studies focus on dynamics near the river mouth e g hetland 2005 macdonald et al 2007 hetland 2010 and kilcher et al 2012 or the structure of the plume front e g marmorino and trump 2000 and jay et al 2010 but few studies examine the connection between both regions that we will address in this study early plume models garvine 1982 1987 allow information from the front to travel into the plume along characteristics so that processes at the front establish the structure of the plume body a key theme of these model results and many models that evolved from the garvine series is plume connectivity and a better understanding of the interaction between the plume front and plume interior structure although qualitatively useful these early models fall short in their ability to reproduce many details of the frontal region because of initial assumptions made about the front structure o donnell et al 1998 the goal of this study is to quantify the amount of source water or water released from the estuary over a single ebb pulse that interacts with the tidal plume front this information has been overlooked in previous studies that evaluate total plume mixing at the front through comparison of mixing measurements at the front with fresh water flux at the source the importance of the front to overall plume structure communication between the mouth and the front is achieved through source water traversing the plume and overtaking the front garvine and monk 1974 o donnell et al 1998 marmorino and trump 2000 kilcher and nash 2010 previous laboratory studies of gravity currents and observational studies of buoyant plumes show that fresh water leaves the source travels through the core of the plume and is cycled through the front this supply of buoyant water to the front is necessary to sustain frontal propagation throughout ebb despite early studies highlighting the importance of fronts and their potential for coastal water mass modification garvine and monk 1974 garvine 1982 1987 luketina and imberger 1987 chen 1980 the role of frontal processes in plume evolution is still not well understood recent studies highlight processes at the source near field or front separately but the relative importance of each region to plume propagation is unclear hetland 2010 investigates the effect of inflow variables on plume interior mixing to determine expansion the details of frontal dynamics are overlooked results from macdonald et al 2007 and hetland and macdonald 2008 suggest that g at the front is set by interior mixing as front overtaking waters traverse the plume alternatively jay et al 2010 assumes local frontal dynamics are responsible for the advancement of the plume removing interior plume dynamics in an analytical modeling study kilcher and nash 2010 link ebb discharge at the estuary mouth to frontal propagation however they do not examine the path of source water through the plume core in detail engineering studies applied to the fronts steady propagation phase the front has a convective head structure during the steady propagation phase luketina and imberger 1987 marmorino and trump 2000 kilcher and nash 2010 that can be related to engineering scale gravity currents in a tank or small scale environmental scenarios benjamin 1968 huppert and simpson 1980 rottman and simpson 1983 chen and macdonald 2006 frontal processes have been explored in engineering scale studies that ignoring the difference in aspect ratio are comparable to geophysical scale studies the anatomy of the current is fairly consistent across laboratory studies composed of a head region of uniform velocity a dissipative wake region where velocity is nonuniform and greater than the front speed exhibiting kelvin helmholtz billows generated at the head often a tail region is also identified where mixing and overtaking velocities diminish lowe et al 2002 marino et al 2005 a contribution of many studies is the development of formulae to predict frontal froude number f r f g h where g is the reduced gravity and h is the plume depth using characteristics of the flow at and around the head of the current these measures are somewhat difficult to extrapolate to geophysical flows huppert and simpson 1980 rottman and simpson 1983 theoretical values of frontal froude number are well established for the constant velocity phase and tend to be o 1 benjamin 1968 determines f r f 2 using inviscid theory and is fairly accurate in prediction of river plume front speed suggesting that the head of the current is relatively unaffected by the complicated flow trailing the front e g jay et al 2010 importance of frontal mixing to the total mixing of estuarine discharge a variety of studies have evaluated mixing within a plume front and in some cases attempted to extrapolate from these observations the importance of frontal mixing to the plume as a whole luketina and imberger 1987 measure a richardson number consistent with turbulent mixing up to 300 m behind the front in a small tidally pulsed plume orton and jay 2005 suggest that a 100 m zone behind the front is responsible for 20 of mixing in the columbia river tidal plume measured dissipation 10 4 m 2 s 3 though their measurements were later in ebb and extrapolated much more broadly pritchard and huntley 2006 suggest that mixing at the front of a small discharge entering tidally energetic waters is strong enough that a plume does not form 65 of the time during spring tides because plume water is mixed to ambient salinity by frontal processes during its early formation a goal of this study is to quantify the fraction of total source water that interacts with the front which will have implications for the importance of frontal mixing to the total ebb discharge 2 model and methods realistic and idealized numerical simulations of the merrimack river estuary shelf system are used in this study the merrimack is a medium discharge river typically 300 700 m3 s 1 that empties into the gulf of maine it is an ideal location to study plume properties because of a narrow estuary mouth and uncomplicated coastal geometry the regional ocean modeling system roms shchepetkin and mcwilliams 2005 a hydrostatic sigma coordinate model is paired with a curvilinear grid that represents the merrimack river estuary and shelf region on the coast of massachusetts and new hampshire fig 1 the grid spans the head of the merrimack estuary to 20 km offshore and ranges from 10 km upcoast of the estuary mouth to cape ann 20 km downcoast of the mouth near field mixing rates and flow characteristics have been validated in this model and it is applied in hetland and macdonald 2008 and chen et al 2009 the offshore boundary is moved farther offshore in these simulations to ensure the plume is contained in within the domain cole 2014 presents further comparison of model simulated fields with the shipboard high sampling frequency ctd tow yow transects through the core of the plume described in macdonald et al 2007 fig 2 shows some examples of these comparisons all data are linearly interpolated to a grid with 40 m spacing in the offshore direction and 0 25 m in the vertical in general the model represents the plume lift off point well and the location of the core of fresh water during late ebb the model compares to data best in interior plume stratification and plume depth during high discharge but performs well over the range of forcing during 2006 2007 freshet the model has 30 vertical layers and the spatial resolution ranges from 40 m at the mouth to 100 m at the offshore boundaries the width and average depth at the mouth is 276 m and 6 3 m respectively and the model bathymetry includes a shallow bar 300 m seaward of the estuary mouth where fresh water loses contact with the bottom during plume formation fresh water enters the domain 10 km up the river from the estuary mouth it generally takes less than 12 h for a parcel of water to travel the length of the estuary and enter the coastal ocean the model uses mpdata vertical and horizontal tracer advection smolarkiewicz and clark 1986 tracers are horizontally mixed along geopotential surfaces vertical mixing is described by k ϵ turbulence closure coupled with canuto a stability function formulation canuto et al 2001 horizontal smoothing of buoyancy and shear is implemented quadratic bottom friction is incorporated into the momentum equation and conservative parabolic spline reconstruction is used for vertical derivatives in the model a flather boundary condition flather 1976 is used for 2 d velocity components and the free surface and an orlanski boundary condition is used for 3 d velocity components and tracers at the north east and south open boundaries orlanski 1976 for realistic simulations domain wide wind forcing is applied from a noaa meteorological station at the isle of shoals 25 km northeast of the estuary mouth river discharge used in the model is recorded by the usgs at a hydrologic unit at lowell ma a southward flowing 5 cm s 1 ambient coastal current is applied at the northern open boundary waters in the gulf of maine follow a seasonal cycle with fall winter convection from surface to mid water column six major river inflows in spring and restratification in summer the saint john penobscot and kennebec rivers are located upcoast of the merrimack river all with larger discharges influencing the coastal current system the core of the western maine coastal current is typically 2 psu below the ambient salinity 0 2 m s 1 and can be located 40 km offshore however this transport significantly diminishes between penobscot bay and the merrimack estuary the early tidal evolution of the merrimack plume which is the focus of this modeling study is generally more sensitive to residual shelf stratification caused by advection and mixing of past tidal pulses than the gulf of maine coastal current system i e forced internally from within the domain rather than entering at the open boundaries more details about the ambient ocean conditions can be found in geyer et al 2004 and summarized in cole 2014 a 1 5 m semidiurnal tide is forced at the open boundaries by the free surface xtide flater 2005 a harmonic tide clock and time predictor software is used to create forcing xtide uses the same algorithm to predict tides as the us nation ocean service and the prediction at the plum island merrimack river entrance merrimack river massachusetts station is used here the tidal phase is referenced to the sea surface height at the estuary mouth in the analyses presented in this paper estuarine outflow typically starts before high water and generally persists longer than six hours in the simulations modeled physical parameters at the river mouth are presented in fig 3 gray regions highlight tidal cycles analyzed in this study and fig 4 shows surface salinity every 0 5 h over the indicated tides the model is initialized with a background ocean salinity and temperature field the entire model simulation spans the months of april and may 2011 the merrimack estuary is a strongly time dependent salt wedge geyer et al 2008 ralston et al 2010 that spins up quickly especially during freshet the first dye and particles are released 27 days after initialization to ensure a realistic estuarine initial condition realistic ambient stratification in the region near the river mouth is established once the estuary is steady by the older tidal pulses on the shelf location of the tidal plume front is determined by 1000 numerical surface drifters released in an arc behind the front when it emerges from the estuary mouth typically slightly before high water the drifters stay with the front as the plume spreads offshore since the drifters spread apart as time passes the front is linearly interpolated where the distance between drifters is more than 300 m fig 5 shows surface convergence in the plume at four times during an ebb pulse tide a in fig 3 fronts exhibit high convergence the front marked by the drifters red line follows the primary front shown in the surface convergence during ebb therefore the drifters provide a reasonable location of the tidal plume front lagrangian tracking is coded in post processing of the model simulation the surface plume velocity field is used to propagate particles forward in time from 1 u 0 x 1 x 0 δ t 2 v 0 y 1 y 0 δ t where u 0 v 0 x 0 and y 0 are the velocities and particle positions at the current time step x 1 and y 1 are the particle positions at the next time step and δ t is the time step for offline particle tracking which can be greater than the roms internal time step several values of δ t were tested with a final choice of δ t 3 min tracking the front well roms modeled fields are saved approximately every fifteen minutes so the particle tracks are interpolated over this time starting locations of the drifters are spaced across the mouth such that the particles do not overlap initially and no two drifters follow the same path since there is realistic variability amongst the drifter tracks no overlap and good resolution along the front from north to south no artificial diffusion is added to the particle tracking scheme source water pathways are investigated using surface drifter clusters and passive dye tracers released at the estuary mouth during tides a b c d e and f we focus high frequency dye release experiments on the first of the back to back tides a c and e tide a illustrates a classic downcoast turning bulge and tide c presents a relatively radial plume expansion case so they are explored in more detail dye tracers are released full water column at the mouth to study dilution of source water traversing the plume the experiments presented in this research are listed in table 1 a coastal wall is added to the grid at the estuary mouth at mid ebb in the gate experiments described in table 1 damming estuarine discharge this is achieved by running the original grid into ebb stopping the simulation during ebb and using the final simulated fields to initialize a new grid with a wall at the estuary mouth to complete the ebb simulation 3 results 3 1 how much source water reaches the plume front we consider how much dye interacts with the front over the first six hours of ebb starting when the front emerges from the estuary mouth this timing is offset from high water and the duration of ebb outflow varies as expected in a realistically forced model we analyze several ebbs during the early steady propagation frontal phase kilcher and nash 2010 note that some quantity of all dyes released interact with the front even dyes released late in ebb if given enough time however once the plume and front has assimilated into older plume waters the interaction is not relevant to source front connectivity as we have defined it surface dye concentrations and vertical structure over a cross shore transect are given in fig 6 for tide a during mid ebb experiment a3 dye concentration or source water concentration at grid cells is one when released at the mouth and decreases as it is mixed with non source water surface concentrations panels a b and c display the accumulation of dye behind the front in the core of the plume the region offshore and slightly rotated downcoast following the path of fresh water hetland and macdonald 2008 the plume spreads radially early in ebb but the front becomes asymmetric and bulges in the core of the plume by mid ebb the dye depth structure panels d e and f shows that the tail of a dye patch moves slower than dye at the surface because of the sheared current structure in the plume the vertical structure of the first release at high water pink shows the plunge of the frontal head and wake of downwelled water trailing the front the dye depth is a reasonable representation of the plume depth ranging from 5 m at the front to 2 m behind the front which compares favorably to observations it takes several hours for source water to travel through the plume as it grows and only the first dyes released interact with the front during the evolving tidal plume stage source water front interaction is also limited spatially the first dye and surface drifters released spread radially and interact with the front in all directions but the subsequent releases follow the core of the plume along the central axis such that less source water interacts with the upcoast and downcoast portion of the front this behavior may be expected as lateral density gradients weaken as the plume body fills with fresh water these trends are consistent across the ebbs investigated dye releases are performed with higher temporal resolution in experiment a12 we calculate dye concentration weighted mean plume properties for twelve dyes released in 30 min blocks over tide a initially dye releases freshen deepen and increase speed during early mid ebb along with the tidal discharge mean dye concentration in the region of frontal convergence is evaluated dye concentration in grid cells within a 300 m radius of the front are averaged o donnell et al 2008 and horner devine et al 2013 show a frontal decay scale on the order of 15 30 m in plumes of similar scale other studies find that the trailing frontal mixing zone can extend hundred of meters into the plume e g luketina and imberger 1987 the goal here is to characterize the region of water that overtakes the front that may represent a much broader region than the length scale associated with active mixing processes at the front e g the itsweire length scale l i 5 u f n where u f is the frontal propagation speed and n is the buoyancy frequency as discussed by o donnell et al 2008 typically on the order of 10 m mean dye concentration in this estimated frontal zone is evaluated by 3 c f r o n t a l z o n e t f r o n t a l z o n e d y e x y z t d x d y d z f r o n t a l z o n e d x d y d z where x y z and t are east west coordinate north south coordinate vertical coordinate and time variables respectively and dye is the source water concentration most dye released late in ebb does not reach the front until nearly the beginning of the next ebb and by this time the front is one of many discharge fronts in the far field the dye exhibiting maximum concentration in the front in experiment a12 is plotted by release and arrival time in fig 7 this result further illustrates that only water released during early ebb strongly interacts with the tidal plume front we refer to the relationship in fig 7 as the age relation showing that new source water replaces old source water in the front following an approximate linear trend interior plume mixing dilutes source water that reaches the front the frontward flux of source water over ebb q f r o n t t is calculated at a radius r f r o n t 350 m behind the front by 4 q f r o n t t p l u m e u f r o n t θ r f r o n t z t d y e θ r f r o n t z t d s d z where θ is an angle from the mouth u f r o n t is the plume radial velocity in the front following frame rotated in the θ direction d y e is the source water concentration and s θ r f r o n t is a plume arc length source water flux behind the front is evaluated during tide c experiment c1 with dye released throughout ebb the plume spreads essentially radially during tide c facilitating the calculation the flux of source water overtaking the front is shown in the top panel of fig 8 model velocities are rotated in the radial direction from the mouth the plume is divided into 5 angles from the mouth and the mean radial velocity of the front is subtracted from the plume radial velocity field within each angle to investigate plume flow in the front following frame vertical profiles of velocity and source water concentration are used to calculate the radial flux 350 m behind the front plume velocity and source water concentration are averaged 300 400 m behind the front resulting in a mean vertical profile in each angle and the flux is calculated assuming an arc length from a circular spreading front the center panel of fig 8 shows the estuarine discharge measured at the mouth the bottom panel of fig 8 shows the fraction of overtaking source water measured behind the front panel a relative to the total estuarine discharge panel b released at the same time the denominator of the metric plotted in panel c is the value shown in panel b the numerator of the metric plotted in panel c is the value shown in panel a tracked back to time of release calculated from the age relation i e panel a shifted to time of release on x axis the flux of source water behind the front is an order of magnitude smaller than the ebb discharge because much of the ebbed water is mixed in the plume body early in ebb a large percentage of source water overtakes the front overtaking velocities span the entire plume early in its formation but quickly diminish in the interior also contributing to the small percentages throughout most of ebb 3 2 does estuarine outflow influence frontal propagation we consider the front position in the core of the plume in relation to processes at the mouth the plume core is defined by the average coordinate of a propagating group of 100 numerical surface drifters released at the mouth at the start of ebb there is spatial variability in front position throughout the plume so this simplification is necessary the response of the tidal plume front when a gate closes at the estuary mouth is investigated over tide a the gate scenarios are achieved by adding a wall to the grid and re initializing the new grid during ebb wind forcing is eliminated in these cases fig 9 shows results from experiments with and without a gate the right panel shows the position of the plume fronts in both cases at 5 69 h after high water the plume front is defined by the dye concentration gradient the gate is closed at 0 78 h after high water and no additional water is released from the estuary mouth the color contours in the left panel in fig 9 show time evolution of normalized sea surface height anomaly along a transect through the core of the plume dashed line in right panel in the no gate case since the figure illustrates the sea surface over many hours we have removed the tidal height so that only the discharge sea surface anomaly relative to the tide is shown this quantity is normalized by the initial sea surface height anomaly before the plume emerges the position of the plume front along the transect is marked with the black no gate case and gray gate case lines the gray horizontal lines show the time the gate closes and when water released at that time would have reached the front according to the age relation in fig 7 the front response to the gate is not instantaneous the separation of the fronts between the two cases occurs approximately when the source water blocked by the gate would have arrived at the front indicating that overtaking velocities are relatively unaffected by the gate and the source water already released is enough to supply the front and sustain its propagation for several hours this suggests that the front propagates nearly independently of the mouth as in jay et al 2010 but eventually requires replenishing of younger water to maintain its speed 4 discussion the importance of the front to overall plume structure garvine 1982 1987 is not completely confirmed by this work as the transport of plume water after it is mixed through the front is not investigated however this study does confirm that process in the plume body and local frontal dynamics are responsible for frontal propagation throughout most of ebb consistent with macdonald et al 2007 hetland and macdonald 2008 hetland 2010 and jay et al 2010 that emphasize the dynamics of these regions in plume structure this work suggests that source discharge highlighted as a main driver of frontal propagation in kilcher and nash 2010 is important during the early formation of the plume front but diminishes in time although not evaluated directly the importance of frontal mixing to the total mixing of estuarine discharge can be extrapolated from this study simply by the diminishing source front connectivity over much of ebb shown in this study the importance of the front to the total mixing of the estuarine discharge must also be small during early ebb the front is clearly a dynamic feature driving source water mixing and plume structure but its significance decreases as the plume lifts off grows and a dynamic near field mixing region develops that appears to separate and function independently from the propagating frontal region at the seaward boundary previous studies expressing the strong importance of the front to dilution of the total discharge require a definition of a frontal zone orton and jay 2005 pritchard and huntley 2006 huguenard et al 2016 which this work now suggests could also include a connectivity parameter that incorporates the age and origin of water being mixed near the seaward boundary as ebb progresses source front connectivity decreases integrating fig 8 panel c we find 6 5 of discharge released over the first six hours of ebb interacts with the front over that time this metric is the result of summing in time the fraction of the total source water released shown as a percent in the bottom panel of fig 8 panel c since the fraction of source water that reaches the front decreases to almost zero after 1 75 h after high water the fraction of the total ebb discharge that reaches the front is small much of the water that composes the frontal region is not tagged by dye suggesting that the front essentially sustains itself after initial formation buoyancy can also be supplied to the front through entrainment of relatively fresh ambient or older source water throughout the plume when the frontal region is young i e during early ebb we expect much of the plume water behind the front to overtake the front as the plume ages the front decouples from the source this is not a complete decoupling all dyes eventually arrive at the front but in increasingly small amounts and well after six hours of ebb the gate experiments illustrated in fig 9 elucidate the independence of the front from processes at the mouth and the length of time the front can sustain itself without a supply of new plume water from the estuary this study shows that the mixing and translation of source water though the plume body changes significantly over ebb indicating that the dynamics of the front likely do as well although we do not have the capability to look at the details or number of times source water cycles through the front in this model the result has significant implications for the mixing and structure of the frontal region which has not previously been described as a region with significant variability in mixing and structure over the ebb phase of the tide however over ebb the front must transition from a small scale propagating discharge front to an intermediate scale shelf front so these findings are reasonable both non geostrophic i e radial expansion and decreasing barotropic gradients and geostrophic i e turning of streamlines parallel to the front processes can contribute to decreasing connectivity between the mouth and front wind and discharge effect plume advection and mixing and will therefore influence source front connectivity we have selected tidal cycles during light winds and comparable discharge rates to minimize these confounding influences in our analysis wind stress especially from onshore winds that may cause swell and wave breaking in a field scenario gerbi et al 2013 thomson et al 2014 waves are not modeled here will mix the plume body and frontal region and become more influential as the plume grows to increasing surface area we have selected modeled plumes that spread essentially radially to reduce the wind driven orientation of the front as well as the plume velocities behind it it is reasonable to assume that in most wind steered plume scenarios source front connectivity will decrease relative to these base cases high river discharge will increase the plume surface area and shear driven dilution source water experiences as it traverses the plume it is likely that increasing river discharge will increase source front connectivity initially as ebb begins but will then decrease source front connectivity later in ebb due to increased shear mixing in the more expansive plume interior and the relatively stronger barotropic gradient g and velocity at the front compared to these base cases although the connectivity estimate from fig 8 panel c is likely influenced by wind and discharge rate and varies somewhat for each ebb the small percentage suggests that the strong mixing pritchard and huntley 2006 and orton and jay 2005 measure at the plume front may only be representative of frontal dynamics during a snap shot of ebb it is reasonable to conclude that early in ebb the front contributes greatly to net mixing of source water while later in ebb as the maximum discharge is released shear mixing of source water in the energetic plume body is greater than frontal mixing see macdonald and geyer 2004 macdonald et al 2007 and kilcher et al 2012 on the importance of near field mixing to plume evolution as the plume becomes increasingly geostrophic shear induced mixing associated with the front will transition from velocity shear in the radial direction to velocity shear in the along front direction further decreasing the energetics of local mixing processes at the front moreover since so little of the discharge interacts with the front these experiments suggest that the front matters less than previously thought to the mixing of the total ebb discharge in comparison shear mixing in the near field becomes increasingly significant with increasing ebb velocities several ebbs shown in fig 4 demonstrate that the water overtaking the front is the same salinity of the front or saltier as the front transitions beyond the lift off region the flattening of the barotropic surface profile across the plume core can reduce source front connectivity fig 9 illustrates sea surface height anomaly along a plume core transect between the mouth and the front in the base case without a gate high sea surface height is sustained at the mouth increasing over ebb and behind the front extending into the plume several kilometers there is a growing region of low essentially constant sea surface height separating the mouth and front regions as the plume evolves this growing distance between the highly energetic liftoff region and the radial expansion of the plume front results in a flattening of the surface gradient that disconnects the frontal region from the plume core and leads to a broad diffuse region of surface divergence far behind the front this mechanism of diminishing connectivity is illustrated in fig 10 note that a hydrostatic model is limited in its ability to resolve details of the front and the associated trailing region of frontal interaction dye tracer averages over large swaths of the frontal region are reasonable but in depth dynamic analysis of connectivity is left for future work with a non hydrostatic model the response of the front to the gate experiments closed during early ebb indicate that the formation of the frontal region during early ebb influences steady propagation but even then fig 9 shows that after 6 h of ebb the difference in position of the fronts in the core of the plume is similar with and without damming the discharge the front continues to propagate offshore for several hours before it slows when it finally experiences the absence of the estuarine discharge blocked by the gate there is no immediate response in frontal propagation when the gate is closed thus early ebb estuarine discharge influences frontal propagation but with a lag throughout ebb with or without a gate it is plausible that the front propagation in the core is sustained by the local barotropic gradient at the front extending into the plume the gate appears to affect the lateral scale of the plume more than the cross shore extent with later ebb gate closings not shown only slightly affecting the lateral plume scale within a few kilometers of the estuary mouth 5 conclusion the numerical simulations in this study address the communication between the estuary mouth and the tidal plume front the translation of source water through the plume is examined the amount of source water that reaches the front over a single ebb is quantified and the role of time dependent estuarine discharge on frontal propagation is investigated the main conclusion of this study is that much of the total discharge released over an ebb pulse does not interact with the propagating tidal plume front river plume source front connectivity diminishes over ebb and the front essentially decouples from the source and sustains itself as a distinct water mass local frontal dynamics jay et al 2010 and processes in the plume body macdonald et al 2007 are responsible for the advancement of the plume communication with the source kilcher and nash 2010 is less important outside of early plume formation these experiments suggest that the growing distance between the mouth region and the plume front results in a flattening of the surface gradient driving flow in the interior diminishing source front connectivity credit authorship contribution statement kelly l cole conceptualization analysis writing editing daniel g macdonald conceptualization analysis writing editing data curation project management georgia kakoulaki data curation writing editing robert d hetland project management funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work is funded by national science foundation usa awards1756690 1756599 0850622 and 0850948 
23969,accurate representation of vertical turbulent fluxes is crucial for numerical ocean modeling both in global and coastal applications the state of the art approach is to use two equation turbulence closure models which introduces two dynamic equations to the system solving these equations numerically however is challenging due to the strict requirement of positivity of the turbulent quantities e g turbulence kinetic energy and its dissipation rate and the non linear source terms that may render the numerical system unstable in this paper we present a discontinuous galerkin dg finite element discretization of the generic length scale gls equations designed to be incorporated in a dg coastal ocean model thetis to ensure numerical stability the function space for turbulent quantities must be chosen carefully in this work we propose to use zeroth degree elements for the turbulent quantities and linear discontinuous elements for the tracers and velocity the spatial discretization is completed with a positivity preserving semi implicit time integration scheme we validate the implementation with standard turbulence closure model benchmarks and an idealized estuary simulation finally we use the full three dimensional model to simulate the columbia river plume the results confirm that the coupled model generates realistic vertical mixing and remains stable under strongly stratified conditions and strong tidal forcing river plume characteristics are well captured keywords oceanic turbulence turbulence closure models finite element method discontinuous galerkin method estuarine dynamics river plumes 1 introduction ocean models rely on parametrizations to account for sub grid scale vertical mixing processes the relevant eddy coefficients are obtained by means of turbulence closure models while in some applications simple parametrizations such as algebraic expressions of eddy viscosity and diffusivity can be sufficient in general more sophisticated schemes are needed in order to model the space time evolution of turbulent fluxes representing the dynamic evolution of turbulent fields is crucial especially in coastal buoyancy driven flows vertical mixing plays a major role in bottom boundary layer dynamics evolution of stratification and formation of the surface mixed layer for example it is also essential feature in estuarine circulation and river plume dynamics which in general cannot be simulated without a sophisticated turbulence closure model zero equation parametrizations such as pacanowski and philander 1981 the k profile parametrization kpp large et al 1994 van roekel et al 2018 and the recent epbl parametrization reichl and hallberg 2018 are widely used in ocean models due to their simplicity and low computational cost these methods do not include a prognostic turbulent variable but parametrize the eddy viscosity as a function of the mean flow state consequently they are of limited applicability the kpp and epbl models only parametrize the surface boundary layer and none of the schemes can represent the temporal dynamics of turbulence the most sophisticated turbulence closures are two equation models these models consist of two partial differential equations one for the turbulent kinetic energy tke and another one for an auxiliary turbulent variable that defines the turbulent length scale such models include the mellor yamada level 2 5 model mellor and yamada 1982 k ε rodi 1987 k ω model wilcox 1988 and the generic length scale g e n umlauf and burchard 2003 model the benefit of the gls formulation is that all of the above closures can be obtained merely by changing parameters the turbulent eddy viscosity and diffusivity are obtained from the state variables scaled by so called non dimensional stability functions the most common stability functions are full equilibrium functions by canuto et al 2001 canuto a and b and by cheng et al 2002 quasi equilibrium functions such as by kantha and clayson 1994 are also often used but have shown to be of limited applicability umlauf and burchard 2005 many existing ocean models implement two equation turbulence closure models the generic gls model has become popular in recent years it has been implemented in selfe zhang and baptista 2008 schism zhang et al 2016 roms warner et al 2005 and nemo reffray et al 2015 for example in addition to its original implementation in the gotm library burchard et al 1999 in most cases the gls equations have been implemented in a 1d vertical finite difference or finite volume context e g gotm there have been only a few finite element implementations of two equations turbulence closure models e g hill et al 2012 in this paper we present a finite element discretization of the gls equations intended to be incorporated in a discontinuous galerkin dg three dimensional circulation model the k ε k ω and g e n models are tested with a series of standard benchmark test cases and a realistic simulation of the columbia river plume we consider both the canuto and cheng stability functions for the sake of simplicity we do not consider convective adjustment methods the weak formulation of the gls equations in a three dimensional domain is presented the function space for turbulent quantities must be chosen carefully to ensure numerical stability of the coupled turbulence mean flow system burchard 2002 kärnä et al 2012 we propose using a zeroth order dg space for the turbulent quantities as a natural choice for a linear dg hydrodynamical model this choice also allows a straightforward implementation of the nonlinear source terms the spatial discretization is completed by a positivity preserving semi implicit time integration scheme positivity of the turbulent quantities is ensured by using a l stable implicit solver and patankar treatment of the source terms we present a time integration scheme for the full coupled turbulence mean flow system the gls model is implemented in the thetis ocean model kärnä et al 2018 thetis is built on the firedrake finite element modeling framework rathgeber et al 2016 which uses a domain specific language unified form language alnæs et al 2014 to describe the weak forms a just in time code generator is used to produce computationally efficient c kernels at runtime as such firedrake offers high flexibility in terms of describing the mathematical formulation without sacrificing computational efficiency it also provides flexible support for various high performance computing platforms as the code generator can apply hardware specific optimizations automatically the present work demonstrates that turbulence closure models can be implemented in such domain specific language frameworks the gls equations are presented in section 2 the positivity preserving time integration scheme is presented in section 3 followed by the finite element discretization in 4 test cases are presented in section 5 including a realistic application to the columbia river plume in section 5 4 followed by discussion and conclusions in sections 6 and 7 2 two equation turbulence closure models 2 1 generic length scale equations let ω be the three dimensional domain in cartesian coordinates x y z fig 1a ω spans from the sea floor z h x y to the free surface z η x y the bottom and top surfaces are denoted by γ b and γ s respectively the generic length scale gls turbulence closure model umlauf and burchard 2003 solves the two equations for turbulent kinetic energy tke k and an auxiliary turbulent variable ψ 1 k t h u k w k z z ν σ k k z p b ε 2 ψ t h u ψ w ψ z z ν σ ψ ψ z ψ k c 1 p c 3 b c 2 ε where t denotes the time u u v 0 and w are the horizontal and vertical velocity respectively and h x y 0 is the horizontal gradient operator the vertical eddy viscosity is denoted by ν σ k and σ ψ are the schmidt numbers for the two state variables respectively the second term in eqs 1 2 represents horizontal advection in many ocean models this term is neglected by assuming horizontal homogeneity of turbulence in the coastal ocean however turbulence can vary significantly over short distances and this assumption is not valid a river plume is a good example turbulent conditions change drastically across the plume front which separates the strongly stratified freshwater plume and weakly stratified coastal waters as the front advances in the surface layer failing to transport the turbulent quantities with the front would inevitably lead into erroneus mixing at the plume front the source terms in 1 are production of tke p buoyancy production b and tke dissipation rate ε p and b depend on the vertical shear frequency m and buoyancy brunt väisälä frequency n respectively 3 p ν m 2 4 b ν n 2 5 m 2 u z 2 v z 2 6 n 2 g ρ 0 ρ z where ν is the eddy diffusivity of tracers g is the gravitational acceleration ρ is the density of the water and ρ 0 denotes a constant reference density the term p is always positive indicating that vertical velocity shear generates turbulence p transforms kinetic energy to turbulent kinetic energy burchard 2002 the sign of b on the other hand depends on n 2 for stable stratification n 2 0 b is negative and transforms turbulent kinetic energy to potential energy stratification thus inhibits turbulence in the case of unstable stratification however b is positive and transforms potential energy to turbulence burchard 2002 showed that the numerical implementation of b and p should be energy conservative such that increase of tke by p for example matches the corresponding loss of kinetic energy the dissipation term ε is always positive and represents loss of tke into heat the auxiliary turbulent variable ψ is defined by the parameters p m n 7 ψ c μ 0 p k m l n where c μ 0 is a dimensionless empirical parameter and l is a turbulent length scale the source terms of ψ in 2 also depend on p b and ε but are scaled by ψ k and the empirical constants c 1 c 2 and c 3 which depend on the chosen closure the parameter c 3 controls buoyancy production of ψ it is split into two different values for stable and unstable stratification respectively 8 c 3 c 3 n 2 0 c 3 n 2 0 the parameter c 3 is used to control mixing in unstably stratified conditions for the closures considered herein c 3 1 0 the value of c 3 depends on the closure as discussed in appendix b 1 the tke dissipation rate ε and turbulent length scale l are computed diagnostically from the state variables 9 ε c μ 0 3 k 3 2 l c μ 0 3 p n k 3 2 m n ψ 1 n 10 l c μ 0 3 k 3 2 ε c μ 0 p n k m n ψ 1 n based on 9 it is clear that choosing p 3 m 3 2 n 1 yields ψ ε and results in the k ε model rodi 1987 finally the eddy viscosity and diffusivity are given by 11 ν c μ k 2 ε 12 ν c μ k 2 ε respectively where c μ and c μ are non dimensional stability functions that depend on n 2 and m 2 in this work we consider three different stability functions canuto a and b and cheng as defined in appendix a the values of the empirical parameter c μ 0 and the schmidt number σ ψ are discussed in appendices b 2 and b 3 respectively the used parameter values are listed in table 1 2 1 1 boundary conditions for k and ψ boundary conditions at the surface and bottom boundaries can be derived from the law of the wall conditions within the boundary layer the turbulent length scale grows linearly with the distance to the boundary i e 13 l s κ η z z 0 s 14 l b κ h z z 0 b where κ 0 4 denotes the von karman constant and z 0 s and z 0 b are the corresponding roughness length scales tke in the unresolved boundary layer is burchard et al 1999 15 k s u s 2 c μ 0 2 16 k b u b 2 c μ 0 2 where u s and u b are the friction velocities from 15 16 the neumann condition for k can be derived 17 ν σ k k z γ b γ s 0 which is used as the boundary condition for k note that this is a natural boundary condition in dg finite element formulation as the diffusive boundary term vanishes if k z 0 substituting 13 14 to 7 yields 18 ψ s c μ 0 p k m κ n η z z 0 s n 19 ψ b c μ 0 p k m κ n h z z 0 b n differentiating with respect to z gives 20 ψ s z n c μ 0 p k m κ n η z z 0 s n 1 21 ψ b z n c μ 0 p k m κ n h z z 0 b n 1 in practice the gradients cannot be evaluated right at the boundary because ψ can be changing rapidly we evaluate the boundary conditions at distance δ z 2 from the boundary where δ z is the vertical element size this choice is consistent with most finite volume implementations and results in stable behavior the ψ boundary conditions then become 22 ν σ ψ ψ z γ s n ν σ ψ c μ 0 p k m κ n δ z 2 z 0 s n 1 23 ν σ ψ ψ z γ b n ν σ ψ c μ 0 p k m κ n δ z 2 z 0 b n 1 2 1 2 boundary conditions for the momentum equation regarding the momentum equation see kärnä et al 2018 we impose the log layer bottom friction condition on the bottom boundary 24 ν u z γ b c d u b u b 25 c d κ 2 log z b h z 0 b z 0 b 2 where c d is the drag coefficient z 0 is the bottom roughness length z b is the z coordinate at the middle of the bottom most element and u b u z b on the free surface wind stress τ w is imposed 26 ν u z γ s τ w ρ 0 in applications with atmospheric wind forcing the stress is computed using the formulation by large and pond 1981 and a constant air density ρ a i r 1 22 kg m 3 for tracers impermeable boundary conditions with zero advective and diffusive fluxes are imposed at the surface and bottom boundaries 2 2 steady state solution in a steady state and assuming homogeneous turbulence the source terms of the governing equations 1 2 balance each other resulting in 27 p b ε 0 28 c 1 p c 3 b c 2 ε 0 it is convenient to define non dimensional shear and buoyancy frequencies burchard and bolding 2001 29 α m k 2 ε 2 m 2 30 α n k 2 ε 2 n 2 using the gradient richardson number 31 r i n 2 m 2 α n α m the equilibrium condition 27 28 can be expressed as umlauf and burchard 2003 32 r i s t c μ r i s t c μ r i s t c 2 c 1 c 2 c 3 where c μ and c μ are the stability functions and r i s t denotes the steady state gradient richardson number commonly set to value 0 25 2 3 length scale limitation galperin et al 1988 suggested to limit l as 33 l l m a x c l i m 2 k n umlauf and burchard 2005 show that the limiting factor c l i m is a function of the steady state richardson number 34 c l i m c μ 0 3 2 α n r i s t the length scale limitation can be formulated as a limit on ψ warner et al 2005 35 ψ 1 n 2 c l i m c μ 0 p n k m n 1 2 n 1 note that for negative n 35 imposes a lower limit on ψ in this work we limit ψ only i e no limit is applied on l or ε 3 temporal discretization this section outlines the temporal discretization before introducing the dg discretization in section 4 3 1 thetis coastal ocean model the turbulence closure model was implemented in the thetis three dimensional circulation model kärnä et al 2018 thetis solves the hydrostatic equations with a semi implicit dg finite element method the equations are solved in a time dependent 3d mesh unstructured in the horizontal direction the mesh moves in the vertical direction to track the free surface undulation the mesh movement is implemented with the arbitrary lagrangian eulerian ale method a second order split implicit time integration scheme is used to advance the equations in time advection of 3d fields is solved with an explicit strong stability preserving ssp scheme vertical diffusion is treated implicitly the model formulation is described in detail in kärnä et al 2018 for 3d advection thetis uses a two stage second order ssp runge kutta scheme ssprk 2 2 shu and osher 1988 the ssp property ensures that the solution is non oscillatory as long as the cfl condition is satisfied with dg spatial discretization this implies that the element mean value is positive definite overshoots can still arise within an element to this end a vertex based slope limiter kuzmin 2010 is used to redistribute mass in the element if local overshoots are present the slope limiter is applied as a post processing step after solving the equations kärnä et al 2018 demonstrate that the model is mass conservative typical error being o 1 0 12 and non oscillatory largest overshoots are of order o 1 0 5 in extreme cases in the gls implementation the turbulent quantities are advanced in time similarly to other 3d fields horizontal and vertical advection is solved with the same ssprk ale scheme vertical dynamics of k and ψ are solved implicitly thetis source code is freely available we have also archived the exact source code version used to produce the results in this paper see appendix c 3 2 implicit and explicit terms the governing equations 1 2 are advanced in time with a fractional step method we first separate the explicit advection terms and the remaining implicit terms 36 k t a k k u w d k k ν s k k ε ν ν m n 37 ψ t a ψ ψ u w d ψ ψ ν s ψ ψ k ε ν ν m n where a i i k ψ denote the horizontal and vertical advection terms d i the vertical diffusion terms and s i the source terms 38 s k p b ε 39 s ψ ψ k c 1 p c 3 b c 2 ε let δ t denote the time step given the state variables at time level n the time update of k can be divided into an explicit and implicit steps ψ is treated analogously 40 k k n δ t a k k n u n w n 41 k n 1 k δ t d k k n 1 ν n δ t s k k n 1 ε n ν n ν n m n n n the explicit advection update 40 is solved with the ale ssprk method as described in kärnä et al 2018 the implicit update 41 is presented below note that d k and s k have been linearized with respect to the prognostic variable only k is taken at time level n 1 to ensure mass conservation and positivity preservation of the whole scheme both stages 40 and 41 must satisfy these properties as stated above the 3d advection step is conservative and positivity preserving the implicit scheme however must be designed with care the diffusion operator may introduce oscillations if viscosity or time step is very large moreover the non linear source terms s k and s ψ may cause negative values unless special treatment is applied 3 3 implicit solver for the gls equations the prognostic variables k and ψ are positive by definition the discretized system must maintain positivity of these variables at all times to ensure physically sound and numerically stable solution as the vertical problem is generally stiff it is crucial to use an l stable implicit method to avoid spurious oscillations alexander 1977 hairer and wanner 1996 l stability means that the amplification factor of the scheme tends to zero as the time step tends to infinity effectively dampening unresolved high frequency oscillations it is worth noting that the commonly used crank nicolson method is not l stable and may lead to erratic and unphysical solutions the simplest l stable choice is the backward euler method 41 it is used in kärnä et al 2018 and also employed in this work alternatively a more accurate multi stage l stable diagonally implicit runge kutta scheme could be used e g ascher et al 1997 practical evaluations however showed that using a two stage second order method did not affect the results significantly but did increase the cost of the implicit solve by a factor of two in thetis the domain is decomposed into parallel sub regions in the horizontal direction i e each vertical column of elements lies within a single process because the implicit solve only contains vertical fluxes the implicit solve is local and does not involve parallel communication 3 4 patankar treatment of source terms the non linear source terms must be treated carefully because they can trigger instabilities and or generate negative values positivity preservation is based on the patankar treatment where all sink terms i e s i 0 are treated implicitly patankar 1980 burchard et al 2003 to ensure that they cannot overshoot to produce negative quantities during temporal integration a similar approach is used in gotm for example in the k equation the shear production term p and tke dissipation rate ε are always positive resulting in a source and sink term respectively the sign of the buoyancy production term b on the other hand depends on the sign of n 2 we therefore split the term in two parts b b b with b 0 and b 0 42 b ν min n 2 0 43 b ν max n 2 0 in the ψ equation we have c 1 p 0 and c 2 ε 0 in this case the sign of the b term however also depends on the parameter c 3 c 3 0 is used when b 0 and c 3 when b 0 c 3 can be negative denoting c 3 b c 3 b c 3 b we define 44 c 3 b max c 3 b 0 45 c 3 b min c 3 b 0 we can now split the source terms in 41 to explicit and implicit parts 46 s k n 1 s k n s k n 1 47 s k n p n b n 48 s k n 1 k n 1 k b n ε n note that in s k we have employed the patankar treatment i e scaled the sink term with the ratio k n 1 k to render it implicit here k is the old value due to the fractional stepping the update for ψ is analogous with the source terms 49 s ψ n ψ n k n c 1 p n c 3 b n 50 s ψ n 1 ψ n 1 k n c 3 b n c 2 ε n 3 5 setting minimum values for k and ε the presented solver ensures that k and ψ remain positive throughout the simulation however due to round off errors small negative values can appear which lead into undefined values e g due to the square root in 10 the turbulent quantities are therefore cropped to a small positive minimum value this is a common practice in several implementations e g umlauf et al 2005 warner et al 2005 the minimum values for k and ψ are listed in table 1 in addition we impose minimum values l m i n 1 0 1 0 12 m and ν m i n ν m i n 1 0 1 0 8 m 2 s 1 it should be noted that the user can modify these limits and also introduce additional background viscosity diffusivity if needed these limits are imposed after every update 4 spatial discretization 4 1 mathematical notation the domain ω is divided into three dimensional elements e p the mesh is generated by extruding a two dimensional surface mesh over the vertical dimension the surface mesh consist of either triangles or quads resulting in triangular prisms or hexahedral 3d elements respectively we denote discontinuous galerkin function spaces of degree p by p p dg a function f p p dg is a polynomial of degree p in each element and discontinuous at the element interfaces on the extruded mesh we define function spaces as a cartesian product of the horizontal 2d and vertical 1d elements p p dg p q dg a function in this space is therefore a polynomial of degree p in the horizontal direction and degree q in the vertical direction the set of horizontal and vertical interfaces are denoted by i h and i v respectively fig 1b the outward unit normal vector is denoted by n n x n y n z its restriction on the horizontal and vertical interfaces are denoted by n h and n v respectively the vertical facets i v are strictly vertical implying n v n x n y 0 in the weak forms we use the following notation for volume and interface integrals ω ω d x ω ω d s in interface terms we additionally use the average and jump operators for arbitrary scalar a and vector u fields a 1 2 a a u 1 2 u u a n a n a n u n u n u n where the superscripts and arbitrarily label the values on either side of the interface note that for the outward normal vectors it holds n n 4 2 choosing function spaces the prognostic variables of the gls system 1 2 are k and ψ diagnostic variables include the dissipation rate ε turbulent length scale l vertical eddy viscosity ν and diffusivity ν diagnostic variables originating from the 3d circulation model are the vertical shear frequency m and buoyancy frequency n the choice of the function spaces where these variables reside is crucial for numerical stability and accuracy the production terms p and b are of crucial importance as they can excite spurious modes in the numerical solution because p ν m 2 the function spaces of ν and m determine the polynomial degree of p for example if ν and m are linear p is nominally cubic but could be projected to a lower function space for numerical stability it is natural to choose function spaces that can satisfy the steady state condition p b ε 0 point wise i e in a strong sense instead of an integral weak sense this implies that p b and ε should belong to the same function space as we can have ψ ε it is convenient to choose that k and ψ also belong to the same space this is also desirable because it ensures that the source terms can be directly mapped to the space of the prognostic variables and cannot thus excite spurious modes thetis uses linear discontinuous galerkin elements for 3d tracers and all velocity components that is the variables belong to a function space w 1 p 1 dg p 1 dg consequently u z belongs to p 0 dg space in the vertical direction noting that a product of two functions in p 0 dg still belongs to the same space p 0 dg is a natural choice for the shear frequency m as well the same reasoning holds also for the tracer gradients and squared buoyancy frequency n 2 if one assumes a linear equation of state the above requirements can be satisfied by choosing that the turbulent quantities belong to the degree zero dg space w 0 p 0 dg p 0 dg with this choice we in fact have f g w 0 f g f g f g w 0 which implies that the stability functions and diagnostic variables can be computed point wise the function spaces are summarized in table 2 it would be desirable to use the same w 1 space for k and ψ as well but at least in the case of k ε model this choice violates the p ε steady state condition and leads to unstable solutions finding higher order function spaces for the turbulent quantities remains an open question 4 3 discontinuous galerkin discretization of the gls equations let ϕ w be a test function the weak formulations are derived by taking the continuous equations 1 2 multiplying them by ϕ and integrating over the domain ω the weak formulation then reads find k ψ w such that 51 t k ϕ ω a h k a v k d k s k ϕ w 52 t ψ ϕ ω a h ψ a v ψ d ψ s ψ ϕ w where a h i and a v i i k ψ denote the horizontal and vertical advection terms while d i and s i are the diffusion and source terms respectively the advection terms are discretized with a standard first order dg upwind technique as implemented in the hydrodynamical model kärnä et al 2018 the diffusion terms are treated with symmetric interior penalty galerkin method sipg epshteyn and rivière 2007 with a penalty factor σ 1 l where l is the vertical element size kärnä et al 2018 the source terms are split to sources and sinks as shown in section 3 4 53 s k s k ϕ ω s k s k ϕ ω s k 54 s ψ s ψ ϕ ω s ψ s ψ ϕ ω s ψ let ϕ i be the basis of the function space w we require that the solution belongs to this space i e k ψ w and use the finite element approximations e g k i k i ϕ i using the basis functions as test functions we can write 51 52 in a bilinear form 55 t m k a h k a v k d k s k s k ϕ j w 56 t m ψ a h ψ a v ψ d ψ s ψ s ψ ϕ j w where m i j ϕ i ϕ j ω is the mass matrix and the other terms are also bilinear e g d k d k ϕ i ϕ j 4 4 computing shear and buoyancy frequencies computing the vertical shear and buoyancy frequencies accurately is crucial for maintaining numerical stability kärnä et al 2012 we compute the vertical gradients weakly denoting the shear frequency vector by m u z we define 57 m ϕ ω u ϕ z ω u ϕ n z i h u ϕ n z γ s γ b 58 m 2 m 2 analogously we can compute the ρ z r z 59 r z ϕ ω ρ ϕ z ω ρ ϕ n z i h ρ ϕ n z γ s γ b 60 n 2 g ρ 0 r z 4 5 time integration for convenience we re write the k and ψ weak forms as 61 k t f k k u w g k k ε ν ν m n 62 ψ t f ψ ψ u w g ψ ψ k ε ν ν m n where f k and f ψ contain the advection terms whilst g k and g ψ contain the vertical diffusion and source terms the solution can then be split in explicit advection stage and implicit vertical dynamics stage the explicit stage is solved with ssprk 2 2 scheme kärnä et al 2018 63 k 1 k n δ t f k k n u n w n w m 1 64 k n 1 k n δ t 1 2 f k k n u n w n w m 1 f k k 1 u 1 w 1 w m n 1 where w m denotes the vertical mesh velocity and f denotes the ale weak forms of f k terms see kärnä et al 2018 the advection stage for ψ is derived analogously using a linearized backward euler update the implicit stage reads 65 k n 1 k n 1 δ t g k k n 1 ε n ν n ν n m n n n 66 ψ n 1 ψ n 1 δ t g ψ ψ n 1 k n ε n ν n ν n m n n n the full time integration scheme is summarized in algorithm 1 5 results we first verify the gls implementation with a series of standard turbulence closure test cases followed by a realistic simulation of the columbia river plume all the tests have been carried out with the k ε k ω and the g e n models as defined in table 1 5 1 bottom friction the first test is an open channel with bottom friction the fluid is initially at rest forced only by a constant free surface slope η x 1 1 0 5 in the absence of rotation the flow converges to a steady state solution where the pressure gradient is balanced by the bottom friction near the bed the flow velocity follows the well known logarithmic profile which can be expressed as e g hanert et al 2007 67 u z u b κ log z 0 b z h z 0 b where u b is the bottom friction velocity and z 0 b 1 5 1 0 3 m is the bottom roughness length the bottom friction velocity can be solved from the momentum balance 68 u b g h η x the eddy viscosity follows a parabolic profile 69 ν u b h κ z 0 b z h z the free flow was simulated in a 5 0 km wide square domain with constant 15 m depth horizontal mesh resolution was 2 5 km periodic boundary conditions were used in the x direction initially the flow is at rest a steady state solution is reached after roughly 12 h of simulation all simulations were carried out with 25 s time step first we experimented the three closure models gls k ε and k ω with canuto a stability functions vertical profiles of velocity tke ε l and viscosity are shown in fig 2 in all simulations 250 vertical levels were used resulting in 6 cm vertical resolution the parabolic courant number ν δ t δ z 2 was approximately 300 the velocity profile is close to the analytical logarithmic solution in all cases tke shows the expected nearly linear profile in terms of eddy viscosity the k ω model matches best with the analytical solution gls and k ε models tend to overestimate viscosity in the upper water column while underestimating it in the middle this behavior is in line with other results in the literature warner et al 2005 one possible cause for this deviation is the surface boundary condition for ψ which affects both ψ and l near the free surface fig 2 d second the k ω model was run with different vertical grids consisting of 5 25 and 250 levels fig 3 the corresponding parabolic courant numbers are 0 1 3 and 300 the velocity profiles are close to the analytical solution for all the resolutions as resolution is increased viscosity converges to a parabola close to the analytical solution this test demonstrates that the effective friction felt by the water column does not depend strongly on the vertical resolution in addition it shows that the numerical solver remains stable even with small vertical elements 6 cm third we experimented with the different stability functions we ran the k ω model with canuto a b and cheng stability functions fig 4 in general the choice of the stability function does not have a major impact on the results the results of canuto a and cheng stability functions are nearly identical canuto b functions on the other hand yields slightly lower tke but the difference in viscosity and velocity is negligible the effect of stability functions was similar with other closure models as well not shown 5 2 wind driven entrainment the next test examines mixed layer deepening due to surface stress based on the laboratory experiment originally conducted by kato and phillips 1969 initially the water column is at rest and linearly stratified a constant surface stress is applied at the free surface stress induced mixing leads to a homogeneous surface layer that grows deeper in time the depth of the mixed layer follows the empirical formula suggested by price 1979 70 d ml 1 05 u s t n 0 where u s is the surface friction velocity and n 0 is the initial spatially invariable buoyancy frequency here values u s 0 01 m s 1 and n 0 0 01 s 1 are used n 0 is prescribed by imposing a suitable linear salinity field and using a linear equation of state the mixed layer deepening was simulated in 5 km wide square domain with constant 50 m depth and 2 5 km mesh resolution all simulations were carried out with 30 s time step unless otherwise mentioned six different mesh resolutions δ z 0 2 0 5 1 0 2 0 3 125 and 5 0 m were experimented with resulting in 250 100 50 25 16 and 10 vertical levels respectively the corresponding parabolic courant number ranges from 7 to 0 03 the evolution of the mixed layer depth is presented in fig 5 for k ε model and canuto a stability functions all resolutions result in mixed layer deepening that is in good agreement with the empirical formula 70 with low vertical resolution the mixed layer depth advances in steps as mixing penetrates new elements next we tested the three different turbulence closure models with canuto a stability functions on the medium resolution δ z 0 5 m mesh fig 6 all models reproduce a realistic mixed layer depth the k ε and gls models are close to the empirical mixed layer depth the k ω model tends to under estimate the mixed layer depth especially in the beginning of the simulation but the difference is small these results are in good agreement with previous studies e g warner et al 2005 kärnä et al 2012 we also carried out experiments with different stability functions not shown in all cases the mixed layer depth behaved correctly its variance being similar to what is seen in fig 6 the above tests were carried out with a short time step 30 s close to typical values in regional applications to test how the model can handle stiff problems we increased the time step in the fine grid δ z 0 2 m case up to δ t 1200 s resulting in parabolic courant number of 300 fig 7 in all the presented cases the model remains stable and produces a deepening mixed layer with long time steps 300 s however the deepening of the mixed layer is underestimated especially during the first 10 h of the simulation these results suggest that the scheme is indeed stable for stiff problems but starts to dissipate rapid processes which occur mainly on the onset of the mixed layer in the beginning the observed behavior is consistent with results by reffray et al 2015 where the nemo 1d model also began to underestimate the mixed layer depth for very long time steps 5 3 idealized estuary estuarine circulation is an essential feature in coastal domains it is dominated by the interplay of buoyancy driven stratification and vertical mixing buoyancy input from a river tends to tilt isopycnals and increase stratification in the estuary on the other hand bottom friction and up estuary currents tilt the isopycnals in the opposite direction causing unstable stratification in the bottom layer this generates vigorous mixing at the bed which under suitable conditions can mix the entire water column under sufficiently strong stratification however turbulence cannot penetrate the pycnocline resulting in a well mixed bottom layer that is de coupled from the fresher surface layer the competition between these two tendencies and temporal evolution of the turbulence fields cannot be modeled without a dynamic two equation turbulence closure model we test the model s capability of representing estuarine circulation with the idealized estuary test case by warner et al 2005 this test case has been used to validate other models as well e g slim kärnä et al 2012 and selfe lopez and baptista 2017 the idealized estuary test case does not have an analytical solution furthermore our tests suggest that the numerical solution is highly sensitive to the open boundary conditions which vary in each model due to its discretization as such carrying out a direct comparison of the modeled fields is not beneficial nevertheless this is a useful dynamical test to verify that the coupled model can generate realistic estuarine circulation features it also reveals possible numerical instabilities associated with strong horizontal gradients advection and tidal currents the domain is a rectangular channel 100 km long and 1 km wide depth varies linearly from 10 m at the deep ocean boundary to 5 m in the shallow river end horizontal mesh resolution is 500 m 20 equally distributed vertical levels are used at the river boundary a constant discharge of f r i v e r 400 m 3 s 1 is imposed corresponding to a 8 cm s 1 seaward velocity water elevation is unprescribed and water salinity is set to zero at the ocean boundary a sinusoidal tidal current is imposed with 0 4 m s 1 amplitude and period t t i d e 12 h in addition we superimpose the seaward river flux f r i v e r at ocean boundary as well to ensure tidally averaged volume conservation salinity of in flowing ocean water is set to is 30 psu throughout the simulation temperature is kept at constant 10 c initially water is at rest salinity varies from 30 to 0 psu along the channel between 30 and 80 km from the ocean boundary fig 8a the ocean and river boundary conditions are ramped up for one hour during the simulation estuarine circulation quickly develops driving freshwater seaward in the surface layer a thick salt wedge forms oscillating with the tides the model is spun up for 15 days after which the solution has reached a quasi periodic state where each tidal cycle is nearly identical fig 8 shows the instantaneous salinity distribution after 16 days of simulation for k ε b k ω c and gls models d in all simulations the canuto a stability functions were used the results show a thick salt wedge and a fairly thin seaward flowing surface layer salinity reaches about 80 km from the estuary mouth the k ω model shows lower stratification and shorter salinity intrusion indicating stronger effective mixing the gls model results in the largest salinity intrusion vertical profiles are presented in fig 9 for the three closures the profiles indicate that the well mixed bottom layer fills most of the water column in the upper water column stratification is very strong which limits mixing and results in almost turbulence free surface layer salinity profiles in fig 9 a show that stratification is indeed weaker in the k ω model it also generates higher tke and viscosity in the bottom layer suggesting a larger overall tidally averaged mixing the k ε and gls model behave quite similarly gls however generates lower tke and viscosity which is consistent with the larger salinity intrusion length fig 8 qualitatively the presented results are similar to those in warner et al 2005 kärnä et al 2012 and lopez and baptista 2017 some differences do exist in salt intrusion and stratification for example which could be attributed to differences in the ocean boundary conditions and more generally the model s discretization it should also be noted that the behavior of the three turbulence closure models strongly depends on the chosen parameters 5 4 application to columbia river plume the columbia river is a major freshwater source in the west coast of the united states fig 10 with an annual mean discharge of 5500 m 3 s 1 it is the second largest river in continental usa chawla et al 2008 maximal daily tidal range varies between from less than 2 0 to 3 6 m at the river mouth kärnä et al 2015 the river plume is a major feature in the pacific northwest coast affecting stratification currents and nutrients in the coastal waters hickey and banas 2003 the river plume can be divided into different water masses horner devine et al 2009 define four water masses the source water followed by the tidal re circulating and far field plume the tidal plume with 6 to 12 h time scale consists of a freshwater lens being emitted from the river mouth every tidal cycle once released it rapidly spreads out and becomes thinner its depth ranging from 6 to 3 m salinity is below 21 psu the tidal plume eventually merges with the re circulating plume the re circulating plume forms an anticyclonic bulge at the vicinity of the river mouth in the cross shore direction the bulge is roughly 40 km in diameter the re circulating plume consists of freshwater volume equivalent to 3 4 days of river discharge salinity is between 21 and 24 psu the far field plume lies beyond the re circulating plume it is the zone where final mixing of the plume and ambient ocean waters takes place unaffected by the momentum of the river discharge typically the far field plume forms a large coastal current driven by buoyancy and earth s rotation that can extend hundreds of kilometers north from the river mouth the evolution of the far field plume however is strongly affected by winds and coastal currents the typical northward propagation of the river plume can be arrested by northerly upwelling favorable winds upwelling generates an off shore current in the surface layer eroding the river plume from the coast the plume detaches from the coast spreads out and becomes thinner under sufficiently strong and prevailing winds the plume begins to travel southwest northerly winds are more common in the pacific northwest during summer months which is why the southwest oriented plume is often called the summer plume upwelling favorable winds therefore can reverse the orientation of the plume southerly downwelling favorable winds on the other hand enhance the northward coastal current under downwelling conditions the surface layer flows onshore and pushes the plume against the coast making it narrower and thicker consequently the coastal current becomes more pronounced it becomes narrower and propagates faster to the north the evolution of the river plume was simulated with thetis the computational domain spans from roughly 40 n to 50 n in the zonal direction fig 10 the western boundary is located roughly 100 km west of the coast the columbia river is included in the domain excluding the shallow lateral bays the river boundary is located at beaver army 86 km upstream from the mouth the horizontal mesh resolution triangle edge length ranges from roughly 900 m in the estuary to 15 km at the open ocean boundaries in the vertical direction 20 terrain following layers were used the layer thickness ranges from roughly 1 m near the surface to a maximum of 180 m at the bottom the entire vertical grid adjusts to the free surface similarly to z grid used in structured grid models adcroft and campin 2004 we used a composite bathymetry data kärnä and baptista 2016a that was interpolated on the model grid fig 10 in addition the bathymetry was smoothed with a laplacian diffusion operator to limit strong gradients which could introduce internal pressure errors minimum water depth was set to 3 5 m wetting and drying was neglected atmospheric pressure and 10 m wind were obtained from the north american mesoscale model nam model wind stress was computed with the formulation by large and pond 1981 at the ocean boundary temperature salinity and sub tidal velocity was imposed from the global navy coastal ocean model ncom model barron et al 2006 in addition tidal elevation and velocities were imposed from the tpxo v9 1 model egbert and erofeeva 2002 at the river boundary discharge and water temperature are imposed using us geological survey usgs gauge data salinity is set to zero the simulation covers a time period from may 1 2006 to july 2 the first month is used to spin up the simulation the analysis period is from june 1 onward this spin up time is sufficient for the estuary plume system as the estuary has a residence time of a few days kärnä and baptista 2016b and the far field plume develops in a couple of weeks it is worth noting that the thetis model setup has not been fully calibrated for the system and the results are therefore preliminary an exhaustive model calibration and skill analysis are out of the scope of the present article and will be addressed in the future the simulations were carried out on a linux cluster with 16 core intel xeon e5620 processors and mellanox infiniband interconnect 96 mpi processes were used the simulation had 2 1 0 6 tracer degrees of freedom dof and used 15 s time step the full 90 day simulation took 7 2 days fig 11 shows the atmospheric and fluvial forcing conditions for the analysis period winds alternate between up and downwelling favorable direction fig 11a tides exhibit a typical spring neap variation to the system tidal range varying between 1 6 and 3 4 m river discharge is roughly 10000 m 3 s 1 during the simulation fig 11b and c simulated salinity field is compared against an observational data set from the rise project river influences on shelf ecosystems e g maccready et al 2009 maccready et al 2009 and liu et al 2009 use data from the 2004 summer measurement campaign it should be noted that for the 2006 campaign used in the present analysis the north and south moorings were moved further out from the river mouth by some 80 km see fig 10 for the mooring locations therefore the 2006 data set is well suited for evaluating the behavior of the coastal current and the far field plume under changing wind conditions fig 12 shows time series of observed surface salinity at stations rino rice ogi01 and riso the rice station fig 12b is located in the tidal plume recording the passing of each tidal freshwater lens the model replicates sub tidal and tidal evolution variability of the near field plume well note that exact replication of the tidal signal is difficult as salinity gradients are very large measured salinity therefore strongly depends on the passing of the plume fronts which is sensitive to atmospheric forcing mesh resolution mixing and bathymetry features for instance the ogi01 station fig 12c is located some 25 km southeast from the river mouth it captures the re circulating plume when it is pushed southward from the river mouth typically this occurs during southerly winds during the simulation period two of such events are recorded on june 6 10 and june 18 20 the model captures the southward transport of the plume relatively well especially during the latter event the northern station rino is located in the far field plume region 24 km off the coast fig 12a the narrow coastal current however is often situated closer to the coast the plume passes through rino station only in cases where the winds erode the plume from the coast such events are seen in the observations on june 6 and 18 the model captures those events well although the arrival of the plume is delayed by roughly one day salinity in thetis also tends to be higher compared to the observations the southern station riso captures the wind driven southward traversal of the plume the observations show such an event between june 10 and 21 thetis simulation shows the passage of the plume albeit the onset is delayed by roughly 3 days and surface salinity does not drop as much as in the observations fig 13 shows the evolution of the surface salinity in the thetis simulation prior to the first upwelling event panels a and b the bulge of the re circulating plume is clearly visible just north of the river mouth the far field plume is quite narrow and fresh it travels northward by the coast and does not reach the rino station on the onset of northerly winds panels c and d the far field plume detaches from the coast spreads out and passes through the station as the winds prevail the plume spreads out more and starts to travel southwest panels e h eventually a new coastal plume starts to develop note that in response to the winds the re circulating plume also spreads out dilutes and begins to meander 6 discussion the idealized 1d and estuary test cases show that the gls implementation remains stable and produces realistic bottom and surface layer dynamics as well as estuarine circulation overall the model s performance is in good agreement with results presented in the literature e g warner et al 2005 kärnä et al 2012 all the tested closure models and stability functions yield similar results although some differences do appear for example the differences in the bottom friction test case between different closures fig 2 are mostly due to numerics related to the surface boundary conditions the commonly used choice of k ε and canuto a stability functions however appears to perform well in all test cases the model performance is also strongly dependent on the chosen parameters which can be tuned in applications for example vertical profiles in the bottom friction test are affected by the choice of c μ 0 and σ ψ parameters among others similarly the length of salinity intrusion in the idealized estuary test case fig 8 depends on the magnitude of total mixing which is partially controlled by the minimum value of tke k m i n evidently the parameters could be tuned further to reduce the gap between different closure models for example however such an investigation of the parameter space is out of the scope of the present study the columbia river plume simulation indicates that thetis can represent tidal highly dynamic river plumes the plume features numerous eddies and responds quickly to changing tidal and wind conditions overall the simulation is in good agreement with the observations and known behavior of the columbia plume under up and downwelling conditions e g hickey and banas 2003 qualitatively thetis results compare well with roms and slim vallaeys et al 2018 thetis surface fields show eddies and filaments and strong frontal features are retained over several tidal cycles this suggests that numerical mixing is low as kärnä et al 2018 demonstrated with idealized test cases the presented model uses p 0 dg function space for the turbulent quantities while the mean flow values are in p 1 dg space this choice resembles the staggered discretization used in finite volume models e g in gotm where the mean flow and turbulent variables are defined at cell centers and cell interfaces respectively as the turbulent quantities reside in a lower degree function space it could impact the accuracy of the coupled model however as the turbulence closure model only affects the mean flow model through the eddy viscosity and diffusivity fields the impact is likely to be small deriving a higher order discretization for the turbulent quantities remains a topic for future research similarly ensuring strict energy conservation between the turbulent and mean flow fields will be addressed in the future 7 conclusions we have presented a dg finite element discretization for the gls turbulence closure model and a positivity preserving coupled time integration scheme the turbulence closure model was implemented in the thetis circulation model the model was tested with a series of idealized test cases the results verify that bottom boundary layer surface mixing and estuarine circulation processes are simulated correctly all the three closures k ε k ω and gls and stability functions canuto a b and cheng yield similar performance finally the model was tested in a realistic columbia river plume application the results indicate that the coupled model performs well in complex highly dynamic plume applications the surface salinity values are in good agreement with observations and the plume responds to changing wind forcing the plume shows strong frontal features which suggests low numerical diffusion thetis therefore can retain fronts between water masses and capture the observed plume traversals there is an ever increasing need for accurate less dissipative coastal ocean models that can simulate buoyancy driven coastal flows with a realistic representation of frontal features and vertical mixing as such the presented coupled circulation turbulence model constitutes an important step towards next generation ocean modeling declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments i am grateful to anonymous reviewers whose insightful comments helped to improve the manuscript lawrence mitchell durham university stephan kramer and david ham imperial college london are thanked for their contributions to thetis and continuous support with firedrake antonio baptista oregon health science university is acknowledged for his contribution on the columbia river plume application appendix a stability functions all the non equilibrium stability functions are defined by a set of canonical parameters table 1 in umlauf and burchard 2005 the functions can however be expressed as rational functions of α m and α n with parameters n i d i n b i umlauf and burchard 2005 a 1 c μ n 0 n 1 α n n 2 α m d 0 d 1 α n d 2 α m d 3 α n α m d 4 α n 2 d 5 α m 2 a 2 c μ n b 0 n b 1 α n n b 2 α m d 0 d 1 α n d 2 α m d 3 α n α m d 4 α n 2 d 5 α m 2 canuto et al 2001 introduced two sets of full non equilibrium stability functions usually referred to as canuto a and b the stability region of canuto b functions is somewhat larger than that of version a suggesting that it is more robust in practice umlauf and burchard 2005 another stability function based on a very similar formulation is given by cheng et al 2002 all the three stability function families have been implemented using the formulation a 1 a 2 a 1 limiting α m and α n the stability functions are only defined for a certain values of α n and α m due to numerical and physical reasons first the shear frequency α m is positive by definition to ensure its positivity α n must be limited from below the condition α m 0 corresponds to the equilibrium relation b ε for which it holds eq a 23 in umlauf and burchard 2005 a 3 b ε c μ α n α n 1 this equilibrium condition corresponds to unstably stratified convective regime where α n 0 and b 0 substituting the stability function c μ into a 3 results in a 4 α n min d 1 n b 0 d 1 n b 0 2 4 d 0 d 4 n b 1 2 d 4 n b 1 typical value of α n min is around 3 an alternative constrain to α n is to require monotonicity eq 47 in umlauf and burchard 2005 a 5 α n c μ α n α n 0 which yields more strict limit in this work a 4 is used as it was sufficient in all the tested cases cropping α n at the minimum value may lead to numerical oscillations as the gradient of the stability function is large for negative α n therefore a smoother transition has been proposed eq 19 in burchard et al 1999 a 6 α n α n α n α c 2 α n α n min 2 α c α n α c the smoothness of the transition is controlled by α c defined in range α n min α c 0 here a value α c 1 2 is used in addition the shear frequency α m must be limited from above to ensure physically sound behavior and numerical stability eq 44 in umlauf and burchard 2005 burchard and deleersnijder 2001 a 7 α m max d 0 n 0 d 0 n 1 d 1 n 0 α n d 1 n 1 d 4 n 0 α n 2 d 4 n 1 α n 3 d 2 n 0 d 2 n 1 d 3 n 0 α n d 3 n 1 α n 2 note that α m max depends on α n the limit a 7 is not always sufficient to ensure stability of the numerical scheme deleersnijder et al 2008 present a more generic stability constraint which guarantees that the vertical gradient of the turbulent quantities remains bounded in this work a 7 is used as it has been sufficient for stability we first set α n to α n according to a 6 and then apply the α m max limit appendix b choosing empirical parameters b 1 computing c 3 the parameter c 3 controls the buoyancy production of ψ under stable stratification its value can be computed from 32 b 1 c 3 c 2 c 2 c 1 c μ r i s t c μ r i s t 1 r i s t the value of c 3 thus depends on both the closure parameters c i and the stability functions to evaluate b 1 one first needs to evaluate the stability functions under steady state the steady state condition 27 can also be written as eq 49 in umlauf and burchard 2005 b 2 c μ α m c μ α n 1 from which one obtains a non linear equation b 3 c μ α m r i s t α m c μ α m r i s t α m r i s t 1 from the above equation α m can be solved either analytically or numerically in practice the analytical approach has been more robust and it is used in this work the c 3 values for the three closures and the canuto a stability functions are shown in table 1 b 2 parameter c μ 0 parameter c μ 0 stands for the value of the stability function in unstratified equilibrium where p ε from 31 and b 2 it follows that in equilibrium the stability functions only depend on r i s t c μ c μ r i s t c μ c μ r i s t its value can therefore be computed for each stability function see eq a 22 in umlauf and burchard 2005 b 3 parameter σ ψ a relation for the schmidt number σ ψ and the von karman constant κ can be derived for the logarithmic boundary layer assumption eq 14 in umlauf and burchard 2003 b 4 σ ψ n 2 κ 2 c μ 0 2 c 2 c 1 in this work we compute σ ψ for each closure with κ 0 4 appendix c source code availability the source code used to perform the experiments in this papers is publicly available firedrake and its components may be obtained from https www firedrakeproject org last access 1 february 2020 thetis from http thetisproject org last access 1 february 2020 for reproducibility we also cite archives of the exact software versions used to produce the results in this paper all major firedrake components and the thetis source code have been archived on zenodo zenodo firedrake 2019 zenodo thetis 2019 
23969,accurate representation of vertical turbulent fluxes is crucial for numerical ocean modeling both in global and coastal applications the state of the art approach is to use two equation turbulence closure models which introduces two dynamic equations to the system solving these equations numerically however is challenging due to the strict requirement of positivity of the turbulent quantities e g turbulence kinetic energy and its dissipation rate and the non linear source terms that may render the numerical system unstable in this paper we present a discontinuous galerkin dg finite element discretization of the generic length scale gls equations designed to be incorporated in a dg coastal ocean model thetis to ensure numerical stability the function space for turbulent quantities must be chosen carefully in this work we propose to use zeroth degree elements for the turbulent quantities and linear discontinuous elements for the tracers and velocity the spatial discretization is completed with a positivity preserving semi implicit time integration scheme we validate the implementation with standard turbulence closure model benchmarks and an idealized estuary simulation finally we use the full three dimensional model to simulate the columbia river plume the results confirm that the coupled model generates realistic vertical mixing and remains stable under strongly stratified conditions and strong tidal forcing river plume characteristics are well captured keywords oceanic turbulence turbulence closure models finite element method discontinuous galerkin method estuarine dynamics river plumes 1 introduction ocean models rely on parametrizations to account for sub grid scale vertical mixing processes the relevant eddy coefficients are obtained by means of turbulence closure models while in some applications simple parametrizations such as algebraic expressions of eddy viscosity and diffusivity can be sufficient in general more sophisticated schemes are needed in order to model the space time evolution of turbulent fluxes representing the dynamic evolution of turbulent fields is crucial especially in coastal buoyancy driven flows vertical mixing plays a major role in bottom boundary layer dynamics evolution of stratification and formation of the surface mixed layer for example it is also essential feature in estuarine circulation and river plume dynamics which in general cannot be simulated without a sophisticated turbulence closure model zero equation parametrizations such as pacanowski and philander 1981 the k profile parametrization kpp large et al 1994 van roekel et al 2018 and the recent epbl parametrization reichl and hallberg 2018 are widely used in ocean models due to their simplicity and low computational cost these methods do not include a prognostic turbulent variable but parametrize the eddy viscosity as a function of the mean flow state consequently they are of limited applicability the kpp and epbl models only parametrize the surface boundary layer and none of the schemes can represent the temporal dynamics of turbulence the most sophisticated turbulence closures are two equation models these models consist of two partial differential equations one for the turbulent kinetic energy tke and another one for an auxiliary turbulent variable that defines the turbulent length scale such models include the mellor yamada level 2 5 model mellor and yamada 1982 k ε rodi 1987 k ω model wilcox 1988 and the generic length scale g e n umlauf and burchard 2003 model the benefit of the gls formulation is that all of the above closures can be obtained merely by changing parameters the turbulent eddy viscosity and diffusivity are obtained from the state variables scaled by so called non dimensional stability functions the most common stability functions are full equilibrium functions by canuto et al 2001 canuto a and b and by cheng et al 2002 quasi equilibrium functions such as by kantha and clayson 1994 are also often used but have shown to be of limited applicability umlauf and burchard 2005 many existing ocean models implement two equation turbulence closure models the generic gls model has become popular in recent years it has been implemented in selfe zhang and baptista 2008 schism zhang et al 2016 roms warner et al 2005 and nemo reffray et al 2015 for example in addition to its original implementation in the gotm library burchard et al 1999 in most cases the gls equations have been implemented in a 1d vertical finite difference or finite volume context e g gotm there have been only a few finite element implementations of two equations turbulence closure models e g hill et al 2012 in this paper we present a finite element discretization of the gls equations intended to be incorporated in a discontinuous galerkin dg three dimensional circulation model the k ε k ω and g e n models are tested with a series of standard benchmark test cases and a realistic simulation of the columbia river plume we consider both the canuto and cheng stability functions for the sake of simplicity we do not consider convective adjustment methods the weak formulation of the gls equations in a three dimensional domain is presented the function space for turbulent quantities must be chosen carefully to ensure numerical stability of the coupled turbulence mean flow system burchard 2002 kärnä et al 2012 we propose using a zeroth order dg space for the turbulent quantities as a natural choice for a linear dg hydrodynamical model this choice also allows a straightforward implementation of the nonlinear source terms the spatial discretization is completed by a positivity preserving semi implicit time integration scheme positivity of the turbulent quantities is ensured by using a l stable implicit solver and patankar treatment of the source terms we present a time integration scheme for the full coupled turbulence mean flow system the gls model is implemented in the thetis ocean model kärnä et al 2018 thetis is built on the firedrake finite element modeling framework rathgeber et al 2016 which uses a domain specific language unified form language alnæs et al 2014 to describe the weak forms a just in time code generator is used to produce computationally efficient c kernels at runtime as such firedrake offers high flexibility in terms of describing the mathematical formulation without sacrificing computational efficiency it also provides flexible support for various high performance computing platforms as the code generator can apply hardware specific optimizations automatically the present work demonstrates that turbulence closure models can be implemented in such domain specific language frameworks the gls equations are presented in section 2 the positivity preserving time integration scheme is presented in section 3 followed by the finite element discretization in 4 test cases are presented in section 5 including a realistic application to the columbia river plume in section 5 4 followed by discussion and conclusions in sections 6 and 7 2 two equation turbulence closure models 2 1 generic length scale equations let ω be the three dimensional domain in cartesian coordinates x y z fig 1a ω spans from the sea floor z h x y to the free surface z η x y the bottom and top surfaces are denoted by γ b and γ s respectively the generic length scale gls turbulence closure model umlauf and burchard 2003 solves the two equations for turbulent kinetic energy tke k and an auxiliary turbulent variable ψ 1 k t h u k w k z z ν σ k k z p b ε 2 ψ t h u ψ w ψ z z ν σ ψ ψ z ψ k c 1 p c 3 b c 2 ε where t denotes the time u u v 0 and w are the horizontal and vertical velocity respectively and h x y 0 is the horizontal gradient operator the vertical eddy viscosity is denoted by ν σ k and σ ψ are the schmidt numbers for the two state variables respectively the second term in eqs 1 2 represents horizontal advection in many ocean models this term is neglected by assuming horizontal homogeneity of turbulence in the coastal ocean however turbulence can vary significantly over short distances and this assumption is not valid a river plume is a good example turbulent conditions change drastically across the plume front which separates the strongly stratified freshwater plume and weakly stratified coastal waters as the front advances in the surface layer failing to transport the turbulent quantities with the front would inevitably lead into erroneus mixing at the plume front the source terms in 1 are production of tke p buoyancy production b and tke dissipation rate ε p and b depend on the vertical shear frequency m and buoyancy brunt väisälä frequency n respectively 3 p ν m 2 4 b ν n 2 5 m 2 u z 2 v z 2 6 n 2 g ρ 0 ρ z where ν is the eddy diffusivity of tracers g is the gravitational acceleration ρ is the density of the water and ρ 0 denotes a constant reference density the term p is always positive indicating that vertical velocity shear generates turbulence p transforms kinetic energy to turbulent kinetic energy burchard 2002 the sign of b on the other hand depends on n 2 for stable stratification n 2 0 b is negative and transforms turbulent kinetic energy to potential energy stratification thus inhibits turbulence in the case of unstable stratification however b is positive and transforms potential energy to turbulence burchard 2002 showed that the numerical implementation of b and p should be energy conservative such that increase of tke by p for example matches the corresponding loss of kinetic energy the dissipation term ε is always positive and represents loss of tke into heat the auxiliary turbulent variable ψ is defined by the parameters p m n 7 ψ c μ 0 p k m l n where c μ 0 is a dimensionless empirical parameter and l is a turbulent length scale the source terms of ψ in 2 also depend on p b and ε but are scaled by ψ k and the empirical constants c 1 c 2 and c 3 which depend on the chosen closure the parameter c 3 controls buoyancy production of ψ it is split into two different values for stable and unstable stratification respectively 8 c 3 c 3 n 2 0 c 3 n 2 0 the parameter c 3 is used to control mixing in unstably stratified conditions for the closures considered herein c 3 1 0 the value of c 3 depends on the closure as discussed in appendix b 1 the tke dissipation rate ε and turbulent length scale l are computed diagnostically from the state variables 9 ε c μ 0 3 k 3 2 l c μ 0 3 p n k 3 2 m n ψ 1 n 10 l c μ 0 3 k 3 2 ε c μ 0 p n k m n ψ 1 n based on 9 it is clear that choosing p 3 m 3 2 n 1 yields ψ ε and results in the k ε model rodi 1987 finally the eddy viscosity and diffusivity are given by 11 ν c μ k 2 ε 12 ν c μ k 2 ε respectively where c μ and c μ are non dimensional stability functions that depend on n 2 and m 2 in this work we consider three different stability functions canuto a and b and cheng as defined in appendix a the values of the empirical parameter c μ 0 and the schmidt number σ ψ are discussed in appendices b 2 and b 3 respectively the used parameter values are listed in table 1 2 1 1 boundary conditions for k and ψ boundary conditions at the surface and bottom boundaries can be derived from the law of the wall conditions within the boundary layer the turbulent length scale grows linearly with the distance to the boundary i e 13 l s κ η z z 0 s 14 l b κ h z z 0 b where κ 0 4 denotes the von karman constant and z 0 s and z 0 b are the corresponding roughness length scales tke in the unresolved boundary layer is burchard et al 1999 15 k s u s 2 c μ 0 2 16 k b u b 2 c μ 0 2 where u s and u b are the friction velocities from 15 16 the neumann condition for k can be derived 17 ν σ k k z γ b γ s 0 which is used as the boundary condition for k note that this is a natural boundary condition in dg finite element formulation as the diffusive boundary term vanishes if k z 0 substituting 13 14 to 7 yields 18 ψ s c μ 0 p k m κ n η z z 0 s n 19 ψ b c μ 0 p k m κ n h z z 0 b n differentiating with respect to z gives 20 ψ s z n c μ 0 p k m κ n η z z 0 s n 1 21 ψ b z n c μ 0 p k m κ n h z z 0 b n 1 in practice the gradients cannot be evaluated right at the boundary because ψ can be changing rapidly we evaluate the boundary conditions at distance δ z 2 from the boundary where δ z is the vertical element size this choice is consistent with most finite volume implementations and results in stable behavior the ψ boundary conditions then become 22 ν σ ψ ψ z γ s n ν σ ψ c μ 0 p k m κ n δ z 2 z 0 s n 1 23 ν σ ψ ψ z γ b n ν σ ψ c μ 0 p k m κ n δ z 2 z 0 b n 1 2 1 2 boundary conditions for the momentum equation regarding the momentum equation see kärnä et al 2018 we impose the log layer bottom friction condition on the bottom boundary 24 ν u z γ b c d u b u b 25 c d κ 2 log z b h z 0 b z 0 b 2 where c d is the drag coefficient z 0 is the bottom roughness length z b is the z coordinate at the middle of the bottom most element and u b u z b on the free surface wind stress τ w is imposed 26 ν u z γ s τ w ρ 0 in applications with atmospheric wind forcing the stress is computed using the formulation by large and pond 1981 and a constant air density ρ a i r 1 22 kg m 3 for tracers impermeable boundary conditions with zero advective and diffusive fluxes are imposed at the surface and bottom boundaries 2 2 steady state solution in a steady state and assuming homogeneous turbulence the source terms of the governing equations 1 2 balance each other resulting in 27 p b ε 0 28 c 1 p c 3 b c 2 ε 0 it is convenient to define non dimensional shear and buoyancy frequencies burchard and bolding 2001 29 α m k 2 ε 2 m 2 30 α n k 2 ε 2 n 2 using the gradient richardson number 31 r i n 2 m 2 α n α m the equilibrium condition 27 28 can be expressed as umlauf and burchard 2003 32 r i s t c μ r i s t c μ r i s t c 2 c 1 c 2 c 3 where c μ and c μ are the stability functions and r i s t denotes the steady state gradient richardson number commonly set to value 0 25 2 3 length scale limitation galperin et al 1988 suggested to limit l as 33 l l m a x c l i m 2 k n umlauf and burchard 2005 show that the limiting factor c l i m is a function of the steady state richardson number 34 c l i m c μ 0 3 2 α n r i s t the length scale limitation can be formulated as a limit on ψ warner et al 2005 35 ψ 1 n 2 c l i m c μ 0 p n k m n 1 2 n 1 note that for negative n 35 imposes a lower limit on ψ in this work we limit ψ only i e no limit is applied on l or ε 3 temporal discretization this section outlines the temporal discretization before introducing the dg discretization in section 4 3 1 thetis coastal ocean model the turbulence closure model was implemented in the thetis three dimensional circulation model kärnä et al 2018 thetis solves the hydrostatic equations with a semi implicit dg finite element method the equations are solved in a time dependent 3d mesh unstructured in the horizontal direction the mesh moves in the vertical direction to track the free surface undulation the mesh movement is implemented with the arbitrary lagrangian eulerian ale method a second order split implicit time integration scheme is used to advance the equations in time advection of 3d fields is solved with an explicit strong stability preserving ssp scheme vertical diffusion is treated implicitly the model formulation is described in detail in kärnä et al 2018 for 3d advection thetis uses a two stage second order ssp runge kutta scheme ssprk 2 2 shu and osher 1988 the ssp property ensures that the solution is non oscillatory as long as the cfl condition is satisfied with dg spatial discretization this implies that the element mean value is positive definite overshoots can still arise within an element to this end a vertex based slope limiter kuzmin 2010 is used to redistribute mass in the element if local overshoots are present the slope limiter is applied as a post processing step after solving the equations kärnä et al 2018 demonstrate that the model is mass conservative typical error being o 1 0 12 and non oscillatory largest overshoots are of order o 1 0 5 in extreme cases in the gls implementation the turbulent quantities are advanced in time similarly to other 3d fields horizontal and vertical advection is solved with the same ssprk ale scheme vertical dynamics of k and ψ are solved implicitly thetis source code is freely available we have also archived the exact source code version used to produce the results in this paper see appendix c 3 2 implicit and explicit terms the governing equations 1 2 are advanced in time with a fractional step method we first separate the explicit advection terms and the remaining implicit terms 36 k t a k k u w d k k ν s k k ε ν ν m n 37 ψ t a ψ ψ u w d ψ ψ ν s ψ ψ k ε ν ν m n where a i i k ψ denote the horizontal and vertical advection terms d i the vertical diffusion terms and s i the source terms 38 s k p b ε 39 s ψ ψ k c 1 p c 3 b c 2 ε let δ t denote the time step given the state variables at time level n the time update of k can be divided into an explicit and implicit steps ψ is treated analogously 40 k k n δ t a k k n u n w n 41 k n 1 k δ t d k k n 1 ν n δ t s k k n 1 ε n ν n ν n m n n n the explicit advection update 40 is solved with the ale ssprk method as described in kärnä et al 2018 the implicit update 41 is presented below note that d k and s k have been linearized with respect to the prognostic variable only k is taken at time level n 1 to ensure mass conservation and positivity preservation of the whole scheme both stages 40 and 41 must satisfy these properties as stated above the 3d advection step is conservative and positivity preserving the implicit scheme however must be designed with care the diffusion operator may introduce oscillations if viscosity or time step is very large moreover the non linear source terms s k and s ψ may cause negative values unless special treatment is applied 3 3 implicit solver for the gls equations the prognostic variables k and ψ are positive by definition the discretized system must maintain positivity of these variables at all times to ensure physically sound and numerically stable solution as the vertical problem is generally stiff it is crucial to use an l stable implicit method to avoid spurious oscillations alexander 1977 hairer and wanner 1996 l stability means that the amplification factor of the scheme tends to zero as the time step tends to infinity effectively dampening unresolved high frequency oscillations it is worth noting that the commonly used crank nicolson method is not l stable and may lead to erratic and unphysical solutions the simplest l stable choice is the backward euler method 41 it is used in kärnä et al 2018 and also employed in this work alternatively a more accurate multi stage l stable diagonally implicit runge kutta scheme could be used e g ascher et al 1997 practical evaluations however showed that using a two stage second order method did not affect the results significantly but did increase the cost of the implicit solve by a factor of two in thetis the domain is decomposed into parallel sub regions in the horizontal direction i e each vertical column of elements lies within a single process because the implicit solve only contains vertical fluxes the implicit solve is local and does not involve parallel communication 3 4 patankar treatment of source terms the non linear source terms must be treated carefully because they can trigger instabilities and or generate negative values positivity preservation is based on the patankar treatment where all sink terms i e s i 0 are treated implicitly patankar 1980 burchard et al 2003 to ensure that they cannot overshoot to produce negative quantities during temporal integration a similar approach is used in gotm for example in the k equation the shear production term p and tke dissipation rate ε are always positive resulting in a source and sink term respectively the sign of the buoyancy production term b on the other hand depends on the sign of n 2 we therefore split the term in two parts b b b with b 0 and b 0 42 b ν min n 2 0 43 b ν max n 2 0 in the ψ equation we have c 1 p 0 and c 2 ε 0 in this case the sign of the b term however also depends on the parameter c 3 c 3 0 is used when b 0 and c 3 when b 0 c 3 can be negative denoting c 3 b c 3 b c 3 b we define 44 c 3 b max c 3 b 0 45 c 3 b min c 3 b 0 we can now split the source terms in 41 to explicit and implicit parts 46 s k n 1 s k n s k n 1 47 s k n p n b n 48 s k n 1 k n 1 k b n ε n note that in s k we have employed the patankar treatment i e scaled the sink term with the ratio k n 1 k to render it implicit here k is the old value due to the fractional stepping the update for ψ is analogous with the source terms 49 s ψ n ψ n k n c 1 p n c 3 b n 50 s ψ n 1 ψ n 1 k n c 3 b n c 2 ε n 3 5 setting minimum values for k and ε the presented solver ensures that k and ψ remain positive throughout the simulation however due to round off errors small negative values can appear which lead into undefined values e g due to the square root in 10 the turbulent quantities are therefore cropped to a small positive minimum value this is a common practice in several implementations e g umlauf et al 2005 warner et al 2005 the minimum values for k and ψ are listed in table 1 in addition we impose minimum values l m i n 1 0 1 0 12 m and ν m i n ν m i n 1 0 1 0 8 m 2 s 1 it should be noted that the user can modify these limits and also introduce additional background viscosity diffusivity if needed these limits are imposed after every update 4 spatial discretization 4 1 mathematical notation the domain ω is divided into three dimensional elements e p the mesh is generated by extruding a two dimensional surface mesh over the vertical dimension the surface mesh consist of either triangles or quads resulting in triangular prisms or hexahedral 3d elements respectively we denote discontinuous galerkin function spaces of degree p by p p dg a function f p p dg is a polynomial of degree p in each element and discontinuous at the element interfaces on the extruded mesh we define function spaces as a cartesian product of the horizontal 2d and vertical 1d elements p p dg p q dg a function in this space is therefore a polynomial of degree p in the horizontal direction and degree q in the vertical direction the set of horizontal and vertical interfaces are denoted by i h and i v respectively fig 1b the outward unit normal vector is denoted by n n x n y n z its restriction on the horizontal and vertical interfaces are denoted by n h and n v respectively the vertical facets i v are strictly vertical implying n v n x n y 0 in the weak forms we use the following notation for volume and interface integrals ω ω d x ω ω d s in interface terms we additionally use the average and jump operators for arbitrary scalar a and vector u fields a 1 2 a a u 1 2 u u a n a n a n u n u n u n where the superscripts and arbitrarily label the values on either side of the interface note that for the outward normal vectors it holds n n 4 2 choosing function spaces the prognostic variables of the gls system 1 2 are k and ψ diagnostic variables include the dissipation rate ε turbulent length scale l vertical eddy viscosity ν and diffusivity ν diagnostic variables originating from the 3d circulation model are the vertical shear frequency m and buoyancy frequency n the choice of the function spaces where these variables reside is crucial for numerical stability and accuracy the production terms p and b are of crucial importance as they can excite spurious modes in the numerical solution because p ν m 2 the function spaces of ν and m determine the polynomial degree of p for example if ν and m are linear p is nominally cubic but could be projected to a lower function space for numerical stability it is natural to choose function spaces that can satisfy the steady state condition p b ε 0 point wise i e in a strong sense instead of an integral weak sense this implies that p b and ε should belong to the same function space as we can have ψ ε it is convenient to choose that k and ψ also belong to the same space this is also desirable because it ensures that the source terms can be directly mapped to the space of the prognostic variables and cannot thus excite spurious modes thetis uses linear discontinuous galerkin elements for 3d tracers and all velocity components that is the variables belong to a function space w 1 p 1 dg p 1 dg consequently u z belongs to p 0 dg space in the vertical direction noting that a product of two functions in p 0 dg still belongs to the same space p 0 dg is a natural choice for the shear frequency m as well the same reasoning holds also for the tracer gradients and squared buoyancy frequency n 2 if one assumes a linear equation of state the above requirements can be satisfied by choosing that the turbulent quantities belong to the degree zero dg space w 0 p 0 dg p 0 dg with this choice we in fact have f g w 0 f g f g f g w 0 which implies that the stability functions and diagnostic variables can be computed point wise the function spaces are summarized in table 2 it would be desirable to use the same w 1 space for k and ψ as well but at least in the case of k ε model this choice violates the p ε steady state condition and leads to unstable solutions finding higher order function spaces for the turbulent quantities remains an open question 4 3 discontinuous galerkin discretization of the gls equations let ϕ w be a test function the weak formulations are derived by taking the continuous equations 1 2 multiplying them by ϕ and integrating over the domain ω the weak formulation then reads find k ψ w such that 51 t k ϕ ω a h k a v k d k s k ϕ w 52 t ψ ϕ ω a h ψ a v ψ d ψ s ψ ϕ w where a h i and a v i i k ψ denote the horizontal and vertical advection terms while d i and s i are the diffusion and source terms respectively the advection terms are discretized with a standard first order dg upwind technique as implemented in the hydrodynamical model kärnä et al 2018 the diffusion terms are treated with symmetric interior penalty galerkin method sipg epshteyn and rivière 2007 with a penalty factor σ 1 l where l is the vertical element size kärnä et al 2018 the source terms are split to sources and sinks as shown in section 3 4 53 s k s k ϕ ω s k s k ϕ ω s k 54 s ψ s ψ ϕ ω s ψ s ψ ϕ ω s ψ let ϕ i be the basis of the function space w we require that the solution belongs to this space i e k ψ w and use the finite element approximations e g k i k i ϕ i using the basis functions as test functions we can write 51 52 in a bilinear form 55 t m k a h k a v k d k s k s k ϕ j w 56 t m ψ a h ψ a v ψ d ψ s ψ s ψ ϕ j w where m i j ϕ i ϕ j ω is the mass matrix and the other terms are also bilinear e g d k d k ϕ i ϕ j 4 4 computing shear and buoyancy frequencies computing the vertical shear and buoyancy frequencies accurately is crucial for maintaining numerical stability kärnä et al 2012 we compute the vertical gradients weakly denoting the shear frequency vector by m u z we define 57 m ϕ ω u ϕ z ω u ϕ n z i h u ϕ n z γ s γ b 58 m 2 m 2 analogously we can compute the ρ z r z 59 r z ϕ ω ρ ϕ z ω ρ ϕ n z i h ρ ϕ n z γ s γ b 60 n 2 g ρ 0 r z 4 5 time integration for convenience we re write the k and ψ weak forms as 61 k t f k k u w g k k ε ν ν m n 62 ψ t f ψ ψ u w g ψ ψ k ε ν ν m n where f k and f ψ contain the advection terms whilst g k and g ψ contain the vertical diffusion and source terms the solution can then be split in explicit advection stage and implicit vertical dynamics stage the explicit stage is solved with ssprk 2 2 scheme kärnä et al 2018 63 k 1 k n δ t f k k n u n w n w m 1 64 k n 1 k n δ t 1 2 f k k n u n w n w m 1 f k k 1 u 1 w 1 w m n 1 where w m denotes the vertical mesh velocity and f denotes the ale weak forms of f k terms see kärnä et al 2018 the advection stage for ψ is derived analogously using a linearized backward euler update the implicit stage reads 65 k n 1 k n 1 δ t g k k n 1 ε n ν n ν n m n n n 66 ψ n 1 ψ n 1 δ t g ψ ψ n 1 k n ε n ν n ν n m n n n the full time integration scheme is summarized in algorithm 1 5 results we first verify the gls implementation with a series of standard turbulence closure test cases followed by a realistic simulation of the columbia river plume all the tests have been carried out with the k ε k ω and the g e n models as defined in table 1 5 1 bottom friction the first test is an open channel with bottom friction the fluid is initially at rest forced only by a constant free surface slope η x 1 1 0 5 in the absence of rotation the flow converges to a steady state solution where the pressure gradient is balanced by the bottom friction near the bed the flow velocity follows the well known logarithmic profile which can be expressed as e g hanert et al 2007 67 u z u b κ log z 0 b z h z 0 b where u b is the bottom friction velocity and z 0 b 1 5 1 0 3 m is the bottom roughness length the bottom friction velocity can be solved from the momentum balance 68 u b g h η x the eddy viscosity follows a parabolic profile 69 ν u b h κ z 0 b z h z the free flow was simulated in a 5 0 km wide square domain with constant 15 m depth horizontal mesh resolution was 2 5 km periodic boundary conditions were used in the x direction initially the flow is at rest a steady state solution is reached after roughly 12 h of simulation all simulations were carried out with 25 s time step first we experimented the three closure models gls k ε and k ω with canuto a stability functions vertical profiles of velocity tke ε l and viscosity are shown in fig 2 in all simulations 250 vertical levels were used resulting in 6 cm vertical resolution the parabolic courant number ν δ t δ z 2 was approximately 300 the velocity profile is close to the analytical logarithmic solution in all cases tke shows the expected nearly linear profile in terms of eddy viscosity the k ω model matches best with the analytical solution gls and k ε models tend to overestimate viscosity in the upper water column while underestimating it in the middle this behavior is in line with other results in the literature warner et al 2005 one possible cause for this deviation is the surface boundary condition for ψ which affects both ψ and l near the free surface fig 2 d second the k ω model was run with different vertical grids consisting of 5 25 and 250 levels fig 3 the corresponding parabolic courant numbers are 0 1 3 and 300 the velocity profiles are close to the analytical solution for all the resolutions as resolution is increased viscosity converges to a parabola close to the analytical solution this test demonstrates that the effective friction felt by the water column does not depend strongly on the vertical resolution in addition it shows that the numerical solver remains stable even with small vertical elements 6 cm third we experimented with the different stability functions we ran the k ω model with canuto a b and cheng stability functions fig 4 in general the choice of the stability function does not have a major impact on the results the results of canuto a and cheng stability functions are nearly identical canuto b functions on the other hand yields slightly lower tke but the difference in viscosity and velocity is negligible the effect of stability functions was similar with other closure models as well not shown 5 2 wind driven entrainment the next test examines mixed layer deepening due to surface stress based on the laboratory experiment originally conducted by kato and phillips 1969 initially the water column is at rest and linearly stratified a constant surface stress is applied at the free surface stress induced mixing leads to a homogeneous surface layer that grows deeper in time the depth of the mixed layer follows the empirical formula suggested by price 1979 70 d ml 1 05 u s t n 0 where u s is the surface friction velocity and n 0 is the initial spatially invariable buoyancy frequency here values u s 0 01 m s 1 and n 0 0 01 s 1 are used n 0 is prescribed by imposing a suitable linear salinity field and using a linear equation of state the mixed layer deepening was simulated in 5 km wide square domain with constant 50 m depth and 2 5 km mesh resolution all simulations were carried out with 30 s time step unless otherwise mentioned six different mesh resolutions δ z 0 2 0 5 1 0 2 0 3 125 and 5 0 m were experimented with resulting in 250 100 50 25 16 and 10 vertical levels respectively the corresponding parabolic courant number ranges from 7 to 0 03 the evolution of the mixed layer depth is presented in fig 5 for k ε model and canuto a stability functions all resolutions result in mixed layer deepening that is in good agreement with the empirical formula 70 with low vertical resolution the mixed layer depth advances in steps as mixing penetrates new elements next we tested the three different turbulence closure models with canuto a stability functions on the medium resolution δ z 0 5 m mesh fig 6 all models reproduce a realistic mixed layer depth the k ε and gls models are close to the empirical mixed layer depth the k ω model tends to under estimate the mixed layer depth especially in the beginning of the simulation but the difference is small these results are in good agreement with previous studies e g warner et al 2005 kärnä et al 2012 we also carried out experiments with different stability functions not shown in all cases the mixed layer depth behaved correctly its variance being similar to what is seen in fig 6 the above tests were carried out with a short time step 30 s close to typical values in regional applications to test how the model can handle stiff problems we increased the time step in the fine grid δ z 0 2 m case up to δ t 1200 s resulting in parabolic courant number of 300 fig 7 in all the presented cases the model remains stable and produces a deepening mixed layer with long time steps 300 s however the deepening of the mixed layer is underestimated especially during the first 10 h of the simulation these results suggest that the scheme is indeed stable for stiff problems but starts to dissipate rapid processes which occur mainly on the onset of the mixed layer in the beginning the observed behavior is consistent with results by reffray et al 2015 where the nemo 1d model also began to underestimate the mixed layer depth for very long time steps 5 3 idealized estuary estuarine circulation is an essential feature in coastal domains it is dominated by the interplay of buoyancy driven stratification and vertical mixing buoyancy input from a river tends to tilt isopycnals and increase stratification in the estuary on the other hand bottom friction and up estuary currents tilt the isopycnals in the opposite direction causing unstable stratification in the bottom layer this generates vigorous mixing at the bed which under suitable conditions can mix the entire water column under sufficiently strong stratification however turbulence cannot penetrate the pycnocline resulting in a well mixed bottom layer that is de coupled from the fresher surface layer the competition between these two tendencies and temporal evolution of the turbulence fields cannot be modeled without a dynamic two equation turbulence closure model we test the model s capability of representing estuarine circulation with the idealized estuary test case by warner et al 2005 this test case has been used to validate other models as well e g slim kärnä et al 2012 and selfe lopez and baptista 2017 the idealized estuary test case does not have an analytical solution furthermore our tests suggest that the numerical solution is highly sensitive to the open boundary conditions which vary in each model due to its discretization as such carrying out a direct comparison of the modeled fields is not beneficial nevertheless this is a useful dynamical test to verify that the coupled model can generate realistic estuarine circulation features it also reveals possible numerical instabilities associated with strong horizontal gradients advection and tidal currents the domain is a rectangular channel 100 km long and 1 km wide depth varies linearly from 10 m at the deep ocean boundary to 5 m in the shallow river end horizontal mesh resolution is 500 m 20 equally distributed vertical levels are used at the river boundary a constant discharge of f r i v e r 400 m 3 s 1 is imposed corresponding to a 8 cm s 1 seaward velocity water elevation is unprescribed and water salinity is set to zero at the ocean boundary a sinusoidal tidal current is imposed with 0 4 m s 1 amplitude and period t t i d e 12 h in addition we superimpose the seaward river flux f r i v e r at ocean boundary as well to ensure tidally averaged volume conservation salinity of in flowing ocean water is set to is 30 psu throughout the simulation temperature is kept at constant 10 c initially water is at rest salinity varies from 30 to 0 psu along the channel between 30 and 80 km from the ocean boundary fig 8a the ocean and river boundary conditions are ramped up for one hour during the simulation estuarine circulation quickly develops driving freshwater seaward in the surface layer a thick salt wedge forms oscillating with the tides the model is spun up for 15 days after which the solution has reached a quasi periodic state where each tidal cycle is nearly identical fig 8 shows the instantaneous salinity distribution after 16 days of simulation for k ε b k ω c and gls models d in all simulations the canuto a stability functions were used the results show a thick salt wedge and a fairly thin seaward flowing surface layer salinity reaches about 80 km from the estuary mouth the k ω model shows lower stratification and shorter salinity intrusion indicating stronger effective mixing the gls model results in the largest salinity intrusion vertical profiles are presented in fig 9 for the three closures the profiles indicate that the well mixed bottom layer fills most of the water column in the upper water column stratification is very strong which limits mixing and results in almost turbulence free surface layer salinity profiles in fig 9 a show that stratification is indeed weaker in the k ω model it also generates higher tke and viscosity in the bottom layer suggesting a larger overall tidally averaged mixing the k ε and gls model behave quite similarly gls however generates lower tke and viscosity which is consistent with the larger salinity intrusion length fig 8 qualitatively the presented results are similar to those in warner et al 2005 kärnä et al 2012 and lopez and baptista 2017 some differences do exist in salt intrusion and stratification for example which could be attributed to differences in the ocean boundary conditions and more generally the model s discretization it should also be noted that the behavior of the three turbulence closure models strongly depends on the chosen parameters 5 4 application to columbia river plume the columbia river is a major freshwater source in the west coast of the united states fig 10 with an annual mean discharge of 5500 m 3 s 1 it is the second largest river in continental usa chawla et al 2008 maximal daily tidal range varies between from less than 2 0 to 3 6 m at the river mouth kärnä et al 2015 the river plume is a major feature in the pacific northwest coast affecting stratification currents and nutrients in the coastal waters hickey and banas 2003 the river plume can be divided into different water masses horner devine et al 2009 define four water masses the source water followed by the tidal re circulating and far field plume the tidal plume with 6 to 12 h time scale consists of a freshwater lens being emitted from the river mouth every tidal cycle once released it rapidly spreads out and becomes thinner its depth ranging from 6 to 3 m salinity is below 21 psu the tidal plume eventually merges with the re circulating plume the re circulating plume forms an anticyclonic bulge at the vicinity of the river mouth in the cross shore direction the bulge is roughly 40 km in diameter the re circulating plume consists of freshwater volume equivalent to 3 4 days of river discharge salinity is between 21 and 24 psu the far field plume lies beyond the re circulating plume it is the zone where final mixing of the plume and ambient ocean waters takes place unaffected by the momentum of the river discharge typically the far field plume forms a large coastal current driven by buoyancy and earth s rotation that can extend hundreds of kilometers north from the river mouth the evolution of the far field plume however is strongly affected by winds and coastal currents the typical northward propagation of the river plume can be arrested by northerly upwelling favorable winds upwelling generates an off shore current in the surface layer eroding the river plume from the coast the plume detaches from the coast spreads out and becomes thinner under sufficiently strong and prevailing winds the plume begins to travel southwest northerly winds are more common in the pacific northwest during summer months which is why the southwest oriented plume is often called the summer plume upwelling favorable winds therefore can reverse the orientation of the plume southerly downwelling favorable winds on the other hand enhance the northward coastal current under downwelling conditions the surface layer flows onshore and pushes the plume against the coast making it narrower and thicker consequently the coastal current becomes more pronounced it becomes narrower and propagates faster to the north the evolution of the river plume was simulated with thetis the computational domain spans from roughly 40 n to 50 n in the zonal direction fig 10 the western boundary is located roughly 100 km west of the coast the columbia river is included in the domain excluding the shallow lateral bays the river boundary is located at beaver army 86 km upstream from the mouth the horizontal mesh resolution triangle edge length ranges from roughly 900 m in the estuary to 15 km at the open ocean boundaries in the vertical direction 20 terrain following layers were used the layer thickness ranges from roughly 1 m near the surface to a maximum of 180 m at the bottom the entire vertical grid adjusts to the free surface similarly to z grid used in structured grid models adcroft and campin 2004 we used a composite bathymetry data kärnä and baptista 2016a that was interpolated on the model grid fig 10 in addition the bathymetry was smoothed with a laplacian diffusion operator to limit strong gradients which could introduce internal pressure errors minimum water depth was set to 3 5 m wetting and drying was neglected atmospheric pressure and 10 m wind were obtained from the north american mesoscale model nam model wind stress was computed with the formulation by large and pond 1981 at the ocean boundary temperature salinity and sub tidal velocity was imposed from the global navy coastal ocean model ncom model barron et al 2006 in addition tidal elevation and velocities were imposed from the tpxo v9 1 model egbert and erofeeva 2002 at the river boundary discharge and water temperature are imposed using us geological survey usgs gauge data salinity is set to zero the simulation covers a time period from may 1 2006 to july 2 the first month is used to spin up the simulation the analysis period is from june 1 onward this spin up time is sufficient for the estuary plume system as the estuary has a residence time of a few days kärnä and baptista 2016b and the far field plume develops in a couple of weeks it is worth noting that the thetis model setup has not been fully calibrated for the system and the results are therefore preliminary an exhaustive model calibration and skill analysis are out of the scope of the present article and will be addressed in the future the simulations were carried out on a linux cluster with 16 core intel xeon e5620 processors and mellanox infiniband interconnect 96 mpi processes were used the simulation had 2 1 0 6 tracer degrees of freedom dof and used 15 s time step the full 90 day simulation took 7 2 days fig 11 shows the atmospheric and fluvial forcing conditions for the analysis period winds alternate between up and downwelling favorable direction fig 11a tides exhibit a typical spring neap variation to the system tidal range varying between 1 6 and 3 4 m river discharge is roughly 10000 m 3 s 1 during the simulation fig 11b and c simulated salinity field is compared against an observational data set from the rise project river influences on shelf ecosystems e g maccready et al 2009 maccready et al 2009 and liu et al 2009 use data from the 2004 summer measurement campaign it should be noted that for the 2006 campaign used in the present analysis the north and south moorings were moved further out from the river mouth by some 80 km see fig 10 for the mooring locations therefore the 2006 data set is well suited for evaluating the behavior of the coastal current and the far field plume under changing wind conditions fig 12 shows time series of observed surface salinity at stations rino rice ogi01 and riso the rice station fig 12b is located in the tidal plume recording the passing of each tidal freshwater lens the model replicates sub tidal and tidal evolution variability of the near field plume well note that exact replication of the tidal signal is difficult as salinity gradients are very large measured salinity therefore strongly depends on the passing of the plume fronts which is sensitive to atmospheric forcing mesh resolution mixing and bathymetry features for instance the ogi01 station fig 12c is located some 25 km southeast from the river mouth it captures the re circulating plume when it is pushed southward from the river mouth typically this occurs during southerly winds during the simulation period two of such events are recorded on june 6 10 and june 18 20 the model captures the southward transport of the plume relatively well especially during the latter event the northern station rino is located in the far field plume region 24 km off the coast fig 12a the narrow coastal current however is often situated closer to the coast the plume passes through rino station only in cases where the winds erode the plume from the coast such events are seen in the observations on june 6 and 18 the model captures those events well although the arrival of the plume is delayed by roughly one day salinity in thetis also tends to be higher compared to the observations the southern station riso captures the wind driven southward traversal of the plume the observations show such an event between june 10 and 21 thetis simulation shows the passage of the plume albeit the onset is delayed by roughly 3 days and surface salinity does not drop as much as in the observations fig 13 shows the evolution of the surface salinity in the thetis simulation prior to the first upwelling event panels a and b the bulge of the re circulating plume is clearly visible just north of the river mouth the far field plume is quite narrow and fresh it travels northward by the coast and does not reach the rino station on the onset of northerly winds panels c and d the far field plume detaches from the coast spreads out and passes through the station as the winds prevail the plume spreads out more and starts to travel southwest panels e h eventually a new coastal plume starts to develop note that in response to the winds the re circulating plume also spreads out dilutes and begins to meander 6 discussion the idealized 1d and estuary test cases show that the gls implementation remains stable and produces realistic bottom and surface layer dynamics as well as estuarine circulation overall the model s performance is in good agreement with results presented in the literature e g warner et al 2005 kärnä et al 2012 all the tested closure models and stability functions yield similar results although some differences do appear for example the differences in the bottom friction test case between different closures fig 2 are mostly due to numerics related to the surface boundary conditions the commonly used choice of k ε and canuto a stability functions however appears to perform well in all test cases the model performance is also strongly dependent on the chosen parameters which can be tuned in applications for example vertical profiles in the bottom friction test are affected by the choice of c μ 0 and σ ψ parameters among others similarly the length of salinity intrusion in the idealized estuary test case fig 8 depends on the magnitude of total mixing which is partially controlled by the minimum value of tke k m i n evidently the parameters could be tuned further to reduce the gap between different closure models for example however such an investigation of the parameter space is out of the scope of the present study the columbia river plume simulation indicates that thetis can represent tidal highly dynamic river plumes the plume features numerous eddies and responds quickly to changing tidal and wind conditions overall the simulation is in good agreement with the observations and known behavior of the columbia plume under up and downwelling conditions e g hickey and banas 2003 qualitatively thetis results compare well with roms and slim vallaeys et al 2018 thetis surface fields show eddies and filaments and strong frontal features are retained over several tidal cycles this suggests that numerical mixing is low as kärnä et al 2018 demonstrated with idealized test cases the presented model uses p 0 dg function space for the turbulent quantities while the mean flow values are in p 1 dg space this choice resembles the staggered discretization used in finite volume models e g in gotm where the mean flow and turbulent variables are defined at cell centers and cell interfaces respectively as the turbulent quantities reside in a lower degree function space it could impact the accuracy of the coupled model however as the turbulence closure model only affects the mean flow model through the eddy viscosity and diffusivity fields the impact is likely to be small deriving a higher order discretization for the turbulent quantities remains a topic for future research similarly ensuring strict energy conservation between the turbulent and mean flow fields will be addressed in the future 7 conclusions we have presented a dg finite element discretization for the gls turbulence closure model and a positivity preserving coupled time integration scheme the turbulence closure model was implemented in the thetis circulation model the model was tested with a series of idealized test cases the results verify that bottom boundary layer surface mixing and estuarine circulation processes are simulated correctly all the three closures k ε k ω and gls and stability functions canuto a b and cheng yield similar performance finally the model was tested in a realistic columbia river plume application the results indicate that the coupled model performs well in complex highly dynamic plume applications the surface salinity values are in good agreement with observations and the plume responds to changing wind forcing the plume shows strong frontal features which suggests low numerical diffusion thetis therefore can retain fronts between water masses and capture the observed plume traversals there is an ever increasing need for accurate less dissipative coastal ocean models that can simulate buoyancy driven coastal flows with a realistic representation of frontal features and vertical mixing as such the presented coupled circulation turbulence model constitutes an important step towards next generation ocean modeling declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments i am grateful to anonymous reviewers whose insightful comments helped to improve the manuscript lawrence mitchell durham university stephan kramer and david ham imperial college london are thanked for their contributions to thetis and continuous support with firedrake antonio baptista oregon health science university is acknowledged for his contribution on the columbia river plume application appendix a stability functions all the non equilibrium stability functions are defined by a set of canonical parameters table 1 in umlauf and burchard 2005 the functions can however be expressed as rational functions of α m and α n with parameters n i d i n b i umlauf and burchard 2005 a 1 c μ n 0 n 1 α n n 2 α m d 0 d 1 α n d 2 α m d 3 α n α m d 4 α n 2 d 5 α m 2 a 2 c μ n b 0 n b 1 α n n b 2 α m d 0 d 1 α n d 2 α m d 3 α n α m d 4 α n 2 d 5 α m 2 canuto et al 2001 introduced two sets of full non equilibrium stability functions usually referred to as canuto a and b the stability region of canuto b functions is somewhat larger than that of version a suggesting that it is more robust in practice umlauf and burchard 2005 another stability function based on a very similar formulation is given by cheng et al 2002 all the three stability function families have been implemented using the formulation a 1 a 2 a 1 limiting α m and α n the stability functions are only defined for a certain values of α n and α m due to numerical and physical reasons first the shear frequency α m is positive by definition to ensure its positivity α n must be limited from below the condition α m 0 corresponds to the equilibrium relation b ε for which it holds eq a 23 in umlauf and burchard 2005 a 3 b ε c μ α n α n 1 this equilibrium condition corresponds to unstably stratified convective regime where α n 0 and b 0 substituting the stability function c μ into a 3 results in a 4 α n min d 1 n b 0 d 1 n b 0 2 4 d 0 d 4 n b 1 2 d 4 n b 1 typical value of α n min is around 3 an alternative constrain to α n is to require monotonicity eq 47 in umlauf and burchard 2005 a 5 α n c μ α n α n 0 which yields more strict limit in this work a 4 is used as it was sufficient in all the tested cases cropping α n at the minimum value may lead to numerical oscillations as the gradient of the stability function is large for negative α n therefore a smoother transition has been proposed eq 19 in burchard et al 1999 a 6 α n α n α n α c 2 α n α n min 2 α c α n α c the smoothness of the transition is controlled by α c defined in range α n min α c 0 here a value α c 1 2 is used in addition the shear frequency α m must be limited from above to ensure physically sound behavior and numerical stability eq 44 in umlauf and burchard 2005 burchard and deleersnijder 2001 a 7 α m max d 0 n 0 d 0 n 1 d 1 n 0 α n d 1 n 1 d 4 n 0 α n 2 d 4 n 1 α n 3 d 2 n 0 d 2 n 1 d 3 n 0 α n d 3 n 1 α n 2 note that α m max depends on α n the limit a 7 is not always sufficient to ensure stability of the numerical scheme deleersnijder et al 2008 present a more generic stability constraint which guarantees that the vertical gradient of the turbulent quantities remains bounded in this work a 7 is used as it has been sufficient for stability we first set α n to α n according to a 6 and then apply the α m max limit appendix b choosing empirical parameters b 1 computing c 3 the parameter c 3 controls the buoyancy production of ψ under stable stratification its value can be computed from 32 b 1 c 3 c 2 c 2 c 1 c μ r i s t c μ r i s t 1 r i s t the value of c 3 thus depends on both the closure parameters c i and the stability functions to evaluate b 1 one first needs to evaluate the stability functions under steady state the steady state condition 27 can also be written as eq 49 in umlauf and burchard 2005 b 2 c μ α m c μ α n 1 from which one obtains a non linear equation b 3 c μ α m r i s t α m c μ α m r i s t α m r i s t 1 from the above equation α m can be solved either analytically or numerically in practice the analytical approach has been more robust and it is used in this work the c 3 values for the three closures and the canuto a stability functions are shown in table 1 b 2 parameter c μ 0 parameter c μ 0 stands for the value of the stability function in unstratified equilibrium where p ε from 31 and b 2 it follows that in equilibrium the stability functions only depend on r i s t c μ c μ r i s t c μ c μ r i s t its value can therefore be computed for each stability function see eq a 22 in umlauf and burchard 2005 b 3 parameter σ ψ a relation for the schmidt number σ ψ and the von karman constant κ can be derived for the logarithmic boundary layer assumption eq 14 in umlauf and burchard 2003 b 4 σ ψ n 2 κ 2 c μ 0 2 c 2 c 1 in this work we compute σ ψ for each closure with κ 0 4 appendix c source code availability the source code used to perform the experiments in this papers is publicly available firedrake and its components may be obtained from https www firedrakeproject org last access 1 february 2020 thetis from http thetisproject org last access 1 february 2020 for reproducibility we also cite archives of the exact software versions used to produce the results in this paper all major firedrake components and the thetis source code have been archived on zenodo zenodo firedrake 2019 zenodo thetis 2019 
