index,text
845,we implement a phase field based lattice boltzmann lb method for numerical simulation of multiphase flows in heterogeneous porous media at pore scales with wettability effects the present method can handle large density and viscosity ratios pertinent to many practical problems as a practical application we study multiphase flow in a micromodel representative of co2 invading a water saturated porous medium at reservoir conditions both numerically and experimentally we focus on two flow cases with i a crossover from capillary fingering to viscous fingering at a relatively small capillary number and ii viscous fingering at a relatively moderate capillary number qualitative and quantitative comparisons are made between numerical results and experimental data for temporal and spatial co2 saturation profiles and good agreement is found in particular a correlation analysis shows that any differences between simulations and results are comparable to intra experimental differences from replicate experiments a key conclusion of this work is that system behavior is highly sensitive to boundary conditions particularly inlet and outlet ones we finish with a discussion on small scale flow features such as the emergence of strong recirculation zones as well as flow in which the residual phase is trapped including a close look at the detailed formation of a water cone overall the proposed model yields useful information such as the spatiotemporal evolution of the co2 front and instantaneous velocity fields which are valuable for understanding the mechanisms of co2 infiltration at the pore scale keywords co2 sequestration lattice boltzmann method porous micromodel capillary fingering viscous fingering pore scale modeling 1 introduction the sequestration of carbon dioxide co2 in geological reservoirs is considered by many to be an essential component in the effective reduction of carbon emissions to the atmosphere and therefore a critical tool in the battle against global climate change huppert and neufeld 2014 pacala and socolow 2004 among possible sites deep saline aquifers are of particular interest owing to their large potential storage capacity worldwide availability and minimal environmental impact bachu 2000 gunter et al 1997 koide et al 1992 central to this approach is accurately predicting both the fidelity of candidate storage sites during pre injection of co2 and its migration post injection which is complicated by multiple factors most notably under typical reservoir conditions co2 is less dense and less viscous than the resident brine which potentially leads to complex and unstable displacement patterns as the co2 infiltrates the pore space both during and after injection complex patterns that emerge at the pore scale lead to macroscopic behaviors that are difficult to predict using current theories recent observations reveal that the macroscopic dynamics of the interface front is strongly tied to and often controlled by a range of pore scale phenomena such as fingering and haines jumps lenormand et al 1988 moebius and or 2014 it is also increasingly accepted that developing subgrid scale models capable of accurately representing pore scale processes is a prerequisite to improving the performance of reservoir scale simulations yet the multiphase multiphysics and multiscale nature of the flow make this task inherently challenging therefore a fundamental understanding of dynamic displacement processes at the pore scale is highly desirable extensive experimental studies of multiphase flows in porous media have been performed using different approaches a number of studies have attempted to observe pore scale flows directly in three dimensional 3d porous models or real rock samples by employing x ray micro computed tomography micro ct and magnetic resonance imaging mri andrew et al 2014 perrin and benson 2010 while these experiments explore the most realistic flows and geometries due to a lack of optical access expensive equipment e g micro ct and mri is a necessity moreover these techniques are generally limited to low temporal resolution and are not best suited for acquiring temporally resolved data which is crucial for studying dynamic displacement processes on the other end of the spectrum more idealized 2d porous media or so called micromodels have been used extensively to study multiphase flows at the pore scale armstrong and berg 2013 blois et al 2015 chen et al 2017 karadimitriou et al 2014 kazemifar et al 2015 2016 li et al 2017 roman et al 2016 zhang et al 2011a 2011b in these micromodels carefully designed or reprinted 2d patterns are etched in silicon or glass slides to which a glass slide is bonded to form a closed cell these 2d micromodels enable direct observation and measurement of pore scale displacement processes using fluorescent microscopy or more advanced techniques such as microscopic particle image velocimetry micro piv kazemifar et al 2015 2016 li et al 2017 roman et al 2016 such 2d micromodels have served as excellent tools for studying the fundamental physics of pore scale flows in porous media the experimental data generated in such studies also provide a convenient basis for the validation of numerical and theoretical models although there is great value to this the highly sensitive and unstable nature of multiphase flows makes direct quantitative comparison between experimental data and simulations challenging as it is virtually impossible to exactly match boundary and initial conditions one must consider this carefully when evaluating the success or failure of a numerical approach as benchmarked against experiments ferrari et al 2015 complementary to experiments numerical simulations can provide access to further and more detailed information about the flow field particularly at the pore scale lenormand et al 1988 thereby complementing experimental studies in many ways existing numerical techniques for studying fluid flow through porous media are manifold e g pore network modeling blunt and king 1991 smoothed particle hydrodynamics sph tartakovsky and meakin 2006 and lattice boltzmann method lbm huang et al 2015 among others here we focus on lbm which is popular due to its a mesoscopic nature b strength in dealing with complex geometries and c ease of parallelization with good scalability on distributed memory machines in addition to the pseudo potential lb model martys and chen 1996 porter et al 2009 shan and chen 1993 perhaps the most common lb model for simulating multiphase flow in porous media is the color gradient or chromodynamic model ba et al 2016 gunstensen et al 1991 huang et al 2014 leclaire et al 2015 with which it is relatively easy to implement different wettability conditions at solid surfaces and which scales well for parallel computations while having many advantages this simplicity also comes at a cost strictly speaking the color model is limited to density matched fluids and numerical stability issues arise for large viscosity ratios and or small capillary numbers although progress has been made in achieving high density ratios ba et al 2016 and in reducing spurious velocities by adding correction terms leclaire et al 2015 the resulting formulations impede computational efficiency and parallelism of the color gradient model making these schemes less practical for efficient simulation of co2 infiltration into water saturated homogeneous and heterogeneous porous media with realistic density or viscosity ratios chen et al 2017 liu et al 2015 2014 phase field lb models are an alternative framework with which one can alleviate some of the aforementioned issues fakhari and rahimian 2010 most of the available phase field models are based on the cahn hilliard equation which requires the calculation of a fourth order derivative this however can be cumbersome and problematic in terms of accuracy efficiency and stability geier et al 2015 additionally while some studies exist that implement arbitrary contact angles within cahn hilliard based lb models connington and lee 2013 these are complicated to implement and the accuracy of implementing the wettability condition is questionable connington et al 2015 an alternative to this is the conservative phase field lbm geier et al 2015 which does not require the calculation of a fourth order derivative and has other advantages over the cahn hilliard equation geier et al 2015 recently we proposed such a conservative phase field lbm for numerical modeling of contact line dynamics on curved boundaries in multiphase flows fakhari and bolster 2017 we have also examined the accuracy and reliability of several phase field lb schemes fakhari et al 2017b here we further develop the phase field lbm fakhari and bolster 2017 with wettability effects for heterogeneous solid structures with realistic co2 brine density and viscosity ratios which is currently not possible using the color gradient model we apply this framework to conduct numerical experiments on co2 invasion into a water saturated porous micromodel for two select capillary numbers representative of capillary and viscous fingering we concurrently carry out matching experiments to which our numerical simulations are both qualitatively and quantitatively compared details of the experimental setup apparatus and methods are given in section 2 the phase field lbm and its numerical implementation details are presented in section 3 a thorough comparison between numerical findings and experimental data is provided in section 4 discussion of numerical and experimental results is presented in section 5 followed by a summary and conclusions in section 6 2 experiment design 2 1 micromodel the micromodels used in this study were fabricated from a silicon wafer using micro fabrication techniques chomsurin and werth 2003 kazemifar et al 2015 they consist of a heterogeneous porous section an inlet and an outlet as shown in fig 1 the unique aspect of the fabricated micromodel is that the porous section represents the pore structure of real sandstone based on a previous study zuo et al 2013 to generate the geometry the pattern encoded in a binary image provided by zuo et al 2013 was first generated from a micro ct scan of a thin slice of sandstone due to limited connectivity associated with the 2d nature of the image the pattern was slightly modified to enlarge the throat size and thus reduce the likelihood of flow blockages the average and minimum throat sizes are 48 µm and 12 µm respectively the full porous section is made up by repeating the basic unit pattern in a 3 3 matrix which has dimensions of l x l y l z 7 101 5 328 0 030 mm and a porosity of ɛ 0 495 based on the pattern matrix sequential processes involving standard photolithography inductively coupled plasma deep reactive ion etching icp drie diamond drilling thermal oxidation and anodic bonding were used to create the heterogeneous structures and to form a 2d micromodel it is worth noting that after thermal oxidation 100 nm of silicon dioxide was grown on the silicon wafer which rendered the surface just as hydrophilic as the glass wafer to which the silicon wafer was bonded to form a closed flow cell the contact angle of water on both surfaces was estimated to be 9 1 degrees using co2 as the non wetting phase the contact angle was measured on flat glass and silicon samples under actual experimental conditions 80 bar 21 c using a separate setup the samples for contact angle measurement were prepared using the same oxidizing and cleaning procedures as for making the micromodel in addition during the course of each experiment we performed an in situ contact angle measurement using fluorescent microscopy in the triangular area near the inlet both measurement approaches yielded consistent measures of the contact angle two nanoports idex health science were attached to the micromodel for fluid delivery 2 2 experimental setup and procedure the coupled flow of water and co2 through the micromodel was controlled by two high pressure syringe pumps teledyne isco 100dm as shown schematically in fig 2 pump 1 filled with liquid co2 was connected to the inlet left port of the micromodel and was used to push liquid co2 pump 2 filled with distilled water was connected to the outlet right port to withdraw water this approach allowed accurate maintenance of the back pressure of the flow system while achieving a constant volumetric flow rate in order to protect the micromodel from over pressurization the micromodel was placed within an overburden pressure cell whose pressure was controlled by a third high pressure syringe pump pump 3 teledyne isco 500d and always maintained at least 5 bar above the micromodel pressure throughout the experiment the overburden pressure cell is simply a cavity made of stainless steel with a sapphire viewing window built into its base whose sole purpose is to maintain the structural integrity of the micromodel during experiments at reservoir relevant pressures the pressurization procedures were as follows before connecting valve t1 to the pressure cell the micromodel was pre saturated with water using pump 2 from right to left then valve t1 was connected to the pressure cell and the micromodel and switched to the line of v1 since valves v1 v2 v3 and v5 were all closed with v4 open the micromodel and pump 2 essentially form a closed internal space whose pressure can be increased by simply running pump 2 in the forward direction at this point pump 3 and pump 2 were run simultaneously until pressures of 86 bar and 80 bar respectively were achieved a high speed differential pressure transducer validyne p55e 1 n 2 42 s 5 a 0 140 kpa 0 1 accuracy was used to measure the instantaneous pressure drop across the micromodel prior to each experiment the co2 was tagged with the fluorescent dye coumarin 153 following zhang et al 2011b the co2 pump was then pressurized to 80 bar and allowed to equilibrate at room temperature for over 2 hr meanwhile the micromodel was mounted in the overburden pressure cell which was then filled with glycerol to facilitate pressurization to begin the experiment the micromodel was pre saturated with pure distilled water under ambient conditions through the outlet the micromodel and the pressure cell were then pressurized simultaneously to 80 and 86 bar respectively after the pressures on the water side and co2 side both reached equilibrium the valve v1 on the co2 line was opened and the co2 and water pumps were simultaneously initiated to run at the desired volumetric flow rates each with an accuracy of 0 3 of the setpoint the instantaneous phase configuration as co2 infiltrated into the water saturated micromodel was imaged using the epi fluorescence microscopy technique as illustrated in fig 3 an led light source thorlabs m385lp1 with a nominal wavelength of 385 nm and a full width at half maximum of 12 nm filtered by a bandpass filter filter 2 semrock brightline ff01 379 34 25 was used to excite the coumarin 153 dye marking the co2 phase the fluorescence emitted from the dye was passed through a dichroic mirror and a λ 445 20 nm bandpass filter filter 3 semrock brightline ff01 445 40 25 and focused by a long distance microscope objective infinity photo optical company k2 distamax onto the detector of a 4 mega pixel 12 bit high speed cmos camera phantom v641 with this imaging setup the resultant magnification and spatial resolution were 2 9 and 3 4 µm respectively and the field of view was approximately 8 8 mm by 5 5 mm which was sufficient to cover the entire porous section of the micromodel as indicated by the green region in fig 1 gray scale images were captured at 1000 hz in order to temporally resolve the dynamic flow processes owing to the epi fluorescence configuration the signal to noise ratio intensity of co2 versus intensity of water or solid matrix of the acquired images was typically greater than 5 which allowed for an unambiguous determination of the instantaneous co2 distribution in each image the saturation of co2 in each frame was calculated by simply thresholding the gray scale image and counting the pixels occupied by co2 due to the non uniformity of the illumination resulting from imperfections of collimating optics the pixels in the center of an image appeared slightly brighter than those on the edges in order to account for this effect a dynamic thresholding scheme was applied i e we divided our image into sub regions within which we calculated the local maximum and minimum intensities a threshold for the sub region was determined based on these two intensities this method was validated with a separate experiment in a micromodel saturated with dyed methanol and the calculated porosity and the design value differed by less than 3 since the same set of image processing procedures with identical parameters was used in the validation experiment as well as in all actual measurements we consider 3 to be an accurate representation of the relative error of the measurements presented herein additional details of this experimental approach can be found in ref kazemifar et al 2015 the physics of the multiphase flow of co2 into a water saturated porous micromodel can be characterized by four dimensionless groups i the density ratio ρ ρ c ρ w where ρ c and ρ w are the densities of liquid co2 and water respectively ii the viscosity ratio μ μ c μ w where μ c and μ w are the viscosities of liquid co2 and water respectively iii the reynolds number re c ρ c u l y μ c where u is the bulk velocity defined as u q a ɛ with q and a being the volumetric flow rate and the frontal area of the micromodel perpendicular to the flow respectively and iv the capillary number ca μ c u σ where σ is the surface tension coefficient between liquid co2 and water the fluid properties and the dimensionless numbers for the two experimental conditions studied are given in tables 1 and 2 respectively 3 numerical modeling we employ a phase field lbm fakhari and bolster 2017 to numerically simulate the experiments described in the previous section strengths of this model include 1 good accuracy 2 an ability to handle large density and viscosity ratios 3 an evolution equation for pressure that is consistent with multiphase flow dynamics and 4 the capability to model pre specified contact angles with smaller spurious velocities than the color gradient or psuedo potential models fakhari and bolster 2017 3 1 phase field lbm the proposed phase field lbm is designed to solve the flow field for isothermal incompressible multiphase fluid systems and consists of two main parts the first is a lattice boltzmann equation lbe for tracking the interface between two different fluids according to the so called conservative phase field equation chiu and lin 2011 1 ϕ t ϕ u m ϕ 4 ξ ϕ 1 ϕ n where ϕ is the phase field which is zero in the relatively light fluid co2 and one in the relatively heavy fluid water and changes smoothly across the interface t is time u is the macroscopic velocity vector m is the mobility ξ is the interfacial thickness and n is the unit vector normal to the co2 water interface 2 n ϕ ϕ ϵ where ϵ 10 32 is a small number to avoid division by zero the last term in the parentheses in 1 is an anti diffusion term that exists only within the interfacial region and prevents the interface from becoming excessively diffusive for a detailed physical explanation please see ref geier et al 2015 in phase field modeling the volumetric free energy of the system is given by jacqmin 1999 2000 3 f β ψ ϕ 1 2 κ ϕ 2 d v where β 12 σ ξ κ 3 σ ξ 2 and the bulk free energy used in this study is 4 ψ ϕ ϕ 2 1 ϕ 2 the chemical potential of the system μϕ is then found by minimizing the free energy according to 5 μ ϕ δ f δ ϕ 4 β ϕ ϕ 1 ϕ 1 2 κ 2 ϕ where δ denotes the variational differentiation the second part of the proposed phase field lbm is a pressure evolution lbe for recovering the macroscopic equations including conservation of mass 6 ρ t ρ u 0 and conservation of momentum navier stokes 7 ρ u t u u p μ u u t f s where ρ and μ are the fluid density and viscosity respectively p is the macroscopic pressure and f s μ ϕ ϕ is the surface tension force between different fluids of note is that the main difference between the current phase field lbm and that proposed in ref fakhari and rahimian 2010 is the interface tracking equation in particular the cahn hilliard equation is used in ref fakhari and rahimian 2010 while the current model is built upon the conservative phase field equation geier et al 2015 the current phase field lbm however is identical to that proposed in ref fakhari and bolster 2017 with the additional contribution of implementing the wettability condition a given contact angle on a heterogeneous solid substrate as will be described in section 3 3 3 1 1 lbe for interface tracking we use the following lbe for tracking the interface between liquid co2 and water fakhari and bolster 2017 8 h α x e α δ t t δ t h α x t h α x t h α eq x t τ ϕ 1 2 where hα is the phase field distribution function τϕ is the phase field relaxation time e α is the lattice dependent mesoscopic velocity set he and luo 1997 and the equilibrium phase field distribution function is 9 h α eq ϕ γ α w α m c s 2 4 ξ ϕ 1 ϕ e α n where 10 γ α w α 1 e α u c s 2 e α u 2 2 c s 4 u u 2 c s 2 in which wα is the lattice dependent weight coefficient set he and luo 1997 c s c 3 is the speed of sound in the system with c δ x δ t 1 lu lattice units where δx and δt are the lattice length scale and time scale respectively the mobility is related to the phase field relaxation time τϕ by 11 m τ ϕ c s 2 δ t assuming a two step collision streaming sequence the phase field is calculated by taking the zero th moment of the phase field distribution function after the streaming 12 ϕ α h α and then the density is updated by 13 ρ ρ w ϕ ρ w ρ c 3 1 2 lbe for hydrodynamics the following lbe is solved for recovering the hydrodynamic properties in nearly incompressible multiphase flows fakhari and bolster 2017 14 g α x e α δ t t δ t g α x t ω α x t f α x t where g α is the modified hydrodynamic distribution function ωα is the collision operator and fα is 15 f α x t δ t γ α w α ρ w ρ c c s 2 γ α μ ϕ e α u ϕ we use the multiple relaxation time mrt collision operator fakhari and lee 2013 lallemand and luo 2000 16 ω α x t m 1 s m g α g α eq where m is the orthogonal transformation matrix s is the diagonal relaxation matrix and the modified equilibrium distribution function is 17 g α eq g α e q 1 2 f α in which 18 g α e q p w α ρ c s 2 γ α w α is the equilibrium distribution function the orthogonal transformation matrix is given in ref lallemand and luo 2000 for the d2q9 lattice used in the present study in order to update the hydrodynamic relaxation time we first calculate the dynamic viscosity according to 19 μ μ c ϕ μ w μ c followed by updating the relaxation time according to 20 τ μ ρ c s 2 this approach has been shown to be more accurate than directly calculating the relaxation time from the phase field using a linear or harmonic interpolation fakhari et al 2017b after solving the lbe 14 using a routine collision streaming sequence the hydrodynamic properties are calculated by 21a u 1 ρ c s 2 α g α e α δ t 2 ρ f s 21b p α g α δ t 2 ρ w ρ c c s 2 u ϕ note that the updated velocity is used in calculation of the pressure 3 2 numerical implementation to implement the lbm described in the previous section one must be able to calculate the gradients of the phase field for mass balance and stability reasons this is done using second order isotropic differences fakhari and bolster 2017 although one might lose accuracy at high density ratios using central differences has shown to be very effective and reasonably accurate for numerical simulation of multiphase flows at low density ratios which is the case in the present study the numerical values of mobility m and interfacial thickness ξ play a key role in the stability and accuracy of phase field lb models the effects of these numerical parameters on the simulation results was considered by fakhari et al 2017a who conducted a sensitivity analysis here we use the empirical guidelines described in ref fakhari et al 2017a to choose these parameters in general having a small ξ is desirable as this improves convergence towards sharp interface solution a small value for ξ however might lead to numerical instability especially at high density ratios as suggested in ref fakhari et al 2017a we use ξ 3 lu which is an optimal value for interfacial thickness at low density ratios less than 10 similarly a high value for the mobility results in excessive numerical dissipation which deteriorates the accuracy of the results on the other hand having a too small m might cause numerical instability in this work we set the mobility to m 0 01 lu fakhari et al 2017a the computational domain shown in fig 4 is discretized using 2131 1599 grid cells on the left boundary where a flat co2 front is located we impose a parabolic poiseuille profile as the inlet velocity while a convective outflow boundary condition bc is applied on the right boundary as will be shown in section 4 1 the distance from the inlet to the porous section of the micromodel xi has a noticeable effect on the numerical results the bottom and top boundaries are treated as solid walls with wettability conditions more on this in section 3 3 we represent the solid grains using stair shaped boundaries boundary conditions are imposed using bounce back on the link to find the value of the unknown distribution functions coming from the solid cells towards the fluid domain details of implementation of the initial and boundary conditions as well as enforcement of an arbitrary contact angle on solid walls are described below 3 3 wettability condition on solid boundaries implementing wettability conditions is easily done in for example the color gradient and pseudopotential lb models because there is no need to calculate the vector normal to the solid boundary in those models this however comes with some drawbacks such as large spurious velocities and restriction to density matched fluids on the other hand finding the normal to the solid surface in a heterogeneous solid structure can be cumbersome in phase field models to the best of our knowledge there are few studies for implementing arbitrary contact angles in cahn hilliard based lb models connington and lee 2013 aside from a complicated algorithm and tedious implementation the accuracy of implementing the wettability condition is questionable connington et al 2015 although contact line dynamics on homogeneous curved solid boundaries have been recently proposed fakhari and bolster 2017 there is no contact angle treatment for heterogeneous solid structures in conservative phase field models for this purpose we present a straightforward algorithm here to impose a pre specified contact angle at the solid walls the wall free energy is postulated to be of the form ding and spelt 2007 jacqmin 2000 22 κ n w ϕ x w 6 σ ψ ϕ cos θ which can be simplified to fakhari and bolster 2017 23 n w ϕ x w 2 β κ ϕ w 1 ϕ w cos θ where n w is the unit vector out normal to the solid wall θ is the static contact angle and ϕ w is the unknown value of the phase field at the wall the unknown quantities in eq 23 are n w and ϕ w the out normal vector n w n x x n y y depends on the given geometry for stationary boundaries which is the case in the present study it can be readily calculated a single time at the beginning of the simulations referring to fig 5 a boundary cells marked as red circles can be easily identified by those solid cells that have at least one neighboring fluid cell once the boundary cells are identified their out normal vectors can be determined by probing the adjacent boundary cells for a 2d geometry we find the x and y components of the normal vector according to the following algorithm if both left and right neighbors of a given boundary cell are solid cells then the normal vector is in the y direction n x 0 otherwise n x points in the x direction where there is a fluid cell similarly if both bottom and top neighbors are solid walls the normal vector is in the x direction n y 0 otherwise n y points to an available fluid cell in the y direction if all orthogonal bottom top left and right neighbors are solid cells then we pick the first diagonal neighbor that is a fluid cell and define the normal vector accordingly this process takes care of the majority of boundary cells with only few exceptions such as convex corner nodes which will be handled separately to make sure that the normal vector is consistently pointing to a fluid cell after finding the vectors normal to the boundary cells we can eliminate ϕ w in eq 23 using the following relations 24a n w ϕ x w ϕ n w x w ϕ f ϕ s 2 h 24b ϕ w ϕ f ϕ s 2 where x f x s n w ϕ f ϕ x f ϕ s ϕ x s and 2 h x f x s n w is the distance between the boundary cell and the fluid cell in the orthogonal directions 2 h 1 lu while in the diagonal directions 2 h 2 lu substituting eq 24 into eq 23 then gives us the unknown value of the phase field at the boundary cells 25 ϕ s 1 a 1 a 1 a 2 4 a ϕ f ϕ f where 26 a h 2 β κ cos θ θ 90 for neutral wetting conditions θ 90 the trivial solution is ϕ s ϕ f 3 4 boundary conditions for the distribution functions in addition to the wetting bc for the phase field at the solid walls the distribution functions coming from the boundary nodes towards the fluid nodes must be determined noting the post collision state of the distribution functions by f where f is a placeholder for either h or g the value of f i at a typical solid boundary node x s is unknown referring to fig 5 b we use the mid way bounce back rule to determine the unknown distribution functions at the boundary nodes before the streaming step 27 f j x s f i x f where j denotes the bounce back direction such that e j e i given a predetermined stationary geometry we identify each boundary node and store its coordinates using two integer numbers together with two indices to identify its normal direction 3 5 initial inlet and outlet boundary conditions initially the porous medium is saturated with water and the phase field is initialized according to 28 ϕ x y 1 2 1 tanh x ξ ξ 2 in other words at the initial time the co2 front is a flat interface located at x ξ a parabolic velocity profile is imposed at the inlet using the non equilibrium bounce back scheme zou and he 1997 after the streaming step according to 29 f i x 0 f o f i e q f o e q x 0 where f is a placeholder for h or g and the subscripts i and o denote the incoming and outgoing distribution functions respectively such that e o e i the outgoing distribution functions fo are known after the streaming step and the equilibrium values f i e q and f o e q are found via eqs 9 and 17 by imposing a uniform phase field ϕ 0 and a parabolic velocity profile at the inlet at the outlet we impose the following convective outflow bc for the unknown distribution functions entering the domain 30 f i t u c f i x x x o 0 where xo is the x location of the outlet boundary uc is the convective velocity to be specified at the outlet it is worth noting the key differences between the current convective bc and those presented in ref lou et al 2013 first using the implicit upwind scheme we solve eq 30 only for the unknown incoming distribution functions while in ref lou et al 2013 eq 30 was solved for the distribution functions in all directions second as opposed to a maximum average or local value for the outlet velocity in ref lou et al 2013 we propose to use the following convective velocity 31 u c x o y max 0 u x x o y for consistency with the upwinding scheme it is important to ensure that the convective velocity is positive this is particularly crucial at small capillary numbers or relatively low flow rates where the characteristic velocity is comparable to spurious currents in our simulations u 0 o 10 4 which is too small for some common schemes to be numerically stable 4 results in this section results from both the lbm simulations and drainage experiments are shown with both quantitative and qualitative comparisons made between them to facilitate comparison a dimensionless time was defined as t t t c where t c l x u is the characteristic time with lx being the length of the porous section as listed in table 2 two different flow rates namely 0 05 ml min and 0 25 ml min corresponding to capillary numbers of 2 65 10 5 and 1 33 10 4 respectively are studied at 8 mpa and 21 c the cases with the low log ca 4 58 and the high log ca 3 88 flow rates are expected to fall within the crossover from capillary to viscous fingering and the viscous fingering regimes respectively zhang et al 2011b 4 1 crossover from capillary to viscous fingering ca 2 65e 5 co2 infiltration into a water saturated micromodel is a complicated process involving the migration of the co2 front the evolution of individual menisci and the growth of dendritic structures i e the fingers kazemifar et al 2016 lenormand et al 1988 as can be seen in the movies provided in the supplementary materials chronologically the entire drainage process can be qualitatively classified into three distinct flow stages i migration of the co2 front in the triangular area c f fig 2 prior to its arrival at the porous section ii percolation of co2 through the micromodel until the flow pattern within the porous section no longer changes quasi steady state and iii post front passage when the distribution of co2 and residual water remain largely unchanged for a long period of time note that during stage iii the flow pattern may eventually be altered by some very slow processes like co2 dissolution into water gangila and shear induced film flows i e quasi steady state kazemifar et al 2016 li et al 2017 morais et al 2016 however these processes are so slow that they are beyond the time scales of interest in this work and therefore are not considered fig 6 shows a few representative snapshots of co2 infiltration into the water saturated micromodel at different times for ca 2 65 10 5 including results from experiments and simulations the full evolution can be seen in videos provided as supplementary materials here t 0 is chosen to correspond to the instant when the co2 front first reaches the porous section i e when co2 saturation within the porous section first becomes non zero in the experiments prior to t 0 the co2 front propagates within the triangular region on the left of the porous section c f fig 1 the front remains significantly curved during this flow stage meaning that the middle portion of the front arrives at the porous section much faster than it reaches the edges see movies in supplementary materials this middle portion of the co2 front becomes pinned to the solid substrate at the entrance of the porous section due to capillary resistance of the porous matrix and the liquid co2 behind the front region continues to expand laterally towards the upper and lower boundaries of the micromodel at t 0 2 co2 partially breaks into the porous section in the form of fingers it is evident that three primary fingers develop at locations corresponding to the most permeable pathways within the porous section where capillary resistance is expected to be lower these three fingers grow predominately in the horizontal direction from left to right consistent with the direction of the bulk pressure gradient thus displaying characteristics of viscous fingering zhang et al 2011b by t 0 4 the three primary fingers have grown even further nearly reaching the outlet boundary of the porous section besides these primary fingers there are multiple secondary fingers that have formed between the primary ones including side fingers emerging from each primary finger the growth lines of these secondary and side fingers are not exactly aligned with the direction of the bulk pressure gradient but rather occur in transverse directions and even backwards against the bulk pressure gradient which is an indication of capillary fingering the coexistence of patterns associated with capillary and viscous fingering suggest that this flow is in the crossover regime from capillary to viscous fingering in agreement with previous flow phase diagram studies using homogeneous micromodels lenormand et al 1988 zhang et al 2011b at t 0 6 while the primary fingers remain largely unchanged the secondary and side fingers continue to grow with each finger branching into multiple fingers in all directions another interesting feature of this snapshot and in the following ones is the existence of isolated co2 blobs within the porous section presumably attributable to snap off effects lenormand et al 1983 these isolated blobs are observed in both the experiments and in the numerical simulations at t 0 8 and t 1 0 the percolation process stage ii is nearly complete with all fingers nearly fully developed although the spatial distributions of co2 and water remain largely unchanged during the rest of the experiment or simulation it can be observed that at the ends of certain fingers the co2 front can locally jump and or retract over short distances suggesting the existence of only a quasi static system the results presented in fig 6 indicate fairly good qualitative agreement between the experiment and the 2d simulation particularly considering the high complexity of the flow system i e unstable multiphase flow in a superhydrophilic heterogeneous porous matrix the simulation and experiment produce qualitatively similar dynamics of fingering as well as similar spatial distributions of co2 perhaps the most evident discrepancy between the experiment and simulation in fig 6 is that the development and advancement of the fingers in the simulations appears to be slightly ahead of that observed in the experiments we conjecture that this difference can primarily be attributed to the discrepancy in the initial and boundary conditions between experiment and simulation although of course model limitations and or errors might also play a factor as already noted during flow stage i in the experiment the co2 front is significantly curved within the triangular region and the exact shape of the co2 front is not only difficult to control experimentally but also difficult to match numerically in fact some discrepancies exist even between two trials of the same experiment see fig 8 moreover the velocity field at the inlet boundary for both the co2 and water sides is significantly perturbed as a result of the propagation of the curved co2 front due to limitations of current measurement techniques kazemifar et al 2015 the velocity field cannot be quantitatively evaluated in the co2 phase and thus cannot be reconstructed and matched numerically given that the liquid co2 pumps into the micromodel through a cylindrical tube in the experiments we suspect that numerically placing a flat co2 front in the vicinity of the porous section will not accurately represent the experimental conditions upon careful inspection of the liquid co2 profile away from the porous region in the experiments we observe a radial flow in the vicinity of the inlet tube the green tube in fig 1 and hence a parabolic rather than uniform velocity profile close to the porous region see the videos in supplementary materials this behavior leads to a parabolic profile for the liquid co2 front at the entrance of the porous section thus in order to better match the initial conditions between numerical simulations and experiment we extended the length of the inlet region by two orders of magnitude from x i 5 lu to x i 300 lu after rerunning the simulations with x i 300 lu we found that placing a flat co2 front close to the porous section of the micromodel is indeed erroneous see the obtained parabolic co2 front in fig 7 when x i 300 lu a quantitative comparison of co2 saturation as a function of time shown in fig 8 for ca 2 65 10 5 further confirm our speculation fig 8 which depicts the data for two separate experiments black circles and red squares along with numerical simulations using two different entry lengths of x i 5 lu green line and x i 300 lu blue line shows an improvement in the temporal evolution of the co2 saturation in the porous micromodel when the length of the inlet region is increased to x i 300 lu as can be seen in fig 8 the shapes of the saturation curves are very similar between the experimental data and simulation results in particular when the inlet region is extended to x i 300 lu the new numerical results nearly match the experimental data with the final co2 saturations i e the quasi steady state values standing at 49 5 49 6 and 49 5 for experiment 1 experiment 2 and simulation blue line respectively these values represent a difference of less than 0 1 between the second experiment and the simulation for which the co2 distributions are shown in fig 9 at t 1 5 it is evident that the original simulation profile with x i 5 lu green line has a higher final saturation than the experimental data for most of the range of t shown in fig 8 this is consistent with the observation from fig 6 that the development of fingers in the original simulations is ahead of that in experiment due to the different inlet boundary conditions in order to further compare the simulations with the micromodel experiments in a quantitative way spatial profiles of co2 saturation in the porous micromodel are plotted in fig 10 at quasi steady state t 1 5 for ca 2 65 10 5 for both experiments and simulation to calculate the data for the spatial profile using simulation results the entire porous section 2131 1599 grid cells was first divided into 194 bins i e 193 bins each with a width of 11 grid cells and one last bin with a width of 8 grid cells in the horizontal direction and then the local co2 saturation was calculated within each bin by counting the cells filled with co2 for the experimental data the acquired image with a typical size of 2066 1550 pixels was first mapped onto a 2131 by 1599 matrix using bilinear interpolation and then the local co2 saturation at each x location was calculated following the same procedure as used in the simulations as shown in fig 10 the spatial saturation profile obtained using lb simulation compares favorably with experimental data predicting most of its peaks and valleys with reasonable accuracy although some discrepancies do exist it must be noted though that even intra experimental variability exists and that the mismatch between experiments is comparable to any mismatch between a given experiment and the simulation in particular a correlation analysis shows that the correlation coefficient between the saturations for both experiments χ 0 85 is comparable to the correlation coefficient between experiments and simulations χ 0 78 0 82 this again highlights the high sensitivity of these systems to initial and boundary conditions which must be carefully considered when evaluating model success 4 2 viscous fingering ca 1 33e 4 in the previous subsection section 4 1 we showed that the numerical results are more consistent with experimental observations if the inlet length is extended as such the remainder of the simulations were carried out using an extended inlet length of x i 300 lu fig 11 shows representative snapshots of co2 infiltration into the water saturated micromodel at different times for ca 1 33 10 4 which is 5 times larger that the previous case it can be seen in fig 11 at t 0 37 that for the experiments the invasion of co2 concentrates near the central portion of the porous section with very little invasion towards the edges suggesting that the boundary effects are even more severe in this case owing to the higher flow rate in the previous case ca 2 65 10 5 when the co2 front arrived at the porous section its middle portion became pinned at the entrance of the porous section simply because the pressure behind the co2 water interface was insufficient to overcome the capillary resistance of the porous matrix while the pressure was accumulating the co2 front expanded in the lateral direction stage i leading to a flatter co2 front which mitigated such boundary effects to some extent on the other hand in the current case the bulk pressure gradient is higher moreover due to a higher re inertial effects are more significant and the period for pressure accumulation is much shorter therefore as soon as the middle portion of the co2 front arrives at the porous section the invasion process begins almost immediately even though the co2 front has still not extended laterally over the inlet of the porous section this behavior is in contrast to the simulations where some such effects are visible i e the central fingers advance earlier and further than those close to the edges but the effects are not as strong again highlighting the clear importance of boundary conditions in this problem which are next to impossible to replicate identically between experiment and simulation aside from such boundary effects the higher flow rate case is fundamentally different than the previous case in two respects first it is evident that the fingering in this case is predominately from left to right in line with the bulk pressure gradient with few fingers growing in other directions this trend is indicative of viscous fingering only which again is in agreement with the flow phase diagram of zhang et al 2011b second the co2 saturation is higher in this case than that in the previous one again in agreement with previous studies cao et al 2016 zhang et al 2011b as the flow rate and the bulk pressure increase inertial effects also increase which facilitates the invasion of throats with higher capillary resistance i e relatively smaller throats moebius and or 2014 therefore additional viscous fingers are formed leading to a higher final co2 saturation as is evident in fig 12 the temporal evolution of liquid co2 saturation in the entire porous section is shown in fig 12 for ca 1 33 10 4 a comparison is made between two experimental trials and simulation as can be seen the simulation agrees reasonably well with both sets of experimental data at early times when the co2 saturation is still growing this is despite clear discrepancies that are shown for example in fig 11 where the experiment has no invasion along the edges of the micromodel at later times there is a deviation between the two experimental data sets as well as with the simulation result attaining a lower final saturation than the experiments the spatial variation of liquid co2 saturation inside the porous micromodel at quasi steady state t 1 5 is shown in fig 13 for ca 1 33 10 4 the general trend in the oscillatory behavior of the saturation profile is predicted in the simulations with comparable variability between peaks and troughs as well as horizontal scales over which the variations occur when compared with experimental data there are however some clear differences between simulations and experiment particularly near the inlet to the porous medium and at the outlet this further highlights the clear influence of the boundary conditions which at this higher flow rate seems to become even more important additionally there are visible discrepancies within the domain in particular the valleys of simulation are lower than those of experiment data in line with the previous observation of lower overall late time saturation fig 12 once more a correlation analysis shows that the correlation coefficient between the saturations for both experiments χ 0 56 is comparable to the correlation coefficient between the saturations predicted by the model and measured in the experiments χ 0 47 0 54 the lower value of the correlation coefficient here compared to the previous case reflects a more challenging situation in terms of reproducibility reflecting the highly sensitive nature of this flow under these unstable conditions 5 discussion on certain flow characteristics one of the main benefits of working with high resolution numerical simulations is that one can resolve the velocity field throughout the flow domain previous experiments in both homogeneous kazemifar et al 2016 and heterogeneous li et al 2017 porous micromodels show that for multiphase flows associated with conditions relevant to co2 sequestration as studied here inertial effects can become significant the velocity field and streamlines in the flowing co2 phase in a select location within the porous section of the micromodel are shown in fig 14 at quasi steady state for both ca 2 65 10 5 and ca 1 33 10 4 it is interesting to note that recirculation regions clearly exist at both flow conditions although they appear to be larger and more significant in the higher flow rate case perhaps due to stronger inertial forces note that the reynolds number in the viscous fingering case re c 3105 is an order of magnitude larger than that in the capillary fingering case re c 621 it is important to recognize that although the co2 and water phases have reached quasi steady spatial configurations at this stage of the flow processes the recirculation zones reported herein occur in the still flowing co2 phase while recent studies have reported the occurrence of recirculation zones within trapped fluid phases owing to high shear imparted at the fluid fluid interface by the still flowing phase kazemifar et al 2016 li et al 2017 those identified herein are strong reflections of inertia especially given their substantial sizes this important observation is only possible when the detailed velocity field within the flowing phase co2 as shown in fig 14 can be accurately captured which has rarely been reported before further beyond simply being interesting to observe the emergence of recirculation in the still flowing co2 phase there are also practical consequences associated with this observation multiphase flows are known to strongly impact transport and mixing processes e g jiménez martínez et al 2015 2017 2016 and the presence of recirculation zones is known to strongly influence the transport of dissolved substances in a porous medium e g bolster et al 2009 2014 which could have a strong impact when studying for example the longer term processes of dissolution of co2 into the water phase which is considered an important permanent trapping mechanism of sequestered co2 gilfillan et al 2009 the identified recirculation zones clearly arise due to the manner in which the co2 phase distributes itself throughout the porous medium creating dead end like cavity and pore structures that are known to be conducive to creating such features in order to believe that they emerge in the real flows and are not an artifact of the simulation the local fluid phase distributions in simulations and experiments should display similar physical and structural characteristics in particular the distribution of the trapped residual water is key zhang et al 2011b highlighted four distinct forms in which the residual phase can be present i pools that occupy multiple pore bodies ii thin films surrounding the grains iii bridges between pore throats and iv cones on the down gradient side of silicon posts which have also been observed in other experiments morais et al 2016 fig 15 zooms in on a small section of the micromodel that displays many of these features in particular we focus on comparing the phase distributions at quasi steady state between experiment and simulation while some discrepancies clearly exist most of the dominant features are well captured and the distinct forms of trapped water exist in similar forms and sizes in both including the water cone behind the large grain in the center of the image interestingly it has been suggested that such cone structures are not thermodynamically stable and may merge with other structures during this quasi steady phase zhang et al 2011b zhang et al 2011b suggested that the formation of such water cones is due to the high shear stress and drag force induced by the fast flow of the nonwetting phase which in turn deforms a wetting film into the shape of a cone on the other hand morais et al 2016 attributed the formation of water cones to surface heterogeneities which influence the behavior of the triple line while both statements are reasonable explanations for water cones occurring at quasi steady state discussion on the dynamics associated with their formation is rare presumably due to technical challenges in characterizing such flows i e the very high spatial and temporal resolutions required in order to resolve this process here our simulations and experiments provide a detailed view of the process as shown in fig 16 interestingly while the quasi steady state in the simulations and experiments appear somewhat similar the transient process of reaching this state differs more suggesting that the final saturation distribution is indeed controlled by pore scale geometry and heterogeneities despite clear discrepancies in the detailed dynamics both experiment and simulation suggest that the formation of a water cone is highly related to the interaction of two distinct co2 fingers of course the porous matrix is highly hydrophilic and therefore the water tends to adhere to the solid surface as evident in fig 16 d and o two co2 fingers are attempting to enter the specific pore almost simultaneously one through the top throat and the other one through the bottom throat in the beginning the bottom finger leads the process and enters around the grain dimple shaped which displaces most of the water out of the pore and leaves some behind in the dimple g and p however as the top finger becomes stronger the bottom one begins to recede h i q and r driving more water back into the pore when the top finger grows further the two fingers eventually merge and a pocket of water is trapped within the pore forming a water cone attached to the grain therefore we conjecture the key elements that enhance the formation of water domes are strong surface hydrophilicity high flow rate and geometric heterogeneity suggesting that both ref zhang et al 2011b and ref morais et al 2016 are correct it is worth reemphasizing that the final phase distribution around the pore is very similar between experiment and simulation in spite of the clear discrepancies during the process of formation for instance the top finger grows much earlier in the experiment than that in the simulation and a few snap off events occurred in the experiment g and h but not in the simulation note that our simulation is capable of capturing such snap off events as evident in fig 11 just not in this case we conjecture that such discrepancies are likely related to boundary effects as we mentioned multiple times before i e the top finger is much closer to the centerline of the domain we must note that it is merely a conjecture but if correct this reinforces our idea that geometry has significant control over the final phase distribution although the dynamics may take a rather different pathway we have no way of formally proving this at this point in time but hopefully future model experiment comparisons will reveal whether this is correct or not 6 summary and conclusion using micromodel experiments and lbm simulations we have studied multiphase flow through a heterogeneous porous medium at the pore scale under conditions relevant to geologic co2 sequestration the pore geometry is based on a real sandstone thus replicating more realistic pore structures than many previous micromodel studies we have focused our study on two flow rates covering unstable flows in the range of crossover from capillary fingering to viscous fingering and viscous fingering regimes while there are clear discrepancies in the specific details of how the co2 distributes itself through the porous matrix both in space and time there is reasonable agreement between the ultimate steady state saturations predicted by the simulations and those measured in the experiments in fact a correlation analysis suggests that differences between model and experiment are comparable to differences between individual experimental trials given the unstable nature of the flow such inter experiment differences are to be expected but the good agreement also highlights unlike a flow through a homogeneous porous medium that the instability and fingers that are formed are strongly controlled by the grain sizes and structure additionally differences between the experiment and simulation can also be attributed to differences in initial and boundary conditions due to inherent experimental uncertainties it is nearly impossible to apply the exact same boundary conditions in our simulations and given the sensitive nature of the flow differences are to be expected however we also showed that better agreement was obtained when our simulations more faithfully represented the flow in the entrance region of the micromodel before the co2 even entered the porous region such a sensitivity to boundary and initial conditions suggests that efforts to improve detailed agreement between numerical simulations and experiments ad nauseam may be doomed to failure we believe that instead efforts should be made to ensure that large scale qualitative features are faithfully represented in such a way that may be useful for upscaling purposes or uncertainty quantification although we acknowledge that it is not clear if this is genuinely possible without capturing all fine scale details of course certain disagreements between the model and the experiments can also be attributed to limitations of the numerical model which while promising as with all models suffers numerical error and potentially incomplete physics e g the diffuse interface approximation of the phase field model while helpful for numerical stability may not be totally representative of the microscopic interface between phases additionally it is well known that the density and viscosity of supercritical co2 are highly sensitive to pressure and temperature fluctuations which is not accounted for in our model note for example that while some convergence testing was done we did not conduct a comprehensive numerical convergence test as this was beyond our available computational resources additionally the numerical results presented in this manuscript are limited in that they are only 2d simulations which cannot resolve inter boundary effects between the top and bottom plate while we also developed 3d simulations doing so comprehensively over the full time of the experiments e g including the 300 lu entry length was beyond our computational resources however our preliminary results suggest that certain improvements over the 2d results are achievable by resolving the third dimension e g closer asymptotic saturations for our second experimental data set since a 3d model is able to fill in patches of the porous medium that might be inaccessible a 2d model bhattad 2010 a detailed view of the quasi steady state distribution of co2 and water shows a streamline structure that suggests a strong emergence of recirculating flows in the still flowing co2 phase which has multiple practical implications such as influencing the transport of dissolved substances e g potentially influencing dissolution dynamics additionally it suggests that inertial effects are important demonstrating potential limitations of upscaled multiphase flow models based on modified forms of darcy s law which neglects inertial effects a further look also reveals that many important structural features are captured in both experiments and simulations in particular relating to the diverse forms in which residual water can be trapped including as a water cone on the downstream side of grains using our temporally and spatially resolved data enables us to explore the formation of such water cones interestingly while the final structure appears very similar in both experiments and simulations the transient evolution differs while we cannot prove it we believe that this again suggests that geometrical features may be the key rather than the fully detailed flow dynamics thus we have demonstrated that our proposed lb model is able to satisfactorily capture several important features of multiphase flow in a realistic pore geometry in particular our model is able to represent true physical properties such as fluid density and viscosity due to its ability to handle relatively large contrasts without having to un physically alter the desired fluid properties additionally while our experiments are able to study the evolution of the co2 through the micromodel with high temporal resolution moving to study much higher flow rates while maintaining such capabilities will be challenging by contrast our numerical model has no such restriction and could be used to more effectively study larger flow rate cases indeed in the context of other complex flows i e non porous media this model has been successfully used to simulate high reynolds number flows fakhari et al 2017a which pose unique challenges under the conditions of large density and viscosity contrast fakhari and bolster 2017 fakhari et al 2017a acknowledgments the experimental portion of this work by y l and k c was primarily supported as part of the center for geologic storage of co2 an energy frontier research center funded by the u s department of energy office of science basic energy sciences under award de sc0c12504 micromodel fabrication and half of the experiments and analysis the modeling portion of this work by a f and d b was supported in part by nsf grant ear 1351623 work by y l d b and k c a portion of experiments analysis and modeling was also supported by the international institute for carbon neutral energy research wpi i2cner sponsored by the world premier international research center initiative wpi mext japan y l also gratefully acknowledges partial support from the center for sustainable energy at the university of notre dame remainder of experiments and analysis supplementary material supplementary material associated with this article can be found in the online version at 10 1016 j advwatres 2018 02 005 appendix a supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 supplementary data s2 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s2 supplementary data s3 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s3 supplementary data s4 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s4 supplementary data s5 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s5 
845,we implement a phase field based lattice boltzmann lb method for numerical simulation of multiphase flows in heterogeneous porous media at pore scales with wettability effects the present method can handle large density and viscosity ratios pertinent to many practical problems as a practical application we study multiphase flow in a micromodel representative of co2 invading a water saturated porous medium at reservoir conditions both numerically and experimentally we focus on two flow cases with i a crossover from capillary fingering to viscous fingering at a relatively small capillary number and ii viscous fingering at a relatively moderate capillary number qualitative and quantitative comparisons are made between numerical results and experimental data for temporal and spatial co2 saturation profiles and good agreement is found in particular a correlation analysis shows that any differences between simulations and results are comparable to intra experimental differences from replicate experiments a key conclusion of this work is that system behavior is highly sensitive to boundary conditions particularly inlet and outlet ones we finish with a discussion on small scale flow features such as the emergence of strong recirculation zones as well as flow in which the residual phase is trapped including a close look at the detailed formation of a water cone overall the proposed model yields useful information such as the spatiotemporal evolution of the co2 front and instantaneous velocity fields which are valuable for understanding the mechanisms of co2 infiltration at the pore scale keywords co2 sequestration lattice boltzmann method porous micromodel capillary fingering viscous fingering pore scale modeling 1 introduction the sequestration of carbon dioxide co2 in geological reservoirs is considered by many to be an essential component in the effective reduction of carbon emissions to the atmosphere and therefore a critical tool in the battle against global climate change huppert and neufeld 2014 pacala and socolow 2004 among possible sites deep saline aquifers are of particular interest owing to their large potential storage capacity worldwide availability and minimal environmental impact bachu 2000 gunter et al 1997 koide et al 1992 central to this approach is accurately predicting both the fidelity of candidate storage sites during pre injection of co2 and its migration post injection which is complicated by multiple factors most notably under typical reservoir conditions co2 is less dense and less viscous than the resident brine which potentially leads to complex and unstable displacement patterns as the co2 infiltrates the pore space both during and after injection complex patterns that emerge at the pore scale lead to macroscopic behaviors that are difficult to predict using current theories recent observations reveal that the macroscopic dynamics of the interface front is strongly tied to and often controlled by a range of pore scale phenomena such as fingering and haines jumps lenormand et al 1988 moebius and or 2014 it is also increasingly accepted that developing subgrid scale models capable of accurately representing pore scale processes is a prerequisite to improving the performance of reservoir scale simulations yet the multiphase multiphysics and multiscale nature of the flow make this task inherently challenging therefore a fundamental understanding of dynamic displacement processes at the pore scale is highly desirable extensive experimental studies of multiphase flows in porous media have been performed using different approaches a number of studies have attempted to observe pore scale flows directly in three dimensional 3d porous models or real rock samples by employing x ray micro computed tomography micro ct and magnetic resonance imaging mri andrew et al 2014 perrin and benson 2010 while these experiments explore the most realistic flows and geometries due to a lack of optical access expensive equipment e g micro ct and mri is a necessity moreover these techniques are generally limited to low temporal resolution and are not best suited for acquiring temporally resolved data which is crucial for studying dynamic displacement processes on the other end of the spectrum more idealized 2d porous media or so called micromodels have been used extensively to study multiphase flows at the pore scale armstrong and berg 2013 blois et al 2015 chen et al 2017 karadimitriou et al 2014 kazemifar et al 2015 2016 li et al 2017 roman et al 2016 zhang et al 2011a 2011b in these micromodels carefully designed or reprinted 2d patterns are etched in silicon or glass slides to which a glass slide is bonded to form a closed cell these 2d micromodels enable direct observation and measurement of pore scale displacement processes using fluorescent microscopy or more advanced techniques such as microscopic particle image velocimetry micro piv kazemifar et al 2015 2016 li et al 2017 roman et al 2016 such 2d micromodels have served as excellent tools for studying the fundamental physics of pore scale flows in porous media the experimental data generated in such studies also provide a convenient basis for the validation of numerical and theoretical models although there is great value to this the highly sensitive and unstable nature of multiphase flows makes direct quantitative comparison between experimental data and simulations challenging as it is virtually impossible to exactly match boundary and initial conditions one must consider this carefully when evaluating the success or failure of a numerical approach as benchmarked against experiments ferrari et al 2015 complementary to experiments numerical simulations can provide access to further and more detailed information about the flow field particularly at the pore scale lenormand et al 1988 thereby complementing experimental studies in many ways existing numerical techniques for studying fluid flow through porous media are manifold e g pore network modeling blunt and king 1991 smoothed particle hydrodynamics sph tartakovsky and meakin 2006 and lattice boltzmann method lbm huang et al 2015 among others here we focus on lbm which is popular due to its a mesoscopic nature b strength in dealing with complex geometries and c ease of parallelization with good scalability on distributed memory machines in addition to the pseudo potential lb model martys and chen 1996 porter et al 2009 shan and chen 1993 perhaps the most common lb model for simulating multiphase flow in porous media is the color gradient or chromodynamic model ba et al 2016 gunstensen et al 1991 huang et al 2014 leclaire et al 2015 with which it is relatively easy to implement different wettability conditions at solid surfaces and which scales well for parallel computations while having many advantages this simplicity also comes at a cost strictly speaking the color model is limited to density matched fluids and numerical stability issues arise for large viscosity ratios and or small capillary numbers although progress has been made in achieving high density ratios ba et al 2016 and in reducing spurious velocities by adding correction terms leclaire et al 2015 the resulting formulations impede computational efficiency and parallelism of the color gradient model making these schemes less practical for efficient simulation of co2 infiltration into water saturated homogeneous and heterogeneous porous media with realistic density or viscosity ratios chen et al 2017 liu et al 2015 2014 phase field lb models are an alternative framework with which one can alleviate some of the aforementioned issues fakhari and rahimian 2010 most of the available phase field models are based on the cahn hilliard equation which requires the calculation of a fourth order derivative this however can be cumbersome and problematic in terms of accuracy efficiency and stability geier et al 2015 additionally while some studies exist that implement arbitrary contact angles within cahn hilliard based lb models connington and lee 2013 these are complicated to implement and the accuracy of implementing the wettability condition is questionable connington et al 2015 an alternative to this is the conservative phase field lbm geier et al 2015 which does not require the calculation of a fourth order derivative and has other advantages over the cahn hilliard equation geier et al 2015 recently we proposed such a conservative phase field lbm for numerical modeling of contact line dynamics on curved boundaries in multiphase flows fakhari and bolster 2017 we have also examined the accuracy and reliability of several phase field lb schemes fakhari et al 2017b here we further develop the phase field lbm fakhari and bolster 2017 with wettability effects for heterogeneous solid structures with realistic co2 brine density and viscosity ratios which is currently not possible using the color gradient model we apply this framework to conduct numerical experiments on co2 invasion into a water saturated porous micromodel for two select capillary numbers representative of capillary and viscous fingering we concurrently carry out matching experiments to which our numerical simulations are both qualitatively and quantitatively compared details of the experimental setup apparatus and methods are given in section 2 the phase field lbm and its numerical implementation details are presented in section 3 a thorough comparison between numerical findings and experimental data is provided in section 4 discussion of numerical and experimental results is presented in section 5 followed by a summary and conclusions in section 6 2 experiment design 2 1 micromodel the micromodels used in this study were fabricated from a silicon wafer using micro fabrication techniques chomsurin and werth 2003 kazemifar et al 2015 they consist of a heterogeneous porous section an inlet and an outlet as shown in fig 1 the unique aspect of the fabricated micromodel is that the porous section represents the pore structure of real sandstone based on a previous study zuo et al 2013 to generate the geometry the pattern encoded in a binary image provided by zuo et al 2013 was first generated from a micro ct scan of a thin slice of sandstone due to limited connectivity associated with the 2d nature of the image the pattern was slightly modified to enlarge the throat size and thus reduce the likelihood of flow blockages the average and minimum throat sizes are 48 µm and 12 µm respectively the full porous section is made up by repeating the basic unit pattern in a 3 3 matrix which has dimensions of l x l y l z 7 101 5 328 0 030 mm and a porosity of ɛ 0 495 based on the pattern matrix sequential processes involving standard photolithography inductively coupled plasma deep reactive ion etching icp drie diamond drilling thermal oxidation and anodic bonding were used to create the heterogeneous structures and to form a 2d micromodel it is worth noting that after thermal oxidation 100 nm of silicon dioxide was grown on the silicon wafer which rendered the surface just as hydrophilic as the glass wafer to which the silicon wafer was bonded to form a closed flow cell the contact angle of water on both surfaces was estimated to be 9 1 degrees using co2 as the non wetting phase the contact angle was measured on flat glass and silicon samples under actual experimental conditions 80 bar 21 c using a separate setup the samples for contact angle measurement were prepared using the same oxidizing and cleaning procedures as for making the micromodel in addition during the course of each experiment we performed an in situ contact angle measurement using fluorescent microscopy in the triangular area near the inlet both measurement approaches yielded consistent measures of the contact angle two nanoports idex health science were attached to the micromodel for fluid delivery 2 2 experimental setup and procedure the coupled flow of water and co2 through the micromodel was controlled by two high pressure syringe pumps teledyne isco 100dm as shown schematically in fig 2 pump 1 filled with liquid co2 was connected to the inlet left port of the micromodel and was used to push liquid co2 pump 2 filled with distilled water was connected to the outlet right port to withdraw water this approach allowed accurate maintenance of the back pressure of the flow system while achieving a constant volumetric flow rate in order to protect the micromodel from over pressurization the micromodel was placed within an overburden pressure cell whose pressure was controlled by a third high pressure syringe pump pump 3 teledyne isco 500d and always maintained at least 5 bar above the micromodel pressure throughout the experiment the overburden pressure cell is simply a cavity made of stainless steel with a sapphire viewing window built into its base whose sole purpose is to maintain the structural integrity of the micromodel during experiments at reservoir relevant pressures the pressurization procedures were as follows before connecting valve t1 to the pressure cell the micromodel was pre saturated with water using pump 2 from right to left then valve t1 was connected to the pressure cell and the micromodel and switched to the line of v1 since valves v1 v2 v3 and v5 were all closed with v4 open the micromodel and pump 2 essentially form a closed internal space whose pressure can be increased by simply running pump 2 in the forward direction at this point pump 3 and pump 2 were run simultaneously until pressures of 86 bar and 80 bar respectively were achieved a high speed differential pressure transducer validyne p55e 1 n 2 42 s 5 a 0 140 kpa 0 1 accuracy was used to measure the instantaneous pressure drop across the micromodel prior to each experiment the co2 was tagged with the fluorescent dye coumarin 153 following zhang et al 2011b the co2 pump was then pressurized to 80 bar and allowed to equilibrate at room temperature for over 2 hr meanwhile the micromodel was mounted in the overburden pressure cell which was then filled with glycerol to facilitate pressurization to begin the experiment the micromodel was pre saturated with pure distilled water under ambient conditions through the outlet the micromodel and the pressure cell were then pressurized simultaneously to 80 and 86 bar respectively after the pressures on the water side and co2 side both reached equilibrium the valve v1 on the co2 line was opened and the co2 and water pumps were simultaneously initiated to run at the desired volumetric flow rates each with an accuracy of 0 3 of the setpoint the instantaneous phase configuration as co2 infiltrated into the water saturated micromodel was imaged using the epi fluorescence microscopy technique as illustrated in fig 3 an led light source thorlabs m385lp1 with a nominal wavelength of 385 nm and a full width at half maximum of 12 nm filtered by a bandpass filter filter 2 semrock brightline ff01 379 34 25 was used to excite the coumarin 153 dye marking the co2 phase the fluorescence emitted from the dye was passed through a dichroic mirror and a λ 445 20 nm bandpass filter filter 3 semrock brightline ff01 445 40 25 and focused by a long distance microscope objective infinity photo optical company k2 distamax onto the detector of a 4 mega pixel 12 bit high speed cmos camera phantom v641 with this imaging setup the resultant magnification and spatial resolution were 2 9 and 3 4 µm respectively and the field of view was approximately 8 8 mm by 5 5 mm which was sufficient to cover the entire porous section of the micromodel as indicated by the green region in fig 1 gray scale images were captured at 1000 hz in order to temporally resolve the dynamic flow processes owing to the epi fluorescence configuration the signal to noise ratio intensity of co2 versus intensity of water or solid matrix of the acquired images was typically greater than 5 which allowed for an unambiguous determination of the instantaneous co2 distribution in each image the saturation of co2 in each frame was calculated by simply thresholding the gray scale image and counting the pixels occupied by co2 due to the non uniformity of the illumination resulting from imperfections of collimating optics the pixels in the center of an image appeared slightly brighter than those on the edges in order to account for this effect a dynamic thresholding scheme was applied i e we divided our image into sub regions within which we calculated the local maximum and minimum intensities a threshold for the sub region was determined based on these two intensities this method was validated with a separate experiment in a micromodel saturated with dyed methanol and the calculated porosity and the design value differed by less than 3 since the same set of image processing procedures with identical parameters was used in the validation experiment as well as in all actual measurements we consider 3 to be an accurate representation of the relative error of the measurements presented herein additional details of this experimental approach can be found in ref kazemifar et al 2015 the physics of the multiphase flow of co2 into a water saturated porous micromodel can be characterized by four dimensionless groups i the density ratio ρ ρ c ρ w where ρ c and ρ w are the densities of liquid co2 and water respectively ii the viscosity ratio μ μ c μ w where μ c and μ w are the viscosities of liquid co2 and water respectively iii the reynolds number re c ρ c u l y μ c where u is the bulk velocity defined as u q a ɛ with q and a being the volumetric flow rate and the frontal area of the micromodel perpendicular to the flow respectively and iv the capillary number ca μ c u σ where σ is the surface tension coefficient between liquid co2 and water the fluid properties and the dimensionless numbers for the two experimental conditions studied are given in tables 1 and 2 respectively 3 numerical modeling we employ a phase field lbm fakhari and bolster 2017 to numerically simulate the experiments described in the previous section strengths of this model include 1 good accuracy 2 an ability to handle large density and viscosity ratios 3 an evolution equation for pressure that is consistent with multiphase flow dynamics and 4 the capability to model pre specified contact angles with smaller spurious velocities than the color gradient or psuedo potential models fakhari and bolster 2017 3 1 phase field lbm the proposed phase field lbm is designed to solve the flow field for isothermal incompressible multiphase fluid systems and consists of two main parts the first is a lattice boltzmann equation lbe for tracking the interface between two different fluids according to the so called conservative phase field equation chiu and lin 2011 1 ϕ t ϕ u m ϕ 4 ξ ϕ 1 ϕ n where ϕ is the phase field which is zero in the relatively light fluid co2 and one in the relatively heavy fluid water and changes smoothly across the interface t is time u is the macroscopic velocity vector m is the mobility ξ is the interfacial thickness and n is the unit vector normal to the co2 water interface 2 n ϕ ϕ ϵ where ϵ 10 32 is a small number to avoid division by zero the last term in the parentheses in 1 is an anti diffusion term that exists only within the interfacial region and prevents the interface from becoming excessively diffusive for a detailed physical explanation please see ref geier et al 2015 in phase field modeling the volumetric free energy of the system is given by jacqmin 1999 2000 3 f β ψ ϕ 1 2 κ ϕ 2 d v where β 12 σ ξ κ 3 σ ξ 2 and the bulk free energy used in this study is 4 ψ ϕ ϕ 2 1 ϕ 2 the chemical potential of the system μϕ is then found by minimizing the free energy according to 5 μ ϕ δ f δ ϕ 4 β ϕ ϕ 1 ϕ 1 2 κ 2 ϕ where δ denotes the variational differentiation the second part of the proposed phase field lbm is a pressure evolution lbe for recovering the macroscopic equations including conservation of mass 6 ρ t ρ u 0 and conservation of momentum navier stokes 7 ρ u t u u p μ u u t f s where ρ and μ are the fluid density and viscosity respectively p is the macroscopic pressure and f s μ ϕ ϕ is the surface tension force between different fluids of note is that the main difference between the current phase field lbm and that proposed in ref fakhari and rahimian 2010 is the interface tracking equation in particular the cahn hilliard equation is used in ref fakhari and rahimian 2010 while the current model is built upon the conservative phase field equation geier et al 2015 the current phase field lbm however is identical to that proposed in ref fakhari and bolster 2017 with the additional contribution of implementing the wettability condition a given contact angle on a heterogeneous solid substrate as will be described in section 3 3 3 1 1 lbe for interface tracking we use the following lbe for tracking the interface between liquid co2 and water fakhari and bolster 2017 8 h α x e α δ t t δ t h α x t h α x t h α eq x t τ ϕ 1 2 where hα is the phase field distribution function τϕ is the phase field relaxation time e α is the lattice dependent mesoscopic velocity set he and luo 1997 and the equilibrium phase field distribution function is 9 h α eq ϕ γ α w α m c s 2 4 ξ ϕ 1 ϕ e α n where 10 γ α w α 1 e α u c s 2 e α u 2 2 c s 4 u u 2 c s 2 in which wα is the lattice dependent weight coefficient set he and luo 1997 c s c 3 is the speed of sound in the system with c δ x δ t 1 lu lattice units where δx and δt are the lattice length scale and time scale respectively the mobility is related to the phase field relaxation time τϕ by 11 m τ ϕ c s 2 δ t assuming a two step collision streaming sequence the phase field is calculated by taking the zero th moment of the phase field distribution function after the streaming 12 ϕ α h α and then the density is updated by 13 ρ ρ w ϕ ρ w ρ c 3 1 2 lbe for hydrodynamics the following lbe is solved for recovering the hydrodynamic properties in nearly incompressible multiphase flows fakhari and bolster 2017 14 g α x e α δ t t δ t g α x t ω α x t f α x t where g α is the modified hydrodynamic distribution function ωα is the collision operator and fα is 15 f α x t δ t γ α w α ρ w ρ c c s 2 γ α μ ϕ e α u ϕ we use the multiple relaxation time mrt collision operator fakhari and lee 2013 lallemand and luo 2000 16 ω α x t m 1 s m g α g α eq where m is the orthogonal transformation matrix s is the diagonal relaxation matrix and the modified equilibrium distribution function is 17 g α eq g α e q 1 2 f α in which 18 g α e q p w α ρ c s 2 γ α w α is the equilibrium distribution function the orthogonal transformation matrix is given in ref lallemand and luo 2000 for the d2q9 lattice used in the present study in order to update the hydrodynamic relaxation time we first calculate the dynamic viscosity according to 19 μ μ c ϕ μ w μ c followed by updating the relaxation time according to 20 τ μ ρ c s 2 this approach has been shown to be more accurate than directly calculating the relaxation time from the phase field using a linear or harmonic interpolation fakhari et al 2017b after solving the lbe 14 using a routine collision streaming sequence the hydrodynamic properties are calculated by 21a u 1 ρ c s 2 α g α e α δ t 2 ρ f s 21b p α g α δ t 2 ρ w ρ c c s 2 u ϕ note that the updated velocity is used in calculation of the pressure 3 2 numerical implementation to implement the lbm described in the previous section one must be able to calculate the gradients of the phase field for mass balance and stability reasons this is done using second order isotropic differences fakhari and bolster 2017 although one might lose accuracy at high density ratios using central differences has shown to be very effective and reasonably accurate for numerical simulation of multiphase flows at low density ratios which is the case in the present study the numerical values of mobility m and interfacial thickness ξ play a key role in the stability and accuracy of phase field lb models the effects of these numerical parameters on the simulation results was considered by fakhari et al 2017a who conducted a sensitivity analysis here we use the empirical guidelines described in ref fakhari et al 2017a to choose these parameters in general having a small ξ is desirable as this improves convergence towards sharp interface solution a small value for ξ however might lead to numerical instability especially at high density ratios as suggested in ref fakhari et al 2017a we use ξ 3 lu which is an optimal value for interfacial thickness at low density ratios less than 10 similarly a high value for the mobility results in excessive numerical dissipation which deteriorates the accuracy of the results on the other hand having a too small m might cause numerical instability in this work we set the mobility to m 0 01 lu fakhari et al 2017a the computational domain shown in fig 4 is discretized using 2131 1599 grid cells on the left boundary where a flat co2 front is located we impose a parabolic poiseuille profile as the inlet velocity while a convective outflow boundary condition bc is applied on the right boundary as will be shown in section 4 1 the distance from the inlet to the porous section of the micromodel xi has a noticeable effect on the numerical results the bottom and top boundaries are treated as solid walls with wettability conditions more on this in section 3 3 we represent the solid grains using stair shaped boundaries boundary conditions are imposed using bounce back on the link to find the value of the unknown distribution functions coming from the solid cells towards the fluid domain details of implementation of the initial and boundary conditions as well as enforcement of an arbitrary contact angle on solid walls are described below 3 3 wettability condition on solid boundaries implementing wettability conditions is easily done in for example the color gradient and pseudopotential lb models because there is no need to calculate the vector normal to the solid boundary in those models this however comes with some drawbacks such as large spurious velocities and restriction to density matched fluids on the other hand finding the normal to the solid surface in a heterogeneous solid structure can be cumbersome in phase field models to the best of our knowledge there are few studies for implementing arbitrary contact angles in cahn hilliard based lb models connington and lee 2013 aside from a complicated algorithm and tedious implementation the accuracy of implementing the wettability condition is questionable connington et al 2015 although contact line dynamics on homogeneous curved solid boundaries have been recently proposed fakhari and bolster 2017 there is no contact angle treatment for heterogeneous solid structures in conservative phase field models for this purpose we present a straightforward algorithm here to impose a pre specified contact angle at the solid walls the wall free energy is postulated to be of the form ding and spelt 2007 jacqmin 2000 22 κ n w ϕ x w 6 σ ψ ϕ cos θ which can be simplified to fakhari and bolster 2017 23 n w ϕ x w 2 β κ ϕ w 1 ϕ w cos θ where n w is the unit vector out normal to the solid wall θ is the static contact angle and ϕ w is the unknown value of the phase field at the wall the unknown quantities in eq 23 are n w and ϕ w the out normal vector n w n x x n y y depends on the given geometry for stationary boundaries which is the case in the present study it can be readily calculated a single time at the beginning of the simulations referring to fig 5 a boundary cells marked as red circles can be easily identified by those solid cells that have at least one neighboring fluid cell once the boundary cells are identified their out normal vectors can be determined by probing the adjacent boundary cells for a 2d geometry we find the x and y components of the normal vector according to the following algorithm if both left and right neighbors of a given boundary cell are solid cells then the normal vector is in the y direction n x 0 otherwise n x points in the x direction where there is a fluid cell similarly if both bottom and top neighbors are solid walls the normal vector is in the x direction n y 0 otherwise n y points to an available fluid cell in the y direction if all orthogonal bottom top left and right neighbors are solid cells then we pick the first diagonal neighbor that is a fluid cell and define the normal vector accordingly this process takes care of the majority of boundary cells with only few exceptions such as convex corner nodes which will be handled separately to make sure that the normal vector is consistently pointing to a fluid cell after finding the vectors normal to the boundary cells we can eliminate ϕ w in eq 23 using the following relations 24a n w ϕ x w ϕ n w x w ϕ f ϕ s 2 h 24b ϕ w ϕ f ϕ s 2 where x f x s n w ϕ f ϕ x f ϕ s ϕ x s and 2 h x f x s n w is the distance between the boundary cell and the fluid cell in the orthogonal directions 2 h 1 lu while in the diagonal directions 2 h 2 lu substituting eq 24 into eq 23 then gives us the unknown value of the phase field at the boundary cells 25 ϕ s 1 a 1 a 1 a 2 4 a ϕ f ϕ f where 26 a h 2 β κ cos θ θ 90 for neutral wetting conditions θ 90 the trivial solution is ϕ s ϕ f 3 4 boundary conditions for the distribution functions in addition to the wetting bc for the phase field at the solid walls the distribution functions coming from the boundary nodes towards the fluid nodes must be determined noting the post collision state of the distribution functions by f where f is a placeholder for either h or g the value of f i at a typical solid boundary node x s is unknown referring to fig 5 b we use the mid way bounce back rule to determine the unknown distribution functions at the boundary nodes before the streaming step 27 f j x s f i x f where j denotes the bounce back direction such that e j e i given a predetermined stationary geometry we identify each boundary node and store its coordinates using two integer numbers together with two indices to identify its normal direction 3 5 initial inlet and outlet boundary conditions initially the porous medium is saturated with water and the phase field is initialized according to 28 ϕ x y 1 2 1 tanh x ξ ξ 2 in other words at the initial time the co2 front is a flat interface located at x ξ a parabolic velocity profile is imposed at the inlet using the non equilibrium bounce back scheme zou and he 1997 after the streaming step according to 29 f i x 0 f o f i e q f o e q x 0 where f is a placeholder for h or g and the subscripts i and o denote the incoming and outgoing distribution functions respectively such that e o e i the outgoing distribution functions fo are known after the streaming step and the equilibrium values f i e q and f o e q are found via eqs 9 and 17 by imposing a uniform phase field ϕ 0 and a parabolic velocity profile at the inlet at the outlet we impose the following convective outflow bc for the unknown distribution functions entering the domain 30 f i t u c f i x x x o 0 where xo is the x location of the outlet boundary uc is the convective velocity to be specified at the outlet it is worth noting the key differences between the current convective bc and those presented in ref lou et al 2013 first using the implicit upwind scheme we solve eq 30 only for the unknown incoming distribution functions while in ref lou et al 2013 eq 30 was solved for the distribution functions in all directions second as opposed to a maximum average or local value for the outlet velocity in ref lou et al 2013 we propose to use the following convective velocity 31 u c x o y max 0 u x x o y for consistency with the upwinding scheme it is important to ensure that the convective velocity is positive this is particularly crucial at small capillary numbers or relatively low flow rates where the characteristic velocity is comparable to spurious currents in our simulations u 0 o 10 4 which is too small for some common schemes to be numerically stable 4 results in this section results from both the lbm simulations and drainage experiments are shown with both quantitative and qualitative comparisons made between them to facilitate comparison a dimensionless time was defined as t t t c where t c l x u is the characteristic time with lx being the length of the porous section as listed in table 2 two different flow rates namely 0 05 ml min and 0 25 ml min corresponding to capillary numbers of 2 65 10 5 and 1 33 10 4 respectively are studied at 8 mpa and 21 c the cases with the low log ca 4 58 and the high log ca 3 88 flow rates are expected to fall within the crossover from capillary to viscous fingering and the viscous fingering regimes respectively zhang et al 2011b 4 1 crossover from capillary to viscous fingering ca 2 65e 5 co2 infiltration into a water saturated micromodel is a complicated process involving the migration of the co2 front the evolution of individual menisci and the growth of dendritic structures i e the fingers kazemifar et al 2016 lenormand et al 1988 as can be seen in the movies provided in the supplementary materials chronologically the entire drainage process can be qualitatively classified into three distinct flow stages i migration of the co2 front in the triangular area c f fig 2 prior to its arrival at the porous section ii percolation of co2 through the micromodel until the flow pattern within the porous section no longer changes quasi steady state and iii post front passage when the distribution of co2 and residual water remain largely unchanged for a long period of time note that during stage iii the flow pattern may eventually be altered by some very slow processes like co2 dissolution into water gangila and shear induced film flows i e quasi steady state kazemifar et al 2016 li et al 2017 morais et al 2016 however these processes are so slow that they are beyond the time scales of interest in this work and therefore are not considered fig 6 shows a few representative snapshots of co2 infiltration into the water saturated micromodel at different times for ca 2 65 10 5 including results from experiments and simulations the full evolution can be seen in videos provided as supplementary materials here t 0 is chosen to correspond to the instant when the co2 front first reaches the porous section i e when co2 saturation within the porous section first becomes non zero in the experiments prior to t 0 the co2 front propagates within the triangular region on the left of the porous section c f fig 1 the front remains significantly curved during this flow stage meaning that the middle portion of the front arrives at the porous section much faster than it reaches the edges see movies in supplementary materials this middle portion of the co2 front becomes pinned to the solid substrate at the entrance of the porous section due to capillary resistance of the porous matrix and the liquid co2 behind the front region continues to expand laterally towards the upper and lower boundaries of the micromodel at t 0 2 co2 partially breaks into the porous section in the form of fingers it is evident that three primary fingers develop at locations corresponding to the most permeable pathways within the porous section where capillary resistance is expected to be lower these three fingers grow predominately in the horizontal direction from left to right consistent with the direction of the bulk pressure gradient thus displaying characteristics of viscous fingering zhang et al 2011b by t 0 4 the three primary fingers have grown even further nearly reaching the outlet boundary of the porous section besides these primary fingers there are multiple secondary fingers that have formed between the primary ones including side fingers emerging from each primary finger the growth lines of these secondary and side fingers are not exactly aligned with the direction of the bulk pressure gradient but rather occur in transverse directions and even backwards against the bulk pressure gradient which is an indication of capillary fingering the coexistence of patterns associated with capillary and viscous fingering suggest that this flow is in the crossover regime from capillary to viscous fingering in agreement with previous flow phase diagram studies using homogeneous micromodels lenormand et al 1988 zhang et al 2011b at t 0 6 while the primary fingers remain largely unchanged the secondary and side fingers continue to grow with each finger branching into multiple fingers in all directions another interesting feature of this snapshot and in the following ones is the existence of isolated co2 blobs within the porous section presumably attributable to snap off effects lenormand et al 1983 these isolated blobs are observed in both the experiments and in the numerical simulations at t 0 8 and t 1 0 the percolation process stage ii is nearly complete with all fingers nearly fully developed although the spatial distributions of co2 and water remain largely unchanged during the rest of the experiment or simulation it can be observed that at the ends of certain fingers the co2 front can locally jump and or retract over short distances suggesting the existence of only a quasi static system the results presented in fig 6 indicate fairly good qualitative agreement between the experiment and the 2d simulation particularly considering the high complexity of the flow system i e unstable multiphase flow in a superhydrophilic heterogeneous porous matrix the simulation and experiment produce qualitatively similar dynamics of fingering as well as similar spatial distributions of co2 perhaps the most evident discrepancy between the experiment and simulation in fig 6 is that the development and advancement of the fingers in the simulations appears to be slightly ahead of that observed in the experiments we conjecture that this difference can primarily be attributed to the discrepancy in the initial and boundary conditions between experiment and simulation although of course model limitations and or errors might also play a factor as already noted during flow stage i in the experiment the co2 front is significantly curved within the triangular region and the exact shape of the co2 front is not only difficult to control experimentally but also difficult to match numerically in fact some discrepancies exist even between two trials of the same experiment see fig 8 moreover the velocity field at the inlet boundary for both the co2 and water sides is significantly perturbed as a result of the propagation of the curved co2 front due to limitations of current measurement techniques kazemifar et al 2015 the velocity field cannot be quantitatively evaluated in the co2 phase and thus cannot be reconstructed and matched numerically given that the liquid co2 pumps into the micromodel through a cylindrical tube in the experiments we suspect that numerically placing a flat co2 front in the vicinity of the porous section will not accurately represent the experimental conditions upon careful inspection of the liquid co2 profile away from the porous region in the experiments we observe a radial flow in the vicinity of the inlet tube the green tube in fig 1 and hence a parabolic rather than uniform velocity profile close to the porous region see the videos in supplementary materials this behavior leads to a parabolic profile for the liquid co2 front at the entrance of the porous section thus in order to better match the initial conditions between numerical simulations and experiment we extended the length of the inlet region by two orders of magnitude from x i 5 lu to x i 300 lu after rerunning the simulations with x i 300 lu we found that placing a flat co2 front close to the porous section of the micromodel is indeed erroneous see the obtained parabolic co2 front in fig 7 when x i 300 lu a quantitative comparison of co2 saturation as a function of time shown in fig 8 for ca 2 65 10 5 further confirm our speculation fig 8 which depicts the data for two separate experiments black circles and red squares along with numerical simulations using two different entry lengths of x i 5 lu green line and x i 300 lu blue line shows an improvement in the temporal evolution of the co2 saturation in the porous micromodel when the length of the inlet region is increased to x i 300 lu as can be seen in fig 8 the shapes of the saturation curves are very similar between the experimental data and simulation results in particular when the inlet region is extended to x i 300 lu the new numerical results nearly match the experimental data with the final co2 saturations i e the quasi steady state values standing at 49 5 49 6 and 49 5 for experiment 1 experiment 2 and simulation blue line respectively these values represent a difference of less than 0 1 between the second experiment and the simulation for which the co2 distributions are shown in fig 9 at t 1 5 it is evident that the original simulation profile with x i 5 lu green line has a higher final saturation than the experimental data for most of the range of t shown in fig 8 this is consistent with the observation from fig 6 that the development of fingers in the original simulations is ahead of that in experiment due to the different inlet boundary conditions in order to further compare the simulations with the micromodel experiments in a quantitative way spatial profiles of co2 saturation in the porous micromodel are plotted in fig 10 at quasi steady state t 1 5 for ca 2 65 10 5 for both experiments and simulation to calculate the data for the spatial profile using simulation results the entire porous section 2131 1599 grid cells was first divided into 194 bins i e 193 bins each with a width of 11 grid cells and one last bin with a width of 8 grid cells in the horizontal direction and then the local co2 saturation was calculated within each bin by counting the cells filled with co2 for the experimental data the acquired image with a typical size of 2066 1550 pixels was first mapped onto a 2131 by 1599 matrix using bilinear interpolation and then the local co2 saturation at each x location was calculated following the same procedure as used in the simulations as shown in fig 10 the spatial saturation profile obtained using lb simulation compares favorably with experimental data predicting most of its peaks and valleys with reasonable accuracy although some discrepancies do exist it must be noted though that even intra experimental variability exists and that the mismatch between experiments is comparable to any mismatch between a given experiment and the simulation in particular a correlation analysis shows that the correlation coefficient between the saturations for both experiments χ 0 85 is comparable to the correlation coefficient between experiments and simulations χ 0 78 0 82 this again highlights the high sensitivity of these systems to initial and boundary conditions which must be carefully considered when evaluating model success 4 2 viscous fingering ca 1 33e 4 in the previous subsection section 4 1 we showed that the numerical results are more consistent with experimental observations if the inlet length is extended as such the remainder of the simulations were carried out using an extended inlet length of x i 300 lu fig 11 shows representative snapshots of co2 infiltration into the water saturated micromodel at different times for ca 1 33 10 4 which is 5 times larger that the previous case it can be seen in fig 11 at t 0 37 that for the experiments the invasion of co2 concentrates near the central portion of the porous section with very little invasion towards the edges suggesting that the boundary effects are even more severe in this case owing to the higher flow rate in the previous case ca 2 65 10 5 when the co2 front arrived at the porous section its middle portion became pinned at the entrance of the porous section simply because the pressure behind the co2 water interface was insufficient to overcome the capillary resistance of the porous matrix while the pressure was accumulating the co2 front expanded in the lateral direction stage i leading to a flatter co2 front which mitigated such boundary effects to some extent on the other hand in the current case the bulk pressure gradient is higher moreover due to a higher re inertial effects are more significant and the period for pressure accumulation is much shorter therefore as soon as the middle portion of the co2 front arrives at the porous section the invasion process begins almost immediately even though the co2 front has still not extended laterally over the inlet of the porous section this behavior is in contrast to the simulations where some such effects are visible i e the central fingers advance earlier and further than those close to the edges but the effects are not as strong again highlighting the clear importance of boundary conditions in this problem which are next to impossible to replicate identically between experiment and simulation aside from such boundary effects the higher flow rate case is fundamentally different than the previous case in two respects first it is evident that the fingering in this case is predominately from left to right in line with the bulk pressure gradient with few fingers growing in other directions this trend is indicative of viscous fingering only which again is in agreement with the flow phase diagram of zhang et al 2011b second the co2 saturation is higher in this case than that in the previous one again in agreement with previous studies cao et al 2016 zhang et al 2011b as the flow rate and the bulk pressure increase inertial effects also increase which facilitates the invasion of throats with higher capillary resistance i e relatively smaller throats moebius and or 2014 therefore additional viscous fingers are formed leading to a higher final co2 saturation as is evident in fig 12 the temporal evolution of liquid co2 saturation in the entire porous section is shown in fig 12 for ca 1 33 10 4 a comparison is made between two experimental trials and simulation as can be seen the simulation agrees reasonably well with both sets of experimental data at early times when the co2 saturation is still growing this is despite clear discrepancies that are shown for example in fig 11 where the experiment has no invasion along the edges of the micromodel at later times there is a deviation between the two experimental data sets as well as with the simulation result attaining a lower final saturation than the experiments the spatial variation of liquid co2 saturation inside the porous micromodel at quasi steady state t 1 5 is shown in fig 13 for ca 1 33 10 4 the general trend in the oscillatory behavior of the saturation profile is predicted in the simulations with comparable variability between peaks and troughs as well as horizontal scales over which the variations occur when compared with experimental data there are however some clear differences between simulations and experiment particularly near the inlet to the porous medium and at the outlet this further highlights the clear influence of the boundary conditions which at this higher flow rate seems to become even more important additionally there are visible discrepancies within the domain in particular the valleys of simulation are lower than those of experiment data in line with the previous observation of lower overall late time saturation fig 12 once more a correlation analysis shows that the correlation coefficient between the saturations for both experiments χ 0 56 is comparable to the correlation coefficient between the saturations predicted by the model and measured in the experiments χ 0 47 0 54 the lower value of the correlation coefficient here compared to the previous case reflects a more challenging situation in terms of reproducibility reflecting the highly sensitive nature of this flow under these unstable conditions 5 discussion on certain flow characteristics one of the main benefits of working with high resolution numerical simulations is that one can resolve the velocity field throughout the flow domain previous experiments in both homogeneous kazemifar et al 2016 and heterogeneous li et al 2017 porous micromodels show that for multiphase flows associated with conditions relevant to co2 sequestration as studied here inertial effects can become significant the velocity field and streamlines in the flowing co2 phase in a select location within the porous section of the micromodel are shown in fig 14 at quasi steady state for both ca 2 65 10 5 and ca 1 33 10 4 it is interesting to note that recirculation regions clearly exist at both flow conditions although they appear to be larger and more significant in the higher flow rate case perhaps due to stronger inertial forces note that the reynolds number in the viscous fingering case re c 3105 is an order of magnitude larger than that in the capillary fingering case re c 621 it is important to recognize that although the co2 and water phases have reached quasi steady spatial configurations at this stage of the flow processes the recirculation zones reported herein occur in the still flowing co2 phase while recent studies have reported the occurrence of recirculation zones within trapped fluid phases owing to high shear imparted at the fluid fluid interface by the still flowing phase kazemifar et al 2016 li et al 2017 those identified herein are strong reflections of inertia especially given their substantial sizes this important observation is only possible when the detailed velocity field within the flowing phase co2 as shown in fig 14 can be accurately captured which has rarely been reported before further beyond simply being interesting to observe the emergence of recirculation in the still flowing co2 phase there are also practical consequences associated with this observation multiphase flows are known to strongly impact transport and mixing processes e g jiménez martínez et al 2015 2017 2016 and the presence of recirculation zones is known to strongly influence the transport of dissolved substances in a porous medium e g bolster et al 2009 2014 which could have a strong impact when studying for example the longer term processes of dissolution of co2 into the water phase which is considered an important permanent trapping mechanism of sequestered co2 gilfillan et al 2009 the identified recirculation zones clearly arise due to the manner in which the co2 phase distributes itself throughout the porous medium creating dead end like cavity and pore structures that are known to be conducive to creating such features in order to believe that they emerge in the real flows and are not an artifact of the simulation the local fluid phase distributions in simulations and experiments should display similar physical and structural characteristics in particular the distribution of the trapped residual water is key zhang et al 2011b highlighted four distinct forms in which the residual phase can be present i pools that occupy multiple pore bodies ii thin films surrounding the grains iii bridges between pore throats and iv cones on the down gradient side of silicon posts which have also been observed in other experiments morais et al 2016 fig 15 zooms in on a small section of the micromodel that displays many of these features in particular we focus on comparing the phase distributions at quasi steady state between experiment and simulation while some discrepancies clearly exist most of the dominant features are well captured and the distinct forms of trapped water exist in similar forms and sizes in both including the water cone behind the large grain in the center of the image interestingly it has been suggested that such cone structures are not thermodynamically stable and may merge with other structures during this quasi steady phase zhang et al 2011b zhang et al 2011b suggested that the formation of such water cones is due to the high shear stress and drag force induced by the fast flow of the nonwetting phase which in turn deforms a wetting film into the shape of a cone on the other hand morais et al 2016 attributed the formation of water cones to surface heterogeneities which influence the behavior of the triple line while both statements are reasonable explanations for water cones occurring at quasi steady state discussion on the dynamics associated with their formation is rare presumably due to technical challenges in characterizing such flows i e the very high spatial and temporal resolutions required in order to resolve this process here our simulations and experiments provide a detailed view of the process as shown in fig 16 interestingly while the quasi steady state in the simulations and experiments appear somewhat similar the transient process of reaching this state differs more suggesting that the final saturation distribution is indeed controlled by pore scale geometry and heterogeneities despite clear discrepancies in the detailed dynamics both experiment and simulation suggest that the formation of a water cone is highly related to the interaction of two distinct co2 fingers of course the porous matrix is highly hydrophilic and therefore the water tends to adhere to the solid surface as evident in fig 16 d and o two co2 fingers are attempting to enter the specific pore almost simultaneously one through the top throat and the other one through the bottom throat in the beginning the bottom finger leads the process and enters around the grain dimple shaped which displaces most of the water out of the pore and leaves some behind in the dimple g and p however as the top finger becomes stronger the bottom one begins to recede h i q and r driving more water back into the pore when the top finger grows further the two fingers eventually merge and a pocket of water is trapped within the pore forming a water cone attached to the grain therefore we conjecture the key elements that enhance the formation of water domes are strong surface hydrophilicity high flow rate and geometric heterogeneity suggesting that both ref zhang et al 2011b and ref morais et al 2016 are correct it is worth reemphasizing that the final phase distribution around the pore is very similar between experiment and simulation in spite of the clear discrepancies during the process of formation for instance the top finger grows much earlier in the experiment than that in the simulation and a few snap off events occurred in the experiment g and h but not in the simulation note that our simulation is capable of capturing such snap off events as evident in fig 11 just not in this case we conjecture that such discrepancies are likely related to boundary effects as we mentioned multiple times before i e the top finger is much closer to the centerline of the domain we must note that it is merely a conjecture but if correct this reinforces our idea that geometry has significant control over the final phase distribution although the dynamics may take a rather different pathway we have no way of formally proving this at this point in time but hopefully future model experiment comparisons will reveal whether this is correct or not 6 summary and conclusion using micromodel experiments and lbm simulations we have studied multiphase flow through a heterogeneous porous medium at the pore scale under conditions relevant to geologic co2 sequestration the pore geometry is based on a real sandstone thus replicating more realistic pore structures than many previous micromodel studies we have focused our study on two flow rates covering unstable flows in the range of crossover from capillary fingering to viscous fingering and viscous fingering regimes while there are clear discrepancies in the specific details of how the co2 distributes itself through the porous matrix both in space and time there is reasonable agreement between the ultimate steady state saturations predicted by the simulations and those measured in the experiments in fact a correlation analysis suggests that differences between model and experiment are comparable to differences between individual experimental trials given the unstable nature of the flow such inter experiment differences are to be expected but the good agreement also highlights unlike a flow through a homogeneous porous medium that the instability and fingers that are formed are strongly controlled by the grain sizes and structure additionally differences between the experiment and simulation can also be attributed to differences in initial and boundary conditions due to inherent experimental uncertainties it is nearly impossible to apply the exact same boundary conditions in our simulations and given the sensitive nature of the flow differences are to be expected however we also showed that better agreement was obtained when our simulations more faithfully represented the flow in the entrance region of the micromodel before the co2 even entered the porous region such a sensitivity to boundary and initial conditions suggests that efforts to improve detailed agreement between numerical simulations and experiments ad nauseam may be doomed to failure we believe that instead efforts should be made to ensure that large scale qualitative features are faithfully represented in such a way that may be useful for upscaling purposes or uncertainty quantification although we acknowledge that it is not clear if this is genuinely possible without capturing all fine scale details of course certain disagreements between the model and the experiments can also be attributed to limitations of the numerical model which while promising as with all models suffers numerical error and potentially incomplete physics e g the diffuse interface approximation of the phase field model while helpful for numerical stability may not be totally representative of the microscopic interface between phases additionally it is well known that the density and viscosity of supercritical co2 are highly sensitive to pressure and temperature fluctuations which is not accounted for in our model note for example that while some convergence testing was done we did not conduct a comprehensive numerical convergence test as this was beyond our available computational resources additionally the numerical results presented in this manuscript are limited in that they are only 2d simulations which cannot resolve inter boundary effects between the top and bottom plate while we also developed 3d simulations doing so comprehensively over the full time of the experiments e g including the 300 lu entry length was beyond our computational resources however our preliminary results suggest that certain improvements over the 2d results are achievable by resolving the third dimension e g closer asymptotic saturations for our second experimental data set since a 3d model is able to fill in patches of the porous medium that might be inaccessible a 2d model bhattad 2010 a detailed view of the quasi steady state distribution of co2 and water shows a streamline structure that suggests a strong emergence of recirculating flows in the still flowing co2 phase which has multiple practical implications such as influencing the transport of dissolved substances e g potentially influencing dissolution dynamics additionally it suggests that inertial effects are important demonstrating potential limitations of upscaled multiphase flow models based on modified forms of darcy s law which neglects inertial effects a further look also reveals that many important structural features are captured in both experiments and simulations in particular relating to the diverse forms in which residual water can be trapped including as a water cone on the downstream side of grains using our temporally and spatially resolved data enables us to explore the formation of such water cones interestingly while the final structure appears very similar in both experiments and simulations the transient evolution differs while we cannot prove it we believe that this again suggests that geometrical features may be the key rather than the fully detailed flow dynamics thus we have demonstrated that our proposed lb model is able to satisfactorily capture several important features of multiphase flow in a realistic pore geometry in particular our model is able to represent true physical properties such as fluid density and viscosity due to its ability to handle relatively large contrasts without having to un physically alter the desired fluid properties additionally while our experiments are able to study the evolution of the co2 through the micromodel with high temporal resolution moving to study much higher flow rates while maintaining such capabilities will be challenging by contrast our numerical model has no such restriction and could be used to more effectively study larger flow rate cases indeed in the context of other complex flows i e non porous media this model has been successfully used to simulate high reynolds number flows fakhari et al 2017a which pose unique challenges under the conditions of large density and viscosity contrast fakhari and bolster 2017 fakhari et al 2017a acknowledgments the experimental portion of this work by y l and k c was primarily supported as part of the center for geologic storage of co2 an energy frontier research center funded by the u s department of energy office of science basic energy sciences under award de sc0c12504 micromodel fabrication and half of the experiments and analysis the modeling portion of this work by a f and d b was supported in part by nsf grant ear 1351623 work by y l d b and k c a portion of experiments analysis and modeling was also supported by the international institute for carbon neutral energy research wpi i2cner sponsored by the world premier international research center initiative wpi mext japan y l also gratefully acknowledges partial support from the center for sustainable energy at the university of notre dame remainder of experiments and analysis supplementary material supplementary material associated with this article can be found in the online version at 10 1016 j advwatres 2018 02 005 appendix a supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 supplementary data s2 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s2 supplementary data s3 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s3 supplementary data s4 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s4 supplementary data s5 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s5 
846,in this work we examine the dispersion of conservative tracers bromide and fluorescein in an experimentally constructed three dimensional dual porosity porous medium the medium is highly heterogeneous σ y 2 5 7 and consists of spherical low hydraulic conductivity inclusions embedded in a high hydraulic conductivity matrix the bimodal medium was saturated with tracers and then flushed with tracer free fluid while the effluent breakthrough curves were measured the focus for this work is to examine a hierarchy of four models in the absence of adjustable parameters with decreasing complexity to assess their ability to accurately represent the measured breakthrough curves the most information rich model was 1 a direct numerical simulation of the system in which the geometry boundary and initial conditions and medium properties were fully independently characterized experimentally with high fidelity the reduced information models included 2 a simplified numerical model identical to the fully resolved direct numerical simulation dns model but using a domain that was one tenth the size 3 an upscaled mobile immobile model that allowed for a time dependent mass transfer coefficient and 4 an upscaled mobile immobile model that assumed a space time constant mass transfer coefficient the results illustrated that all four models provided accurate representations of the experimental breakthrough curves as measured by global rms error the primary component of error induced in the upscaled models appeared to arise from the neglect of convection within the inclusions we discuss the necessity to assign value via a utility function or other similar method to outcomes if one is to further select from among model options interestingly these results suggested that the conventional convection dispersion equation when applied in a way that resolves the heterogeneities yields models with high fidelity without requiring the imposition of a more complex non fickian model keywords solute transport upscaling laboratory experiments heterogeneous porous media model complexity 1 introduction in natural geological systems highly heterogeneous materials are the rule rather than the exception one approach for representing systems with very high variations of hydraulic conductivity is to represent the field as a set of distinct regions either through hydrofacies mapping anderson et al 1999 through indicator methods knudby and carrera 2005 or a combination of these two approaches bianchi and pedretti 2017 lee et al 2007 a particular simplification of these models is the case of bimodal or dual domain media where only two classes of materials are present e g low conductivity immobile regions embedded in high conductivity mobile regions davit et al 2012 fiori et al 2011 golfier et al 2011 jankovic et al 2003 knudby and carrera 2005 molinari et al 2015 van genuchten and wierenga 1976 such media can serve as an idealization of a highly heterogeneous but continuous porous medium that has been segmented into high and low conductivity components so that the total variance of each segment is reduced the important hydrogeologic role of such representations has been discussed recently by molz 2015 low conductivity frequently referred to by the terminology immobile regions are often conceptualized as being spherical or ellipsoidal in analytical coats et al 1964 fernàndez garcia and sanchez vila 2015 haggerty and gorelick 1995 poley 1988 rabinovich et al 2013 numerical bianchi and pedretti 2017 finkel et al 2016 lee et al 2017 and experimental golfier et al 2011 zinn et al 2004 investigations ellipsoidal or spherical representations of low conductivity inclusions have been used extensively both to represent actual structures observed in the field e g jussel et al 1994 murphy et al 1992 and as a reasonable simplification of low conductivity regions dagan and lessoff 2001 the relevance in this approximation has been discussed in detail in dagan and lessoff 2001 janković et al 2006 who use ellipsoidal inclusions in their representations and in the review by frippiat and holeyman 2008 in a recent review article on the geological representation of heterogeneity eaton 2006 p 195 discusses such idealizations for situations where the heterogeneity is particularly large by noting composite media approaches in which different heterogeneous structures of contrasting hydraulic properties such as inclusions of different shapes have also been used to quantify flow numerically as these methods become more widely understood and implemented in readily available modeling codes their application will allow a geostatistical approach to even the most heterogeneous flow systems a significant advance early investigations of bimodal systems accounted for the influence of immobile regions on transport phenomena by representing the immobile region with a stagnant volume fraction which is coupled to the mobile region with a constant mass transfer coefficient α coats et al 1964 deans 1963 deans and lapidus 1960 rao et al 1980 this idea has been extended to more general multiple region models carrera et al 1998 haggerty and gorelick 1995 and models that include convection and dispersion in both regions ahmadi et al 1998 ginn et al 2017 golfier et al 2007 goltz and roberts 1986 haggerty and gorelick 1995 haggerty et al 2000 van genuchten and wierenga 1976 reviews of much of the literature on this topic have been presented by cherblanc et al 2003 and fernàndez garcia and sanchez vila 2015 for bimodal representation of heterogeneous materials the spatial domain is usually envisioned as being separated into two components 1 a connected high conductivity medium and 2 a disconnected low conductivity medium although in some models the low conductivity medium is assumed to be immobile in more recent models it is assumed that convective fluxes can exist in the disconnected phase because mass transfer occurs between the high and low conductivity regions the resulting model can represent a range of transport behaviors from conventional convection dispersion to transport that appears significantly non fickian the characteristic times associated with transport in each of the two regions can span a large range if the conductivity variance in the medium as a whole is large such differences in transport times can result in asymmetric breakthrough curves and tailing bianchi et al 2011 fiori et al 2011 haggerty et al 2000 li et al 2011 van genuchten and wierenga 1976 zinn and harvey 2003 accurate and economical descriptions of tailing phenomena have been of significant interest in hydrological applications for some time the objectives of this paper are 1 to describe a new set of three dimensional experiments for solute transport in a bimodally distributed system and 2 to assess the ability for a hierarchy of decreasingly complex models to adequately represent the breakthrough curves from these experiments in particular we are interested in the use of simplified models to simultaneously reduce the complexity our measure of the complexity is an algorithmic one described in detail below while maintaining fidelity with the experimental observations we analyze the experimental results using two strictly numerical and two upscaled models chastanet and wood 2008 each of these models can be described briefly as follows 1 a fully detailed i e resolving all heterogeneities fully direct numerical simulation dns of the entire experimental domain 2 a fully detailed but domain reduced representation of the experimental system 3 an upscaled two region model accounting for transience in the mass transfer process and finally 4 an upscaled model that assumes that the mass transfer process is roughly quasi steady so that the mass transfer coefficient is a constant one important feature of this work is that the experimental system has been highly characterized so all models of the system are in the absence of adjustable parameters we examine the ability of each of these models to represent the experimental breakthrough curves and offer some assessment as to how well reduced complexity models perform as compared to models that represent essentially perfect information i e fully resolved dns where the geometrical details are represented explicitly within the bounds of experimental error 2 background and previous work bimodally distributed media have been studied experimentally by a number of researchers in table 1 we have summarized the available experimental data including this work for both 2 and 3 dimensional systems we have taken particular care to report only on experiments with bimodally distributed media and where the experimental conditions were described in sufficient detail as to make the experiments interpretable to address the need to capture tailing associated with bimodal media formally averaged two region whitaker 1999 frippiat and holeyman 2008 li et al 2011 golfier et al 2011 and even multi region davit and quintard 2015 transport equations have been developed although transport phenomena in highly heterogeneous media have been extensively investigated numerically studies which combine the predictive capabilities of numerical models with experimental validation at the darcy scale are still somewhat sparse the most extensively characterized experiments conducted to date in bimodal media are those summarized in table 1 with only two exceptions one of which is the work reported here these experiments were effectively 2 dimensional and many of them have log variance of conductivities σy that are near unity the experiments detailed in this paper are unique in that they are conducted in a medium with 3 dimensional heterogeneity and the variance is more representative of what might be observed in the field σ y 5 71 to help characterize transport phenomena in bimodal porous materials where the two regions are denoted as the η and ω region respectively zinn et al 2004 suggested the definition of three péclet numbers as modified by golfier et al 2007 1 p e ω ω v ω ω a a 2 d ω v ω ω a d ω 2 p e η ω v η η a d ω a l 3 p e η η v η η l l 2 d η v η η l d η here vω ω is the magnitude of the intrinsic velocity in the ω region dω denotes the effective diffusivity of the solute of interest section 3 3 a is the radius of the inclusion and l denotes the characteristic distance for gradients of the concentration conventionally this is taken as the system length or when applicable the solute pulse length to help with the interpretation of table 1 we note the following definitions specific to media with heterogeneities segmented into two hydraulic conductivities 4 y φ η ln k η φ ω ln k ω 5 σ y 2 φ η ln k η y 2 φ ω ln k ω y 2 note that here φ η and φ ω represent the fractions of the total volume of the domain fluid plus solid occupied by the high and low conductivity materials respectively in physical terms peωω quantifies the relative dominance of convective and diffusive fluxes in the ω region and peηω compares the magnitude of the convective flux in the η region to the diffusive flux in the ω region the final péclet number peηη compares convection and diffusion in the high permeability matrix and it does not usually exhibit a controlling influence on the net transport unless it were unusually large in fig 1 we have provided an illustration that very roughly divides the possible combinations of peωω and peηω into five different transport schemes these schemes have been discussed in detail by zinn et al 2004 golfier et al 2007 and heidari and li 2014 briefly the schemes indicate 1 the relative importance of the various convective versus diffusive processes and 2 whether the transport time scales involved require for one or two equation models to represent the net transport behavior this is a qualitative plot that can be useful to generally characterize regimes but the interpretation is the most precise when the combination of péclet numbers is not near regime boundaries for reference the combination of péclet numbers for our experiment and those for a number of other experiments from the literature are plotted for comparison because these data have archival value we have also provided the associated sets of parameters for these experiments in table 1 3 experiments because of the relative scarcity of carefully controlled experiments in highly heterogeneous materials particularly in 3 dimensions we performed a set of large scale on the order of 1 m experiments with a high conductivity contrast σ y 2 5 71 as is often the case the structure of the heterogeneity in the experimental system represented a trade off between experimental control and interpretability versus a more realistic representation of field like structure as described in the introduction however the relevance of bimodal materials as reasonable analogues to the field has been well established in the literature and also reflects the most common experimental option for handling highly heterogeneous materials zinn and harvey 2003 in this sense the experimental work described below represents an extension of the work of zinn and harvey 2003 to three dimensions 3 1 flow cell the experimental system illustrated in fig 2 consisted of a flow cell 100 cm long 50 cm tall 20 cm thick constructed of anodized aluminum packed with a dual porosity medium the inlet and outlet end plates of the flow cell were engineered structures nominally 50 cm by 20 cm anodized aluminum with ancillary material to allow the end plates to be bolted to the flow cell machined with groves to help distribute flow and create as uniform a pressure as possible six inlet ports were installed at inlet and outlet plates again with the goal of distributing the flow and pressure as uniformly as possible finally each end plate was machined to accept a 50 cm by 20 cm by 1 8 inch piece of sintered stainless steel to further encourage flow distribution at both the inlet and outlet a manifold of 1 8 inch teflon tubing was constructed to split the flow evenly among the 6 inlet ports the thickness of the plate itself was about 2 5 cm with another 2 5 cm of tubing creating the inlet and outlet manifolds additional details about the construction of the flow cell including the hydraulics of the inlet and outlet regions is available in the thesis by harrington 2010 3 2 porous materials the bimodal porous medium was constructed by embedding low hydraulic conductivity spherical inclusions with radius a 2 5 cm in a high hydraulic conductivity matrix in the material that follows the subscripts η and ω will be used to denote the matrix and inclusion phases respectively the materials for the two regions were composed of mono disperse solid glass spherical particles potters industries inc valley forge pa of two different diameters the high conductivity matrix the η phase was composed of spherical particles with a nominal diameter of 2 4 0 4 mm a 240 spheriglass the inclusions forming the disconnected ω phase were composed of spherical glass particles with a diameter of 0 068 0 023 mm 2530 spheriglass the spherical inclusions were created by sintering the glass particles in graphite molds for 2 5 h at 725 c a total of 203 such inclusions were constructed the sintering process helped to assure that each inclusion would be geometrically similar and dramatically simplified the process of inclusion placement in the background matrix the inclusions were placed spatially using a percolation process on a simple cubic lattice the flow cell was divided up into 800 cubic sub domains of 125 cm3 each or 5 cm on a side forming three dimensional simple cubic lattice no inclusions were placed within 5 cm proximity of inlet and outlet so this left a possible 720 sub domains that could be populated to populate a random number nr 0 nr 1 was generated for each of the sub domains if the random number was less than or equal to the percolation threshold n p 0 333 an inclusion was placed in that sub domain the fractions of the total volume of the domain occupied by the η and ω regions are denoted by φ η and φ ω note that these two quantities are defined as including both the fluid and solid phases of the η and ω regions using the number of spheres placed and their radius it is easy to compute that the realized fraction of inclusions was 13 3 table 2 provides a summary of the physical parameters that characterize the system the hydraulic conductivity of the coarse medium the matrix was measured by packing the flow cell with only the high hydraulic conductivity beads the flow and pressure drop was then measured for several flow rates and the hydraulic conductivity determined by fitting the data to darcy s law the hydraulic conductivity of each of the 203 inclusions was independently measured as follows individual spheres were immobilized by o rings in a column specifically designed for measuring the pressure drop through each sphere a pressure drop was applied and the corresponding flow rate was measured to provide a measure of the relative conductivity of each sphere this was then normalized by using the hydraulic conductivity of the fine medium measured in a column experiment similar to that for the coarse medium there is a certain amount of uncertainty in the hydraulic conductivity of the spherical inclusions because the sintering process almost certainly reduced the hydraulic conductivity of the fine porous medium compared to its non sintered original state although there was variation in the hydraulic conductivity this variation was small and the average value of the hydraulic conductivity for the fine medium was used in models of the system 3 3 tracer experiments two solutions were prepared for use in experiments first the tracer solution consisted of 100 ppm sodium borate to discourage biological growth at ph 9 3 0 3 to which lithium bromide c 0 25 mg l as br and fluorescein c 0 1 5 mg l were added as inert solutes these two tracers were selected with the goal of using two tracers that are largely conservative but would allow us to assure that unexpected effects such as ion repulsion or sorption kasnavia et al 1999 did not occur solution containing these two tracers initially saturated the flow cell a second solution consisting of 100 ppm sodium borate was prepared for column flushing the column was pre saturated with the tracer solution by pumping it through the system until concentrations measured at the inlet and outlet equilibrated to conduct the experiments the tracer free solution was injected into the inlet structures of the tracer saturated system with an average injection rate q 0 of 45 2 ml min harrington 2010 breakthrough concentrations of flourescein were measured at the column outlet using a model 10 au 005 ce flow through fluorometer turner designs sunnyvale ca effluent bromide was measured by collecting effluent volume fractions using a gilson 223 fraction collector manufactured by gilson inc middleton wi concentrations were subsequently determined using ion chromatography dx 120 ion chromatograph dionex sunnyvale ca as is always the case with tracer experiments in complex laboratory media it is important to be clear about the interpretation of measured concentrations for our experimental system we measured what are essentially concentrations that are flux averaged over the exit plane of the flow cell because the péclet number in the coarse medium is very high p e η η 23925 we do not have to be concerned about the distinction between flux averaged and resident concentrations as influenced by the diffusive fluxes cf parker and van genuchten 1984 thus the concentration measured for the breakthrough curves corresponds to the following golfier et al 2007 6 c η 1 q 0 a η effluent n η e v η c η d a in the remainder of the paper c η will be used to indicate either an experimentally measured breakthrough concentration or the appropriately weighted via eq 6 flux averaged concentration derived from mathematical and numerical models 4 hierarchy of models for the bimodal system in this section we describe the application of a hierarchy of models with decreasing complexity that can be used to represent the results of the experimental system this data set provides an excellent opportunity to test the performance of various upscaled information reduced models spanning the range from a fully resolved direct numerical simulation dns of the system to substantially simplified models that may have significant restrictions on their range of validity in particular we examine the following hierarchy of models from the most to the least complex as follows 1 model i a fully resolved and converged dns of the entire domain resolving each inclusion in its appropriate spatial location 2 model ii a simplified numerical model developed by conducting a fully resolved and converged dns but on a domain that is substantially one tenth the size of the actual flow cell domain the idea here is that the flow cell experiment may be much larger than a representative elementary volume rev of the system in the sense described by wood 2009 and wood and valdés parada 2013 the purpose of this simulation is to determine if a smaller volume of the system would still provide an rev from the perspective of the fidelity of breakthrough curves because there is no unique way to select and rev and because the definition of an rev depends in part upon the metric chosen e g wood et al 2015 this analysis provides some relevant details on how sensitive breakthrough curves are to the rev selection 3 model iii the upscaled model of chastanet and wood 2008 this is a mass transfer type model that assumes only that the system is an rev and that the relative volume fractions of the two phases and the associated effective parameters are known this particular model is somewhat more general than the mass transfer models presented by for example haggerty and gorelick 1995 by allowing for potential transience in the effective mass transfer coefficient 4 model iv a simplified version of the upscaled model of chastanet and wood 2008 for this model the conditions of the system are poised such that one can assume a constant mass transfer coefficient for the system yielding a model that is identical to that described by haggerty and gorelick 1995 regardless of which model is selected our analysis ultimately starts with the governing equations for the system at the microscale for this analysis micro scale means the scale for which the porous material may be treated as a pre homogenized continuum because the analysis for the fluorescein data had much higher sensitivity than the bromide data for the remainder of the analysis the focus will be primarily on fluorescein as the species of interest the governing balance equations are given by 7 velocity field η phase v η k η ɛ η p η ρ g 8 velocity field ω phase v ω k ω ɛ ω p ω ρ g 9 velocity b c 1 n η ω v η n η ω v ω at internal boundaries 10 velocity b c 2 v η x 0 v 0 at flow cell inlet 11 tracer transport η phase c η t c η v η d η c η 12 tracer transport ω phase c ω t c ω v ω d ω c ω 13 i c c η t 0 c ω t 0 c 0 f 14 interfacial b c c ω c η at internal boundaries 15 inlet b c c η x 0 0 at flow cell inlet 16 outlet b c c η x x l 0 at flow cell outlet here v p cη and cω are the darcy scale pointwise velocity pressure and the scalar concentrations in each region respectively and g is gravitational acceleration this system of equations is valid in both regions and provides a complete description of the system at all the scales involved in the experiments the corresponding hydraulic conductivity at the darcy scale is specified by k η i k η k ω i k ω for the effective dispersion tensors d η and d ω the following relations hold 17 d η i d η α l η v η η 1 0 0 0 0 0 0 0 0 α t η v η η 0 0 0 0 1 0 0 0 1 18 d ω i d ω α l η v ω η 1 0 0 0 0 0 0 0 0 α t ω v ω ω 0 0 0 0 1 0 0 0 1 note that the materials are assumed to be structurally isotropic so the tensors take particularly simple forms the inlet and outlet plates on the flow cell extended the effective length of the domain although the actual amount of additional dispersion added by these flow structures was not measured we made a modeling choice to represent them as adding an additional 5 cm to the length at both the inlet and the outlet this is consistent with the physical size of the inlet and outlet structures the dispersivity associated with the inlet and outlet plates was assumed to be the same as the coarse medium a full listing of the flow cell dimensions and properties are provided in table 2 4 1 numerical models two different direct numerical simulations of the experimental system were constructed the first employed a full representation of the complete geometry as it was set up in the experiments the hexahedral volume of the flow cell plus each of the 203 inclusions 20 cm 50 cm 100 cm the second numerical model was constructed as a similarly resolved model but with a substantially reduced domain size 10 cm 10 cm 100 cm the finite elements package comsol multiphysics 5 3 was used to numerically solve eqs 7 16 on this geometry an illustration of the geometry is given in fig 2 direct numerical simulations of the system were conducted by meshing volumes the coarse matrix and inclusions using a tetrahedral mesh the matrix and inclusions were separated by a boundary fitted mesh the interfacial boundary condition indicated by eq 14 was applied at this interfacial boundary convergence of the numerical model was determined by conducting a conventional grid convergence analysis in short a sequence of simulations with decreasing mesh size were computed and a global error metric was computed for each increasingly resolved mesh the simulations were considered converged when the error metric was below a pre determined target value details of the convergence analysis are provided in the appendix model i fully resolved direct numerical simulation of the entire flow cell the most resolved model that can be adopted for this particular system on the darcy scale is a fully converged numerical simulation that solves eqs 7 16 over a domain that represents the entire experimental system to within our abilities to measure the system parameters for reference the domain for the complete representation of the geometry of the experimental system is illustrated in fig 3 a the advantage of such a model is that assuming that eqs 7 16 are correct there is no upscaling involved in the representation of the system the primary disadvantage however is that such a model is maximal in terms of the amount of degrees of freedom required to represent the system although this is possible for an experimental system such as this it unlikely to be possible for actual porous materials encountered in the environment or even in engineered applications thus the fully resolved dns is not a parsimonious model and it may provide more information than is technically required as an example the dns model presumably provides an accurate time history of the concentration at each point in the flow cell this kind of information is of interest if the pointwise concentration in the medium were of relevance however in many cases including these experiments the breakthrough curve is the only measured data that is available hence although one may predict good estimates of the concentration for each point in the domain these are of little value if the goal of the model is to predict the breakthrough curve therefore the fully resolved dns model is an accurate model but one that generates ancillary data that is not of direct relevance to the goal of computing an accurate breakthrough curve model ii fully resolved direct numerical simulation of a reduced domain in model i a fully resolved representation of the full experimental system was developed for model ii we examined options for replacing the actual domain by a reduced size realization of the domain the idea for this model was to roughly determine what might constitute a representative volume rev for the simulation of breakthrough curves as a guiding principle we assumed that the volume should at least have the correct spatial statistics which would define an rev with some quantifiable error wood and valdés parada 2013 in practice however uniquely determining an rev is a difficult task and it depends in part upon the processes modeled and the required fidelity of the results our approach was to make a sequence of reasonable assumptions regarding the required size these were based in part on previous experience with such systems thus our process was to 1 make reasonable assumptions and then 2 check to assure that the reduced model was an rev although it may not be the smallest such volume as measured by fidelity with the breakthrough curves for this model we chose a domain with the full domain length length 100 cm but where the width and height of the domain were set to 10 cm each this reduction decreases the volume of domain by a factor of 10 in comparison to the fully resolved domain the width and height of the reduced domain were chosen such that they were at least the size of two times the inclusion diameter this choice was made as a compromise between increasing fidelity for the derived effective parameters and reducing the size of the simulated domain although further size decreases in the transverse directions could be explored increased uncertainty in the value of the effective parameters would result our results indicate that our particular choice for reduction was in fact a reasonable compromise the volumetric ratio of inclusions to the total domain size was kept the same as in the experimental setup and the fully resolved domain v ω v t o t a l 0 133 inclusions were randomly placed throughout the reduced domain with a script generated with matlab vogler 2012 as in the experiment and the fully resolved model no inclusions were placed within 5 cm of the inlet or outlet for reference the domain for the complete representation of the geometry of the experimental system is illustrated in fig 3 b our reduced domain size was selected on the basis of previous experience golfier et al 2007 no effort was made to determine if this was a minimal rev note that for both models i and ii we computed the value of c η at the effluent plane this computed concentration is in principle equivalent to that measured experimentally 4 2 upscaled models we considered two additional reduced models for describing the bimodal system behavior each of these models has been spatially averaged to develop upscaled balance equations spatially averaged models of mass transfer in two region media have previously been developed in several studies chastanet and wood 2008 cherblanc et al 2003 quintard 1993 whitaker 1999 wood et al 2003 we apply the development by chastanet and wood 2008 interested readers are referred to that work for details of the upscaling process chastanet and wood 2008 develop three upscaled models where the functional form of the effective mass transfer terms represent different levels of coupling between micro and macroscales the models in decreasing order of complexity are 1 a fully coupled model with a non local in time mass transfer term 2 a decoupled transient model with linear mass transfer that depends upon a time varying effective mass transfer coefficient and 3 a quasi steady model with a constant asymptotic mass transfer coefficient the uncoupled and the quasi steady models iii and iv below are both investigated in the present study we discuss the fully coupled model for completeness note that in all of these models it is assumed that convection in the inclusions can be neglected relative to diffusion this is not due to a limitation of the averaging method rather this approximation is required for one to develop an explicit series solution for the effective mass transfer coefficient upscaled models that include convection in the inclusions are available ahmadi et al 1998 but they require much more computation to develop solutions ultimately the approach of chastanet and wood 2008 was selected as a modeling choice that appeared to be consistent with the physical system being analyzed while also providing substantial reduction in model complexity the fully coupled model of chastanet and wood 2008 is stated as 19 η phase ɛ η φ η c η η t ɛ η φ η d η η c η η ɛ η φ η v η η c η η w t 20 ω phase ɛ ω φ ω c ω ω t ɛ ω φ ω d ω c ω ω w t where 21 w t ɛ η φ ω d d t 0 t b t τ c η ω τ d τ 22 c η ω c η η c ω ω here the intrinsic averaged macroscale concentrations for the η and ω regions are given by cη η and cω ω respectively the intrinsic averaged macroscale velocity is given by v η η d η η is the effective total dispersion tensor for the η phase d ω is the effective diffusion tensor for the ω phase d ω i d ω and w t is the effective mass transfer function chastanet and wood 2008 the quantity b t is a kernel function depending on the geometry initial conditions and physical parameters describing the system for clarification we note that for the case examined here zero convection in the ω phase we have the condition that d ω d ω i d ω thus we have used the symbol d ω in eq 20 for this model the functional form of the mass transfer source sink term depends on the convolution of a kernel function b which carries information about the physics and geometry of the problem at the darcy scale eq 21 with the macroscale mass transfer driving force eq 22 this general form is technically necessary only for conditions where the time scale for solute transport out of the inclusions is on the order of the one for transport through the coarse material under many reasonable sets of conditions this general model can be somewhat simplified while still maintaining accuracy in the following we describe two of these models these two simplified representations were used to model the breakthrough curve of the effluent concentration from the flow cell note that because of the large péclet number associated with the η phase for this mathematical model under the experimental conditions there is essentially no difference between the concentrations cη η and c η for convenience in presentation we will use the symbol c η when comparing experimental concentrations with those developed from models iii and iv with the understanding that they are equivalent model iii two equation time local model decoupled model the first simplification arises under conditions where the timescales of variations of cηω are large compared to the time scale associated with the kernel b when this is true the averaged concentration term cηω can be carried outside the integral under these conditions the macroscale concentrations are then decoupled from the darcy scale physics represented by the kernel b and the expression in eq 21 simplified to the familiar linear form with a time varying mass transfer coefficient 23 w t ɛ η φ ω b t α t c η ω eq 23 transforms the macroscale balance laws into the more familiar form 24 η phase ɛ η φ η c η η t ɛ η φ η d η η c η η ɛ η φ η v η η c η η α t c η η c ω ω 25 ω phase ɛ ω φ ω c ω ω t ɛ ω φ ω d ω c ω ω α t c η η c ω ω chastanet and wood 2008 provide a closed form expression for α by solving the closure problems associated with eq 24 over a representative elementary volume rev using fourier transforms the time dependent solution is 26 α t 15 d ω ɛ ω φ ω a 2 6 d ω ɛ ω φ ω a 2 n 1 exp q n 2 d ω a 2 t where qn are the non zero positive roots of 27 tan q n 3 q n 3 q n 2 for reference a normalized plot of the transient value of α t appears in fig 4 model iv two equation quasi steady model this model is a simplification of model iii where the time asymptotic solution the leading term in eq 26 is considered for these conditions the mass transfer coefficient is given by the constant 28 α t 15 d ω ɛ ω φ ω a 2 the value of this constant is also plotted in fig 4 solutions for the breakthrough curves were generated using models iii and iv by treating each as a coupled mobile immobile system of 1 dimensional advection dispersion equations the values for model parameters are listed in table 2 the transport properties reported in table 2 were determined a priori and independent of the experimental results the hydraulic conductivity of the low conductivity region was obtained from measurements with the material used to construct the inclusion which was tightly packed k ω 6 67 10 7 m s harrington 2010 vogler 2012 for both models iii and iv the effective dispersion tensor d η η is an upscaled parameter representing the dispersion in the coarse material as it is influenced by the presence of the inclusions we determined the effective dispersion tensor by numerically computing the solution to a closure problem posed for a single simple unit cell following whitaker 1999 chp 3 29 d η η d η i 1 v η a η ω n η ω b η d a v η b η η here the ancillary vector field b η is related to the deviation concentration c η b η c η η additional information about the particular balance equations met by b η are available in whitaker 1999 chp 3 our particular computation had explicitly made the approximation that the ω phase may be treated as being impermeable for the purposes of determining the effective dispersion tensor for the η phase the geometry of the unit cell fig 5 consisted of a sphere centered in a cube with the volume of the sphere reflecting the total volume of the inclusions in the experimental system table 2 φ ω 0 133 subsequently the closure variable b η was calculated using comsol multiphysics the resulting values for the dispersion tensor components the dispersivities and other derived parameters are reported in table 3 a detailed derivation of b η can be found in ahmadi et al 1998 this approach does require that one knows something about the geometry of the low conductivity heterogeneities and that this geometry be considered to be representative however this approach is not limited to spherical or ellipsoidal inclusions essentially any geometry for low conductivity heterogeneities can be accounted for in the closure the primary restriction is that the low conductivity heterogeneities be approximately spatially stationary in distribution i e that some notion of a representative structure can be established 5 results early and late time experimental breakthrough curves for bromide and flourescein are illustrated in fig 6 tracer concentrations are normalized with respect to the initial saturated concentration c 0 f or c 0 b and time is non dimensionalized using the characteristic timescale of diffusion in the inclusions τ d a 2 d ω here early time refers to the period of time where the bulk of the solute is being flushed out of the matrix 0 t 0 04 late time refers to the period where solute is being transported primarily out of the inclusions and the outlet concentration is decreasing asymptotically 0 04 t 0 4 the observed breakthrough curve behavior thereby resembles previous studies on high conductivity contrast domains haggerty and gorelick 1995 zinn et al 2004 where a sharp initial decline in concentration after the flushing of the high conductivity domain is followed by slower concentration decay while the solute leaves the low conductivity inclusions as fig 6 b shows the experiment using flourescein provided more data for late time behavior due to the sensitivity of the method concentrations up to 3 orders of magnitude smaller than the inlet concentration could be measured for bromide measurements the accuracy of the measurement technique allowed measurements only to within 2 orders of magnitude smaller than the inlet concentration fig 6 also illustrates that the two tracers follow very similar trends but show several small deviations from one another at both early and late times however both early and late time deviations of bromide from fluorescein are within a 95 confidence interval for bromide thus they are not statistically significant the late time deviations are most likely additionally influenced by approaching the noise floor for measurements using the hplc the spatial distribution of the simulated tracer concentrations in the system are illustrated in fig 7 this plot is useful to get a sense for the disparity in time scales for transport in the matrix versus the inclusions the magnitude of the intrinsic velocities vω ω and vη η were computed numerically from the dns models table 3 the values for the péclet numbers and other important parameters required to simulate the particular initial boundary and derived conditions in the flow cell are summarized in table 3 the value of peωω is slightly larger than unity indicating that convective transport and diffusive transport were both important in the inclusions although the intrinsic velocity in the inclusions vω ω is two orders of magnitude smaller than the intrinsic velocity in the matrix vη η the ω region is characterized as mobile values reported in table 3 however as mentioned previously on fig 2 this experiment plots near the boundary between the mobile mobile and mobile immobile regimes thus for this case either model is likely to give acceptable results for simulating the breakthrough curve behavior however one might expect a mobile mobile model to be somewhat more accurate although at a higher computational cost superimposed on fig 6 are the results from the fully resolved dns model i the reduced domain dns model ii and the two upscaled models models iii and iv for this particular set of conditions models iii two equation time local and iv two equation quasi steady models produced results that were indistinguishable root mean square rms errors were computed for the difference between each of the four models and the experimental data for fluorescein as follows 30 ϵ r m s i c η m e a s t i c η m o d e l t i 2 1 2 for comparison purposes we consider the ratio of rms errors compared with the maximal information model model i errors for this metric we refer to the rms error associated with model i as ϵ0 rms 6 discussion 6 1 model quality the results show reasonable agreement between the experiment and each of the four models investigated each of the models explored predicted the trend of tracer breakthrough reasonably accurately it should be emphasized here that no numerical or parameter fitting was performed for any of the models all hydraulic parameters were either measured or computed for a unit cell model the fully resolved dns and reduced domain dns produce almost identical breakthrough curves this result also provides some validation that the measured parameters and geometrical representation for the flow cell are reasonably accurate as evidenced by the very small rms error associated with these simulations table 4 an additional interesting feature of this modeling effort is that a purely fickian type constitutive equation was able to reproduce the system behavior accurately this is consistent with other recent work on inclusion type laboratory systems e g heidari and li 2014 of all of the models the fully resolved dns imposes the least reduction of complexity of the modeled problem the model performance of reduced complexity domains models ii iv should therefore be compared to the fully resolved dns as well as the experimental data since the early time behavior of the experimental data is not captured perfectly by any of the presented models the most likely reason for this is experimental uncertainty rather than failure of any of the models this is discussed below the reduced domain dns captured the physics of the full system nearly as accurately as the fully resolved dns the only notable deviations to the fully resolved dns are very small again this is reflected in the very similar rms error values presented in table 4 the increase in the rms error was on the order of 5 using the reduced domain model however the domain size was only 1 10th of the size of the fully resolved dns domain in comparison the results obtained using the upscaled models show slightly larger deviations from the experiments than do the two dns models while the dns correctly represents the time that the tailing begins visible in fig 6 b the volume averaged models predict a shift to the diffusive dominated tailing regime slightly earlier subsequently transport of solute from the inclusions to the matrix leads to higher concentrations at the outlet at the beginning of tailing and a slight under prediction of the solute concentration at the outlet at the end of the experiment note that models iii and iv are essentially indistinguishable for these particular conditions this observation is corroborated by noting that the mass transfer coefficient relaxes i e where the two curves in fig 4 are close enough to be considered indistinguishable to its asymptotic value near about t 10 2 in terms of non normalized variables complete relaxation occurs after about 5 h this is a small fraction of the observed time and thus transience in the value for the mass transfer coefficient was not important for these conditions another factor in the accuracy of models iii and iv is the neglect of convection in the inclusions analytical results such as those reported in haggerty and gorelick 1995 and chastanet and wood 2008 require that convection be neglected so that a simple analytical solution can be derived reference to fig 1 shows that the experiment took place in the mobile mobile region thus convection within the low conductivity inclusions was not entirely negligible however the plot in fig 1 is intended to be primarily qualitative especially near the regime boundaries our data plots near such a boundary thus it is difficult to predict a priori whether or not our experiments are significantly affected by convection for early times each of the four models considered under predicts the initial dispersion in concentration as compared to the experimental results there are a number of possibilities here but the most likely one is that the experimentally realized dispersion near the inlet of the flow cell is higher than it is in the remainder of the medium the most likely explanation is that there was a non uniform distribution of flow into the flow cell although significant effort was taken to make the inlet as uniform as possible inlet boundaries are notoriously difficult to control in porous media experiments because we have no method to measure a posteriori the uniformity of the initial experimental injection we have made no effort to account for this hypothesized early spreading in the models regardless the absolute difference for each of the models with the experimental data in this early part of the breakthrough curve is at most 5 of the total concentration 6 2 model complexity it is clear from the model results that using reduced information models was effective for this experimental system suggesting that the particular type and extent of heterogeneities in the system lends itself to upscaling it is interesting to consider the question of how much information reduction was realized by the various models employed one of the problems with computing information reduction in models is a fundamental one what elements of a system can be considered to contribute to information for a model because in this case all four models are ultimately solved by numerical methods that require discretization of a set of partial differential equations we might consider some of the tools that are used in measuring information content for algorithmic systems for example one can consider computing the algorithmic complexity of a particular discrete algorithm note that in the literature both information and complexity are used to indicate roughly the same concept the algorithmic complexity has a specific meaning in computing theory that can be well defined for particular problems cook 1983 cover and thomas 2012 savage 1976 zvonkin and levin 1970 however it is neither easy to determine the algorithmic complexity for something as complicated as a finite element scheme farmaga et al 2011 nor does such a metric represent the only component of information that is of interest for example the amount of memory required to solve a particular finite element problem is a relevant part of the complexity of a problem in applications farmaga et al 2011 because memory limitations often define how well a particular problem can be resolved however algorithmic complexity does not always directly account for this facet of the problem cook 1983 algorithmic complexity also does not directly account for the amount of time it takes for a particular algorithm to run although it is frequently proportional to it concepts such as levin complexity ming and vitányi 1997 address some of these problems but it is still a tool that is best for more theoretical analyses in many applications it is more reasonable to develop a proxy for information content for iterative numerical methods it has become common to use floating point operations or computational time or some filtered version of these metrics e g karlsson et al 2005 as a measure of complexity for our results because we were using the same code and methods to solve all four models we used a naive metric of computational time cpu time as a measure of information content we did not make any attempts to account for overhead functions such as caching or inter processor communications however a comparison of the data suggests that this metric scales linearly r 2 0 998 with the number of degrees of freedom dof suggesting that overhead functions were not significant for our particular problem our results for processing times are summarized on table 4 note that because models iii and iv are essentially identical for our particular experimental conditions they are not independently distinguished in the table in the remainder of this section the terms complexity and information are used interchangeably these terms are intended to be interpreted by the heuristic definitions discussed in the following rather than in the more formal definitions associated with for example shannon information or kolmogorov complexity that can be defined in the context of information theory information metrics are inherently difficult to compute and it is conventional to examine changes in terms of powers of the base unit first we define the relative time for computation compared to the model with the maximal use of information by 31 f t t m t 0 where t 0 is the time for the maximum information model to run and tm is the time for any particular reduced information model to run for our normalized metric we can define the powers of 10 reduction in cpu time by 32 i c p u l o g t m t 0 this measure then provides the number of powers of 10 reduction in computation time we have computed these values and listed them rounding to the nearest log unit in table 4 because our information reduction is taken as a measure relative to the fully resolved dns the fully resolved dns model offers zero information reduction in other words this model when fully converged represents the maximal use of information that we have regarding the experimental system including the explicit details of its geometry the boundary and initial conditions and independent measures of the associated physical properties table 2 in our efforts employing models of reduced complexity is motivated by reducing the computational costs associated with systems of high variability of hydraulic parameters and complex geometries the results presented in table 4 provide some results about the relative computational costs of each of the four models first we note that the fraction of computing time compared to the maximal information model model i is substantially decreased in our hierarchy of reduced complexity models model ii which reduced the simulation domain by a factor of 10 correspondingly takes about a factor of 10 less time i c p u 1 to compute compared to model i this comes at a cost in that the rms error for model ii is about 5 higher than for model i however the reduction in computational burden may well make this trade off an acceptable one the results for models iii and iv show a substantially greater economy in computational costs the computational time for these models is on the order of 10 000 times less than for model i i c p u 4 although the upscaled models show lower accuracy in respect to the experimental data than the fully resolved and reduced domain dns the rms value for these models is about 14 more than for model i the results are still quite compelling when measured by the absolute rms error which is still quite small as a final comment it is interesting to note that the question of reduction of complexity for models is incomplete without some notion of assigning utility to the various possible models without a notion of utility it is impossible to make choices that weight the relative strengths of the models examined in this case the trade off is between computational size versus solution accuracy this can be done by establishing a utility function that weights the various features of each model to provide an overall sense of its value the review article by tartakovsky 2013 provides an excellent overview on this question for the cases explored here the utility function would represent a trade off between accuracy of the solution and the computational resources needed to obtain the solution such issues become more acute when uncertainty is higher and solutions may consist for example of large suites of monte carlo simulations in order to account for the uncertainty in the data even the understanding of what is meant by accuracy of the solution may have to be further quantified in a utility function for example if one is primarily concerned about mean breakthrough time then the arithmetic concentration as plotted in fig 6 a might be relevant however if one were more concerned about long term behavior of small concentrations this would be the case for some kinds of contaminants in the environment then it may be the tailing of the breakthrough curves illustrated in fig 6 b that might be of more relevance the rms values computed in this work were computed for the arithmetic concentrations and would not be the most useful metrics of error if one wanted to emphasize the late time tailing of the breakthrough curve instead comparisons of the various models might be best done on the log transformed data which would give increased weight to the late time data thus model simplification is one part of a larger analysis that must also consider how to place specific value via a utility function or other method to assign value to outcomes on the results that are obtained 7 conclusion a sequence of models with decreasing complexity was examined for modeling the breakthrough curves of a conservative tracer in a highly heterogeneous bimodal porous medium the experimentally observed late time breakthrough was modeled using a two region time non local mass transfer model developed using the method of volume averaging that was cross validated with direct numerical simulations at the darcy scale dns with the full system geometry and a simplified geometry with identical volumetric fractions of two regions yielded very accurate results as measured by rms error when compared with the experimental data for the entire time period examined experimentally the dns simulations included convective transport in the low conductivity inclusions and this proved to have a small but measurable impact on the accuracy of the results breakthrough curves predicted by the two volume averaged models show only small differences from the two dns results these differences appear to arise almost entirely from the simplification in those models that neglects convection within the inclusions overall the volume averaged models succeed in providing solutions which require 4 orders of magnitude less computational time than the fully resolved dns while only increasing the rms error by a factor of 1 14 for these particular cases the absolute rms error is already quite small for all of the models tested thus a 14 increase in the rms error may not be of any practical significance an interesting facet that the comparison of model complexity does raise is the question of how to decide what model is in some sense best often in studies of this type the stated goal is to develop reduced models that are computationally more efficient considerations of model accuracy are usually relegated to not exceeding some often arbitrary standard of error in some sense this does provide a de facto utility function for which a decision among models may be made however in actual applications one would have to attempt to assign value to the various costs involved for each of the models in order to make a selection in this example the costs are primarily the interplay between computational time and model accuracy however the specific objectives for the application of model predictions would potentially weight these two costs differently and may even require different metrics e g a maximum concentration difference not to be exceeded at a control plane instead of the global rms error for measuring accuracy although these questions are being increasingly recognized in hydrology tartakovsky 2013 the development of concrete tools for assigning value to outcomes is clearly an important area for continued research 8 nomenclature see table 5 acknowledgements and data the experiments discussed in this study were originally conducted by stephanie harrington savannah river remediation llc as part of doctoral work at osu we appreciate the careful work conducted as part of that thesis the authors appreciate the input from three anonymous reviewers bdw rp and so were supported on nsf ear 1521441 the data breakthrough curves geometry open source format numerical meshes and comsol input files associated with this paper is publicly available on the following open source electronic archive https doi org 10 7267 n99s1p7n appendix convergence analysis a convergence analysis of the model was performed to ensure sufficient accuracy of the numerical scheme convergence for both time and space was quantified by computing the area integral of the resident concentration at breakthrough plane breakthrough curves were calculated for time steps ranging from 5 102 seconds to 1 105 seconds and various pre defined and user defined mesh parameters a root mean square rms error was then computed to quantify convergence behavior for the time step and mesh size the rms error was defined by 33 ϵ t 0 t n c 0 c test 2 where n is the number of time steps in the simulation c 0 is the concentration data of the breakthrough curve calculated with the smallest mesh and time step computed and ctest is the concentration data of the breakthrough curve for the mesh and time step in which convergence is being evaluated the size of the rms and the run time required to compute results for the model were the basis for choosing a sufficiently small mesh size and time step the system was assumed to be converged when reducing the mesh size or time step did not significantly lower the rms value variations of the time step had a small influence on the accuracy of the solution fig 8 a and a time step of 1 104 seconds was subsequently chosen convergence was defined by achieving an rms value less than ϵ 0 0025 this value was met for mesh edge lengths in the matrix around 0 02 m fig 8 b a maximum mesh edge length of 0 0212 m was used for the direct numerical simulations presented in the results section 5 supplementary material supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2018 02 009 appendix b supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
846,in this work we examine the dispersion of conservative tracers bromide and fluorescein in an experimentally constructed three dimensional dual porosity porous medium the medium is highly heterogeneous σ y 2 5 7 and consists of spherical low hydraulic conductivity inclusions embedded in a high hydraulic conductivity matrix the bimodal medium was saturated with tracers and then flushed with tracer free fluid while the effluent breakthrough curves were measured the focus for this work is to examine a hierarchy of four models in the absence of adjustable parameters with decreasing complexity to assess their ability to accurately represent the measured breakthrough curves the most information rich model was 1 a direct numerical simulation of the system in which the geometry boundary and initial conditions and medium properties were fully independently characterized experimentally with high fidelity the reduced information models included 2 a simplified numerical model identical to the fully resolved direct numerical simulation dns model but using a domain that was one tenth the size 3 an upscaled mobile immobile model that allowed for a time dependent mass transfer coefficient and 4 an upscaled mobile immobile model that assumed a space time constant mass transfer coefficient the results illustrated that all four models provided accurate representations of the experimental breakthrough curves as measured by global rms error the primary component of error induced in the upscaled models appeared to arise from the neglect of convection within the inclusions we discuss the necessity to assign value via a utility function or other similar method to outcomes if one is to further select from among model options interestingly these results suggested that the conventional convection dispersion equation when applied in a way that resolves the heterogeneities yields models with high fidelity without requiring the imposition of a more complex non fickian model keywords solute transport upscaling laboratory experiments heterogeneous porous media model complexity 1 introduction in natural geological systems highly heterogeneous materials are the rule rather than the exception one approach for representing systems with very high variations of hydraulic conductivity is to represent the field as a set of distinct regions either through hydrofacies mapping anderson et al 1999 through indicator methods knudby and carrera 2005 or a combination of these two approaches bianchi and pedretti 2017 lee et al 2007 a particular simplification of these models is the case of bimodal or dual domain media where only two classes of materials are present e g low conductivity immobile regions embedded in high conductivity mobile regions davit et al 2012 fiori et al 2011 golfier et al 2011 jankovic et al 2003 knudby and carrera 2005 molinari et al 2015 van genuchten and wierenga 1976 such media can serve as an idealization of a highly heterogeneous but continuous porous medium that has been segmented into high and low conductivity components so that the total variance of each segment is reduced the important hydrogeologic role of such representations has been discussed recently by molz 2015 low conductivity frequently referred to by the terminology immobile regions are often conceptualized as being spherical or ellipsoidal in analytical coats et al 1964 fernàndez garcia and sanchez vila 2015 haggerty and gorelick 1995 poley 1988 rabinovich et al 2013 numerical bianchi and pedretti 2017 finkel et al 2016 lee et al 2017 and experimental golfier et al 2011 zinn et al 2004 investigations ellipsoidal or spherical representations of low conductivity inclusions have been used extensively both to represent actual structures observed in the field e g jussel et al 1994 murphy et al 1992 and as a reasonable simplification of low conductivity regions dagan and lessoff 2001 the relevance in this approximation has been discussed in detail in dagan and lessoff 2001 janković et al 2006 who use ellipsoidal inclusions in their representations and in the review by frippiat and holeyman 2008 in a recent review article on the geological representation of heterogeneity eaton 2006 p 195 discusses such idealizations for situations where the heterogeneity is particularly large by noting composite media approaches in which different heterogeneous structures of contrasting hydraulic properties such as inclusions of different shapes have also been used to quantify flow numerically as these methods become more widely understood and implemented in readily available modeling codes their application will allow a geostatistical approach to even the most heterogeneous flow systems a significant advance early investigations of bimodal systems accounted for the influence of immobile regions on transport phenomena by representing the immobile region with a stagnant volume fraction which is coupled to the mobile region with a constant mass transfer coefficient α coats et al 1964 deans 1963 deans and lapidus 1960 rao et al 1980 this idea has been extended to more general multiple region models carrera et al 1998 haggerty and gorelick 1995 and models that include convection and dispersion in both regions ahmadi et al 1998 ginn et al 2017 golfier et al 2007 goltz and roberts 1986 haggerty and gorelick 1995 haggerty et al 2000 van genuchten and wierenga 1976 reviews of much of the literature on this topic have been presented by cherblanc et al 2003 and fernàndez garcia and sanchez vila 2015 for bimodal representation of heterogeneous materials the spatial domain is usually envisioned as being separated into two components 1 a connected high conductivity medium and 2 a disconnected low conductivity medium although in some models the low conductivity medium is assumed to be immobile in more recent models it is assumed that convective fluxes can exist in the disconnected phase because mass transfer occurs between the high and low conductivity regions the resulting model can represent a range of transport behaviors from conventional convection dispersion to transport that appears significantly non fickian the characteristic times associated with transport in each of the two regions can span a large range if the conductivity variance in the medium as a whole is large such differences in transport times can result in asymmetric breakthrough curves and tailing bianchi et al 2011 fiori et al 2011 haggerty et al 2000 li et al 2011 van genuchten and wierenga 1976 zinn and harvey 2003 accurate and economical descriptions of tailing phenomena have been of significant interest in hydrological applications for some time the objectives of this paper are 1 to describe a new set of three dimensional experiments for solute transport in a bimodally distributed system and 2 to assess the ability for a hierarchy of decreasingly complex models to adequately represent the breakthrough curves from these experiments in particular we are interested in the use of simplified models to simultaneously reduce the complexity our measure of the complexity is an algorithmic one described in detail below while maintaining fidelity with the experimental observations we analyze the experimental results using two strictly numerical and two upscaled models chastanet and wood 2008 each of these models can be described briefly as follows 1 a fully detailed i e resolving all heterogeneities fully direct numerical simulation dns of the entire experimental domain 2 a fully detailed but domain reduced representation of the experimental system 3 an upscaled two region model accounting for transience in the mass transfer process and finally 4 an upscaled model that assumes that the mass transfer process is roughly quasi steady so that the mass transfer coefficient is a constant one important feature of this work is that the experimental system has been highly characterized so all models of the system are in the absence of adjustable parameters we examine the ability of each of these models to represent the experimental breakthrough curves and offer some assessment as to how well reduced complexity models perform as compared to models that represent essentially perfect information i e fully resolved dns where the geometrical details are represented explicitly within the bounds of experimental error 2 background and previous work bimodally distributed media have been studied experimentally by a number of researchers in table 1 we have summarized the available experimental data including this work for both 2 and 3 dimensional systems we have taken particular care to report only on experiments with bimodally distributed media and where the experimental conditions were described in sufficient detail as to make the experiments interpretable to address the need to capture tailing associated with bimodal media formally averaged two region whitaker 1999 frippiat and holeyman 2008 li et al 2011 golfier et al 2011 and even multi region davit and quintard 2015 transport equations have been developed although transport phenomena in highly heterogeneous media have been extensively investigated numerically studies which combine the predictive capabilities of numerical models with experimental validation at the darcy scale are still somewhat sparse the most extensively characterized experiments conducted to date in bimodal media are those summarized in table 1 with only two exceptions one of which is the work reported here these experiments were effectively 2 dimensional and many of them have log variance of conductivities σy that are near unity the experiments detailed in this paper are unique in that they are conducted in a medium with 3 dimensional heterogeneity and the variance is more representative of what might be observed in the field σ y 5 71 to help characterize transport phenomena in bimodal porous materials where the two regions are denoted as the η and ω region respectively zinn et al 2004 suggested the definition of three péclet numbers as modified by golfier et al 2007 1 p e ω ω v ω ω a a 2 d ω v ω ω a d ω 2 p e η ω v η η a d ω a l 3 p e η η v η η l l 2 d η v η η l d η here vω ω is the magnitude of the intrinsic velocity in the ω region dω denotes the effective diffusivity of the solute of interest section 3 3 a is the radius of the inclusion and l denotes the characteristic distance for gradients of the concentration conventionally this is taken as the system length or when applicable the solute pulse length to help with the interpretation of table 1 we note the following definitions specific to media with heterogeneities segmented into two hydraulic conductivities 4 y φ η ln k η φ ω ln k ω 5 σ y 2 φ η ln k η y 2 φ ω ln k ω y 2 note that here φ η and φ ω represent the fractions of the total volume of the domain fluid plus solid occupied by the high and low conductivity materials respectively in physical terms peωω quantifies the relative dominance of convective and diffusive fluxes in the ω region and peηω compares the magnitude of the convective flux in the η region to the diffusive flux in the ω region the final péclet number peηη compares convection and diffusion in the high permeability matrix and it does not usually exhibit a controlling influence on the net transport unless it were unusually large in fig 1 we have provided an illustration that very roughly divides the possible combinations of peωω and peηω into five different transport schemes these schemes have been discussed in detail by zinn et al 2004 golfier et al 2007 and heidari and li 2014 briefly the schemes indicate 1 the relative importance of the various convective versus diffusive processes and 2 whether the transport time scales involved require for one or two equation models to represent the net transport behavior this is a qualitative plot that can be useful to generally characterize regimes but the interpretation is the most precise when the combination of péclet numbers is not near regime boundaries for reference the combination of péclet numbers for our experiment and those for a number of other experiments from the literature are plotted for comparison because these data have archival value we have also provided the associated sets of parameters for these experiments in table 1 3 experiments because of the relative scarcity of carefully controlled experiments in highly heterogeneous materials particularly in 3 dimensions we performed a set of large scale on the order of 1 m experiments with a high conductivity contrast σ y 2 5 71 as is often the case the structure of the heterogeneity in the experimental system represented a trade off between experimental control and interpretability versus a more realistic representation of field like structure as described in the introduction however the relevance of bimodal materials as reasonable analogues to the field has been well established in the literature and also reflects the most common experimental option for handling highly heterogeneous materials zinn and harvey 2003 in this sense the experimental work described below represents an extension of the work of zinn and harvey 2003 to three dimensions 3 1 flow cell the experimental system illustrated in fig 2 consisted of a flow cell 100 cm long 50 cm tall 20 cm thick constructed of anodized aluminum packed with a dual porosity medium the inlet and outlet end plates of the flow cell were engineered structures nominally 50 cm by 20 cm anodized aluminum with ancillary material to allow the end plates to be bolted to the flow cell machined with groves to help distribute flow and create as uniform a pressure as possible six inlet ports were installed at inlet and outlet plates again with the goal of distributing the flow and pressure as uniformly as possible finally each end plate was machined to accept a 50 cm by 20 cm by 1 8 inch piece of sintered stainless steel to further encourage flow distribution at both the inlet and outlet a manifold of 1 8 inch teflon tubing was constructed to split the flow evenly among the 6 inlet ports the thickness of the plate itself was about 2 5 cm with another 2 5 cm of tubing creating the inlet and outlet manifolds additional details about the construction of the flow cell including the hydraulics of the inlet and outlet regions is available in the thesis by harrington 2010 3 2 porous materials the bimodal porous medium was constructed by embedding low hydraulic conductivity spherical inclusions with radius a 2 5 cm in a high hydraulic conductivity matrix in the material that follows the subscripts η and ω will be used to denote the matrix and inclusion phases respectively the materials for the two regions were composed of mono disperse solid glass spherical particles potters industries inc valley forge pa of two different diameters the high conductivity matrix the η phase was composed of spherical particles with a nominal diameter of 2 4 0 4 mm a 240 spheriglass the inclusions forming the disconnected ω phase were composed of spherical glass particles with a diameter of 0 068 0 023 mm 2530 spheriglass the spherical inclusions were created by sintering the glass particles in graphite molds for 2 5 h at 725 c a total of 203 such inclusions were constructed the sintering process helped to assure that each inclusion would be geometrically similar and dramatically simplified the process of inclusion placement in the background matrix the inclusions were placed spatially using a percolation process on a simple cubic lattice the flow cell was divided up into 800 cubic sub domains of 125 cm3 each or 5 cm on a side forming three dimensional simple cubic lattice no inclusions were placed within 5 cm proximity of inlet and outlet so this left a possible 720 sub domains that could be populated to populate a random number nr 0 nr 1 was generated for each of the sub domains if the random number was less than or equal to the percolation threshold n p 0 333 an inclusion was placed in that sub domain the fractions of the total volume of the domain occupied by the η and ω regions are denoted by φ η and φ ω note that these two quantities are defined as including both the fluid and solid phases of the η and ω regions using the number of spheres placed and their radius it is easy to compute that the realized fraction of inclusions was 13 3 table 2 provides a summary of the physical parameters that characterize the system the hydraulic conductivity of the coarse medium the matrix was measured by packing the flow cell with only the high hydraulic conductivity beads the flow and pressure drop was then measured for several flow rates and the hydraulic conductivity determined by fitting the data to darcy s law the hydraulic conductivity of each of the 203 inclusions was independently measured as follows individual spheres were immobilized by o rings in a column specifically designed for measuring the pressure drop through each sphere a pressure drop was applied and the corresponding flow rate was measured to provide a measure of the relative conductivity of each sphere this was then normalized by using the hydraulic conductivity of the fine medium measured in a column experiment similar to that for the coarse medium there is a certain amount of uncertainty in the hydraulic conductivity of the spherical inclusions because the sintering process almost certainly reduced the hydraulic conductivity of the fine porous medium compared to its non sintered original state although there was variation in the hydraulic conductivity this variation was small and the average value of the hydraulic conductivity for the fine medium was used in models of the system 3 3 tracer experiments two solutions were prepared for use in experiments first the tracer solution consisted of 100 ppm sodium borate to discourage biological growth at ph 9 3 0 3 to which lithium bromide c 0 25 mg l as br and fluorescein c 0 1 5 mg l were added as inert solutes these two tracers were selected with the goal of using two tracers that are largely conservative but would allow us to assure that unexpected effects such as ion repulsion or sorption kasnavia et al 1999 did not occur solution containing these two tracers initially saturated the flow cell a second solution consisting of 100 ppm sodium borate was prepared for column flushing the column was pre saturated with the tracer solution by pumping it through the system until concentrations measured at the inlet and outlet equilibrated to conduct the experiments the tracer free solution was injected into the inlet structures of the tracer saturated system with an average injection rate q 0 of 45 2 ml min harrington 2010 breakthrough concentrations of flourescein were measured at the column outlet using a model 10 au 005 ce flow through fluorometer turner designs sunnyvale ca effluent bromide was measured by collecting effluent volume fractions using a gilson 223 fraction collector manufactured by gilson inc middleton wi concentrations were subsequently determined using ion chromatography dx 120 ion chromatograph dionex sunnyvale ca as is always the case with tracer experiments in complex laboratory media it is important to be clear about the interpretation of measured concentrations for our experimental system we measured what are essentially concentrations that are flux averaged over the exit plane of the flow cell because the péclet number in the coarse medium is very high p e η η 23925 we do not have to be concerned about the distinction between flux averaged and resident concentrations as influenced by the diffusive fluxes cf parker and van genuchten 1984 thus the concentration measured for the breakthrough curves corresponds to the following golfier et al 2007 6 c η 1 q 0 a η effluent n η e v η c η d a in the remainder of the paper c η will be used to indicate either an experimentally measured breakthrough concentration or the appropriately weighted via eq 6 flux averaged concentration derived from mathematical and numerical models 4 hierarchy of models for the bimodal system in this section we describe the application of a hierarchy of models with decreasing complexity that can be used to represent the results of the experimental system this data set provides an excellent opportunity to test the performance of various upscaled information reduced models spanning the range from a fully resolved direct numerical simulation dns of the system to substantially simplified models that may have significant restrictions on their range of validity in particular we examine the following hierarchy of models from the most to the least complex as follows 1 model i a fully resolved and converged dns of the entire domain resolving each inclusion in its appropriate spatial location 2 model ii a simplified numerical model developed by conducting a fully resolved and converged dns but on a domain that is substantially one tenth the size of the actual flow cell domain the idea here is that the flow cell experiment may be much larger than a representative elementary volume rev of the system in the sense described by wood 2009 and wood and valdés parada 2013 the purpose of this simulation is to determine if a smaller volume of the system would still provide an rev from the perspective of the fidelity of breakthrough curves because there is no unique way to select and rev and because the definition of an rev depends in part upon the metric chosen e g wood et al 2015 this analysis provides some relevant details on how sensitive breakthrough curves are to the rev selection 3 model iii the upscaled model of chastanet and wood 2008 this is a mass transfer type model that assumes only that the system is an rev and that the relative volume fractions of the two phases and the associated effective parameters are known this particular model is somewhat more general than the mass transfer models presented by for example haggerty and gorelick 1995 by allowing for potential transience in the effective mass transfer coefficient 4 model iv a simplified version of the upscaled model of chastanet and wood 2008 for this model the conditions of the system are poised such that one can assume a constant mass transfer coefficient for the system yielding a model that is identical to that described by haggerty and gorelick 1995 regardless of which model is selected our analysis ultimately starts with the governing equations for the system at the microscale for this analysis micro scale means the scale for which the porous material may be treated as a pre homogenized continuum because the analysis for the fluorescein data had much higher sensitivity than the bromide data for the remainder of the analysis the focus will be primarily on fluorescein as the species of interest the governing balance equations are given by 7 velocity field η phase v η k η ɛ η p η ρ g 8 velocity field ω phase v ω k ω ɛ ω p ω ρ g 9 velocity b c 1 n η ω v η n η ω v ω at internal boundaries 10 velocity b c 2 v η x 0 v 0 at flow cell inlet 11 tracer transport η phase c η t c η v η d η c η 12 tracer transport ω phase c ω t c ω v ω d ω c ω 13 i c c η t 0 c ω t 0 c 0 f 14 interfacial b c c ω c η at internal boundaries 15 inlet b c c η x 0 0 at flow cell inlet 16 outlet b c c η x x l 0 at flow cell outlet here v p cη and cω are the darcy scale pointwise velocity pressure and the scalar concentrations in each region respectively and g is gravitational acceleration this system of equations is valid in both regions and provides a complete description of the system at all the scales involved in the experiments the corresponding hydraulic conductivity at the darcy scale is specified by k η i k η k ω i k ω for the effective dispersion tensors d η and d ω the following relations hold 17 d η i d η α l η v η η 1 0 0 0 0 0 0 0 0 α t η v η η 0 0 0 0 1 0 0 0 1 18 d ω i d ω α l η v ω η 1 0 0 0 0 0 0 0 0 α t ω v ω ω 0 0 0 0 1 0 0 0 1 note that the materials are assumed to be structurally isotropic so the tensors take particularly simple forms the inlet and outlet plates on the flow cell extended the effective length of the domain although the actual amount of additional dispersion added by these flow structures was not measured we made a modeling choice to represent them as adding an additional 5 cm to the length at both the inlet and the outlet this is consistent with the physical size of the inlet and outlet structures the dispersivity associated with the inlet and outlet plates was assumed to be the same as the coarse medium a full listing of the flow cell dimensions and properties are provided in table 2 4 1 numerical models two different direct numerical simulations of the experimental system were constructed the first employed a full representation of the complete geometry as it was set up in the experiments the hexahedral volume of the flow cell plus each of the 203 inclusions 20 cm 50 cm 100 cm the second numerical model was constructed as a similarly resolved model but with a substantially reduced domain size 10 cm 10 cm 100 cm the finite elements package comsol multiphysics 5 3 was used to numerically solve eqs 7 16 on this geometry an illustration of the geometry is given in fig 2 direct numerical simulations of the system were conducted by meshing volumes the coarse matrix and inclusions using a tetrahedral mesh the matrix and inclusions were separated by a boundary fitted mesh the interfacial boundary condition indicated by eq 14 was applied at this interfacial boundary convergence of the numerical model was determined by conducting a conventional grid convergence analysis in short a sequence of simulations with decreasing mesh size were computed and a global error metric was computed for each increasingly resolved mesh the simulations were considered converged when the error metric was below a pre determined target value details of the convergence analysis are provided in the appendix model i fully resolved direct numerical simulation of the entire flow cell the most resolved model that can be adopted for this particular system on the darcy scale is a fully converged numerical simulation that solves eqs 7 16 over a domain that represents the entire experimental system to within our abilities to measure the system parameters for reference the domain for the complete representation of the geometry of the experimental system is illustrated in fig 3 a the advantage of such a model is that assuming that eqs 7 16 are correct there is no upscaling involved in the representation of the system the primary disadvantage however is that such a model is maximal in terms of the amount of degrees of freedom required to represent the system although this is possible for an experimental system such as this it unlikely to be possible for actual porous materials encountered in the environment or even in engineered applications thus the fully resolved dns is not a parsimonious model and it may provide more information than is technically required as an example the dns model presumably provides an accurate time history of the concentration at each point in the flow cell this kind of information is of interest if the pointwise concentration in the medium were of relevance however in many cases including these experiments the breakthrough curve is the only measured data that is available hence although one may predict good estimates of the concentration for each point in the domain these are of little value if the goal of the model is to predict the breakthrough curve therefore the fully resolved dns model is an accurate model but one that generates ancillary data that is not of direct relevance to the goal of computing an accurate breakthrough curve model ii fully resolved direct numerical simulation of a reduced domain in model i a fully resolved representation of the full experimental system was developed for model ii we examined options for replacing the actual domain by a reduced size realization of the domain the idea for this model was to roughly determine what might constitute a representative volume rev for the simulation of breakthrough curves as a guiding principle we assumed that the volume should at least have the correct spatial statistics which would define an rev with some quantifiable error wood and valdés parada 2013 in practice however uniquely determining an rev is a difficult task and it depends in part upon the processes modeled and the required fidelity of the results our approach was to make a sequence of reasonable assumptions regarding the required size these were based in part on previous experience with such systems thus our process was to 1 make reasonable assumptions and then 2 check to assure that the reduced model was an rev although it may not be the smallest such volume as measured by fidelity with the breakthrough curves for this model we chose a domain with the full domain length length 100 cm but where the width and height of the domain were set to 10 cm each this reduction decreases the volume of domain by a factor of 10 in comparison to the fully resolved domain the width and height of the reduced domain were chosen such that they were at least the size of two times the inclusion diameter this choice was made as a compromise between increasing fidelity for the derived effective parameters and reducing the size of the simulated domain although further size decreases in the transverse directions could be explored increased uncertainty in the value of the effective parameters would result our results indicate that our particular choice for reduction was in fact a reasonable compromise the volumetric ratio of inclusions to the total domain size was kept the same as in the experimental setup and the fully resolved domain v ω v t o t a l 0 133 inclusions were randomly placed throughout the reduced domain with a script generated with matlab vogler 2012 as in the experiment and the fully resolved model no inclusions were placed within 5 cm of the inlet or outlet for reference the domain for the complete representation of the geometry of the experimental system is illustrated in fig 3 b our reduced domain size was selected on the basis of previous experience golfier et al 2007 no effort was made to determine if this was a minimal rev note that for both models i and ii we computed the value of c η at the effluent plane this computed concentration is in principle equivalent to that measured experimentally 4 2 upscaled models we considered two additional reduced models for describing the bimodal system behavior each of these models has been spatially averaged to develop upscaled balance equations spatially averaged models of mass transfer in two region media have previously been developed in several studies chastanet and wood 2008 cherblanc et al 2003 quintard 1993 whitaker 1999 wood et al 2003 we apply the development by chastanet and wood 2008 interested readers are referred to that work for details of the upscaling process chastanet and wood 2008 develop three upscaled models where the functional form of the effective mass transfer terms represent different levels of coupling between micro and macroscales the models in decreasing order of complexity are 1 a fully coupled model with a non local in time mass transfer term 2 a decoupled transient model with linear mass transfer that depends upon a time varying effective mass transfer coefficient and 3 a quasi steady model with a constant asymptotic mass transfer coefficient the uncoupled and the quasi steady models iii and iv below are both investigated in the present study we discuss the fully coupled model for completeness note that in all of these models it is assumed that convection in the inclusions can be neglected relative to diffusion this is not due to a limitation of the averaging method rather this approximation is required for one to develop an explicit series solution for the effective mass transfer coefficient upscaled models that include convection in the inclusions are available ahmadi et al 1998 but they require much more computation to develop solutions ultimately the approach of chastanet and wood 2008 was selected as a modeling choice that appeared to be consistent with the physical system being analyzed while also providing substantial reduction in model complexity the fully coupled model of chastanet and wood 2008 is stated as 19 η phase ɛ η φ η c η η t ɛ η φ η d η η c η η ɛ η φ η v η η c η η w t 20 ω phase ɛ ω φ ω c ω ω t ɛ ω φ ω d ω c ω ω w t where 21 w t ɛ η φ ω d d t 0 t b t τ c η ω τ d τ 22 c η ω c η η c ω ω here the intrinsic averaged macroscale concentrations for the η and ω regions are given by cη η and cω ω respectively the intrinsic averaged macroscale velocity is given by v η η d η η is the effective total dispersion tensor for the η phase d ω is the effective diffusion tensor for the ω phase d ω i d ω and w t is the effective mass transfer function chastanet and wood 2008 the quantity b t is a kernel function depending on the geometry initial conditions and physical parameters describing the system for clarification we note that for the case examined here zero convection in the ω phase we have the condition that d ω d ω i d ω thus we have used the symbol d ω in eq 20 for this model the functional form of the mass transfer source sink term depends on the convolution of a kernel function b which carries information about the physics and geometry of the problem at the darcy scale eq 21 with the macroscale mass transfer driving force eq 22 this general form is technically necessary only for conditions where the time scale for solute transport out of the inclusions is on the order of the one for transport through the coarse material under many reasonable sets of conditions this general model can be somewhat simplified while still maintaining accuracy in the following we describe two of these models these two simplified representations were used to model the breakthrough curve of the effluent concentration from the flow cell note that because of the large péclet number associated with the η phase for this mathematical model under the experimental conditions there is essentially no difference between the concentrations cη η and c η for convenience in presentation we will use the symbol c η when comparing experimental concentrations with those developed from models iii and iv with the understanding that they are equivalent model iii two equation time local model decoupled model the first simplification arises under conditions where the timescales of variations of cηω are large compared to the time scale associated with the kernel b when this is true the averaged concentration term cηω can be carried outside the integral under these conditions the macroscale concentrations are then decoupled from the darcy scale physics represented by the kernel b and the expression in eq 21 simplified to the familiar linear form with a time varying mass transfer coefficient 23 w t ɛ η φ ω b t α t c η ω eq 23 transforms the macroscale balance laws into the more familiar form 24 η phase ɛ η φ η c η η t ɛ η φ η d η η c η η ɛ η φ η v η η c η η α t c η η c ω ω 25 ω phase ɛ ω φ ω c ω ω t ɛ ω φ ω d ω c ω ω α t c η η c ω ω chastanet and wood 2008 provide a closed form expression for α by solving the closure problems associated with eq 24 over a representative elementary volume rev using fourier transforms the time dependent solution is 26 α t 15 d ω ɛ ω φ ω a 2 6 d ω ɛ ω φ ω a 2 n 1 exp q n 2 d ω a 2 t where qn are the non zero positive roots of 27 tan q n 3 q n 3 q n 2 for reference a normalized plot of the transient value of α t appears in fig 4 model iv two equation quasi steady model this model is a simplification of model iii where the time asymptotic solution the leading term in eq 26 is considered for these conditions the mass transfer coefficient is given by the constant 28 α t 15 d ω ɛ ω φ ω a 2 the value of this constant is also plotted in fig 4 solutions for the breakthrough curves were generated using models iii and iv by treating each as a coupled mobile immobile system of 1 dimensional advection dispersion equations the values for model parameters are listed in table 2 the transport properties reported in table 2 were determined a priori and independent of the experimental results the hydraulic conductivity of the low conductivity region was obtained from measurements with the material used to construct the inclusion which was tightly packed k ω 6 67 10 7 m s harrington 2010 vogler 2012 for both models iii and iv the effective dispersion tensor d η η is an upscaled parameter representing the dispersion in the coarse material as it is influenced by the presence of the inclusions we determined the effective dispersion tensor by numerically computing the solution to a closure problem posed for a single simple unit cell following whitaker 1999 chp 3 29 d η η d η i 1 v η a η ω n η ω b η d a v η b η η here the ancillary vector field b η is related to the deviation concentration c η b η c η η additional information about the particular balance equations met by b η are available in whitaker 1999 chp 3 our particular computation had explicitly made the approximation that the ω phase may be treated as being impermeable for the purposes of determining the effective dispersion tensor for the η phase the geometry of the unit cell fig 5 consisted of a sphere centered in a cube with the volume of the sphere reflecting the total volume of the inclusions in the experimental system table 2 φ ω 0 133 subsequently the closure variable b η was calculated using comsol multiphysics the resulting values for the dispersion tensor components the dispersivities and other derived parameters are reported in table 3 a detailed derivation of b η can be found in ahmadi et al 1998 this approach does require that one knows something about the geometry of the low conductivity heterogeneities and that this geometry be considered to be representative however this approach is not limited to spherical or ellipsoidal inclusions essentially any geometry for low conductivity heterogeneities can be accounted for in the closure the primary restriction is that the low conductivity heterogeneities be approximately spatially stationary in distribution i e that some notion of a representative structure can be established 5 results early and late time experimental breakthrough curves for bromide and flourescein are illustrated in fig 6 tracer concentrations are normalized with respect to the initial saturated concentration c 0 f or c 0 b and time is non dimensionalized using the characteristic timescale of diffusion in the inclusions τ d a 2 d ω here early time refers to the period of time where the bulk of the solute is being flushed out of the matrix 0 t 0 04 late time refers to the period where solute is being transported primarily out of the inclusions and the outlet concentration is decreasing asymptotically 0 04 t 0 4 the observed breakthrough curve behavior thereby resembles previous studies on high conductivity contrast domains haggerty and gorelick 1995 zinn et al 2004 where a sharp initial decline in concentration after the flushing of the high conductivity domain is followed by slower concentration decay while the solute leaves the low conductivity inclusions as fig 6 b shows the experiment using flourescein provided more data for late time behavior due to the sensitivity of the method concentrations up to 3 orders of magnitude smaller than the inlet concentration could be measured for bromide measurements the accuracy of the measurement technique allowed measurements only to within 2 orders of magnitude smaller than the inlet concentration fig 6 also illustrates that the two tracers follow very similar trends but show several small deviations from one another at both early and late times however both early and late time deviations of bromide from fluorescein are within a 95 confidence interval for bromide thus they are not statistically significant the late time deviations are most likely additionally influenced by approaching the noise floor for measurements using the hplc the spatial distribution of the simulated tracer concentrations in the system are illustrated in fig 7 this plot is useful to get a sense for the disparity in time scales for transport in the matrix versus the inclusions the magnitude of the intrinsic velocities vω ω and vη η were computed numerically from the dns models table 3 the values for the péclet numbers and other important parameters required to simulate the particular initial boundary and derived conditions in the flow cell are summarized in table 3 the value of peωω is slightly larger than unity indicating that convective transport and diffusive transport were both important in the inclusions although the intrinsic velocity in the inclusions vω ω is two orders of magnitude smaller than the intrinsic velocity in the matrix vη η the ω region is characterized as mobile values reported in table 3 however as mentioned previously on fig 2 this experiment plots near the boundary between the mobile mobile and mobile immobile regimes thus for this case either model is likely to give acceptable results for simulating the breakthrough curve behavior however one might expect a mobile mobile model to be somewhat more accurate although at a higher computational cost superimposed on fig 6 are the results from the fully resolved dns model i the reduced domain dns model ii and the two upscaled models models iii and iv for this particular set of conditions models iii two equation time local and iv two equation quasi steady models produced results that were indistinguishable root mean square rms errors were computed for the difference between each of the four models and the experimental data for fluorescein as follows 30 ϵ r m s i c η m e a s t i c η m o d e l t i 2 1 2 for comparison purposes we consider the ratio of rms errors compared with the maximal information model model i errors for this metric we refer to the rms error associated with model i as ϵ0 rms 6 discussion 6 1 model quality the results show reasonable agreement between the experiment and each of the four models investigated each of the models explored predicted the trend of tracer breakthrough reasonably accurately it should be emphasized here that no numerical or parameter fitting was performed for any of the models all hydraulic parameters were either measured or computed for a unit cell model the fully resolved dns and reduced domain dns produce almost identical breakthrough curves this result also provides some validation that the measured parameters and geometrical representation for the flow cell are reasonably accurate as evidenced by the very small rms error associated with these simulations table 4 an additional interesting feature of this modeling effort is that a purely fickian type constitutive equation was able to reproduce the system behavior accurately this is consistent with other recent work on inclusion type laboratory systems e g heidari and li 2014 of all of the models the fully resolved dns imposes the least reduction of complexity of the modeled problem the model performance of reduced complexity domains models ii iv should therefore be compared to the fully resolved dns as well as the experimental data since the early time behavior of the experimental data is not captured perfectly by any of the presented models the most likely reason for this is experimental uncertainty rather than failure of any of the models this is discussed below the reduced domain dns captured the physics of the full system nearly as accurately as the fully resolved dns the only notable deviations to the fully resolved dns are very small again this is reflected in the very similar rms error values presented in table 4 the increase in the rms error was on the order of 5 using the reduced domain model however the domain size was only 1 10th of the size of the fully resolved dns domain in comparison the results obtained using the upscaled models show slightly larger deviations from the experiments than do the two dns models while the dns correctly represents the time that the tailing begins visible in fig 6 b the volume averaged models predict a shift to the diffusive dominated tailing regime slightly earlier subsequently transport of solute from the inclusions to the matrix leads to higher concentrations at the outlet at the beginning of tailing and a slight under prediction of the solute concentration at the outlet at the end of the experiment note that models iii and iv are essentially indistinguishable for these particular conditions this observation is corroborated by noting that the mass transfer coefficient relaxes i e where the two curves in fig 4 are close enough to be considered indistinguishable to its asymptotic value near about t 10 2 in terms of non normalized variables complete relaxation occurs after about 5 h this is a small fraction of the observed time and thus transience in the value for the mass transfer coefficient was not important for these conditions another factor in the accuracy of models iii and iv is the neglect of convection in the inclusions analytical results such as those reported in haggerty and gorelick 1995 and chastanet and wood 2008 require that convection be neglected so that a simple analytical solution can be derived reference to fig 1 shows that the experiment took place in the mobile mobile region thus convection within the low conductivity inclusions was not entirely negligible however the plot in fig 1 is intended to be primarily qualitative especially near the regime boundaries our data plots near such a boundary thus it is difficult to predict a priori whether or not our experiments are significantly affected by convection for early times each of the four models considered under predicts the initial dispersion in concentration as compared to the experimental results there are a number of possibilities here but the most likely one is that the experimentally realized dispersion near the inlet of the flow cell is higher than it is in the remainder of the medium the most likely explanation is that there was a non uniform distribution of flow into the flow cell although significant effort was taken to make the inlet as uniform as possible inlet boundaries are notoriously difficult to control in porous media experiments because we have no method to measure a posteriori the uniformity of the initial experimental injection we have made no effort to account for this hypothesized early spreading in the models regardless the absolute difference for each of the models with the experimental data in this early part of the breakthrough curve is at most 5 of the total concentration 6 2 model complexity it is clear from the model results that using reduced information models was effective for this experimental system suggesting that the particular type and extent of heterogeneities in the system lends itself to upscaling it is interesting to consider the question of how much information reduction was realized by the various models employed one of the problems with computing information reduction in models is a fundamental one what elements of a system can be considered to contribute to information for a model because in this case all four models are ultimately solved by numerical methods that require discretization of a set of partial differential equations we might consider some of the tools that are used in measuring information content for algorithmic systems for example one can consider computing the algorithmic complexity of a particular discrete algorithm note that in the literature both information and complexity are used to indicate roughly the same concept the algorithmic complexity has a specific meaning in computing theory that can be well defined for particular problems cook 1983 cover and thomas 2012 savage 1976 zvonkin and levin 1970 however it is neither easy to determine the algorithmic complexity for something as complicated as a finite element scheme farmaga et al 2011 nor does such a metric represent the only component of information that is of interest for example the amount of memory required to solve a particular finite element problem is a relevant part of the complexity of a problem in applications farmaga et al 2011 because memory limitations often define how well a particular problem can be resolved however algorithmic complexity does not always directly account for this facet of the problem cook 1983 algorithmic complexity also does not directly account for the amount of time it takes for a particular algorithm to run although it is frequently proportional to it concepts such as levin complexity ming and vitányi 1997 address some of these problems but it is still a tool that is best for more theoretical analyses in many applications it is more reasonable to develop a proxy for information content for iterative numerical methods it has become common to use floating point operations or computational time or some filtered version of these metrics e g karlsson et al 2005 as a measure of complexity for our results because we were using the same code and methods to solve all four models we used a naive metric of computational time cpu time as a measure of information content we did not make any attempts to account for overhead functions such as caching or inter processor communications however a comparison of the data suggests that this metric scales linearly r 2 0 998 with the number of degrees of freedom dof suggesting that overhead functions were not significant for our particular problem our results for processing times are summarized on table 4 note that because models iii and iv are essentially identical for our particular experimental conditions they are not independently distinguished in the table in the remainder of this section the terms complexity and information are used interchangeably these terms are intended to be interpreted by the heuristic definitions discussed in the following rather than in the more formal definitions associated with for example shannon information or kolmogorov complexity that can be defined in the context of information theory information metrics are inherently difficult to compute and it is conventional to examine changes in terms of powers of the base unit first we define the relative time for computation compared to the model with the maximal use of information by 31 f t t m t 0 where t 0 is the time for the maximum information model to run and tm is the time for any particular reduced information model to run for our normalized metric we can define the powers of 10 reduction in cpu time by 32 i c p u l o g t m t 0 this measure then provides the number of powers of 10 reduction in computation time we have computed these values and listed them rounding to the nearest log unit in table 4 because our information reduction is taken as a measure relative to the fully resolved dns the fully resolved dns model offers zero information reduction in other words this model when fully converged represents the maximal use of information that we have regarding the experimental system including the explicit details of its geometry the boundary and initial conditions and independent measures of the associated physical properties table 2 in our efforts employing models of reduced complexity is motivated by reducing the computational costs associated with systems of high variability of hydraulic parameters and complex geometries the results presented in table 4 provide some results about the relative computational costs of each of the four models first we note that the fraction of computing time compared to the maximal information model model i is substantially decreased in our hierarchy of reduced complexity models model ii which reduced the simulation domain by a factor of 10 correspondingly takes about a factor of 10 less time i c p u 1 to compute compared to model i this comes at a cost in that the rms error for model ii is about 5 higher than for model i however the reduction in computational burden may well make this trade off an acceptable one the results for models iii and iv show a substantially greater economy in computational costs the computational time for these models is on the order of 10 000 times less than for model i i c p u 4 although the upscaled models show lower accuracy in respect to the experimental data than the fully resolved and reduced domain dns the rms value for these models is about 14 more than for model i the results are still quite compelling when measured by the absolute rms error which is still quite small as a final comment it is interesting to note that the question of reduction of complexity for models is incomplete without some notion of assigning utility to the various possible models without a notion of utility it is impossible to make choices that weight the relative strengths of the models examined in this case the trade off is between computational size versus solution accuracy this can be done by establishing a utility function that weights the various features of each model to provide an overall sense of its value the review article by tartakovsky 2013 provides an excellent overview on this question for the cases explored here the utility function would represent a trade off between accuracy of the solution and the computational resources needed to obtain the solution such issues become more acute when uncertainty is higher and solutions may consist for example of large suites of monte carlo simulations in order to account for the uncertainty in the data even the understanding of what is meant by accuracy of the solution may have to be further quantified in a utility function for example if one is primarily concerned about mean breakthrough time then the arithmetic concentration as plotted in fig 6 a might be relevant however if one were more concerned about long term behavior of small concentrations this would be the case for some kinds of contaminants in the environment then it may be the tailing of the breakthrough curves illustrated in fig 6 b that might be of more relevance the rms values computed in this work were computed for the arithmetic concentrations and would not be the most useful metrics of error if one wanted to emphasize the late time tailing of the breakthrough curve instead comparisons of the various models might be best done on the log transformed data which would give increased weight to the late time data thus model simplification is one part of a larger analysis that must also consider how to place specific value via a utility function or other method to assign value to outcomes on the results that are obtained 7 conclusion a sequence of models with decreasing complexity was examined for modeling the breakthrough curves of a conservative tracer in a highly heterogeneous bimodal porous medium the experimentally observed late time breakthrough was modeled using a two region time non local mass transfer model developed using the method of volume averaging that was cross validated with direct numerical simulations at the darcy scale dns with the full system geometry and a simplified geometry with identical volumetric fractions of two regions yielded very accurate results as measured by rms error when compared with the experimental data for the entire time period examined experimentally the dns simulations included convective transport in the low conductivity inclusions and this proved to have a small but measurable impact on the accuracy of the results breakthrough curves predicted by the two volume averaged models show only small differences from the two dns results these differences appear to arise almost entirely from the simplification in those models that neglects convection within the inclusions overall the volume averaged models succeed in providing solutions which require 4 orders of magnitude less computational time than the fully resolved dns while only increasing the rms error by a factor of 1 14 for these particular cases the absolute rms error is already quite small for all of the models tested thus a 14 increase in the rms error may not be of any practical significance an interesting facet that the comparison of model complexity does raise is the question of how to decide what model is in some sense best often in studies of this type the stated goal is to develop reduced models that are computationally more efficient considerations of model accuracy are usually relegated to not exceeding some often arbitrary standard of error in some sense this does provide a de facto utility function for which a decision among models may be made however in actual applications one would have to attempt to assign value to the various costs involved for each of the models in order to make a selection in this example the costs are primarily the interplay between computational time and model accuracy however the specific objectives for the application of model predictions would potentially weight these two costs differently and may even require different metrics e g a maximum concentration difference not to be exceeded at a control plane instead of the global rms error for measuring accuracy although these questions are being increasingly recognized in hydrology tartakovsky 2013 the development of concrete tools for assigning value to outcomes is clearly an important area for continued research 8 nomenclature see table 5 acknowledgements and data the experiments discussed in this study were originally conducted by stephanie harrington savannah river remediation llc as part of doctoral work at osu we appreciate the careful work conducted as part of that thesis the authors appreciate the input from three anonymous reviewers bdw rp and so were supported on nsf ear 1521441 the data breakthrough curves geometry open source format numerical meshes and comsol input files associated with this paper is publicly available on the following open source electronic archive https doi org 10 7267 n99s1p7n appendix convergence analysis a convergence analysis of the model was performed to ensure sufficient accuracy of the numerical scheme convergence for both time and space was quantified by computing the area integral of the resident concentration at breakthrough plane breakthrough curves were calculated for time steps ranging from 5 102 seconds to 1 105 seconds and various pre defined and user defined mesh parameters a root mean square rms error was then computed to quantify convergence behavior for the time step and mesh size the rms error was defined by 33 ϵ t 0 t n c 0 c test 2 where n is the number of time steps in the simulation c 0 is the concentration data of the breakthrough curve calculated with the smallest mesh and time step computed and ctest is the concentration data of the breakthrough curve for the mesh and time step in which convergence is being evaluated the size of the rms and the run time required to compute results for the model were the basis for choosing a sufficiently small mesh size and time step the system was assumed to be converged when reducing the mesh size or time step did not significantly lower the rms value variations of the time step had a small influence on the accuracy of the solution fig 8 a and a time step of 1 104 seconds was subsequently chosen convergence was defined by achieving an rms value less than ϵ 0 0025 this value was met for mesh edge lengths in the matrix around 0 02 m fig 8 b a maximum mesh edge length of 0 0212 m was used for the direct numerical simulations presented in the results section 5 supplementary material supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2018 02 009 appendix b supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
847,sequential monte carlo smc samplers have become increasing popular for estimating the posterior parameter distribution with the non linear dependency structures and multiple modes often present in hydrological models however the explorative capabilities and efficiency of the sampler depends strongly on the efficiency in the move step of smc sampler in this paper we presented a new smc sampler entitled the particle evolution metropolis sequential monte carlo pem smc algorithm which is well suited to handle unknown static parameters of hydrologic model the pem smc sampler is inspired by the works of liang and wong 2001 and operates by incorporating the strengths of the genetic algorithm differential evolution algorithm and metropolis hasting algorithm into the framework of smc we also prove that the sampler admits the target distribution to be a stationary distribution two case studies including a multi dimensional bimodal normal distribution and a conceptual rainfall runoff hydrologic model by only considering parameter uncertainty and simultaneously considering parameter and input uncertainty show that pem smc sampler is generally superior to other popular smc algorithms in handling the high dimensional problems the study also indicated that it may be important to account for model structural uncertainty by using multiplier different hydrological models in the smc framework in future study keywords sequential monte carlo genetic algorithm bayes parameter optimization hydrolic models mcmc 1 introduction over the past few decades considerable progress has been made in the development of hydrologic models which are now widely used for different purposes such as flood forecasting urban planning and water resources management pokhrel et al 2008 clark et al 2015 it is well recognized that parameter estimation model calibration is a necessary step to improve model accuracy and how to obtain appropriate model parameters has long been a subject of debate within the hydrologic community gupta et al 1998 montanari 2005 marshall et al 2004 montanari and koutsoyiannis 2012 mendoza et al 2015 enabled by increasing computer power tremendous advances have been achieved in parameter estimation methods e g duan et al 1992 gupta et al 1998 bates and campbell 2001 vrugt et al 2009 pokhrel et al 2012 vrugt 2016 among them bayesian inference provides an ideal platform for assessing parameter values by simultaneously accounting for both measurement and model structure uncertainties thiemann et al 2001 jeremiah et al 2011 gao and zhang 2012 zhu et al 2014 and is becoming increasingly popular in environment science clark 2005 given the analytically intractable nature of the hydrologic models implementation of bayesian inference is usually aided by markov chain monte carlo mcmc techniques smith and marshall 2008 in practice the major difficulty associated with using mcmc is the need to assess convergence fan et al 2008 although there are several indices to help gauge convergence for complex models one may never be completely sure clark 2005 sequential monte carlo smc samplers also known as particles filters provide an alternative framework of drawing samples from the posterior distribution which does not depend on markov chain property thereby avoiding the difficulty of ensuring chain convergence to the posterior distribution fan et al 2008 jeremiah et al 2011 traditionally smc samplers were developed primarily for estimation of the dynamic states in a system through various reweighting resampling and move strategies arulampalam et al 2002 in hydrologic models many if not all parameters that represent conceptual or effective properties of landscape should be regarded as time invariant static and their meaningful values can only be obtained through the parameter calibration method ajami et al 2007 mendoza et al 2015 now several methods have been proposed to handle unknown static model parameters using the smc samplers including the state augmentation method which simply treats the static parameters as dynamic states and transfer the parameter optimization to state variable filtering problem e g moradkhani et al 2005 2012 salamon and feyen 2009 nagarajan et al 2011 noh et al 2011 vrugt et al 2013 abbaszadeh et al 2018 and the dynamic partial posterior distribution method which sequentially incorporates increasing amounts of observations into the posterior distribution e g chopin 2002 another approach is the so called geometric bridge method del moral et al 2006 fan et al 2008 jeremiah et al 2011 2012 which constructs an inhomogeneous sequence of distributions to move smoothly from a tractable initial distribution to the target distribution through a sequence of intermediary distributions the smc sampler implemented using geometric bridge method has advantages in preserving the static nature of the unknown parameters and inferring the parameter posterior distribution based on the whole observations lee and chia 2002 in spite of these advantages the smc sampler has a serious drawback which is the well known particle impoverishment problem to improve particle diversity and quality the particles usually need to be moved by using the markov chain monte carlo mcmc transition kernel i e random walk metropolis rwm algorithm metropolis et al 1953 and adaptive random walk metropolis arm algorithm chopin 2002 fan et al 2008 jeremiah et al 2011 2012 chopin 2002 pointed out that the efficiency in the move step is critical since it is the most computationally demanding step thus it is significantly important to develop appropriate candidate generating algorithms in improving the efficiency of the smc sampler owen and tribble 2005 inspired by the success of the genetic and evolution algorithm holland 1975 storn and price 1997 in optimization problems we proposed a new candidate generating method in the framework of smc by employing the two genetic styled operators crossover and mutation specifically the new algorithm is implemented by incorporating some attractive features of genetic and evolutionary algorithm to generate candidates as well as the metropolis hasting algorithm into the framework of smc to evolve the particles to the target distribution this philosophy is not completely new in previous studies some authors have tried to combine the genetic or evolutionary algorithms with population mcmc e g liang and wong 2001 ter braak 2006 vrugt et al 2008 also considerable efforts have been paid to introduce the genetic algorithm into the particle filters uosaki et al 2004 park et al 2007 li et al 2013 abbaszadeh et al 2018 however these works mainly focus on estimating the state variables of a dynamic system rather than the unknown model parameters in this study we describe how to embed the genetic and evolutionary algorithm into the framework of smc for estimating the static model parameters and prove that the proposed algorithm in move step is an mcmc transition kernel which admits the intermediary distribution to be stationary in addition there is a growing realization that parameter estimation in hydrological models is significantly affected by uncertainties in the input forcing data kavetski et al 2002 2006 ajami et al 2007 vrugt et al 2008 to get unbiased parameter estimations and detect the genuine model structure inadequacies the forcing uncertainty should be described explicitly with the system through input error models kavetski et al 2002 2006 ajami et al 2007 vrugt et al 2008 in such conditions the number of variables needed to be estimated including hydrological model parameters and latent variables in the input error model increase considerably and often cause dimensionality issues ajami et al 2007 thus it is needed for the smc samplers to be able to handle the high dimensional problems and the applicability of the samplers for analyzing forcing uncertainty should be assessed systematically montanari 2007 to achieve this propose the efficiency and effectiveness of the proposed smc sampler were tested and compared with other smc samplers using different mcmc transitional kernels i e rwm and arw algorithms through two case studies the first one uses a synthetic bimodal normal distribution with dimensions varying from 5 to 50 and the second one uses a conceptual rainfall runoff model by dealing only with model parameter uncertainty and simultaneously with model parameter and input uncertainties the paper is organized as follows section 2 presents a summary of the bayesian inference followed by a detailed description of the smc samplers in section 3 including the principle of the geometric bridge method the procedures of the smc sampler and the candidate generating methods in move step section 4 provides the results of the two case studies and compares the performance of each sampler finally section 5 presents the main conclusions of the study and the scope for future work 2 bayesian inference a hydrological model can be defined as 1 y t f x t θ ɛ t where y t is the observed data at time t 1 2 n f x t θ is the corresponding model output simulation x t is the model input at time t θ rd is a d dimensional vector of unknown model parameters and ε t represents the measurement error consisting the combined errors from modeling uncertainties the bayesian inference treats hydrologic model parameters θ as probabilistic variables and the posterior parameter distributions can be expressed as 2 p θ y 1 n p θ p y 1 n θ p y 1 n p θ p y 1 n θ where y 1 n y t t 1 2 n represents the set of all available observations p θ and p θ y 1 n signify the prior and posterior parameter distribution respectively p y 1 n θ denotes the model likelihood for observed data y 1 n and p y 1 n is the normalization constant so that the posterior parameter distribution integrates to unity in the most simplistic case with scalar valued measurement y t r 1 t 1 2 n and normal homoscedastic uncorrelated error terms the likelihood function can be written as 3 p y 1 n θ 2 π σ 2 n 2 t 1 n exp y t f x t θ 2 2 σ 2 where σ is an estimate of the standard deviation of the measurement error traditionally σ can be included into the analysis explicitly i e assuming σ is uniform over log σ gelman et al 1995 bates and campbell 2001 and treated as one the model parameters which yields a complete posterior distribution of σ however this method artificially increased the parameter dimension of the problem and may result in unreasonable estimations of the parameter values kavetski et al 2006 in this study σ was estimated by using the analytical method braswell et al 2005 zhu et al 2014 which is to find the value of σ that maximizes log p y 1 n θ for a given parameter vector by differentiating log p y 1 n θ with respect to σ we can obtain 4 σ a 1 n t 1 n y t f x t θ 2 we then used σ a to replace σ in eq 3 3 sequential monte carlo sampling the sequential monte carlo smc sampling approach is a generalization of importance sampling that generates a set of samples from p θ y 1 n with associated weights also called particles and calculates estimates based on these weighted samples as the number of samples become very large the monte carlo approximation can equivalently represent the functional description of the posterior distribution arulampalam et al 2002 however since the posterior distribution is hard to sample directly smc tackles this problem by introducing a sequence of intermediary distributions with the final distribution given by the desired posterior fan et al 2008 in this study the intermediary distribution is constructed using the geometric bridge method del moral et al 2006 fan et al 2008 jeremiah et al 2011 2012 5 π s θ p 0 θ 1 β s p θ y 1 n β s where p 0 θ and π s θ denote the initial and the sth distribution in the sequence s 0 1 s respectively and β s is a sequence of scalar powers such that 0 β0 β1 β s 1 which allows a gradual transition of π s θ from the initial sampling distribution π0 θ p 0 θ when β0 0 to the posterior distribution π s θ p θ y 1 n when β s 1 how to specify the distributional sequence β s still remains an open research question fan et al 2008 following jeremiah et al 2011 2012 an exponential β s sequence is used in this study suppose that an initial population of n particles i e parameter vectors θ are generated from the initial distribution π0 θ p 0 θ from which direct sampling is possible each particle is denoted by θ j 0 and allocated a weight w j 0 1 n for j 1 2 n so that θ j 0 w j 0 is a weighted particle at initial stage s 0 the smc sampling approach then uses the weighted particles from π s 1 θ with s 1 2 s to produce particles from distribution π s θ through reweighting resampling and move processes which are described in detail below 3 1 reweighting given n weighted particles θ j s 1 w j s 1 j 1 2 n from π s 1 θ at stage s 1 with s 1 2 s then by setting θ j s θ j s 1 and 6 w j s w j s 1 π s θ j s π s 1 θ j s 1 the resulting particles θ j s w j s are now drawn from the distribution π s θ eq 6 will increase the weight of particles that have higher density under π s θ than under π s 1 θ and decrease the weight of particles that have lower density under π s θ than under π s 1 θ 3 2 resampling a common problem with the smc sampling approach is the degeneracy phenomenon where as s increases all but one particle will have negligible weight arulampalam et al 2002 this implies that a large computational effort is devoted to updating particles whose contribution to posterior estimates and predictions is almost zero the aim of resampling step is to discard bad particles with negligible importance and to replace them with exact copies of more promising samples vrugt et al 2013 a suitable measure of degeneracy of the algorithm is the effective sample size neff defined as jeremiah et al 2011 2012 vrugt et al 2013 7 n e f f 1 i 1 n w j s 2 in practice resampling is performed whenever neff is less than rn where r 0 1 is a pre specified constant typically taken to be 1 2 fan et al 2008 the resulting particle is in fact an i i d sample from the discrete distribution θ j s w j s arulampalam et al 2002 and the weights are reset to w j s 1 n for j 1 2 n fan et al 2008 jeremiah et al 2011 2012 until now a wide variety of resampling methods including systematic stratified residual and multinomial resampling has been developed in the statistical literature following arulampalam et al 2002 the systematic resampling scheme is selected in this study since it is simple to implement and minimizes the monte carlo variance 3 3 move although the resampling step reduces the effects of the degeneracy problem it may lead to a loss of diversity among the particles as the resulting sample will contain many repeated points which is known as sample impoverishment let θ j s w j s j 1 2 n denote particles at current stage s after reweighting and possibly resampling steps to improve particle diversity and quality each sample is moved according to a markov chain monte carlo mcmc transition kernel ks so that θ j s k s θ j s generally the building of a mcmc transition kennel ks proceeds in the following three steps first a candidate particle θ j s is sampled from a proposal density q s θ j s that depends on the present particle θ j s next the candidate particle is either accepted or rejected using the metropolis hasting m h acceptance probability 8 α m i n 1 π s θ j s q s θ j s θ j s π s θ j s q s θ j s θ j s finally with probability α set θ j s θ j s else leave θ j s unchanged efficiency of the move step significantly depends on an appropriate selection of the candidate generating methods owen and tribble 2005 the earliest and most general candidate generating approach is the random walk metropolis rwm algorithm metropolis et al 1953 in this approach the candidate sample θ j s is drawn from a proposal density qs that depends on the current particle θ j s and is assumed to be fixed and symmetric i e q s θ j s θ j s q s θ j s θ j s a natural choice for q s θ j s in practice is the multivariate normal density so that θ j s n d θ j s γ i d here i d denotes the d dimensional identity matrix and γ is the scaling factor for which we have used the value γ 2 38 2 d given by roberts and rosenthal 1998 to fully use the information gained by the particle system itself the adaptive random walk metropolis arm algorithm is proposed and has been widely used in literature chopin 2002 fan et al 2008 jeremiah et al 2011 2012 for the arm algorithm the covariance of the multivariate normal proposal density is continuously adapted toward the target distribution based on particles in previous populations following chopin 2002 the proposal density is defined as q s θ j s n d θ j s σ s 1 where σ s 1 denotes the weighted sample covariance matrix of previous particle populations θ j s 1 w j s 1 j 1 2 n the new candidate generating method presented here is named as particle evolution metropolis pem which uses genetic and evolution operators to generate candidates holland 1975 storn and price 1997 and merges the strength of the m h algorithm to evolve the particle to the target distribution in the context of genetic or evolution algorithm the particle θ j s j 1 2 n at current stage s is called a chromosome or an individual and the set of n particles form a population then the population is continuously updated toward better solutions in the parameter space by selection and modification procedures noticeably the particles have been selected according to their weights in the resampling step of the smc algorithm which is functionally similar in to the roulette wheel selection procedure used in genetic algorithm thus only two genetic styled operators crossover and mutation are employed in this step and they serves to diversify the individuals in the population notably the chromosomes can be coded as either binary or real numbers in applications to practical problems previous studies have demonstrated that the genetic styled operators are more efficient for real coded chromosomes than those coded in binary numbers liang and wong 2001 thus the real coded chromosomes were used in this study in the crossover operator one parental chromosome pair θ i s and θ j s i j is selected from the current population without replacement and mated to produce a new offspring pair θ i s and θ j s according to the random selection procedure as the weights of chromosome were reset to be equal after the resampling step here the simple one point crossover operator is used to generate offspring θ i s and θ j s which is operated as follows first an integer crossover point is drawn uniformly on 1 2 d where d is the dimension of parameter space then θ i s and θ j s are produced by swapping the parameters to the right of the crossover point between parents θ i s and θ j s with a predefined crossover probability pc after crossover the new offspring pair is accepted with probability min 1 rc according to the m h rule 9 r c π s θ i s π s θ j s j s θ i s θ j s θ i s θ j s π s θ i s π s θ j s j s θ i s θ j s θ i s θ j s where js denotes the transfer probability between the parental θ i s θ j s and the offspring θ i s θ j s pairs and j s θ i s θ j s θ i s θ j s p θ i s θ j s θ p θ i s θ j s θ i s θ j s here p θ i s θ j s θ denotes the selection probability of one pair from the parental population θ and p θ i s θ j s θ i s θ j s is the generating probability of offspring pair θ i s θ j s from the parental chair θ i s θ j s it can be proved that the transfer probability from the parental pair θ i s θ j s to the offspring pair θ i s θ j s is equal to the reverse transfer i e j s θ i s θ j s θ i s θ j s j s θ i s θ j s θ i s θ j s see theorem in supplement 1 if the proposal is accepted the current parental pair θ i s θ j s in the population is replaced by θ i s θ j s otherwise the population remains unchanged noticeably if mating does not take place in the crossover procedure the parents always survive to the next stage according to the m h rule after the crossover operators which repeat n 2 times the population is updated and denoted by θ θ j s j 1 2 n to increase the diversity of the parameter population the differential mutation procedure is used to modify the real coded chromosomes of offspring storn and price 1997 that is the current particle θ j s j 1 2 n is mutated according to 10 θ j s θ j s γ θ r 1 s θ r 2 s ζ d where r 1 and r 2 are integer values drawn without replacement from 1 j 1 j 1 n γ 2 38 2 d denotes the jump rate and ζd nd 0 b is drawn from a normal density with small standard deviation say b 10 6 according to the m h rule the new chromosome θ j s is accepted with probability min 1 rm where rm is calculated as 11 r m π s θ j s j s θ j s θ j s π s θ j s j s θ j s θ j s and js denotes the transition probability between θ j s and θ j s ter braak 2006 has proved that the transfer probability from θ j s to θ j s is the same as that from θ j s to θ j s i e j s θ j s θ j s j s θ j s θ j s if the proposal is accepted the current parental chromosome θ j s in the population is replaced by θ j s otherwise the population remains unchanged these operators selection and mutation are repeated n times and the population is updated again we proved that the pem algorithm maintains the detailed balance and admits π s as the unique stationary distribution at each stage s see theorem in supplement 1 there are only three basic control variables in pem smc sampler n the number of particles in population s the number of evolutions and p c the crossover probability which is set to be 0 6 in this study in addition it is inherently parallel and hence lends itself to computation via a parallel machine or a network of computers the pseudo code of the algorithm is given below step 1 initialization a draw an initial population θ j 0 j 1 2 n from p 0 θ and set weights w j 0 1 n b identify the sequence 0 β0 β1 β s 1 c set iteration index s 1 and effective sample size constant r 0 1 for s 1 2 s do stage evolution step 2 reweighting a set θ j s θ j s 1 j 1 n and calculate the weight w j s w j s 1 π s θ j s π s 1 θ j s 1 b normalize the weight so that j 1 n w j s 1 step 3 resampling a calculate the effective sample size n e f f 1 i 1 n w j s 2 b if neff rn go to the next step otherwise return to step 2 step 3a systematic resampling a resample from θ j s w j s j 1 2 n using the systematic resampling procedure b set w j s 1 n j 1 2 n step 3b move using the pem algorithm to increase the diversity of particles for i 1 2 n 2 do crossover operator using one pair chromosome a randomly select one parental chromosome pair θ i s and θ j s i j and create a new offspring pair θ i s and θ j s using the one point crossover operator b with probability m i n 1 π s θ i s π s θ j s j s θ i s θ j s θ i s θ j s π s θ i s π s θ j s j s θ i s θ j s θ i s θ j s set θ i s θ i s and θ j s θ j s else leave θ i s and θ j s unchanged end for crossover operator using one pair chromosome for i 1 2 n do mutation operator using one chromosome a uniformly select one chromosome θ j s j 1 2 n from the present population and create a new chromosome θ j s by the mutation operator b with probability m i n 1 π s θ j s j s θ j s θ j s π s θ j s j s θ j s θ j s set θ j s θ j s else leave θ j s unchanged end for mutation operator using one chromosome end for stage evolution 4 case studies in this section we conducted two case studies to compare the performance of the smc sampler with different candidate generating algorithms in exploring the parameter space for convenience the smc sampler utilizing the rwm arm and pem algorithms to generate candidates is named as rwm smc arm smc and pem smc respectively in the first case study a synthetic example is constructed on the basis of a mixture of multivariate normal distribution with a well separated bimodal response surface the second example considers application of the algorithms to parameter inference in the hydrologic setting featuring a lumped conceptual rainfall runoff watershed model with data from the bass river watershed australia 4 1 case study 1 synthetic bimodal normal mixture to emulate the common feature of the parameter surface with multiple modes in hydrological modeling the first case study involves a synthetic multi dimensional bimodal normal distribution smith and marshall 2008 vrugt et al 2009 12 π θ 1 3 n d θ 5 i d 2 3 n d θ 5 i d where 5 and 5 are d dimensional vectors to explore the efficiency and effectiveness of the smc samplers in simulating the target distribution in different dimensions the test study was performed in dimensions d 5 10 20 and 30 the feasible parameter space was taken to be a uniform distribution between 10 and 10 for each parameter in the 5 dimensional case fig 1 compares histograms of the marginal posterior distribution of parameter derived from the smc samplers with the actual target distribution obviously both modes of the target distribution are well identified by the three smc samplers with particle number n 300 in addition the statistical characteristics of the average euclidean distance of the true means and standard deviations of the prior defined probability distribution from the respective values estimated with the smc samplers are summarized in table 1 the results indicated that the smc samplers can give a reasonable estimation of the true values of the prior defined probability distribution to check the convergence status of the smc algorithms the transitions of parameters of the selected particles during the sampling paths are illustrated in fig 2 note graphical examination about the convergences of the algorithms for other particles yields a similar picture as that presented in fig 2 it demonstrates that in the initial stages s 450 the parameter values of the particles are uniformly distributed in the parameter space at a later stage s 450 they all tend to converge to a limiting distribution that appear relative tight and encompass the actual target parameter values 5 and 5 represented by and at the right hand side respectively however the mixing of the particles generated by the rwm smc algorithm is quite poor it is generally difficult for the particles to jump from one mode to the other and the individual particle tends to collapse into a single region of highest attraction fig 2a on the contrary the other two smc samplers i e arm smc and pem smc exhibit relatively good explorative and mixing capabilities partially due to their abilities in exchanging information about the search space gained by different launched particles fig 2b and c the performances of the smc samplers in dimension d 10 are similar to that in d 5 to obtain proper estimations of posterior parameter distribution the particle number should be larger than 800 for the 20 dimensional case the histograms of the marginal posterior distribution of dimensions 1 5 10 15 20 generated using the smc samplers with particle number n 1500 are presented in fig 3 as well as providing the actual target distribution black line it is clear that the arm smc sampler falsely converged to local optimum and only one mode was identified by it also the average euclidean distance of the pem smc estimated mean values and standard deviations from the true values is closer to zero than that of the other smc samples suggesting that the pem smc sampler outperforms other smc samplers in estimating the 20 dimensional bimodal target distribution more significantly the transitions of parameters during the sampling paths revealed that the particles generated by the rwm smc and arm smc samplers tend to collapse into local optimums and the mixing of the particles are quite poor fig 4 a and b on the contrary the pem smc algorithm exhibits relatively good mixing capabilities and thus maintaining the diversity of the particles fig 4c we further tested the performances of the smc samplers in dimension d 30 with particle number n 1500 the results indicated that it is difficult for the rwm smc and arm smc samplers to properly estimate the 30 dimensional bimodal target distribution in contrast the pem smc sampler illustrated relative good performances in both properly identifying two modes of the target distribution and maintaining the mixing properties of particles see details in supplement 2 thus the pem smc sampler seems to be more efficient in exploring the high dimensional and complex parameter space than other smc samplers i e rwm smc and arm smc this does benefit from the ability of the genetic algorithm to learn efficiently from the historical evolutionary processes which plays an important role in the early stage of the evolution that is the good particles with a high probability value tend to be stored in the population for a relative long time while the bad particles with a low probability value will be easily eliminated from the population thus the crossover operator in subsequent evolutionary processes ensures us to construct better proposal distributions based on the guidance of good particles stored in the population in addition the mutation operator provides a local updating step to help the particles escape from local optimum and therefore increase the mixing of the particles the improved efficiency and effectiveness of the pem smc algorithm give us confidence in its proper assessment of parameter uncertainty in hydrologic modeling 4 2 case study 2 conceptual hydrologic modeling the second case study considers the australian water balance model awbm which was developed by boughton 1993 to calculate daily runoff from daily rainfall data and daily evapotranspiration estimates fig 5 the awbm has 8 parameters that need to be properly calibrated among them six parameters represent the variability of soil moisture capacity over a watershed which include three surface storage capacities c 1 c 2 c 3 and the fractional areas associated with these capacities a 1 a 2 a 3 the other two parameters are the baseflow index bfi and the daily recession constant k which is used to determine the proportion of baseflow recharge from surface runoff and discharge from the baseflow respectively thus the parameter vector associated with the awbm model can be written as θ c 1 c 2 c 3 a 1 a 2 a 3 bfi k 4 2 1 parameter uncertainty estimation in this section we focus to investigate the performances of the smc samplers in identifying and estimating model parameters without explicit assessment of forcing data error here we considered two different runoff time series in this analysis the first study serves as a benchmark experiment of the smc samplers and uses a fourteen years 1 january 1983 31 december 1996 record of simulated dataset the simulated runoff dataset was generated from the awbm model using measured forcing data from the bass river watershed in the south gippsland basin 52 km2 and parameter values given by marshall et al 2004 table a1 in supplement 3 the artificial runoff data are then corrupted with heteroscedastic measurement error the standard deviation of which was taken to vary from 5 to 50 of the actual simulated values the second study explores the performance of the smc samplers using the actual measured runoff dataset see details in bates and campbell 2001 marshall et al 2004 jeremiah et al 2011 in all numerical experiments the smc samplers were performed with particle number n 400 and iteration s 1000 where the initial parameter values were randomly sampled from the noninformative prior distribution moradkhani et al 2005 salamon and feyen 2009 for the artificial runoff dataset two main conclusions can be drawn from the analysis first the mixing capacity of the rwm smc sampler is quite poor fig 6 and it turned out not to be competitive when applying in the hydrologic setting second the arm smc and pem smc samplers are robust to noise in measurements the estimates of the model parameters derived with the arm smc and pem smc are very close to the actual values when the standard deviation of measurement error varies from 5 to 30 of the actual simulated values fig 7 previous studies have illustrated that the overall uncertainty in runoff measurements mainly range from 5 to 20 pelletier 1987 thus the effect of measurement uncertainty plays a marginal role in identifying real world hydrological model parameters for the arm smc and pem smc samplers these highlight that arm smc and pem smc samplers are more suitable than the rwm smc sampler in making inferences about the posterior parameter distribution of the hydrological models in the following study we thus mainly focus on investigating the performances of the arm smc and pem smc samplers in real world hydrological setting for the historical runoff observations we used 5 years 1 january 1987 31 december 1991 data for model calibration and 5 years 1 january 1992 31 december 1996 data for model validation to reduce sensitivity to state value initialization the first 4 year data 1 january 1983 31 december 1986 was used as the warm up period prior to the calibration data time series during which no updating of the posterior density was performed the posterior marginal parameter distributions derived by each smc sampler are shown as histograms in fig 8 and summarized in table 2 by posterior medians and 95 probability intervals the posterior distributions of the individual parameters obtained by the two samplers are very similar and occupy only a relatively small region interior to the uniform prior distributions table 2 and fig 8 suggesting the two smc samplers were in most cases successful in reducing the assumed prior uncertainties of the parameters values to understand the influence of parameters uncertainty to the simulation result of awbm predictive uncertainty fig 9 shows the 95 hydrograph prediction uncertainty intervals associated with the posterior parameters ranges for the selected calibration and evaluation periods we can observe that the ensemble runoff predictions using the posterior parameters derived by the two smc samplers are very similar and they all reasonably track the historical runoff dynamics dark solid circlers however only a small portion of observed runoff data can be bracketed by the 95 hydrograph prediction uncertainty table 3 and fig 9 the findings are consistent with previous studies i e ajami et al 2007 vrugt et al 2008 and reveal a considerable amount of uncertainty in both the model structure and the forcing data 4 2 2 simultaneously considering parameter and input uncertainty estimation in this section we investigate the applicability of the smc samplers in simultaneous estimation of the awbm model parameters and input uncertainty within the system in this study the rain fall forcing data error was implemented by using a single rainfall multiplier for each storm event kavetski et al 2002 2006 ajami et al 2007 vrugt et al 2008 that is each storm is assigned a different rainfall multiplier β j j 1 2 ς which uniformly distributed over the range between 0 25 and 2 50 and these values are added to the vector of model parameters θ to be optimized hence θ θ β in the 5 years calibration period 1 january 1987 31 december 1991 a total of ς 66 storm events were identified for the bass river watershed which resulted in the number of estimated parameters increasing up to 73 to verify whether the smc samplers are computationally feasible synthetically generated runoff data are used first followed by the actual measured runoff dataset to generate the synthetic runoff dataset a multiplier vector was first drawn using latin hypercube sampling within 0 25 2 50 ς ς 66 then it was combined with the observed rainfall depths over the basin to generate a new rainfall hyetograph the rainfall record was subsequently used with randomly sampled values of the awbm parameters table a2 in supplement 3 to create a 5 year time series of synthetic runoff data in both the synthetic and the actual studies the smc samplers were performed with particle number n 600 and iteration s 2000 for the synthetic runoff dataset it is observed that the particles generated by the smc samplers tend to converge to the limiting distribution after 1200 iterations fig 10 however the arm smc sampler provides some differing parameter estimates from their actual values in particular for parameters c 1 c 2 and a 2 while the different actual values of the awbm model parameters are well defined by the pem smc sampler and display very little uncertainty fig 11 more significantly it is difficult for the arm smc sampler to properly converge to the actual values of the rainfall multipliers only 11 out of 66 are well identified on the contrary the majority of the rainfall multiplier values 41 out of 66 are well identified by the pem smc sampler with its failures due to the low values in either rainfall depths or runoff observations fig 12 thus the pem smc sampler is more robust than the arm smc sampler for the case in simultaneously estimating both the awbm model parameters and the rainfall multipliers more details about the performances of the smc samplers were presented in supplement 3 for the historical runoff observations the calibration procedure is similar to that used in section 4 2 1 the posterior marginal parameter distributions derived by the smc samplers are given in fig 13 and table 2 the sampled rainfall multipliers for each storm are presented as box plots in fig 14 as well as providing histograms of all combined rainfall multipliers comparing with the results in section 4 2 1 we can observe that 1 the explicit consideration of the input error changes the final estimated marginal distribution of the model parameters which is most evident for the parameters c 3 k and bfi table 2 2 the 95 prediction uncertainty interval of the parameters obtained by the smc samplers decreases when rainfall estimates are directly inferred from the observed discharge data table 2 3 the posterior distribution of the model parameters and the rainfall multipliers derived by the pem smc sampler are very narrow and close to normal in comparison with that obtained by the arm smc sampler fig 13 fig 14a and c indicating that the runoff observations contain sufficient information for the pem smc sampler to simultaneously constrain both model parameters and rainfall multipliers and 4 the median posterior values of the combined rainfall multipliers obtained by the two smc samplers are very similar and larger than 1 fig 14b and d indicating the observed rainfall depths are lower than our inferred rainfall from the runoff data on average the 95 runoff predictive uncertainty ranges associated with model parameter and input uncertainty for selected calibration and evaluation periods are presented in fig 15 here the rainfall multiplier for each individual rainfall storm during the evaluation period was sampled from the histograms presented in fig 14b and d and was then combined with the observed rainfall record to generate a possible realization of rainfall hyetograph looking at fig 15 and comparing with fig 9 we can observed that the 95 prediction intervals are slightly narrow here and show a much better coverage of the low runoff observations i e days 1 81 for calibration period and days 1 50 for the validation period the summary statistics presented in table 3 showed that the observed runoff data that fall in the 95 prediction intervals has increased by about 50 for the two smc samplers when we account for input uncertainty also a better model performance is obtained when rainfall multipliers are simultaneously inferred with the model parameters i e a 5 30 reduction in rmse is observed for the two smc samplers noticeably the model performances with parameters and input uncertainty determined by the awr smc sampler and the pem smc sampler are very similar this phenomenon is well known as equifinality in hydrology mainly due to the inadequacies in model structure beven and freer 2001 bastola et al 2011 thus further analysis about model structural error is needed in future studies this is beyond the scope of current paper and we will consider using multiple different hydrological models to reduce the uncertainty caused by the model structure in future studies 5 conclusions this paper has presented a sequential monte carlo sampler which is entitled the particle evolution metropolis sequential monte carlo pem smc algorithm the sampler incorporates some attractive features of genetic algorithm differential evolution algorithm and metropolis hasting algorithm into the framework of sequential monte carlo to evolve a population of particles to approximate the posterior parameter distributions we proved that the sampler admits the target distribution at each iteration π s θ s 1 2 s to be a stationary distribution the performance of the pem smc in estimating the posterior parameter distribution was compared with the other two smc samplers i e rwm smc and arm smc samplers through two case studies of increasing complexity the first case study a synthetic bimodal normal distribution showed that the pem smc sampler has the ability to infer the known target distribution where the parameter surface is extremely complex with many local optima for the arm smc sampler the candidates are drawn from the gaussian proposal distribution with a fixed spatial orientation thus the arm smc sampler is more likely to falsely converge to a local optimum and only one mode can be identified in dimension d 20 fig 3b this indicated that the arm smc sampler can potentially experience difficulties in exploring the non gaussian parameter space with multiple modes in addition the difficulty in ensuring the weighted sample covariance matrix to be symmetric and positively semi defined make the arm smc sampler thoroughly fails for high dimensional problems d 30 for the rwm smc the candidates are generated from an isotropic random walk which can effectively reduce the risk of false convergence to local optima however the rwm smc algorithm shows relative poor mixing property and it is generally difficult for the individual particles to traverse the parameter space figs 1 and 3 this leads the explorative capability of the rwm smc sampler through the feasible parameter space is lower than that of the arm smc and pem smc samplers a second case study illustrated the utility of the pem smc sampler when applied to conceptual rainfall runoff modeling by only considering model parameter uncertainty and simultaneously considering both model parameter and input data uncertainties the synthetic test reveals that the improved efficiency and effectiveness of the pem smc sampler can successfully reduce the prior uncertainties in parameter and input by using information contained in observed runoff data jeremiah et al 2011 on the contrary the rwm smc sampler turned out to not competitive when applying in the hydrologic setting due to its low capacity in exploring parameter space this is consistent with the results of the synthetic bimodal normal distribution the arm smc sampler experienced difficulties in simultaneously estimating both the model parameters and the input uncertainties the majority of the actual values of the rainfall multipliers fall out the 95 probability intervals obtained by the arm smc sampler fig 12 for historical runoff observations the estimated marginal distribution of the model parameters by accounting input errors was different from that estimated by only considering parameter uncertainty table 2 in addition the observed runoff data that fall in the 95 prediction intervals has increased by about 50 for the two smc samplers when we account for input errors table 3 these results are consistent with previous studies ajmni et al 2007 vrugt et al 2008 however the model performances with different parameter and rainfall multiplier values determined by the arw smc and pem smc samplers are very similar this indicates that some physical processes of the watershed may be not adequately represented by the awbm model and further analysis is needed to address the model structure uncertainty by using the bayesian model averaging approach ajmni et al 2007 qi et al 2018 the integration of copulas and bayesian model averaging approach madadgar moradkhani 2013 madadgar et al 2014 sequential bayesian methods hsu et al 2009 wei et al 2012 and data assimilation methods bell et al 2004 kuppel et al 2013 cardinali et al 2014 abbaszadeh et al 2018 essentially bayesian model averaging approach is a post processing of the individual model predictions in a selected ensemble by using the expectation maximization em algorithm raftery et al 1997 thus the proposed smc sampler can be easily extended to the studies of total uncertainty assessment including model parameters input and structural uncertainty and we will present related results in the coming papers finally the computational execution time required by the pem smc sampler is about two times of that needed by the rwm smc and arm smc samplers because of the inclusion of some extra operators in move step of the pem smc sampler however a further significant speedup can be obtained if the pem smc is executed on a parallel machine or a network of computers due to its inherently parallel this is especially true for real world hydrological problems where obtaining the proper parameter posterior distributions often requires a significant amount of time i e about 20 hours for simultaneously estimating both parameter and input uncertainties of the awbm model for the pem smc sampler acknowledgments the authors would thank prof g c sander editor and prof b rajagopalan associate editor for their continued help during the revisions of the paper we also thank the anonymous reviews for their critical reviews and helpful comments this research was supported by national key r d program of china 2016yfc0500203 the national natural science foundation of china nos 31370467 and 41571016 and cas interdisciplinary innovation team the data and code written in matlab can be obtained from the first author zhugf lzu edu cn upon request supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2018 02 007 appendix supplementary materials image application 1 image application 2 
847,sequential monte carlo smc samplers have become increasing popular for estimating the posterior parameter distribution with the non linear dependency structures and multiple modes often present in hydrological models however the explorative capabilities and efficiency of the sampler depends strongly on the efficiency in the move step of smc sampler in this paper we presented a new smc sampler entitled the particle evolution metropolis sequential monte carlo pem smc algorithm which is well suited to handle unknown static parameters of hydrologic model the pem smc sampler is inspired by the works of liang and wong 2001 and operates by incorporating the strengths of the genetic algorithm differential evolution algorithm and metropolis hasting algorithm into the framework of smc we also prove that the sampler admits the target distribution to be a stationary distribution two case studies including a multi dimensional bimodal normal distribution and a conceptual rainfall runoff hydrologic model by only considering parameter uncertainty and simultaneously considering parameter and input uncertainty show that pem smc sampler is generally superior to other popular smc algorithms in handling the high dimensional problems the study also indicated that it may be important to account for model structural uncertainty by using multiplier different hydrological models in the smc framework in future study keywords sequential monte carlo genetic algorithm bayes parameter optimization hydrolic models mcmc 1 introduction over the past few decades considerable progress has been made in the development of hydrologic models which are now widely used for different purposes such as flood forecasting urban planning and water resources management pokhrel et al 2008 clark et al 2015 it is well recognized that parameter estimation model calibration is a necessary step to improve model accuracy and how to obtain appropriate model parameters has long been a subject of debate within the hydrologic community gupta et al 1998 montanari 2005 marshall et al 2004 montanari and koutsoyiannis 2012 mendoza et al 2015 enabled by increasing computer power tremendous advances have been achieved in parameter estimation methods e g duan et al 1992 gupta et al 1998 bates and campbell 2001 vrugt et al 2009 pokhrel et al 2012 vrugt 2016 among them bayesian inference provides an ideal platform for assessing parameter values by simultaneously accounting for both measurement and model structure uncertainties thiemann et al 2001 jeremiah et al 2011 gao and zhang 2012 zhu et al 2014 and is becoming increasingly popular in environment science clark 2005 given the analytically intractable nature of the hydrologic models implementation of bayesian inference is usually aided by markov chain monte carlo mcmc techniques smith and marshall 2008 in practice the major difficulty associated with using mcmc is the need to assess convergence fan et al 2008 although there are several indices to help gauge convergence for complex models one may never be completely sure clark 2005 sequential monte carlo smc samplers also known as particles filters provide an alternative framework of drawing samples from the posterior distribution which does not depend on markov chain property thereby avoiding the difficulty of ensuring chain convergence to the posterior distribution fan et al 2008 jeremiah et al 2011 traditionally smc samplers were developed primarily for estimation of the dynamic states in a system through various reweighting resampling and move strategies arulampalam et al 2002 in hydrologic models many if not all parameters that represent conceptual or effective properties of landscape should be regarded as time invariant static and their meaningful values can only be obtained through the parameter calibration method ajami et al 2007 mendoza et al 2015 now several methods have been proposed to handle unknown static model parameters using the smc samplers including the state augmentation method which simply treats the static parameters as dynamic states and transfer the parameter optimization to state variable filtering problem e g moradkhani et al 2005 2012 salamon and feyen 2009 nagarajan et al 2011 noh et al 2011 vrugt et al 2013 abbaszadeh et al 2018 and the dynamic partial posterior distribution method which sequentially incorporates increasing amounts of observations into the posterior distribution e g chopin 2002 another approach is the so called geometric bridge method del moral et al 2006 fan et al 2008 jeremiah et al 2011 2012 which constructs an inhomogeneous sequence of distributions to move smoothly from a tractable initial distribution to the target distribution through a sequence of intermediary distributions the smc sampler implemented using geometric bridge method has advantages in preserving the static nature of the unknown parameters and inferring the parameter posterior distribution based on the whole observations lee and chia 2002 in spite of these advantages the smc sampler has a serious drawback which is the well known particle impoverishment problem to improve particle diversity and quality the particles usually need to be moved by using the markov chain monte carlo mcmc transition kernel i e random walk metropolis rwm algorithm metropolis et al 1953 and adaptive random walk metropolis arm algorithm chopin 2002 fan et al 2008 jeremiah et al 2011 2012 chopin 2002 pointed out that the efficiency in the move step is critical since it is the most computationally demanding step thus it is significantly important to develop appropriate candidate generating algorithms in improving the efficiency of the smc sampler owen and tribble 2005 inspired by the success of the genetic and evolution algorithm holland 1975 storn and price 1997 in optimization problems we proposed a new candidate generating method in the framework of smc by employing the two genetic styled operators crossover and mutation specifically the new algorithm is implemented by incorporating some attractive features of genetic and evolutionary algorithm to generate candidates as well as the metropolis hasting algorithm into the framework of smc to evolve the particles to the target distribution this philosophy is not completely new in previous studies some authors have tried to combine the genetic or evolutionary algorithms with population mcmc e g liang and wong 2001 ter braak 2006 vrugt et al 2008 also considerable efforts have been paid to introduce the genetic algorithm into the particle filters uosaki et al 2004 park et al 2007 li et al 2013 abbaszadeh et al 2018 however these works mainly focus on estimating the state variables of a dynamic system rather than the unknown model parameters in this study we describe how to embed the genetic and evolutionary algorithm into the framework of smc for estimating the static model parameters and prove that the proposed algorithm in move step is an mcmc transition kernel which admits the intermediary distribution to be stationary in addition there is a growing realization that parameter estimation in hydrological models is significantly affected by uncertainties in the input forcing data kavetski et al 2002 2006 ajami et al 2007 vrugt et al 2008 to get unbiased parameter estimations and detect the genuine model structure inadequacies the forcing uncertainty should be described explicitly with the system through input error models kavetski et al 2002 2006 ajami et al 2007 vrugt et al 2008 in such conditions the number of variables needed to be estimated including hydrological model parameters and latent variables in the input error model increase considerably and often cause dimensionality issues ajami et al 2007 thus it is needed for the smc samplers to be able to handle the high dimensional problems and the applicability of the samplers for analyzing forcing uncertainty should be assessed systematically montanari 2007 to achieve this propose the efficiency and effectiveness of the proposed smc sampler were tested and compared with other smc samplers using different mcmc transitional kernels i e rwm and arw algorithms through two case studies the first one uses a synthetic bimodal normal distribution with dimensions varying from 5 to 50 and the second one uses a conceptual rainfall runoff model by dealing only with model parameter uncertainty and simultaneously with model parameter and input uncertainties the paper is organized as follows section 2 presents a summary of the bayesian inference followed by a detailed description of the smc samplers in section 3 including the principle of the geometric bridge method the procedures of the smc sampler and the candidate generating methods in move step section 4 provides the results of the two case studies and compares the performance of each sampler finally section 5 presents the main conclusions of the study and the scope for future work 2 bayesian inference a hydrological model can be defined as 1 y t f x t θ ɛ t where y t is the observed data at time t 1 2 n f x t θ is the corresponding model output simulation x t is the model input at time t θ rd is a d dimensional vector of unknown model parameters and ε t represents the measurement error consisting the combined errors from modeling uncertainties the bayesian inference treats hydrologic model parameters θ as probabilistic variables and the posterior parameter distributions can be expressed as 2 p θ y 1 n p θ p y 1 n θ p y 1 n p θ p y 1 n θ where y 1 n y t t 1 2 n represents the set of all available observations p θ and p θ y 1 n signify the prior and posterior parameter distribution respectively p y 1 n θ denotes the model likelihood for observed data y 1 n and p y 1 n is the normalization constant so that the posterior parameter distribution integrates to unity in the most simplistic case with scalar valued measurement y t r 1 t 1 2 n and normal homoscedastic uncorrelated error terms the likelihood function can be written as 3 p y 1 n θ 2 π σ 2 n 2 t 1 n exp y t f x t θ 2 2 σ 2 where σ is an estimate of the standard deviation of the measurement error traditionally σ can be included into the analysis explicitly i e assuming σ is uniform over log σ gelman et al 1995 bates and campbell 2001 and treated as one the model parameters which yields a complete posterior distribution of σ however this method artificially increased the parameter dimension of the problem and may result in unreasonable estimations of the parameter values kavetski et al 2006 in this study σ was estimated by using the analytical method braswell et al 2005 zhu et al 2014 which is to find the value of σ that maximizes log p y 1 n θ for a given parameter vector by differentiating log p y 1 n θ with respect to σ we can obtain 4 σ a 1 n t 1 n y t f x t θ 2 we then used σ a to replace σ in eq 3 3 sequential monte carlo sampling the sequential monte carlo smc sampling approach is a generalization of importance sampling that generates a set of samples from p θ y 1 n with associated weights also called particles and calculates estimates based on these weighted samples as the number of samples become very large the monte carlo approximation can equivalently represent the functional description of the posterior distribution arulampalam et al 2002 however since the posterior distribution is hard to sample directly smc tackles this problem by introducing a sequence of intermediary distributions with the final distribution given by the desired posterior fan et al 2008 in this study the intermediary distribution is constructed using the geometric bridge method del moral et al 2006 fan et al 2008 jeremiah et al 2011 2012 5 π s θ p 0 θ 1 β s p θ y 1 n β s where p 0 θ and π s θ denote the initial and the sth distribution in the sequence s 0 1 s respectively and β s is a sequence of scalar powers such that 0 β0 β1 β s 1 which allows a gradual transition of π s θ from the initial sampling distribution π0 θ p 0 θ when β0 0 to the posterior distribution π s θ p θ y 1 n when β s 1 how to specify the distributional sequence β s still remains an open research question fan et al 2008 following jeremiah et al 2011 2012 an exponential β s sequence is used in this study suppose that an initial population of n particles i e parameter vectors θ are generated from the initial distribution π0 θ p 0 θ from which direct sampling is possible each particle is denoted by θ j 0 and allocated a weight w j 0 1 n for j 1 2 n so that θ j 0 w j 0 is a weighted particle at initial stage s 0 the smc sampling approach then uses the weighted particles from π s 1 θ with s 1 2 s to produce particles from distribution π s θ through reweighting resampling and move processes which are described in detail below 3 1 reweighting given n weighted particles θ j s 1 w j s 1 j 1 2 n from π s 1 θ at stage s 1 with s 1 2 s then by setting θ j s θ j s 1 and 6 w j s w j s 1 π s θ j s π s 1 θ j s 1 the resulting particles θ j s w j s are now drawn from the distribution π s θ eq 6 will increase the weight of particles that have higher density under π s θ than under π s 1 θ and decrease the weight of particles that have lower density under π s θ than under π s 1 θ 3 2 resampling a common problem with the smc sampling approach is the degeneracy phenomenon where as s increases all but one particle will have negligible weight arulampalam et al 2002 this implies that a large computational effort is devoted to updating particles whose contribution to posterior estimates and predictions is almost zero the aim of resampling step is to discard bad particles with negligible importance and to replace them with exact copies of more promising samples vrugt et al 2013 a suitable measure of degeneracy of the algorithm is the effective sample size neff defined as jeremiah et al 2011 2012 vrugt et al 2013 7 n e f f 1 i 1 n w j s 2 in practice resampling is performed whenever neff is less than rn where r 0 1 is a pre specified constant typically taken to be 1 2 fan et al 2008 the resulting particle is in fact an i i d sample from the discrete distribution θ j s w j s arulampalam et al 2002 and the weights are reset to w j s 1 n for j 1 2 n fan et al 2008 jeremiah et al 2011 2012 until now a wide variety of resampling methods including systematic stratified residual and multinomial resampling has been developed in the statistical literature following arulampalam et al 2002 the systematic resampling scheme is selected in this study since it is simple to implement and minimizes the monte carlo variance 3 3 move although the resampling step reduces the effects of the degeneracy problem it may lead to a loss of diversity among the particles as the resulting sample will contain many repeated points which is known as sample impoverishment let θ j s w j s j 1 2 n denote particles at current stage s after reweighting and possibly resampling steps to improve particle diversity and quality each sample is moved according to a markov chain monte carlo mcmc transition kernel ks so that θ j s k s θ j s generally the building of a mcmc transition kennel ks proceeds in the following three steps first a candidate particle θ j s is sampled from a proposal density q s θ j s that depends on the present particle θ j s next the candidate particle is either accepted or rejected using the metropolis hasting m h acceptance probability 8 α m i n 1 π s θ j s q s θ j s θ j s π s θ j s q s θ j s θ j s finally with probability α set θ j s θ j s else leave θ j s unchanged efficiency of the move step significantly depends on an appropriate selection of the candidate generating methods owen and tribble 2005 the earliest and most general candidate generating approach is the random walk metropolis rwm algorithm metropolis et al 1953 in this approach the candidate sample θ j s is drawn from a proposal density qs that depends on the current particle θ j s and is assumed to be fixed and symmetric i e q s θ j s θ j s q s θ j s θ j s a natural choice for q s θ j s in practice is the multivariate normal density so that θ j s n d θ j s γ i d here i d denotes the d dimensional identity matrix and γ is the scaling factor for which we have used the value γ 2 38 2 d given by roberts and rosenthal 1998 to fully use the information gained by the particle system itself the adaptive random walk metropolis arm algorithm is proposed and has been widely used in literature chopin 2002 fan et al 2008 jeremiah et al 2011 2012 for the arm algorithm the covariance of the multivariate normal proposal density is continuously adapted toward the target distribution based on particles in previous populations following chopin 2002 the proposal density is defined as q s θ j s n d θ j s σ s 1 where σ s 1 denotes the weighted sample covariance matrix of previous particle populations θ j s 1 w j s 1 j 1 2 n the new candidate generating method presented here is named as particle evolution metropolis pem which uses genetic and evolution operators to generate candidates holland 1975 storn and price 1997 and merges the strength of the m h algorithm to evolve the particle to the target distribution in the context of genetic or evolution algorithm the particle θ j s j 1 2 n at current stage s is called a chromosome or an individual and the set of n particles form a population then the population is continuously updated toward better solutions in the parameter space by selection and modification procedures noticeably the particles have been selected according to their weights in the resampling step of the smc algorithm which is functionally similar in to the roulette wheel selection procedure used in genetic algorithm thus only two genetic styled operators crossover and mutation are employed in this step and they serves to diversify the individuals in the population notably the chromosomes can be coded as either binary or real numbers in applications to practical problems previous studies have demonstrated that the genetic styled operators are more efficient for real coded chromosomes than those coded in binary numbers liang and wong 2001 thus the real coded chromosomes were used in this study in the crossover operator one parental chromosome pair θ i s and θ j s i j is selected from the current population without replacement and mated to produce a new offspring pair θ i s and θ j s according to the random selection procedure as the weights of chromosome were reset to be equal after the resampling step here the simple one point crossover operator is used to generate offspring θ i s and θ j s which is operated as follows first an integer crossover point is drawn uniformly on 1 2 d where d is the dimension of parameter space then θ i s and θ j s are produced by swapping the parameters to the right of the crossover point between parents θ i s and θ j s with a predefined crossover probability pc after crossover the new offspring pair is accepted with probability min 1 rc according to the m h rule 9 r c π s θ i s π s θ j s j s θ i s θ j s θ i s θ j s π s θ i s π s θ j s j s θ i s θ j s θ i s θ j s where js denotes the transfer probability between the parental θ i s θ j s and the offspring θ i s θ j s pairs and j s θ i s θ j s θ i s θ j s p θ i s θ j s θ p θ i s θ j s θ i s θ j s here p θ i s θ j s θ denotes the selection probability of one pair from the parental population θ and p θ i s θ j s θ i s θ j s is the generating probability of offspring pair θ i s θ j s from the parental chair θ i s θ j s it can be proved that the transfer probability from the parental pair θ i s θ j s to the offspring pair θ i s θ j s is equal to the reverse transfer i e j s θ i s θ j s θ i s θ j s j s θ i s θ j s θ i s θ j s see theorem in supplement 1 if the proposal is accepted the current parental pair θ i s θ j s in the population is replaced by θ i s θ j s otherwise the population remains unchanged noticeably if mating does not take place in the crossover procedure the parents always survive to the next stage according to the m h rule after the crossover operators which repeat n 2 times the population is updated and denoted by θ θ j s j 1 2 n to increase the diversity of the parameter population the differential mutation procedure is used to modify the real coded chromosomes of offspring storn and price 1997 that is the current particle θ j s j 1 2 n is mutated according to 10 θ j s θ j s γ θ r 1 s θ r 2 s ζ d where r 1 and r 2 are integer values drawn without replacement from 1 j 1 j 1 n γ 2 38 2 d denotes the jump rate and ζd nd 0 b is drawn from a normal density with small standard deviation say b 10 6 according to the m h rule the new chromosome θ j s is accepted with probability min 1 rm where rm is calculated as 11 r m π s θ j s j s θ j s θ j s π s θ j s j s θ j s θ j s and js denotes the transition probability between θ j s and θ j s ter braak 2006 has proved that the transfer probability from θ j s to θ j s is the same as that from θ j s to θ j s i e j s θ j s θ j s j s θ j s θ j s if the proposal is accepted the current parental chromosome θ j s in the population is replaced by θ j s otherwise the population remains unchanged these operators selection and mutation are repeated n times and the population is updated again we proved that the pem algorithm maintains the detailed balance and admits π s as the unique stationary distribution at each stage s see theorem in supplement 1 there are only three basic control variables in pem smc sampler n the number of particles in population s the number of evolutions and p c the crossover probability which is set to be 0 6 in this study in addition it is inherently parallel and hence lends itself to computation via a parallel machine or a network of computers the pseudo code of the algorithm is given below step 1 initialization a draw an initial population θ j 0 j 1 2 n from p 0 θ and set weights w j 0 1 n b identify the sequence 0 β0 β1 β s 1 c set iteration index s 1 and effective sample size constant r 0 1 for s 1 2 s do stage evolution step 2 reweighting a set θ j s θ j s 1 j 1 n and calculate the weight w j s w j s 1 π s θ j s π s 1 θ j s 1 b normalize the weight so that j 1 n w j s 1 step 3 resampling a calculate the effective sample size n e f f 1 i 1 n w j s 2 b if neff rn go to the next step otherwise return to step 2 step 3a systematic resampling a resample from θ j s w j s j 1 2 n using the systematic resampling procedure b set w j s 1 n j 1 2 n step 3b move using the pem algorithm to increase the diversity of particles for i 1 2 n 2 do crossover operator using one pair chromosome a randomly select one parental chromosome pair θ i s and θ j s i j and create a new offspring pair θ i s and θ j s using the one point crossover operator b with probability m i n 1 π s θ i s π s θ j s j s θ i s θ j s θ i s θ j s π s θ i s π s θ j s j s θ i s θ j s θ i s θ j s set θ i s θ i s and θ j s θ j s else leave θ i s and θ j s unchanged end for crossover operator using one pair chromosome for i 1 2 n do mutation operator using one chromosome a uniformly select one chromosome θ j s j 1 2 n from the present population and create a new chromosome θ j s by the mutation operator b with probability m i n 1 π s θ j s j s θ j s θ j s π s θ j s j s θ j s θ j s set θ j s θ j s else leave θ j s unchanged end for mutation operator using one chromosome end for stage evolution 4 case studies in this section we conducted two case studies to compare the performance of the smc sampler with different candidate generating algorithms in exploring the parameter space for convenience the smc sampler utilizing the rwm arm and pem algorithms to generate candidates is named as rwm smc arm smc and pem smc respectively in the first case study a synthetic example is constructed on the basis of a mixture of multivariate normal distribution with a well separated bimodal response surface the second example considers application of the algorithms to parameter inference in the hydrologic setting featuring a lumped conceptual rainfall runoff watershed model with data from the bass river watershed australia 4 1 case study 1 synthetic bimodal normal mixture to emulate the common feature of the parameter surface with multiple modes in hydrological modeling the first case study involves a synthetic multi dimensional bimodal normal distribution smith and marshall 2008 vrugt et al 2009 12 π θ 1 3 n d θ 5 i d 2 3 n d θ 5 i d where 5 and 5 are d dimensional vectors to explore the efficiency and effectiveness of the smc samplers in simulating the target distribution in different dimensions the test study was performed in dimensions d 5 10 20 and 30 the feasible parameter space was taken to be a uniform distribution between 10 and 10 for each parameter in the 5 dimensional case fig 1 compares histograms of the marginal posterior distribution of parameter derived from the smc samplers with the actual target distribution obviously both modes of the target distribution are well identified by the three smc samplers with particle number n 300 in addition the statistical characteristics of the average euclidean distance of the true means and standard deviations of the prior defined probability distribution from the respective values estimated with the smc samplers are summarized in table 1 the results indicated that the smc samplers can give a reasonable estimation of the true values of the prior defined probability distribution to check the convergence status of the smc algorithms the transitions of parameters of the selected particles during the sampling paths are illustrated in fig 2 note graphical examination about the convergences of the algorithms for other particles yields a similar picture as that presented in fig 2 it demonstrates that in the initial stages s 450 the parameter values of the particles are uniformly distributed in the parameter space at a later stage s 450 they all tend to converge to a limiting distribution that appear relative tight and encompass the actual target parameter values 5 and 5 represented by and at the right hand side respectively however the mixing of the particles generated by the rwm smc algorithm is quite poor it is generally difficult for the particles to jump from one mode to the other and the individual particle tends to collapse into a single region of highest attraction fig 2a on the contrary the other two smc samplers i e arm smc and pem smc exhibit relatively good explorative and mixing capabilities partially due to their abilities in exchanging information about the search space gained by different launched particles fig 2b and c the performances of the smc samplers in dimension d 10 are similar to that in d 5 to obtain proper estimations of posterior parameter distribution the particle number should be larger than 800 for the 20 dimensional case the histograms of the marginal posterior distribution of dimensions 1 5 10 15 20 generated using the smc samplers with particle number n 1500 are presented in fig 3 as well as providing the actual target distribution black line it is clear that the arm smc sampler falsely converged to local optimum and only one mode was identified by it also the average euclidean distance of the pem smc estimated mean values and standard deviations from the true values is closer to zero than that of the other smc samples suggesting that the pem smc sampler outperforms other smc samplers in estimating the 20 dimensional bimodal target distribution more significantly the transitions of parameters during the sampling paths revealed that the particles generated by the rwm smc and arm smc samplers tend to collapse into local optimums and the mixing of the particles are quite poor fig 4 a and b on the contrary the pem smc algorithm exhibits relatively good mixing capabilities and thus maintaining the diversity of the particles fig 4c we further tested the performances of the smc samplers in dimension d 30 with particle number n 1500 the results indicated that it is difficult for the rwm smc and arm smc samplers to properly estimate the 30 dimensional bimodal target distribution in contrast the pem smc sampler illustrated relative good performances in both properly identifying two modes of the target distribution and maintaining the mixing properties of particles see details in supplement 2 thus the pem smc sampler seems to be more efficient in exploring the high dimensional and complex parameter space than other smc samplers i e rwm smc and arm smc this does benefit from the ability of the genetic algorithm to learn efficiently from the historical evolutionary processes which plays an important role in the early stage of the evolution that is the good particles with a high probability value tend to be stored in the population for a relative long time while the bad particles with a low probability value will be easily eliminated from the population thus the crossover operator in subsequent evolutionary processes ensures us to construct better proposal distributions based on the guidance of good particles stored in the population in addition the mutation operator provides a local updating step to help the particles escape from local optimum and therefore increase the mixing of the particles the improved efficiency and effectiveness of the pem smc algorithm give us confidence in its proper assessment of parameter uncertainty in hydrologic modeling 4 2 case study 2 conceptual hydrologic modeling the second case study considers the australian water balance model awbm which was developed by boughton 1993 to calculate daily runoff from daily rainfall data and daily evapotranspiration estimates fig 5 the awbm has 8 parameters that need to be properly calibrated among them six parameters represent the variability of soil moisture capacity over a watershed which include three surface storage capacities c 1 c 2 c 3 and the fractional areas associated with these capacities a 1 a 2 a 3 the other two parameters are the baseflow index bfi and the daily recession constant k which is used to determine the proportion of baseflow recharge from surface runoff and discharge from the baseflow respectively thus the parameter vector associated with the awbm model can be written as θ c 1 c 2 c 3 a 1 a 2 a 3 bfi k 4 2 1 parameter uncertainty estimation in this section we focus to investigate the performances of the smc samplers in identifying and estimating model parameters without explicit assessment of forcing data error here we considered two different runoff time series in this analysis the first study serves as a benchmark experiment of the smc samplers and uses a fourteen years 1 january 1983 31 december 1996 record of simulated dataset the simulated runoff dataset was generated from the awbm model using measured forcing data from the bass river watershed in the south gippsland basin 52 km2 and parameter values given by marshall et al 2004 table a1 in supplement 3 the artificial runoff data are then corrupted with heteroscedastic measurement error the standard deviation of which was taken to vary from 5 to 50 of the actual simulated values the second study explores the performance of the smc samplers using the actual measured runoff dataset see details in bates and campbell 2001 marshall et al 2004 jeremiah et al 2011 in all numerical experiments the smc samplers were performed with particle number n 400 and iteration s 1000 where the initial parameter values were randomly sampled from the noninformative prior distribution moradkhani et al 2005 salamon and feyen 2009 for the artificial runoff dataset two main conclusions can be drawn from the analysis first the mixing capacity of the rwm smc sampler is quite poor fig 6 and it turned out not to be competitive when applying in the hydrologic setting second the arm smc and pem smc samplers are robust to noise in measurements the estimates of the model parameters derived with the arm smc and pem smc are very close to the actual values when the standard deviation of measurement error varies from 5 to 30 of the actual simulated values fig 7 previous studies have illustrated that the overall uncertainty in runoff measurements mainly range from 5 to 20 pelletier 1987 thus the effect of measurement uncertainty plays a marginal role in identifying real world hydrological model parameters for the arm smc and pem smc samplers these highlight that arm smc and pem smc samplers are more suitable than the rwm smc sampler in making inferences about the posterior parameter distribution of the hydrological models in the following study we thus mainly focus on investigating the performances of the arm smc and pem smc samplers in real world hydrological setting for the historical runoff observations we used 5 years 1 january 1987 31 december 1991 data for model calibration and 5 years 1 january 1992 31 december 1996 data for model validation to reduce sensitivity to state value initialization the first 4 year data 1 january 1983 31 december 1986 was used as the warm up period prior to the calibration data time series during which no updating of the posterior density was performed the posterior marginal parameter distributions derived by each smc sampler are shown as histograms in fig 8 and summarized in table 2 by posterior medians and 95 probability intervals the posterior distributions of the individual parameters obtained by the two samplers are very similar and occupy only a relatively small region interior to the uniform prior distributions table 2 and fig 8 suggesting the two smc samplers were in most cases successful in reducing the assumed prior uncertainties of the parameters values to understand the influence of parameters uncertainty to the simulation result of awbm predictive uncertainty fig 9 shows the 95 hydrograph prediction uncertainty intervals associated with the posterior parameters ranges for the selected calibration and evaluation periods we can observe that the ensemble runoff predictions using the posterior parameters derived by the two smc samplers are very similar and they all reasonably track the historical runoff dynamics dark solid circlers however only a small portion of observed runoff data can be bracketed by the 95 hydrograph prediction uncertainty table 3 and fig 9 the findings are consistent with previous studies i e ajami et al 2007 vrugt et al 2008 and reveal a considerable amount of uncertainty in both the model structure and the forcing data 4 2 2 simultaneously considering parameter and input uncertainty estimation in this section we investigate the applicability of the smc samplers in simultaneous estimation of the awbm model parameters and input uncertainty within the system in this study the rain fall forcing data error was implemented by using a single rainfall multiplier for each storm event kavetski et al 2002 2006 ajami et al 2007 vrugt et al 2008 that is each storm is assigned a different rainfall multiplier β j j 1 2 ς which uniformly distributed over the range between 0 25 and 2 50 and these values are added to the vector of model parameters θ to be optimized hence θ θ β in the 5 years calibration period 1 january 1987 31 december 1991 a total of ς 66 storm events were identified for the bass river watershed which resulted in the number of estimated parameters increasing up to 73 to verify whether the smc samplers are computationally feasible synthetically generated runoff data are used first followed by the actual measured runoff dataset to generate the synthetic runoff dataset a multiplier vector was first drawn using latin hypercube sampling within 0 25 2 50 ς ς 66 then it was combined with the observed rainfall depths over the basin to generate a new rainfall hyetograph the rainfall record was subsequently used with randomly sampled values of the awbm parameters table a2 in supplement 3 to create a 5 year time series of synthetic runoff data in both the synthetic and the actual studies the smc samplers were performed with particle number n 600 and iteration s 2000 for the synthetic runoff dataset it is observed that the particles generated by the smc samplers tend to converge to the limiting distribution after 1200 iterations fig 10 however the arm smc sampler provides some differing parameter estimates from their actual values in particular for parameters c 1 c 2 and a 2 while the different actual values of the awbm model parameters are well defined by the pem smc sampler and display very little uncertainty fig 11 more significantly it is difficult for the arm smc sampler to properly converge to the actual values of the rainfall multipliers only 11 out of 66 are well identified on the contrary the majority of the rainfall multiplier values 41 out of 66 are well identified by the pem smc sampler with its failures due to the low values in either rainfall depths or runoff observations fig 12 thus the pem smc sampler is more robust than the arm smc sampler for the case in simultaneously estimating both the awbm model parameters and the rainfall multipliers more details about the performances of the smc samplers were presented in supplement 3 for the historical runoff observations the calibration procedure is similar to that used in section 4 2 1 the posterior marginal parameter distributions derived by the smc samplers are given in fig 13 and table 2 the sampled rainfall multipliers for each storm are presented as box plots in fig 14 as well as providing histograms of all combined rainfall multipliers comparing with the results in section 4 2 1 we can observe that 1 the explicit consideration of the input error changes the final estimated marginal distribution of the model parameters which is most evident for the parameters c 3 k and bfi table 2 2 the 95 prediction uncertainty interval of the parameters obtained by the smc samplers decreases when rainfall estimates are directly inferred from the observed discharge data table 2 3 the posterior distribution of the model parameters and the rainfall multipliers derived by the pem smc sampler are very narrow and close to normal in comparison with that obtained by the arm smc sampler fig 13 fig 14a and c indicating that the runoff observations contain sufficient information for the pem smc sampler to simultaneously constrain both model parameters and rainfall multipliers and 4 the median posterior values of the combined rainfall multipliers obtained by the two smc samplers are very similar and larger than 1 fig 14b and d indicating the observed rainfall depths are lower than our inferred rainfall from the runoff data on average the 95 runoff predictive uncertainty ranges associated with model parameter and input uncertainty for selected calibration and evaluation periods are presented in fig 15 here the rainfall multiplier for each individual rainfall storm during the evaluation period was sampled from the histograms presented in fig 14b and d and was then combined with the observed rainfall record to generate a possible realization of rainfall hyetograph looking at fig 15 and comparing with fig 9 we can observed that the 95 prediction intervals are slightly narrow here and show a much better coverage of the low runoff observations i e days 1 81 for calibration period and days 1 50 for the validation period the summary statistics presented in table 3 showed that the observed runoff data that fall in the 95 prediction intervals has increased by about 50 for the two smc samplers when we account for input uncertainty also a better model performance is obtained when rainfall multipliers are simultaneously inferred with the model parameters i e a 5 30 reduction in rmse is observed for the two smc samplers noticeably the model performances with parameters and input uncertainty determined by the awr smc sampler and the pem smc sampler are very similar this phenomenon is well known as equifinality in hydrology mainly due to the inadequacies in model structure beven and freer 2001 bastola et al 2011 thus further analysis about model structural error is needed in future studies this is beyond the scope of current paper and we will consider using multiple different hydrological models to reduce the uncertainty caused by the model structure in future studies 5 conclusions this paper has presented a sequential monte carlo sampler which is entitled the particle evolution metropolis sequential monte carlo pem smc algorithm the sampler incorporates some attractive features of genetic algorithm differential evolution algorithm and metropolis hasting algorithm into the framework of sequential monte carlo to evolve a population of particles to approximate the posterior parameter distributions we proved that the sampler admits the target distribution at each iteration π s θ s 1 2 s to be a stationary distribution the performance of the pem smc in estimating the posterior parameter distribution was compared with the other two smc samplers i e rwm smc and arm smc samplers through two case studies of increasing complexity the first case study a synthetic bimodal normal distribution showed that the pem smc sampler has the ability to infer the known target distribution where the parameter surface is extremely complex with many local optima for the arm smc sampler the candidates are drawn from the gaussian proposal distribution with a fixed spatial orientation thus the arm smc sampler is more likely to falsely converge to a local optimum and only one mode can be identified in dimension d 20 fig 3b this indicated that the arm smc sampler can potentially experience difficulties in exploring the non gaussian parameter space with multiple modes in addition the difficulty in ensuring the weighted sample covariance matrix to be symmetric and positively semi defined make the arm smc sampler thoroughly fails for high dimensional problems d 30 for the rwm smc the candidates are generated from an isotropic random walk which can effectively reduce the risk of false convergence to local optima however the rwm smc algorithm shows relative poor mixing property and it is generally difficult for the individual particles to traverse the parameter space figs 1 and 3 this leads the explorative capability of the rwm smc sampler through the feasible parameter space is lower than that of the arm smc and pem smc samplers a second case study illustrated the utility of the pem smc sampler when applied to conceptual rainfall runoff modeling by only considering model parameter uncertainty and simultaneously considering both model parameter and input data uncertainties the synthetic test reveals that the improved efficiency and effectiveness of the pem smc sampler can successfully reduce the prior uncertainties in parameter and input by using information contained in observed runoff data jeremiah et al 2011 on the contrary the rwm smc sampler turned out to not competitive when applying in the hydrologic setting due to its low capacity in exploring parameter space this is consistent with the results of the synthetic bimodal normal distribution the arm smc sampler experienced difficulties in simultaneously estimating both the model parameters and the input uncertainties the majority of the actual values of the rainfall multipliers fall out the 95 probability intervals obtained by the arm smc sampler fig 12 for historical runoff observations the estimated marginal distribution of the model parameters by accounting input errors was different from that estimated by only considering parameter uncertainty table 2 in addition the observed runoff data that fall in the 95 prediction intervals has increased by about 50 for the two smc samplers when we account for input errors table 3 these results are consistent with previous studies ajmni et al 2007 vrugt et al 2008 however the model performances with different parameter and rainfall multiplier values determined by the arw smc and pem smc samplers are very similar this indicates that some physical processes of the watershed may be not adequately represented by the awbm model and further analysis is needed to address the model structure uncertainty by using the bayesian model averaging approach ajmni et al 2007 qi et al 2018 the integration of copulas and bayesian model averaging approach madadgar moradkhani 2013 madadgar et al 2014 sequential bayesian methods hsu et al 2009 wei et al 2012 and data assimilation methods bell et al 2004 kuppel et al 2013 cardinali et al 2014 abbaszadeh et al 2018 essentially bayesian model averaging approach is a post processing of the individual model predictions in a selected ensemble by using the expectation maximization em algorithm raftery et al 1997 thus the proposed smc sampler can be easily extended to the studies of total uncertainty assessment including model parameters input and structural uncertainty and we will present related results in the coming papers finally the computational execution time required by the pem smc sampler is about two times of that needed by the rwm smc and arm smc samplers because of the inclusion of some extra operators in move step of the pem smc sampler however a further significant speedup can be obtained if the pem smc is executed on a parallel machine or a network of computers due to its inherently parallel this is especially true for real world hydrological problems where obtaining the proper parameter posterior distributions often requires a significant amount of time i e about 20 hours for simultaneously estimating both parameter and input uncertainties of the awbm model for the pem smc sampler acknowledgments the authors would thank prof g c sander editor and prof b rajagopalan associate editor for their continued help during the revisions of the paper we also thank the anonymous reviews for their critical reviews and helpful comments this research was supported by national key r d program of china 2016yfc0500203 the national natural science foundation of china nos 31370467 and 41571016 and cas interdisciplinary innovation team the data and code written in matlab can be obtained from the first author zhugf lzu edu cn upon request supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2018 02 007 appendix supplementary materials image application 1 image application 2 
848,physical semi empirical models that do not require any calibration are of paramount need for estimating hydrological fluxes for ungauged sites we develop semi empirical models for estimating the mean and variance of the monthly streamflow based on taylor series approximation of a lumped physically based water balance model the proposed models require mean and variance of monthly precipitation and potential evapotranspiration co variability of precipitation and potential evapotranspiration and regionally calibrated catchment retention sensitivity atmospheric moisture uptake sensitivity groundwater partitioning factor and the maximum soil moisture holding capacity parameters estimates of mean and variance of monthly streamflow using the semi empirical equations are compared with the observed estimates for 1373 catchments in the continental united states analyses show that the proposed models explain the spatial variability in monthly moments for basins in lower elevations a regionalization of parameters for each water resources region show good agreement between observed moments and model estimated moments during january february march and april for mean and all months except may and june for variance thus the proposed relationships could be employed for understanding and estimating the monthly hydroclimatology of ungauged basins using regional parameters keywords hydroclimatology prediction in ungauged basins physical water balance model monthly moments 1 introduction the partitioning of precipitation into evaporation and streamflow a fundamental aspect of understanding the hydroclimatology of the region is governed by the dynamic processes of atmosphere and surface and sub surface moisture interactions seasonality of precipitation and temperature heterogeneity in the land surface and sub surface data and varying basin characteristics all complicate the task of understanding this partitioning milly et al 1994a b petersen et al 2012 this fundamental understanding provides opportunities for developing semi empirical models that estimate mean annual monthly runoff purely based on climatic information and basin characteristics since these models require no calibration they can also be applied in ungauged basins for developing first order estimates of mean monthly land surface fluxes which provides critical information for water resources planning and management numerous studies have focused on developing physical or semi empirical relationships to explain the annual hydroclimatology of a region schreiber 1904 ol dekop 1911 budyko 1974 milly 1994a 1994b wolock and mccabe 1999a 1999b zhang et al 2001 yang et al 2008 donohue et al 2010 milly 1994a incorporated the seasonality in precipitation and potential evapotranspiration on the annual water balance woods 2003 has developed analytical models for seasonality and annual water balance of a catchment potter et al 2005 and hickel and zhang 2006 have also analyzed the impact of rainfall seasonality on mean annual water balance however there is limited no models available that provide estimates of mean and variance of monthly runoff purely based on climate and basin characteristics farmer et al 2003 explored the role of climate and landscape interactions in explaining the annual monthly and daily water balance of several arid basins yokoo et al 2008 explored the effects of seasonal variability of climate on mean annual and monthly water balances based on a physically based hill slope model petersen et al 2012 explained how the co occurrence of moisture and energy availability in phase and out of phase seasonality between precipitation and temperature can control the mean monthly runoff over the coterminous united states the objective of this study is to develop a physical model that estimates mean monthly runoff and variability of monthly runoff based on mean monthly precipitation mean monthly potential evapotranspiration and basin characteristics an allied goal is to evaluate the developed model in explaining the spatial variability in mean monthly runoff and variance of monthly runoff over the coterminous united states towards this we consider a lumped watershed model that is parsimonious in parameterization for deriving the expressions for mean monthly and variance of monthly runoff at the annual scale milly 1994b used a conceptual water balance model to identify several dimensionless parameters that influence the partitioning of rainfall into evapotranspiration and streamflow that is the first effort that developed a physical model extending budyko s framework for estimating mean annual runoff based on aridity ratio soil moisture storage capacity seasonality of moisture and energy variations and storm arrival rate koster and suarez 1999 implemented budyko s framework to investigate the implication of anomalous annual precipitation totals on evaporation and runoff behavior within this context they provide a single input function able to predict the ratio of the standard deviations in interannual evaporation and precipitation using only the index of dryness their approach is simple adhering to model parsimony yet sufficient at explaining basic hydroclimatic statistics of yearly data sankarasubramanian and vogel 2002 proposed similar approach by deriving approximations of a lumped watershed model for explaining the mean annual runoff and interannual variability of annual streamflow in the hydroclimatic data network hcdn basins over the coterminous united states recently sivapalan et al 2011 demonstrated the congruence in trends between spatial and temporal variability for key precipitation and groundwater partitioning factors their study which analyzed the horton index baseflow fraction vaporization fraction and runoff fraction metrics for coterminous united states basins showed similarity in the behavior of mean annual water balance variability between 377 catchments and variability in annual flows for 12 catchments over a 50 year period they however acknowledged that the interannual variability and responses to individual years were not well represented indicating the unexplained phenomena of within year and within catchment variability of climatic inputs and their interactions with landscape properties extending these parsimonious models to monthly time scale requires consideration of several additional processes zhang et al 2008 adopted a top down approach sivapalan et al 2003 to extrapolate the application of budyko s curve 1961 to two critical partitions of the water cycle at sub annual scale their approach entails using the primary controls climate to explain the catchment behavior and including secondary controls basin soil moisture dynamics only if deemed necessary extending budyko s framework of demand supply relationships for various layers in the water balance model this water balance model adds additional complexities for estimating runoff at multiple time scales thus the zhang s water balance model zwbm proposes a parsimonious approach in extending budyko s framework for estimating runoff over various time scales and our work builds on to develop approximations to moments of monthly streamflow precipitation events are divided into catchment rainfall retention and direct runoff and catchment water availability is divided into evapotranspiration soil moisture storage and groundwater recharge for extending the water balance model to be flexible at monthly and daily time scales these variables in combination with four efficiency and partitioning parameters conceptualize the influxes and effluxes of soil moisture and groundwater storages according to the limits concept while many watershed models have been developed to simulate monthly runoff based on detailed calibration there are no parsimonious physical models that estimate mean and variance of monthly streamflow for ungauged basins we employ the zwbm to derive taylor s series approximations of mean monthly streamflow and variance in monthly streamflow we focus on obtaining the first two statistical moments of monthly streamflow utilizing mean variance and covariance information between precipitation and potential evapotranspiration climate forcings with additional parameters which are estimated regionally describing the basins response the proposed framework could potentially estimate the first two moments of monthly runoff for ungauged basins with minimal input the rest of the paper is organized in the following manner first we provide a description of the geographic extent of our study sites and give information on the data sources and their methods of measurement in section 2 we present an overview of the zwbm and introduce our derivation of the taylor series approximations for the mean and variance in monthly streamflow in section 3 we also assess the performance of our approximation equations through comparison with zwbm obtained statistics and our observed dataset in section 4 we analyze and describe the utility of the regionalized parameterization of our model as will be explained classifying efficiency and partitioning parameters geographically spatially grouped according to hydroclimatic characteristics enables our model to be implemented in ungauged locations with assumed similarities in basin properties finally in section 5 we provide the summary and conclusions from the study 2 data description for this study we employed monthly time series of precipitation p potential evapotranspiration pet and streamflow q developed by vogel and sankarasubramanian 2005 for 1373 hydroclimatic data network hcdn watersheds hcdn watersheds are basins whose streamflow records are minimally affected by anthropogenic influences such as upstream storages land use changes or groundwater pumping slack et al 1993 martinez and gupta 2010 emphasized the importance of hcdn watersheds in estimating the various water balance parameters over the coterminous united states a detailed description of the development of the monthly precipitation and potential evapotranspiration time series for the hcdn watersheds can be found in vogel et al 1999 vogel and sankarasubramanian 2000 and sankarasubramanian and vogel 2005 2 1 streamflow data the hcdn database contains records of average daily streamflow for 1659 locations in the united states and its territories streamflow records range from 1874 to 1988 with an average record length of 44 years the following criteria were used for the review and quality control of the data 1 record lengths in excess of 20 years unless site location is underrepresented 2 accuracy ratings of records are at least good as defined by usgs standards 3 no overt adjustment of natural monthly streamflows by flow diversion groundwater pumping or other forms of regulation 4 only measured discharge values are tabulated reconstructed or estimated records are not used and 5 availability of data in electronic form for this study we considered streamflow data from 1952 to 1988 with catchments from the 48 contiguous states in the continental united states which resulted in a total of 1373 basins with 37 years of continuous daily streamflow observations 2 2 climate forcings data time series of monthly precipitation and average minimum and average maximum daily temperature for the continental united states were obtained for 37 years from the 1373 hcdn watersheds using 2 5 arc minute grids 4 km resolution based on the precipitation elevation regressions on independent slopes model prism climate analysis system daly et al 1994 prism uses a precipitation elevation regression relationship to distribute point measurements to evenly spaced grid cells prism is considered an improvement over other spatial interpolation methods such as inverse distance weighting or kriging because it attempts to account for orographic effects by using precipitation elevation regression functions and employs adiabatic lapse rate corrections in its temperature interpolations the monthly climate time series grids were spatially averaged over each hcdn basin using a geographic information system gis and a digital elevation map dem of the united states using the monthly time series of average minimum and average maximum temperature data along with extraterrestrial solar radiation estimates of monthly potential evapotranspiration were obtained hargreaves and samani 1982 extraterrestrial solar radiation was determined for each hcdn basin by computing the solar radiation over 0 1 arc minute grids duffie and beckman 1980 and then summing those estimates over the entire basin the hargreaves method was the highest ranked temperature based method for computing potential evapotranspiration reported in the american society of civil engineers asce manual 70 analysis jensen et al 1990 3 methods 3 1 zhang water balance model zwbm zhang et al 2008 have introduced a lumped conceptual water balance model that is applicable at finer time scales monthly to daily based on a generalization of budyko s demand supply limits framework budyko 1961 calder 1998 budyko s framework assumes that water availability approximated by precipitation and atmospheric demand approximated by the potential evapotranspiration control the steady state water balance of a basin based on these controls fu 1981 proposed the following empirical relationship for estimating the mean annual evapotranspiration 1 e t p 1 p e t p 1 p e t p 1 1 α 1 α e t p f p e t p α where e t p e t and p are mean annual catchment evapotranspiration potential evapotranspiration and precipitation respectively the parameter α conceptualized here as evapotranspiration efficiency assumes a value between 0 and 1 the greater the value of α the closer e t resembles p e t under humid conditions hence the mean annual moisture supply p transpires into the atmosphere at a fraction determined by the index of dryness p e t p and the efficiency parameter as mentioned above zhang et al 2008 applied this demand supply limit concept for water partitioning to account for the fluxes between storage control volumes and basin outflow at the monthly and daily time scales within an idealized catchment in particular rainwater is apportioned into components of direct runoff and total basin water retention and is followed by the division of catchment water availability into evapotranspiration soil moisture storage and recharge to groundwater storage thus a catchment contains two storage control volumes one sensitive to atmospheric forcing the soil moisture storage and a second less transient containment the groundwater storage the demand supply limit concept is applied on the rainwater retention component and the evapotranspiration opportunity the zwbm can be described as follows 1 rainfall pt for a given time step t is partitioned into direct runoff q t d and catchment rainfall retention xt i e the amount of rainfall retained by the catchment for evapotranspiration ett change in root zone soil moisture storage st s t 1 and ground water recharge rt 2 p t q t d x t the catchment rainfall retention xt is limited by the amount of rainfall pt under dry conditions and by the potential retention x t 0 the sum of available storage capacity smax s t 1 and potential evapotranspiration pett under wet conditions in other words when the catchment is very dry x t 0 p t it can retain all the rainwater pt and the direct runoff q t d is 0 when the catchment is very wet x t 0 0 it cannot retain any rainwater pt and the direct runoff q t d will equal rainfall at that time step zhang et al 2008 used this limiting criteria analogy to formulate catchment retention xt as 3 x t p t f x t 0 p t α 1 x t p t 1 x t 0 p t 1 x t 0 p t 1 1 α 1 1 α 1 where x t 0 s m a x s t 1 p e t t and α1 is the catchment retention efficiency a value between 0 and 1 larger smaller α1 value indicates more less retention by the catchment and less more direct runoff 2 for every time step t the available water in the catchment wt is defined as the sum of the initial storage s t 1 and the retained water xt 4 w t s t 1 x t the available water in the catchment wt can be partitioned into groundwater recharge rt evapotranspiration ett and remaining storage st in the root zone evapotranspiration ett can be estimated using budyko s limits framework with a supply limit of available water wt and demand limit of potential evapotranspiration pett as 5 e t t w t f p e t t w t α 2 e t t w t 1 p e t t w t 1 p e t t w t 1 1 α 2 1 α 2 note that while the demand limit in eq 5 remains unaltered pett the mean annual supply limit from budyko s original form pt is replaced by the water availability wt at sub annual time scales for the long term yearly water balance budyko 1961 makes the steady state assumption that gains and losses to the storage system are equilibrated this assumption is not valid at finer temporal resolutions and thus the zwbm incorporates st and rt into the dynamic relationship between energy and the moisture available for uptake into the atmosphere α 2 is the evapotranspiration efficiency the sum of evapotranspiration ett and remaining storage st in the root zone is defined as evapotranspiration opportunity yt the maximum water that can leave the basin as evapotranspiration at any given time t sankarasubramanian and vogel 2002 its lower bound is the available water in the catchment wt when the catchment is very dry the groundwater recharge rt is 0 and all available water wt is either lost to evaporation or held in the root zone as end of the time step storage on the other hand when the catchment is wet the evapotranspiration opportunity has an upper bound of the sum of maximum storage capacity smax and potential evapotranspiration pett based on these limits zhang et al 2008 formulated the catchment s evapotranspiration opportunity as 6 y t w t f s max p e t t w t α 2 y t w t 1 s max p e t t w t 1 s max p e t t w t 1 1 α 2 1 α 2 notice that the efficiency parameter α2 for both eqs 5 and 6 are the same to ensure that groundwater recharge rt is controlled by the evaporation efficiency α2 close to 1 indicates that the actual evapotranspiration equals potential evapotranspiration and the ground water recharge is 0 we can compute the end of the time step storage in the root zone using eqs 5 and 6 as 7 s t y t e t t 3 finally the zwbm assumes a linear relationship between groundwater storage gt and baseflow q t b and allows for the estimation of the second contribution to streamflow 8 g t 1 d g t 1 r t 9 q t b d g t 1 in eqs 8 and 9 d is a model parameter that determines the proportion of groundwater added to runoff each time step the total streamflow is obtained from the two components 10 q t q t d q t b for a more elaborate description of the zwbm please refer to zhang et al 2008 an examination of the above zwbm equations indicates that monthly streamflow qt can be estimated from the climate forcings pt and pett and the calibrated model efficiency parameter α1 and α2 baseflow parameter d and the maximum storage capacity smax hence we express monthly streamflow as 11 q t α 1 α 2 d s max f p t pe t t we implemented the four objective functions previously tested for streamflow reproducibility by the zwbm in australian watersheds zhang et al 2008 for calibrating the parameters to produce runoff closely resembling the observed data the objective functions are designed to emphasize the errors in both low flows and high flows account for time shifts in observed and predicted flows and to ensure the mass balance over the entire calibration period the optimization uses the constrained nonlinear multivariate function themathworksinc 2016 3 2 deriving the moments of monthly streamflow using the zwbm our objective in this study is to investigate the plausibility of estimating the mean and interannual variability of monthly streamflow using observable climate forcing precipitation and potential evapotranspiration for this purpose we attempted to derive the statistical moments mean and variance of the monthly streamflow from the zwmb formulation we considered the first two terms of the taylor series expansion of the zwbm and using this general form derived the expectation and variance of the monthly streamflow the major steps of this procedure are described below detailed derivations of ancillary state variables are provided in appendix a the general form of the truncated up to first derivative taylor series is given by 12 f x f a j 1 i f x i x j a i x j a j where i is the number of state variables in the function by substituting the streamflow function defined by the zwbm eq 11 into eq 12 and centering the function on the mean of the monthly precipitation and monthly potential evapotranspiration we have 13 q t p t p e t t q t p t p e t t q t p t p e t t p t p t p e t t p t p t q t p t p e t t p e t t p t p e t t p e t t p e t t in order to obtain an approximation of mean monthly runoff we take the expected value of eq 13 14 e q t p t p e t t e q t p t p e t t q t p t p e t t the variable subscript t assigns the month of interest and indicates the stochastic processes as functions of time for instance p1 refers to the random variable of precipitation for the month of october we follow the water year october to september system to reflect negligible storage in the basin at the beginning moreover p 1 indicates the mean monthly precipitation in october the first order terms in eq 13 drop since e q t p t p e t t p t p t p e t t p t p t q t p t p e t t p t p t p e t t e p t p t w h e r e e p t p t 0 a similar result holds for the partial derivative taken with respect to pett in an analogous fashion we can obtain an approximation for the variance in monthly streamflow by calculating the variance of eq 13 15 v a r q t p t p e t t q t p t p e t t p t p t p e t t 2 v a r p t q t p t p e t t p e t t p t p e t t 2 v a r p e t t 2 q t p t p e t t p t p t p e t t q t p t p e t t p e t t p t p e t t c o v p t p e t t in the case of the variance approximation the variance of the constant 0th order term is zero eq 15 indicates that the variance of monthly streamflow depends largely on the partial derivatives of qt with respect to pt and pett these partial derivatives qt pt pett pt and qt pt pett pett through application of the chain rule depend on xt pt and xt pett the expressions for the means of the ancillary state variables in eq 14 and the partial derivatives in eq 15 are provided in the appendix a hence we demonstrate an approach to approximate the mean monthly streamflow utilizing only the mean of the monthly precipitation data and the mean of the monthly potential evapotranspiration data the first order approximation of the variance in monthly streamflow similarly requires p t and p e t t input but additionally necessitates the monthly variances and covariance interaction between these two input variables 4 results and analysis 4 1 assessment of zwbm for select basins to assess the performance of our moments approximations and their ability to capture the annual trends in the observed streamflow we investigated the annual cycles of the mean and variance of five sample stations with varying hydroclimatic characteristics across the united states fig 1 the basins were chosen to help determine which moisture and energy dynamics are well captured or misrepresented by the zwbm table 1 provides information on the geographic location and the moisture and energy behavior of the chosen sites the mean and variance of monthly streamflow for the catchments in fig 1 were estimated using our approximations eqs 14 and 15 and the site specific calibrated parameters for the five catchments the mean monthly streamflow statistics calculated by the zwbm are shown as black and those obtained via our 0th order approximation are shown as black triangles displayed on the reversed secondary axis of fig 1 a f is a comparison between the observed simulated and approximated standard deviation in monthly streamflow for all five catchments presented in fig 1 the mean monthly streamflow statistics calculated by the zwbm and our 0th order approximation show close resemblance since the zwbm has been shown to accurately simulate observed runoff data for australian catchments zhang et al 2008 potter and zhang 2009 and our approximations of the mean monthly streamflow deviate only negligibly from the zwbm model values close reproducibility of the observed data in the u s is expected station elevation and latitude determine the basin s tendency to store winter precipitation as snow and release the melt water during the spring as the zwbm does not include a snowmelt component we expect it to misrepresent the winter and spring streamflow regimes for the high elevation basins and basins that are located in the northern u s for instance fig 1 a and b show the annual cycle of the mean and variance of the streamflow for a watershed located in the grand canyon in northern arizona at an elevation of 760 m and in new england respectively the zwbm used to estimate monthly streamflow data black clearly underestimates the mean observed streamflow in the spring further investigation shows that the site specific calibration of the model does well to represent q in january february and march months during which snow storage is expected to accumulate this moisture accumulation is manifested as delayed runoff during late april and may as is demonstrated in fig 1 a the zwbm is unable to reproduce this signal and instead resolves a nearly uniform annual streamflow distribution coherent with its precipitation pattern the low nash sutcliffe coefficient 0 19 obtained through a comparison of model simulated and observed streamflow data further underlines the weak predictive power of the model for high elevation basins similarly fig 1 b and c evaluate the performance of the zwbm in predicting the annual cycle of the runoff in a basins with snowfall these basins located in new england and the midwest conform to precipitation schedules that are either uniform or peak in june with limited moisture input during the winter months respectively nonetheless a pronounced spike in meltwater runoff is recorded in march resulting in a skewed calibration of the parameters and an inaccurate representation of the water storage interaction within the model the zwbm streamflow presented in fig 1 c overestimates the observed runoff in july and august as the retention efficiency α 1 is overestimated and the evaporation efficiency α 2 is underestimated thus even low values of snow accumulation can significantly impact the predictability of the zwbm the sample water catchments shown in fig 1 b d f have varying moisture and energy interactions all exhibit good performance as evaluated by the nash sutcliffe coefficient 0 60 fig 1 e presents the annual streamflow cycle of a basin governed by a uniform precipitation regime while the catchment in fig 1 b is located in connecticut and is moisture abundant semi humid the catchment in fig 1 e is located in arkansas and is moisture limited temperate in both cases the general trend of the mean monthly streamflow is well simulated by the zwbm with high nash sutcliffe coefficients of 0 77 and 0 82 respectively however we acknowledge that the zwbm is not able to capture some of the extremes in the mean monthly streamflow for the two basins as seen by the large bias in the streamflow calculations for the months of march and april soil conditions root zone storage vary from month to month and are sensitive to isolated flood and drought events they affect the sorptivity and percolation rates of a catchment seasonally changing catchment retention parameters can resolve these biases located near lake okeechobee in florida the catchment presented in fig 1 f follows a summer dominant precipitation regime and is semi humid here moisture and energy peaks occur in the same season requiring particularly sensitive tuning of the parameters that govern the partitioning of rainfall into evaporation runoff and infiltration it is vital that the model can accurately apportion the precipitation remaining after evaporation into its respective storage components because the zwbm incorporates two storage levels root zone storage and groundwater storage it possesses the ability to mediate the intricate connection between precipitation input and the catchment outflow for this catchment the zwbm explains 85 of the variability in the monthly streamflow data fig 1 d shows the annual streamflow cycle of a mississippi basin with dominant winter precipitation i e the moisture p and energy availability pet are out of phase under these hydroclimatic conditions the zwbm is best able to simulate the observed streamflow behavior achieving nash sutcliffe coefficients above 0 84 when p and pet are out of phase the moisture and energy controls assume a less interdependent association rainfall during the winter is only mildly affected by the low evaporative potential of the cold season temperatures while an abundant atmospheric moisture demand during the summer remains unsated by low precipitation input thus the hydroclimatology is substantially simplified with the streamflow regime closely following the precipitation regime for this reason the winter dominant precipitation cycles for low elevation catchments in wrr 17 and wrr 18 provide many basins for which the zwbm best explains the mean monthly streamflow the observed simulated and approximated standard deviation in monthly streamflow is displayed on the reversed secondary axis of fig 1 a e it is here clearly visible that while we capture the overall trend in the annual cycle for months with high variance in streamflow our 1st order approximations consistently overestimate the model simulated values we speculate that the bias between stdev q est standard deviation estimated from zwbm and stdev q apx standard deviation approximated from the taylor series expansion is rooted in the higher order terms of the taylor series excluded by our 1st order approximation nonetheless the observed monthly variance shows close resemblance to stdev q est and stdev q apx for catchments with good model performance i e high nash sutcliffe coefficient the principal motivation behind our study is to provide an approach to estimate the mean monthly streamflow and variance in monthly streamflow as obtained by the zwbm therefore we do not aim to revalidate the model s capability to simulate streamflow but instead wish to show that if the zwbm model performs aptly then our approximations are well suited to provide accurate estimates of the two statistical moments thus the remainder of our study evaluates our approximations only for basins with good model performance nash sutcliffe coefficient 0 60 we also set an elevation cutoff of 500 m for basins in water resources regions wrr 1 16 and 1 000 m for wrr 17 18 to mitigate adverse model performance due to the regular occurrence of snow storage the threshold for the western u s wrr 17 18 coast was raised to 1 000 m as the model shows robust simulations for elevations up to this threshold fig 2 b this selection gave us 405 basins for further evaluation the spatial distribution of the zwbm parameters nash sutcliffe coefficient and its relation to elevation for all the basins is shown in fig 2 the catchment retention efficiency α1 is highest in the eastern parts of the pacific northwest region 17 and the south atlantic gulf region 3 it is also high in region 6 the tennessee valley larger catchment retention indicates less direct runoff the basins in the western part the pacific northwest and new england region 1 have the lowest retention efficiency indicating more direct runoff in these catchments the evaporation efficiency α2 gradually increases as one moves from the eastern catchments to the mid western basins this observation is in line with the aridity index gradient of the country where the actual evaporation reaches the potential evapotranspiration as one goes from humid eastern catchments to semi arid to arid basins of the mid west the groundwater partitioning factor d is highest for basins in the eastern usa and gradually decreases for the basin in the mid west similarly the catchments far west of the pacific northwest and california regions have a high groundwater contribution factor the basins in the eastern parts of these regions have a low groundwater contribution the maximum storage capacity smax is highest for these basins 4 2 regional calibration of the zwbm parameters our approximations for the six stations described in the previous section maintain dependence on the calibration of four site specific parameters α1 α2 d and smax furthermore ungauged catchments and catchments deplete in observational streamflow data provide only limited reference information for calibration given our interest in adopting the model and the moments approximations for predictions in ungauged basins hrachowitz et al 2013 we seek regionally representative parameters for basins of similar hydroclimatic behavior hence our study continues by analyzing the calibrated parameter data for grouped basins across the continental united states we will show that it is reasonable to assume that basins with similar hydroclimatic classification wrr grouping should respond to catchment retention sensitivity α1 and atmospheric moisture uptake sensitivity α2 in a manner appropriate to the group s overall behavior however due to the strong influence of geography and heterogeneity in vertical and horizontal soil profiles the groundwater partitioning factor d and maximum soil moisture holding capacity smax vary substantially across regional basins to elucidate the marginal impacts of these latter two parameters on the resulting streamflow statistics and to evaluate the appropriateness of implementing regionalized values into our approximation equations we provide a comparison of the model s performance with the model results of a site specific parameterization in fig 3 we present boxplots of the four calibrated parameters α1 α2 d and smax grouped by water resources regions seaber et al 1987 having similar hydroclimatic behavior the respective median values are presented adjacent to the boxplots the range of calibrated α1 parameters for each region is between 0 1 and 0 2 with the median values around 0 6 fig 3 a indicating similar behavior in catchment retention efficiency for basins across the conterminous united states in other words the proportion of rainfall attributed to direct runoff and root zone soil moisture within the zwbm varies marginally throughout the country it is assumed that significant alterations in land use due to deforestation and human settlement impact retention efficiency since the hcdn basins are screened to limit anthropogenic influence we expect the calibrated α1 values to describe the catchments natural state well parameters close to 1 assume complete translation of rainfall into basin retention and parameters close to 0 assume complete translation of rainfall into direct runoff the narrow range of the parameter distributions validates our use of the median values as the regionalized parameter for all the catchments in the region for estimating the streamflow from the zwbm and the moments from our 0th and 1st order approximation we find similar results see fig 3 b for the regional distributions of α2 excluding regions 17 and 18 the distributions are centered on 0 6 with a small range however unlike α1 there is a slight upward trend in the evapotranspiration efficiency moving geographically from regions 1 to 10 thus the regional median of the calibrated parameters gradually increases from around 0 5 to 0 7 moving from east to west this general pattern is best explained by the interplay between the index of dryness and the coherency between precipitation and potential evapotranspiration seasonality in our previous study petersen et al 2012 we provided a comprehensive assessment of these two climatological process controls the mid and south atlantic geographic regions especially new england are governed by a humid and semi humid climate where precipitation events are distributed uniformly throughout the year here relatively abundant rainfall events a significant portion of which occurs in the winter months allow for more groundwater recharge and soil water retention than in the midwest colorado and gulf coast regions on the other hand in the far west several stations have indices of dryness where annual catchment energy supply has the theoretical potential to evaporate over three times the annual moisture supply moreover the proportion of rainfall occurring in the summer months coherent with seasonal energy influxes is substantially greater hence water if available is evaporated more readily in the midwest than along the more humid east coast this spatial variation in hydroclimatology produces a positive gradient in the α2 values from east to west the distribution of the calibrated α2 parameters for water resources regions 17 and 18 beckons further inspection the boxplots for these two regions across the pacific coast of the united states illustrate a large spread in the parameters again referring to our previous study petersen et al 2012 the annual climatology for stations within wrr 17 and 18 shows considerable variation for region 17 the dryness index p e t p varies from below 0 5 to above 3 0 as we move diagonally from northwest to southeast wrr 18 largely coinciding with the geographical location of california shows a similar range in the dryness index instigated by a positive gradient from north to south furthermore the pacific united states is the only portion of the country that exhibits a predominantly negative correlation between temporal distributions of moisture and energy i e precipitation occurs primarily during the winter it has been shown that an increase in mean annual energy supply distributed evenly across seasons in these regions increases potential evaporation throughout the year and in effect reduces runoff in the winter thus humid basins whose rainfall occurs predominantly during seasons deplete in energy show low extreme α2 values where almost none of the moisture reenters the atmosphere conversely the arid catchments of region 17 and 18 particularly in the southern portions of california supply abundant energy and can evaporate nearly all of the winter precipitation these conditions make regions 17 and 18 amenable to the large spread in the distribution of the calibrated α2 parameters besides we also acknowledge the potential for equifinality the existence of two or more parameter values producing similar maximization in model performance within our optimization procedure under such circumstances it is possible for calibrated parameters to assume values that are unrepresentative of the basin hydroclimatology this mathematical equivalence may have supplemented the broad range of the α 2 parameter in regions 17 and 18 we continue our discussion by evaluating the intra regional trends and dispersion of the optimized parameters for the ground water portioning factor d fig 3 c presents the boxplots of the parameter for each of the wrr regions we see a decreasing trend in d as we move from east to west wrr 1 to wrr 18 additionally we see that the northern catchments wrr 1 2 5 6 7 10 17 tend to release groundwater more readily than the southern catchments of similar longitude wrr 3 8 12 11 18 the northern southern catchments have higher lower median d values indicating more less groundwater contribution to further explain the spatial distribution of the baseflow behavior across the coterminous united states we direct the readers to the study conducted by santhi et al 2008 this study presents the geographical distribution of the baseflow index bfi percentage of streamflow composed of baseflow as estimated by wolock and mccabe 1999a 1999b one can easily draw parallels between the geographic locations of high baseflow contribution and high groundwater partitioning factor d the spatial data plotted by santhi et al 2008 depicts a high baseflow runoff contribution 50 particularly in the northwestern us and across the rocky mountain range spanning most of wrr 14 16 and 17 additional bfi coverage above 50 is witnessed along the eastern portions of central and northern california encompassing about half of wrr 18 streamflow in wrr 17 is derived nearly by proportions of d exceeding the 50 threshold on the other hand wrr 18 is bisected into an eastern area of high d values and a western area where the d is limited to 40 other regions exhibiting distributions of high groundwater partitioning factors and which have baseflows that have been shown to constitute large portions of annual streamflow include wrr 1 2 6 and 7 it is also of interest to note the existence of an extreme variation and heterogeneity in the baseflow contribution within wrr 2 and 3 this effect is mimicked by the broad range of our boxplots of d for these regions in fig 3 c while we can relate information about the hydrogeological characteristics of regions to the distribution of the groundwater partitioning factor the large range of the calibrated d parameters requires additional analysis to justify the use of its median statistic within our approximations additionally this analysis must include an understanding of how sensitive our approximations are to the soil moisture holding capacity smax and the α 2 as mentioned earlier wrr 17 and 18 which also exhibited a large spread fig 3 d presents the regional distribution of the calibrated soil moisture holding capacities smax calculation of the relation between the calibrated smax and d parameters exhibits a significant negative correlation 0 53 significant beyond the 0 01 level implying that the zwbm links characteristics of large small fractional baseflow contribution to low high soil moisture holding capacity similar to d smax relies heavily on the basin s soil profile which varies significantly from site to site thus while there is a close link for α 1 and α 2 to the region s climatic characteristics d and smax are less dependent on regionalized conditions and are highly reliant on the local geology and soil properties to assess the overall penalty of applying the median valued parameters to our approximations as opposed to using the site specific values fig 4 a and 4 b compares the results of the two parametric approaches in calculating the mean and the standard deviation respectively these nearly 1 to 1 plots reinforce the suitability of using the median valued parameters instead of the site specific values the high coefficients of determination 0 87 between the two approximations of the mean and 0 84 between the two approximations of the standard deviation verify that the overall variability in the statistical moments of the observed data is captured well nonetheless it must be pointed out that use of the regionalized parameters is most auspiciously applied during months of significant streamflow generation 4 3 month by month evaluation of the moments in this section we present the comparisons of observed moments mean and variance of monthly streamflow with the moments estimated from the simulated streamflows of the zwbm and the moments approximated by our eqs 14 and 15 405 hcdn stations that conform to our selection criteria of nash sutcliffe coefficient 0 6 with elevation 500 m in wrr 1 16 and nash sutcliffe coefficient 0 6 and elevation 1000 m in wrr 17 and 18 are presented here furthermore we used the regionalized parameters in the model and approximation equations for prediction fig 5 compares the observed and predicted values of mean streamflow for the months of october march similarly fig 6 compares the observed and predicted values of the mean streamflow for the months of april september in both figs 5 and 6 the predicted mean monthly streamflow from the zwbm is shown in blue colored square symbols and the predicted mean monthly streamflow from our approximations is shown in red color circles we observe that there is a good agreement between observed and predicted both from zwbm and our 0th order approximation mean streamflows for the months of january february march and april early spring season the agreement in these months is particularly high for the low streamflow values mean 100 mm month we also observe that for the high mean monthly flows there is a systematic under prediction from both the zwbm and our 0th order approximation recall that we are using regionalized parameters median of the distribution of all basins in the wrr for prediction in these basins and that the groundwater release parameter d and storage capacity smax have a large spread in the distribution across basins hence one can expect especially for watersheds dominated by groundwater release and storage components an under prediction of high monthly flows from the model an investigation of these stations i e stations having under prediction in high flows showed us that the actual catchment baseflow parameter d is much larger than the assumed median for the region indicating the heterogeneity in sub surface data and presence of local groundwater system wang et al 2015 for the months of may june and july we find that there is a larger spread around the 1 to 1 correspondence line with over prediction of the low flows and under prediction of high flows fig 7 compares the observed and predicted values of standard deviation of streamflow for the months of october march similarly fig 8 compares the observed and predicted values of the standard deviation of streamflow for the months of april september as in figs 5 and 6 the predicted standard deviation of monthly streamflow from the zwbm is shown in blue colored square symbols and the predicted standard deviation of monthly streamflow from our approximations is shown in red color circles we can see that except for the months of april and may the zwbm predicted standard deviation has good agreement with the observed standard deviation our 1st order approximation under predicts the low standard deviations for all the months but predicts the high standard deviation accurately this phenomenon can be explained partly by the fact that we choose only up to first derivative in the taylor series approximation higher order terms allow for a much smoother fit to the function thereby accurately estimating the variability from year to year we can also ascribe this phenomenon to the choice of regionalized parameters for predictions as we saw in the predictions for mean monthly flows overestimation underestimation of baseflow parameter or catchment storage capacity consistently produces more less monthly flows every year thereby creating wider tails for the distribution of monthly streamflow we compute the relative bias in predicting observed mean monthly flows and standard deviation of monthly flows using the our approximations for each basin for each month and present the monthly distributions in fig 9 we can see a low relative bias within 20 from the observed during january february march and april we can also see that for the months of june september there is a large spread of 50 as discussed above a use of local parameters for baseflow and storage capacity can improve the performance during these months fig 9 b presents the distributions of the relative bias in predicting the standard deviations of monthly streamflow using our 1st order approximation we can see that for all the months there is a negative relative bias in summary given the fact that we use regionalized parameters for the 405 stations across the united states we argue that our parsimonious approach for approximating the moments using eqs 14 and 15 provides reasonable estimates with low relative bias 5 summary this study focused on understanding and estimating the monthly hydroclimatology of coterminous united states with intent to develop quasi physical models that require limited no calibration towards this we derived analytical approximations for the mean and variance of monthly streamflows based on a physical water balance model zwbm mean variance and covariance information between precipitation and potential evapotranspiration along with basin characteristics and regionalized parameters of the zwbm models are the only inputs needed to estimate the moments of monthly streamflow thus the developed framework offers potential to estimate the moments of monthly runoff for ungauged basins evaluation of the zwbm and the developed semi empirical equations show good agreement in estimating mean monthly moments for low elevation basins consequently we selected 405 low elevation catchments and evaluated the performance of the semi empirical model in estimating the monthly moments using regionalized parameters analysis of the distributions of the calibrated model parameters indicate that basins within a hydroclimatic region have similar catchment retention sensitivity α1 and atmospheric moisture uptake sensitivity α2 the groundwater partitioning factor d and the maximum soil moisture holding capacity smax however varied substantially due to the strong influence of geography and heterogeneity in vertical and horizontal soil profiles the use of the median of the distributions as the regionalized parameters for all catchments still captures 87 of the variance in mean monthly streamflow and 84 of the variance in the standard deviation of the monthly flows indicating its suitability for prediction in ungauged basins it is important to note that these parameters estimation is based on full data record we have not done a cross validation on the parameters a comparison of observed and model both zwbm and our analytical model estimated monthly means indicates good agreement and low relative bias for the months of january february march and april high values of mean monthly flows have a systematic under prediction from both zwbm and our analytical model similarly comparison of observed and model estimated monthly standard deviation second moment show good agreement for all the months with the exception of may and june the analysis presented here is an important step towards better understanding the controls of monthly streamflow and towards the prediction in ungauged basins initiative together they play a significant role in water resources planning and management the developed expression also provides potential for developing models on elasticity of mean monthly runoff to mean monthly climatic inputs sankarasubramanian et al 2001 dooge et al 1999 developed elasticity of mean annual runoff to mean annual climatic inputs similar to that this study offers potential for developing expressions for estimating elasticity of mean monthly runoff to monthly climatic inputs it is important to understand that elasticity estimates are heavily dependent on the underlying structure sankarasubramanian et al 2001 which in this case is the zwbm since our interest is primarily mean monthly runoff we expect a lumped model such as zwbm should be sufficient we do not anticipate substantial differences in the estimates derived using a complex distributed model which primarily provide better performance for continuous runoff estimation as well as in estimating streamflow during extreme conditions comparison of the analytical expressions in estimating mean monthly runoff figs 5 and 6 with the observed and modeled mean monthly runoff shows relatively good agreement in all the months except during the summer months of june and july the zwbm simulated values tend to overestimate the observed flows whereas the zwbm approximation further overestimates in june and july over arid basins similarly comparison of the analytical expressions in estimating the standard deviation of monthly runoff with observed and model estimated values are in good agreement shows that model estimated values are in agreement for the months of november to march for basins having standard deviation of monthly runoff above 20 mm fig 7 during spring and summer months the analytical expression consistently underestimates the observed standard deviation of monthly runoff fig 8 which is partly due to the inability of the zwbm itself blue dots in estimating the observed interannual variability of summer flows in arid basins to summarize the proposed analytical approximations of mean monthly runoff and standard deviation of monthly runoff provide good agreement in most basins in all the months except during the summer months in initial land surface dominated basins ability of water balance models in estimating flows in arid basins is a well known issue abdulla and lettenmaier 1997 sankarasubramanian et al 2002 as it requires calibration of the model to other land surface attributes such as evapotranspiration and groundwater level yapo et al 1998 kuczera 1982 1983 parameters estimated with such multi objective optimization could be used in place of the parameters estimated using streamflow alone we intend to consider such refinements as part of our future effort related to the usgs powell center funded global synthesis on budyko s framework https powellcenter usgs gov view project 59a062cfe4b038630d03054b acknowledgments this research was supported by a nsf grant 1360446 water sustainability and climate category 3 b nsf grant 0954405 career award for the third author c nsf grant 1204368 water sustainability and climate category 3 the statements contained within the manuscript research article are not the opinions of the funding agency or the u s government but reflect the authors opinions data used in this research are available from a the monthly climate data for the hcdn sites are available from the oak ridge national laboratory distributed active archive center https daac ornl gov hydroclimatology guides hcdn monthly hydroclim html b the streamflow data is available from u s geological survey usgs https pubs usgs gov wri wri934076 1st page html the model output data are available from the authors upon request appendix a in the following we detail the derivation of the 0th order taylor series approximation of mean monthly runoff as calculated by the zhang et al 2008 water balance model a1 q p t p e t t d g t 1 p t x t a2 g t 1 d g t 1 r t a3 r t w t y t a4 s t y t e t a5 e t w t f p e t t w t α 2 a6 y t w t f s max p e t t w t α 2 a7 w t x t s t 1 a8 x t p t f x 0 t p t α 1 a9 x 0 t s m a x s t 1 p e t t since q t g t r t s t e t y t w t x t and x 0 t are all functions of p t p e t t our model merely necessitates data on the mean monthly precipitation and mean monthly potential evapotranspiration in order to approximate the mean monthly runoff an iterative procedure was used to find appropriate values for the storage components s 1 and g 1 at t 0 i e the soil moisture and groundwater components expected at the end of september the 1st order taylor series approximation of the variance in mean monthly runoff was calculated via the zwbm using eq 15 and the relations detailed below partial derivative of monthly runoff qt with respect to the corresponding monthly precipitation pt a10 q t p t 1 x t p t a11 x t p t 1 1 x 0 t p t 1 1 α 1 1 α 1 x 0 t p t 1 1 α 1 1 x 0 t p t 1 1 α 1 α 1 partial derivative of monthly runoff qt with respect to the corresponding monthly potential evapotranspiration pett a12 q t p e t t x t p e t t a13 x t p e t t 1 1 x 0 t p t 1 1 α 1 α 1 x 0 t p t α 1 1 α 1 here it must be remarked that the partial derivatives at the current time step cannot depend on the groundwater and soil moisture storage components of the previous time step this leads to the simply expressions above supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2018 02 010 appendix b supplementary materials image application 1 
848,physical semi empirical models that do not require any calibration are of paramount need for estimating hydrological fluxes for ungauged sites we develop semi empirical models for estimating the mean and variance of the monthly streamflow based on taylor series approximation of a lumped physically based water balance model the proposed models require mean and variance of monthly precipitation and potential evapotranspiration co variability of precipitation and potential evapotranspiration and regionally calibrated catchment retention sensitivity atmospheric moisture uptake sensitivity groundwater partitioning factor and the maximum soil moisture holding capacity parameters estimates of mean and variance of monthly streamflow using the semi empirical equations are compared with the observed estimates for 1373 catchments in the continental united states analyses show that the proposed models explain the spatial variability in monthly moments for basins in lower elevations a regionalization of parameters for each water resources region show good agreement between observed moments and model estimated moments during january february march and april for mean and all months except may and june for variance thus the proposed relationships could be employed for understanding and estimating the monthly hydroclimatology of ungauged basins using regional parameters keywords hydroclimatology prediction in ungauged basins physical water balance model monthly moments 1 introduction the partitioning of precipitation into evaporation and streamflow a fundamental aspect of understanding the hydroclimatology of the region is governed by the dynamic processes of atmosphere and surface and sub surface moisture interactions seasonality of precipitation and temperature heterogeneity in the land surface and sub surface data and varying basin characteristics all complicate the task of understanding this partitioning milly et al 1994a b petersen et al 2012 this fundamental understanding provides opportunities for developing semi empirical models that estimate mean annual monthly runoff purely based on climatic information and basin characteristics since these models require no calibration they can also be applied in ungauged basins for developing first order estimates of mean monthly land surface fluxes which provides critical information for water resources planning and management numerous studies have focused on developing physical or semi empirical relationships to explain the annual hydroclimatology of a region schreiber 1904 ol dekop 1911 budyko 1974 milly 1994a 1994b wolock and mccabe 1999a 1999b zhang et al 2001 yang et al 2008 donohue et al 2010 milly 1994a incorporated the seasonality in precipitation and potential evapotranspiration on the annual water balance woods 2003 has developed analytical models for seasonality and annual water balance of a catchment potter et al 2005 and hickel and zhang 2006 have also analyzed the impact of rainfall seasonality on mean annual water balance however there is limited no models available that provide estimates of mean and variance of monthly runoff purely based on climate and basin characteristics farmer et al 2003 explored the role of climate and landscape interactions in explaining the annual monthly and daily water balance of several arid basins yokoo et al 2008 explored the effects of seasonal variability of climate on mean annual and monthly water balances based on a physically based hill slope model petersen et al 2012 explained how the co occurrence of moisture and energy availability in phase and out of phase seasonality between precipitation and temperature can control the mean monthly runoff over the coterminous united states the objective of this study is to develop a physical model that estimates mean monthly runoff and variability of monthly runoff based on mean monthly precipitation mean monthly potential evapotranspiration and basin characteristics an allied goal is to evaluate the developed model in explaining the spatial variability in mean monthly runoff and variance of monthly runoff over the coterminous united states towards this we consider a lumped watershed model that is parsimonious in parameterization for deriving the expressions for mean monthly and variance of monthly runoff at the annual scale milly 1994b used a conceptual water balance model to identify several dimensionless parameters that influence the partitioning of rainfall into evapotranspiration and streamflow that is the first effort that developed a physical model extending budyko s framework for estimating mean annual runoff based on aridity ratio soil moisture storage capacity seasonality of moisture and energy variations and storm arrival rate koster and suarez 1999 implemented budyko s framework to investigate the implication of anomalous annual precipitation totals on evaporation and runoff behavior within this context they provide a single input function able to predict the ratio of the standard deviations in interannual evaporation and precipitation using only the index of dryness their approach is simple adhering to model parsimony yet sufficient at explaining basic hydroclimatic statistics of yearly data sankarasubramanian and vogel 2002 proposed similar approach by deriving approximations of a lumped watershed model for explaining the mean annual runoff and interannual variability of annual streamflow in the hydroclimatic data network hcdn basins over the coterminous united states recently sivapalan et al 2011 demonstrated the congruence in trends between spatial and temporal variability for key precipitation and groundwater partitioning factors their study which analyzed the horton index baseflow fraction vaporization fraction and runoff fraction metrics for coterminous united states basins showed similarity in the behavior of mean annual water balance variability between 377 catchments and variability in annual flows for 12 catchments over a 50 year period they however acknowledged that the interannual variability and responses to individual years were not well represented indicating the unexplained phenomena of within year and within catchment variability of climatic inputs and their interactions with landscape properties extending these parsimonious models to monthly time scale requires consideration of several additional processes zhang et al 2008 adopted a top down approach sivapalan et al 2003 to extrapolate the application of budyko s curve 1961 to two critical partitions of the water cycle at sub annual scale their approach entails using the primary controls climate to explain the catchment behavior and including secondary controls basin soil moisture dynamics only if deemed necessary extending budyko s framework of demand supply relationships for various layers in the water balance model this water balance model adds additional complexities for estimating runoff at multiple time scales thus the zhang s water balance model zwbm proposes a parsimonious approach in extending budyko s framework for estimating runoff over various time scales and our work builds on to develop approximations to moments of monthly streamflow precipitation events are divided into catchment rainfall retention and direct runoff and catchment water availability is divided into evapotranspiration soil moisture storage and groundwater recharge for extending the water balance model to be flexible at monthly and daily time scales these variables in combination with four efficiency and partitioning parameters conceptualize the influxes and effluxes of soil moisture and groundwater storages according to the limits concept while many watershed models have been developed to simulate monthly runoff based on detailed calibration there are no parsimonious physical models that estimate mean and variance of monthly streamflow for ungauged basins we employ the zwbm to derive taylor s series approximations of mean monthly streamflow and variance in monthly streamflow we focus on obtaining the first two statistical moments of monthly streamflow utilizing mean variance and covariance information between precipitation and potential evapotranspiration climate forcings with additional parameters which are estimated regionally describing the basins response the proposed framework could potentially estimate the first two moments of monthly runoff for ungauged basins with minimal input the rest of the paper is organized in the following manner first we provide a description of the geographic extent of our study sites and give information on the data sources and their methods of measurement in section 2 we present an overview of the zwbm and introduce our derivation of the taylor series approximations for the mean and variance in monthly streamflow in section 3 we also assess the performance of our approximation equations through comparison with zwbm obtained statistics and our observed dataset in section 4 we analyze and describe the utility of the regionalized parameterization of our model as will be explained classifying efficiency and partitioning parameters geographically spatially grouped according to hydroclimatic characteristics enables our model to be implemented in ungauged locations with assumed similarities in basin properties finally in section 5 we provide the summary and conclusions from the study 2 data description for this study we employed monthly time series of precipitation p potential evapotranspiration pet and streamflow q developed by vogel and sankarasubramanian 2005 for 1373 hydroclimatic data network hcdn watersheds hcdn watersheds are basins whose streamflow records are minimally affected by anthropogenic influences such as upstream storages land use changes or groundwater pumping slack et al 1993 martinez and gupta 2010 emphasized the importance of hcdn watersheds in estimating the various water balance parameters over the coterminous united states a detailed description of the development of the monthly precipitation and potential evapotranspiration time series for the hcdn watersheds can be found in vogel et al 1999 vogel and sankarasubramanian 2000 and sankarasubramanian and vogel 2005 2 1 streamflow data the hcdn database contains records of average daily streamflow for 1659 locations in the united states and its territories streamflow records range from 1874 to 1988 with an average record length of 44 years the following criteria were used for the review and quality control of the data 1 record lengths in excess of 20 years unless site location is underrepresented 2 accuracy ratings of records are at least good as defined by usgs standards 3 no overt adjustment of natural monthly streamflows by flow diversion groundwater pumping or other forms of regulation 4 only measured discharge values are tabulated reconstructed or estimated records are not used and 5 availability of data in electronic form for this study we considered streamflow data from 1952 to 1988 with catchments from the 48 contiguous states in the continental united states which resulted in a total of 1373 basins with 37 years of continuous daily streamflow observations 2 2 climate forcings data time series of monthly precipitation and average minimum and average maximum daily temperature for the continental united states were obtained for 37 years from the 1373 hcdn watersheds using 2 5 arc minute grids 4 km resolution based on the precipitation elevation regressions on independent slopes model prism climate analysis system daly et al 1994 prism uses a precipitation elevation regression relationship to distribute point measurements to evenly spaced grid cells prism is considered an improvement over other spatial interpolation methods such as inverse distance weighting or kriging because it attempts to account for orographic effects by using precipitation elevation regression functions and employs adiabatic lapse rate corrections in its temperature interpolations the monthly climate time series grids were spatially averaged over each hcdn basin using a geographic information system gis and a digital elevation map dem of the united states using the monthly time series of average minimum and average maximum temperature data along with extraterrestrial solar radiation estimates of monthly potential evapotranspiration were obtained hargreaves and samani 1982 extraterrestrial solar radiation was determined for each hcdn basin by computing the solar radiation over 0 1 arc minute grids duffie and beckman 1980 and then summing those estimates over the entire basin the hargreaves method was the highest ranked temperature based method for computing potential evapotranspiration reported in the american society of civil engineers asce manual 70 analysis jensen et al 1990 3 methods 3 1 zhang water balance model zwbm zhang et al 2008 have introduced a lumped conceptual water balance model that is applicable at finer time scales monthly to daily based on a generalization of budyko s demand supply limits framework budyko 1961 calder 1998 budyko s framework assumes that water availability approximated by precipitation and atmospheric demand approximated by the potential evapotranspiration control the steady state water balance of a basin based on these controls fu 1981 proposed the following empirical relationship for estimating the mean annual evapotranspiration 1 e t p 1 p e t p 1 p e t p 1 1 α 1 α e t p f p e t p α where e t p e t and p are mean annual catchment evapotranspiration potential evapotranspiration and precipitation respectively the parameter α conceptualized here as evapotranspiration efficiency assumes a value between 0 and 1 the greater the value of α the closer e t resembles p e t under humid conditions hence the mean annual moisture supply p transpires into the atmosphere at a fraction determined by the index of dryness p e t p and the efficiency parameter as mentioned above zhang et al 2008 applied this demand supply limit concept for water partitioning to account for the fluxes between storage control volumes and basin outflow at the monthly and daily time scales within an idealized catchment in particular rainwater is apportioned into components of direct runoff and total basin water retention and is followed by the division of catchment water availability into evapotranspiration soil moisture storage and recharge to groundwater storage thus a catchment contains two storage control volumes one sensitive to atmospheric forcing the soil moisture storage and a second less transient containment the groundwater storage the demand supply limit concept is applied on the rainwater retention component and the evapotranspiration opportunity the zwbm can be described as follows 1 rainfall pt for a given time step t is partitioned into direct runoff q t d and catchment rainfall retention xt i e the amount of rainfall retained by the catchment for evapotranspiration ett change in root zone soil moisture storage st s t 1 and ground water recharge rt 2 p t q t d x t the catchment rainfall retention xt is limited by the amount of rainfall pt under dry conditions and by the potential retention x t 0 the sum of available storage capacity smax s t 1 and potential evapotranspiration pett under wet conditions in other words when the catchment is very dry x t 0 p t it can retain all the rainwater pt and the direct runoff q t d is 0 when the catchment is very wet x t 0 0 it cannot retain any rainwater pt and the direct runoff q t d will equal rainfall at that time step zhang et al 2008 used this limiting criteria analogy to formulate catchment retention xt as 3 x t p t f x t 0 p t α 1 x t p t 1 x t 0 p t 1 x t 0 p t 1 1 α 1 1 α 1 where x t 0 s m a x s t 1 p e t t and α1 is the catchment retention efficiency a value between 0 and 1 larger smaller α1 value indicates more less retention by the catchment and less more direct runoff 2 for every time step t the available water in the catchment wt is defined as the sum of the initial storage s t 1 and the retained water xt 4 w t s t 1 x t the available water in the catchment wt can be partitioned into groundwater recharge rt evapotranspiration ett and remaining storage st in the root zone evapotranspiration ett can be estimated using budyko s limits framework with a supply limit of available water wt and demand limit of potential evapotranspiration pett as 5 e t t w t f p e t t w t α 2 e t t w t 1 p e t t w t 1 p e t t w t 1 1 α 2 1 α 2 note that while the demand limit in eq 5 remains unaltered pett the mean annual supply limit from budyko s original form pt is replaced by the water availability wt at sub annual time scales for the long term yearly water balance budyko 1961 makes the steady state assumption that gains and losses to the storage system are equilibrated this assumption is not valid at finer temporal resolutions and thus the zwbm incorporates st and rt into the dynamic relationship between energy and the moisture available for uptake into the atmosphere α 2 is the evapotranspiration efficiency the sum of evapotranspiration ett and remaining storage st in the root zone is defined as evapotranspiration opportunity yt the maximum water that can leave the basin as evapotranspiration at any given time t sankarasubramanian and vogel 2002 its lower bound is the available water in the catchment wt when the catchment is very dry the groundwater recharge rt is 0 and all available water wt is either lost to evaporation or held in the root zone as end of the time step storage on the other hand when the catchment is wet the evapotranspiration opportunity has an upper bound of the sum of maximum storage capacity smax and potential evapotranspiration pett based on these limits zhang et al 2008 formulated the catchment s evapotranspiration opportunity as 6 y t w t f s max p e t t w t α 2 y t w t 1 s max p e t t w t 1 s max p e t t w t 1 1 α 2 1 α 2 notice that the efficiency parameter α2 for both eqs 5 and 6 are the same to ensure that groundwater recharge rt is controlled by the evaporation efficiency α2 close to 1 indicates that the actual evapotranspiration equals potential evapotranspiration and the ground water recharge is 0 we can compute the end of the time step storage in the root zone using eqs 5 and 6 as 7 s t y t e t t 3 finally the zwbm assumes a linear relationship between groundwater storage gt and baseflow q t b and allows for the estimation of the second contribution to streamflow 8 g t 1 d g t 1 r t 9 q t b d g t 1 in eqs 8 and 9 d is a model parameter that determines the proportion of groundwater added to runoff each time step the total streamflow is obtained from the two components 10 q t q t d q t b for a more elaborate description of the zwbm please refer to zhang et al 2008 an examination of the above zwbm equations indicates that monthly streamflow qt can be estimated from the climate forcings pt and pett and the calibrated model efficiency parameter α1 and α2 baseflow parameter d and the maximum storage capacity smax hence we express monthly streamflow as 11 q t α 1 α 2 d s max f p t pe t t we implemented the four objective functions previously tested for streamflow reproducibility by the zwbm in australian watersheds zhang et al 2008 for calibrating the parameters to produce runoff closely resembling the observed data the objective functions are designed to emphasize the errors in both low flows and high flows account for time shifts in observed and predicted flows and to ensure the mass balance over the entire calibration period the optimization uses the constrained nonlinear multivariate function themathworksinc 2016 3 2 deriving the moments of monthly streamflow using the zwbm our objective in this study is to investigate the plausibility of estimating the mean and interannual variability of monthly streamflow using observable climate forcing precipitation and potential evapotranspiration for this purpose we attempted to derive the statistical moments mean and variance of the monthly streamflow from the zwmb formulation we considered the first two terms of the taylor series expansion of the zwbm and using this general form derived the expectation and variance of the monthly streamflow the major steps of this procedure are described below detailed derivations of ancillary state variables are provided in appendix a the general form of the truncated up to first derivative taylor series is given by 12 f x f a j 1 i f x i x j a i x j a j where i is the number of state variables in the function by substituting the streamflow function defined by the zwbm eq 11 into eq 12 and centering the function on the mean of the monthly precipitation and monthly potential evapotranspiration we have 13 q t p t p e t t q t p t p e t t q t p t p e t t p t p t p e t t p t p t q t p t p e t t p e t t p t p e t t p e t t p e t t in order to obtain an approximation of mean monthly runoff we take the expected value of eq 13 14 e q t p t p e t t e q t p t p e t t q t p t p e t t the variable subscript t assigns the month of interest and indicates the stochastic processes as functions of time for instance p1 refers to the random variable of precipitation for the month of october we follow the water year october to september system to reflect negligible storage in the basin at the beginning moreover p 1 indicates the mean monthly precipitation in october the first order terms in eq 13 drop since e q t p t p e t t p t p t p e t t p t p t q t p t p e t t p t p t p e t t e p t p t w h e r e e p t p t 0 a similar result holds for the partial derivative taken with respect to pett in an analogous fashion we can obtain an approximation for the variance in monthly streamflow by calculating the variance of eq 13 15 v a r q t p t p e t t q t p t p e t t p t p t p e t t 2 v a r p t q t p t p e t t p e t t p t p e t t 2 v a r p e t t 2 q t p t p e t t p t p t p e t t q t p t p e t t p e t t p t p e t t c o v p t p e t t in the case of the variance approximation the variance of the constant 0th order term is zero eq 15 indicates that the variance of monthly streamflow depends largely on the partial derivatives of qt with respect to pt and pett these partial derivatives qt pt pett pt and qt pt pett pett through application of the chain rule depend on xt pt and xt pett the expressions for the means of the ancillary state variables in eq 14 and the partial derivatives in eq 15 are provided in the appendix a hence we demonstrate an approach to approximate the mean monthly streamflow utilizing only the mean of the monthly precipitation data and the mean of the monthly potential evapotranspiration data the first order approximation of the variance in monthly streamflow similarly requires p t and p e t t input but additionally necessitates the monthly variances and covariance interaction between these two input variables 4 results and analysis 4 1 assessment of zwbm for select basins to assess the performance of our moments approximations and their ability to capture the annual trends in the observed streamflow we investigated the annual cycles of the mean and variance of five sample stations with varying hydroclimatic characteristics across the united states fig 1 the basins were chosen to help determine which moisture and energy dynamics are well captured or misrepresented by the zwbm table 1 provides information on the geographic location and the moisture and energy behavior of the chosen sites the mean and variance of monthly streamflow for the catchments in fig 1 were estimated using our approximations eqs 14 and 15 and the site specific calibrated parameters for the five catchments the mean monthly streamflow statistics calculated by the zwbm are shown as black and those obtained via our 0th order approximation are shown as black triangles displayed on the reversed secondary axis of fig 1 a f is a comparison between the observed simulated and approximated standard deviation in monthly streamflow for all five catchments presented in fig 1 the mean monthly streamflow statistics calculated by the zwbm and our 0th order approximation show close resemblance since the zwbm has been shown to accurately simulate observed runoff data for australian catchments zhang et al 2008 potter and zhang 2009 and our approximations of the mean monthly streamflow deviate only negligibly from the zwbm model values close reproducibility of the observed data in the u s is expected station elevation and latitude determine the basin s tendency to store winter precipitation as snow and release the melt water during the spring as the zwbm does not include a snowmelt component we expect it to misrepresent the winter and spring streamflow regimes for the high elevation basins and basins that are located in the northern u s for instance fig 1 a and b show the annual cycle of the mean and variance of the streamflow for a watershed located in the grand canyon in northern arizona at an elevation of 760 m and in new england respectively the zwbm used to estimate monthly streamflow data black clearly underestimates the mean observed streamflow in the spring further investigation shows that the site specific calibration of the model does well to represent q in january february and march months during which snow storage is expected to accumulate this moisture accumulation is manifested as delayed runoff during late april and may as is demonstrated in fig 1 a the zwbm is unable to reproduce this signal and instead resolves a nearly uniform annual streamflow distribution coherent with its precipitation pattern the low nash sutcliffe coefficient 0 19 obtained through a comparison of model simulated and observed streamflow data further underlines the weak predictive power of the model for high elevation basins similarly fig 1 b and c evaluate the performance of the zwbm in predicting the annual cycle of the runoff in a basins with snowfall these basins located in new england and the midwest conform to precipitation schedules that are either uniform or peak in june with limited moisture input during the winter months respectively nonetheless a pronounced spike in meltwater runoff is recorded in march resulting in a skewed calibration of the parameters and an inaccurate representation of the water storage interaction within the model the zwbm streamflow presented in fig 1 c overestimates the observed runoff in july and august as the retention efficiency α 1 is overestimated and the evaporation efficiency α 2 is underestimated thus even low values of snow accumulation can significantly impact the predictability of the zwbm the sample water catchments shown in fig 1 b d f have varying moisture and energy interactions all exhibit good performance as evaluated by the nash sutcliffe coefficient 0 60 fig 1 e presents the annual streamflow cycle of a basin governed by a uniform precipitation regime while the catchment in fig 1 b is located in connecticut and is moisture abundant semi humid the catchment in fig 1 e is located in arkansas and is moisture limited temperate in both cases the general trend of the mean monthly streamflow is well simulated by the zwbm with high nash sutcliffe coefficients of 0 77 and 0 82 respectively however we acknowledge that the zwbm is not able to capture some of the extremes in the mean monthly streamflow for the two basins as seen by the large bias in the streamflow calculations for the months of march and april soil conditions root zone storage vary from month to month and are sensitive to isolated flood and drought events they affect the sorptivity and percolation rates of a catchment seasonally changing catchment retention parameters can resolve these biases located near lake okeechobee in florida the catchment presented in fig 1 f follows a summer dominant precipitation regime and is semi humid here moisture and energy peaks occur in the same season requiring particularly sensitive tuning of the parameters that govern the partitioning of rainfall into evaporation runoff and infiltration it is vital that the model can accurately apportion the precipitation remaining after evaporation into its respective storage components because the zwbm incorporates two storage levels root zone storage and groundwater storage it possesses the ability to mediate the intricate connection between precipitation input and the catchment outflow for this catchment the zwbm explains 85 of the variability in the monthly streamflow data fig 1 d shows the annual streamflow cycle of a mississippi basin with dominant winter precipitation i e the moisture p and energy availability pet are out of phase under these hydroclimatic conditions the zwbm is best able to simulate the observed streamflow behavior achieving nash sutcliffe coefficients above 0 84 when p and pet are out of phase the moisture and energy controls assume a less interdependent association rainfall during the winter is only mildly affected by the low evaporative potential of the cold season temperatures while an abundant atmospheric moisture demand during the summer remains unsated by low precipitation input thus the hydroclimatology is substantially simplified with the streamflow regime closely following the precipitation regime for this reason the winter dominant precipitation cycles for low elevation catchments in wrr 17 and wrr 18 provide many basins for which the zwbm best explains the mean monthly streamflow the observed simulated and approximated standard deviation in monthly streamflow is displayed on the reversed secondary axis of fig 1 a e it is here clearly visible that while we capture the overall trend in the annual cycle for months with high variance in streamflow our 1st order approximations consistently overestimate the model simulated values we speculate that the bias between stdev q est standard deviation estimated from zwbm and stdev q apx standard deviation approximated from the taylor series expansion is rooted in the higher order terms of the taylor series excluded by our 1st order approximation nonetheless the observed monthly variance shows close resemblance to stdev q est and stdev q apx for catchments with good model performance i e high nash sutcliffe coefficient the principal motivation behind our study is to provide an approach to estimate the mean monthly streamflow and variance in monthly streamflow as obtained by the zwbm therefore we do not aim to revalidate the model s capability to simulate streamflow but instead wish to show that if the zwbm model performs aptly then our approximations are well suited to provide accurate estimates of the two statistical moments thus the remainder of our study evaluates our approximations only for basins with good model performance nash sutcliffe coefficient 0 60 we also set an elevation cutoff of 500 m for basins in water resources regions wrr 1 16 and 1 000 m for wrr 17 18 to mitigate adverse model performance due to the regular occurrence of snow storage the threshold for the western u s wrr 17 18 coast was raised to 1 000 m as the model shows robust simulations for elevations up to this threshold fig 2 b this selection gave us 405 basins for further evaluation the spatial distribution of the zwbm parameters nash sutcliffe coefficient and its relation to elevation for all the basins is shown in fig 2 the catchment retention efficiency α1 is highest in the eastern parts of the pacific northwest region 17 and the south atlantic gulf region 3 it is also high in region 6 the tennessee valley larger catchment retention indicates less direct runoff the basins in the western part the pacific northwest and new england region 1 have the lowest retention efficiency indicating more direct runoff in these catchments the evaporation efficiency α2 gradually increases as one moves from the eastern catchments to the mid western basins this observation is in line with the aridity index gradient of the country where the actual evaporation reaches the potential evapotranspiration as one goes from humid eastern catchments to semi arid to arid basins of the mid west the groundwater partitioning factor d is highest for basins in the eastern usa and gradually decreases for the basin in the mid west similarly the catchments far west of the pacific northwest and california regions have a high groundwater contribution factor the basins in the eastern parts of these regions have a low groundwater contribution the maximum storage capacity smax is highest for these basins 4 2 regional calibration of the zwbm parameters our approximations for the six stations described in the previous section maintain dependence on the calibration of four site specific parameters α1 α2 d and smax furthermore ungauged catchments and catchments deplete in observational streamflow data provide only limited reference information for calibration given our interest in adopting the model and the moments approximations for predictions in ungauged basins hrachowitz et al 2013 we seek regionally representative parameters for basins of similar hydroclimatic behavior hence our study continues by analyzing the calibrated parameter data for grouped basins across the continental united states we will show that it is reasonable to assume that basins with similar hydroclimatic classification wrr grouping should respond to catchment retention sensitivity α1 and atmospheric moisture uptake sensitivity α2 in a manner appropriate to the group s overall behavior however due to the strong influence of geography and heterogeneity in vertical and horizontal soil profiles the groundwater partitioning factor d and maximum soil moisture holding capacity smax vary substantially across regional basins to elucidate the marginal impacts of these latter two parameters on the resulting streamflow statistics and to evaluate the appropriateness of implementing regionalized values into our approximation equations we provide a comparison of the model s performance with the model results of a site specific parameterization in fig 3 we present boxplots of the four calibrated parameters α1 α2 d and smax grouped by water resources regions seaber et al 1987 having similar hydroclimatic behavior the respective median values are presented adjacent to the boxplots the range of calibrated α1 parameters for each region is between 0 1 and 0 2 with the median values around 0 6 fig 3 a indicating similar behavior in catchment retention efficiency for basins across the conterminous united states in other words the proportion of rainfall attributed to direct runoff and root zone soil moisture within the zwbm varies marginally throughout the country it is assumed that significant alterations in land use due to deforestation and human settlement impact retention efficiency since the hcdn basins are screened to limit anthropogenic influence we expect the calibrated α1 values to describe the catchments natural state well parameters close to 1 assume complete translation of rainfall into basin retention and parameters close to 0 assume complete translation of rainfall into direct runoff the narrow range of the parameter distributions validates our use of the median values as the regionalized parameter for all the catchments in the region for estimating the streamflow from the zwbm and the moments from our 0th and 1st order approximation we find similar results see fig 3 b for the regional distributions of α2 excluding regions 17 and 18 the distributions are centered on 0 6 with a small range however unlike α1 there is a slight upward trend in the evapotranspiration efficiency moving geographically from regions 1 to 10 thus the regional median of the calibrated parameters gradually increases from around 0 5 to 0 7 moving from east to west this general pattern is best explained by the interplay between the index of dryness and the coherency between precipitation and potential evapotranspiration seasonality in our previous study petersen et al 2012 we provided a comprehensive assessment of these two climatological process controls the mid and south atlantic geographic regions especially new england are governed by a humid and semi humid climate where precipitation events are distributed uniformly throughout the year here relatively abundant rainfall events a significant portion of which occurs in the winter months allow for more groundwater recharge and soil water retention than in the midwest colorado and gulf coast regions on the other hand in the far west several stations have indices of dryness where annual catchment energy supply has the theoretical potential to evaporate over three times the annual moisture supply moreover the proportion of rainfall occurring in the summer months coherent with seasonal energy influxes is substantially greater hence water if available is evaporated more readily in the midwest than along the more humid east coast this spatial variation in hydroclimatology produces a positive gradient in the α2 values from east to west the distribution of the calibrated α2 parameters for water resources regions 17 and 18 beckons further inspection the boxplots for these two regions across the pacific coast of the united states illustrate a large spread in the parameters again referring to our previous study petersen et al 2012 the annual climatology for stations within wrr 17 and 18 shows considerable variation for region 17 the dryness index p e t p varies from below 0 5 to above 3 0 as we move diagonally from northwest to southeast wrr 18 largely coinciding with the geographical location of california shows a similar range in the dryness index instigated by a positive gradient from north to south furthermore the pacific united states is the only portion of the country that exhibits a predominantly negative correlation between temporal distributions of moisture and energy i e precipitation occurs primarily during the winter it has been shown that an increase in mean annual energy supply distributed evenly across seasons in these regions increases potential evaporation throughout the year and in effect reduces runoff in the winter thus humid basins whose rainfall occurs predominantly during seasons deplete in energy show low extreme α2 values where almost none of the moisture reenters the atmosphere conversely the arid catchments of region 17 and 18 particularly in the southern portions of california supply abundant energy and can evaporate nearly all of the winter precipitation these conditions make regions 17 and 18 amenable to the large spread in the distribution of the calibrated α2 parameters besides we also acknowledge the potential for equifinality the existence of two or more parameter values producing similar maximization in model performance within our optimization procedure under such circumstances it is possible for calibrated parameters to assume values that are unrepresentative of the basin hydroclimatology this mathematical equivalence may have supplemented the broad range of the α 2 parameter in regions 17 and 18 we continue our discussion by evaluating the intra regional trends and dispersion of the optimized parameters for the ground water portioning factor d fig 3 c presents the boxplots of the parameter for each of the wrr regions we see a decreasing trend in d as we move from east to west wrr 1 to wrr 18 additionally we see that the northern catchments wrr 1 2 5 6 7 10 17 tend to release groundwater more readily than the southern catchments of similar longitude wrr 3 8 12 11 18 the northern southern catchments have higher lower median d values indicating more less groundwater contribution to further explain the spatial distribution of the baseflow behavior across the coterminous united states we direct the readers to the study conducted by santhi et al 2008 this study presents the geographical distribution of the baseflow index bfi percentage of streamflow composed of baseflow as estimated by wolock and mccabe 1999a 1999b one can easily draw parallels between the geographic locations of high baseflow contribution and high groundwater partitioning factor d the spatial data plotted by santhi et al 2008 depicts a high baseflow runoff contribution 50 particularly in the northwestern us and across the rocky mountain range spanning most of wrr 14 16 and 17 additional bfi coverage above 50 is witnessed along the eastern portions of central and northern california encompassing about half of wrr 18 streamflow in wrr 17 is derived nearly by proportions of d exceeding the 50 threshold on the other hand wrr 18 is bisected into an eastern area of high d values and a western area where the d is limited to 40 other regions exhibiting distributions of high groundwater partitioning factors and which have baseflows that have been shown to constitute large portions of annual streamflow include wrr 1 2 6 and 7 it is also of interest to note the existence of an extreme variation and heterogeneity in the baseflow contribution within wrr 2 and 3 this effect is mimicked by the broad range of our boxplots of d for these regions in fig 3 c while we can relate information about the hydrogeological characteristics of regions to the distribution of the groundwater partitioning factor the large range of the calibrated d parameters requires additional analysis to justify the use of its median statistic within our approximations additionally this analysis must include an understanding of how sensitive our approximations are to the soil moisture holding capacity smax and the α 2 as mentioned earlier wrr 17 and 18 which also exhibited a large spread fig 3 d presents the regional distribution of the calibrated soil moisture holding capacities smax calculation of the relation between the calibrated smax and d parameters exhibits a significant negative correlation 0 53 significant beyond the 0 01 level implying that the zwbm links characteristics of large small fractional baseflow contribution to low high soil moisture holding capacity similar to d smax relies heavily on the basin s soil profile which varies significantly from site to site thus while there is a close link for α 1 and α 2 to the region s climatic characteristics d and smax are less dependent on regionalized conditions and are highly reliant on the local geology and soil properties to assess the overall penalty of applying the median valued parameters to our approximations as opposed to using the site specific values fig 4 a and 4 b compares the results of the two parametric approaches in calculating the mean and the standard deviation respectively these nearly 1 to 1 plots reinforce the suitability of using the median valued parameters instead of the site specific values the high coefficients of determination 0 87 between the two approximations of the mean and 0 84 between the two approximations of the standard deviation verify that the overall variability in the statistical moments of the observed data is captured well nonetheless it must be pointed out that use of the regionalized parameters is most auspiciously applied during months of significant streamflow generation 4 3 month by month evaluation of the moments in this section we present the comparisons of observed moments mean and variance of monthly streamflow with the moments estimated from the simulated streamflows of the zwbm and the moments approximated by our eqs 14 and 15 405 hcdn stations that conform to our selection criteria of nash sutcliffe coefficient 0 6 with elevation 500 m in wrr 1 16 and nash sutcliffe coefficient 0 6 and elevation 1000 m in wrr 17 and 18 are presented here furthermore we used the regionalized parameters in the model and approximation equations for prediction fig 5 compares the observed and predicted values of mean streamflow for the months of october march similarly fig 6 compares the observed and predicted values of the mean streamflow for the months of april september in both figs 5 and 6 the predicted mean monthly streamflow from the zwbm is shown in blue colored square symbols and the predicted mean monthly streamflow from our approximations is shown in red color circles we observe that there is a good agreement between observed and predicted both from zwbm and our 0th order approximation mean streamflows for the months of january february march and april early spring season the agreement in these months is particularly high for the low streamflow values mean 100 mm month we also observe that for the high mean monthly flows there is a systematic under prediction from both the zwbm and our 0th order approximation recall that we are using regionalized parameters median of the distribution of all basins in the wrr for prediction in these basins and that the groundwater release parameter d and storage capacity smax have a large spread in the distribution across basins hence one can expect especially for watersheds dominated by groundwater release and storage components an under prediction of high monthly flows from the model an investigation of these stations i e stations having under prediction in high flows showed us that the actual catchment baseflow parameter d is much larger than the assumed median for the region indicating the heterogeneity in sub surface data and presence of local groundwater system wang et al 2015 for the months of may june and july we find that there is a larger spread around the 1 to 1 correspondence line with over prediction of the low flows and under prediction of high flows fig 7 compares the observed and predicted values of standard deviation of streamflow for the months of october march similarly fig 8 compares the observed and predicted values of the standard deviation of streamflow for the months of april september as in figs 5 and 6 the predicted standard deviation of monthly streamflow from the zwbm is shown in blue colored square symbols and the predicted standard deviation of monthly streamflow from our approximations is shown in red color circles we can see that except for the months of april and may the zwbm predicted standard deviation has good agreement with the observed standard deviation our 1st order approximation under predicts the low standard deviations for all the months but predicts the high standard deviation accurately this phenomenon can be explained partly by the fact that we choose only up to first derivative in the taylor series approximation higher order terms allow for a much smoother fit to the function thereby accurately estimating the variability from year to year we can also ascribe this phenomenon to the choice of regionalized parameters for predictions as we saw in the predictions for mean monthly flows overestimation underestimation of baseflow parameter or catchment storage capacity consistently produces more less monthly flows every year thereby creating wider tails for the distribution of monthly streamflow we compute the relative bias in predicting observed mean monthly flows and standard deviation of monthly flows using the our approximations for each basin for each month and present the monthly distributions in fig 9 we can see a low relative bias within 20 from the observed during january february march and april we can also see that for the months of june september there is a large spread of 50 as discussed above a use of local parameters for baseflow and storage capacity can improve the performance during these months fig 9 b presents the distributions of the relative bias in predicting the standard deviations of monthly streamflow using our 1st order approximation we can see that for all the months there is a negative relative bias in summary given the fact that we use regionalized parameters for the 405 stations across the united states we argue that our parsimonious approach for approximating the moments using eqs 14 and 15 provides reasonable estimates with low relative bias 5 summary this study focused on understanding and estimating the monthly hydroclimatology of coterminous united states with intent to develop quasi physical models that require limited no calibration towards this we derived analytical approximations for the mean and variance of monthly streamflows based on a physical water balance model zwbm mean variance and covariance information between precipitation and potential evapotranspiration along with basin characteristics and regionalized parameters of the zwbm models are the only inputs needed to estimate the moments of monthly streamflow thus the developed framework offers potential to estimate the moments of monthly runoff for ungauged basins evaluation of the zwbm and the developed semi empirical equations show good agreement in estimating mean monthly moments for low elevation basins consequently we selected 405 low elevation catchments and evaluated the performance of the semi empirical model in estimating the monthly moments using regionalized parameters analysis of the distributions of the calibrated model parameters indicate that basins within a hydroclimatic region have similar catchment retention sensitivity α1 and atmospheric moisture uptake sensitivity α2 the groundwater partitioning factor d and the maximum soil moisture holding capacity smax however varied substantially due to the strong influence of geography and heterogeneity in vertical and horizontal soil profiles the use of the median of the distributions as the regionalized parameters for all catchments still captures 87 of the variance in mean monthly streamflow and 84 of the variance in the standard deviation of the monthly flows indicating its suitability for prediction in ungauged basins it is important to note that these parameters estimation is based on full data record we have not done a cross validation on the parameters a comparison of observed and model both zwbm and our analytical model estimated monthly means indicates good agreement and low relative bias for the months of january february march and april high values of mean monthly flows have a systematic under prediction from both zwbm and our analytical model similarly comparison of observed and model estimated monthly standard deviation second moment show good agreement for all the months with the exception of may and june the analysis presented here is an important step towards better understanding the controls of monthly streamflow and towards the prediction in ungauged basins initiative together they play a significant role in water resources planning and management the developed expression also provides potential for developing models on elasticity of mean monthly runoff to mean monthly climatic inputs sankarasubramanian et al 2001 dooge et al 1999 developed elasticity of mean annual runoff to mean annual climatic inputs similar to that this study offers potential for developing expressions for estimating elasticity of mean monthly runoff to monthly climatic inputs it is important to understand that elasticity estimates are heavily dependent on the underlying structure sankarasubramanian et al 2001 which in this case is the zwbm since our interest is primarily mean monthly runoff we expect a lumped model such as zwbm should be sufficient we do not anticipate substantial differences in the estimates derived using a complex distributed model which primarily provide better performance for continuous runoff estimation as well as in estimating streamflow during extreme conditions comparison of the analytical expressions in estimating mean monthly runoff figs 5 and 6 with the observed and modeled mean monthly runoff shows relatively good agreement in all the months except during the summer months of june and july the zwbm simulated values tend to overestimate the observed flows whereas the zwbm approximation further overestimates in june and july over arid basins similarly comparison of the analytical expressions in estimating the standard deviation of monthly runoff with observed and model estimated values are in good agreement shows that model estimated values are in agreement for the months of november to march for basins having standard deviation of monthly runoff above 20 mm fig 7 during spring and summer months the analytical expression consistently underestimates the observed standard deviation of monthly runoff fig 8 which is partly due to the inability of the zwbm itself blue dots in estimating the observed interannual variability of summer flows in arid basins to summarize the proposed analytical approximations of mean monthly runoff and standard deviation of monthly runoff provide good agreement in most basins in all the months except during the summer months in initial land surface dominated basins ability of water balance models in estimating flows in arid basins is a well known issue abdulla and lettenmaier 1997 sankarasubramanian et al 2002 as it requires calibration of the model to other land surface attributes such as evapotranspiration and groundwater level yapo et al 1998 kuczera 1982 1983 parameters estimated with such multi objective optimization could be used in place of the parameters estimated using streamflow alone we intend to consider such refinements as part of our future effort related to the usgs powell center funded global synthesis on budyko s framework https powellcenter usgs gov view project 59a062cfe4b038630d03054b acknowledgments this research was supported by a nsf grant 1360446 water sustainability and climate category 3 b nsf grant 0954405 career award for the third author c nsf grant 1204368 water sustainability and climate category 3 the statements contained within the manuscript research article are not the opinions of the funding agency or the u s government but reflect the authors opinions data used in this research are available from a the monthly climate data for the hcdn sites are available from the oak ridge national laboratory distributed active archive center https daac ornl gov hydroclimatology guides hcdn monthly hydroclim html b the streamflow data is available from u s geological survey usgs https pubs usgs gov wri wri934076 1st page html the model output data are available from the authors upon request appendix a in the following we detail the derivation of the 0th order taylor series approximation of mean monthly runoff as calculated by the zhang et al 2008 water balance model a1 q p t p e t t d g t 1 p t x t a2 g t 1 d g t 1 r t a3 r t w t y t a4 s t y t e t a5 e t w t f p e t t w t α 2 a6 y t w t f s max p e t t w t α 2 a7 w t x t s t 1 a8 x t p t f x 0 t p t α 1 a9 x 0 t s m a x s t 1 p e t t since q t g t r t s t e t y t w t x t and x 0 t are all functions of p t p e t t our model merely necessitates data on the mean monthly precipitation and mean monthly potential evapotranspiration in order to approximate the mean monthly runoff an iterative procedure was used to find appropriate values for the storage components s 1 and g 1 at t 0 i e the soil moisture and groundwater components expected at the end of september the 1st order taylor series approximation of the variance in mean monthly runoff was calculated via the zwbm using eq 15 and the relations detailed below partial derivative of monthly runoff qt with respect to the corresponding monthly precipitation pt a10 q t p t 1 x t p t a11 x t p t 1 1 x 0 t p t 1 1 α 1 1 α 1 x 0 t p t 1 1 α 1 1 x 0 t p t 1 1 α 1 α 1 partial derivative of monthly runoff qt with respect to the corresponding monthly potential evapotranspiration pett a12 q t p e t t x t p e t t a13 x t p e t t 1 1 x 0 t p t 1 1 α 1 α 1 x 0 t p t α 1 1 α 1 here it must be remarked that the partial derivatives at the current time step cannot depend on the groundwater and soil moisture storage components of the previous time step this leads to the simply expressions above supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2018 02 010 appendix b supplementary materials image application 1 
849,in this paper we analyze the hirano active layer model used in mixed sediment river morphodynamics concerning its ill posedness ill posedness causes the solution to be unstable to short wave perturbations this implies that the solution presents spurious oscillations the amplitude of which depends on the domain discretization ill posedness not only produces physically unrealistic results but may also cause failure of numerical simulations by considering a two fraction sediment mixture we obtain analytical expressions for the mathematical characterization of the model using these we show that the ill posed domain is larger than what was found in previous analyses not only comprising cases of bed degradation into a substrate finer than the active layer but also in aggradational cases furthermore by analyzing a three fraction model we observe ill posedness under conditions of bed degradation into a coarse substrate we observe that oscillations in the numerical solution of ill posed simulations grow until the model becomes well posed as the spurious mixing of the active layer sediment and substrate sediment acts as a regularization mechanism finally we conduct an eigenstructure analysis of a simplified vertically continuous model for mixed sediment for which we show that ill posedness occurs in a wider range of conditions than the active layer model keywords river morphodynamics ill posedness mixed sediment 1 introduction the mixed character of the sediment is a property necessary to explain physical phenomena such as downstream fining sternberg 1875 blom et al 2016 the gravel sand transition zone yatsu 1955 blom et al 2017 the formation of bedload sheets seminara et al 1996 or bed surface armoring parker and klingeman 1982 hirano 1971 was the first to develop a mass conservation model for mixed size sediment the model assumes that the topmost part of the bed i e the active layer interacts with the flow and is instantaneously mixed below the active layer lies the substrate which can have vertical stratification in this schematic representation of the morphodynamic processes only the active layer sediment is affected by entrainment and depositional processes a vertical flux of sediment originates from changes in elevation of the interface between the active layer and the substrate one of the critical aspects of the active layer model is the fact that the vertical extent of the active layer or active layer thickness shall be a priori assigned however it cannot be physically measured as it stems from the above schematic representation siviglia et al 2017 church and haschenburger 2017 the active layer thickness is related to the time scale of the process under consideration bennett and nordin 1977 rahuel et al 1989 sieben 1997 wu 2007 in plane bed conditions and short time scales the active layer thickness is assumed to be proportional to the size of a characteristic coarse fraction in the bed for instance d 84 or d 90 e g petts et al 1989 rahuel et al 1989 parker and sutherland 1990 if bed forms are predominant and the time scale under consideration involves the mixing induced by the passage of several bed forms the active layer thickness is typically related to a characteristic bed form height e g deigaard and fredsøe 1978 lee and odgaard 1986 armanini and silvio 1988 the active layer thickness may vary over space and time although often it is assumed to be a uniform constant the active layer modeling framework has proven to be able to represent a wide variety of physical phenomena such as bed surface armoring e g park and jain 1987 and the morphodynamics of gravel bed rivers e g vogel et al 1992 and tidal basins e g carniello et al 2012 moreover it is implemented in a large amount of software packages such as telemac villaret et al 2013 delft3d sloff and mosselman 2012 and basement vetsch et al 2006 the mathematical representation of river morphodynamics should be well posed this means that the mathematical problem must have a unique solution which depends continuously on the data hadamard 1923 if the solution does not depend continuously on the data the model is unfit to represent the corresponding physics despite its widespread use the active layer model has one major mathematical shortcoming the model can change its mathematical character under some parameter settings therefore the mathematical problem that represents the physics of river morphodynamics can become ill posed this fact was first recognized by ribberink 1987 to this end he simplified the active layer model by considering an equation for the mean grain size of the active layer sediment rather than one active layer equation for each grain size fraction he found that under aggradational conditions the problem is unconditionally well posed and the system may become ill posed under degradational conditions if the substrate is finer than the active layer i e degradation in an armored river ribberink 1987 included a third layer between the active layer and the substrate to model the effects of dunes exceptionally larger than the average dune height although this model includes more physical mechanisms and improves the prediction of mixed sediment processes in dune dominated cases it may still become ill posed sieben 1994 to understand the conditions in which the active layer model becomes ill posed we focus on how information propagates along a river we first consider a certain reach characterized by normal flow and immobile sediment a perturbation of the flow propagates along the river in the form of two waves traveling at speeds equal to u g h where u m s denotes the mean flow velocity h m the flow depth and g m s2 is the acceleration due to gravity if sediment is mobile yet uniform a perturbation in bed elevation e g a sediment hump will propagate with a speed that is termed the bed celerity de vries 1965 lyn and altinakar 2002 stecca et al 2014 as the bed elevation affects the flow the bed elevation perturbation also induces a perturbation of the flow thus under unisize sediment conditions a perturbation of the bed elevation leads to three waves fig 1 a although each of the waves perturb both bed elevation and flow two of the waves perturb mainly the flow without much change in bed level if the froude number f r u g h is sufficiently small de vries 1973 needham 1990 zanré and needham 1994 the consideration of mixed sediment of two size fractions to simplify the example introduces another celerity which is termed the sorting celerity suzuki 1976 ribberink 1987 stecca et al 2014 thus under mixed sediment conditions with two grain sizes a perturbation of bed elevation causes four waves although each wave perturbs the flow bed elevation and surface grain size distribution two of these perturb mainly the flow one mainly the bed level and one mainly the surface grain size distribution ribberink 1987 stecca et al 2014 fig 1b sieben 1994 identified a region of parameters where for a sediment mixture consisting of two grain size classes under bed degradation into a substrate finer than the active layer the model is unconditionally ill posed this occurs when the sorting celerity equals the bed celerity this was confirmed by stecca et al 2014 who observed through numerical computation of the system eigenvalues such model behavior also in case of more than two sediment fractions furthermore stecca et al 2014 analytically confirmed the outcomes of ribberink s analysis using a more realistic unsteady model for two sediment size fractions they considered grain size selectivity of the bedload but hiding in a limited manner hiding accounts for the fact that grain size fractions finer than a characteristic mean grain size of the mixture hide behind larger grains and so they experience a larger critical bed shear stress compared to the unisize case einstein 1950 komar 1987a 1987b the opposite happens for coarse sediment fractions which experience a larger exposure to the flow than in a unisize case in their analysis stecca et al 2014 showed that the model can become ill posed under degradational conditions if and only if the substrate is finer than a reference grain size distribution which is related to the grain size distribution of the bedload instead of the active layer as in ribberink s 1987 analysis to overcome the problem of setting the active layer thickness parker et al 2000 developed a stochastic framework without the need for a distinction between the active and inactive parts of the bed blom and parker 2004 blom et al 2006 and blom et al 2008 developed a model that accounts for dune sorting and the variability of bed elevation based on the stochastic framework developed by parker et al 2000 the model associates a probability of grain size selective entrainment to all elevations within the bed and hence allows for sediment at any elevation to be entrained and contribute to the bedload discharge viparelli et al 2017 developed a simplified vertically continuous model assuming slow changes in bed elevation and a steady probability distribution of entrainment deposition and bed elevation which make their model suitable for large space and time domains so far the well posedness of the continuous model has never been assessed our main objective is to analyze the problem of ill posedness of the active layer model used for mixed sediment morphodynamics the present paper provides four key improvements with respect to presently available knowledge i we obtain analytical expressions to characterize a simplified model i e to find whether it is ill posed or well posed with two sediment fractions only ii we study the effect of model parameter choice on ill posedness iii we find new previously neglected ill posed domains and iv we study the consequences of ill posedness in numerical simulations our second objective is to mathematically characterize the vertically continuous model developed by viparelli et al 2017 in the next section we present the general set of equations for modeling mixed sediment river morphodynamics using a the active layer model and b the vertically continuous model developed by viparelli et al 2017 the models are simplified and analyzed in section 3 we analyze the effect of model parameters on the ill posedness of the active layer model in section 4 in section 5 we study the consequences of ill posedness using numerical runs in section 6 we relax and study the simplifications of our analysis 2 model equations in this section we present the equations used to model river morphodynamics these equations represent one dimensional hydrostatic flow over a mobile bed composed of an arbitrary number n of non cohesive sediment fractions characterized by a grain size dk m where the subscript k identifies each fraction in increasing size i e d 1 d 2 d n in the following section we describe the flow equations as previous research has clarified ribberink 1987 stecca et al 2014 a key parameter in determining well posedness of the active layer model is the active layer thickness in this paper we both consider a model with constant and with unsteady time varying active layer thickness while the well posedness of the model with constant active layer thickness has been analyzed in previous work ribberink 1987 stecca et al 2014 to our knowledge no analysis of the well posedness of the model with unsteady active layer thickness is available although use of such a model is documented in the literature e g karim et al 1983 the equations of the adapted active layer model are presented in section 2 2 in section 2 3 we present the vertically continuous model derived by viparelli et al 2017 the closure relations for both models are treated in section 2 4 in section 2 5 we present a compact matrix formulation of the model equations 2 1 flow equations the flow is described by the 1d shallow water equations i e the saint venant equations saint venant 1871 considering constant width assuming steady flow conditions the water discharge is uniform and conservation of momentum reduces to the so called backwater equation appendix a when assuming steady flow over a movable bed composed of sediment of different sizes we implicitly assume that the flow adapts instantaneously to perturbations in bed elevation and grain size distribution worded differently we assume that flow perturbations propagate infinitely fast relative to perturbations in bed elevation and surface grain size distribution this assumption is referred to in literature as the quasi steady flow assumption de vries 1965 zhang and kahawita 1987 1990 cao and carling 2002a the quasi steady flow assumption is acceptable provided that the froude number is sufficiently small 1 f r 2 o 1 de vries 1973 sieben 1999 lyn and altinakar 2002 note that in this context the term quasi steady has a meaning different from for instance its use in the modeling of flood waves where quasi steady refers to negligible inertia in the momentum balance 2 2 adapted active layer model equations the conservation of the total amount of sediment in the bed is formulated by the exner equation exner 1920 the active layer equation describes mass conservation for each size fraction hirano 1971 appendix b presents the details of the active layer model to analyze the model with unsteady active layer thickness we first need to set a closure relation expressing the thickness change in time we consider an empirical empirical power relation between dune height h m and flow depth h m yalin 1964 gill 1971 1 h a l h b l where al m 1 b l and bl are constants allen 1968a b proposed values of a l 0 1 0 2 m 1 b l and b l 0 9 1 2 with h in m assuming that the active layer thickness la m is equal to the mean dune height blom 2008 we relate the active layer thickness to the flow depth as follows 2 l a a l h b l to obtain an equation for the active layer thickness variation we differentiate the constitutive law eq 2 with respect to time and then substitute the continuity eq a 1 in it 3 l a t a l b l h b l 1 q x substitution of eq 3 into the active layer eq b 2 yields the following adapted active layer equation 4 m ak t f k i q b x f k i a l b l h b l 1 q x q bk x 0 where t s denotes the time coordinate x m the streamwise coordinate q u h m2 s the water discharge per unit width qb m2 s is the sediment transport rate per unit width multiplied by 1 1 p where p is the bed porosity i e the sediment transport rate qb accounts for pores qbk m2 s is the sediment transport rate per size fraction mak m is the volume of sediment of size fraction k in the active layer per unit of bed area and f k i is the volume fraction content of size fraction k at the interface between the active layer and the substrate in fig 2 we show a schematic representation of the main variables of the active layer model 2 3 simplified vertically continuous model equations the conserved quantity in the vertically continuous model similar to mak in the active layer model is the product of the cumulative probability of bed elevation pe and the volume fraction content of a specific grain size class k fk parker et al 2000 pelosi et al 2014 the vertical coordinate is z m to simplify the problem the probability distribution depends on a second vertical coordinate y z η which is centered at the mean bed elevation assuming slow changes in mean bed elevation and a constant in time and space probability distribution of bed elevation viparelli et al 2017 obtain an equation for the change in time of the volume fraction content fk 5 p e f k t p e q b k x q b x f k p e y where pe m 1 is the probability density function of bed elevation fig 2 as in the active layer model information is only advected in streamwise direction i e the conservation equation does not include divergence terms in the y direction and the only independent variable in space is x in contrast to the active layer model there is no inactive substrate and sediment at all elevations plays a role this is illustrated by the dependence of the probability function on the y coordinate and the gradient in the y direction in eq 5 thus although the system of equations is one dimensional the mathematical character of the model is a property depending not only on the streamwise coordinate x but also on the vertical coordinate y 2 4 closure relations we apply the chézy law for the friction slope thus the friction slope is proportional to the square of the mean flow velocity divided by the flow depth s f c f u 2 g h where cf is a nondimensional friction coefficient for simplicity we assume a constant nondimensional friction coefficient that is independent of the flow and bed parameters we apply a generalized form of the meyer peter and müller 1948 transport relation in which the sediment transport rate is a power function of the excess bed shear stress 6 q b k a max θ k ξ k θ c 0 b where q b k is a nondimensional sediment transport rate appendix c a and b are nondimensional parameters θk is the nondimensional bed shear stress of size fraction k also known as shields 1936 parameter θc is the nondimensional critical bed shear stress and ξk is the hiding coefficient table 1 summarizes appropriate values of a b and θc according to several authors a common hiding function is the one due to egiazaroff 1965 appendix c a simpler relation was developed by parker et al 1982 7 ξ k d m d k b where dm m is a characteristic mean grain size and b is a nondimensional parameter a value of b 1 dhamotharan et al 1980 misri et al 1984 kuhnle 1993 implies that hiding is so strong that the coarser fraction s in the mixture is are more mobile than the finer one s i e reverse mobility solari and parker 2000 a final closure relation is required only for the active layer model for the volume fraction content of sediment of size fraction k at the interface between the active layer and the substrate f k i when the interface lowers the texture at the interface is equal to that at the topmost part of the substrate when the interface elevation increases various relations can be applied for f k i hirano 1971 proposed that during aggradation the grain size distribution at the interface is equal to the one of the active layer according to parker 1991 also the bedload sediment plays a role in the aggradational flux to the substrate hoey and ferguson 1994 combined both concepts in one parameter α spanning the range 0 1 that describes the contribution of the active layer relative to the one of the bedload 8 f k i f s k z η l a if η l a t 0 α f a k 1 α p k if η l a t 0 where p k q b k q b is the fraction of sediment transport rate of size fraction k 2 5 matrix formulation in this section we introduce a matrix formulation to asses the well posedness of the system of equations a system of partial differential equations pdes can be mathematically classified as being of a hyperbolic elliptic or mixed type e g courant and hilbert 1989 to this end we write the problem in matrix vector form e g toro 2001 9 q t a q x s this equation is the one dimensional quasi linear non conservative form of the advection equation q is the vector of dependent variables a is the system matrix and s is the vector of source terms a system is hyperbolic at a point x t if all the eigenvalues of matrix a are real physical propagation problems are modeled with hyperbolic systems of equations if all eigenvalues are complex the system is termed elliptic elliptic systems model equilibrium physical problems if matrix a has both real and complex eigenvalues it is a mixed type system a space time dependent problem in which we prescribe boundary conditions as a function of time and an initial condition as is the case in modeling river morphodynamics governed by an elliptic set of equations is ill posed hadamard 1923 joseph and saut 1990 kabanikhin 2008 this is confirmed by a perturbation analysis that shows that if all eigenvalues of matrix a are real perturbations of a reference state are bounded appendix a in the supplementary material however if there is at least one complex eigenvalue or precisely at least two because of the complex conjugate perturbations grow exponentially the exponential growth depends on the product of the imaginary part of the eigenvalues and the wave number of the perturbation which implies that the solution of an ill posed problem is unstable to short perturbations attempts to numerically integrate an ill posed problem therefore produce results that continue to change as the grid is refined woodhouse et al 2012 barker et al 2015 as in numerical solutions perturbations always exist due to at least truncation errors in numerical simulations the wave number of the shortest possible perturbation is inversely related to the horizontal discretization δx by only using the eigenvalues of a to characterize the system of equations we are neglecting the effect of friction appendix a in the supplementary material yet this suffices here as friction becomes relevant for small wave numbers only appendix a in the supplementary material and the most critical wave numbers as regards to oscillation growth are the large ones as a single complex pair of eigenvalues makes the problem ill posed we do not make a distinction between the number of complex eigenvalues we term a problem with at least a pair of complex eigenvalues as elliptic we recast in matrix vector form the saint venant equations a 1 and a 2 the exner equation b 1 the active layer thickness equation 3 and the adapted active layer equation 4 the vector of dependent variables is 10 q al h q η l a m a k n 1 t the system matrix is 11 and the vector of source terms is 12 s al 0 g h s f 0 0 0 n 1 t the brackets highlight those terms that are vectors or matrices we also recast in matrix vector form the saint venant equations a 1 and a 2 the exner equation b 1 and the conservation equation of the vertically continuous model eq 5 the vector of dependent variables is 13 q vc h q η f k n 1 t the system matrix is 14 and the vector of source terms is 15 s vc 0 g h s f 0 0 n 1 t 3 characterization of the mathematical models in this section we analyze the mathematical character of the models described in section 2 eigenvalues computed numerically can be obtained for an unlimited number of fractions here we study a simple case assuming steady flow and two size fractions to obtain analytical expressions of the eigenvalues as in our case the temporal change of the active layer thickness depends on the spatial gradient of the water discharge per unit width eq 3 the steady flow assumption implies a constant active layer thickness yet in a numerical simulation where the steady flow assumption is used but the upstream discharge varies with time i e alternating steady flow the active layer thickness may vary with time however in such a case the perturbations due to a change in active layer thickness propagate infinitely fast relative to the perturbations in bed elevation and surface grain size distribution the implications of more than two sediment size fractions and an active layer thickness as a function of the flow depth are studied in section 6 3 1 steady active layer model consisting of two size fractions substitution of the backwater equation a 3 in the exner equation b 1 and the active layer equation b 2 allows us to obtain a reduced model where the vector of dependent variables q als2 is 16 q als2 η m a 1 t the vector of source terms s als2 reads 17 s als2 s f u ψ 1 f r 2 1 γ 1 t and the system matrix a als2 is 18 a als2 u ψ 1 f r 2 χ 1 ψ 1 f r 2 γ 1 χ 1 μ 1 1 we define ψ as 19 ψ q b q which is a parameter related to the intensity of total bedload in the flow and ranges between 0 null sediment discharge i e fixed bed and o 10 2 high sediment discharge e g de vries 1965 lyn and altinakar 2002 stecca et al 2014 the parameter γ 1 is a measure of the fraction content of sediment in transport relative to the fraction content of sediment at the interface between the active layer and the substrate stecca et al 2014 20 γ 1 c 1 f 1 i where c 1 0 1 is a parameter expressing the increase in the sediment transport intensity of the fine fraction relative to the total sediment transport intensity stecca et al 2014 21 c 1 1 ψ q b 1 q we now introduce the parameter χ 1 which is a nondimensional measure of the derivative of the total sediment transport rate with respect to the volume of fine sediment in the active layer 22 χ 1 1 u q b m a 1 the parameter μ 1 1 is defined as 23 μ 1 1 d 1 1 f 1 i where d 1 1 is a nondimensional measure of the derivative of the sediment transport rate of the fine fraction with respect to the volume of fine sediment in the active layer 24 d 1 1 1 u χ 1 q b 1 m a 1 we obtain the eigenvalues of the system matrix finding the roots of its second degree characteristic polynomial the eigenvalues are nondimensionalized dividing by the flow velocity 25 λ als2 i 1 2 λ b λ s 1 δ als2 for i 1 2 where the discriminant is 26 δ als2 λ b λ s 1 2 4 λ b λ s 1 γ 1 μ 1 1 the eigenvalues of the system carry coupled information on both the bed elevation and the surface grain size distribution which shows that a perturbation in bed elevation causes a perturbation in surface grain size distribution and vice versa section 1 yet we identify two nondimensional celerities that approximate the changes in bed elevation λb and in surface grain size distribution λ s1 independently the bed celerity which is independent of the active layer thickness was first derived by de vries 1965 for unisize sediment 27 λ b ψ 1 f r 2 we define the nondimensional sorting celerity as 28 λ s 1 χ 1 μ 1 1 this sorting celerity differs from the one of ribberink 1987 as he considered a perturbation in the mean grain size while here the sorting celerity relates to a perturbation in the volume fraction content of each grain size fraction individually the proposed expression for the sorting celerity in eq 28 is a generalization of the expression proposed by stecca et al 2014 as we have relaxed stecca s assumption of limited hiding the mathematical character of the model depends on the sign of the discriminant δ als2 eq 26 if δ als2 0 the two eigenvalues are real and the system is hyperbolic if δ als2 0 the eigenvalues are complex and the system is elliptic a large difference between the bed celerity and sorting celerity reduces the likelihood that the model becomes elliptic hyperbolicity is guaranteed if γ 1 0 if γ 1 0 and the bed and sorting celerities are equal ellipticity is guaranteed sieben 1994 stecca et al 2014 assuming that reverse mobility does not occur section 2 4 c 1 is larger than the volume fraction content of fine sediment in the active layer f a1 due to the grain size selectivity of the sediment transport relation stecca et al 2014 if we also assume that the sediment transferred to the substrate in aggradational conditions has the same grain size distribution as the active layer hirano 1971 then the parameter γ 1 is always positive in aggradational conditions only a substrate finer than the active layer yields a negative value of the parameter γ 1 thus a two fraction active layer model can only be ill posed if the bed degrades into a substrate that is finer than the active layer a result also found by stecca et al 2014 considering unsteady flow in sections 4 1 and 4 2 we assess the relaxation of the assumptions that reverse mobility does not occur and that the aggradational flux to the substrate has the same grain size distribution as the active layer 3 2 steady vertically continuous model consisting of two size fractions we apply the same procedure used to analyze the active layer model to the vertically continuous model section 2 3 in this manner we obtain the discriminant of the eigenvalues appendix d 29 δ vcs2 λ b λ s c 1 2 4 λ b λ s c 1 g 1 m 1 1 where λ sc1 g 1 and m 1 1 are the equivalents to λ s1 γ 1 and μ 1 1 of the active layer model appendix d similar to the active layer model section 3 1 the continuous model is hyperbolic and well posed if δ vcs2 0 and vice versa although the expression of the discriminant of the vertically continuous model eq 29 is similar to the one of the active layer model eq 26 there is an essential difference between the two in the active layer model the discriminant is a function of the streamwise position δ als2 x yet in the continuous model the discriminant is also a function of the vertical coordinate δ vcs2 x y thus ellipticity or hyperbolicity is a property not only of the streamwise coordinate but also of the elevation in the bed section 2 3 hyperbolicity is guaranteed if g 1 0 but contrary to the active layer model this parameter can be negative both under aggradational and degradational conditions due to grain size selective transport we can assure that if reverse mobility conditions do not prevail the concentration c 1 is larger than the volume fraction content representative of the bed surface f b1 eq c 4 however f b1 is a weighted average of all sediment and for this reason there is no guarantee that for all bed elevations the average volume fraction content f b1 is larger than the local volume fraction content in the bed sediment f 1 moreover as there is no distinction between aggradational and degradational cases the domain in which the model is likely to be ill posed is larger than for the active layer model the presence of fine sediment at the locations having larger probability of entrainment in combination with a smooth vertical variation small derivative of the volume fraction content of fine sediment reduces the likelihood of the model becoming elliptic 4 active layer model parameter study in this section we assess the effects of various model parameters on the mathematical character of the active layer model to this end we study the analytical expressions of the eigenvalues of the steady model considering two sediment size fractions obtained in section 3 1 4 1 hiding given the fact that ill posedness arises when considering different grain sizes in the mixture and that a larger difference between grain sizes increases the ill posed domain intuitively hiding should reduce the likelihood of ill posedness its effect however is opposite as we will show here to explain this counter intuitive result we analyze the term in the characteristic polynomial intrinsically related to hiding this term is the derivative of the sediment transport rate of fine and coarse sediment with respect to the volume of fine sediment in the active layer qbk m a1 it can be considered as the summation of two terms 30 q b k m a 1 1 l a f a k f a 1 q b k presence f a k q b k f a 1 hiding for k 1 2 we name the first and second terms on the right hand side the presence term and the hiding term respectively the presence term explains that an increase in the volume fraction content of the fine sediment in the active layer implies both 1 an increase of the sediment transport rate of the fine fraction as its presence at the bed surface is larger and 2 a consequent decrease of the sediment transport rate of the coarse fraction because its presence at the bed surface decreases the hiding term indicates the fact that a variation of the volume fraction content of the fine sediment changes the sediment transport rate of both fine and coarse fractions due to a change in the mean grain size of the sediment mixture the presence term is positive for the fine fraction and negative for the coarse fraction the hiding term is always positive in a situation where hiding is negligible an increase of the characteristic size of the coarse fraction or decrease of the fine fraction which is associated with a larger likelihood that the model is elliptic causes an increase of the presence term and thus of qbk m a1 with respect to such a situation hiding decreases the presence term of both fine and coarse sediment reducing the likelihood of ellipticity but introduces the positive contribution of the hiding term overall the hiding term may dominate which increases the value of qbk m a1 and thus of the likelihood of ellipticity interestingly in degradational conditions into a fine substrate a situation prone to be elliptic the hiding term dominates thus hiding increases the likelihood that the model is elliptic in degradational conditions into a substrate finer than the active layer in fig 3 a we show the effect of hiding on the discriminant of the steady active layer model considering two size fractions eq 26 we consider the reference case described in table 2 the sediment transport rate is computed using the relation derived by meyer peter and müller 1948 to obtain different values of hiding we vary parameter b in the power law hiding function in eq 7 between 0 and 1 purple line in fig 3a the yellow line in fig 3a is obtained varying the characteristic grain size of the fine fraction between 0 001 m and 0 004 m using the egiazaroff hiding relation eq c 5 the discriminant decreases for increasing hiding independent from the hiding function besides these cases under degradational conditions we may encounter problems even under aggradation in fact if hiding is so strong that reverse mobility is induced then one of the assumptions of the analysis by stecca et al 2014 may not be fulfilled in detail it may happen that the reference content c 1 related to the fine sediment in the bedload eq 21 is not greater than the content of fines in the active layer f a1 which was their assumption under grain size selective transport when reverse mobility instead determines conditions such that c 1 f a1 then the discriminant eq 26 may be negative and the model may become elliptic even under aggradational conditions 4 2 aggradational flux to the substrate the sediment transferred to the substrate under aggradational conditions using the model by hoey and ferguson 1994 section 2 4 is always finer than the sediment in the active layer this is because the bedload is finer than the bed surface due to grain size selective processes provided that reverse mobility does not dominate thus application of the model by hoey and ferguson 1994 implies that under aggradational conditions the interface between the active layer and the substrate is finer than the active layer this means that the condition γ 1 0 section 3 1 may not be fulfilled under aggradational conditions which implies that the model may become ill posed therefore a larger contribution of the bedload to the aggradational flux to the substrate smaller value of the parameter α in eq 8 implies a larger likelihood of the model becoming elliptic appendix b in the supplementary material however in a hypothetical aggrading case in which the grain size distribution transferred to the substrate is fully composed of bedload sediment α 0 the relative content of the fine fraction in the vertical sediment flux γ 1 eq 20 that controls the size of the ill posed domain section 3 1 is still not as small as it can be found under degradational cases appendix b in the supplementary material thus ill posed cases are expected to occur primarily under degradational conditions into a fine substrate 4 3 prefactor in a sediment transport relation and morphodynamic factor the discriminant δ als2 of the steady active layer model for two size fractions eq 26 can be written as δ als2 a 2 δ als2 where δ als2 is the discriminant for a unit prefactor i e a 1 the prefactor a increases or decreases the discriminant but does not change its sign and so it does not change the character of the mathematical system this is confirmed by fig 3b which shows the effect of varying the prefactor a in the reference case described in section 4 1 since morphodynamic time scales are usually several orders of magnitude larger than the time scales of the flow section 2 1 computations usually cover a significant number of years the computational time is sometimes reduced using a morphodynamic factor that multiplies the divergence of the sediment transport rate latteux 1995 roelvink 2006 ranasinghe et al 2011 this factor can also be considered as a multiplication of the sediment transport rate and therefore has the same effect as the prefactor a thus the use of a morphodynamic factor does not change the mathematical character of the model this result is obtained assuming quasi steady flow while the prefactor in the sediment transport relation rarely varies by more than an order of magnitude simulations may be run with morphodynamic acceleration factors o 10 2 in these latter cases the quasi steady flow assumption may not be acceptable which limits the extension of our analysis 4 4 exponent and critical shields stress in a sediment transport relation the discriminant eq 26 tends to 0 with increasing values of b if the effective shields stress for all sediment fractions is smaller than 1 or to if the effective shields stress is larger than 1 for at least one fraction thus it is difficult to generalize the effect of the exponent its variation from a reference situation can both make the system hyperbolic if the reference situation is elliptic or vice versa in fig 3c we show the discriminant as a function of b for the same reference cases as in section 4 3 the hyperbolic situation when using meyer peter and müller 1948 becomes elliptic if the value of the exponent b increases towards the value in engelund and hansen 1967 the effect of the critical shields stress θc in eq 6 on the discriminant is similar to the effect of the exponent as its variation can both make a previously hyperbolic case elliptic or vice versa fig 3d shows how a decrease of the critical shear stress when using the sediment transport relation by meyer peter and müller 1948 increases the discriminant reducing the likelihood of elliptic behavior 4 5 active layer thickness the discriminant of the eigenvalues eq 26 can be written as a second degree polynomial of the inverse of the active layer thickness i e δ als2 a 1 1 l a 2 a 2 1 l a a 3 where a 1 0 a 2 and a 3 are coefficients independent of the active layer thickness this implies that 1 the model is well posed for a sufficiently thin active layer 2 the model is well posed for a sufficiently thick active layer and 3 there exists one ill posed domain only regarding the active layer thickness these results of the two fractions model confirm previous results based on the simplified active layer model ribberink 1987 sieben 1994 the inverse of the roots of the second degree polynomial are the limit values of the active layer thickness that ensure that the model is well posed 31 l a λ s 1 λ b 1 2 γ 1 μ 1 1 2 γ 1 μ 1 1 1 2 1 1 where we have used the notation for the variables with unit active layer thickness i e l a 1 m given the facts that the active layer thickness is one of the most empirical parameters of the system of equations section 1 and that river morphodynamic models often require calibration e g cao and carling 2002b eq 31 can be applied to select a certain value for the active layer thickness to avoid a situation that is prone to be ill posed 5 consequences of ill posedness in this section we analyze the consequences of ill posedness using numerical simulations our aim is to provide modellers with the tools to detect occurrence of ill posedness in their results and understand how the observed unrealistic model behavior changes with parameter and model choices first we make numerical runs to qualitatively observe the consequences of the non linear effects that are neglected in the perturbation analysis section 5 1 in section 5 2 we conduct a sensitivity analysis to generalize the consequences observed in the previous section 5 1 numerical examples the linear perturbation analysis shown in section 2 5 indicates that perturbations grow unboundedly if the model is elliptic in this section we run four numerical simulations at flume scale to analyze the effects of the neglected non linear terms the simulations are one dimensional for the flow and are computed using the delft3d software package lesser et al 2004 which solves the unsteady shallow water equations in combination with the active layer model for simplicity the active layer thickness is assumed constant under aggradational conditions the sediment transferred to the substrate is composed of only the active layer sediment i e α 1 in eq 8 substrate stratigraphy is stored using a bookkeeping system viparelli et al 2010 stecca et al 2016 all simulations start from equilibrium conditions under coarse sediment feeding a lowering of the base level is imposed which causes degradation into a fine substrate we consider a well posed reference case simulation 1 that initially has the same parameters as the reference case of the parameter study of section 4 table 2 then the active layer thickness is changed simulation 2 and hiding is considered simulation 3 simulation 4 is equal to simulation 3 except for its morphodynamic factor table 3 summarizes the differences between the four simulations the boundary conditions that are in equilibrium with the initial condition blom et al 2016 as well as other parameters are described in table 4 in fig 4 a we plot the discriminant of the eigenvalues of the quasi steady active layer model eq 26 at the initial time as a function of the active layer thickness note that the conditions of simulation 1 yield a well posed model δ als2 0 while the conditions of simulation 2 yield an ill posed model δ als2 0 in fig 4d e we show the evolution of the bed elevation for simulations 1 and 2 respectively the ill posed simulation 2 shows an oscillatory behavior that is not present in the well posed simulation 1 we have not imposed any initial perturbation which implies that numerical noise is sufficient to trigger the oscillatory behavior simulation 3 is the same as simulation 1 yet the sediment transport rate now accounts for hiding using the parker et al 1982 function eq 7 with exponent b equal to 0 8 simulation 3 is ill posed fig 4b and the solution shows oscillations fig 4f just as in the ill posed simulation 2 simulation 4 is the same as simulation 3 except for its morphodynamic factor equal to two which decreases the value of the discriminant fig 4c causing oscillations to develop faster fig 4g for all cases oscillations do not occur at the upstream end of the domain this is because oscillations require time and so space to grow in all cases oscillations grow until a maximum amplitude is reached and then propagate downstream this maximum amplitude is such that the conditions are at the brink of ill posedness and well posedness worded differently downstream from the location where the amplitude is maximum the model is ill posed and it is well posed upstream from it the oscillations are associated with degradation and subsequent aggradation the deposited sediment has the same grain size distribution as the active layer which is coarser than the initial substrate so the overall effect of an oscillation is a coarsening of the topmost part of the substrate this coarsening acts as a regularization mechanism which not only restores hyperbolicity but also dampens oscillations that arrive from upstream by limiting the source of fine material it is likely that because of the regularization mechanism computations do not crash as a result the extent and likelihood of ellipticity may in practice be underestimated yet the results are physically unrealistic and implementing an automated check of the eigenvalues would be good practice for software developers and users 5 2 sensitivity analysis the previous section has shown that due to the non linearity of the system an ill posed simulation generates non physical oscillations that propagate downstream and grow until a certain maximum amplitude at which the mathematical problem is at the brink of ill posedness and well posedness in this section we run a sensitivity analysis to generalize those results to this end we vary 4 physical parameters and 2 parameters related to the domain discretization using simulation 1 as a reference case table 5 summarizes the parameter values used in the sensitivity analysis as we are interested in studying the behavior of simulations under ill posed conditions we exclude from the analysis those simulations in which the combination of parameters yield a well posed model as we have observed that the oscillations need space to grow until a maximum value section 5 1 we exclude those simulations in which the domain is not long enough to develop an oscillation that travels with a constant amplitude a set of 173 out of 256 simulations fulfills these two requirements in fig 5 a we plot the maximum flow depth h max nondimensionalized with the normal flow depth hn as a function of the discriminant eq 26 for the sake of clarity we plot the results of the simulations with a horizontal discretization length δx equal to 0 1 m and a thickness of the substrate layers equal to 0 01 m and 0 10 m see appendix c of the supplementary material for the results of all simulations the parameters used to evaluate the discriminant are those at the start of the simulation normal flow the vertical black lines join simulations with the same physical parameters i e they only differ regarding numerical parameters and the color of each dot is related to the thickness of the substrate layer the linear analysis has shown that the growth rate depends on the discriminant section 2 5 however there is only mild correlation between the discriminant and the maximum amplitude of the oscillations a thinly discretized substrate is associated with a larger amplitude of the oscillations fig 5a this effect can be seen only empirically since it is not a parameter of the system of equations nor does it appear in the linear stability analysis for all simulations we compute the flow depth that yields a value of the discriminant at the initial condition equal to 0 i e at the brink between ellipticity and hyperbolicity this is done numerically finding the root of δ als2 h eq 26 considering the water discharge and volume of sediment in the active layer and at the substrate of the initial condition we term this flow depth the hyperbolic flow depth hhyp which is independent of the numerical parameters of the simulation and depends on physical parameters only in fig 5b we compare the measured maximum flow depth and the hyperbolic flow depth the grey line represents the situation in which h m a x h h y p we see that the hyperbolic flow depth can be used as a rough estimate of the maximum flow depth that will occur in an elliptic simulation one important source of scatter is the fact that the hyperbolic flow depth depends on the initial condition only whereas the maximum flow depth also depends on the evolution of the solution as the oscillations interact with each other in fig 5c we plot the nondimensional maximum flow depth as a function of the streamwise location where the maximum flow depth occurs nondimensionalized with the total length of the domain for the sake of clarity we plot the results of the simulations with a thickness of the bookkeeping layers δz equal to 0 01 m see appendix c of the supplementary material for the results of all simulations in the thinly discretized simulations we find the maximum amplitude more upstream compared to the coarsely discretized simulations the location where the maximum amplitude of the oscillations is found is related to its growth rate since a faster growing oscillation develops its maximum amplitude in less distance than a slower one this result confirms the findings of linear stability analysis section 2 5 also the maximum flow depth and the domain discretization are mildly correlated similar to the vertical discretization smaller cells yield a larger maximum flow depth but this effect can be seen only empirically the discretization of the substrate affects also the duration of the elliptic behavior fig 6 shows the longitudinal profile of four simulations from the sensitivity analysis at the end of the run simulations 1 5 6 and 7 see table 3 the substrate of the well posed simulations at the end of the runs is unaltered whereas it has coarsened in the ill posed cases due to the oscillatory behavior which acts as a regularization mechanism section 5 1 a thinly discretized substrate enhances the regularization mechanism as one full layer is created with the grain size distribution of the coarse active layer during the aggrading phase of the oscillation if the bed is discretized into thick layers the material transferred to the substrate will be averaged with the sediment already present in the top substrate layer the resulting grain size distribution of the substrate may not be sufficiently coarse to prevent the model from being ill posed 6 implications of considering more than two size fractions or an unsteady active layer thickness to obtain an analytical expression of the eigenvalues we have restricted our analysis to mixtures of sediment composed of two size fractions and steady flow in this section we explore the consequences of relaxing these assumptions 6 1 ill posed domain of a three size fractions case a model for three sediment size fractions is too complex to obtain analytical expressions of the eigenvalues we therefore first attempt to provide insight addressing a specific case based on the results of the case for two size fractions the concept of a finer or coarser active layer relative to the substrate is unequivocally applicable in the case of two size fractions however this concept is not as straightforward for three size fractions as it requires the definition of a mean grain size as an extension of the results for the two size fractions case where the model can only be ill posed in degradational conditions into a substrate finer than the active layer assuming certain conditions on the closure relations section 3 1 we consider a situation with three size fractions which regardless of the method to compute the mean grain size is governed by degradation into a substrate coarser than the active layer this happens for instance if the volume fraction contents in the active layer of the fine medium and coarse size fractions are 0 5 0 5 and 0 respectively and at the interface are 0 5 0 and 0 5 we consider a sediment mixture with the above volume fraction contents and characteristic grain sizes of the fine medium and coarse fraction equal to 0 001 m 0 003 m 0 005 m all the other parameters are equal to the reference case table 2 this situation is elliptic as two of the eigenvalues of the system matrix are complex thus in a three size fractions case the mean grain size of the sediment in the active layer relative to that at the interface is not a valid discriminant of the mathematical character of the system of equations fig 7 shows the results of a numerical simulation based on the above parameters the solution presents oscillations as in the previous ill posed cases however the amplitude of these oscillations is now significantly smaller compare fig 7a to fig 4e a relatively large oscillation appears after approximately 3 h which entrains coarse sediment from the substrate fig 7b during the aggradational phase of the oscillations fine sediment from the active layer is transferred to the substrate thus at the end of the simulation the top part of the substrate is finer than initially fig 7c to illustrate the implications of this result we study the effects of discretizing the same sediment mixture into two or three sediment fractions to discretize the sample into three sediment fractions we use characteristic grain sizes equal to 0 001 m 0 003 m and 0 005 m and to discretize it into two sediment fractions we use 0 002 m and 0 004 m the volume fraction content in the medium size of the three fraction mixture is equally split between the fine and coarse bins of the two fraction mixture we vary all volume fraction contents between 0 and 1 to obtain different sediment mixtures and the flow depth keeping the water discharge per unit width constant between 0 15 m and 1 5 m to obtain different flow conditions all other parameters are equal to the reference case fig 8 a b shows the elliptic domain when the mixture is discretized into two and three size fractions respectively on the vertical axis we plot the difference between the mean grain size of the sediment in the active layer dma m and at the interface between the active layer and the substrate dmi m note that some situations that are well posed when the mixture is discretized into two fractions are ill posed when it is discretized into three fractions we cannot prove that the eigenvalues of the system matrix for three size fractions are always real under aggradational conditions due to the complexity of the expressions nevertheless we have not obtained a single complex value in any of the aggradational tests we have conducted 6 2 effect of an unsteady active layer thickness in the ill posed domain in this section we analyze the implications of considering a variable active layer thickness with respect to the ill posedness of the system of equations the flow needs to be considered unsteady to study the variability of the active layer thickness if it is related to dune growth section 3 we simplify the system assuming two sediment size fractions and negligible hiding stecca et al 2014 and appendix d of the supplementary material we obtain the characteristic polynomial of the system matrix eq 11 we prove that in aggradational and degradational conditions into a substrate coarser than the active layer the characteristic polynomial has 5 real roots appendix d of the supplementary material therefore the model is well posed regardless of the unsteady active layer thickness regarding degradational conditions into a substrate finer than the active layer we prove that if λ b λ s 1 f a 1 f 1 i considering a variable active layer thickness increases the likelihood of the model becoming elliptic note that assuming a similar order of magnitude of the bed and sorting celerities in conditions prone to be elliptic i e degradation into a substrate significantly finer than the active layer a variable active layer thickness increases the domain in which the active layer model is elliptic we numerically test several sets of parameters and we find no case where the model is hyperbolic if the active layer is unsteady but elliptic if it is constant appendix d of the supplementary material this suggests that although we do not provide a formal proof an unsteady active layer thickness always increases the likelihood of the model being ill posed 7 conclusions we have assessed the well posedness of the equations used to model mixed sediment river morphodynamics in particular we have studied the system formed by the flow equations saint venant 1871 together with the active layer model hirano 1971 and a simplified vertically continuous model viparelli et al 2017 our findings are the following considering two size fractions and the quasi steady flow assumption we obtain an analytical expression for the discriminant that determines whether the active layer and continuous models are ill posed assuming i two size fractions ii steady flow iii no reverse mobility and iv that under aggradational conditions the depositional flux of sediment to the substrate is entirely composed of active layer sediment the active layer model can be ill posed under degradational conditions into a substrate finer than the active layer only the use of a hiding factor increases the likelihood of ill posedness strong hiding that causes reverse mobility may cause ill posedness also in aggradational conditions aggradational cases may be ill posed if the depositional flux of sediment to the substrate includes bedload sediment hoey and ferguson 1994 the active layer model may be ill posed in degradational conditions into a substrate coarser than the active layer if more than two size fractions are considered considering a variable active layer thickness associated with dune growth increases the likelihood that the active layer model is ill posed the simplified vertically continuous model can be ill posed under both aggradational and degradational conditions a small vertical gradient of the probability of bed elevation and volume fraction content decreases the likelihood of the model being ill posed ill posedness results in non physical oscillations that grow until a maximum amplitude is reached at which the model recovers its hyperbolic character and becomes well posed the non physical oscillations itself act as a regularizing mechanism by coarsening the substrate the numerical solution of an ill posed problem may be reliable if perturbations do not have space and or time to grow or if the consequences of the perturbations are negligible compared to the accuracy of the problem data however the reliability of the solution becomes subjective this implies that it is up to the modeller to decide whether a solution is representative of the physical phenomenon under consideration in a well posed model a finer grid provides more accurate results this is opposite in ill posed models as the growth rate of oscillations decreases with grid size thus if a model is ill posed one may be tempted to use a larger grid size such that oscillations do not have space to grow and numerical viscosity is sufficient to suppress the consequences of ill posedness we do not recommend to follow this strategy because of the subjectivity of the solution we do not recommend discarding the active layer and vertically continuous models for modeling mixed sediment river morphodynamics the former has proven its validity over a large range of situations section 1 and the latter is yet a simplified version of a continuous sediment conservation model moreover both models are well posed for a vast range of situations the ill posedness of the system of equations is a fundamental mathematical problem independent of the numerical solver it can only be solved by an improved set of equations that represents physical processes in a better way than existing models do in this regard we are currently conducting laboratory experiments to investigate the physical mechanisms that are relevant under conditions in which the active layer model is ill posed one may want to introduce minimal changes to the active layer model to regularize it i e to ensure that the model is always well posed in this case the most straightforward solution is to check whether the model is ill posed and to change the active layer thickness to a value that provides a well posed model one needs to be aware that this approach is not simply a numerical trick as it implies a change of the time scale of the physical processes under consideration moreover it implies a temporal change of the active layer thickness which may be relatively large and local preliminary simulations show that this solution is not always stable another possibility may be to artificially modify the celerities without changing the actual thickness of the active layer a similar approach has been used by zanotti et al 2007 to regularize the ill posed two layer shallow water model current work by the authors builds on this idea acknowledgments this research is part of the research programme rivercare supported by the applied and engineering sciences ttw division of the netherlands organization for scientific research nwo and which is partly funded by the ministry of economic affairs under grant number p12 14 perspective programme guglielmo stecca is supported by a marie curie outgoing fellowship within the european union s seventh framework programme for research technological development and demonstration under grant agreement no piof ga 2013 621886 we acknowledge the editorial work by dr d odorico and the comments of two anonymous reviewers who helped in clarifying the message the fruitful discussions and comments on the manuscript of liselot arkesteijn and robert jan labeur are gratefully acknowledged appendix a flow equations the water phase is mathematically described by the saint venant equations saint venant 1871 in which mass conservation is represented by the continuity equation a 1 h t q x 0 where t s denotes the time coordinate x m the streamwise coordinate and q u h m2 s the water discharge per unit width the balance of streamwise momentum is represented by a 2 q t q 2 h g h 2 2 x g h η x g h s f where η m denotes the bed elevation and sf the friction slope considering steady flow the conservation of water mass eq a 1 reduces to a spatially constant discharge and the conservation of momentum eq a 2 to the backwater equation a 3 h x 1 1 f r 2 η x s f 1 f r 2 appendix b active layer equations the conservation of the total amount of sediment in the bed is represented by the exner equation exner 1920 b 1 η t q b x 0 where qb m2 s is the sediment transport rate per unit width multiplied by 1 1 p where p is the bed porosity i e the sediment transport rate qb accounts for pores for simplicity mechanisms such as subsidence and uplift compaction and dilation of sediment are neglected in the above equation paola and voller 2005 of special relevance is the implicit assumption that the temporal change of the storage of sediment within the water column and its effects on bed elevation are negligible park and jain 1987 stevens 1988 correia et al 1992 morris and williams 1996 we consider that there is no lag between changes in bottom bed shear stress bell and sutherland 1983 jain 1992 worded differently the sediment transport rate is at capacity and adapts instantaneously to the flow field thus the sediment transport rate does not require a constitutive equation and is treated as a closure relation assuming constant porosity and density the active layer equation describes the conservation of mass of grain size fraction k in the active layer hirano 1971 b 2 m a k t f k i η l a t q b k x 0 where mak m is the volume of sediment of size fraction k in the active layer per unit of bed area f k i is the volume fraction content of size fraction k at the interface between the active layer and the substrate f k i 0 1 la m is the active layer thickness and qbk m2 s is the sediment transport rate per unit width of size fraction k multiplied by 1 1 p the addition of the sediment transport rate for each size fraction equals the total amount of sediment in transport including pores b 3 q b k 1 n q b k assuming constant porosity and density mass conservation of sediment of size fraction k in the substrate is expressed by b 4 m s k t f k i η l a t 0 where msk m is the sediment volume of size fraction k in the substrate per unit of bed area the volume of sediment per unit of bed area in the active layer and the substrate are defined as b 5 m a k f a k l a m s k η 0 η l a f s k z d z where fak is the volume fraction content of size fraction k in the active layer fak 0 1 fsk z is the volume fraction content of size fraction k in the substrate at elevation z m fsk z 0 1 and η 0 m is the time invariant datum for bed elevation the volume fraction contents are constrained by the equations b 6 k 1 n f k i 1 k 1 n f a k 1 k 1 n f s k z 1 thus the volume of sediment per unit of bed area is constrained by the equations b 7 k 1 n m a k l a k 1 n m s k η l a η 0 the summation of n active layer equations yields the exner equation ribberink 1987 parker et al 2000 as the active layer equation b 2 represents fractional mass conservation of sediment and the exner equation b 1 represent the conservation of the total amount of sediment thus to consider n active layer equations is equivalent to considering n 1 active layer equations and the exner equation we here choose for the second option as in this way the conservation of sediment mass per size fraction can be considered as an extension of the unisize model the substrate equation b 4 is a linear combination of the exner equation b 1 and the active layer equation b 2 which means that the substrate equation does not play a role in the mathematical behavior of the system and can be treated in a decoupled manner appendix c sediment transport closure relation the sediment transport rate of size fraction k per unit width including pores qbk is expressed as the product of the volume fraction content of size fraction k at the bed surface fbk and the sediment transport capacity qbk m2 s which is the sediment transport we would obtain if the bed was formed by unisize sediment yet including hiding effects deigaard and fredsøe 1978 ribberink 1987 armanini 1995 c 1 q b k f b k q b k the sediment transport capacity is the product of a nondimensional sediment transport rate q b k and the parameter g r d k 3 einstein 1950 c 2 q b k q b k g r d k 3 1 p where we account for the volume of pores multiplying by 1 p r ρ s ρ w 1 is the submerged specific gravity ρ s 2650 kg m3 the sediment density and ρ w 1000 kg m3 the water density the volume fraction content of size fraction k at the bed surface is constrained by the condition c 3 k 1 n f b k 1 in the active layer model the volume fraction content of size fraction k at the bed surface is considered to be equal to the volume fraction content in the active layer f b k f a k in the vertically continuous model developed by viparelli et al 2017 it is considered equal to the integral of the volume fraction content of size fraction k in the bed sediment weighted by the elevation s exposure to the flow c 4 f b k f k y p e y d y the sediment transport rate q b k is related to the mean characteristics of the flow here we consider a generalized form of the meyer peter and müller 1948 transport relation which estimates sediment transport as a power function of the excess bed shear eq 6 the nondimensional bed shear stress of size fraction k or shields 1936 parameter is computed as θ k c f u 2 g r d k a commonly used hiding relation is the one due to egiazaroff 1965 c 5 ξ k log 10 19 log 10 19 d k d m 2 where dm m is a characteristic mean grain size of the mixture obtained as an average of the grains in movement and in the bed surface in practical terms dm is computed as the arithmetic mean e g wu et al 2000 geometric mean e g bettess and frangipane 2003 or the median grain size e g van niekerk et al 1992 kleinhans et al 2002 of the bed surface sediment a simpler expression was developed by parker et al 1982 c 6 ξ k d m d k b where the characteristic mean grain size is the median grain size d 50 of the subpavement sediment below an armor layer parker et al 1982 or the geometric mean of the surface sediment parker 1990 if the nondimensional parameter b is equal to 0 there is no hiding effect and each grain size behaves independently of each other if b 1 the sediment transport of each size fraction is independent of its grain size for b 1 5 thus only depends on its presence at the surface fbk buffington and montgomery 1997 made an inventory of values of b spanning between 0 32 and 1 25 a value of b 1 implies reverse mobility solari and parker 2000 in this paper we compute the characteristic mean grain size dm as the geometric mean c 7 d m d ref 2 k 1 n f b k log 2 d k d ref where d ref 1 mm is a reference grain size that makes the grain size on ϕ scale nondimensional appendix d system of equations of the steady vertically continuous model consisting of two size fractions the vector of dependent variables q vcs2 is d 1 q vcs2 η f 1 t the vector of source terms is d 2 s vcs2 s f u ψ 1 f r 2 1 p e p e g 1 t and the system matrix is d 3 a vcs2 u ψ 1 f r 2 1 p e x 1 ψ 1 f r 2 p e p e g 1 x 1 1 p e m 1 1 parameters g 1 x 1 m 1 1 and δ 1 1 are the equivalent of parameters γ 1 χ 1 μ 1 1 and d 1 1 in the active layer model section 3 1 d 4 g 1 c 1 φ 1 d 5 φ 1 1 p e f 1 p e y d 6 x 1 p e u q b f 1 d 7 m 1 1 δ 1 1 φ 1 d 8 δ 1 1 p e u x 1 q b 1 f 1 the eigenvalues of the system matrix eq d 3 nondimensionalized dividing by the flow velocity are d 9 λ vcs2 i 1 2 λ b λ s c 1 δ vcs2 for i 1 2 where the discriminant is d 10 δ vcs2 λ b λ s c 1 2 4 λ b λ s c 1 g 1 m 1 1 we define λ sc1 as the nondimensional sorting celerity of the vertically continuous model as the equivalent of the sorting celerity in the active layer model in eq 28 d 11 λ s c 1 x 1 m 1 1 p e supplementary material supplementary material associated with this article can be found in the online version at 10 1016 j advwatres 2018 02 011 appendix e supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
849,in this paper we analyze the hirano active layer model used in mixed sediment river morphodynamics concerning its ill posedness ill posedness causes the solution to be unstable to short wave perturbations this implies that the solution presents spurious oscillations the amplitude of which depends on the domain discretization ill posedness not only produces physically unrealistic results but may also cause failure of numerical simulations by considering a two fraction sediment mixture we obtain analytical expressions for the mathematical characterization of the model using these we show that the ill posed domain is larger than what was found in previous analyses not only comprising cases of bed degradation into a substrate finer than the active layer but also in aggradational cases furthermore by analyzing a three fraction model we observe ill posedness under conditions of bed degradation into a coarse substrate we observe that oscillations in the numerical solution of ill posed simulations grow until the model becomes well posed as the spurious mixing of the active layer sediment and substrate sediment acts as a regularization mechanism finally we conduct an eigenstructure analysis of a simplified vertically continuous model for mixed sediment for which we show that ill posedness occurs in a wider range of conditions than the active layer model keywords river morphodynamics ill posedness mixed sediment 1 introduction the mixed character of the sediment is a property necessary to explain physical phenomena such as downstream fining sternberg 1875 blom et al 2016 the gravel sand transition zone yatsu 1955 blom et al 2017 the formation of bedload sheets seminara et al 1996 or bed surface armoring parker and klingeman 1982 hirano 1971 was the first to develop a mass conservation model for mixed size sediment the model assumes that the topmost part of the bed i e the active layer interacts with the flow and is instantaneously mixed below the active layer lies the substrate which can have vertical stratification in this schematic representation of the morphodynamic processes only the active layer sediment is affected by entrainment and depositional processes a vertical flux of sediment originates from changes in elevation of the interface between the active layer and the substrate one of the critical aspects of the active layer model is the fact that the vertical extent of the active layer or active layer thickness shall be a priori assigned however it cannot be physically measured as it stems from the above schematic representation siviglia et al 2017 church and haschenburger 2017 the active layer thickness is related to the time scale of the process under consideration bennett and nordin 1977 rahuel et al 1989 sieben 1997 wu 2007 in plane bed conditions and short time scales the active layer thickness is assumed to be proportional to the size of a characteristic coarse fraction in the bed for instance d 84 or d 90 e g petts et al 1989 rahuel et al 1989 parker and sutherland 1990 if bed forms are predominant and the time scale under consideration involves the mixing induced by the passage of several bed forms the active layer thickness is typically related to a characteristic bed form height e g deigaard and fredsøe 1978 lee and odgaard 1986 armanini and silvio 1988 the active layer thickness may vary over space and time although often it is assumed to be a uniform constant the active layer modeling framework has proven to be able to represent a wide variety of physical phenomena such as bed surface armoring e g park and jain 1987 and the morphodynamics of gravel bed rivers e g vogel et al 1992 and tidal basins e g carniello et al 2012 moreover it is implemented in a large amount of software packages such as telemac villaret et al 2013 delft3d sloff and mosselman 2012 and basement vetsch et al 2006 the mathematical representation of river morphodynamics should be well posed this means that the mathematical problem must have a unique solution which depends continuously on the data hadamard 1923 if the solution does not depend continuously on the data the model is unfit to represent the corresponding physics despite its widespread use the active layer model has one major mathematical shortcoming the model can change its mathematical character under some parameter settings therefore the mathematical problem that represents the physics of river morphodynamics can become ill posed this fact was first recognized by ribberink 1987 to this end he simplified the active layer model by considering an equation for the mean grain size of the active layer sediment rather than one active layer equation for each grain size fraction he found that under aggradational conditions the problem is unconditionally well posed and the system may become ill posed under degradational conditions if the substrate is finer than the active layer i e degradation in an armored river ribberink 1987 included a third layer between the active layer and the substrate to model the effects of dunes exceptionally larger than the average dune height although this model includes more physical mechanisms and improves the prediction of mixed sediment processes in dune dominated cases it may still become ill posed sieben 1994 to understand the conditions in which the active layer model becomes ill posed we focus on how information propagates along a river we first consider a certain reach characterized by normal flow and immobile sediment a perturbation of the flow propagates along the river in the form of two waves traveling at speeds equal to u g h where u m s denotes the mean flow velocity h m the flow depth and g m s2 is the acceleration due to gravity if sediment is mobile yet uniform a perturbation in bed elevation e g a sediment hump will propagate with a speed that is termed the bed celerity de vries 1965 lyn and altinakar 2002 stecca et al 2014 as the bed elevation affects the flow the bed elevation perturbation also induces a perturbation of the flow thus under unisize sediment conditions a perturbation of the bed elevation leads to three waves fig 1 a although each of the waves perturb both bed elevation and flow two of the waves perturb mainly the flow without much change in bed level if the froude number f r u g h is sufficiently small de vries 1973 needham 1990 zanré and needham 1994 the consideration of mixed sediment of two size fractions to simplify the example introduces another celerity which is termed the sorting celerity suzuki 1976 ribberink 1987 stecca et al 2014 thus under mixed sediment conditions with two grain sizes a perturbation of bed elevation causes four waves although each wave perturbs the flow bed elevation and surface grain size distribution two of these perturb mainly the flow one mainly the bed level and one mainly the surface grain size distribution ribberink 1987 stecca et al 2014 fig 1b sieben 1994 identified a region of parameters where for a sediment mixture consisting of two grain size classes under bed degradation into a substrate finer than the active layer the model is unconditionally ill posed this occurs when the sorting celerity equals the bed celerity this was confirmed by stecca et al 2014 who observed through numerical computation of the system eigenvalues such model behavior also in case of more than two sediment fractions furthermore stecca et al 2014 analytically confirmed the outcomes of ribberink s analysis using a more realistic unsteady model for two sediment size fractions they considered grain size selectivity of the bedload but hiding in a limited manner hiding accounts for the fact that grain size fractions finer than a characteristic mean grain size of the mixture hide behind larger grains and so they experience a larger critical bed shear stress compared to the unisize case einstein 1950 komar 1987a 1987b the opposite happens for coarse sediment fractions which experience a larger exposure to the flow than in a unisize case in their analysis stecca et al 2014 showed that the model can become ill posed under degradational conditions if and only if the substrate is finer than a reference grain size distribution which is related to the grain size distribution of the bedload instead of the active layer as in ribberink s 1987 analysis to overcome the problem of setting the active layer thickness parker et al 2000 developed a stochastic framework without the need for a distinction between the active and inactive parts of the bed blom and parker 2004 blom et al 2006 and blom et al 2008 developed a model that accounts for dune sorting and the variability of bed elevation based on the stochastic framework developed by parker et al 2000 the model associates a probability of grain size selective entrainment to all elevations within the bed and hence allows for sediment at any elevation to be entrained and contribute to the bedload discharge viparelli et al 2017 developed a simplified vertically continuous model assuming slow changes in bed elevation and a steady probability distribution of entrainment deposition and bed elevation which make their model suitable for large space and time domains so far the well posedness of the continuous model has never been assessed our main objective is to analyze the problem of ill posedness of the active layer model used for mixed sediment morphodynamics the present paper provides four key improvements with respect to presently available knowledge i we obtain analytical expressions to characterize a simplified model i e to find whether it is ill posed or well posed with two sediment fractions only ii we study the effect of model parameter choice on ill posedness iii we find new previously neglected ill posed domains and iv we study the consequences of ill posedness in numerical simulations our second objective is to mathematically characterize the vertically continuous model developed by viparelli et al 2017 in the next section we present the general set of equations for modeling mixed sediment river morphodynamics using a the active layer model and b the vertically continuous model developed by viparelli et al 2017 the models are simplified and analyzed in section 3 we analyze the effect of model parameters on the ill posedness of the active layer model in section 4 in section 5 we study the consequences of ill posedness using numerical runs in section 6 we relax and study the simplifications of our analysis 2 model equations in this section we present the equations used to model river morphodynamics these equations represent one dimensional hydrostatic flow over a mobile bed composed of an arbitrary number n of non cohesive sediment fractions characterized by a grain size dk m where the subscript k identifies each fraction in increasing size i e d 1 d 2 d n in the following section we describe the flow equations as previous research has clarified ribberink 1987 stecca et al 2014 a key parameter in determining well posedness of the active layer model is the active layer thickness in this paper we both consider a model with constant and with unsteady time varying active layer thickness while the well posedness of the model with constant active layer thickness has been analyzed in previous work ribberink 1987 stecca et al 2014 to our knowledge no analysis of the well posedness of the model with unsteady active layer thickness is available although use of such a model is documented in the literature e g karim et al 1983 the equations of the adapted active layer model are presented in section 2 2 in section 2 3 we present the vertically continuous model derived by viparelli et al 2017 the closure relations for both models are treated in section 2 4 in section 2 5 we present a compact matrix formulation of the model equations 2 1 flow equations the flow is described by the 1d shallow water equations i e the saint venant equations saint venant 1871 considering constant width assuming steady flow conditions the water discharge is uniform and conservation of momentum reduces to the so called backwater equation appendix a when assuming steady flow over a movable bed composed of sediment of different sizes we implicitly assume that the flow adapts instantaneously to perturbations in bed elevation and grain size distribution worded differently we assume that flow perturbations propagate infinitely fast relative to perturbations in bed elevation and surface grain size distribution this assumption is referred to in literature as the quasi steady flow assumption de vries 1965 zhang and kahawita 1987 1990 cao and carling 2002a the quasi steady flow assumption is acceptable provided that the froude number is sufficiently small 1 f r 2 o 1 de vries 1973 sieben 1999 lyn and altinakar 2002 note that in this context the term quasi steady has a meaning different from for instance its use in the modeling of flood waves where quasi steady refers to negligible inertia in the momentum balance 2 2 adapted active layer model equations the conservation of the total amount of sediment in the bed is formulated by the exner equation exner 1920 the active layer equation describes mass conservation for each size fraction hirano 1971 appendix b presents the details of the active layer model to analyze the model with unsteady active layer thickness we first need to set a closure relation expressing the thickness change in time we consider an empirical empirical power relation between dune height h m and flow depth h m yalin 1964 gill 1971 1 h a l h b l where al m 1 b l and bl are constants allen 1968a b proposed values of a l 0 1 0 2 m 1 b l and b l 0 9 1 2 with h in m assuming that the active layer thickness la m is equal to the mean dune height blom 2008 we relate the active layer thickness to the flow depth as follows 2 l a a l h b l to obtain an equation for the active layer thickness variation we differentiate the constitutive law eq 2 with respect to time and then substitute the continuity eq a 1 in it 3 l a t a l b l h b l 1 q x substitution of eq 3 into the active layer eq b 2 yields the following adapted active layer equation 4 m ak t f k i q b x f k i a l b l h b l 1 q x q bk x 0 where t s denotes the time coordinate x m the streamwise coordinate q u h m2 s the water discharge per unit width qb m2 s is the sediment transport rate per unit width multiplied by 1 1 p where p is the bed porosity i e the sediment transport rate qb accounts for pores qbk m2 s is the sediment transport rate per size fraction mak m is the volume of sediment of size fraction k in the active layer per unit of bed area and f k i is the volume fraction content of size fraction k at the interface between the active layer and the substrate in fig 2 we show a schematic representation of the main variables of the active layer model 2 3 simplified vertically continuous model equations the conserved quantity in the vertically continuous model similar to mak in the active layer model is the product of the cumulative probability of bed elevation pe and the volume fraction content of a specific grain size class k fk parker et al 2000 pelosi et al 2014 the vertical coordinate is z m to simplify the problem the probability distribution depends on a second vertical coordinate y z η which is centered at the mean bed elevation assuming slow changes in mean bed elevation and a constant in time and space probability distribution of bed elevation viparelli et al 2017 obtain an equation for the change in time of the volume fraction content fk 5 p e f k t p e q b k x q b x f k p e y where pe m 1 is the probability density function of bed elevation fig 2 as in the active layer model information is only advected in streamwise direction i e the conservation equation does not include divergence terms in the y direction and the only independent variable in space is x in contrast to the active layer model there is no inactive substrate and sediment at all elevations plays a role this is illustrated by the dependence of the probability function on the y coordinate and the gradient in the y direction in eq 5 thus although the system of equations is one dimensional the mathematical character of the model is a property depending not only on the streamwise coordinate x but also on the vertical coordinate y 2 4 closure relations we apply the chézy law for the friction slope thus the friction slope is proportional to the square of the mean flow velocity divided by the flow depth s f c f u 2 g h where cf is a nondimensional friction coefficient for simplicity we assume a constant nondimensional friction coefficient that is independent of the flow and bed parameters we apply a generalized form of the meyer peter and müller 1948 transport relation in which the sediment transport rate is a power function of the excess bed shear stress 6 q b k a max θ k ξ k θ c 0 b where q b k is a nondimensional sediment transport rate appendix c a and b are nondimensional parameters θk is the nondimensional bed shear stress of size fraction k also known as shields 1936 parameter θc is the nondimensional critical bed shear stress and ξk is the hiding coefficient table 1 summarizes appropriate values of a b and θc according to several authors a common hiding function is the one due to egiazaroff 1965 appendix c a simpler relation was developed by parker et al 1982 7 ξ k d m d k b where dm m is a characteristic mean grain size and b is a nondimensional parameter a value of b 1 dhamotharan et al 1980 misri et al 1984 kuhnle 1993 implies that hiding is so strong that the coarser fraction s in the mixture is are more mobile than the finer one s i e reverse mobility solari and parker 2000 a final closure relation is required only for the active layer model for the volume fraction content of sediment of size fraction k at the interface between the active layer and the substrate f k i when the interface lowers the texture at the interface is equal to that at the topmost part of the substrate when the interface elevation increases various relations can be applied for f k i hirano 1971 proposed that during aggradation the grain size distribution at the interface is equal to the one of the active layer according to parker 1991 also the bedload sediment plays a role in the aggradational flux to the substrate hoey and ferguson 1994 combined both concepts in one parameter α spanning the range 0 1 that describes the contribution of the active layer relative to the one of the bedload 8 f k i f s k z η l a if η l a t 0 α f a k 1 α p k if η l a t 0 where p k q b k q b is the fraction of sediment transport rate of size fraction k 2 5 matrix formulation in this section we introduce a matrix formulation to asses the well posedness of the system of equations a system of partial differential equations pdes can be mathematically classified as being of a hyperbolic elliptic or mixed type e g courant and hilbert 1989 to this end we write the problem in matrix vector form e g toro 2001 9 q t a q x s this equation is the one dimensional quasi linear non conservative form of the advection equation q is the vector of dependent variables a is the system matrix and s is the vector of source terms a system is hyperbolic at a point x t if all the eigenvalues of matrix a are real physical propagation problems are modeled with hyperbolic systems of equations if all eigenvalues are complex the system is termed elliptic elliptic systems model equilibrium physical problems if matrix a has both real and complex eigenvalues it is a mixed type system a space time dependent problem in which we prescribe boundary conditions as a function of time and an initial condition as is the case in modeling river morphodynamics governed by an elliptic set of equations is ill posed hadamard 1923 joseph and saut 1990 kabanikhin 2008 this is confirmed by a perturbation analysis that shows that if all eigenvalues of matrix a are real perturbations of a reference state are bounded appendix a in the supplementary material however if there is at least one complex eigenvalue or precisely at least two because of the complex conjugate perturbations grow exponentially the exponential growth depends on the product of the imaginary part of the eigenvalues and the wave number of the perturbation which implies that the solution of an ill posed problem is unstable to short perturbations attempts to numerically integrate an ill posed problem therefore produce results that continue to change as the grid is refined woodhouse et al 2012 barker et al 2015 as in numerical solutions perturbations always exist due to at least truncation errors in numerical simulations the wave number of the shortest possible perturbation is inversely related to the horizontal discretization δx by only using the eigenvalues of a to characterize the system of equations we are neglecting the effect of friction appendix a in the supplementary material yet this suffices here as friction becomes relevant for small wave numbers only appendix a in the supplementary material and the most critical wave numbers as regards to oscillation growth are the large ones as a single complex pair of eigenvalues makes the problem ill posed we do not make a distinction between the number of complex eigenvalues we term a problem with at least a pair of complex eigenvalues as elliptic we recast in matrix vector form the saint venant equations a 1 and a 2 the exner equation b 1 the active layer thickness equation 3 and the adapted active layer equation 4 the vector of dependent variables is 10 q al h q η l a m a k n 1 t the system matrix is 11 and the vector of source terms is 12 s al 0 g h s f 0 0 0 n 1 t the brackets highlight those terms that are vectors or matrices we also recast in matrix vector form the saint venant equations a 1 and a 2 the exner equation b 1 and the conservation equation of the vertically continuous model eq 5 the vector of dependent variables is 13 q vc h q η f k n 1 t the system matrix is 14 and the vector of source terms is 15 s vc 0 g h s f 0 0 n 1 t 3 characterization of the mathematical models in this section we analyze the mathematical character of the models described in section 2 eigenvalues computed numerically can be obtained for an unlimited number of fractions here we study a simple case assuming steady flow and two size fractions to obtain analytical expressions of the eigenvalues as in our case the temporal change of the active layer thickness depends on the spatial gradient of the water discharge per unit width eq 3 the steady flow assumption implies a constant active layer thickness yet in a numerical simulation where the steady flow assumption is used but the upstream discharge varies with time i e alternating steady flow the active layer thickness may vary with time however in such a case the perturbations due to a change in active layer thickness propagate infinitely fast relative to the perturbations in bed elevation and surface grain size distribution the implications of more than two sediment size fractions and an active layer thickness as a function of the flow depth are studied in section 6 3 1 steady active layer model consisting of two size fractions substitution of the backwater equation a 3 in the exner equation b 1 and the active layer equation b 2 allows us to obtain a reduced model where the vector of dependent variables q als2 is 16 q als2 η m a 1 t the vector of source terms s als2 reads 17 s als2 s f u ψ 1 f r 2 1 γ 1 t and the system matrix a als2 is 18 a als2 u ψ 1 f r 2 χ 1 ψ 1 f r 2 γ 1 χ 1 μ 1 1 we define ψ as 19 ψ q b q which is a parameter related to the intensity of total bedload in the flow and ranges between 0 null sediment discharge i e fixed bed and o 10 2 high sediment discharge e g de vries 1965 lyn and altinakar 2002 stecca et al 2014 the parameter γ 1 is a measure of the fraction content of sediment in transport relative to the fraction content of sediment at the interface between the active layer and the substrate stecca et al 2014 20 γ 1 c 1 f 1 i where c 1 0 1 is a parameter expressing the increase in the sediment transport intensity of the fine fraction relative to the total sediment transport intensity stecca et al 2014 21 c 1 1 ψ q b 1 q we now introduce the parameter χ 1 which is a nondimensional measure of the derivative of the total sediment transport rate with respect to the volume of fine sediment in the active layer 22 χ 1 1 u q b m a 1 the parameter μ 1 1 is defined as 23 μ 1 1 d 1 1 f 1 i where d 1 1 is a nondimensional measure of the derivative of the sediment transport rate of the fine fraction with respect to the volume of fine sediment in the active layer 24 d 1 1 1 u χ 1 q b 1 m a 1 we obtain the eigenvalues of the system matrix finding the roots of its second degree characteristic polynomial the eigenvalues are nondimensionalized dividing by the flow velocity 25 λ als2 i 1 2 λ b λ s 1 δ als2 for i 1 2 where the discriminant is 26 δ als2 λ b λ s 1 2 4 λ b λ s 1 γ 1 μ 1 1 the eigenvalues of the system carry coupled information on both the bed elevation and the surface grain size distribution which shows that a perturbation in bed elevation causes a perturbation in surface grain size distribution and vice versa section 1 yet we identify two nondimensional celerities that approximate the changes in bed elevation λb and in surface grain size distribution λ s1 independently the bed celerity which is independent of the active layer thickness was first derived by de vries 1965 for unisize sediment 27 λ b ψ 1 f r 2 we define the nondimensional sorting celerity as 28 λ s 1 χ 1 μ 1 1 this sorting celerity differs from the one of ribberink 1987 as he considered a perturbation in the mean grain size while here the sorting celerity relates to a perturbation in the volume fraction content of each grain size fraction individually the proposed expression for the sorting celerity in eq 28 is a generalization of the expression proposed by stecca et al 2014 as we have relaxed stecca s assumption of limited hiding the mathematical character of the model depends on the sign of the discriminant δ als2 eq 26 if δ als2 0 the two eigenvalues are real and the system is hyperbolic if δ als2 0 the eigenvalues are complex and the system is elliptic a large difference between the bed celerity and sorting celerity reduces the likelihood that the model becomes elliptic hyperbolicity is guaranteed if γ 1 0 if γ 1 0 and the bed and sorting celerities are equal ellipticity is guaranteed sieben 1994 stecca et al 2014 assuming that reverse mobility does not occur section 2 4 c 1 is larger than the volume fraction content of fine sediment in the active layer f a1 due to the grain size selectivity of the sediment transport relation stecca et al 2014 if we also assume that the sediment transferred to the substrate in aggradational conditions has the same grain size distribution as the active layer hirano 1971 then the parameter γ 1 is always positive in aggradational conditions only a substrate finer than the active layer yields a negative value of the parameter γ 1 thus a two fraction active layer model can only be ill posed if the bed degrades into a substrate that is finer than the active layer a result also found by stecca et al 2014 considering unsteady flow in sections 4 1 and 4 2 we assess the relaxation of the assumptions that reverse mobility does not occur and that the aggradational flux to the substrate has the same grain size distribution as the active layer 3 2 steady vertically continuous model consisting of two size fractions we apply the same procedure used to analyze the active layer model to the vertically continuous model section 2 3 in this manner we obtain the discriminant of the eigenvalues appendix d 29 δ vcs2 λ b λ s c 1 2 4 λ b λ s c 1 g 1 m 1 1 where λ sc1 g 1 and m 1 1 are the equivalents to λ s1 γ 1 and μ 1 1 of the active layer model appendix d similar to the active layer model section 3 1 the continuous model is hyperbolic and well posed if δ vcs2 0 and vice versa although the expression of the discriminant of the vertically continuous model eq 29 is similar to the one of the active layer model eq 26 there is an essential difference between the two in the active layer model the discriminant is a function of the streamwise position δ als2 x yet in the continuous model the discriminant is also a function of the vertical coordinate δ vcs2 x y thus ellipticity or hyperbolicity is a property not only of the streamwise coordinate but also of the elevation in the bed section 2 3 hyperbolicity is guaranteed if g 1 0 but contrary to the active layer model this parameter can be negative both under aggradational and degradational conditions due to grain size selective transport we can assure that if reverse mobility conditions do not prevail the concentration c 1 is larger than the volume fraction content representative of the bed surface f b1 eq c 4 however f b1 is a weighted average of all sediment and for this reason there is no guarantee that for all bed elevations the average volume fraction content f b1 is larger than the local volume fraction content in the bed sediment f 1 moreover as there is no distinction between aggradational and degradational cases the domain in which the model is likely to be ill posed is larger than for the active layer model the presence of fine sediment at the locations having larger probability of entrainment in combination with a smooth vertical variation small derivative of the volume fraction content of fine sediment reduces the likelihood of the model becoming elliptic 4 active layer model parameter study in this section we assess the effects of various model parameters on the mathematical character of the active layer model to this end we study the analytical expressions of the eigenvalues of the steady model considering two sediment size fractions obtained in section 3 1 4 1 hiding given the fact that ill posedness arises when considering different grain sizes in the mixture and that a larger difference between grain sizes increases the ill posed domain intuitively hiding should reduce the likelihood of ill posedness its effect however is opposite as we will show here to explain this counter intuitive result we analyze the term in the characteristic polynomial intrinsically related to hiding this term is the derivative of the sediment transport rate of fine and coarse sediment with respect to the volume of fine sediment in the active layer qbk m a1 it can be considered as the summation of two terms 30 q b k m a 1 1 l a f a k f a 1 q b k presence f a k q b k f a 1 hiding for k 1 2 we name the first and second terms on the right hand side the presence term and the hiding term respectively the presence term explains that an increase in the volume fraction content of the fine sediment in the active layer implies both 1 an increase of the sediment transport rate of the fine fraction as its presence at the bed surface is larger and 2 a consequent decrease of the sediment transport rate of the coarse fraction because its presence at the bed surface decreases the hiding term indicates the fact that a variation of the volume fraction content of the fine sediment changes the sediment transport rate of both fine and coarse fractions due to a change in the mean grain size of the sediment mixture the presence term is positive for the fine fraction and negative for the coarse fraction the hiding term is always positive in a situation where hiding is negligible an increase of the characteristic size of the coarse fraction or decrease of the fine fraction which is associated with a larger likelihood that the model is elliptic causes an increase of the presence term and thus of qbk m a1 with respect to such a situation hiding decreases the presence term of both fine and coarse sediment reducing the likelihood of ellipticity but introduces the positive contribution of the hiding term overall the hiding term may dominate which increases the value of qbk m a1 and thus of the likelihood of ellipticity interestingly in degradational conditions into a fine substrate a situation prone to be elliptic the hiding term dominates thus hiding increases the likelihood that the model is elliptic in degradational conditions into a substrate finer than the active layer in fig 3 a we show the effect of hiding on the discriminant of the steady active layer model considering two size fractions eq 26 we consider the reference case described in table 2 the sediment transport rate is computed using the relation derived by meyer peter and müller 1948 to obtain different values of hiding we vary parameter b in the power law hiding function in eq 7 between 0 and 1 purple line in fig 3a the yellow line in fig 3a is obtained varying the characteristic grain size of the fine fraction between 0 001 m and 0 004 m using the egiazaroff hiding relation eq c 5 the discriminant decreases for increasing hiding independent from the hiding function besides these cases under degradational conditions we may encounter problems even under aggradation in fact if hiding is so strong that reverse mobility is induced then one of the assumptions of the analysis by stecca et al 2014 may not be fulfilled in detail it may happen that the reference content c 1 related to the fine sediment in the bedload eq 21 is not greater than the content of fines in the active layer f a1 which was their assumption under grain size selective transport when reverse mobility instead determines conditions such that c 1 f a1 then the discriminant eq 26 may be negative and the model may become elliptic even under aggradational conditions 4 2 aggradational flux to the substrate the sediment transferred to the substrate under aggradational conditions using the model by hoey and ferguson 1994 section 2 4 is always finer than the sediment in the active layer this is because the bedload is finer than the bed surface due to grain size selective processes provided that reverse mobility does not dominate thus application of the model by hoey and ferguson 1994 implies that under aggradational conditions the interface between the active layer and the substrate is finer than the active layer this means that the condition γ 1 0 section 3 1 may not be fulfilled under aggradational conditions which implies that the model may become ill posed therefore a larger contribution of the bedload to the aggradational flux to the substrate smaller value of the parameter α in eq 8 implies a larger likelihood of the model becoming elliptic appendix b in the supplementary material however in a hypothetical aggrading case in which the grain size distribution transferred to the substrate is fully composed of bedload sediment α 0 the relative content of the fine fraction in the vertical sediment flux γ 1 eq 20 that controls the size of the ill posed domain section 3 1 is still not as small as it can be found under degradational cases appendix b in the supplementary material thus ill posed cases are expected to occur primarily under degradational conditions into a fine substrate 4 3 prefactor in a sediment transport relation and morphodynamic factor the discriminant δ als2 of the steady active layer model for two size fractions eq 26 can be written as δ als2 a 2 δ als2 where δ als2 is the discriminant for a unit prefactor i e a 1 the prefactor a increases or decreases the discriminant but does not change its sign and so it does not change the character of the mathematical system this is confirmed by fig 3b which shows the effect of varying the prefactor a in the reference case described in section 4 1 since morphodynamic time scales are usually several orders of magnitude larger than the time scales of the flow section 2 1 computations usually cover a significant number of years the computational time is sometimes reduced using a morphodynamic factor that multiplies the divergence of the sediment transport rate latteux 1995 roelvink 2006 ranasinghe et al 2011 this factor can also be considered as a multiplication of the sediment transport rate and therefore has the same effect as the prefactor a thus the use of a morphodynamic factor does not change the mathematical character of the model this result is obtained assuming quasi steady flow while the prefactor in the sediment transport relation rarely varies by more than an order of magnitude simulations may be run with morphodynamic acceleration factors o 10 2 in these latter cases the quasi steady flow assumption may not be acceptable which limits the extension of our analysis 4 4 exponent and critical shields stress in a sediment transport relation the discriminant eq 26 tends to 0 with increasing values of b if the effective shields stress for all sediment fractions is smaller than 1 or to if the effective shields stress is larger than 1 for at least one fraction thus it is difficult to generalize the effect of the exponent its variation from a reference situation can both make the system hyperbolic if the reference situation is elliptic or vice versa in fig 3c we show the discriminant as a function of b for the same reference cases as in section 4 3 the hyperbolic situation when using meyer peter and müller 1948 becomes elliptic if the value of the exponent b increases towards the value in engelund and hansen 1967 the effect of the critical shields stress θc in eq 6 on the discriminant is similar to the effect of the exponent as its variation can both make a previously hyperbolic case elliptic or vice versa fig 3d shows how a decrease of the critical shear stress when using the sediment transport relation by meyer peter and müller 1948 increases the discriminant reducing the likelihood of elliptic behavior 4 5 active layer thickness the discriminant of the eigenvalues eq 26 can be written as a second degree polynomial of the inverse of the active layer thickness i e δ als2 a 1 1 l a 2 a 2 1 l a a 3 where a 1 0 a 2 and a 3 are coefficients independent of the active layer thickness this implies that 1 the model is well posed for a sufficiently thin active layer 2 the model is well posed for a sufficiently thick active layer and 3 there exists one ill posed domain only regarding the active layer thickness these results of the two fractions model confirm previous results based on the simplified active layer model ribberink 1987 sieben 1994 the inverse of the roots of the second degree polynomial are the limit values of the active layer thickness that ensure that the model is well posed 31 l a λ s 1 λ b 1 2 γ 1 μ 1 1 2 γ 1 μ 1 1 1 2 1 1 where we have used the notation for the variables with unit active layer thickness i e l a 1 m given the facts that the active layer thickness is one of the most empirical parameters of the system of equations section 1 and that river morphodynamic models often require calibration e g cao and carling 2002b eq 31 can be applied to select a certain value for the active layer thickness to avoid a situation that is prone to be ill posed 5 consequences of ill posedness in this section we analyze the consequences of ill posedness using numerical simulations our aim is to provide modellers with the tools to detect occurrence of ill posedness in their results and understand how the observed unrealistic model behavior changes with parameter and model choices first we make numerical runs to qualitatively observe the consequences of the non linear effects that are neglected in the perturbation analysis section 5 1 in section 5 2 we conduct a sensitivity analysis to generalize the consequences observed in the previous section 5 1 numerical examples the linear perturbation analysis shown in section 2 5 indicates that perturbations grow unboundedly if the model is elliptic in this section we run four numerical simulations at flume scale to analyze the effects of the neglected non linear terms the simulations are one dimensional for the flow and are computed using the delft3d software package lesser et al 2004 which solves the unsteady shallow water equations in combination with the active layer model for simplicity the active layer thickness is assumed constant under aggradational conditions the sediment transferred to the substrate is composed of only the active layer sediment i e α 1 in eq 8 substrate stratigraphy is stored using a bookkeeping system viparelli et al 2010 stecca et al 2016 all simulations start from equilibrium conditions under coarse sediment feeding a lowering of the base level is imposed which causes degradation into a fine substrate we consider a well posed reference case simulation 1 that initially has the same parameters as the reference case of the parameter study of section 4 table 2 then the active layer thickness is changed simulation 2 and hiding is considered simulation 3 simulation 4 is equal to simulation 3 except for its morphodynamic factor table 3 summarizes the differences between the four simulations the boundary conditions that are in equilibrium with the initial condition blom et al 2016 as well as other parameters are described in table 4 in fig 4 a we plot the discriminant of the eigenvalues of the quasi steady active layer model eq 26 at the initial time as a function of the active layer thickness note that the conditions of simulation 1 yield a well posed model δ als2 0 while the conditions of simulation 2 yield an ill posed model δ als2 0 in fig 4d e we show the evolution of the bed elevation for simulations 1 and 2 respectively the ill posed simulation 2 shows an oscillatory behavior that is not present in the well posed simulation 1 we have not imposed any initial perturbation which implies that numerical noise is sufficient to trigger the oscillatory behavior simulation 3 is the same as simulation 1 yet the sediment transport rate now accounts for hiding using the parker et al 1982 function eq 7 with exponent b equal to 0 8 simulation 3 is ill posed fig 4b and the solution shows oscillations fig 4f just as in the ill posed simulation 2 simulation 4 is the same as simulation 3 except for its morphodynamic factor equal to two which decreases the value of the discriminant fig 4c causing oscillations to develop faster fig 4g for all cases oscillations do not occur at the upstream end of the domain this is because oscillations require time and so space to grow in all cases oscillations grow until a maximum amplitude is reached and then propagate downstream this maximum amplitude is such that the conditions are at the brink of ill posedness and well posedness worded differently downstream from the location where the amplitude is maximum the model is ill posed and it is well posed upstream from it the oscillations are associated with degradation and subsequent aggradation the deposited sediment has the same grain size distribution as the active layer which is coarser than the initial substrate so the overall effect of an oscillation is a coarsening of the topmost part of the substrate this coarsening acts as a regularization mechanism which not only restores hyperbolicity but also dampens oscillations that arrive from upstream by limiting the source of fine material it is likely that because of the regularization mechanism computations do not crash as a result the extent and likelihood of ellipticity may in practice be underestimated yet the results are physically unrealistic and implementing an automated check of the eigenvalues would be good practice for software developers and users 5 2 sensitivity analysis the previous section has shown that due to the non linearity of the system an ill posed simulation generates non physical oscillations that propagate downstream and grow until a certain maximum amplitude at which the mathematical problem is at the brink of ill posedness and well posedness in this section we run a sensitivity analysis to generalize those results to this end we vary 4 physical parameters and 2 parameters related to the domain discretization using simulation 1 as a reference case table 5 summarizes the parameter values used in the sensitivity analysis as we are interested in studying the behavior of simulations under ill posed conditions we exclude from the analysis those simulations in which the combination of parameters yield a well posed model as we have observed that the oscillations need space to grow until a maximum value section 5 1 we exclude those simulations in which the domain is not long enough to develop an oscillation that travels with a constant amplitude a set of 173 out of 256 simulations fulfills these two requirements in fig 5 a we plot the maximum flow depth h max nondimensionalized with the normal flow depth hn as a function of the discriminant eq 26 for the sake of clarity we plot the results of the simulations with a horizontal discretization length δx equal to 0 1 m and a thickness of the substrate layers equal to 0 01 m and 0 10 m see appendix c of the supplementary material for the results of all simulations the parameters used to evaluate the discriminant are those at the start of the simulation normal flow the vertical black lines join simulations with the same physical parameters i e they only differ regarding numerical parameters and the color of each dot is related to the thickness of the substrate layer the linear analysis has shown that the growth rate depends on the discriminant section 2 5 however there is only mild correlation between the discriminant and the maximum amplitude of the oscillations a thinly discretized substrate is associated with a larger amplitude of the oscillations fig 5a this effect can be seen only empirically since it is not a parameter of the system of equations nor does it appear in the linear stability analysis for all simulations we compute the flow depth that yields a value of the discriminant at the initial condition equal to 0 i e at the brink between ellipticity and hyperbolicity this is done numerically finding the root of δ als2 h eq 26 considering the water discharge and volume of sediment in the active layer and at the substrate of the initial condition we term this flow depth the hyperbolic flow depth hhyp which is independent of the numerical parameters of the simulation and depends on physical parameters only in fig 5b we compare the measured maximum flow depth and the hyperbolic flow depth the grey line represents the situation in which h m a x h h y p we see that the hyperbolic flow depth can be used as a rough estimate of the maximum flow depth that will occur in an elliptic simulation one important source of scatter is the fact that the hyperbolic flow depth depends on the initial condition only whereas the maximum flow depth also depends on the evolution of the solution as the oscillations interact with each other in fig 5c we plot the nondimensional maximum flow depth as a function of the streamwise location where the maximum flow depth occurs nondimensionalized with the total length of the domain for the sake of clarity we plot the results of the simulations with a thickness of the bookkeeping layers δz equal to 0 01 m see appendix c of the supplementary material for the results of all simulations in the thinly discretized simulations we find the maximum amplitude more upstream compared to the coarsely discretized simulations the location where the maximum amplitude of the oscillations is found is related to its growth rate since a faster growing oscillation develops its maximum amplitude in less distance than a slower one this result confirms the findings of linear stability analysis section 2 5 also the maximum flow depth and the domain discretization are mildly correlated similar to the vertical discretization smaller cells yield a larger maximum flow depth but this effect can be seen only empirically the discretization of the substrate affects also the duration of the elliptic behavior fig 6 shows the longitudinal profile of four simulations from the sensitivity analysis at the end of the run simulations 1 5 6 and 7 see table 3 the substrate of the well posed simulations at the end of the runs is unaltered whereas it has coarsened in the ill posed cases due to the oscillatory behavior which acts as a regularization mechanism section 5 1 a thinly discretized substrate enhances the regularization mechanism as one full layer is created with the grain size distribution of the coarse active layer during the aggrading phase of the oscillation if the bed is discretized into thick layers the material transferred to the substrate will be averaged with the sediment already present in the top substrate layer the resulting grain size distribution of the substrate may not be sufficiently coarse to prevent the model from being ill posed 6 implications of considering more than two size fractions or an unsteady active layer thickness to obtain an analytical expression of the eigenvalues we have restricted our analysis to mixtures of sediment composed of two size fractions and steady flow in this section we explore the consequences of relaxing these assumptions 6 1 ill posed domain of a three size fractions case a model for three sediment size fractions is too complex to obtain analytical expressions of the eigenvalues we therefore first attempt to provide insight addressing a specific case based on the results of the case for two size fractions the concept of a finer or coarser active layer relative to the substrate is unequivocally applicable in the case of two size fractions however this concept is not as straightforward for three size fractions as it requires the definition of a mean grain size as an extension of the results for the two size fractions case where the model can only be ill posed in degradational conditions into a substrate finer than the active layer assuming certain conditions on the closure relations section 3 1 we consider a situation with three size fractions which regardless of the method to compute the mean grain size is governed by degradation into a substrate coarser than the active layer this happens for instance if the volume fraction contents in the active layer of the fine medium and coarse size fractions are 0 5 0 5 and 0 respectively and at the interface are 0 5 0 and 0 5 we consider a sediment mixture with the above volume fraction contents and characteristic grain sizes of the fine medium and coarse fraction equal to 0 001 m 0 003 m 0 005 m all the other parameters are equal to the reference case table 2 this situation is elliptic as two of the eigenvalues of the system matrix are complex thus in a three size fractions case the mean grain size of the sediment in the active layer relative to that at the interface is not a valid discriminant of the mathematical character of the system of equations fig 7 shows the results of a numerical simulation based on the above parameters the solution presents oscillations as in the previous ill posed cases however the amplitude of these oscillations is now significantly smaller compare fig 7a to fig 4e a relatively large oscillation appears after approximately 3 h which entrains coarse sediment from the substrate fig 7b during the aggradational phase of the oscillations fine sediment from the active layer is transferred to the substrate thus at the end of the simulation the top part of the substrate is finer than initially fig 7c to illustrate the implications of this result we study the effects of discretizing the same sediment mixture into two or three sediment fractions to discretize the sample into three sediment fractions we use characteristic grain sizes equal to 0 001 m 0 003 m and 0 005 m and to discretize it into two sediment fractions we use 0 002 m and 0 004 m the volume fraction content in the medium size of the three fraction mixture is equally split between the fine and coarse bins of the two fraction mixture we vary all volume fraction contents between 0 and 1 to obtain different sediment mixtures and the flow depth keeping the water discharge per unit width constant between 0 15 m and 1 5 m to obtain different flow conditions all other parameters are equal to the reference case fig 8 a b shows the elliptic domain when the mixture is discretized into two and three size fractions respectively on the vertical axis we plot the difference between the mean grain size of the sediment in the active layer dma m and at the interface between the active layer and the substrate dmi m note that some situations that are well posed when the mixture is discretized into two fractions are ill posed when it is discretized into three fractions we cannot prove that the eigenvalues of the system matrix for three size fractions are always real under aggradational conditions due to the complexity of the expressions nevertheless we have not obtained a single complex value in any of the aggradational tests we have conducted 6 2 effect of an unsteady active layer thickness in the ill posed domain in this section we analyze the implications of considering a variable active layer thickness with respect to the ill posedness of the system of equations the flow needs to be considered unsteady to study the variability of the active layer thickness if it is related to dune growth section 3 we simplify the system assuming two sediment size fractions and negligible hiding stecca et al 2014 and appendix d of the supplementary material we obtain the characteristic polynomial of the system matrix eq 11 we prove that in aggradational and degradational conditions into a substrate coarser than the active layer the characteristic polynomial has 5 real roots appendix d of the supplementary material therefore the model is well posed regardless of the unsteady active layer thickness regarding degradational conditions into a substrate finer than the active layer we prove that if λ b λ s 1 f a 1 f 1 i considering a variable active layer thickness increases the likelihood of the model becoming elliptic note that assuming a similar order of magnitude of the bed and sorting celerities in conditions prone to be elliptic i e degradation into a substrate significantly finer than the active layer a variable active layer thickness increases the domain in which the active layer model is elliptic we numerically test several sets of parameters and we find no case where the model is hyperbolic if the active layer is unsteady but elliptic if it is constant appendix d of the supplementary material this suggests that although we do not provide a formal proof an unsteady active layer thickness always increases the likelihood of the model being ill posed 7 conclusions we have assessed the well posedness of the equations used to model mixed sediment river morphodynamics in particular we have studied the system formed by the flow equations saint venant 1871 together with the active layer model hirano 1971 and a simplified vertically continuous model viparelli et al 2017 our findings are the following considering two size fractions and the quasi steady flow assumption we obtain an analytical expression for the discriminant that determines whether the active layer and continuous models are ill posed assuming i two size fractions ii steady flow iii no reverse mobility and iv that under aggradational conditions the depositional flux of sediment to the substrate is entirely composed of active layer sediment the active layer model can be ill posed under degradational conditions into a substrate finer than the active layer only the use of a hiding factor increases the likelihood of ill posedness strong hiding that causes reverse mobility may cause ill posedness also in aggradational conditions aggradational cases may be ill posed if the depositional flux of sediment to the substrate includes bedload sediment hoey and ferguson 1994 the active layer model may be ill posed in degradational conditions into a substrate coarser than the active layer if more than two size fractions are considered considering a variable active layer thickness associated with dune growth increases the likelihood that the active layer model is ill posed the simplified vertically continuous model can be ill posed under both aggradational and degradational conditions a small vertical gradient of the probability of bed elevation and volume fraction content decreases the likelihood of the model being ill posed ill posedness results in non physical oscillations that grow until a maximum amplitude is reached at which the model recovers its hyperbolic character and becomes well posed the non physical oscillations itself act as a regularizing mechanism by coarsening the substrate the numerical solution of an ill posed problem may be reliable if perturbations do not have space and or time to grow or if the consequences of the perturbations are negligible compared to the accuracy of the problem data however the reliability of the solution becomes subjective this implies that it is up to the modeller to decide whether a solution is representative of the physical phenomenon under consideration in a well posed model a finer grid provides more accurate results this is opposite in ill posed models as the growth rate of oscillations decreases with grid size thus if a model is ill posed one may be tempted to use a larger grid size such that oscillations do not have space to grow and numerical viscosity is sufficient to suppress the consequences of ill posedness we do not recommend to follow this strategy because of the subjectivity of the solution we do not recommend discarding the active layer and vertically continuous models for modeling mixed sediment river morphodynamics the former has proven its validity over a large range of situations section 1 and the latter is yet a simplified version of a continuous sediment conservation model moreover both models are well posed for a vast range of situations the ill posedness of the system of equations is a fundamental mathematical problem independent of the numerical solver it can only be solved by an improved set of equations that represents physical processes in a better way than existing models do in this regard we are currently conducting laboratory experiments to investigate the physical mechanisms that are relevant under conditions in which the active layer model is ill posed one may want to introduce minimal changes to the active layer model to regularize it i e to ensure that the model is always well posed in this case the most straightforward solution is to check whether the model is ill posed and to change the active layer thickness to a value that provides a well posed model one needs to be aware that this approach is not simply a numerical trick as it implies a change of the time scale of the physical processes under consideration moreover it implies a temporal change of the active layer thickness which may be relatively large and local preliminary simulations show that this solution is not always stable another possibility may be to artificially modify the celerities without changing the actual thickness of the active layer a similar approach has been used by zanotti et al 2007 to regularize the ill posed two layer shallow water model current work by the authors builds on this idea acknowledgments this research is part of the research programme rivercare supported by the applied and engineering sciences ttw division of the netherlands organization for scientific research nwo and which is partly funded by the ministry of economic affairs under grant number p12 14 perspective programme guglielmo stecca is supported by a marie curie outgoing fellowship within the european union s seventh framework programme for research technological development and demonstration under grant agreement no piof ga 2013 621886 we acknowledge the editorial work by dr d odorico and the comments of two anonymous reviewers who helped in clarifying the message the fruitful discussions and comments on the manuscript of liselot arkesteijn and robert jan labeur are gratefully acknowledged appendix a flow equations the water phase is mathematically described by the saint venant equations saint venant 1871 in which mass conservation is represented by the continuity equation a 1 h t q x 0 where t s denotes the time coordinate x m the streamwise coordinate and q u h m2 s the water discharge per unit width the balance of streamwise momentum is represented by a 2 q t q 2 h g h 2 2 x g h η x g h s f where η m denotes the bed elevation and sf the friction slope considering steady flow the conservation of water mass eq a 1 reduces to a spatially constant discharge and the conservation of momentum eq a 2 to the backwater equation a 3 h x 1 1 f r 2 η x s f 1 f r 2 appendix b active layer equations the conservation of the total amount of sediment in the bed is represented by the exner equation exner 1920 b 1 η t q b x 0 where qb m2 s is the sediment transport rate per unit width multiplied by 1 1 p where p is the bed porosity i e the sediment transport rate qb accounts for pores for simplicity mechanisms such as subsidence and uplift compaction and dilation of sediment are neglected in the above equation paola and voller 2005 of special relevance is the implicit assumption that the temporal change of the storage of sediment within the water column and its effects on bed elevation are negligible park and jain 1987 stevens 1988 correia et al 1992 morris and williams 1996 we consider that there is no lag between changes in bottom bed shear stress bell and sutherland 1983 jain 1992 worded differently the sediment transport rate is at capacity and adapts instantaneously to the flow field thus the sediment transport rate does not require a constitutive equation and is treated as a closure relation assuming constant porosity and density the active layer equation describes the conservation of mass of grain size fraction k in the active layer hirano 1971 b 2 m a k t f k i η l a t q b k x 0 where mak m is the volume of sediment of size fraction k in the active layer per unit of bed area f k i is the volume fraction content of size fraction k at the interface between the active layer and the substrate f k i 0 1 la m is the active layer thickness and qbk m2 s is the sediment transport rate per unit width of size fraction k multiplied by 1 1 p the addition of the sediment transport rate for each size fraction equals the total amount of sediment in transport including pores b 3 q b k 1 n q b k assuming constant porosity and density mass conservation of sediment of size fraction k in the substrate is expressed by b 4 m s k t f k i η l a t 0 where msk m is the sediment volume of size fraction k in the substrate per unit of bed area the volume of sediment per unit of bed area in the active layer and the substrate are defined as b 5 m a k f a k l a m s k η 0 η l a f s k z d z where fak is the volume fraction content of size fraction k in the active layer fak 0 1 fsk z is the volume fraction content of size fraction k in the substrate at elevation z m fsk z 0 1 and η 0 m is the time invariant datum for bed elevation the volume fraction contents are constrained by the equations b 6 k 1 n f k i 1 k 1 n f a k 1 k 1 n f s k z 1 thus the volume of sediment per unit of bed area is constrained by the equations b 7 k 1 n m a k l a k 1 n m s k η l a η 0 the summation of n active layer equations yields the exner equation ribberink 1987 parker et al 2000 as the active layer equation b 2 represents fractional mass conservation of sediment and the exner equation b 1 represent the conservation of the total amount of sediment thus to consider n active layer equations is equivalent to considering n 1 active layer equations and the exner equation we here choose for the second option as in this way the conservation of sediment mass per size fraction can be considered as an extension of the unisize model the substrate equation b 4 is a linear combination of the exner equation b 1 and the active layer equation b 2 which means that the substrate equation does not play a role in the mathematical behavior of the system and can be treated in a decoupled manner appendix c sediment transport closure relation the sediment transport rate of size fraction k per unit width including pores qbk is expressed as the product of the volume fraction content of size fraction k at the bed surface fbk and the sediment transport capacity qbk m2 s which is the sediment transport we would obtain if the bed was formed by unisize sediment yet including hiding effects deigaard and fredsøe 1978 ribberink 1987 armanini 1995 c 1 q b k f b k q b k the sediment transport capacity is the product of a nondimensional sediment transport rate q b k and the parameter g r d k 3 einstein 1950 c 2 q b k q b k g r d k 3 1 p where we account for the volume of pores multiplying by 1 p r ρ s ρ w 1 is the submerged specific gravity ρ s 2650 kg m3 the sediment density and ρ w 1000 kg m3 the water density the volume fraction content of size fraction k at the bed surface is constrained by the condition c 3 k 1 n f b k 1 in the active layer model the volume fraction content of size fraction k at the bed surface is considered to be equal to the volume fraction content in the active layer f b k f a k in the vertically continuous model developed by viparelli et al 2017 it is considered equal to the integral of the volume fraction content of size fraction k in the bed sediment weighted by the elevation s exposure to the flow c 4 f b k f k y p e y d y the sediment transport rate q b k is related to the mean characteristics of the flow here we consider a generalized form of the meyer peter and müller 1948 transport relation which estimates sediment transport as a power function of the excess bed shear eq 6 the nondimensional bed shear stress of size fraction k or shields 1936 parameter is computed as θ k c f u 2 g r d k a commonly used hiding relation is the one due to egiazaroff 1965 c 5 ξ k log 10 19 log 10 19 d k d m 2 where dm m is a characteristic mean grain size of the mixture obtained as an average of the grains in movement and in the bed surface in practical terms dm is computed as the arithmetic mean e g wu et al 2000 geometric mean e g bettess and frangipane 2003 or the median grain size e g van niekerk et al 1992 kleinhans et al 2002 of the bed surface sediment a simpler expression was developed by parker et al 1982 c 6 ξ k d m d k b where the characteristic mean grain size is the median grain size d 50 of the subpavement sediment below an armor layer parker et al 1982 or the geometric mean of the surface sediment parker 1990 if the nondimensional parameter b is equal to 0 there is no hiding effect and each grain size behaves independently of each other if b 1 the sediment transport of each size fraction is independent of its grain size for b 1 5 thus only depends on its presence at the surface fbk buffington and montgomery 1997 made an inventory of values of b spanning between 0 32 and 1 25 a value of b 1 implies reverse mobility solari and parker 2000 in this paper we compute the characteristic mean grain size dm as the geometric mean c 7 d m d ref 2 k 1 n f b k log 2 d k d ref where d ref 1 mm is a reference grain size that makes the grain size on ϕ scale nondimensional appendix d system of equations of the steady vertically continuous model consisting of two size fractions the vector of dependent variables q vcs2 is d 1 q vcs2 η f 1 t the vector of source terms is d 2 s vcs2 s f u ψ 1 f r 2 1 p e p e g 1 t and the system matrix is d 3 a vcs2 u ψ 1 f r 2 1 p e x 1 ψ 1 f r 2 p e p e g 1 x 1 1 p e m 1 1 parameters g 1 x 1 m 1 1 and δ 1 1 are the equivalent of parameters γ 1 χ 1 μ 1 1 and d 1 1 in the active layer model section 3 1 d 4 g 1 c 1 φ 1 d 5 φ 1 1 p e f 1 p e y d 6 x 1 p e u q b f 1 d 7 m 1 1 δ 1 1 φ 1 d 8 δ 1 1 p e u x 1 q b 1 f 1 the eigenvalues of the system matrix eq d 3 nondimensionalized dividing by the flow velocity are d 9 λ vcs2 i 1 2 λ b λ s c 1 δ vcs2 for i 1 2 where the discriminant is d 10 δ vcs2 λ b λ s c 1 2 4 λ b λ s c 1 g 1 m 1 1 we define λ sc1 as the nondimensional sorting celerity of the vertically continuous model as the equivalent of the sorting celerity in the active layer model in eq 28 d 11 λ s c 1 x 1 m 1 1 p e supplementary material supplementary material associated with this article can be found in the online version at 10 1016 j advwatres 2018 02 011 appendix e supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
