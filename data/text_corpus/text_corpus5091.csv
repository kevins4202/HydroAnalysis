index,text
25455,we present an integrated hydrologic modeling approach for the conterminous united states using the swat models of the national agroecosystem model nam the nam is a field based national scale hydrologic model to aid in conservation planning and policy we augment the nam by simulating groundwater storage and flow in a physically based spatially distributed manner using the gwflow module we also present a scripting tool that automates the creation of gwflow inputs for each 8 digit hydrologic unit code huc8 swat model key calculated groundwater inflows and outflows include recharge pumping groundwater lake exchange groundwater surface water exchange transfer to soils and boundary inflow we demonstrate the approach for six huc8 watersheds located in various regions of the united states focusing on areas of groundwater pumping tile drainage intensive groundwater surface water interactions and high precipitation the presented framework can be used to establish models for scenario analysis of climate management and land use keywords swat swat groundwater modeling aquifers agroecosystem data availability data will be made available on request software availability name of software swat fortran 524 files 3 2 mb with the gwflow module developer and contact information ryan bailey rtbailey colostate edu jeffrey arnold year first available 2022 hardware required standard desktop pc software required none availability and cost source files of swat including the subroutines for the gwflow module are freely available for download at https swat tamu edu software plus gwflow 1 introduction the need to quantify current and future water supply and water quality conditions in regions of the world has led to recent advances in large scale integrated hydrologic modeling modeling is performed at the river basin sun et al 2016 mohammed et al 2018 aliyari et al 2019 tran et al 2022a tran et al 2022b regional schuol et al 2008 peterson et al 2016 hanson et al 2020 čerkasova et al 2021 national condon and maxwell 2019 alattar et al 2020 and even continental abbaspour et al 2015 naz et al 2022 scale many of these models have been used to inform policy regarding water management and climate change effects e g abbaspour et al 2015 čerkasova et al 2021 whereas others are used to improve understanding of hydrologic systems and feedbacks maxwell et al 2016 or are prepared for potential application in scenario analysis alattar et al 2020 the degree of model complexity within these studies is wide ranging with several approaches using the semi distributed model swat arnold et al 1998 which lumps hydrologic fluxes at the level of hydrologic response units hrus unique geographic areas of topographic slope soil type and land management and simulates groundwater storage and flow using steady state assumptions and linear reservoir equations sun et al 2016 in the yangtze river basin china yan and roy 2016 in the yellow river basin china schuol et al 2008 in west africa abbaspour et al 2015 for the european continent and čerkasova et al 2021 for the nemunas river basin europe the other approaches generally use coupled surface subsurface models with physically based spatially distributed groundwater flow modeling such as hanson et al 2020 and alattar et al 2020 using modflow owhm hanson et al 2014 and condon and maxwell 2019 and o neill et al 2021 using parflow alattar et al 2020 used a grid cell size of 13 km and monthly water budgets to simulate groundwater head and stream discharge of major rivers in the conterminous united states conus and maxwell et al 2016 used a 1 km cell size to simulate hydrologic fluxes across the majority of conus a new effort to simulate hydrologic fluxes and water resources within conus is the national agroeosystem model nam arnold et al 2021 white et al 2022 comprised of one watershed model for each 8 digit watershed of the conus with flow routed between upstream and downstream watersheds to provide a single hydrologic system the modeling code used is swat bieger et al 2017 a restructured version of swat that provides enhanced flexibility in routing water between spatial objects within a watershed system the nam uses a suite of publicly available national datasets such as topography soil unit boundaries and characteristics streamflow lines water bodies tile drainage locations irrigation practices water use reservoir management field boundaries and subbasin boundaries to create one swat model for each of the 2121 huc8 watersheds although stream discharge and general water balance components have been corroborated against observation data e g white et al 2022 the swat groundwater components are little changed from the original swat code and have the same limitations to provide a holistic integrated approach to watershed modeling and hydrologic flux quantification the nam needs a groundwater module that uses physically based spatially distributed groundwater modeling principles particularly for watersheds wherein groundwater plays a key role in irrigation water supply and streamflow generation the objective of this paper is to introduce a modeling framework for including physically based spatially distributed groundwater modeling into the swat models comprising nam this is achieved by using the new gwflow module bailey et al 2020 of swat modified herein to link with the spatial objects specific to the nam the gwflow module simulates spatially distributed groundwater storage groundwater head and key groundwater sources and sinks recharge lake exchange stream exchange tile flow saturation excess flow pumping using a grid of cells i e aquifer control volumes that encompasses the watershed boundary the module is written as a subroutine of swat and exchanges water with other swat objects hydrologic response units hrus reservoirs lakes and streams to provide an integrated hydrologic model for surface and subsurface processes for ease of model construction and application we also introduce a scripted workflow to automate the geoprocessing of spatial connections between swat objects hrus streams lakes and gwflow grid cells and the writing of gwflow input files that contain the connection data the script uses publicly available national datasets of topography aquifer thickness geologic units and tile drainage to populate grid cell properties we demonstrate the enhanced modeling framework for 6 huc8 watersheds across the conterminous united states little river georgia cache river missouri arkansas nanticoke river delaware maryland winnebago river minnesota iowa sauk river washington and upper yellowstone river montana wyoming these watersheds were chosen due to unique and diverse hydrologic features such as high baseflow little nanticoke groundwater pumping for irrigation cache tile drainage winnebago semi arid climate upper yellowstone and the absence of cultivation sauk for each watershed we amend a previously constructed and soft calibrated swat model arnold et al 2021 white et al 2022 with the gwflow module and then compare model output to measured streamflow and groundwater head at available usgs stream gages and monitoring wells respectively as the objective of this paper is to introduce the modeling framework and scripted workflow we do not perform any additional calibration instead using results to highlight the reasonable spatio temporal patterns and water balance of preliminary model results and the potential improvement in model performance for the study watersheds as presented this framework can be used in future studies to assess regional and national spatio temporal patterns and trends in recharge groundwater storage groundwater pumping baseflow and tile drainage beyond the typical capabilities of the nam swat models 2 methods 2 1 swat and the national agroecosystem model nam the watershed model swat bieger et al 2017 is a restructured form of the original soil and water assessment tool swat arnold et al 1998 designed to more easily provide connectivity between hydrologic objects in a watershed system for example whereas swat is limited to a single stream channel per subbasin swat can simulate the movement of water nutrients and sediment for any number of channels within the watershed landscape specific hydrologic objects include fields hrus stream channels aquifers ponds wetlands and reservoirs with water nutrient mass and sediment routed between objects as specified by the user on a daily time step the watershed is divided into routing units which lumps hydrographs from multiple objects permitting simplified routing across the landscape and through the channel network the swat code is written in fortran and available open source at https swat tamu edu software plus with a gis geographic information system user interface and tools for model calibration sensitivity analysis and uncertainty analysis swat is currently being applied to the conterminous united states as the national agroecosystem model nam arnold et al 2021 white et al 2022 for conservation policy and environmental planning within the nam a separate swat model is created for each of the 2121 huc8 8 digit hydrologic unit code watershed within the conus each model uses five domains for simulating hydrologic processes and management field 1 50 ha transition 0 2 2 0 km2 headwater 1 15 km2 tributaries 15 150 km2 and main river 150 km2 datasets used to construct each swat model table 1 include field boundaries yan and roy 2016 with each field designated as an individual hru crop rotation usda cropscape 10 m topographic slope 10 m soil boundaries and properties gssurgo 30 m land use and land cover stream segments as provided by the national hydrography dataset nhdplus version 2 moore and dewald 2016 lakes and reservoirs weather ghcn prism using methods of gao et al 2020 water use from the 2015 usgs national assessment dieter et al 2018 and county level reports of irrigated and non irrigated planted acres with the latter used to derive irrigation probabilities point discharge into streams from facilities skinner and maupin 2019 and databases for plants fertilizer tillage and irrigation operations subbasin boundaries within each huc8 model are designated by huc12 catchments the width and depth of each nhd channel were estimated using the method of bieger et al 2016 release parameters for reservoirs were derived using data from wu et al 2020 full details of model datasets and construction are provided in white et al 2022 model construction using these datasets results in a total of 4 606 927 agricultural fields hrus 2 296 974 non agricultural hrus 1 610 000 headwater channels 591 000 tributary channels and 432 400 main channels arnold et al 2021 for the 2121 huc8 models each huc8 scale model is run for the 2000 2015 period on a daily time step outflow from headwater huc8 watersheds is provided as input into adjacent downstream huc8 watersheds in a cascading manner until the most downstream huc8 watershed model in a given river basin has been run 2 2 the gwflow module and its inclusion in the nam 2 2 1 basics of the gwflow module the new gwflow module bailey et al 2020 2022 was added as an option to swat and users may activate it or the original groundwater module the original module provides a simplistic representation of groundwater storage groundwater flow and interaction with other water systems soil profile reservoirs streams in a watershed setting including homogeneous aquifer properties groundwater discharge to streams based on steady flow conditions and user defined thresholds rather than gradients and head differences and the lack of groundwater flow between adjacent aquifer units the gwflow module was designed to provide a physically based spatially distributed simulation of groundwater states storage head saturated thickness and fluxes for the swat watershed setting the module uses a set of cells i e aquifer control volumes that are connected in space to simulate the movement of groundwater laterally through a single layer unconfined aquifer each cell has a specified fixed volume bounded by the ground surface above the bedrock below and faces on the north east south and west groundwater can be exchanged across the four faces with surrounding cells cells along the boundary of the watershed can be designated as either constant head cells or no flow cells with the latter preventing any groundwater from crossing the watershed boundary each cell is provided a value of hydraulic conductivity k m day and specific yield s y the geographic set up of the gwflow module is shown in fig 1 fig 1a shows the watershed boundary red subbasins black and stream channels blue for a generic swat model set up and the gwflow grid fig 1b shows a close up of a watershed area and grid cells and fig 1c shows the multi dimensional view of a representative grid cell depicting the water table bedrock saturated thickness lateral dimensions δx δy and total groundwater volume v m3 for each daily time step δt of the swat simulation the gwflow module is called as a subroutine to compute sources and sinks and update groundwater storage and groundwater head for each grid cell the module uses an explicit forward in time numerical method to update groundwater storage v for each grid cell using the following water balance equation see fig 1b and c 1 δ v i j n 1 δ t s o u r c e s i j n s i n k s i j n l a t e r a l f l o w i j n where n 1 represents the current time day n represents the previous day and i and j represent the row and column indices respectively of each cell equation 1 can be expanded to 2 v i j n 1 v i j n s o u r c e s i j n s i n k s i j n l a t e r a l f l o w i j n t n 1 t n groundwater sources sinks and lateral flow are volumetric fluxes m3 day of groundwater computed as 3 s o u r c e s q r e c h q s w g w q l a k e g w 4 s i n k s q g w e t q g w s w q s a t e x q p u m p q g w l a k e q t i l e q s o i l 5 l a t e r a l f l o w q n o r t h q s o u t h q w e s t q e a s t where rech sw gw lake gw gwet gw sw satex pump gw lake tile and soil represent recharge stream seepage to the aquifer lake seepage to the aquifer groundwater evapotranspiration et groundwater discharge to streams saturation excess flow when the water table intersects the ground surface groundwater pumping groundwater discharge to lakes groundwater discharge to tile drains and groundwater transfer to the soil profile respectively see fig 1c q north q south q west and q east represent lateral groundwater fluxes into out of the four sides of the grid cell which provides the spatial connectivity of the aquifer system the resulting groundwater volume v for each grid cell is used to update groundwater head h for each cell using the volume equation 6 v i j n 1 δ x δ y s i j n 1 s y i j where s is saturated thickness m water table to bedrock of the aquifer and equating δs to δh 7 h i j n 1 h i j n s o u r c e s i j n s i n k s i j n l a t e r a l f l o w i j n δ t s y i j δ x δ y as the presented method is explicit in nature i e all values of v and h at the current time step n 1 are calculated using values from the previous time step n initial v and h must be specified for each cell for t 0 which corresponds to the first day of the swat simulation within the gwflow subroutine the following spatial connections are instituted for integrating gwflow calculations with swat objects fig 2 1 recharge q rech is provided to grid cells by hru soil profile deep percolation using spatial intersections between hrus and grid cells 2 groundwater transfer to soils q soil for conditions where the groundwater levels rise above the bottom of the soil profile using spatial intersections between grid cells and hrus 3 groundwater stream exchange volumes q sw gw q gw gw are calculated for each grid cell that geographically intersects a stream channel and provided to the corresponding channel object 4 groundwater lake exchange volumes q lake gw q gw lake are calculated for each grid cell that geographically intersects a lake or reservoir and provided to the corresponding reservoir object 5 groundwater discharge to tiles q tile is calculated for each grid cell that geographically includes a tile drain and provided to the channel object to which the tile drains 6 saturation excess flow q satex is calculated for conditions of the water table rising above the ground surface i e during a storm event and provided to the channel object to which the surface runoff of the corresponding hru drains lateral flows q north q south q west and q east groundwater exchange with streams q sw gw q gw gw and lakes q lake gw q gw lake and groundwater discharge to tile drains q tile are computed using darcy s law which requires a relation of h interface areas m2 and k m day of the aquifer streambed and lakebed respectively the inclusion of q tile was introduced by bailey et al 2021 in a study of subsurface drainage in a watershed in iowa the inclusion of groundwater lake interactions q lake gw q gw lake is introduced in this paper for the first time due to the need for this connection for many watersheds using the gwflow module with swat requires the following input files gwflow input cell information ground surface aquifer thickness initial h k s y streambed k lakebed k tile drain k gwflow hrucell spatial connections between grid cells and hru objects gwflow rivcells spatial connections between grid cells and channel objects the gwflow module is constituted by four new subroutines to the swat code gwflow module for variable declaration gwflow riv for connections between river cell and channel objects gwflow read for reading the gwflow inputs and gwflow simulate for simulating equations 6 and 7 outputs for the gwflow module include daily monthly and yearly groundwater balance terms cell by cell annual flux rates for each groundwater source and sink and cell by cell groundwater head for specified days of the simulation period for each time step the total change in groundwater storage in the unconfined aquifer is compared to the summation of all groundwater inflows and outflows to verify that the aquifer water balance is complete and has no error if the aquifer water balance does not close then likely the groundwater residence time within a given grid cell is smaller than the specified time step δt resulting in incorrect groundwater lateral flow values to remedy this δt should be decreased by the model user e g from 1 0 day to 0 5 day 2 2 2 module application to the national agroecosystem model in this study we demonstrate the application of the gwflow module to the huc8 scale swat models that comprise nam this application includes two key components 1 modifying the gwflow module code and input file structure to provide linkages to nam characteristics and 2 creating a scripted workflow to automate the geoprocessing of groundwater features and their spatial connections to swat objects for each huc8 scale model the use of a script minimizes user error in creating spatial linkages and provides a rapid method for creating these linkages for the 2121 huc8 scale models for component 1 the first modification to the swat and gwflow code includes linking groundwater pumping to crop irrigation for hrus that are designated as receiving groundwater for irrigation based on water usage data dieter et al 2018 for a day in which groundwater is assumed to be applied as irrigation to a given field the specified irrigation depth is multiplied by the area of the field with the resulting volume of groundwater then removed from the corresponding linked gwflow grid cells i e the set of cells that geographically underly the hru the groundwater volume v for each pumped grid cell is tracked to prevent over pumping from a dry aquifer if the available groundwater is less than the irrigation demand the available groundwater is removed from the aquifer and the irrigation depth is accordingly re calculated the second modification involves the swat code that links hru deep percolation to grid cell recharge and using the same spatial connections the transfer of grid cell groundwater storage to the hru soil profile to account for shallow water tables gis shape files of cultivated fields are provided by yan and roy 2016 and therefore recharge from each field hru to grid cells is handled using the normal gwflow routines using the intersected areas between the fields and the grid cells however the remaining hrus are not spatially explicit in nam as is the case for most swat applications therefore for watershed areas that are not fields recharge to grid cells is calculated using the average recharge rate from all non field hrus within a routing unit i e huc12 catchments similarly due to the lack of full spatial connectivity between hrus and grid cells the transfer of groundwater from grid cells to the soil profile of connected hrus is not possible therefore whereas shallow groundwater should be routed to the soil profile and then often to streams via soil lateral flow in this study the groundwater can reach the ground surface and then is routed to streams via saturation excess flow although not ideal in a hydrologic sense this procedure seems adequate for regional scale model applications such as the intended use of nam the third modification includes simulating water exchange between lakes reservoirs and groundwater for cells adjacent to reservoir objects water exchange q gw res is calculated using darcy s law 8 q i j g w r e s k r e s h r e s h i j z r e s z r e s δ x where k res is the hydraulic conductivity m day of reservoir bed material h res is the stage m of the reservoir on the current day h ij is the simulated groundwater head of the cell m for the current day z res is the thickness m of the reservoir bed material and δx is the length m of the cell h res is simulated through the reservoir control subroutine of swat equation 8 yields reservoir water seepage to the aquifer if the reservoir stage is higher than the local water table and groundwater discharge to the reservoir if the water table is higher than the reservoir stage these exchange rates q are tracked to maintain a mass water balance within and between reservoir cells and reservoir objects the fourth modification to the code includes reading in annual average values of groundwater head from usgs monitoring wells for comparison with simulated groundwater head at corresponding grid cells allowing for rapid model testing and performance statistics of groundwater head bailey and alderfer 2022 calculated annual average groundwater head values for each usgs groundwater monitoring well drilled in an unconfined aquifer within the conus between 1920 and 2020 all data were retrieved from the usgs groundwater data web page https waterdata usgs gov nwis gw groundwater head data were filtered between confined and unconfined aquifers using a national dataset of aquifer thickness shangguan et al 2017 and usgs local aquifer codes and then processed to provide annual average groundwater head values for each year for each monitoring well these data are stored in a text file and read in at the beginning of each swat model simulation for each monitoring well located within the boundary of the huc8 scale model the corresponding gwflow grid cell i e the cell in which the monitoring well resides geographically is identified and annual average values of groundwater head at these cells are tracked and then stored in an output file alongside the value from the monitoring well mean absolute error mae of the simulated groundwater head values at each monitoring well location also is calculated and written to the output file for ease of model assessment this assessment along with streamflow comparisons at usgs gaging sites provides a strong corroboration of model performance for component 2 a python script was written to automate the following geoprocessing routines fig 3 for each huc8 model 1 create the gwflow grid of cells and identify active grid cells using the boundary of the huc8 watershed the user specifies the desired uniform length m and width m of the cells 2 determine the aquifer thickness m for each grid cell using the global raster dataset of the thickness of unconsolidated material i e the vertical distance from ground surface to bedrock shangguan et al 2017 see table 1 and fig 3 3 determine the ground surface elevation m for each grid cell using a 30 m digital elevation model dem raster 4 determine the aquifer properties hydraulic conductivity specific yield of each grid cell using a national map of geologic units horton 2017 see fig 3 each geologic unit in the national map is assigned a default value of hydraulic conductivity and specific yield based on general literature these values can be changed during model calibration 5 determine the initial groundwater head h m for each grid cell using the point usgs groundwater data processed by bailey and alderfer 2022 see fig 3 for the location of monitoring wells these values are determined by spatial interpolation between the locations of monitoring wells for huc8 watersheds without observed groundwater head data the groundwater head is set at a specified uniform depth below the ground surface for the entire watershed 6 identify boundary cells and for each boundary cell indicate the boundary condition constant head or no flow 7 determine the presence of tile drains for each grid cell using the national tile drain 30 m raster dataset of valayamkunnath et al 2020 see fig 3 8 determine the presence of lakes and reservoirs for each grid cell using the water body shape file 9 identify river cells using an intersection with nhd flow lines specify the elevation thickness and hydraulic conductivity of the river bed for each intersected cell 10 link cultivated fields hrus yan and roy 2016 to the active grid cells 11 intersect grid cells with usgs monitoring well locations specify the name of each well well location and name are used to test each model against measured groundwater head the script then uses the established spatial connections to create the necessary gwflow input files fig 3 the script also saves all constructed gis files for ease of viewing and map making the swat model then can be run with the gwflow inputs and results compared to measured streamflow and groundwater head 2 3 study watersheds we demonstrate the inclusion of gwflow in the nam by application to six study watersheds fig 4 little river georgia cache river missouri arkansas nanticoke river delaware maryland winnebago river minnesota iowa sauk river washington and upper yellowstone river montana wyoming the characteristics of each watershed are listed in table 2 spatial areas range from 1783 km2 winnebago to 7768 km2 upper yellowstone and annual precipitation rates range from 555 mm upper yellowstone to 2556 mm sauk each watershed is a headwater huc8 and hence no inflow from upstream huc8 watersheds and are in different huc2 regions table 2 these six watersheds were chosen due to existing hydrologic features that provide insightful demonstrations of the gwflow application such as high estimated baseflow fractions wolock 2003 0 69 for upper yellowstone 0 60 for nanticoke and sauk extensive presence of tile drains in fields winnebago groundwater pumping for irrigation cache shallow groundwater with extensive hydraulic connection with streams little nanticoke a dry semi arid climate upper yellowstone and humid climate little cache nanticoke sauk the cache river watershed is one of the leading rice producing areas in the united states us army corps of engineers 2017 2 3 1 huc8 base model preparation the base swat models for the 6 watersheds were constructed using the datasets listed in table 1 and the method described in arnold et al 2021 a map of each study watershed showing watershed boundary subbasin boundaries water bodies streams weather stations and usgs river gages is shown in fig 5 a list of usgs gages by site id is presented in section 3 table 2 lists the number of hrus and channels for each watershed before applying the gwflow module these models were calibrated using soft data i e processes that cannot be measured directly such as average annual estimates of water balance components precipitation surface runoff et total water yield baseflow which provide realistic parameter ranges and a formal check on model rationality seibert and mcdonnell 2002 arnold et al 2015 average annual hydrologic flux estimates quick flow runoff recharge and et from reitz et al 2017 were weighted for each huc8 and compared to model output modeled surface runoff was assumed to be equivalent to quick flow runoff and modeled lateral soil flow tile flow and percolation from the soil profile were assumed to be equivalent to recharge five model parameters are used for calibration 1 lateral flow travel time coefficient latq co range from 0 to 1 2 soil evaporation compensation factor esco range from 0 to 1 soil water content at condition iii curve number an indication of hortonian vs saturation excess runoff cn3 swf range from 0 2 1 4 percolation coefficient to limit percolation from the bottom of the soil profile perco range from 0 to 1 and 5 radiation coefficient used in potential et equation harg pet range from 0 0016 to 0 0023 the initial simulation for each model used default values for each parameter based on soil properties and topographic slope whereupon the model is run iteratively using the difference between simulated and observed quick flow and recharge to update parameter values see fig s1 in supplemental information the procedure is coded in swat so no other interface or software is needed a maximum of 18 simulations was required to minimize the difference between simulated and observed values 2 3 2 augmenting the models with the gwflow module for each base swat model the gwflow python script was run with the national datasets see table 1 to prepare the gwflow inputs using a cell size of 500 m for each watershed the resulting number of grid rows and columns for each watershed is shown in table 2 the cell by cell aquifer thickness m aquifer hydraulic conductivity m day and initial groundwater head as produced by the script is shown for each watershed in figs 6 8 respectively the thickness of the unconfined aquifer fig 6 ranges from a few meters to more than 80 m with a shallow aquifer for little nanticoke sauk and portions of upper yellowstone and spatial patterns following the location of the stream network for cache however the entire watershed is underlain by a thick aquifer 20 m often up to more than 80 m which is utilized for groundwater irrigation us army corps of engineers 2017 the hydraulic conductivity of the unconfined aquifer fig 7 similarly follows spatial patterns of the stream network with values ranging from extremely low 0 00001 m day for rock to very high 100 m day for alluvium sand and gravel initial groundwater fig 8 was established using spatial interpolation between the groundwater head values obtained from usgs monitoring wells for the year 2000 see location in fig 5 the number of monitoring wells for the little cache nanticoke winnebago sauk and upper yellowstone watersheds is 31 182 35 26 0 and 2 wells respectively due to the lack of groundwater head data in the sauk river watershed the initial head for each grid cell was set to 5 m below the ground surface in contrast initial head data for the cache river watershed are plentiful thereby providing accurate patterns of groundwater depressions in the southern half of the watershed due to groundwater pumping for irrigation boundary conditions for the cache river watershed were set to no flow due to the expected large amounts of pumping and drawdown in the watershed whereas the boundary conditions were set to constant head for the other watersheds each model was validated against monthly streamflow at usgs gage stations and annual average groundwater head at available usgs monitoring wells during the 2000 2015 period for monthly streamflow model performance was evaluated using nash sutcliffe efficiency nse modified nash sutcliffe efficiency mnse coefficient of determination r2 and the percent bias pbias moriasi et al 2015 for model performance regarding annual average groundwater head we use mean absolute error mae m for monthly streamflow we also compare model results against the stand alone swat models to indicate key differences in model working when the gwflow module is included using an intel core i7 10700 cpu 2 90 ghz with 16 gb ram desktop computer run times for the 6 simulations with the gwflow module table 3 were approximately 14 33 11 7 4 and 19 min respectively averaging 1 6 times longer than the base swat simulation time 3 results and discussion 3 1 water balance results of the initial soft calibration procedure using the base swat models are presented in table 4 showing close comparisons with reitz et al 2017 data the average annual hydrologic fluxes mm for each of the 6 study watersheds using the swat model with the gwflow module are presented in table 5 watershed inputs include precipitation and groundwater inflow along the watershed boundary watershed outputs include evapotranspiration et surface runoff soil lateral flow stream seepage saturation excess flow and tile drainage flow with the latter three terms computed by the gwflow module we note that values of surface runoff in table 5 are similar in magnitude to the base swat results in table 4 recharge magnitudes are not as similar with differences of up to 25 except for winnebago with gwflow estimating approximately one third the value of the base swat model 93 mm yr compared to 242 mm y fluxes internal to the watershed include recharge soil aquifer pumping irrigation aquifer land surface groundwater lake and reservoir exchange aquifer lakes and reservoirs and surface water irrigation channels land surface with the first three terms computed by the gwflow module table 5 also lists average annual water yield and key hydrologic fractions of note are the high values of saturation excess flow for nanticoke 465 mm and sauk 1898 mm indicating high volumes of groundwater discharging to the stream network cache has a net loss of stream water to the aquifer 75 mm seepage 51 sat excess flow 24 net due to deeper groundwater levels winnebago as expected has the highest tile drain flow 25 mm and cache has the highest groundwater pumping for irrigation 123 mm baseflow fraction is high 0 70 for nanticoke sauk and upper yellowstone moderate for little 0 28 and winnebago 0 40 although for the latter the fraction increases to 0 49 if tile drain flow is included in baseflow sauk has a yield fraction of 1 01 due to the inflow of groundwater along the watershed perimeter boundary inflow 744 mm the recharge fraction i e the ratio of recharge to precipitation ranges from 0 08 little river to 0 45 sauk however recharge can be derived from both precipitation and irrigation we noted in section 2 2 that groundwater lake exchange using reservoir objects within swat is a new feature of this gwflow application although this flux may be important for other watersheds it is low for the six watersheds of this study see table 5 maximum rate of 8 mm day for the sauk river watershed which is only 0 1 of soil recharge and therefore only has a minor influence on overall groundwater and watershed budgets monthly hydrologic fluxes 2003 2006 for each watershed are given in fig 9 watershed inputs precipitation boundary inflow are presented as positive values whereas watershed outputs surface et runoff lateral flow groundwater saturation excess flow tile drainage are presented as negative values these plots demonstrate the seasonality of fluxes for each watershed of note are the seasonal pattern and high flux rates for groundwater pumping in the cache river watershed tile drainage outflow in the winnebago river watershed and saturation excess flow i e groundwater discharge in the nanticoke river 3 2 streamflow comparison of simulated and measured monthly streamflow at 14 gage sites in the 6 watersheds table 6 fig 10 demonstrate both good excellent model performance and key areas for improvement five sites have nse 0 60 but all sites in the sauk and upper yellowstone have nse 0 pbias generally is 0 indicating underestimation of streamflow these performance statistics are corroborated by visual comparisons between hydrographs in fig 10 although the sauk model captures the general trend of the hydrograph values are often higher than measured values and are offset by 1 2 months similar to the results of the yellow river at corwin springs when compared with results from the base swat models fig 11 the use of gwflow shows improvement in baseflow particularly for the cache river near cotton plant and the sauk river near sauk due to the physically based representation of groundwater levels and groundwater surface water exchange however the models with the gwflow module sometimes under estimate peak flow nanticoke river near bridgeville cache river near cotton plant likely due to under estimation of surface runoff and associated over estimation in recharge based on the default soil parameters in the swat model if these models were to be employed in scenario analysis these features can be adjusted during model calibration as discussed in section 3 5 3 3 groundwater head the simulated cell by cell values of groundwater head for the year 2016 fig 12 are similar in pattern to the maps of initial head year 2000 fig 8 with adjustments during the 2000 2015 period based on an imbalance between groundwater inflow recharge seepage and outflows pumping saturation excess flow tile drainage groundwater et the monthly fluxes mm of each groundwater term are shown in fig 9 right column showing seasonal patterns of recharge pumping cache and tile drainage winnebago mae results fig 13 show good agreement 1 5 m difference in groundwater head between measured and simulated annual average groundwater head at monitoring well locations although several locations show high error 3 0 m difference in groundwater error maps of saturated thickness vertical distance between water table and bedrock in the year 2016 for three of the watersheds nanticoke winnebago and cache fig 14 top pane show similar patterns to the aquifer thickness maps fig 6 but with spatial variations due to increases and decreases in groundwater levels for each watershed these maps can be used to estimate total available groundwater in the unconfined aquifers by multiplying the saturated thickness m of each cell by the cell size m2 and the specific yield see equation 6 depth to water table fig 14 middle pane shows shallow groundwater conditions for nanticoke and portions of winnebago hence the need for tile drainage for the latter and deep groundwater levels for cache due to groundwater pumping for irrigation see figs 8 and 12 the relation between groundwater head ground surface bedrock and key groundwater fluxes in a cross section setting fig 14 bottom pane demonstrate the physically based nature of the gwflow module groundwater levels initialized by spatial interpolation between monitoring well locations respond and adjust to inflows and outflows with resulting gradients driving groundwater flow to adjacent areas and finally to streams and rivers cell by cell fluxes m3 day of saturated excess flow tile drainage outflow and groundwater pumping are shown for nanticoke winnebago and cache respectively shallow water tables intersecting stream channels occur in nanticoke and winnebago with the spatial pattern in winnebago also impacted by drainage outflow if the water table rises above the drain elevation deeper water tables occur for cache with depletion occurring in the eastern region of the watershed these simulated deep groundwater levels are corroborated by comparison with usgs monitoring well data see the multitude of green dots in fig 13 for cache particularly within the eastern region and are in agreement with recent studies in the cache river watershed leslie et al 2022 3 4 groundwater fluxes raster i e cell by cell maps of average daily groundwater source sink fluxes figs 15 18 are key components of model output and analysis showing areas of stress within the aquifer system and areas of key inputs i e saturation excess flow tile drainage into the stream channel system such maps also aid in determining why differences between simulated and observed groundwater head might occur see fig 13 recharge maps fig 15 show field scale recharge for little cache nanticoke and winnebago watersheds due to the presence of fields throughout the watershed recharge patterns for sauk and upper yellowstone are based on the boundaries of huc12 catchments due to the lack of cultivated fields see section 2 2 for upper yellowstone field scale recharge does occur along the river system due to the presence of irrigated fields within the stream corridors groundwater stream interaction is a combination of stream seepage fig 16 and groundwater saturation excess flow fig 17 of course stream seepage to the aquifer fig 16 occurs along the stream system with high rates typically occurring along the major rivers due to high stream depths and hence the large head difference between the stream and the surrounding water table saturation excess flow fig 17 has similar spatial patterns with high values along rivers and streams due to shallow groundwater levels that periodically rise above the ground surface however whereas seepage occurs along most streams in the nanticoke and cache watersheds saturation excess flow occurs only in certain regions due to the water table being lower than the stream channel this is particularly true for the cache river fig 17 due to extensive groundwater pumping and lowering of groundwater levels see fig 14 water table depth and cross section plot groundwater pumping for irrigation fig 18 is shown only for the three watersheds where it is simulated nanticoke cache and upper yellowstone low pumping rates occur for nanticoke moderate rates occur for cache and high pumping rates occur for upper yellowstone although rates are only localized for the latter due to irrigated fields along the corridor of the yellowstone river the extensive pumping within the cache watershed leads to the lowering of groundwater levels in the unconfined aquifer see fig 14 representing groundwater depletion that has been observed in the mississippi alluvial plain generally konikow 2013 2015 reba et al 2017 and in the cache river watershed specifically leslie et al 2022 3 5 methods for improvement in model performance in this article we have presented hydrologic results from models that have not yet undergone hard calibration as a demonstration of the modeling approach for the conterminous united states conus using the original swat structure of nam as the presented modeling system is applied to regions within conus parameter estimation tools will be required to ensure appropriate model mimicry of water balance components e g evapotranspiration runoff recharge baseflow stream discharge and groundwater head so that models can be used in scenario analyses e g impact of climate change land use change and conservation practices on hydrological processes and water supply water balance components can be compared to national assessments such as in reitz et al 2017 and stream discharge and groundwater head can be compared to available data from usgs gaging stations and monitoring wells as outlined in this study the gwflow routines within the swat code are equipped to output comparisons between simulated and observed groundwater head per the usgs groundwater head data processed by bailey and alderfer 2022 specific parameter estimation tools that can be used in model calibration are pest parameter estimation software doherty 2018 as performed by bailey et al 2021 in their use of the gwflow module to simulate tile drainage for a watershed in iowa and the particle swarm optimization pso algorithm as performed by rafiei et al 2022 in their use of swat modflow rt3d to simulate nutrient transport in a coastal watershed system pest and other software programs can be used for uncertainty analysis and sensitivity analysis not only quantifying the influence of input parameters on standard model output stream discharge groundwater head but also on water balance fluxes themselves for the latter researchers can identify controlling factors on key hydrologic fluxes providing insights into impactful strategies for water management the use of an integrated modeling system like swat with the gwflow module is important for such an assessment as all major hydrologic fluxes within the watershed system are linked and depend on each other for example when estimating model parameters surface runoff fluxes recharge fluxes and groundwater surface water fluxes all must be considered in their control of stream discharge and groundwater head in this way tight control of water balance components is achieved 4 summary and conclusions in this paper we present a holistic approach to modeling watershed scale hydrologic processes for any huc8 watershed within the conus using the swat models that comprise the nam the approach uses the gwflow module a new physically based spatially distributed groundwater modeling routine that is embedded in the swat modeling code using a grid of cellular control volumes to calculate daily water balance in an unconfined aquifer key calculated groundwater inflow and outflows include recharge pumping groundwater lake exchange groundwater surface water exchange transfer to soils and boundary inflow the gwflow module uses national scale datasets of aquifer thickness geologic units streamflow lines water bodies tile drain locations topography boundaries of cultivated fields boundaries of huc12 catchments and usgs groundwater head data to establish cell by cell aquifer properties and spatial connections with swat objects hrus channels routing units and reservoirs a python script is used to automate the processing of these datasets to construct gwflow input files for swat we demonstrate the approach for six watersheds each within a different huc2 region of the conus using 500 m grid cells for gwflow the base swat models have been soft calibrated for overall watershed water balance fluxes but no hard calibration for streamflow and groundwater head has been performed with the augmented models whereas several of the watershed models exhibited excellent stream discharge and groundwater head results other models or spatial regions of the models exhibited poor results that can be improved during model calibration model outputs including stream discharge groundwater head spatial maps and time series of observation locations saturated thickness spatial maps water table depth spatial maps and times series and cell by cell raster maps of groundwater fluxes recharge stream seepage saturation excess flow tile drainage pumping can be used to corroborate the model and identify regions that require additional parameter estimation in general using the combination of stream discharge groundwater head and average annual water balance fluxes can constrain hydrologic fluxes to realistic ranges thereby providing a modeling tool that can be used for scenario analysis climate management land use in the region of interest declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements financial support for this study was provided by the united state department of agriculture agricultural research service through cooperative agreements 59 3098 8 002 and 59 3098 2 001 usda is an equal opportunity employer and provider author contributions r b j a and m w designed the research r b and j a performed model coding r b s a j a m w j g and n c performed the research s a r b j g and n c analyzed the data r b and s a wrote the paper usda is an equal opportunity employer and provider appendix a supplementary data the following is the supplementary data to this article multimedia component 1 multimedia component 1 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j envsoft 2022 105589 
25455,we present an integrated hydrologic modeling approach for the conterminous united states using the swat models of the national agroecosystem model nam the nam is a field based national scale hydrologic model to aid in conservation planning and policy we augment the nam by simulating groundwater storage and flow in a physically based spatially distributed manner using the gwflow module we also present a scripting tool that automates the creation of gwflow inputs for each 8 digit hydrologic unit code huc8 swat model key calculated groundwater inflows and outflows include recharge pumping groundwater lake exchange groundwater surface water exchange transfer to soils and boundary inflow we demonstrate the approach for six huc8 watersheds located in various regions of the united states focusing on areas of groundwater pumping tile drainage intensive groundwater surface water interactions and high precipitation the presented framework can be used to establish models for scenario analysis of climate management and land use keywords swat swat groundwater modeling aquifers agroecosystem data availability data will be made available on request software availability name of software swat fortran 524 files 3 2 mb with the gwflow module developer and contact information ryan bailey rtbailey colostate edu jeffrey arnold year first available 2022 hardware required standard desktop pc software required none availability and cost source files of swat including the subroutines for the gwflow module are freely available for download at https swat tamu edu software plus gwflow 1 introduction the need to quantify current and future water supply and water quality conditions in regions of the world has led to recent advances in large scale integrated hydrologic modeling modeling is performed at the river basin sun et al 2016 mohammed et al 2018 aliyari et al 2019 tran et al 2022a tran et al 2022b regional schuol et al 2008 peterson et al 2016 hanson et al 2020 čerkasova et al 2021 national condon and maxwell 2019 alattar et al 2020 and even continental abbaspour et al 2015 naz et al 2022 scale many of these models have been used to inform policy regarding water management and climate change effects e g abbaspour et al 2015 čerkasova et al 2021 whereas others are used to improve understanding of hydrologic systems and feedbacks maxwell et al 2016 or are prepared for potential application in scenario analysis alattar et al 2020 the degree of model complexity within these studies is wide ranging with several approaches using the semi distributed model swat arnold et al 1998 which lumps hydrologic fluxes at the level of hydrologic response units hrus unique geographic areas of topographic slope soil type and land management and simulates groundwater storage and flow using steady state assumptions and linear reservoir equations sun et al 2016 in the yangtze river basin china yan and roy 2016 in the yellow river basin china schuol et al 2008 in west africa abbaspour et al 2015 for the european continent and čerkasova et al 2021 for the nemunas river basin europe the other approaches generally use coupled surface subsurface models with physically based spatially distributed groundwater flow modeling such as hanson et al 2020 and alattar et al 2020 using modflow owhm hanson et al 2014 and condon and maxwell 2019 and o neill et al 2021 using parflow alattar et al 2020 used a grid cell size of 13 km and monthly water budgets to simulate groundwater head and stream discharge of major rivers in the conterminous united states conus and maxwell et al 2016 used a 1 km cell size to simulate hydrologic fluxes across the majority of conus a new effort to simulate hydrologic fluxes and water resources within conus is the national agroeosystem model nam arnold et al 2021 white et al 2022 comprised of one watershed model for each 8 digit watershed of the conus with flow routed between upstream and downstream watersheds to provide a single hydrologic system the modeling code used is swat bieger et al 2017 a restructured version of swat that provides enhanced flexibility in routing water between spatial objects within a watershed system the nam uses a suite of publicly available national datasets such as topography soil unit boundaries and characteristics streamflow lines water bodies tile drainage locations irrigation practices water use reservoir management field boundaries and subbasin boundaries to create one swat model for each of the 2121 huc8 watersheds although stream discharge and general water balance components have been corroborated against observation data e g white et al 2022 the swat groundwater components are little changed from the original swat code and have the same limitations to provide a holistic integrated approach to watershed modeling and hydrologic flux quantification the nam needs a groundwater module that uses physically based spatially distributed groundwater modeling principles particularly for watersheds wherein groundwater plays a key role in irrigation water supply and streamflow generation the objective of this paper is to introduce a modeling framework for including physically based spatially distributed groundwater modeling into the swat models comprising nam this is achieved by using the new gwflow module bailey et al 2020 of swat modified herein to link with the spatial objects specific to the nam the gwflow module simulates spatially distributed groundwater storage groundwater head and key groundwater sources and sinks recharge lake exchange stream exchange tile flow saturation excess flow pumping using a grid of cells i e aquifer control volumes that encompasses the watershed boundary the module is written as a subroutine of swat and exchanges water with other swat objects hydrologic response units hrus reservoirs lakes and streams to provide an integrated hydrologic model for surface and subsurface processes for ease of model construction and application we also introduce a scripted workflow to automate the geoprocessing of spatial connections between swat objects hrus streams lakes and gwflow grid cells and the writing of gwflow input files that contain the connection data the script uses publicly available national datasets of topography aquifer thickness geologic units and tile drainage to populate grid cell properties we demonstrate the enhanced modeling framework for 6 huc8 watersheds across the conterminous united states little river georgia cache river missouri arkansas nanticoke river delaware maryland winnebago river minnesota iowa sauk river washington and upper yellowstone river montana wyoming these watersheds were chosen due to unique and diverse hydrologic features such as high baseflow little nanticoke groundwater pumping for irrigation cache tile drainage winnebago semi arid climate upper yellowstone and the absence of cultivation sauk for each watershed we amend a previously constructed and soft calibrated swat model arnold et al 2021 white et al 2022 with the gwflow module and then compare model output to measured streamflow and groundwater head at available usgs stream gages and monitoring wells respectively as the objective of this paper is to introduce the modeling framework and scripted workflow we do not perform any additional calibration instead using results to highlight the reasonable spatio temporal patterns and water balance of preliminary model results and the potential improvement in model performance for the study watersheds as presented this framework can be used in future studies to assess regional and national spatio temporal patterns and trends in recharge groundwater storage groundwater pumping baseflow and tile drainage beyond the typical capabilities of the nam swat models 2 methods 2 1 swat and the national agroecosystem model nam the watershed model swat bieger et al 2017 is a restructured form of the original soil and water assessment tool swat arnold et al 1998 designed to more easily provide connectivity between hydrologic objects in a watershed system for example whereas swat is limited to a single stream channel per subbasin swat can simulate the movement of water nutrients and sediment for any number of channels within the watershed landscape specific hydrologic objects include fields hrus stream channels aquifers ponds wetlands and reservoirs with water nutrient mass and sediment routed between objects as specified by the user on a daily time step the watershed is divided into routing units which lumps hydrographs from multiple objects permitting simplified routing across the landscape and through the channel network the swat code is written in fortran and available open source at https swat tamu edu software plus with a gis geographic information system user interface and tools for model calibration sensitivity analysis and uncertainty analysis swat is currently being applied to the conterminous united states as the national agroecosystem model nam arnold et al 2021 white et al 2022 for conservation policy and environmental planning within the nam a separate swat model is created for each of the 2121 huc8 8 digit hydrologic unit code watershed within the conus each model uses five domains for simulating hydrologic processes and management field 1 50 ha transition 0 2 2 0 km2 headwater 1 15 km2 tributaries 15 150 km2 and main river 150 km2 datasets used to construct each swat model table 1 include field boundaries yan and roy 2016 with each field designated as an individual hru crop rotation usda cropscape 10 m topographic slope 10 m soil boundaries and properties gssurgo 30 m land use and land cover stream segments as provided by the national hydrography dataset nhdplus version 2 moore and dewald 2016 lakes and reservoirs weather ghcn prism using methods of gao et al 2020 water use from the 2015 usgs national assessment dieter et al 2018 and county level reports of irrigated and non irrigated planted acres with the latter used to derive irrigation probabilities point discharge into streams from facilities skinner and maupin 2019 and databases for plants fertilizer tillage and irrigation operations subbasin boundaries within each huc8 model are designated by huc12 catchments the width and depth of each nhd channel were estimated using the method of bieger et al 2016 release parameters for reservoirs were derived using data from wu et al 2020 full details of model datasets and construction are provided in white et al 2022 model construction using these datasets results in a total of 4 606 927 agricultural fields hrus 2 296 974 non agricultural hrus 1 610 000 headwater channels 591 000 tributary channels and 432 400 main channels arnold et al 2021 for the 2121 huc8 models each huc8 scale model is run for the 2000 2015 period on a daily time step outflow from headwater huc8 watersheds is provided as input into adjacent downstream huc8 watersheds in a cascading manner until the most downstream huc8 watershed model in a given river basin has been run 2 2 the gwflow module and its inclusion in the nam 2 2 1 basics of the gwflow module the new gwflow module bailey et al 2020 2022 was added as an option to swat and users may activate it or the original groundwater module the original module provides a simplistic representation of groundwater storage groundwater flow and interaction with other water systems soil profile reservoirs streams in a watershed setting including homogeneous aquifer properties groundwater discharge to streams based on steady flow conditions and user defined thresholds rather than gradients and head differences and the lack of groundwater flow between adjacent aquifer units the gwflow module was designed to provide a physically based spatially distributed simulation of groundwater states storage head saturated thickness and fluxes for the swat watershed setting the module uses a set of cells i e aquifer control volumes that are connected in space to simulate the movement of groundwater laterally through a single layer unconfined aquifer each cell has a specified fixed volume bounded by the ground surface above the bedrock below and faces on the north east south and west groundwater can be exchanged across the four faces with surrounding cells cells along the boundary of the watershed can be designated as either constant head cells or no flow cells with the latter preventing any groundwater from crossing the watershed boundary each cell is provided a value of hydraulic conductivity k m day and specific yield s y the geographic set up of the gwflow module is shown in fig 1 fig 1a shows the watershed boundary red subbasins black and stream channels blue for a generic swat model set up and the gwflow grid fig 1b shows a close up of a watershed area and grid cells and fig 1c shows the multi dimensional view of a representative grid cell depicting the water table bedrock saturated thickness lateral dimensions δx δy and total groundwater volume v m3 for each daily time step δt of the swat simulation the gwflow module is called as a subroutine to compute sources and sinks and update groundwater storage and groundwater head for each grid cell the module uses an explicit forward in time numerical method to update groundwater storage v for each grid cell using the following water balance equation see fig 1b and c 1 δ v i j n 1 δ t s o u r c e s i j n s i n k s i j n l a t e r a l f l o w i j n where n 1 represents the current time day n represents the previous day and i and j represent the row and column indices respectively of each cell equation 1 can be expanded to 2 v i j n 1 v i j n s o u r c e s i j n s i n k s i j n l a t e r a l f l o w i j n t n 1 t n groundwater sources sinks and lateral flow are volumetric fluxes m3 day of groundwater computed as 3 s o u r c e s q r e c h q s w g w q l a k e g w 4 s i n k s q g w e t q g w s w q s a t e x q p u m p q g w l a k e q t i l e q s o i l 5 l a t e r a l f l o w q n o r t h q s o u t h q w e s t q e a s t where rech sw gw lake gw gwet gw sw satex pump gw lake tile and soil represent recharge stream seepage to the aquifer lake seepage to the aquifer groundwater evapotranspiration et groundwater discharge to streams saturation excess flow when the water table intersects the ground surface groundwater pumping groundwater discharge to lakes groundwater discharge to tile drains and groundwater transfer to the soil profile respectively see fig 1c q north q south q west and q east represent lateral groundwater fluxes into out of the four sides of the grid cell which provides the spatial connectivity of the aquifer system the resulting groundwater volume v for each grid cell is used to update groundwater head h for each cell using the volume equation 6 v i j n 1 δ x δ y s i j n 1 s y i j where s is saturated thickness m water table to bedrock of the aquifer and equating δs to δh 7 h i j n 1 h i j n s o u r c e s i j n s i n k s i j n l a t e r a l f l o w i j n δ t s y i j δ x δ y as the presented method is explicit in nature i e all values of v and h at the current time step n 1 are calculated using values from the previous time step n initial v and h must be specified for each cell for t 0 which corresponds to the first day of the swat simulation within the gwflow subroutine the following spatial connections are instituted for integrating gwflow calculations with swat objects fig 2 1 recharge q rech is provided to grid cells by hru soil profile deep percolation using spatial intersections between hrus and grid cells 2 groundwater transfer to soils q soil for conditions where the groundwater levels rise above the bottom of the soil profile using spatial intersections between grid cells and hrus 3 groundwater stream exchange volumes q sw gw q gw gw are calculated for each grid cell that geographically intersects a stream channel and provided to the corresponding channel object 4 groundwater lake exchange volumes q lake gw q gw lake are calculated for each grid cell that geographically intersects a lake or reservoir and provided to the corresponding reservoir object 5 groundwater discharge to tiles q tile is calculated for each grid cell that geographically includes a tile drain and provided to the channel object to which the tile drains 6 saturation excess flow q satex is calculated for conditions of the water table rising above the ground surface i e during a storm event and provided to the channel object to which the surface runoff of the corresponding hru drains lateral flows q north q south q west and q east groundwater exchange with streams q sw gw q gw gw and lakes q lake gw q gw lake and groundwater discharge to tile drains q tile are computed using darcy s law which requires a relation of h interface areas m2 and k m day of the aquifer streambed and lakebed respectively the inclusion of q tile was introduced by bailey et al 2021 in a study of subsurface drainage in a watershed in iowa the inclusion of groundwater lake interactions q lake gw q gw lake is introduced in this paper for the first time due to the need for this connection for many watersheds using the gwflow module with swat requires the following input files gwflow input cell information ground surface aquifer thickness initial h k s y streambed k lakebed k tile drain k gwflow hrucell spatial connections between grid cells and hru objects gwflow rivcells spatial connections between grid cells and channel objects the gwflow module is constituted by four new subroutines to the swat code gwflow module for variable declaration gwflow riv for connections between river cell and channel objects gwflow read for reading the gwflow inputs and gwflow simulate for simulating equations 6 and 7 outputs for the gwflow module include daily monthly and yearly groundwater balance terms cell by cell annual flux rates for each groundwater source and sink and cell by cell groundwater head for specified days of the simulation period for each time step the total change in groundwater storage in the unconfined aquifer is compared to the summation of all groundwater inflows and outflows to verify that the aquifer water balance is complete and has no error if the aquifer water balance does not close then likely the groundwater residence time within a given grid cell is smaller than the specified time step δt resulting in incorrect groundwater lateral flow values to remedy this δt should be decreased by the model user e g from 1 0 day to 0 5 day 2 2 2 module application to the national agroecosystem model in this study we demonstrate the application of the gwflow module to the huc8 scale swat models that comprise nam this application includes two key components 1 modifying the gwflow module code and input file structure to provide linkages to nam characteristics and 2 creating a scripted workflow to automate the geoprocessing of groundwater features and their spatial connections to swat objects for each huc8 scale model the use of a script minimizes user error in creating spatial linkages and provides a rapid method for creating these linkages for the 2121 huc8 scale models for component 1 the first modification to the swat and gwflow code includes linking groundwater pumping to crop irrigation for hrus that are designated as receiving groundwater for irrigation based on water usage data dieter et al 2018 for a day in which groundwater is assumed to be applied as irrigation to a given field the specified irrigation depth is multiplied by the area of the field with the resulting volume of groundwater then removed from the corresponding linked gwflow grid cells i e the set of cells that geographically underly the hru the groundwater volume v for each pumped grid cell is tracked to prevent over pumping from a dry aquifer if the available groundwater is less than the irrigation demand the available groundwater is removed from the aquifer and the irrigation depth is accordingly re calculated the second modification involves the swat code that links hru deep percolation to grid cell recharge and using the same spatial connections the transfer of grid cell groundwater storage to the hru soil profile to account for shallow water tables gis shape files of cultivated fields are provided by yan and roy 2016 and therefore recharge from each field hru to grid cells is handled using the normal gwflow routines using the intersected areas between the fields and the grid cells however the remaining hrus are not spatially explicit in nam as is the case for most swat applications therefore for watershed areas that are not fields recharge to grid cells is calculated using the average recharge rate from all non field hrus within a routing unit i e huc12 catchments similarly due to the lack of full spatial connectivity between hrus and grid cells the transfer of groundwater from grid cells to the soil profile of connected hrus is not possible therefore whereas shallow groundwater should be routed to the soil profile and then often to streams via soil lateral flow in this study the groundwater can reach the ground surface and then is routed to streams via saturation excess flow although not ideal in a hydrologic sense this procedure seems adequate for regional scale model applications such as the intended use of nam the third modification includes simulating water exchange between lakes reservoirs and groundwater for cells adjacent to reservoir objects water exchange q gw res is calculated using darcy s law 8 q i j g w r e s k r e s h r e s h i j z r e s z r e s δ x where k res is the hydraulic conductivity m day of reservoir bed material h res is the stage m of the reservoir on the current day h ij is the simulated groundwater head of the cell m for the current day z res is the thickness m of the reservoir bed material and δx is the length m of the cell h res is simulated through the reservoir control subroutine of swat equation 8 yields reservoir water seepage to the aquifer if the reservoir stage is higher than the local water table and groundwater discharge to the reservoir if the water table is higher than the reservoir stage these exchange rates q are tracked to maintain a mass water balance within and between reservoir cells and reservoir objects the fourth modification to the code includes reading in annual average values of groundwater head from usgs monitoring wells for comparison with simulated groundwater head at corresponding grid cells allowing for rapid model testing and performance statistics of groundwater head bailey and alderfer 2022 calculated annual average groundwater head values for each usgs groundwater monitoring well drilled in an unconfined aquifer within the conus between 1920 and 2020 all data were retrieved from the usgs groundwater data web page https waterdata usgs gov nwis gw groundwater head data were filtered between confined and unconfined aquifers using a national dataset of aquifer thickness shangguan et al 2017 and usgs local aquifer codes and then processed to provide annual average groundwater head values for each year for each monitoring well these data are stored in a text file and read in at the beginning of each swat model simulation for each monitoring well located within the boundary of the huc8 scale model the corresponding gwflow grid cell i e the cell in which the monitoring well resides geographically is identified and annual average values of groundwater head at these cells are tracked and then stored in an output file alongside the value from the monitoring well mean absolute error mae of the simulated groundwater head values at each monitoring well location also is calculated and written to the output file for ease of model assessment this assessment along with streamflow comparisons at usgs gaging sites provides a strong corroboration of model performance for component 2 a python script was written to automate the following geoprocessing routines fig 3 for each huc8 model 1 create the gwflow grid of cells and identify active grid cells using the boundary of the huc8 watershed the user specifies the desired uniform length m and width m of the cells 2 determine the aquifer thickness m for each grid cell using the global raster dataset of the thickness of unconsolidated material i e the vertical distance from ground surface to bedrock shangguan et al 2017 see table 1 and fig 3 3 determine the ground surface elevation m for each grid cell using a 30 m digital elevation model dem raster 4 determine the aquifer properties hydraulic conductivity specific yield of each grid cell using a national map of geologic units horton 2017 see fig 3 each geologic unit in the national map is assigned a default value of hydraulic conductivity and specific yield based on general literature these values can be changed during model calibration 5 determine the initial groundwater head h m for each grid cell using the point usgs groundwater data processed by bailey and alderfer 2022 see fig 3 for the location of monitoring wells these values are determined by spatial interpolation between the locations of monitoring wells for huc8 watersheds without observed groundwater head data the groundwater head is set at a specified uniform depth below the ground surface for the entire watershed 6 identify boundary cells and for each boundary cell indicate the boundary condition constant head or no flow 7 determine the presence of tile drains for each grid cell using the national tile drain 30 m raster dataset of valayamkunnath et al 2020 see fig 3 8 determine the presence of lakes and reservoirs for each grid cell using the water body shape file 9 identify river cells using an intersection with nhd flow lines specify the elevation thickness and hydraulic conductivity of the river bed for each intersected cell 10 link cultivated fields hrus yan and roy 2016 to the active grid cells 11 intersect grid cells with usgs monitoring well locations specify the name of each well well location and name are used to test each model against measured groundwater head the script then uses the established spatial connections to create the necessary gwflow input files fig 3 the script also saves all constructed gis files for ease of viewing and map making the swat model then can be run with the gwflow inputs and results compared to measured streamflow and groundwater head 2 3 study watersheds we demonstrate the inclusion of gwflow in the nam by application to six study watersheds fig 4 little river georgia cache river missouri arkansas nanticoke river delaware maryland winnebago river minnesota iowa sauk river washington and upper yellowstone river montana wyoming the characteristics of each watershed are listed in table 2 spatial areas range from 1783 km2 winnebago to 7768 km2 upper yellowstone and annual precipitation rates range from 555 mm upper yellowstone to 2556 mm sauk each watershed is a headwater huc8 and hence no inflow from upstream huc8 watersheds and are in different huc2 regions table 2 these six watersheds were chosen due to existing hydrologic features that provide insightful demonstrations of the gwflow application such as high estimated baseflow fractions wolock 2003 0 69 for upper yellowstone 0 60 for nanticoke and sauk extensive presence of tile drains in fields winnebago groundwater pumping for irrigation cache shallow groundwater with extensive hydraulic connection with streams little nanticoke a dry semi arid climate upper yellowstone and humid climate little cache nanticoke sauk the cache river watershed is one of the leading rice producing areas in the united states us army corps of engineers 2017 2 3 1 huc8 base model preparation the base swat models for the 6 watersheds were constructed using the datasets listed in table 1 and the method described in arnold et al 2021 a map of each study watershed showing watershed boundary subbasin boundaries water bodies streams weather stations and usgs river gages is shown in fig 5 a list of usgs gages by site id is presented in section 3 table 2 lists the number of hrus and channels for each watershed before applying the gwflow module these models were calibrated using soft data i e processes that cannot be measured directly such as average annual estimates of water balance components precipitation surface runoff et total water yield baseflow which provide realistic parameter ranges and a formal check on model rationality seibert and mcdonnell 2002 arnold et al 2015 average annual hydrologic flux estimates quick flow runoff recharge and et from reitz et al 2017 were weighted for each huc8 and compared to model output modeled surface runoff was assumed to be equivalent to quick flow runoff and modeled lateral soil flow tile flow and percolation from the soil profile were assumed to be equivalent to recharge five model parameters are used for calibration 1 lateral flow travel time coefficient latq co range from 0 to 1 2 soil evaporation compensation factor esco range from 0 to 1 soil water content at condition iii curve number an indication of hortonian vs saturation excess runoff cn3 swf range from 0 2 1 4 percolation coefficient to limit percolation from the bottom of the soil profile perco range from 0 to 1 and 5 radiation coefficient used in potential et equation harg pet range from 0 0016 to 0 0023 the initial simulation for each model used default values for each parameter based on soil properties and topographic slope whereupon the model is run iteratively using the difference between simulated and observed quick flow and recharge to update parameter values see fig s1 in supplemental information the procedure is coded in swat so no other interface or software is needed a maximum of 18 simulations was required to minimize the difference between simulated and observed values 2 3 2 augmenting the models with the gwflow module for each base swat model the gwflow python script was run with the national datasets see table 1 to prepare the gwflow inputs using a cell size of 500 m for each watershed the resulting number of grid rows and columns for each watershed is shown in table 2 the cell by cell aquifer thickness m aquifer hydraulic conductivity m day and initial groundwater head as produced by the script is shown for each watershed in figs 6 8 respectively the thickness of the unconfined aquifer fig 6 ranges from a few meters to more than 80 m with a shallow aquifer for little nanticoke sauk and portions of upper yellowstone and spatial patterns following the location of the stream network for cache however the entire watershed is underlain by a thick aquifer 20 m often up to more than 80 m which is utilized for groundwater irrigation us army corps of engineers 2017 the hydraulic conductivity of the unconfined aquifer fig 7 similarly follows spatial patterns of the stream network with values ranging from extremely low 0 00001 m day for rock to very high 100 m day for alluvium sand and gravel initial groundwater fig 8 was established using spatial interpolation between the groundwater head values obtained from usgs monitoring wells for the year 2000 see location in fig 5 the number of monitoring wells for the little cache nanticoke winnebago sauk and upper yellowstone watersheds is 31 182 35 26 0 and 2 wells respectively due to the lack of groundwater head data in the sauk river watershed the initial head for each grid cell was set to 5 m below the ground surface in contrast initial head data for the cache river watershed are plentiful thereby providing accurate patterns of groundwater depressions in the southern half of the watershed due to groundwater pumping for irrigation boundary conditions for the cache river watershed were set to no flow due to the expected large amounts of pumping and drawdown in the watershed whereas the boundary conditions were set to constant head for the other watersheds each model was validated against monthly streamflow at usgs gage stations and annual average groundwater head at available usgs monitoring wells during the 2000 2015 period for monthly streamflow model performance was evaluated using nash sutcliffe efficiency nse modified nash sutcliffe efficiency mnse coefficient of determination r2 and the percent bias pbias moriasi et al 2015 for model performance regarding annual average groundwater head we use mean absolute error mae m for monthly streamflow we also compare model results against the stand alone swat models to indicate key differences in model working when the gwflow module is included using an intel core i7 10700 cpu 2 90 ghz with 16 gb ram desktop computer run times for the 6 simulations with the gwflow module table 3 were approximately 14 33 11 7 4 and 19 min respectively averaging 1 6 times longer than the base swat simulation time 3 results and discussion 3 1 water balance results of the initial soft calibration procedure using the base swat models are presented in table 4 showing close comparisons with reitz et al 2017 data the average annual hydrologic fluxes mm for each of the 6 study watersheds using the swat model with the gwflow module are presented in table 5 watershed inputs include precipitation and groundwater inflow along the watershed boundary watershed outputs include evapotranspiration et surface runoff soil lateral flow stream seepage saturation excess flow and tile drainage flow with the latter three terms computed by the gwflow module we note that values of surface runoff in table 5 are similar in magnitude to the base swat results in table 4 recharge magnitudes are not as similar with differences of up to 25 except for winnebago with gwflow estimating approximately one third the value of the base swat model 93 mm yr compared to 242 mm y fluxes internal to the watershed include recharge soil aquifer pumping irrigation aquifer land surface groundwater lake and reservoir exchange aquifer lakes and reservoirs and surface water irrigation channels land surface with the first three terms computed by the gwflow module table 5 also lists average annual water yield and key hydrologic fractions of note are the high values of saturation excess flow for nanticoke 465 mm and sauk 1898 mm indicating high volumes of groundwater discharging to the stream network cache has a net loss of stream water to the aquifer 75 mm seepage 51 sat excess flow 24 net due to deeper groundwater levels winnebago as expected has the highest tile drain flow 25 mm and cache has the highest groundwater pumping for irrigation 123 mm baseflow fraction is high 0 70 for nanticoke sauk and upper yellowstone moderate for little 0 28 and winnebago 0 40 although for the latter the fraction increases to 0 49 if tile drain flow is included in baseflow sauk has a yield fraction of 1 01 due to the inflow of groundwater along the watershed perimeter boundary inflow 744 mm the recharge fraction i e the ratio of recharge to precipitation ranges from 0 08 little river to 0 45 sauk however recharge can be derived from both precipitation and irrigation we noted in section 2 2 that groundwater lake exchange using reservoir objects within swat is a new feature of this gwflow application although this flux may be important for other watersheds it is low for the six watersheds of this study see table 5 maximum rate of 8 mm day for the sauk river watershed which is only 0 1 of soil recharge and therefore only has a minor influence on overall groundwater and watershed budgets monthly hydrologic fluxes 2003 2006 for each watershed are given in fig 9 watershed inputs precipitation boundary inflow are presented as positive values whereas watershed outputs surface et runoff lateral flow groundwater saturation excess flow tile drainage are presented as negative values these plots demonstrate the seasonality of fluxes for each watershed of note are the seasonal pattern and high flux rates for groundwater pumping in the cache river watershed tile drainage outflow in the winnebago river watershed and saturation excess flow i e groundwater discharge in the nanticoke river 3 2 streamflow comparison of simulated and measured monthly streamflow at 14 gage sites in the 6 watersheds table 6 fig 10 demonstrate both good excellent model performance and key areas for improvement five sites have nse 0 60 but all sites in the sauk and upper yellowstone have nse 0 pbias generally is 0 indicating underestimation of streamflow these performance statistics are corroborated by visual comparisons between hydrographs in fig 10 although the sauk model captures the general trend of the hydrograph values are often higher than measured values and are offset by 1 2 months similar to the results of the yellow river at corwin springs when compared with results from the base swat models fig 11 the use of gwflow shows improvement in baseflow particularly for the cache river near cotton plant and the sauk river near sauk due to the physically based representation of groundwater levels and groundwater surface water exchange however the models with the gwflow module sometimes under estimate peak flow nanticoke river near bridgeville cache river near cotton plant likely due to under estimation of surface runoff and associated over estimation in recharge based on the default soil parameters in the swat model if these models were to be employed in scenario analysis these features can be adjusted during model calibration as discussed in section 3 5 3 3 groundwater head the simulated cell by cell values of groundwater head for the year 2016 fig 12 are similar in pattern to the maps of initial head year 2000 fig 8 with adjustments during the 2000 2015 period based on an imbalance between groundwater inflow recharge seepage and outflows pumping saturation excess flow tile drainage groundwater et the monthly fluxes mm of each groundwater term are shown in fig 9 right column showing seasonal patterns of recharge pumping cache and tile drainage winnebago mae results fig 13 show good agreement 1 5 m difference in groundwater head between measured and simulated annual average groundwater head at monitoring well locations although several locations show high error 3 0 m difference in groundwater error maps of saturated thickness vertical distance between water table and bedrock in the year 2016 for three of the watersheds nanticoke winnebago and cache fig 14 top pane show similar patterns to the aquifer thickness maps fig 6 but with spatial variations due to increases and decreases in groundwater levels for each watershed these maps can be used to estimate total available groundwater in the unconfined aquifers by multiplying the saturated thickness m of each cell by the cell size m2 and the specific yield see equation 6 depth to water table fig 14 middle pane shows shallow groundwater conditions for nanticoke and portions of winnebago hence the need for tile drainage for the latter and deep groundwater levels for cache due to groundwater pumping for irrigation see figs 8 and 12 the relation between groundwater head ground surface bedrock and key groundwater fluxes in a cross section setting fig 14 bottom pane demonstrate the physically based nature of the gwflow module groundwater levels initialized by spatial interpolation between monitoring well locations respond and adjust to inflows and outflows with resulting gradients driving groundwater flow to adjacent areas and finally to streams and rivers cell by cell fluxes m3 day of saturated excess flow tile drainage outflow and groundwater pumping are shown for nanticoke winnebago and cache respectively shallow water tables intersecting stream channels occur in nanticoke and winnebago with the spatial pattern in winnebago also impacted by drainage outflow if the water table rises above the drain elevation deeper water tables occur for cache with depletion occurring in the eastern region of the watershed these simulated deep groundwater levels are corroborated by comparison with usgs monitoring well data see the multitude of green dots in fig 13 for cache particularly within the eastern region and are in agreement with recent studies in the cache river watershed leslie et al 2022 3 4 groundwater fluxes raster i e cell by cell maps of average daily groundwater source sink fluxes figs 15 18 are key components of model output and analysis showing areas of stress within the aquifer system and areas of key inputs i e saturation excess flow tile drainage into the stream channel system such maps also aid in determining why differences between simulated and observed groundwater head might occur see fig 13 recharge maps fig 15 show field scale recharge for little cache nanticoke and winnebago watersheds due to the presence of fields throughout the watershed recharge patterns for sauk and upper yellowstone are based on the boundaries of huc12 catchments due to the lack of cultivated fields see section 2 2 for upper yellowstone field scale recharge does occur along the river system due to the presence of irrigated fields within the stream corridors groundwater stream interaction is a combination of stream seepage fig 16 and groundwater saturation excess flow fig 17 of course stream seepage to the aquifer fig 16 occurs along the stream system with high rates typically occurring along the major rivers due to high stream depths and hence the large head difference between the stream and the surrounding water table saturation excess flow fig 17 has similar spatial patterns with high values along rivers and streams due to shallow groundwater levels that periodically rise above the ground surface however whereas seepage occurs along most streams in the nanticoke and cache watersheds saturation excess flow occurs only in certain regions due to the water table being lower than the stream channel this is particularly true for the cache river fig 17 due to extensive groundwater pumping and lowering of groundwater levels see fig 14 water table depth and cross section plot groundwater pumping for irrigation fig 18 is shown only for the three watersheds where it is simulated nanticoke cache and upper yellowstone low pumping rates occur for nanticoke moderate rates occur for cache and high pumping rates occur for upper yellowstone although rates are only localized for the latter due to irrigated fields along the corridor of the yellowstone river the extensive pumping within the cache watershed leads to the lowering of groundwater levels in the unconfined aquifer see fig 14 representing groundwater depletion that has been observed in the mississippi alluvial plain generally konikow 2013 2015 reba et al 2017 and in the cache river watershed specifically leslie et al 2022 3 5 methods for improvement in model performance in this article we have presented hydrologic results from models that have not yet undergone hard calibration as a demonstration of the modeling approach for the conterminous united states conus using the original swat structure of nam as the presented modeling system is applied to regions within conus parameter estimation tools will be required to ensure appropriate model mimicry of water balance components e g evapotranspiration runoff recharge baseflow stream discharge and groundwater head so that models can be used in scenario analyses e g impact of climate change land use change and conservation practices on hydrological processes and water supply water balance components can be compared to national assessments such as in reitz et al 2017 and stream discharge and groundwater head can be compared to available data from usgs gaging stations and monitoring wells as outlined in this study the gwflow routines within the swat code are equipped to output comparisons between simulated and observed groundwater head per the usgs groundwater head data processed by bailey and alderfer 2022 specific parameter estimation tools that can be used in model calibration are pest parameter estimation software doherty 2018 as performed by bailey et al 2021 in their use of the gwflow module to simulate tile drainage for a watershed in iowa and the particle swarm optimization pso algorithm as performed by rafiei et al 2022 in their use of swat modflow rt3d to simulate nutrient transport in a coastal watershed system pest and other software programs can be used for uncertainty analysis and sensitivity analysis not only quantifying the influence of input parameters on standard model output stream discharge groundwater head but also on water balance fluxes themselves for the latter researchers can identify controlling factors on key hydrologic fluxes providing insights into impactful strategies for water management the use of an integrated modeling system like swat with the gwflow module is important for such an assessment as all major hydrologic fluxes within the watershed system are linked and depend on each other for example when estimating model parameters surface runoff fluxes recharge fluxes and groundwater surface water fluxes all must be considered in their control of stream discharge and groundwater head in this way tight control of water balance components is achieved 4 summary and conclusions in this paper we present a holistic approach to modeling watershed scale hydrologic processes for any huc8 watershed within the conus using the swat models that comprise the nam the approach uses the gwflow module a new physically based spatially distributed groundwater modeling routine that is embedded in the swat modeling code using a grid of cellular control volumes to calculate daily water balance in an unconfined aquifer key calculated groundwater inflow and outflows include recharge pumping groundwater lake exchange groundwater surface water exchange transfer to soils and boundary inflow the gwflow module uses national scale datasets of aquifer thickness geologic units streamflow lines water bodies tile drain locations topography boundaries of cultivated fields boundaries of huc12 catchments and usgs groundwater head data to establish cell by cell aquifer properties and spatial connections with swat objects hrus channels routing units and reservoirs a python script is used to automate the processing of these datasets to construct gwflow input files for swat we demonstrate the approach for six watersheds each within a different huc2 region of the conus using 500 m grid cells for gwflow the base swat models have been soft calibrated for overall watershed water balance fluxes but no hard calibration for streamflow and groundwater head has been performed with the augmented models whereas several of the watershed models exhibited excellent stream discharge and groundwater head results other models or spatial regions of the models exhibited poor results that can be improved during model calibration model outputs including stream discharge groundwater head spatial maps and time series of observation locations saturated thickness spatial maps water table depth spatial maps and times series and cell by cell raster maps of groundwater fluxes recharge stream seepage saturation excess flow tile drainage pumping can be used to corroborate the model and identify regions that require additional parameter estimation in general using the combination of stream discharge groundwater head and average annual water balance fluxes can constrain hydrologic fluxes to realistic ranges thereby providing a modeling tool that can be used for scenario analysis climate management land use in the region of interest declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements financial support for this study was provided by the united state department of agriculture agricultural research service through cooperative agreements 59 3098 8 002 and 59 3098 2 001 usda is an equal opportunity employer and provider author contributions r b j a and m w designed the research r b and j a performed model coding r b s a j a m w j g and n c performed the research s a r b j g and n c analyzed the data r b and s a wrote the paper usda is an equal opportunity employer and provider appendix a supplementary data the following is the supplementary data to this article multimedia component 1 multimedia component 1 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j envsoft 2022 105589 
25456,floods are one of the most devastating natural hazards causing several deaths and conspicuous damages all over the world in this work we explore the applicability of the transformer neural network to the task of flood forecasting our goal consists in predicting the water level of a river one day ahead by using the past water levels of its upstream branches as predictors the methodology was validated on the severe flood that affected southeast europe in may 2014 the results show that the transformer outperforms recurrent neural networks by more than 4 in terms of the root mean squared error rmse and 7 in terms of the mean absolute error mae furthermore the transformer requires lower computational costs with respect to recurrent networks the forecasting errors obtained are considered acceptable according to the domain standards demonstrating the applicability of the transformer to the task of flood forecasting msc 00 01 99 00 keywords flood forecasting water level deep learning neural network transformer lstm data availability the authors do not have permission to share data 1 introduction according to the world meteorological organization floods are one of the most frequent and destructive natural hazards accounting for 44 of the total number of worldwide weather related disasters reported in the period from 1970 to 2019 world meteorological organization 2015 due to their increasing frequency and severity floods are raising great concerns for the worldwide governments although the occurrence of these events cannot be avoided different measures can be taken to reduce their effects minimize the susceptibility to damage and mitigate their impact the problem should be approached from different sides including infrastructure improvements flood plan regulations preparedness and education these actions are enclosed in the so called flood management world meteorological organization 2009 one of the most important strategies adopted to reduce the susceptibility to damage is flood awareness and prediction indeed knowing in advance the possible occurrence of floods could help people to better manage these events and rapidly respond to them flood prediction represents the most effective countermeasure to mitigate the damages of sudden flooding events indeed the production of accurate flood forecasts allows to manage the occurrence of extreme water events beforehand their arrival they can help the population to deal with the risks of floods in their region thus avoiding major losses of human lives due to unpreparedness most importantly local authorities can rapidly setup protection measures to rescue the population of the threatened sites moreover flood forecasting is also able to quantify the magnitude of floods thus allowing to prepare commensurate resources to face the adversities the problem of flood prediction has traditionally been a topic of great interest in the hydrology field historically physical and numerical models represented the most widely used tools for flood forecasting devia et al 2015 lee and georgakakos 1996 however they usually require large volumes of both hydrological and geomorphological data which are quite costly to be obtained moreover the large number of parameters involved in the numerical models often result in prohibitive computational costs in addition large teams of experts are usually needed for the development of physical models which further increase the development costs of such systems mosavi et al 2018 the advancements in computing technologies and the increasing availability of data sets from monitoring sensors determined the growing adoption of statistical models for the prediction of flooding events as a matter of fact statistical models require fewer input parameters with respect to numerical models and demonstrated a greater forecasting accuracy in several use cases abbot and marohasy 2014 aziz et al 2014 statistical models usually approach the problem of flood prediction by forecasting a target variable which can be either the water level of a river or the amount of rainfall measured over a certain area in this work we followed the former approach using the water level of the river as an indicator of the flooding risk in the last decades computing power grew significantly allowing the generation of more advanced statistical models among them the artificial neural network ann is one of the most commonly used multiple studies have shown the superiority of these models over traditional statistical methods in aichouri et al 2015 a feed forward neural network has been compared against a multiple linear regression model with the aim of predicting the daily runoff from the measurements of the previous seven days the neural network showed superior performance with respect to its linear counterpart motivating the use of neural networks for streamflow forecasting zounemat kermani et al 2013 conducted a similar study comparing the predictive performance of an artificial neural network with those of a linear regression model in this case the authors used the past runoff values of upstream stations as input once again the neural network demonstrated superior performance with respect to the linear model the effectiveness of neural networks lies in the use of non linear activation functions which allow to capture more complex relationships with respect to linear models recently researchers started to adopt deeper models to further enhance the performance of neural networks and model even more complex relationships sit et al 2020 shu et al 2021 explored the applicability of convolutional neural networks cnn for forecasting the monthly streamflow of a river comparing its performance with an artificial neural network and an extreme learning machine the results showed that the cnn has superior performance with respect to the shallow neural architectures huang et al 2020 designed a convolutional neural network to forecast the daily streamflow of several sites based on the past water levels of their neighbors the same cnn has been trained multiple times for each site by using a transfer learning technique the convolutional neural network outperformed simpler approaches including the autoregressive model multilayer perception network and kernel ridge regression adikari et al 2021 proposed a convolutional neural network cnn for performing flood and drought forecasting in both arid and tropical regions the results show that the cnn outperforms other models in flood forecasting and can better handle multiple features in input hosseiny 2021 used a more complex cnn called u net to predict the water depth over multiple locations surrounding the river s basin given in input the ground elevation of the predicted points and the flooding discharge of the river convolutional neural networks can also be adapted to process graph data such as those represented by a network of gauges distributed along a river basin sit et al 2021 investigated the effectiveness of a graph convolutional neural network for predicting the hourly river flow from the past water levels of upstream gauges the results showed that graph convolutions improved upon standard convolutions motivating the use of this new architecture a similar approach has been adopted in other studies demonstrating that graph convolutional neural networks are perfectly suitable for this task thanks to their capability of handling spatio temporal features liu et al 2022c a sun et al 2021 among all the different neural architectures applied to the task of flood forecasting the long short term memory lstm neural network is certainly the most widely investigated in this field in fact the lstm is specifically designed to process sequential inputs such as those described by rivers water levels and historical rainfall s measurements campos et al 2019 showed that the lstm neural network outperforms the arima model in forecasting the streamflow of some brazilian rivers with an autoregressive approach differently from arima which is a linear model the lstm can capture more complex non linear relationships between consecutive water levels the same conclusions can be drawn from the work of xiang et al 2020 which shows that the lstm seq2seq model overcomes the performance of other linear models including linear lasso and ridge regression methods when compared with other classical machine learning algorithms the lstm remains the preferred approach for flood forecasting dazzi et al 2021 compared a lstm neural network with a support vector machine svm and a multilayer perceptron mlp in predicting the hourly water levels of an italian river from the measurements of two upstream stations the results demonstrate that the lstm outperforms both the svm and the mlp by a good amount in terms of different forecasting metrics other related works assessed the superiority of the lstm neural network with respect to traditional neural architectures which definitely places the lstm among the state of the art models for flood forecasting han et al 2021 hu et al 2018 very recently researchers found that sequences can be better analyzed by using the so called attention mechanism which allows analyzing longer sequences with respect to plain recurrent networks ding et al 2020 implemented a lstm model enhanced with a spatio temporal attention mechanism which allows to relate the water levels of different river s sites and at different lagged timestamps to improve both accuracy and interpretability of neural networks the authors of feng et al 2021 proposed a graph convolutional neural network gcn for better exploiting the water levels of different stations employing a spatio temporal attention mechanism to further improve the accuracy of their model in general all the works that used a form of attention mechanism spatial or temporal combined with recurrent layers demonstrated that this approach outperforms conventional deep learning methods in the task of flood forecasting liu et al 2018 wu et al 2020a yan et al 2021 in practice the latest advancements in language translation demonstrated that we can completely substitute recurrent layers with the self attention mechanism which allows to model even longer input sequences vaswani et al 2017 shortly after the research community started to apply the transformer to the task of time series forecasting overcoming the accuracy of recurrent neural networks li et al 2019 zhou et al 2021 wu et al 2020b in addition the attention mechanism allows to tackle very different tasks involving both structured and unstructured data motivating its application in diverse predictive domains jaegle et al 2021 liu et al 2022b proposed a transformer neural network for predicting the monthly streamflow of the yangtze river using both past water levels and the el niño southern oscillation enso as input the transformer architecture demonstrated superior performance with respect to several machine learning models including convolutional and recurrent neural networks in the scope of flood forecasting the ability of producing timely predictions is crucial to implement effective countermeasures for mitigating the impact of flooding events indeed a good flood forecasting system should provide the highest accuracy with the lowest computational costs in the task of language translation the transformer demonstrated superior performance with respect to recurrent neural networks both in terms of accuracy and execution times in the same way we believe that the transformer could also improve upon recurrent neural networks in the task of flood forecasting by increasing the forecasting accuracy and lowering the computational costs in this paper we propose a transformer neural network for tackling the problem of flood forecasting in detail we aim at predicting the water level of a target river by using the past water levels of its upstream branches as input differently from liu et al 2022b we applied the transformer directly to the raw streamflow data without applying any transformation to the input e g variational mode decomposition in addition the novelty of our approach consists in using more input variables from neighboring stations thus truly exploiting the potentiality of the self attention module to demonstrate the effectiveness of our model we compared the prediction performance of the transformer with both gru and lstm neural networks the results show that the transformer presents superior forecasting capabilities with minor execution times which definitely motivates its use for flood forecasting the effectiveness of our method lies in the multi head attention mechanism implemented in the transformer s encoder layers in particular we found that the attention mechanism assigns different weights to the various inputs based on their relevance for producing accurate predictions in this way the transformer attends to specific parts of the input which allows using an even larger set of features as input the obtained results are considered good according to the domain standards ritter and munoz carpena 2013 which demonstrates the applicability of the proposed method in the real world the rest of this work is organized as follows section 2 provides a description of the data set section 3 introduces the transformer neural network and explains the architectural choices of our specific implementation in section 4 the transformer is compared with recurrent neural networks and other statistical models used as benchmarks discussing the performance in terms of accuracy and computational costs finally section 5 presents the main findings of our work and provides potential future research directions 2 data set the data set used to conduct our experiments was obtained from the hydrological information system of the sava river basin savahis international sava river basin commission 2021 the savahis project handles a large fleet of hydrological and meteorological stations deployed across the sava river and its tributaries the sava river passes through several countries in southeast europe including slovenia croatia bosnia herzegovina serbia and montenegro here we focused on the country of bosnia and herzegovina which was severely affected by an extreme flooding event in may 2014 in particular doboj was one of the most severely affected cities counting several victims due to the inundation from nearby rivers novosti 2014 for this reason we decided to use the water level of doboj as our target variable to evaluate the performance of our models in a real world scenario in fact the accurate estimate of future water levels can help local authorities to prepare the right countermeasures to face such catastrophic events to achieve this goal we selected a set of 13 hydrological stations from the upstream branch of the river with respect to the site of doboj each monitoring station provides the average water level of the river with a daily frequency expressed as the distance in cm from a reference point the entire monitoring period of our data set goes from 1 january 2014 to 31 december 2014 covering exactly two years of measurements without missing values table 1 gives some statistics of the 13 monitoring stations composing our final data set in addition to the target station of doboj that was used as input as well those statistics include the minimum maximum and mean water level for each river together with its standard deviation the last column reports the distance in km of each gauge from doboj the data set was split into a training set and test set for evaluating and comparing the performance of our models the training period covers roughly 66 of the entire data set from january 2013 to april 2014 16 months accordingly the test set consists of the remaining months from may 2014 to dec 2014 8 months notice that the severe flood occurring on 13 may 2014 is contained in the test set and it will serve to truly demonstrate the applicability of our models in a real flooding scenario the training set was further split into an actual training set and a smaller validation set which has been used for avoiding overfitting during the neural networks training the validation set covers the period from february 2014 to april 2014 3 months while the final training set goes from january 2013 to january 2014 included for the sake of clarity we reported the details of data set split in table 2 notice also that we respected the temporal order of the events by using only data prior to the flood for training our models without leaking data from the future 3 methodology the full pipeline of our methodology for flood forecasting is depicted in fig 1 notice that the training and validation phases are repeated multiple times to find the best combination of hyperparameters for our model the final test phase instead is executed only once in order to evaluate the forecasting performance of the transformer on unseen data in the following we introduce our specific implementation of the transformer neural network discussing all the relevant architectural choices that conducted to the final architecture 3 1 transformer the transformer is a neural network that was firstly introduced by vaswani et al 2017 as a groundbreaking architecture for solving machine translation problems the transformer has been early adopted in other application domains involving the analysis of fairly long input sequences such as time series forecasting and classification li et al 2019 in fact the self attention mechanism of the transformer completely substituted recurrent layers allowing to analyze even longer input sequences the computations of the self attention can be divided into the following steps firstly each point of the input sequence is mapped to three different representations with dimension d m o d e l which are called query q key k and value v then the q vectors are matched against all the k vectors by means of a dot product multiplication the square matrix obtained in this way is scaled and passed through a softmax function to obtain the attention scores between the different points of the sequence finally the attention scores are multiplied by the v vectors to generate a new representation of the input sequence indeed the self attention modifies the representation of each point by taking into account the weighted contribution of all the other points in the sequence in this way distant points in the sequence can attend to the value of each other sharing important information that could be missed otherwise the self attention mechanism is summarized by the following formula where d k is the dimension of the key vectors 1 a t t e n t i o n q k v s o f t m a x q k t d k v the multi head attention used by the transformer simply adds a bit of redundancy to the self attention computation in fact the values of q k and v are split into multiple chunks with dimension d m o d e l h where h is the number of attention heads each head applies the same computations of eq 1 to each individual chunk after that all the new representations are concatenated and passed through a final linear transformation the use of the multi head attention allows increasing the number of combinations between the different points of the input sequence thus increasing the probability of finding relevant relationships since the self attention mechanism is completely agnostic of the order in the input sequence we need to add some information to keep track of the position of the different points this goal is achieved by adding a static positional encoding to the original input embedding of the transformer model the position of each point is encoded by means of the following formula where p o s is the position within the input sequence and i is the index of the embedding value 2 p e p o s 2 i s i n p o s 100002 i d m o d e l p e p o s 2 i 1 c o s p o s 100002 i d m o d e l the transformer used in this work is slightly different from the original implementation presented in vaswani et al 2017 the most important difference is the lack of decoder layers in fact differently from traditional machine translation problems where sequence to sequence seq2seq models are usually employed in our case we are dealing with a single output value that represents the predicted water level for the next day therefore we decided to employ only encoder layers and map the extracted representations directly to the output value following the implementations of previous works from the literature jaegle et al 2021 huang et al 2019 hu and xiao 2022 interestingly we found that a single encoder layer already provides the best performance with respect to higher numbers of layers as shown in fig 3 another important difference in our architecture is the lack of normalization layers with reference to fig 4 we found that layer normalization reduces the generalization capabilities of our model to a great extent the last architectural choice that we made consists of the use of a final global average pooling layer before the output as depicted in fig 5 we found that the average pooling layer gives slightly better results than simply flattening the final representations the full architecture of our transformer is depicted in fig 2 notice that the multi head attention module is followed by a small feed forward neural net which applies a non linear transformation to the input the d m o d e l was set to 512 and the number of units in the feed forward module is 2048 similarly to the original transformer implementation the transformer was implemented in python by using tensorflow and the keras api chollet et al 2015 to train the transformer we used the adaptive moment estimation adam optimization algorithm kingma and ba 2017 the best convergence was achieved with a very small learning rate equal to 0 00001 the loss function that was minimized during the training of the transformer was the mean squared error mse defined by eq 3 in this formula n is the number of samples whereas y i and y i ˆ are the observed and predicted values the batch size was set to 32 samples and the maximum number of epochs was set to 1000 to avoid overfitting the early stopping criteria was employed interrupting the training procedure if the model performance does not improve for more than 30 epochs table 3 summarizes the hyperparameters used to train the transformer 3 m s e i 1 n y i y ˆ i 2 n 4 results and discussion this section presents the prediction results obtained with the transformer neural network applied to the task of flood forecasting first of all we give a quick description of the lstm neural network that we used as benchmark then we briefly introduce the evaluation metrics that we used to compare the performance of our models after that we present the forecasting performance of the two models with a varying number of lagged inputs we also provide a general interpretation of the attention maps extracted from the transformer neural network to conclude we compare the two models in terms of the required execution times for both training and testing 4 1 benchmark models in section 1 we provided some relevant works demonstrating that lstm based models currently represent the state of the art in flood forecasting han et al 2021 indeed lstm outperformed all traditional machine learning algorithms in this task including shallow neural network approaches dazzi et al 2021 for this reason we decided to primarily compare the forecasting performance of the transformer with those of an lstm based benchmark model in addition to the lstm we also decided to compare the transformer with another recurrent neural network using the gated recurrent unit gru cho et al 2014 which uses significantly less parameters than the lstm finally we also compared the transformer with simpler models such as persistence and ridge regression to ensure that our approach at least overcomes the performance of well known baseline models to find the best architecture of our lstm and gru models we run multiple validation tests by changing the number of recurrent layers together with their hyper parameters we finally opted for a stack of two recurrent layers with 128 units using a rectified linear units relu activation function this configuration achieved the best performance on the validation set and was retained for the final models comparison on the test set for the sake of clarity the full architecture of the recurrent neural networks is reported in table 4 the ridge regression model achieved the best performance with a very small regularization factor i e 0 0001 which is practically equal to training a simple linear regression model without applying any regularization 4 2 evaluation metrics to evaluate the forecasting performance of the transformer we adopted four statistical indicators commonly used for the evaluation of hydrological models ritter and munoz carpena 2013 the evaluation metrics are the mean absolute error mae the root mean square error rmse the nash sutcliffe efficiency coefficient nse and the mean bias error mbe the four metrics are defined by the following equations where y is the vector of the measured water levels y ˆ contains the predicted water levels y is the mean value of the measured water levels and n is the number of samples notice that a good set of predictions present an nse closer to 1 while for the mae mbe and rmse follow the rule of the lower the better the mbe was only computed for top 2 peak levels of the test set in order to evaluate the effectiveness of each model in predicting exceptional water levels and flooding events the mbe is a useful metric to understand the extent to which the model is underestimating or overestimating the actual water levels 4 m a e i 1 n y i y i ˆ n 5 r m s e i 1 n y i y ˆ i 2 n 6 n s e 1 i 1 n y i y ˆ i 2 i 1 n y i y i 2 7 m b e i 1 n y i y i ˆ n 4 3 model performance table 5 reports the forecasting performance of the transformer compared to the benchmark models in terms of mae rmse and nse in addition we also reported the mbe computed on the top 2 peak levels of the test set for each statistical model we provided the final results with three different lagged inputs because we noticed that different models may perform better depending on the number of previous days used as input for the persistence which uses only the previous day value we just reported the results with a lag of one day for completeness we also reported the results obtained on the training and validation sets in addition to those of the final test set table 5 shows that the transformer obtained the best performance in terms of all the reported metrics the highlighted values indicate the model with the lowest error on the test set notice that the transformer achieved the lowest errors with a lagged input of two days in comparison with the best performance of recurrent neural networks the transformer improved the rmse by 4 and reduced the mae by more than 7 interestingly ridge regression achieved a lower mae than recurrent neural networks which motivates its use as a valid alternative to more complex neural models the persistence was largely outperformed by all models using more than one lagged input showing that previous values from more than one day in the past are important for the forecasting results according to the hydrology forecasting standards reported in ritter and munoz carpena 2013 the transformer presents acceptable performance with an rmse lower than 0 83 standard deviations and an nse greater than 0 65 in practice the performance can be definitely considered as good since our results are closer to the threshold of 0 45 standard deviations and the nse is greater than 0 8 in fact we can notice an increase in the rmse between the validation set and the test set from 25 84 cm to 38 28 cm for a lagged input of two days the cause of this discrepancy lies in the flooding event of may 2014 that showed water levels never seen before by the model however the transformer successfully predicted also the water levels during the flooding event as depicted in fig 6 this fact is also supported by the lowest mbe in absolute value obtained by the transformer with respect to all the other models showing that the transformer is a valid model for predicting future unexpected water levels in this region 4 4 interpretation of the attention maps the attention scores computed within the multi head attention layers usually reveal some hidden correlations captured by the transformer at inference time to demonstrate the presence of these hidden patterns in fig 7 we reported the attention maps of the 8 heads of our transformer in the period from 11 may 2014 to 20 may 2014 first of all it is interesting to notice how all the attention maps suddenly change at the start of the flooding event 14 may 2014 and then rapidly restore their previous patterns at the end 18 may 2014 fig 8 provides a more detailed view of the 8 attention maps captured by the transformer on 14 may 2014 where each column in the attention maps correspond to a specific upstream station except for the first column which is the target site doboj the attention maps clearly show that the transformer applies a sort of feature selection on the input stations giving more importance to the most relevant variables at the occurrence this phenomenon can be evinced from the vertical patterns observable in the attention maps of fig 7 which tend to give more weight to certain input features with respect to others for example fig 8 shows that in the day preceding the flood 14 may 2014 the transformer changed its attention maps to give more importance to the stations of reljevo see heads 4 and 6 and olovo see heads 1 2 3 5 7 and 8 with reference to fig 9 instead we can see that those stations anticipate to a certain extent the flooding event that affected doboj on the following day 15 may 2014 therefore we can say that the transformer correctly attends with more attention those upstream stations that exhibit a good predictive potential however we can also notice that other seemingly relevant upstream stations were completely ignored by the attention maps to explain this behavior we can suppose that the transformer tries to suppress redundant information such as those existing between highly correlated upstream stations 4 5 computational costs table 6 reports a comparison between the execution times and the number of parameters of the different neural networks for both training and test all our tests were run on a workstation equipped with a single nvidia geforce rtx 3080 graphical processing unit and an amd ryzen 9 3900 processor the execution times are very low in both cases because of the relatively small size of our data set which counts only 396 training samples and 244 test samples however we must consider that these models can be employed to monitor several hydrological stations moreover they can be potentially used to forecast water levels at shorter lead times such as minutes and hours given these considerations even a small percentage reduction in the execution times can result in a great improvement in the scalability of a real world flood management system table 6 shows that the transformer required on average 24 s for training and 0 17 s for testing while the gru which is faster than lstm required 36 s and 0 22 s for the same tasks which is roughly 50 more time for training and 29 more time for inference respectively in fact recurrent networks showed longer execution times despite using significantly less parameters than the transformer the performance advantage of the transformer lies in the parallel computation of the input sequences which is not possible in the case of recurrent neural networks in conclusion the comparison demonstrates that the transformer can achieve better forecasting performance with shorter execution times with respect to recurrent networks 5 conclusion in this paper we applied the transformer neural network for predicting potential floods with a lead time of one day ahead to achieve this goal we trained our model to predict the water level of a river by using past observations from its upstream stations according to the results the transformer presents superior forecasting performance with respect to both lstm and gru recurrent neural networks which were used as benchmark in our experiments the obtained indicators are considered good for the standards of flood forecasting with a mean absolute error of 18 cm and a root mean square error of 38 cm for one day ahead predictions the nash sutcliffe efficiency coefficient is good as well with a score of 0 90 the transformer improved the forecasting performance by more than 4 with respect to the recurrent benchmark models in addition the transformer shows shorter execution times for both training and test because it avoids the use of recurrent layers in its architecture the attention maps reveal that the transformer selects the most relevant input for the target at hand changing the attention weights based on the specific conditions on the upstream stations as future work we want to train the transformer with a larger set of input features including rainfall observations from nearby meteorological stations and other physical properties of the ground in addition we will combine the transformer with graph neural networks to better model both spatial and temporal information of the data set declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work was partially supported by shelter which is an horizon 2020 project funded by the european union grant agreement no 821282 
25456,floods are one of the most devastating natural hazards causing several deaths and conspicuous damages all over the world in this work we explore the applicability of the transformer neural network to the task of flood forecasting our goal consists in predicting the water level of a river one day ahead by using the past water levels of its upstream branches as predictors the methodology was validated on the severe flood that affected southeast europe in may 2014 the results show that the transformer outperforms recurrent neural networks by more than 4 in terms of the root mean squared error rmse and 7 in terms of the mean absolute error mae furthermore the transformer requires lower computational costs with respect to recurrent networks the forecasting errors obtained are considered acceptable according to the domain standards demonstrating the applicability of the transformer to the task of flood forecasting msc 00 01 99 00 keywords flood forecasting water level deep learning neural network transformer lstm data availability the authors do not have permission to share data 1 introduction according to the world meteorological organization floods are one of the most frequent and destructive natural hazards accounting for 44 of the total number of worldwide weather related disasters reported in the period from 1970 to 2019 world meteorological organization 2015 due to their increasing frequency and severity floods are raising great concerns for the worldwide governments although the occurrence of these events cannot be avoided different measures can be taken to reduce their effects minimize the susceptibility to damage and mitigate their impact the problem should be approached from different sides including infrastructure improvements flood plan regulations preparedness and education these actions are enclosed in the so called flood management world meteorological organization 2009 one of the most important strategies adopted to reduce the susceptibility to damage is flood awareness and prediction indeed knowing in advance the possible occurrence of floods could help people to better manage these events and rapidly respond to them flood prediction represents the most effective countermeasure to mitigate the damages of sudden flooding events indeed the production of accurate flood forecasts allows to manage the occurrence of extreme water events beforehand their arrival they can help the population to deal with the risks of floods in their region thus avoiding major losses of human lives due to unpreparedness most importantly local authorities can rapidly setup protection measures to rescue the population of the threatened sites moreover flood forecasting is also able to quantify the magnitude of floods thus allowing to prepare commensurate resources to face the adversities the problem of flood prediction has traditionally been a topic of great interest in the hydrology field historically physical and numerical models represented the most widely used tools for flood forecasting devia et al 2015 lee and georgakakos 1996 however they usually require large volumes of both hydrological and geomorphological data which are quite costly to be obtained moreover the large number of parameters involved in the numerical models often result in prohibitive computational costs in addition large teams of experts are usually needed for the development of physical models which further increase the development costs of such systems mosavi et al 2018 the advancements in computing technologies and the increasing availability of data sets from monitoring sensors determined the growing adoption of statistical models for the prediction of flooding events as a matter of fact statistical models require fewer input parameters with respect to numerical models and demonstrated a greater forecasting accuracy in several use cases abbot and marohasy 2014 aziz et al 2014 statistical models usually approach the problem of flood prediction by forecasting a target variable which can be either the water level of a river or the amount of rainfall measured over a certain area in this work we followed the former approach using the water level of the river as an indicator of the flooding risk in the last decades computing power grew significantly allowing the generation of more advanced statistical models among them the artificial neural network ann is one of the most commonly used multiple studies have shown the superiority of these models over traditional statistical methods in aichouri et al 2015 a feed forward neural network has been compared against a multiple linear regression model with the aim of predicting the daily runoff from the measurements of the previous seven days the neural network showed superior performance with respect to its linear counterpart motivating the use of neural networks for streamflow forecasting zounemat kermani et al 2013 conducted a similar study comparing the predictive performance of an artificial neural network with those of a linear regression model in this case the authors used the past runoff values of upstream stations as input once again the neural network demonstrated superior performance with respect to the linear model the effectiveness of neural networks lies in the use of non linear activation functions which allow to capture more complex relationships with respect to linear models recently researchers started to adopt deeper models to further enhance the performance of neural networks and model even more complex relationships sit et al 2020 shu et al 2021 explored the applicability of convolutional neural networks cnn for forecasting the monthly streamflow of a river comparing its performance with an artificial neural network and an extreme learning machine the results showed that the cnn has superior performance with respect to the shallow neural architectures huang et al 2020 designed a convolutional neural network to forecast the daily streamflow of several sites based on the past water levels of their neighbors the same cnn has been trained multiple times for each site by using a transfer learning technique the convolutional neural network outperformed simpler approaches including the autoregressive model multilayer perception network and kernel ridge regression adikari et al 2021 proposed a convolutional neural network cnn for performing flood and drought forecasting in both arid and tropical regions the results show that the cnn outperforms other models in flood forecasting and can better handle multiple features in input hosseiny 2021 used a more complex cnn called u net to predict the water depth over multiple locations surrounding the river s basin given in input the ground elevation of the predicted points and the flooding discharge of the river convolutional neural networks can also be adapted to process graph data such as those represented by a network of gauges distributed along a river basin sit et al 2021 investigated the effectiveness of a graph convolutional neural network for predicting the hourly river flow from the past water levels of upstream gauges the results showed that graph convolutions improved upon standard convolutions motivating the use of this new architecture a similar approach has been adopted in other studies demonstrating that graph convolutional neural networks are perfectly suitable for this task thanks to their capability of handling spatio temporal features liu et al 2022c a sun et al 2021 among all the different neural architectures applied to the task of flood forecasting the long short term memory lstm neural network is certainly the most widely investigated in this field in fact the lstm is specifically designed to process sequential inputs such as those described by rivers water levels and historical rainfall s measurements campos et al 2019 showed that the lstm neural network outperforms the arima model in forecasting the streamflow of some brazilian rivers with an autoregressive approach differently from arima which is a linear model the lstm can capture more complex non linear relationships between consecutive water levels the same conclusions can be drawn from the work of xiang et al 2020 which shows that the lstm seq2seq model overcomes the performance of other linear models including linear lasso and ridge regression methods when compared with other classical machine learning algorithms the lstm remains the preferred approach for flood forecasting dazzi et al 2021 compared a lstm neural network with a support vector machine svm and a multilayer perceptron mlp in predicting the hourly water levels of an italian river from the measurements of two upstream stations the results demonstrate that the lstm outperforms both the svm and the mlp by a good amount in terms of different forecasting metrics other related works assessed the superiority of the lstm neural network with respect to traditional neural architectures which definitely places the lstm among the state of the art models for flood forecasting han et al 2021 hu et al 2018 very recently researchers found that sequences can be better analyzed by using the so called attention mechanism which allows analyzing longer sequences with respect to plain recurrent networks ding et al 2020 implemented a lstm model enhanced with a spatio temporal attention mechanism which allows to relate the water levels of different river s sites and at different lagged timestamps to improve both accuracy and interpretability of neural networks the authors of feng et al 2021 proposed a graph convolutional neural network gcn for better exploiting the water levels of different stations employing a spatio temporal attention mechanism to further improve the accuracy of their model in general all the works that used a form of attention mechanism spatial or temporal combined with recurrent layers demonstrated that this approach outperforms conventional deep learning methods in the task of flood forecasting liu et al 2018 wu et al 2020a yan et al 2021 in practice the latest advancements in language translation demonstrated that we can completely substitute recurrent layers with the self attention mechanism which allows to model even longer input sequences vaswani et al 2017 shortly after the research community started to apply the transformer to the task of time series forecasting overcoming the accuracy of recurrent neural networks li et al 2019 zhou et al 2021 wu et al 2020b in addition the attention mechanism allows to tackle very different tasks involving both structured and unstructured data motivating its application in diverse predictive domains jaegle et al 2021 liu et al 2022b proposed a transformer neural network for predicting the monthly streamflow of the yangtze river using both past water levels and the el niño southern oscillation enso as input the transformer architecture demonstrated superior performance with respect to several machine learning models including convolutional and recurrent neural networks in the scope of flood forecasting the ability of producing timely predictions is crucial to implement effective countermeasures for mitigating the impact of flooding events indeed a good flood forecasting system should provide the highest accuracy with the lowest computational costs in the task of language translation the transformer demonstrated superior performance with respect to recurrent neural networks both in terms of accuracy and execution times in the same way we believe that the transformer could also improve upon recurrent neural networks in the task of flood forecasting by increasing the forecasting accuracy and lowering the computational costs in this paper we propose a transformer neural network for tackling the problem of flood forecasting in detail we aim at predicting the water level of a target river by using the past water levels of its upstream branches as input differently from liu et al 2022b we applied the transformer directly to the raw streamflow data without applying any transformation to the input e g variational mode decomposition in addition the novelty of our approach consists in using more input variables from neighboring stations thus truly exploiting the potentiality of the self attention module to demonstrate the effectiveness of our model we compared the prediction performance of the transformer with both gru and lstm neural networks the results show that the transformer presents superior forecasting capabilities with minor execution times which definitely motivates its use for flood forecasting the effectiveness of our method lies in the multi head attention mechanism implemented in the transformer s encoder layers in particular we found that the attention mechanism assigns different weights to the various inputs based on their relevance for producing accurate predictions in this way the transformer attends to specific parts of the input which allows using an even larger set of features as input the obtained results are considered good according to the domain standards ritter and munoz carpena 2013 which demonstrates the applicability of the proposed method in the real world the rest of this work is organized as follows section 2 provides a description of the data set section 3 introduces the transformer neural network and explains the architectural choices of our specific implementation in section 4 the transformer is compared with recurrent neural networks and other statistical models used as benchmarks discussing the performance in terms of accuracy and computational costs finally section 5 presents the main findings of our work and provides potential future research directions 2 data set the data set used to conduct our experiments was obtained from the hydrological information system of the sava river basin savahis international sava river basin commission 2021 the savahis project handles a large fleet of hydrological and meteorological stations deployed across the sava river and its tributaries the sava river passes through several countries in southeast europe including slovenia croatia bosnia herzegovina serbia and montenegro here we focused on the country of bosnia and herzegovina which was severely affected by an extreme flooding event in may 2014 in particular doboj was one of the most severely affected cities counting several victims due to the inundation from nearby rivers novosti 2014 for this reason we decided to use the water level of doboj as our target variable to evaluate the performance of our models in a real world scenario in fact the accurate estimate of future water levels can help local authorities to prepare the right countermeasures to face such catastrophic events to achieve this goal we selected a set of 13 hydrological stations from the upstream branch of the river with respect to the site of doboj each monitoring station provides the average water level of the river with a daily frequency expressed as the distance in cm from a reference point the entire monitoring period of our data set goes from 1 january 2014 to 31 december 2014 covering exactly two years of measurements without missing values table 1 gives some statistics of the 13 monitoring stations composing our final data set in addition to the target station of doboj that was used as input as well those statistics include the minimum maximum and mean water level for each river together with its standard deviation the last column reports the distance in km of each gauge from doboj the data set was split into a training set and test set for evaluating and comparing the performance of our models the training period covers roughly 66 of the entire data set from january 2013 to april 2014 16 months accordingly the test set consists of the remaining months from may 2014 to dec 2014 8 months notice that the severe flood occurring on 13 may 2014 is contained in the test set and it will serve to truly demonstrate the applicability of our models in a real flooding scenario the training set was further split into an actual training set and a smaller validation set which has been used for avoiding overfitting during the neural networks training the validation set covers the period from february 2014 to april 2014 3 months while the final training set goes from january 2013 to january 2014 included for the sake of clarity we reported the details of data set split in table 2 notice also that we respected the temporal order of the events by using only data prior to the flood for training our models without leaking data from the future 3 methodology the full pipeline of our methodology for flood forecasting is depicted in fig 1 notice that the training and validation phases are repeated multiple times to find the best combination of hyperparameters for our model the final test phase instead is executed only once in order to evaluate the forecasting performance of the transformer on unseen data in the following we introduce our specific implementation of the transformer neural network discussing all the relevant architectural choices that conducted to the final architecture 3 1 transformer the transformer is a neural network that was firstly introduced by vaswani et al 2017 as a groundbreaking architecture for solving machine translation problems the transformer has been early adopted in other application domains involving the analysis of fairly long input sequences such as time series forecasting and classification li et al 2019 in fact the self attention mechanism of the transformer completely substituted recurrent layers allowing to analyze even longer input sequences the computations of the self attention can be divided into the following steps firstly each point of the input sequence is mapped to three different representations with dimension d m o d e l which are called query q key k and value v then the q vectors are matched against all the k vectors by means of a dot product multiplication the square matrix obtained in this way is scaled and passed through a softmax function to obtain the attention scores between the different points of the sequence finally the attention scores are multiplied by the v vectors to generate a new representation of the input sequence indeed the self attention modifies the representation of each point by taking into account the weighted contribution of all the other points in the sequence in this way distant points in the sequence can attend to the value of each other sharing important information that could be missed otherwise the self attention mechanism is summarized by the following formula where d k is the dimension of the key vectors 1 a t t e n t i o n q k v s o f t m a x q k t d k v the multi head attention used by the transformer simply adds a bit of redundancy to the self attention computation in fact the values of q k and v are split into multiple chunks with dimension d m o d e l h where h is the number of attention heads each head applies the same computations of eq 1 to each individual chunk after that all the new representations are concatenated and passed through a final linear transformation the use of the multi head attention allows increasing the number of combinations between the different points of the input sequence thus increasing the probability of finding relevant relationships since the self attention mechanism is completely agnostic of the order in the input sequence we need to add some information to keep track of the position of the different points this goal is achieved by adding a static positional encoding to the original input embedding of the transformer model the position of each point is encoded by means of the following formula where p o s is the position within the input sequence and i is the index of the embedding value 2 p e p o s 2 i s i n p o s 100002 i d m o d e l p e p o s 2 i 1 c o s p o s 100002 i d m o d e l the transformer used in this work is slightly different from the original implementation presented in vaswani et al 2017 the most important difference is the lack of decoder layers in fact differently from traditional machine translation problems where sequence to sequence seq2seq models are usually employed in our case we are dealing with a single output value that represents the predicted water level for the next day therefore we decided to employ only encoder layers and map the extracted representations directly to the output value following the implementations of previous works from the literature jaegle et al 2021 huang et al 2019 hu and xiao 2022 interestingly we found that a single encoder layer already provides the best performance with respect to higher numbers of layers as shown in fig 3 another important difference in our architecture is the lack of normalization layers with reference to fig 4 we found that layer normalization reduces the generalization capabilities of our model to a great extent the last architectural choice that we made consists of the use of a final global average pooling layer before the output as depicted in fig 5 we found that the average pooling layer gives slightly better results than simply flattening the final representations the full architecture of our transformer is depicted in fig 2 notice that the multi head attention module is followed by a small feed forward neural net which applies a non linear transformation to the input the d m o d e l was set to 512 and the number of units in the feed forward module is 2048 similarly to the original transformer implementation the transformer was implemented in python by using tensorflow and the keras api chollet et al 2015 to train the transformer we used the adaptive moment estimation adam optimization algorithm kingma and ba 2017 the best convergence was achieved with a very small learning rate equal to 0 00001 the loss function that was minimized during the training of the transformer was the mean squared error mse defined by eq 3 in this formula n is the number of samples whereas y i and y i ˆ are the observed and predicted values the batch size was set to 32 samples and the maximum number of epochs was set to 1000 to avoid overfitting the early stopping criteria was employed interrupting the training procedure if the model performance does not improve for more than 30 epochs table 3 summarizes the hyperparameters used to train the transformer 3 m s e i 1 n y i y ˆ i 2 n 4 results and discussion this section presents the prediction results obtained with the transformer neural network applied to the task of flood forecasting first of all we give a quick description of the lstm neural network that we used as benchmark then we briefly introduce the evaluation metrics that we used to compare the performance of our models after that we present the forecasting performance of the two models with a varying number of lagged inputs we also provide a general interpretation of the attention maps extracted from the transformer neural network to conclude we compare the two models in terms of the required execution times for both training and testing 4 1 benchmark models in section 1 we provided some relevant works demonstrating that lstm based models currently represent the state of the art in flood forecasting han et al 2021 indeed lstm outperformed all traditional machine learning algorithms in this task including shallow neural network approaches dazzi et al 2021 for this reason we decided to primarily compare the forecasting performance of the transformer with those of an lstm based benchmark model in addition to the lstm we also decided to compare the transformer with another recurrent neural network using the gated recurrent unit gru cho et al 2014 which uses significantly less parameters than the lstm finally we also compared the transformer with simpler models such as persistence and ridge regression to ensure that our approach at least overcomes the performance of well known baseline models to find the best architecture of our lstm and gru models we run multiple validation tests by changing the number of recurrent layers together with their hyper parameters we finally opted for a stack of two recurrent layers with 128 units using a rectified linear units relu activation function this configuration achieved the best performance on the validation set and was retained for the final models comparison on the test set for the sake of clarity the full architecture of the recurrent neural networks is reported in table 4 the ridge regression model achieved the best performance with a very small regularization factor i e 0 0001 which is practically equal to training a simple linear regression model without applying any regularization 4 2 evaluation metrics to evaluate the forecasting performance of the transformer we adopted four statistical indicators commonly used for the evaluation of hydrological models ritter and munoz carpena 2013 the evaluation metrics are the mean absolute error mae the root mean square error rmse the nash sutcliffe efficiency coefficient nse and the mean bias error mbe the four metrics are defined by the following equations where y is the vector of the measured water levels y ˆ contains the predicted water levels y is the mean value of the measured water levels and n is the number of samples notice that a good set of predictions present an nse closer to 1 while for the mae mbe and rmse follow the rule of the lower the better the mbe was only computed for top 2 peak levels of the test set in order to evaluate the effectiveness of each model in predicting exceptional water levels and flooding events the mbe is a useful metric to understand the extent to which the model is underestimating or overestimating the actual water levels 4 m a e i 1 n y i y i ˆ n 5 r m s e i 1 n y i y ˆ i 2 n 6 n s e 1 i 1 n y i y ˆ i 2 i 1 n y i y i 2 7 m b e i 1 n y i y i ˆ n 4 3 model performance table 5 reports the forecasting performance of the transformer compared to the benchmark models in terms of mae rmse and nse in addition we also reported the mbe computed on the top 2 peak levels of the test set for each statistical model we provided the final results with three different lagged inputs because we noticed that different models may perform better depending on the number of previous days used as input for the persistence which uses only the previous day value we just reported the results with a lag of one day for completeness we also reported the results obtained on the training and validation sets in addition to those of the final test set table 5 shows that the transformer obtained the best performance in terms of all the reported metrics the highlighted values indicate the model with the lowest error on the test set notice that the transformer achieved the lowest errors with a lagged input of two days in comparison with the best performance of recurrent neural networks the transformer improved the rmse by 4 and reduced the mae by more than 7 interestingly ridge regression achieved a lower mae than recurrent neural networks which motivates its use as a valid alternative to more complex neural models the persistence was largely outperformed by all models using more than one lagged input showing that previous values from more than one day in the past are important for the forecasting results according to the hydrology forecasting standards reported in ritter and munoz carpena 2013 the transformer presents acceptable performance with an rmse lower than 0 83 standard deviations and an nse greater than 0 65 in practice the performance can be definitely considered as good since our results are closer to the threshold of 0 45 standard deviations and the nse is greater than 0 8 in fact we can notice an increase in the rmse between the validation set and the test set from 25 84 cm to 38 28 cm for a lagged input of two days the cause of this discrepancy lies in the flooding event of may 2014 that showed water levels never seen before by the model however the transformer successfully predicted also the water levels during the flooding event as depicted in fig 6 this fact is also supported by the lowest mbe in absolute value obtained by the transformer with respect to all the other models showing that the transformer is a valid model for predicting future unexpected water levels in this region 4 4 interpretation of the attention maps the attention scores computed within the multi head attention layers usually reveal some hidden correlations captured by the transformer at inference time to demonstrate the presence of these hidden patterns in fig 7 we reported the attention maps of the 8 heads of our transformer in the period from 11 may 2014 to 20 may 2014 first of all it is interesting to notice how all the attention maps suddenly change at the start of the flooding event 14 may 2014 and then rapidly restore their previous patterns at the end 18 may 2014 fig 8 provides a more detailed view of the 8 attention maps captured by the transformer on 14 may 2014 where each column in the attention maps correspond to a specific upstream station except for the first column which is the target site doboj the attention maps clearly show that the transformer applies a sort of feature selection on the input stations giving more importance to the most relevant variables at the occurrence this phenomenon can be evinced from the vertical patterns observable in the attention maps of fig 7 which tend to give more weight to certain input features with respect to others for example fig 8 shows that in the day preceding the flood 14 may 2014 the transformer changed its attention maps to give more importance to the stations of reljevo see heads 4 and 6 and olovo see heads 1 2 3 5 7 and 8 with reference to fig 9 instead we can see that those stations anticipate to a certain extent the flooding event that affected doboj on the following day 15 may 2014 therefore we can say that the transformer correctly attends with more attention those upstream stations that exhibit a good predictive potential however we can also notice that other seemingly relevant upstream stations were completely ignored by the attention maps to explain this behavior we can suppose that the transformer tries to suppress redundant information such as those existing between highly correlated upstream stations 4 5 computational costs table 6 reports a comparison between the execution times and the number of parameters of the different neural networks for both training and test all our tests were run on a workstation equipped with a single nvidia geforce rtx 3080 graphical processing unit and an amd ryzen 9 3900 processor the execution times are very low in both cases because of the relatively small size of our data set which counts only 396 training samples and 244 test samples however we must consider that these models can be employed to monitor several hydrological stations moreover they can be potentially used to forecast water levels at shorter lead times such as minutes and hours given these considerations even a small percentage reduction in the execution times can result in a great improvement in the scalability of a real world flood management system table 6 shows that the transformer required on average 24 s for training and 0 17 s for testing while the gru which is faster than lstm required 36 s and 0 22 s for the same tasks which is roughly 50 more time for training and 29 more time for inference respectively in fact recurrent networks showed longer execution times despite using significantly less parameters than the transformer the performance advantage of the transformer lies in the parallel computation of the input sequences which is not possible in the case of recurrent neural networks in conclusion the comparison demonstrates that the transformer can achieve better forecasting performance with shorter execution times with respect to recurrent networks 5 conclusion in this paper we applied the transformer neural network for predicting potential floods with a lead time of one day ahead to achieve this goal we trained our model to predict the water level of a river by using past observations from its upstream stations according to the results the transformer presents superior forecasting performance with respect to both lstm and gru recurrent neural networks which were used as benchmark in our experiments the obtained indicators are considered good for the standards of flood forecasting with a mean absolute error of 18 cm and a root mean square error of 38 cm for one day ahead predictions the nash sutcliffe efficiency coefficient is good as well with a score of 0 90 the transformer improved the forecasting performance by more than 4 with respect to the recurrent benchmark models in addition the transformer shows shorter execution times for both training and test because it avoids the use of recurrent layers in its architecture the attention maps reveal that the transformer selects the most relevant input for the target at hand changing the attention weights based on the specific conditions on the upstream stations as future work we want to train the transformer with a larger set of input features including rainfall observations from nearby meteorological stations and other physical properties of the ground in addition we will combine the transformer with graph neural networks to better model both spatial and temporal information of the data set declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work was partially supported by shelter which is an horizon 2020 project funded by the european union grant agreement no 821282 
25457,the alterations in the hydrosphere dynamics are undeniable however the analysis of hydrological alterations provides a benchmark to identify the potential environmental consequences and triggers of the evinced deviations hydra eflow is a free download and integrated hydro informatics tool to assess gauged site discharge timeseries deviations for two non concomitant samples through the hydrologic alteration indices on rivers iahris acronym in spanish its modules allow data quality verification traditional frequency analysis alteration analysis and desktop environmental flow prescription in addition hydra eflow supplies recommendations by an expert based adjacency matrix to guide forward cascading studies and provide helpful rules for robust models a case study at the balsas river basin is shown to verify the consistency of the information generated by hydra eflow results show that 96 out of 129 hydrometric stations are altered due to changes in the discharge regime derived from the densified number of dams and impoundments in the streams for a wide range of purposes furthermore the middle northern sub basins exhibit a high alteration degree which may cause appalling water resources management since they submit more than 25 of the drinking water consumed in mexico city finally hydra eflow supplied information to improve the heuristics of hydrologic alteration in the balsas river basin graphical abstract image 1 keywords hydra eflow hydrologic alteration structured analysis iahris balsas river basin data availability data will be made available on request 1 introduction natural flow variability is the foremost attribute that governs the structure functionality and habitat integrity in freshwater ecosystems rolls and bond 2017 the term hydrologic alteration ha is commonly employed to refer to hydrological deviations from the presumably natural variability in any water balance component stewardson et al 2017 over the world a classification of flow regime types exists each responding to the regional surface characteristics and the water cycle dynamics resulting in intra and inter annual sequences of dry and wet periods hayes et al 2018 these periods come with high and low flow pulses responsible for spatiotemporal variations in riverine and adjacent ecosystems ngor et al 2018 transport of sediments vercruysse et al 2017 nutrients bernhardt et al 2018 contaminants chen et al 2019 water surface extent and hence evaporation rate milly and dunne 2020 vertical and longitudinal connectivity flow velocities and both water depth and thermal regime arora et al 2016 dugdale et al 2018 furthermore the flow regime variability interacts with the distribution and abundance of water dependent species such as plants fishes microinvertebrates and amphibians among others it constitutes a natural procedure for population control piniewski et al 2017 human population growth has elicited an increasing demand for natural resources mainly oriented to food and energy production economic thriving and technological development in the last decades the relentless pursuit of satisfying human needs has modified the terrestrial aquatic and atmospheric processes leading to widespread habitat degradation and biodiversity loss díaz et al 2019 remarkably freshwater ecosystems are regularly subjected to water stress principally due to land use change tan et al 2015 anim et al 2018 dam construction yin et al 2014 ren et al 2019 water storage withdrawals zipper et al 2019 human induced climate change zhuan et al 2018 and industrial farming livestock or urban disposals burns et al 2019 the causes of habitat degradation its effects on biotic and abiotic diversity and their responses to discharge need to consider the indirect effects caused by trigger synergies jacoby et al 2015 nonetheless this century has been the burgeoning of various environmental studies methods and devices devoted to delving into the ecosystem principles so that human demands could coexist with ecological requirements poff et al 2017 for example the natural flow paradigm has suggested that instream flow regimes should mimic the natural flow variability poff et al 1997 however the new water management era faces a rapid and uneven change in the water cycle dynamics simultaneously with climate change leading to non stationary effects in the observed phenomena poff 2018 hence returning to its prior status may be an impossible task especially in places where the anthropogenic influence has surpassed the ecosystem resilience acreman et al 2014 and the native species plasticity bonamour et al 2019 quantifying the flow alteration degree began with statistical metrics to unravel the possible species responses to discharge variations bovee 1982 olden and poff 2003 some studies have demonstrated that there is a more significant correlation between the species preferences for morphological unit distribution and hydraulics parameters rather than purely hydrologic components warren et al 2015 lamouroux et al 2017 thus evaluating the ha might be an optimal benchmark for backward and forward cascade research to assist stakeholders scientists practitioners and decision makers seek sustainable integrated water management various approaches emerged from the initial forays into assessing the ha to provide a quantitative and qualitative evaluation through significative environmental descriptors most of the worldwide used indicators are oriented to measure the five flow regime components divergence poff et al 1997 between the altered hydrologic regime ahr and the prior natural regime nhr the nature conservancy 2009 published a collection of 33 indicators based on the widely used plethora of indices proposed by richter et al 1998 however they lack a method to inform the alteration degree peñas et al 2016 the hydrologic alteration indices in rivers iahris for its acronym in spanish in stark contrast provide an internationally accepted scorecard for alteration guidance still they do not measure the instream rate of change martínez santa maría and fernández yuste 2021 nonetheless to have a more accurate diagnosis of the state of the flow regime along with the dominant causes and effects of the possible disturbances instream hydrologic alteration iha should comprise flow variability riverine climate and water quality evaluation fig 1 this paper aims to introduce an integrated informatics tool named hydrologic alteration and environmental flow hydra eflow which evaluates the ha through the 21 partial and three global iahris indices for non concomitant discharge series hydra eflow supplies recommendations based on an adjacency matrix between partial indices and the most cited affectations informed and proven heuristics zhang et al 2017 in addition hydra eflow is applied in a study case in the balsas river basin in mexico even though the software is addressed for purely hydrologic analysis it establishes solid foundations for future research to reach the iha proposal 2 software description 2 1 general overview hydra eflow arévalo mejía et al 2019 mexico register no 03 2018 091211215800 01 is a free download hydrological tool based on the hydrologic alteration indices in rivers iahris martínez santa maría and fernández yuste 2021 oriented to evaluate the hydrologic alteration ha for typical mean and total volumes maximum and minimum discharge values of two non concomitant samples downloading link https drive google com drive folders 1nmbrrrh yuayn xgjrbqe9730 gkebih usp sharing the iahris indices are an inter institutional scientific development by the spanish government the center for studies and experimentation of public works cedex acronym in spanish and the polytechnic university of madrid they were mainly designed to identify the rehabilitation condition of a regulated river and set priority criteria to recover the riverine ecosystems they have their software whose version 3 0 was released in 2021 software available at http www2 montes upm es dptos digfa on the other hand hydra eflow can also be used to verify whether the dam operation rules will alter the instream regime or not hydra eflow essentially comprises four modules i data verification ii flood frequency analysis iii hydrologic alteration and vi desktop environmental flow fig 2 the first module analyzes the data quality and estimates 77 core hydrologic variables needed to evaluate the iahris indices the second module is devoted to traditional flood frequency analysis where the users can fit a probability distribution function pdf to a discharge sample but it is also useful since some indices are based on flood frequency analysis then the ha is evaluated in the iahris module where the sample periods are chosen finally a hydrologic environmental flow ef is prescribed based on well known desktop methods belzile et al 1997 hydra eflow is programmed in the technical programming language matlab r2016b the novelties that hydra eflow integrates into comparison to the iahris v3 0 software are i an easy to use graphical user interface ii flexibility with different file extensions for input series iii data quality evaluation module iv incorporation of more probability density functions to estimate certain partial indices v desktop environmental flow prescription vi executive report generation in different file formats and vii high definition graphs with export options for enhanced resolution nonetheless the limitations of hydra eflow are i it deals only with non concomitant time series and ii the performance is reduced for registers with several missing values the following sections generally describe the built in modules readers are referred to the software manual in hydra eflow for further information 2 2 user data description hydra eflow works with daily observed discharge data in m3 s provided from single or database files the file structure consists of two column files date format i e 12 05 1980 15 2 or four column files yyyy mm dd discharge i e 12 05 1980 15 2 a label row is allowed and must be indicated in hydra eflow before reading the file if a date format file is supplied the date order must be specified between slashes i e dd mm yyyy or yyyy mm dd hydra eflow is compatible with text txt comma separated values csv ms excel xls xlsx and matlab mat file formats the discharge data series are shown in the main window once the file has been loaded fig 3 discharge observations cannot be modified in hydra eflow 2 3 hydrologic variables estimation to have an accurate ha evaluation a set of 77 hydrologic variables is assessed based on the starting month of the hydrological year and the high and low pulse thresholds table 1 hence this routine represents the hydrologic core of hydra eflow the hydrological variables are similar to the 33 indicators of hydrological alterations iha developed by the nature conservancy 2022 which have been meticulously described by zhang et al 2017 this module activates the graphics visualization panel of hydra eflow 2 4 data quality evaluation while working with hydrologic time series is common to question the data sampling procedures and the statistical quality since some time series components are transferred to higher aggregation timestamps box et al 2016 wei 2019 for example the trend asymmetry periodicity and spatial and temporal dependency are transferable statistical properties with meaningful significance in the hydrologic analysis fernández and gironás 2017 properties such as homogeneity independence normality stationarity and outliers are evaluated through parametric and non parametric tests to inform the possible data anomalies within the provided discharge series table 2 it is highly suggested to perform these statistical tests monthly or annually to avoid data dependency on lower time scales machiwal and jha 2012 2 5 hydrologic alteration evaluation the iahris indices are grouped into three categories typical mean and total volumes maximum and minimum values to encompass the regime variability the assessment of the 21 partial and the three global indices for non concomitant discharge samples table 3 requires the information provided by the 77 hydrological variables hv previously described table 1 the discharge time series is split into two non concomitant samples the natural flow regime nfr which encompasses all the years presumably assumed to be non regulated nor altered and the altered flow regime afr otherwise hence the hvs are used to estimate each partial index in both the natural hainfr and the altered samples haiafr the final partial index hai is evaluated as the ratio between the natural hainfr and altered haiafr conditions ranging from 0 to 1 where 1 denotes a slight deviation from the natural regime and 0 otherwise if the haiafr magnitude is greater than the hainfr the index is estimated with the inverse ratio and hydra eflow will mark it with an asterisk on the other hand the global indices reflect the overall squared qualifications of the n partial indices per each j regime group in table 3 as eq 3 g h a i i j 1 n h a i j 2 j 1 n h a i j 2 n n 1 the approach proposes five alteration degrees and considers the cis wfd 2003 color assignation to inform the alteration status qualitatively fig 4 further information for each index expression is found in the iahris methodological manual available at http www2 montes upm es dptos digfa or the manual of hydra eflow 2 6 flood frequency analysis the connectivity discharge frequency index hai9 considers the gumbel probability distribution function pdf to model the maximum flow series frequency that guarantees river connectivity eq 1 however discharge regimes vary worldwide and over time so the statistical descriptors and the best fitting distribution ouarda and charron 2019 playing a predominant role in hydrological alteration assessment for this reason hydra eflow incorporates hydrological probability distribution functions to offer a flexible evaluation of the indices that require a flood frequency analysis depending on the selected function the results are plotted in either normal gumbel or lognormal probability papers in addition the kolmogorov smirnov test massey 1951 is included to verify the goodness of fit eq 1 q c o n n q t r 2 t r q e eq 2 q e q x a 0 7 0 6 c v q x a where q c o n n is the connectivity discharge q t r 2 t r q e is the discharge whose return period is double the return period of the effective discharge q e is the effective discharge q x a is the mean of the maximum annual discharge series and c v q x a is the coefficient of variation of the maximum annual discharge series 2 7 hydrologic environmental flow prescription the environmental flow ef or environmental water allocation is based on the instream hydrological alterations and its linkages with ecological principles to encourage a social and environment agreed water regime for rivers and estuaries management arthington 2012 various methods developed in the last decades aimed to establish an ecologically significant ef tharme 2003 recently classified into five groups with specific characteristics poff et al 2017 none of the groups is better than the others their use depends on the amount of monitored information and the financial budget available to rehabilitate a specific habitat acreman 2016 the hydrological approaches work primarily with flow time series oriented to preserve the crucial characteristics of the hydrograph they have been mainly designed for targeted species i e salmon or trouts but the hydraulics morphological and ecological essentials are barely acknowledged webb et al 2017 theodoropoulos et al 2018 however they are appropriated for reconnaissance levels in water resources management for their low cost and undemanding expertise poff et al 2017 hydra eflow incorporates eight hydrological methods as a preliminary stage for ef allocations in this first version fig 2 2 8 the ecological network analysis after performing an ha analysis hydra eflow produces a technical report where recommendations are supplied to guide analysts to the likely forward studies to deep into the potential environmental consequences the guidance is founded on an expert based adjacency matrix which reflects the connections between the iahris indices and the hydraulics geomorphology and ecosystem components bondy and murty 2008 it is worth mentioning that for instance hydra eflow uses a circular graph to show both the structure and the network relationships for recommendation purposes not for network operation suppose two variables hereafter nodes are linked in that case their association is denoted with 1 in the adjacency matrix a 0 otherwise a indicates the direct relationships between node pairs for all n nodes and can be symmetric for bidirectional connections or non symmetric for unidirectional ones thus a is the direct connection matrix dcm fig 5 a however to elucidate the indirect network interrelatedness icm a is powered from order 2 to any m order until the variable hierarchy stabilizes where m is the connection length between nodes the result will show the number of possible indirect connection pathways between node pairs fig 5b manzano solís et al 2019 for example suppose that node 2 relates to node 3 and node 3 to node 4 there is an indirect linkage pathway between node 2 and node 4 of length two 2 3 and 3 4 that is shown in the element a 2 4 of a 2 in many structural system analyses the dcm is non symmetric where the sum of the elements in the i th row represents the total direct influence of the i th node tdi while the sum of the elements in the j th column denotes the total direct dependence of the j th node tdd godet and bourse 2004 the sorted rank of the tdi designates the variable hierarchy and it is compared at each dcm power fig 5a the goal is to know the total connection matrix tcm for this purpose the icm is normalized by dividing each element by the highest value in the matrix fig 5c the result is the normalized indirect connection matrix nicm eq 4 b i j a i j max i c m a i j i c m b i j n i c m finally the nicm is added to the dcm to get the total connection matrix tcm manzano solís et al 2019 the sum of the elements of the i th row denotes the total influence level of the i th node while the sum of the elements of the j th columns represents the total dependence level fig 5d hydra eflow employs an expert based adjacency matrix to link the hai indices to hydraulics geomorphological and environmental variables to elucidate the potential affectations caused by the flow regime alteration and provide recommendations for forwarding cascade studies seven experts in integrated water resources management strategic planning hydrology climatology hydraulics ecology and biology worked under the delphi approach delbecq et al 1975 applied as suggested by chu and wang 2008 firstly one anonymous round took place remotely to select the most relevant channel hydraulics geomorphological and ecosystem components related to the discharge regime for such purpose the hai description per index table 3 and related documentation were provided to every expert to standardize the heuristics and introduce the topic the construction of the adjacency matrix was based on the linkages integration between the 21 partial hais for 1150 gauged catchments in mexico arévalo mejía et al 2020 ten hydraulics parameters nine geomorphological characteristics and six environmental biological indicators fig 6 a then another round was held to fill an adjacency matrix per expert which tells whether the i th row indicator behavior modifies the j th column node behavior 1 or not 0 next the seven adjacency matrices were added and turned into a binary matrix as the expert team had seven members all values greater than four were turned into 1 to represent an agreement greater than 50 0 otherwise the result was a global adjacency matrix a fig 6a since the nodes hierarchy became stable between power four and five a was powered four to identify the indirect connections between the node pairs and their total dependence and influence levels fig 6b finally the combination of influence and dependence levels constitutes the descriptive circular graph used by hydra eflow to show the potential affectations after evaluating the hais fig 6c fig 6b shows the general picture of the hydrologic alteration dynamics firstly there is a group of driving variables that influence the general system demeanor mean annual volume index hai1 mean monthly volume index hai2 minimum monthly volume hai6 mean monthly maximum discharge hai7 connectivity discharge hai9 flushing floods discharge hai10 mean minimum monthly discharge hai15 typical droughts discharge hai16 and the drainage pattern therefore modifications to this group will change the status in the long term of the rest of the variables however another group is the transition between the driving variables and the response nodes base flow water depth wet perimeter discharge velocity the mass water exchange between tributaries and the river shape it is remarkable that purely hydraulics components constitute this group which is highly dependent on the driving one and influential on the third thus hydraulics directly influences the geomorphology and habitat responses but depends on the discharge patterns finally all the habitat features and most geomorphological ones are contained in the response group these nodes have little or no influence on the general system behavior but are hugely dependent on the dynamics of the other two groups on the other hand fig 6c exhibits the nodes hierarchy note that the hydraulics features head the node hierarchy with many total and direct connections followed by the driving alteration indices however this condition may vary from one site to the other in addition climate components and water quality were not included in this first version of hydra eflow for this reason the adjacency matrix can be modified according to the characteristics of the analyzed location but the guidance of experts is highly recommended the dynamic shown is the general trajectory noticed in altered regimes worldwide tian et al 2019 yuqin et al 2019 macnaughton et al 2015 thus the method applied is a numerical way to explain the hydrological alteration consistently in addition it is a structured way to depict thumb rules that could be useful in robust machine learning or data mining algorithms 3 study case the balsas river basin in mexico 3 1 area description the balsas river basin brb is located among the trans mexican volcanic belt tmvb sierra madre del sur sms and the mixteca mountain ranges taxiaco and tamazulapan fig 7 it is characterized by irregular topography intermontane valleys deep slopes and narrow fluvial plains casas et al 1996 the balsas river is born in the puebla valley with the atoyac river which runs off to the west until pouring its waters into the pacific ocean on average the mexican coasts leading to the pacific ocean are struck annually by 13 hurricanes causing enormous damage to the lower sub basins díaz delgado and gaytán iniesta 2014 the average altitude is 1000 mosl with a drainage area of 117203 9 km2 the mean annual rainfall oscillates between 873 mm in the lower and 1219 mm in the higher sub basins fig 8 the weather is mainly semi warm and sub humid with a mean annual temperature of 22 c according to the national water commission conagua the brb reports a mean total discharge volume of 16798 hm3 year and over 12 million inhabitants benefit from its natural resources conagua 2018a b c however nearly 68 of the water availability is employed for consumptive water activities like agriculture self sufficient industry public supply and electricity generation excluding hydropower thus the basin is characterized by a densified amount of large water supply reservoirs hydropower dams flood alleviation weirs and small farm impoundments generating undesirable habitat degradation biodiversity loss and reduced fluvial connectivity in addition to discharge regulation water diversion to the metropolitan valley of mexico and foreign irrigation districts are two common practices in the brb only the cutzamala sub basin provides 25 of the potable water consumed in mexico city conagua 2018a b c these water withdrawals have largely adverse effects on the breadth of seasonal discharge variations increasing the frequency of low flow events and setting restrictions to the water mass for environmental purposes hence the riverine communities struggle against the unprecedented water stress induced by human needs and enhanced by climate change in recent decades the brb is divided into 15 sub basins however only 13 are analyzed since the other two are significantly small and lack hydrometric information 3 2 the data daily discharge data were obtained from the national bank of superficial water data bandas acronym in spanish conagua 2018a b c there are 256 hydrometric stations within the basin however after assessing the data quality with hydra eflow in the operating stations with a record period greater than fifteen years only 129 stations were considered for the analysis each time series was segmented into regulated and unregulated periods depending on the ancient reservoir in each tributary reach the regulation dates were downloaded from the dams security system ssp acronym in spanish conagua 2018a b c fig 9 shows the time series of five flow components and characteristics of the 13 sub basins identifying the starting regulation date per reservoir the data verification module of hydra eflow assessed the information for database entries fig 2 3 3 results and discussion 3 3 1 alteration dynamics the dams operation rules usually impact the discharge downstream of the regulation site as the run off aggregates without a retained part of the water volume devoted to satisfying human needs macnaughton et al 2015 the upper streams in the brb are highly fragmented resulting in severe consequences for the lower sub basins these consequences include modifications in diverse regime components and promote the land use change from temperate and tropical forests to agriculture livestock and urban uses zarco gonzález et al 2021 mainly the extreme values are directly impacted throughout the lower region and during the hydrologic year as shown in fig 9 the upper right sub basins tlapaneco nexapa mixteco alto atoyac and libres o reveal two contrasting scenarios from one side the variability of the 7 day max and 30 day min discharge series has been drastically diminished for the alto atoyac sub basin which is consistent with the positive trend shown by the number of days with null discharge this sub basin deviates the available water to irrigation districts located on the highlands conagua 2018a b c the farm dams regulate the flow to ensure enough water for agriculture reducing the intra and interannual variability and exposing the riverine organisms to the minimum and base flow reduction effects additionally the irrigation districts pour the remaining polluted water into the streams increasing the biochemical oxygen demand bod5 from 75 to 210 mg l in the dry season pérez castresana et al 2018 the depletion of the minimum flow magnitude reduces the pollution dissolution capacity in the rivers worsening the conditions to preserve the instream and adjacent biota in stark contrast the libres o sub basin exposes a negative trend in the number of days with null discharge and for the mixteco sub basin they have been absent since 1995 surprisingly the libres o sub basin lacks dams weirs or impoundments to increase the monthly discharge however the landscape has recently changed to farming crops and increased urban surface nexapa has the same water uses as the alto atoyac the difference is that nexapa does not evince an increase of days with null discharge tepalcaltepec cupatitzio and tacámbaro constitute the upper left sub basins in tepalcaltepec the more extended irrigation districts and the annual run off benefit from recurrent hurricanes that strike the pacific coast with a higher 30 day minimum flowing downstream in most stations the number of days with null discharge has been practically absent since the 80s the increase in the water mass means that the channel geomorphology is preserved since it runs all along the hydrologic year however the constant flow prevents the formation of morphological units like pools and shallow banks proper for amphibians egg deposition and juvenile fish recruitment modifying the species distribution pattern along the rivers rolls and bond 2017 the middle sub basins cutzamala mezcala and amacuzac exhibit extensive discharge variability before the 80s providing the optimum conditions for different life stages of amphibians fishes reptiles microinvertebrates dense forests and birds communities however it is also evident that when the large dams started their regulation procedures the variability of the minimum flow was reduced while the maximum peaks were preserved and enhanced the trend for the minimum flow depletion is remarkable and is likely to keep in that motion until the present day the decline is partially due to the increasing water demand for agriculture and hydropower generation nonetheless precipitation reduction and increased air temperature have also been observed melgarejo et al 2021 the increasing air temperature eases the heat transfer to the low water mass ending and in combination with the discharge reduction increases the evaporation rate and dewatering regimes the number of days with null discharge has also been decreased meaning that the operation rules leave a lesser but constant low flow running downstream on the other hand the mezcala and the amacuzac sub basins show extraordinary discharge peaks caused by possible human demanded water to satisfy agricultural or urban needs or by a meteorological phenomenon the hydropeaking causes harsh havocs to the instream communities while the discharge is suddenly released washing away the nutrients and sediments increasing the mortality probability of adult individuals aggravating the fish recruitment and reducing the riparian richness the modifications caused by the regulation infrastructure in the upper sub basins have their denouement in the lower brb hydrologic regimes the discharge at infiernillo and zirándaro are characterized by the lack of extreme values variability and a regular hydrograph with lesser water than habitual since most of the water mass is retained upstream these regular hydrographs affect the endemic riverine taxa and facilitate the encroachment of exotic aquatic and terrestrial species into the streams mejía mojica et al 2015 broadening the list of endangered native species of the brb in the red list cervantes et al 2020 3 3 2 evaluation of hydrological alteration the discharge deviations caused by the reservoirs range widely between sub basins however the ha module of hydra eflow fig 2 allows valuable insight extraction while evaluating the discharge samples regulated and unregulated the study reveals that there are 96 altered stations and 33 non altered as expected the most altered river reaches are located within the highly human influenced sub basins and in the lowlands in contrast the non altered reaches are located in the highlands except for the alto atoyac nexapa and mixteco sub basins fig 10 impacted by human settlements and industrial or agricultural lands rodríguez tapia and morales novelo 2017 pérez castresana et al 2019 the hai evaluation exhibits that a large portion of the basin is altered nonetheless there are sub basins tacámbaro and tlapaneco with nearly no alteration despite the presence of the reservoirs fig 10 the sub basins are classified into three groups according to the number of altered stations to elucidate the hydrological impacts resemblances and differences of each group table 4 it is worth mentioning that the non alteration status was prescribed if the three global indices ghai fell in the excellent or good categories otherwise the discharge was considered altered fig 4 the highly altered sub basins show a broader dispersion while evaluating the partial alteration indices fig 11 which means that the hydrologic regime has been highly modified in the three analyzed discharge disaggregation groups mimicking the hydrograph variability is highly important the typical values mean and total volumes represent the water regime that circulates at least 50 of the time in a hydrologic year the minimum flow frequency will likely increase if the typical discharge values are reduced similarly the rise of maximum extreme events may be linked to the persistent increment of the typical values the magnitude hai1 and hai2 and seasonality indices hai5 and hai6 are the most fluctuating components for typical values in the infiernillo zirándaro cutzamala mezcala and mixteco sub basins it should be noted that the most important large dams are located in the mentioned areas e g infiernillo and el caracol affecting the aquatic biota which has nearly disappeared in the sub basins whose waters are destined for agricultural uses conagua 2018a b c values ranging from 0 2 to 0 6 in the hai5 and hai6 indicate a seasonality reversal in the streams up to four months the implications for the riverine taxa include reduced water availability downstream altered physical chemical parameters and pollutant dissolution capacity reduction seasonality reversals may be linked to climate change or climate variability which has been observed in the brb in recent years causing severe drought occurrences melgarejo et al 2021 the extreme maximum and minimum events play a notable role in river hydraulics geomorphological and environmental components fig 6b however changes in their frequency magnitude or seasonality are arguably the most pervasive impacts on the riverine taxa recruitment richness and distribution the magnitude index hai7 exhibits a wide dispersion with a narrow tail at the end of the violin plot fig 11 the tail shape is explained by the hydropeaking practices in the stations located after the large dams since there is a greater water mass volume the index is assessed by the inverse ratio nhr ahr leaving the evaluation reasonably low in the violin plot with a tail shape this effect is visible for the infiernillo zirándaro cutzamala and mixteco sub basins another highlighting insight is the low evaluation in the frequency index hai9 related to the connectivity discharge of the drainage pattern and therefore the baseflow it is well known that the reservoirs fragment the drainage pattern and that more than 75 of the worldwide rivers will be fragmented in 2030 nilsson et al 2005 while the reservoirs and small farming impoundments retain the water the downstream baseflow is reduced impacting the longitudinal transversal and wet perimeter of the rivers this index directly connects to the hydraulic parameters in the rivers henceforth it indirectly impacts the channel geomorphology and the riverine habitat distribution fig 6b on the other hand the low flow magnitude hai15 and duration hai20 and hai21 are the most affected indices in the evaluation which have impacted the distribution of exotic species in the brb mejía mojica et al 2015 the altered sub basins evince lesser dispersion than the highly altered sub basins nonetheless the tail shape is preserved for the magnitude indices in typical hai1 and hai2 extreme maximum hai7 and hai8 and minimum hai15 and hai16 values similarly the frequency of extreme maximum events hai9 is low ranked in the evaluation these similarities reveal recurrent dynamics in the altered components of the first two groups of sub basins and the rehabilitation strategies may become likely applicable in parallel to the whole basin it should be mindful that these indices are encompassed in the driving variables for indirect alterations fig 6b the evaluation in the non altered sub basins was satisfactory in all the indices except for the frequency of extreme maximum events hai9 for the tlapaneco sub basin the reduction of the connectivity discharge may be linked to the water diversion practices of the upstream impoundments however the evaluation for the tacámbaro sub basin is quite uncertain due to the lack of hydrometric and water regulation information therefore a more detailed study is strongly recommendable in this sub basin 3 3 3 environmental consequences fig 6c shows that from the 21 hais the mean annual and monthly volumes hai1 hai2 the connectivity discharge hai9 the flushing flood discharge hai10 the mean minimum monthly discharge hai15 and the typical droughts discharge hai16 produce more direct and indirect hazards to the riverine systems biodiversity is the higher dependence level variable followed by invasive species nutrients and species spawning the descriptive graph concludes that the nodes with the most direct and indirect affectations are associated with the ecosystem and the riverine living organisms regardless of the expertise and scientific fields the highly altered sub basins table 4 showed a poor evaluation in hai5 hai6 hai9 hai15 hai16 and hai21 similar conditions are noticed in the altered sub basins since they scored low on hai6 hai9 hai14 hai15 and hai21 furthermore the depletion of the minimum monthly volume hai5 diminishes the channel connectivity discharge hai9 worsening the stream dissolution capability and increasing the number of periods with low flow hai21 as expected the base flow and the minimum mean monthly discharge hai15 are also reduced therefore the flow regime changes cause direct impacts on all the hydraulics and geomorphological components which generates indirect hostile and undesirable endangerment of the riverine biodiversity at this point the circular graph is merely descriptive nonetheless operational mining graph algorithms will be included for future research to glimpse the affectation degree and their dynamics the alterations in the hydrosphere dynamics are undeniable with less water mass to exchange between sub basins the hydraulics physicochemical chemical geomorphological and environmental riverine conditions will worsen every passing day if the mexican society non governmental organizations and stakeholders do not mitigate the alterations herein shown habitat rehabilitation will remain a priority objective in the environmental agendas while ecological sustainability will be harder to reach 3 3 4 hydra eflow assistance in the analysis hydra eflow was an appreciable assistant while exploring the hydrological data since it makes it possible to evaluate the statistical quality of the data sample a characteristic that is not considered in the iahris v3 0 software martínez santa maría and fernández yuste 2021 nor in indicators of hydrological alteration iha software developed by the nature conservancy the nature conservancy 2022 for punctual analysis or single files the iha software provides facilities and a wide range of indicators on its side the iahris software v3 0 has a convenient option for databases analyzing each hydrometric time series provided hydra eflow allows working with databases as well saving all the results in a single ms excel file the above is advantageous when exporting the file into a geographical information system gis software and recognizing the spatial behavior of the hydrologic alteration the results of every single step in hydra eflow are exportable into text formats simplifying the information extraction and pattern recognition of the data most of the graphs herein shown come from the single database file for the study case or are native hydra eflow graphs exportable from the software finally it is remarkable to mention that the executive report makes de recommendations based on an expert adjacency matrix which can be modified according to the needings and features of each study case 4 conclusions the hydrologic alteration evaluation is a benchmarking study to enrich the heuristics of the system conditions and promote backward and forward cascading studies to depict the potential alteration triggers and impacts hydra eflow is an easy to use tool for a compelling and insightful hydrological alteration analysis for gauged sites considering non concomitant samples and its recommendations follow the expert heuristics for forwarding cascade studies hydra eflow is an appreciable tool for hydrometric data analysis saving all the results in a single file exportable to any gis software easing the spatial behavior analysis of the hydrologic alteration and containing other utilities that are not commonly found in similar software hydra eflow implements a structured system analysis that showed consistent alteration dynamics observed in the balsas river basin study case furthermore this approach may lead to helpful thumb rules in more robust algorithms to analyze environmental behavior the balsas river basin showed significant hydrologic alterations due to changes in the flow regime derived from the densified number of dams and impoundments in the streams for crop irrigation energy generation and livestock purposes moreover alterations are more severe in the lower sub basins than in the highlands due to the depletion of the aggregated run off leading to frightful water scarcity and unenviable biodiversity loss cupatitzio infiernillo zirándaro cutzamala mezcala nexapa mixteco alto atoyac libres o tepalcaltepec and amacuzac sub basins are altered which may cause appalling water resources management since the northern sub basins submits more than 25 of the drinking water consumed in mexico city declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this study was carried out with the financial support provided by conacyt 248498 and 248553 and uaem siea quebec canada 4212 2016e and 4192 2016e appendix a supplementary data the following is the supplementary data to this article multimedia component 1 multimedia component 1 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j envsoft 2022 105592 
25457,the alterations in the hydrosphere dynamics are undeniable however the analysis of hydrological alterations provides a benchmark to identify the potential environmental consequences and triggers of the evinced deviations hydra eflow is a free download and integrated hydro informatics tool to assess gauged site discharge timeseries deviations for two non concomitant samples through the hydrologic alteration indices on rivers iahris acronym in spanish its modules allow data quality verification traditional frequency analysis alteration analysis and desktop environmental flow prescription in addition hydra eflow supplies recommendations by an expert based adjacency matrix to guide forward cascading studies and provide helpful rules for robust models a case study at the balsas river basin is shown to verify the consistency of the information generated by hydra eflow results show that 96 out of 129 hydrometric stations are altered due to changes in the discharge regime derived from the densified number of dams and impoundments in the streams for a wide range of purposes furthermore the middle northern sub basins exhibit a high alteration degree which may cause appalling water resources management since they submit more than 25 of the drinking water consumed in mexico city finally hydra eflow supplied information to improve the heuristics of hydrologic alteration in the balsas river basin graphical abstract image 1 keywords hydra eflow hydrologic alteration structured analysis iahris balsas river basin data availability data will be made available on request 1 introduction natural flow variability is the foremost attribute that governs the structure functionality and habitat integrity in freshwater ecosystems rolls and bond 2017 the term hydrologic alteration ha is commonly employed to refer to hydrological deviations from the presumably natural variability in any water balance component stewardson et al 2017 over the world a classification of flow regime types exists each responding to the regional surface characteristics and the water cycle dynamics resulting in intra and inter annual sequences of dry and wet periods hayes et al 2018 these periods come with high and low flow pulses responsible for spatiotemporal variations in riverine and adjacent ecosystems ngor et al 2018 transport of sediments vercruysse et al 2017 nutrients bernhardt et al 2018 contaminants chen et al 2019 water surface extent and hence evaporation rate milly and dunne 2020 vertical and longitudinal connectivity flow velocities and both water depth and thermal regime arora et al 2016 dugdale et al 2018 furthermore the flow regime variability interacts with the distribution and abundance of water dependent species such as plants fishes microinvertebrates and amphibians among others it constitutes a natural procedure for population control piniewski et al 2017 human population growth has elicited an increasing demand for natural resources mainly oriented to food and energy production economic thriving and technological development in the last decades the relentless pursuit of satisfying human needs has modified the terrestrial aquatic and atmospheric processes leading to widespread habitat degradation and biodiversity loss díaz et al 2019 remarkably freshwater ecosystems are regularly subjected to water stress principally due to land use change tan et al 2015 anim et al 2018 dam construction yin et al 2014 ren et al 2019 water storage withdrawals zipper et al 2019 human induced climate change zhuan et al 2018 and industrial farming livestock or urban disposals burns et al 2019 the causes of habitat degradation its effects on biotic and abiotic diversity and their responses to discharge need to consider the indirect effects caused by trigger synergies jacoby et al 2015 nonetheless this century has been the burgeoning of various environmental studies methods and devices devoted to delving into the ecosystem principles so that human demands could coexist with ecological requirements poff et al 2017 for example the natural flow paradigm has suggested that instream flow regimes should mimic the natural flow variability poff et al 1997 however the new water management era faces a rapid and uneven change in the water cycle dynamics simultaneously with climate change leading to non stationary effects in the observed phenomena poff 2018 hence returning to its prior status may be an impossible task especially in places where the anthropogenic influence has surpassed the ecosystem resilience acreman et al 2014 and the native species plasticity bonamour et al 2019 quantifying the flow alteration degree began with statistical metrics to unravel the possible species responses to discharge variations bovee 1982 olden and poff 2003 some studies have demonstrated that there is a more significant correlation between the species preferences for morphological unit distribution and hydraulics parameters rather than purely hydrologic components warren et al 2015 lamouroux et al 2017 thus evaluating the ha might be an optimal benchmark for backward and forward cascade research to assist stakeholders scientists practitioners and decision makers seek sustainable integrated water management various approaches emerged from the initial forays into assessing the ha to provide a quantitative and qualitative evaluation through significative environmental descriptors most of the worldwide used indicators are oriented to measure the five flow regime components divergence poff et al 1997 between the altered hydrologic regime ahr and the prior natural regime nhr the nature conservancy 2009 published a collection of 33 indicators based on the widely used plethora of indices proposed by richter et al 1998 however they lack a method to inform the alteration degree peñas et al 2016 the hydrologic alteration indices in rivers iahris for its acronym in spanish in stark contrast provide an internationally accepted scorecard for alteration guidance still they do not measure the instream rate of change martínez santa maría and fernández yuste 2021 nonetheless to have a more accurate diagnosis of the state of the flow regime along with the dominant causes and effects of the possible disturbances instream hydrologic alteration iha should comprise flow variability riverine climate and water quality evaluation fig 1 this paper aims to introduce an integrated informatics tool named hydrologic alteration and environmental flow hydra eflow which evaluates the ha through the 21 partial and three global iahris indices for non concomitant discharge series hydra eflow supplies recommendations based on an adjacency matrix between partial indices and the most cited affectations informed and proven heuristics zhang et al 2017 in addition hydra eflow is applied in a study case in the balsas river basin in mexico even though the software is addressed for purely hydrologic analysis it establishes solid foundations for future research to reach the iha proposal 2 software description 2 1 general overview hydra eflow arévalo mejía et al 2019 mexico register no 03 2018 091211215800 01 is a free download hydrological tool based on the hydrologic alteration indices in rivers iahris martínez santa maría and fernández yuste 2021 oriented to evaluate the hydrologic alteration ha for typical mean and total volumes maximum and minimum discharge values of two non concomitant samples downloading link https drive google com drive folders 1nmbrrrh yuayn xgjrbqe9730 gkebih usp sharing the iahris indices are an inter institutional scientific development by the spanish government the center for studies and experimentation of public works cedex acronym in spanish and the polytechnic university of madrid they were mainly designed to identify the rehabilitation condition of a regulated river and set priority criteria to recover the riverine ecosystems they have their software whose version 3 0 was released in 2021 software available at http www2 montes upm es dptos digfa on the other hand hydra eflow can also be used to verify whether the dam operation rules will alter the instream regime or not hydra eflow essentially comprises four modules i data verification ii flood frequency analysis iii hydrologic alteration and vi desktop environmental flow fig 2 the first module analyzes the data quality and estimates 77 core hydrologic variables needed to evaluate the iahris indices the second module is devoted to traditional flood frequency analysis where the users can fit a probability distribution function pdf to a discharge sample but it is also useful since some indices are based on flood frequency analysis then the ha is evaluated in the iahris module where the sample periods are chosen finally a hydrologic environmental flow ef is prescribed based on well known desktop methods belzile et al 1997 hydra eflow is programmed in the technical programming language matlab r2016b the novelties that hydra eflow integrates into comparison to the iahris v3 0 software are i an easy to use graphical user interface ii flexibility with different file extensions for input series iii data quality evaluation module iv incorporation of more probability density functions to estimate certain partial indices v desktop environmental flow prescription vi executive report generation in different file formats and vii high definition graphs with export options for enhanced resolution nonetheless the limitations of hydra eflow are i it deals only with non concomitant time series and ii the performance is reduced for registers with several missing values the following sections generally describe the built in modules readers are referred to the software manual in hydra eflow for further information 2 2 user data description hydra eflow works with daily observed discharge data in m3 s provided from single or database files the file structure consists of two column files date format i e 12 05 1980 15 2 or four column files yyyy mm dd discharge i e 12 05 1980 15 2 a label row is allowed and must be indicated in hydra eflow before reading the file if a date format file is supplied the date order must be specified between slashes i e dd mm yyyy or yyyy mm dd hydra eflow is compatible with text txt comma separated values csv ms excel xls xlsx and matlab mat file formats the discharge data series are shown in the main window once the file has been loaded fig 3 discharge observations cannot be modified in hydra eflow 2 3 hydrologic variables estimation to have an accurate ha evaluation a set of 77 hydrologic variables is assessed based on the starting month of the hydrological year and the high and low pulse thresholds table 1 hence this routine represents the hydrologic core of hydra eflow the hydrological variables are similar to the 33 indicators of hydrological alterations iha developed by the nature conservancy 2022 which have been meticulously described by zhang et al 2017 this module activates the graphics visualization panel of hydra eflow 2 4 data quality evaluation while working with hydrologic time series is common to question the data sampling procedures and the statistical quality since some time series components are transferred to higher aggregation timestamps box et al 2016 wei 2019 for example the trend asymmetry periodicity and spatial and temporal dependency are transferable statistical properties with meaningful significance in the hydrologic analysis fernández and gironás 2017 properties such as homogeneity independence normality stationarity and outliers are evaluated through parametric and non parametric tests to inform the possible data anomalies within the provided discharge series table 2 it is highly suggested to perform these statistical tests monthly or annually to avoid data dependency on lower time scales machiwal and jha 2012 2 5 hydrologic alteration evaluation the iahris indices are grouped into three categories typical mean and total volumes maximum and minimum values to encompass the regime variability the assessment of the 21 partial and the three global indices for non concomitant discharge samples table 3 requires the information provided by the 77 hydrological variables hv previously described table 1 the discharge time series is split into two non concomitant samples the natural flow regime nfr which encompasses all the years presumably assumed to be non regulated nor altered and the altered flow regime afr otherwise hence the hvs are used to estimate each partial index in both the natural hainfr and the altered samples haiafr the final partial index hai is evaluated as the ratio between the natural hainfr and altered haiafr conditions ranging from 0 to 1 where 1 denotes a slight deviation from the natural regime and 0 otherwise if the haiafr magnitude is greater than the hainfr the index is estimated with the inverse ratio and hydra eflow will mark it with an asterisk on the other hand the global indices reflect the overall squared qualifications of the n partial indices per each j regime group in table 3 as eq 3 g h a i i j 1 n h a i j 2 j 1 n h a i j 2 n n 1 the approach proposes five alteration degrees and considers the cis wfd 2003 color assignation to inform the alteration status qualitatively fig 4 further information for each index expression is found in the iahris methodological manual available at http www2 montes upm es dptos digfa or the manual of hydra eflow 2 6 flood frequency analysis the connectivity discharge frequency index hai9 considers the gumbel probability distribution function pdf to model the maximum flow series frequency that guarantees river connectivity eq 1 however discharge regimes vary worldwide and over time so the statistical descriptors and the best fitting distribution ouarda and charron 2019 playing a predominant role in hydrological alteration assessment for this reason hydra eflow incorporates hydrological probability distribution functions to offer a flexible evaluation of the indices that require a flood frequency analysis depending on the selected function the results are plotted in either normal gumbel or lognormal probability papers in addition the kolmogorov smirnov test massey 1951 is included to verify the goodness of fit eq 1 q c o n n q t r 2 t r q e eq 2 q e q x a 0 7 0 6 c v q x a where q c o n n is the connectivity discharge q t r 2 t r q e is the discharge whose return period is double the return period of the effective discharge q e is the effective discharge q x a is the mean of the maximum annual discharge series and c v q x a is the coefficient of variation of the maximum annual discharge series 2 7 hydrologic environmental flow prescription the environmental flow ef or environmental water allocation is based on the instream hydrological alterations and its linkages with ecological principles to encourage a social and environment agreed water regime for rivers and estuaries management arthington 2012 various methods developed in the last decades aimed to establish an ecologically significant ef tharme 2003 recently classified into five groups with specific characteristics poff et al 2017 none of the groups is better than the others their use depends on the amount of monitored information and the financial budget available to rehabilitate a specific habitat acreman 2016 the hydrological approaches work primarily with flow time series oriented to preserve the crucial characteristics of the hydrograph they have been mainly designed for targeted species i e salmon or trouts but the hydraulics morphological and ecological essentials are barely acknowledged webb et al 2017 theodoropoulos et al 2018 however they are appropriated for reconnaissance levels in water resources management for their low cost and undemanding expertise poff et al 2017 hydra eflow incorporates eight hydrological methods as a preliminary stage for ef allocations in this first version fig 2 2 8 the ecological network analysis after performing an ha analysis hydra eflow produces a technical report where recommendations are supplied to guide analysts to the likely forward studies to deep into the potential environmental consequences the guidance is founded on an expert based adjacency matrix which reflects the connections between the iahris indices and the hydraulics geomorphology and ecosystem components bondy and murty 2008 it is worth mentioning that for instance hydra eflow uses a circular graph to show both the structure and the network relationships for recommendation purposes not for network operation suppose two variables hereafter nodes are linked in that case their association is denoted with 1 in the adjacency matrix a 0 otherwise a indicates the direct relationships between node pairs for all n nodes and can be symmetric for bidirectional connections or non symmetric for unidirectional ones thus a is the direct connection matrix dcm fig 5 a however to elucidate the indirect network interrelatedness icm a is powered from order 2 to any m order until the variable hierarchy stabilizes where m is the connection length between nodes the result will show the number of possible indirect connection pathways between node pairs fig 5b manzano solís et al 2019 for example suppose that node 2 relates to node 3 and node 3 to node 4 there is an indirect linkage pathway between node 2 and node 4 of length two 2 3 and 3 4 that is shown in the element a 2 4 of a 2 in many structural system analyses the dcm is non symmetric where the sum of the elements in the i th row represents the total direct influence of the i th node tdi while the sum of the elements in the j th column denotes the total direct dependence of the j th node tdd godet and bourse 2004 the sorted rank of the tdi designates the variable hierarchy and it is compared at each dcm power fig 5a the goal is to know the total connection matrix tcm for this purpose the icm is normalized by dividing each element by the highest value in the matrix fig 5c the result is the normalized indirect connection matrix nicm eq 4 b i j a i j max i c m a i j i c m b i j n i c m finally the nicm is added to the dcm to get the total connection matrix tcm manzano solís et al 2019 the sum of the elements of the i th row denotes the total influence level of the i th node while the sum of the elements of the j th columns represents the total dependence level fig 5d hydra eflow employs an expert based adjacency matrix to link the hai indices to hydraulics geomorphological and environmental variables to elucidate the potential affectations caused by the flow regime alteration and provide recommendations for forwarding cascade studies seven experts in integrated water resources management strategic planning hydrology climatology hydraulics ecology and biology worked under the delphi approach delbecq et al 1975 applied as suggested by chu and wang 2008 firstly one anonymous round took place remotely to select the most relevant channel hydraulics geomorphological and ecosystem components related to the discharge regime for such purpose the hai description per index table 3 and related documentation were provided to every expert to standardize the heuristics and introduce the topic the construction of the adjacency matrix was based on the linkages integration between the 21 partial hais for 1150 gauged catchments in mexico arévalo mejía et al 2020 ten hydraulics parameters nine geomorphological characteristics and six environmental biological indicators fig 6 a then another round was held to fill an adjacency matrix per expert which tells whether the i th row indicator behavior modifies the j th column node behavior 1 or not 0 next the seven adjacency matrices were added and turned into a binary matrix as the expert team had seven members all values greater than four were turned into 1 to represent an agreement greater than 50 0 otherwise the result was a global adjacency matrix a fig 6a since the nodes hierarchy became stable between power four and five a was powered four to identify the indirect connections between the node pairs and their total dependence and influence levels fig 6b finally the combination of influence and dependence levels constitutes the descriptive circular graph used by hydra eflow to show the potential affectations after evaluating the hais fig 6c fig 6b shows the general picture of the hydrologic alteration dynamics firstly there is a group of driving variables that influence the general system demeanor mean annual volume index hai1 mean monthly volume index hai2 minimum monthly volume hai6 mean monthly maximum discharge hai7 connectivity discharge hai9 flushing floods discharge hai10 mean minimum monthly discharge hai15 typical droughts discharge hai16 and the drainage pattern therefore modifications to this group will change the status in the long term of the rest of the variables however another group is the transition between the driving variables and the response nodes base flow water depth wet perimeter discharge velocity the mass water exchange between tributaries and the river shape it is remarkable that purely hydraulics components constitute this group which is highly dependent on the driving one and influential on the third thus hydraulics directly influences the geomorphology and habitat responses but depends on the discharge patterns finally all the habitat features and most geomorphological ones are contained in the response group these nodes have little or no influence on the general system behavior but are hugely dependent on the dynamics of the other two groups on the other hand fig 6c exhibits the nodes hierarchy note that the hydraulics features head the node hierarchy with many total and direct connections followed by the driving alteration indices however this condition may vary from one site to the other in addition climate components and water quality were not included in this first version of hydra eflow for this reason the adjacency matrix can be modified according to the characteristics of the analyzed location but the guidance of experts is highly recommended the dynamic shown is the general trajectory noticed in altered regimes worldwide tian et al 2019 yuqin et al 2019 macnaughton et al 2015 thus the method applied is a numerical way to explain the hydrological alteration consistently in addition it is a structured way to depict thumb rules that could be useful in robust machine learning or data mining algorithms 3 study case the balsas river basin in mexico 3 1 area description the balsas river basin brb is located among the trans mexican volcanic belt tmvb sierra madre del sur sms and the mixteca mountain ranges taxiaco and tamazulapan fig 7 it is characterized by irregular topography intermontane valleys deep slopes and narrow fluvial plains casas et al 1996 the balsas river is born in the puebla valley with the atoyac river which runs off to the west until pouring its waters into the pacific ocean on average the mexican coasts leading to the pacific ocean are struck annually by 13 hurricanes causing enormous damage to the lower sub basins díaz delgado and gaytán iniesta 2014 the average altitude is 1000 mosl with a drainage area of 117203 9 km2 the mean annual rainfall oscillates between 873 mm in the lower and 1219 mm in the higher sub basins fig 8 the weather is mainly semi warm and sub humid with a mean annual temperature of 22 c according to the national water commission conagua the brb reports a mean total discharge volume of 16798 hm3 year and over 12 million inhabitants benefit from its natural resources conagua 2018a b c however nearly 68 of the water availability is employed for consumptive water activities like agriculture self sufficient industry public supply and electricity generation excluding hydropower thus the basin is characterized by a densified amount of large water supply reservoirs hydropower dams flood alleviation weirs and small farm impoundments generating undesirable habitat degradation biodiversity loss and reduced fluvial connectivity in addition to discharge regulation water diversion to the metropolitan valley of mexico and foreign irrigation districts are two common practices in the brb only the cutzamala sub basin provides 25 of the potable water consumed in mexico city conagua 2018a b c these water withdrawals have largely adverse effects on the breadth of seasonal discharge variations increasing the frequency of low flow events and setting restrictions to the water mass for environmental purposes hence the riverine communities struggle against the unprecedented water stress induced by human needs and enhanced by climate change in recent decades the brb is divided into 15 sub basins however only 13 are analyzed since the other two are significantly small and lack hydrometric information 3 2 the data daily discharge data were obtained from the national bank of superficial water data bandas acronym in spanish conagua 2018a b c there are 256 hydrometric stations within the basin however after assessing the data quality with hydra eflow in the operating stations with a record period greater than fifteen years only 129 stations were considered for the analysis each time series was segmented into regulated and unregulated periods depending on the ancient reservoir in each tributary reach the regulation dates were downloaded from the dams security system ssp acronym in spanish conagua 2018a b c fig 9 shows the time series of five flow components and characteristics of the 13 sub basins identifying the starting regulation date per reservoir the data verification module of hydra eflow assessed the information for database entries fig 2 3 3 results and discussion 3 3 1 alteration dynamics the dams operation rules usually impact the discharge downstream of the regulation site as the run off aggregates without a retained part of the water volume devoted to satisfying human needs macnaughton et al 2015 the upper streams in the brb are highly fragmented resulting in severe consequences for the lower sub basins these consequences include modifications in diverse regime components and promote the land use change from temperate and tropical forests to agriculture livestock and urban uses zarco gonzález et al 2021 mainly the extreme values are directly impacted throughout the lower region and during the hydrologic year as shown in fig 9 the upper right sub basins tlapaneco nexapa mixteco alto atoyac and libres o reveal two contrasting scenarios from one side the variability of the 7 day max and 30 day min discharge series has been drastically diminished for the alto atoyac sub basin which is consistent with the positive trend shown by the number of days with null discharge this sub basin deviates the available water to irrigation districts located on the highlands conagua 2018a b c the farm dams regulate the flow to ensure enough water for agriculture reducing the intra and interannual variability and exposing the riverine organisms to the minimum and base flow reduction effects additionally the irrigation districts pour the remaining polluted water into the streams increasing the biochemical oxygen demand bod5 from 75 to 210 mg l in the dry season pérez castresana et al 2018 the depletion of the minimum flow magnitude reduces the pollution dissolution capacity in the rivers worsening the conditions to preserve the instream and adjacent biota in stark contrast the libres o sub basin exposes a negative trend in the number of days with null discharge and for the mixteco sub basin they have been absent since 1995 surprisingly the libres o sub basin lacks dams weirs or impoundments to increase the monthly discharge however the landscape has recently changed to farming crops and increased urban surface nexapa has the same water uses as the alto atoyac the difference is that nexapa does not evince an increase of days with null discharge tepalcaltepec cupatitzio and tacámbaro constitute the upper left sub basins in tepalcaltepec the more extended irrigation districts and the annual run off benefit from recurrent hurricanes that strike the pacific coast with a higher 30 day minimum flowing downstream in most stations the number of days with null discharge has been practically absent since the 80s the increase in the water mass means that the channel geomorphology is preserved since it runs all along the hydrologic year however the constant flow prevents the formation of morphological units like pools and shallow banks proper for amphibians egg deposition and juvenile fish recruitment modifying the species distribution pattern along the rivers rolls and bond 2017 the middle sub basins cutzamala mezcala and amacuzac exhibit extensive discharge variability before the 80s providing the optimum conditions for different life stages of amphibians fishes reptiles microinvertebrates dense forests and birds communities however it is also evident that when the large dams started their regulation procedures the variability of the minimum flow was reduced while the maximum peaks were preserved and enhanced the trend for the minimum flow depletion is remarkable and is likely to keep in that motion until the present day the decline is partially due to the increasing water demand for agriculture and hydropower generation nonetheless precipitation reduction and increased air temperature have also been observed melgarejo et al 2021 the increasing air temperature eases the heat transfer to the low water mass ending and in combination with the discharge reduction increases the evaporation rate and dewatering regimes the number of days with null discharge has also been decreased meaning that the operation rules leave a lesser but constant low flow running downstream on the other hand the mezcala and the amacuzac sub basins show extraordinary discharge peaks caused by possible human demanded water to satisfy agricultural or urban needs or by a meteorological phenomenon the hydropeaking causes harsh havocs to the instream communities while the discharge is suddenly released washing away the nutrients and sediments increasing the mortality probability of adult individuals aggravating the fish recruitment and reducing the riparian richness the modifications caused by the regulation infrastructure in the upper sub basins have their denouement in the lower brb hydrologic regimes the discharge at infiernillo and zirándaro are characterized by the lack of extreme values variability and a regular hydrograph with lesser water than habitual since most of the water mass is retained upstream these regular hydrographs affect the endemic riverine taxa and facilitate the encroachment of exotic aquatic and terrestrial species into the streams mejía mojica et al 2015 broadening the list of endangered native species of the brb in the red list cervantes et al 2020 3 3 2 evaluation of hydrological alteration the discharge deviations caused by the reservoirs range widely between sub basins however the ha module of hydra eflow fig 2 allows valuable insight extraction while evaluating the discharge samples regulated and unregulated the study reveals that there are 96 altered stations and 33 non altered as expected the most altered river reaches are located within the highly human influenced sub basins and in the lowlands in contrast the non altered reaches are located in the highlands except for the alto atoyac nexapa and mixteco sub basins fig 10 impacted by human settlements and industrial or agricultural lands rodríguez tapia and morales novelo 2017 pérez castresana et al 2019 the hai evaluation exhibits that a large portion of the basin is altered nonetheless there are sub basins tacámbaro and tlapaneco with nearly no alteration despite the presence of the reservoirs fig 10 the sub basins are classified into three groups according to the number of altered stations to elucidate the hydrological impacts resemblances and differences of each group table 4 it is worth mentioning that the non alteration status was prescribed if the three global indices ghai fell in the excellent or good categories otherwise the discharge was considered altered fig 4 the highly altered sub basins show a broader dispersion while evaluating the partial alteration indices fig 11 which means that the hydrologic regime has been highly modified in the three analyzed discharge disaggregation groups mimicking the hydrograph variability is highly important the typical values mean and total volumes represent the water regime that circulates at least 50 of the time in a hydrologic year the minimum flow frequency will likely increase if the typical discharge values are reduced similarly the rise of maximum extreme events may be linked to the persistent increment of the typical values the magnitude hai1 and hai2 and seasonality indices hai5 and hai6 are the most fluctuating components for typical values in the infiernillo zirándaro cutzamala mezcala and mixteco sub basins it should be noted that the most important large dams are located in the mentioned areas e g infiernillo and el caracol affecting the aquatic biota which has nearly disappeared in the sub basins whose waters are destined for agricultural uses conagua 2018a b c values ranging from 0 2 to 0 6 in the hai5 and hai6 indicate a seasonality reversal in the streams up to four months the implications for the riverine taxa include reduced water availability downstream altered physical chemical parameters and pollutant dissolution capacity reduction seasonality reversals may be linked to climate change or climate variability which has been observed in the brb in recent years causing severe drought occurrences melgarejo et al 2021 the extreme maximum and minimum events play a notable role in river hydraulics geomorphological and environmental components fig 6b however changes in their frequency magnitude or seasonality are arguably the most pervasive impacts on the riverine taxa recruitment richness and distribution the magnitude index hai7 exhibits a wide dispersion with a narrow tail at the end of the violin plot fig 11 the tail shape is explained by the hydropeaking practices in the stations located after the large dams since there is a greater water mass volume the index is assessed by the inverse ratio nhr ahr leaving the evaluation reasonably low in the violin plot with a tail shape this effect is visible for the infiernillo zirándaro cutzamala and mixteco sub basins another highlighting insight is the low evaluation in the frequency index hai9 related to the connectivity discharge of the drainage pattern and therefore the baseflow it is well known that the reservoirs fragment the drainage pattern and that more than 75 of the worldwide rivers will be fragmented in 2030 nilsson et al 2005 while the reservoirs and small farming impoundments retain the water the downstream baseflow is reduced impacting the longitudinal transversal and wet perimeter of the rivers this index directly connects to the hydraulic parameters in the rivers henceforth it indirectly impacts the channel geomorphology and the riverine habitat distribution fig 6b on the other hand the low flow magnitude hai15 and duration hai20 and hai21 are the most affected indices in the evaluation which have impacted the distribution of exotic species in the brb mejía mojica et al 2015 the altered sub basins evince lesser dispersion than the highly altered sub basins nonetheless the tail shape is preserved for the magnitude indices in typical hai1 and hai2 extreme maximum hai7 and hai8 and minimum hai15 and hai16 values similarly the frequency of extreme maximum events hai9 is low ranked in the evaluation these similarities reveal recurrent dynamics in the altered components of the first two groups of sub basins and the rehabilitation strategies may become likely applicable in parallel to the whole basin it should be mindful that these indices are encompassed in the driving variables for indirect alterations fig 6b the evaluation in the non altered sub basins was satisfactory in all the indices except for the frequency of extreme maximum events hai9 for the tlapaneco sub basin the reduction of the connectivity discharge may be linked to the water diversion practices of the upstream impoundments however the evaluation for the tacámbaro sub basin is quite uncertain due to the lack of hydrometric and water regulation information therefore a more detailed study is strongly recommendable in this sub basin 3 3 3 environmental consequences fig 6c shows that from the 21 hais the mean annual and monthly volumes hai1 hai2 the connectivity discharge hai9 the flushing flood discharge hai10 the mean minimum monthly discharge hai15 and the typical droughts discharge hai16 produce more direct and indirect hazards to the riverine systems biodiversity is the higher dependence level variable followed by invasive species nutrients and species spawning the descriptive graph concludes that the nodes with the most direct and indirect affectations are associated with the ecosystem and the riverine living organisms regardless of the expertise and scientific fields the highly altered sub basins table 4 showed a poor evaluation in hai5 hai6 hai9 hai15 hai16 and hai21 similar conditions are noticed in the altered sub basins since they scored low on hai6 hai9 hai14 hai15 and hai21 furthermore the depletion of the minimum monthly volume hai5 diminishes the channel connectivity discharge hai9 worsening the stream dissolution capability and increasing the number of periods with low flow hai21 as expected the base flow and the minimum mean monthly discharge hai15 are also reduced therefore the flow regime changes cause direct impacts on all the hydraulics and geomorphological components which generates indirect hostile and undesirable endangerment of the riverine biodiversity at this point the circular graph is merely descriptive nonetheless operational mining graph algorithms will be included for future research to glimpse the affectation degree and their dynamics the alterations in the hydrosphere dynamics are undeniable with less water mass to exchange between sub basins the hydraulics physicochemical chemical geomorphological and environmental riverine conditions will worsen every passing day if the mexican society non governmental organizations and stakeholders do not mitigate the alterations herein shown habitat rehabilitation will remain a priority objective in the environmental agendas while ecological sustainability will be harder to reach 3 3 4 hydra eflow assistance in the analysis hydra eflow was an appreciable assistant while exploring the hydrological data since it makes it possible to evaluate the statistical quality of the data sample a characteristic that is not considered in the iahris v3 0 software martínez santa maría and fernández yuste 2021 nor in indicators of hydrological alteration iha software developed by the nature conservancy the nature conservancy 2022 for punctual analysis or single files the iha software provides facilities and a wide range of indicators on its side the iahris software v3 0 has a convenient option for databases analyzing each hydrometric time series provided hydra eflow allows working with databases as well saving all the results in a single ms excel file the above is advantageous when exporting the file into a geographical information system gis software and recognizing the spatial behavior of the hydrologic alteration the results of every single step in hydra eflow are exportable into text formats simplifying the information extraction and pattern recognition of the data most of the graphs herein shown come from the single database file for the study case or are native hydra eflow graphs exportable from the software finally it is remarkable to mention that the executive report makes de recommendations based on an expert adjacency matrix which can be modified according to the needings and features of each study case 4 conclusions the hydrologic alteration evaluation is a benchmarking study to enrich the heuristics of the system conditions and promote backward and forward cascading studies to depict the potential alteration triggers and impacts hydra eflow is an easy to use tool for a compelling and insightful hydrological alteration analysis for gauged sites considering non concomitant samples and its recommendations follow the expert heuristics for forwarding cascade studies hydra eflow is an appreciable tool for hydrometric data analysis saving all the results in a single file exportable to any gis software easing the spatial behavior analysis of the hydrologic alteration and containing other utilities that are not commonly found in similar software hydra eflow implements a structured system analysis that showed consistent alteration dynamics observed in the balsas river basin study case furthermore this approach may lead to helpful thumb rules in more robust algorithms to analyze environmental behavior the balsas river basin showed significant hydrologic alterations due to changes in the flow regime derived from the densified number of dams and impoundments in the streams for crop irrigation energy generation and livestock purposes moreover alterations are more severe in the lower sub basins than in the highlands due to the depletion of the aggregated run off leading to frightful water scarcity and unenviable biodiversity loss cupatitzio infiernillo zirándaro cutzamala mezcala nexapa mixteco alto atoyac libres o tepalcaltepec and amacuzac sub basins are altered which may cause appalling water resources management since the northern sub basins submits more than 25 of the drinking water consumed in mexico city declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this study was carried out with the financial support provided by conacyt 248498 and 248553 and uaem siea quebec canada 4212 2016e and 4192 2016e appendix a supplementary data the following is the supplementary data to this article multimedia component 1 multimedia component 1 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j envsoft 2022 105592 
25458,the multiple anthropogenic threats to marine ecosystems and the increasing spatial conflicts in the adriatic ionian region air require transnational integrated and efficient planning of coastal and marine spaces at macro regional level this research presents the geoportal of the adriatic ionian region gair a common platform for information data and decision support tools for ocean planning in the adriatic ionian sea space the gair is an open source platform it supports co production of msp relevant knowledge based on 12 databases portals and tools developed within a set of european projects supporting the implementation of the european strategy for the air eusair the study presents the gair s software architecture its technological stack and the seven integrated geospatial tools a case study of the tool presents its user workflow and main outputs the paper concludes with an evaluation of the gair with respect to msp sustainable blue economy and the implementation of the eusair action plan graphical abstract image 1 keywords cumulative impact assessment aquaculture suitability analysis particle tracking sustainable blue economy decision support instruments maritime spatial planning data availability all the data and metadata mentioned in the research are available at the following link https www portodimare eu 1 introduction the present competition for coastal and maritime space triggered by human activities as well as climate change effects and natural and manmade hazards impact coastal and marine ecosystems pınarbaşı et al 2020 maritime spatial planning msp is a strategy that can tackle these challenges and ensure protection and maintenance of ecosystem structure and functioning by applying an ecosystem based approach domínguez tejo et al 2016 thus ecosystem based maritime spatial planning eb msp is a public process that aims at implementing transparent strategic plans providing legal certainty and regulations for the access to marine resources and spaces addressing both socio economic and ecological objectives as well as ensuring the involvement of a wide range of stakeholders in participatory interaction processes ehler and douvere 2009 hence eb msp implementation should apply a holistic approach and a commonly accepted framework with an ecologically sound visioning easy to communicate to environmental and marine managers and to an ample range of stakeholders pınarbaşı et al 2020 schumacher et al 2020 in this context decision support tools dsts were developed and implemented to inform evidence based decision making processes for maritime management and to support the development of long term strategies for the achievement of the sustainable blue economy sbe com 2021 240 final and of the european green deal goals depellegrin et al 2021 pınarbaşı et al 2020 consequently the results produced by applying dsts strongly support the eu msp directive 2014 89 eu implementation identifying the areas most suitable to allocate different human activities taking into consideration habitats existing sea uses and conflicts and co use of new potential activities in the last years many dsts were developed in diversified contexts and applied for different planning objectives andersen et al 2020 gusatu et al 2021 kotta et al 2020 menegon et al 2018b pınarbaşı et al 2017 these tools often require input data and geographic information system gis and programming skills for their use together with interdisciplinary competences this heterogeneity and wide choice of dsts can generate some difficulties for decision makers in selecting the most suitable tool that can better address the specific planning objectives menegon et al 2018b moreover ideally these tools should be accessible to users through a graphical user interface gui in order to be practically used to address the development of spatial plans their management and the monitoring and evaluation of their effective implementation ehler 2017 menegon et al 2018b in full compliance with the msp principles and policies and with the integrated coastal zone management iczm processes in 2014 the european commission developed the european union strategy for the adriatic and ionian region eusair and the related action plan european commission 2014 aimed at supporting the blue growth in the area the air basin due to its bio physical characteristics and semi enclosed nature and due to being shared between different countries is more vulnerable to space and multi uses competition depellegrin et al 2019 this basin is shared by seven countries four eu member states croatia greece italy and slovenia and three non member states albania montenegro and bosnia herzegovina these characteristics pointed out the compelling need in the air for a transnational integrated and efficient planning and management of marine spaces and uses at macroregional level enabling the avoidance of potential conflicts and favouring synergies to secure a sustainable growth whilst allowing the preservation of coastal and marine ecosystems for future generations msp can foster transboundary cooperation defining common objectives instruments and establishing a close coordination and integration between different administrative and manager levels gómez ballesteros et al 2021 jay et al 2016 in the air several initiatives to support cross border msp in eu member states exist beyond the eusair strategy such as the european maritime fishery and aquaculture fund emfaf or the interreg adriatic ionian adrion programme within the portodimare project geoportal of tools data for sustainable management of coastal and marine environment interreg adrion https www portodimare eu the geoportal of the adriatic ionian region gair was developed the gair is a single virtual space that integrates and further develops existing geospatial databases interoperable portals and interactive tools thus supporting coordinated transnationally coherent and transparent decision making processes for cross border msp the gair also capitalises and integrates outcomes from prior european and regional initiatives such as the supreme project supporting maritime spatial planning in the eastern mediterranean supreme partnership 2018 that supported the development of the msp knowledge catalogue mspkc menegon et al 2018d a web application to facilitate the collaborative inventory and data preparation of msp relevant information e g reports datasets scientific publications policy briefs and reference information to national msp processes and the adriplan adriatic ionian maritime spatial planning dg mare 2013 2015 and ritmare the italian research for the sea miur 2013 2016 2018 projects that supported the initial development of the tools4msp geoplatform menegon et al 2018c a web application providing msp oriented tools such as cumulative effects assessment cea marine use conflict analysis and a marine ecosystem services threat mes threat analysis the aim of this research is to present the gair which overcomes the traditional msp oriented geoportals functionalities i e data visualisation and sharing with data analysis modules and a novel instrument to facilitate data preparation and the engagement with data providers in detail the core features of the gair are the seven geospatial tools namely 1 cumulative effects assessment cea 2 maritime use conflicts muc 3 particle tracking module partrac 4 aquaculture zoning assessment aza 5 coastal oil spill vulnerability assessment oilspill 6 small scale fishery footprint ssf and 7 medium scale fishery footprint combined with cea module msf cea and an additional module named msp knowledge catalogue mspkc to support data inventory and preparation this manuscript is structured as follows firstly we present the gair s software architecture and its technological stack then we provide an overview of the datasets and modules and present a workflow on how to use the gair for a case study on cea in the emilia romagna region northern adriatic sea we discuss the importance of the gair for the msp process in the air and conclude with an analysis of its future development needs and challenges 2 methods 2 1 overall architecture of the gair the gair is a common platform for co production of knowledge in coastal and marine areas mainly focused on supporting msp and based on an integrated combination of web tools helping collaborative management processes and geospatial analysis the need to integrate and further develop existing repositories portals and tools aiming at efficiently organising and making accessible through a single virtual space most of the available knowledge and resources thus supporting coordinated regionally transnationally coherent and transparent decision making processes has emerged within previous eu projects and initiatives european commission 2016 within the portodimare project portodimare partnership 2020 the previous experiences have received a further impulse and a full operational gair has been developed and implemented to support a transnational cooperation network for the implementation of the protocol for the integrated coastal zone management iczm and the directive 2014 89 eu maritime spatial planning directive mspd in the air as a concrete instrument for the implementation of the eusair action plan the overall architecture of the gair is presented in fig 1 the scheme underlines the interaction with external applications and potential end users as well it depicts as a whole a knowledge co production system of software users and web services for supporting the msp processes five hierarchical levels of user profiles have been implemented in order to balance the trade off between the need of knowledge co production and users engagement and the need to guarantee an appropriate level in the resources and information quality general public unregistered users registered users e g citizen stakeholders scientists policy makers and planners advanced users e g pps and invited policy makers and planners specific scientific networks managers editors administrators many gair contents and resources e g public layers maps documents and case studies are publicly available to unregistered users in order to upload and create new resources or perform module analyses users have to be registered and authenticated into the platform the registration is open to everyone however it is subjected to approval by the administrators to prevent registration of spam users in annex 1 of the supplementary material we provide a detailed description of the gair user profiles the main functionalities of the gair include data sharing among users e g geospatial datasets documents maps collections of layers creation and sharing performance of analyses through seven different decision support modules and results sharing through the platform the gair has been designed following a service oriented architecture that includes three main abstract layers fig 1 1 the graphical user interfaces guis which are accessible through html5 based web browsers including mobile browsers allowing end users to intuitively and interactively visualise and operate e g search explore manage with local and remote resources e g geospatial layers maps 2 the access layer which exposes interoperable services and restfull api and acts as a middleware between the guis layer and the resource layer below wrapping access to local resources it also constitutes a single and common point for accessing and managing resources by machine to machine communications third party data repositories or by desktop applications e g qgis 3 the resource layer which deals with storing maintaining and low level controlling the access to different heterogeneous resources such as geospatial datasets metadata documents module configurations case study setups 2 1 1 graphical user interfaces the three main gui components are the geo cms gui the case study and modules gui and the geodatabuilder gui see fig 1 the geo cms gui provides content management system cms functionalities to manage upload create and modify geospatial resources e g layers layer styles maps particularly it includes a search gui which combines free text search faceted navigation and a preview of the filtered results to search over the different gair content types geospatial layers maps generic files and documents and archived model outputs see fig 2 a gui to upload and publish new geospatial datasets and documents including graphical controls to customise the layer styles and to manage permissions in a granular manner e g visualising downloading changing and a map viewer and composer to create and share interactive e g navigating querying multi layered web map applications the case studies and modules gui implements the workflow for the case study driven approach menegon et al 2018b 2018c where the users can perform a module analysis including cea cumulative effects assessment muc maritime use conflicts analysis partrac particle tracking module aza aquaculture zoning assessment oilspill coastal oil spill vulnerability assessment ssf small scale fishery footprint module and msf cea module for medium scale fishery footprint and cea we refer to section 3 3 on model workflow for a detailed description of a case study module run using the cea module the geodatabuilder gui allows users to define new geospatial layer expressions through map algebra operators and functions for combining one or more layers already stored into the gair layer expressions may be used to automatically pre process new layers and use the result to customise the case studies and the module analysis an example of the geodatabuilder gui for creating a new layer expression is presented in fig 3 geodatabuilder supports base map algebra operations e g addition subtraction division multiplication rescaling e g to rescale a layer into the 0 1 interval log transformation and aggregations e g max min average in addition the geodatabuilder enables the user to pipeline the outputs of a module result with another module case study and therefore allowing a module to module integration as an example of integration we refer to the case study in section 4 2 7 2 1 2 access layer web services api the access layer is composed of the geospatial interoperable services and apis and the casestudies api see fig 1 the geospatial interoperable services and apis mainly implement the open geospatial consortium ogc open geospatial consortium inc 2021 web services for enabling the discoverability accessibility and usability of geographic information shared through the gair see supplementary material annex 2 and additional apis for securely uploading registering and publishing new geospatial layers or other generic resources e g documents such apis are also part of the synchronisation mechanism data sync between the mspkc and the gair which allows to ingest the data of the catalogue by the gair see fig 1 2 1 3 resource layer the resource layer consists of a combination of different storage solutions e g database management systems to support the heterogeneous data models and formats shared by the data managers and the end users and all the information needed to achieve a full operational infrastructure e g geospatial datasets documents metadata catalogue information user accounts and profiles case study configurations and model run parameters direct access to the resources is usually interdicted since the access is exclusively provided by the access layer external geospatial resources provided by third party data repositories e g emodnet copernicus are made available through the remote services application remote services allow users to register external services usually web map services osgeo 2010 information on external published layers are automatically retrieved and the layers are made available through the platform similarly to the raster and vector geospatial layers stored locally corti et al 2019 2 2 technological stack the technology stack is the combination of software products development frameworks and programming languages used to build and run a complete application avgeriou and zdun 2014 the gair adopts a free and open source foss technological stack combining and integrating several software packages fig 4 presents an overview of the software components used in the gair server and client implementations each element in the stack was carefully selected based on requirement fulfilment robustness and size of the software community e g number of developers and users quality of support e g public groups or forums addressing user queries regarding installation or other bugs quality of documentation and software licence the gair has been developed on top of the geonode platform benthall and gill 2010 corti et al 2019 geonode development team 2021 2022 a complete suite for collaborative managing geospatial data that provides a significant number of required functionalities providing geospatial content management system functionalities geonode facilitates the upload and management of geospatial datasets making them discoverable and available via standard open geospatial consortium ogc protocols and web mapping applications geonode provides high level guis for spatial data discovery uploading and managing e g setting up metadata and presentation form and for composing and viewing interactive maps geonode guis are built on top of bootstrap bootstrap team 2019 and angularjs google 2021 frameworks and mapstore2 geosolutions 2022 for the mapping applications a highly interoperable access layer based on geoserver geoserver development team 2022 and pycsw software packages pycsw development team 2022 provides access to stored resources through standardised interfaces especially ogc web service the resource layer is mainly implemented by postgresql the postgresql global development group 2022 postgis postgis development group 2022 and elasticsearch elastic nv 2021 for supporting full text searching overall geonode has been developed on the top of django django development team 2018 in annex 3 a summary of geonode and gair technological stack s software components is presented beside adopting the geonode tech stack the gair also leverages on additional foss libraries and frameworks such as jquery the jquery team 2021 for the casestudy and the geodatabuilder guis and the django rest framework encode oss ltd 2021 for the casestudies api see figs 1 and 4 tools4msp api provides the model engine for cea muc and patrac modules menegon 2021 finally an r language r core team 2022 separate stack has been adopted to implement the r based modules server that incorporates additional packages for dealing with geospatial data such as the raster package hijmans 2021 to manipulate and analyse gridded spatial data the mspkc is based on ckan comprehensive knowledge archive network web tool open knowledge international 2021 an open source software for managing organising metadating and publishing collections of datasets in addition the ckanext mspkc plugin menegon 2018 has been developed during the supreme project and included into the mskc implementation ckanext mspkc is a ckan extension which provides additional metadata fields to support an msp oriented resource categorization and description and facilitates the linkage and coupling with the gair the new extension introduces new metadata fields such as msp related topic categories and subcategories domain areas a spatially aware definition of marine areas e g sea names data portals a reference to well established repositories and data portals and validation level a descriptive classification of dataset robustness and official level 3 data collection and geospatial datasets implementing a shared knowledge framework about the coastal and marine system is an essential requisite for creating the case studies and feeding the decision support module analyses the inherent dynamic and collaborative nature of the gair facilitates the continuous improvement and refinement of collected datasets directly by the end users in total 509 geospatial datasets and associated metadata information are stored into the gair figure updated to march 2022 302 layers were initially imported from the mspkc see following section 4 1 while another 207 were later added into the gair by the project partners and the users fig 5 represents the grouping of the geospatial datasets according to topic category spatial scale and validation level the type of habitats includes the majority of layers 79 layers 16 followed by biological characteristics 53 layers 10 fishing 47 layers 9 and maritime transport 40 layers 8 in terms of spatial scale the majority of datasets are of regional scale 169 33 followed by the country level data 146 29 then followed by mediterranean sea basin and air level 82 16 the dataset validation level refers to the source of the dataset and distinguishes among official data providers such as competent authorities at different administrative levels including the european marine observation and data network emodnet while research data is retrieved from experimental models and research studies e g species distribution models spawning and recruitment grounds fishing effort estimations the dataset includes 328 65 official and 181 35 research layers it is to be noted that the official layers mostly refer to type of habitats 70 layers 15 while the research layers mostly refer to biological characteristics topic 44 layers 9 based on the domain area metadata field the spatial distribution of data availability in the air was calculated considering the number of layers related to different spatial scales see annex 4 hotspots of data availability occur in correspondence to portodimare case studies i e emilia romagna istria county slovenia montenegro and kephalonia island 4 modules and workflows 4 1 msp knowledge catalogue the aim of the msp knowledge catalogue mspkc is to overcome time consuming data preparation tasks during an msp data gathering process by providing a web based collaborative inventory and resource systematisation tool that facilitates the engagement with msp data providers the inventory includes spatial and non spatial information such as reports geo statistical datasets scientific publications policy briefs national msp supporting documentation and blue growth strategies the mspkc allows to improve the engagement of contributors avoiding data duplications and fostering a collaborative approach for the catalogue filling up and maintenance a screenshot of the mspkc home page is provided in annex 5 data gathering in mspkc was performed by 13 stakeholders including research institutes universities local and regional authorities across the air italy greece slovenia montenegro croatia bosnia herzegovina and was combined with data assimilated from other global eu national and regional geoportals such as emodnet human activities environmental marine information system emis shape atlas tools4msp data portal annex 6 the stakeholders engaged into the data gathering process introduced more than 1000 resources including geospatial datasets documents maps reports etc into the mspkc and categorised them into 26 msp oriented topics e g maritime boundaries biological characteristics aquaculture fishing each resource was described using dedicated metadata fields e g reference date owner provider licence accessibility annex 7 as a next step non relevant or duplicated resources were removed resulting in 994 resources see annex 5 a faceted search and identification was performed by stakeholders to prioritise the geospatial data to be used by the geospatial tools of the gair based on the following criteria i data quality and reliability ii geographic domain and iii data availability this resulted in the 302 high priority geospatial resources for the air that were imported into the gair 4 2 geospatial modules 4 2 1 module identification and importance within msp process the identification of the geospatial modules to be incorporated within the gair platform was based on a combination of different criteria i relevance of the tools to support the different stages of the msp processes especially in the context of the air region ii maximisation of project partners experience in developing dsts for marine management with particular reference to sector analysis of maritime activities and support to ecosystem based management iii technological feasibility in integrating the tool within the gair platform and iv ease of use for stakeholders of the air and for non expert gair user profiles see annex 1 although based on existing algorithms and tools developed by the partners under the portodimare project the modules were improved and adapted to the specific needs of iczm msp and to the need to achieve an harmonised approach among them one of the goals of such adaptation and harmonization is to support integration among the modules themselves for example by allowing the outputs of one module to be used directly as inputs by other modules e g the cea module can use the outputs of the aza and ssf msf modules as inputs module results integration can be performed using the geodatabuilder gui described in section 2 1 1 the relevance of the identified modules in supporting the different stages of an msp process is illustrated in detail in annex 8 the geospatial modules are mainly designed to support stage 2 gather data and define current ecological and socio economic conditions stage 3 identify issues constraints and future conditions and stage 5 evaluate alternative management actions however the aza module can also have a significant use for building future scenarios and developing alternative management actions stage 4 instead the mspkc and the gair core functionalities i e data management and sharing layers maps offer important support also to stage 1 define goals and objectives and stage 7 refine goals objectives and management actions 4 2 2 module description table 1 provides an overview of the geospatial modules available in the gair in terms of model input data and output data requirements module integration pattern and case studies application gair geospatial modules differ according to adopted programming languages python and r user interaction level and level of long term support perspective this variability has led to the design of two different module integration patterns api based integration and direct integration see fig 1 and table 1 the api based integration performs machine to machine communication with an external module tool web service this mode of integration was implemented for the maritime use conflicts muc module the cumulative effects assessment cea and the particle tracking module partrac in the direct integration mode the gair common api communicates and executes directly with the module engine this was implemented for the aquaculture zoning assessment tool aza the small scale fishery footprint ssf and the medium scale fishery footprint and cea module msf cea a third mode of operation implemented for the coastal oil spill vulnerability assessment oil spill does not require real time analysis and end users can explore query and consult pre processed layers and pre configured maps in table 1 and in the following sections a detailed overview of the seven geospatial modules available in the gair is provided along with their main aims and documentation sources in the supplementary material annexes 9 to 13 we provide screenshots exemplifying outputs for each module 4 2 3 muc maritime conflict analysis the muc is a geospatial instrument to identify sea areas where spatial conflicts occur between sea use pairs e g commercial fishery vs shipping the methodology of the instrument was based on the coexist project interaction in european coastal waters a roadmap to sustainable integration of aquaculture and fisheries coexist 2013 the instrument was widely tested using the tools4msp modelling framework menegon et al 2018c for further details on the methodology applied in the adriatic sea and northern adriatic we refer to menegon et al 2018b and farella et al 2021 4 2 4 cea cumulative effects assessment this module refers to the assessment and mapping of cumulative effects based on the tools4msp modelling framework menegon et al 2018a the module allows to assess the effects of single or multiple human activities on environmental components the cea was widely used across european seas namely adriatic sea farella et al 2020 2021 south eastern baltic sea depellegrin et al 2020 or north sea gusatu et al 2021 for further information on the methodological aspects we refer to menegon et al 2018a also section 4 2 7 exemplifies the application of the cea module through the gair 4 2 5 partrac module for particle conservative contaminants dispersion this module is a tool to evaluate the area of influence of a contaminant source the tool simulates the dispersion of lagrangian particles as a function of the hydrodynamic conditions simulated by the state of the art 3d shyfem oceanographic model bellafiore et al 2018 the hydrodynamic field transporting the particles is calculated as multi annual average by a finite element numerical model applied to the adriatic sea domain with higher resolution along the coast and including the main lagoons and rivers in the area ferrarin et al 2019 ribotti et al 2019 this module allows to assess the dispersion of particles released in the adriatic sea an advection diffusion modelling tool for lagrangian particles is proposed as a planning tool tuned to end users and stakeholders its outputs and derived variables can be customised and analysed based on the end user requests and can be used to evaluate events such as impacts of aquaculture larvae dispersion tracking of floating debris and microplastic point discharge and river plumes dispersion 4 2 6 aquaculture zoning assessment the aquaculture zoning assessment aza module implements a spatially explicit multi criteria methodology namely smce spatial multi criteria evaluation for identifying azas allocated zones for aquaculture fao 2012 i e marine areas where the development of aquaculture is prior to other uses sanchez jerez et al 2016 the smce applied for the aza module can be carried out following the framework developed in brigolin et al 2017 throughout three steps i criteria normalisation ii weight assignment to each criterion iii suitability index calculation radiarta et al 2008 all the criteria to run the aza module together with the weights and the constraints are available for the users in the portodimare geoportal for further details on the aza module application we refer to porporato et al 2020 4 2 7 oil spill coastal oil spill vulnerability assessment the module allows to represent in the form of a dynamic map the vulnerability to oil spills of environmental and socio economic coastal resources of the air the user can set the map to the area of interest activate one or more of the layers that summarise oil spill risk and visually compare with the score for the coastal vulnerability in the area average values for the 2 components of vulnerability layers in the map are automatically calculated the instrument was originally developed as an early warning system within the hazadr project lauro et al 2015 which aimed at strengthening the response capacity of the adriatic region against environmental and technological hazards due to collisions shipwrecking and spillage of oil and toxic material into the sea that could seriously pollute the marine environment and damage the socio economic activities of the sea and coastal communities the oil spill is based on a combined index comadex composed by 5 different parameters regarding the ship dimension and conditions according to the annex 7 of the paris mou vessel type gross tonnage year launched flag and register plus two values about the sea weather condition wind power by beaufort scale and waves height by douglas scale that can generate stress conditions on the ship structure the oil spill was embedded into the gair as dynamic layers to explore the registered oil spill risk during 2019 and vulnerability across the adriatic coastal areas for further methodological details we refer to hazadr 2015 4 2 8 ssf module for small scale fishery footprint and msf module for medium scale fishery footprint and cea cumulative effects assessment these modules provide the tools for visualising fishing pressure for small and medium scale coastal fisheries and combine the multi criteria decision analysis mcda and geospatial techniques to quantify the synergistic effect of influential components e g bathymetry distance from the coast chl a concentration fishing effort marine traffic activity vessel capacity of ports etc on defining fishing footprint the modules were built within the fprmcda r package by the hellenic centre for marine research hcmr for more information about the methodology associated with the fprmcda package please see kavadas et al 2015 the cea module integrates diverse pressures e g ssf msf outputs aquaculture shipping tourism infrastructures to assess the spatial distribution of impacts exerted by these pressures on the selected ecosystem components 4 2 9 case study cea module workflow for emilia romagna regions a typical user driven module workflow for the use of the cea is presented in fig 6 the aim of the case study is to perform this assessment by testing future aquaculture scenarios expansion of 100 sq km of new shellfish farms in the emilia romagna region after the selection of the cea module the user can choose among the available case studies for each tool a case study is a coherent and harmonised set of geospatial layers available at different spatial scales air national regional local testing site or case study levels see table 1 and resolutions that can be used for module running menegon et al 2018b in the case study selection fig 6a we select the emilia romagna region 5260 sq km located in the northern adriatic sea the input parameter setup includes the selection of the geospatial features of the case study area fig 6b this includes the grid resolution layer 42080 grid cells layer resolution 250 m 250 m that defines the spatial resolution of the input layers the human activities u n 16 relevant in the study area e g shipping fishery military areas and the environmental features e n 8 e g marine habitats turtles marine mammals the units of the spatial indicators u and e can be presence absence e g military areas weighted dummy e g land based activities and intensity indicators e g maritime traffic in addition a shellfish aquaculture scenario was performed with the aza module see annex 14 perini et al 2020b for detailed description and incorporated in the cea module considering a uniform distribution on areas with a high aquaculture suitability score suitability 0 75 intensity indicators were transformed using log x 1 to avoid an over dominance of extreme values and all datasets were rescaled from 0 to 1 in order to allow direct comparison on a single and unitless scale based on the selected layers the user can compile a matrix of sensitivity scores based on 15 pressures adapted from the msfd annex iii 2017 845 eu pressure weights and propagation distance fig 6c the pressure weights are scored from 0 to 1 and are a measure of importance of a certain use in contributing to a specific pressure while the distance refers to the area of influence of the pressure in km sensitivity scores can have values between 0 not sensitive and 1 highly sensitive and correspond to the susceptibility of the environmental component to the pressure exerted by a human activity menegon et al 2018a the outputs of the model are presented in fig 6d which includes geospatial results of cea distribution heatmaps representing cea score for each human use and environmental component and a bar plot representing the aggregated value of pressures by human use for the study area the server response time was approximately 5s considering the full case study analysis 42080 grid cells 25 geospatial layers 15 pressures combinations and a server having minimum hardware requirements of 16 gb and 2 2 ghz processor with 4 cores for further details on the module setup and data components we refer to perini et al 2020a the geospatial explicit results show that the highest cea scores 20 are located in offshore areas approximately 20 nm offshore in the north and in the south of the study area in coastal areas high cea scores are located in the whole case study area between 3 and 12 nm offshore in proximity to the ravenna port areas showing medium high scores 7 14 are largely distributed along the entire case study area mainly due to maritime traffic and trawling activities in the area the complex system of marine transportation is the most influential source of anthropogenic pressures such as the introduction of non indigenous species marine litter underwater noise and polluting substances and is impacting mainly essential fish habitats efh circalittoral fine mud eunis code a5 36 and marine turtles and mammals the full set of trawling activities reaches a total cea score higher than the one generated by maritime transport bottom otter trawlers mid water pelagic and rapido beam trawlers impact the area mainly by generating abrasion change in siltation smothering and both selective and non selective extraction of species land based activities pressures e g microbial pathogens marine litter and introduction of organic and inorganic substances strongly related to riverine inputs e g po river delta in the north have a significant influence on the overall cea score coastal and maritime tourism influences the coastal water only within the 2 nm being the source of a wide set of pressures e g marine litter underwater noise introduction of both organic and synthetic components the contribution to total cea of new shellfish farms future aquaculture scenarios is significant primarily at the local scale and for some areas e g between 3 and 6 nm in front of riccione the possible expansion of aquaculture may result in an overall decrease of the cea score because the presence of higher impact activities eg non compatible uses such as trawling must be reduced or eliminated another result of the module run is the cea heatmap fig 6d centred that calculates the cea scores by pairwise percentage contribution by environmental receptor human activity respectively marine litter and pressures related to trawling fisheries mainly seafloor abrasion changes in siltation and extraction of species are the pressures determining the highest contribution to the cea score the most affected environmental components are the species of high conservation interest especially marine turtles efhs and sandy muddy seabeds mainly circalittoral fine muds the bar plot in fig 6d right quantifies the contribution of each pressure to the total cea score selective extraction abrasion and marine litter are the human uses generating the highest pressure with 12 and 11 respectively 5 discussion 5 1 relevance of the gair for the adriatic ionian region the gair supports all the four pillars of the european union strategy for the adriatic and ionian region pillar 1 on blue growth pillar 2 on transport and energy pillar 3 on environmental quality pillar 4 on sustainable tourism the geoportal allows ecosystem based investigation of the ecological resources of the air and analyses how current coastal and maritime activities may trigger adverse effects on the marine environmental status which is one of the priorities of eusair pillar 3 this is ensured by the cumulative effects assessment tool which is widely used for ecosystem based management of the marine environment across the globe clarke murray et al 2015 griffiths et al 2020 hammar et al 2020 and which is implemented in the geoportal through the tools4msp application programming environment api menegon et al 2018a decision makers and planners can use the tool to define planning strategies aimed at mitigating the anthropogenic impacts coming from multiple stressors such as underwater noise marine litter and abrasion the geoportal can substantially contribute also to eusair pillar 1 blue growth european commission 2014 the geoportal implements a set of sectoral tools such as the aquaculture zoning assessment aza module which enables the analysis of mussel aquaculture siting in line with global trends also in the mediterranean 62 of fish food will be produced by aquaculture in 2030 world bank 2013 and therefore the need for instruments that can support planners in the identification of the most suitable areas for this activity by balancing the demands for ecological protection with socio economic needs will be required the msp directive 2014 89 eu requires coastal eu member states to establish maritime spatial plans by 2021 the geoportal provides a full suite of data and tools that can support the national msp in air countries in a transboundary cooperation framework according to art 11 and art 12 of the msp directive in particular the geoportal provides a set of tools to organise the sea uses reduce conflicts and investigate environmental human interactions to promote a sustainable development of coastal economies the emilia romagna region proposal within the italian msp process presidente della repubblica 2016 for the adriatic sea has been strongly supported by cea results within the gair workflow perini et al 2020b resolution of the emilia romagna regional council n 277 of 01 03 2021 the regional focus given to the cea analysis highlights the potential threats to species habitats and ecosystems generated by multi sector human activities in the regional coastal and marine space in order to inform the planning process on the present propagation of pressures and to assess the spatial distribution of impacts on one or multiple environmental receptors through the gair the cea operational tool has been made accessible through a graphical user friendly interface available also for a wider non technical audience such as decision makers practitioners blue economy sectors and civil society the proposed cea methodology and analysis for the emilia romagna region constituted a fundamental knowledge base for the regional msp pilot plan one of the earliest msp pilot plans of the italian sea space barbanti et al 2018 which lead to the definition of management measures in accordance with the areas of major impact and identifying the typology of sea uses responsible for those impacts for further details on the pilot plan and its planning measures we refer to barbanti et al 2018 and farella et al 2020 5 2 limitations and future developments of the gair the gair presents a series of limitations that can be the object of future development and improvement user interaction needs to be improved e g by enhancing the presentation of textual and graphical contents within the modules pages simplifying the management of all input parameters allowing case studies to be created from scratch and especially the geodata builder that is used for the creation of new input layers and to effectively connect the geospatial modules i e incorporating the output of a module as an input of another module the mechanism of data synchronisation data sync between the mspkc and the gair needs to be more robust through specific validators for uploaded or referenced user datasets this could be ideally tackled by using error handling protocols as presented in the emilia romagna case study the modules were designed to be mutually integrated mainly adopting a common grid based approach for geospatial analysis and thorough systematic usage of the geodatabuilder but this integration is not fully automated because users still have to download the output of the previous module and manually upload it as new layer into the geoportal only after that can the layer be used for example as a new input for cea the performance of modules requires further improvement in terms of reduction of computational time this is especially the case for computationally intensive modules such as partrac for particle dispersion modelling the gair is currently lacking a logical structure for defining the relevant layers to be used into the different modules in the future a fuzzy matching procedure will be tested to ease the identification of relevant layers to be used in the reference module and case study the modules would benefit from asynchronous module runs to ensure more efficient user interactions and optimise the model run time the modular architecture of the gair will easily allow adding other modules by using the api technology and sharing the same input data model at the current stage the software of the gair has a long term development perspective through ongoing and future international and national research projects such as remap reviewing and evaluating the monitoring and assessment of maritime spatial planning emfaf 2022 2025 msp4bio improved science based maritime spatial planning to safeguard and restore biodiversity in a coherent european mpa network h2020 2022 2025 and the msp4biodiversity biodiversity mainstreaming in maritime spatial planning next generation eu to establish the national biodiversity future center 2023 2025 the project initiatives will further support the technological development of the gair through extension of tools incorporation of new datasets application in study areas outside the air e g western mediterranean and black sea and bug fixing 6 conclusions the gair showcases to be a versatile instrument to support the development and implementation of the planning and management strategies in the air at regional national and transboundary level indeed its open and easy to use nature allows different users also non technical experts to access and operatively exploit the provided services and the available data thus making the gair a useful tool for public administrations scientific and research bodies as well as the civil society and facilitates the engagement of data producers being conceived and developed by a transnational network of research institutes and public administrative bodies the gair possesses a shared and transnational character thus representing a collector of data and information coming from different sources and levels from the scientific community research and monitoring activities to the public administrations repositories and is linked to different available thematic portals this characteristic is of high relevance since it ensures a populated data portal thanks to data sharing practices at transnational level set up in the framework of the supreme and portodimare projects the geoportal becomes an instrument able to favour a knowledge building process by engaging multiple stakeholders and strengthening the science policy dialogue furthermore the gair is expected to be a regularly maintained and validated source of knowledge and data for msp with data systematically controlled filtered and harmonised to ensure reliable and useable products the mspkc provides mechanisms to engage the data providers who can collaborate in the inventorying screening and prioritisation of data sources that compose the knowledge base of the gair and the analysis in the available case studies the gair provides a set of tools and services that can be used in an msp context the tools are already fed by a variety of spatial data in an effective and shared environment where these services and the derived products can be integrated between each other to provide information relevant for the management both sectoral and multi sectoral issues can be addressed thanks to the potential of adopting an integrated holistic approach where one module can provide information useful to feed the application of a second module e g aza partrac ssf towards cea and muc as such the modules offered by the gair can be customised and applied to satisfy the information needs and management issues depending on the context while the gair was developed to serve msp in the air the application of its modules is flexible for other geographic regions and scalable at different resolutions local to sea basin level for example the cea module has been tested in the north sea gusatu et al 2021 in the context of offshore wind energy scenarios for 2050 in the lithuanian baltic sea depellegrin et al 2020 in the context of marine ecosystem services threat analysis as well as for transboundary cea in the strait of sicily malta farella et al 2019 also the muc module was applied outside the air in an msp data stocktake in bangladesh roy et al 2022 for the identification of conflicts with nature protection and in the strait of sicily malta farella et al 2019 and the patrac module based on the shyfem hydrodynamic model was applied in the mediterranean sea basin and danube delta black sea shyfem 2022 shyfem development team 2022 the key advantage in these applications is the case study driven approach that can be applied with adequate data to any geographic area of the globe in addition the gair as an open source platform for multi user knowledge co production can be easily reused to support the development of maritime spatial plans from sub national to transboundary marine waters in the european seas and beyond beyond the provisioning of spatial and quantitative data the gair also provides information on the main existing strategies and legislative instruments that act at the air basin scale and allows the countries to be informed on the state of implementation of the management and spatial plans and the adopted approaches of their neighbours thus the gair acquires an added value since it acts as a communication and sharing platform among the air countries supporting the transnational coordination that is required by the msp directive because it is recognized as a fundamental enabling factor for the achievement of an effective and sustainable use of marine and coastal resources indeed the geoportal ensures the transfer the implementation and re use of the outputs obtained by applying the provided modules software availability name of software and products geoportal of the adriatic ionian region gair portodimare geonode project designers national research council of italy institute of marine sciences cnr ismar venice developers emilia romagna region directorate general for territory and environment protection bologna national research council of italy institute of marine sciences cnr ismar venice maintenance emilia romagna region department directorate general for territory and environment protection national research council of italy institute of marine sciences cnr ismar venice year first available 2020 hardware required web server 16 gb or more 2 2 ghz processor with 4 cores additional processing power may be required for multiple concurrent styling renderings a baseline of 50 gb 100 gb for production deployment additional disk space could be necessary according to specific needs especially in relation with the number and size of spatial data 64 bit hardware is strongly recommended see the geonode quick installation guide 2021 for additional information software required web server geonode 2 10 r server docker engine and docker compose optionally software required client users all modern internet browsers e g google chrome mozilla firefox microsoft edge apple safari including mobile versions software availability gair https github com regioneer portodimare gair data availability gair https www portodimare eu software licence gnu agpl v3 0 user documentation https www portodimare eu static docs program language python backend javascript react redux frontend program size 100 mb implementation official implementation for supporting maritime spatial planning into the adriatic ionian region has been released within the interreg adrion portodimare project https www portodimare eu declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work was supported by the project portodimare geoportal of tools data for sustainable management of coastal and marine environment adrion 205 european union appendix a supplementary data the following is the supplementary data to this article multimedia component 1 multimedia component 1 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j envsoft 2022 105585 
25458,the multiple anthropogenic threats to marine ecosystems and the increasing spatial conflicts in the adriatic ionian region air require transnational integrated and efficient planning of coastal and marine spaces at macro regional level this research presents the geoportal of the adriatic ionian region gair a common platform for information data and decision support tools for ocean planning in the adriatic ionian sea space the gair is an open source platform it supports co production of msp relevant knowledge based on 12 databases portals and tools developed within a set of european projects supporting the implementation of the european strategy for the air eusair the study presents the gair s software architecture its technological stack and the seven integrated geospatial tools a case study of the tool presents its user workflow and main outputs the paper concludes with an evaluation of the gair with respect to msp sustainable blue economy and the implementation of the eusair action plan graphical abstract image 1 keywords cumulative impact assessment aquaculture suitability analysis particle tracking sustainable blue economy decision support instruments maritime spatial planning data availability all the data and metadata mentioned in the research are available at the following link https www portodimare eu 1 introduction the present competition for coastal and maritime space triggered by human activities as well as climate change effects and natural and manmade hazards impact coastal and marine ecosystems pınarbaşı et al 2020 maritime spatial planning msp is a strategy that can tackle these challenges and ensure protection and maintenance of ecosystem structure and functioning by applying an ecosystem based approach domínguez tejo et al 2016 thus ecosystem based maritime spatial planning eb msp is a public process that aims at implementing transparent strategic plans providing legal certainty and regulations for the access to marine resources and spaces addressing both socio economic and ecological objectives as well as ensuring the involvement of a wide range of stakeholders in participatory interaction processes ehler and douvere 2009 hence eb msp implementation should apply a holistic approach and a commonly accepted framework with an ecologically sound visioning easy to communicate to environmental and marine managers and to an ample range of stakeholders pınarbaşı et al 2020 schumacher et al 2020 in this context decision support tools dsts were developed and implemented to inform evidence based decision making processes for maritime management and to support the development of long term strategies for the achievement of the sustainable blue economy sbe com 2021 240 final and of the european green deal goals depellegrin et al 2021 pınarbaşı et al 2020 consequently the results produced by applying dsts strongly support the eu msp directive 2014 89 eu implementation identifying the areas most suitable to allocate different human activities taking into consideration habitats existing sea uses and conflicts and co use of new potential activities in the last years many dsts were developed in diversified contexts and applied for different planning objectives andersen et al 2020 gusatu et al 2021 kotta et al 2020 menegon et al 2018b pınarbaşı et al 2017 these tools often require input data and geographic information system gis and programming skills for their use together with interdisciplinary competences this heterogeneity and wide choice of dsts can generate some difficulties for decision makers in selecting the most suitable tool that can better address the specific planning objectives menegon et al 2018b moreover ideally these tools should be accessible to users through a graphical user interface gui in order to be practically used to address the development of spatial plans their management and the monitoring and evaluation of their effective implementation ehler 2017 menegon et al 2018b in full compliance with the msp principles and policies and with the integrated coastal zone management iczm processes in 2014 the european commission developed the european union strategy for the adriatic and ionian region eusair and the related action plan european commission 2014 aimed at supporting the blue growth in the area the air basin due to its bio physical characteristics and semi enclosed nature and due to being shared between different countries is more vulnerable to space and multi uses competition depellegrin et al 2019 this basin is shared by seven countries four eu member states croatia greece italy and slovenia and three non member states albania montenegro and bosnia herzegovina these characteristics pointed out the compelling need in the air for a transnational integrated and efficient planning and management of marine spaces and uses at macroregional level enabling the avoidance of potential conflicts and favouring synergies to secure a sustainable growth whilst allowing the preservation of coastal and marine ecosystems for future generations msp can foster transboundary cooperation defining common objectives instruments and establishing a close coordination and integration between different administrative and manager levels gómez ballesteros et al 2021 jay et al 2016 in the air several initiatives to support cross border msp in eu member states exist beyond the eusair strategy such as the european maritime fishery and aquaculture fund emfaf or the interreg adriatic ionian adrion programme within the portodimare project geoportal of tools data for sustainable management of coastal and marine environment interreg adrion https www portodimare eu the geoportal of the adriatic ionian region gair was developed the gair is a single virtual space that integrates and further develops existing geospatial databases interoperable portals and interactive tools thus supporting coordinated transnationally coherent and transparent decision making processes for cross border msp the gair also capitalises and integrates outcomes from prior european and regional initiatives such as the supreme project supporting maritime spatial planning in the eastern mediterranean supreme partnership 2018 that supported the development of the msp knowledge catalogue mspkc menegon et al 2018d a web application to facilitate the collaborative inventory and data preparation of msp relevant information e g reports datasets scientific publications policy briefs and reference information to national msp processes and the adriplan adriatic ionian maritime spatial planning dg mare 2013 2015 and ritmare the italian research for the sea miur 2013 2016 2018 projects that supported the initial development of the tools4msp geoplatform menegon et al 2018c a web application providing msp oriented tools such as cumulative effects assessment cea marine use conflict analysis and a marine ecosystem services threat mes threat analysis the aim of this research is to present the gair which overcomes the traditional msp oriented geoportals functionalities i e data visualisation and sharing with data analysis modules and a novel instrument to facilitate data preparation and the engagement with data providers in detail the core features of the gair are the seven geospatial tools namely 1 cumulative effects assessment cea 2 maritime use conflicts muc 3 particle tracking module partrac 4 aquaculture zoning assessment aza 5 coastal oil spill vulnerability assessment oilspill 6 small scale fishery footprint ssf and 7 medium scale fishery footprint combined with cea module msf cea and an additional module named msp knowledge catalogue mspkc to support data inventory and preparation this manuscript is structured as follows firstly we present the gair s software architecture and its technological stack then we provide an overview of the datasets and modules and present a workflow on how to use the gair for a case study on cea in the emilia romagna region northern adriatic sea we discuss the importance of the gair for the msp process in the air and conclude with an analysis of its future development needs and challenges 2 methods 2 1 overall architecture of the gair the gair is a common platform for co production of knowledge in coastal and marine areas mainly focused on supporting msp and based on an integrated combination of web tools helping collaborative management processes and geospatial analysis the need to integrate and further develop existing repositories portals and tools aiming at efficiently organising and making accessible through a single virtual space most of the available knowledge and resources thus supporting coordinated regionally transnationally coherent and transparent decision making processes has emerged within previous eu projects and initiatives european commission 2016 within the portodimare project portodimare partnership 2020 the previous experiences have received a further impulse and a full operational gair has been developed and implemented to support a transnational cooperation network for the implementation of the protocol for the integrated coastal zone management iczm and the directive 2014 89 eu maritime spatial planning directive mspd in the air as a concrete instrument for the implementation of the eusair action plan the overall architecture of the gair is presented in fig 1 the scheme underlines the interaction with external applications and potential end users as well it depicts as a whole a knowledge co production system of software users and web services for supporting the msp processes five hierarchical levels of user profiles have been implemented in order to balance the trade off between the need of knowledge co production and users engagement and the need to guarantee an appropriate level in the resources and information quality general public unregistered users registered users e g citizen stakeholders scientists policy makers and planners advanced users e g pps and invited policy makers and planners specific scientific networks managers editors administrators many gair contents and resources e g public layers maps documents and case studies are publicly available to unregistered users in order to upload and create new resources or perform module analyses users have to be registered and authenticated into the platform the registration is open to everyone however it is subjected to approval by the administrators to prevent registration of spam users in annex 1 of the supplementary material we provide a detailed description of the gair user profiles the main functionalities of the gair include data sharing among users e g geospatial datasets documents maps collections of layers creation and sharing performance of analyses through seven different decision support modules and results sharing through the platform the gair has been designed following a service oriented architecture that includes three main abstract layers fig 1 1 the graphical user interfaces guis which are accessible through html5 based web browsers including mobile browsers allowing end users to intuitively and interactively visualise and operate e g search explore manage with local and remote resources e g geospatial layers maps 2 the access layer which exposes interoperable services and restfull api and acts as a middleware between the guis layer and the resource layer below wrapping access to local resources it also constitutes a single and common point for accessing and managing resources by machine to machine communications third party data repositories or by desktop applications e g qgis 3 the resource layer which deals with storing maintaining and low level controlling the access to different heterogeneous resources such as geospatial datasets metadata documents module configurations case study setups 2 1 1 graphical user interfaces the three main gui components are the geo cms gui the case study and modules gui and the geodatabuilder gui see fig 1 the geo cms gui provides content management system cms functionalities to manage upload create and modify geospatial resources e g layers layer styles maps particularly it includes a search gui which combines free text search faceted navigation and a preview of the filtered results to search over the different gair content types geospatial layers maps generic files and documents and archived model outputs see fig 2 a gui to upload and publish new geospatial datasets and documents including graphical controls to customise the layer styles and to manage permissions in a granular manner e g visualising downloading changing and a map viewer and composer to create and share interactive e g navigating querying multi layered web map applications the case studies and modules gui implements the workflow for the case study driven approach menegon et al 2018b 2018c where the users can perform a module analysis including cea cumulative effects assessment muc maritime use conflicts analysis partrac particle tracking module aza aquaculture zoning assessment oilspill coastal oil spill vulnerability assessment ssf small scale fishery footprint module and msf cea module for medium scale fishery footprint and cea we refer to section 3 3 on model workflow for a detailed description of a case study module run using the cea module the geodatabuilder gui allows users to define new geospatial layer expressions through map algebra operators and functions for combining one or more layers already stored into the gair layer expressions may be used to automatically pre process new layers and use the result to customise the case studies and the module analysis an example of the geodatabuilder gui for creating a new layer expression is presented in fig 3 geodatabuilder supports base map algebra operations e g addition subtraction division multiplication rescaling e g to rescale a layer into the 0 1 interval log transformation and aggregations e g max min average in addition the geodatabuilder enables the user to pipeline the outputs of a module result with another module case study and therefore allowing a module to module integration as an example of integration we refer to the case study in section 4 2 7 2 1 2 access layer web services api the access layer is composed of the geospatial interoperable services and apis and the casestudies api see fig 1 the geospatial interoperable services and apis mainly implement the open geospatial consortium ogc open geospatial consortium inc 2021 web services for enabling the discoverability accessibility and usability of geographic information shared through the gair see supplementary material annex 2 and additional apis for securely uploading registering and publishing new geospatial layers or other generic resources e g documents such apis are also part of the synchronisation mechanism data sync between the mspkc and the gair which allows to ingest the data of the catalogue by the gair see fig 1 2 1 3 resource layer the resource layer consists of a combination of different storage solutions e g database management systems to support the heterogeneous data models and formats shared by the data managers and the end users and all the information needed to achieve a full operational infrastructure e g geospatial datasets documents metadata catalogue information user accounts and profiles case study configurations and model run parameters direct access to the resources is usually interdicted since the access is exclusively provided by the access layer external geospatial resources provided by third party data repositories e g emodnet copernicus are made available through the remote services application remote services allow users to register external services usually web map services osgeo 2010 information on external published layers are automatically retrieved and the layers are made available through the platform similarly to the raster and vector geospatial layers stored locally corti et al 2019 2 2 technological stack the technology stack is the combination of software products development frameworks and programming languages used to build and run a complete application avgeriou and zdun 2014 the gair adopts a free and open source foss technological stack combining and integrating several software packages fig 4 presents an overview of the software components used in the gair server and client implementations each element in the stack was carefully selected based on requirement fulfilment robustness and size of the software community e g number of developers and users quality of support e g public groups or forums addressing user queries regarding installation or other bugs quality of documentation and software licence the gair has been developed on top of the geonode platform benthall and gill 2010 corti et al 2019 geonode development team 2021 2022 a complete suite for collaborative managing geospatial data that provides a significant number of required functionalities providing geospatial content management system functionalities geonode facilitates the upload and management of geospatial datasets making them discoverable and available via standard open geospatial consortium ogc protocols and web mapping applications geonode provides high level guis for spatial data discovery uploading and managing e g setting up metadata and presentation form and for composing and viewing interactive maps geonode guis are built on top of bootstrap bootstrap team 2019 and angularjs google 2021 frameworks and mapstore2 geosolutions 2022 for the mapping applications a highly interoperable access layer based on geoserver geoserver development team 2022 and pycsw software packages pycsw development team 2022 provides access to stored resources through standardised interfaces especially ogc web service the resource layer is mainly implemented by postgresql the postgresql global development group 2022 postgis postgis development group 2022 and elasticsearch elastic nv 2021 for supporting full text searching overall geonode has been developed on the top of django django development team 2018 in annex 3 a summary of geonode and gair technological stack s software components is presented beside adopting the geonode tech stack the gair also leverages on additional foss libraries and frameworks such as jquery the jquery team 2021 for the casestudy and the geodatabuilder guis and the django rest framework encode oss ltd 2021 for the casestudies api see figs 1 and 4 tools4msp api provides the model engine for cea muc and patrac modules menegon 2021 finally an r language r core team 2022 separate stack has been adopted to implement the r based modules server that incorporates additional packages for dealing with geospatial data such as the raster package hijmans 2021 to manipulate and analyse gridded spatial data the mspkc is based on ckan comprehensive knowledge archive network web tool open knowledge international 2021 an open source software for managing organising metadating and publishing collections of datasets in addition the ckanext mspkc plugin menegon 2018 has been developed during the supreme project and included into the mskc implementation ckanext mspkc is a ckan extension which provides additional metadata fields to support an msp oriented resource categorization and description and facilitates the linkage and coupling with the gair the new extension introduces new metadata fields such as msp related topic categories and subcategories domain areas a spatially aware definition of marine areas e g sea names data portals a reference to well established repositories and data portals and validation level a descriptive classification of dataset robustness and official level 3 data collection and geospatial datasets implementing a shared knowledge framework about the coastal and marine system is an essential requisite for creating the case studies and feeding the decision support module analyses the inherent dynamic and collaborative nature of the gair facilitates the continuous improvement and refinement of collected datasets directly by the end users in total 509 geospatial datasets and associated metadata information are stored into the gair figure updated to march 2022 302 layers were initially imported from the mspkc see following section 4 1 while another 207 were later added into the gair by the project partners and the users fig 5 represents the grouping of the geospatial datasets according to topic category spatial scale and validation level the type of habitats includes the majority of layers 79 layers 16 followed by biological characteristics 53 layers 10 fishing 47 layers 9 and maritime transport 40 layers 8 in terms of spatial scale the majority of datasets are of regional scale 169 33 followed by the country level data 146 29 then followed by mediterranean sea basin and air level 82 16 the dataset validation level refers to the source of the dataset and distinguishes among official data providers such as competent authorities at different administrative levels including the european marine observation and data network emodnet while research data is retrieved from experimental models and research studies e g species distribution models spawning and recruitment grounds fishing effort estimations the dataset includes 328 65 official and 181 35 research layers it is to be noted that the official layers mostly refer to type of habitats 70 layers 15 while the research layers mostly refer to biological characteristics topic 44 layers 9 based on the domain area metadata field the spatial distribution of data availability in the air was calculated considering the number of layers related to different spatial scales see annex 4 hotspots of data availability occur in correspondence to portodimare case studies i e emilia romagna istria county slovenia montenegro and kephalonia island 4 modules and workflows 4 1 msp knowledge catalogue the aim of the msp knowledge catalogue mspkc is to overcome time consuming data preparation tasks during an msp data gathering process by providing a web based collaborative inventory and resource systematisation tool that facilitates the engagement with msp data providers the inventory includes spatial and non spatial information such as reports geo statistical datasets scientific publications policy briefs national msp supporting documentation and blue growth strategies the mspkc allows to improve the engagement of contributors avoiding data duplications and fostering a collaborative approach for the catalogue filling up and maintenance a screenshot of the mspkc home page is provided in annex 5 data gathering in mspkc was performed by 13 stakeholders including research institutes universities local and regional authorities across the air italy greece slovenia montenegro croatia bosnia herzegovina and was combined with data assimilated from other global eu national and regional geoportals such as emodnet human activities environmental marine information system emis shape atlas tools4msp data portal annex 6 the stakeholders engaged into the data gathering process introduced more than 1000 resources including geospatial datasets documents maps reports etc into the mspkc and categorised them into 26 msp oriented topics e g maritime boundaries biological characteristics aquaculture fishing each resource was described using dedicated metadata fields e g reference date owner provider licence accessibility annex 7 as a next step non relevant or duplicated resources were removed resulting in 994 resources see annex 5 a faceted search and identification was performed by stakeholders to prioritise the geospatial data to be used by the geospatial tools of the gair based on the following criteria i data quality and reliability ii geographic domain and iii data availability this resulted in the 302 high priority geospatial resources for the air that were imported into the gair 4 2 geospatial modules 4 2 1 module identification and importance within msp process the identification of the geospatial modules to be incorporated within the gair platform was based on a combination of different criteria i relevance of the tools to support the different stages of the msp processes especially in the context of the air region ii maximisation of project partners experience in developing dsts for marine management with particular reference to sector analysis of maritime activities and support to ecosystem based management iii technological feasibility in integrating the tool within the gair platform and iv ease of use for stakeholders of the air and for non expert gair user profiles see annex 1 although based on existing algorithms and tools developed by the partners under the portodimare project the modules were improved and adapted to the specific needs of iczm msp and to the need to achieve an harmonised approach among them one of the goals of such adaptation and harmonization is to support integration among the modules themselves for example by allowing the outputs of one module to be used directly as inputs by other modules e g the cea module can use the outputs of the aza and ssf msf modules as inputs module results integration can be performed using the geodatabuilder gui described in section 2 1 1 the relevance of the identified modules in supporting the different stages of an msp process is illustrated in detail in annex 8 the geospatial modules are mainly designed to support stage 2 gather data and define current ecological and socio economic conditions stage 3 identify issues constraints and future conditions and stage 5 evaluate alternative management actions however the aza module can also have a significant use for building future scenarios and developing alternative management actions stage 4 instead the mspkc and the gair core functionalities i e data management and sharing layers maps offer important support also to stage 1 define goals and objectives and stage 7 refine goals objectives and management actions 4 2 2 module description table 1 provides an overview of the geospatial modules available in the gair in terms of model input data and output data requirements module integration pattern and case studies application gair geospatial modules differ according to adopted programming languages python and r user interaction level and level of long term support perspective this variability has led to the design of two different module integration patterns api based integration and direct integration see fig 1 and table 1 the api based integration performs machine to machine communication with an external module tool web service this mode of integration was implemented for the maritime use conflicts muc module the cumulative effects assessment cea and the particle tracking module partrac in the direct integration mode the gair common api communicates and executes directly with the module engine this was implemented for the aquaculture zoning assessment tool aza the small scale fishery footprint ssf and the medium scale fishery footprint and cea module msf cea a third mode of operation implemented for the coastal oil spill vulnerability assessment oil spill does not require real time analysis and end users can explore query and consult pre processed layers and pre configured maps in table 1 and in the following sections a detailed overview of the seven geospatial modules available in the gair is provided along with their main aims and documentation sources in the supplementary material annexes 9 to 13 we provide screenshots exemplifying outputs for each module 4 2 3 muc maritime conflict analysis the muc is a geospatial instrument to identify sea areas where spatial conflicts occur between sea use pairs e g commercial fishery vs shipping the methodology of the instrument was based on the coexist project interaction in european coastal waters a roadmap to sustainable integration of aquaculture and fisheries coexist 2013 the instrument was widely tested using the tools4msp modelling framework menegon et al 2018c for further details on the methodology applied in the adriatic sea and northern adriatic we refer to menegon et al 2018b and farella et al 2021 4 2 4 cea cumulative effects assessment this module refers to the assessment and mapping of cumulative effects based on the tools4msp modelling framework menegon et al 2018a the module allows to assess the effects of single or multiple human activities on environmental components the cea was widely used across european seas namely adriatic sea farella et al 2020 2021 south eastern baltic sea depellegrin et al 2020 or north sea gusatu et al 2021 for further information on the methodological aspects we refer to menegon et al 2018a also section 4 2 7 exemplifies the application of the cea module through the gair 4 2 5 partrac module for particle conservative contaminants dispersion this module is a tool to evaluate the area of influence of a contaminant source the tool simulates the dispersion of lagrangian particles as a function of the hydrodynamic conditions simulated by the state of the art 3d shyfem oceanographic model bellafiore et al 2018 the hydrodynamic field transporting the particles is calculated as multi annual average by a finite element numerical model applied to the adriatic sea domain with higher resolution along the coast and including the main lagoons and rivers in the area ferrarin et al 2019 ribotti et al 2019 this module allows to assess the dispersion of particles released in the adriatic sea an advection diffusion modelling tool for lagrangian particles is proposed as a planning tool tuned to end users and stakeholders its outputs and derived variables can be customised and analysed based on the end user requests and can be used to evaluate events such as impacts of aquaculture larvae dispersion tracking of floating debris and microplastic point discharge and river plumes dispersion 4 2 6 aquaculture zoning assessment the aquaculture zoning assessment aza module implements a spatially explicit multi criteria methodology namely smce spatial multi criteria evaluation for identifying azas allocated zones for aquaculture fao 2012 i e marine areas where the development of aquaculture is prior to other uses sanchez jerez et al 2016 the smce applied for the aza module can be carried out following the framework developed in brigolin et al 2017 throughout three steps i criteria normalisation ii weight assignment to each criterion iii suitability index calculation radiarta et al 2008 all the criteria to run the aza module together with the weights and the constraints are available for the users in the portodimare geoportal for further details on the aza module application we refer to porporato et al 2020 4 2 7 oil spill coastal oil spill vulnerability assessment the module allows to represent in the form of a dynamic map the vulnerability to oil spills of environmental and socio economic coastal resources of the air the user can set the map to the area of interest activate one or more of the layers that summarise oil spill risk and visually compare with the score for the coastal vulnerability in the area average values for the 2 components of vulnerability layers in the map are automatically calculated the instrument was originally developed as an early warning system within the hazadr project lauro et al 2015 which aimed at strengthening the response capacity of the adriatic region against environmental and technological hazards due to collisions shipwrecking and spillage of oil and toxic material into the sea that could seriously pollute the marine environment and damage the socio economic activities of the sea and coastal communities the oil spill is based on a combined index comadex composed by 5 different parameters regarding the ship dimension and conditions according to the annex 7 of the paris mou vessel type gross tonnage year launched flag and register plus two values about the sea weather condition wind power by beaufort scale and waves height by douglas scale that can generate stress conditions on the ship structure the oil spill was embedded into the gair as dynamic layers to explore the registered oil spill risk during 2019 and vulnerability across the adriatic coastal areas for further methodological details we refer to hazadr 2015 4 2 8 ssf module for small scale fishery footprint and msf module for medium scale fishery footprint and cea cumulative effects assessment these modules provide the tools for visualising fishing pressure for small and medium scale coastal fisheries and combine the multi criteria decision analysis mcda and geospatial techniques to quantify the synergistic effect of influential components e g bathymetry distance from the coast chl a concentration fishing effort marine traffic activity vessel capacity of ports etc on defining fishing footprint the modules were built within the fprmcda r package by the hellenic centre for marine research hcmr for more information about the methodology associated with the fprmcda package please see kavadas et al 2015 the cea module integrates diverse pressures e g ssf msf outputs aquaculture shipping tourism infrastructures to assess the spatial distribution of impacts exerted by these pressures on the selected ecosystem components 4 2 9 case study cea module workflow for emilia romagna regions a typical user driven module workflow for the use of the cea is presented in fig 6 the aim of the case study is to perform this assessment by testing future aquaculture scenarios expansion of 100 sq km of new shellfish farms in the emilia romagna region after the selection of the cea module the user can choose among the available case studies for each tool a case study is a coherent and harmonised set of geospatial layers available at different spatial scales air national regional local testing site or case study levels see table 1 and resolutions that can be used for module running menegon et al 2018b in the case study selection fig 6a we select the emilia romagna region 5260 sq km located in the northern adriatic sea the input parameter setup includes the selection of the geospatial features of the case study area fig 6b this includes the grid resolution layer 42080 grid cells layer resolution 250 m 250 m that defines the spatial resolution of the input layers the human activities u n 16 relevant in the study area e g shipping fishery military areas and the environmental features e n 8 e g marine habitats turtles marine mammals the units of the spatial indicators u and e can be presence absence e g military areas weighted dummy e g land based activities and intensity indicators e g maritime traffic in addition a shellfish aquaculture scenario was performed with the aza module see annex 14 perini et al 2020b for detailed description and incorporated in the cea module considering a uniform distribution on areas with a high aquaculture suitability score suitability 0 75 intensity indicators were transformed using log x 1 to avoid an over dominance of extreme values and all datasets were rescaled from 0 to 1 in order to allow direct comparison on a single and unitless scale based on the selected layers the user can compile a matrix of sensitivity scores based on 15 pressures adapted from the msfd annex iii 2017 845 eu pressure weights and propagation distance fig 6c the pressure weights are scored from 0 to 1 and are a measure of importance of a certain use in contributing to a specific pressure while the distance refers to the area of influence of the pressure in km sensitivity scores can have values between 0 not sensitive and 1 highly sensitive and correspond to the susceptibility of the environmental component to the pressure exerted by a human activity menegon et al 2018a the outputs of the model are presented in fig 6d which includes geospatial results of cea distribution heatmaps representing cea score for each human use and environmental component and a bar plot representing the aggregated value of pressures by human use for the study area the server response time was approximately 5s considering the full case study analysis 42080 grid cells 25 geospatial layers 15 pressures combinations and a server having minimum hardware requirements of 16 gb and 2 2 ghz processor with 4 cores for further details on the module setup and data components we refer to perini et al 2020a the geospatial explicit results show that the highest cea scores 20 are located in offshore areas approximately 20 nm offshore in the north and in the south of the study area in coastal areas high cea scores are located in the whole case study area between 3 and 12 nm offshore in proximity to the ravenna port areas showing medium high scores 7 14 are largely distributed along the entire case study area mainly due to maritime traffic and trawling activities in the area the complex system of marine transportation is the most influential source of anthropogenic pressures such as the introduction of non indigenous species marine litter underwater noise and polluting substances and is impacting mainly essential fish habitats efh circalittoral fine mud eunis code a5 36 and marine turtles and mammals the full set of trawling activities reaches a total cea score higher than the one generated by maritime transport bottom otter trawlers mid water pelagic and rapido beam trawlers impact the area mainly by generating abrasion change in siltation smothering and both selective and non selective extraction of species land based activities pressures e g microbial pathogens marine litter and introduction of organic and inorganic substances strongly related to riverine inputs e g po river delta in the north have a significant influence on the overall cea score coastal and maritime tourism influences the coastal water only within the 2 nm being the source of a wide set of pressures e g marine litter underwater noise introduction of both organic and synthetic components the contribution to total cea of new shellfish farms future aquaculture scenarios is significant primarily at the local scale and for some areas e g between 3 and 6 nm in front of riccione the possible expansion of aquaculture may result in an overall decrease of the cea score because the presence of higher impact activities eg non compatible uses such as trawling must be reduced or eliminated another result of the module run is the cea heatmap fig 6d centred that calculates the cea scores by pairwise percentage contribution by environmental receptor human activity respectively marine litter and pressures related to trawling fisheries mainly seafloor abrasion changes in siltation and extraction of species are the pressures determining the highest contribution to the cea score the most affected environmental components are the species of high conservation interest especially marine turtles efhs and sandy muddy seabeds mainly circalittoral fine muds the bar plot in fig 6d right quantifies the contribution of each pressure to the total cea score selective extraction abrasion and marine litter are the human uses generating the highest pressure with 12 and 11 respectively 5 discussion 5 1 relevance of the gair for the adriatic ionian region the gair supports all the four pillars of the european union strategy for the adriatic and ionian region pillar 1 on blue growth pillar 2 on transport and energy pillar 3 on environmental quality pillar 4 on sustainable tourism the geoportal allows ecosystem based investigation of the ecological resources of the air and analyses how current coastal and maritime activities may trigger adverse effects on the marine environmental status which is one of the priorities of eusair pillar 3 this is ensured by the cumulative effects assessment tool which is widely used for ecosystem based management of the marine environment across the globe clarke murray et al 2015 griffiths et al 2020 hammar et al 2020 and which is implemented in the geoportal through the tools4msp application programming environment api menegon et al 2018a decision makers and planners can use the tool to define planning strategies aimed at mitigating the anthropogenic impacts coming from multiple stressors such as underwater noise marine litter and abrasion the geoportal can substantially contribute also to eusair pillar 1 blue growth european commission 2014 the geoportal implements a set of sectoral tools such as the aquaculture zoning assessment aza module which enables the analysis of mussel aquaculture siting in line with global trends also in the mediterranean 62 of fish food will be produced by aquaculture in 2030 world bank 2013 and therefore the need for instruments that can support planners in the identification of the most suitable areas for this activity by balancing the demands for ecological protection with socio economic needs will be required the msp directive 2014 89 eu requires coastal eu member states to establish maritime spatial plans by 2021 the geoportal provides a full suite of data and tools that can support the national msp in air countries in a transboundary cooperation framework according to art 11 and art 12 of the msp directive in particular the geoportal provides a set of tools to organise the sea uses reduce conflicts and investigate environmental human interactions to promote a sustainable development of coastal economies the emilia romagna region proposal within the italian msp process presidente della repubblica 2016 for the adriatic sea has been strongly supported by cea results within the gair workflow perini et al 2020b resolution of the emilia romagna regional council n 277 of 01 03 2021 the regional focus given to the cea analysis highlights the potential threats to species habitats and ecosystems generated by multi sector human activities in the regional coastal and marine space in order to inform the planning process on the present propagation of pressures and to assess the spatial distribution of impacts on one or multiple environmental receptors through the gair the cea operational tool has been made accessible through a graphical user friendly interface available also for a wider non technical audience such as decision makers practitioners blue economy sectors and civil society the proposed cea methodology and analysis for the emilia romagna region constituted a fundamental knowledge base for the regional msp pilot plan one of the earliest msp pilot plans of the italian sea space barbanti et al 2018 which lead to the definition of management measures in accordance with the areas of major impact and identifying the typology of sea uses responsible for those impacts for further details on the pilot plan and its planning measures we refer to barbanti et al 2018 and farella et al 2020 5 2 limitations and future developments of the gair the gair presents a series of limitations that can be the object of future development and improvement user interaction needs to be improved e g by enhancing the presentation of textual and graphical contents within the modules pages simplifying the management of all input parameters allowing case studies to be created from scratch and especially the geodata builder that is used for the creation of new input layers and to effectively connect the geospatial modules i e incorporating the output of a module as an input of another module the mechanism of data synchronisation data sync between the mspkc and the gair needs to be more robust through specific validators for uploaded or referenced user datasets this could be ideally tackled by using error handling protocols as presented in the emilia romagna case study the modules were designed to be mutually integrated mainly adopting a common grid based approach for geospatial analysis and thorough systematic usage of the geodatabuilder but this integration is not fully automated because users still have to download the output of the previous module and manually upload it as new layer into the geoportal only after that can the layer be used for example as a new input for cea the performance of modules requires further improvement in terms of reduction of computational time this is especially the case for computationally intensive modules such as partrac for particle dispersion modelling the gair is currently lacking a logical structure for defining the relevant layers to be used into the different modules in the future a fuzzy matching procedure will be tested to ease the identification of relevant layers to be used in the reference module and case study the modules would benefit from asynchronous module runs to ensure more efficient user interactions and optimise the model run time the modular architecture of the gair will easily allow adding other modules by using the api technology and sharing the same input data model at the current stage the software of the gair has a long term development perspective through ongoing and future international and national research projects such as remap reviewing and evaluating the monitoring and assessment of maritime spatial planning emfaf 2022 2025 msp4bio improved science based maritime spatial planning to safeguard and restore biodiversity in a coherent european mpa network h2020 2022 2025 and the msp4biodiversity biodiversity mainstreaming in maritime spatial planning next generation eu to establish the national biodiversity future center 2023 2025 the project initiatives will further support the technological development of the gair through extension of tools incorporation of new datasets application in study areas outside the air e g western mediterranean and black sea and bug fixing 6 conclusions the gair showcases to be a versatile instrument to support the development and implementation of the planning and management strategies in the air at regional national and transboundary level indeed its open and easy to use nature allows different users also non technical experts to access and operatively exploit the provided services and the available data thus making the gair a useful tool for public administrations scientific and research bodies as well as the civil society and facilitates the engagement of data producers being conceived and developed by a transnational network of research institutes and public administrative bodies the gair possesses a shared and transnational character thus representing a collector of data and information coming from different sources and levels from the scientific community research and monitoring activities to the public administrations repositories and is linked to different available thematic portals this characteristic is of high relevance since it ensures a populated data portal thanks to data sharing practices at transnational level set up in the framework of the supreme and portodimare projects the geoportal becomes an instrument able to favour a knowledge building process by engaging multiple stakeholders and strengthening the science policy dialogue furthermore the gair is expected to be a regularly maintained and validated source of knowledge and data for msp with data systematically controlled filtered and harmonised to ensure reliable and useable products the mspkc provides mechanisms to engage the data providers who can collaborate in the inventorying screening and prioritisation of data sources that compose the knowledge base of the gair and the analysis in the available case studies the gair provides a set of tools and services that can be used in an msp context the tools are already fed by a variety of spatial data in an effective and shared environment where these services and the derived products can be integrated between each other to provide information relevant for the management both sectoral and multi sectoral issues can be addressed thanks to the potential of adopting an integrated holistic approach where one module can provide information useful to feed the application of a second module e g aza partrac ssf towards cea and muc as such the modules offered by the gair can be customised and applied to satisfy the information needs and management issues depending on the context while the gair was developed to serve msp in the air the application of its modules is flexible for other geographic regions and scalable at different resolutions local to sea basin level for example the cea module has been tested in the north sea gusatu et al 2021 in the context of offshore wind energy scenarios for 2050 in the lithuanian baltic sea depellegrin et al 2020 in the context of marine ecosystem services threat analysis as well as for transboundary cea in the strait of sicily malta farella et al 2019 also the muc module was applied outside the air in an msp data stocktake in bangladesh roy et al 2022 for the identification of conflicts with nature protection and in the strait of sicily malta farella et al 2019 and the patrac module based on the shyfem hydrodynamic model was applied in the mediterranean sea basin and danube delta black sea shyfem 2022 shyfem development team 2022 the key advantage in these applications is the case study driven approach that can be applied with adequate data to any geographic area of the globe in addition the gair as an open source platform for multi user knowledge co production can be easily reused to support the development of maritime spatial plans from sub national to transboundary marine waters in the european seas and beyond beyond the provisioning of spatial and quantitative data the gair also provides information on the main existing strategies and legislative instruments that act at the air basin scale and allows the countries to be informed on the state of implementation of the management and spatial plans and the adopted approaches of their neighbours thus the gair acquires an added value since it acts as a communication and sharing platform among the air countries supporting the transnational coordination that is required by the msp directive because it is recognized as a fundamental enabling factor for the achievement of an effective and sustainable use of marine and coastal resources indeed the geoportal ensures the transfer the implementation and re use of the outputs obtained by applying the provided modules software availability name of software and products geoportal of the adriatic ionian region gair portodimare geonode project designers national research council of italy institute of marine sciences cnr ismar venice developers emilia romagna region directorate general for territory and environment protection bologna national research council of italy institute of marine sciences cnr ismar venice maintenance emilia romagna region department directorate general for territory and environment protection national research council of italy institute of marine sciences cnr ismar venice year first available 2020 hardware required web server 16 gb or more 2 2 ghz processor with 4 cores additional processing power may be required for multiple concurrent styling renderings a baseline of 50 gb 100 gb for production deployment additional disk space could be necessary according to specific needs especially in relation with the number and size of spatial data 64 bit hardware is strongly recommended see the geonode quick installation guide 2021 for additional information software required web server geonode 2 10 r server docker engine and docker compose optionally software required client users all modern internet browsers e g google chrome mozilla firefox microsoft edge apple safari including mobile versions software availability gair https github com regioneer portodimare gair data availability gair https www portodimare eu software licence gnu agpl v3 0 user documentation https www portodimare eu static docs program language python backend javascript react redux frontend program size 100 mb implementation official implementation for supporting maritime spatial planning into the adriatic ionian region has been released within the interreg adrion portodimare project https www portodimare eu declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work was supported by the project portodimare geoportal of tools data for sustainable management of coastal and marine environment adrion 205 european union appendix a supplementary data the following is the supplementary data to this article multimedia component 1 multimedia component 1 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j envsoft 2022 105585 
25459,postwrf is an open source software toolkit to facilitate the main visualization tasks and data handling for the wrf model outputs the toolkit is mostly written in ncl and shell with a namelist that resembles the wrf or wps namelists besides the visualizations postwrf provides wrf netcdf to geotiff conversion for gis applications era5 netcdf reanalysis data plotting and extraction and preparation and plotting of the rttov model inputs from wrf and outputs the primary purpose of postwrf is to benefit the environmental researchers both experienced and inexperienced to make use of the wrf model simulations in a straightforward and efficient way without dealing with coding and syntax errors since the wrf model simulates most aspects of a full atmospheric model in the regional scale the toolkit can also be used as an educational aid in meteorological and environmental science postwrf is freely available on github https github com anikfal postwrf provided with html documentations https postwrf readthedocs io en master and guided examples graphical abstract keywords wrf visualization data handling era5 rttov data availability https github com anikfal postwrf 1 introduction scientific visualization and computer graphics are closely interconnected with atmospheric and environmental science brodlie et al 2012 when it comes to atmospheric science there are several challenges in data visualization such as efficient data manipulation and interactive data visualization helbig et al 2017 rautenhaus et al 2017 interactive visual analysis in which the user has control in the way the software generates the results limet et al 2014 is among the most remarkable of a software s capabilities interactive visualization software is commonly applicable to case study research rather than operational weather forecasting over the last decades several software tools have been developed to advance the understanding of weather and better interpretation of the atmospheric models results for example in order to specify outliers in ensemble forecast systems based on the wrf model an interactive tool called noodles has been designed to visualize the ensemble uncertainty of some primary atmospheric variables sanyal et al 2010 gis systems are also considerably employed in climate data visualization using c a suite of gis based tools meteoinfo has been developed for the visualization and analysis of geo scientific data formats such as netcdf and grib wang 2014 in another research chang 2017 cloud computing and optimization techniques have been used to simulate temperature distributions and investigate extreme weather data for most of environmental numerical models particularly regional atmospheric models netcdf data format fulker 1991 rew and davis 1997 is the primary interface for the model inputs and outputs however in case of atmospheric numerical models e g wrf skamarock et al 2019 gfs national centers for environmental prediction et al 2015 and era5 hersbach et al 2020 grib data format hübbe et al 2013 has a key role implementation of netcdf libraries in the regional environmental atmospheric models has major advantages such as improving the accessibility analysis and display of data furthermore netcdf provides reusability of the software and self describing files which could be analyzed and displayed in conjunction with other data formats such as hdf rew and davis 1990 the grid analysis and display system grads doty and kinter 1995 netcdf operators nco zender 2008 and ncar command language ncl brown et al 2012 are among the most widely used unix based software programs in manipulating and analysis of the netcdf data format along with the common features to modern programming languages such as functions and procedures loops and conditional statements ncl has special features for the manipulation of metadata complex visualizations handling a wide variety of data formats and supporting array operations brown et al 2012 the capability to retrieve linux environmental variables is an essential feature of ncl which makes it possible to collaborate with the linux environment through the command line user interface shell and hence the development of automated procedures postwrf as a specialized post processing suite for the wrf model outputs provides a straightforward accurate and efficient way in the visualizations of the wrf netcdf files a wide range of environmental researchers both experienced and inexperienced can make use of the postwrf software to handle various post processing tasks in a quick way similar to the method they run the wrf model by modifying a namelist without dealing with programming in this article the capabilities and main features of postwrf are discussed and demonstrated in forms of maps diagrams and tables postwrf is also provided by detailed documentations which are available on the internet 2 methods 2 1 wrf model the weather research and forecasting wrf model is an advanced numerical weather prediction system for regional atmospheric simulations with a worldwide community of users developing a specialized tool as a software or toolkit component for the post processing of the wrf netcdf files can make it possible to carry out the primary data analyses and visualizations without an advanced knowledge in wrf structure or the programming languages the wrf model is provided with several physics and dynamics options dudhia 2014 which could be combined in various ways examining the sensitivity of different physics options in the wrf model is a frequent research topic in the field of atmospheric numerical modeling kala et al 2015 santos alamillos et al 2013 hence wrf visualizations and postprocessing make a major contribution to many research projects particularly those concerning sensitivity analysis pianosi et al 2016 the wrf model is extensively used in environmental studies multiple atmospheric physics and dynamics schemes which could be configured in different ways are available in the wrf model it is a common practice in many research articles to combine wrf modeling schemes to reach the best configuration and model results wrf simulations of precipitation and rainfall have been carried out in different geographical regions with regard to several factors such as microphysics parameterization schemes karki et al 2018 horizontal grid spacing rai et al 2019 and downscaling skill ekström 2016 one of the essential features of the wrf model is its capability to be coupled with other environmental models such as wrf chem powers et al 2017 and wrf hydro gochis et al 2018 with particular applications in air pollution zhou et al 2017 shahbazi et al 2018 and hydrological modeling lin et al 2018 silver et al 2017 2 2 era5 reanalysis data era5 hersbach et al 2020 is the fifth generation ecmwf molteni et al 1996 atmospheric reanalysis of the global climate covering produced by the copernicus climate change service c3s at ecmwf era5 data has a horizontal spatial resolution of 30 km with 137 vertical levels from surface to a height of 80 km the data are available on several atmospheric levels such as single levels pressure levels potential temperature levels and etc the era5 reanalysis model data have extensive applications in atmospheric and environmental studies one of the main applications of these data is for the initialization of atmospheric regional models particularly the wrf model liu et al 2021 since the era5 data are available for the last decades climatology of atmospheric variables is another major applications of such data lolis et al 2022 the era5 pressure and surface level data are also extensively used in making atmospheric plots and synoptic analysis bagaglini et al 2021 2 3 rttov model rttov radiative transfer for tovs saunders et al 2018 is a fast one dimensional radiative transfer model for simulating top of atmosphere visible infrared ir and microwave radiances observed by downward viewing space borne passive sensors hocking et al 2021 rttov can be used as a tool for data assimilation in numerical weather prediction and producing simulated imagery from nwp models rttov can also be used to simulate top of atmosphere radiances for evaluating climate models turner and tett 2014 the rttov optical depth calculation is a parameterization which requires precomputed regression coefficients for each instrument and are stored in coefficient files which must be called in each model run hocking et al 2011 rttov requires atmospheric and surface variables as input data which can be obtained from atmospheric models rttov simulations can be applied on each wrf model grids to estimate optical depth for a specific satellite sensor the pressure temperature and water vapor on each level besides surface pressure and skin temperature are mandatory inputs rttov can also simulate the scattering properties of aerosols and clouds if their concentrations on different atmospheric levels are given marquis et al 2021 2 4 software structure postwrf is an open source software toolkit written mainly in ncar command language ncl and linux shell script a namelist file namelist wrf which resembles the wrf s namelist input or wps s namelist wps acts as the linkage between the user and the software therefore the way postwrf is run is similar to running wrf or wps most of the requirements such as atmospheric variables and pressure levels table 1 which are necessary to run the toolkit can be specified in namelist wrf by the user some additional inputs such as contour color patterns or output file formats are not in namelist wrf and must be specified by the user during the run time reading the variables in namelist wrf as well as requesting the additional input data are carried out by the shell scripts any scientific software tool has one or more programming languages as their building blocks for example in the qgis software qgis development team 2021 python functions play a significant role in raster and vector processing ncl in postwrf plays a similar role as python in qgis postwrf s user can specify single variables or polynomials of variables to be processed by the software variable names in namelist wrf associated with wrf can be determined either as those ones directly simulated by wrf and available in its output or as diagnostics e g vorticity or relative humidity which are not stored in the wrf output but can be calculated the user can display the names of possible diagnostics about 40 variables that can be calculated by the software the specialized ncl functions for wrf are used to calculate the diagnostic meteorological variables polynomials of the wrf output variables diagnostics in postwrf can be made by six mathematical operations including the four basic operations addition subtraction multiplication and division exponentiation and parentheses fig 1 shows the run process of postwrf two standard netcdf format of the wrf and era5 data can be processed by the software this issue must be noticed especially for the era5 data since era5 is originally based on grib format it must be downloaded as netcdf data to be processed by postwrf overall the users do not need to deal with data formats since both wrf and era5 data have standard output format 3 results software capabilities some arbitrary wrf output files have been chosen as test cases since the structure of the wrf netcdf output files are the same it would make no difference if the test cases were the output of wrf wrf chem or any other coupled modeling system based on the wrf model postwrf does not require any special compilation since postwrf is a linux based tool all of its components including bash ncl and gdal are freely available as open source software packages and can be simply installed by the linux package manager however ncl source codes are available on https www ncl ucar edu download index shtml before running the software one or multiple wrf netcdf output files must be linked or copied on the main directory of postwrf the namelist must be modified to enable and set the parameters associated with the desired post processing task the generated plots can be saved as pdf png or animated gif needs imagemagick the imagemagick development team 2021 to be installed postwrf has been developed to provide a practical software toolkit to carry out the most frequently used tasks in the postprocessing of the wrf model outputs the software s capabilities are divided into 9 sections in namelist wrf such as horizontal and vertical contour plots data extraction and statistical diagrams all of these capabilities can be classified into two primary groups visualization and data handling 3 1 visualization in this section all of the capabilities which can be used to make plots and diagrams are discussed besides the wrf model outputs some of the visualizations are being plotted using other data sources such as observations or rttov model outputs 3 1 1 contour plots wrf and era5 horizontal contour plots and vertical cross sections are necessary for evaluating almost all of the numerical weather simulations plotting the wrf geographical domains can be carried out in 2 ways by a separate section in namelist wrf for contour plots of the atmospheric variabls the user can specify up to 3 groups of variables polynomials of variables from a wrf output to be overlaid on the same plot in case of 3 overlaid variables one of them can be plotted as shaded contours while the other 2 remaining variables can plotted as line contours for the horizontal contour plots some other elements such as wind vectors point markers geographical locations and shapefiles can also be overlaid on plots several main features can be set in namelist wrf table 1 such as atmospheric pressure levels for each variables colors and thicknesses of line contours as well as intervals between them reference magnitude of wind vectors as well as their density and other key features that are mostly used and required for a sophisticated visualization fig 2 a shows blue shaded contours of 2 m dew point temperature as a diagnostic variable overlaid with red line contours of temperature at 700 hpa and wind vectors at 300 hpa fig 2 b shows three variables water vapor mixing ratio as shaded and temperature and wind speed as line contours overlaid on the same cross section plot from a wrf chem netcdf output file a small subplot can also be overlaid on top of the main plot representing the path of the cross section line which is over the west coast of northern america for this case 3 1 2 diagrams wind rose and skew t diagrams with separate sections in namelist wrf can be plotted for specific locations inside the wrf domain several statistical diagrams including time series and scatter plots can be set in namelist wrf to be plotted by postwrf fig 3 b shows the taylor diagram for 2 m temperature over specific locations taylor diagrams as well as scatter plots needs measurement data e g openweather weather api openweathermap 2012 as a data provider statistical diagrams are not specific to wrf outputs and can be plotted for any pairs of simulation and measurement data the data files must conform with a particular format that can be generated by the extract section of postwrf fig 3 a shows the vertical profiles of potential vorticity for 3 locations on a specific time slot 2016 10 01 03 00 additional examples for meteorological diagrams are available on https postwrf readthedocs io en latest 3 1 3 rttov outputs rttov simulations using the atmospheric inputs extracted on each wrf grid points are saved as ascii files the optical variables including the brightness temperature and radiance can be read from the rttov output file and plotted by postwrf the formats of the plot can be selected as netcdf or png for a single band or an rgb image for 3 bands since plotting the rttov outputs needs to convert their ascii files to netcdf this process can also be classified as data conversion and could be included in the next section since postwrf reads the coordinates of the wrf grid points rttov outputs must be generated by the input data extracted by postwrf itself otherwise postwrf cannot convert the rttov output to netcdf or other image formats fig 4 shows the simulated brightness temperatures for msg2 seviri sensor channels 8 7 and 12 0 μ m over central europe on a specific time 2021 07 07 13 00 postwrf can also convert rttov outputs using input data from wrf for three different satellite channels to rgb images 3 2 data handling postwrf can carry out several data handling tasks for the wrf output files these tasks are mainly data extraction and data conversion the user can convert the wrf netcdf output format to geotiff data conversion can also be applied on the rttov model outputs from ascii file format to another more easy to use file formats eg netcdf 3 2 1 data extraction in a separate section data extraction in namelist wrf postwrf extracts atmospheric variables over specified locations by pairs of latitudes and longitudes if the variable has bottom top dimension the lowest layer will be extracted the user can extract a variable s values on all model pressure levels by plotting its vertical profiles fig 3 a at specific points table 2 shows the values of 2 m relative humidity extracted from 3 locations of los angeles la san francisco sf and las vegas lv from an arbitrary wrf output 3 2 2 conversion to geotiff since wrf files do not conform to the netcdf cf convention eaton et al 2003 it is a challenge for gis analysts to work with the wrf outputs in their gis software there is a specialized plugin meyer and riechert 2019 provided for the qgis software which is capable of reading and post processing wrf netcdf outputs however by using the gdal gdal ogr contributors 2021 tool postwrf can convert a polynomial of atmospheric variables on specific pressure levels from the wrf netcdf outputs to geotiff file format as a standard raster data for each time slot for the wrf output variable a separate geotiff file is generated by postwrf 3 2 3 rttov inputs rttov model requires input atmospheric surface variables some of these data are mandatory to run the model such as atmospheric temperature and water vapor on pressure levels surface pressure and skin temperature are other mandatory data postwrf extracts the required input data for example fwd f90 example program input data for the other example programs as well as user defined rttov applications are almost similar to those of example fwd f90 however advanced users can modify the postwrf codes to generate their preferred input data table 3 shows the beginning lines of the rttov input data extracted from the grid points of an arbitrary wrf netcdf output file the extractions are carried out for all of the grid points which are 32041 179 west east 179 south north points for this sample wrf output file moreover postwrf can also extract the vertical profiles of dust concentrations from the wrf chem output files which are required in the simulation of aerosol effects by the rttov model 4 discussion and conclusions apart from the postwrf s aforementioned tools some other capabilities such as plotting skew t and wind rose diagrams as well as wrf model domains are available in separate sections in namelist wrf furthermore some additional features could be activated in the last section general settings of namelist wrf to provide extra capabilities such as average and panel plots multiple wrf outputs for the same simulation can be selected in postwrf making all times in each output to be appended to form a single output which is particularly useful for average plots since postwrf is independent of a parent software platform e g a gis software it is capable to be developed in an unlimited way with other open source data analysis tools such as nco moreover advanced users can easily modify postwrf s codes and add their own desired capabilities to the software the wrf model as a major regional atmospheric model covers a wide spectrum of applications in environmental science considering that not all environmental scientists are expert in atmospheric modeling and numerical analysis postwrf can act as a bridge between atmospheric modeling and environmental science making it possible for many researchers to directly carry out the main post processing tasks for the wrf model outputs and analyze the results without any advanced knowledge in programming and wrf modeling system however it should be mentioned that postwrf is a toolkit for both experienced and inexperienced scholars postwrf as a multidisciplinary toolkit which deals with wrf and rttov models provides applications in numerical modeling as well as remote sensing however as an interactive software besides in research activities it also has applications in meteorological education since the wrf model carries out an almost complete numerical simulation of the atmosphere in regional scales a sample wrf output file for a specific geographical domain can be efficiently explored by postwrf illustrating a wide spectrum of atmospheric variables in forms of plots diagrams and numerical values software availability software name postwrf developer amir h nikfal email ah nikfal gmail com year first available 2018 hardware required linux preferably fedora based main software required ncl bash additional software required gdal imagemagick python program size 1 mb license mit repository https github com anikfal postwrf documentations https postwrf readthedocs io en master declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper 
25459,postwrf is an open source software toolkit to facilitate the main visualization tasks and data handling for the wrf model outputs the toolkit is mostly written in ncl and shell with a namelist that resembles the wrf or wps namelists besides the visualizations postwrf provides wrf netcdf to geotiff conversion for gis applications era5 netcdf reanalysis data plotting and extraction and preparation and plotting of the rttov model inputs from wrf and outputs the primary purpose of postwrf is to benefit the environmental researchers both experienced and inexperienced to make use of the wrf model simulations in a straightforward and efficient way without dealing with coding and syntax errors since the wrf model simulates most aspects of a full atmospheric model in the regional scale the toolkit can also be used as an educational aid in meteorological and environmental science postwrf is freely available on github https github com anikfal postwrf provided with html documentations https postwrf readthedocs io en master and guided examples graphical abstract keywords wrf visualization data handling era5 rttov data availability https github com anikfal postwrf 1 introduction scientific visualization and computer graphics are closely interconnected with atmospheric and environmental science brodlie et al 2012 when it comes to atmospheric science there are several challenges in data visualization such as efficient data manipulation and interactive data visualization helbig et al 2017 rautenhaus et al 2017 interactive visual analysis in which the user has control in the way the software generates the results limet et al 2014 is among the most remarkable of a software s capabilities interactive visualization software is commonly applicable to case study research rather than operational weather forecasting over the last decades several software tools have been developed to advance the understanding of weather and better interpretation of the atmospheric models results for example in order to specify outliers in ensemble forecast systems based on the wrf model an interactive tool called noodles has been designed to visualize the ensemble uncertainty of some primary atmospheric variables sanyal et al 2010 gis systems are also considerably employed in climate data visualization using c a suite of gis based tools meteoinfo has been developed for the visualization and analysis of geo scientific data formats such as netcdf and grib wang 2014 in another research chang 2017 cloud computing and optimization techniques have been used to simulate temperature distributions and investigate extreme weather data for most of environmental numerical models particularly regional atmospheric models netcdf data format fulker 1991 rew and davis 1997 is the primary interface for the model inputs and outputs however in case of atmospheric numerical models e g wrf skamarock et al 2019 gfs national centers for environmental prediction et al 2015 and era5 hersbach et al 2020 grib data format hübbe et al 2013 has a key role implementation of netcdf libraries in the regional environmental atmospheric models has major advantages such as improving the accessibility analysis and display of data furthermore netcdf provides reusability of the software and self describing files which could be analyzed and displayed in conjunction with other data formats such as hdf rew and davis 1990 the grid analysis and display system grads doty and kinter 1995 netcdf operators nco zender 2008 and ncar command language ncl brown et al 2012 are among the most widely used unix based software programs in manipulating and analysis of the netcdf data format along with the common features to modern programming languages such as functions and procedures loops and conditional statements ncl has special features for the manipulation of metadata complex visualizations handling a wide variety of data formats and supporting array operations brown et al 2012 the capability to retrieve linux environmental variables is an essential feature of ncl which makes it possible to collaborate with the linux environment through the command line user interface shell and hence the development of automated procedures postwrf as a specialized post processing suite for the wrf model outputs provides a straightforward accurate and efficient way in the visualizations of the wrf netcdf files a wide range of environmental researchers both experienced and inexperienced can make use of the postwrf software to handle various post processing tasks in a quick way similar to the method they run the wrf model by modifying a namelist without dealing with programming in this article the capabilities and main features of postwrf are discussed and demonstrated in forms of maps diagrams and tables postwrf is also provided by detailed documentations which are available on the internet 2 methods 2 1 wrf model the weather research and forecasting wrf model is an advanced numerical weather prediction system for regional atmospheric simulations with a worldwide community of users developing a specialized tool as a software or toolkit component for the post processing of the wrf netcdf files can make it possible to carry out the primary data analyses and visualizations without an advanced knowledge in wrf structure or the programming languages the wrf model is provided with several physics and dynamics options dudhia 2014 which could be combined in various ways examining the sensitivity of different physics options in the wrf model is a frequent research topic in the field of atmospheric numerical modeling kala et al 2015 santos alamillos et al 2013 hence wrf visualizations and postprocessing make a major contribution to many research projects particularly those concerning sensitivity analysis pianosi et al 2016 the wrf model is extensively used in environmental studies multiple atmospheric physics and dynamics schemes which could be configured in different ways are available in the wrf model it is a common practice in many research articles to combine wrf modeling schemes to reach the best configuration and model results wrf simulations of precipitation and rainfall have been carried out in different geographical regions with regard to several factors such as microphysics parameterization schemes karki et al 2018 horizontal grid spacing rai et al 2019 and downscaling skill ekström 2016 one of the essential features of the wrf model is its capability to be coupled with other environmental models such as wrf chem powers et al 2017 and wrf hydro gochis et al 2018 with particular applications in air pollution zhou et al 2017 shahbazi et al 2018 and hydrological modeling lin et al 2018 silver et al 2017 2 2 era5 reanalysis data era5 hersbach et al 2020 is the fifth generation ecmwf molteni et al 1996 atmospheric reanalysis of the global climate covering produced by the copernicus climate change service c3s at ecmwf era5 data has a horizontal spatial resolution of 30 km with 137 vertical levels from surface to a height of 80 km the data are available on several atmospheric levels such as single levels pressure levels potential temperature levels and etc the era5 reanalysis model data have extensive applications in atmospheric and environmental studies one of the main applications of these data is for the initialization of atmospheric regional models particularly the wrf model liu et al 2021 since the era5 data are available for the last decades climatology of atmospheric variables is another major applications of such data lolis et al 2022 the era5 pressure and surface level data are also extensively used in making atmospheric plots and synoptic analysis bagaglini et al 2021 2 3 rttov model rttov radiative transfer for tovs saunders et al 2018 is a fast one dimensional radiative transfer model for simulating top of atmosphere visible infrared ir and microwave radiances observed by downward viewing space borne passive sensors hocking et al 2021 rttov can be used as a tool for data assimilation in numerical weather prediction and producing simulated imagery from nwp models rttov can also be used to simulate top of atmosphere radiances for evaluating climate models turner and tett 2014 the rttov optical depth calculation is a parameterization which requires precomputed regression coefficients for each instrument and are stored in coefficient files which must be called in each model run hocking et al 2011 rttov requires atmospheric and surface variables as input data which can be obtained from atmospheric models rttov simulations can be applied on each wrf model grids to estimate optical depth for a specific satellite sensor the pressure temperature and water vapor on each level besides surface pressure and skin temperature are mandatory inputs rttov can also simulate the scattering properties of aerosols and clouds if their concentrations on different atmospheric levels are given marquis et al 2021 2 4 software structure postwrf is an open source software toolkit written mainly in ncar command language ncl and linux shell script a namelist file namelist wrf which resembles the wrf s namelist input or wps s namelist wps acts as the linkage between the user and the software therefore the way postwrf is run is similar to running wrf or wps most of the requirements such as atmospheric variables and pressure levels table 1 which are necessary to run the toolkit can be specified in namelist wrf by the user some additional inputs such as contour color patterns or output file formats are not in namelist wrf and must be specified by the user during the run time reading the variables in namelist wrf as well as requesting the additional input data are carried out by the shell scripts any scientific software tool has one or more programming languages as their building blocks for example in the qgis software qgis development team 2021 python functions play a significant role in raster and vector processing ncl in postwrf plays a similar role as python in qgis postwrf s user can specify single variables or polynomials of variables to be processed by the software variable names in namelist wrf associated with wrf can be determined either as those ones directly simulated by wrf and available in its output or as diagnostics e g vorticity or relative humidity which are not stored in the wrf output but can be calculated the user can display the names of possible diagnostics about 40 variables that can be calculated by the software the specialized ncl functions for wrf are used to calculate the diagnostic meteorological variables polynomials of the wrf output variables diagnostics in postwrf can be made by six mathematical operations including the four basic operations addition subtraction multiplication and division exponentiation and parentheses fig 1 shows the run process of postwrf two standard netcdf format of the wrf and era5 data can be processed by the software this issue must be noticed especially for the era5 data since era5 is originally based on grib format it must be downloaded as netcdf data to be processed by postwrf overall the users do not need to deal with data formats since both wrf and era5 data have standard output format 3 results software capabilities some arbitrary wrf output files have been chosen as test cases since the structure of the wrf netcdf output files are the same it would make no difference if the test cases were the output of wrf wrf chem or any other coupled modeling system based on the wrf model postwrf does not require any special compilation since postwrf is a linux based tool all of its components including bash ncl and gdal are freely available as open source software packages and can be simply installed by the linux package manager however ncl source codes are available on https www ncl ucar edu download index shtml before running the software one or multiple wrf netcdf output files must be linked or copied on the main directory of postwrf the namelist must be modified to enable and set the parameters associated with the desired post processing task the generated plots can be saved as pdf png or animated gif needs imagemagick the imagemagick development team 2021 to be installed postwrf has been developed to provide a practical software toolkit to carry out the most frequently used tasks in the postprocessing of the wrf model outputs the software s capabilities are divided into 9 sections in namelist wrf such as horizontal and vertical contour plots data extraction and statistical diagrams all of these capabilities can be classified into two primary groups visualization and data handling 3 1 visualization in this section all of the capabilities which can be used to make plots and diagrams are discussed besides the wrf model outputs some of the visualizations are being plotted using other data sources such as observations or rttov model outputs 3 1 1 contour plots wrf and era5 horizontal contour plots and vertical cross sections are necessary for evaluating almost all of the numerical weather simulations plotting the wrf geographical domains can be carried out in 2 ways by a separate section in namelist wrf for contour plots of the atmospheric variabls the user can specify up to 3 groups of variables polynomials of variables from a wrf output to be overlaid on the same plot in case of 3 overlaid variables one of them can be plotted as shaded contours while the other 2 remaining variables can plotted as line contours for the horizontal contour plots some other elements such as wind vectors point markers geographical locations and shapefiles can also be overlaid on plots several main features can be set in namelist wrf table 1 such as atmospheric pressure levels for each variables colors and thicknesses of line contours as well as intervals between them reference magnitude of wind vectors as well as their density and other key features that are mostly used and required for a sophisticated visualization fig 2 a shows blue shaded contours of 2 m dew point temperature as a diagnostic variable overlaid with red line contours of temperature at 700 hpa and wind vectors at 300 hpa fig 2 b shows three variables water vapor mixing ratio as shaded and temperature and wind speed as line contours overlaid on the same cross section plot from a wrf chem netcdf output file a small subplot can also be overlaid on top of the main plot representing the path of the cross section line which is over the west coast of northern america for this case 3 1 2 diagrams wind rose and skew t diagrams with separate sections in namelist wrf can be plotted for specific locations inside the wrf domain several statistical diagrams including time series and scatter plots can be set in namelist wrf to be plotted by postwrf fig 3 b shows the taylor diagram for 2 m temperature over specific locations taylor diagrams as well as scatter plots needs measurement data e g openweather weather api openweathermap 2012 as a data provider statistical diagrams are not specific to wrf outputs and can be plotted for any pairs of simulation and measurement data the data files must conform with a particular format that can be generated by the extract section of postwrf fig 3 a shows the vertical profiles of potential vorticity for 3 locations on a specific time slot 2016 10 01 03 00 additional examples for meteorological diagrams are available on https postwrf readthedocs io en latest 3 1 3 rttov outputs rttov simulations using the atmospheric inputs extracted on each wrf grid points are saved as ascii files the optical variables including the brightness temperature and radiance can be read from the rttov output file and plotted by postwrf the formats of the plot can be selected as netcdf or png for a single band or an rgb image for 3 bands since plotting the rttov outputs needs to convert their ascii files to netcdf this process can also be classified as data conversion and could be included in the next section since postwrf reads the coordinates of the wrf grid points rttov outputs must be generated by the input data extracted by postwrf itself otherwise postwrf cannot convert the rttov output to netcdf or other image formats fig 4 shows the simulated brightness temperatures for msg2 seviri sensor channels 8 7 and 12 0 μ m over central europe on a specific time 2021 07 07 13 00 postwrf can also convert rttov outputs using input data from wrf for three different satellite channels to rgb images 3 2 data handling postwrf can carry out several data handling tasks for the wrf output files these tasks are mainly data extraction and data conversion the user can convert the wrf netcdf output format to geotiff data conversion can also be applied on the rttov model outputs from ascii file format to another more easy to use file formats eg netcdf 3 2 1 data extraction in a separate section data extraction in namelist wrf postwrf extracts atmospheric variables over specified locations by pairs of latitudes and longitudes if the variable has bottom top dimension the lowest layer will be extracted the user can extract a variable s values on all model pressure levels by plotting its vertical profiles fig 3 a at specific points table 2 shows the values of 2 m relative humidity extracted from 3 locations of los angeles la san francisco sf and las vegas lv from an arbitrary wrf output 3 2 2 conversion to geotiff since wrf files do not conform to the netcdf cf convention eaton et al 2003 it is a challenge for gis analysts to work with the wrf outputs in their gis software there is a specialized plugin meyer and riechert 2019 provided for the qgis software which is capable of reading and post processing wrf netcdf outputs however by using the gdal gdal ogr contributors 2021 tool postwrf can convert a polynomial of atmospheric variables on specific pressure levels from the wrf netcdf outputs to geotiff file format as a standard raster data for each time slot for the wrf output variable a separate geotiff file is generated by postwrf 3 2 3 rttov inputs rttov model requires input atmospheric surface variables some of these data are mandatory to run the model such as atmospheric temperature and water vapor on pressure levels surface pressure and skin temperature are other mandatory data postwrf extracts the required input data for example fwd f90 example program input data for the other example programs as well as user defined rttov applications are almost similar to those of example fwd f90 however advanced users can modify the postwrf codes to generate their preferred input data table 3 shows the beginning lines of the rttov input data extracted from the grid points of an arbitrary wrf netcdf output file the extractions are carried out for all of the grid points which are 32041 179 west east 179 south north points for this sample wrf output file moreover postwrf can also extract the vertical profiles of dust concentrations from the wrf chem output files which are required in the simulation of aerosol effects by the rttov model 4 discussion and conclusions apart from the postwrf s aforementioned tools some other capabilities such as plotting skew t and wind rose diagrams as well as wrf model domains are available in separate sections in namelist wrf furthermore some additional features could be activated in the last section general settings of namelist wrf to provide extra capabilities such as average and panel plots multiple wrf outputs for the same simulation can be selected in postwrf making all times in each output to be appended to form a single output which is particularly useful for average plots since postwrf is independent of a parent software platform e g a gis software it is capable to be developed in an unlimited way with other open source data analysis tools such as nco moreover advanced users can easily modify postwrf s codes and add their own desired capabilities to the software the wrf model as a major regional atmospheric model covers a wide spectrum of applications in environmental science considering that not all environmental scientists are expert in atmospheric modeling and numerical analysis postwrf can act as a bridge between atmospheric modeling and environmental science making it possible for many researchers to directly carry out the main post processing tasks for the wrf model outputs and analyze the results without any advanced knowledge in programming and wrf modeling system however it should be mentioned that postwrf is a toolkit for both experienced and inexperienced scholars postwrf as a multidisciplinary toolkit which deals with wrf and rttov models provides applications in numerical modeling as well as remote sensing however as an interactive software besides in research activities it also has applications in meteorological education since the wrf model carries out an almost complete numerical simulation of the atmosphere in regional scales a sample wrf output file for a specific geographical domain can be efficiently explored by postwrf illustrating a wide spectrum of atmospheric variables in forms of plots diagrams and numerical values software availability software name postwrf developer amir h nikfal email ah nikfal gmail com year first available 2018 hardware required linux preferably fedora based main software required ncl bash additional software required gdal imagemagick python program size 1 mb license mit repository https github com anikfal postwrf documentations https postwrf readthedocs io en master declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper 
