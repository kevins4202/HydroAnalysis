index,text
180,a general approach to deal with parameter uncertainty in natural systems is to use ensembles of many parameter realizations however this might result in extremely expensive computational time especially when additional loops for transient simulation and for optimization are involved one possibility to mitigate computing time is to use few but well selected realizations that best represent the involved geological uncertainties e g by clustering techniques the goal of this paper is to address the search for representative realizations that best approximate the distribution and its tails of a model ensemble in our test application this ensemble is used to delineate wellhead protection areas whpas under transient flow conditions and subject to random heterogeneity of the aquifer our approach is based on clustering and proposes that the cluster medoids representatives should be optimized not for statistical representation in the space of some selected proxy metrics but for a minimum of decision relevant errors and if the underlying decision problem is multi objective then the clustering optimization can be made multi objective too in this way many subsequent analyses can be performed on the condensed set of representative scenarios that would be computationally too expensive otherwise even if distribution tails and extreme realizations are relevant we demonstrate the advantage of our clustering optimization methodology on a dynamic probabilistic whpa delineation and we compare its performance with a standard clustering analysis our results show that 1 in probabilistic transient whpa analysis clustering is a suitable technique to account for geological uncertainty 2 however clustering analysis should be based on optimization concepts rather than on simple medoid concepts and 3 of course it should use problem specific and decision relevant metrics for cluster optimization in our whpa application this leads to a more accurate representation of decision relevant statistical extremes 4 the additional extension to multi objective cluster selection probes to be a valid approach in multi objective whpa delineation 5 using our framework we reduce the computational cost of addressing highly expensive simulations keywords well catchment delineation groundwater protection transient flow conditions risk assessment multiobjective optimization machine learning clustering unsupervised learning 1 introduction typically in order to deal with geological uncertainty groundwater modelers routinely use an ensemble of many hydraulic conductivity realizations or other multiple representation approaches to capture the influence of uncertain hydrogeological conditions generally using monte carlo simulation stauffer et al 2005 in the example of wellhead protection area whpa analysis each of these realizations depicts a different hydraulic conductivity field that leads to distinctive contour lines and isolines of travel time towards a drinking water well haitjema 1995 this in turn leads to different outlines of water captured by the well within a given transport time called capture outline the straightforward analysis in such cases is statistical aggregation over the ensemble of capture outline realizations this aggregation provides a probabilistic whpa map with values ranging from 0 to 1 it expresses the probability of well pollution in case of spill events for each location on the map the final decision is to pick a reliability level and then choose the corresponding isoprobability line from the probabilistic whpa map as final whpa outline this manner of accounting for uncertainty in whpa analysis is called probabilistic whpa delineation enzenhoefer et al 2012 2014 rodriguez pretelin and nowak 2018 additionally when transient flow conditions are considered there is a frequentistic component for each location on the map to be part of a whpa outline in each realization and the procedure is called transient probabilistic whpa delineation the latter requires to specify both a geological reliability level and a transience related reliability level rodriguez pretelin and nowak 2018 2019 in such types of application the involved monte carlo simulations are already expensive as they trigger a loop over many model calls additionally the involved more complex analyses trigger even more loops nested inside or outside the original monte carlo loop in the case of transient probabilistic whpa delineation these additional loops are transient simulation of transport towards a well rodriguez pretelin and nowak 2018 time loop inside the monte carlo loop or an additional optimization of adaptive pumping rates rodriguez pretelin and nowak 2019 optimization loop around the monte carlo and time loop with this whpa analysis is not alone there are many robust optimization task with nested loops inside or outside a monte carlo loop generally in the area of robust optimization examples are robust optimization of remediation schemes robust optimization of oil extraction and robust design of co 2 or nuclear waste storage in the subsurface to name only a few thus it is tempting to cut down on the computational costs by a cheaper monte carlo approximation but without sacrificing too much statistical accuracy one possible strategy is to substitute the monte carlo loop by a limited set of aquifer realizations according to the modelers own experience and knowledge however this manual interpretation of geological uncertainty might bring bias into the overall result this could lead for instance to over confident management strategies that perform worse in practice than what was expected during the optimization and decision making a less subjective methodology for selecting representative subsets of realizations is unsupervised learning for example via clustering cluster analysis usually searches within a low dimensional feature representation of the ensemble for commonalities among realizations based on some distance measures in a lower dimensional feature space then the identified subset of model realizations one at the center of each cluster is used as a condensed yet comprehensive set of hypotheses to represent the relevant aspects of uncertainty at the limit of one cluster for each original realization cluster based uncertainty quantification converges back to the computational effort and accuracy of the full original monte carlo simulation for much smaller numbers of clusters cluster based analysis has been found by several authors see below to have a better accuracy per computational time compared to smaller monte carlo simulations there have been previous studies addressing cluster analysis to depict geological uncertainty through a subset of realizations mostly in the field of oil reservoir production for instance in the context of uncertainty quantification scheidt and caers 2009 combined kernel k means clustering with flow simulation to select a small number of representative realizations that represent relevant statistics for future oil production the same authors scheidt et al 2009 presented a distance kernel method to select a subgroup of realizations that represent ranges of uncertainty for time series of cumulative oil production in the context of robust optimization problems wang et al 2012 applied k means clustering they used the identified subset of realizations to search for robust optimal well placement solutions that maximize the expected oil production of the reservoir under study when aiming to optimize well control strategies for a similar purpose of robust optimization shirangi and mukerji 2012 used kernel clustering in all these studies the authors significantly reduced the computational cost of robust optimization by depicting geological uncertainty with a limited number of reservoir realizations however one problem remains if the selection of that limited set is not performed properly bias might arise that leads to improper uncertainty quantification sub optimal results and unforeseen risk scenarios this holds in probabilistic whpa analysis as well as in all other mentioned applications the problem can be divided into two parts defining the so called feature space and defining the selection rule among realizations within that feature space in the first part of the problem one has to define an appropriate lower dimensional feature space in which the clustering can be performed the low dimensionality is required in order to have meaningful expressions of distance e g euclidean distance which is the basis for defining similarity and dissimilarity among realizations the features underlying this feature space influence what realizations will be clustered together and hence will affect the overall clustering result this means that the features have to be problem specific and chosen properly recently shirangi and durlofsky 2016 concluded that flow based features of hydraulic conductivity realizations additional to straightforward conductivity based features was beneficial during the clustering despite the higher computational time spent for the additional flow simulations required to define these flow based features in the second part of the problem independently of the chosen feature space the selection of the clustering technique plays an important role most available clustering methods rely on centroid based strategies scheidt et al 2009 shirangi and durlofsky 2016 their alleged advantage is their robustness to noise and outliers as well as their wide availability e g many programming environments of language such as matlab seber 1984 have their own clustering packages and simplicity to implement in such techniques clusters are represented by their means or medoids which per definition has a central tendency this might contribute to a lack of representation for statistical extremes although tails and extremes are often the most decision relevant aspects a different strategy is to propose that the cluster representatives should be optimized not for statistical representation in the feature space but for a minimum of decision relevant errors via optimization analysis cai et al 2020 for instance one possibility is to minimize the discrepancy between reliability aspects of a selected subset and the solution obtained after evaluating the full monte carlo ensemble of course these decision relevant features and reliability aspects must be approximated on a cheaper but related problem otherwise the subset selection would require solving the full problem first the contribution of this study is to reduce the computational cost of addressing highly expensive monte carlo simulations for transient problems and or within optimization problems this is done by detecting a limited subset of realizations that best represent the geological uncertainty of a model towards a specified decision criterion while almost all clustering techniques use some sort of optimization e g minimal variance within the clusters our novelty lies in using decision relevant criteria when selecting the cluster representatives if the targeted decision problem is multi objective then the optimal clustering will become multi objective too while multi objective clustering concepts exist in the literature e g gong et al 2017 they do not build up on the idea of decision relevant objectives in our whpa application example the decision relevant criteria used for optimal clustering relate to minimal errors in delineated wpha outlines although specific choices of implementation are done in our application example our optimal selection framework is independent of random field parameterization e g principal component analysis and of algorithmic choices for numerical simulation and optimization it is also in its optimal selection idea independent of our whpa application the only thing specific to our application is that we propose a set of decision relevant selection features that are targeted at reliable multi objective whpa delineation to illustrate our framework we speed up probabilistic whpa analysis in a transient transport context however the selection of representative realizations has to be achieved without running the expensive transient analysis i e in cheaper pre processing of the most expensive step since geological uncertainty turned out to have a higher influence on whpa delineation than uncertain transient flow conditions rodriguez pretelin and nowak 2018 a much cheaper steady state analysis is still near optimal to a transient cluster selection in this way we can reduce the computational costs to find problem specific features and then limit the transient flow simulations to optimally selected k field realizations to the best knowledge of the authors there is only one study addressing clustering in groundwater flow modeling alzraiee and garcia 2012 concluded that for the study under analysis 25 of the total number of realizations was enough to achieve approximately the ensemble statistical response we aim to deepen the use of clustering techniques in groundwater flow modeling evaluating the effects in transport modeling particularly for whpa analysis and to achieve a higher efficiency than alzraiee and garcia 2012 in a more complex problem the remainder of this paper is structured as follows in section 2 we present a brief overview of whpa analysis in the presence of uncertain geological variability and transient flow conditions governing equations and numerical solvers are provided in the appendix in section 3 we present our formulation for clustering analysis based on multi objective optimization concepts in section 4 we describe the whpa test case scenario in section 5 we provide results and corresponding discussions here we compare the whpa accuracy and the overall computing time between our proposed optimization based clustering and a standard clustering approach we also demonstrate the benefits of multi objective clustering for multi objective whpa analysis finally in section 6 we present the conclusion and outlook of our study 2 transient probabilistic whpa analysis a usual strategy followed by many national water safety guidelines to prevent groundwater pollution in drinking water well catchments is to define wellhead protection areas whpa these areas represent zones of concern that might pose a risk due to land surface activities to the produced drinking water quality a typical criterion to delineate whpas relies on time of travel capture areas defined through the time it would take a contaminant to reach a drinking water well often in order to reduce the complexity when using model based solutions some model simplifications are implemented among these the two most frequent ones used are 1 homogeneity in the pattern of subsurface hydrogelogic variables and 2 the delineation of capture outlines under steady state flow conditions however the use of these simplifications might lead to a poor representation of the real groundwater flow behavior and therefore to unsafe whpa delineations the impact on whpa delineations due to natural geological variability franzetti and guadagnini 1996 has been well addressed in the literature enzenhoefer et al 2012 the classical approach to deal with uncertain geological conditions is via probabilistic methods e g by monte carlo simulation here each monte carlo realization uses a different randomly generated hydraulic conductivity field rodriguez pretelin and nowak 2018 extended the concept of probabilistic whpa delineation to integrate the influence of uncertain transient flow conditions the resulting probabilistic whpa solution depicts the joint probability distribution of pixel wise whpa membership under uncertain aquifer parameters and uncertain transient flow conditions the transient probabilistic whpa analysis can be solved with a backward in time formulation of advective dispersive transport in the lagrangian framework this means to use a reverse particle tracking random walk where the simulated release of particles starts at the pumping well to reflect the effect of transient flow conditions over a simulation period t particle release has to be continuous for temporal discretization of this continuous release batches of particles are released at time steps t j 0 t j 1 n j then these particles are traced backward in time until each one of them reaches a critical life time for whpa analysis τ c r i t e g τ c r i t 365 d a y s using the travel time map generated after backtracking each particle batch j a boolean yes no map f j k x i is generated per release time t j 1 f j k x i 1 if τ x i t j θ k α t j t τ c r i t 0 otherwise where f j k 0 1 indicates whether a map pixel at position x i represents a risk to the well f 1 if yes f 0 if no in case of a spill event at location x i the index k denotes that the resulting map is different for each monte carlo realization k 1 n r with randomly drawn hydrogeological parameter sets θ k that influence flow and transport e g porosity or hydraulic conductivity field the index j denotes that the resulting map depends on reverse release time t j i e on the arrival time at the well due to transient changes in pumping rate conditions or in the hydraulic groundwater gradient the transient changes of flow are driven by a time dependent vector of flow related boundary conditions source sink terms and pumping rates α t j t then by analyzing how often over the release times t j each map pixel defines a risk to the pumping well a frequency map f k x i of whpa membership is obtained 2 f k x i 1 n j j 1 n j f j k x i the obtained frequency map still per realization k 1 n r assumes values between zero and one indicating the fraction of time in which the well is susceptible to a contaminant spill at position x i in short f k x i resembles a transience related risk map next this map is converted to a transience related reliability map r k x i 3 r k x i 1 f k x i higher values in r k e g 1 represent smaller temporal windows for possible contamination e g never and hence larger reliability to obtain a recommended whpa outline per realization k we transform r k x i to a binary map b k x i that labels all pixels with a less than required temporal reliability r k r t c r i t for inclusion into the whpa 4 b k x i 1 if r k x i r t c r i t 0 otherwise where the transience related or temporal reliability level r t c r i t is to be chosen by a decision maker the actual choice of level will depend on her or his risk aversion and on the willingness at accept larger whpas finally after statistical aggregation over all n r realizations we get the overall probabilistic whpa map p x i 5 p x i 1 n r k 1 n r b k x i the map p x i resembles a risk map over all possible spill locations x i it expresses the probability across all geological realizations of the aquifer that a contaminant spill at location x i would cause a quality problem at the well that lasts longer than a fraction 1 r t c r i t of the year thus for a given value of r t c r i t the probabilities p x i resemble a risk caused by geological uncertainties among the different aquifer realizations k in the end the decision maker picks a geology related reliability level r g c r i t again according to risk aversion which converts the probabilistic whpa map p x i into a binary whpa outline w x i 6 w x i 1 if p x i 1 r g c r i t 0 otherwise this second decision parameter r g c r i t is called geology related reliability level because it addresses the geological uncertainties inherent in p x i like for r t c r i t the greater the chosen value of r g c r i t the larger the resulting whpa outline and the greater the safety against geological uncertainty to explicitly denote the dependence of w x i on the underlying decision parameters r t c r i t and r g c r i t we write 7 w x i w x i r t c r i t r g c r i t 3 proposed approach for objective oriented clustering analysis in this section we describe our novel methodology proposed in this study like almost all clustering ideas our clustering analysis relies on optimization based strategies to find a subset of representative model realizations the difference lies in formulating optimization criteria that are aligned with decision relevant predictive errors rather than a nest possible statistical representation in the feature space for brevity we call it optimal clustering analysis oca we seek to find a subset n s with size n s of realizations that chosen from an original monte carlo ensemble n r of size n r approximates a statistic of interest when aggregated for decision analysis van essen et al 2009 in the case of probabilistic whpa analysis the whpa map w s obtained by cluster based analysis should be close to the whpa map w r obtained after aggregation over all n r k field realizations 8 w s x i r t c r i t r g c r i t w r x i r t c r i t r g c r i t for a given pair r t c r i t r g c r i t where the full monte carlo ensemble n r of size n r is used for computing w r and only the selected subset n s of size n s is used for computing w s in the eqs 1 to 7 in the following we discuss the ingredients of our oca a feature space that serves to characterize the n r realizations for clustering along with their cheaper replacement by steady state instead of transient simulations section 3 1 the optimization approach for subset selection section 3 2 and its multi objective extension section 3 2 2 3 1 features for low dimensional representation of realizations in whpa analysis clustering needs a definition of similarity between realizations so that similar realizations can be clustered together this similarity is commonly defined as small distances in a so called feature space boutsidis and mahoney 2009 the feature space must be low dimensional because with increasing dimension of a feature space the number of realizations or data items that populate that space in a meaningful manner would have to increase exponentially bellman 2015 steinbach et al 2004 without sufficiently large data sets distances and hence similarities and clusters become meaningless which features are important or how many features to use feature selection is a problem dependent decision our proposed oca method will not be designed to minimize distances in the feature space as standard clustering methods would instead it will minimize decision relevant errors thus the main exercise for oca is to think about a proxy for decision relevant errors nevertheless we first look at a meaningful feature space for two reasons first we need it for fair conditions when comparing oca with standard clustering techniques second discussing features is a fruitful ground to discuss the proxies for optimization later on for application to whpa analysis we combine one generic feature with two problem specific features as a generic feature we use a simple euclidean distance as already used by wang et al 2012 9 k d i s t k ω k k x k ˆ 2 d x 1 2 which is the euclidean distance between each hydraulic conductivity realization k k and the ensemble and volume average k ˆ over all k field realizations it serves to differentiate hydraulic conductivity fields as such regardless of their action in flow transport and whpa delineation as first problem specific feature we use the size a a r e a k of realization wise whpas 10 a a r e a k ω b k x d x ω a k x d x where ω is the spatial domain under analysis b k x is the binary map defined in eq 4 and the approximation by a k x will be defined below computing a a r e a k from b k for all k 1 n r realizations would require transient simulation across all n r realizations fortunately it was found in past studies that transient flow has a much smaller influence on whpa delineation than geological uncertainty rodriguez pretelin and nowak 2018 hence we can approximate b k reasonably well for the purpose of clustering by binary maps a k found via steady state simulations 11 a k x i 1 if τ x i θ k α 0 τ c r i t 0 otherwise where τ x i θ k α 0 is the travel time towards the well simulated under steady state conditions i e with static drivers α 0 instead of time dependent drivers α t j t this collapses the flow simulation to a steady state solve and the reverse particle tracking to a single batch of particles hence the computer time divides by the number of time steps in the transient simulation and we complete the approximation provided in eq 10 as second problem specific feature we apply the same strategy as used for k d i s t to the steady state whpa maps a k x i from eq 11 12 a d i s t k ω a k x a ˆ 2 d x 1 2 finally all three feature values k d i s t a a r e a and a d i s t are normalized with their respective maximum magnitude so that they fall into the interval 0 1 they serve to represent all n r realizations and their simulation outcomes in a three dimensional problem specific feature space that we will use for clustering section 5 1 will illustrate this feature space 3 2 optimal cluster analysis for minimal decision relevant errors the central idea of our oca approach is that instead of selecting subsets based on some statistical representation as in conventional clustering approaches we seek for a minimum of decision relevant errors in our whpa application this means we seek the smallest possible approximation error of resulting whpa outlines for this we use as objective function an error measure that evaluates the disagreement in eq 8 our proposed approach is to compute over some problem domain ω an error measure that quantifies the total decision error induced by the approximation in eq 8 in our case we use the error e d e l in whpa delineation as error measure 13 e d e l n s r t c r i t r g c r i t ω 1 w s x i r t c r i t r g c r i t n s w r x i r t c r i t r g c r i t d x e d e l captures both the false positive and the false negative errors of whpa decisions this is the whpa extent that the clustering based solution w s fails to cover false negative and the excess area consumed by w s without providing any additional protection false positive when compared to w r i e to the full monte carlo whpa solution once again using this error measure would require to solve the full transient problem first before beginning even to cluster therefore w r and w s in eq 13 must be approximated on a cheaper but related problem thus we replace once again the transient transport problems hidden in the definition of w s x i and w r x i by their steady state counterpart we replace them by v s x i and v r x i respectively 14 e d e l n s r t c r i t r g c r i t ω 1 v s x i r t c r i t r g c r i t n s v r x i r t c r i t r g c r i t d x where v s and v r are obtained through replacing b k x i in eq 4 by a k x i as defined in the previous section in section 5 2 we will show the clustering based whpa results obtained with steady state features and with a steady state based objective function are indeed good approximations 3 2 1 single objective optimization analysis according to our oca idea we now want to choose the subset n s of size n s such that we minimize the decision relevant errors as approximated by eq 14 15 n s opt n s r t c r i t r g c r i t arg min n s n e d e l n s r t c r i t r g c r i t here n s opt n s r t c r i t r g c r i t is the optimal clustering selection of size n s that minimizes the total delineation error e d e l according to eq 14 for a specified pair of reliability levels r t c r i t and r g c r i t the search for n s o p t acts over all n s n where n includes all possible subset selections of size n s from the full monte carlo ensemble n r of size n r each obtained representative realization has the same importance i e when aggregating over the obtained subset we do not implement weight factors van essen et al 2009 this formulation is a single objective optimization problem as we have a unique objective function for clustering this is the case whenever the two reliability levels r t c r i t and r g c r i t are fixed and given however the approximation target specified by eq 14 changes with different reliability levels a whpa decision maker typically can decide on reliability levels only after seeing their whpa consequences such as total area demand this is a typical situation of multi objective decision making also the decision maker may want to establish different protection levels for different whpas at different reliability levels therefore we wish to avoid the dependence of n s opt on a single pair of reliability levels for example we can use a set of j pairwise reliability levels e g 10 50 and 90 for geological and for transience related reliability and sum up the corresponding objective functions 16 n s opt n s arg min n s n j 1 j e d e l n s r t c r i t j r g c r i t j 3 2 2 multi objective optimization analysis the summation of objective functions from different reliability levels proposed above maintains the character of a single objective optimization problem however it will lead to a non balanced distribution of approximation errors among the different specified reliability levels for instance there is a higher contribution to the approximation error from higher reliability levels because they depend more on geological extremes see section 5 3 for illustration the way out is to treat a set of reliability levels as mutually competitive objectives this will lead to a multi objective optimization problem marler and arora 2004 for the optimal selection in clustering then the competition between approximation qualities is laid open and the modeler or decision maker can decide herself on a balanced distribution of errors compare section 5 4 hence we extend the single objective oca formulation to a multi objective optimization moo formulation 17 n s opt n s arg min n s n e d e l n s r t c r i t j r g c r i t j j where e d e l j is the vector of approximation errors e d e l for different reliability levels j 1 j in section 5 4 we will show that subset solutions of same size n s in fact lead to more favorable error reduction when implementing this multi objective analysis to solve our optimization problem and obtain the set of pareto optimal solutions for subset choice after feature extraction see section 3 we use among several possible optimization algorithms e g boussaïd et al 2013 dokeroglu et al 2019 and hussain et al 2019 the framework for optimal multi objective particle swarm optimization omopso as developed by sierra and coello coello 2005 the soo problem is solved easily by a plain particle swarm optimization 4 test case scenario we test our methodology using a rectangular 3d domain that resembles a single geological layer on top the domain is semi confined by a leaky aquifer that permits recharge see fig 1 this synthetic model has a size of 5 250 m 5 250 m 60 m and is equally discretized d x d y d z 15 m we use a well field that is located in the eastern part of the model represented by a row of eight fully penetrating wells each of them having a separation distance of 160 m between each other fig 1 illustrates the model domain and features to represent transiency in groundwater flow the model uses four transient conditions on seasonal scale a changes in pumping rates b changes in the natural recharge to the groundwater c changes in the strength of the regional hydraulic gradient and d changes in the regional groundwater flow direction we depict seasonal changes with a yearly sinusoidal pattern of given frequency ω π year and phase shift values φ n 0 as discussed in rodriguez pretelin and nowak 2018 in our model set up we oppose the impact of pumping and recharge to represent larger water demand during the dry season for this we use a phase shift value φ n 180 for groundwater recharge to outline whpas for 360 days of travel time to the well we set the total simulation time to 720 days and trace all particles backward in the flow field until the whpa relevant lifetime of τ 360 days for transport simulation we release a new batch of particles at the well locations every day δ t j 1 day a specific storage of 1 1 0 6 is assumed in this study we set groundwater flow behavior to follow the mean transient behavior α to simulate steady state conditions all parameters relevant for flow and transport are provided in table 1 while governing equations and numerical schemes are provided in appendix in our model randomly heterogeneous k fields are modeled as random space function governed by the matérn covariance function minasny and mcbratney 2005 with the parameters listed in table 1 additionally to resemble uncertainty levels as in cases where some hydrogeological data exist each k field realization is conditioned to point like hydraulic conductivity measurements located at ten different sampling locations of a initial synthetic truth realization the spatial position of the sampling locations are highlighted with black squares in fig 1 we generate each conditioned k field realization with the fft based geostatistical tool described in fritz et al 2009 5 results and discussion for the sake of demonstration we implement the numerical example introduced in section 4 with n r 2 000 monte carlo realizations and define the resulting ensemble n r to be the true underlying probability distribution of all uncertain parameters thanks to this assumption n r can serve as exact reference solution then we illustrate and evaluate our oca method we also compare it against k medoid clustering as example of a standard clustering method we do these analyses using the application scenario provided above using both the soo and moo formulations defined in section 3 1 we use our second type of soo analysis eq 16 with three geological reliability levels 10 50 and 90 all combined with a transience related reliability level of 100 with the corresponding subsets n s of different sizes n s we perform whpa analysis based on the same set of reliability levels and analyze the resulting delineation errors 2 then we use a moo analysis eq 17 with the same set of reliability levels to highlight the advantages of more balanced approximation errors 5 1 low dimensional representation using geological and transport features first we present in fig 2 the low dimensional representation of all n r 2000 k field realizations black spheres in our three dimensional and problem specific feature space the feature space consists of the geological k d i s t and transport features a d i s t and a a r e a from section 3 1 as can be seen from the black spheres rather than depicting well defined clusters in the low dimensional feature space the full ensemble n r forms a densely packed cloud in the feature space in case a groundwater modeler had to manually select a specified number of representatives the solution would absolutely not be obvious this also implies that the specific choice of clustering method does matter the subset selection for n s 100 from single objective clustering according to eq 16 is shown as red spheres note that the selected representatives n s are well distributed in the feature space without focusing too much on the densely populated space this can be seen well in the 2d projections to the planes of the coordinate system if compared to a subset n s of same size n s 100 obtained through k medoid clustering green spheres in fig 2 we cannot see any particular difference in the distribution pattern this is merely a first check showing that our oca method leads to a plausible selection the better approximation for the decision task will be discussed in the upcoming sections 5 2 quality of oca approximated whpa outlines and comparison to k medoid how does a transient whpa solution obtained from a much smaller subset selected under steady state differ from the full ensemble based whpa delineation how much better are the results based on oca compared to those obtained by standard clustering to investigate these questions fig 3 features whpa delineations for the 10 50 and 90 geological reliability outlines we are still using the single objective oca in specific we show the whpa outlines obtained from the full ensemble white outlines and corresponding whpa outlines based on clustering red outlines we do this comparison both with our oca upper row and with k medoids clustering lower row and for subsets of size 10 left 70 center and 100 right a more fine grained convergence analysis will be shown in section 5 3 in fig 3 each black cross indicates a pumping well location inspecting the approximated whpa outlines from left to right we see that increasing the size of n s reduces the mismatch between the approximated red outlines and the full ensemble white outlines especially for the 90 geological reliability delineation this is true for both implemented clustering methodologies however when we compare visually the agreement of the white and red outlines between the two clustering methods for increasing n s comparing the top row and the bottom row we observe a clear advantage for the oca method for instance when comparing the optimized solution in the upper row for n s 70 center column 3 5 of the total ensemble with the corresponding k medoid solution in the lower row we observe a closer agreement for the 10 and 50 geological reliability outlines this is not achieved in the bottom row even by increasing n s to 100 although this analysis is specific to a single case study it allows us to conclude two things 1 by using problem specific features even a simple clustering technique here k medoids can be remarkably good for the task at hand already with very small subsets 2 being based on optimization our oca framework can outperform k medoids 5 3 heuristic convergence analysis in decision errors in order to assess convergence beyond the visual impression from section 5 2 we evaluate the whpa disagreement e d e l eq 14 for the three different reliability levels correspondingly fig 4 shows the convergence for the 10 blue 50 red and 90 black geological reliability levels for values of n s between 1 and 200 for easier interpretation we show the percent reduction in e d e l from the error level at n s 1 towards the full solution of n r 2000 within the shown range a size of n s 1 indicates that the data cloud see fig 2 is represented only by a single realization at n s 200 10 of the entire ensemble are used overall the three geological reliability delineations show a similar convergence behavior all three show an initially steeper increment in the reduction of e d e l which stabilizes when n s 70 although all three reliability outlines show similar behavior we can notice a faster improvement in error reduction for the 10 reliability outline when compared to the other two reliability levels this behavior can be attributed to the difficulty for larger reliability levels to find a proper combination of subset scenarios that represent the geological extremes thus if highly accurate analysis requires to approximate probabilistic transient whpa delineations at high reliability levels there is an obvious need for choosing a greater number of clusters next we compare the convergence of our oca to that of monte carlo simulation and of standard k medoid clustering thus we additionally run the k medoid clustering for n s 1 200 and we perform smaller monte carlo simulations for the latter we perform a resampling with replacement of n s randomly drawn realizations from the full set of n r 2000 and then perform a whpa analysis to be statistically representative we repeat this resampling procedure 2000 times fig 5 shows the resulting speed accuracy curves for 10 left 50 center and 90 right geological reliability levels for sizes of n s between 1 and 200 the repeated monte carlo results gray lines are also represented by their average line red while k medoid results are shown in blue and oca is shown in green accuracy is shown as error of delineation e d e l as defined in eq 14 normalized with the respective a a r e a value of the reference solution with n r 2 000 first when inspecting the performance of the random repetitions in the monte carlo variant we can see a high variability in the e d e l values this reflects the typical random error behavior of monte carlo simulation however once we compare the monte carlo mean performance red and the two clustering techniques blue and green we can clearly see that for all n s values our methodology always gives a much smaller error while k medoid only has a small yet consistent advantage over monte carlo additionally we see that the advantage of standard clustering blue over monte carlo simulation starts only for n s 160 thus although standard clustering was shown to be useful in related applications in the literature it does not strongly outperform plain monte carlo analysis in our application case this is because we have a reliability related task where extremes matter and do not seek to approximate a simple ensemble mean our optimization based clustering oca accounts for this aspect per construction consequently for those reliability levels where the identification of extremes has higher influence e g 50 and 90 we observe that our methodology shows the strongest improvement over both competitors 5 4 multi objective clustering for more balances errors in the approximations up to here we used the summed up soo analysis eq 16 to optimally select a single subset that approximates all three features reliability levels well however we also saw in our results so far that the different reliability levels have slightly different convergence behavior in relative errors also they are subject to different absolute error levels they may have similar relative errors but they also have different base sizes a a r e a hence optimizing the subset selection under the sum of errors does not necessarily lead to a balanced distribution of errors across the different reliability levels in order to address this problem we move a step forward and use our moo formulation from eq 17 for the purpose of discussion we show in fig 6 the three dimensional pareto front for subset selection at n s 10 these are the pareto optimal subsets identified by the omopso algorithm each red sphere represents a multi objective compromise solution over the considered three objective functions i e for e d e l for 10 50 and 90 reliability levels furthermore we highlight in green the so called best compromise solution i e the subset selection that offers the shortest euclidean distance to the hypothetically ideal subset that would achieve zero error in all three reliability outlines additionally we show the projections of the pareto front onto the planes of the coordinate system to facilitate the visual evaluation of all bi objective trade offs to facilitate the analysis we shifted and re scaled the goal attainment levels of the pareto front to the interval 0 1 for each individual objective function first we inspect the conflict among the three selected objectives observe how each geological reliability level has a single objective optimal subset of realizations however each individually optimal subset does not offer the same optimality for the respective other two reliability levels for instance if we search through the gray dots on the bottom plane for the minimum error in e d e l 10 we find them at the rear end of the plane they are located at positions that are medium or worse for e d e l 50 when searching for these dots in the rear right plane we find them again at medium or worse error levels for e d e l 90 therefore one either needs an individual subset for each objective at the cost of multiplying the subsequent computer costs when working with j subsets for j objectives or one seeks for a more balanced distribution of errors e g via the best compromise solution second we loot at consequences in approximation errors on whpa maps in fig 7 again the white lines are the whpa outlines from the full ensemble for the 90 a 50 b and 10 c geological reliability outlines subfigures a to c show as red lines the corresponding approximations for n s 10 these approximations are single objective optimal for each individual reliability level i e the outmost outline in subfigure a is optimal in approximating the outmost white line the inner outline in subfigure c is optimal in approximating the inner white line at the same time one can see that the respective other red outlines are not that good i e they show larger approximation errors than in the case for which they have been optimized to show most stark contrasts the black lines in subfigures a to c show the 90 a 50 b and 10 c outlines computed from the respectively worst pareto solution shown in fig 6 in fig 7d we show the whpa outlines from the best compromise subset with n s 10 while each individually optimal subset in subfigures a to c is best in its respective outline and can be quite poor in the other two outlines the best compromise outline in fig 7d is good in all three outlines at the same time while being almost as good in each outline as each individual optimum if we compare visually the multi objective best compromise subset results in 7b with the results shown in fig 3b we see a similar approximation quality to the true geological reliability outlines however now we have this quality at a lowered computational cost since we decreased the n s value from 70 to 10 in our current analysis this discussion showed four things at the same time 1 indeed the approximation of several reliability levels by a single subset is multi objective 2 an individual optimization per reliability level is better per task but would come at a multiple of computing time 3 the summation strategy in our previous results may be a way out but 4 a direct moo strategy for cluster analysis brings more balanced approximation errors in terms of computational saving we cut down 95 5 of the total computational cost between our moo approximation and the fully integrated monte carlo solution 6 conclusions and outlook in this study we presented a methodology that reduces the cost of monte carlo simulation to quantify geological uncertainty in probabilistic transient whpa analysis our methodology suggests to perform cluster analysis based on optimization concepts hence we call it optimal cluster analysis oca oca selects a limited subset of hydraulic conductivity realizations that best approximate the overall information of a larger ensemble by optimizing decision relevant errors for doing so it needs to work with a proxy of the decision relevant errors otherwise one would have to solve the full problem to obtain an optimal clustering we visualize the selection in a problem specific feature space which accounts for pixel wise commonalities among all hydraulic conductivity fields geological features and commonalities in respective steady state whpa solutions transport features in the end our oca idea reduces the required number of realizations to represent the impact of geological uncertainty in this way further analysis like probabilistic transient whpa analysis and subsequent optimization tasks rodriguez pretelin and nowak 2019 can be performed at a fraction of computer time our conclusions are 1 in probabilistic whpa analysis clustering is a suitable strategy to account for the influence of geological uncertainty with out proposed oca approach we were able to reduce the computational time of probabilistic transient whpa analysis by a factor of 200 i e a reduction by 95 at acceptable approximation errors 2 using a problem specific feature space for clustering is beneficial even standard clustering performs remarkably well for whpa analysis when conducted in this feature space 3 performing the clustering via optimization to minimize decision relevant errors is beneficial over standard clustering a direct comparison of our proposed method showed a clear reduction in approximation errors over k medoid clustering in reliability based problems such as probabilistic whpa delineation statistical extremes matter more than a broad statistical representation and our oca approach accounts for this aspect per construction 4 when several approximations need to be done at the same time like whpa outlines for several reliability levels then the optimization of clustering can be performed multi objectively as well this leads to a balanced distribution of approximation errors across all tasks as an outlook for future research our oca idea could be applicable in many other reliability engineering tasks whenever a task specific feature proxy can be defined at a computationally cheap level declaration of competing interest one or more of the authors of this paper have disclosed potential or pertinent conflicts of interest which may include receipt of payment either direct or indirect institutional support or association with an entity in the biomedical field which may be perceived to have potential conflict of interest with this work for full disclosure statements refer to https doi org 10 1016 j advwatres 2022 104146 abelardo rodriguez pretelin reports financial support was provided by conacyt daad scholarship program acknowledgments the authors would like to express their gratitude for the financial support given by the cluster of excellence in simulation technology germany s excellence strategy exc 2075 390740016 at the university of stuttgart germany additionally we would like to thank an anonymous reviewer and alberto guadagnini for their constructive comments appendix here we provide the mathematical definition to simulate transient groundwater flow and contaminant transport for conservative tracers under transient flow conditions transient flow simulation we simulate transient groundwater flow using the same approach described in rodriguez pretelin and nowak 2018 they solve the groundwater flow equation described by a 1 s s ϕ t k ϕ q s x t in ω in eq a 1 k describes hydraulic transmissivity ϕ represents hydraulic head s s denotes specific storage and q s x t is the sink source term in the domain ω in the eq a 1 the boundary conditions are a 2 k ϕ n q t on γ 1 ϕ ϕ t on γ 2 here ϕ and q and ϕ are predefined heads and fluxes on dirichlet γ 2 and neumann γ 1 boundaries respectively n is the outward directed unit normal to γ where γ γ 1 γ 2 the specific solution technique is an extremely fast asymptotic approximation by a dynamic superpositioning of steady state solutions components more details about this transient simulator can be found in rodriguez pretelin and nowak 2018 then we simulate each whpa transient scenario in n r using the aforementioned simulator next we obtain each alternative steady state solution by solving eq a 1 using the standard galerkin finite element code as introduced by nowak et al 2008 transport simulation under transient flow conditions the simulation of contaminant transport for conservative tracers considering transient groundwater flow is given by the advection dispersion equation a 3 c t v c d c 0 in ω where c is concentration t is time v q n e is velocity q is darcy velocity n e is effective porosity assumed constant in this study and d is the hydromechanic dispersion tensor scheidegger 1954 given by a 4 d α t v d e i α l α t v v t v with longitudinal and transversal dispersivities α l and α t respectively effective diffusion coefficient d e and the identity matrix i eq a 3 is subject to the boundary conditions a 5 n v c n d c j on γ 1 a 6 c c on γ γ 1 here j is a prescribed normal flux density and c represents prescribed concentrations again as in rodriguez pretelin and nowak 2018 we use a transient particle tracking random walk solution technique in order to address contaminant transport simulation we utilize a lagrangian particle tracking approach due to its absence of numerical dispersion kinzelbach 1988 salamon and fern 2006 
180,a general approach to deal with parameter uncertainty in natural systems is to use ensembles of many parameter realizations however this might result in extremely expensive computational time especially when additional loops for transient simulation and for optimization are involved one possibility to mitigate computing time is to use few but well selected realizations that best represent the involved geological uncertainties e g by clustering techniques the goal of this paper is to address the search for representative realizations that best approximate the distribution and its tails of a model ensemble in our test application this ensemble is used to delineate wellhead protection areas whpas under transient flow conditions and subject to random heterogeneity of the aquifer our approach is based on clustering and proposes that the cluster medoids representatives should be optimized not for statistical representation in the space of some selected proxy metrics but for a minimum of decision relevant errors and if the underlying decision problem is multi objective then the clustering optimization can be made multi objective too in this way many subsequent analyses can be performed on the condensed set of representative scenarios that would be computationally too expensive otherwise even if distribution tails and extreme realizations are relevant we demonstrate the advantage of our clustering optimization methodology on a dynamic probabilistic whpa delineation and we compare its performance with a standard clustering analysis our results show that 1 in probabilistic transient whpa analysis clustering is a suitable technique to account for geological uncertainty 2 however clustering analysis should be based on optimization concepts rather than on simple medoid concepts and 3 of course it should use problem specific and decision relevant metrics for cluster optimization in our whpa application this leads to a more accurate representation of decision relevant statistical extremes 4 the additional extension to multi objective cluster selection probes to be a valid approach in multi objective whpa delineation 5 using our framework we reduce the computational cost of addressing highly expensive simulations keywords well catchment delineation groundwater protection transient flow conditions risk assessment multiobjective optimization machine learning clustering unsupervised learning 1 introduction typically in order to deal with geological uncertainty groundwater modelers routinely use an ensemble of many hydraulic conductivity realizations or other multiple representation approaches to capture the influence of uncertain hydrogeological conditions generally using monte carlo simulation stauffer et al 2005 in the example of wellhead protection area whpa analysis each of these realizations depicts a different hydraulic conductivity field that leads to distinctive contour lines and isolines of travel time towards a drinking water well haitjema 1995 this in turn leads to different outlines of water captured by the well within a given transport time called capture outline the straightforward analysis in such cases is statistical aggregation over the ensemble of capture outline realizations this aggregation provides a probabilistic whpa map with values ranging from 0 to 1 it expresses the probability of well pollution in case of spill events for each location on the map the final decision is to pick a reliability level and then choose the corresponding isoprobability line from the probabilistic whpa map as final whpa outline this manner of accounting for uncertainty in whpa analysis is called probabilistic whpa delineation enzenhoefer et al 2012 2014 rodriguez pretelin and nowak 2018 additionally when transient flow conditions are considered there is a frequentistic component for each location on the map to be part of a whpa outline in each realization and the procedure is called transient probabilistic whpa delineation the latter requires to specify both a geological reliability level and a transience related reliability level rodriguez pretelin and nowak 2018 2019 in such types of application the involved monte carlo simulations are already expensive as they trigger a loop over many model calls additionally the involved more complex analyses trigger even more loops nested inside or outside the original monte carlo loop in the case of transient probabilistic whpa delineation these additional loops are transient simulation of transport towards a well rodriguez pretelin and nowak 2018 time loop inside the monte carlo loop or an additional optimization of adaptive pumping rates rodriguez pretelin and nowak 2019 optimization loop around the monte carlo and time loop with this whpa analysis is not alone there are many robust optimization task with nested loops inside or outside a monte carlo loop generally in the area of robust optimization examples are robust optimization of remediation schemes robust optimization of oil extraction and robust design of co 2 or nuclear waste storage in the subsurface to name only a few thus it is tempting to cut down on the computational costs by a cheaper monte carlo approximation but without sacrificing too much statistical accuracy one possible strategy is to substitute the monte carlo loop by a limited set of aquifer realizations according to the modelers own experience and knowledge however this manual interpretation of geological uncertainty might bring bias into the overall result this could lead for instance to over confident management strategies that perform worse in practice than what was expected during the optimization and decision making a less subjective methodology for selecting representative subsets of realizations is unsupervised learning for example via clustering cluster analysis usually searches within a low dimensional feature representation of the ensemble for commonalities among realizations based on some distance measures in a lower dimensional feature space then the identified subset of model realizations one at the center of each cluster is used as a condensed yet comprehensive set of hypotheses to represent the relevant aspects of uncertainty at the limit of one cluster for each original realization cluster based uncertainty quantification converges back to the computational effort and accuracy of the full original monte carlo simulation for much smaller numbers of clusters cluster based analysis has been found by several authors see below to have a better accuracy per computational time compared to smaller monte carlo simulations there have been previous studies addressing cluster analysis to depict geological uncertainty through a subset of realizations mostly in the field of oil reservoir production for instance in the context of uncertainty quantification scheidt and caers 2009 combined kernel k means clustering with flow simulation to select a small number of representative realizations that represent relevant statistics for future oil production the same authors scheidt et al 2009 presented a distance kernel method to select a subgroup of realizations that represent ranges of uncertainty for time series of cumulative oil production in the context of robust optimization problems wang et al 2012 applied k means clustering they used the identified subset of realizations to search for robust optimal well placement solutions that maximize the expected oil production of the reservoir under study when aiming to optimize well control strategies for a similar purpose of robust optimization shirangi and mukerji 2012 used kernel clustering in all these studies the authors significantly reduced the computational cost of robust optimization by depicting geological uncertainty with a limited number of reservoir realizations however one problem remains if the selection of that limited set is not performed properly bias might arise that leads to improper uncertainty quantification sub optimal results and unforeseen risk scenarios this holds in probabilistic whpa analysis as well as in all other mentioned applications the problem can be divided into two parts defining the so called feature space and defining the selection rule among realizations within that feature space in the first part of the problem one has to define an appropriate lower dimensional feature space in which the clustering can be performed the low dimensionality is required in order to have meaningful expressions of distance e g euclidean distance which is the basis for defining similarity and dissimilarity among realizations the features underlying this feature space influence what realizations will be clustered together and hence will affect the overall clustering result this means that the features have to be problem specific and chosen properly recently shirangi and durlofsky 2016 concluded that flow based features of hydraulic conductivity realizations additional to straightforward conductivity based features was beneficial during the clustering despite the higher computational time spent for the additional flow simulations required to define these flow based features in the second part of the problem independently of the chosen feature space the selection of the clustering technique plays an important role most available clustering methods rely on centroid based strategies scheidt et al 2009 shirangi and durlofsky 2016 their alleged advantage is their robustness to noise and outliers as well as their wide availability e g many programming environments of language such as matlab seber 1984 have their own clustering packages and simplicity to implement in such techniques clusters are represented by their means or medoids which per definition has a central tendency this might contribute to a lack of representation for statistical extremes although tails and extremes are often the most decision relevant aspects a different strategy is to propose that the cluster representatives should be optimized not for statistical representation in the feature space but for a minimum of decision relevant errors via optimization analysis cai et al 2020 for instance one possibility is to minimize the discrepancy between reliability aspects of a selected subset and the solution obtained after evaluating the full monte carlo ensemble of course these decision relevant features and reliability aspects must be approximated on a cheaper but related problem otherwise the subset selection would require solving the full problem first the contribution of this study is to reduce the computational cost of addressing highly expensive monte carlo simulations for transient problems and or within optimization problems this is done by detecting a limited subset of realizations that best represent the geological uncertainty of a model towards a specified decision criterion while almost all clustering techniques use some sort of optimization e g minimal variance within the clusters our novelty lies in using decision relevant criteria when selecting the cluster representatives if the targeted decision problem is multi objective then the optimal clustering will become multi objective too while multi objective clustering concepts exist in the literature e g gong et al 2017 they do not build up on the idea of decision relevant objectives in our whpa application example the decision relevant criteria used for optimal clustering relate to minimal errors in delineated wpha outlines although specific choices of implementation are done in our application example our optimal selection framework is independent of random field parameterization e g principal component analysis and of algorithmic choices for numerical simulation and optimization it is also in its optimal selection idea independent of our whpa application the only thing specific to our application is that we propose a set of decision relevant selection features that are targeted at reliable multi objective whpa delineation to illustrate our framework we speed up probabilistic whpa analysis in a transient transport context however the selection of representative realizations has to be achieved without running the expensive transient analysis i e in cheaper pre processing of the most expensive step since geological uncertainty turned out to have a higher influence on whpa delineation than uncertain transient flow conditions rodriguez pretelin and nowak 2018 a much cheaper steady state analysis is still near optimal to a transient cluster selection in this way we can reduce the computational costs to find problem specific features and then limit the transient flow simulations to optimally selected k field realizations to the best knowledge of the authors there is only one study addressing clustering in groundwater flow modeling alzraiee and garcia 2012 concluded that for the study under analysis 25 of the total number of realizations was enough to achieve approximately the ensemble statistical response we aim to deepen the use of clustering techniques in groundwater flow modeling evaluating the effects in transport modeling particularly for whpa analysis and to achieve a higher efficiency than alzraiee and garcia 2012 in a more complex problem the remainder of this paper is structured as follows in section 2 we present a brief overview of whpa analysis in the presence of uncertain geological variability and transient flow conditions governing equations and numerical solvers are provided in the appendix in section 3 we present our formulation for clustering analysis based on multi objective optimization concepts in section 4 we describe the whpa test case scenario in section 5 we provide results and corresponding discussions here we compare the whpa accuracy and the overall computing time between our proposed optimization based clustering and a standard clustering approach we also demonstrate the benefits of multi objective clustering for multi objective whpa analysis finally in section 6 we present the conclusion and outlook of our study 2 transient probabilistic whpa analysis a usual strategy followed by many national water safety guidelines to prevent groundwater pollution in drinking water well catchments is to define wellhead protection areas whpa these areas represent zones of concern that might pose a risk due to land surface activities to the produced drinking water quality a typical criterion to delineate whpas relies on time of travel capture areas defined through the time it would take a contaminant to reach a drinking water well often in order to reduce the complexity when using model based solutions some model simplifications are implemented among these the two most frequent ones used are 1 homogeneity in the pattern of subsurface hydrogelogic variables and 2 the delineation of capture outlines under steady state flow conditions however the use of these simplifications might lead to a poor representation of the real groundwater flow behavior and therefore to unsafe whpa delineations the impact on whpa delineations due to natural geological variability franzetti and guadagnini 1996 has been well addressed in the literature enzenhoefer et al 2012 the classical approach to deal with uncertain geological conditions is via probabilistic methods e g by monte carlo simulation here each monte carlo realization uses a different randomly generated hydraulic conductivity field rodriguez pretelin and nowak 2018 extended the concept of probabilistic whpa delineation to integrate the influence of uncertain transient flow conditions the resulting probabilistic whpa solution depicts the joint probability distribution of pixel wise whpa membership under uncertain aquifer parameters and uncertain transient flow conditions the transient probabilistic whpa analysis can be solved with a backward in time formulation of advective dispersive transport in the lagrangian framework this means to use a reverse particle tracking random walk where the simulated release of particles starts at the pumping well to reflect the effect of transient flow conditions over a simulation period t particle release has to be continuous for temporal discretization of this continuous release batches of particles are released at time steps t j 0 t j 1 n j then these particles are traced backward in time until each one of them reaches a critical life time for whpa analysis τ c r i t e g τ c r i t 365 d a y s using the travel time map generated after backtracking each particle batch j a boolean yes no map f j k x i is generated per release time t j 1 f j k x i 1 if τ x i t j θ k α t j t τ c r i t 0 otherwise where f j k 0 1 indicates whether a map pixel at position x i represents a risk to the well f 1 if yes f 0 if no in case of a spill event at location x i the index k denotes that the resulting map is different for each monte carlo realization k 1 n r with randomly drawn hydrogeological parameter sets θ k that influence flow and transport e g porosity or hydraulic conductivity field the index j denotes that the resulting map depends on reverse release time t j i e on the arrival time at the well due to transient changes in pumping rate conditions or in the hydraulic groundwater gradient the transient changes of flow are driven by a time dependent vector of flow related boundary conditions source sink terms and pumping rates α t j t then by analyzing how often over the release times t j each map pixel defines a risk to the pumping well a frequency map f k x i of whpa membership is obtained 2 f k x i 1 n j j 1 n j f j k x i the obtained frequency map still per realization k 1 n r assumes values between zero and one indicating the fraction of time in which the well is susceptible to a contaminant spill at position x i in short f k x i resembles a transience related risk map next this map is converted to a transience related reliability map r k x i 3 r k x i 1 f k x i higher values in r k e g 1 represent smaller temporal windows for possible contamination e g never and hence larger reliability to obtain a recommended whpa outline per realization k we transform r k x i to a binary map b k x i that labels all pixels with a less than required temporal reliability r k r t c r i t for inclusion into the whpa 4 b k x i 1 if r k x i r t c r i t 0 otherwise where the transience related or temporal reliability level r t c r i t is to be chosen by a decision maker the actual choice of level will depend on her or his risk aversion and on the willingness at accept larger whpas finally after statistical aggregation over all n r realizations we get the overall probabilistic whpa map p x i 5 p x i 1 n r k 1 n r b k x i the map p x i resembles a risk map over all possible spill locations x i it expresses the probability across all geological realizations of the aquifer that a contaminant spill at location x i would cause a quality problem at the well that lasts longer than a fraction 1 r t c r i t of the year thus for a given value of r t c r i t the probabilities p x i resemble a risk caused by geological uncertainties among the different aquifer realizations k in the end the decision maker picks a geology related reliability level r g c r i t again according to risk aversion which converts the probabilistic whpa map p x i into a binary whpa outline w x i 6 w x i 1 if p x i 1 r g c r i t 0 otherwise this second decision parameter r g c r i t is called geology related reliability level because it addresses the geological uncertainties inherent in p x i like for r t c r i t the greater the chosen value of r g c r i t the larger the resulting whpa outline and the greater the safety against geological uncertainty to explicitly denote the dependence of w x i on the underlying decision parameters r t c r i t and r g c r i t we write 7 w x i w x i r t c r i t r g c r i t 3 proposed approach for objective oriented clustering analysis in this section we describe our novel methodology proposed in this study like almost all clustering ideas our clustering analysis relies on optimization based strategies to find a subset of representative model realizations the difference lies in formulating optimization criteria that are aligned with decision relevant predictive errors rather than a nest possible statistical representation in the feature space for brevity we call it optimal clustering analysis oca we seek to find a subset n s with size n s of realizations that chosen from an original monte carlo ensemble n r of size n r approximates a statistic of interest when aggregated for decision analysis van essen et al 2009 in the case of probabilistic whpa analysis the whpa map w s obtained by cluster based analysis should be close to the whpa map w r obtained after aggregation over all n r k field realizations 8 w s x i r t c r i t r g c r i t w r x i r t c r i t r g c r i t for a given pair r t c r i t r g c r i t where the full monte carlo ensemble n r of size n r is used for computing w r and only the selected subset n s of size n s is used for computing w s in the eqs 1 to 7 in the following we discuss the ingredients of our oca a feature space that serves to characterize the n r realizations for clustering along with their cheaper replacement by steady state instead of transient simulations section 3 1 the optimization approach for subset selection section 3 2 and its multi objective extension section 3 2 2 3 1 features for low dimensional representation of realizations in whpa analysis clustering needs a definition of similarity between realizations so that similar realizations can be clustered together this similarity is commonly defined as small distances in a so called feature space boutsidis and mahoney 2009 the feature space must be low dimensional because with increasing dimension of a feature space the number of realizations or data items that populate that space in a meaningful manner would have to increase exponentially bellman 2015 steinbach et al 2004 without sufficiently large data sets distances and hence similarities and clusters become meaningless which features are important or how many features to use feature selection is a problem dependent decision our proposed oca method will not be designed to minimize distances in the feature space as standard clustering methods would instead it will minimize decision relevant errors thus the main exercise for oca is to think about a proxy for decision relevant errors nevertheless we first look at a meaningful feature space for two reasons first we need it for fair conditions when comparing oca with standard clustering techniques second discussing features is a fruitful ground to discuss the proxies for optimization later on for application to whpa analysis we combine one generic feature with two problem specific features as a generic feature we use a simple euclidean distance as already used by wang et al 2012 9 k d i s t k ω k k x k ˆ 2 d x 1 2 which is the euclidean distance between each hydraulic conductivity realization k k and the ensemble and volume average k ˆ over all k field realizations it serves to differentiate hydraulic conductivity fields as such regardless of their action in flow transport and whpa delineation as first problem specific feature we use the size a a r e a k of realization wise whpas 10 a a r e a k ω b k x d x ω a k x d x where ω is the spatial domain under analysis b k x is the binary map defined in eq 4 and the approximation by a k x will be defined below computing a a r e a k from b k for all k 1 n r realizations would require transient simulation across all n r realizations fortunately it was found in past studies that transient flow has a much smaller influence on whpa delineation than geological uncertainty rodriguez pretelin and nowak 2018 hence we can approximate b k reasonably well for the purpose of clustering by binary maps a k found via steady state simulations 11 a k x i 1 if τ x i θ k α 0 τ c r i t 0 otherwise where τ x i θ k α 0 is the travel time towards the well simulated under steady state conditions i e with static drivers α 0 instead of time dependent drivers α t j t this collapses the flow simulation to a steady state solve and the reverse particle tracking to a single batch of particles hence the computer time divides by the number of time steps in the transient simulation and we complete the approximation provided in eq 10 as second problem specific feature we apply the same strategy as used for k d i s t to the steady state whpa maps a k x i from eq 11 12 a d i s t k ω a k x a ˆ 2 d x 1 2 finally all three feature values k d i s t a a r e a and a d i s t are normalized with their respective maximum magnitude so that they fall into the interval 0 1 they serve to represent all n r realizations and their simulation outcomes in a three dimensional problem specific feature space that we will use for clustering section 5 1 will illustrate this feature space 3 2 optimal cluster analysis for minimal decision relevant errors the central idea of our oca approach is that instead of selecting subsets based on some statistical representation as in conventional clustering approaches we seek for a minimum of decision relevant errors in our whpa application this means we seek the smallest possible approximation error of resulting whpa outlines for this we use as objective function an error measure that evaluates the disagreement in eq 8 our proposed approach is to compute over some problem domain ω an error measure that quantifies the total decision error induced by the approximation in eq 8 in our case we use the error e d e l in whpa delineation as error measure 13 e d e l n s r t c r i t r g c r i t ω 1 w s x i r t c r i t r g c r i t n s w r x i r t c r i t r g c r i t d x e d e l captures both the false positive and the false negative errors of whpa decisions this is the whpa extent that the clustering based solution w s fails to cover false negative and the excess area consumed by w s without providing any additional protection false positive when compared to w r i e to the full monte carlo whpa solution once again using this error measure would require to solve the full transient problem first before beginning even to cluster therefore w r and w s in eq 13 must be approximated on a cheaper but related problem thus we replace once again the transient transport problems hidden in the definition of w s x i and w r x i by their steady state counterpart we replace them by v s x i and v r x i respectively 14 e d e l n s r t c r i t r g c r i t ω 1 v s x i r t c r i t r g c r i t n s v r x i r t c r i t r g c r i t d x where v s and v r are obtained through replacing b k x i in eq 4 by a k x i as defined in the previous section in section 5 2 we will show the clustering based whpa results obtained with steady state features and with a steady state based objective function are indeed good approximations 3 2 1 single objective optimization analysis according to our oca idea we now want to choose the subset n s of size n s such that we minimize the decision relevant errors as approximated by eq 14 15 n s opt n s r t c r i t r g c r i t arg min n s n e d e l n s r t c r i t r g c r i t here n s opt n s r t c r i t r g c r i t is the optimal clustering selection of size n s that minimizes the total delineation error e d e l according to eq 14 for a specified pair of reliability levels r t c r i t and r g c r i t the search for n s o p t acts over all n s n where n includes all possible subset selections of size n s from the full monte carlo ensemble n r of size n r each obtained representative realization has the same importance i e when aggregating over the obtained subset we do not implement weight factors van essen et al 2009 this formulation is a single objective optimization problem as we have a unique objective function for clustering this is the case whenever the two reliability levels r t c r i t and r g c r i t are fixed and given however the approximation target specified by eq 14 changes with different reliability levels a whpa decision maker typically can decide on reliability levels only after seeing their whpa consequences such as total area demand this is a typical situation of multi objective decision making also the decision maker may want to establish different protection levels for different whpas at different reliability levels therefore we wish to avoid the dependence of n s opt on a single pair of reliability levels for example we can use a set of j pairwise reliability levels e g 10 50 and 90 for geological and for transience related reliability and sum up the corresponding objective functions 16 n s opt n s arg min n s n j 1 j e d e l n s r t c r i t j r g c r i t j 3 2 2 multi objective optimization analysis the summation of objective functions from different reliability levels proposed above maintains the character of a single objective optimization problem however it will lead to a non balanced distribution of approximation errors among the different specified reliability levels for instance there is a higher contribution to the approximation error from higher reliability levels because they depend more on geological extremes see section 5 3 for illustration the way out is to treat a set of reliability levels as mutually competitive objectives this will lead to a multi objective optimization problem marler and arora 2004 for the optimal selection in clustering then the competition between approximation qualities is laid open and the modeler or decision maker can decide herself on a balanced distribution of errors compare section 5 4 hence we extend the single objective oca formulation to a multi objective optimization moo formulation 17 n s opt n s arg min n s n e d e l n s r t c r i t j r g c r i t j j where e d e l j is the vector of approximation errors e d e l for different reliability levels j 1 j in section 5 4 we will show that subset solutions of same size n s in fact lead to more favorable error reduction when implementing this multi objective analysis to solve our optimization problem and obtain the set of pareto optimal solutions for subset choice after feature extraction see section 3 we use among several possible optimization algorithms e g boussaïd et al 2013 dokeroglu et al 2019 and hussain et al 2019 the framework for optimal multi objective particle swarm optimization omopso as developed by sierra and coello coello 2005 the soo problem is solved easily by a plain particle swarm optimization 4 test case scenario we test our methodology using a rectangular 3d domain that resembles a single geological layer on top the domain is semi confined by a leaky aquifer that permits recharge see fig 1 this synthetic model has a size of 5 250 m 5 250 m 60 m and is equally discretized d x d y d z 15 m we use a well field that is located in the eastern part of the model represented by a row of eight fully penetrating wells each of them having a separation distance of 160 m between each other fig 1 illustrates the model domain and features to represent transiency in groundwater flow the model uses four transient conditions on seasonal scale a changes in pumping rates b changes in the natural recharge to the groundwater c changes in the strength of the regional hydraulic gradient and d changes in the regional groundwater flow direction we depict seasonal changes with a yearly sinusoidal pattern of given frequency ω π year and phase shift values φ n 0 as discussed in rodriguez pretelin and nowak 2018 in our model set up we oppose the impact of pumping and recharge to represent larger water demand during the dry season for this we use a phase shift value φ n 180 for groundwater recharge to outline whpas for 360 days of travel time to the well we set the total simulation time to 720 days and trace all particles backward in the flow field until the whpa relevant lifetime of τ 360 days for transport simulation we release a new batch of particles at the well locations every day δ t j 1 day a specific storage of 1 1 0 6 is assumed in this study we set groundwater flow behavior to follow the mean transient behavior α to simulate steady state conditions all parameters relevant for flow and transport are provided in table 1 while governing equations and numerical schemes are provided in appendix in our model randomly heterogeneous k fields are modeled as random space function governed by the matérn covariance function minasny and mcbratney 2005 with the parameters listed in table 1 additionally to resemble uncertainty levels as in cases where some hydrogeological data exist each k field realization is conditioned to point like hydraulic conductivity measurements located at ten different sampling locations of a initial synthetic truth realization the spatial position of the sampling locations are highlighted with black squares in fig 1 we generate each conditioned k field realization with the fft based geostatistical tool described in fritz et al 2009 5 results and discussion for the sake of demonstration we implement the numerical example introduced in section 4 with n r 2 000 monte carlo realizations and define the resulting ensemble n r to be the true underlying probability distribution of all uncertain parameters thanks to this assumption n r can serve as exact reference solution then we illustrate and evaluate our oca method we also compare it against k medoid clustering as example of a standard clustering method we do these analyses using the application scenario provided above using both the soo and moo formulations defined in section 3 1 we use our second type of soo analysis eq 16 with three geological reliability levels 10 50 and 90 all combined with a transience related reliability level of 100 with the corresponding subsets n s of different sizes n s we perform whpa analysis based on the same set of reliability levels and analyze the resulting delineation errors 2 then we use a moo analysis eq 17 with the same set of reliability levels to highlight the advantages of more balanced approximation errors 5 1 low dimensional representation using geological and transport features first we present in fig 2 the low dimensional representation of all n r 2000 k field realizations black spheres in our three dimensional and problem specific feature space the feature space consists of the geological k d i s t and transport features a d i s t and a a r e a from section 3 1 as can be seen from the black spheres rather than depicting well defined clusters in the low dimensional feature space the full ensemble n r forms a densely packed cloud in the feature space in case a groundwater modeler had to manually select a specified number of representatives the solution would absolutely not be obvious this also implies that the specific choice of clustering method does matter the subset selection for n s 100 from single objective clustering according to eq 16 is shown as red spheres note that the selected representatives n s are well distributed in the feature space without focusing too much on the densely populated space this can be seen well in the 2d projections to the planes of the coordinate system if compared to a subset n s of same size n s 100 obtained through k medoid clustering green spheres in fig 2 we cannot see any particular difference in the distribution pattern this is merely a first check showing that our oca method leads to a plausible selection the better approximation for the decision task will be discussed in the upcoming sections 5 2 quality of oca approximated whpa outlines and comparison to k medoid how does a transient whpa solution obtained from a much smaller subset selected under steady state differ from the full ensemble based whpa delineation how much better are the results based on oca compared to those obtained by standard clustering to investigate these questions fig 3 features whpa delineations for the 10 50 and 90 geological reliability outlines we are still using the single objective oca in specific we show the whpa outlines obtained from the full ensemble white outlines and corresponding whpa outlines based on clustering red outlines we do this comparison both with our oca upper row and with k medoids clustering lower row and for subsets of size 10 left 70 center and 100 right a more fine grained convergence analysis will be shown in section 5 3 in fig 3 each black cross indicates a pumping well location inspecting the approximated whpa outlines from left to right we see that increasing the size of n s reduces the mismatch between the approximated red outlines and the full ensemble white outlines especially for the 90 geological reliability delineation this is true for both implemented clustering methodologies however when we compare visually the agreement of the white and red outlines between the two clustering methods for increasing n s comparing the top row and the bottom row we observe a clear advantage for the oca method for instance when comparing the optimized solution in the upper row for n s 70 center column 3 5 of the total ensemble with the corresponding k medoid solution in the lower row we observe a closer agreement for the 10 and 50 geological reliability outlines this is not achieved in the bottom row even by increasing n s to 100 although this analysis is specific to a single case study it allows us to conclude two things 1 by using problem specific features even a simple clustering technique here k medoids can be remarkably good for the task at hand already with very small subsets 2 being based on optimization our oca framework can outperform k medoids 5 3 heuristic convergence analysis in decision errors in order to assess convergence beyond the visual impression from section 5 2 we evaluate the whpa disagreement e d e l eq 14 for the three different reliability levels correspondingly fig 4 shows the convergence for the 10 blue 50 red and 90 black geological reliability levels for values of n s between 1 and 200 for easier interpretation we show the percent reduction in e d e l from the error level at n s 1 towards the full solution of n r 2000 within the shown range a size of n s 1 indicates that the data cloud see fig 2 is represented only by a single realization at n s 200 10 of the entire ensemble are used overall the three geological reliability delineations show a similar convergence behavior all three show an initially steeper increment in the reduction of e d e l which stabilizes when n s 70 although all three reliability outlines show similar behavior we can notice a faster improvement in error reduction for the 10 reliability outline when compared to the other two reliability levels this behavior can be attributed to the difficulty for larger reliability levels to find a proper combination of subset scenarios that represent the geological extremes thus if highly accurate analysis requires to approximate probabilistic transient whpa delineations at high reliability levels there is an obvious need for choosing a greater number of clusters next we compare the convergence of our oca to that of monte carlo simulation and of standard k medoid clustering thus we additionally run the k medoid clustering for n s 1 200 and we perform smaller monte carlo simulations for the latter we perform a resampling with replacement of n s randomly drawn realizations from the full set of n r 2000 and then perform a whpa analysis to be statistically representative we repeat this resampling procedure 2000 times fig 5 shows the resulting speed accuracy curves for 10 left 50 center and 90 right geological reliability levels for sizes of n s between 1 and 200 the repeated monte carlo results gray lines are also represented by their average line red while k medoid results are shown in blue and oca is shown in green accuracy is shown as error of delineation e d e l as defined in eq 14 normalized with the respective a a r e a value of the reference solution with n r 2 000 first when inspecting the performance of the random repetitions in the monte carlo variant we can see a high variability in the e d e l values this reflects the typical random error behavior of monte carlo simulation however once we compare the monte carlo mean performance red and the two clustering techniques blue and green we can clearly see that for all n s values our methodology always gives a much smaller error while k medoid only has a small yet consistent advantage over monte carlo additionally we see that the advantage of standard clustering blue over monte carlo simulation starts only for n s 160 thus although standard clustering was shown to be useful in related applications in the literature it does not strongly outperform plain monte carlo analysis in our application case this is because we have a reliability related task where extremes matter and do not seek to approximate a simple ensemble mean our optimization based clustering oca accounts for this aspect per construction consequently for those reliability levels where the identification of extremes has higher influence e g 50 and 90 we observe that our methodology shows the strongest improvement over both competitors 5 4 multi objective clustering for more balances errors in the approximations up to here we used the summed up soo analysis eq 16 to optimally select a single subset that approximates all three features reliability levels well however we also saw in our results so far that the different reliability levels have slightly different convergence behavior in relative errors also they are subject to different absolute error levels they may have similar relative errors but they also have different base sizes a a r e a hence optimizing the subset selection under the sum of errors does not necessarily lead to a balanced distribution of errors across the different reliability levels in order to address this problem we move a step forward and use our moo formulation from eq 17 for the purpose of discussion we show in fig 6 the three dimensional pareto front for subset selection at n s 10 these are the pareto optimal subsets identified by the omopso algorithm each red sphere represents a multi objective compromise solution over the considered three objective functions i e for e d e l for 10 50 and 90 reliability levels furthermore we highlight in green the so called best compromise solution i e the subset selection that offers the shortest euclidean distance to the hypothetically ideal subset that would achieve zero error in all three reliability outlines additionally we show the projections of the pareto front onto the planes of the coordinate system to facilitate the visual evaluation of all bi objective trade offs to facilitate the analysis we shifted and re scaled the goal attainment levels of the pareto front to the interval 0 1 for each individual objective function first we inspect the conflict among the three selected objectives observe how each geological reliability level has a single objective optimal subset of realizations however each individually optimal subset does not offer the same optimality for the respective other two reliability levels for instance if we search through the gray dots on the bottom plane for the minimum error in e d e l 10 we find them at the rear end of the plane they are located at positions that are medium or worse for e d e l 50 when searching for these dots in the rear right plane we find them again at medium or worse error levels for e d e l 90 therefore one either needs an individual subset for each objective at the cost of multiplying the subsequent computer costs when working with j subsets for j objectives or one seeks for a more balanced distribution of errors e g via the best compromise solution second we loot at consequences in approximation errors on whpa maps in fig 7 again the white lines are the whpa outlines from the full ensemble for the 90 a 50 b and 10 c geological reliability outlines subfigures a to c show as red lines the corresponding approximations for n s 10 these approximations are single objective optimal for each individual reliability level i e the outmost outline in subfigure a is optimal in approximating the outmost white line the inner outline in subfigure c is optimal in approximating the inner white line at the same time one can see that the respective other red outlines are not that good i e they show larger approximation errors than in the case for which they have been optimized to show most stark contrasts the black lines in subfigures a to c show the 90 a 50 b and 10 c outlines computed from the respectively worst pareto solution shown in fig 6 in fig 7d we show the whpa outlines from the best compromise subset with n s 10 while each individually optimal subset in subfigures a to c is best in its respective outline and can be quite poor in the other two outlines the best compromise outline in fig 7d is good in all three outlines at the same time while being almost as good in each outline as each individual optimum if we compare visually the multi objective best compromise subset results in 7b with the results shown in fig 3b we see a similar approximation quality to the true geological reliability outlines however now we have this quality at a lowered computational cost since we decreased the n s value from 70 to 10 in our current analysis this discussion showed four things at the same time 1 indeed the approximation of several reliability levels by a single subset is multi objective 2 an individual optimization per reliability level is better per task but would come at a multiple of computing time 3 the summation strategy in our previous results may be a way out but 4 a direct moo strategy for cluster analysis brings more balanced approximation errors in terms of computational saving we cut down 95 5 of the total computational cost between our moo approximation and the fully integrated monte carlo solution 6 conclusions and outlook in this study we presented a methodology that reduces the cost of monte carlo simulation to quantify geological uncertainty in probabilistic transient whpa analysis our methodology suggests to perform cluster analysis based on optimization concepts hence we call it optimal cluster analysis oca oca selects a limited subset of hydraulic conductivity realizations that best approximate the overall information of a larger ensemble by optimizing decision relevant errors for doing so it needs to work with a proxy of the decision relevant errors otherwise one would have to solve the full problem to obtain an optimal clustering we visualize the selection in a problem specific feature space which accounts for pixel wise commonalities among all hydraulic conductivity fields geological features and commonalities in respective steady state whpa solutions transport features in the end our oca idea reduces the required number of realizations to represent the impact of geological uncertainty in this way further analysis like probabilistic transient whpa analysis and subsequent optimization tasks rodriguez pretelin and nowak 2019 can be performed at a fraction of computer time our conclusions are 1 in probabilistic whpa analysis clustering is a suitable strategy to account for the influence of geological uncertainty with out proposed oca approach we were able to reduce the computational time of probabilistic transient whpa analysis by a factor of 200 i e a reduction by 95 at acceptable approximation errors 2 using a problem specific feature space for clustering is beneficial even standard clustering performs remarkably well for whpa analysis when conducted in this feature space 3 performing the clustering via optimization to minimize decision relevant errors is beneficial over standard clustering a direct comparison of our proposed method showed a clear reduction in approximation errors over k medoid clustering in reliability based problems such as probabilistic whpa delineation statistical extremes matter more than a broad statistical representation and our oca approach accounts for this aspect per construction 4 when several approximations need to be done at the same time like whpa outlines for several reliability levels then the optimization of clustering can be performed multi objectively as well this leads to a balanced distribution of approximation errors across all tasks as an outlook for future research our oca idea could be applicable in many other reliability engineering tasks whenever a task specific feature proxy can be defined at a computationally cheap level declaration of competing interest one or more of the authors of this paper have disclosed potential or pertinent conflicts of interest which may include receipt of payment either direct or indirect institutional support or association with an entity in the biomedical field which may be perceived to have potential conflict of interest with this work for full disclosure statements refer to https doi org 10 1016 j advwatres 2022 104146 abelardo rodriguez pretelin reports financial support was provided by conacyt daad scholarship program acknowledgments the authors would like to express their gratitude for the financial support given by the cluster of excellence in simulation technology germany s excellence strategy exc 2075 390740016 at the university of stuttgart germany additionally we would like to thank an anonymous reviewer and alberto guadagnini for their constructive comments appendix here we provide the mathematical definition to simulate transient groundwater flow and contaminant transport for conservative tracers under transient flow conditions transient flow simulation we simulate transient groundwater flow using the same approach described in rodriguez pretelin and nowak 2018 they solve the groundwater flow equation described by a 1 s s ϕ t k ϕ q s x t in ω in eq a 1 k describes hydraulic transmissivity ϕ represents hydraulic head s s denotes specific storage and q s x t is the sink source term in the domain ω in the eq a 1 the boundary conditions are a 2 k ϕ n q t on γ 1 ϕ ϕ t on γ 2 here ϕ and q and ϕ are predefined heads and fluxes on dirichlet γ 2 and neumann γ 1 boundaries respectively n is the outward directed unit normal to γ where γ γ 1 γ 2 the specific solution technique is an extremely fast asymptotic approximation by a dynamic superpositioning of steady state solutions components more details about this transient simulator can be found in rodriguez pretelin and nowak 2018 then we simulate each whpa transient scenario in n r using the aforementioned simulator next we obtain each alternative steady state solution by solving eq a 1 using the standard galerkin finite element code as introduced by nowak et al 2008 transport simulation under transient flow conditions the simulation of contaminant transport for conservative tracers considering transient groundwater flow is given by the advection dispersion equation a 3 c t v c d c 0 in ω where c is concentration t is time v q n e is velocity q is darcy velocity n e is effective porosity assumed constant in this study and d is the hydromechanic dispersion tensor scheidegger 1954 given by a 4 d α t v d e i α l α t v v t v with longitudinal and transversal dispersivities α l and α t respectively effective diffusion coefficient d e and the identity matrix i eq a 3 is subject to the boundary conditions a 5 n v c n d c j on γ 1 a 6 c c on γ γ 1 here j is a prescribed normal flux density and c represents prescribed concentrations again as in rodriguez pretelin and nowak 2018 we use a transient particle tracking random walk solution technique in order to address contaminant transport simulation we utilize a lagrangian particle tracking approach due to its absence of numerical dispersion kinzelbach 1988 salamon and fern 2006 
181,a novel numerical method was developed to evaluate the effect of the aperture heterogeneity of individual fractures on fluid flow through three dimensional discrete fracture networks dfns first the rock fractures are modelled as circular discs with sizes orientations and positions following exponential fisher and uniform distributions respectively isolated fractures clusters that make no contribution to fluid flow through the dfn were then removed by optimization programming using breadth optimization and deep optimization algorithms subsequently individual fractures with heterogeneous apertures were developed using successive random addition algorithms after that fracture networks were triangulated and the reynolds equations were solved for fluid dynamics computations the verification showed that the developed method provides advantages in computational accuracy and efficiency finally the influence of the aperture heterogeneity of individual fractures on fluid flow through a dfn was evaluated with the proposed method for comparison dfn models with identical mechanical apertures dfn i and another model with heterogeneous apertures dfnh were developed the results show that a preferential flow phenomenon appeared in both the dfn i and dfnh models however owing to the aperture heterogeneity of the individual fractures the results of the dfnh model were more substantial than those of the dfn i model this preferential flow phenomenon would be weakened by an increase in either the mechanical aperture or the fracture density the results also showed that the permeability difference between the dfn i and dfnh models was obvious for dfn models with small apertures and low fracture densities but this permeability discrepancy decreased with increasing mechanical aperture or fracture density therefore a critical mechanical aperture exists for a dfn model with a specified fracture density beyond this threshold the influence of aperture heterogeneity within individual fractures on fluid flow can be neglected and the dfn i model can be selected to replace the dfnh model for efficient modelling and computation keywords discrete fracture network seepage path aperture heterogeneity reynolds equation permeability nomenclature a fracture aperture a constant b constant d diameter of the fracture d min minimum diameter d max maximum diameter d fractal dimension di distance from the centre point of disk to intersection line em mechanical aperture of fracture f body force vector g acceleration of gravity h hurst exponent heq equivalent hydraulic aperture hi hydraulic aperture of the ith fracture h k f the trace of head k equivalent permeability of dfns ks numerical result of permeability kt theoretical result of permeability l the length along flow direction of dfns model l the total length in the direction of fluid flow li the projected length of fracture in the direction of fluid flow n d the frequency of fractures with diameters from d min to d n k f the normal unit vector on the boundary sk of the fracture ω f qglobe total flow rate of dfns model qlocal flow rate of per unit fracture width q flow rate in fracture r constant s cross sectional area ts hydraulic conductivity of fracture u dynamic viscosity u the velocity vector of fluid v k f flow velocity α power law index θ angular deviation from the mean vector θ 1 dip angle θ 2 dip direction angle ρ fluid density κ the degree of dispersion of orientation λ proportionality factor ε relative error between the theoretical and numerical result of permeability ϕ i the inclination of the ith fracture the mathematical expectation σ2 variance p pressure gradient δp pressure difference between the inlet and outlet boundary h hydraulic gradient γ in fluid inlet boundary γ out fluid outlet boundary γ imp impermeable boundary γ f fracture edge 1 introduction fluid flow through fractured rocks has attracted increasing attention for the purpose of either stability or production in many rock engineering applications such as dam foundations subsurface pollutant migration and oil and gas exploitation hyman et al 2015 senent et al 2013 continuous methodologies such as stochastic continuum neuman 2005 and dual multiple continua zhang and yin 2014 in which fracture and matrix are regarded as a continuous medium provide a phenomenological description of fluid flow in a large domain of fractured rocks however capturing permeability anisotropy is limited due to the heterogeneity of fracture apertures as a result a representative element volume rev may not exist hitchmough et al 2007 in contrast a discrete fracture network dfn has the advantage of explicitly describing the orientation position connectivity and geometric morphology within fractures ishibashi et al 2012 the permeability of rock fractures is usually several orders of magnitude higher than that of the rock matrix playing a dominant role in fluid flow through fractured rocks baghbanan and jing 2008 de dreuzy et al 2002 conventionally the parallel plate assumption of individual fractures has been made in dfn modelling however natural fractures are typically rough and the aperture variation in rough walled individual fractures has a significant influence on the fluid flow behaviour therefore an accurate characterization of the geometrical morphology of individual fractures of rock fracture networks is crucial for the evaluation of permeability and the factors that influence fluid flows through fractured rocks berkowitz 2002 rock fractures were originally simplified to two dimensions 2d due to insufficient three dimensional 3d measurement information in characterizing the geometric topological features of dfn models and computational limitations liu et al 2018 zhao et al 2011 the accuracy of 2d models in permeability prediction has been continuously improved in theory laboratory experiments and numerical calculations leung and zimmerman 2012 ren et al 2017a however as a slice from 3d models a 2d model cannot easily characterize the real geometric topology of rock fractures for example some fractures can be isolated in 2d models but may be connected with other fractures in 3d models bogdanov et al 2003 gonzalez garcia et al 2000 therefore 2d models can underestimate the permeability of fractured rocks lang et al 2014 and 3d models have significant advantages for precisely describing the spatial position orientation and connectivity of fracture networks erhel et al 2009 zhang and yin 2014 in 3d dfn modelling individual fractures are conventionally represented by 2d discs consisting of two smooth parallel plates baecher and lanney 1978 long et al 1985 with the further assumption of laminar flow a cubic law has been applied to govern the fluid flow through parallel plate fractures such simplification facilitates dfn model construction but it ignores the influence of aperture heterogeneity of individual fractures on the fluid flow process and permeability estimation frampton et al 2019 makedonska et al 2016 to overcome this drawback a boundary element method has been used to describe fluid flow in individual fractures but the number of fractures in dfn models is limited andersson and dverstorp 1987 alternatively the pipe network method was developed by connecting one dimensional pipes at the centres of fractures for fast analysis of large scale and or high density fracture networks aperture heterogeneity is considered by locally changing the pipe diameter ren et al 2017b however one dimensional geometric models cannot capture the characteristics of fluid flow in three dimensional geometry such as preferential flow and anisotropic flow chen et al 2018 to include the aperture heterogeneity in 3d dfn models an alternative method has been proposed where the mechanical aperture is replaced by the hydraulic aperture which is a function of aperture heterogeneity zhao et al 2013 apart from that many other numerical modelling methods have been proposed berrone et al 2013b de dreuzy et al 2004 however the following restrictions limit the above methods one shortcoming is the difficulty in geometric discretization and the enormous computational burden in solving the navier stokes ns equations javadi et al 2010 makedonska et al 2016 another deficiency is that the aperture of the individual fractures was regarded as constant whereas the channel flow caused by the variety of apertures within fractures has been observed in field and laboratory investigations in which approximately 5 20 of the fracture area contributed to more than 90 of the total flow rong et al 2016 therefore incorporating aperture heterogeneity of individual fractures into dfn models is a prerequisite for straightforward and reliable characterization of fluid flow and permeability estimation of fractured rocks in this study a novel 3d dfn modelling method considering aperture heterogeneity was originally developed to mimic fluid flow through fractured rocks to improve computational efficiency an approach to identifying the flow path and removing invalid fractures of dfn models was proposed after that the reliability of the numerical method was verified through three parallel plate models and one rough walled fracture model then the individual fractures of heterogeneous apertures dfnh were generated by a successive random additions sra algorithm and assigned to individual fractures and 3d dfns with the same network topology and identical mechanical aperture dfn i as the dfnh models were also generated for comparison finally the role of variable fracture apertures in fluid flow and the permeability discrepancy between the two models with increasing fracture density and mechanical aperture were analysed 2 generation of 3d dfns with rough fractal fracture surfaces 2 1 3d dfn model generation it is difficult to accurate and complete mapping of fracture geometry due to the limitation of geological survey level lang et al 2014 nick et al 2011 alternatively stochastic methods based on mathematical statistics show advantages in describing these ambiguous structural planes in fractured rock through field investigations an assumption that the fracture shape is close to circular disks was proposed by beacher et al baecher and lanney 1978 and then confirmed by long et al long et al 1985 all fractures presented in this study are assumed to be circle disks with the centre of them following uniformly distributed the volume density p32 which is suitable for characterizing the fracture density in 3d and is defined as the total fracture area per unit volume in units of m2 m3 was used in this study davy et al 2006 some studies have shown that the trace length corresponding to the diameter of the fracture follows an exponential distribution darcel et al 2003 de dreuzy et al 2000 1 n d λ d α where d is the diameter of the fracture in the range d min d max n d is the frequency of fractures with diameters from d min to d α is the power law index generally between 2 and 4 5 de dreuzy et al 2012 and λ is the proportionality factor another important parameter is fracture orientation which is usually expressed by dip θ 1 and dip direction θ 2 geological surveys have found that the orientations of fractures conformed a fisher distribution min et al 2004 and this phenomenon is describe by 2 f θ κ sin θ e κ cos θ e κ e κ where θ is the angular deviation from the mean vector and κ is the degree of dispersion of orientation the fracture aperture is usually at least three orders of magnitude lower than the length and width of the fracture plane in addition natural fractures are typically rough causing a variety of fracture apertures dang et al 2019 such geometric complexity of fracture networks brings great difficulty in geometric model discretization hyman et al 2014 to overcome this drawback a 3d undulating surface with dual coordinates is established where the fracture aperture is expressed by local coordinates and the spatial position is represented by global coordinates the local coordinates of all points on a fracture are represented by xi yj a xi yj and can be linked with global coordinates through coordinate transformation where a xi yj represents the aperture at the local coordinate xi yj i 0 1 2 m j 0 1 2 n m n represent a lattice point for a fracture aperture based on the regulations and methods mentioned above a fracture network incorporating heterogeneous fracture apertures was generated as shown in fig 1 a simultaneously a 3d dfn composed of smooth and parallel plates with the equivalent mechanical aperture to model a was generated for comparison as shown in fig 1 b 2 2 generation of a 3d self affine fracture model as the diversification of the fracture aperture affects the fluid flow state and energy loss fracture network embedded with geometric fracture morphology is conducive to obtaining detailed and realistic fracture seepage zhang et al 2013 since fractal geometry was introduced many efforts have been made to characterize rough fracture surfaces with fractal theory such as the sra algorithm and fourier transforms li et al 2008 amongst them the improved sra algorithm is widely used due to its high efficiency liu et al 2004 and corresponding matlab code was developed to generate 3d self affine fracture apertures in 2d sra a single valued continuous function a xi yj is used to describe the aperture distribution of fracture it is defined as a x δx y δy a x y and obeys the gaussian normal distribution with mean zero and variance σ2 at distance l l δ x 2 δ y 2 the aperture field of the self affine fracture surface was defined by the following functions 3 a x γ δ x y γ δ y a x y 0 4 σ 2 r r 2 h σ 2 1 where is the mathematical expectation r is a constant his the hurst exponent ranging from 0 to 1 and satisfies d 3 h where d is the fractal dimension and σ2 is the variance that can be defined as a function of r 5 σ 2 r a x γ δ x y γ δ y a x y 2 3 optimization of dfns to remove invalid fractures the geometric construction and numerical computation of 3d dfns are time consuming and computationally intensive hyman et al 2015 removing the fractures that have no contribution to fluid flow can save time for geometric model discretization and subsequent computation according to percolation theory brian 1993 there exist four types of invalid fractures for fluid flow the first type consists of isolated fractures with no connections to other fractures the second type includes isolated fractures that are connected to only one fracture and can be referred to as dead ends the third type consists of isolated fracture clusters that are not connected to other fracture clusters and the upstream and downstream boundaries the fourth type includes fracture clusters that are connected only to a percolation path or the upstream downstream boundary in practice fracture clusters of the fourth type can store but not transport fluid therefore these fracture regions can be defined as dead zones in unsteady flows eddies and energy losses occur in isolated fractures clusters thus these dead zones should be considered in fluid dynamics analyse however it is not necessary to consider these four types of fractures fracture clusters in analyses of steady state flows this section provides a method to remove invalid fractures according to their geometric characteristics 3 1 intersection of spatial polygons the intersection amongst fractures is the basis for finding the seepage channel and removing the invalid fractures the positional relationship between different circles in space is conventionally determined by solving the set of equations of them zhan et al 2016 the geometric parameters of a disk are assumed as follow coordinates of centre xi yi zi dip θ1 i dip direction θ2 i diameter li the plane of the fracture disk can be described as 6 a i x x 0 b i y y 0 c i z z 0 0 where ai bi ci is the normal vector of fracture ai sin θ1 i sin θ2 i bi sin θ1 i cos θ2 i ci cos θ1 i the intersection line of arbitrary two non parallel planes can be expressed as 7 a 1 x x 1 b 1 y y 1 c 1 z z 1 0 a 2 x x 2 b 2 y y 2 c 2 z z 2 0 the direction vector n 1 n 2 n 3 of the intersection line can be expressed by 8 n 1 b 1 c 2 b 2 c 1 n 2 a 2 c 1 a 1 c 2 n 3 a 1 b 2 a 2 b 1 assuming x 0 y 0 z 0 is a point in intersection line the distance from the centre point of the disk to intersection line can be obtained by 9 d i x i x 0 n 2 y i y 0 n 1 2 y i y 0 n 3 z i z 0 n 2 2 z i z 0 n 1 x i x 0 n 3 2 n 1 2 n 2 2 n 3 2 according to the knowledge of analytic geometry the two disks are intersected only if d 1 0 5l 1 d 2 0 5l 2 and d 1 d 2 0 5 l 1 l 2 3 2 method to evaluate the effectiveness of fracture in practice the distributions of the sizes and orientations of rock fractures are very complex and not all fractures intersect with other fractures removing fractures that make no contribution to steady fluid flow can greatly improve the computational efficiency a programme was developed to search the seepage path of the fracture network and remove invalid fractures to illustrate this programme a fracture network was constructed and the steps to remove invalid fractures were introduced the undirected graph is like the topology of a 3d dfn and convenient for computer processes accordingly invalid fractures can be identified and removed by processing the adjacency matrix corresponding to the undirected graph the adjacency matrix of an undirected graph uses a sequence list to represent the adjacencies between vertices and store vertex information fig 2 a shows the undirected graph corresponding to a 3d fracture network and fig 2 b is a schematic diagram that describing the relationship between adjacency matrix and undirected graph in the undirected graph fig 2 a each number represents a fracture and the edges between ordinals indicate that two fractures are connected fractures are divided into three sets fractures that intersect with the inlet named inlet region fractures that do not intersect with the inlet and outlet named flow region and fractures that intersect with the outlet named outlet region the node degree is defined as the number of intersections with a fracture which can be obtained by summation of the row or column of the adjacency matrix in addition the node degree of the fracture in inlet region and outlet region increases by 1 they intersect with the inflow or outflow the node degrees equal 0 for isolated fractures the first type of invalid fracture and 1 for leaf nodes the third type of invalid fracture the first step is to delete the isolated fractures and leaf nodes in the study domain then the remaining fractures are renumbered and the undirected graph and adjacency matrix are updated subsequently the isolated fracture and newly generated leaf nodes are deleted the iterative process is conducted until no more invalid fractures exist following this process the fracture marked i in fig 2 a is removed that is the fractures numbered 3 9 18 19 and 20 are deleted in the second step the breadth search optimization algorithm is used to group the remaining fractures and remove the isolated fracture clusters in detail a fracture is stored in a stack and then the fractures that intersecting the fracture in this stack are added this step is repeated until no new fractures can be added then the fracture represented by the smallest row number and not contained in the existing stack is stored in a new stack and the fracture connected with the fracture in this stack is added the process is iteratively performed until all fractures are accessed and stored in a stack this process divides all fractures into different fracture clusters as shown in fig 2 a according to percolation theory only the fracture clusters intersecting the inlet and outlet can transport fluid with this process the isolated fracture clusters marked ii are removed fracture numbers 1 4 5 6 7 and 8 in fig 2 a in the third step the dead area is removed first the depth optimization algorithm is used to find a seepage channel from the inlet region to the outlet region which is referred to as the seepage trunk for example the fractures with serial numbers 10 11 13 14 and 17 in fig 2 a constitute a percolation trunk in the fracture cluster then the fracture directly connected to the seepage trunk is found using the width optimization algorithm and added to this seepage trunk the fracture found in the previous procedure is stored in a new stack and an unvisited fracture connected with the fracture in this stack is added to it iteration of this process is conducted until no new fractures are added or there is no further stack connection with one of the following the inlet region the outlet region and the seepage trunk if the latter stopping principle is satisfied then the fracture is judged to be effective and should be added to the seepage trunk otherwise the fracture is defined to be invalid and should be removed this process is repeated until all fractures are accessed during this process the fractures marked iii in fig 2 a numbers 15 and 16 were deleted and fracture number 12 was confirmed to be valid through the process above a complex fracture network consisting of 22 fractures was simplified to a fracture network consisting of 9 fractures this significantly reduces the subsequent computational burden especially when the fracture density is sparse invalid fractures are more likely to appeared 3 3 algorithm optimization in a geological survey tens of thousands of fractures can be sampled evaluating the relationship between these fractures is time consuming and it is difficult to meshed geometric model due to the conformity constraints on the fracture intersections berrone et al 2019 pichot et al 2012 therefore optimization of the process of fracture effectiveness identification and improvements the computational efficiency are necessary to implement a large scale high density fracture network in a microcomputer positional relationship evaluation between fractures and optimization of dfns are two independent processes positional relationship evaluation of fractures one at a time is achieved by the exhaustive method assuming that the fractured rock mass includes n fractures and n represents the number of fractured polygon sides the time complexity of the intersection determination algorithm is o nn in fig 3 some spherical bounding boxes sharing the same centre and radius as those of the disks are used for fast positional relationship decision making between fractures if the distance between the centres of two spheres is more than the sum of the two radii the fracture contained in the two spheres must be disconnected otherwise further evaluation is needed with the method that has been introduced in section 3 1 this method reduces the time complexity of intersection determination from o nn to o n to further improve intersection evaluation efficiency the partition algorithm is adapted fig 4 shows the methods of dividing dfn models into sub regions in one direction or three directions and fig 5 shows the flowchart of the partition algorithm to avoid a fracture which belongs to more than one partitions its specific partition is determined according to the location of its geometric centre for example a fracture goes through sub partitions sub a and sub b simultaneously but its geometric centre is in the sub partition sub a then this fracture belongs to sub partition sub a in the partition algorithm the scale of the dfn models can be reduced by segmentation of regions as a result the fracture number in each sub region is much smaller than n in addition parallel computing is the basis for the realization of the region segmentation algorithm by synchronously handling as many sub regions as possible therefore identifying effective fractures and removing invalid fractures for each sub region would be more efficient in computation although the computation time increases due to partitioning and splicing of the fracture information of the dfn mode the time complexity can be reduced significantly 4 mesh generation and computation of fluid flow in 3d dfn models 4 1 method of mesh generation for 3d dfns 3d dfns provide great advantages in understanding how fluid flows through fractures discretization of model geometry is the basis of solving the governing equations on the fracture network scale 2d intersecting polygons with random orientations sizes and locations in 3d space form complex topological network structures the intersection line is taken as edges in the meshing which satisfies the conservation of head and flow at intersections erhel et al 2009 note that there are some methods that control the conservation of the flow without any constraints on the mesh berrone et al 2013a on the fracture scale the fracture surface was discretized in 2d whereas neither quadrilateral nor triangular meshes were consistent with the geometric edges of the fracture therefore the geometric discretization of the 3d dfns must meet two restrictions first the mesh must use the intersection line as edges which satisfies the conservation of pressure and flow at intersections in fig 6 a three intersecting fractures are discretized based on this restriction where the red line represents the line of interest the second prerequisite restriction is approximate disc edges to a polygon to maintain consistency with mesh edges this assumption is reasonable and conducive to geometrical discreteness notably it is only an assumption that a fracture is a disc there is no strict circular fracture in nature it is challenging to balance mesh quality and quantity especially when there is a very large number of randomly intersecting fractures that form an enormous number of small areas to date both structured and unstructured methods have been widely used in geometric discretization mohajerani et al 2018 a structured mesh means that all internal meshes have the same adjacent elements which has the advantages of fast meshing high quality and simple structure but it is difficult to mesh irregular geometries such as 3d dfns compared with structured meshes unstructured meshes have internal meshes with arbitrarily shaped adjacent cells which automatically adjust the size of the mesh according to the local geometry therefore the balance between the quantity and quality of a mesh can be easily obtained with the unstructured mesh technique hyman et al 2014 an unstructured discretization method for adaptively meshing highly discontinuous geological media is adopted in the present study skewness is defined as the difference between the actual node shape and an equilateral regular polygon with the same area ranging from 0 to 1 where the number 1 represents the element that meets the highest standards of mesh quality and 0 represents the opposite extreme i e a degraded element in fig 6 b and c the 3d dfns shown in fig 1 b dfn i and fig 1 a dfnh are triangulated with 62 715 meshes and 1 410 080 meshes respectively the skewness of these two 3d dfns is larger than 0 8 this means that the discretization method meets the requirements of numerical computation parthasarathy 1993 wang et al 2017 4 2 governing equations and boundary conditions the naiver stokes equations are a set of coupled differential equations governing the motion of viscous fluids zimmerman and bodvarsson 1996 10 ρ u t u u p μ 2 u f where ρ is the fluid density u is the velocity vector of fluid p is the pressure gradient and f is the body force vector the terms ρ u t and ρu u represent the force from the inertial effect while the term μ 2 u represents the viscous force the naiver stokes equations describe incompressible newtonian flow very well but the quadratic partial differential term μ 2 u introduces computational difficulty for the convenience of computational simplicity some macroscopic empirical governing equations have been proposed for example the cubic law which is derived from the naiver stokes equations is used to describe laminar fluid flow at low velocity through two parallel plates separated by a small aperture ju et al 2019 11 q a 3 12 u h where u is the dynamic viscosity a is the fracture aperture and the hydraulic gradient h is calculated by h h x h y according to the cubic law the hydraulic conductivity of the fracture is proportional to the quadratic square of the fracture aperture 12 k s ρ g 12 u a 2 where g is acceleration due to gravity the permeability of the fracture is proportional to both the aperture and hydraulic conductivity 13 t s a k s ρ g 12 u a 3 the flux in the fracture is given by 14 q k s h the discharge per unit of fracture width qlocal can be computed by multiplying the hydraulic gradient and hydraulic conductivity through the following formula 15 q l o c a l a q t s h the total seepage flow qglobe of the model can be obtained by integrating the local flow of each fracture at the outlet boundary then the equivalent permeability of dfns can be calculated liu et al 2018 16 k u l q g l o b e s δ p where l is the length along the flow direction of the model s is the cross sectional area and δp is the pressure difference between the inlet and outlet the reynolds equation which is also called the local cubic law is used as a governing equation to describe fluid flow between two rough fracture walls by divide the void space into several small simplified parallel plates wang et al 2016 17 t s h 0 even though natural rock fracture surfaces are generally rough the smooth parallel plate assumption can still be valid regionally if the geometry is discretized into many small smooth parallel plates the aperture assignment by the sra method is presented in section 2 2 in numerical computation the boundary conditions of the model must be set in advance two opposite surfaces γ in and γ out were set as fixed hydraulic pressures h 1 and h 2 while the other four surfaces γ imp were set to be impermeable and a neumann zero flux condition on each fracture edge γ f which can be summarized as huang et al 2016 18 h h 1 o n γ f γ i n h h 2 o n γ f γ o u t u n 0 o n γ f γ i m p u n 0 o n γ f the continuous condition on the intersection line of each fracture are erhel et al 2009 19 h k f h k o n e k f f k f f k v k f n k f 0 o n s k where h k f is the trace of the head v k f is the flow velocity and n k f is the normal unit vector on the boundary sk of the fracture ω f 4 3 numerical solution procedure fig 7 shows the processes of geometric construction and numerical computation first programming is conducted to generate geometric information of 3d dfn models in matlab then a fracture network optimization algorithm is developed to identify the effectiveness of fractures and remove fractures that make no contribution to fluid flow subsequently the surface geometry morphology of the remaining fractures is established and the variable regional fracture aperture is assigned finally the generated model is imported into comsol multiphasic for discretization and initial and boundary conditions are set for flow computations with a computer with a 64 bit operating system and an intel i5 8500 processor the computation of numerical models of fracture density p32 equal to 3 6 m2 m3 with regional aperture variation a total of 1410 080 meshes requires 2 min and the case in the dfn i model with the corresponding mechanical aperture a total number of 62 715 meshes consumes 6 s conventionally it takes more than ten hours to calculate a model containing more than 60 000 mesh nodes on a computational cluster with 64 cpus huang et al 2016 karra et al 2018 liu et al 2016 comparatively the proposed method overcomes the time consuming defect when analysing fluid flow no matter in dfnh or dfn i model furthermore this method avoids inaccurate evaluation due to the problematic degradation of 3d to 2d for the limitation of computation berkowitz 2002 therefore the proposed modelling and optimization methods of 3d dfns show great advantages in time savings and computation improvement when delineating fluid flow and transport processes and can be used for large scale or high density dfn models 5 results and analysis 5 1 verification of the newly developed method before an application is evaluated some models are established to verify the proposed method the cubic law was used to calculate the closed form theoretical permeability kt and the numerical results ks were calculated at the same time the relative error between the theoretical and computational permeabilities is defined as ε kt ks kt and listed in table 1 in the first step of verification three fracture models were developed with the parallel plate assumption as shown in fig 8 model a is a single fracture consisting of two parallel plates model b contains two intersecting parallel plate fractures dipping at 45 and 135 and model c consists of five parallel plate fractures in these three models the aperture is set uniformly to be 1 mm like the parallel connection of resistance the equivalent hydraulic aperture of the inclined plane can be obtained sudipta sarkar 2004 20 h eq i 1 n h i 3 cos φ i 3 where heq is the equivalent hydraulic aperture hi is the hydraulic aperture of the ith fracture and ϕ i is the inclination of the ith fracture in the same way that the equivalent resistance of a series of resistors is obtained the following formula can be used to obtain the equivalent hydraulic aperture of factures connected in series 21 h eq i 1 n l i l 1 h eq i 3 3 1 where h e q i is the effective aperture of the fracture corresponding to the ith segment li is the projected length of the fracture corresponding to the seepage direction and l is the total length in the direction of fluid flow as shown in table 1 the theoretical and numerical solutions are in good agreement for either single fractures or multiple fractures the three cases mentioned above prove that the proposed method for describing fluid flow in a parallel plate and fracture intersection is valid the aim of this study is to develop a numerical method of 3d dfn models considering fracture aperture heterogeneity as there is no closed form solution to calculating the equivalent hydraulic aperture of fractures with variable apertures a matlab code was developed to calculate the hydraulic aperture of rough fracture based on eqs 20 and 21 table 1 shows that the deviation of the hydraulic aperture of the models shown in fig 8 calculated by the proposed numerical method from the theoretical value are less than 0 279 this deviation results from the dispersion of aperture and can be negligible the proposed method is theoretically reliable and is feasible for characterizing fluid flow in 3d dfns in both dfn i and dfnh models 5 2 permeability comparison of the dfn h and dfn i models 5 2 1 generation of the dfn h and dfn i models treating individual fractures of dfn models as smooth parallel plates can reduce the workload of computations however previous studies indicated that this geometric simplification could lead to incorrect estimates of the permeability of fractures and the channel flow phenomenon caused by fracture aperture heterogeneity cannot be characterized zhang and nemcik 2012 the permeabilities of the dfnh model and dfn i model in fig 1 are 2 759 m2 and 3 933 m2 respectively with a relative error of 43 therefore it is important to analyse the role of fracture aperture heterogeneity in dfns to understand the fluid flow of fractured rock masses four increasing fracture densities of 0 2 0 3 0 4 and 0 5 m2 m3 and nine hydrological apertures with a gradation of 0 2 mm from 0 4 mm to 2 0 mm are considered here to reduce the influence of randomness on permeability each case was generated 10 times for simulations in total 4 fracture densities 9 hydrology apertures 10 10 times 2 dfnh and dfn i models 720 models are generated and the fluid flow through each model is simulated by applied different hydraulic pressures in the left h 1 and right boundary surface h 2 of dfn models the parameters for generating the dfn model are summarized in table 2 since the uniform aperture was applied in the dfn i model fig 9 only shows the aperture distribution of dfnh model and the hydraulic pressure distribution of the dfnh and dfn i models is also represented 5 2 2 fluid flows in dfn h and dfn i models according to the pressure and fluid distribution fig 9 in the dfnh and dfn i models the phenomenon of preferential flow appeared which may be caused by the randomness of fracture position size and orientation due to the aperture heterogeneity of individual fractures in the dfn models the phenomenon of preferential flow is more obvious in the dfnh model than in the dfn i model fig 9 shows that the smaller the fracture density is the more obvious the preferential flow phenomenon in the dfn models with increasing fracture density the number of fractures and the intersection of fractures increased which provided more paths for fluid flow and the phenomenon of preferential flow was reduced to some extent fig 10 shows the equivalent permeability of the dfn models while keeping the same fracture density the variation ranges of the fracture network permeability reached three orders of magnitude in either the dfnh or dfn i models although the fracture aperture only increased from 0 4 mm to 2 mm this implies the strong dependence of the permeability on the fracture aperture the data points in fig 10 can be fitted with an exponential function k a e m b where em is the mechanical aperture of the fracture the values of the constants a and b and correlation coefficient r2 are listed in table 3 an intense fracture density means that the fracture network contains more fractures which makes the fracture distribution more consistent with the predetermined distribution and decreases the influence of fracture randomness on the dfn model therefore the permeability of the dfn models generated by the same geometric statistical parameters such as position and orientation tends to be consistent which can be reflected by the increase in r2 to quantitatively describe the equivalent permeability discrepancy between the dfnh and dfn i models the permeability rate of the two models is defined as ki kh kh fig 11 shows the relationship between the fracture mechanical aperture and the relative variation in permeability of the two models with different fracture densities the solid red line is the average value of the relative discrepancy of the permeability and the upper and lower dotted blue lines show the boundary curves of the relative discrepancy of the permeability the difference in permeability between the two models decreased with increasing equivalent mechanical aperture and this trend was initially significant and then tended to disappear this indicates that the effect of aperture anisotropy is restricted with increasing equivalent mechanical aperture when the mechanical aperture is 0 4 mm and the fracture density is equal to 0 2 0 3 0 4 and 0 5 m2 m3 the average relative variation is 42 24 12 and 10 respectively this indicates that the increase in fracture density reduces the difference in permeability between the two models in the fracture network fluid tends to flow in the most permeable channels the increase in the number of fractures provides more alternative paths for fluid flow which is the reason for the similar values of the permeability when the two models are close in intense density 5 2 3 critical mechanical aperture fig 11 shows that the equivalent permeability discrepancy of the dfn i and dfnh models decreased with increasing fracture density or mechanical aperture a critical equivalent mechanical aperture is defined when the difference in permeability between the two models equals 10 fig 12 shows that when the fracture density is 0 2 0 3 0 4 and 0 5 m2 m3 the critical mechanical apertures are 1 1 0 8 0 6 and 0 4 mm respectively the increase in fracture density improves the connectivity of the fracture network and provides more alternative channels for fluid flow which weakens the effect of aperture heterogeneity on the permeability of dfns when the mechanical aperture of the fracture is beyond this critical value the permeability obtained by the dfn i model is close to that obtained by the dfnh model otherwise the heterogeneity of the aperture has a significant influence on seepage and this influence should be considered in computational fluid dynamic analysis using dfn models 6 conclusions this study proposed a numerical method to analyse fluid flow through 3d dfn models of heterogeneous apertures technology to identify percolation pathways and remove invalid fractures was proposed and a corresponding programme was developed to optimize the dfn models the optimized dfn model is geometrically discretized by an unstructured triangular mesh and the reynolds equation is solved using the finite element method this method guarantees the conservation of fluid mass and hydraulic pressure both locally and globally in the dfn model and can incorporate heterogeneous apertures into individual fractures to analyse the effect of aperture variables on fluid flow in individual fractures and on channel flow phenomena in the 3d dfn model the validity of the proposed numerical method is proven by using a matlab program to calculate the equivalent hydraulic aperture from 3d models and compare the results for constant and variable apertures the developed numerical methods were subsequently used to evaluate the effects of aperture heterogeneity on fluid flow in 3d dfn models the results show that this numerical method is reliable and robust and can be used for rapid numerical calculations of high density or large dfn models the preferential flow phenomenon appears in dfn i models due to geometric randomness in characteristics such as fracture length orientation position and the discrepancy of mechanical apertures in addition preferential flow paths are more easily formed in dfnh models than in dfn i models because the aperture varies within a single fracture the discrepancy of the permeability between the two models decreases significantly first and then tends to disappear with the increase in equivalent mechanical aperture which shows that the influence of the aperture heterogeneity on the permeability is restricted therefore a critical mechanical aperture can be proposed above this critical threshold the dfn i model is recommended as a means to reduce the workload during model generation and numerical computation otherwise the dfnh model is the option that can improve computational accuracy the specific geometry and aperture distribution of dfn models could strongly impact on the fluid flow behaviour further experimental and numerical studies are required to fully uncover the fluid flow behaviour through dfns with a broad spectrum of geometries in the future explorations credit authorship contribution statement kangsheng xue conceptualization methodology formal analysis writing original draft zhenyu zhang conceptualization methodology writing review editing chunlin zhong methodology yujing jiang writing review editing xueyu geng writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this study was financially supported by the national natural science foundation of china grant no 51674047 and 51911530152 supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2022 104164 appendix supplementary materials image application 1 
181,a novel numerical method was developed to evaluate the effect of the aperture heterogeneity of individual fractures on fluid flow through three dimensional discrete fracture networks dfns first the rock fractures are modelled as circular discs with sizes orientations and positions following exponential fisher and uniform distributions respectively isolated fractures clusters that make no contribution to fluid flow through the dfn were then removed by optimization programming using breadth optimization and deep optimization algorithms subsequently individual fractures with heterogeneous apertures were developed using successive random addition algorithms after that fracture networks were triangulated and the reynolds equations were solved for fluid dynamics computations the verification showed that the developed method provides advantages in computational accuracy and efficiency finally the influence of the aperture heterogeneity of individual fractures on fluid flow through a dfn was evaluated with the proposed method for comparison dfn models with identical mechanical apertures dfn i and another model with heterogeneous apertures dfnh were developed the results show that a preferential flow phenomenon appeared in both the dfn i and dfnh models however owing to the aperture heterogeneity of the individual fractures the results of the dfnh model were more substantial than those of the dfn i model this preferential flow phenomenon would be weakened by an increase in either the mechanical aperture or the fracture density the results also showed that the permeability difference between the dfn i and dfnh models was obvious for dfn models with small apertures and low fracture densities but this permeability discrepancy decreased with increasing mechanical aperture or fracture density therefore a critical mechanical aperture exists for a dfn model with a specified fracture density beyond this threshold the influence of aperture heterogeneity within individual fractures on fluid flow can be neglected and the dfn i model can be selected to replace the dfnh model for efficient modelling and computation keywords discrete fracture network seepage path aperture heterogeneity reynolds equation permeability nomenclature a fracture aperture a constant b constant d diameter of the fracture d min minimum diameter d max maximum diameter d fractal dimension di distance from the centre point of disk to intersection line em mechanical aperture of fracture f body force vector g acceleration of gravity h hurst exponent heq equivalent hydraulic aperture hi hydraulic aperture of the ith fracture h k f the trace of head k equivalent permeability of dfns ks numerical result of permeability kt theoretical result of permeability l the length along flow direction of dfns model l the total length in the direction of fluid flow li the projected length of fracture in the direction of fluid flow n d the frequency of fractures with diameters from d min to d n k f the normal unit vector on the boundary sk of the fracture ω f qglobe total flow rate of dfns model qlocal flow rate of per unit fracture width q flow rate in fracture r constant s cross sectional area ts hydraulic conductivity of fracture u dynamic viscosity u the velocity vector of fluid v k f flow velocity α power law index θ angular deviation from the mean vector θ 1 dip angle θ 2 dip direction angle ρ fluid density κ the degree of dispersion of orientation λ proportionality factor ε relative error between the theoretical and numerical result of permeability ϕ i the inclination of the ith fracture the mathematical expectation σ2 variance p pressure gradient δp pressure difference between the inlet and outlet boundary h hydraulic gradient γ in fluid inlet boundary γ out fluid outlet boundary γ imp impermeable boundary γ f fracture edge 1 introduction fluid flow through fractured rocks has attracted increasing attention for the purpose of either stability or production in many rock engineering applications such as dam foundations subsurface pollutant migration and oil and gas exploitation hyman et al 2015 senent et al 2013 continuous methodologies such as stochastic continuum neuman 2005 and dual multiple continua zhang and yin 2014 in which fracture and matrix are regarded as a continuous medium provide a phenomenological description of fluid flow in a large domain of fractured rocks however capturing permeability anisotropy is limited due to the heterogeneity of fracture apertures as a result a representative element volume rev may not exist hitchmough et al 2007 in contrast a discrete fracture network dfn has the advantage of explicitly describing the orientation position connectivity and geometric morphology within fractures ishibashi et al 2012 the permeability of rock fractures is usually several orders of magnitude higher than that of the rock matrix playing a dominant role in fluid flow through fractured rocks baghbanan and jing 2008 de dreuzy et al 2002 conventionally the parallel plate assumption of individual fractures has been made in dfn modelling however natural fractures are typically rough and the aperture variation in rough walled individual fractures has a significant influence on the fluid flow behaviour therefore an accurate characterization of the geometrical morphology of individual fractures of rock fracture networks is crucial for the evaluation of permeability and the factors that influence fluid flows through fractured rocks berkowitz 2002 rock fractures were originally simplified to two dimensions 2d due to insufficient three dimensional 3d measurement information in characterizing the geometric topological features of dfn models and computational limitations liu et al 2018 zhao et al 2011 the accuracy of 2d models in permeability prediction has been continuously improved in theory laboratory experiments and numerical calculations leung and zimmerman 2012 ren et al 2017a however as a slice from 3d models a 2d model cannot easily characterize the real geometric topology of rock fractures for example some fractures can be isolated in 2d models but may be connected with other fractures in 3d models bogdanov et al 2003 gonzalez garcia et al 2000 therefore 2d models can underestimate the permeability of fractured rocks lang et al 2014 and 3d models have significant advantages for precisely describing the spatial position orientation and connectivity of fracture networks erhel et al 2009 zhang and yin 2014 in 3d dfn modelling individual fractures are conventionally represented by 2d discs consisting of two smooth parallel plates baecher and lanney 1978 long et al 1985 with the further assumption of laminar flow a cubic law has been applied to govern the fluid flow through parallel plate fractures such simplification facilitates dfn model construction but it ignores the influence of aperture heterogeneity of individual fractures on the fluid flow process and permeability estimation frampton et al 2019 makedonska et al 2016 to overcome this drawback a boundary element method has been used to describe fluid flow in individual fractures but the number of fractures in dfn models is limited andersson and dverstorp 1987 alternatively the pipe network method was developed by connecting one dimensional pipes at the centres of fractures for fast analysis of large scale and or high density fracture networks aperture heterogeneity is considered by locally changing the pipe diameter ren et al 2017b however one dimensional geometric models cannot capture the characteristics of fluid flow in three dimensional geometry such as preferential flow and anisotropic flow chen et al 2018 to include the aperture heterogeneity in 3d dfn models an alternative method has been proposed where the mechanical aperture is replaced by the hydraulic aperture which is a function of aperture heterogeneity zhao et al 2013 apart from that many other numerical modelling methods have been proposed berrone et al 2013b de dreuzy et al 2004 however the following restrictions limit the above methods one shortcoming is the difficulty in geometric discretization and the enormous computational burden in solving the navier stokes ns equations javadi et al 2010 makedonska et al 2016 another deficiency is that the aperture of the individual fractures was regarded as constant whereas the channel flow caused by the variety of apertures within fractures has been observed in field and laboratory investigations in which approximately 5 20 of the fracture area contributed to more than 90 of the total flow rong et al 2016 therefore incorporating aperture heterogeneity of individual fractures into dfn models is a prerequisite for straightforward and reliable characterization of fluid flow and permeability estimation of fractured rocks in this study a novel 3d dfn modelling method considering aperture heterogeneity was originally developed to mimic fluid flow through fractured rocks to improve computational efficiency an approach to identifying the flow path and removing invalid fractures of dfn models was proposed after that the reliability of the numerical method was verified through three parallel plate models and one rough walled fracture model then the individual fractures of heterogeneous apertures dfnh were generated by a successive random additions sra algorithm and assigned to individual fractures and 3d dfns with the same network topology and identical mechanical aperture dfn i as the dfnh models were also generated for comparison finally the role of variable fracture apertures in fluid flow and the permeability discrepancy between the two models with increasing fracture density and mechanical aperture were analysed 2 generation of 3d dfns with rough fractal fracture surfaces 2 1 3d dfn model generation it is difficult to accurate and complete mapping of fracture geometry due to the limitation of geological survey level lang et al 2014 nick et al 2011 alternatively stochastic methods based on mathematical statistics show advantages in describing these ambiguous structural planes in fractured rock through field investigations an assumption that the fracture shape is close to circular disks was proposed by beacher et al baecher and lanney 1978 and then confirmed by long et al long et al 1985 all fractures presented in this study are assumed to be circle disks with the centre of them following uniformly distributed the volume density p32 which is suitable for characterizing the fracture density in 3d and is defined as the total fracture area per unit volume in units of m2 m3 was used in this study davy et al 2006 some studies have shown that the trace length corresponding to the diameter of the fracture follows an exponential distribution darcel et al 2003 de dreuzy et al 2000 1 n d λ d α where d is the diameter of the fracture in the range d min d max n d is the frequency of fractures with diameters from d min to d α is the power law index generally between 2 and 4 5 de dreuzy et al 2012 and λ is the proportionality factor another important parameter is fracture orientation which is usually expressed by dip θ 1 and dip direction θ 2 geological surveys have found that the orientations of fractures conformed a fisher distribution min et al 2004 and this phenomenon is describe by 2 f θ κ sin θ e κ cos θ e κ e κ where θ is the angular deviation from the mean vector and κ is the degree of dispersion of orientation the fracture aperture is usually at least three orders of magnitude lower than the length and width of the fracture plane in addition natural fractures are typically rough causing a variety of fracture apertures dang et al 2019 such geometric complexity of fracture networks brings great difficulty in geometric model discretization hyman et al 2014 to overcome this drawback a 3d undulating surface with dual coordinates is established where the fracture aperture is expressed by local coordinates and the spatial position is represented by global coordinates the local coordinates of all points on a fracture are represented by xi yj a xi yj and can be linked with global coordinates through coordinate transformation where a xi yj represents the aperture at the local coordinate xi yj i 0 1 2 m j 0 1 2 n m n represent a lattice point for a fracture aperture based on the regulations and methods mentioned above a fracture network incorporating heterogeneous fracture apertures was generated as shown in fig 1 a simultaneously a 3d dfn composed of smooth and parallel plates with the equivalent mechanical aperture to model a was generated for comparison as shown in fig 1 b 2 2 generation of a 3d self affine fracture model as the diversification of the fracture aperture affects the fluid flow state and energy loss fracture network embedded with geometric fracture morphology is conducive to obtaining detailed and realistic fracture seepage zhang et al 2013 since fractal geometry was introduced many efforts have been made to characterize rough fracture surfaces with fractal theory such as the sra algorithm and fourier transforms li et al 2008 amongst them the improved sra algorithm is widely used due to its high efficiency liu et al 2004 and corresponding matlab code was developed to generate 3d self affine fracture apertures in 2d sra a single valued continuous function a xi yj is used to describe the aperture distribution of fracture it is defined as a x δx y δy a x y and obeys the gaussian normal distribution with mean zero and variance σ2 at distance l l δ x 2 δ y 2 the aperture field of the self affine fracture surface was defined by the following functions 3 a x γ δ x y γ δ y a x y 0 4 σ 2 r r 2 h σ 2 1 where is the mathematical expectation r is a constant his the hurst exponent ranging from 0 to 1 and satisfies d 3 h where d is the fractal dimension and σ2 is the variance that can be defined as a function of r 5 σ 2 r a x γ δ x y γ δ y a x y 2 3 optimization of dfns to remove invalid fractures the geometric construction and numerical computation of 3d dfns are time consuming and computationally intensive hyman et al 2015 removing the fractures that have no contribution to fluid flow can save time for geometric model discretization and subsequent computation according to percolation theory brian 1993 there exist four types of invalid fractures for fluid flow the first type consists of isolated fractures with no connections to other fractures the second type includes isolated fractures that are connected to only one fracture and can be referred to as dead ends the third type consists of isolated fracture clusters that are not connected to other fracture clusters and the upstream and downstream boundaries the fourth type includes fracture clusters that are connected only to a percolation path or the upstream downstream boundary in practice fracture clusters of the fourth type can store but not transport fluid therefore these fracture regions can be defined as dead zones in unsteady flows eddies and energy losses occur in isolated fractures clusters thus these dead zones should be considered in fluid dynamics analyse however it is not necessary to consider these four types of fractures fracture clusters in analyses of steady state flows this section provides a method to remove invalid fractures according to their geometric characteristics 3 1 intersection of spatial polygons the intersection amongst fractures is the basis for finding the seepage channel and removing the invalid fractures the positional relationship between different circles in space is conventionally determined by solving the set of equations of them zhan et al 2016 the geometric parameters of a disk are assumed as follow coordinates of centre xi yi zi dip θ1 i dip direction θ2 i diameter li the plane of the fracture disk can be described as 6 a i x x 0 b i y y 0 c i z z 0 0 where ai bi ci is the normal vector of fracture ai sin θ1 i sin θ2 i bi sin θ1 i cos θ2 i ci cos θ1 i the intersection line of arbitrary two non parallel planes can be expressed as 7 a 1 x x 1 b 1 y y 1 c 1 z z 1 0 a 2 x x 2 b 2 y y 2 c 2 z z 2 0 the direction vector n 1 n 2 n 3 of the intersection line can be expressed by 8 n 1 b 1 c 2 b 2 c 1 n 2 a 2 c 1 a 1 c 2 n 3 a 1 b 2 a 2 b 1 assuming x 0 y 0 z 0 is a point in intersection line the distance from the centre point of the disk to intersection line can be obtained by 9 d i x i x 0 n 2 y i y 0 n 1 2 y i y 0 n 3 z i z 0 n 2 2 z i z 0 n 1 x i x 0 n 3 2 n 1 2 n 2 2 n 3 2 according to the knowledge of analytic geometry the two disks are intersected only if d 1 0 5l 1 d 2 0 5l 2 and d 1 d 2 0 5 l 1 l 2 3 2 method to evaluate the effectiveness of fracture in practice the distributions of the sizes and orientations of rock fractures are very complex and not all fractures intersect with other fractures removing fractures that make no contribution to steady fluid flow can greatly improve the computational efficiency a programme was developed to search the seepage path of the fracture network and remove invalid fractures to illustrate this programme a fracture network was constructed and the steps to remove invalid fractures were introduced the undirected graph is like the topology of a 3d dfn and convenient for computer processes accordingly invalid fractures can be identified and removed by processing the adjacency matrix corresponding to the undirected graph the adjacency matrix of an undirected graph uses a sequence list to represent the adjacencies between vertices and store vertex information fig 2 a shows the undirected graph corresponding to a 3d fracture network and fig 2 b is a schematic diagram that describing the relationship between adjacency matrix and undirected graph in the undirected graph fig 2 a each number represents a fracture and the edges between ordinals indicate that two fractures are connected fractures are divided into three sets fractures that intersect with the inlet named inlet region fractures that do not intersect with the inlet and outlet named flow region and fractures that intersect with the outlet named outlet region the node degree is defined as the number of intersections with a fracture which can be obtained by summation of the row or column of the adjacency matrix in addition the node degree of the fracture in inlet region and outlet region increases by 1 they intersect with the inflow or outflow the node degrees equal 0 for isolated fractures the first type of invalid fracture and 1 for leaf nodes the third type of invalid fracture the first step is to delete the isolated fractures and leaf nodes in the study domain then the remaining fractures are renumbered and the undirected graph and adjacency matrix are updated subsequently the isolated fracture and newly generated leaf nodes are deleted the iterative process is conducted until no more invalid fractures exist following this process the fracture marked i in fig 2 a is removed that is the fractures numbered 3 9 18 19 and 20 are deleted in the second step the breadth search optimization algorithm is used to group the remaining fractures and remove the isolated fracture clusters in detail a fracture is stored in a stack and then the fractures that intersecting the fracture in this stack are added this step is repeated until no new fractures can be added then the fracture represented by the smallest row number and not contained in the existing stack is stored in a new stack and the fracture connected with the fracture in this stack is added the process is iteratively performed until all fractures are accessed and stored in a stack this process divides all fractures into different fracture clusters as shown in fig 2 a according to percolation theory only the fracture clusters intersecting the inlet and outlet can transport fluid with this process the isolated fracture clusters marked ii are removed fracture numbers 1 4 5 6 7 and 8 in fig 2 a in the third step the dead area is removed first the depth optimization algorithm is used to find a seepage channel from the inlet region to the outlet region which is referred to as the seepage trunk for example the fractures with serial numbers 10 11 13 14 and 17 in fig 2 a constitute a percolation trunk in the fracture cluster then the fracture directly connected to the seepage trunk is found using the width optimization algorithm and added to this seepage trunk the fracture found in the previous procedure is stored in a new stack and an unvisited fracture connected with the fracture in this stack is added to it iteration of this process is conducted until no new fractures are added or there is no further stack connection with one of the following the inlet region the outlet region and the seepage trunk if the latter stopping principle is satisfied then the fracture is judged to be effective and should be added to the seepage trunk otherwise the fracture is defined to be invalid and should be removed this process is repeated until all fractures are accessed during this process the fractures marked iii in fig 2 a numbers 15 and 16 were deleted and fracture number 12 was confirmed to be valid through the process above a complex fracture network consisting of 22 fractures was simplified to a fracture network consisting of 9 fractures this significantly reduces the subsequent computational burden especially when the fracture density is sparse invalid fractures are more likely to appeared 3 3 algorithm optimization in a geological survey tens of thousands of fractures can be sampled evaluating the relationship between these fractures is time consuming and it is difficult to meshed geometric model due to the conformity constraints on the fracture intersections berrone et al 2019 pichot et al 2012 therefore optimization of the process of fracture effectiveness identification and improvements the computational efficiency are necessary to implement a large scale high density fracture network in a microcomputer positional relationship evaluation between fractures and optimization of dfns are two independent processes positional relationship evaluation of fractures one at a time is achieved by the exhaustive method assuming that the fractured rock mass includes n fractures and n represents the number of fractured polygon sides the time complexity of the intersection determination algorithm is o nn in fig 3 some spherical bounding boxes sharing the same centre and radius as those of the disks are used for fast positional relationship decision making between fractures if the distance between the centres of two spheres is more than the sum of the two radii the fracture contained in the two spheres must be disconnected otherwise further evaluation is needed with the method that has been introduced in section 3 1 this method reduces the time complexity of intersection determination from o nn to o n to further improve intersection evaluation efficiency the partition algorithm is adapted fig 4 shows the methods of dividing dfn models into sub regions in one direction or three directions and fig 5 shows the flowchart of the partition algorithm to avoid a fracture which belongs to more than one partitions its specific partition is determined according to the location of its geometric centre for example a fracture goes through sub partitions sub a and sub b simultaneously but its geometric centre is in the sub partition sub a then this fracture belongs to sub partition sub a in the partition algorithm the scale of the dfn models can be reduced by segmentation of regions as a result the fracture number in each sub region is much smaller than n in addition parallel computing is the basis for the realization of the region segmentation algorithm by synchronously handling as many sub regions as possible therefore identifying effective fractures and removing invalid fractures for each sub region would be more efficient in computation although the computation time increases due to partitioning and splicing of the fracture information of the dfn mode the time complexity can be reduced significantly 4 mesh generation and computation of fluid flow in 3d dfn models 4 1 method of mesh generation for 3d dfns 3d dfns provide great advantages in understanding how fluid flows through fractures discretization of model geometry is the basis of solving the governing equations on the fracture network scale 2d intersecting polygons with random orientations sizes and locations in 3d space form complex topological network structures the intersection line is taken as edges in the meshing which satisfies the conservation of head and flow at intersections erhel et al 2009 note that there are some methods that control the conservation of the flow without any constraints on the mesh berrone et al 2013a on the fracture scale the fracture surface was discretized in 2d whereas neither quadrilateral nor triangular meshes were consistent with the geometric edges of the fracture therefore the geometric discretization of the 3d dfns must meet two restrictions first the mesh must use the intersection line as edges which satisfies the conservation of pressure and flow at intersections in fig 6 a three intersecting fractures are discretized based on this restriction where the red line represents the line of interest the second prerequisite restriction is approximate disc edges to a polygon to maintain consistency with mesh edges this assumption is reasonable and conducive to geometrical discreteness notably it is only an assumption that a fracture is a disc there is no strict circular fracture in nature it is challenging to balance mesh quality and quantity especially when there is a very large number of randomly intersecting fractures that form an enormous number of small areas to date both structured and unstructured methods have been widely used in geometric discretization mohajerani et al 2018 a structured mesh means that all internal meshes have the same adjacent elements which has the advantages of fast meshing high quality and simple structure but it is difficult to mesh irregular geometries such as 3d dfns compared with structured meshes unstructured meshes have internal meshes with arbitrarily shaped adjacent cells which automatically adjust the size of the mesh according to the local geometry therefore the balance between the quantity and quality of a mesh can be easily obtained with the unstructured mesh technique hyman et al 2014 an unstructured discretization method for adaptively meshing highly discontinuous geological media is adopted in the present study skewness is defined as the difference between the actual node shape and an equilateral regular polygon with the same area ranging from 0 to 1 where the number 1 represents the element that meets the highest standards of mesh quality and 0 represents the opposite extreme i e a degraded element in fig 6 b and c the 3d dfns shown in fig 1 b dfn i and fig 1 a dfnh are triangulated with 62 715 meshes and 1 410 080 meshes respectively the skewness of these two 3d dfns is larger than 0 8 this means that the discretization method meets the requirements of numerical computation parthasarathy 1993 wang et al 2017 4 2 governing equations and boundary conditions the naiver stokes equations are a set of coupled differential equations governing the motion of viscous fluids zimmerman and bodvarsson 1996 10 ρ u t u u p μ 2 u f where ρ is the fluid density u is the velocity vector of fluid p is the pressure gradient and f is the body force vector the terms ρ u t and ρu u represent the force from the inertial effect while the term μ 2 u represents the viscous force the naiver stokes equations describe incompressible newtonian flow very well but the quadratic partial differential term μ 2 u introduces computational difficulty for the convenience of computational simplicity some macroscopic empirical governing equations have been proposed for example the cubic law which is derived from the naiver stokes equations is used to describe laminar fluid flow at low velocity through two parallel plates separated by a small aperture ju et al 2019 11 q a 3 12 u h where u is the dynamic viscosity a is the fracture aperture and the hydraulic gradient h is calculated by h h x h y according to the cubic law the hydraulic conductivity of the fracture is proportional to the quadratic square of the fracture aperture 12 k s ρ g 12 u a 2 where g is acceleration due to gravity the permeability of the fracture is proportional to both the aperture and hydraulic conductivity 13 t s a k s ρ g 12 u a 3 the flux in the fracture is given by 14 q k s h the discharge per unit of fracture width qlocal can be computed by multiplying the hydraulic gradient and hydraulic conductivity through the following formula 15 q l o c a l a q t s h the total seepage flow qglobe of the model can be obtained by integrating the local flow of each fracture at the outlet boundary then the equivalent permeability of dfns can be calculated liu et al 2018 16 k u l q g l o b e s δ p where l is the length along the flow direction of the model s is the cross sectional area and δp is the pressure difference between the inlet and outlet the reynolds equation which is also called the local cubic law is used as a governing equation to describe fluid flow between two rough fracture walls by divide the void space into several small simplified parallel plates wang et al 2016 17 t s h 0 even though natural rock fracture surfaces are generally rough the smooth parallel plate assumption can still be valid regionally if the geometry is discretized into many small smooth parallel plates the aperture assignment by the sra method is presented in section 2 2 in numerical computation the boundary conditions of the model must be set in advance two opposite surfaces γ in and γ out were set as fixed hydraulic pressures h 1 and h 2 while the other four surfaces γ imp were set to be impermeable and a neumann zero flux condition on each fracture edge γ f which can be summarized as huang et al 2016 18 h h 1 o n γ f γ i n h h 2 o n γ f γ o u t u n 0 o n γ f γ i m p u n 0 o n γ f the continuous condition on the intersection line of each fracture are erhel et al 2009 19 h k f h k o n e k f f k f f k v k f n k f 0 o n s k where h k f is the trace of the head v k f is the flow velocity and n k f is the normal unit vector on the boundary sk of the fracture ω f 4 3 numerical solution procedure fig 7 shows the processes of geometric construction and numerical computation first programming is conducted to generate geometric information of 3d dfn models in matlab then a fracture network optimization algorithm is developed to identify the effectiveness of fractures and remove fractures that make no contribution to fluid flow subsequently the surface geometry morphology of the remaining fractures is established and the variable regional fracture aperture is assigned finally the generated model is imported into comsol multiphasic for discretization and initial and boundary conditions are set for flow computations with a computer with a 64 bit operating system and an intel i5 8500 processor the computation of numerical models of fracture density p32 equal to 3 6 m2 m3 with regional aperture variation a total of 1410 080 meshes requires 2 min and the case in the dfn i model with the corresponding mechanical aperture a total number of 62 715 meshes consumes 6 s conventionally it takes more than ten hours to calculate a model containing more than 60 000 mesh nodes on a computational cluster with 64 cpus huang et al 2016 karra et al 2018 liu et al 2016 comparatively the proposed method overcomes the time consuming defect when analysing fluid flow no matter in dfnh or dfn i model furthermore this method avoids inaccurate evaluation due to the problematic degradation of 3d to 2d for the limitation of computation berkowitz 2002 therefore the proposed modelling and optimization methods of 3d dfns show great advantages in time savings and computation improvement when delineating fluid flow and transport processes and can be used for large scale or high density dfn models 5 results and analysis 5 1 verification of the newly developed method before an application is evaluated some models are established to verify the proposed method the cubic law was used to calculate the closed form theoretical permeability kt and the numerical results ks were calculated at the same time the relative error between the theoretical and computational permeabilities is defined as ε kt ks kt and listed in table 1 in the first step of verification three fracture models were developed with the parallel plate assumption as shown in fig 8 model a is a single fracture consisting of two parallel plates model b contains two intersecting parallel plate fractures dipping at 45 and 135 and model c consists of five parallel plate fractures in these three models the aperture is set uniformly to be 1 mm like the parallel connection of resistance the equivalent hydraulic aperture of the inclined plane can be obtained sudipta sarkar 2004 20 h eq i 1 n h i 3 cos φ i 3 where heq is the equivalent hydraulic aperture hi is the hydraulic aperture of the ith fracture and ϕ i is the inclination of the ith fracture in the same way that the equivalent resistance of a series of resistors is obtained the following formula can be used to obtain the equivalent hydraulic aperture of factures connected in series 21 h eq i 1 n l i l 1 h eq i 3 3 1 where h e q i is the effective aperture of the fracture corresponding to the ith segment li is the projected length of the fracture corresponding to the seepage direction and l is the total length in the direction of fluid flow as shown in table 1 the theoretical and numerical solutions are in good agreement for either single fractures or multiple fractures the three cases mentioned above prove that the proposed method for describing fluid flow in a parallel plate and fracture intersection is valid the aim of this study is to develop a numerical method of 3d dfn models considering fracture aperture heterogeneity as there is no closed form solution to calculating the equivalent hydraulic aperture of fractures with variable apertures a matlab code was developed to calculate the hydraulic aperture of rough fracture based on eqs 20 and 21 table 1 shows that the deviation of the hydraulic aperture of the models shown in fig 8 calculated by the proposed numerical method from the theoretical value are less than 0 279 this deviation results from the dispersion of aperture and can be negligible the proposed method is theoretically reliable and is feasible for characterizing fluid flow in 3d dfns in both dfn i and dfnh models 5 2 permeability comparison of the dfn h and dfn i models 5 2 1 generation of the dfn h and dfn i models treating individual fractures of dfn models as smooth parallel plates can reduce the workload of computations however previous studies indicated that this geometric simplification could lead to incorrect estimates of the permeability of fractures and the channel flow phenomenon caused by fracture aperture heterogeneity cannot be characterized zhang and nemcik 2012 the permeabilities of the dfnh model and dfn i model in fig 1 are 2 759 m2 and 3 933 m2 respectively with a relative error of 43 therefore it is important to analyse the role of fracture aperture heterogeneity in dfns to understand the fluid flow of fractured rock masses four increasing fracture densities of 0 2 0 3 0 4 and 0 5 m2 m3 and nine hydrological apertures with a gradation of 0 2 mm from 0 4 mm to 2 0 mm are considered here to reduce the influence of randomness on permeability each case was generated 10 times for simulations in total 4 fracture densities 9 hydrology apertures 10 10 times 2 dfnh and dfn i models 720 models are generated and the fluid flow through each model is simulated by applied different hydraulic pressures in the left h 1 and right boundary surface h 2 of dfn models the parameters for generating the dfn model are summarized in table 2 since the uniform aperture was applied in the dfn i model fig 9 only shows the aperture distribution of dfnh model and the hydraulic pressure distribution of the dfnh and dfn i models is also represented 5 2 2 fluid flows in dfn h and dfn i models according to the pressure and fluid distribution fig 9 in the dfnh and dfn i models the phenomenon of preferential flow appeared which may be caused by the randomness of fracture position size and orientation due to the aperture heterogeneity of individual fractures in the dfn models the phenomenon of preferential flow is more obvious in the dfnh model than in the dfn i model fig 9 shows that the smaller the fracture density is the more obvious the preferential flow phenomenon in the dfn models with increasing fracture density the number of fractures and the intersection of fractures increased which provided more paths for fluid flow and the phenomenon of preferential flow was reduced to some extent fig 10 shows the equivalent permeability of the dfn models while keeping the same fracture density the variation ranges of the fracture network permeability reached three orders of magnitude in either the dfnh or dfn i models although the fracture aperture only increased from 0 4 mm to 2 mm this implies the strong dependence of the permeability on the fracture aperture the data points in fig 10 can be fitted with an exponential function k a e m b where em is the mechanical aperture of the fracture the values of the constants a and b and correlation coefficient r2 are listed in table 3 an intense fracture density means that the fracture network contains more fractures which makes the fracture distribution more consistent with the predetermined distribution and decreases the influence of fracture randomness on the dfn model therefore the permeability of the dfn models generated by the same geometric statistical parameters such as position and orientation tends to be consistent which can be reflected by the increase in r2 to quantitatively describe the equivalent permeability discrepancy between the dfnh and dfn i models the permeability rate of the two models is defined as ki kh kh fig 11 shows the relationship between the fracture mechanical aperture and the relative variation in permeability of the two models with different fracture densities the solid red line is the average value of the relative discrepancy of the permeability and the upper and lower dotted blue lines show the boundary curves of the relative discrepancy of the permeability the difference in permeability between the two models decreased with increasing equivalent mechanical aperture and this trend was initially significant and then tended to disappear this indicates that the effect of aperture anisotropy is restricted with increasing equivalent mechanical aperture when the mechanical aperture is 0 4 mm and the fracture density is equal to 0 2 0 3 0 4 and 0 5 m2 m3 the average relative variation is 42 24 12 and 10 respectively this indicates that the increase in fracture density reduces the difference in permeability between the two models in the fracture network fluid tends to flow in the most permeable channels the increase in the number of fractures provides more alternative paths for fluid flow which is the reason for the similar values of the permeability when the two models are close in intense density 5 2 3 critical mechanical aperture fig 11 shows that the equivalent permeability discrepancy of the dfn i and dfnh models decreased with increasing fracture density or mechanical aperture a critical equivalent mechanical aperture is defined when the difference in permeability between the two models equals 10 fig 12 shows that when the fracture density is 0 2 0 3 0 4 and 0 5 m2 m3 the critical mechanical apertures are 1 1 0 8 0 6 and 0 4 mm respectively the increase in fracture density improves the connectivity of the fracture network and provides more alternative channels for fluid flow which weakens the effect of aperture heterogeneity on the permeability of dfns when the mechanical aperture of the fracture is beyond this critical value the permeability obtained by the dfn i model is close to that obtained by the dfnh model otherwise the heterogeneity of the aperture has a significant influence on seepage and this influence should be considered in computational fluid dynamic analysis using dfn models 6 conclusions this study proposed a numerical method to analyse fluid flow through 3d dfn models of heterogeneous apertures technology to identify percolation pathways and remove invalid fractures was proposed and a corresponding programme was developed to optimize the dfn models the optimized dfn model is geometrically discretized by an unstructured triangular mesh and the reynolds equation is solved using the finite element method this method guarantees the conservation of fluid mass and hydraulic pressure both locally and globally in the dfn model and can incorporate heterogeneous apertures into individual fractures to analyse the effect of aperture variables on fluid flow in individual fractures and on channel flow phenomena in the 3d dfn model the validity of the proposed numerical method is proven by using a matlab program to calculate the equivalent hydraulic aperture from 3d models and compare the results for constant and variable apertures the developed numerical methods were subsequently used to evaluate the effects of aperture heterogeneity on fluid flow in 3d dfn models the results show that this numerical method is reliable and robust and can be used for rapid numerical calculations of high density or large dfn models the preferential flow phenomenon appears in dfn i models due to geometric randomness in characteristics such as fracture length orientation position and the discrepancy of mechanical apertures in addition preferential flow paths are more easily formed in dfnh models than in dfn i models because the aperture varies within a single fracture the discrepancy of the permeability between the two models decreases significantly first and then tends to disappear with the increase in equivalent mechanical aperture which shows that the influence of the aperture heterogeneity on the permeability is restricted therefore a critical mechanical aperture can be proposed above this critical threshold the dfn i model is recommended as a means to reduce the workload during model generation and numerical computation otherwise the dfnh model is the option that can improve computational accuracy the specific geometry and aperture distribution of dfn models could strongly impact on the fluid flow behaviour further experimental and numerical studies are required to fully uncover the fluid flow behaviour through dfns with a broad spectrum of geometries in the future explorations credit authorship contribution statement kangsheng xue conceptualization methodology formal analysis writing original draft zhenyu zhang conceptualization methodology writing review editing chunlin zhong methodology yujing jiang writing review editing xueyu geng writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this study was financially supported by the national natural science foundation of china grant no 51674047 and 51911530152 supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2022 104164 appendix supplementary materials image application 1 
182,we consider a porous medium containing a single fracture and identify the aperture to length ratio as the small parameter ɛ with the fracture permeability and the fracture porosity scaled as exponents of ɛ we consider a two phase flow where the flow is governed by the mass balance and the darcy law using formal asymptotic approach we derive a catalogue of reduced models as the vanishing limit of ɛ our derivation provides new models in a hybrid dimensional setting as well as models which exhibit two scale behaviour several numerical examples confirm the theoretical derivations and provide additional insight keywords fractured porous media upscaling two phase flow 1 introduction fractures are in abundance in the subsurface such as soils national research council et al 2001 smith et al 2003 watanabe et al 1998 in glaciers fountain and walder 1998 and in many other types of porous media such as wood and concrete carmeliet et al 2004 fractures are discontinuities in the medium that form narrow zones where the hydraulic properties such as permeability or porosity are strongly different from the surrounding matrix the fractures have a strong influence on flow and transport either making flow in certain directions several orders of magnitude more rapid than in other directions or possibly nearly blocking flow in certain directions in cases where the fracture is highly permeable it can act as the dominant flow pathway through a porous matrix where there is almost no flow in the porous matrix or in cases with low permeability in the fracture it may act as an barrier allowing no fluids to pass through adler and thovert 1999 taking them into account therefore is of great interest in a wide variety of applications for instance in the petroleum extraction a fracture can lead to enhanced oil production or in co 2 storage applications it can act as a leakage pathway therefore the effects of fractures or entire fracture network need to be incorporated in mathematical models for fluid flow and transport there is a rich literature dealing with fractures and we refer to textbooks bear 1988 helmig et al 1997 adler et al 2012 as standard references and to berre et al 2019 for a recent survey the fracture has a small aperture to length ratio and this makes it difficult to resolve the fluid flow explicitly through brute force computations this is evident as the thinner the fracture is one requires smaller grid size to resolve it in most cases this is also not of much use as the transverse flow details may not be important in a thin medium given that the resolution of the fracture by discretizing the thin and long medium is computationally infeasible we are left with alternative approaches to account for their impact several approaches exist that account for this impact and we refer to a recent survey berre et al 2019 where they describe some of the most known methods there are two wider classes in which we can classify the methods to take the fractures into account one is the continuum type models where the effects of fractures are incorporated by suitably modifying the matrix hydraulic properties gerritsen and durlofsky 2005 arbogast et al 1990 and the second discrete fracture network or mixed dimensional models where the fractures are embedded as a lower dimensional objects in a porous matrix the second class of methods relies on explicit representation of fractures but representing them as lower dimensional geometric objects embedded in a three dimensional porous matrix due to the huge number and a large variation in the shapes and sizes of the fractures in a real porous medium it is not possible to resolve all the fractures a compromise is achieved by explicitly representing only the most dominant fractures and incorporating the smaller ones in terms of effective hydraulic properties as in the continuum models the variant of these approaches are known as discrete fracture matrix model dfm discrete fracture network models dfn reduced models or more generally as mixed dimensional models this has been widely used bastian et al 2000 reichenberger et al 2006 fumagalli and scotti 2013 aghili et al 2019 for a variety of flow models and singh et al 2014 girault et al 2016 bukac et al 2016 bukač et al 2015 andersen and evje 2016 brenner et al 2018 for multiphysics models including geomechanics and other advanced physical models the advantage of this method is a more faithful representation of the fracture network geometry but the challenges are in dealing with the amount of geometric complexity contained within discretized grid block and the effect of strong heterogeneity of the fracture matrix properties for instance discontinuities in matrix pressure across the fracture caused by resistance to flow the setting of this paper is in the second class of method the particularity of our setting is an immiscible two phase flow model widely used in the multiphase flow problems where two or more fluids share the pore scape the interplay of capillary viscous and buoyancy forces for the fluids in a complex pore geometry leads to a nonlinear possibly degenerate system of partial differential equations modelling the flow behaviour standard textbooks e g bear 1988 discuss these flow equations and are standard in porous media flow studies our work deals with the effective models that explicitly represents the fractures and focusses on the effect of heterogeneities in the fracture matrix properties in particular we use formal asymptotic approach to provide a rational derivation of the variety of effective models that result for different regimes of this heterogeneity the starting model is an equi dimensional one for the fracture and the matrix where the fracture is represented as a thin domain with a non zero thickness with the standard two phase darcy equations describing the flow in both the fracture and matrix the use of standard two phase darcy model for the fracture is premised on the fact that the fracture is also assumed to be porous though possibly with drastically different hydraulic properties natural interface conditions of the continuity of pressure and fluxes are imposed at the matrix fracture interfaces one of the new difficulties that comes with a two phase flow model is the different relative permeability and the capillary pressure curves for flow in the fracture and in the matrix roughly speaking our work here derives effective models as the limit of the thickness of fracture vanishes leading to reduced order models where the fracture becomes effectively a lower dimensional geometric object we focus on the derivation of these effective models this work connects the surrounding matrix which is solved by a flow equation with a fracture that is solved using a differential equation on the lower dimensional fracture surface these fracture can depending on their properties act as barriers open fracture or something in between this suggests that the upscaled models should distinguish between these cases the key parameter in our approach is ɛ the ratio of the width to the length of the fracture the porosity and the permeability contrast of the fracture matrix heterogeneity is then taken as the scale of ɛ as follows ϕ f ϕ m ɛ κ and k ˆ a f k ˆ a m ɛ λ here ϕ f k ˆ a f and ϕ m k ˆ a m are the porosities absolute permeabilities of the fracture and the matrix respectively our assumption for the starting model is of darcy type in both the fracture and the matrix this corresponds to the situation when the fracture is filled with some material so that we assume the model equations are of the same type in both the subdomains the two parameters κ and λ determine the contrast of hydraulic properties of matrix versus those of the fracture our approach is to derive effective models as ɛ goes towards zero for different values of the parameters κ and λ in contrast to the single phase flow here the relative permeability and the capillary pressure curves may be different in the fracture and the matrix though we consider a single fracture following formaggia et al 2014 our work can be used to provide a hierarchy of reduced models based on the properties of the fractured networks our approach uses formal asymptotics for the derivation of upscaled models these upscaled models are the equations satisfied by the leading order term in the expansion of the solution variables similar works pertaining to the derivation of upscaling of models for fractured medium have been followed in dugstad et al 2021 and kumar et al 2020 in dugstad et al 2021 they explore the effects of polymer in a fracture case where the permeability of the fracture is scaled with the width of the fracture moreover the permeability is supposed to be anisotropic and the effective models are obtained as a result of the scalings for the diagonal permeability components a closer reference to the present work is kumar et al 2020 where similar effective models but for the richards equation have been obtained the similarity is closer here as in the present case both the porosity and the permeability are scaled as the exponents of ɛ here we follow a similar approach but for an immiscible two phase flow containing oil and water the two phase flow model is the standard multiphase flow widely used in the subsurface energy and environmental applications and in the fractured context it has also been widely used in the literature see e g bastian et al 2000 pruess and narasimhan 1982 where they study two phase flow in a fractured porous medium surprisingly though there are far fewer results on the derivation of effective models the closest to our situation is ahmed et al 2017 where reduced models are derived for two phase flow models however the approach there is quite distinct from the ones we follow their approach is inspired from the analogous work in the single phase flow case as performed in martin et al 2005 our results are consistent with their results in certain regimes of the permeability we make this comparison later in the remark 3 1 in contrast to a formal approach here a rigorous mathematical approach has been widely used in literature we refer to the works of morales and showalter 2010 2012 tunc 2012 for a single phase flow in case of the richards equation we refer to list et al 2020 where mathematically rigorous convergence results are obtained for a certain range of parameters for a study on the transport equation in similar setting we refer to the work by pop et al 2017 gander et al 2021 uses fourier analysis to obtain coupling conditions between subdomains and obtain model error estimates when the fracture is represented as a hypersurface embedded in the surrounded rock matrix in neuss radu and jäger 2007 gahn et al 2018 2016 the authors consider a thin domain with periodic coefficients for a reactive transport model and perform a rigorous two scale homogenization to obtain interface conditions the numerical methods for solving multiphase flow in a fractured medium has received more attention we refer to the literature hoteit and firoozabadi 2008 fumagalli and scotti 2013 kim and deo 2000 fumagalli et al 2019 brenner et al 2015 angot et al 2009 and the recent review of berre et al 2019 for a discussion on the numerical methods for solving the reduced models for two phase flow a typical approach is using domain decomposition and mortar variables for the fracture variables in the present work we will use three different models which treat the fracture in different ways one model where the fracture is treated as a lower dimensional object one two scaled model where the fracture is rescaled into a separate domain and one model where the fracture acts as an barrier where there is zero flux over the fracture the paper is structured as follows in section 2 we introduce our two phase flow model where we work with a non degenerate case in section 3 we give a catalogue of the effective models for different permeability and porosity in the fracture in section 4 we derive our effective models here we use a formal asymptotic approach and obtain upscaled models for the different regimes of parameters κ and λ in section 5 we introduce our numerical results which illustrate the quality of our upscaled models and in the last section we state our conclusions regarding the upscaled models and the numerical simulations 2 model equations and scaling first we formulate the models in a dimensional form let ω ˆ r 2 be an open bounded and convex polygonal domain with boundaries denoted by ω ˆ the domain contains a single fracture ω ˆ f which divides ω ˆ into two subdomains ω ˆ 1 and ω ˆ 2 we get that ω ˆ ω ˆ 1 ω ˆ 2 ω ˆ f and that ω ˆ ω f ω ˆ 1 ω ˆ 2 the interfaces between the subdomains are denoted by γ ˆ 1 ω ˆ 1 ω ˆ f and γ ˆ 2 ω ˆ 2 ω ˆ f we reduce the fracture domain to be a one dimensional interface between the two domains ω ˆ 1 and ω ˆ 2 2 1 dimensional model we simplify the geometry so that the fracture boundaries are straight lines and the domain ω ˆ is a rectangle in terms of coordinates matrix block and equi dimensional and the reduced fracture geometry are given as it poses no additional difficulty in considering higher dimensions say r n n 3 instead of n 2 here in case n 3 the fracture is a two dimensional surface to have more generality we can consider a non self intersecting one dimensional manifold τ ˆ with the fracture represented as ω ˆ f x ω ˆ x ˆ s ˆ ϕ ˆ n τ for some s ˆ τ ˆ and ϕ ˆ l 2 here l is the width of the fracture at s ˆ in the normal direction and n τ is the outward unit normal to τ ˆ in this system we consider a two phase flow in ω ˆ m governed by darcy law and the mass conservation equation where m m 1 m 2 f let p ˆ w m denote the pressure of water phase and p ˆ o m the phase pressure of the oil the saturation of water is s ˆ w m and that of oil is s ˆ o m it holds at each point in ω ˆ and for all t 0 t 1 t ϕ m ˆ s ˆ w m u ˆ w m f ˆ w m t ϕ m ˆ s ˆ o m u ˆ o m f ˆ o m u ˆ w m k ˆ k ˆ r w μ ˆ w p ˆ w m u ˆ o m k ˆ k ˆ r o μ ˆ o p ˆ o m the first two equations are conservation of mass of water and oil phase respectively the next two equations are the darcy law that describes the flux as the gradient of the respective phase pressures the porosity is denoted by ϕ ˆ the source sink terms f ˆ i m on the right hand side stands for water or oil injections outflow furthermore k ˆ is the absolute permeability and k ˆ r w s ˆ w and k ˆ r o s ˆ o denote the relative permeability of water and oil respectively and are functions of the respective saturations moreover μ ˆ w and μ ˆ o are dynamic viscosities of water and oil for simplicity the absolute permeability k ˆ will be considered as a scalar quantity and in the matrix blocks this will be equal to 1 extension to an anisotropic case is a straight forward in the fracture domain the permeability is prescribed as an exponent of the fracture width ɛ here we have considered the same function k ˆ r w and k ˆ r o in all the three subdomains however considering different functions in the three subdomains possess no additional difficulty and can be easily accommodated the model needs further equations for its completion first is the saturation constraint at each point in space and time in each of the subdomains s ˆ w m s ˆ o m 1 the second is the closure condition where the capillary pressure for m m 1 m 2 f p ˆ c m s ˆ w m p ˆ w m p ˆ o m is a given function of saturation we make the following assumptions on the coefficients for m m 1 m 2 f 1 the relative permeability k ˆ r w k ˆ r o is assumed to be strictly positive the absolute permeability k is a positive tensor bounded both from above and below by strictly positive constants 2 the capillary pressure p c m 0 1 r is a positive monotonically decreasing smooth function with the p c m δ 0 moreover the inverse function p c m 1 r 0 1 exists and is assumed to be a smooth function in short we are considering a non degenerate system of equations with smooth coefficients in each subdomains since our approach is formal these assumptions are needed to justify the asymptotics to complete the description we need to specify the boundary interface conditions and the initial conditions for the sake of convenience homogeneous dirichlet boundary conditions are considered the interface conditions are the continuity of the pressure and the continuity of flux the precise equations will be written below the initial conditions are assumed to be given p w m t 0 p w m 0 p o m t 0 p o m 0 using the invertibility of the capillary pressure this also provides the initial conditions for the saturations 2 2 non dimensionalization we define ɛ l l that is the ratio of the fracture width to its length and to denote that the parameters are dependent on the size of ɛ we denote them with a subscript ɛ here l is the reference length scale and the geometry is in the dimensionless form 2 ω 1 ɛ 0 1 ɛ 2 1 ɛ 2 γ 1 ɛ 0 1 ɛ 2 ω 2 ɛ 0 1 1 ɛ 2 ɛ 2 γ 2 ɛ 0 1 ɛ 2 ω f ɛ 0 1 ɛ 2 ɛ 2 γ 0 1 0 the dimensionless pressure heads are given by p m j i p ˆ m j i l and p f j i p ˆ f j i l the dimensionless time is set as t t ˆ t and the final time as t t ˆ t where 3 t ϕ m l 2 k ˆ a m p ϕ m l k ˆ a m we denote the dimensionless counterparts for s ˆ i m k ˆ and k ˆ r i as s i m k and k r i respectively we now substitute the darcy law in the mass balance from model eqs 1 we get 4 t ϕ i s i m ɛ k m k r i s i m ɛ μ i p w m ɛ f m ɛ in ω m ɛ where i denotes the phases o w and m the matrix blocks m 1 and m 2 further we assume that the porosity in the matrix blocks are equal 5 ϕ 1 ϕ 2 and we would like to note the porosity and absolute hydraulic conductivity scaling in the fracture with respect to that of the surrounding matrix as suggested we have assumed the following scaling for the porosity and hydraulic conductivity in the fracture domain 6 ϕ f ϕ m ɛ κ k a f k a n ɛ λ here κ and λ are scaling parameters as earlier we use the darcy law in the mass balance equation to get the dimensionless equation for the fracture 7 t ɛ κ s i f ɛ ɛ λ k f k r i s i f ɛ μ i p w f ɛ f f in ω f ɛ we write down the full dimensionless model 8 t ϕ m s i m ɛ k k r i s i m ɛ μ i p i m ɛ f i m ɛ in ω m ɛ t ɛ κ s i f ɛ ɛ λ k k r i s i f ɛ μ i p i f ɛ f i f ɛ in ω f ɛ s w m ɛ s o m ɛ 1 in ω m ɛ ω f ɛ p c m ɛ s w m ɛ p w m ɛ p o m ɛ in ω m ɛ ω f ɛ p i m ɛ p i f ɛ on γ m ɛ ɛ λ k k r i μ i p i f ɛ n k k r i μ i p i m ɛ n on γ m ɛ p w m t 0 p w m 0 and p o m t 0 p o m 0 in ω m ɛ ω f ɛ where i w o and m m 1 m 2 and in the third and fourth equations m holds for m 1 m 2 f this problem motivates us to see if we can define different models depending on the permeability of the fracture we can thus try to determine different types of upscaled models depending on the values of κ and λ as the fracture width ɛ 0 the scaling parameter κ is related to the storage capacity of the fracture which means that for small κ κ 1 the fracture maintains its ability to store water as the fracture size tends to zero and for large κ κ 0 the storage capacity decreases as the fracture tends to zero the parameter λ is connected to the conductivity of the fracture here a small λ e g λ 0 gives a high conductivity flow can occur freely while a high λ λ 1 will give us that the fracture will behave more as a barrier as seen in the above system of equations we have considered the interface conditions where the pressures are continuous and the fluxes are equal at the fracture matrix interface in the case of two phase flow this may not hold true due to the presence of different capillary forces inside the fracture and in the matrix the presence of entry pressure may lead to an extended pressure condition at the interface as derived in van duijn and de neef 1998 the difference in entry pressures causes oil trapping at the interface our approach can be used to derive the effective models in this case as well however for simplicity we disregard these difficulties 3 main results catalogue of effective models we identify three classes of effective models i effective models i iv that have continuous pressure across the fracture matrix interface ii effective models v vi that show a two scale type behaviour and iii effective models vii x that have fractures acting as barriers and the pressure across the fracture matrix interface is disconnected in case ii the pressure is given by a differential equation inside the fracture which is coupled to those in the matrix while in case iii the fracture acts as a barrier and accordingly has zero flux boundary for the flow model in the matrix we provide the effective models for a wide range of κ and λ and make brief remarks of them the derivation of the reduced models is postponed to section 4 in the different upscaled models we have that with i w o 9 q i m γ k m k r i s i m μ p i m 1 n 1 k m k r i s i m μ x p i m 2 n 2 is the flux difference for water and oil respectively in the two solid matrix subdomains ω 1 and ω 2 note that n 1 n 2 and that these vectors are normal to the fracture 3 1 effective model i the first four models have continuous pressure the first model gives us a two dimensional problem in the surrounding matrix blocks and a one dimensional problem in the fracture domain the model for κ 1 and λ 1 with i w o and m m 1 m 2 the fracture behaves as a one dimensional domain where q w m γ and q o m γ are the flux difference for water and oil respectively in the two solid matrix subdomains ω 1 and ω 2 here the permeability is large enough to make the pressure inside the fracture to become y independent the storage term and the darcy flow term both survive and this is taken as the most widely used model for fracture coupling 3 2 effective model ii in this case we have that κ 1 λ 1 the porosity increase here with vanishing ɛ vanishing fracture width is less than linear we get the model for i w o and m m 1 m 2 as in effective model i we have that the permeability in the fracture is large enough to ensure that the fracture pressure equals the traces of the matrix pressures at the fracture matrix interfaces and we get a jump in flux over the fracture however the porosity term is sublinear and thus vanishes in the limit as κ 1 3 3 effective model iii this corresponds to the case κ 1 λ 1 1 we have the following effective model for i w o and m m 1 m 2 here only the flux terms vanish in the limit and the fracture is able to store and release fluids from the solid matrix the pressure at the fracture interfaces are retained in other words the fracture interface conditions for ω 1 and ω 2 are equal to the pressure inside the fracture 3 4 effective model iv this case is for κ 1 λ 1 1 it has been partly covered by previous cases the pressure and the normal fluxes become continuous at the interface in practice the fracture has disappeared as a physical entity and can be ignored in the upscaled model 3 5 effective model v this is the first effective model with discontinuous pressure over the fracture first we will consider the case where κ 1 and λ 1 10 x ξ and y 1 ɛ η here we have rescaled the fracture subdomain ω f ɛ to an ɛ independent subdomain ω f 11 ω f 0 1 1 2 1 2 where the 0 1 term is the rescaling of the x coordinates now denoted as ξ and the 1 2 1 2 term is the rescaling of the y coordinates now denoted as η notice that the solution in the fracture in both effective models v and vi depends on η the value η 1 2 corresponds to the boundary bottom boundary of ω m 1 at y 0 similarly η 1 2 corresponds to the top boundary of ω m 2 y 0 these models will be referred to as two scale models and a typical two scale model has the scaling such that we need to resolve the details of the fracture in this sense representing the fracture as an interface is not fully justified the original problem is divided into three coupled subdomains that are solved separately using boundary conditions from each other for i w o and m m 1 m 2 here for each ξ x one determines p i f ξ as the solution to the parabolic differential equation in one dimensional spatial domain 3 6 effective model vi the same happens for the effective model where κ 1 the effective model remains the same as in the previous case except for the storage term it vanishes for i w o and m m 1 m 2 for any t ξ x t p i f t ξ solves the one dimensional elliptic auxiliary problem 3 7 effective model vii in the case where λ 1 and κ 1 we get a discontinuous pressure over the fracture interface the result is that the fracture flux is zero and it behaves as a barrier the two domains ω 1 and ω 2 can be solved separately for i w o and m m 1 m 2 3 8 effective model viii in the case where λ 1 and κ 1 there is little difference from case vii the only difference is that the storage term in the fracture drops out in the limit of ɛ 0 for i w o and m m 1 m 2 we end up with the model 3 9 effective model ix the two last effective models are models with spatially constant pressure in the fracture the permeability in the fracture is so large that the pressure in the fracture will be the same short time after a pressure change the reduced models will depend only on the time p w f t y p w f t and p o f t y p o f t for the models this means that the fracture endpoints cannot impose different pressures at the fracture endpoints the effective model 9 is for the cases where κ 1 and λ 1 one get for i w o and m m 1 m 2 the pressure is spatially constant and continuous in the fracture and therefore it must be spatially constant at the interfaces as well 3 10 effective model x this case is for κ 1 and λ 1 here the storage term vanishes there is no equation giving the pressure in the fracture and we get for i w o and m m 1 m 2 where for each t 0 t the time dependent function p i f p i f t is determined such that 0 1 q m γ d x 0 remark 3 1 we make a brief comparison with the fracture models that are widely used in practice see e g berre et al 2019 we refer to martin et al 2005 where similar models are derived for single phase flow and to ahmed et al 2017 for two phase flow models our results here are different in these respects the derivation follows different arguments and secondly the final results are consistent in certain regimes of the parameters yet not identical the derivation in martin et al 2005 and in ahmed et al 2017 takes place in three steps first the darcy flow equation along the fracture surface is obtained immediately by considering the flux component in the tangential direction of the fracture second one integrates the flow equation along the transverse direction in the fracture subdomain using the continuity of fluxes at the matrix fracture interfaces this yields a surface equation with the jump in the matrix flux term as a source term the third step is a closure relationship by postulating a pressure profile in the fracture this is in contrast with our approach we assume a scaling of hydraulic properties on ɛ and κ and use a formal asymptotic ansatz where we only consider the terms of o ɛ as this is the leading term once the choice of scaling is made the rest of the steps follow without any additional assumptions in particular our approach does not postulate any closure condition on the pressure inside the fracture as this is part of the solution also we mention that in the references cited the closure condition introduces a parameter in the effective model for the fracture here we have a catalogue of models and no additional parameter is necessary moreover for several of the regimes considered here the derivation is sustained by mathematically rigorous proofs see list et al 2020 in terms of the final results we remark that for certain regimes e g λ 1 our approach yields that the fracture flow cannot be collapsed on a surface and we must resolve the details of the flow there however in the references and currently in practice as well such two scale models are not used and instead a mixed dimensional model is used irrespective of the parameter range remark 3 2 this paper considers a simple geometry for the fracture embedded in a porous matrix besides our model is a standard two phase flow model with interface conditions across the matrix fracture interface this is consistent with our objective to illustrate the role of properties of the fracture in determining the appropriate discrete fracture network dfn model the two natural extensions are in the fracture networks and introducing further multiphysics the former extension requires defining models at different scales e g in the intersection of the fracture equi dimensional subdomains this would introduce more scales for the hydraulic properties in the intersecting subdomains and the latter corresponds to reactive multiphase flow nonlinear interface conditions or more general models involving thermal and mechanical models also differences in the composition of fracture and matrix may cause strong heterogeneities in the constitutive relations manifested as capillary barriers and entry pressure effects over the fracture matrix interface van duijn et al 2007 depending on the specific form of relative permeabilities and capillary pressure functions these heterogeneities are known to cause numerical challenges the formal asymptotic approach used here can be used to incorporate these difficulties for further uses we mention that this approach can be used to provide arguments for the mixed dimensional models proposed in boon et al 2017 based on physical arguments in the same spirit the reduced models are derived for fracture networks in formaggia et al 2014 building on the work of martin et al 2005 our work can be used to similarly provide a hierarchy of reduced models based on the properties of the fractured networks 4 formal upscaling and derivation of effective models we perform a formal upscaling for the above system of equations to derive the effective equations for quantities in the subdomain ω i m i w o m m 1 m 2 f one makes the following ansatz for the pressure 12 p i m ɛ p i m 0 ɛ p i m 1 o ɛ 2 and the corresponding ansatz for the saturations 13 s i m ɛ s i m 0 ɛ s i m 1 o ɛ 2 4 1 interface conditions next we treat the interface conditions this preparation will be useful in the derivation of the effective models we take the interface conditions after the formal upscaling 14 p w f 0 ɛ p w f 1 o ɛ 2 p w m 1 0 ɛ p w m 1 1 o ɛ 2 on γ 1 ε p w f 0 ɛ p w f 1 o ɛ 2 p w m 2 0 ɛ p w m 2 1 o ɛ 2 on γ 2 ε p o f 0 ɛ p o f 1 o ɛ 2 p o m 1 0 ɛ p o m 1 1 o ɛ 2 on γ 1 ε p o f 0 ɛ p o f 1 o ɛ 2 p o m 2 0 ɛ p o m 2 1 o ɛ 2 on γ 2 ε and see that the effective pressure interface conditions up to the leading order becomes 15 p w f 0 p w m 1 0 p o f 0 p o m 1 0 on γ p w f 0 p w m 2 0 p o f 0 p o m 2 0 o n γ recalling the scaling introduced in the effective model 5 for ξ and η the derivatives get transformed to x ξ and y 1 ɛ η and the interface conditions at γ 1 and γ 2 become 16 ɛ λ 1 k k r w μ w η p w f ɛ k k r w μ w y p w m 1 ɛ on γ ɛ λ 1 k k r o μ o η p o f ɛ k k r o μ o y p o m 2 ɛ on γ for j 1 2 from the interface conditions in 16 we see that when λ 1 for an ɛ 0 we have that the left hand side goes towards zero leading to the following interface conditions for the leading order term for the matrix subdomain fluxes 17 k k r w μ w y p w m 1 0 0 on γ k k r w μ w y p w m 2 0 0 on γ k k r o μ o y p o m 1 0 0 on γ k k r o μ o y p o m 2 0 0 on γ for the case where λ 1 the interface conditions become 18 k k r w μ w η p w m f 0 k k r w μ w ξ p w m 1 0 on γ k k r w μ w η p w m f 0 k k r w μ w ξ p w m 2 0 on γ k k r o μ o η p o m f 0 k k r o μ o ξ p o m 1 0 on γ k k r o μ o η p o m f 0 k k r o μ o ξ p o m 2 0 on γ for λ 1 we keep it in the same form we also state the energy estimate for the model equations this will allow us to conclude that the leading order terms p w f 0 p o f 0 are independent of y we multiply the model eqs 8 by p w m 1 ɛ p o m 1 ɛ p w m 2 ɛ p o m 2 ɛ p w f ɛ p o f ɛ and integrate over the respective domains ω f ɛ ω 1 ɛ and ω 2 ɛ using the gauss divergence theorem to transfer the div to the other term and using the boundary condition we obtain ω f ɛ ɛ κ t s o f ɛ p o f ɛ p w f ɛ d x ɛ λ ω f ɛ k k r w s w f ɛ p w f ɛ 2 d x ɛ λ ω f ɛ k k r o s o f ɛ p o f ɛ 2 d x ω 1 ɛ k k r o s o m 1 ɛ p o m 1 ɛ 2 d x ω 1 ɛ k k r w s w m 1 ɛ p w m 1 ɛ 2 d x ω 2 ɛ k k r w s w m 2 ɛ p w m 2 ɛ 2 d x ω 2 ɛ k k r o s o m 2 ɛ p o m 2 ɛ 2 d x ω 1 ɛ t s o m 1 ɛ p o m 1 ɛ p w m 1 ɛ d x ω 2 ɛ t s o m 2 ɛ p o m 2 ɛ p w m 2 ɛ d x 0 integrating over time from 0 to an arbitrary time t we obtain ɛ κ ω f ɛ b s w f ɛ t ɛ λ 0 t ω f ɛ k k r w s w f ɛ p w f ɛ 2 d x d t ɛ λ 0 t ω f ɛ k k r o s o f ɛ p o f ɛ 2 d x d t 0 t ω 1 ɛ k k r o s o m 1 ɛ p o m 1 ɛ 2 d x d t 0 t ω 1 ɛ k k r w s w m 1 ɛ p w m 1 ɛ 2 d x d t 0 t ω 2 ɛ k k r w s w m 2 ɛ p w m 2 ɛ 2 d x d t 0 t ω 2 ɛ k k r o s o m 2 ɛ p o m 2 ɛ 2 d x d t ω 1 ɛ b s w m 1 ɛ t ω f ɛ b s w m 2 ɛ t c here b z 0 z p c z d z and is a positive quantity in the transformed co ordinates ξ x η y ɛ inside the fracture region we get ɛ λ 1 ɛ 2 0 t 1 2 1 2 k k r w s w f ɛ η p w f ɛ 2 d η d t ɛ λ 0 t 0 1 k k r w s w f ɛ ξ p w f ɛ 2 d ξ d t c using non degeneracy of k r w η p w f ɛ c ɛ 1 λ this allows us to conclude that the leading order term p w f 0 in the expansion of p w f ɛ for λ 1 is independent of the y co ordinate as well as the η co ordinate in the re scaled variables that is 19 p w f 0 p w f 0 x this implies that for λ 1 the leading order approximation for the water pressure in the fracture is independent of the y direction the same conclusion holds for oil pressure thus for λ 1 we have 20 p o f 0 p o f 0 x this completes the preparation for deriving the effective equations now we consider the model equations for different regimes for κ and λ 4 2 derivation of the effective models we begin with the matrix subdomain equations the upscaling here proceeds without much difficulty 4 2 1 matrix subdomains recall the model equation in the matrix subdomain for i w o m m 1 m 2 t ϕ m s i m k k r i s i m μ i p i m f i m in ω m ɛ note that in the matrix subdomain the derivatives do not introduce any ɛ and it gets introduced only in the expansion of the variables substituting the ansatz for pressure and saturation we obtain up to o ɛ 2 approximation t ϕ m s i m 0 ɛ s i m 1 k k r i s i m 0 ɛ s i m 1 μ i p i m 0 ɛ p i m 1 f i m in ω m ɛ restricting up to leading order we have that ω m ɛ tends to ω m as ɛ tends to zero t ϕ m s i m 0 k k r i s i m 0 μ i p i m 0 f i m in ω m this reflects the stability of the matrix subdomains with respect to the upscaling this is expected since the matrix subdomain converges uniformly to ɛ independent subdomain and the coefficients are ɛ independent this holds true regardless of the value of λ and κ 4 2 2 fracture subdomain next we consider the fracture equation 21 t ɛ κ s i f ɛ λ k k r w s i f μ i p i f f i f in ω f ɛ and with the rescaling of the fracture domain the rescaled equations in the ω f become 22 t ɛ κ s w f 0 ɛ s w f 1 1 ɛ 2 η ɛ λ k k r w s w f 0 ɛ s w f 1 μ w η p w f 0 ɛ p w f 1 ξ ɛ λ k k r w s w f 0 ɛ s w f 1 μ w ξ p w f 0 ɛ p w f 1 f w f t ɛ κ s o f 0 ɛ s o f 1 1 ɛ 2 η ɛ λ k k r o s o f 0 ɛ s o f 1 μ o η p o f 0 ɛ p o f 1 ξ ɛ λ k k r o s o f 0 ɛ s o f 1 μ o ξ p o f 0 ɛ p f o 1 f o f 4 2 3 subcases when λ 1 recall that in this case p w f 0 and p o f 0 are independent of η by virtue of this we conclude that p c s w 0 p o f 0 p w f 0 is independent of η from the invertibility of p c we get that s w f 0 is independent of η as well due to the saturation constraint s o f 0 is also independent of η we begin with the case κ 1 λ 1 integrating eq 22 over η 1 2 to 1 2 and multiplying the equation by ɛ we have ɛ 1 κ 1 2 1 2 t s w f 0 ɛ s w f 1 d η 1 ɛ 1 2 1 2 η ɛ λ k k r w s w f 0 ɛ s w f 1 μ w η p w f 0 ɛ p w f 1 d η ɛ 1 2 1 2 ξ ɛ λ k k r w s w f 0 ɛ s w f 1 μ w ξ p w f 0 ɛ p w f 1 d η 1 2 1 2 ɛ f w f d η ɛ 1 κ 1 2 1 2 t s o f 0 ɛ s o f 1 d η 1 ɛ 1 2 1 2 η ɛ λ k k r o s o f 0 ɛ s o f 1 μ o η p o f 0 ɛ p o f 1 d η ɛ 1 2 1 2 ξ ɛ λ k k r o s o f 0 ɛ s o f 1 μ o ξ p o f 0 ɛ p f o 1 d η 1 2 1 2 ɛ f o f d η the reason for multiplying by ɛ is obvious this matches the scale of ɛ in the flux interface conditions 16 we take the leading order term and use the independence of these leading order terms p w f 0 p o f 0 s w f 0 s o f 0 of η moreover the scaled right hand side is assumed to be independent of η with these considerations ɛ κ 1 t s w f 0 ɛ λ 1 k k r w s w f 0 μ w η p w f 0 η 1 2 ɛ λ 1 k k r w s w f 0 μ w η p w f 0 η 1 2 ɛ λ 1 ξ k k r w s w f 0 μ w ξ p w f 0 ɛ f w f ɛ κ 1 t s o f 0 ɛ λ 1 k k r o s o f 0 μ o η p o f 0 η 1 2 ɛ λ 1 k k r o s o f 0 μ o η p o f 0 η 1 2 ɛ λ 1 ξ k k r o s o f 0 μ o ξ p o f 0 ɛ f o f using the interface condition for the flux in 16 and restricting up to the leading order term ɛ λ 1 k k r w s w f 0 μ w η p w f 0 η 1 2 k k r w μ w y p w m 1 0 y 0 ɛ λ 1 k k r w s w f 0 μ w η p w f 0 η 1 2 k k r w μ w y p w m 2 0 y 0 for the oil flux we get a similar expression ɛ λ 1 k k r o s o f 0 μ o η p o f 0 η 1 2 k k r o μ o y p o m 1 0 y 0 ɛ λ 1 k k r o s o f 0 μ o η p o f 0 η 1 2 k k r o μ o y p o m 2 0 y 0 defining the jump in the flux for the water and the oil across the fracture surface q w 0 k k r w μ w y p w 0 y 0 k k r w μ w y p w 0 y 0 q o 0 k k r o μ o y p o 0 y 0 k k r o μ o y p o 0 y 0 with these definitions for the jump in the flux on hand we rewrite the averaged model as 23 ɛ κ 1 t s w f 0 ɛ λ 1 ξ k k r w s w f 0 μ w ξ p w f 0 q w 0 f w f ɛ κ 1 t s o f 0 ɛ λ 1 ξ k k r o s o f 0 μ o ξ p o f 0 q o 0 f o f now in 23 we consider the different regimes of coefficients for κ 1 λ 1 we get 24 t s w f 0 ξ k k r w s w f 0 μ w ξ p w f 0 q w 0 f w f t s o f 0 ξ k k r o s o f 0 μ o ξ p o f 0 q o 0 f o f next we consider the case when κ 1 λ 1 the only change from the above derivation is the storage term this term vanishes in the limit as ɛ goes to zero indeed for κ 1 we have ɛ κ 1 t s w f 0 0 and ɛ κ 1 t s o f 0 0 as ɛ 0 with the storage term vanishing on γ for the coefficients κ 1 λ 1 it holds 25 ξ k k r w s w f 0 μ w ξ p w f 0 q w 0 f w f ξ k k r o s o f 0 μ o ξ p o f 0 q o 0 f o f in the case when λ 1 1 on the fracture surface γ we have that ɛ λ 1 x k k w f μ w x p w f 0 0 as ɛ 0 the averaged equation therefore takes the form of an ode since the flux term now drops out on γ it holds that t s w f 0 q w 0 f w f t s o f 0 q o 0 f o f the next effective model is for κ 1 λ 1 1 partly these intervals have been covered in the previous cases for λ 1 1 the flux term drops out and for κ 1 the storage term vanishes the resulting equation therefore takes the form q w 0 f w f 0 q o 0 f o f 0 in the absence of any source term this case shows that the pressure is continuous over the fracture the effective model behaves as if the fracture as a physical entity has disappeared 4 2 4 subcases when λ 1 this is the critical case of λ being exactly equal to 1 in contrast to the previous case when λ 1 led to the continuity of pressures across the fracture interface this case leads to a discontinuous pressure however the pressures at the two sides of the fracture interfaces are not independent rather they are coupled through a differential equation inside the rescaled fracture subdomain we have different interface conditions on the two sides of the fracture and we define the interfaces as γ 1 ω 1 ω f and γ 2 ω 2 ω f let us first derive the model equations for this case before discussing more on their structures the next case the fifth case is for κ 1 and λ 1 and we have these interface conditions 26 k k r w μ w η p w f 0 k k r w μ w y p w m 1 0 on γ 1 k k r w μ w η p w f 0 k k r w μ w y p w m 2 0 on γ 2 k k r o μ o η p o f 0 k k r o μ o y p o m 1 0 on γ 1 k k r o μ o η p o f 0 k k r o μ o y p o m 2 0 on γ 2 and the continuity of the pressure 27 p w f 0 t x η 1 2 p w m 1 0 t x 0 p w f 0 t x η 1 2 p w m 2 0 t x 0 p o f 0 t x η 1 2 p o m 1 0 t x 0 p o f 0 t x η 1 2 p o m 2 0 t x 0 we begin again from 22 for λ 1 and again multiplying the equation by ɛ and restricting up to leading order terms ɛ κ 1 t s w f 0 η k k r w s w f 0 μ w η p w f 0 ɛ 2 ξ k k r w s w f 0 μ w ξ p w f 0 ɛ f w f ɛ κ 1 t s o f 0 η k k r o s o f 0 μ o η p o f 0 ɛ 2 ξ k k r o s o f 0 μ o ξ p o f 0 ɛ f o f clearly ɛ 2 ξ k k r w s w f 0 μ w ξ p w f 0 0 ɛ 2 ξ k k r o s o f 0 μ o ξ p o f 0 0 as well as the source term goes to zero as ɛ vanishes with these considerations we obtain the following model ɛ κ 1 t s w f 0 η k k r w s w f 0 μ w η p w f 0 0 ɛ κ 1 t s o f 0 η k k r o s o f 0 μ o η p o f 0 0 now we consider a different regime for κ 1 we obtain the effective model v the fracture flow model is given as follows 28 t s w f 0 η k k r w s w f 0 μ w η p w f 0 0 for η 1 2 1 2 t x 0 t γ t s o f 0 η k k r o s o f 0 μ o η p o f 0 0 for η 1 2 1 2 t x 0 t γ the interface conditions and the subdomain equations complete the model derivation next case we treat is the case where κ 1 λ 1 this case is almost equal to the previous case however the scaling of κ in the storage term is different the interface condition remains the same for this range of κ the storage term vanishes in the limit as ɛ goes to zero that is ɛ κ 1 t s w f 0 0 ɛ κ 1 t s o f 0 0 the fracture equations then take the form 29 η k k r w s w f 0 μ w η p w f 0 0 for η 1 2 1 2 t x 0 t γ η k k r o s o f 0 μ o η p o f 0 0 for η 1 2 1 2 t x 0 t γ together with the interface conditions 26 and 27 and retaining the subdomain equation this completes the derivation of the effective model vi the dependency of p o f 0 and p w f 0 on t and y happens via the interface conditions notice that in the effective models v and vi the fracture model does not collapse into reduced dimensional fracture models and one needs to solve differential equations inside the fracture subdomain this is what we will refer to as the two scaled models similar to a cell problem in homogenization this is different from what happened in the effective models i iv where one needs to solve differential equations on the fracture surface 4 2 5 subcases when λ 1 for the last two models the permeability in the fracture is sufficiently low such that the fracture acts as a barrier these cases are for κ 1 λ 1 and κ 1 λ 1 the difference between these two cases is the scaling of the storage term and as we have seen before the storage term will not survive in the latter case the subdomain equations remain unchanged as before we then recall the interface conditions in 17 to deduce the boundary conditions for the matrix subdomain 30 k k r w μ w p w m 1 0 ɛ n 0 on γ k k r o μ o p o m 1 0 ɛ n 0 on γ k k r w μ w p w m 2 0 ɛ n 0 on γ k k r o μ o p o m 2 0 ɛ n 0 on γ the zero flux boundary condition between the matrix sub domains leads to a set of subdomains that are independent of each other and can be solved separately the fracture equation becomes irrelevant however for the case when κ 1 we can still evaluate the fracture equation by solving the differential equations 31 t s w f 0 t η x 0 for η 1 2 1 2 t x 0 t γ t s o f 0 t η x 0 for η 1 2 1 2 t x 0 t γ as the flux terms in the fracture drop out in the case when κ 1 λ 1 even the storage term drops out making the fracture equation irrelevant together with retaining the initial condition and the boundary conditions we recover the effective models vii and viii for the last two effective models ix and x we have the cases κ 1 λ 1 and κ 1 λ 1 respectively the permeability in this case is large enough so that the pressure becomes independent of y clearly in this regime the pressures are independent of y since λ is less than 1 as seen before however in this regime the pressure also becomes independent of x this implies that the pressure is constant along the fracture surface this is possible only when the boundary conditions are compatible the difference between ix and x is that in case ix when κ 1 the storage term survives and the fracture pressure only depends on t in x the storage term also drops out 4 3 summary of the effective models below we summarize the range of parameters and their corresponding effective models κ 1 λ 1 effective model i κ 1 λ 1 effective model ii κ 1 λ 1 1 effective model iii κ 1 λ 1 1 effective model iv κ 1 λ 1 effective model v κ 1 λ 1 effective model vi κ 1 λ 1 effective model vii κ 1 λ 1 effective model viii κ 1 λ 1 effective model ix κ 1 λ 1 effective model x 5 numerical examples in this section we will numerically verify the above upscaling results to perform numerical experiments we use a fully implicit two phase oil and water model as implemented in the matlab reservoir simulation toolbox mrst lie 2019 we use the standard finite volume scheme using two point flux scheme tpfa on a static uniform grid with rectangular cells the geometry is built up by two smaller rectangular domains separated by a fracture as considered in the derivation the two domains ω 1 and ω 2 consist of 100 50 grid blocks each the fracture is treated in different ways depending on the effective model in use the reference solution is obtained by solving the two phase flow model 1 in ω ε ω 1 ε ω f ε ω 2 ε as shown in fig 1 here the fracture is solved together with the surrounding matrix using the tpfa the domain ω is fully saturated with oil at t 0 the global pressure for the boundary conditions are taken to be of dirichlet type on all sides with a pressure of p 2 at the bottom and at the left side of the domain on the top and right hand side the pressure is p 1 at the time t 0 we have that the whole domain ω is fully oil saturated and then we start the water injection this is done by setting the saturation of the fluxes at the boundaries as water only in our reference model we solve the full model using these boundary conditions on all the sides however for the upscaled models we need some interface conditions at the fracture interface these conditions vary depending on the different effective models we use and the different models vary depending on the values of λ and κ the easiest case however is the case where the fracture completely separates the two sub domains ω 1 and ω 2 from each other here we can put a zero flux interface condition and just solve the two sub domains ω 1 and ω 2 separately we provide further information on solving each of the three effective models in the numerical tests below the capillary pressure is implemented with a simple linear relationship of the form p c s c 1 s which is implemented in mrst where c is a constant and s is the saturation in the following simulations c 0 01 we do also have linear relative permeabilities for each phase our approach for the validation is as follows we select certain values of ε κ λ which determine the reference geometry and the permeabilities we compute the pressure for the full reference model resolving the fracture thickness i e we solve the equations in 8 with a finite value of ε and use this for our reference solution depending on the κ and λ we pick a suitable upscaled model from the catalogue for these values the solution from the upscaled model is then compared to those from the reference model we choose three sets of representative values for κ and λ we choose i λ 2 κ 1 ii λ 1 κ 1 and iii λ 2 κ 1 these three regimes correspond to permeability being quite large critical case and sufficiently low permeability to act as a barrier case respectively for these three cases we choose three representative upscaled models from the catalogue the three models are selected such that they are the appropriate models for the above three cases the first model is the effective model i which has the model equations collapsed on a surface with the jump in the flux from the matrix appearing on the right hand side the second representative model is the two scale model effective model v which retains the storage term time derivative term of saturation the effective model vii is chosen from the class that caters to sufficiently low permeability so that the fracture acts as a barrier effective model i is the appropriate model for case i λ 2 κ 1 whereas models v and vii are appropriate for ii λ 1 κ 1 and iii λ 2 κ 1 cases respectively the motivation for setting up these numerical tests is the following for a certain parameter range we find that the corresponding model from the catalogue is the appropriate one and matches the reference solution quite closely moreover if we choose one particular model but then choose the parameters far from their range of validity the accuracy decreases this shows that relying on only one of these models would not be appropriate for all the range of the parameters 5 1 effective model i we study the effective model i and its quality in solving the models for the three cases as mentioned above note that this is a mixed dimensional model with the fracture flow model on the fracture surface coupled to the matrix flow equations we adopt a domain decomposition procedure consisting of neumann to dirichlet and dirichlet to neumann operators for solving the model equations here we compute the fluxes from the matrix ω 1 and ω 2 at the interfaces and compute the jump in the flux term and use this as a source term at the fracture domain the equations for the fracture are solved with the boundary conditions at the fracture boundaries the pressure calculated using the model equations in the fracture is used as the new dirichlet boundary condition for ω 1 and ω 2 then we repeat the procedure until the solution converges within tolerance in fig 2 we see that the effective model i gives a good prediction for the case where the permeability in the fracture is sufficiently large λ 2 κ 1 the saturation curves from the upscaled model and the reference model are quite close to each other at each time step we plot the pressure with respect to the y axis for a fixed x coordinate in the plot on the right side of fig 2 the three lines in the figure represent different fixed x values in our domain ω and we plot the pressure with respect to the y values from fig 2 b we see that the pressure curves from the upscaled model and the reference model overlap perfectly however if we had tried this model for cases that are outside their range of validity λ and κ for instance λ 0 this model gives unphysical results the upscaled models must be carefully selected depending on the values of λ and κ we note that this effective model is derived under the assumption of high permeability in the fracture λ 1 this forces the pressure to be continuous across the fracture matrix interface however for the two cases where λ 1 and λ 2 the permeability is small enough that it leads to discontinuity across the fracture matrix interface this explains why this model is unable to approximate the solutions in the other two cases 5 2 two scaled model effective model v for the two scaled model the solution procedure consists of rescaling the domain and then solve the fracture and the matrix domains in an implicit manner note that the interface conditions across the fracture subdomain interface is continuity of pressures and that of fluxes this implies that we can solve the fracture and subdomain unknowns together getting a system of algebraic equations where the subdomains and the rescaled fracture pressure unknowns are coupled together in fig 3 we have used the upscaled model for various values of κ and λ again we use this model to solve the three cases as mentioned above in fig 3 we have plotted the saturation and pressure from our numerical results we have used the two scaled model and solved it for the three same λ and κ values as we have used in the previous model from the previous section we expect the case where λ 1 and κ 1 to be the best fit for our model this is also the case as seen in fig 3 c where the saturation curves overlap and we see the same for the pressure curves in fig 3 d in the two other cases the fit is not as good for the case where λ 2 we see that the model does not catch the jump in pressure over the fracture the two scale model has the advantage that it resolves the flow profile inside the fracture unlike the other effective models that either take uniform pressure across the vertical direction or simply decouple the two subdomains since there is a discontinuity of pressure across the fracture this model seems to provide a better approximation for the case of λ 2 when there is also a discontinuity of pressures than in the case when λ 2 when there is a continuity of pressures 5 3 the decoupled model effective model viii here we discuss the results from what we refer to as a decoupled model the model is expected to work in cases where the fracture permeability is sufficiently small and refers to structures such as barriers or cap rocks in this upscaled model the two domains ω 1 and ω 2 are solved separately with zero flux boundaries along the fracture interface in this case the effective problem decouples completely to give two inependent subproblems each of the subproblem is a two phase model with zero flux boundary at the fracture interface fig 4 gives the saturation and pressure curves for the upscaled model for the three cases as discussed above from fig 4 we see that this model gives a good matching for the saturation curves for cases where the permeability in the fracture is sufficiently low λ 1 fig 4 e for the other cases in fig 4 a and fig 4 c we see that the saturation curves from the upscaled model and those from the reference solutions do not overlap the pressures for our last time steps are shown in the graphs at the right hand side of fig 4 and we see the same type of behaviour here the pressure curves from the upscaled model overlap with the pressures from the reference model for the case where λ 1 fig 4 f in the other cases however there is no overlapping and the other upscaled model is therefore not good for predicting the flow in these intervals here we note that the permeability is quite small obstructing the flow across the fracture interface and in the limit this leads to discontinuity of pressures across the matrix fracture interface this obstruction of flow is captured by the zero flux condition this explains why this effective model captures this case quite well but fails in the cases when the pressure is continuous case i moreover the critical case when λ 1 even though it also leads to discontinuity of pressures there is still flow taking place across the fracture surface and the pressures from the two subdomains sides are not independent rather coupled via a differential equation that resolves the pressure profile inside the fracture subdomain this explains why this effective model is unable to approximate this case sufficiently well an important observation is that the model equations are discontinuous with respect to the parameters λ and κ in particular for λ 1 we see that a small perturbation in this value would imply the upscaled model changes its character quite abruptly this is not a satisfactory situation because in practice we do not know the exact value of λ and κ this suggests that higher order terms are needed to obtain the next order approximation so that the model equations retain the continuity this would be the subject of our future investigations this is also likely to give a better understanding of the practical use of mixed dimensional models for all the parameter ranges and using a fitting parameter to guess the pressure profile inside the fracture 6 conclusion we consider a two dimensional fractured porous medium where the fracture has a thickness ε for our flow model we have considered a standard fully implicit two phase oil water model this model consists of combining the mass balance equation with the darcy equation for each of the two phases we perform an upscaling of the flow model which is obtained as the limit as ε tends to zero the particularity in our approach is the scaling of the permeabilities of the two phases and porosity of the matrix that is taken as exponents of ε characterized by two real numbers λ and κ respectively we obtain a catalogue of models for different values of λ and κ in our numerical simulations we show that we can use κ and λ to pick an upscaled model and that the upscaled models work inside their range of validity finally we think that the higher order approximations are needed in order to deal with the discontinuous nature of the upscaled models with respect to the parameters declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we would like to thank the norwegian research council for their financial support through the project rcn project 811716 lab2field all authors approved the version of the manuscript to be published 
182,we consider a porous medium containing a single fracture and identify the aperture to length ratio as the small parameter ɛ with the fracture permeability and the fracture porosity scaled as exponents of ɛ we consider a two phase flow where the flow is governed by the mass balance and the darcy law using formal asymptotic approach we derive a catalogue of reduced models as the vanishing limit of ɛ our derivation provides new models in a hybrid dimensional setting as well as models which exhibit two scale behaviour several numerical examples confirm the theoretical derivations and provide additional insight keywords fractured porous media upscaling two phase flow 1 introduction fractures are in abundance in the subsurface such as soils national research council et al 2001 smith et al 2003 watanabe et al 1998 in glaciers fountain and walder 1998 and in many other types of porous media such as wood and concrete carmeliet et al 2004 fractures are discontinuities in the medium that form narrow zones where the hydraulic properties such as permeability or porosity are strongly different from the surrounding matrix the fractures have a strong influence on flow and transport either making flow in certain directions several orders of magnitude more rapid than in other directions or possibly nearly blocking flow in certain directions in cases where the fracture is highly permeable it can act as the dominant flow pathway through a porous matrix where there is almost no flow in the porous matrix or in cases with low permeability in the fracture it may act as an barrier allowing no fluids to pass through adler and thovert 1999 taking them into account therefore is of great interest in a wide variety of applications for instance in the petroleum extraction a fracture can lead to enhanced oil production or in co 2 storage applications it can act as a leakage pathway therefore the effects of fractures or entire fracture network need to be incorporated in mathematical models for fluid flow and transport there is a rich literature dealing with fractures and we refer to textbooks bear 1988 helmig et al 1997 adler et al 2012 as standard references and to berre et al 2019 for a recent survey the fracture has a small aperture to length ratio and this makes it difficult to resolve the fluid flow explicitly through brute force computations this is evident as the thinner the fracture is one requires smaller grid size to resolve it in most cases this is also not of much use as the transverse flow details may not be important in a thin medium given that the resolution of the fracture by discretizing the thin and long medium is computationally infeasible we are left with alternative approaches to account for their impact several approaches exist that account for this impact and we refer to a recent survey berre et al 2019 where they describe some of the most known methods there are two wider classes in which we can classify the methods to take the fractures into account one is the continuum type models where the effects of fractures are incorporated by suitably modifying the matrix hydraulic properties gerritsen and durlofsky 2005 arbogast et al 1990 and the second discrete fracture network or mixed dimensional models where the fractures are embedded as a lower dimensional objects in a porous matrix the second class of methods relies on explicit representation of fractures but representing them as lower dimensional geometric objects embedded in a three dimensional porous matrix due to the huge number and a large variation in the shapes and sizes of the fractures in a real porous medium it is not possible to resolve all the fractures a compromise is achieved by explicitly representing only the most dominant fractures and incorporating the smaller ones in terms of effective hydraulic properties as in the continuum models the variant of these approaches are known as discrete fracture matrix model dfm discrete fracture network models dfn reduced models or more generally as mixed dimensional models this has been widely used bastian et al 2000 reichenberger et al 2006 fumagalli and scotti 2013 aghili et al 2019 for a variety of flow models and singh et al 2014 girault et al 2016 bukac et al 2016 bukač et al 2015 andersen and evje 2016 brenner et al 2018 for multiphysics models including geomechanics and other advanced physical models the advantage of this method is a more faithful representation of the fracture network geometry but the challenges are in dealing with the amount of geometric complexity contained within discretized grid block and the effect of strong heterogeneity of the fracture matrix properties for instance discontinuities in matrix pressure across the fracture caused by resistance to flow the setting of this paper is in the second class of method the particularity of our setting is an immiscible two phase flow model widely used in the multiphase flow problems where two or more fluids share the pore scape the interplay of capillary viscous and buoyancy forces for the fluids in a complex pore geometry leads to a nonlinear possibly degenerate system of partial differential equations modelling the flow behaviour standard textbooks e g bear 1988 discuss these flow equations and are standard in porous media flow studies our work deals with the effective models that explicitly represents the fractures and focusses on the effect of heterogeneities in the fracture matrix properties in particular we use formal asymptotic approach to provide a rational derivation of the variety of effective models that result for different regimes of this heterogeneity the starting model is an equi dimensional one for the fracture and the matrix where the fracture is represented as a thin domain with a non zero thickness with the standard two phase darcy equations describing the flow in both the fracture and matrix the use of standard two phase darcy model for the fracture is premised on the fact that the fracture is also assumed to be porous though possibly with drastically different hydraulic properties natural interface conditions of the continuity of pressure and fluxes are imposed at the matrix fracture interfaces one of the new difficulties that comes with a two phase flow model is the different relative permeability and the capillary pressure curves for flow in the fracture and in the matrix roughly speaking our work here derives effective models as the limit of the thickness of fracture vanishes leading to reduced order models where the fracture becomes effectively a lower dimensional geometric object we focus on the derivation of these effective models this work connects the surrounding matrix which is solved by a flow equation with a fracture that is solved using a differential equation on the lower dimensional fracture surface these fracture can depending on their properties act as barriers open fracture or something in between this suggests that the upscaled models should distinguish between these cases the key parameter in our approach is ɛ the ratio of the width to the length of the fracture the porosity and the permeability contrast of the fracture matrix heterogeneity is then taken as the scale of ɛ as follows ϕ f ϕ m ɛ κ and k ˆ a f k ˆ a m ɛ λ here ϕ f k ˆ a f and ϕ m k ˆ a m are the porosities absolute permeabilities of the fracture and the matrix respectively our assumption for the starting model is of darcy type in both the fracture and the matrix this corresponds to the situation when the fracture is filled with some material so that we assume the model equations are of the same type in both the subdomains the two parameters κ and λ determine the contrast of hydraulic properties of matrix versus those of the fracture our approach is to derive effective models as ɛ goes towards zero for different values of the parameters κ and λ in contrast to the single phase flow here the relative permeability and the capillary pressure curves may be different in the fracture and the matrix though we consider a single fracture following formaggia et al 2014 our work can be used to provide a hierarchy of reduced models based on the properties of the fractured networks our approach uses formal asymptotics for the derivation of upscaled models these upscaled models are the equations satisfied by the leading order term in the expansion of the solution variables similar works pertaining to the derivation of upscaling of models for fractured medium have been followed in dugstad et al 2021 and kumar et al 2020 in dugstad et al 2021 they explore the effects of polymer in a fracture case where the permeability of the fracture is scaled with the width of the fracture moreover the permeability is supposed to be anisotropic and the effective models are obtained as a result of the scalings for the diagonal permeability components a closer reference to the present work is kumar et al 2020 where similar effective models but for the richards equation have been obtained the similarity is closer here as in the present case both the porosity and the permeability are scaled as the exponents of ɛ here we follow a similar approach but for an immiscible two phase flow containing oil and water the two phase flow model is the standard multiphase flow widely used in the subsurface energy and environmental applications and in the fractured context it has also been widely used in the literature see e g bastian et al 2000 pruess and narasimhan 1982 where they study two phase flow in a fractured porous medium surprisingly though there are far fewer results on the derivation of effective models the closest to our situation is ahmed et al 2017 where reduced models are derived for two phase flow models however the approach there is quite distinct from the ones we follow their approach is inspired from the analogous work in the single phase flow case as performed in martin et al 2005 our results are consistent with their results in certain regimes of the permeability we make this comparison later in the remark 3 1 in contrast to a formal approach here a rigorous mathematical approach has been widely used in literature we refer to the works of morales and showalter 2010 2012 tunc 2012 for a single phase flow in case of the richards equation we refer to list et al 2020 where mathematically rigorous convergence results are obtained for a certain range of parameters for a study on the transport equation in similar setting we refer to the work by pop et al 2017 gander et al 2021 uses fourier analysis to obtain coupling conditions between subdomains and obtain model error estimates when the fracture is represented as a hypersurface embedded in the surrounded rock matrix in neuss radu and jäger 2007 gahn et al 2018 2016 the authors consider a thin domain with periodic coefficients for a reactive transport model and perform a rigorous two scale homogenization to obtain interface conditions the numerical methods for solving multiphase flow in a fractured medium has received more attention we refer to the literature hoteit and firoozabadi 2008 fumagalli and scotti 2013 kim and deo 2000 fumagalli et al 2019 brenner et al 2015 angot et al 2009 and the recent review of berre et al 2019 for a discussion on the numerical methods for solving the reduced models for two phase flow a typical approach is using domain decomposition and mortar variables for the fracture variables in the present work we will use three different models which treat the fracture in different ways one model where the fracture is treated as a lower dimensional object one two scaled model where the fracture is rescaled into a separate domain and one model where the fracture acts as an barrier where there is zero flux over the fracture the paper is structured as follows in section 2 we introduce our two phase flow model where we work with a non degenerate case in section 3 we give a catalogue of the effective models for different permeability and porosity in the fracture in section 4 we derive our effective models here we use a formal asymptotic approach and obtain upscaled models for the different regimes of parameters κ and λ in section 5 we introduce our numerical results which illustrate the quality of our upscaled models and in the last section we state our conclusions regarding the upscaled models and the numerical simulations 2 model equations and scaling first we formulate the models in a dimensional form let ω ˆ r 2 be an open bounded and convex polygonal domain with boundaries denoted by ω ˆ the domain contains a single fracture ω ˆ f which divides ω ˆ into two subdomains ω ˆ 1 and ω ˆ 2 we get that ω ˆ ω ˆ 1 ω ˆ 2 ω ˆ f and that ω ˆ ω f ω ˆ 1 ω ˆ 2 the interfaces between the subdomains are denoted by γ ˆ 1 ω ˆ 1 ω ˆ f and γ ˆ 2 ω ˆ 2 ω ˆ f we reduce the fracture domain to be a one dimensional interface between the two domains ω ˆ 1 and ω ˆ 2 2 1 dimensional model we simplify the geometry so that the fracture boundaries are straight lines and the domain ω ˆ is a rectangle in terms of coordinates matrix block and equi dimensional and the reduced fracture geometry are given as it poses no additional difficulty in considering higher dimensions say r n n 3 instead of n 2 here in case n 3 the fracture is a two dimensional surface to have more generality we can consider a non self intersecting one dimensional manifold τ ˆ with the fracture represented as ω ˆ f x ω ˆ x ˆ s ˆ ϕ ˆ n τ for some s ˆ τ ˆ and ϕ ˆ l 2 here l is the width of the fracture at s ˆ in the normal direction and n τ is the outward unit normal to τ ˆ in this system we consider a two phase flow in ω ˆ m governed by darcy law and the mass conservation equation where m m 1 m 2 f let p ˆ w m denote the pressure of water phase and p ˆ o m the phase pressure of the oil the saturation of water is s ˆ w m and that of oil is s ˆ o m it holds at each point in ω ˆ and for all t 0 t 1 t ϕ m ˆ s ˆ w m u ˆ w m f ˆ w m t ϕ m ˆ s ˆ o m u ˆ o m f ˆ o m u ˆ w m k ˆ k ˆ r w μ ˆ w p ˆ w m u ˆ o m k ˆ k ˆ r o μ ˆ o p ˆ o m the first two equations are conservation of mass of water and oil phase respectively the next two equations are the darcy law that describes the flux as the gradient of the respective phase pressures the porosity is denoted by ϕ ˆ the source sink terms f ˆ i m on the right hand side stands for water or oil injections outflow furthermore k ˆ is the absolute permeability and k ˆ r w s ˆ w and k ˆ r o s ˆ o denote the relative permeability of water and oil respectively and are functions of the respective saturations moreover μ ˆ w and μ ˆ o are dynamic viscosities of water and oil for simplicity the absolute permeability k ˆ will be considered as a scalar quantity and in the matrix blocks this will be equal to 1 extension to an anisotropic case is a straight forward in the fracture domain the permeability is prescribed as an exponent of the fracture width ɛ here we have considered the same function k ˆ r w and k ˆ r o in all the three subdomains however considering different functions in the three subdomains possess no additional difficulty and can be easily accommodated the model needs further equations for its completion first is the saturation constraint at each point in space and time in each of the subdomains s ˆ w m s ˆ o m 1 the second is the closure condition where the capillary pressure for m m 1 m 2 f p ˆ c m s ˆ w m p ˆ w m p ˆ o m is a given function of saturation we make the following assumptions on the coefficients for m m 1 m 2 f 1 the relative permeability k ˆ r w k ˆ r o is assumed to be strictly positive the absolute permeability k is a positive tensor bounded both from above and below by strictly positive constants 2 the capillary pressure p c m 0 1 r is a positive monotonically decreasing smooth function with the p c m δ 0 moreover the inverse function p c m 1 r 0 1 exists and is assumed to be a smooth function in short we are considering a non degenerate system of equations with smooth coefficients in each subdomains since our approach is formal these assumptions are needed to justify the asymptotics to complete the description we need to specify the boundary interface conditions and the initial conditions for the sake of convenience homogeneous dirichlet boundary conditions are considered the interface conditions are the continuity of the pressure and the continuity of flux the precise equations will be written below the initial conditions are assumed to be given p w m t 0 p w m 0 p o m t 0 p o m 0 using the invertibility of the capillary pressure this also provides the initial conditions for the saturations 2 2 non dimensionalization we define ɛ l l that is the ratio of the fracture width to its length and to denote that the parameters are dependent on the size of ɛ we denote them with a subscript ɛ here l is the reference length scale and the geometry is in the dimensionless form 2 ω 1 ɛ 0 1 ɛ 2 1 ɛ 2 γ 1 ɛ 0 1 ɛ 2 ω 2 ɛ 0 1 1 ɛ 2 ɛ 2 γ 2 ɛ 0 1 ɛ 2 ω f ɛ 0 1 ɛ 2 ɛ 2 γ 0 1 0 the dimensionless pressure heads are given by p m j i p ˆ m j i l and p f j i p ˆ f j i l the dimensionless time is set as t t ˆ t and the final time as t t ˆ t where 3 t ϕ m l 2 k ˆ a m p ϕ m l k ˆ a m we denote the dimensionless counterparts for s ˆ i m k ˆ and k ˆ r i as s i m k and k r i respectively we now substitute the darcy law in the mass balance from model eqs 1 we get 4 t ϕ i s i m ɛ k m k r i s i m ɛ μ i p w m ɛ f m ɛ in ω m ɛ where i denotes the phases o w and m the matrix blocks m 1 and m 2 further we assume that the porosity in the matrix blocks are equal 5 ϕ 1 ϕ 2 and we would like to note the porosity and absolute hydraulic conductivity scaling in the fracture with respect to that of the surrounding matrix as suggested we have assumed the following scaling for the porosity and hydraulic conductivity in the fracture domain 6 ϕ f ϕ m ɛ κ k a f k a n ɛ λ here κ and λ are scaling parameters as earlier we use the darcy law in the mass balance equation to get the dimensionless equation for the fracture 7 t ɛ κ s i f ɛ ɛ λ k f k r i s i f ɛ μ i p w f ɛ f f in ω f ɛ we write down the full dimensionless model 8 t ϕ m s i m ɛ k k r i s i m ɛ μ i p i m ɛ f i m ɛ in ω m ɛ t ɛ κ s i f ɛ ɛ λ k k r i s i f ɛ μ i p i f ɛ f i f ɛ in ω f ɛ s w m ɛ s o m ɛ 1 in ω m ɛ ω f ɛ p c m ɛ s w m ɛ p w m ɛ p o m ɛ in ω m ɛ ω f ɛ p i m ɛ p i f ɛ on γ m ɛ ɛ λ k k r i μ i p i f ɛ n k k r i μ i p i m ɛ n on γ m ɛ p w m t 0 p w m 0 and p o m t 0 p o m 0 in ω m ɛ ω f ɛ where i w o and m m 1 m 2 and in the third and fourth equations m holds for m 1 m 2 f this problem motivates us to see if we can define different models depending on the permeability of the fracture we can thus try to determine different types of upscaled models depending on the values of κ and λ as the fracture width ɛ 0 the scaling parameter κ is related to the storage capacity of the fracture which means that for small κ κ 1 the fracture maintains its ability to store water as the fracture size tends to zero and for large κ κ 0 the storage capacity decreases as the fracture tends to zero the parameter λ is connected to the conductivity of the fracture here a small λ e g λ 0 gives a high conductivity flow can occur freely while a high λ λ 1 will give us that the fracture will behave more as a barrier as seen in the above system of equations we have considered the interface conditions where the pressures are continuous and the fluxes are equal at the fracture matrix interface in the case of two phase flow this may not hold true due to the presence of different capillary forces inside the fracture and in the matrix the presence of entry pressure may lead to an extended pressure condition at the interface as derived in van duijn and de neef 1998 the difference in entry pressures causes oil trapping at the interface our approach can be used to derive the effective models in this case as well however for simplicity we disregard these difficulties 3 main results catalogue of effective models we identify three classes of effective models i effective models i iv that have continuous pressure across the fracture matrix interface ii effective models v vi that show a two scale type behaviour and iii effective models vii x that have fractures acting as barriers and the pressure across the fracture matrix interface is disconnected in case ii the pressure is given by a differential equation inside the fracture which is coupled to those in the matrix while in case iii the fracture acts as a barrier and accordingly has zero flux boundary for the flow model in the matrix we provide the effective models for a wide range of κ and λ and make brief remarks of them the derivation of the reduced models is postponed to section 4 in the different upscaled models we have that with i w o 9 q i m γ k m k r i s i m μ p i m 1 n 1 k m k r i s i m μ x p i m 2 n 2 is the flux difference for water and oil respectively in the two solid matrix subdomains ω 1 and ω 2 note that n 1 n 2 and that these vectors are normal to the fracture 3 1 effective model i the first four models have continuous pressure the first model gives us a two dimensional problem in the surrounding matrix blocks and a one dimensional problem in the fracture domain the model for κ 1 and λ 1 with i w o and m m 1 m 2 the fracture behaves as a one dimensional domain where q w m γ and q o m γ are the flux difference for water and oil respectively in the two solid matrix subdomains ω 1 and ω 2 here the permeability is large enough to make the pressure inside the fracture to become y independent the storage term and the darcy flow term both survive and this is taken as the most widely used model for fracture coupling 3 2 effective model ii in this case we have that κ 1 λ 1 the porosity increase here with vanishing ɛ vanishing fracture width is less than linear we get the model for i w o and m m 1 m 2 as in effective model i we have that the permeability in the fracture is large enough to ensure that the fracture pressure equals the traces of the matrix pressures at the fracture matrix interfaces and we get a jump in flux over the fracture however the porosity term is sublinear and thus vanishes in the limit as κ 1 3 3 effective model iii this corresponds to the case κ 1 λ 1 1 we have the following effective model for i w o and m m 1 m 2 here only the flux terms vanish in the limit and the fracture is able to store and release fluids from the solid matrix the pressure at the fracture interfaces are retained in other words the fracture interface conditions for ω 1 and ω 2 are equal to the pressure inside the fracture 3 4 effective model iv this case is for κ 1 λ 1 1 it has been partly covered by previous cases the pressure and the normal fluxes become continuous at the interface in practice the fracture has disappeared as a physical entity and can be ignored in the upscaled model 3 5 effective model v this is the first effective model with discontinuous pressure over the fracture first we will consider the case where κ 1 and λ 1 10 x ξ and y 1 ɛ η here we have rescaled the fracture subdomain ω f ɛ to an ɛ independent subdomain ω f 11 ω f 0 1 1 2 1 2 where the 0 1 term is the rescaling of the x coordinates now denoted as ξ and the 1 2 1 2 term is the rescaling of the y coordinates now denoted as η notice that the solution in the fracture in both effective models v and vi depends on η the value η 1 2 corresponds to the boundary bottom boundary of ω m 1 at y 0 similarly η 1 2 corresponds to the top boundary of ω m 2 y 0 these models will be referred to as two scale models and a typical two scale model has the scaling such that we need to resolve the details of the fracture in this sense representing the fracture as an interface is not fully justified the original problem is divided into three coupled subdomains that are solved separately using boundary conditions from each other for i w o and m m 1 m 2 here for each ξ x one determines p i f ξ as the solution to the parabolic differential equation in one dimensional spatial domain 3 6 effective model vi the same happens for the effective model where κ 1 the effective model remains the same as in the previous case except for the storage term it vanishes for i w o and m m 1 m 2 for any t ξ x t p i f t ξ solves the one dimensional elliptic auxiliary problem 3 7 effective model vii in the case where λ 1 and κ 1 we get a discontinuous pressure over the fracture interface the result is that the fracture flux is zero and it behaves as a barrier the two domains ω 1 and ω 2 can be solved separately for i w o and m m 1 m 2 3 8 effective model viii in the case where λ 1 and κ 1 there is little difference from case vii the only difference is that the storage term in the fracture drops out in the limit of ɛ 0 for i w o and m m 1 m 2 we end up with the model 3 9 effective model ix the two last effective models are models with spatially constant pressure in the fracture the permeability in the fracture is so large that the pressure in the fracture will be the same short time after a pressure change the reduced models will depend only on the time p w f t y p w f t and p o f t y p o f t for the models this means that the fracture endpoints cannot impose different pressures at the fracture endpoints the effective model 9 is for the cases where κ 1 and λ 1 one get for i w o and m m 1 m 2 the pressure is spatially constant and continuous in the fracture and therefore it must be spatially constant at the interfaces as well 3 10 effective model x this case is for κ 1 and λ 1 here the storage term vanishes there is no equation giving the pressure in the fracture and we get for i w o and m m 1 m 2 where for each t 0 t the time dependent function p i f p i f t is determined such that 0 1 q m γ d x 0 remark 3 1 we make a brief comparison with the fracture models that are widely used in practice see e g berre et al 2019 we refer to martin et al 2005 where similar models are derived for single phase flow and to ahmed et al 2017 for two phase flow models our results here are different in these respects the derivation follows different arguments and secondly the final results are consistent in certain regimes of the parameters yet not identical the derivation in martin et al 2005 and in ahmed et al 2017 takes place in three steps first the darcy flow equation along the fracture surface is obtained immediately by considering the flux component in the tangential direction of the fracture second one integrates the flow equation along the transverse direction in the fracture subdomain using the continuity of fluxes at the matrix fracture interfaces this yields a surface equation with the jump in the matrix flux term as a source term the third step is a closure relationship by postulating a pressure profile in the fracture this is in contrast with our approach we assume a scaling of hydraulic properties on ɛ and κ and use a formal asymptotic ansatz where we only consider the terms of o ɛ as this is the leading term once the choice of scaling is made the rest of the steps follow without any additional assumptions in particular our approach does not postulate any closure condition on the pressure inside the fracture as this is part of the solution also we mention that in the references cited the closure condition introduces a parameter in the effective model for the fracture here we have a catalogue of models and no additional parameter is necessary moreover for several of the regimes considered here the derivation is sustained by mathematically rigorous proofs see list et al 2020 in terms of the final results we remark that for certain regimes e g λ 1 our approach yields that the fracture flow cannot be collapsed on a surface and we must resolve the details of the flow there however in the references and currently in practice as well such two scale models are not used and instead a mixed dimensional model is used irrespective of the parameter range remark 3 2 this paper considers a simple geometry for the fracture embedded in a porous matrix besides our model is a standard two phase flow model with interface conditions across the matrix fracture interface this is consistent with our objective to illustrate the role of properties of the fracture in determining the appropriate discrete fracture network dfn model the two natural extensions are in the fracture networks and introducing further multiphysics the former extension requires defining models at different scales e g in the intersection of the fracture equi dimensional subdomains this would introduce more scales for the hydraulic properties in the intersecting subdomains and the latter corresponds to reactive multiphase flow nonlinear interface conditions or more general models involving thermal and mechanical models also differences in the composition of fracture and matrix may cause strong heterogeneities in the constitutive relations manifested as capillary barriers and entry pressure effects over the fracture matrix interface van duijn et al 2007 depending on the specific form of relative permeabilities and capillary pressure functions these heterogeneities are known to cause numerical challenges the formal asymptotic approach used here can be used to incorporate these difficulties for further uses we mention that this approach can be used to provide arguments for the mixed dimensional models proposed in boon et al 2017 based on physical arguments in the same spirit the reduced models are derived for fracture networks in formaggia et al 2014 building on the work of martin et al 2005 our work can be used to similarly provide a hierarchy of reduced models based on the properties of the fractured networks 4 formal upscaling and derivation of effective models we perform a formal upscaling for the above system of equations to derive the effective equations for quantities in the subdomain ω i m i w o m m 1 m 2 f one makes the following ansatz for the pressure 12 p i m ɛ p i m 0 ɛ p i m 1 o ɛ 2 and the corresponding ansatz for the saturations 13 s i m ɛ s i m 0 ɛ s i m 1 o ɛ 2 4 1 interface conditions next we treat the interface conditions this preparation will be useful in the derivation of the effective models we take the interface conditions after the formal upscaling 14 p w f 0 ɛ p w f 1 o ɛ 2 p w m 1 0 ɛ p w m 1 1 o ɛ 2 on γ 1 ε p w f 0 ɛ p w f 1 o ɛ 2 p w m 2 0 ɛ p w m 2 1 o ɛ 2 on γ 2 ε p o f 0 ɛ p o f 1 o ɛ 2 p o m 1 0 ɛ p o m 1 1 o ɛ 2 on γ 1 ε p o f 0 ɛ p o f 1 o ɛ 2 p o m 2 0 ɛ p o m 2 1 o ɛ 2 on γ 2 ε and see that the effective pressure interface conditions up to the leading order becomes 15 p w f 0 p w m 1 0 p o f 0 p o m 1 0 on γ p w f 0 p w m 2 0 p o f 0 p o m 2 0 o n γ recalling the scaling introduced in the effective model 5 for ξ and η the derivatives get transformed to x ξ and y 1 ɛ η and the interface conditions at γ 1 and γ 2 become 16 ɛ λ 1 k k r w μ w η p w f ɛ k k r w μ w y p w m 1 ɛ on γ ɛ λ 1 k k r o μ o η p o f ɛ k k r o μ o y p o m 2 ɛ on γ for j 1 2 from the interface conditions in 16 we see that when λ 1 for an ɛ 0 we have that the left hand side goes towards zero leading to the following interface conditions for the leading order term for the matrix subdomain fluxes 17 k k r w μ w y p w m 1 0 0 on γ k k r w μ w y p w m 2 0 0 on γ k k r o μ o y p o m 1 0 0 on γ k k r o μ o y p o m 2 0 0 on γ for the case where λ 1 the interface conditions become 18 k k r w μ w η p w m f 0 k k r w μ w ξ p w m 1 0 on γ k k r w μ w η p w m f 0 k k r w μ w ξ p w m 2 0 on γ k k r o μ o η p o m f 0 k k r o μ o ξ p o m 1 0 on γ k k r o μ o η p o m f 0 k k r o μ o ξ p o m 2 0 on γ for λ 1 we keep it in the same form we also state the energy estimate for the model equations this will allow us to conclude that the leading order terms p w f 0 p o f 0 are independent of y we multiply the model eqs 8 by p w m 1 ɛ p o m 1 ɛ p w m 2 ɛ p o m 2 ɛ p w f ɛ p o f ɛ and integrate over the respective domains ω f ɛ ω 1 ɛ and ω 2 ɛ using the gauss divergence theorem to transfer the div to the other term and using the boundary condition we obtain ω f ɛ ɛ κ t s o f ɛ p o f ɛ p w f ɛ d x ɛ λ ω f ɛ k k r w s w f ɛ p w f ɛ 2 d x ɛ λ ω f ɛ k k r o s o f ɛ p o f ɛ 2 d x ω 1 ɛ k k r o s o m 1 ɛ p o m 1 ɛ 2 d x ω 1 ɛ k k r w s w m 1 ɛ p w m 1 ɛ 2 d x ω 2 ɛ k k r w s w m 2 ɛ p w m 2 ɛ 2 d x ω 2 ɛ k k r o s o m 2 ɛ p o m 2 ɛ 2 d x ω 1 ɛ t s o m 1 ɛ p o m 1 ɛ p w m 1 ɛ d x ω 2 ɛ t s o m 2 ɛ p o m 2 ɛ p w m 2 ɛ d x 0 integrating over time from 0 to an arbitrary time t we obtain ɛ κ ω f ɛ b s w f ɛ t ɛ λ 0 t ω f ɛ k k r w s w f ɛ p w f ɛ 2 d x d t ɛ λ 0 t ω f ɛ k k r o s o f ɛ p o f ɛ 2 d x d t 0 t ω 1 ɛ k k r o s o m 1 ɛ p o m 1 ɛ 2 d x d t 0 t ω 1 ɛ k k r w s w m 1 ɛ p w m 1 ɛ 2 d x d t 0 t ω 2 ɛ k k r w s w m 2 ɛ p w m 2 ɛ 2 d x d t 0 t ω 2 ɛ k k r o s o m 2 ɛ p o m 2 ɛ 2 d x d t ω 1 ɛ b s w m 1 ɛ t ω f ɛ b s w m 2 ɛ t c here b z 0 z p c z d z and is a positive quantity in the transformed co ordinates ξ x η y ɛ inside the fracture region we get ɛ λ 1 ɛ 2 0 t 1 2 1 2 k k r w s w f ɛ η p w f ɛ 2 d η d t ɛ λ 0 t 0 1 k k r w s w f ɛ ξ p w f ɛ 2 d ξ d t c using non degeneracy of k r w η p w f ɛ c ɛ 1 λ this allows us to conclude that the leading order term p w f 0 in the expansion of p w f ɛ for λ 1 is independent of the y co ordinate as well as the η co ordinate in the re scaled variables that is 19 p w f 0 p w f 0 x this implies that for λ 1 the leading order approximation for the water pressure in the fracture is independent of the y direction the same conclusion holds for oil pressure thus for λ 1 we have 20 p o f 0 p o f 0 x this completes the preparation for deriving the effective equations now we consider the model equations for different regimes for κ and λ 4 2 derivation of the effective models we begin with the matrix subdomain equations the upscaling here proceeds without much difficulty 4 2 1 matrix subdomains recall the model equation in the matrix subdomain for i w o m m 1 m 2 t ϕ m s i m k k r i s i m μ i p i m f i m in ω m ɛ note that in the matrix subdomain the derivatives do not introduce any ɛ and it gets introduced only in the expansion of the variables substituting the ansatz for pressure and saturation we obtain up to o ɛ 2 approximation t ϕ m s i m 0 ɛ s i m 1 k k r i s i m 0 ɛ s i m 1 μ i p i m 0 ɛ p i m 1 f i m in ω m ɛ restricting up to leading order we have that ω m ɛ tends to ω m as ɛ tends to zero t ϕ m s i m 0 k k r i s i m 0 μ i p i m 0 f i m in ω m this reflects the stability of the matrix subdomains with respect to the upscaling this is expected since the matrix subdomain converges uniformly to ɛ independent subdomain and the coefficients are ɛ independent this holds true regardless of the value of λ and κ 4 2 2 fracture subdomain next we consider the fracture equation 21 t ɛ κ s i f ɛ λ k k r w s i f μ i p i f f i f in ω f ɛ and with the rescaling of the fracture domain the rescaled equations in the ω f become 22 t ɛ κ s w f 0 ɛ s w f 1 1 ɛ 2 η ɛ λ k k r w s w f 0 ɛ s w f 1 μ w η p w f 0 ɛ p w f 1 ξ ɛ λ k k r w s w f 0 ɛ s w f 1 μ w ξ p w f 0 ɛ p w f 1 f w f t ɛ κ s o f 0 ɛ s o f 1 1 ɛ 2 η ɛ λ k k r o s o f 0 ɛ s o f 1 μ o η p o f 0 ɛ p o f 1 ξ ɛ λ k k r o s o f 0 ɛ s o f 1 μ o ξ p o f 0 ɛ p f o 1 f o f 4 2 3 subcases when λ 1 recall that in this case p w f 0 and p o f 0 are independent of η by virtue of this we conclude that p c s w 0 p o f 0 p w f 0 is independent of η from the invertibility of p c we get that s w f 0 is independent of η as well due to the saturation constraint s o f 0 is also independent of η we begin with the case κ 1 λ 1 integrating eq 22 over η 1 2 to 1 2 and multiplying the equation by ɛ we have ɛ 1 κ 1 2 1 2 t s w f 0 ɛ s w f 1 d η 1 ɛ 1 2 1 2 η ɛ λ k k r w s w f 0 ɛ s w f 1 μ w η p w f 0 ɛ p w f 1 d η ɛ 1 2 1 2 ξ ɛ λ k k r w s w f 0 ɛ s w f 1 μ w ξ p w f 0 ɛ p w f 1 d η 1 2 1 2 ɛ f w f d η ɛ 1 κ 1 2 1 2 t s o f 0 ɛ s o f 1 d η 1 ɛ 1 2 1 2 η ɛ λ k k r o s o f 0 ɛ s o f 1 μ o η p o f 0 ɛ p o f 1 d η ɛ 1 2 1 2 ξ ɛ λ k k r o s o f 0 ɛ s o f 1 μ o ξ p o f 0 ɛ p f o 1 d η 1 2 1 2 ɛ f o f d η the reason for multiplying by ɛ is obvious this matches the scale of ɛ in the flux interface conditions 16 we take the leading order term and use the independence of these leading order terms p w f 0 p o f 0 s w f 0 s o f 0 of η moreover the scaled right hand side is assumed to be independent of η with these considerations ɛ κ 1 t s w f 0 ɛ λ 1 k k r w s w f 0 μ w η p w f 0 η 1 2 ɛ λ 1 k k r w s w f 0 μ w η p w f 0 η 1 2 ɛ λ 1 ξ k k r w s w f 0 μ w ξ p w f 0 ɛ f w f ɛ κ 1 t s o f 0 ɛ λ 1 k k r o s o f 0 μ o η p o f 0 η 1 2 ɛ λ 1 k k r o s o f 0 μ o η p o f 0 η 1 2 ɛ λ 1 ξ k k r o s o f 0 μ o ξ p o f 0 ɛ f o f using the interface condition for the flux in 16 and restricting up to the leading order term ɛ λ 1 k k r w s w f 0 μ w η p w f 0 η 1 2 k k r w μ w y p w m 1 0 y 0 ɛ λ 1 k k r w s w f 0 μ w η p w f 0 η 1 2 k k r w μ w y p w m 2 0 y 0 for the oil flux we get a similar expression ɛ λ 1 k k r o s o f 0 μ o η p o f 0 η 1 2 k k r o μ o y p o m 1 0 y 0 ɛ λ 1 k k r o s o f 0 μ o η p o f 0 η 1 2 k k r o μ o y p o m 2 0 y 0 defining the jump in the flux for the water and the oil across the fracture surface q w 0 k k r w μ w y p w 0 y 0 k k r w μ w y p w 0 y 0 q o 0 k k r o μ o y p o 0 y 0 k k r o μ o y p o 0 y 0 with these definitions for the jump in the flux on hand we rewrite the averaged model as 23 ɛ κ 1 t s w f 0 ɛ λ 1 ξ k k r w s w f 0 μ w ξ p w f 0 q w 0 f w f ɛ κ 1 t s o f 0 ɛ λ 1 ξ k k r o s o f 0 μ o ξ p o f 0 q o 0 f o f now in 23 we consider the different regimes of coefficients for κ 1 λ 1 we get 24 t s w f 0 ξ k k r w s w f 0 μ w ξ p w f 0 q w 0 f w f t s o f 0 ξ k k r o s o f 0 μ o ξ p o f 0 q o 0 f o f next we consider the case when κ 1 λ 1 the only change from the above derivation is the storage term this term vanishes in the limit as ɛ goes to zero indeed for κ 1 we have ɛ κ 1 t s w f 0 0 and ɛ κ 1 t s o f 0 0 as ɛ 0 with the storage term vanishing on γ for the coefficients κ 1 λ 1 it holds 25 ξ k k r w s w f 0 μ w ξ p w f 0 q w 0 f w f ξ k k r o s o f 0 μ o ξ p o f 0 q o 0 f o f in the case when λ 1 1 on the fracture surface γ we have that ɛ λ 1 x k k w f μ w x p w f 0 0 as ɛ 0 the averaged equation therefore takes the form of an ode since the flux term now drops out on γ it holds that t s w f 0 q w 0 f w f t s o f 0 q o 0 f o f the next effective model is for κ 1 λ 1 1 partly these intervals have been covered in the previous cases for λ 1 1 the flux term drops out and for κ 1 the storage term vanishes the resulting equation therefore takes the form q w 0 f w f 0 q o 0 f o f 0 in the absence of any source term this case shows that the pressure is continuous over the fracture the effective model behaves as if the fracture as a physical entity has disappeared 4 2 4 subcases when λ 1 this is the critical case of λ being exactly equal to 1 in contrast to the previous case when λ 1 led to the continuity of pressures across the fracture interface this case leads to a discontinuous pressure however the pressures at the two sides of the fracture interfaces are not independent rather they are coupled through a differential equation inside the rescaled fracture subdomain we have different interface conditions on the two sides of the fracture and we define the interfaces as γ 1 ω 1 ω f and γ 2 ω 2 ω f let us first derive the model equations for this case before discussing more on their structures the next case the fifth case is for κ 1 and λ 1 and we have these interface conditions 26 k k r w μ w η p w f 0 k k r w μ w y p w m 1 0 on γ 1 k k r w μ w η p w f 0 k k r w μ w y p w m 2 0 on γ 2 k k r o μ o η p o f 0 k k r o μ o y p o m 1 0 on γ 1 k k r o μ o η p o f 0 k k r o μ o y p o m 2 0 on γ 2 and the continuity of the pressure 27 p w f 0 t x η 1 2 p w m 1 0 t x 0 p w f 0 t x η 1 2 p w m 2 0 t x 0 p o f 0 t x η 1 2 p o m 1 0 t x 0 p o f 0 t x η 1 2 p o m 2 0 t x 0 we begin again from 22 for λ 1 and again multiplying the equation by ɛ and restricting up to leading order terms ɛ κ 1 t s w f 0 η k k r w s w f 0 μ w η p w f 0 ɛ 2 ξ k k r w s w f 0 μ w ξ p w f 0 ɛ f w f ɛ κ 1 t s o f 0 η k k r o s o f 0 μ o η p o f 0 ɛ 2 ξ k k r o s o f 0 μ o ξ p o f 0 ɛ f o f clearly ɛ 2 ξ k k r w s w f 0 μ w ξ p w f 0 0 ɛ 2 ξ k k r o s o f 0 μ o ξ p o f 0 0 as well as the source term goes to zero as ɛ vanishes with these considerations we obtain the following model ɛ κ 1 t s w f 0 η k k r w s w f 0 μ w η p w f 0 0 ɛ κ 1 t s o f 0 η k k r o s o f 0 μ o η p o f 0 0 now we consider a different regime for κ 1 we obtain the effective model v the fracture flow model is given as follows 28 t s w f 0 η k k r w s w f 0 μ w η p w f 0 0 for η 1 2 1 2 t x 0 t γ t s o f 0 η k k r o s o f 0 μ o η p o f 0 0 for η 1 2 1 2 t x 0 t γ the interface conditions and the subdomain equations complete the model derivation next case we treat is the case where κ 1 λ 1 this case is almost equal to the previous case however the scaling of κ in the storage term is different the interface condition remains the same for this range of κ the storage term vanishes in the limit as ɛ goes to zero that is ɛ κ 1 t s w f 0 0 ɛ κ 1 t s o f 0 0 the fracture equations then take the form 29 η k k r w s w f 0 μ w η p w f 0 0 for η 1 2 1 2 t x 0 t γ η k k r o s o f 0 μ o η p o f 0 0 for η 1 2 1 2 t x 0 t γ together with the interface conditions 26 and 27 and retaining the subdomain equation this completes the derivation of the effective model vi the dependency of p o f 0 and p w f 0 on t and y happens via the interface conditions notice that in the effective models v and vi the fracture model does not collapse into reduced dimensional fracture models and one needs to solve differential equations inside the fracture subdomain this is what we will refer to as the two scaled models similar to a cell problem in homogenization this is different from what happened in the effective models i iv where one needs to solve differential equations on the fracture surface 4 2 5 subcases when λ 1 for the last two models the permeability in the fracture is sufficiently low such that the fracture acts as a barrier these cases are for κ 1 λ 1 and κ 1 λ 1 the difference between these two cases is the scaling of the storage term and as we have seen before the storage term will not survive in the latter case the subdomain equations remain unchanged as before we then recall the interface conditions in 17 to deduce the boundary conditions for the matrix subdomain 30 k k r w μ w p w m 1 0 ɛ n 0 on γ k k r o μ o p o m 1 0 ɛ n 0 on γ k k r w μ w p w m 2 0 ɛ n 0 on γ k k r o μ o p o m 2 0 ɛ n 0 on γ the zero flux boundary condition between the matrix sub domains leads to a set of subdomains that are independent of each other and can be solved separately the fracture equation becomes irrelevant however for the case when κ 1 we can still evaluate the fracture equation by solving the differential equations 31 t s w f 0 t η x 0 for η 1 2 1 2 t x 0 t γ t s o f 0 t η x 0 for η 1 2 1 2 t x 0 t γ as the flux terms in the fracture drop out in the case when κ 1 λ 1 even the storage term drops out making the fracture equation irrelevant together with retaining the initial condition and the boundary conditions we recover the effective models vii and viii for the last two effective models ix and x we have the cases κ 1 λ 1 and κ 1 λ 1 respectively the permeability in this case is large enough so that the pressure becomes independent of y clearly in this regime the pressures are independent of y since λ is less than 1 as seen before however in this regime the pressure also becomes independent of x this implies that the pressure is constant along the fracture surface this is possible only when the boundary conditions are compatible the difference between ix and x is that in case ix when κ 1 the storage term survives and the fracture pressure only depends on t in x the storage term also drops out 4 3 summary of the effective models below we summarize the range of parameters and their corresponding effective models κ 1 λ 1 effective model i κ 1 λ 1 effective model ii κ 1 λ 1 1 effective model iii κ 1 λ 1 1 effective model iv κ 1 λ 1 effective model v κ 1 λ 1 effective model vi κ 1 λ 1 effective model vii κ 1 λ 1 effective model viii κ 1 λ 1 effective model ix κ 1 λ 1 effective model x 5 numerical examples in this section we will numerically verify the above upscaling results to perform numerical experiments we use a fully implicit two phase oil and water model as implemented in the matlab reservoir simulation toolbox mrst lie 2019 we use the standard finite volume scheme using two point flux scheme tpfa on a static uniform grid with rectangular cells the geometry is built up by two smaller rectangular domains separated by a fracture as considered in the derivation the two domains ω 1 and ω 2 consist of 100 50 grid blocks each the fracture is treated in different ways depending on the effective model in use the reference solution is obtained by solving the two phase flow model 1 in ω ε ω 1 ε ω f ε ω 2 ε as shown in fig 1 here the fracture is solved together with the surrounding matrix using the tpfa the domain ω is fully saturated with oil at t 0 the global pressure for the boundary conditions are taken to be of dirichlet type on all sides with a pressure of p 2 at the bottom and at the left side of the domain on the top and right hand side the pressure is p 1 at the time t 0 we have that the whole domain ω is fully oil saturated and then we start the water injection this is done by setting the saturation of the fluxes at the boundaries as water only in our reference model we solve the full model using these boundary conditions on all the sides however for the upscaled models we need some interface conditions at the fracture interface these conditions vary depending on the different effective models we use and the different models vary depending on the values of λ and κ the easiest case however is the case where the fracture completely separates the two sub domains ω 1 and ω 2 from each other here we can put a zero flux interface condition and just solve the two sub domains ω 1 and ω 2 separately we provide further information on solving each of the three effective models in the numerical tests below the capillary pressure is implemented with a simple linear relationship of the form p c s c 1 s which is implemented in mrst where c is a constant and s is the saturation in the following simulations c 0 01 we do also have linear relative permeabilities for each phase our approach for the validation is as follows we select certain values of ε κ λ which determine the reference geometry and the permeabilities we compute the pressure for the full reference model resolving the fracture thickness i e we solve the equations in 8 with a finite value of ε and use this for our reference solution depending on the κ and λ we pick a suitable upscaled model from the catalogue for these values the solution from the upscaled model is then compared to those from the reference model we choose three sets of representative values for κ and λ we choose i λ 2 κ 1 ii λ 1 κ 1 and iii λ 2 κ 1 these three regimes correspond to permeability being quite large critical case and sufficiently low permeability to act as a barrier case respectively for these three cases we choose three representative upscaled models from the catalogue the three models are selected such that they are the appropriate models for the above three cases the first model is the effective model i which has the model equations collapsed on a surface with the jump in the flux from the matrix appearing on the right hand side the second representative model is the two scale model effective model v which retains the storage term time derivative term of saturation the effective model vii is chosen from the class that caters to sufficiently low permeability so that the fracture acts as a barrier effective model i is the appropriate model for case i λ 2 κ 1 whereas models v and vii are appropriate for ii λ 1 κ 1 and iii λ 2 κ 1 cases respectively the motivation for setting up these numerical tests is the following for a certain parameter range we find that the corresponding model from the catalogue is the appropriate one and matches the reference solution quite closely moreover if we choose one particular model but then choose the parameters far from their range of validity the accuracy decreases this shows that relying on only one of these models would not be appropriate for all the range of the parameters 5 1 effective model i we study the effective model i and its quality in solving the models for the three cases as mentioned above note that this is a mixed dimensional model with the fracture flow model on the fracture surface coupled to the matrix flow equations we adopt a domain decomposition procedure consisting of neumann to dirichlet and dirichlet to neumann operators for solving the model equations here we compute the fluxes from the matrix ω 1 and ω 2 at the interfaces and compute the jump in the flux term and use this as a source term at the fracture domain the equations for the fracture are solved with the boundary conditions at the fracture boundaries the pressure calculated using the model equations in the fracture is used as the new dirichlet boundary condition for ω 1 and ω 2 then we repeat the procedure until the solution converges within tolerance in fig 2 we see that the effective model i gives a good prediction for the case where the permeability in the fracture is sufficiently large λ 2 κ 1 the saturation curves from the upscaled model and the reference model are quite close to each other at each time step we plot the pressure with respect to the y axis for a fixed x coordinate in the plot on the right side of fig 2 the three lines in the figure represent different fixed x values in our domain ω and we plot the pressure with respect to the y values from fig 2 b we see that the pressure curves from the upscaled model and the reference model overlap perfectly however if we had tried this model for cases that are outside their range of validity λ and κ for instance λ 0 this model gives unphysical results the upscaled models must be carefully selected depending on the values of λ and κ we note that this effective model is derived under the assumption of high permeability in the fracture λ 1 this forces the pressure to be continuous across the fracture matrix interface however for the two cases where λ 1 and λ 2 the permeability is small enough that it leads to discontinuity across the fracture matrix interface this explains why this model is unable to approximate the solutions in the other two cases 5 2 two scaled model effective model v for the two scaled model the solution procedure consists of rescaling the domain and then solve the fracture and the matrix domains in an implicit manner note that the interface conditions across the fracture subdomain interface is continuity of pressures and that of fluxes this implies that we can solve the fracture and subdomain unknowns together getting a system of algebraic equations where the subdomains and the rescaled fracture pressure unknowns are coupled together in fig 3 we have used the upscaled model for various values of κ and λ again we use this model to solve the three cases as mentioned above in fig 3 we have plotted the saturation and pressure from our numerical results we have used the two scaled model and solved it for the three same λ and κ values as we have used in the previous model from the previous section we expect the case where λ 1 and κ 1 to be the best fit for our model this is also the case as seen in fig 3 c where the saturation curves overlap and we see the same for the pressure curves in fig 3 d in the two other cases the fit is not as good for the case where λ 2 we see that the model does not catch the jump in pressure over the fracture the two scale model has the advantage that it resolves the flow profile inside the fracture unlike the other effective models that either take uniform pressure across the vertical direction or simply decouple the two subdomains since there is a discontinuity of pressure across the fracture this model seems to provide a better approximation for the case of λ 2 when there is also a discontinuity of pressures than in the case when λ 2 when there is a continuity of pressures 5 3 the decoupled model effective model viii here we discuss the results from what we refer to as a decoupled model the model is expected to work in cases where the fracture permeability is sufficiently small and refers to structures such as barriers or cap rocks in this upscaled model the two domains ω 1 and ω 2 are solved separately with zero flux boundaries along the fracture interface in this case the effective problem decouples completely to give two inependent subproblems each of the subproblem is a two phase model with zero flux boundary at the fracture interface fig 4 gives the saturation and pressure curves for the upscaled model for the three cases as discussed above from fig 4 we see that this model gives a good matching for the saturation curves for cases where the permeability in the fracture is sufficiently low λ 1 fig 4 e for the other cases in fig 4 a and fig 4 c we see that the saturation curves from the upscaled model and those from the reference solutions do not overlap the pressures for our last time steps are shown in the graphs at the right hand side of fig 4 and we see the same type of behaviour here the pressure curves from the upscaled model overlap with the pressures from the reference model for the case where λ 1 fig 4 f in the other cases however there is no overlapping and the other upscaled model is therefore not good for predicting the flow in these intervals here we note that the permeability is quite small obstructing the flow across the fracture interface and in the limit this leads to discontinuity of pressures across the matrix fracture interface this obstruction of flow is captured by the zero flux condition this explains why this effective model captures this case quite well but fails in the cases when the pressure is continuous case i moreover the critical case when λ 1 even though it also leads to discontinuity of pressures there is still flow taking place across the fracture surface and the pressures from the two subdomains sides are not independent rather coupled via a differential equation that resolves the pressure profile inside the fracture subdomain this explains why this effective model is unable to approximate this case sufficiently well an important observation is that the model equations are discontinuous with respect to the parameters λ and κ in particular for λ 1 we see that a small perturbation in this value would imply the upscaled model changes its character quite abruptly this is not a satisfactory situation because in practice we do not know the exact value of λ and κ this suggests that higher order terms are needed to obtain the next order approximation so that the model equations retain the continuity this would be the subject of our future investigations this is also likely to give a better understanding of the practical use of mixed dimensional models for all the parameter ranges and using a fitting parameter to guess the pressure profile inside the fracture 6 conclusion we consider a two dimensional fractured porous medium where the fracture has a thickness ε for our flow model we have considered a standard fully implicit two phase oil water model this model consists of combining the mass balance equation with the darcy equation for each of the two phases we perform an upscaling of the flow model which is obtained as the limit as ε tends to zero the particularity in our approach is the scaling of the permeabilities of the two phases and porosity of the matrix that is taken as exponents of ε characterized by two real numbers λ and κ respectively we obtain a catalogue of models for different values of λ and κ in our numerical simulations we show that we can use κ and λ to pick an upscaled model and that the upscaled models work inside their range of validity finally we think that the higher order approximations are needed in order to deal with the discontinuous nature of the upscaled models with respect to the parameters declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we would like to thank the norwegian research council for their financial support through the project rcn project 811716 lab2field all authors approved the version of the manuscript to be published 
183,the freeze thaw cycle associated with climatic seasonality is a common phenomenon in cold regions affecting a wide range of subsurface processes due to the complex and highly nonlinear nature of the associated hydrologic processes transient freeze thaw dynamics are conventionally quantified in a numerical way here we present a hybrid analytical numerical scheme for solving one dimensional soil or porous media temperature profiles when the soil profile is subjected to unidirectional freezing or thawing conditions this scheme divides the partially frozen soil into multi layers each with constant thermal parameters and fixed temperature boundaries temperature profiles within each layer were obtained by solving multiple moving boundary problems the proposed hybrid analytical numerical scheme was tested into a freezing test of silty clay in a permafrost region on the qinghai tibetan plateau and its solution was in good agreement with the finite element numerical solution results show that the proposed multi layer method adapted well to the changes in unfrozen water content and thermal properties of soil over a wide range of subzero temperatures by contrast the freezing front s migration rate and penetration depth calculated by neumann s classical solution which only considers two zones frozen and unfrozen was found to be underestimated as for our proposed multi layer solution by dividing the subsurface domain into many layers with smaller proportion ratios thinner layers close to the freezing front there was a slower penetration rate of the freezing front resulting in shallower penetration depth the predicted profiles of temperature thermal conductivity and diffusivity heat flux and dynamics of the freezing front were significantly impacted by the shape of the soil freezing curves and the magnitude of soil grain thermal conductivity especially for the accuracy of long term predictions keywords analytical solution heat transfer with phase change freeze thaw process nonlinearity unfrozen water content temperature dependent thermal property thermal diffusivity moving boundary problem 1 introduction freeze thaw processes play an integral role in nearly every aspect of the water ice system this includes for example applications in permafrost and seasonally frozen soils ice sheet and climate glacier dynamics infrastructure design and construction in cold regions food materials processing and preservation cryosurgery and cryopreservation of biological tissue and even the water cycle on mars and other cold planets e g xu et al 2010 deville 2017 when freezing or thawing occurs in soils the energy exchange and heat propagation are primarily affected by the latent heat released from the water ice phase change as the freezing front propagates in time the concomitant changes in the proportion of water and ice content alter the thermal hydraulic mechanical and chemical properties of soils which in turn affect the processes of water migration heat transfer porous media deformation and solute transport reaction therefore mathematical models developed to describe these complex processes that occur in seasonally frozen soil and permafrost terrain are highly nonlinear which brings enormous challenges to derive the exact analytical solutions in past decades many numerical approaches have been developed and are broadly used to approximate the exact solutions under various initial and boundary conditions e g an et al 1990 devoie 2021 however these numerical models are rarely compared and verified with analytical solutions e g grenier et al 2018 analytical solutions are helpful for benchmarking numerical models and quickly analyzing the idealized system still only a few studies have focused on the development of analytical solutions for the processes of freezing and thawing soils the first analytical expressions for heat transfer with freezing and thawing processes were documented by stefan and neumann in the late 19th century e g stefan 1889 carslaw jaeger 1959 lunardini 1981 although only heat conduction and constant thermal properties in the frozen and thaw zones were assumed their solutions were adapted by geotechnical engineers and cryo hydrogeologists to calculate temperature distributions with water ice phase change and to predict the seasonal depth of the freezing or thawing front e g jumikis 1966 later lunardini 1985 1991 introduced a partially frozen zone mushy or slurry zone between the fully frozen and thawed zones and proposed a three zone analytical solution for temperature distributions osterkamp 1987 further divided the partially frozen zone into many uniform segments to predict the maximum depth of ice penetration in a large artificial island built on subsea permafrost by adapting the stefan neumann solution for multi layered soils xie gough 2013 simulated temperature profiles at typical permafrost sites on the qinghai tibetan plateau kurylyk et al 2014 discussed the lunardini solution for a thawing problem of an initially fully frozen soil column which accommodated heat advection via water flow under steady state thermal conditions collectively these classic solutions have paved a cost effective way for verifying mathematical models of heat transfer with phase change however the change in thermal properties of a soil composite with subzero temperatures as well as the effect of unfrozen water content were largely ignored because of the high nonlinearity of the water and heat transfer system many numerical codes have emerged to quantify the freeze thaw processes in permafrost and seasonally frozen soils neumann s two zone i e a solid and a liquid zone and lunardini s three zone i e a solid a solid liquid and a liquid zone solutions have been extensively accepted for code verification and benchmarking e g grenier et al 2018 for example mottaghy rath 2006 used neumann s solution to verify a reactive transport modelling tool that was implemented for heat transport simulations within a permafrost formation in poland following this work anbergen et al 2015 computed temperature profiles and the propagation rate of the freezing front using the feflow and shemat simulators which were then tested against the neumann and lunardini solutions the neumann solution was also recommended to verify the numerical code temp w for validating a one dimensional freeze thaw process and the open source finite element code opengeosys for simulating thermo hydro mechanical chemical processes in porous media zheng et al 2019 mckenzie et al 2007 compared the lunardini solutions with simulated temperature distributions using sutra ice during the investigation of the freezing process in peat bogs in addition to the above mentioned thermal hydraulic models lunardini s solutions more recently were used to test the robustness of the coupled thermo hydro mechanical processes in saturated and unsaturated soils subjected to freezing actions e g nishimura et al 2009 tian et al 2019 huang et al 2019 2022 huang rudolph 2021 considering the rapid increase in accessible numerical models designed to simulate soil freeze thaw processes and the value of benchmarking these solutions to analytical models it would be of interest to ensure that the analytical solutions used to assess this family of numerical models capture as much of the associated physics of the processes as possible robust analytical solutions that accommodate both the variations of thermal properties over an extended range of temperatures and the variable phase stratification along the freezing front would be of practical value this study presents a new hybrid analytical numerical solution scheme for determining transient soil temperature profiles subjected to unidirectional freezing or thawing processes by incorporating temperature dependent thermal properties the proposed scheme was applied to a freezing test of silty clay which is the dominant soil texture of the active layer on the qinghai tibetan plateau with high frost susceptibility the calculated temperature profiles including the unfrozen water content thermal conductivity thermal diffusivity conductive heat flux and the propagation of the freezing front were comparably studied based on different types of unfrozen water content models and different values of soil grain thermal conductivities the results of this work may provide significant insight for selecting appropriate unfrozen water content models and soil thermal conductivity models to predict the evolution of temperature profiles in the subsurface during the freezing or thawing process 2 methodology 2 1 formulation of the problem for low permeability sediments like silty clay which are subjected to freeze thaw cycles the movement of unfrozen water is usually assumed to be negligible due to the low hydraulic conductivity of the porous medium and heat conduction is considered to be a far more significant process than that of heat convection e g zhang et al 2017 selroos et al 2019 zhu et al 2019 for the current study we will consider the propagation of the freezing front into an initially unfrozen semi infinite column of soil with a uniform initial temperature tn throughout the domain heat exchange is triggered by a sudden decrease to a cold temperature t 0 on the top surface or upper boundary this one dimensional heat conductive transfer process along with the ice water phase change based upon an energy balance can be written in the following form 1 c s t t l f ρ i ρ w θ i t z λ t z 0 where t is the temperature c t is the time s cs is the bulk equivalent volumetric heat capacity of the soil composite j m 3 v c 1 θ i is the volumetric fraction of the ice m3 m 3 lf is the volumetric latent heat of water freezing melting approximately 3 33 108 j m 3 ρ i 917 kg m 3 and ρ w 1000 kg m 3 are the density of ice and liquid water respectively and λ is the equivalent thermal conductivity of the soil composites w m 1 c 1 the first term represents the change rate of energy storage the second term refers to the latent heat released absorbed by the phase change between the unfrozen water and ice the third term corresponds to the net energy flow by conduction by incorporating latent heat into the heat capacity eq 1 can be reduced to the general heat transport equation 2 c t t z λ t z where c c s l f ρ i ρ w θ i t c s l f θ w t is defined as the apparent volumetric heat capacity by subsuming the latent heat effect in the soil bulk heat capacity term because the volumetric fraction of unfrozen water θ w depends on the subzero temperatures see fig 1 a so do the c and λ parameters which brings nonlinearity into eq 2 thus making it difficult to derive an analytical solution however if the computation domain were divided into many zones each with nearly constant values of θ w c and λ within a narrow interval of subzero temperatures it would be possible to obtain approximate analytical solutions fig 1b shows typical snapshots of temperature profiles for freezing of the initially unfrozen soil column respectively in order to illustrate the proposed approach to formulating the analytical solution a simple four layer discretization of the computational domain is designated based on the temperature ranges denoted along the unfrozen water content curve as shown in fig 1a for this case the water freezing point tf was assigned equal to t 3 at the interface between the unfrozen and partially frozen regions for the case where the domain is divided into many much finer layers i e n 3 the partially frozen region was divided into n 1 layers overlying one unfrozen layer at the bottom for the top down freezing problem for the top down thawing problem the one unfrozen layer is at the top of the domain the isotherms t 1 t 2 t n 1 are the internal thermal boundaries of these layers with corresponding locations z 1 z 2 z n 1 varying with time the unfrozen water content versus temperature curve was divided into a number of proportionally spaced layers segments within the temperature below tf as shown in fig 1 to refine the discretized layers based on the temperature the proportion ratio is defined as the width of layer n 1 divided by the width of layer n 2 and equal to t n 1 t n 2 t n 2 t n 3 for example the ratio 1 0 means an equally spaced temperature layer and 0 8 denotes a narrower spacing closer to the freezing front as shown in fig 1b both c and λ are assumed to be constant within each layer owing to a small variation of temperature but their values are different from layer to layer for each layer j 1 2 n eq 2 becomes 3 t t d j 2 t z 2 where d j λ j c j is defined as the thermal diffusivity for the jth layer the initial condition is given as 4 t z 0 t 0 t n where tn is the temperature as z approaches infinity for the jth layer the temperature at the top boundary z j 1 isotherms is given as 5 t z j 1 t 0 t j 1 and temperature at the bottom boundary zj isotherms is given as 6 t z j t 0 t j because the heat flow is continuous within each layer it is also continued at the internal boundary j 1 2 n 1 for example at the position zj the heat flux is given by 7 λ j t z z z j λ j 1 t z z z j 2 2 hybrid analytical numerical solution scheme based on the analytical solutions of neumman s two zone and lunardini s three zone models for the heat transfer process with phase change lunardini 1985 1991 the more generalized form of solutions satisfying the above eqs 3 7 for the top down freezing of the initially unfrozen soil column as shown in fig 1b can be expressed as follows i for temperature profiles in the partially frozen region namely j 1 2 n 1 8 t z t j t j t j t j 1 erf z 2 d j t erf β j erf β j erf β j 1 d j 1 d j ii for temperature profiles in the unfrozen region namely j n 9 t z t j t j t j t j 1 erfc z 2 d j t erfc β j 1 d j 1 d j where erf is the error function and erfc 1 erf is the complementary error function combining the boundary conditions of each layer eqs 5 and 6 with eq 8 the internal moving isotherms j 1 2 n 1 can be calculated by e g lunardini 1991 mckenzie et al 2007 10 z j t j 2 β j d j t substituting the eqs 8 and 9 into eq 7 we can determine the unknowns β j which correspond to the bottom of each layer of the partially frozen region as follows i for the coefficient β n 1 corresponding to the freezing front at the interface between the partially frozen and unfrozen regions namely j n 1 11 t j t j 1 exp β j 2 erf β j erf β j 1 d j 1 d j t j 1 t j d j λ j 1 d j 1 λ j exp β j 2 d j d j 1 erfc β j d j d j 1 ii for the remaining coefficients β j corresponding to the other moving isotherms within the partially frozen region namely j 1 2 n 2 12 t j t j 1 exp β j 2 erf β j erf β j 1 d j 1 d j t j 1 t j d j λ j 1 d j 1 λ j exp β j 2 d j d j 1 erf β j 1 erf β j d j d j 1 by substituting the thermal diffusivity dj of each layer into eqs 11 and 12 for j 1 2 n 1 we get n 1 transcendental equations but there are n unknowns i e β0 β1 β n 1 it should be noted that the top cold end ground surface does not change indicating z 0 t 0 and β0 equal to zero therefore it is possible to solve for n 1 unknowns β1 β n 1 from n 1 transcendental equations however their solutions might not be unique here at least two types of constraints could be added to optimize the solution e g carslaw jaeger 1959 osterkamp 1987 lunardini 1991 firstly the β j must be positive and monotonically increasing with subscripts namely β n 1 β2 β1 0 as the freezing front penetrates with time resulting in a downward movement of the internal boundaries of each layer isotherms according to eq 10 secondly the value of erf β j erf β j 1 d j 1 d j must be positive namely β j β j 1 d j 1 d j as the value of erfc β j d j d j 1 is always greater than zero according to eq 11 given a small value for the convergence criteria the above system of nonlinear equations can be solved within an incremental iterative newton raphson scheme when the n 1 unknowns β j are obtained they can be substituted into eqs 8 9 and 10 to get explicit solutions of the temperature profiles t z t and the moving isotherms for different subzero temperatures because there is an inverse relationship between the freezing and thawing process the scheme used to solve the top down thawing of initially frozen soil is the same in form as that of the top down freezing problem presented above however for the unidirectional thawing problem such as tracking the thaw penetration in the initially frozen ground e g stefan problem elaborated by kurylyk et al 2014 the top thawed layer of the simulation domain overlies n 1 partially frozen layers it should be noted that the proposed solving scheme can not be directly applied to the freeze thaw cycling process which involves the bidirectional behaviour of thermal migration as yet no exact analytical solution is available for that specific case but even so for most cases the magnitude of the thawing forcing from the upper ground surface boundary will be significantly higher than that from the lower boundary such that the proposed multi layer scheme will still have wide applicability 3 a freezing test in a permafrost area the new solution scheme presented above provides a convenient way to calculate temperature profiles for the conductive heat transfer with water ice phase change problems such as the freezing or thawing process in soils without having to employ complex numerical models in this section a freezing test is conducted to illustrate and compare the results by the described solution techniques in permafrost environments especially for discontinuous permafrost zones such as those encountered in parts of the northwest territories canada e g devoie 2021 qinghai tibetan plateau china e g lu et al 2019 and many other cold regions information about the depth of subsurface freezing or thawing is critical as it affects the eco hydrological processes e g energy balance water and nutrients cycles etc and infrastructure stability e g buildings pipelines roads etc wen et al 2012 and lu et al 2019 subsequentially ran a series of laboratory field experiments to analyze the relationships among the temperature unfrozen water content and soil matric potential of qinghai tibetan silty clay which provide a sufficient foundation for the following cryo hydrogeological studies in this case it is assumed that the land surface is suddenly subjected to constant cold air temperature 12 c the initial temperature of the subsurface is assumed to be 1 0 c and the freezing point invariantly to be 0 3 c heat conduction is the dominant heat transport mechanism in the simulated cases and the process of convective advective heat transport governed by the hydraulic properties is ignored in the two layer neumann solution it is assumed that the pore water is wholly transferred into ice as the freezing front propagates the evaluation of different soil freezing functions and thermal property calculations including the thermal conductivity heat capacity equivalent heat capacity and apparent heat capacity and thermal diffusivity are described in the appendix equations 11 and 12 were then solved for the constants for the moving boundary of each layer the substitution of these constants into equations 8 10 yields the solution for the temperature profiles and the propagation of the freezing front thermal properties are assumed to be uniform within each layer and are calculated based on the median temperature of the two moving isotherms 3 1 comparison with neumann analytical solution and finite element numerical solution based on the freezing curve proposed by anderson tice 1972 and the equivalent thermal conductivity estimated by the weighted geometric mean method calculations utilizing the multi layer method proposed in the current work were completed to compare the temperature profiles and propagation curves of the freezing front obtained through the two layer neumann solution and finite element fe numerical model the comsol multiphysics fe simulator comsol 2017 was used to solve eq 1 to obtain the numerical solutions the soil porosity is 0 36 the thermal conductivity λ g and heat capacity cg of soil grain are 1 5 w m 1 c 1 and 800 j kg 1 c 1 respectively fig 2 a presents the calculated temperature profiles after 20 years of freezing for the two layer neumann solution the multi layer solution with different proportion ratios and the fe numerical solution the freezing depth was z n 1 9 65 m for the neumann solution while it was deeper ranging from 15 5 to 28 5 m for the multi layer solution this greater depth of ice penetration appears to be caused by the reduced amount of latent heat that was removed in the partially frozen region compared to the fully frozen region for the neumann solution as such the two layer neumann method underestimates the maximum depth of ice penetration as illustrated in fig 2a and fig 2b there are negligible variations among the solutions of 10 layer proportion ratio 0 6 100 layer proportion ratio 1 0 and 100 layer proportion ratio 0 8 and they match well with the simulations via the fe numerical method it can also be seen from fig 2a and fig 2b that a shallower penetration depth and slower penetration rate of the freezing front are presented when the domain is divided into more layers for the same proportion ratio furthermore for the same number of discretization layers a shallower penetration depth and slower penetration rate of the freezing front are also predicted when the proportion ratio decreases a small value of the proportion ratio means that the thinner layer will be discretized when closer to the freezing point tf region a rational reason for this result is that the finer discretization of the subzero temperature layers near the freezing point will capture the nearby significant drop in the unfrozen water content which leads to a much more accurate representation of the large amount of the latent heat released close to the freezing front however the finer discretization requires a high computational cost to maintain the high accuracy and reduce the computational cost for the current case each of the 10 layer proportion ratio 0 6 50 layer proportion ratio 0 8 and 100 layer proportion ratio 1 0 are comparable because each requires only a couple of seconds to complete by contrast the fe numerical method needs about a half minute when implemented with the same computational infrastructure briefly when the multi layer method is used for actual research benchmarking numerical codes for example the 100 layer proportion ratio 0 9 or more refined discretization would be preferred however the coarser discretization such as 10 layer proportion ratio 0 6 would be enough for quickly estimating the maximum freezing depth or analyzing the idealized system different shapes of the transient temperature profiles are also observed in fig 2a in the frozen zone both the neumann method and the multi layer method predict a nearly linear temperature profile in the region close to tf however the multi layer method exhibits a gradual temperature change this gradual temperature change at the phase boundary is due to the stable evolution of the thermal properties from layer to layer associated with the multi layer method which becomes progressively more smooth as the number of layers is increased 3 2 effects of different soil freezing functions different soil freezing functions may yield different shapes of thermal conductivity and diffusivity with respect to temperature as shown in fig b 1 and fig b 2 in appendix b this will affect the temperature profiles during the freeze thaw process in soils and permafrost following the freezing test with a freezing function of the anderson tice 1972 in section 3 1 another five commonly used freezing functions with reasonable parameters see fig a 1a and table a 1 in appendix a were examined by using the 100 layer method with a proportion ratio of 0 9 fig 3 presents the predicted profiles of the temperature liquid water content equivalent thermal conductivity thermal diffusivity and conductive heat flux after 20 years of freezing as well as the propagation of the freezing front which were highly impacted by the form of the freezing functions it can be seen in fig 3a that the maximum depth of ice penetration is about 15 5 m using the freezing curve proposed by anderson tice 1972 while this increases to 26 0 m with the soil freezing function presented by zhang et al 2017 the different profiles of unfrozen water content within the partially frozen region were generated in fig 3b by substituting the temperatures into the corresponding freezing curves because the thermal conductivity of solid ice is approximately four times larger than that of liquid water there is a somewhat mirrored shape relationship between the profiles of unfrozen water content in fig 3b and the profiles of soil equivalent thermal conductivity in fig 3c in the partially frozen region near the freezing front the substantial water ice phase change generated a spike in latent heat resulting in a peak in the apparent heat capacity see fig 4 and further caused a trough in the thermal diffusivity especially for the results of anderson tice 1972 vg clapeyron and zhang et al 2017 as shown in fig 3d the results in fig 3e illustrate that this excessive latent heat buffered heat transfer and yielded a similar reduction of the heat flux fig 3f shows that the rate of movement of the freezing front predicted by the form of anderson tice 1972 lags the other formulations of the freezing functions by a significant amount this lag increases with time and it may reach a large value when approaching the thermal steady state condition the maximum depth of the freezing front it can also be seen that the predicted depth of the freezing front is within the upper boundary underestimation values calculated by anderson tice 1972 model and lower boundary over estimation values calculated by zhang et al 2017 model for example at the end of 20 years of simulation the difference in the predicted freezing depth between the anderson tice 1972 and zhang et al 2017 models is up to 10 5 m these observations indicate that the temperature profiles intermediate thermal variables and the depth of the freezing front are highly impacted by the shape of the freezing curve especially for the long term predictions given the heterogeneity of soil properties it would be difficult to choose the most reasonable freezing function if there were scarce field laboratory observations for a specific site however the presentation of confidence intervals calculated from anderson tice 1972 model and zhang et al 2017 model and relevant parametric analyses would be helpful for the predictive understanding of the soil freezing process based on hypothetical scenarios fig 4 shows significant variations in the calculated profiles of soil apparent heat capacity c c s l f θ w t are observed after 20 years of freezing and their shapes are dominantly controlled by the first derivative of soil freezing functions see fig a 1b the apparent heat capacity c in eq 2 is conventionally named as a mass coefficient or damping coefficient term according to a general form of the partial derivative equation the abrupt changes in values of this term near the freezing front especially for zhang et al 2017 model vg clapeyron model and anderson tice 1972 model usually require substantial computation cost and might cause numerical oscillations if numerical method was used to solve the equations 3 3 effects of different thermal conductivities soil freezing behaviours can be affected by the variations of soil grain thermal properties most recent studies found thermal conductivity has a higher model sensitivity compared with heat capacity e g de bruin et al 2021 huang rudolph 2021 following the above findings different values of soil grain thermal conductivity i e λ g 1 0 1 5 and 2 0 w m 1 c 1 were comparatively analyzed based on the underestimation soil freezing function proposed by anderson tice 1972 and the overestimation soil freezing function proposed by zhang et al 2017 all other settings are kept the same as those in section 3 2 fig 5 presents the predicted profiles of the temperature liquid water content equivalent thermal conductivity thermal diffusivity and conductive heat flux after 20 years of freezing as well as the propagation of the freezing front which were significantly impacted by the different soil grain thermal conductivities fig 5a shows the freezing depth ranges from 13 84 to 17 31 m for anderson tice 1972 model and from 23 91 to 28 83 m for zhang et al 2017 model when soil grain thermal conductivity increases from 1 0 to 2 0 w m 1 c 1 as shown in fig s 5b 5c and 5d the profiles of unfrozen water content equivalent thermal conductivity and thermal diffusivity correspondingly shift downward similar to this pattern the magnitude of heat flux and the depth of freezing front increase with soil grain thermal conductivity as displayed in fig 5e and fig 5f it can also be seen from fig 5f that those variations caused by different thermal conductivity increase with simulation time indicating thermal conductivity significantly affects the accuracy of long term predictions 4 model limitations and future work a key limitation for the continual development of the proposed hybrid analytical numerical method is the availability of relevant exact analytical solutions upon which it is based although the finer discretization in the space of the dependent variables e g temperature spaced layer adapting for the shape of state variables e g thermal diffusivity could increase the solution s accuracy this optimization would require high computational effort as for its application to the soil freezing process there are several limitations from the governing eq 1 i it does not consider the heat convection contributed by pore water flow e g driven by the hydraulic gradient and thermal gradient that may be questionable if high liquid fluxes were anticipated in less dense coarser soil materials ii the saturated soil domain is assumed as a non deformable continuous porous media with isotropic constant total porosity that ignores the proportion change of each constituent caused by ice expansion and iii it handles water ice phase change in simplified equilibrium thermodynamics that requires further calibration the variations in soil porosity affect the amount proportion of liquid water and ice in the pore space see supplementary materials fig s1 and the shape of the unfrozen water content curve such as anderson tice 1972 model and thereby the required latent heat of fusion during phase transition whose effects were not comparably analyzed here in addition to collecting more laboratory field experimental data to validate the model developing a friendly graphical user interface for the approximate analytical solution would be helpful for testing numerical solutions and intuitively understanding the cryo subsurface the inclusion of variably saturated flow and more practical freeze thaw cycles would enable the model to be applied to more diverse cold region environments further research is underway to incorporate these processes and examine how they affect thermal regimes and relevant flow transport mechanisms in cryo hydrogeological systems 5 conclusions this study proposed a hybrid analytical numerical technique for solving one dimensional soil temperature profiles subjected to the unidirectional freezing or thawing process this solution scheme divides the partially frozen soil into multi layers with respect to temperatures indicating that each layer has temperature fixed location free boundaries and uniform thermal parameters this proposed hybrid analytical numerical scheme was tested through a comparison to a freezing test and its solution was in good agreement with the finite element numerical solution and the results of different forms of soil freezing functions were comparably studied the main findings and conclusions of this study can be drawn as follows 1 in comparison to neumann s two layer method the proposed multi layer method adapts well to the changes of unfrozen water content and thermal properties over a wide range of subzero temperatures 2 because neumann s two layer solution assumes a partially frozen region does not exist the release of latent heat was over calculated which resulted in an underestimation of the moving rate and maximum depth of the freezing front for the multi layer method the more layers with smaller proportion ratios thin layers nearby the freezing point used to discretize the domain the shallower and slower penetration of the freezing front 3 the profiles of temperature thermal conductivity and diffusivity heat flux and dynamics of the freezing front are highly impacted by the shape of the soil freezing curve the freezing curves developed by anderson tice 1972 and zhang et al 2017 could be used to estimate the upper boundary underestimation and lower boundary overestimation for predicting the depth of freezing front maximum depth of ice penetration respectively especially for running a permafrost relevant forecast model for a few to tens of years for example in order to obtain a temperature solution under thermal steady state by running the transient model for a long time to approximate a steady state condition 4 the shape of the unfrozen water content curve and the magnitude of soil grain thermal conductivity have a large impact on long term predictions of the freezing front s migration rate and penetration depth in summary the above hybrid analytical numerical solution scheme can capture the main relevant dynamics of temperature profiles for soil freezing and thawing processes if heat exchange occurs only due to conduction and pore water phase change the soil thermal properties are assumed to be only temperature dependent without taking into account the effect of water movement and the impact of the freeze induced deformation on soil structure although the conclusions above have certain limitations and may require further clarification they may assist in better understanding the thermal dynamics in permafrost glacial terrain and the shallow subsurface during the freeze and thaw processes credit authorship contribution statement xiang huang conceptualization methodology formal analysis visualization writing original draft writing review editing david l rudolph funding acquisition resources writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the authors would like to thank the global water futures gwf program for financial support through project funding and the natural sciences and engineering research council nserc for financial support through a discovery grant to d l rudolph xiang huang was also financially supported in part by the national natural science foundation of china 41702265 the authors appreciate valuable comments from four anonymous reviewers the associate editor and editor dr gabriele villarini which helped significantly improve this manuscript supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2022 104163 appendix c supplementary materials image application 1 appendix a unfrozen water content in freezing soils unfrozen water content refers to the amount of unfrozen water existing in soil pores at subzero temperature it is well recognized that the unfrozen water content drops sharply after the freezing point tf to a specified residual value over a wide temperature range i e from 50 to 0 c the relationship between temperature and unfrozen water content in frozen soils is usually defined as the unfrozen water characteristics curve uwcc the soil freezing characteristics curve sfcc or soil freezing functions which is a critical soil property for calculating heat and mass transport in frozen soils as well as frost heave and thaw settlement e g zhang michalowski 2015 tian et al 2019 tens of uwcc models expressions are available in the literature e g kurylyk watanabe 2013 hu et al 2020 and could be roughly categorized into two groups the first group incorporates an empirical relationship between the experimental results of unfrozen water content and subzero temperature the second group is based on the mathematical combination of the soil water characteristic function and the clapeyron equation where the subzero temperature is correlated to soil suction at the ice water interface under thermodynamic equilibrium here six commonly used uwcc models e g mckenzie et al 2007 ren vanapalli 2018 lu et al 2019 hu et al 2020 wen et al 2020 are described and evaluated among which the former four belong to the first empirical fitting group and the remaining two are within the mathematical combination group a 1 description of the uwcc models anderson tice 1972 found that the uwcc could be approximated by a simple power function of temperature as follows a 1 θ w ρ d ρ w α t η t t f θ 0 t t f where θ w is the volumetric fraction of unfrozen water content and θ0 corresponds to the mean volumetric water content during a thawing period or its initial value m3 m 3 ρ w and ρ d are the density of water and dry soil kg m 3 respectively α and η are soil characteristic fitting parameters tf is the freezing point of pore water c t is the soil temperature c this model assumes the unfrozen water is confined in the pores due to the adsorptive force and it has been widely used in cold region engineering practice applications e g xu et al 2010 tian et al 2019 because the unfrozen water content in soil drops toward an infinitesimally small amount as the subzero temperature decreases it thus might be unacceptable in mathematical or numerical calculations michalowski 1993 proposed an exponential function based on experimental tests from anderson tice 1972 that is a 2 θ w θ r e s θ 0 θ r e s e μ t t f t t f θ 0 t t f where μ is a soil characteristic fitting parameter and θ res is the residual unfrozen water content at some very low reference temperature this model was used for simulating frost heave and thaw settlement e g zhang michalowski 2015 more recently mckenzie et al 2007 presented a revised exponential relationship by exploiting the similarity in shape between the soil freezing function and soil water characteristic function e g lunardini 1991 which is given as follows a 3 θ w θ r e s θ 0 θ r e s e t t f γ 2 t t f θ 0 t t f where γ is a soil characteristic fitting parameter this revised exponential equation was subsequently written into the sutra ice for predicting hydrogeological regimes in permafrost regions under a warming climate e g mckenzie et al 2007 devoie 2021 in subsequent work zhang et al 2017 suggested another relationship between the volumetric unfrozen water content and subzero temperature based on four years of field observations which is expressed as a 4 θ w θ 0 1 t f t t f 273 15 ω t t f θ 0 t t f where ω is the only fitting parameter this model assumed all pore water was turned into ice if the soil temperature fell below 273 15 k and was shown to be convenient for numerical analysis of the coupled hydrothermal or thermomechanical processes in permafrost regions e g zhang et al 2017 lu et al 2019 since the above mentioned uwcc analytical models are based on empirical formulae fitted to lab field observations it is challenging to ensure their versatility for different kinds of soils some researchers e g nishimura et al 2009 kurylyk watanabe 2013 proposed a combination of the simplified clapeyron equation with the van genuchten soil water characteristic function vg model van genuchten 1980 yielding the vg clapeyron model for the unfrozen water content as below a 5 θ w θ r e s θ 0 θ r e s 1 α v g l f ρ w g t f t t f 273 15 n v g m v g t t f θ 0 t t f where α vg nvg and mvg are soil fitting parameters of the vg model this model considered the analogy between the soil characteristic function and soil freezing function and was used for simulating coupled thermal hydraulic behaviour in unsaturated freezing soils e g he et al 2020 huang et al 2022 alternatively when substituting the clapeyron equation into the fredlund and xing soil water characteristic function fx model fredlund xing 1994 azmatch et al 2012 successfully fitted the measured soil freezing data unfrozen water content vs subzero temperature for silt soils and developed the fx clapeyron model as below a 6 θ w θ 0 ln e l f α f x ρ w g t f t t f 273 15 n f x m f x t t f θ 0 t t f where α fx nfx and mfx are soil fitting parameters of the fx model e is the natural logarithmic constant ren vanapalli 2018 used this model to predict a resilient modulus of frozen saturated soils and the associated cryogenic suction by exploiting the similarity between freezing thawing and drying wetting processes in fact there are many other unfrozen water models such as the linear or nonlinear piecewise freezing curves within a specified temperature interval and models related to the distribution of pore size pore pressure void ratio the surface area of soil grains etc e g kurylyk watanabe 2013 lu et al 2019 however the formulation of these models can be either too simple or too complicated which makes them inconvenient for many practical applications more recently some researchers e g wen et al 2020 hu et al 2020 comparatively evaluated many different types of the uwcc and argued that it was difficult to propose a generalized formula suitable for all soils a 2 evaluation by laboratory observations to illustrate the differences among the above six uwcc models we evaluated their abilities to reproduce the unfrozen water content against the laboratory measurements the unfrozen water contents versus subzero temperatures for a typical freezing test of a silty clay sample collected from the qinghai tibetan plateau china wen et al 2012 lu et al 2019 fig a 1 presents a comparison of the calculated results for these six uwcc models the corresponding best fitted parameters listed in table a 1 were obtained by minimizing the sum of squares of the residuals the minimized root mean square error rmse describes the absolute differences between the calculated and measured values the shape of anderson tice 1972 is similar to fx clapeyron model the curve of zhang et al 2017 is pretty close to that of vg clapeyron according to the calculated values of the remse and pearson correlation coefficient the best fitting one is anderson tice 1972 model it can be seen that none of the six uwcc models can fully capture all features of the changes in volumetric unfrozen water content with temperatures especially for the rapidly decreasing shape of this relationship near tf due to the drastic water ice phase transition and the gradual stable tail residual water content far below tf according to the first derivative of these uwcc models with respect to temperature slope of the freezing functions in fig a 1b both the mckenzie et al 2007 and fx clapeyron models have the advantage of continuous differentiability and show high computational efficiency which are good for numerical stability but exhibit zero at the freezing point tf this means that the unfrozen water content gently changes continuously with subzero temperatures immediately close to the freezing point however these two fail to represent the practically observed phenomenon e g lunardini 1991 xu et al 2010 that the actual variation of the unfrozen water contents usually drops drastically discontinuously close to the freezing point appendix b thermal properties of freezing soils the thermal diffusivity equals thermal conductivity divided by the apparent heat capacity which is the sum of the bulk heat capacity and the latent heat of water ice phase change according to eq 1 the latent heat is linearly related to the first derivative of unfrozen water content as a function of the subzero temperature therefore before analyzing the relationship between thermal diffusivity and subzero temperature we should first examine the variations of bulk heat capacity and thermal conductivity with changing subzero temperatures the bulk equivalent volumetric heat capacity cs of frozen soil is conventionally calculated as a mixture of soil grains g water w and ice i e g michalowski 1993 xu et al 2010 b 1 c s k θ k ρ k c k where θ k ρ k and ck are the volumetric fraction m3 m 3 density kg m 3 and mass heat capacity j kg 1 c 1 of the kth constituent k g w i respectively with the heat capacity of ice ci 2100 j kg 1 c 1 and heat capacity of water cw 4180 j kg 1 c 1 the equivalent thermal conductivity of frozen soil depends on the thermal conductivities of its components soil grain λ g water λ w 0 56 and ice λ i 2 22 w m 1 c 1 their volumetric fractions and spatial distribution orientation of the medium constituents e g jumikis 1966 it has been recognized that the equivalent thermal conductivity of frozen soils is inversely related to the subzero temperature though monotonically varying this relationship can be more complicated depending on the arrangements of the ice soil structure and empirical fittings of a series of experimental measurements the expressions for calculating the equivalent thermal conductivity are diverse in the literature e g jumikis 1966 lunardini 1981 tian et al 2019 here four commonly used formulas are described and evaluated b 1 description of the thermal conductivity models if the components of frozen soil are arranged in parallel to the direction of heat flow its equivalent thermal conductivity can be given by the weighted arithmetic mean b 2 λ a m k λ k θ k where λ k is the conductivity and θ k is the volumetric content of the kth constituent this parallel arrangement is exact for calculating the bulk density and volumetric heat capacity of soils by contrast the series arrangements yield the equivalent thermal conductivity using the weighted harmonic mean b 3 λ h m k λ k 1 θ k 1 in reality the natural structure of frozen soil can be considered a mixture of the above two types of arrangements indicating that the equivalent thermal conductivity varies between these two bounds subsequently a third formula is proposed to calculate the equivalent thermal conductivity based on the weighted geometric mean b 4 λ g m k λ k θ k where the geometric mean of thermal conductivity λ gm was widely used in many frozen soil and permafrost studies e g zhang michalowski 2015 he et al 2020 on the other hand by assuming randomly distributed constituents woodside messmer 1961 proposed a weighted square root mean of thermal conductivity which was written into a numerical model by mottaghy rath 2006 considering a more definite physical meaning than the geometric mean as below b 5 λ s r m k θ k λ k 2 b 2 comparison of thermal conductivity and diffusivity for different calculation methods on the basis of the best fitted uwcc models in fig a 1 and the thermal conductivities of all constituents that form the soil e g water ice and soil grains solutions for the equivalent thermal conductivities and diffusivities across the whole freezing or thawing process can be generated fig b 1 and fig b 2 present the equivalent thermal conductivity and diffusivity as a function of temperature using four different approaches respectively it can be seen that the equivalent thermal conductivities and diffusivities calculated by the geometric mean and the square root mean are somewhat close and they both lie between the upper bound by the arithmetic mean and the lower bound by the harmonic mean method compared with other uwcc models the vg clapeyron model and zhang et al 2017 model yield a sharp break of the equivalent thermal conductivities and diffusivities at temperatures immediately below the freezing point tf this behaviour can be attributed to the sudden decrease of unfrozen water content fig a 1a and its corresponding steep slope with respect to temperature fig a 1b it can be seen from the definition of the equivalent heat capacity cs θ g ρ g cg θ i ρ i ci θ w ρ w cw and apparent heat capacity c c s l f θ w t that the shape of equivalent heat capacity is similar to that of the uwcc while the shape of the apparent heat capacity is similar to that of the first derivative of the uwcc collectively the above performance evaluation of the different uwcc models and thermal conductivity calculation methods reflect the fact that i thermal properties of frozen soils are nonlinearly related to subzero temperatures and particularly exhibit a significant variation close to the freezing point and ii different uwcc models result in different characteristic curves of thermal diffusivities which affect the heat transfer process of frozen soils specifically speaking both the mckenzie et al 2007 and fx clapeyron models have the advantage of continuous differentiability but fail to represent the actual rapid variation of the unfrozen water contents at the freezing point for calculating the equivalent thermal conductivity and diffusivity of soil composite the vg clapeyron model and zhang et al 2017 model yield a sharp break at a temperature close to the freezing point 
183,the freeze thaw cycle associated with climatic seasonality is a common phenomenon in cold regions affecting a wide range of subsurface processes due to the complex and highly nonlinear nature of the associated hydrologic processes transient freeze thaw dynamics are conventionally quantified in a numerical way here we present a hybrid analytical numerical scheme for solving one dimensional soil or porous media temperature profiles when the soil profile is subjected to unidirectional freezing or thawing conditions this scheme divides the partially frozen soil into multi layers each with constant thermal parameters and fixed temperature boundaries temperature profiles within each layer were obtained by solving multiple moving boundary problems the proposed hybrid analytical numerical scheme was tested into a freezing test of silty clay in a permafrost region on the qinghai tibetan plateau and its solution was in good agreement with the finite element numerical solution results show that the proposed multi layer method adapted well to the changes in unfrozen water content and thermal properties of soil over a wide range of subzero temperatures by contrast the freezing front s migration rate and penetration depth calculated by neumann s classical solution which only considers two zones frozen and unfrozen was found to be underestimated as for our proposed multi layer solution by dividing the subsurface domain into many layers with smaller proportion ratios thinner layers close to the freezing front there was a slower penetration rate of the freezing front resulting in shallower penetration depth the predicted profiles of temperature thermal conductivity and diffusivity heat flux and dynamics of the freezing front were significantly impacted by the shape of the soil freezing curves and the magnitude of soil grain thermal conductivity especially for the accuracy of long term predictions keywords analytical solution heat transfer with phase change freeze thaw process nonlinearity unfrozen water content temperature dependent thermal property thermal diffusivity moving boundary problem 1 introduction freeze thaw processes play an integral role in nearly every aspect of the water ice system this includes for example applications in permafrost and seasonally frozen soils ice sheet and climate glacier dynamics infrastructure design and construction in cold regions food materials processing and preservation cryosurgery and cryopreservation of biological tissue and even the water cycle on mars and other cold planets e g xu et al 2010 deville 2017 when freezing or thawing occurs in soils the energy exchange and heat propagation are primarily affected by the latent heat released from the water ice phase change as the freezing front propagates in time the concomitant changes in the proportion of water and ice content alter the thermal hydraulic mechanical and chemical properties of soils which in turn affect the processes of water migration heat transfer porous media deformation and solute transport reaction therefore mathematical models developed to describe these complex processes that occur in seasonally frozen soil and permafrost terrain are highly nonlinear which brings enormous challenges to derive the exact analytical solutions in past decades many numerical approaches have been developed and are broadly used to approximate the exact solutions under various initial and boundary conditions e g an et al 1990 devoie 2021 however these numerical models are rarely compared and verified with analytical solutions e g grenier et al 2018 analytical solutions are helpful for benchmarking numerical models and quickly analyzing the idealized system still only a few studies have focused on the development of analytical solutions for the processes of freezing and thawing soils the first analytical expressions for heat transfer with freezing and thawing processes were documented by stefan and neumann in the late 19th century e g stefan 1889 carslaw jaeger 1959 lunardini 1981 although only heat conduction and constant thermal properties in the frozen and thaw zones were assumed their solutions were adapted by geotechnical engineers and cryo hydrogeologists to calculate temperature distributions with water ice phase change and to predict the seasonal depth of the freezing or thawing front e g jumikis 1966 later lunardini 1985 1991 introduced a partially frozen zone mushy or slurry zone between the fully frozen and thawed zones and proposed a three zone analytical solution for temperature distributions osterkamp 1987 further divided the partially frozen zone into many uniform segments to predict the maximum depth of ice penetration in a large artificial island built on subsea permafrost by adapting the stefan neumann solution for multi layered soils xie gough 2013 simulated temperature profiles at typical permafrost sites on the qinghai tibetan plateau kurylyk et al 2014 discussed the lunardini solution for a thawing problem of an initially fully frozen soil column which accommodated heat advection via water flow under steady state thermal conditions collectively these classic solutions have paved a cost effective way for verifying mathematical models of heat transfer with phase change however the change in thermal properties of a soil composite with subzero temperatures as well as the effect of unfrozen water content were largely ignored because of the high nonlinearity of the water and heat transfer system many numerical codes have emerged to quantify the freeze thaw processes in permafrost and seasonally frozen soils neumann s two zone i e a solid and a liquid zone and lunardini s three zone i e a solid a solid liquid and a liquid zone solutions have been extensively accepted for code verification and benchmarking e g grenier et al 2018 for example mottaghy rath 2006 used neumann s solution to verify a reactive transport modelling tool that was implemented for heat transport simulations within a permafrost formation in poland following this work anbergen et al 2015 computed temperature profiles and the propagation rate of the freezing front using the feflow and shemat simulators which were then tested against the neumann and lunardini solutions the neumann solution was also recommended to verify the numerical code temp w for validating a one dimensional freeze thaw process and the open source finite element code opengeosys for simulating thermo hydro mechanical chemical processes in porous media zheng et al 2019 mckenzie et al 2007 compared the lunardini solutions with simulated temperature distributions using sutra ice during the investigation of the freezing process in peat bogs in addition to the above mentioned thermal hydraulic models lunardini s solutions more recently were used to test the robustness of the coupled thermo hydro mechanical processes in saturated and unsaturated soils subjected to freezing actions e g nishimura et al 2009 tian et al 2019 huang et al 2019 2022 huang rudolph 2021 considering the rapid increase in accessible numerical models designed to simulate soil freeze thaw processes and the value of benchmarking these solutions to analytical models it would be of interest to ensure that the analytical solutions used to assess this family of numerical models capture as much of the associated physics of the processes as possible robust analytical solutions that accommodate both the variations of thermal properties over an extended range of temperatures and the variable phase stratification along the freezing front would be of practical value this study presents a new hybrid analytical numerical solution scheme for determining transient soil temperature profiles subjected to unidirectional freezing or thawing processes by incorporating temperature dependent thermal properties the proposed scheme was applied to a freezing test of silty clay which is the dominant soil texture of the active layer on the qinghai tibetan plateau with high frost susceptibility the calculated temperature profiles including the unfrozen water content thermal conductivity thermal diffusivity conductive heat flux and the propagation of the freezing front were comparably studied based on different types of unfrozen water content models and different values of soil grain thermal conductivities the results of this work may provide significant insight for selecting appropriate unfrozen water content models and soil thermal conductivity models to predict the evolution of temperature profiles in the subsurface during the freezing or thawing process 2 methodology 2 1 formulation of the problem for low permeability sediments like silty clay which are subjected to freeze thaw cycles the movement of unfrozen water is usually assumed to be negligible due to the low hydraulic conductivity of the porous medium and heat conduction is considered to be a far more significant process than that of heat convection e g zhang et al 2017 selroos et al 2019 zhu et al 2019 for the current study we will consider the propagation of the freezing front into an initially unfrozen semi infinite column of soil with a uniform initial temperature tn throughout the domain heat exchange is triggered by a sudden decrease to a cold temperature t 0 on the top surface or upper boundary this one dimensional heat conductive transfer process along with the ice water phase change based upon an energy balance can be written in the following form 1 c s t t l f ρ i ρ w θ i t z λ t z 0 where t is the temperature c t is the time s cs is the bulk equivalent volumetric heat capacity of the soil composite j m 3 v c 1 θ i is the volumetric fraction of the ice m3 m 3 lf is the volumetric latent heat of water freezing melting approximately 3 33 108 j m 3 ρ i 917 kg m 3 and ρ w 1000 kg m 3 are the density of ice and liquid water respectively and λ is the equivalent thermal conductivity of the soil composites w m 1 c 1 the first term represents the change rate of energy storage the second term refers to the latent heat released absorbed by the phase change between the unfrozen water and ice the third term corresponds to the net energy flow by conduction by incorporating latent heat into the heat capacity eq 1 can be reduced to the general heat transport equation 2 c t t z λ t z where c c s l f ρ i ρ w θ i t c s l f θ w t is defined as the apparent volumetric heat capacity by subsuming the latent heat effect in the soil bulk heat capacity term because the volumetric fraction of unfrozen water θ w depends on the subzero temperatures see fig 1 a so do the c and λ parameters which brings nonlinearity into eq 2 thus making it difficult to derive an analytical solution however if the computation domain were divided into many zones each with nearly constant values of θ w c and λ within a narrow interval of subzero temperatures it would be possible to obtain approximate analytical solutions fig 1b shows typical snapshots of temperature profiles for freezing of the initially unfrozen soil column respectively in order to illustrate the proposed approach to formulating the analytical solution a simple four layer discretization of the computational domain is designated based on the temperature ranges denoted along the unfrozen water content curve as shown in fig 1a for this case the water freezing point tf was assigned equal to t 3 at the interface between the unfrozen and partially frozen regions for the case where the domain is divided into many much finer layers i e n 3 the partially frozen region was divided into n 1 layers overlying one unfrozen layer at the bottom for the top down freezing problem for the top down thawing problem the one unfrozen layer is at the top of the domain the isotherms t 1 t 2 t n 1 are the internal thermal boundaries of these layers with corresponding locations z 1 z 2 z n 1 varying with time the unfrozen water content versus temperature curve was divided into a number of proportionally spaced layers segments within the temperature below tf as shown in fig 1 to refine the discretized layers based on the temperature the proportion ratio is defined as the width of layer n 1 divided by the width of layer n 2 and equal to t n 1 t n 2 t n 2 t n 3 for example the ratio 1 0 means an equally spaced temperature layer and 0 8 denotes a narrower spacing closer to the freezing front as shown in fig 1b both c and λ are assumed to be constant within each layer owing to a small variation of temperature but their values are different from layer to layer for each layer j 1 2 n eq 2 becomes 3 t t d j 2 t z 2 where d j λ j c j is defined as the thermal diffusivity for the jth layer the initial condition is given as 4 t z 0 t 0 t n where tn is the temperature as z approaches infinity for the jth layer the temperature at the top boundary z j 1 isotherms is given as 5 t z j 1 t 0 t j 1 and temperature at the bottom boundary zj isotherms is given as 6 t z j t 0 t j because the heat flow is continuous within each layer it is also continued at the internal boundary j 1 2 n 1 for example at the position zj the heat flux is given by 7 λ j t z z z j λ j 1 t z z z j 2 2 hybrid analytical numerical solution scheme based on the analytical solutions of neumman s two zone and lunardini s three zone models for the heat transfer process with phase change lunardini 1985 1991 the more generalized form of solutions satisfying the above eqs 3 7 for the top down freezing of the initially unfrozen soil column as shown in fig 1b can be expressed as follows i for temperature profiles in the partially frozen region namely j 1 2 n 1 8 t z t j t j t j t j 1 erf z 2 d j t erf β j erf β j erf β j 1 d j 1 d j ii for temperature profiles in the unfrozen region namely j n 9 t z t j t j t j t j 1 erfc z 2 d j t erfc β j 1 d j 1 d j where erf is the error function and erfc 1 erf is the complementary error function combining the boundary conditions of each layer eqs 5 and 6 with eq 8 the internal moving isotherms j 1 2 n 1 can be calculated by e g lunardini 1991 mckenzie et al 2007 10 z j t j 2 β j d j t substituting the eqs 8 and 9 into eq 7 we can determine the unknowns β j which correspond to the bottom of each layer of the partially frozen region as follows i for the coefficient β n 1 corresponding to the freezing front at the interface between the partially frozen and unfrozen regions namely j n 1 11 t j t j 1 exp β j 2 erf β j erf β j 1 d j 1 d j t j 1 t j d j λ j 1 d j 1 λ j exp β j 2 d j d j 1 erfc β j d j d j 1 ii for the remaining coefficients β j corresponding to the other moving isotherms within the partially frozen region namely j 1 2 n 2 12 t j t j 1 exp β j 2 erf β j erf β j 1 d j 1 d j t j 1 t j d j λ j 1 d j 1 λ j exp β j 2 d j d j 1 erf β j 1 erf β j d j d j 1 by substituting the thermal diffusivity dj of each layer into eqs 11 and 12 for j 1 2 n 1 we get n 1 transcendental equations but there are n unknowns i e β0 β1 β n 1 it should be noted that the top cold end ground surface does not change indicating z 0 t 0 and β0 equal to zero therefore it is possible to solve for n 1 unknowns β1 β n 1 from n 1 transcendental equations however their solutions might not be unique here at least two types of constraints could be added to optimize the solution e g carslaw jaeger 1959 osterkamp 1987 lunardini 1991 firstly the β j must be positive and monotonically increasing with subscripts namely β n 1 β2 β1 0 as the freezing front penetrates with time resulting in a downward movement of the internal boundaries of each layer isotherms according to eq 10 secondly the value of erf β j erf β j 1 d j 1 d j must be positive namely β j β j 1 d j 1 d j as the value of erfc β j d j d j 1 is always greater than zero according to eq 11 given a small value for the convergence criteria the above system of nonlinear equations can be solved within an incremental iterative newton raphson scheme when the n 1 unknowns β j are obtained they can be substituted into eqs 8 9 and 10 to get explicit solutions of the temperature profiles t z t and the moving isotherms for different subzero temperatures because there is an inverse relationship between the freezing and thawing process the scheme used to solve the top down thawing of initially frozen soil is the same in form as that of the top down freezing problem presented above however for the unidirectional thawing problem such as tracking the thaw penetration in the initially frozen ground e g stefan problem elaborated by kurylyk et al 2014 the top thawed layer of the simulation domain overlies n 1 partially frozen layers it should be noted that the proposed solving scheme can not be directly applied to the freeze thaw cycling process which involves the bidirectional behaviour of thermal migration as yet no exact analytical solution is available for that specific case but even so for most cases the magnitude of the thawing forcing from the upper ground surface boundary will be significantly higher than that from the lower boundary such that the proposed multi layer scheme will still have wide applicability 3 a freezing test in a permafrost area the new solution scheme presented above provides a convenient way to calculate temperature profiles for the conductive heat transfer with water ice phase change problems such as the freezing or thawing process in soils without having to employ complex numerical models in this section a freezing test is conducted to illustrate and compare the results by the described solution techniques in permafrost environments especially for discontinuous permafrost zones such as those encountered in parts of the northwest territories canada e g devoie 2021 qinghai tibetan plateau china e g lu et al 2019 and many other cold regions information about the depth of subsurface freezing or thawing is critical as it affects the eco hydrological processes e g energy balance water and nutrients cycles etc and infrastructure stability e g buildings pipelines roads etc wen et al 2012 and lu et al 2019 subsequentially ran a series of laboratory field experiments to analyze the relationships among the temperature unfrozen water content and soil matric potential of qinghai tibetan silty clay which provide a sufficient foundation for the following cryo hydrogeological studies in this case it is assumed that the land surface is suddenly subjected to constant cold air temperature 12 c the initial temperature of the subsurface is assumed to be 1 0 c and the freezing point invariantly to be 0 3 c heat conduction is the dominant heat transport mechanism in the simulated cases and the process of convective advective heat transport governed by the hydraulic properties is ignored in the two layer neumann solution it is assumed that the pore water is wholly transferred into ice as the freezing front propagates the evaluation of different soil freezing functions and thermal property calculations including the thermal conductivity heat capacity equivalent heat capacity and apparent heat capacity and thermal diffusivity are described in the appendix equations 11 and 12 were then solved for the constants for the moving boundary of each layer the substitution of these constants into equations 8 10 yields the solution for the temperature profiles and the propagation of the freezing front thermal properties are assumed to be uniform within each layer and are calculated based on the median temperature of the two moving isotherms 3 1 comparison with neumann analytical solution and finite element numerical solution based on the freezing curve proposed by anderson tice 1972 and the equivalent thermal conductivity estimated by the weighted geometric mean method calculations utilizing the multi layer method proposed in the current work were completed to compare the temperature profiles and propagation curves of the freezing front obtained through the two layer neumann solution and finite element fe numerical model the comsol multiphysics fe simulator comsol 2017 was used to solve eq 1 to obtain the numerical solutions the soil porosity is 0 36 the thermal conductivity λ g and heat capacity cg of soil grain are 1 5 w m 1 c 1 and 800 j kg 1 c 1 respectively fig 2 a presents the calculated temperature profiles after 20 years of freezing for the two layer neumann solution the multi layer solution with different proportion ratios and the fe numerical solution the freezing depth was z n 1 9 65 m for the neumann solution while it was deeper ranging from 15 5 to 28 5 m for the multi layer solution this greater depth of ice penetration appears to be caused by the reduced amount of latent heat that was removed in the partially frozen region compared to the fully frozen region for the neumann solution as such the two layer neumann method underestimates the maximum depth of ice penetration as illustrated in fig 2a and fig 2b there are negligible variations among the solutions of 10 layer proportion ratio 0 6 100 layer proportion ratio 1 0 and 100 layer proportion ratio 0 8 and they match well with the simulations via the fe numerical method it can also be seen from fig 2a and fig 2b that a shallower penetration depth and slower penetration rate of the freezing front are presented when the domain is divided into more layers for the same proportion ratio furthermore for the same number of discretization layers a shallower penetration depth and slower penetration rate of the freezing front are also predicted when the proportion ratio decreases a small value of the proportion ratio means that the thinner layer will be discretized when closer to the freezing point tf region a rational reason for this result is that the finer discretization of the subzero temperature layers near the freezing point will capture the nearby significant drop in the unfrozen water content which leads to a much more accurate representation of the large amount of the latent heat released close to the freezing front however the finer discretization requires a high computational cost to maintain the high accuracy and reduce the computational cost for the current case each of the 10 layer proportion ratio 0 6 50 layer proportion ratio 0 8 and 100 layer proportion ratio 1 0 are comparable because each requires only a couple of seconds to complete by contrast the fe numerical method needs about a half minute when implemented with the same computational infrastructure briefly when the multi layer method is used for actual research benchmarking numerical codes for example the 100 layer proportion ratio 0 9 or more refined discretization would be preferred however the coarser discretization such as 10 layer proportion ratio 0 6 would be enough for quickly estimating the maximum freezing depth or analyzing the idealized system different shapes of the transient temperature profiles are also observed in fig 2a in the frozen zone both the neumann method and the multi layer method predict a nearly linear temperature profile in the region close to tf however the multi layer method exhibits a gradual temperature change this gradual temperature change at the phase boundary is due to the stable evolution of the thermal properties from layer to layer associated with the multi layer method which becomes progressively more smooth as the number of layers is increased 3 2 effects of different soil freezing functions different soil freezing functions may yield different shapes of thermal conductivity and diffusivity with respect to temperature as shown in fig b 1 and fig b 2 in appendix b this will affect the temperature profiles during the freeze thaw process in soils and permafrost following the freezing test with a freezing function of the anderson tice 1972 in section 3 1 another five commonly used freezing functions with reasonable parameters see fig a 1a and table a 1 in appendix a were examined by using the 100 layer method with a proportion ratio of 0 9 fig 3 presents the predicted profiles of the temperature liquid water content equivalent thermal conductivity thermal diffusivity and conductive heat flux after 20 years of freezing as well as the propagation of the freezing front which were highly impacted by the form of the freezing functions it can be seen in fig 3a that the maximum depth of ice penetration is about 15 5 m using the freezing curve proposed by anderson tice 1972 while this increases to 26 0 m with the soil freezing function presented by zhang et al 2017 the different profiles of unfrozen water content within the partially frozen region were generated in fig 3b by substituting the temperatures into the corresponding freezing curves because the thermal conductivity of solid ice is approximately four times larger than that of liquid water there is a somewhat mirrored shape relationship between the profiles of unfrozen water content in fig 3b and the profiles of soil equivalent thermal conductivity in fig 3c in the partially frozen region near the freezing front the substantial water ice phase change generated a spike in latent heat resulting in a peak in the apparent heat capacity see fig 4 and further caused a trough in the thermal diffusivity especially for the results of anderson tice 1972 vg clapeyron and zhang et al 2017 as shown in fig 3d the results in fig 3e illustrate that this excessive latent heat buffered heat transfer and yielded a similar reduction of the heat flux fig 3f shows that the rate of movement of the freezing front predicted by the form of anderson tice 1972 lags the other formulations of the freezing functions by a significant amount this lag increases with time and it may reach a large value when approaching the thermal steady state condition the maximum depth of the freezing front it can also be seen that the predicted depth of the freezing front is within the upper boundary underestimation values calculated by anderson tice 1972 model and lower boundary over estimation values calculated by zhang et al 2017 model for example at the end of 20 years of simulation the difference in the predicted freezing depth between the anderson tice 1972 and zhang et al 2017 models is up to 10 5 m these observations indicate that the temperature profiles intermediate thermal variables and the depth of the freezing front are highly impacted by the shape of the freezing curve especially for the long term predictions given the heterogeneity of soil properties it would be difficult to choose the most reasonable freezing function if there were scarce field laboratory observations for a specific site however the presentation of confidence intervals calculated from anderson tice 1972 model and zhang et al 2017 model and relevant parametric analyses would be helpful for the predictive understanding of the soil freezing process based on hypothetical scenarios fig 4 shows significant variations in the calculated profiles of soil apparent heat capacity c c s l f θ w t are observed after 20 years of freezing and their shapes are dominantly controlled by the first derivative of soil freezing functions see fig a 1b the apparent heat capacity c in eq 2 is conventionally named as a mass coefficient or damping coefficient term according to a general form of the partial derivative equation the abrupt changes in values of this term near the freezing front especially for zhang et al 2017 model vg clapeyron model and anderson tice 1972 model usually require substantial computation cost and might cause numerical oscillations if numerical method was used to solve the equations 3 3 effects of different thermal conductivities soil freezing behaviours can be affected by the variations of soil grain thermal properties most recent studies found thermal conductivity has a higher model sensitivity compared with heat capacity e g de bruin et al 2021 huang rudolph 2021 following the above findings different values of soil grain thermal conductivity i e λ g 1 0 1 5 and 2 0 w m 1 c 1 were comparatively analyzed based on the underestimation soil freezing function proposed by anderson tice 1972 and the overestimation soil freezing function proposed by zhang et al 2017 all other settings are kept the same as those in section 3 2 fig 5 presents the predicted profiles of the temperature liquid water content equivalent thermal conductivity thermal diffusivity and conductive heat flux after 20 years of freezing as well as the propagation of the freezing front which were significantly impacted by the different soil grain thermal conductivities fig 5a shows the freezing depth ranges from 13 84 to 17 31 m for anderson tice 1972 model and from 23 91 to 28 83 m for zhang et al 2017 model when soil grain thermal conductivity increases from 1 0 to 2 0 w m 1 c 1 as shown in fig s 5b 5c and 5d the profiles of unfrozen water content equivalent thermal conductivity and thermal diffusivity correspondingly shift downward similar to this pattern the magnitude of heat flux and the depth of freezing front increase with soil grain thermal conductivity as displayed in fig 5e and fig 5f it can also be seen from fig 5f that those variations caused by different thermal conductivity increase with simulation time indicating thermal conductivity significantly affects the accuracy of long term predictions 4 model limitations and future work a key limitation for the continual development of the proposed hybrid analytical numerical method is the availability of relevant exact analytical solutions upon which it is based although the finer discretization in the space of the dependent variables e g temperature spaced layer adapting for the shape of state variables e g thermal diffusivity could increase the solution s accuracy this optimization would require high computational effort as for its application to the soil freezing process there are several limitations from the governing eq 1 i it does not consider the heat convection contributed by pore water flow e g driven by the hydraulic gradient and thermal gradient that may be questionable if high liquid fluxes were anticipated in less dense coarser soil materials ii the saturated soil domain is assumed as a non deformable continuous porous media with isotropic constant total porosity that ignores the proportion change of each constituent caused by ice expansion and iii it handles water ice phase change in simplified equilibrium thermodynamics that requires further calibration the variations in soil porosity affect the amount proportion of liquid water and ice in the pore space see supplementary materials fig s1 and the shape of the unfrozen water content curve such as anderson tice 1972 model and thereby the required latent heat of fusion during phase transition whose effects were not comparably analyzed here in addition to collecting more laboratory field experimental data to validate the model developing a friendly graphical user interface for the approximate analytical solution would be helpful for testing numerical solutions and intuitively understanding the cryo subsurface the inclusion of variably saturated flow and more practical freeze thaw cycles would enable the model to be applied to more diverse cold region environments further research is underway to incorporate these processes and examine how they affect thermal regimes and relevant flow transport mechanisms in cryo hydrogeological systems 5 conclusions this study proposed a hybrid analytical numerical technique for solving one dimensional soil temperature profiles subjected to the unidirectional freezing or thawing process this solution scheme divides the partially frozen soil into multi layers with respect to temperatures indicating that each layer has temperature fixed location free boundaries and uniform thermal parameters this proposed hybrid analytical numerical scheme was tested through a comparison to a freezing test and its solution was in good agreement with the finite element numerical solution and the results of different forms of soil freezing functions were comparably studied the main findings and conclusions of this study can be drawn as follows 1 in comparison to neumann s two layer method the proposed multi layer method adapts well to the changes of unfrozen water content and thermal properties over a wide range of subzero temperatures 2 because neumann s two layer solution assumes a partially frozen region does not exist the release of latent heat was over calculated which resulted in an underestimation of the moving rate and maximum depth of the freezing front for the multi layer method the more layers with smaller proportion ratios thin layers nearby the freezing point used to discretize the domain the shallower and slower penetration of the freezing front 3 the profiles of temperature thermal conductivity and diffusivity heat flux and dynamics of the freezing front are highly impacted by the shape of the soil freezing curve the freezing curves developed by anderson tice 1972 and zhang et al 2017 could be used to estimate the upper boundary underestimation and lower boundary overestimation for predicting the depth of freezing front maximum depth of ice penetration respectively especially for running a permafrost relevant forecast model for a few to tens of years for example in order to obtain a temperature solution under thermal steady state by running the transient model for a long time to approximate a steady state condition 4 the shape of the unfrozen water content curve and the magnitude of soil grain thermal conductivity have a large impact on long term predictions of the freezing front s migration rate and penetration depth in summary the above hybrid analytical numerical solution scheme can capture the main relevant dynamics of temperature profiles for soil freezing and thawing processes if heat exchange occurs only due to conduction and pore water phase change the soil thermal properties are assumed to be only temperature dependent without taking into account the effect of water movement and the impact of the freeze induced deformation on soil structure although the conclusions above have certain limitations and may require further clarification they may assist in better understanding the thermal dynamics in permafrost glacial terrain and the shallow subsurface during the freeze and thaw processes credit authorship contribution statement xiang huang conceptualization methodology formal analysis visualization writing original draft writing review editing david l rudolph funding acquisition resources writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the authors would like to thank the global water futures gwf program for financial support through project funding and the natural sciences and engineering research council nserc for financial support through a discovery grant to d l rudolph xiang huang was also financially supported in part by the national natural science foundation of china 41702265 the authors appreciate valuable comments from four anonymous reviewers the associate editor and editor dr gabriele villarini which helped significantly improve this manuscript supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2022 104163 appendix c supplementary materials image application 1 appendix a unfrozen water content in freezing soils unfrozen water content refers to the amount of unfrozen water existing in soil pores at subzero temperature it is well recognized that the unfrozen water content drops sharply after the freezing point tf to a specified residual value over a wide temperature range i e from 50 to 0 c the relationship between temperature and unfrozen water content in frozen soils is usually defined as the unfrozen water characteristics curve uwcc the soil freezing characteristics curve sfcc or soil freezing functions which is a critical soil property for calculating heat and mass transport in frozen soils as well as frost heave and thaw settlement e g zhang michalowski 2015 tian et al 2019 tens of uwcc models expressions are available in the literature e g kurylyk watanabe 2013 hu et al 2020 and could be roughly categorized into two groups the first group incorporates an empirical relationship between the experimental results of unfrozen water content and subzero temperature the second group is based on the mathematical combination of the soil water characteristic function and the clapeyron equation where the subzero temperature is correlated to soil suction at the ice water interface under thermodynamic equilibrium here six commonly used uwcc models e g mckenzie et al 2007 ren vanapalli 2018 lu et al 2019 hu et al 2020 wen et al 2020 are described and evaluated among which the former four belong to the first empirical fitting group and the remaining two are within the mathematical combination group a 1 description of the uwcc models anderson tice 1972 found that the uwcc could be approximated by a simple power function of temperature as follows a 1 θ w ρ d ρ w α t η t t f θ 0 t t f where θ w is the volumetric fraction of unfrozen water content and θ0 corresponds to the mean volumetric water content during a thawing period or its initial value m3 m 3 ρ w and ρ d are the density of water and dry soil kg m 3 respectively α and η are soil characteristic fitting parameters tf is the freezing point of pore water c t is the soil temperature c this model assumes the unfrozen water is confined in the pores due to the adsorptive force and it has been widely used in cold region engineering practice applications e g xu et al 2010 tian et al 2019 because the unfrozen water content in soil drops toward an infinitesimally small amount as the subzero temperature decreases it thus might be unacceptable in mathematical or numerical calculations michalowski 1993 proposed an exponential function based on experimental tests from anderson tice 1972 that is a 2 θ w θ r e s θ 0 θ r e s e μ t t f t t f θ 0 t t f where μ is a soil characteristic fitting parameter and θ res is the residual unfrozen water content at some very low reference temperature this model was used for simulating frost heave and thaw settlement e g zhang michalowski 2015 more recently mckenzie et al 2007 presented a revised exponential relationship by exploiting the similarity in shape between the soil freezing function and soil water characteristic function e g lunardini 1991 which is given as follows a 3 θ w θ r e s θ 0 θ r e s e t t f γ 2 t t f θ 0 t t f where γ is a soil characteristic fitting parameter this revised exponential equation was subsequently written into the sutra ice for predicting hydrogeological regimes in permafrost regions under a warming climate e g mckenzie et al 2007 devoie 2021 in subsequent work zhang et al 2017 suggested another relationship between the volumetric unfrozen water content and subzero temperature based on four years of field observations which is expressed as a 4 θ w θ 0 1 t f t t f 273 15 ω t t f θ 0 t t f where ω is the only fitting parameter this model assumed all pore water was turned into ice if the soil temperature fell below 273 15 k and was shown to be convenient for numerical analysis of the coupled hydrothermal or thermomechanical processes in permafrost regions e g zhang et al 2017 lu et al 2019 since the above mentioned uwcc analytical models are based on empirical formulae fitted to lab field observations it is challenging to ensure their versatility for different kinds of soils some researchers e g nishimura et al 2009 kurylyk watanabe 2013 proposed a combination of the simplified clapeyron equation with the van genuchten soil water characteristic function vg model van genuchten 1980 yielding the vg clapeyron model for the unfrozen water content as below a 5 θ w θ r e s θ 0 θ r e s 1 α v g l f ρ w g t f t t f 273 15 n v g m v g t t f θ 0 t t f where α vg nvg and mvg are soil fitting parameters of the vg model this model considered the analogy between the soil characteristic function and soil freezing function and was used for simulating coupled thermal hydraulic behaviour in unsaturated freezing soils e g he et al 2020 huang et al 2022 alternatively when substituting the clapeyron equation into the fredlund and xing soil water characteristic function fx model fredlund xing 1994 azmatch et al 2012 successfully fitted the measured soil freezing data unfrozen water content vs subzero temperature for silt soils and developed the fx clapeyron model as below a 6 θ w θ 0 ln e l f α f x ρ w g t f t t f 273 15 n f x m f x t t f θ 0 t t f where α fx nfx and mfx are soil fitting parameters of the fx model e is the natural logarithmic constant ren vanapalli 2018 used this model to predict a resilient modulus of frozen saturated soils and the associated cryogenic suction by exploiting the similarity between freezing thawing and drying wetting processes in fact there are many other unfrozen water models such as the linear or nonlinear piecewise freezing curves within a specified temperature interval and models related to the distribution of pore size pore pressure void ratio the surface area of soil grains etc e g kurylyk watanabe 2013 lu et al 2019 however the formulation of these models can be either too simple or too complicated which makes them inconvenient for many practical applications more recently some researchers e g wen et al 2020 hu et al 2020 comparatively evaluated many different types of the uwcc and argued that it was difficult to propose a generalized formula suitable for all soils a 2 evaluation by laboratory observations to illustrate the differences among the above six uwcc models we evaluated their abilities to reproduce the unfrozen water content against the laboratory measurements the unfrozen water contents versus subzero temperatures for a typical freezing test of a silty clay sample collected from the qinghai tibetan plateau china wen et al 2012 lu et al 2019 fig a 1 presents a comparison of the calculated results for these six uwcc models the corresponding best fitted parameters listed in table a 1 were obtained by minimizing the sum of squares of the residuals the minimized root mean square error rmse describes the absolute differences between the calculated and measured values the shape of anderson tice 1972 is similar to fx clapeyron model the curve of zhang et al 2017 is pretty close to that of vg clapeyron according to the calculated values of the remse and pearson correlation coefficient the best fitting one is anderson tice 1972 model it can be seen that none of the six uwcc models can fully capture all features of the changes in volumetric unfrozen water content with temperatures especially for the rapidly decreasing shape of this relationship near tf due to the drastic water ice phase transition and the gradual stable tail residual water content far below tf according to the first derivative of these uwcc models with respect to temperature slope of the freezing functions in fig a 1b both the mckenzie et al 2007 and fx clapeyron models have the advantage of continuous differentiability and show high computational efficiency which are good for numerical stability but exhibit zero at the freezing point tf this means that the unfrozen water content gently changes continuously with subzero temperatures immediately close to the freezing point however these two fail to represent the practically observed phenomenon e g lunardini 1991 xu et al 2010 that the actual variation of the unfrozen water contents usually drops drastically discontinuously close to the freezing point appendix b thermal properties of freezing soils the thermal diffusivity equals thermal conductivity divided by the apparent heat capacity which is the sum of the bulk heat capacity and the latent heat of water ice phase change according to eq 1 the latent heat is linearly related to the first derivative of unfrozen water content as a function of the subzero temperature therefore before analyzing the relationship between thermal diffusivity and subzero temperature we should first examine the variations of bulk heat capacity and thermal conductivity with changing subzero temperatures the bulk equivalent volumetric heat capacity cs of frozen soil is conventionally calculated as a mixture of soil grains g water w and ice i e g michalowski 1993 xu et al 2010 b 1 c s k θ k ρ k c k where θ k ρ k and ck are the volumetric fraction m3 m 3 density kg m 3 and mass heat capacity j kg 1 c 1 of the kth constituent k g w i respectively with the heat capacity of ice ci 2100 j kg 1 c 1 and heat capacity of water cw 4180 j kg 1 c 1 the equivalent thermal conductivity of frozen soil depends on the thermal conductivities of its components soil grain λ g water λ w 0 56 and ice λ i 2 22 w m 1 c 1 their volumetric fractions and spatial distribution orientation of the medium constituents e g jumikis 1966 it has been recognized that the equivalent thermal conductivity of frozen soils is inversely related to the subzero temperature though monotonically varying this relationship can be more complicated depending on the arrangements of the ice soil structure and empirical fittings of a series of experimental measurements the expressions for calculating the equivalent thermal conductivity are diverse in the literature e g jumikis 1966 lunardini 1981 tian et al 2019 here four commonly used formulas are described and evaluated b 1 description of the thermal conductivity models if the components of frozen soil are arranged in parallel to the direction of heat flow its equivalent thermal conductivity can be given by the weighted arithmetic mean b 2 λ a m k λ k θ k where λ k is the conductivity and θ k is the volumetric content of the kth constituent this parallel arrangement is exact for calculating the bulk density and volumetric heat capacity of soils by contrast the series arrangements yield the equivalent thermal conductivity using the weighted harmonic mean b 3 λ h m k λ k 1 θ k 1 in reality the natural structure of frozen soil can be considered a mixture of the above two types of arrangements indicating that the equivalent thermal conductivity varies between these two bounds subsequently a third formula is proposed to calculate the equivalent thermal conductivity based on the weighted geometric mean b 4 λ g m k λ k θ k where the geometric mean of thermal conductivity λ gm was widely used in many frozen soil and permafrost studies e g zhang michalowski 2015 he et al 2020 on the other hand by assuming randomly distributed constituents woodside messmer 1961 proposed a weighted square root mean of thermal conductivity which was written into a numerical model by mottaghy rath 2006 considering a more definite physical meaning than the geometric mean as below b 5 λ s r m k θ k λ k 2 b 2 comparison of thermal conductivity and diffusivity for different calculation methods on the basis of the best fitted uwcc models in fig a 1 and the thermal conductivities of all constituents that form the soil e g water ice and soil grains solutions for the equivalent thermal conductivities and diffusivities across the whole freezing or thawing process can be generated fig b 1 and fig b 2 present the equivalent thermal conductivity and diffusivity as a function of temperature using four different approaches respectively it can be seen that the equivalent thermal conductivities and diffusivities calculated by the geometric mean and the square root mean are somewhat close and they both lie between the upper bound by the arithmetic mean and the lower bound by the harmonic mean method compared with other uwcc models the vg clapeyron model and zhang et al 2017 model yield a sharp break of the equivalent thermal conductivities and diffusivities at temperatures immediately below the freezing point tf this behaviour can be attributed to the sudden decrease of unfrozen water content fig a 1a and its corresponding steep slope with respect to temperature fig a 1b it can be seen from the definition of the equivalent heat capacity cs θ g ρ g cg θ i ρ i ci θ w ρ w cw and apparent heat capacity c c s l f θ w t that the shape of equivalent heat capacity is similar to that of the uwcc while the shape of the apparent heat capacity is similar to that of the first derivative of the uwcc collectively the above performance evaluation of the different uwcc models and thermal conductivity calculation methods reflect the fact that i thermal properties of frozen soils are nonlinearly related to subzero temperatures and particularly exhibit a significant variation close to the freezing point and ii different uwcc models result in different characteristic curves of thermal diffusivities which affect the heat transfer process of frozen soils specifically speaking both the mckenzie et al 2007 and fx clapeyron models have the advantage of continuous differentiability but fail to represent the actual rapid variation of the unfrozen water contents at the freezing point for calculating the equivalent thermal conductivity and diffusivity of soil composite the vg clapeyron model and zhang et al 2017 model yield a sharp break at a temperature close to the freezing point 
184,classical molecular dynamics md simulations were carried out to analyze the diffusion of saltwater in aquifers at a salinity of 3 5 wt and temperatures between 5 and 50 c porous systems were built from the quartz stable alpha phase to represent typical compositions and structures reported for aquifer surfaces the spc e model was used to describe the interactions between water molecules in the system while the quartz intramolecular bonds were characterized through a buckingham type potential it was demonstrated from md trajectories that the diffusivity in small pores of both water molecules and nacl ions depends strongly on the crystallographic orientation of quartz surfaces exposed to the quartz saltwater interface the three most stable quartz surfaces favor the diffusion of na over cl in confinement principally due to strong nonbonded interactions between chloride and silicon atoms with partial positive charges that remain exposed at surface terminations the exposed quartz surfaces also determined the structure of confined water and the distribution of ions along the normal direction of the pore surfaces the results reported in this study provide a molecular scale description of the diffusive transport of seawater through quartz pores which represents a potential scenario for seawater intrusion in coastal aquifers graphical abstract image graphical abstract keywords seawater intrusion coastal aquifer molecular dynamics saline groundwater 1 introduction salinity intrusion in aquifers is currently a topic of interest among scientific communities principally due to unprecedented earth climate scenarios that have intensified the problem for coastal communities changes in the temperature of the earth and precipitation patterns glacial thaw sea level rise and groundwater well overexploitation are some of the events that have caused the deterioration of groundwater resources through saline intrusion rasmussen et al 2013 ferguson and gleeson 2012 paul et al 2019 climate change has become a factor that has amplified all the phenomena leading to seawater intrusion and depletion of groundwater resources in coastal aquifers according to the noaa global climate report published in 2020 the overall temperature of the earth has risen in 0 18 c per decade since 1981 with 2019 being the second warmest year in recorded history with a departure from an average of 0 95 c noaa national centers for environmental information 2020 this unexpected rise in temperature results in the thermal expansion of the oceans glacial melting and rises in the global mean sea level which is predicted by the international panel of climate change ipcc to reach values in the order of 15 mm year by 2100 much higher than the 3 6 mm year measured between 2006 and 2015 portner et al 2019 this phenomenon pushes the freshwater sweater interface zone of dispersion inland leading to salinization of underground water resources as climate change intensifies as a result of natural and human activities hardy 2003 the climate forecast predicts the issue will worsen in the next decades portner et al 2019 temperature departures from average in climate change scenarios will impact the precipitation patterns the glacier phase transitions as well as the demand for freshwater for crops and human consumption hardy 2003 xiao et al 2020 haddeland et al 2014 the first two phenomena affect the global mean sea level whereas the latter affects the use of groundwater resources by coastal communities previous studies consider the over extraction of groundwater to be more influential in the saltwater intrusion process than the sea level rise ferguson and gleeson 2012 although other studies have shown that the combined effect of sea level rise and over pumping of wells results in a dispersion zone deeper into the inland abd elhamid and javadi 2011 therefore solutions and countermeasures have been proposed to minimize the impact of climate change and over pumping on the quality of groundwater stored in coastal aquifers artificial recharge or freshwater injection into the well kallioras et al 2013 mahesha 1996 armanuos et al 2019 saltwater extraction from the dispersion zone bear et al 1999 sang uk et al 2012 sherif and hamza 2001 and underground physical barriers or walls armanuos et al 2019 kallioras et al 2013 are often used as countermeasures to prevent salinization of coastal aquifers all these techniques are considered direct methods to avoid seawater intrusion in coastal aquifers conversely computational modeling techniques are often classified as indirect prevention methods kallioras et al 2013 as they provide a theoretical evaluation of groundwater wells evolution that complements all prevention correction methods described above kim and yang 2018 abarca et al 2006 abd elhamid 2016 however the versatility of computer models allows not only characterizing prevention methods besides a complete qualitative understating of the factors that govern the transport of pollutants under different conditions may be also achieved bear et al 1999 which may provide the fundamentals for the development of effective countermeasures capable of preventing seawater intrusion in coastal aquifers most of the mathematical models employed to characterize the seawater intrusion are macroscopic they can capture the most relevant transport conditions that are known to affect the intrusion process such as piezometric head density viscosity porosity hydraulic gradient sea level rise among others voss 1984 sherif et al 1988 tsai and kou 1998 chun et al 2018 despite the vast amount of computational work related to pollutant transport in aquifers computational efforts seem to overlook the modeling of the intrusion process at a nanoscale level a molecular description of underground sweater diffusion captures the main characteristics of subsurface materials and fluids as explicit atomistic constructions instead of simple model parameters classical molecular dynamics simulations have been used to characterize pure and saltwater at different concentrations through its structure and dynamic behavior ghaffari and rahbar kelishami 2013 chowdhuri and chandra 2001 the models have shown excellent agreement with experimental evidence in transport properties furthermore molecular dynamics simulations have been used to study the adsorption and diffusion phenomena of confined pure water in ceramic pores marry et al 2008 mccaughan et al 2013 chen and cheng 2010 skelton et al 2011 recently saltwater and electrolyte solutions interacting with quartz surfaces have been also analyzed through molecular dynamics simulations quezada et al 2017 kroutil et al 2015 however none of them has focused on the diffusive transport properties of chloride and sodium ions in aquifers in a seawater intrusion scenario in this work we use classical molecular dynamics simulations to characterize the distribution and diffusion of salt ions in pores made of quartz at a seawater concentration of 3 5 wt the effect of the pore surface structure and temperature on the dynamic behavior of nacl ions at a fixed concentration is analyzed the results reported in this work provide a deep look into the ionic transportation through pores into coastal aquifers since it includes pore structure variables not included in common solute transport and finite element models furthermore the atomistic molecular description of the intrusion phenomenon offers a detailed characterization that allows taking advantage of the intrinsic characteristics of the soil and subsurface materials to develop proper prevention methods for seawater intrusion in aquifers 2 methods 2 1 systems configuration saltwater systems were built at a constant salinity of 3 5 wt and a density of 1 023 g cm3 which are known concentration and thermodynamic properties for standard seawater safarov et al 2009a 2009b in order to build the pore systems bulk quartz was cut at four different crystallographic orientations 100 110 101 and 001 fig 1 creating slabs with at least 4 atomic layers and a vacuum of 15 å along the z axis the size of the pore 15 å represents the typical dimensions of intercrystalline pores kashif et al 2019 the thickness of the slab was defined in such a way that the surface termination was the same at the top and bottom of the slit to preserve identical conditions for water molecules and salt ions which will interact with the top and bottom surfaces of the aquifer the configuration files for the cleaved surfaces are found in the supporting information once the surfaces were cleaved the salinity and density of the saltwater were achieved by placing 18 nacl units and 1611 h2o molecules occupying the 4 88 104 å3 of confined volume between the two quartz surfaces in a periodic cell with a slab located at the bottom the confined volume occupied by seawater is calculated from the surface area and the unoccupied vertical length which corresponds to the vertical distance from the topmost atoms of the surface and the upper edge of the cell see fig s1 atoms belonging to the central plane of the slab were forced to keep their initial positions frozen to avoid parallel diffusion of the whole slab on the xy plane which may lead to erroneous estimations of the parallel diffusivity of the liquid phase in contact with the solid surface a bulk system was also built with 1432 water molecules and 12 nacl units placed in a cubic box of 35 13 å edge length which represents the same density and salinity of confined systems the purpose of building a bulk system is to validate the computational methods through calculation of seawater properties and to evaluate the real effect of the confinement on the diffusion of seawater 2 2 computational methods molecular dynamics simulations were carried out using the dlpoly classic software smith 2014 water molecules were modeled using the spc e water model berendsen et al 1987 setting each water molecule a rigid body with fixed bond lengths ro h 1 00 å and bond angles θho h 109 47 intermolecular interactions are described through the lennard jones lj pair potential 1 u r ij 4 ε ij σ ij r ij 12 σ ij r ij 6 the lj parameters were taken from the original publication of the spc e water model as well as the charges for oxygen and hydrogen which are set to 0 8476 and 0 4238 respectively these values were developed so that lennard jones parameters for hydrogen can be set to zero and mixing rules involving hydrogen atoms are avoided lennard jones parameters for sodium and chloride ions are taken from chowdhuri and chandra 2001 while the salt water interaction parameters were obtained from lorentz berthelot mixing rules arithmetic averages for σ and geometric averages for ε all lennard jones parameters are reported in table s1 supporting information the internal forces between oxygen and silicon atoms in quartz are described through the bks potential derived and parametrized by van beest van beest et al 1990 from the typical buckingham functional form 2 u r ij a exp r ij ρ c r ij 6 the set of parameters are found in table s2 supporting information the electrostatic interactions between all atoms types are computed using the ewald summation method allen and tildesley 2017 ewald 1921 kolafa and perram 1992 which accurately accounts for long range electrostatic interactions in periodic systems the ewald summation parameters corresponding to the real space cutoff rcut the convergence parameter α and the reciprocal space vector kmax are estimated by dlpoly with a precision of 1 10 6 the charges of silicon and oxygen atoms in the bks potential are set to 2 4 and 1 2 respectively which guarantees the charge neutrality if the stoichiometric ratio is kept however the charge neutrality of the system was not always preserved in favor of the surface termination consistency top and bottom surfaces of the pore therefore fuchs correction for charged systems fuchs and fowler 1935 leslie and gillan 1985 was included in the ewald sum expression of the molecular dynamics simulations saltwater quartz intermolecular energies are described through the lennard jones potential although the sio2 is internally modeled through the bks potential the set of lennard jones parameters for silicon and oxygen were taken from mccaughan et al 2013 and used to derive all lj parameters for the sio2 saltwater interface through the lorentz berthelot mixing rules as described above parameters are found in table s1 molecular dynamics simulations were carried out using an npt ensemble using hoover nose thermostat hoover 1985 and barostat with 0 5 ps of relaxation time in each case the external pressure was set to zero while simulations were performed at ten different temperatures from 5 to 50 c 5 c steps a total of 3 ns was simulated with 1 ns of equilibration time and 1 fs timestep for the integration of motion equations through the verlet leapfrog algorithm the shake algorithm ryckaert et al 1977 was used to constrain bonds and angles in the rigid spc e water model a cutoff radio for nonbonded interatomic forces is set to 8 å which is more than half of the pore size built for the aquifer slit models 15 å cutoffs for nonbonded interactions in the order 8 å has been used in water and protein systems without affecting accuracy of the simulations garemyr and elofsson 1999 levitt et al 1997 the diffusion coefficients of water molecules and nacl ions were calculated from the mean squared displacement msd the msd was computed for the entire trajectory followed by a least squares linear regression to determine diffusion coefficient according to the einstein relation 3 d n 1 2 n lim t r t r 0 2 t where n defines the number of dimensions of the diffusion process for bulk diffusion n 3 while for surface diffusion on the xy planes parallel to the quartz surface n 2 the quantity at the numerator corresponds to the average of the position deviation from a reference position computed over all particles which is the definition of msd on the other hand t represents the total simulation time 3 ns in which the linearity of the msd is kept 3 results and discussion 3 1 diffusion of saltwater in quartz pores after every forcefield parameter was defined and the molecular dynamics trajectories were obtained at different temperatures the diffusion coefficients for water molecules were calculated from the mean squared displacement using the einstein relation eq 3 the diffusivity of water in a 3 5 wt aqueous solution of nacl is analyzed as a function of temperature and for four different quartz surfaces fig 1 fig 2 shows the diffusion coefficients of water molecules within quartz pores with different surface topologies the bulk diffusion of water molecules in saltwater is included for comparison purposes all diffusion coefficients for confined water correspond to parallel diffusion coefficients where only the x and y components of displacement are considered for the msd calculation and n takes de value of 2 in eq 3 on the other hand the bulk diffusion is calculated in a three dimensional space considering all components of the displacement and making n 3 in eq 3 the black curve in fig 2 demonstrates that the bulk diffusion coefficients of water molecules as a function of temperature are in strong agreement with the experimental values reported for pure water systems holz et al 2000 these results are expected since the spc e parameterization is known for its good representation of structural and dynamics properties for pure water berendsen et al 1987 the dynamic behavior of water molecules validates the selection of the spc e water model and the cutoff for nonbonding interactions 8 å additionally fig 2 proves that water molecules diffuse faster in bulk than in confined environments as the black curve lies above all other curves this behavior is anticipated due to the partial charges exposed in all quartz surfaces that favor strong coulomb interactions between water molecules and the surfaces slowing down the water diffusion furthermore exposed oxygen atoms at the top layer of the bottom surface and the bottom layer of the top surface allow strong hydrogen bonding between water and both surfaces such as the case of the quartz 110 fig 1 the pink line in fig 2 corresponding to the water diffusion in the quartz 101 pore lies very close to the bulk diffusion this behavior is explained from the topology of the quartz 101 surface which is the smoothest of all quartz surfaces tested in this study with positive silicon and negative oxygen ions localized at the interface scheme of quartz 101 in fig 1 conversely the diffusion of water molecules in the quartz 100 pore drops significantly due to the strong roughness of the surface and positively charged silicon atoms localized alone at the interface the silicon positive charges pointing towards the interface attract negatively charged oxygen atoms of the water molecule to form strong electrostatic interactions and slowing down diffusion although quartz oxygen is absent at the quartz 100 saltwater interface to favor hydrogen bonding this absence also reduces the o quartz o water repulsion at the interface therefore the strong coulomb interactions between si quartz and o water are responsible for the low mobility of water molecules except for the diffusion in quartz 001 all profiles present a slight exponential behavior as a function of temperature considering that fig 2 presents a logarithmic y axis the diffusion of water molecules in the quartz 001 pore exhibits a noteworthy behavior the red curve drops two orders of magnitude compared to the bulk diffusion from 10 5 to 10 7 cm2 s while the diffusion profile deviates from the exponential trend linear with the logarithmic axis to exhibit a non linear behavior with a tendency to increase with temperature the low diffusivity is related to the characteristic porosity of the quartz 001 surface and water penetration whereas the lack of linearity is a consequence of the negligible effect of temperature on the amount of water molecules penetrating the surface fig 1 shows a large pore for the quartz 001 surface in its top view the view along the 100 does not portray the most interesting topology features of this surface which are captured in fig 3 with a view along the 110 direction fig 3 shows the top view and a view along the 110 direction of the quartz 001 surface the top view presents a water molecule model with its dimensions in contrast with the surface pore dimensions the top view fig 3a shows a large pore 3 6 å in the 001 surface which can trap water molecules with van der waals radii in the order of 2 8 å the small vdw radii of the water molecule let it diffuse towards the inner layers of the quartz which is less probable to occur in the other quartz surfaces with smaller pore sizes fig 1 water molecules trapped in the subsurface will not diffuse as fast as they do in a homogeneous liquid phase i e near the center of the quartz slit this explains the slow parallel diffusion coefficients obtained when water molecules are confined by quartz 001 surfaces moreover the view along 110 direction fig 3b exhibits a remarkable roughness of the quartz 001 surface with a topology depicting the formation of wells as represented by the schemes in fig 3 water molecules may easily get trapped in these wells finding themselves in a state where a significant potential energy barrier must be overcome to return to the liquid phase the penetration of water molecules in the direction of the bulk quartz is demonstrated by the z density profiles reported in fig 4 a the green area corresponding to the zones of water location with lower density overlaps with the orange diagonal lines defining the presence of silicon atoms belonging to quartz this overlap is significant although the water molecules do not cross through the subsurface to the deeper layers this feature is not seen in the remaining quartz surfaces to this extent the interaction between water molecules and the quartz 101 results in a small overlap between oxygen from water and silicon from quartz fig 4b however it is worth noting that the highest water peaks are found between the central plateau and the peak overlapping the silicon region these two peaks represent the highest density and are not in contact with the quartz surface which gives an idea about the remarked layered structure taken by the water with this pore structure the water density drops to zero at 9 5 å and at 22 8 å which leaves the highest density peak isolated from the quartz surface this highly localized water structure provides clues for the fast parallel diffusion of water confined by quartz 101 which is almost the same magnitude of bulk diffusion between 5 and 50 c as seen in fig 2 the highest density layer is bounded by the low density central plateau and a vacuum layer providing a small energy barrier for lateral diffusion the z density profiles of water in the quartz 100 pore exhibit a very weak interaction between water molecules and the surface fig 4c the water peaks limiting with the surface are 1 5 å away from the silicon peak which is the closest quartz 100 atom type to the surface water interface moreover the water density drops to zero when approaching the silicon peak which proves the absence of water penetration into the quartz 100 surface on the other hand the water diffusion in the quartz 110 pore is relatively fast this pore surface has the peculiarity of having oxygen termination unless the other studied quartz surfaces in this work fig 1 also it does not present a high porosity therefore significant water penetration is not seen fig 4d shows only a very low water density overlapping the surface silicon peak however the z density profiles for water in quartz 101 and 110 share a similarity the water densities for both pore structures drop below 0 023 molecules å3 in the center of the pore conversely the water density at the center of the quartz 100 is 0 037 molecules å3 fig 4c and the density at the center of the quartz 001 pore even ascends to 0 048 molecules å3 fig 4a all simulations are carried out using an npt ensemble and therefore the volume adjusts during the initial steps to find the equilibrium density thus the equilibrium local densities for water at the center of quartz 001 and 100 are found above the experimental density of bulk water at 25 c 1 g cm3 or 0 034 molecules å3 these localized high densities are commonly seen in layered structures of confined water karamzadeh and mozaffari 2018 wu et al 2019 the compactness associated to high densities of the aqueous phases within these pores contributes to their slow parallel diffusion the presence of a highly dense water phase inside quartz 001 and 100 pores is also supported by the radial distribution functions rdf plotted in fig s2a and s2c see fig s2 supporting information regardless of the temperature the rdf plots exhibit a second peak the second peak for water in quartz 001 is more prominent and located at 5 6 å whereas the second peak for quartz 100 is dimmer and located at 6 1 å second peaks are barely distinguished for water confined by quartz 101 and 110 fig s2b and s2d which results from the low density near the center of the pore and the consequential lack of a packed structure radial distribution functions plotted in fig s2 proved that the water structure does not depend on temperature in the 5 45 c range furthermore the bulk pure water structure is not affected by the salinity at 25 c as the rdf curves for bulk pure water and bulk saltwater are superimposed fig s2 the mobility and diffusion of water are correlated to its density and structure in confined systems on one hand the denser and more structured water phase the lower the mobility of water molecules on the other hand the less dense and less structured water molecules in the center of a confined system the higher their diffusivity however the dynamic behavior of the water molecules in the confined salt water system does not necessarily correlate with the behavior of na and cl ions the differences in surface chemistries will lead to a wide range of possibilities for ions distribution and diffusion due to different interactions with both surfaces and the aqueous phase the analysis of the ions dynamics is essential to understand the physical chemical phenomena governing the saltwater intrusion in aquifers and the salination of fresh water in wells 4 diffusion of nacl ions in quartz pores the diffusion of the na and cl ions were computed from the mean squared displacement and the einstein relation and reported in fig 5 almost all cases show a slight dependence on temperature increasing diffusivity as the temperature increases although not as prominent as in the case of water molecules for both na and cl the diffusion was higher in bulk than in any other pore regardless of the pore composition or the structure however the diffusion of na in quartz 101 was the only one that reached coefficients near bulk levels even overcoming the bulk diffusion at 25 c this surface also leads to fast diffusion of water molecules as stated above and reported in fig 2 this behavior is related to the smoothness and balanced charge of the top layer of the quartz 101 surface which diminishes steric and electrostatic interactions between the surface and the constituents of the saltwater on the other hand the salt cation na diffuses very slow in the quartz 110 surface as demonstrated by the orange data set in fig 5a this particular behavior is observed because the 110 surface exposes oxygen atoms with partial negative charges at the quartz saltwater interface the electrostatic interaction between those exposed oxygens and the sodium cations is so strong that sodium atoms even access the quartz 110 subsurface as seen in fig 6 d these oxygen atoms not only attract sodium ions but they also repel cl displacing them toward less dense central saltwater regions figs 4d and 6d where higher diffusivity is found therefore the chloride ions find the highest diffusivity in confinement with the quartz 110 with coefficients even approaching 1 10 5 cm2 s at 50 c which are bulk level coefficients for chloride ions orange data set in fig 5b the diffusion coefficients of na in quartz 001 lie between 5 10 7 and 2 10 6 cm2 s red line fig 5a which is expected for the cations located in the central zone of the pore fig 6a where the water density is not too low compared to the water density at the center of quartz 101 or 110 as shown in fig 4 conversely the same surface induces a very slow diffusivity for cl ions with diffusion coefficients as low as 1 10 8 fig 5b much lower than water molecules within the same surfaces where the water found the lowest diffusivity due to the intrusion of water molecules through slab nanopores and into the quartz subsurface the same analysis applies for the chloride anions since their penetration inside the subsurface is also demonstrated by the z density profile of cl in fig 6a this chloride infiltration inside the quartz 001 surface disrupts the temperature dependence of the diffusion coefficient since the thermally activated diffusion hops lose the sensitivity to kinetic variations as they abandon the liquid phase conversely the diffusion hops start being defined by larger activation energies in the solid quartz matrix where larger temperature changes are required to observe significant variations in diffusion coefficients this kind of infiltration is not seen for any ion in quartz 101 fig 6b and quartz 100 fig 6c in these pores the ions stay away from the quartz saltwater interface and the diffusion coefficients are determined by the saltwater density and temperature therefore the overall diffusivity of nacl ions in quartz 101 and quartz 100 are slower than in bulk but faster than in highly interacting systems it is worth noting that all density profiles in figs 4 and 6 present a high symmetry respect to the center of the pore this feature is attributed to the identical termination of both surfaces top and bottom however as mentioned above the consistency in surface terminations was only achieved by unbalancing the net charge of surfaces although the nonzero net charge was compensated through the fuchs correction fuchs and fowler 1935 leslie and gillan 1985 the high correlation between the surface termination and the preferred location of ions inside the pores demonstrate that the local charge concentration at the surface and the surface topology determine the main electrostatic and steric interactions and consequently the density profiles however the net charge of the cell per surface area also shows a direct correlation with the chloride interaction with surfaces as seen in the table s3 the quartz 001 presents the highest positive charge per surface area followed by quartz 100 and quartz 101 the inverse trend in cl diffusion nevertheless the effect is the net charge is not conclusive since the dynamic behavior of neutral water molecules is demonstrated to be mostly influenced by the topology porosity roughness of the surface which is expected to affect ionic interactions and diffusion from these results it can be concluded that the diffusion of na and cl ions in quartz pores depends individually on the structure of the pore surfaces and the exposed quartz atoms at the interface in bulk na and cl exhibit diffusion coefficients within the same order of magnitude with cl diffusivities slightly higher at most of the temperatures in agreement with experimental results yuan hui and gregory 1974 unlike the behavior in an open system the bi dimensional diffusion coefficients of na and cl ions through a pore may differ from each other by a few orders of magnitude depending on the crystallographic planes of the pore surfaces all surfaces here analyzed introduce a strong interaction with either chloride or sodium but the strength of these interactions is not the same for both ions simultaneously it can be noticed from fig 5 that for confined systems there are larger gaps between diffusion coefficients of na and cl in a given pore compared to the bulk as seen from lines of the same color in fig 5a and 5b the bulk diffusion trend where the cl diffuses slightly faster than na is disrupted in confinement for instance the chloride diffusivity in quartz 001 is much lower than sodium diffusivity because of the chloride intrusion into the subsurface discussed above furthermore quartz 101 and 100 pink and blue data sets in fig 5a and 5b also invert the bulk trend allowing sodium ions to reach higher diffusivities than chloride within the pore conversely quartz 110 allows a higher diffusivity of cl as in bulk but the gap between na and cl diffusivities becomes wider due to strong electrostatic interactions between na and the surface as can be inferred the simultaneous suppression of na and cl diffusivities through strong adsorption on surfaces is unlikely unless the pore stabilizes different surfaces leading to the strong interactions of both ions with different surface structures within the same pore the surface structure of pores and consequently the silicon and oxygen atoms exposed at the interface determine the diffusivity of ions through specific interactions but this leads to opposite dynamic behavior in na and cl although the simulations performed in this study were set up to have a balanced concentration of na and cl ions the obtained diffusivities can be used to predict the relative concentrations of both ions na cl ratio by the time they reach an aquifer assuming the transport is predominantly diffusive and the pore stabilizes the same type of surface thus considering the 001 is the energetically most stable surface for alpha quartz de leeuw et al 1999 it is fair to assume that saltwater intruding aquifers through quartz pores may lead to higher na cl concentration ratios in groundwater as the diffusivity of na is larger than that of cl in quartz 001 most of the chloride diffusing toward a freshwater well may get stuck inside quartz 001 nanopores on their way to the underground freshwater storage however seawater intrusion properties have been widely characterized by low na cl ratios 1 while high na cl ratios in aquifers are attributed to anthropogenic sources such as fertilizers or residential wastewater moujabber et al 2006 the simulation conditions implemented in this study represent the salinity of seawater and one of the ceramic materials typically found in coastal soils cao et al 2016 nevertheless the pore size used in this study lies within the category of nanopores which is dimensionally closer to intercrystalline pores with throat radios below 6 nm kashif et al 2019 than to aquifer pores commonly measured in the order of micrometers therefore saltwater reaching the aquifers from brine storages hu et al 2018 keating et al 2013 through intercrystalline diffusion mechanisms is the closest phenomenological scenario represented by these simulations since md simulations do not consider anthropogenic sources the obtained diffusivities dna dcl for the most stable surface suggest concentration properties that oppose experimental observations as the ratio in diffusivities relates to the ratio of concentrations at distant aquifer this conflicting outcome can be explained from two different perspectives the first is that less stable quartz surfaces are exposed at coastal rocks such as the quartz 110 which stabilizes dangling oxygen atoms at the water rock interface that strongly interact with sodium cations quartz 110 is the least stable of all four surfaces here studied but it can be stabilized under certain conditions such as bent or curved quartz crystals pereira et al 2015 the second explanation is that other common carbonate ceramic materials such as calcite aragonite or dolomite are found at a greater proportion than quartz in coastal aquifers daniele et al 2013 stable surfaces in these materials may favor cl diffusion over na providing the reason for low na cl ratios in aquifers as a result of seawater intrusion more ionic carbonate materials such as calcite also lead to higher ionic exchange that results in the presence of carbonate bicarbonate and calcium ions in groundwaters daniele et al 2013 the dissolution of these electrolytes may disrupt the ratio between chloride and carbonates carbonate bicarbonate known as simpson ratio moujabber et al 2006 sudaryanto and naily 2018 todd and mays 2004 which has been established as a criterion for the identification of seawater intrusion high simpson ratios are considered as a fingerprint of seawater intrusion in groundwater although the simpson ratio is much higher in seawater than in contaminated groundwater moujabber et al 2006 which may be a result of ionic exchanges in any case more simulations are needed to prove either of these two hypotheses yet molecular dynamics simulations have shown that higher quartz concentrations in rock compositions may disrupt diffusion patterns for seawater intrusion since the most stable quartz surface favors na diffusion over cl the analysis of molecular dynamics trajectories also characterizes the possible formation of nacl clusters inside the pore as a result of electrostatic repulsions from the pore surface and ions accumulation near the pore center radial distribution functions rdf plotted in fig 7 demonstrate that the height of the first peak depends on the crystallographic planes exposed on pore surfaces the first peak of all rdfs is located at 2 90 å and the highest intensities are found for 101 and 100 surfaces of quartz these peaks are much higher than the first rdf peak for nacl in bulk water this evidences that a strong na cl interaction inside these pores may lead to a possible formation of cluster like structures as a result of confinement considering the nacl bond length in the gas phase clusters and crystals range between 2 36 and 2 79 å garcía et al 2019 the possible ionic cluster formation in confinement has been predicted before through the analysis of single particle distributions density profiles computed from molecular dynamics trajectories nicholson and quirke 2003 thus the high 101 and 100 peaks in fig 7 are correlated with the z density profiles in the fig 6b and 6c where the chloride ions are found far from the surface trapping the sodium ions located in the middle of the pore this feature for instance is not seen in the quartz 001 surface where cl ions penetrate the surface and therefore interact with less strength with the na ions in the center as discussed above this is evidenced in fig 7 by the low height of the first peak corresponding to the quartz 001 surface red peak at 2 90 å this peak even vanishes at 25 c fig 7b and it is very low at 5 and 45 c this behavior suggests that strong interactions between most of the chloride ions and the quartz 001 surface hinder the possible formation of na cl cluster like structures in the middle of the quartz 001 pore furthermore na and cl ions interact very weakly within the quartz 110 pore the oxygen terminated surface interacting very strong with chloride breaks apart any attempt of ionic aggregation near the center of the pore this is supported by the flatness of the orange peaks in the radial distribution functions reported in fig 8 nevertheless the low energetic stability of the quartz 110 surface makes this scenario less probable 5 conclusions in summary molecular dynamics simulations were performed to gain a deep understanding of the diffusion and interaction phenomena of seawater in quartz pores at a molecular level simulations showed that the diffusivities of both water molecules and nacl ions are correlated to the crystallographic orientation of the quartz surfaces the most stable surfaces induce higher diffusivity of sodium than chloride ions because of the particular topology of the quartz 001 and 101 that expose positively charged silicon atoms that favor the strong adsorption of chloride ions additionally the nano porosity of the quartz 001 surface allows penetration of chloride ions into the subsurface reducing the planar diffusion coefficients to orders of magnitude as low as 10 8 cm2 s the md results herein reported suggest a high na cl in aquifers upon seawater intrusion which contradicts experimental evidence the differences are mainly attributed to the predominant presence of carbonate materials in most coastal aquifers that offer strong sodium carbonate interactions the results herein reported provide a theoretical basis for understanding the seawater intrusion phenomena from a molecular perspective this computational approach complements other experimental and modeling efforts developed through decades towards improving the quality of groundwater resources supporting information supporting information si includes lennard jones parameters for van der waals interactions and parameters for the bks potential describing the bonding interactions dimensions and charges of all the quartz surfaces are reported the surface dimensions data is supported by a representation of the periodic surface cell radial distribution functions for water molecules in confinement and bulk are also reported in the si configuration files of every quartz surface are included in the si credit authorship contribution statement juan c burgos conceptualization methodology validation investigation formal analysis writing original draft writing review editing edgar quiñones bolaños visualization supervision writing review editing m ziad saghir visualization supervision writing review editing resources mehrab mehrvar visualization conceptualization investigation methodology resources formal analysis supervision writing review editing project administration funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the financial support of the canadian queen elizabeth ii diamond jubilee scholarship program qes ryerson university faculty of engineering and architectural science dean s research fund and universidad de cartagena is greatly appreciated the authors would also like to thank compute canada for providing access to its computational resources 
184,classical molecular dynamics md simulations were carried out to analyze the diffusion of saltwater in aquifers at a salinity of 3 5 wt and temperatures between 5 and 50 c porous systems were built from the quartz stable alpha phase to represent typical compositions and structures reported for aquifer surfaces the spc e model was used to describe the interactions between water molecules in the system while the quartz intramolecular bonds were characterized through a buckingham type potential it was demonstrated from md trajectories that the diffusivity in small pores of both water molecules and nacl ions depends strongly on the crystallographic orientation of quartz surfaces exposed to the quartz saltwater interface the three most stable quartz surfaces favor the diffusion of na over cl in confinement principally due to strong nonbonded interactions between chloride and silicon atoms with partial positive charges that remain exposed at surface terminations the exposed quartz surfaces also determined the structure of confined water and the distribution of ions along the normal direction of the pore surfaces the results reported in this study provide a molecular scale description of the diffusive transport of seawater through quartz pores which represents a potential scenario for seawater intrusion in coastal aquifers graphical abstract image graphical abstract keywords seawater intrusion coastal aquifer molecular dynamics saline groundwater 1 introduction salinity intrusion in aquifers is currently a topic of interest among scientific communities principally due to unprecedented earth climate scenarios that have intensified the problem for coastal communities changes in the temperature of the earth and precipitation patterns glacial thaw sea level rise and groundwater well overexploitation are some of the events that have caused the deterioration of groundwater resources through saline intrusion rasmussen et al 2013 ferguson and gleeson 2012 paul et al 2019 climate change has become a factor that has amplified all the phenomena leading to seawater intrusion and depletion of groundwater resources in coastal aquifers according to the noaa global climate report published in 2020 the overall temperature of the earth has risen in 0 18 c per decade since 1981 with 2019 being the second warmest year in recorded history with a departure from an average of 0 95 c noaa national centers for environmental information 2020 this unexpected rise in temperature results in the thermal expansion of the oceans glacial melting and rises in the global mean sea level which is predicted by the international panel of climate change ipcc to reach values in the order of 15 mm year by 2100 much higher than the 3 6 mm year measured between 2006 and 2015 portner et al 2019 this phenomenon pushes the freshwater sweater interface zone of dispersion inland leading to salinization of underground water resources as climate change intensifies as a result of natural and human activities hardy 2003 the climate forecast predicts the issue will worsen in the next decades portner et al 2019 temperature departures from average in climate change scenarios will impact the precipitation patterns the glacier phase transitions as well as the demand for freshwater for crops and human consumption hardy 2003 xiao et al 2020 haddeland et al 2014 the first two phenomena affect the global mean sea level whereas the latter affects the use of groundwater resources by coastal communities previous studies consider the over extraction of groundwater to be more influential in the saltwater intrusion process than the sea level rise ferguson and gleeson 2012 although other studies have shown that the combined effect of sea level rise and over pumping of wells results in a dispersion zone deeper into the inland abd elhamid and javadi 2011 therefore solutions and countermeasures have been proposed to minimize the impact of climate change and over pumping on the quality of groundwater stored in coastal aquifers artificial recharge or freshwater injection into the well kallioras et al 2013 mahesha 1996 armanuos et al 2019 saltwater extraction from the dispersion zone bear et al 1999 sang uk et al 2012 sherif and hamza 2001 and underground physical barriers or walls armanuos et al 2019 kallioras et al 2013 are often used as countermeasures to prevent salinization of coastal aquifers all these techniques are considered direct methods to avoid seawater intrusion in coastal aquifers conversely computational modeling techniques are often classified as indirect prevention methods kallioras et al 2013 as they provide a theoretical evaluation of groundwater wells evolution that complements all prevention correction methods described above kim and yang 2018 abarca et al 2006 abd elhamid 2016 however the versatility of computer models allows not only characterizing prevention methods besides a complete qualitative understating of the factors that govern the transport of pollutants under different conditions may be also achieved bear et al 1999 which may provide the fundamentals for the development of effective countermeasures capable of preventing seawater intrusion in coastal aquifers most of the mathematical models employed to characterize the seawater intrusion are macroscopic they can capture the most relevant transport conditions that are known to affect the intrusion process such as piezometric head density viscosity porosity hydraulic gradient sea level rise among others voss 1984 sherif et al 1988 tsai and kou 1998 chun et al 2018 despite the vast amount of computational work related to pollutant transport in aquifers computational efforts seem to overlook the modeling of the intrusion process at a nanoscale level a molecular description of underground sweater diffusion captures the main characteristics of subsurface materials and fluids as explicit atomistic constructions instead of simple model parameters classical molecular dynamics simulations have been used to characterize pure and saltwater at different concentrations through its structure and dynamic behavior ghaffari and rahbar kelishami 2013 chowdhuri and chandra 2001 the models have shown excellent agreement with experimental evidence in transport properties furthermore molecular dynamics simulations have been used to study the adsorption and diffusion phenomena of confined pure water in ceramic pores marry et al 2008 mccaughan et al 2013 chen and cheng 2010 skelton et al 2011 recently saltwater and electrolyte solutions interacting with quartz surfaces have been also analyzed through molecular dynamics simulations quezada et al 2017 kroutil et al 2015 however none of them has focused on the diffusive transport properties of chloride and sodium ions in aquifers in a seawater intrusion scenario in this work we use classical molecular dynamics simulations to characterize the distribution and diffusion of salt ions in pores made of quartz at a seawater concentration of 3 5 wt the effect of the pore surface structure and temperature on the dynamic behavior of nacl ions at a fixed concentration is analyzed the results reported in this work provide a deep look into the ionic transportation through pores into coastal aquifers since it includes pore structure variables not included in common solute transport and finite element models furthermore the atomistic molecular description of the intrusion phenomenon offers a detailed characterization that allows taking advantage of the intrinsic characteristics of the soil and subsurface materials to develop proper prevention methods for seawater intrusion in aquifers 2 methods 2 1 systems configuration saltwater systems were built at a constant salinity of 3 5 wt and a density of 1 023 g cm3 which are known concentration and thermodynamic properties for standard seawater safarov et al 2009a 2009b in order to build the pore systems bulk quartz was cut at four different crystallographic orientations 100 110 101 and 001 fig 1 creating slabs with at least 4 atomic layers and a vacuum of 15 å along the z axis the size of the pore 15 å represents the typical dimensions of intercrystalline pores kashif et al 2019 the thickness of the slab was defined in such a way that the surface termination was the same at the top and bottom of the slit to preserve identical conditions for water molecules and salt ions which will interact with the top and bottom surfaces of the aquifer the configuration files for the cleaved surfaces are found in the supporting information once the surfaces were cleaved the salinity and density of the saltwater were achieved by placing 18 nacl units and 1611 h2o molecules occupying the 4 88 104 å3 of confined volume between the two quartz surfaces in a periodic cell with a slab located at the bottom the confined volume occupied by seawater is calculated from the surface area and the unoccupied vertical length which corresponds to the vertical distance from the topmost atoms of the surface and the upper edge of the cell see fig s1 atoms belonging to the central plane of the slab were forced to keep their initial positions frozen to avoid parallel diffusion of the whole slab on the xy plane which may lead to erroneous estimations of the parallel diffusivity of the liquid phase in contact with the solid surface a bulk system was also built with 1432 water molecules and 12 nacl units placed in a cubic box of 35 13 å edge length which represents the same density and salinity of confined systems the purpose of building a bulk system is to validate the computational methods through calculation of seawater properties and to evaluate the real effect of the confinement on the diffusion of seawater 2 2 computational methods molecular dynamics simulations were carried out using the dlpoly classic software smith 2014 water molecules were modeled using the spc e water model berendsen et al 1987 setting each water molecule a rigid body with fixed bond lengths ro h 1 00 å and bond angles θho h 109 47 intermolecular interactions are described through the lennard jones lj pair potential 1 u r ij 4 ε ij σ ij r ij 12 σ ij r ij 6 the lj parameters were taken from the original publication of the spc e water model as well as the charges for oxygen and hydrogen which are set to 0 8476 and 0 4238 respectively these values were developed so that lennard jones parameters for hydrogen can be set to zero and mixing rules involving hydrogen atoms are avoided lennard jones parameters for sodium and chloride ions are taken from chowdhuri and chandra 2001 while the salt water interaction parameters were obtained from lorentz berthelot mixing rules arithmetic averages for σ and geometric averages for ε all lennard jones parameters are reported in table s1 supporting information the internal forces between oxygen and silicon atoms in quartz are described through the bks potential derived and parametrized by van beest van beest et al 1990 from the typical buckingham functional form 2 u r ij a exp r ij ρ c r ij 6 the set of parameters are found in table s2 supporting information the electrostatic interactions between all atoms types are computed using the ewald summation method allen and tildesley 2017 ewald 1921 kolafa and perram 1992 which accurately accounts for long range electrostatic interactions in periodic systems the ewald summation parameters corresponding to the real space cutoff rcut the convergence parameter α and the reciprocal space vector kmax are estimated by dlpoly with a precision of 1 10 6 the charges of silicon and oxygen atoms in the bks potential are set to 2 4 and 1 2 respectively which guarantees the charge neutrality if the stoichiometric ratio is kept however the charge neutrality of the system was not always preserved in favor of the surface termination consistency top and bottom surfaces of the pore therefore fuchs correction for charged systems fuchs and fowler 1935 leslie and gillan 1985 was included in the ewald sum expression of the molecular dynamics simulations saltwater quartz intermolecular energies are described through the lennard jones potential although the sio2 is internally modeled through the bks potential the set of lennard jones parameters for silicon and oxygen were taken from mccaughan et al 2013 and used to derive all lj parameters for the sio2 saltwater interface through the lorentz berthelot mixing rules as described above parameters are found in table s1 molecular dynamics simulations were carried out using an npt ensemble using hoover nose thermostat hoover 1985 and barostat with 0 5 ps of relaxation time in each case the external pressure was set to zero while simulations were performed at ten different temperatures from 5 to 50 c 5 c steps a total of 3 ns was simulated with 1 ns of equilibration time and 1 fs timestep for the integration of motion equations through the verlet leapfrog algorithm the shake algorithm ryckaert et al 1977 was used to constrain bonds and angles in the rigid spc e water model a cutoff radio for nonbonded interatomic forces is set to 8 å which is more than half of the pore size built for the aquifer slit models 15 å cutoffs for nonbonded interactions in the order 8 å has been used in water and protein systems without affecting accuracy of the simulations garemyr and elofsson 1999 levitt et al 1997 the diffusion coefficients of water molecules and nacl ions were calculated from the mean squared displacement msd the msd was computed for the entire trajectory followed by a least squares linear regression to determine diffusion coefficient according to the einstein relation 3 d n 1 2 n lim t r t r 0 2 t where n defines the number of dimensions of the diffusion process for bulk diffusion n 3 while for surface diffusion on the xy planes parallel to the quartz surface n 2 the quantity at the numerator corresponds to the average of the position deviation from a reference position computed over all particles which is the definition of msd on the other hand t represents the total simulation time 3 ns in which the linearity of the msd is kept 3 results and discussion 3 1 diffusion of saltwater in quartz pores after every forcefield parameter was defined and the molecular dynamics trajectories were obtained at different temperatures the diffusion coefficients for water molecules were calculated from the mean squared displacement using the einstein relation eq 3 the diffusivity of water in a 3 5 wt aqueous solution of nacl is analyzed as a function of temperature and for four different quartz surfaces fig 1 fig 2 shows the diffusion coefficients of water molecules within quartz pores with different surface topologies the bulk diffusion of water molecules in saltwater is included for comparison purposes all diffusion coefficients for confined water correspond to parallel diffusion coefficients where only the x and y components of displacement are considered for the msd calculation and n takes de value of 2 in eq 3 on the other hand the bulk diffusion is calculated in a three dimensional space considering all components of the displacement and making n 3 in eq 3 the black curve in fig 2 demonstrates that the bulk diffusion coefficients of water molecules as a function of temperature are in strong agreement with the experimental values reported for pure water systems holz et al 2000 these results are expected since the spc e parameterization is known for its good representation of structural and dynamics properties for pure water berendsen et al 1987 the dynamic behavior of water molecules validates the selection of the spc e water model and the cutoff for nonbonding interactions 8 å additionally fig 2 proves that water molecules diffuse faster in bulk than in confined environments as the black curve lies above all other curves this behavior is anticipated due to the partial charges exposed in all quartz surfaces that favor strong coulomb interactions between water molecules and the surfaces slowing down the water diffusion furthermore exposed oxygen atoms at the top layer of the bottom surface and the bottom layer of the top surface allow strong hydrogen bonding between water and both surfaces such as the case of the quartz 110 fig 1 the pink line in fig 2 corresponding to the water diffusion in the quartz 101 pore lies very close to the bulk diffusion this behavior is explained from the topology of the quartz 101 surface which is the smoothest of all quartz surfaces tested in this study with positive silicon and negative oxygen ions localized at the interface scheme of quartz 101 in fig 1 conversely the diffusion of water molecules in the quartz 100 pore drops significantly due to the strong roughness of the surface and positively charged silicon atoms localized alone at the interface the silicon positive charges pointing towards the interface attract negatively charged oxygen atoms of the water molecule to form strong electrostatic interactions and slowing down diffusion although quartz oxygen is absent at the quartz 100 saltwater interface to favor hydrogen bonding this absence also reduces the o quartz o water repulsion at the interface therefore the strong coulomb interactions between si quartz and o water are responsible for the low mobility of water molecules except for the diffusion in quartz 001 all profiles present a slight exponential behavior as a function of temperature considering that fig 2 presents a logarithmic y axis the diffusion of water molecules in the quartz 001 pore exhibits a noteworthy behavior the red curve drops two orders of magnitude compared to the bulk diffusion from 10 5 to 10 7 cm2 s while the diffusion profile deviates from the exponential trend linear with the logarithmic axis to exhibit a non linear behavior with a tendency to increase with temperature the low diffusivity is related to the characteristic porosity of the quartz 001 surface and water penetration whereas the lack of linearity is a consequence of the negligible effect of temperature on the amount of water molecules penetrating the surface fig 1 shows a large pore for the quartz 001 surface in its top view the view along the 100 does not portray the most interesting topology features of this surface which are captured in fig 3 with a view along the 110 direction fig 3 shows the top view and a view along the 110 direction of the quartz 001 surface the top view presents a water molecule model with its dimensions in contrast with the surface pore dimensions the top view fig 3a shows a large pore 3 6 å in the 001 surface which can trap water molecules with van der waals radii in the order of 2 8 å the small vdw radii of the water molecule let it diffuse towards the inner layers of the quartz which is less probable to occur in the other quartz surfaces with smaller pore sizes fig 1 water molecules trapped in the subsurface will not diffuse as fast as they do in a homogeneous liquid phase i e near the center of the quartz slit this explains the slow parallel diffusion coefficients obtained when water molecules are confined by quartz 001 surfaces moreover the view along 110 direction fig 3b exhibits a remarkable roughness of the quartz 001 surface with a topology depicting the formation of wells as represented by the schemes in fig 3 water molecules may easily get trapped in these wells finding themselves in a state where a significant potential energy barrier must be overcome to return to the liquid phase the penetration of water molecules in the direction of the bulk quartz is demonstrated by the z density profiles reported in fig 4 a the green area corresponding to the zones of water location with lower density overlaps with the orange diagonal lines defining the presence of silicon atoms belonging to quartz this overlap is significant although the water molecules do not cross through the subsurface to the deeper layers this feature is not seen in the remaining quartz surfaces to this extent the interaction between water molecules and the quartz 101 results in a small overlap between oxygen from water and silicon from quartz fig 4b however it is worth noting that the highest water peaks are found between the central plateau and the peak overlapping the silicon region these two peaks represent the highest density and are not in contact with the quartz surface which gives an idea about the remarked layered structure taken by the water with this pore structure the water density drops to zero at 9 5 å and at 22 8 å which leaves the highest density peak isolated from the quartz surface this highly localized water structure provides clues for the fast parallel diffusion of water confined by quartz 101 which is almost the same magnitude of bulk diffusion between 5 and 50 c as seen in fig 2 the highest density layer is bounded by the low density central plateau and a vacuum layer providing a small energy barrier for lateral diffusion the z density profiles of water in the quartz 100 pore exhibit a very weak interaction between water molecules and the surface fig 4c the water peaks limiting with the surface are 1 5 å away from the silicon peak which is the closest quartz 100 atom type to the surface water interface moreover the water density drops to zero when approaching the silicon peak which proves the absence of water penetration into the quartz 100 surface on the other hand the water diffusion in the quartz 110 pore is relatively fast this pore surface has the peculiarity of having oxygen termination unless the other studied quartz surfaces in this work fig 1 also it does not present a high porosity therefore significant water penetration is not seen fig 4d shows only a very low water density overlapping the surface silicon peak however the z density profiles for water in quartz 101 and 110 share a similarity the water densities for both pore structures drop below 0 023 molecules å3 in the center of the pore conversely the water density at the center of the quartz 100 is 0 037 molecules å3 fig 4c and the density at the center of the quartz 001 pore even ascends to 0 048 molecules å3 fig 4a all simulations are carried out using an npt ensemble and therefore the volume adjusts during the initial steps to find the equilibrium density thus the equilibrium local densities for water at the center of quartz 001 and 100 are found above the experimental density of bulk water at 25 c 1 g cm3 or 0 034 molecules å3 these localized high densities are commonly seen in layered structures of confined water karamzadeh and mozaffari 2018 wu et al 2019 the compactness associated to high densities of the aqueous phases within these pores contributes to their slow parallel diffusion the presence of a highly dense water phase inside quartz 001 and 100 pores is also supported by the radial distribution functions rdf plotted in fig s2a and s2c see fig s2 supporting information regardless of the temperature the rdf plots exhibit a second peak the second peak for water in quartz 001 is more prominent and located at 5 6 å whereas the second peak for quartz 100 is dimmer and located at 6 1 å second peaks are barely distinguished for water confined by quartz 101 and 110 fig s2b and s2d which results from the low density near the center of the pore and the consequential lack of a packed structure radial distribution functions plotted in fig s2 proved that the water structure does not depend on temperature in the 5 45 c range furthermore the bulk pure water structure is not affected by the salinity at 25 c as the rdf curves for bulk pure water and bulk saltwater are superimposed fig s2 the mobility and diffusion of water are correlated to its density and structure in confined systems on one hand the denser and more structured water phase the lower the mobility of water molecules on the other hand the less dense and less structured water molecules in the center of a confined system the higher their diffusivity however the dynamic behavior of the water molecules in the confined salt water system does not necessarily correlate with the behavior of na and cl ions the differences in surface chemistries will lead to a wide range of possibilities for ions distribution and diffusion due to different interactions with both surfaces and the aqueous phase the analysis of the ions dynamics is essential to understand the physical chemical phenomena governing the saltwater intrusion in aquifers and the salination of fresh water in wells 4 diffusion of nacl ions in quartz pores the diffusion of the na and cl ions were computed from the mean squared displacement and the einstein relation and reported in fig 5 almost all cases show a slight dependence on temperature increasing diffusivity as the temperature increases although not as prominent as in the case of water molecules for both na and cl the diffusion was higher in bulk than in any other pore regardless of the pore composition or the structure however the diffusion of na in quartz 101 was the only one that reached coefficients near bulk levels even overcoming the bulk diffusion at 25 c this surface also leads to fast diffusion of water molecules as stated above and reported in fig 2 this behavior is related to the smoothness and balanced charge of the top layer of the quartz 101 surface which diminishes steric and electrostatic interactions between the surface and the constituents of the saltwater on the other hand the salt cation na diffuses very slow in the quartz 110 surface as demonstrated by the orange data set in fig 5a this particular behavior is observed because the 110 surface exposes oxygen atoms with partial negative charges at the quartz saltwater interface the electrostatic interaction between those exposed oxygens and the sodium cations is so strong that sodium atoms even access the quartz 110 subsurface as seen in fig 6 d these oxygen atoms not only attract sodium ions but they also repel cl displacing them toward less dense central saltwater regions figs 4d and 6d where higher diffusivity is found therefore the chloride ions find the highest diffusivity in confinement with the quartz 110 with coefficients even approaching 1 10 5 cm2 s at 50 c which are bulk level coefficients for chloride ions orange data set in fig 5b the diffusion coefficients of na in quartz 001 lie between 5 10 7 and 2 10 6 cm2 s red line fig 5a which is expected for the cations located in the central zone of the pore fig 6a where the water density is not too low compared to the water density at the center of quartz 101 or 110 as shown in fig 4 conversely the same surface induces a very slow diffusivity for cl ions with diffusion coefficients as low as 1 10 8 fig 5b much lower than water molecules within the same surfaces where the water found the lowest diffusivity due to the intrusion of water molecules through slab nanopores and into the quartz subsurface the same analysis applies for the chloride anions since their penetration inside the subsurface is also demonstrated by the z density profile of cl in fig 6a this chloride infiltration inside the quartz 001 surface disrupts the temperature dependence of the diffusion coefficient since the thermally activated diffusion hops lose the sensitivity to kinetic variations as they abandon the liquid phase conversely the diffusion hops start being defined by larger activation energies in the solid quartz matrix where larger temperature changes are required to observe significant variations in diffusion coefficients this kind of infiltration is not seen for any ion in quartz 101 fig 6b and quartz 100 fig 6c in these pores the ions stay away from the quartz saltwater interface and the diffusion coefficients are determined by the saltwater density and temperature therefore the overall diffusivity of nacl ions in quartz 101 and quartz 100 are slower than in bulk but faster than in highly interacting systems it is worth noting that all density profiles in figs 4 and 6 present a high symmetry respect to the center of the pore this feature is attributed to the identical termination of both surfaces top and bottom however as mentioned above the consistency in surface terminations was only achieved by unbalancing the net charge of surfaces although the nonzero net charge was compensated through the fuchs correction fuchs and fowler 1935 leslie and gillan 1985 the high correlation between the surface termination and the preferred location of ions inside the pores demonstrate that the local charge concentration at the surface and the surface topology determine the main electrostatic and steric interactions and consequently the density profiles however the net charge of the cell per surface area also shows a direct correlation with the chloride interaction with surfaces as seen in the table s3 the quartz 001 presents the highest positive charge per surface area followed by quartz 100 and quartz 101 the inverse trend in cl diffusion nevertheless the effect is the net charge is not conclusive since the dynamic behavior of neutral water molecules is demonstrated to be mostly influenced by the topology porosity roughness of the surface which is expected to affect ionic interactions and diffusion from these results it can be concluded that the diffusion of na and cl ions in quartz pores depends individually on the structure of the pore surfaces and the exposed quartz atoms at the interface in bulk na and cl exhibit diffusion coefficients within the same order of magnitude with cl diffusivities slightly higher at most of the temperatures in agreement with experimental results yuan hui and gregory 1974 unlike the behavior in an open system the bi dimensional diffusion coefficients of na and cl ions through a pore may differ from each other by a few orders of magnitude depending on the crystallographic planes of the pore surfaces all surfaces here analyzed introduce a strong interaction with either chloride or sodium but the strength of these interactions is not the same for both ions simultaneously it can be noticed from fig 5 that for confined systems there are larger gaps between diffusion coefficients of na and cl in a given pore compared to the bulk as seen from lines of the same color in fig 5a and 5b the bulk diffusion trend where the cl diffuses slightly faster than na is disrupted in confinement for instance the chloride diffusivity in quartz 001 is much lower than sodium diffusivity because of the chloride intrusion into the subsurface discussed above furthermore quartz 101 and 100 pink and blue data sets in fig 5a and 5b also invert the bulk trend allowing sodium ions to reach higher diffusivities than chloride within the pore conversely quartz 110 allows a higher diffusivity of cl as in bulk but the gap between na and cl diffusivities becomes wider due to strong electrostatic interactions between na and the surface as can be inferred the simultaneous suppression of na and cl diffusivities through strong adsorption on surfaces is unlikely unless the pore stabilizes different surfaces leading to the strong interactions of both ions with different surface structures within the same pore the surface structure of pores and consequently the silicon and oxygen atoms exposed at the interface determine the diffusivity of ions through specific interactions but this leads to opposite dynamic behavior in na and cl although the simulations performed in this study were set up to have a balanced concentration of na and cl ions the obtained diffusivities can be used to predict the relative concentrations of both ions na cl ratio by the time they reach an aquifer assuming the transport is predominantly diffusive and the pore stabilizes the same type of surface thus considering the 001 is the energetically most stable surface for alpha quartz de leeuw et al 1999 it is fair to assume that saltwater intruding aquifers through quartz pores may lead to higher na cl concentration ratios in groundwater as the diffusivity of na is larger than that of cl in quartz 001 most of the chloride diffusing toward a freshwater well may get stuck inside quartz 001 nanopores on their way to the underground freshwater storage however seawater intrusion properties have been widely characterized by low na cl ratios 1 while high na cl ratios in aquifers are attributed to anthropogenic sources such as fertilizers or residential wastewater moujabber et al 2006 the simulation conditions implemented in this study represent the salinity of seawater and one of the ceramic materials typically found in coastal soils cao et al 2016 nevertheless the pore size used in this study lies within the category of nanopores which is dimensionally closer to intercrystalline pores with throat radios below 6 nm kashif et al 2019 than to aquifer pores commonly measured in the order of micrometers therefore saltwater reaching the aquifers from brine storages hu et al 2018 keating et al 2013 through intercrystalline diffusion mechanisms is the closest phenomenological scenario represented by these simulations since md simulations do not consider anthropogenic sources the obtained diffusivities dna dcl for the most stable surface suggest concentration properties that oppose experimental observations as the ratio in diffusivities relates to the ratio of concentrations at distant aquifer this conflicting outcome can be explained from two different perspectives the first is that less stable quartz surfaces are exposed at coastal rocks such as the quartz 110 which stabilizes dangling oxygen atoms at the water rock interface that strongly interact with sodium cations quartz 110 is the least stable of all four surfaces here studied but it can be stabilized under certain conditions such as bent or curved quartz crystals pereira et al 2015 the second explanation is that other common carbonate ceramic materials such as calcite aragonite or dolomite are found at a greater proportion than quartz in coastal aquifers daniele et al 2013 stable surfaces in these materials may favor cl diffusion over na providing the reason for low na cl ratios in aquifers as a result of seawater intrusion more ionic carbonate materials such as calcite also lead to higher ionic exchange that results in the presence of carbonate bicarbonate and calcium ions in groundwaters daniele et al 2013 the dissolution of these electrolytes may disrupt the ratio between chloride and carbonates carbonate bicarbonate known as simpson ratio moujabber et al 2006 sudaryanto and naily 2018 todd and mays 2004 which has been established as a criterion for the identification of seawater intrusion high simpson ratios are considered as a fingerprint of seawater intrusion in groundwater although the simpson ratio is much higher in seawater than in contaminated groundwater moujabber et al 2006 which may be a result of ionic exchanges in any case more simulations are needed to prove either of these two hypotheses yet molecular dynamics simulations have shown that higher quartz concentrations in rock compositions may disrupt diffusion patterns for seawater intrusion since the most stable quartz surface favors na diffusion over cl the analysis of molecular dynamics trajectories also characterizes the possible formation of nacl clusters inside the pore as a result of electrostatic repulsions from the pore surface and ions accumulation near the pore center radial distribution functions rdf plotted in fig 7 demonstrate that the height of the first peak depends on the crystallographic planes exposed on pore surfaces the first peak of all rdfs is located at 2 90 å and the highest intensities are found for 101 and 100 surfaces of quartz these peaks are much higher than the first rdf peak for nacl in bulk water this evidences that a strong na cl interaction inside these pores may lead to a possible formation of cluster like structures as a result of confinement considering the nacl bond length in the gas phase clusters and crystals range between 2 36 and 2 79 å garcía et al 2019 the possible ionic cluster formation in confinement has been predicted before through the analysis of single particle distributions density profiles computed from molecular dynamics trajectories nicholson and quirke 2003 thus the high 101 and 100 peaks in fig 7 are correlated with the z density profiles in the fig 6b and 6c where the chloride ions are found far from the surface trapping the sodium ions located in the middle of the pore this feature for instance is not seen in the quartz 001 surface where cl ions penetrate the surface and therefore interact with less strength with the na ions in the center as discussed above this is evidenced in fig 7 by the low height of the first peak corresponding to the quartz 001 surface red peak at 2 90 å this peak even vanishes at 25 c fig 7b and it is very low at 5 and 45 c this behavior suggests that strong interactions between most of the chloride ions and the quartz 001 surface hinder the possible formation of na cl cluster like structures in the middle of the quartz 001 pore furthermore na and cl ions interact very weakly within the quartz 110 pore the oxygen terminated surface interacting very strong with chloride breaks apart any attempt of ionic aggregation near the center of the pore this is supported by the flatness of the orange peaks in the radial distribution functions reported in fig 8 nevertheless the low energetic stability of the quartz 110 surface makes this scenario less probable 5 conclusions in summary molecular dynamics simulations were performed to gain a deep understanding of the diffusion and interaction phenomena of seawater in quartz pores at a molecular level simulations showed that the diffusivities of both water molecules and nacl ions are correlated to the crystallographic orientation of the quartz surfaces the most stable surfaces induce higher diffusivity of sodium than chloride ions because of the particular topology of the quartz 001 and 101 that expose positively charged silicon atoms that favor the strong adsorption of chloride ions additionally the nano porosity of the quartz 001 surface allows penetration of chloride ions into the subsurface reducing the planar diffusion coefficients to orders of magnitude as low as 10 8 cm2 s the md results herein reported suggest a high na cl in aquifers upon seawater intrusion which contradicts experimental evidence the differences are mainly attributed to the predominant presence of carbonate materials in most coastal aquifers that offer strong sodium carbonate interactions the results herein reported provide a theoretical basis for understanding the seawater intrusion phenomena from a molecular perspective this computational approach complements other experimental and modeling efforts developed through decades towards improving the quality of groundwater resources supporting information supporting information si includes lennard jones parameters for van der waals interactions and parameters for the bks potential describing the bonding interactions dimensions and charges of all the quartz surfaces are reported the surface dimensions data is supported by a representation of the periodic surface cell radial distribution functions for water molecules in confinement and bulk are also reported in the si configuration files of every quartz surface are included in the si credit authorship contribution statement juan c burgos conceptualization methodology validation investigation formal analysis writing original draft writing review editing edgar quiñones bolaños visualization supervision writing review editing m ziad saghir visualization supervision writing review editing resources mehrab mehrvar visualization conceptualization investigation methodology resources formal analysis supervision writing review editing project administration funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the financial support of the canadian queen elizabeth ii diamond jubilee scholarship program qes ryerson university faculty of engineering and architectural science dean s research fund and universidad de cartagena is greatly appreciated the authors would also like to thank compute canada for providing access to its computational resources 
