index,text
2655,the sustainable development of groundwater resources in arid and semi arid regions is a challenging task hindered by climate change and human activities the rational utilization and management of groundwater resources is therefore dependent on an understanding of the influences of human and climatic factors on the spatial distribution of groundwater resources and their change over time the thick quaternary aquifers in the yinchuan basin china were used herein as an example of how to quantitatively assess spatial and temporal trends in groundwater resources in response to human activities and climate change a 3d transient groundwater flow model was constructed and used to simulate the evolution and spatial variability of hydrogeological processes from 1990 to 2020 by subsequently applying regime shift detection and correlation analysis to the simulation results we found that 1 groundwater storage was continuously depleted over the 30 year period reaching a cumulative depletion of 1 89 109 m3 2 human activities were mainly responsible for variations in regional hydrogeological processes for a period of up to 30 years climate only affected short term interannual fluctuations in groundwater storage 3 human activities e g river water diversion and groundwater abstractions were the decisive factors causing a continuous reduction of groundwater resources a policy driven reduction in water diversion from the yellow river directly led to a significant drop in groundwater storage which had a consequent effect on surface water and groundwater interactions and altered agricultural irrigation patterns crop patterns and irrigation methods 4 the amount of groundwater recharge from the yellow river and local lakes increased from 1990 to 2020 whereas the discharge of groundwater to the yellow river and lakes decreased keywords quaternary sediments yinchuan basin numerical groundwater flow model human activities climate change surface water groundwater interactions data availability the authors do not have permission to share data 1 introduction groundwater is a crucial component of regional water cycles and plays a vital role in regional socio economic development and ecosystem conservation especially in arid and semi arid regions characterized by scarce precipitation and surface water resources strong evapotranspiration and fragile ecosystems groundwater is not only an important source of domestic industrial and agricultural water but is also critical for maintaining ecosystems in arid areas wang et al 2021a for example the growth of natural vegetation often depends on phreatic evapotranspiration and the maintenance of the water levels volumes and areas of rivers and lakes depends on the balance between groundwater recharge and discharge li et al 2020a ma et al 2022 zhou et al 2020 in recent decades the impact of global climate change and human activities associated with rapid socio economic development on hydrogeological processes has become increasingly prominent changes in climatic factors e g precipitation and evapotranspiration and human activities e g agricultural irrigation and groundwater abstractions have the potential to substantially affect hydrogeological processes and mechanisms fu et al 2019 liu et al 2022 meixner et al 2016 nofal et al 2019 ramos et al 2020 shamir et al 2015 taylor et al 2013 vrzel et al 2019 xu and su 2019 climate factors including precipitation and evaporation affect groundwater systems by altering the interactions between groundwater and surface water bodies e g lakes and rivers as well as by affecting recharge processes carlson et al 2011 jyrkama and sykes 2007 human activities in contrast directly impact groundwater through the exploitation of groundwater resources and or their influence on groundwater recharge in addition human activities may indirectly affect groundwater recharge discharge as land use cover is altered during the implementation of agricultural development projects and or by urbanization among other activities zhang et al 2014 such human induced disturbances may lead to a sharp drop in groundwater levels a change in the water cycle and or a deterioration of groundwater quality sekhar et al 2013 in semi arid farmlands irrigation return flow and canal leakage may greatly contribute to groundwater recharge jimenez martinez et al 2010 especially when a large amount of water from a perennial river supplies the irrigation systems vallet coulomb et al 2017 therefore groundwater flow and storage can change in response to alterations in agricultural irrigation land use and water demand in this context maintaining the long term balance of groundwater systems is critical to supporting a sustainable economic and ecological environment fu et al 2019 given the complexity of the system and the wide range of factors that may impact groundwater systems the sustainable management of groundwater resources is an arduous issue that requires an evaluation of hydrogeological processes an analysis of natural and anthropogenic drivers and an understanding of the mechanisms controlling the regional water cycle understanding the impacts of environmental change on groundwater systems requires on the one hand an assessment of the evolution of the numerous interacting hydrogeological variables that control the groundwater system e g river stages lake water levels and lateral boundary flow on the other hand it is necessary to evaluate alterations in climate and human activities that represent the primary controls on groundwater e g precipitation evapotranspiration crop patterns the intensity of extraction and water allocation policy however the proper evaluation of different types of variables is often complex and indistinguishable as they are related to multiple physical factors with high temporal and spatial variability pulido velazquez et al 2015 to address such research needs a wide range of approaches have been applied including water balance methods li et al 2020a statistical analyses hou et al 2022 wang et al 2018 integrated hydrological modelling mikeshe gsflow feng et al 2018 and numerical groundwater models liu et al 2021 ramos et al 2020 wang et al 2021b zhou et al 2020 integrated hydrological modelling is often difficult to apply to large areas because of its extensive requirements for surface information and surface water parameters it is also difficult to achieve a high level of accuracy with such hydrologic models numerical groundwater simulations are commonly used to evaluate the response of groundwater flow processes to climate change and anthropogenic disturbances a transient groundwater flow model that describes the heterogeneous structure of the aquifer can provide important insights for the accurate evaluation regulation and management of groundwater resources however it is a challenge to characterize the heterogeneity of complex multi layer hydrogeological structures in finite difference grids with reasonable partitioning and stratification burns et al 2010 the hydrogeologic unit flow package huf anderman and hill 2000 of modflow 2005 harbaugh 2005 hill et al 2000 can address this challenge huf allows hydrogeological units to be defined independently of model layers eliminating the need to determine how to delineate model layers to match highly heterogeneous structures the yinchuan basin is an important food production area located in the arid and semi arid region of northwest china due to the lack of local surface water resources and precipitation socio economic water demand mainly depends on the diversion of water from the yellow river more frequent droughts accompanied by a reduction in river flows have resulted in a lower water supply as a result groundwater abstractions from local and regional aquifers now serve as a secondary and stable source of water in the yinchuan basin moreover during the past 30 years the yinchuan basin has experienced accelerated urbanization and sustained population growth nsb 1991 2020 in 1990 9 4 million people lived in the yinchuan basin the population had grown to 11 1 million 15 7 million and 17 5 million by 2000 2010 and 2019 respectively nsb 1991 2020 as a result the demand for groundwater for domestic industrial and agricultural purposes have and continue to increase moreover changes in the mechanisms of water diversion irrigation and land use may have substantially modified hydrogeological processes therefore the groundwater system of the yinchuan basin appears to be very sensitive to human activities recent reductions in yellow river discharges as a result of climate change and intensive human activities have also raised concerns about water availability in the yinchuan basin of particular concern is the amount of water that can be allocated from the yellow river and the exploitable amount of groundwater in the coming years to ensure the sustainable utilization of water resources in the yinchuan basin it is necessary to investigate the simultaneous response of hydrogeological processes to long term human activities and climate factors and to assess trends in the changes in groundwater recharge processes over time and space nofal et al 2019 previous water balance calculations and numerical groundwater simulations in the yinchuan basin have mainly focused on one or several temporal hydrological years in which the exploitable amount and pollution potential of groundwater were the main concern li et al 2020b qian et al 2012 xu et al 2015 the groundwater response to long term changes in climate and human activities and the complex interactions between the groundwater and surface systems have not been systematically studied this study adopts a transient groundwater flow simulation based on the modflow model to assess the long term hydrogeological processes and the factors controlling these processes within the thick unconsolidated quaternary aquifers of the yinchuan basin from 1990 to 2020 the main objectives of the study are to 1 detect the temporal and spatial trends in hydrogeological processes 2 identify the trends and abrupt change points in climate change human activities and hydrogeological processes 3 evaluate groundwater dynamics under the influence of natural forces climate and human related forces human activities and 4 explore the response of groundwater surface water interactions to long term human activities and climate factors the results of this study provide science based information for the rational development of groundwater resources help to design effective measures to cope with the impact of climate change and human activities and formulate appropriate sustainable groundwater management plans in arid and semi arid basins 2 materials and methods 2 1 study area the yinchuan basin is located in the northern ningxia hui autonomous region of china fig 1 it is bounded by qingtongxia canyon to the south the ordos platform to the east and the helan mountains to the north and west the basin varies in width from 10 to 60 km and possesses a long axis oriented nearly in a south north direction that is 181 km in length the basin covers an area of approximately 7088 km2 and has an elevation that ranges between 1100 m and 1300 m above sea level topography dips gently from southwest to northeast structurally the yinchuan basin is a fault controlled basin developed during the cenozoic era high subsidence rates within the basin have allowed for the enhanced deposition of unconsolidated quaternary sediments han et al 2013 which reach about 1700 m in thickness within the center of the basin these sediments become thinner towards the basin s margins yang et al 2018 geomorphologically the yinchuan basin can be subdivided into three topographic units each of which is associated with a distinct sedimentary sequence 1 a piedmont pluvial plain underlain predominantly by coarse gravel sized sediments 2 a pluvial alluvial plain underlain by sandy gravel sized sediments and 3 an alluvial lacustrine plain underlain by relative fine sediments consisting primarily of sand silt and clay fine grained sediments dominated by sandy clays are generally found along the piedmont pluvial front the yinchuan basin is characterized by arid and semi arid conditions that are associated with a continental climate with sufficient sunshine little rainfall and strong evapotranspiration climatic data within the yinchuan basin have been collected from 1990 to 2019 at the yinchuan station fig 2 the mean annual precipitation is about 186 mm a with most rains occurring from may to september the mean annual evapotranspiration is about 1748 mm measured with a 20 cm evaporating dish e601 most evapotranspiration occurs between april and september the annual evapotranspiration is about 10 times the annual precipitation the monthly mean temperatures range from 7 to 24 c the yellow river is an important perennial river that flows through the yinchuan basin from southwest to northeast it is the most important source of irrigation water irrigation return flow serves as a major source of groundwater recharge mi et al 2020 due to the unique geological structure climate and hydrogeological characteristics of the yinchuan basin an underground reservoir of pore water exists within the thick unconsolidated quaternary sediments in the basin groundwater is mainly recharged by irrigation return flow canal leakage precipitation infiltration and lateral groundwater runoff from the foothills of the helan mountains groundwater is also recharged directly from the yellow river where the river stage is above the groundwater level groundwater is discharged into surface water bodies including the drains the yellow river and lakes or is lost via other outflow components including evapotranspiration and abstractions among these flow routes irrigation return flow and drainage are the most important components effecting recharge and discharge of the groundwater system the dominant groundwater flow direction in the study area is generally from the southwest to the northeast and is characterized by hydraulic gradients that exceed 0 04 beneath the northern alluvial lacustrine plain groundwater flows to the northeast under a hydraulic gradient lower than 0 04 due to the area s flat lying topography before flowing into the yellow river han et al 2013 except within the piedmont pluvial plain the groundwater table in most parts of the basin is less than 3 m below the ground surface qian et al 2014 most of the lakes in the study area are distributed along linear depressions that represent the old route of the yellow river these lakes possess an obvious oxbow morphology other lakes are distributed in depressions in front of or between alluvial fans and are irregularly shaped zhang 2007 most of the land in the yinchuan basin is cultivated for irrigated crops consisting mainly of rice wheat and corn to compensate for the lack of rainfall the crops are irrigated during the growing season with waters diverted mostly from the yellow river additional irrigation water is obtained from groundwater withdrawals water from the yellow river is transported from south to north to farmland through a canal system irrigation return water from the farmland is ultimately discharged back into the yellow river through a network of drains numerous water conservancy projects have been implemented in the area most of which were constructed in the 1960s and 1970s the constructed projects were restricted by economic conditions at the time thus the loss of diversion water by leakage is large the region s convenient water diversion conditions favoured the use of traditional flood irrigation in the study area an approach that is characterized by large water diversions and drainage large scale water diversions for irrigation have also resulted in increased groundwater recharge and groundwater resources that have maintained local lakes and wetlands therefore surface water and groundwater are closely related leading local residents to say that the water of the yellow river enriches ningxia which comes in the form of local economic development however as a result of the diversions runoff in the yellow river declines significantly after it flows through the yinchuan basin 2 2 construction of a conceptual hydrogeological model development of the conceptual model consisted of three steps 1 construction of a 3d lithological model 2 creation of conceptual model coverages and 3 mapping of the conceptual model to modflow numerical model packages 2 2 1 a three dimensional lithological model a 3d lithological model of the study area was built using an integrated approach that had previously been used to construct a hydrogeological structure model of the basin s thick unconsolidated sediments li et al 2021 the 3d lithological model is based on multiple sources of data including borehole surface elevation data borehole lithology data audio frequency magnetotelluric data amt and lower boundary elevation data for the quaternary sediments that were integrated using several methods including sequential gaussian simulation and natural neighbor interpolation the integrated geological model reproduces the spatial heterogeneity of the basin s geometric features and repeated geometric patterns 2 2 2 conceptual model coverages the groundwater modeling system 10 4 gms10 4 was used to create conceptual model coverages including 1 boundary coverages arcs and properties the boundaries of the first layer in the yinchuan basin were defined as general head boundaries the western boundary adjacent to the helan mountains was set as a highly permeable boundary that receives a supply of bedrock fissure water and terrestrial flood flows from the mountains the boundaries to southwest and south were defined as weakly permeable boundaries associated with alluvial fans and a delta respectively the boundaries for layers 2 11 were generalized as no flow boundaries a no flow boundary was also adopted for the bottom of the quaternary sediments fig 3 2 sources sinks coverages a recharge from precipitation areal recharge coverage monthly precipitation data between 1990 and 2020 from 10 meteorological stations fig 1 were obtained from the ningxia meteorological bureau thiessen polygons were used to calculate the control area of the 10 meteorological stations the corresponding infiltration coefficients table 1 were then assigned to different soil types and land use types on the basis of the soil zonation map of the vadose zone obtained from the institute of hydrogeology and environmental geology of ningxia the recharge rate from precipitation was then calculated based on different zones using the following equation 1 p r i p where pr m d is the recharge rate from precipitation p m d is the monthly precipitation rate and i dimensionless is the infiltration coefficient of the different soil types b irrigation return flow areal recharge coverage the zonation of irrigation return flow was based on an interpretation of administrative divisions soil types and land use types as determined from a u s landsat 30 m resolution image of the yinchuan basin acquired in 2018 xu et al 2018 the recharge rate for irrigation return flow was calculated as 2 i r u i w a where ir m d is the recharge rate of irrigation return flow u dimensionless is the effective utilization coefficient of field water i dimensionless is the infiltration coefficient of the different soil types w m3 d is the monthly agricultural water utilization from both the yellow river and groundwater and a m2 is the area of each zone the agricultural water intake for each administrative division was obtained from the ningxia water resources bulletin nwrd 2000 2020 c canal leakage specified flow coverage the leakage rates of the canals fig 3 were calculated by 3 c l d i 1 c u c i where cl m3 d is the recharge rate from canal leakage di m3 d is the monthly water diversion from the yellow river cu dimensionless is the effective utilization coefficient of canal water and ci dimensionless is the infiltration coefficient for the canals water diversions of each canal were obtained from the ningxia water resources bulletin nwrd 2000 2020 d groundwater abstractions well coverage two types of groundwater abstractions were included in the coverages the first is the centralized abstractions from the deep aquifer layers 2 3 which was mainly used for industrial and urban water supplies the second includes abstractions from the shallow aquifer layer 1 2 these abstractions were primarily conducted through scattered wells including hand and motor operated wells the water from these wells is mainly used for agriculture and as a rural water supply where the pumping rate of a well field was not available the pumping rate was defined as the allowable pumping rate of the well field the allowable pumping rate specifies the maximum daily pumping rate for each well field the pumping rates of scattered wells were assigned to the model according to the administrative division the pumping rate of each administrative division was obtained from the ningxia water resources bulletin nwrd 2000 2020 e evapotranspiration et coverage the evapotranspiration rate of groundwater was estimated on the basis of calculated surface evapotranspiration as determined from a mod16 data set zonation was then conducted on these estimates of evapotranspiration rate the extinction depth of phreatic evapotranspiration was set as 3 1 m the elevation of the et surface was set as the land surface elevation f discharge from drainages drain coverage excess irrigation water was drained and discharged to the yellow river fig 3 drains were assigned a bottom elevation of 3 m below the surface the conductivities of all drains were set to 12 m d g the yellow river general head coverage the monthly stages of the yellow river as recorded at the qingtongxia and shizuishan stations were obtained for the period of 1990 to 2020 the monthly yellow river stages in 2000 were also collected from 5 additional gauging stations yesheng wuduizi shiba hongyazi and gaorenzhen the conductance of the riverbed material was set to 0 06 m2 d m h lakes river coverage the location and geometry of 7 lakes with an area greater than 2 96 km2 fig 1 in the study area were extracted from remotely sensed images xu et al 2018 the conductance of the lakebed material was set to 0 01 m2 d m2 to maintain the stability of the ecological environment the government replenishes the lakes through water diversions from the yellow river therefore the lake areas water depths and water surface elevation of the 7 lakes are relatively stable and were set as fixed values in our model the head stages and bottom elevations were based on survey data of average lake depth collected by the institute of hydrogeology and environmental geology of ningxia the general characteristics of the 7 lakes are shown in table s1 in supplementary 3 hydrogeological unit properties the initial hydraulic conductivities horizontal and vertical were assigned to each hydrogeological unit according to the results of pumping tests gsin 2016 the initial specific storages and initial specific yields of each material were based on the handbook of hydrogeology cgs 2012 those parameters were then calibrated in the model table 2 4 observation coverage data from 201 long term observation wells near yinchuan city and shizuishan city from 1990 to 2019 were obtained from the ningxia water resources department groundwater levels were measured monthly in most of these wells in addition surveillance measurements of groundwater levels were obtained for a large number of production and observation wells in total data were available for 1180 wells distributed in layers 1 3 2 3 construction of the numerical model the transient groundwater flow model was established using modflow 2005 harbaugh et al 2017 harbaugh 2005 in 1990 the observed groundwater levels were relatively stable and precipitation was abundant therefore a steady state simulation for the year 1990 was first performed to conduct a preliminary calibration of hydrogeological parameters and determine the initial heads for the transient simulation covering the period from 1990 to 2020 2 3 1 model grid and stress period a total of 372 monthly stress periods were defined for the simulated interval of january 1990 to december 2020 the y north south and x west east directions were evenly discretized with a fixed grid size of 1000 m by 1000 m this created a model grid of 181 rows and 87 columns eleven layers were chosen for the model in the z vertical direction the surface elevation and bottom elevation of the model were determined by the 3d geological structure model developed by li 2021 the areal extension of the model layers was truncated by the bottom elevation of the basin aquaveo 2017 since the bottom of the model is bowl shaped the number of grids within each model layer decreases sequentially from the top to the bottom the first layer contains 7185 grid cells the second layer contains 6891 grid cells the 11 layers in total contain 34 236 active grid cells the first layer was set as unconfined whereas the remaining layers were set as confined 2 3 2 model packages 1 flow package hydrogeological unit flow package huf the study area is characterized by fluvial lacustrine sedimentary facies including river channel and flood deposits that exhibit complex and highly heterogeneous geometries which appear in repeated patterns friend 1983 gibling 2006 miall 2006 the hydrogeological unit flow huf package was used in modflow 2005 anderman and hill 2000 to represent detailed stratigraphic profiles in the finite difference grids huf can represent hydrogeological units with variable thickness and distribution while supporting the attribute modeling of numerical layers of uniform thickness langevin et al 2008 in general huf can more effectively describe vertical changes in the hydrogeological properties of the sediments than more traditional approaches by using huf to establish the geometric structure of the hydrogeological units independently of the model layers the hydraulic properties table 2 are directly assigned to hydrogeological units that are geometrically distinct from the model layers rather than to grid cells huf calculates the effective hydraulic properties of each grid according to the top elevation and thickness of the hydrogeological units contained in the grids anderman and hill 2000 2 sources and sinks package the source and sink data used in the conceptual model coverages were mapped to modflow packages of the numerical model table s2 supplementary recharge from both precipitation and irrigation were assigned with the recharge package canal leakage and abstractions were assigned using the well package et was set by the evapotranspiration package drains were defined in the drain package the yellow river is in hydraulic contact with the aquifer and was simulated using the general head boundary ghb package lakes were simulated using the river package boundaries were set using the ghb package 2 3 3 model calibration the hydrogeological parameters were calibrated manually based on data from the 201 long sequence observation wells and the 979 wells where surveillance measurements of groundwater levels were obtained for different years and months calibration was conducted by adjusting several hydrogeological parameters within hydrogeologically reasonable limits until the simulated groundwater levels matched the observed groundwater levels the mean absolute error mae root mean squared error rmse and coefficient of determination r2 were selected as indicators of goodness of fit 2 4 statistical analysis methods detection of shifts in means is the most common method used to identify abrupt change points a regime shift detection analysis rodionov and overland 2005 based on a sequential t test analysis of regime shifts stars was used to statistically detect the regime changes in major sources and sinks such as total inflow water diversions groundwater abstractions and recharge from precipitation during the period from 1990 to 2020 with a target significance level of 0 05 the cut off length and the huber s tuning constant was set to 3 years and 2 respectively table 4 in section 4 1 in addition a pearson correlation coefficients matrix was used to conduct the bivariate correlation analysis of the four above sources and sinks influencing groundwater storage at the significance levels of 0 01 and 0 05 3 results 3 1 calibration of the groundwater flow model fig 4 shows the relationship between simulated and observed hydraulic heads of all observation wells located in layers 1 3 in august 1996 and august 2014 a sharp drop in groundwater storage occurred in 2003 fig 10 c in section 3 3 1 therefore before and after 2003 were selected to represent higher and lower steps in groundwater levels respectively the scattered data points for the two stress periods lie close to the diagonal line mae rmse and r2 were 1 967 m 2 656 m and 0 942 in august 1996 and 1 866 m 2 499 m and 0 972 in august 2014 the error then is acceptable given that the difference between the highest groundwater level and the lowest groundwater level in the entire basin was about 90 m that is after manual calibration the calculated heads were generally consistent with the observed heads during the two typical stress periods of before and after 2003 in other words the model effectively simulated the groundwater dynamics of the modeled aquifers and could reproduce the long term spatial distribution of groundwater levels and the regional characteristics of the hydrogeological processes the calibrated hydrogeological parameters are shown in table 2 typical long term observation wells in both layer 1 and layer 2 of yinchuan city and shizuishan city are shown in fig 5 and fig 6 although the long term trends in observed and computed heads are similar seasonal fluctuations in the computed heads were smaller than the observed heads a further decrease in storage parameters led to dry cells in the top model layer which may be related to seasonal variations in irrigation return flow and groundwater abstractions furthermore there is a large discrepancy between the observed and simulated groundwater levels this discrepancy in the shallow aquifer can mainly be attributed to inaccurate estimations of irrigation return flow and canal leakage in the confined aquifer groundwater abstractions were obtained from annual water resources bulletins which contain large uncertainty 3 2 evolution of regional groundwater levels 3 2 1 inter annual groundwater level dynamics the highest groundwater levels in the shallow aquifer occur in the piedmont pluvial plain in the west and the area of pluvial alluvial fans in the south the main groundwater flow direction is from southwest to northeast and is consistent with the change in topography the groundwater flow direction beneath the piedmont pluvial plain and the pluvial alluvial plain in the west is from west to east interannual variations in groundwater levels were not significant fig 7 the spatial distribution of groundwater levels in the deep aquifers layers 2 3 is overall consistent with that in the shallow aquifer local differences in groundwater levels are primarily associated with concentrated areas of groundwater abstractions in yinchuan city and shizuishan city which have created cones of depression fig 8 in the early 1990s such cones of depression did not exist in shizuishan city however a long term cone began to form in 1995 and with an increase in the pumping rate the area of the cone gradually increased from 9 km2 in the mid 1990s to 80 km2 in 2010 after 2010 the area of the cone in shizuishan city began to gradually decrease and by 2020 it had returned to its size in the 1990s around 2006 two small cones of depression related to groundwater pumping appeared on the east side of shizuishan city and remained stable as for yinchuan city its cone of depression has gradually expanded from an area of 50 km2 in the 1990s to five groups of smaller cones each with an area of about 30 40 km2 in 2020 where irrigation activities occur over the shallow aquifers the seasonal variations in groundwater level were more pronounced than in the deep aquifer over the 30 year period groundwater levels remained relatively stable compared to the deep aquifers the changes in groundwater levels that did occur in layer 1 varied spatially over the area beneath the western piedmont pluvial plain of yinchuan city the groundwater levels continued to decline over the 30 year study period in the shallow aquifer fig 5 a in the eastern part of yinchuan city changes in groundwater levels slowed over the 30 years fig 5 b c in the western section of shizuishan city groundwater levels in the shallow aquifer initially remained stable but have declined between 2000 and 2010 after 2010 groundwater levels gradually recovered to that which existed before 2000 fig 5 d e in the southern part of shizuishan city groundwater in the shallow aquifer declined slowly fig 5 f in deep aquifers layers 2 3 where groundwater exploitation is concentrated the groundwater levels declined continuously with less seasonal variation compared to the shallow aquifers in the vicinity of the well fields west of yinchuan city the groundwater levels gradually recovered from 1090 m in the 1990s to 1100 m in 2020 fig 6 a north of yinchuan city the groundwater level declined slowly before 2005 but from 2005 to 2020 the groundwater level dropped sharply and were superimposed on by relatively small seasonal fluctuations fig 6 b in the northeastern part of yinchuan groundwater levels remained stable fig 6 c the groundwater levels in the deep aquifer south of shizuishan city declined continuously fig 6 d within the cone of depression in the western part of shizuishan city the groundwater level in the deep aquifer decreased from 1990 to 2010 since 2010 it has begun to recover to the level before 2000 fig 6 e f 3 2 2 seasonal groundwater level variations the seasonal variations in groundwater levels in the shallow layer were generally higher than that in the deep aquifers the average amplitudes of groundwater level fluctuations in the central and northern parts of the study area were about 2 m and 1 5 m respectively larger amplitudes of variation 4 m occur in the south most likely in response to a larger amount of irrigation which allows significant excess irrigation return flow to infiltrate and replenish the shallow groundwater the annual variations in groundwater levels water diversions zhao et al 2015 the irrigation period precipitation and evapotranspiration are compared for well 1 7 in fig 9 as an example of the changes in the shallow aquifer the annual dynamics of the groundwater levels in the irrigated area are significantly affected by the irrigation activities and water diversion processes for example seasonal fluctuations in groundwater levels in the shallow aquifer are temporally consistent with the cycle of irrigation and water diversions from the yellow river and can be subdivided into four stages 1 a period of no irrigation that occurs before the beginning of spring irrigation december to march the groundwater is at the lowest levels 2 a period of irrigation which begins with the onset of water diversions in late april at which time groundwater levels begin to rise the amount of water diverted from the yellow river increases in may and august resulting in the highest groundwater levels which correspond to a period of maximum irrigation 3 an intermittent period of irrigation in late september and late october during which the amount of water diversions from the yellow river decreases and groundwater levels begin to drop and 4 a period of winter irrigation extending from late october to late november winter irrigation is carried out for soil salt leaching and moisture storage the groundwater level rises again to a level similar to that during the irrigation period of the four factors discussed above the correlation between the groundwater levels and water diversions is strongest with a correlation coefficient of 0 928 which is significant at the 0 01 level table 3 climate factors show moderate correlation with groundwater levels and water diversions and are significant at the 0 05 and 0 01 level respectively recharge from precipitation may contribute to higher groundwater levels during the rainy season however relatively high evapotranspiration should result in lower groundwater levels therefore climate factors have less effect on groundwater levels the seasonal fluctuations in groundwater levels exhibited the same pattern throughout the study area however the amplitude of the groundwater level fluctuations varied spatially this spatial variation was mainly attributable to recharge and hydrogeological conditions and could be subdivide into specific areas including 1 the alluvial lacustrine plain where irrigation is widespread the intra annual dynamics of the shallow groundwater levels are mainly affected by irrigation and water diversions in the central and southern part of the basin and levels are dependent on irrigation the amplitude of the groundwater fluctuations is relatively large 2 an area in the northern part of the catchment where downstream irrigation occurs and the amplitude of the changes in groundwater levels are relatively low due to the shallow depth of groundwater in the northern region the amount of evapotranspiration is large 3 in areas of non agricultural irrigation such as in the piedmont pluvial plain and urban areas the magnitude of the groundwater level fluctuations in the shallow aquifer is small in the piedmont area the groundwater level is deep and evapotranspiration is small in addition a large transmissivity and hydraulic gradient primarily generate horizonal flow so seasonal variations in groundwater levels are small in urban areas land cover is often impermeable limiting precipitation infiltration thus the fluctuations in groundwater levels are also small 4 the groundwater level dynamics in most areas with deep aquifers exhibit relatively small interannual and seasonal fluctuations however in areas of concentrated pumping yinchuan city and shizuishan city the groundwater levels vary with pumping rates 3 3 groundwater budget 3 3 1 water budget components and change in groundwater storage the simulated groundwater budget for the period between 1990 and 2020 table s3 fig 10 a shows that recharge from irrigation return flow and canal leakage is the main inflow component to the groundwater system accounting for about 70 of the total recharge the other inflow components include lateral flow from the western border and recharge from precipitation major groundwater outflows include groundwater withdrawals from shallow and deep aquifers evapotranspiration and drain discharges which collectively account for approximately 90 of the total outflows from 1990 to 1999 the annual amount of water diverted from the yellow river increased steadily in riparian provinces as a result discharge in the yellow river was significantly reduced to alleviate severe shortages in water resources the yellow river water conservancy commission officially launched a unified scheduling program of water diversions from the yellow river in march 1999 since 2000 the amount of water diversion from the yellow river has strictly followed water allocation regulations and the diversion of water from the river has started to decline fig 10 b the inflow of water from the upper reaches of the yellow river reached its lowest value in 2003 a dry year which led to a sharp decline in water diversions since 2004 the rate of decline has slowed recharge of the groundwater system and water diversions are highly correlated see section 4 1 the trend visible in the time series of total inflow is mainly associated with the variability in irrigation return flow recharge and canal leakage lateral inflow from the western boundary along the helan mountains has been relatively stable groundwater abstractions increased in the periods of lower water diversions fig 10 a b water diversions dropped dramatically in 2003 and reached another low after 2016 conversely groundwater abstractions increased during these two periods groundwater outflows were largely dependent on inflows and overall trends and fluctuations between the two were similar the relation between the two is probably related to the dense distribution of drains in the yinchuan basin and the use of traditional modes of irrigation that involves large scale water spreading and large drainages the discharge from these drains accounts for a large proportion of the total outflow and is consistent with trends in water diversions fig 10 b within a given year the discharge from drains was proportional to the irrigation water use since 2000 groundwater storage has declined significantly that is the total outflow is greater than the total inflow fig 10 c the cumulative depletion in storage has continuously increased during the 30 year study period since 2014 the depletion in groundwater storage has become even more rapid by 2020 the depletion in groundwater storage had reached 1 89 109 m3 3 3 2 water exchange between groundwater and surface water over the entire basin discharge of groundwater to the yellow river is greater than the recharge of groundwater from the yellow river fig 11 the continuous increase in irrigation between 1990 and 2000 increased groundwater levels in most parts of the study area and gradually increased the discharge of groundwater to the yellow river after 2000 with the gradual reduction in irrigation water the discharge of groundwater to the yellow river gradually decreased the amount of groundwater recharge from the yellow river was relatively stable before 2017 after 2017 the increase in groundwater abstractions and the lowering of the groundwater levels led to an increase in groundwater recharge from the yellow river the discharge of groundwater to lakes is lower than the recharge of groundwater from lakes lakes in the yinchuan basin simultaneously receive groundwater inflow from one portion of the shoreline and recharge the groundwater system along the other therefore all lakes are flow through lakes fig 12 the largest amount of groundwater recharge is from mingcui lake located in the eastern part of yinchuan city since 2012 outflow to groundwater from all of these lakes except sha lake and gaomiao lake have substantially increased fig 13 a the increased outflow to groundwater near these lakes is related to the increase in groundwater abstractions near these lakes and the establishment of several new well fields in the eastern part of yinchuan city the water levels of the lakes are maintained through water diversions from the canals as the difference between lake level and the groundwater level increases groundwater recharge by these lakes increases due to the relatively low groundwater abstractions near xinghai lake gaomiao lake and sha lake the groundwater recharge from these three lakes remained relatively stable the amount of discharge from groundwater to mingcui lake yuehai lake and sha lake decreased over the study period the discharge from groundwater to the rest of the four lakes remained relatively stable fig 13 b compared with the overall groundwater budget of the yinchuan basin the amount of groundwater surface water exchange is small however these groundwater and surface water interactions have significant environmental consequences for example the gradual reduction of groundwater recharge and the increase in groundwater abstractions may result in lake leakage which in turn can lead to a shrinkage in lake area or even dry lakes to maintain the area and the ecological conditions of the lakes water diversions are required to maintain lake water levels in particular in mingcui lake xinghai lake and yuehai lake 4 discussion 4 1 the causes of stepped trend in the groundwater budget water diversions groundwater abstractions and recharge from precipitation were analyzed by regime shift analysis and correlation analysis as potential factors controlling the temporal changes in groundwater resources the temporal trends in irrigation return flow and canal leakage were similar to the water diversions from the yellow river therefore this study analyzed the effect of agricultural irrigation activities on groundwater recharge on the basis of the water diversions from the yellow river rather than irrigation return flow and canal leakage the trend in the mean total annual inflow abruptly dropped in 2003 fig 14 a the average values of the steps before 2003 and after 2003 were 14 24 108 m3 a and 11 92 108 m3 a respectively table 4 before 2003 water diversions exhibited a similarly high value which abruptly changed in 2003 fig 14 b that is the reduction in total inflow and groundwater storage from 1990 to 2016 was dominated by a decline in available water diversions from the yellow river fig 14 a b in contrast to the trend in total inflow the step trend of water diversions showed another sharp drop in 2016 in other words a three step trend was identified where the average values of each step are 62 29 108 m3 a 46 92 108 m3 a and 38 89 108 m3 a the groundwater abstractions for agriculture exhibit a two step trend the shift point occurs in 2017 the average abstraction volumes during the two periods were 5 02 108 a m3 before 2017 and 5 91 108 m3 a after 2017 we hypothesize that groundwater abstractions were increased from 2017 fig 14 c to compensate for a shortage in water demand that resulted from the reduction in water diversions from the yellow river since 2016 fig 14 b as a result the drop of total inflow from 2016 fig 14 a was not significant in combination the trends show that water diversions from the yellow river have had a decisive impact on the total inflow the impact of total inflow since 2016 is collectively determined by water diversions and groundwater abstractions most of the precipitation in the yinchuan basin is concentrated from may to september regime shift detection was unable to identify step trends in precipitation infiltration during the study period fig 14 d suggesting that the long term trend in total inflow was not significantly affected by recharge from precipitation a bivariate correlation analysis was used to calculate the correlation coefficients among total inflow water diversions abstractions and recharge from precipitation table 5 the pearson correlation coefficient between total inflow and water diversion is 0 965 a strong correlation which is significant at the 0 01 level the correlation suggests that water diversion is a decisive factor controlling groundwater recharge the pearson correlation coefficient between abstractions and water diversions is 0 428 which is significant at the 0 05 level when water diversions decrease groundwater abstractions increase to meet water demands however recharge from precipitation does not exhibit a significant correlation with total inflow water diversions or abstractions at a significance level of 0 05 this is presumably because recharge from precipitation only affects the short term interannual fluctuations of total inflow which mainly reflects the difference between precipitation recharge in wet and dry years water diversions are mainly policy controlled thus diversions are only weakly correlated with recharge from precipitation 4 2 adaptation for a reduction in river water diversions with increased urbanization between 1990 and 1999 the consumption of water for domestic needs and industrial activities have increased significantly along with the use of water for irrigation the amount of total groundwater abstractions and the amount of water diverted from the yellow river increased simultaneously the implementation of the national western development strategy in 2000 led to an increase in both population and water demand since then the gradual reductions in water diversions have not been sufficient to meet the growing water demand fig 15 total groundwater abstractions has been slowly growing to deal with the shortage of water resources caused by the reduction of water diversions from the yellow river in 2003 and during 2016 2020 the amount of water taken from the yellow river reached its lowest value as a result there were sharp increases in groundwater abstractions in these particular years groundwater abstractions by different users showed different trends the relatively low groundwater abstractions for rural water supplies remained stable for 30 consecutive years groundwater abstracted from centralized well fields for industrial and urban water supplies accounted for the largest proportion of total abstractions which is in line with the growth in total abstractions with the exception of 2003 urban and industrial water use was restricted by the sharp drop in water diversions the abstractions of groundwater for agriculture remained stable before 2003 but to compensate for the shortage in agricultural water caused by the sharp drops in river water diversions in 2003 and during 2016 2020 groundwater abstractions for agriculture increased sharply fig 15 therefore an indirect inverse relationship exists between the agricultural abstractions of groundwater and the water diversions from the river fig 10 b c fig 15 it is worth noting that after 2004 the amount of water diverted from the yellow river decreased but agricultural abstractions did not increase significantly we speculate that after the unified regulation of water diversion from the yellow river in 2000 and the extreme drought year in 2003 the yinchuan basin began to implement large scale crop pattern adjustments and agricultural water saving measures to reduce the agricultural water demand water saving irrigation projects have been carried out since 2000 for example the crop pattern for the entire ningxia region was adjusted nsb 1991 2020 resulting in a reduction in summer grain crops e g wheat and an increase in autumn grain crops e g corn these changes in crop patterns reduce irrigation water requirements fig 16 farmers have also 1 reduced the planting area of crops with high water consumption and low efficiency e g wheat 2 maintained the planting area of rice and 3 developed water saving irrigation for rice cultivation moreover farmers have expanded the area of crops with lower water consumption including drought tolerant crops e g autumn corn forage grass and herbs and crops using water saving irrigation techniques e g vegetables melons and fruits the total cultivation area increased before 2010 and remained stable after 2010 in addition water saving irrigation techniques have been improved for example the irrigation of wheat and corn was changed from flood irrigation to furrow irrigation micro irrigation has also been developed for vegetables melons and fruits and sprinkler irrigation has been developed for forage grass at present the leakage of water from the canal system accounts for a large proportion of water loss in the future the water diversions of the yellow river will continue to decrease we therefore suggest that the anti leakage treatment of the canal system should be further strengthened and the main canals combined to reduce the leakage losses of water during its delivery to agricultural fields 4 3 limitations there are a number of limitations to the model developed in this study first hydrogeological parameters e g k and ss vary with depth however the values of each hydrogeological parameter in each lithology geological unit were assigned uniformly by the huf package for the differing depths considered in this model in addition there is a lack of hydrogeological parameter data for the deep aquifer materials depths greater than 300 m thus we assumed that the values of the hydrogeological parameters of the lithologic units at different depths are the same second the depths of long term groundwater level observations available for model calibration are limited and most observations were at depths of less than 300 m third the model was constructed for monthly stress periods while the actual data were collected on an annual scale the seasonal variations of each item e g recharge from irrigation return flow canal leakage were based on the proportion of water diversions in different months zhao et al 2015 which may result in uncertainties in the seasonal fluctuations of the computed heads fourth because maps of crop patterns for different years are not available the zonation of irrigation return flow was conducted according to the administrative division land use and soil type in addition the infiltration coefficient of irrigation water in different years was assumed to be a fixed value within the same zone as was the effective utilization coefficient fifth since data describing the degree to which the canals were lined in different years were not available the leakage coefficient of the canals in different years was assumed to be a fixed value within the same zone as was the effective utilization coefficient sixth due to the lack of hydrogeological boreholes in the piedmont of the helan mountains the lateral recharge along the piedmont boundary was assumed on the basis of the hydraulic gradient between the boreholes in the front of the alluvial fans the above limitations have presumably led to uncertainty in parameter calibration and bias in the model results to address all the limitations mentioned investigations will be conducted in the future to improve the model thereby increasing its ability to assess the mechanisms of deep groundwater flow dynamics and the prediction of future changes in the groundwater system despite these limitations our present results provided general patterns of groundwater flow dynamics under the effects of human activities and climate change 5 conclusions changes in the environment have profound effects on the evolution of hydrogeological processes especially in arid and semi arid regions documenting the response of a regional groundwater system to human activities and climate change is a challenge a long term transient groundwater flow model can be used to reconstruct historical changes in hydrogeological processes and quantify the interaction between groundwater and surface water systems the main conclusions from this study are as follows 1 groundwater storage was continuously depleted over the 30 year 1990 2020 study period reaching a cumulative depletion of 1 89 109 m3 irrigation return flow and canal leakage were the main sources of recharge to the groundwater system the main groundwater outflows included groundwater abstractions drain discharge and evapotranspiration 2 hydrogeological processes were mainly affected by human activities in the yinchuan basin human activities particularly water diversions from the yellow river dominated the long term trend in groundwater storage climate only affected short term interannual fluctuations in groundwater storage 3 in most years the computed groundwater budget shows that recharge from surface water to groundwater was lower than that from groundwater to surface water the continuous decline in groundwater levels during the 30 year study period led to an increase in the amount of groundwater recharge from the yellow river and lakes conversely the amount of groundwater discharged to the yellow river and lakes has continued to decrease there is an increasing requirement for artificially supplied water to lakes to maintain their water levels 4 water diversions from the yellow river has dropped since 2000 resulting in a continuous reduction in groundwater recharge and storage the amount of groundwater abstractions increased when water diversions from the yellow river were insufficient to meet the water demand water saving irrigation and adjustments to the crop pattern were implemented to reduce the requirements for irrigation in the yinchuan basin a representative arid and semi arid area of northern china groundwater is being depleted and the ongoing development is not sustainable groundwater resources are more vulnerable to policy changes pertaining to water diversions and land use change than climate factors the risk of future groundwater depletion may likely come from human impacts such as policies governing surface water diversions and groundwater abstraction intensity this study not only documented the temporal and spatial variations in groundwater levels in a typical arid and semi arid area of northwest china but also evaluated the impact of human activities on the groundwater system the dynamic response in groundwater levels irrigation patterns and groundwater abstractions to the change in water diversions from the yellow river was evident the results will enable water managers to predict future changes in groundwater levels and storage caused by changes in land use and water diversions through scenario analysis it can also provide insights for creating sustainable management plans in other arid and semi arid regions credit authorship contribution statement jie li data curation writing original draft writing review editing yangxiao zhou funding acquisition supervision writing review editing wenke wang funding acquisition supervision writing review editing sida liu writing review editing ying li data curation investigation ping wu data curation investigation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgment this study was funded by the national natural science foundation of china grant no 42130710 the natural science basic research program of shaanxi province grant no 2021jcw 16 and the the investigation and evaluation on the development and utilization of groundwater resources and the effect of ecological environment protection along the yellow ecological economic zone project of the ningxia finance department grant no 6400201901273 the first author is grateful to the china scholarship council no 202006560048 we are thankful for the technical support by prof fusheng hu from china university of geosciences beijing and dr feilong jie from xi an university of technology the authors are grateful to the editors and two anonymous reviewers for their valuable comments and suggestions which helped to improve the manuscript appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 128619 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
2655,the sustainable development of groundwater resources in arid and semi arid regions is a challenging task hindered by climate change and human activities the rational utilization and management of groundwater resources is therefore dependent on an understanding of the influences of human and climatic factors on the spatial distribution of groundwater resources and their change over time the thick quaternary aquifers in the yinchuan basin china were used herein as an example of how to quantitatively assess spatial and temporal trends in groundwater resources in response to human activities and climate change a 3d transient groundwater flow model was constructed and used to simulate the evolution and spatial variability of hydrogeological processes from 1990 to 2020 by subsequently applying regime shift detection and correlation analysis to the simulation results we found that 1 groundwater storage was continuously depleted over the 30 year period reaching a cumulative depletion of 1 89 109 m3 2 human activities were mainly responsible for variations in regional hydrogeological processes for a period of up to 30 years climate only affected short term interannual fluctuations in groundwater storage 3 human activities e g river water diversion and groundwater abstractions were the decisive factors causing a continuous reduction of groundwater resources a policy driven reduction in water diversion from the yellow river directly led to a significant drop in groundwater storage which had a consequent effect on surface water and groundwater interactions and altered agricultural irrigation patterns crop patterns and irrigation methods 4 the amount of groundwater recharge from the yellow river and local lakes increased from 1990 to 2020 whereas the discharge of groundwater to the yellow river and lakes decreased keywords quaternary sediments yinchuan basin numerical groundwater flow model human activities climate change surface water groundwater interactions data availability the authors do not have permission to share data 1 introduction groundwater is a crucial component of regional water cycles and plays a vital role in regional socio economic development and ecosystem conservation especially in arid and semi arid regions characterized by scarce precipitation and surface water resources strong evapotranspiration and fragile ecosystems groundwater is not only an important source of domestic industrial and agricultural water but is also critical for maintaining ecosystems in arid areas wang et al 2021a for example the growth of natural vegetation often depends on phreatic evapotranspiration and the maintenance of the water levels volumes and areas of rivers and lakes depends on the balance between groundwater recharge and discharge li et al 2020a ma et al 2022 zhou et al 2020 in recent decades the impact of global climate change and human activities associated with rapid socio economic development on hydrogeological processes has become increasingly prominent changes in climatic factors e g precipitation and evapotranspiration and human activities e g agricultural irrigation and groundwater abstractions have the potential to substantially affect hydrogeological processes and mechanisms fu et al 2019 liu et al 2022 meixner et al 2016 nofal et al 2019 ramos et al 2020 shamir et al 2015 taylor et al 2013 vrzel et al 2019 xu and su 2019 climate factors including precipitation and evaporation affect groundwater systems by altering the interactions between groundwater and surface water bodies e g lakes and rivers as well as by affecting recharge processes carlson et al 2011 jyrkama and sykes 2007 human activities in contrast directly impact groundwater through the exploitation of groundwater resources and or their influence on groundwater recharge in addition human activities may indirectly affect groundwater recharge discharge as land use cover is altered during the implementation of agricultural development projects and or by urbanization among other activities zhang et al 2014 such human induced disturbances may lead to a sharp drop in groundwater levels a change in the water cycle and or a deterioration of groundwater quality sekhar et al 2013 in semi arid farmlands irrigation return flow and canal leakage may greatly contribute to groundwater recharge jimenez martinez et al 2010 especially when a large amount of water from a perennial river supplies the irrigation systems vallet coulomb et al 2017 therefore groundwater flow and storage can change in response to alterations in agricultural irrigation land use and water demand in this context maintaining the long term balance of groundwater systems is critical to supporting a sustainable economic and ecological environment fu et al 2019 given the complexity of the system and the wide range of factors that may impact groundwater systems the sustainable management of groundwater resources is an arduous issue that requires an evaluation of hydrogeological processes an analysis of natural and anthropogenic drivers and an understanding of the mechanisms controlling the regional water cycle understanding the impacts of environmental change on groundwater systems requires on the one hand an assessment of the evolution of the numerous interacting hydrogeological variables that control the groundwater system e g river stages lake water levels and lateral boundary flow on the other hand it is necessary to evaluate alterations in climate and human activities that represent the primary controls on groundwater e g precipitation evapotranspiration crop patterns the intensity of extraction and water allocation policy however the proper evaluation of different types of variables is often complex and indistinguishable as they are related to multiple physical factors with high temporal and spatial variability pulido velazquez et al 2015 to address such research needs a wide range of approaches have been applied including water balance methods li et al 2020a statistical analyses hou et al 2022 wang et al 2018 integrated hydrological modelling mikeshe gsflow feng et al 2018 and numerical groundwater models liu et al 2021 ramos et al 2020 wang et al 2021b zhou et al 2020 integrated hydrological modelling is often difficult to apply to large areas because of its extensive requirements for surface information and surface water parameters it is also difficult to achieve a high level of accuracy with such hydrologic models numerical groundwater simulations are commonly used to evaluate the response of groundwater flow processes to climate change and anthropogenic disturbances a transient groundwater flow model that describes the heterogeneous structure of the aquifer can provide important insights for the accurate evaluation regulation and management of groundwater resources however it is a challenge to characterize the heterogeneity of complex multi layer hydrogeological structures in finite difference grids with reasonable partitioning and stratification burns et al 2010 the hydrogeologic unit flow package huf anderman and hill 2000 of modflow 2005 harbaugh 2005 hill et al 2000 can address this challenge huf allows hydrogeological units to be defined independently of model layers eliminating the need to determine how to delineate model layers to match highly heterogeneous structures the yinchuan basin is an important food production area located in the arid and semi arid region of northwest china due to the lack of local surface water resources and precipitation socio economic water demand mainly depends on the diversion of water from the yellow river more frequent droughts accompanied by a reduction in river flows have resulted in a lower water supply as a result groundwater abstractions from local and regional aquifers now serve as a secondary and stable source of water in the yinchuan basin moreover during the past 30 years the yinchuan basin has experienced accelerated urbanization and sustained population growth nsb 1991 2020 in 1990 9 4 million people lived in the yinchuan basin the population had grown to 11 1 million 15 7 million and 17 5 million by 2000 2010 and 2019 respectively nsb 1991 2020 as a result the demand for groundwater for domestic industrial and agricultural purposes have and continue to increase moreover changes in the mechanisms of water diversion irrigation and land use may have substantially modified hydrogeological processes therefore the groundwater system of the yinchuan basin appears to be very sensitive to human activities recent reductions in yellow river discharges as a result of climate change and intensive human activities have also raised concerns about water availability in the yinchuan basin of particular concern is the amount of water that can be allocated from the yellow river and the exploitable amount of groundwater in the coming years to ensure the sustainable utilization of water resources in the yinchuan basin it is necessary to investigate the simultaneous response of hydrogeological processes to long term human activities and climate factors and to assess trends in the changes in groundwater recharge processes over time and space nofal et al 2019 previous water balance calculations and numerical groundwater simulations in the yinchuan basin have mainly focused on one or several temporal hydrological years in which the exploitable amount and pollution potential of groundwater were the main concern li et al 2020b qian et al 2012 xu et al 2015 the groundwater response to long term changes in climate and human activities and the complex interactions between the groundwater and surface systems have not been systematically studied this study adopts a transient groundwater flow simulation based on the modflow model to assess the long term hydrogeological processes and the factors controlling these processes within the thick unconsolidated quaternary aquifers of the yinchuan basin from 1990 to 2020 the main objectives of the study are to 1 detect the temporal and spatial trends in hydrogeological processes 2 identify the trends and abrupt change points in climate change human activities and hydrogeological processes 3 evaluate groundwater dynamics under the influence of natural forces climate and human related forces human activities and 4 explore the response of groundwater surface water interactions to long term human activities and climate factors the results of this study provide science based information for the rational development of groundwater resources help to design effective measures to cope with the impact of climate change and human activities and formulate appropriate sustainable groundwater management plans in arid and semi arid basins 2 materials and methods 2 1 study area the yinchuan basin is located in the northern ningxia hui autonomous region of china fig 1 it is bounded by qingtongxia canyon to the south the ordos platform to the east and the helan mountains to the north and west the basin varies in width from 10 to 60 km and possesses a long axis oriented nearly in a south north direction that is 181 km in length the basin covers an area of approximately 7088 km2 and has an elevation that ranges between 1100 m and 1300 m above sea level topography dips gently from southwest to northeast structurally the yinchuan basin is a fault controlled basin developed during the cenozoic era high subsidence rates within the basin have allowed for the enhanced deposition of unconsolidated quaternary sediments han et al 2013 which reach about 1700 m in thickness within the center of the basin these sediments become thinner towards the basin s margins yang et al 2018 geomorphologically the yinchuan basin can be subdivided into three topographic units each of which is associated with a distinct sedimentary sequence 1 a piedmont pluvial plain underlain predominantly by coarse gravel sized sediments 2 a pluvial alluvial plain underlain by sandy gravel sized sediments and 3 an alluvial lacustrine plain underlain by relative fine sediments consisting primarily of sand silt and clay fine grained sediments dominated by sandy clays are generally found along the piedmont pluvial front the yinchuan basin is characterized by arid and semi arid conditions that are associated with a continental climate with sufficient sunshine little rainfall and strong evapotranspiration climatic data within the yinchuan basin have been collected from 1990 to 2019 at the yinchuan station fig 2 the mean annual precipitation is about 186 mm a with most rains occurring from may to september the mean annual evapotranspiration is about 1748 mm measured with a 20 cm evaporating dish e601 most evapotranspiration occurs between april and september the annual evapotranspiration is about 10 times the annual precipitation the monthly mean temperatures range from 7 to 24 c the yellow river is an important perennial river that flows through the yinchuan basin from southwest to northeast it is the most important source of irrigation water irrigation return flow serves as a major source of groundwater recharge mi et al 2020 due to the unique geological structure climate and hydrogeological characteristics of the yinchuan basin an underground reservoir of pore water exists within the thick unconsolidated quaternary sediments in the basin groundwater is mainly recharged by irrigation return flow canal leakage precipitation infiltration and lateral groundwater runoff from the foothills of the helan mountains groundwater is also recharged directly from the yellow river where the river stage is above the groundwater level groundwater is discharged into surface water bodies including the drains the yellow river and lakes or is lost via other outflow components including evapotranspiration and abstractions among these flow routes irrigation return flow and drainage are the most important components effecting recharge and discharge of the groundwater system the dominant groundwater flow direction in the study area is generally from the southwest to the northeast and is characterized by hydraulic gradients that exceed 0 04 beneath the northern alluvial lacustrine plain groundwater flows to the northeast under a hydraulic gradient lower than 0 04 due to the area s flat lying topography before flowing into the yellow river han et al 2013 except within the piedmont pluvial plain the groundwater table in most parts of the basin is less than 3 m below the ground surface qian et al 2014 most of the lakes in the study area are distributed along linear depressions that represent the old route of the yellow river these lakes possess an obvious oxbow morphology other lakes are distributed in depressions in front of or between alluvial fans and are irregularly shaped zhang 2007 most of the land in the yinchuan basin is cultivated for irrigated crops consisting mainly of rice wheat and corn to compensate for the lack of rainfall the crops are irrigated during the growing season with waters diverted mostly from the yellow river additional irrigation water is obtained from groundwater withdrawals water from the yellow river is transported from south to north to farmland through a canal system irrigation return water from the farmland is ultimately discharged back into the yellow river through a network of drains numerous water conservancy projects have been implemented in the area most of which were constructed in the 1960s and 1970s the constructed projects were restricted by economic conditions at the time thus the loss of diversion water by leakage is large the region s convenient water diversion conditions favoured the use of traditional flood irrigation in the study area an approach that is characterized by large water diversions and drainage large scale water diversions for irrigation have also resulted in increased groundwater recharge and groundwater resources that have maintained local lakes and wetlands therefore surface water and groundwater are closely related leading local residents to say that the water of the yellow river enriches ningxia which comes in the form of local economic development however as a result of the diversions runoff in the yellow river declines significantly after it flows through the yinchuan basin 2 2 construction of a conceptual hydrogeological model development of the conceptual model consisted of three steps 1 construction of a 3d lithological model 2 creation of conceptual model coverages and 3 mapping of the conceptual model to modflow numerical model packages 2 2 1 a three dimensional lithological model a 3d lithological model of the study area was built using an integrated approach that had previously been used to construct a hydrogeological structure model of the basin s thick unconsolidated sediments li et al 2021 the 3d lithological model is based on multiple sources of data including borehole surface elevation data borehole lithology data audio frequency magnetotelluric data amt and lower boundary elevation data for the quaternary sediments that were integrated using several methods including sequential gaussian simulation and natural neighbor interpolation the integrated geological model reproduces the spatial heterogeneity of the basin s geometric features and repeated geometric patterns 2 2 2 conceptual model coverages the groundwater modeling system 10 4 gms10 4 was used to create conceptual model coverages including 1 boundary coverages arcs and properties the boundaries of the first layer in the yinchuan basin were defined as general head boundaries the western boundary adjacent to the helan mountains was set as a highly permeable boundary that receives a supply of bedrock fissure water and terrestrial flood flows from the mountains the boundaries to southwest and south were defined as weakly permeable boundaries associated with alluvial fans and a delta respectively the boundaries for layers 2 11 were generalized as no flow boundaries a no flow boundary was also adopted for the bottom of the quaternary sediments fig 3 2 sources sinks coverages a recharge from precipitation areal recharge coverage monthly precipitation data between 1990 and 2020 from 10 meteorological stations fig 1 were obtained from the ningxia meteorological bureau thiessen polygons were used to calculate the control area of the 10 meteorological stations the corresponding infiltration coefficients table 1 were then assigned to different soil types and land use types on the basis of the soil zonation map of the vadose zone obtained from the institute of hydrogeology and environmental geology of ningxia the recharge rate from precipitation was then calculated based on different zones using the following equation 1 p r i p where pr m d is the recharge rate from precipitation p m d is the monthly precipitation rate and i dimensionless is the infiltration coefficient of the different soil types b irrigation return flow areal recharge coverage the zonation of irrigation return flow was based on an interpretation of administrative divisions soil types and land use types as determined from a u s landsat 30 m resolution image of the yinchuan basin acquired in 2018 xu et al 2018 the recharge rate for irrigation return flow was calculated as 2 i r u i w a where ir m d is the recharge rate of irrigation return flow u dimensionless is the effective utilization coefficient of field water i dimensionless is the infiltration coefficient of the different soil types w m3 d is the monthly agricultural water utilization from both the yellow river and groundwater and a m2 is the area of each zone the agricultural water intake for each administrative division was obtained from the ningxia water resources bulletin nwrd 2000 2020 c canal leakage specified flow coverage the leakage rates of the canals fig 3 were calculated by 3 c l d i 1 c u c i where cl m3 d is the recharge rate from canal leakage di m3 d is the monthly water diversion from the yellow river cu dimensionless is the effective utilization coefficient of canal water and ci dimensionless is the infiltration coefficient for the canals water diversions of each canal were obtained from the ningxia water resources bulletin nwrd 2000 2020 d groundwater abstractions well coverage two types of groundwater abstractions were included in the coverages the first is the centralized abstractions from the deep aquifer layers 2 3 which was mainly used for industrial and urban water supplies the second includes abstractions from the shallow aquifer layer 1 2 these abstractions were primarily conducted through scattered wells including hand and motor operated wells the water from these wells is mainly used for agriculture and as a rural water supply where the pumping rate of a well field was not available the pumping rate was defined as the allowable pumping rate of the well field the allowable pumping rate specifies the maximum daily pumping rate for each well field the pumping rates of scattered wells were assigned to the model according to the administrative division the pumping rate of each administrative division was obtained from the ningxia water resources bulletin nwrd 2000 2020 e evapotranspiration et coverage the evapotranspiration rate of groundwater was estimated on the basis of calculated surface evapotranspiration as determined from a mod16 data set zonation was then conducted on these estimates of evapotranspiration rate the extinction depth of phreatic evapotranspiration was set as 3 1 m the elevation of the et surface was set as the land surface elevation f discharge from drainages drain coverage excess irrigation water was drained and discharged to the yellow river fig 3 drains were assigned a bottom elevation of 3 m below the surface the conductivities of all drains were set to 12 m d g the yellow river general head coverage the monthly stages of the yellow river as recorded at the qingtongxia and shizuishan stations were obtained for the period of 1990 to 2020 the monthly yellow river stages in 2000 were also collected from 5 additional gauging stations yesheng wuduizi shiba hongyazi and gaorenzhen the conductance of the riverbed material was set to 0 06 m2 d m h lakes river coverage the location and geometry of 7 lakes with an area greater than 2 96 km2 fig 1 in the study area were extracted from remotely sensed images xu et al 2018 the conductance of the lakebed material was set to 0 01 m2 d m2 to maintain the stability of the ecological environment the government replenishes the lakes through water diversions from the yellow river therefore the lake areas water depths and water surface elevation of the 7 lakes are relatively stable and were set as fixed values in our model the head stages and bottom elevations were based on survey data of average lake depth collected by the institute of hydrogeology and environmental geology of ningxia the general characteristics of the 7 lakes are shown in table s1 in supplementary 3 hydrogeological unit properties the initial hydraulic conductivities horizontal and vertical were assigned to each hydrogeological unit according to the results of pumping tests gsin 2016 the initial specific storages and initial specific yields of each material were based on the handbook of hydrogeology cgs 2012 those parameters were then calibrated in the model table 2 4 observation coverage data from 201 long term observation wells near yinchuan city and shizuishan city from 1990 to 2019 were obtained from the ningxia water resources department groundwater levels were measured monthly in most of these wells in addition surveillance measurements of groundwater levels were obtained for a large number of production and observation wells in total data were available for 1180 wells distributed in layers 1 3 2 3 construction of the numerical model the transient groundwater flow model was established using modflow 2005 harbaugh et al 2017 harbaugh 2005 in 1990 the observed groundwater levels were relatively stable and precipitation was abundant therefore a steady state simulation for the year 1990 was first performed to conduct a preliminary calibration of hydrogeological parameters and determine the initial heads for the transient simulation covering the period from 1990 to 2020 2 3 1 model grid and stress period a total of 372 monthly stress periods were defined for the simulated interval of january 1990 to december 2020 the y north south and x west east directions were evenly discretized with a fixed grid size of 1000 m by 1000 m this created a model grid of 181 rows and 87 columns eleven layers were chosen for the model in the z vertical direction the surface elevation and bottom elevation of the model were determined by the 3d geological structure model developed by li 2021 the areal extension of the model layers was truncated by the bottom elevation of the basin aquaveo 2017 since the bottom of the model is bowl shaped the number of grids within each model layer decreases sequentially from the top to the bottom the first layer contains 7185 grid cells the second layer contains 6891 grid cells the 11 layers in total contain 34 236 active grid cells the first layer was set as unconfined whereas the remaining layers were set as confined 2 3 2 model packages 1 flow package hydrogeological unit flow package huf the study area is characterized by fluvial lacustrine sedimentary facies including river channel and flood deposits that exhibit complex and highly heterogeneous geometries which appear in repeated patterns friend 1983 gibling 2006 miall 2006 the hydrogeological unit flow huf package was used in modflow 2005 anderman and hill 2000 to represent detailed stratigraphic profiles in the finite difference grids huf can represent hydrogeological units with variable thickness and distribution while supporting the attribute modeling of numerical layers of uniform thickness langevin et al 2008 in general huf can more effectively describe vertical changes in the hydrogeological properties of the sediments than more traditional approaches by using huf to establish the geometric structure of the hydrogeological units independently of the model layers the hydraulic properties table 2 are directly assigned to hydrogeological units that are geometrically distinct from the model layers rather than to grid cells huf calculates the effective hydraulic properties of each grid according to the top elevation and thickness of the hydrogeological units contained in the grids anderman and hill 2000 2 sources and sinks package the source and sink data used in the conceptual model coverages were mapped to modflow packages of the numerical model table s2 supplementary recharge from both precipitation and irrigation were assigned with the recharge package canal leakage and abstractions were assigned using the well package et was set by the evapotranspiration package drains were defined in the drain package the yellow river is in hydraulic contact with the aquifer and was simulated using the general head boundary ghb package lakes were simulated using the river package boundaries were set using the ghb package 2 3 3 model calibration the hydrogeological parameters were calibrated manually based on data from the 201 long sequence observation wells and the 979 wells where surveillance measurements of groundwater levels were obtained for different years and months calibration was conducted by adjusting several hydrogeological parameters within hydrogeologically reasonable limits until the simulated groundwater levels matched the observed groundwater levels the mean absolute error mae root mean squared error rmse and coefficient of determination r2 were selected as indicators of goodness of fit 2 4 statistical analysis methods detection of shifts in means is the most common method used to identify abrupt change points a regime shift detection analysis rodionov and overland 2005 based on a sequential t test analysis of regime shifts stars was used to statistically detect the regime changes in major sources and sinks such as total inflow water diversions groundwater abstractions and recharge from precipitation during the period from 1990 to 2020 with a target significance level of 0 05 the cut off length and the huber s tuning constant was set to 3 years and 2 respectively table 4 in section 4 1 in addition a pearson correlation coefficients matrix was used to conduct the bivariate correlation analysis of the four above sources and sinks influencing groundwater storage at the significance levels of 0 01 and 0 05 3 results 3 1 calibration of the groundwater flow model fig 4 shows the relationship between simulated and observed hydraulic heads of all observation wells located in layers 1 3 in august 1996 and august 2014 a sharp drop in groundwater storage occurred in 2003 fig 10 c in section 3 3 1 therefore before and after 2003 were selected to represent higher and lower steps in groundwater levels respectively the scattered data points for the two stress periods lie close to the diagonal line mae rmse and r2 were 1 967 m 2 656 m and 0 942 in august 1996 and 1 866 m 2 499 m and 0 972 in august 2014 the error then is acceptable given that the difference between the highest groundwater level and the lowest groundwater level in the entire basin was about 90 m that is after manual calibration the calculated heads were generally consistent with the observed heads during the two typical stress periods of before and after 2003 in other words the model effectively simulated the groundwater dynamics of the modeled aquifers and could reproduce the long term spatial distribution of groundwater levels and the regional characteristics of the hydrogeological processes the calibrated hydrogeological parameters are shown in table 2 typical long term observation wells in both layer 1 and layer 2 of yinchuan city and shizuishan city are shown in fig 5 and fig 6 although the long term trends in observed and computed heads are similar seasonal fluctuations in the computed heads were smaller than the observed heads a further decrease in storage parameters led to dry cells in the top model layer which may be related to seasonal variations in irrigation return flow and groundwater abstractions furthermore there is a large discrepancy between the observed and simulated groundwater levels this discrepancy in the shallow aquifer can mainly be attributed to inaccurate estimations of irrigation return flow and canal leakage in the confined aquifer groundwater abstractions were obtained from annual water resources bulletins which contain large uncertainty 3 2 evolution of regional groundwater levels 3 2 1 inter annual groundwater level dynamics the highest groundwater levels in the shallow aquifer occur in the piedmont pluvial plain in the west and the area of pluvial alluvial fans in the south the main groundwater flow direction is from southwest to northeast and is consistent with the change in topography the groundwater flow direction beneath the piedmont pluvial plain and the pluvial alluvial plain in the west is from west to east interannual variations in groundwater levels were not significant fig 7 the spatial distribution of groundwater levels in the deep aquifers layers 2 3 is overall consistent with that in the shallow aquifer local differences in groundwater levels are primarily associated with concentrated areas of groundwater abstractions in yinchuan city and shizuishan city which have created cones of depression fig 8 in the early 1990s such cones of depression did not exist in shizuishan city however a long term cone began to form in 1995 and with an increase in the pumping rate the area of the cone gradually increased from 9 km2 in the mid 1990s to 80 km2 in 2010 after 2010 the area of the cone in shizuishan city began to gradually decrease and by 2020 it had returned to its size in the 1990s around 2006 two small cones of depression related to groundwater pumping appeared on the east side of shizuishan city and remained stable as for yinchuan city its cone of depression has gradually expanded from an area of 50 km2 in the 1990s to five groups of smaller cones each with an area of about 30 40 km2 in 2020 where irrigation activities occur over the shallow aquifers the seasonal variations in groundwater level were more pronounced than in the deep aquifer over the 30 year period groundwater levels remained relatively stable compared to the deep aquifers the changes in groundwater levels that did occur in layer 1 varied spatially over the area beneath the western piedmont pluvial plain of yinchuan city the groundwater levels continued to decline over the 30 year study period in the shallow aquifer fig 5 a in the eastern part of yinchuan city changes in groundwater levels slowed over the 30 years fig 5 b c in the western section of shizuishan city groundwater levels in the shallow aquifer initially remained stable but have declined between 2000 and 2010 after 2010 groundwater levels gradually recovered to that which existed before 2000 fig 5 d e in the southern part of shizuishan city groundwater in the shallow aquifer declined slowly fig 5 f in deep aquifers layers 2 3 where groundwater exploitation is concentrated the groundwater levels declined continuously with less seasonal variation compared to the shallow aquifers in the vicinity of the well fields west of yinchuan city the groundwater levels gradually recovered from 1090 m in the 1990s to 1100 m in 2020 fig 6 a north of yinchuan city the groundwater level declined slowly before 2005 but from 2005 to 2020 the groundwater level dropped sharply and were superimposed on by relatively small seasonal fluctuations fig 6 b in the northeastern part of yinchuan groundwater levels remained stable fig 6 c the groundwater levels in the deep aquifer south of shizuishan city declined continuously fig 6 d within the cone of depression in the western part of shizuishan city the groundwater level in the deep aquifer decreased from 1990 to 2010 since 2010 it has begun to recover to the level before 2000 fig 6 e f 3 2 2 seasonal groundwater level variations the seasonal variations in groundwater levels in the shallow layer were generally higher than that in the deep aquifers the average amplitudes of groundwater level fluctuations in the central and northern parts of the study area were about 2 m and 1 5 m respectively larger amplitudes of variation 4 m occur in the south most likely in response to a larger amount of irrigation which allows significant excess irrigation return flow to infiltrate and replenish the shallow groundwater the annual variations in groundwater levels water diversions zhao et al 2015 the irrigation period precipitation and evapotranspiration are compared for well 1 7 in fig 9 as an example of the changes in the shallow aquifer the annual dynamics of the groundwater levels in the irrigated area are significantly affected by the irrigation activities and water diversion processes for example seasonal fluctuations in groundwater levels in the shallow aquifer are temporally consistent with the cycle of irrigation and water diversions from the yellow river and can be subdivided into four stages 1 a period of no irrigation that occurs before the beginning of spring irrigation december to march the groundwater is at the lowest levels 2 a period of irrigation which begins with the onset of water diversions in late april at which time groundwater levels begin to rise the amount of water diverted from the yellow river increases in may and august resulting in the highest groundwater levels which correspond to a period of maximum irrigation 3 an intermittent period of irrigation in late september and late october during which the amount of water diversions from the yellow river decreases and groundwater levels begin to drop and 4 a period of winter irrigation extending from late october to late november winter irrigation is carried out for soil salt leaching and moisture storage the groundwater level rises again to a level similar to that during the irrigation period of the four factors discussed above the correlation between the groundwater levels and water diversions is strongest with a correlation coefficient of 0 928 which is significant at the 0 01 level table 3 climate factors show moderate correlation with groundwater levels and water diversions and are significant at the 0 05 and 0 01 level respectively recharge from precipitation may contribute to higher groundwater levels during the rainy season however relatively high evapotranspiration should result in lower groundwater levels therefore climate factors have less effect on groundwater levels the seasonal fluctuations in groundwater levels exhibited the same pattern throughout the study area however the amplitude of the groundwater level fluctuations varied spatially this spatial variation was mainly attributable to recharge and hydrogeological conditions and could be subdivide into specific areas including 1 the alluvial lacustrine plain where irrigation is widespread the intra annual dynamics of the shallow groundwater levels are mainly affected by irrigation and water diversions in the central and southern part of the basin and levels are dependent on irrigation the amplitude of the groundwater fluctuations is relatively large 2 an area in the northern part of the catchment where downstream irrigation occurs and the amplitude of the changes in groundwater levels are relatively low due to the shallow depth of groundwater in the northern region the amount of evapotranspiration is large 3 in areas of non agricultural irrigation such as in the piedmont pluvial plain and urban areas the magnitude of the groundwater level fluctuations in the shallow aquifer is small in the piedmont area the groundwater level is deep and evapotranspiration is small in addition a large transmissivity and hydraulic gradient primarily generate horizonal flow so seasonal variations in groundwater levels are small in urban areas land cover is often impermeable limiting precipitation infiltration thus the fluctuations in groundwater levels are also small 4 the groundwater level dynamics in most areas with deep aquifers exhibit relatively small interannual and seasonal fluctuations however in areas of concentrated pumping yinchuan city and shizuishan city the groundwater levels vary with pumping rates 3 3 groundwater budget 3 3 1 water budget components and change in groundwater storage the simulated groundwater budget for the period between 1990 and 2020 table s3 fig 10 a shows that recharge from irrigation return flow and canal leakage is the main inflow component to the groundwater system accounting for about 70 of the total recharge the other inflow components include lateral flow from the western border and recharge from precipitation major groundwater outflows include groundwater withdrawals from shallow and deep aquifers evapotranspiration and drain discharges which collectively account for approximately 90 of the total outflows from 1990 to 1999 the annual amount of water diverted from the yellow river increased steadily in riparian provinces as a result discharge in the yellow river was significantly reduced to alleviate severe shortages in water resources the yellow river water conservancy commission officially launched a unified scheduling program of water diversions from the yellow river in march 1999 since 2000 the amount of water diversion from the yellow river has strictly followed water allocation regulations and the diversion of water from the river has started to decline fig 10 b the inflow of water from the upper reaches of the yellow river reached its lowest value in 2003 a dry year which led to a sharp decline in water diversions since 2004 the rate of decline has slowed recharge of the groundwater system and water diversions are highly correlated see section 4 1 the trend visible in the time series of total inflow is mainly associated with the variability in irrigation return flow recharge and canal leakage lateral inflow from the western boundary along the helan mountains has been relatively stable groundwater abstractions increased in the periods of lower water diversions fig 10 a b water diversions dropped dramatically in 2003 and reached another low after 2016 conversely groundwater abstractions increased during these two periods groundwater outflows were largely dependent on inflows and overall trends and fluctuations between the two were similar the relation between the two is probably related to the dense distribution of drains in the yinchuan basin and the use of traditional modes of irrigation that involves large scale water spreading and large drainages the discharge from these drains accounts for a large proportion of the total outflow and is consistent with trends in water diversions fig 10 b within a given year the discharge from drains was proportional to the irrigation water use since 2000 groundwater storage has declined significantly that is the total outflow is greater than the total inflow fig 10 c the cumulative depletion in storage has continuously increased during the 30 year study period since 2014 the depletion in groundwater storage has become even more rapid by 2020 the depletion in groundwater storage had reached 1 89 109 m3 3 3 2 water exchange between groundwater and surface water over the entire basin discharge of groundwater to the yellow river is greater than the recharge of groundwater from the yellow river fig 11 the continuous increase in irrigation between 1990 and 2000 increased groundwater levels in most parts of the study area and gradually increased the discharge of groundwater to the yellow river after 2000 with the gradual reduction in irrigation water the discharge of groundwater to the yellow river gradually decreased the amount of groundwater recharge from the yellow river was relatively stable before 2017 after 2017 the increase in groundwater abstractions and the lowering of the groundwater levels led to an increase in groundwater recharge from the yellow river the discharge of groundwater to lakes is lower than the recharge of groundwater from lakes lakes in the yinchuan basin simultaneously receive groundwater inflow from one portion of the shoreline and recharge the groundwater system along the other therefore all lakes are flow through lakes fig 12 the largest amount of groundwater recharge is from mingcui lake located in the eastern part of yinchuan city since 2012 outflow to groundwater from all of these lakes except sha lake and gaomiao lake have substantially increased fig 13 a the increased outflow to groundwater near these lakes is related to the increase in groundwater abstractions near these lakes and the establishment of several new well fields in the eastern part of yinchuan city the water levels of the lakes are maintained through water diversions from the canals as the difference between lake level and the groundwater level increases groundwater recharge by these lakes increases due to the relatively low groundwater abstractions near xinghai lake gaomiao lake and sha lake the groundwater recharge from these three lakes remained relatively stable the amount of discharge from groundwater to mingcui lake yuehai lake and sha lake decreased over the study period the discharge from groundwater to the rest of the four lakes remained relatively stable fig 13 b compared with the overall groundwater budget of the yinchuan basin the amount of groundwater surface water exchange is small however these groundwater and surface water interactions have significant environmental consequences for example the gradual reduction of groundwater recharge and the increase in groundwater abstractions may result in lake leakage which in turn can lead to a shrinkage in lake area or even dry lakes to maintain the area and the ecological conditions of the lakes water diversions are required to maintain lake water levels in particular in mingcui lake xinghai lake and yuehai lake 4 discussion 4 1 the causes of stepped trend in the groundwater budget water diversions groundwater abstractions and recharge from precipitation were analyzed by regime shift analysis and correlation analysis as potential factors controlling the temporal changes in groundwater resources the temporal trends in irrigation return flow and canal leakage were similar to the water diversions from the yellow river therefore this study analyzed the effect of agricultural irrigation activities on groundwater recharge on the basis of the water diversions from the yellow river rather than irrigation return flow and canal leakage the trend in the mean total annual inflow abruptly dropped in 2003 fig 14 a the average values of the steps before 2003 and after 2003 were 14 24 108 m3 a and 11 92 108 m3 a respectively table 4 before 2003 water diversions exhibited a similarly high value which abruptly changed in 2003 fig 14 b that is the reduction in total inflow and groundwater storage from 1990 to 2016 was dominated by a decline in available water diversions from the yellow river fig 14 a b in contrast to the trend in total inflow the step trend of water diversions showed another sharp drop in 2016 in other words a three step trend was identified where the average values of each step are 62 29 108 m3 a 46 92 108 m3 a and 38 89 108 m3 a the groundwater abstractions for agriculture exhibit a two step trend the shift point occurs in 2017 the average abstraction volumes during the two periods were 5 02 108 a m3 before 2017 and 5 91 108 m3 a after 2017 we hypothesize that groundwater abstractions were increased from 2017 fig 14 c to compensate for a shortage in water demand that resulted from the reduction in water diversions from the yellow river since 2016 fig 14 b as a result the drop of total inflow from 2016 fig 14 a was not significant in combination the trends show that water diversions from the yellow river have had a decisive impact on the total inflow the impact of total inflow since 2016 is collectively determined by water diversions and groundwater abstractions most of the precipitation in the yinchuan basin is concentrated from may to september regime shift detection was unable to identify step trends in precipitation infiltration during the study period fig 14 d suggesting that the long term trend in total inflow was not significantly affected by recharge from precipitation a bivariate correlation analysis was used to calculate the correlation coefficients among total inflow water diversions abstractions and recharge from precipitation table 5 the pearson correlation coefficient between total inflow and water diversion is 0 965 a strong correlation which is significant at the 0 01 level the correlation suggests that water diversion is a decisive factor controlling groundwater recharge the pearson correlation coefficient between abstractions and water diversions is 0 428 which is significant at the 0 05 level when water diversions decrease groundwater abstractions increase to meet water demands however recharge from precipitation does not exhibit a significant correlation with total inflow water diversions or abstractions at a significance level of 0 05 this is presumably because recharge from precipitation only affects the short term interannual fluctuations of total inflow which mainly reflects the difference between precipitation recharge in wet and dry years water diversions are mainly policy controlled thus diversions are only weakly correlated with recharge from precipitation 4 2 adaptation for a reduction in river water diversions with increased urbanization between 1990 and 1999 the consumption of water for domestic needs and industrial activities have increased significantly along with the use of water for irrigation the amount of total groundwater abstractions and the amount of water diverted from the yellow river increased simultaneously the implementation of the national western development strategy in 2000 led to an increase in both population and water demand since then the gradual reductions in water diversions have not been sufficient to meet the growing water demand fig 15 total groundwater abstractions has been slowly growing to deal with the shortage of water resources caused by the reduction of water diversions from the yellow river in 2003 and during 2016 2020 the amount of water taken from the yellow river reached its lowest value as a result there were sharp increases in groundwater abstractions in these particular years groundwater abstractions by different users showed different trends the relatively low groundwater abstractions for rural water supplies remained stable for 30 consecutive years groundwater abstracted from centralized well fields for industrial and urban water supplies accounted for the largest proportion of total abstractions which is in line with the growth in total abstractions with the exception of 2003 urban and industrial water use was restricted by the sharp drop in water diversions the abstractions of groundwater for agriculture remained stable before 2003 but to compensate for the shortage in agricultural water caused by the sharp drops in river water diversions in 2003 and during 2016 2020 groundwater abstractions for agriculture increased sharply fig 15 therefore an indirect inverse relationship exists between the agricultural abstractions of groundwater and the water diversions from the river fig 10 b c fig 15 it is worth noting that after 2004 the amount of water diverted from the yellow river decreased but agricultural abstractions did not increase significantly we speculate that after the unified regulation of water diversion from the yellow river in 2000 and the extreme drought year in 2003 the yinchuan basin began to implement large scale crop pattern adjustments and agricultural water saving measures to reduce the agricultural water demand water saving irrigation projects have been carried out since 2000 for example the crop pattern for the entire ningxia region was adjusted nsb 1991 2020 resulting in a reduction in summer grain crops e g wheat and an increase in autumn grain crops e g corn these changes in crop patterns reduce irrigation water requirements fig 16 farmers have also 1 reduced the planting area of crops with high water consumption and low efficiency e g wheat 2 maintained the planting area of rice and 3 developed water saving irrigation for rice cultivation moreover farmers have expanded the area of crops with lower water consumption including drought tolerant crops e g autumn corn forage grass and herbs and crops using water saving irrigation techniques e g vegetables melons and fruits the total cultivation area increased before 2010 and remained stable after 2010 in addition water saving irrigation techniques have been improved for example the irrigation of wheat and corn was changed from flood irrigation to furrow irrigation micro irrigation has also been developed for vegetables melons and fruits and sprinkler irrigation has been developed for forage grass at present the leakage of water from the canal system accounts for a large proportion of water loss in the future the water diversions of the yellow river will continue to decrease we therefore suggest that the anti leakage treatment of the canal system should be further strengthened and the main canals combined to reduce the leakage losses of water during its delivery to agricultural fields 4 3 limitations there are a number of limitations to the model developed in this study first hydrogeological parameters e g k and ss vary with depth however the values of each hydrogeological parameter in each lithology geological unit were assigned uniformly by the huf package for the differing depths considered in this model in addition there is a lack of hydrogeological parameter data for the deep aquifer materials depths greater than 300 m thus we assumed that the values of the hydrogeological parameters of the lithologic units at different depths are the same second the depths of long term groundwater level observations available for model calibration are limited and most observations were at depths of less than 300 m third the model was constructed for monthly stress periods while the actual data were collected on an annual scale the seasonal variations of each item e g recharge from irrigation return flow canal leakage were based on the proportion of water diversions in different months zhao et al 2015 which may result in uncertainties in the seasonal fluctuations of the computed heads fourth because maps of crop patterns for different years are not available the zonation of irrigation return flow was conducted according to the administrative division land use and soil type in addition the infiltration coefficient of irrigation water in different years was assumed to be a fixed value within the same zone as was the effective utilization coefficient fifth since data describing the degree to which the canals were lined in different years were not available the leakage coefficient of the canals in different years was assumed to be a fixed value within the same zone as was the effective utilization coefficient sixth due to the lack of hydrogeological boreholes in the piedmont of the helan mountains the lateral recharge along the piedmont boundary was assumed on the basis of the hydraulic gradient between the boreholes in the front of the alluvial fans the above limitations have presumably led to uncertainty in parameter calibration and bias in the model results to address all the limitations mentioned investigations will be conducted in the future to improve the model thereby increasing its ability to assess the mechanisms of deep groundwater flow dynamics and the prediction of future changes in the groundwater system despite these limitations our present results provided general patterns of groundwater flow dynamics under the effects of human activities and climate change 5 conclusions changes in the environment have profound effects on the evolution of hydrogeological processes especially in arid and semi arid regions documenting the response of a regional groundwater system to human activities and climate change is a challenge a long term transient groundwater flow model can be used to reconstruct historical changes in hydrogeological processes and quantify the interaction between groundwater and surface water systems the main conclusions from this study are as follows 1 groundwater storage was continuously depleted over the 30 year 1990 2020 study period reaching a cumulative depletion of 1 89 109 m3 irrigation return flow and canal leakage were the main sources of recharge to the groundwater system the main groundwater outflows included groundwater abstractions drain discharge and evapotranspiration 2 hydrogeological processes were mainly affected by human activities in the yinchuan basin human activities particularly water diversions from the yellow river dominated the long term trend in groundwater storage climate only affected short term interannual fluctuations in groundwater storage 3 in most years the computed groundwater budget shows that recharge from surface water to groundwater was lower than that from groundwater to surface water the continuous decline in groundwater levels during the 30 year study period led to an increase in the amount of groundwater recharge from the yellow river and lakes conversely the amount of groundwater discharged to the yellow river and lakes has continued to decrease there is an increasing requirement for artificially supplied water to lakes to maintain their water levels 4 water diversions from the yellow river has dropped since 2000 resulting in a continuous reduction in groundwater recharge and storage the amount of groundwater abstractions increased when water diversions from the yellow river were insufficient to meet the water demand water saving irrigation and adjustments to the crop pattern were implemented to reduce the requirements for irrigation in the yinchuan basin a representative arid and semi arid area of northern china groundwater is being depleted and the ongoing development is not sustainable groundwater resources are more vulnerable to policy changes pertaining to water diversions and land use change than climate factors the risk of future groundwater depletion may likely come from human impacts such as policies governing surface water diversions and groundwater abstraction intensity this study not only documented the temporal and spatial variations in groundwater levels in a typical arid and semi arid area of northwest china but also evaluated the impact of human activities on the groundwater system the dynamic response in groundwater levels irrigation patterns and groundwater abstractions to the change in water diversions from the yellow river was evident the results will enable water managers to predict future changes in groundwater levels and storage caused by changes in land use and water diversions through scenario analysis it can also provide insights for creating sustainable management plans in other arid and semi arid regions credit authorship contribution statement jie li data curation writing original draft writing review editing yangxiao zhou funding acquisition supervision writing review editing wenke wang funding acquisition supervision writing review editing sida liu writing review editing ying li data curation investigation ping wu data curation investigation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgment this study was funded by the national natural science foundation of china grant no 42130710 the natural science basic research program of shaanxi province grant no 2021jcw 16 and the the investigation and evaluation on the development and utilization of groundwater resources and the effect of ecological environment protection along the yellow ecological economic zone project of the ningxia finance department grant no 6400201901273 the first author is grateful to the china scholarship council no 202006560048 we are thankful for the technical support by prof fusheng hu from china university of geosciences beijing and dr feilong jie from xi an university of technology the authors are grateful to the editors and two anonymous reviewers for their valuable comments and suggestions which helped to improve the manuscript appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 128619 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
2656,accurate and updated bathymetric data is of great significance for the management and protection of alpine tufa lakes in recent years unmanned aerial vehicle uav borne optical remote sensing has become a cost effective technique for obtaining water depth of small and clear waters like tufa lakes uav based bathymetry can be categorized into photogrammetric approach and spectrally derived approach photogrammetric bathymetry is contactless but invalid in water areas with uniform texture while spectral based bathymetry requires a large amount of in situ depth measurements in this paper we combined the strengths of the two bathymetric methods to retrieve the depth of clear tufa lakes using neural networks the surface elevation and orthoimage were first produced from uav acquired overlapping images and then water color depth tie points were sampled in the orthoimage and refraction corrected bathymetric map next the shallow and deep neural networks were separately used to train the regression models for predicting water depth lastly the combined bathymetric methods were compared with the single ones in terms of effective spatial coverage and bathymetry accuracy the results indicated that the combined methods were superior to single bathymetric methods in fully covered bathymetry of clear tufa lakes the shallow neural network based model achieved the highest accuracy with the coefficient of determination r2 of 0 91 and the root mean square error rmse of 1 12 m whereas the deep neural network based model increased the details of water depth distribution keywords tufa lake unmanned aerial vehicle uav bathymetry optical image neural network digital bathymetric map dbm data availability data will be made available on request 1 introduction bathymetric survey is of great significance for the management and protection of alpine tufa lakes as a part of surface karst sedimentary landforms transparent blue green tufa lakes have high tourism and scientific value currás et al 2012 li et al 2020 however global climate change frequent geological disasters and over exploitation of tourism resources make the tufa lake landscape face the risk of degradation liu 2017 qiao et al 2016 accurate and updated water depth data is very critical for the monitoring and management of these lakes however depth measurement using sonar not only consumes huge resources but also is not suitable for shallow waters mandlburger 2021 satellite derived bathymetry sdb estimates the depth of shallow waters through remotely sensed satellite data which has been utilized since the 1970s lyzenga 1978 the technique was initially developed to retrieve water depth based on the spectral information of satellite imagery in most cases it follows the physical basis of exponential attenuation of optical signal in the water column the bathymetric retrieval techniques are generally built upon either physical principles or empirical models niroumand jadidi et al 2020 the analysis of radiative transfer process is the basis of physical techniques while the relationships between spectrally derived features e g band ratios and water depth should be established for empirical techniques therefore physical bathymetric techniques usually need to conduct accurate atmospheric correction and empirical techniques require to do numerous in situ measurements zhou et al 2021 as a result a large amount of additional workload has to be added in water depth retrieval recently satellite two media photogrammetry avoided these limitations and provided spatially extensive method for bathymetric mapping hodúl et al 2018 but it cannot satisfy the requirements of high resolution and fine scale bathymetry in alpine tufa lakes in recent years unmanned aerial vehicles uavs especially mini uavs and drone technologies have developed very rapidly making them a popular remote platforms xiang et al 2019 chen et al 2022 when taken as a whole system of components uav sensor ground station etc their technical terms are also known as unmanned aircraft systems uas or remotely piloted aircraft systems rpas colomina and molina 2014 alvarez et al 2018 at the moment uav based remote sensing has been increasingly used in forest surveys and management otero et al 2018 lin et al 2022 geological surveys colica et al 2021 hydrological research vélez nicolás et al 2021 and archaeological surveys rouse and krumnow 2020 etc meanwhile structure from motion and multi view stereo sfm mvs algorithms have become sophisticated but they still follow the photogrammetric principles westoby et al 2012 fonstad et al 2013 hence uav based sfm mvs photogrammetry is frequently used for geoscience applications owing to its advantages of low cost and high resolution eltner et al 2016 meinen and robinson 2020 granados bolaños et al 2021 previous studies have demonstrated that the uav acquired aerial images with high overlap can produce high resolution and high accuracy digital elevation models dems james and robson 2014 under the conditions of good illumination and transparent water overlapping uav imagery can also derive underwater topography woodget et al 2015 woodget et al 2019 which is referred to as bathymetry david et al 2021 mandlburger 2021 therefore uav based remote sensing has become an effective technique for retrieving depths of small and transparent tufa lakes he et al 2021 similar to existing satellite bathymetric models uav based bathymetry can be categorized into spectrally derived bathymetry and photogrammetric bathymetry dietrich 2017 shintani and fonstad 2017 kim et al 2019 the spectral based bathymetry was principally derived from the overlapping images taken by uav loaded visible multispectral cameras kim et al 2019 rossi et al 2020 the empirical sdb models such as log linear inversion model stumpf model and optimal band ratio analysis obra lyzenga 1978 stumpf et al 2003 legleiter et al 2009 have been applied to bathymetric survey achieving a depth accuracy of about 20 cm in shallow waters rossi et al 2020 as for uav based photogrammetric bathymetry the refraction correction is necessary to be conducted in the general uav sfm workflow this kind of approaches is essentially geometrical analysis that aims to eliminate the refraction effect of light at the air water interface one simplified post processing solution is to correct the initial water depth derived from the resulting dems using a constant scale factor woodget et al 2015 some other approaches deal with the refraction effect in the process of bundle adjustment maas 2015 mulsow et al 2018 or build a refraction correction model based on sfm mvs photogrammetric point cloud dietrich 2017 however it is very difficult for the photogrammetric bathymetry to identify effective tie points in overlapping images of the water area with uniform texture mandlburger 2019 so the bathymetric map frequently fails to cover the entire tufa lake in contrast spectral based bathymetry usually works better in the low texture areas of a tufa lake but requires a number of in situ depth measurements he et al 2021 therefore the spectral based and photogrammetric techniques complement each other and their integration may improve the effective coverage of bathymetry slocum et al 2020 literature review indicates that the combination of photogrammetric and spectrally derived bathymetry provides an increase of up to 61 in spatial coverage compared to either of the two approaches slocum et al 2020 the combined approach can be applied to the bathymetry of alpine tufa lakes and is expected to address the problem of missing image matching points in low texture areas as homologous products from uav acquired images the orthoimage and dem share the same spatial and temporal reference the digital number dn of spectral bands can be obtained from a sfm mvs derived orthoimage starek and giessel 2017 while the initial water depth can be extracted from a sfm mvs derived digital surface model dsm shintani and fonstad 2017 meinen and robinson 2020 since the uav acquired optical images are usually not preprocessed with the radiometric correction dn values will be used for water depth inversion instead of the reflectance ones kim et al 2019 the photogrammetric bathymetry can provide appropriate reference data for training validation and testing of spectral based bathymetric models like airborne lidar bathymetry mandlburger et al 2021 machine learning approaches including neural networks e g back propagation artificial neural networks usually do well in establishing the relationship between spectral features and reference data danesh yazdi et al 2021 feng et al 2021 guo et al 2021a slocum et al 2020 therefore the combined approaches using neural networks will not only effectively expand the bathymetric coverage but also make it possible for completely non contact bathymetry in alpine tufa lakes the structure of this paper is composed of the following sections section 2 introduces study area and uav data acquisition and then describes the methods including uav data processing single combined bathymetric approaches and accuracy assessment section 3 presents the water depth maps derived by bathymetric models their bathymetry accuracies and improvements from neural network based methods the transferability and deficiencies of combined bathymetric models are discussed in section 4 the conclusions of this study are drawn in section 5 2 materials and methods 2 1 study area and data 2 1 1 study area jiuzhai valley is located in the south of minshan mountain and the northeast of gongga mountain the terrain in the valley fluctuates and the main valley has the length of greater than 30 km in terms of geology and geomorphology jiuzhai valley is located in the transition zone of qinghai tibet plateau and sichuan basin hence the complex geologic history and widely distributed carbonate developed large scale karst tufa deposits in terms of climate and hydrology jiuzhai valley is included in the humid plateau climate there are 114 alpine lakes mostly distributed in groups with various sizes the water system in jiuzhai valley has a y shape which finally flows into the jialing river the waters from rize valley and zechawa valley in the upstream converge into shuzheng valley in the downstream fig 1 the study area is situated in shuzheng valley where many blue green tufa lakes are distributed including shuzheng lakes lying dragon lake spark lake and double dragon lake spark lake also known as huohuahai lake guo et al 2021b is a typical tufa lake located between double dragon lake and lying dragon lake in shuzheng valley it is roughly in a triangular shape with a side length of about 150 m the flow velocity in the lake was slow and the lake surface was calm on august 8 2017 an earthquake measuring 7 0 on the richter scale struck jiuzhaigou county northern sichuan province lei et al 2017 the epicenter was located in bimang village 5 km west of jiuzhai valley the earthquake triggered landslides and collapses in various locations in jiuzhaigou scenic area including nuorilang waterfall spark lake and other scenic spots the tufa barrage at the downstream side of spark lake collapsed in the earthquake as a result the lake water was almost drained out and the lake basin was exposed earthquake caused landslips in some tufa mounds of the lake and a small amount of flood remained in the downstream lake basin subsequently the collapsed barrage of spark lake was rebuilt but the morphology of original lake bed has not been significantly changed therefore it is an ideal test site for studying on bathymetry of tufa lakes 2 1 2 uav acquired images the raw aerial images in this study were acquired by two different unmanned aircrafts before and after jiuzhaigou earthquake a fixed wing uav feima f1000 was used before the earthquake to obtain images covering the whole shuzheng valley december 9 2016 while a quad rotor drone dji phantom4 pro was focused on the test site spark lake after the earthquake october 10 2018 the fixed wing uav was equipped with a consumer grade digital camera sony ilce 5100 and the quad rotor drone with specially designed camera dji fc6310 both uavs were loaded with inertial measurement unit imu and global positioning system gps to measure their instantaneous three dimensional 3d position and orientation information i e external orientation elements during airborne surveys the spatial resolutions of overlapping images collected by the fixed wing uav and the multi rotor drone were 10 cm and 5 cm respectively 2 2 methods and validation the major procedures of retrieving depth of clear tufa lakes include explanation of uav data processing single and combined bathymetric methods and validation of bathymetric accuracy 2 2 1 surface processing and sampling aerial triangulation is also called sfm in computer vision xiang et al 2019 the commercial sfm software i e pix4d 4 4 10 was applied to processing uav acquired images through the steps of auto triangulation orthorectification and mosaicking the purpose was to generate orthoimage and surface elevation of the study site fig 2 sfm mvs the state of art algorithms for 3d surface reconstruction are not only the core of aerial triangulation processing but also the key to producing the final products dense point cloud orthoimage dsm etc the sfm mvs processing starts with the automatic extraction of tie points in the uav acquired overlapping images sfm simultaneously obtains camera poses and parameters via bundle adjustment and generates sparse point cloud on the basis of sfm processing mvs densifies point cloud using multi view stereo matching algorithms smith et al 2014 then the dense point cloud is rasterized to produce the orthoimage and dsm of the study site iglhaut et al 2019 the spatial co registration and resampling of pre and post earthquake orthoimage and dsm were carried out in gis software i e arcgis 10 3 1 the points used for spatial co registration were distributed around spark lake and their positions were marked in the pre earthquake orthoimage as shown in fig 2a in order to keep the size and position of image pixels consistent the orthoimages and dsms before and after the earthquake were resampled with ground sample distance gsd of 5 cm the lake surface points were selected along the water s edge from the pre earthquake orthoimage and the average value of their elevations was taken as the final water surface elevation wse woodget et al 2019 the calculated wse was 2 226 93 m below which the bathymetric extent of the lake basin area was extracted from the pre earthquake dsm fig 2b the dsm falling in the bathymetric extent was regarded as the initial dem with a minimum elevation of 2 214 09 m then the initial digital bathymetric map dbm was obtained through the conversion between the initial dem and wse using eq 1 likewise the post earthquake dry depth of spark lake was converted from the dsm of exposed lake bed and the wse fig 3 b 1 h w s e e where h represents the water depth wse is the water surface elevation and e represents the lake bed elevation based on the pre and post earthquake dbms the two depth values of each sampling point were collected while the dn values of red green and blue bands of sampling points were extracted from the pre earthquake orthoimage in the sampling process we excluded the areas where the surface elevation had been changed or covered by ponding after the earthquake fig 3a random sampling was conducted in the selection of sample points which achieved the relatively balanced distribution of sample points with various water depths 900 sample points were randomly divided into 600 training points with depth values and dn values and 300 check points with post earthquake dry depth values the number distribution of sample points training points and check points in the various ranges of dry depths was shown in table 1 the training points were only used to establish spectral based bathymetric models and the check points were used to validate the accuracies of all bathymetric models including photogrammetric spectral based and neural network based models 2 2 2 single bathymetric methods single bathymetric methods can be divided into spectrally derived bathymetry and photogrammetric bathymetry the pre earthquake orthoimage and the conversed depth maps before and after the earthquake were taken as the data sources for single bathymetric methods spectrally derived bathymetry in our case was a method to retrieve the water depth by establishing the regression relationship between the band dn values or the combinations in the orthoimage and dry depth values after the earthquake for single band log linear models the green band lngreen was the preferred one for water depth inversion because it showed a stronger capability in penetrating the water body of tufa lakes for band ratio models the stumpf model usually applied the combination of blue band and green band lnblue lngreen to retrieve the water depth stumpf et al 2003 in such a model the longer wavelength green band provided the information of water depth change while the shorter wavelength blue band offered the information of bottom type legleiter et al 2009 compared with band ratio models the band difference model based on blue band and green band blue green was more in line with the water color features of transparent tufa lakes he et al 2021 photogrammetric bathymetry was based on the principle of photogrammetry and supplemented with refraction correction to obtain the actual water depth the initial dbm directly generated by photogrammetry had a large bias 2 3 m and needed to be corrected the geometry of refraction correction is described by snell s law eq 2 in our study refraction correction was applied to the initial dbm and a constant scale factor was used to correct the initial water depth according to the simplified snell s law alvarez et al 2018 the refractive index of fresh water 1 34 as the correction factor could generally meet the requirements of water depth estimation woodget et al 2015 shintani and fonstad 2017 in other words the actual water depth was equal to the initial water depth multiplied by 1 34 the dbm correction could be conveniently realized using the arcgis raster calculator tool however the initial raster dbm derived from dense point cloud would be affected by the quality of point cloud itself as shown in fig 4 the point cloud in low texture areas were missing due to the lack of effective tie points in the dense image matching of aerial auto triangulation as a result photogrammetric bathymetry could not generate bathymetric map effectively covering the entire tufa lake 2 sin r sin i n 2 n 1 where i and r are the incidence angle and refraction angle for light transmitting from air into water n1 and n2 are the refractive indexes of air and water 2 2 3 combined bathymetric methods as the spectral and geometric bathymetric methods complement each other the combination of them was expected to overcome the shortcomings of single bathymetric methods and establish a fully covered and non contact bathymetric method neural network is a machine learning based operation model which is composed of a large number of nodes or neurons in different layers generally a neural network architecture consists of one input layer one multi hidden layer s and one output layer danesh yazdi et al 2021 considering the fitting capability of neural networks to non linear problems the shallow and deep neural networks were selected to separately fit the training data the basic way of the combination was to take the refraction corrected water depth before the earthquake as the depth training data and establish the relationship between the band dn values in the pre earthquake orthoimage and water depths using neural network models the flow chart of combining geometric and spectral methods is shown in fig 5 the preliminary preparation for training the neural network models was to exclude the invalid area in the refraction corrected dbm and extract the corrected water color depth values from the valid area in our case the invalid area is the abnormal part of spark lake with uniform texture fig 4 and it would be excluded during water color depth tie point sampling the key to the establishment of bathymetric models was to use neural networks to train the regression models so as to input spectral features and output the predicted bathymetric values guo et al 2021a the spectral features here referred to the dn values of red green and blue bands in the pre earthquake orthoimage the neural network models were implemented using the matlab version r2017b neural network toolbox including a shallow neural network and a deep neural network the shallow neural network adopted one hidden layer with 5 nodes n 5 fig 6 a the deep neural network had three hidden layers fig 6b and the numbers of hidden layer nodes were 10 8 and 5 respectively k 10 l 8 and m 5 the reason for such choices was that complex topologies might lead to over fitting while simplistic ones could not accurately predict water depth slocum et al 2020 furthermore the shallow neural network was trained with levenberg marquardt back propagation algorithm the sigmoid function was used as the activation function of hidden layer neurons eqs 3 and 5 while the activation function of output layer neurons were linear eqs 4 and 6 danesh yazdi et al 2021 the deep neural network adopted the same activation function of hidden layers but did more repeated calculations of hidden layers neurons 3 g x 1 1 e x 4 f x x 5 h q g p 1 3 w pq x p a q 6 depth f q 1 n h q w q b where n is the number of nodes in the hidden layer wpq is the weight from the input layer to the hidden layer xp represents the dn values of red green and blue bands aq is a constant value belonging to the hidden layer s neurons hq is the output value of neuron q in the hidden layer wq is the weight from the hidden layer to the output layer b is a constant value relating to the output layer s neuron and depth represents the predicted water depth in addition the sample data for two neural networks were randomly divided according to the proportion of 7 2 1 namely 70 was used for training 20 for validation and 10 for testing the correlation coefficients r in training set validation set and test set of shallow neural network with single hidden layer and deep neural network with multiple hidden layers were listed in table 2 the two neural network models were retained after numerous times of training to predict the water depths of the entire bathymetric extent 2 2 4 metrics for accuracy assessment we would use the post earthquake dry depths of the check points as the reference values and conduct a point to point validation to evaluate the performance of various bathymetric models the statistical validation metrics for accuracy assessment included r2 coefficients of determination rmse root mean square error mae mean absolute error eq 7 and mre mean relative error eq 8 the rmse is non linear and has a higher weight for larger errors the mae is a linear index and all errors in the samples have the same weight the mre is known as percentage error which is more sensitive to the errors of low value interval 7 mae 1 n i 1 n h i h i 8 mre 1 n i 1 n h i h i h i 100 where h i is the resulting water depth at the location of a check point from various bathymetric models h i is the reference water depth and n is the number of check points 3 results 3 1 dbms derived by bathymetric models the six dbms derived by single and combined bathymetric models were shown in fig 7 as a whole the water depth distributions showed the similar pattern which was shallow in the west and deep in the east of spark lake in the shallow area the water depths of all models had little difference except for lngreen but in the deep area the maximum water depths of models lnblue lngreen refraction correction and deep neural network exceeded 16 m while those of models lngreen blue green and shallow neural network were less than 16 m the dbms obtained by single bathymetric methods had local anomalies in some areas for example there were obvious abnormal depressions scattered near submerged tufa mounds in the dashed rectangles in fig 7a which was retrieved by single band model lngreen as seen in fig 7b the band ratio model lnblue lngreen alleviated the abnormal depressions to a certain extent the band difference model blue green further improved such situation and nearly eliminated the anomalies in those areas fig 7c in contrast there were no abnormal depressions near the tufa mounds in the dbm derived by refraction correction model fig 7d but one abnormal bulge appeared in the dashed circle where the lake bed had a uniform texture as for the combined bathymetric methods based on neural network models there were basically no such anomalies as depressions and bulges in the resulting bathymetric maps fig 7e f compared with single bathymetric methods the combined ones were effective in the bathymetry of the entire water area of spark lake 3 2 accuracy assessment of bathymetric models in order to validate the bathymetric data derived from the six methods a total of 300 check points in the exposed basin of spark lake were collected fig 3 the relationships between the elevation values from the six dbms and those of the check points were presented as scatter plots in fig 8 as indicated in fig 8a the performance of single band model lngreen was the worst among all models with the r2 of 0 48 and the rmse of 2 59 m the band ratio model lnblue lngreen was slightly better with the r2 of 0 74 and the rmse of 1 82 m but there was a large deviation in the shallow water fig 8b compared with the single band model and the band ratio model the accuracy of band difference model blue green had been significantly improved with the r2 of 0 86 and the rmse of 1 37 m moreover the band difference model nearly performed well in the whole water depth range fig 8c as the r2 was 0 88 and the rmse was 1 32 m fig 8d refraction correction model achieved the accuracy close to that of the band difference model the combined bathymetric model based on shallow neural network achieved the highest accuracy with the r2 of 0 91 and the rmse of 1 12 m fig 8e the rmse was close to 8 of the maximum reference depth of spark lake however the accuracy of the combined model based on deep neural network was not further improved fig 8f its r2 was 0 90 and rmse was 1 18 m as indicated in fig 8 the derived depths from shallow neural network model and the reference ones from check points had the best consistency among all models especially in shallow water according to statistics in table 3 the bathymetric model on shallow neural network had the lowest mae and mre of 0 89 m and 17 13 respectively meanwhile the deep neural network model gained the second place with the mae of 0 93 m and the mre of 19 84 although the band difference model blue green and the refraction correction model had very close maes of 1 07 m and 0 98 m the mre of the former was much larger than that of the latter among spectral based bathymetric models the band difference model blue green performed best because it better reflected the rule of water color changing with water depth of a tufa lake after refraction correction the photogrammetric bathymetric model achieved similar overall accuracy to that of the band difference model and performed better in shallow water due to the involvement of the red band with strong capability for fitting non linear problems neural network based models accomplished the regression analysis between water color and water depth of the tufa lake with unique spectral features moreover the neural network based models took advantage of red green and blue bands simultaneously different from the blue and green bands commonly used in the band ratio difference models the red band was most sensitive to the depth change in shallow water areas in addition the shallow neural network model could satisfy the accuracy requirement of bathymetry with a small number of training samples but the deep neural network model could not further improve the accuracy without more sample data 3 3 improvements from neural network based methods the improvements from combined geometric and spectral methods were reflected in the spatial coverage and accuracy of bathymetry compared with the depth inversion models and the refraction correction model the neural network based combined methods had no obvious invalid bathymetric area and effectively covered the entire water area fig 7 a large number of color depth training samples for establishing spectral bathymetric models were obtained by refraction corrected photogrammetric bathymetry and the local anomalies at the water surface depressions or bulges caused by photogrammetric bathymetry were nearly eliminated by spectral based bathymetric method as a result the combined bathymetric methods on neural network models achieved the best bathymetric accuracy without in situ depth measurements especially in shallow water depth fig 8 in addition the results of combined bathymetry varied according to the adopted neural network architectures the shallow neural network with single hidden layer satisfied the requirement of combining geometric and spectral methods and achieved high accuracy bathymetry fig 8e although the deep neural network with more hidden layers did not further improve the bathymetric accuracy it added more details of water depth distribution in the deep water and tufa mound areas fig 7f 4 discussion 4 1 transferability analysis of bathymetric models in our study the trained and validated bathymetric models were also applied to lying dragon lake fig 9 a and double dragon lake fig 9m in shuzheng valley fig 1 the former is relatively deeper than spark lake and the latter is shallower according to the official data from jiuzhai admin the maximum depths of lying dragon lake and double dragon lake is 24 m and 9 m respectively since the pre earthquake uav images of the region were captured simultaneously these two lakes were considered to share the same spectral radiation conditions with spark lake hence the transferability of bathymetric models could be evaluated by applying trained and validated models based on spark lake to the two adjacent tufa lakes as indicated in fig 9b h the maximum water depths of lying dragon lake derived by bathymetric models were generally low apart from that of refraction correction model it was possibly caused by the saturation of optical signal in deep water or the refraction effect of light the depth depressions induced by sparse shadows dashed rectangles in fig 9b d and abnormal bulges caused by uniform textures dashed circles in fig 9e f were almost removed in the bathymetric maps fig 9g h derived by the neural network based combined methods especially deep neural network based one it indicated that the neural network based models were transferable to eliminate depth anomalies as for double dragon lake the depth depressions induced by large dark shadows dashed rectangles in fig 9j l were remarkable and abnormal bulges caused by uniform textures dashed circles in fig 9m n were still existing in contrast the deep neural network based model was basically able to derive its maximum water depth even with the interference of the large dark shadow fig 9p however a small amount of anomalies were present at the edges of the shadow the major reason for this phenomenon might be the lack of training samples at the transition zone between shadow and non shadow areas the shallow neural network based model also did worse in the dark shadow areas compared with the deep one in general the neural network based combined models performed well in relatively shallow waters without large dark shadows 4 2 deficiencies and potential remedies in this study the geometric and spectral methods were combined to realize non contact high accuracy and fully covered bathymetry of clear tufa lakes using neural networks however some deficiencies were reflected in the following aspects first of all when collecting the samples from the depth map derived by refraction corrected photogrammetric bathymetry the invalid areas with uniform texture were visually identified and manually excluded the available spectral channels of uav acquired visible images were limited for bathymetric modeling compared with hyperspectral imagery legleiter and fosness 2019 rossi et al 2020 there was a lack of quantitative study on the correspondence relationship between the topology of neural network and the number of training samples some measures could be taken to remedy these deficiencies in future applications for example the gray level co occurrence matrix glcm approach baraldi and parmiggiani 1995 could be used to automatically determine the low texture region in the bathymetric map with the gradual miniaturization and cost reduction uav borne hyperspectral sensors were expected to be used for bathymetry of tufa lakes various topologies of neural networks could be used for combined bathymetry to figure out the optimum correspondence with the number of training samples in addition it was beneficial to enhance the effective depth and accuracy of bathymetry if uav images were captured under conditions of good illumination and small solar altitude angle 5 conclusions in this study we combined the photogrammetric and spectral based bathymetric methods to derive dbms of tufa lakes using uav images and neural networks the important conclusions we concluded are as follows the surface elevation and orthoimage produced from uav based sfm mvs photogrammetry could be used as the data sources to derive the dbms of clear tufa lakes by refraction corrected photogrammetric bathymetry and spectrally derived bathymetry the refraction corrected bathymetry tended to cause depth anomalies in the water areas where the lake bed had a uniform texture while spectral based bathymetry usually induced abnormal depressions around the tufa mounds with sparse shadows and in the water areas with big shadows the combined bathymetric methods based on neural network models eliminated those depth anomalies occurring in single bathymetric methods and realized fully covered bathymetry of the tufa lake the neural network model with a single hidden layer achieved the highest accuracy of bathymetry with the r2 of 0 91 and the rmse of 1 12 m close to 8 of the maximum depth the neural network model with multiple hidden layers increased the details of water depth distribution though the combined methods were effective for non contact high accuracy and fully covered bathymetry of clear tufa lakes some deficiencies existed including manual exclusion of invalid areas insufficient spectral channels undetermined relationship between neural network topology and sample number and so forth therefore the proposed combined bathymetric methods still have room for improvements in the future the studies should involve automatic identification of uniform texture areas based on glcm establishment of bathymetric model using hyperspectral images and determination of the optimum neural network topology according to the number of sample points credit authorship contribution statement jinchen he methodology software validation data curation visualization writing original draft jiayuan lin conceptualization methodology funding acquisition supervision writing review editing xiaohan liao investigation funding acquisition project administration declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this article was jointly supported by the national natural science foundation of china grant no 32071678 the strategic priority research program of the chinese academy of sciences grant no xda19050501 and the key research and development program of the sichuan province grant no 2022yfq0035 the authors would like to thank yangchun wang and xiaolin du from institute of mountain hazards and environments chinese academy of sciences for their help in uav operations and data acquisition 
2656,accurate and updated bathymetric data is of great significance for the management and protection of alpine tufa lakes in recent years unmanned aerial vehicle uav borne optical remote sensing has become a cost effective technique for obtaining water depth of small and clear waters like tufa lakes uav based bathymetry can be categorized into photogrammetric approach and spectrally derived approach photogrammetric bathymetry is contactless but invalid in water areas with uniform texture while spectral based bathymetry requires a large amount of in situ depth measurements in this paper we combined the strengths of the two bathymetric methods to retrieve the depth of clear tufa lakes using neural networks the surface elevation and orthoimage were first produced from uav acquired overlapping images and then water color depth tie points were sampled in the orthoimage and refraction corrected bathymetric map next the shallow and deep neural networks were separately used to train the regression models for predicting water depth lastly the combined bathymetric methods were compared with the single ones in terms of effective spatial coverage and bathymetry accuracy the results indicated that the combined methods were superior to single bathymetric methods in fully covered bathymetry of clear tufa lakes the shallow neural network based model achieved the highest accuracy with the coefficient of determination r2 of 0 91 and the root mean square error rmse of 1 12 m whereas the deep neural network based model increased the details of water depth distribution keywords tufa lake unmanned aerial vehicle uav bathymetry optical image neural network digital bathymetric map dbm data availability data will be made available on request 1 introduction bathymetric survey is of great significance for the management and protection of alpine tufa lakes as a part of surface karst sedimentary landforms transparent blue green tufa lakes have high tourism and scientific value currás et al 2012 li et al 2020 however global climate change frequent geological disasters and over exploitation of tourism resources make the tufa lake landscape face the risk of degradation liu 2017 qiao et al 2016 accurate and updated water depth data is very critical for the monitoring and management of these lakes however depth measurement using sonar not only consumes huge resources but also is not suitable for shallow waters mandlburger 2021 satellite derived bathymetry sdb estimates the depth of shallow waters through remotely sensed satellite data which has been utilized since the 1970s lyzenga 1978 the technique was initially developed to retrieve water depth based on the spectral information of satellite imagery in most cases it follows the physical basis of exponential attenuation of optical signal in the water column the bathymetric retrieval techniques are generally built upon either physical principles or empirical models niroumand jadidi et al 2020 the analysis of radiative transfer process is the basis of physical techniques while the relationships between spectrally derived features e g band ratios and water depth should be established for empirical techniques therefore physical bathymetric techniques usually need to conduct accurate atmospheric correction and empirical techniques require to do numerous in situ measurements zhou et al 2021 as a result a large amount of additional workload has to be added in water depth retrieval recently satellite two media photogrammetry avoided these limitations and provided spatially extensive method for bathymetric mapping hodúl et al 2018 but it cannot satisfy the requirements of high resolution and fine scale bathymetry in alpine tufa lakes in recent years unmanned aerial vehicles uavs especially mini uavs and drone technologies have developed very rapidly making them a popular remote platforms xiang et al 2019 chen et al 2022 when taken as a whole system of components uav sensor ground station etc their technical terms are also known as unmanned aircraft systems uas or remotely piloted aircraft systems rpas colomina and molina 2014 alvarez et al 2018 at the moment uav based remote sensing has been increasingly used in forest surveys and management otero et al 2018 lin et al 2022 geological surveys colica et al 2021 hydrological research vélez nicolás et al 2021 and archaeological surveys rouse and krumnow 2020 etc meanwhile structure from motion and multi view stereo sfm mvs algorithms have become sophisticated but they still follow the photogrammetric principles westoby et al 2012 fonstad et al 2013 hence uav based sfm mvs photogrammetry is frequently used for geoscience applications owing to its advantages of low cost and high resolution eltner et al 2016 meinen and robinson 2020 granados bolaños et al 2021 previous studies have demonstrated that the uav acquired aerial images with high overlap can produce high resolution and high accuracy digital elevation models dems james and robson 2014 under the conditions of good illumination and transparent water overlapping uav imagery can also derive underwater topography woodget et al 2015 woodget et al 2019 which is referred to as bathymetry david et al 2021 mandlburger 2021 therefore uav based remote sensing has become an effective technique for retrieving depths of small and transparent tufa lakes he et al 2021 similar to existing satellite bathymetric models uav based bathymetry can be categorized into spectrally derived bathymetry and photogrammetric bathymetry dietrich 2017 shintani and fonstad 2017 kim et al 2019 the spectral based bathymetry was principally derived from the overlapping images taken by uav loaded visible multispectral cameras kim et al 2019 rossi et al 2020 the empirical sdb models such as log linear inversion model stumpf model and optimal band ratio analysis obra lyzenga 1978 stumpf et al 2003 legleiter et al 2009 have been applied to bathymetric survey achieving a depth accuracy of about 20 cm in shallow waters rossi et al 2020 as for uav based photogrammetric bathymetry the refraction correction is necessary to be conducted in the general uav sfm workflow this kind of approaches is essentially geometrical analysis that aims to eliminate the refraction effect of light at the air water interface one simplified post processing solution is to correct the initial water depth derived from the resulting dems using a constant scale factor woodget et al 2015 some other approaches deal with the refraction effect in the process of bundle adjustment maas 2015 mulsow et al 2018 or build a refraction correction model based on sfm mvs photogrammetric point cloud dietrich 2017 however it is very difficult for the photogrammetric bathymetry to identify effective tie points in overlapping images of the water area with uniform texture mandlburger 2019 so the bathymetric map frequently fails to cover the entire tufa lake in contrast spectral based bathymetry usually works better in the low texture areas of a tufa lake but requires a number of in situ depth measurements he et al 2021 therefore the spectral based and photogrammetric techniques complement each other and their integration may improve the effective coverage of bathymetry slocum et al 2020 literature review indicates that the combination of photogrammetric and spectrally derived bathymetry provides an increase of up to 61 in spatial coverage compared to either of the two approaches slocum et al 2020 the combined approach can be applied to the bathymetry of alpine tufa lakes and is expected to address the problem of missing image matching points in low texture areas as homologous products from uav acquired images the orthoimage and dem share the same spatial and temporal reference the digital number dn of spectral bands can be obtained from a sfm mvs derived orthoimage starek and giessel 2017 while the initial water depth can be extracted from a sfm mvs derived digital surface model dsm shintani and fonstad 2017 meinen and robinson 2020 since the uav acquired optical images are usually not preprocessed with the radiometric correction dn values will be used for water depth inversion instead of the reflectance ones kim et al 2019 the photogrammetric bathymetry can provide appropriate reference data for training validation and testing of spectral based bathymetric models like airborne lidar bathymetry mandlburger et al 2021 machine learning approaches including neural networks e g back propagation artificial neural networks usually do well in establishing the relationship between spectral features and reference data danesh yazdi et al 2021 feng et al 2021 guo et al 2021a slocum et al 2020 therefore the combined approaches using neural networks will not only effectively expand the bathymetric coverage but also make it possible for completely non contact bathymetry in alpine tufa lakes the structure of this paper is composed of the following sections section 2 introduces study area and uav data acquisition and then describes the methods including uav data processing single combined bathymetric approaches and accuracy assessment section 3 presents the water depth maps derived by bathymetric models their bathymetry accuracies and improvements from neural network based methods the transferability and deficiencies of combined bathymetric models are discussed in section 4 the conclusions of this study are drawn in section 5 2 materials and methods 2 1 study area and data 2 1 1 study area jiuzhai valley is located in the south of minshan mountain and the northeast of gongga mountain the terrain in the valley fluctuates and the main valley has the length of greater than 30 km in terms of geology and geomorphology jiuzhai valley is located in the transition zone of qinghai tibet plateau and sichuan basin hence the complex geologic history and widely distributed carbonate developed large scale karst tufa deposits in terms of climate and hydrology jiuzhai valley is included in the humid plateau climate there are 114 alpine lakes mostly distributed in groups with various sizes the water system in jiuzhai valley has a y shape which finally flows into the jialing river the waters from rize valley and zechawa valley in the upstream converge into shuzheng valley in the downstream fig 1 the study area is situated in shuzheng valley where many blue green tufa lakes are distributed including shuzheng lakes lying dragon lake spark lake and double dragon lake spark lake also known as huohuahai lake guo et al 2021b is a typical tufa lake located between double dragon lake and lying dragon lake in shuzheng valley it is roughly in a triangular shape with a side length of about 150 m the flow velocity in the lake was slow and the lake surface was calm on august 8 2017 an earthquake measuring 7 0 on the richter scale struck jiuzhaigou county northern sichuan province lei et al 2017 the epicenter was located in bimang village 5 km west of jiuzhai valley the earthquake triggered landslides and collapses in various locations in jiuzhaigou scenic area including nuorilang waterfall spark lake and other scenic spots the tufa barrage at the downstream side of spark lake collapsed in the earthquake as a result the lake water was almost drained out and the lake basin was exposed earthquake caused landslips in some tufa mounds of the lake and a small amount of flood remained in the downstream lake basin subsequently the collapsed barrage of spark lake was rebuilt but the morphology of original lake bed has not been significantly changed therefore it is an ideal test site for studying on bathymetry of tufa lakes 2 1 2 uav acquired images the raw aerial images in this study were acquired by two different unmanned aircrafts before and after jiuzhaigou earthquake a fixed wing uav feima f1000 was used before the earthquake to obtain images covering the whole shuzheng valley december 9 2016 while a quad rotor drone dji phantom4 pro was focused on the test site spark lake after the earthquake october 10 2018 the fixed wing uav was equipped with a consumer grade digital camera sony ilce 5100 and the quad rotor drone with specially designed camera dji fc6310 both uavs were loaded with inertial measurement unit imu and global positioning system gps to measure their instantaneous three dimensional 3d position and orientation information i e external orientation elements during airborne surveys the spatial resolutions of overlapping images collected by the fixed wing uav and the multi rotor drone were 10 cm and 5 cm respectively 2 2 methods and validation the major procedures of retrieving depth of clear tufa lakes include explanation of uav data processing single and combined bathymetric methods and validation of bathymetric accuracy 2 2 1 surface processing and sampling aerial triangulation is also called sfm in computer vision xiang et al 2019 the commercial sfm software i e pix4d 4 4 10 was applied to processing uav acquired images through the steps of auto triangulation orthorectification and mosaicking the purpose was to generate orthoimage and surface elevation of the study site fig 2 sfm mvs the state of art algorithms for 3d surface reconstruction are not only the core of aerial triangulation processing but also the key to producing the final products dense point cloud orthoimage dsm etc the sfm mvs processing starts with the automatic extraction of tie points in the uav acquired overlapping images sfm simultaneously obtains camera poses and parameters via bundle adjustment and generates sparse point cloud on the basis of sfm processing mvs densifies point cloud using multi view stereo matching algorithms smith et al 2014 then the dense point cloud is rasterized to produce the orthoimage and dsm of the study site iglhaut et al 2019 the spatial co registration and resampling of pre and post earthquake orthoimage and dsm were carried out in gis software i e arcgis 10 3 1 the points used for spatial co registration were distributed around spark lake and their positions were marked in the pre earthquake orthoimage as shown in fig 2a in order to keep the size and position of image pixels consistent the orthoimages and dsms before and after the earthquake were resampled with ground sample distance gsd of 5 cm the lake surface points were selected along the water s edge from the pre earthquake orthoimage and the average value of their elevations was taken as the final water surface elevation wse woodget et al 2019 the calculated wse was 2 226 93 m below which the bathymetric extent of the lake basin area was extracted from the pre earthquake dsm fig 2b the dsm falling in the bathymetric extent was regarded as the initial dem with a minimum elevation of 2 214 09 m then the initial digital bathymetric map dbm was obtained through the conversion between the initial dem and wse using eq 1 likewise the post earthquake dry depth of spark lake was converted from the dsm of exposed lake bed and the wse fig 3 b 1 h w s e e where h represents the water depth wse is the water surface elevation and e represents the lake bed elevation based on the pre and post earthquake dbms the two depth values of each sampling point were collected while the dn values of red green and blue bands of sampling points were extracted from the pre earthquake orthoimage in the sampling process we excluded the areas where the surface elevation had been changed or covered by ponding after the earthquake fig 3a random sampling was conducted in the selection of sample points which achieved the relatively balanced distribution of sample points with various water depths 900 sample points were randomly divided into 600 training points with depth values and dn values and 300 check points with post earthquake dry depth values the number distribution of sample points training points and check points in the various ranges of dry depths was shown in table 1 the training points were only used to establish spectral based bathymetric models and the check points were used to validate the accuracies of all bathymetric models including photogrammetric spectral based and neural network based models 2 2 2 single bathymetric methods single bathymetric methods can be divided into spectrally derived bathymetry and photogrammetric bathymetry the pre earthquake orthoimage and the conversed depth maps before and after the earthquake were taken as the data sources for single bathymetric methods spectrally derived bathymetry in our case was a method to retrieve the water depth by establishing the regression relationship between the band dn values or the combinations in the orthoimage and dry depth values after the earthquake for single band log linear models the green band lngreen was the preferred one for water depth inversion because it showed a stronger capability in penetrating the water body of tufa lakes for band ratio models the stumpf model usually applied the combination of blue band and green band lnblue lngreen to retrieve the water depth stumpf et al 2003 in such a model the longer wavelength green band provided the information of water depth change while the shorter wavelength blue band offered the information of bottom type legleiter et al 2009 compared with band ratio models the band difference model based on blue band and green band blue green was more in line with the water color features of transparent tufa lakes he et al 2021 photogrammetric bathymetry was based on the principle of photogrammetry and supplemented with refraction correction to obtain the actual water depth the initial dbm directly generated by photogrammetry had a large bias 2 3 m and needed to be corrected the geometry of refraction correction is described by snell s law eq 2 in our study refraction correction was applied to the initial dbm and a constant scale factor was used to correct the initial water depth according to the simplified snell s law alvarez et al 2018 the refractive index of fresh water 1 34 as the correction factor could generally meet the requirements of water depth estimation woodget et al 2015 shintani and fonstad 2017 in other words the actual water depth was equal to the initial water depth multiplied by 1 34 the dbm correction could be conveniently realized using the arcgis raster calculator tool however the initial raster dbm derived from dense point cloud would be affected by the quality of point cloud itself as shown in fig 4 the point cloud in low texture areas were missing due to the lack of effective tie points in the dense image matching of aerial auto triangulation as a result photogrammetric bathymetry could not generate bathymetric map effectively covering the entire tufa lake 2 sin r sin i n 2 n 1 where i and r are the incidence angle and refraction angle for light transmitting from air into water n1 and n2 are the refractive indexes of air and water 2 2 3 combined bathymetric methods as the spectral and geometric bathymetric methods complement each other the combination of them was expected to overcome the shortcomings of single bathymetric methods and establish a fully covered and non contact bathymetric method neural network is a machine learning based operation model which is composed of a large number of nodes or neurons in different layers generally a neural network architecture consists of one input layer one multi hidden layer s and one output layer danesh yazdi et al 2021 considering the fitting capability of neural networks to non linear problems the shallow and deep neural networks were selected to separately fit the training data the basic way of the combination was to take the refraction corrected water depth before the earthquake as the depth training data and establish the relationship between the band dn values in the pre earthquake orthoimage and water depths using neural network models the flow chart of combining geometric and spectral methods is shown in fig 5 the preliminary preparation for training the neural network models was to exclude the invalid area in the refraction corrected dbm and extract the corrected water color depth values from the valid area in our case the invalid area is the abnormal part of spark lake with uniform texture fig 4 and it would be excluded during water color depth tie point sampling the key to the establishment of bathymetric models was to use neural networks to train the regression models so as to input spectral features and output the predicted bathymetric values guo et al 2021a the spectral features here referred to the dn values of red green and blue bands in the pre earthquake orthoimage the neural network models were implemented using the matlab version r2017b neural network toolbox including a shallow neural network and a deep neural network the shallow neural network adopted one hidden layer with 5 nodes n 5 fig 6 a the deep neural network had three hidden layers fig 6b and the numbers of hidden layer nodes were 10 8 and 5 respectively k 10 l 8 and m 5 the reason for such choices was that complex topologies might lead to over fitting while simplistic ones could not accurately predict water depth slocum et al 2020 furthermore the shallow neural network was trained with levenberg marquardt back propagation algorithm the sigmoid function was used as the activation function of hidden layer neurons eqs 3 and 5 while the activation function of output layer neurons were linear eqs 4 and 6 danesh yazdi et al 2021 the deep neural network adopted the same activation function of hidden layers but did more repeated calculations of hidden layers neurons 3 g x 1 1 e x 4 f x x 5 h q g p 1 3 w pq x p a q 6 depth f q 1 n h q w q b where n is the number of nodes in the hidden layer wpq is the weight from the input layer to the hidden layer xp represents the dn values of red green and blue bands aq is a constant value belonging to the hidden layer s neurons hq is the output value of neuron q in the hidden layer wq is the weight from the hidden layer to the output layer b is a constant value relating to the output layer s neuron and depth represents the predicted water depth in addition the sample data for two neural networks were randomly divided according to the proportion of 7 2 1 namely 70 was used for training 20 for validation and 10 for testing the correlation coefficients r in training set validation set and test set of shallow neural network with single hidden layer and deep neural network with multiple hidden layers were listed in table 2 the two neural network models were retained after numerous times of training to predict the water depths of the entire bathymetric extent 2 2 4 metrics for accuracy assessment we would use the post earthquake dry depths of the check points as the reference values and conduct a point to point validation to evaluate the performance of various bathymetric models the statistical validation metrics for accuracy assessment included r2 coefficients of determination rmse root mean square error mae mean absolute error eq 7 and mre mean relative error eq 8 the rmse is non linear and has a higher weight for larger errors the mae is a linear index and all errors in the samples have the same weight the mre is known as percentage error which is more sensitive to the errors of low value interval 7 mae 1 n i 1 n h i h i 8 mre 1 n i 1 n h i h i h i 100 where h i is the resulting water depth at the location of a check point from various bathymetric models h i is the reference water depth and n is the number of check points 3 results 3 1 dbms derived by bathymetric models the six dbms derived by single and combined bathymetric models were shown in fig 7 as a whole the water depth distributions showed the similar pattern which was shallow in the west and deep in the east of spark lake in the shallow area the water depths of all models had little difference except for lngreen but in the deep area the maximum water depths of models lnblue lngreen refraction correction and deep neural network exceeded 16 m while those of models lngreen blue green and shallow neural network were less than 16 m the dbms obtained by single bathymetric methods had local anomalies in some areas for example there were obvious abnormal depressions scattered near submerged tufa mounds in the dashed rectangles in fig 7a which was retrieved by single band model lngreen as seen in fig 7b the band ratio model lnblue lngreen alleviated the abnormal depressions to a certain extent the band difference model blue green further improved such situation and nearly eliminated the anomalies in those areas fig 7c in contrast there were no abnormal depressions near the tufa mounds in the dbm derived by refraction correction model fig 7d but one abnormal bulge appeared in the dashed circle where the lake bed had a uniform texture as for the combined bathymetric methods based on neural network models there were basically no such anomalies as depressions and bulges in the resulting bathymetric maps fig 7e f compared with single bathymetric methods the combined ones were effective in the bathymetry of the entire water area of spark lake 3 2 accuracy assessment of bathymetric models in order to validate the bathymetric data derived from the six methods a total of 300 check points in the exposed basin of spark lake were collected fig 3 the relationships between the elevation values from the six dbms and those of the check points were presented as scatter plots in fig 8 as indicated in fig 8a the performance of single band model lngreen was the worst among all models with the r2 of 0 48 and the rmse of 2 59 m the band ratio model lnblue lngreen was slightly better with the r2 of 0 74 and the rmse of 1 82 m but there was a large deviation in the shallow water fig 8b compared with the single band model and the band ratio model the accuracy of band difference model blue green had been significantly improved with the r2 of 0 86 and the rmse of 1 37 m moreover the band difference model nearly performed well in the whole water depth range fig 8c as the r2 was 0 88 and the rmse was 1 32 m fig 8d refraction correction model achieved the accuracy close to that of the band difference model the combined bathymetric model based on shallow neural network achieved the highest accuracy with the r2 of 0 91 and the rmse of 1 12 m fig 8e the rmse was close to 8 of the maximum reference depth of spark lake however the accuracy of the combined model based on deep neural network was not further improved fig 8f its r2 was 0 90 and rmse was 1 18 m as indicated in fig 8 the derived depths from shallow neural network model and the reference ones from check points had the best consistency among all models especially in shallow water according to statistics in table 3 the bathymetric model on shallow neural network had the lowest mae and mre of 0 89 m and 17 13 respectively meanwhile the deep neural network model gained the second place with the mae of 0 93 m and the mre of 19 84 although the band difference model blue green and the refraction correction model had very close maes of 1 07 m and 0 98 m the mre of the former was much larger than that of the latter among spectral based bathymetric models the band difference model blue green performed best because it better reflected the rule of water color changing with water depth of a tufa lake after refraction correction the photogrammetric bathymetric model achieved similar overall accuracy to that of the band difference model and performed better in shallow water due to the involvement of the red band with strong capability for fitting non linear problems neural network based models accomplished the regression analysis between water color and water depth of the tufa lake with unique spectral features moreover the neural network based models took advantage of red green and blue bands simultaneously different from the blue and green bands commonly used in the band ratio difference models the red band was most sensitive to the depth change in shallow water areas in addition the shallow neural network model could satisfy the accuracy requirement of bathymetry with a small number of training samples but the deep neural network model could not further improve the accuracy without more sample data 3 3 improvements from neural network based methods the improvements from combined geometric and spectral methods were reflected in the spatial coverage and accuracy of bathymetry compared with the depth inversion models and the refraction correction model the neural network based combined methods had no obvious invalid bathymetric area and effectively covered the entire water area fig 7 a large number of color depth training samples for establishing spectral bathymetric models were obtained by refraction corrected photogrammetric bathymetry and the local anomalies at the water surface depressions or bulges caused by photogrammetric bathymetry were nearly eliminated by spectral based bathymetric method as a result the combined bathymetric methods on neural network models achieved the best bathymetric accuracy without in situ depth measurements especially in shallow water depth fig 8 in addition the results of combined bathymetry varied according to the adopted neural network architectures the shallow neural network with single hidden layer satisfied the requirement of combining geometric and spectral methods and achieved high accuracy bathymetry fig 8e although the deep neural network with more hidden layers did not further improve the bathymetric accuracy it added more details of water depth distribution in the deep water and tufa mound areas fig 7f 4 discussion 4 1 transferability analysis of bathymetric models in our study the trained and validated bathymetric models were also applied to lying dragon lake fig 9 a and double dragon lake fig 9m in shuzheng valley fig 1 the former is relatively deeper than spark lake and the latter is shallower according to the official data from jiuzhai admin the maximum depths of lying dragon lake and double dragon lake is 24 m and 9 m respectively since the pre earthquake uav images of the region were captured simultaneously these two lakes were considered to share the same spectral radiation conditions with spark lake hence the transferability of bathymetric models could be evaluated by applying trained and validated models based on spark lake to the two adjacent tufa lakes as indicated in fig 9b h the maximum water depths of lying dragon lake derived by bathymetric models were generally low apart from that of refraction correction model it was possibly caused by the saturation of optical signal in deep water or the refraction effect of light the depth depressions induced by sparse shadows dashed rectangles in fig 9b d and abnormal bulges caused by uniform textures dashed circles in fig 9e f were almost removed in the bathymetric maps fig 9g h derived by the neural network based combined methods especially deep neural network based one it indicated that the neural network based models were transferable to eliminate depth anomalies as for double dragon lake the depth depressions induced by large dark shadows dashed rectangles in fig 9j l were remarkable and abnormal bulges caused by uniform textures dashed circles in fig 9m n were still existing in contrast the deep neural network based model was basically able to derive its maximum water depth even with the interference of the large dark shadow fig 9p however a small amount of anomalies were present at the edges of the shadow the major reason for this phenomenon might be the lack of training samples at the transition zone between shadow and non shadow areas the shallow neural network based model also did worse in the dark shadow areas compared with the deep one in general the neural network based combined models performed well in relatively shallow waters without large dark shadows 4 2 deficiencies and potential remedies in this study the geometric and spectral methods were combined to realize non contact high accuracy and fully covered bathymetry of clear tufa lakes using neural networks however some deficiencies were reflected in the following aspects first of all when collecting the samples from the depth map derived by refraction corrected photogrammetric bathymetry the invalid areas with uniform texture were visually identified and manually excluded the available spectral channels of uav acquired visible images were limited for bathymetric modeling compared with hyperspectral imagery legleiter and fosness 2019 rossi et al 2020 there was a lack of quantitative study on the correspondence relationship between the topology of neural network and the number of training samples some measures could be taken to remedy these deficiencies in future applications for example the gray level co occurrence matrix glcm approach baraldi and parmiggiani 1995 could be used to automatically determine the low texture region in the bathymetric map with the gradual miniaturization and cost reduction uav borne hyperspectral sensors were expected to be used for bathymetry of tufa lakes various topologies of neural networks could be used for combined bathymetry to figure out the optimum correspondence with the number of training samples in addition it was beneficial to enhance the effective depth and accuracy of bathymetry if uav images were captured under conditions of good illumination and small solar altitude angle 5 conclusions in this study we combined the photogrammetric and spectral based bathymetric methods to derive dbms of tufa lakes using uav images and neural networks the important conclusions we concluded are as follows the surface elevation and orthoimage produced from uav based sfm mvs photogrammetry could be used as the data sources to derive the dbms of clear tufa lakes by refraction corrected photogrammetric bathymetry and spectrally derived bathymetry the refraction corrected bathymetry tended to cause depth anomalies in the water areas where the lake bed had a uniform texture while spectral based bathymetry usually induced abnormal depressions around the tufa mounds with sparse shadows and in the water areas with big shadows the combined bathymetric methods based on neural network models eliminated those depth anomalies occurring in single bathymetric methods and realized fully covered bathymetry of the tufa lake the neural network model with a single hidden layer achieved the highest accuracy of bathymetry with the r2 of 0 91 and the rmse of 1 12 m close to 8 of the maximum depth the neural network model with multiple hidden layers increased the details of water depth distribution though the combined methods were effective for non contact high accuracy and fully covered bathymetry of clear tufa lakes some deficiencies existed including manual exclusion of invalid areas insufficient spectral channels undetermined relationship between neural network topology and sample number and so forth therefore the proposed combined bathymetric methods still have room for improvements in the future the studies should involve automatic identification of uniform texture areas based on glcm establishment of bathymetric model using hyperspectral images and determination of the optimum neural network topology according to the number of sample points credit authorship contribution statement jinchen he methodology software validation data curation visualization writing original draft jiayuan lin conceptualization methodology funding acquisition supervision writing review editing xiaohan liao investigation funding acquisition project administration declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this article was jointly supported by the national natural science foundation of china grant no 32071678 the strategic priority research program of the chinese academy of sciences grant no xda19050501 and the key research and development program of the sichuan province grant no 2022yfq0035 the authors would like to thank yangchun wang and xiaolin du from institute of mountain hazards and environments chinese academy of sciences for their help in uav operations and data acquisition 
2657,the standardized precipitation evapotranspiration index spei lacks the assessment mechanism for the coupling relationship between the magnitudes of the precipitation p potential evapotranspiration etp and water deficit making it hard to predict the drought precisely this paper selected the marginal and joint cumulative distribution functions cdf of p and etp to present their magnitudes and water deficit respectively we formatted the frank copula based spei speic to combine the marginal cdfs at 3 6 9 and 12 month scales it indicated that the two parameter gamma distribution was the best fitted marginal cdfs of the p cdfp and etp cdf etp the cdfp exerted a slightly more significant marginal effect on the joint cdf than the cdf etp at 6 to 12 month scales indicated by the steeper slope of the cdfp s marginal curves vs joint cdf the verified more significant marginal effect denied the implied assumption of the same marginal effects of the p and etp using spei the new constructed speic temporally fluctuated highly consistent with the spei in the whole energy and water limited regions of china indicated by the higher 3 to 12 month averaged nash sutcliffe efficiency coefficient 0 63 and determination coefficient 0 75 the speic had a more sensitive detectivity of the drought frequency indicated by more events detected besides it had a minor sensitive detectivity of the drought severity indicated by the larger speic under the same specified frequencies of the p and etp keywords drought indices drought simulation drought assessment spei frank copula based spei data availability the authors do not have permission to share data 1 introduction drought is a multiscalar phenomenon essentially determined by the regionally available water resources in terms of soil moisture underground water snowpack streamflow and reservoir storage mckee et al 1993 vicente serrano et al 2010 the multiscalar character of drought regulated its onset duration and severity in the specified time scale which was helpful in different types of water resources management the palmer drought severity index pdsi was a landmark based on the simple double layer water balance fok et al 2018 zhao et al 2017 the major criticism of the pdsi concentrated on its fixed time scale guttman 1998 vicente serrano et al 2010 the standardized precipitation index spi succeeded in monitoring and predicting the droughts in different time scales for the water resources management but the spi was questionable in neglecting drought affected climatic elements other than the precipitation p uddameri et al 2018 vicente serrano et al 2010 drought is multivariable driven hydrological process that respond to climate change mukherjee et al 2018 vicente serrano et al 2015 the drought index was inferred to be multivariable formed to consider the hydrological cycle ultimately vicente serrano et al 2010 combined the advantage of the pdsi in the sensitivity on the climate change and of spi in the multitemporal scales to format the standardized precipitation evapotranspiration index spei the coupling relationship between the regional p and potential evapotranspiration etp existed at seasonal and annual scales as the feedback of the water vapor cycle p provided the water boundary condition of the actual evapotranspiration ae in the regional water vapor cycle statistically the p determined the ae to various extents in water or energy limited regions bai et al 2020 ukkola and prentice 2013 in water limited regions the increasing p would accelerate the regional water vapor cycle and increase the ae ae was not only the water loss process but also the energy consumption process via the transformation of latent heat and aerodynamic conditions allen et al 1998 donohue et al 2010 penman 1948 shuttleworth 1993 the accelerated ae driven water loss took more phase change heat away it would occupy the energy from the sensible heat given the stable net radiation rn the occupation would decrease the sensible heat in addition to the air temperature and the etp bai et al 2020 the response chain from the increased p to the decreased etp clearly presented the full picture of the interactive effect of the regional water vapor cycle the decrease in etp displayed as the compensation for the increase in ae during the response chain bouchet s complementary hypothesis interpreted the opposite temporal trends of annual etp and ae at the annual scale bai et al 2020 bouchet 1963 zuo et al 2016 chen and buchberger 2018 verified the response chain from p to etp by their negative correlation at the seasonal scale in energy limited region the latent heat was insufficient to transform the increased p into ae the insufficient latent heat blocked the water energy response process to some content bouchet s complementary relationship was hard to be observed instead the etp mainly determined the ae the consistent trends of annual ae and etp can be verified and interpreted by the penman hypothesis bai et al 2020 penman 1948 accordingly the regional p coupled with etp through the regional water vapor cycle at seasonal and annual scales spei lacked the assessment mechanism on the coupling relationship making it challenging to characterize actual water vapor cycle driven regional drought stress rds in essence the drought was the water budget derived deficit wd at different levels and time scales existing in the water resource systems guo et al 2019 keyantash and dracup 2002 wang et al 2011 the difference between the p and ae regulated the wd of the water resource systems according to the regional water balance principle the spei index employed the climatic water deficit cwd p etp to estimate the wd rather than p ae to represent a simple climatic water balance vicente serrano et al 2010 this type of cwd could only characterize the maximum rds rather than the actual rds the reason for not applying ae was its complicated relationships with the p etp and characterization of the terrestrial surface in the spei construction abiodun et al 2019 the coupling relationship between the p and etp provided a possible method to predict the water vapor cycle driven actual rds without directly estimating the ae by the complicated relationship with other environmental elements it appeared that obviously the spei lacked this kind of assessment mechanism on the coupling relationship to indicate the actual water vapor cycle driven rds the lack of an assessment mechanism on the actual water vapor cycle driven rds using spei resulted in the drought severity estimate bias the spei was the quantile of the standardized cumulative distribution function cdf of the monthly cwd thornthwaite 1948 vicente serrano et al 2010 the standardized cdf parameters differed in the temporal and spatial scales the spei was only related to the cwd given the same standardized cdf parameters according to the spei s original algorithm regardless of the magnitudes of the p and etp actually the magnitudes of the p and etp determined the types of the regions the water or energy limited one even the same cwd would represent the different levels of drought severity for the water or energy limited regions the spei lacked the assessment mechanism on the coupling relationship between the cwd and the magnitudes of the p and etp this shortage would lead to the drought severity estimate bias the copula function was able to couple the relationship between the wd and the magnitudes of the p and etp in special the copula function could link the marginal cdfs of the p and etp with the function parameters the marginal cdfs of the p and etp statistically indicated their magnitudes furthermore the regional p and etp pairwise coupled through the water vapor cycle and presented the correlation statistically niel et al 2019 the pearson spearman and kendall correlation coefficients could indicate their bivariate correlation akoglu 2018 those coefficients were further applied to estimate the parameters in the copula function to quantify the correlation between the marginal cdfs of the p and etp li et al 2013 tsakiris et al 2016 this correlation between p and etp statistically represented the wd accordingly the copula function could link either the wd or the magnitudes of the p and etp besides the regional p would display positive or negative relationships with the etp according to penman or bouchet s complementary hypothesis respectively bouchet 1963 penman 1948 the frank copula function could capture the ability to detect either positive or negative correlation ogana et al 2020 it was suitable to assess the joint cdfs of p and etp to present the regional wd and format the drought index accordingly this paper reformulated a new spei type index the copula based spei speic based on the frank copula function compared with the classic spei the speic added the assessment mechanism on the coupling relationship between the wd and the magnitudes of the p and etp driven by the regional water vapor cycle processes we also tested its detective abilities of drought 2 datasets and methodology 2 1 datasets the daily meteorological data at 819 meteorological gauges shown in fig 1 they were acquired from the china meteorological data sharing service system this system controlled the data quality with codes which were provided by the national meteorological information center 2019 we excluded the gauges when the missing data rate exceeded 20 seven hundred and sixty gauges were left after excluding the daily meteorological data included maximum and minimum air temperature c wind speed at 10 m height m s relative humidity rh sunshine duration n hours and p mm from 1961 to 2019 besides the mean daily temperature t was the mean value of the daily maximum and minimum air temperature we adjusted the wind speed at 10 m height to the one at 2 m height u2 allen et al 1998 water and energy limited regions for ae were defined with the mean annual p 800 mm and 800 mm respectively fig 1 wang et al 2021 2 2 methodology we drew a flow chart to summarize the employed methodology in 3 steps fig 2 step 1 was the best fitted marginal cdfs of the regional water balance components p and etp step 2 was the joint cdf estimation using the frank copula function based on the coupling relationship between the marginal cdfs step 3 was the drought scenario simulation and analysis using speic and spei to assess the speic s detectivity superiority 2 2 1 marginal distribution functions of the precipitation and potential evapotranspiration in the meteorological gauges at 3 to 12 month scales 1 estimation of the 3 to 12 month precipitation and potential evapotranspiration the albedo or canopy reflection coefficient cα was selected as 0 23 allen et al 1998 at each gauge the daily solar radiation rs and rn were calculated based on the observed n and the ångström presscott model parameters in china allen et al 1998 ångström 1924 bai et al 2020 ozturk 2015 as 1 r s a b n n r a 2 r n r ns r nl 1 c α r s r nl where a and a b are the fraction of extraterrestrial radiation reaching the earth on overcast days and clear days respectively n is the maximum possible sunshine duration hours ra is the extraterrestrial radiation mj m 2 day 1 rns is the net solar or shortwave radiation mj m 2 day 1 rnl is the net outgoing longwave radiation mj m 2 day 1 in addition the daily etp mm d 1 was estimated using the penman equation donohue et al 2010 penman 1948 at each gauge as 3 e t p δ δ γ p r n γ p δ γ p 6430 v p d λ 1 0 536 u 2 where δ is the slope of saturation vapor curve pa k γ p is the psychrometric constant pa k vpd is the vapor pressure deficit pa and λ is the latent heat of vaporization of water 2 45mjkg 1 3 6 9 and 12 months were specified as the time scales of the drought index to reveal both seasonal and inter annual distributions the observed daily p and estimated daily etp were summed to form the 3 to 12 month values at each gauge 2 marginal distribution functions of the precipitation and potential evapotranspiration six frequently used probability density functions pdfs were selected as the candidate marginal distribution functions of the p including the two parameter gamma logistic log logistic normal log normal and 3 parameter generalized extreme value distributions table 1 rahman 2019 zhang and li 2020 the maximum likelihood method was employed to estimate these distribution parameters using the mle tool in the matlab r2018b manufactured by mathworks inc at a 0 05 significance level the goodness of fit for each candidate pdf at every meteorological gauge was tested at 3 to 12 month scales using the chi2gof tool in the matlab r2018b manufactured by mathworks inc the result hp was one if the p vector came from the specified candidate pdf the test results hp 1 were accumulated among the meteorological gauges at 3 to 12 month scales we calculated the ratio of the accumulated hp and the number of the meteorological gauges to represent the specified candidate pdf s applicable ratio at the 3 month scale followed by 6 9 and 12 month scales best fitted pdf for the p was confirmed by the most significant 3 to 12 month averaged ratio besides few studies analyzed the best fitted pdf for the etp at different time scales accordingly we screened the best fitted pdfs for the etp according to the same procedure as the p based on the calibrated distribution parameters the corresponding cdf of the p was the integral of the probability density function f p from the lower limit of zero toward the quantile of p pp assadollahi and nowamooz 2018 4 cd f p 0 pp f p d p the cdf of monthly etp was defined as the integral of the probability density function with limit ranges between 0 and the quantile of etp etpp 5 cd f e t p p e t p e t pp 0 e t pp f e t p d e t p besides the joint cdf of the p and etp indicated the wd this paper selected the etp as the variable to build the speic we calculated its cdf as 6 cd f e t p p e t p e t pp p e t p e t pp 1 p et p et pp 1 0 et pp f et p det p 3 zero precipitation the cdf with zero p was assigned based on the historical occurrence frequency of the zero p lloyd hughes and saunders 2002 sienz et al 2012 stagge et al 2015 wu et al 2007 as 7 cd f p c d f p 0 1 c d f p 0 c d f p 0 where cdfp 0 denotes the cumulative distribution function of the zero precipitation cdfp 0 denotes the cumulative distribution function above the zero precipitation the cdf of the zero p was estimated using the weibull plotting position function makkonen 2006 2008 stagge et al 2015 8 cd f p 0 n p 0 n p 1 where np 0 denotes the sample capacity of the zero precipitation np denotes the total sample capacity of the precipitation 4 marginal cdfs test the empirical cdfs of the p or etp were calculated as 9 cd f e i io n s 1 where iio is the range number of the p or etp observations arranged by the increasing order ns is the sample capacity of the observations the coefficient of determination r2 was calculated and tested using the linear regression and student s t test between the theoretical marginal cdf cdft and cdfe of the p or etp gosset 1942 at a 0 05 significance level we accepted the simulation of the cdf of the p or etp through this test 2 2 2 frank copula based spei constructing the speic was divided into four steps fig 3 step 1 was the estimation of the marginal distribution functions of the p and etp in the meteorological gauges at 3 to 12 month scales listed in section 2 2 1 step 2 was the estimation of the joint cdf of p and etp at meteorological gauges using the frank copula function step 3 was the estimation of the best fitted cdf of the joint cdf step 4 was the normalization of the estimated cdf to build speic the step 2 3 and 4 were interpreted in detail as follows 1 joint cdf of p and etp at meteorological gauges wildly used frank copula was chosen to join the marginal cdfs of the p or etp to form the joint cdf c u v at the meteorological gauges the frank copula is a two dimensional archimedean copula with parameter θ defined as frank 1979 genest and rivest 1993 ogana et al 2020 10 c u v 1 θ ln 1 e θ u 1 e θ v 1 e θ 1 where u and v denote the cdfs of the p and etp at different time scales respectively the functional relationship between the parameter θ and kendall s τ was given as follows naz et al 2019 11 τ 1 4 θ d 1 θ 1 where d1 θ is the debye function for 1 d 1 θ 1 θ 0 θ t e t 1 d t kendall s τ is defined by the difference between the concordant and discordant pairs and expressed as the proportion of the total number of pairs as follows doorn et al 2018 12 τ 1 i j n s n s ξ x i y i x j y j 0 5 n s n s 1 where x and y are the time series vectors of the cdfs of the p and etp respectively the length of which were both ns ξ is the concordance indicator function defined as doorn et al 2018 13 ξ x i y i x j y j 1 for x i x j y i y j 0 1 for x i x j y i y j 0 the kendall s τ τo between the 3 month cdfs of p and etp was assessed by the corr tool in the matlab r2018b manufactured by mathworks inc followed by the 6 9 and 12 month scales parameter θ was estimated based on the τo using the nonlinear programming model as follows 14 min z θ τ θ τ 0 2 1 4 θ d 1 θ 1 τ 0 2 where z is the objective function this model was solved using the fmincon tool in the matlab r2018b manufactured by mathworks inc the calibrated parameter θ is further applied to assess the c p etp according to eq 10 at each meteorological gauge and specified time scale combined with the marginal cdfs of the p and etp 2 best fitted pdf of the joint cdf of p and etp at meteorological gauges the procedure of choosing best fitted pdf of the joint cdf was the same as that of marginal cdfs at meteorological gauges if the log logistic cdf f was proved to be the best fitted one the f of the c p etp f c p e t p and wd f wd were given by vicente serrano et al 2010 15 f c p e t p 1 α c p e t p γ β 1 f w d 1 α wd γ β 1 three parameters of f are assessed using the l moment procedure by singh et al 1993 vicente serrano et al 2010 16 β 2 ω 1 ω 0 6 ω 1 ω 0 6 ω 2 α ω 0 2 ω 1 β γ 1 1 β γ 1 1 β γ ω 0 α γ 1 1 β γ 1 1 β where ω0 ω1 and ω2 are the probability weighted moments the order s of which are given by vicente serrano et al 2010 17 ω s 1 n s i 1 n s 1 f e i s w d i where the fei is a frequency estimator given by hosking 1990 vicente serrano et al 2010 18 f e i i io 0 35 n s 3 the speic and spei we calculated the climatic wd by the p etp at 3 6 9 and 12 month scales and the classical spei can be acquired as the standardized normal distribution s quantile corresponding to the f wd its equations were given by vicente serrano et al 2010 19 spei w c 0 c 1 w c 2 w 2 1 d 1 w d 2 w 2 d 3 w 3 where 20 w 2 ln p c for p c 0 5 pc is defined as the probability of exceeding the specified wd pc 1 f wd the pc is replaced by 1 pc and the sign of the resultant spei is reversed given pc 0 5 c0 2 515517 c1 0 802853 c 2 0 010328 d1 1 432788 d2 0 189269 and d3 0 001308 we could easily obtain the speic as the standardized normal distribution s quantile corresponding to f c p etp the approximation of the speic followed the classical one abramowitz and stegun 1964 vicente serrano et al 2010 just replacing the f wd with f c p etp 2 2 3 assessment of the speic 1 temporal consistence of the speic and spei we calculated the monthly speic and spei indexes at each meteorological gauge china as a whole the water and energy limited regions of china during 1961 2019 the nash sutcliffe efficiency coefficient nse nash and sutcliffe 1970 was estimated between the speic and spei indexes in the same region followed by the r2 gosset 1942 at 3 to 12 month scales those statistics among regions were compared to detect the difference in the spei and speic s temporal consistency 2 detectivity superiority using the speic we compared the drought frequencies using speic and spei to find their difference given the same drought severity in special the drought index di classification values were specified to represent the different drought severities the frequency number was counted for each drought category classified by the spei and speic classification at 3 to 12 month scales table 2 mckee et al 1993 paulo et al 2012 wang et al 2017 then the empirical drought frequencies were calculated based on the counted frequency number eq 9 for each category using the speic and spei both observed frequencies were compared in the same category to test the detectivity superiority of drought frequency using speic we compared the drought severities using speic and spei to find their difference given the same frequency of the p and etp in special the marginal cdfs of the p and etp were specified to be 5 and 25 the corresponding 3 month speic and spei were estimated for both specified frequencies in water or energy limited regions of china we also assessed the 6 month 9 month and 12 month ones for each specified frequency 5 or 25 the estimated 3 to 12 month speic was averaged in water or energy limited followed by the spei the averaged speic and spei were pairwise compared at the same frequency 5 or 25 and region to assess the detectivity superiority of the drought severity using speic 3 results 3 1 marginal distribution functions of the precipitation and potential evapotranspiration in the meteorological gauges from 3 to 12 month scales table 3 shows the applicable ratio of the meteorological gauges for each candidate pdf of the p and etp using the chi2gof test specially 3 to 12 month averaged applicable ratio for the ga distribution of the p was assessed to be 0 93 as the most significant value among the candidate distributions it indicated that the ga distribution was the best fitted pdf for 3 to 12 month p in comparison 3 to 12 month averaged applicable proportion for the ga distribution of the etp was detected to be 0 9 as the most significant value among the candidate distributions it indicated that the ga distribution was also one of the best fitted distributions for 3 to 12 month etp for the sake of a standardized and simplified speic estimation procedure the marginal pdfs of the p and etp were unified to be the ga distribution function with shape and scale parameters the marginal cdfs of the 3 to 12 month p and etp fig 4 a and 4b were estimated based on the corresponding parameters from fig 4e to 4r the marginal cdfs simulation effects of the p and etp were evaluated using linear regression and student s t test between the cdft and cdfe the cdft linearly correlated with cdfe by the slope rates of 1 indicated by the r2 0 99 fig 5 the ga distribution was fitted to estimate the marginal cdfs of p and etp 3 2 frank copula based spei fig 6 shows the spatiotemporal distributions of the mean monthly τ and θ in china at 3 to 12 month scales both the coefficient τ and parameter θ were spatially and substantially bordered by the midline of china displaying high values in the energy limited region fig 6a in contrast they fell into their valley values in the water limited region seasonally coefficient τ s medians presented the multimodal seasonal distributions with the most significant peak values appearing in the same 6th month since the first statistical month at each scale fig 6b in comparison the parameter θ s medians generally displayed the unimodal seasonal distribution at all scales reaching their peak values in the 7th month since the first statistical month of each scale the monthly interquartile ranges of kendall s τ were reduced from 3 to 12 months but remained stable for the parameter θ accordingly the mean monthly τ and θ spatially presented high values in the energy limited region they fluctuated with the seasons appearing at the peak values in the 6th and 7th months since the first statistical month of each scale respectively monthly kendall s τ presented the reducing spatial dispersion from 3 to 12 month scales indicated by the decreasing monthly interquartile ranges conversely the monthly parameter θ showed a similar spatial dispersion characterized by the stable monthly interquartile ranges fig 7 shows the contour maps of the joint cdf of the cdfp and the cdf of cdf etp the joint cdf increased as either cdfp or cdf etp rose the contour was nearly symmetrical about the straight line cdfp 1 03cdf etp at a 3 month scale it meant the cdfp and cdf etp possessed similar marginal curves slope rates vs joint cdf in comparison the slope rate of the symmetrical straight line between the cdf etp and cdfp was assessed to be 1 17 at a 6 month scale 1 16 at a 9 month scale and 1 26 at a 12 month scale it indicated that the cdfp possessed a steeper slope rate of its own marginal curves vs joint cdf than the cdf etp accordingly the joint cdf displayed a positive correlation with the cdfp and cdf etp additionally the cdfp and cdf etp shared a substantially equal marginal effect on the joint cdf at the 3 month scale proved by the similar marginal curves slope rates vs joint cdf but the cdfp exerted a larger marginal impact on the joint cdf at 6 to 12 month scales indicated by its larger marginal curves slope rates table 3 shows the applicable proportion of the meteorological gauges for each candidate pdf of the joint cdf using chi2gof test specially 3 to 12 month averaged applicable proportion for the ll distribution of the joint cdf was assessed to be 0 77 as the most considerable value among different candidate distributions it indicated that the ll distribution function was the best fitted pdf for the joint cdf fig 8 shows the temporal variations of 3 to 12 month di in terms of the spei and speic in the energy limited water limited and whole regions of china the monthly speic temporally fluctuated highly consistent with the spei in three study regions 3 3 assessment of the speic the nse and r2 between the monthly speic and spei were calculated to assess their temporal consistency at 3 to 12 month scales table 4 in special the temporal consistency between the speic and spei was further confirmed by the higher 3 to 12 month averaged nse 0 63 and r2 0 75 for all the study regions the temporal consistency displayed more in the arid areas indicated by the nse 0 88 and r2 0 9 furthermore the temporal inconsistency gradually appeared between the speic and spei along with the extension of the specified time scales indicated by the continuously decreasing nse and r2 from 3 to 12 month scales in all study regions accordingly the monthly speic fluctuated highly consistent with the spei in all the study regions but this consistency gradually decreased with the extension of the specified time scales the drought frequencies were pairwise compared in the same drought category using speic and spei to test their difference table 4 specially the 3 to 12 month averaged drought frequencies using speic were assessed to be 5 96 13 87 among all the study regions for the mild drought events more significant than the frequency using spei in the corresponding area furthermore the 3 to 12 month averaged drought frequencies using speic were assessed to be 0 25 1 24 among all the study regions for the moderate drought events more significant than the frequency using spei in the corresponding area more drought events were detected using the speic than the spei no matter for the mild and moderate drought events indicated by the larger 3 to 12 month averaged drought frequencies accordingly the speic has a more sensitive detectivity of the drought frequency the speic and spei were pairwise compared at the specified cdfs of the p and etp to further find their difference given the p and etp s frequencies of 5 the 3 to 12 month averaged speic were assessed to be 1 45 in the energy limited region and 1 46 in the water limited region in comparison the 3 to 12 month averaged spei was detected to be 1 76 in energy limited and 1 85 in water limited regions the 3 to 12 month averaged speic appeared more significant than the spei no matter for the energy and water limited regions at the specified frequency of 5 given the p and etp s frequencies of 25 the 3 to 12 month averaged speic were assessed to be 0 91 in the energy limited and 0 92 in the water limited regions in comparison the 3 to 12 month averaged spei was detected as 0 82 in energy limited and 1 09 in the water limited regions the 3 to 12 month averaged speic appeared more significant than the spei in the water limited regions at the specified frequency of 25 accordingly the speic has a minor sensitive detectivity of the drought severity represented by the more significant 3 to 12 month averaged value at the same specified p and etp s frequencies in the study regions 4 discussion 4 1 marginal distribution functions of the precipitation and potential evapotranspiration in the meteorological gauges from 3 to 12 month scales best fitted cdfs of p and etp provided a theoretical basis for regionally long term water resources management in special precipitation and evaporation were the major segments in the water vapor cycle process indicated by the p and etp as the process variables respectively the p and etp was regarded as the random variables for a long period the probabilistic method was effective and wildly used for predicting their future scenario values meteorological drought was led by the lack of p at different spatiotemporal scales the best fitted cdfs of p needed to be screened to construct its probabilistic prediction model current studies proved the ga distribution was both temporally and spatially best fitted distribution for p in china wang et al 2019 zhao et al 2020 zuo et al 2021 it was superior to other pdfs in describing p at 1 3 6 9 12 and 24 month scales wang et al 2019 zhao et al 2020 and in the majority of the meteorological gauges in china zuo et al 2021 we drew a similar conclusion in this paper in comparison few papers discussed the cdfs of the etp we found the ga distribution was also the best fitted pdf in describing the etp at 3 6 9 and 12 month scales in china ga distribution could be used for the monthly p and etp s probabilistic prediction in china this tool provided a theoretical basis for regionally long term water resources management 4 2 frank copula based spei the p exerted more significant marginal effects on the joint cdf at 6 9 and 12 month scales which denied the implied assumption of the spei index construction specially the monthly wd was calculated by subtracting etp from the p during the spei index estimation yang et al 2016 given the water balance in the calculation interval mehr et al 2020 theoretically the partial derivative of the wd should be one concerning for either the p or the etp the equal absolute value of the partial derivatives implied the null assumption that p and etp marginally contributed to be equal on the wd at all scales followed by the spei index the slope rate of a symmetrical straight line was detected to be 1 02 between the cdfp and cdfetp at a 3 month scale fig 7 close to 1 this rate meant the cdfs of the p and etp exerted nearly equal marginal effects on the joint cdf this statistical finding validated the null assumption of the spei index construction instead the slope rates of the symmetrical straight lines were detected to be 1 16 1 26 at the 6 9 and 12 month scales these rates implied the p exerted more significant marginal effects on the joint cdf at the different time scales this statistical finding denied the null assumption of the spei index construction the correlation was verified between the p and etp as the independent variables of the spei index construction at 3 to 12 month scales the p and etp were selected as the independent variables to estimate the spei index shi et al 2020 in this paper kendall s rank correlation coefficient was chosen as the targeted index of the correlation between the independent variables its spatiotemporal distribution was assessed in china from 1961 to 2019 the higher kendall s rank correlation coefficient was detected to distribute in energy limited region it meant a higher correlation between the cdfs of the p and etp in this region at 3 to 12 month scales in comparison the lower kendall s rank correlation coefficient distributed in water limited region at 3 to 12 month scales it implied the lower correlation between cdfs of the p and etp in this region besides it was suspected whether the correlation would affect the stability of the index parameters just as the collinearity did júnior and nóbrega 2018 the regional water and energy coupling relationship could be applied to interpret the spatiotemporal distribution of kendall s rank correlation coefficient between the cdfs of the p and etp at 3 to 12 month scales the actual evapotranspiration was largely regulated by the p ukkola and prentice 2013 according to this finding the actual evapotranspiration should temporally go consistent with the p on the whole in water limited regions the actual evapotranspiration presented a complementary relationship with the etp where the contrary temporal tendencies were easily observed in this case the etp was expected to go inconsistent with the p temporally this inconsistency was verified in this paper indicated by the lower kendall s rank correlation coefficient in the water limited region in energy limited areas the actual evapotranspiration displayed a proportional relationship with the etp where consistent temporal tendencies were easily observed in this case the etp was expected to stay consistent with the p this consistency was verified in this paper indicated by the higher kendall s rank correlation coefficient in the energy limited region 4 3 assessment of the speic the new constructed speic index could capture the influences of the wd under different magnitudes of the p and etp the spei was a type of the cwd driven drought index yang et al 2016 lower cwd represented the severer degree of the drought no matter what the magnitudes of the p and etp were the magnitudes determined the types of regions the energy or water limited ones tomas burguera et al 2020 mcvicar et al 2012 zhang et al 2012 even the same cwd would indicate different levels of drought in other regions and periods in this case only the cwd index was insufficient to estimate the water budget based drought in comparison the speic considered the cdfs of the p and etp as the magnitude index besides this index employed the frank copula function to link the cdfs of the p and etp under the condition of the different magnitudes to characterize the wd compared with spei the speic could capture both effects of the wd and magnitude it was designed to compensate for the drought severity estimate bias using the spei in this paper the predicted speic was detected to be larger than spei under the same specified frequencies of the p and etp but the compensation still needed to be further assessed more drought events detected by the speic originated from the speic s ability to estimate the influences of the wd under the magnitudes of the p and etp in special the p and etp time series temporally fluctuated with different amplitudes the constructed wd index was expected to cut the original amplitudes of the p and etp because of the index s subtraction algorithm which weakened the wd index s temporal variation it was deduced that the amplitudes of the spei were also relatively narrow in comparison the speic coupled the cdfs of the p and etp which was not expected to alter the amplitudes of the p and etp accordingly the new constructed speic index was expected to detect more drought events than the spei it was definitely verified in our paper table 4 we assessed the pearson correlation coefficient between the drought indices spei and speic vs p and etp in humid and arid regions the interregional applicability of both indices in comparing drought events was discussed the available water resources could be better represented at the 12 month scale which was selected as an analysis period spei was initially designed as a flexible approach to combine the effects of p and etp mukherjee et al 2018 vicente serrano et al 2010 it performs appropriately by the equal marginal effect according to its definition however the spei may be limited in comparing the drought events among different climatic regions for instance the spei was deduced to be more correlated with p than the etp in the humid area mukherjee et al 2018 vicente serrano et al 2015 which was attributed to the significant magnitude of p this deduction was verified by the higher pearson correlation coefficient between the spei and p in the humid area at the 12 month scale fig 9 b in the arid region a more significant correlation was expected between the spei and etp compared to the humid region it was attributed to the increasing magnitude of the etp this expectation was observed and indicated by the higher pearson correlation coefficient between the spei and etp in the arid area than in the humid area fig 9 the diverse control variables for the spei among different climatic regions were the obstacle in comparing drought events in comparison the speic showed nearly equal correlations with the p and etp at the 12 month scale regardless of the humid and arid regions a similar correlation was attributed to considering the magnitudes of p and etp in the speic construction accordingly the speic provided a more reasonable approach to comparing drought events among different areas the copula based speic still needed to be further compared with the hydrological drought index to test its accuracy the speic was a water budget based drought index the same as the spei it was built according to the regional water balance stagge et al 2015 the streamflow was the direct hydrological observation to estimate the difference between water input and output over an extended period many hydrological drought indexes were constructed based on the streamflow such as the streamflow drought index tabari et al 2013 accordingly the speic still needed to be compared with the hydrological di to test its accuracy 5 conclusion we employed the two parameter gamma function as the best fitted marginal distribution functions of the p and etp at 3 6 9 and 12 month scales the kendall s rank correlation and frank copula coefficients were estimated between marginal cdfs additionally the spei index was reconstructed by coupling the cdfs of p and etp at 760 meteorological gauges in china using frank copula the new index was named after speic the speic s detectivity superiority of drought frequency and severity was assessed using the scenario simulation and analysis to the classical spei the 3 to 12 month averaged applicable ratio of the meteorological gauges for the ga distribution of the p and etp was assessed to be 0 93 and 0 9 as the most significant values among the candidate distributions respectively it indicated that the ga distribution was the best fitted pdfs for 3 to 12 month p or etp besides the marginal cdfs using ga distribution of the 3 to 12 month p and etp were accepted through linear regression and student s t test between the cdft and cdfe the kendall s rank correlation coefficient and frank copula s parameter presented spatially zonal and seasonal distributions in special the mean monthly kendall s rank correlation coefficient and frank copula s parameter spatially showed high values in the energy limited region of china in comparison both the coefficient and parameter displayed low values in water limited region temporally kendall s τ and parameter θ fluctuated with the seasons appearing the larger values in the 6th and 7th months since the first statistical month of each scale respectively and the monthly kendall s τ presented the reducing spatial dispersion from 3 to 12 month scales indicated by the decreasing monthly interquartile ranges conversely the monthly parameter θ showed a similar spatial dispersion characterized by the stable monthly interquartile ranges the joint cdf displayed positive correlations with the cdfp and cdf etp additionally the cdfp and cdf etp shared a substantially equal marginal effect on the joint cdf at a 3 month scale proved by their similar marginal curves slope rates vs joint cdf instead the cdfp exerted a more considerable marginal impact on the joint cdf at 6 to 12 month scales indicated by its larger marginal curves slope rates in general the new constructed speic temporally fluctuated highly consistent with the spei in the whole energy and water limited regions of china indicated by the higher 3 to 12 month averaged nse 0 63 and r2 0 75 furthermore more drought events were detected using the speic than the spei no matter for the mild and moderate drought events as indicated by the larger 3 to 12 month averaged drought frequencies the speic has a more sensitive detectivity of the drought frequency besides it had a minor sensitive detectivity of the drought severity indicated by the larger speic under the same specified frequencies of the p and etp credit authorship contribution statement hua bai conceptualization data curation formal analysis methodology software validation writing original draft writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgment this work was sponsored by the science and technology project for the education department of jiangxi province grant gjj171005 gjj170980 the critical program for the jiangxi provincial hydraulic science and technology projects grant 201922zdkt05 202023zdkt03 kt201726 and the national natural science foundation of china grant 41761058 
2657,the standardized precipitation evapotranspiration index spei lacks the assessment mechanism for the coupling relationship between the magnitudes of the precipitation p potential evapotranspiration etp and water deficit making it hard to predict the drought precisely this paper selected the marginal and joint cumulative distribution functions cdf of p and etp to present their magnitudes and water deficit respectively we formatted the frank copula based spei speic to combine the marginal cdfs at 3 6 9 and 12 month scales it indicated that the two parameter gamma distribution was the best fitted marginal cdfs of the p cdfp and etp cdf etp the cdfp exerted a slightly more significant marginal effect on the joint cdf than the cdf etp at 6 to 12 month scales indicated by the steeper slope of the cdfp s marginal curves vs joint cdf the verified more significant marginal effect denied the implied assumption of the same marginal effects of the p and etp using spei the new constructed speic temporally fluctuated highly consistent with the spei in the whole energy and water limited regions of china indicated by the higher 3 to 12 month averaged nash sutcliffe efficiency coefficient 0 63 and determination coefficient 0 75 the speic had a more sensitive detectivity of the drought frequency indicated by more events detected besides it had a minor sensitive detectivity of the drought severity indicated by the larger speic under the same specified frequencies of the p and etp keywords drought indices drought simulation drought assessment spei frank copula based spei data availability the authors do not have permission to share data 1 introduction drought is a multiscalar phenomenon essentially determined by the regionally available water resources in terms of soil moisture underground water snowpack streamflow and reservoir storage mckee et al 1993 vicente serrano et al 2010 the multiscalar character of drought regulated its onset duration and severity in the specified time scale which was helpful in different types of water resources management the palmer drought severity index pdsi was a landmark based on the simple double layer water balance fok et al 2018 zhao et al 2017 the major criticism of the pdsi concentrated on its fixed time scale guttman 1998 vicente serrano et al 2010 the standardized precipitation index spi succeeded in monitoring and predicting the droughts in different time scales for the water resources management but the spi was questionable in neglecting drought affected climatic elements other than the precipitation p uddameri et al 2018 vicente serrano et al 2010 drought is multivariable driven hydrological process that respond to climate change mukherjee et al 2018 vicente serrano et al 2015 the drought index was inferred to be multivariable formed to consider the hydrological cycle ultimately vicente serrano et al 2010 combined the advantage of the pdsi in the sensitivity on the climate change and of spi in the multitemporal scales to format the standardized precipitation evapotranspiration index spei the coupling relationship between the regional p and potential evapotranspiration etp existed at seasonal and annual scales as the feedback of the water vapor cycle p provided the water boundary condition of the actual evapotranspiration ae in the regional water vapor cycle statistically the p determined the ae to various extents in water or energy limited regions bai et al 2020 ukkola and prentice 2013 in water limited regions the increasing p would accelerate the regional water vapor cycle and increase the ae ae was not only the water loss process but also the energy consumption process via the transformation of latent heat and aerodynamic conditions allen et al 1998 donohue et al 2010 penman 1948 shuttleworth 1993 the accelerated ae driven water loss took more phase change heat away it would occupy the energy from the sensible heat given the stable net radiation rn the occupation would decrease the sensible heat in addition to the air temperature and the etp bai et al 2020 the response chain from the increased p to the decreased etp clearly presented the full picture of the interactive effect of the regional water vapor cycle the decrease in etp displayed as the compensation for the increase in ae during the response chain bouchet s complementary hypothesis interpreted the opposite temporal trends of annual etp and ae at the annual scale bai et al 2020 bouchet 1963 zuo et al 2016 chen and buchberger 2018 verified the response chain from p to etp by their negative correlation at the seasonal scale in energy limited region the latent heat was insufficient to transform the increased p into ae the insufficient latent heat blocked the water energy response process to some content bouchet s complementary relationship was hard to be observed instead the etp mainly determined the ae the consistent trends of annual ae and etp can be verified and interpreted by the penman hypothesis bai et al 2020 penman 1948 accordingly the regional p coupled with etp through the regional water vapor cycle at seasonal and annual scales spei lacked the assessment mechanism on the coupling relationship making it challenging to characterize actual water vapor cycle driven regional drought stress rds in essence the drought was the water budget derived deficit wd at different levels and time scales existing in the water resource systems guo et al 2019 keyantash and dracup 2002 wang et al 2011 the difference between the p and ae regulated the wd of the water resource systems according to the regional water balance principle the spei index employed the climatic water deficit cwd p etp to estimate the wd rather than p ae to represent a simple climatic water balance vicente serrano et al 2010 this type of cwd could only characterize the maximum rds rather than the actual rds the reason for not applying ae was its complicated relationships with the p etp and characterization of the terrestrial surface in the spei construction abiodun et al 2019 the coupling relationship between the p and etp provided a possible method to predict the water vapor cycle driven actual rds without directly estimating the ae by the complicated relationship with other environmental elements it appeared that obviously the spei lacked this kind of assessment mechanism on the coupling relationship to indicate the actual water vapor cycle driven rds the lack of an assessment mechanism on the actual water vapor cycle driven rds using spei resulted in the drought severity estimate bias the spei was the quantile of the standardized cumulative distribution function cdf of the monthly cwd thornthwaite 1948 vicente serrano et al 2010 the standardized cdf parameters differed in the temporal and spatial scales the spei was only related to the cwd given the same standardized cdf parameters according to the spei s original algorithm regardless of the magnitudes of the p and etp actually the magnitudes of the p and etp determined the types of the regions the water or energy limited one even the same cwd would represent the different levels of drought severity for the water or energy limited regions the spei lacked the assessment mechanism on the coupling relationship between the cwd and the magnitudes of the p and etp this shortage would lead to the drought severity estimate bias the copula function was able to couple the relationship between the wd and the magnitudes of the p and etp in special the copula function could link the marginal cdfs of the p and etp with the function parameters the marginal cdfs of the p and etp statistically indicated their magnitudes furthermore the regional p and etp pairwise coupled through the water vapor cycle and presented the correlation statistically niel et al 2019 the pearson spearman and kendall correlation coefficients could indicate their bivariate correlation akoglu 2018 those coefficients were further applied to estimate the parameters in the copula function to quantify the correlation between the marginal cdfs of the p and etp li et al 2013 tsakiris et al 2016 this correlation between p and etp statistically represented the wd accordingly the copula function could link either the wd or the magnitudes of the p and etp besides the regional p would display positive or negative relationships with the etp according to penman or bouchet s complementary hypothesis respectively bouchet 1963 penman 1948 the frank copula function could capture the ability to detect either positive or negative correlation ogana et al 2020 it was suitable to assess the joint cdfs of p and etp to present the regional wd and format the drought index accordingly this paper reformulated a new spei type index the copula based spei speic based on the frank copula function compared with the classic spei the speic added the assessment mechanism on the coupling relationship between the wd and the magnitudes of the p and etp driven by the regional water vapor cycle processes we also tested its detective abilities of drought 2 datasets and methodology 2 1 datasets the daily meteorological data at 819 meteorological gauges shown in fig 1 they were acquired from the china meteorological data sharing service system this system controlled the data quality with codes which were provided by the national meteorological information center 2019 we excluded the gauges when the missing data rate exceeded 20 seven hundred and sixty gauges were left after excluding the daily meteorological data included maximum and minimum air temperature c wind speed at 10 m height m s relative humidity rh sunshine duration n hours and p mm from 1961 to 2019 besides the mean daily temperature t was the mean value of the daily maximum and minimum air temperature we adjusted the wind speed at 10 m height to the one at 2 m height u2 allen et al 1998 water and energy limited regions for ae were defined with the mean annual p 800 mm and 800 mm respectively fig 1 wang et al 2021 2 2 methodology we drew a flow chart to summarize the employed methodology in 3 steps fig 2 step 1 was the best fitted marginal cdfs of the regional water balance components p and etp step 2 was the joint cdf estimation using the frank copula function based on the coupling relationship between the marginal cdfs step 3 was the drought scenario simulation and analysis using speic and spei to assess the speic s detectivity superiority 2 2 1 marginal distribution functions of the precipitation and potential evapotranspiration in the meteorological gauges at 3 to 12 month scales 1 estimation of the 3 to 12 month precipitation and potential evapotranspiration the albedo or canopy reflection coefficient cα was selected as 0 23 allen et al 1998 at each gauge the daily solar radiation rs and rn were calculated based on the observed n and the ångström presscott model parameters in china allen et al 1998 ångström 1924 bai et al 2020 ozturk 2015 as 1 r s a b n n r a 2 r n r ns r nl 1 c α r s r nl where a and a b are the fraction of extraterrestrial radiation reaching the earth on overcast days and clear days respectively n is the maximum possible sunshine duration hours ra is the extraterrestrial radiation mj m 2 day 1 rns is the net solar or shortwave radiation mj m 2 day 1 rnl is the net outgoing longwave radiation mj m 2 day 1 in addition the daily etp mm d 1 was estimated using the penman equation donohue et al 2010 penman 1948 at each gauge as 3 e t p δ δ γ p r n γ p δ γ p 6430 v p d λ 1 0 536 u 2 where δ is the slope of saturation vapor curve pa k γ p is the psychrometric constant pa k vpd is the vapor pressure deficit pa and λ is the latent heat of vaporization of water 2 45mjkg 1 3 6 9 and 12 months were specified as the time scales of the drought index to reveal both seasonal and inter annual distributions the observed daily p and estimated daily etp were summed to form the 3 to 12 month values at each gauge 2 marginal distribution functions of the precipitation and potential evapotranspiration six frequently used probability density functions pdfs were selected as the candidate marginal distribution functions of the p including the two parameter gamma logistic log logistic normal log normal and 3 parameter generalized extreme value distributions table 1 rahman 2019 zhang and li 2020 the maximum likelihood method was employed to estimate these distribution parameters using the mle tool in the matlab r2018b manufactured by mathworks inc at a 0 05 significance level the goodness of fit for each candidate pdf at every meteorological gauge was tested at 3 to 12 month scales using the chi2gof tool in the matlab r2018b manufactured by mathworks inc the result hp was one if the p vector came from the specified candidate pdf the test results hp 1 were accumulated among the meteorological gauges at 3 to 12 month scales we calculated the ratio of the accumulated hp and the number of the meteorological gauges to represent the specified candidate pdf s applicable ratio at the 3 month scale followed by 6 9 and 12 month scales best fitted pdf for the p was confirmed by the most significant 3 to 12 month averaged ratio besides few studies analyzed the best fitted pdf for the etp at different time scales accordingly we screened the best fitted pdfs for the etp according to the same procedure as the p based on the calibrated distribution parameters the corresponding cdf of the p was the integral of the probability density function f p from the lower limit of zero toward the quantile of p pp assadollahi and nowamooz 2018 4 cd f p 0 pp f p d p the cdf of monthly etp was defined as the integral of the probability density function with limit ranges between 0 and the quantile of etp etpp 5 cd f e t p p e t p e t pp 0 e t pp f e t p d e t p besides the joint cdf of the p and etp indicated the wd this paper selected the etp as the variable to build the speic we calculated its cdf as 6 cd f e t p p e t p e t pp p e t p e t pp 1 p et p et pp 1 0 et pp f et p det p 3 zero precipitation the cdf with zero p was assigned based on the historical occurrence frequency of the zero p lloyd hughes and saunders 2002 sienz et al 2012 stagge et al 2015 wu et al 2007 as 7 cd f p c d f p 0 1 c d f p 0 c d f p 0 where cdfp 0 denotes the cumulative distribution function of the zero precipitation cdfp 0 denotes the cumulative distribution function above the zero precipitation the cdf of the zero p was estimated using the weibull plotting position function makkonen 2006 2008 stagge et al 2015 8 cd f p 0 n p 0 n p 1 where np 0 denotes the sample capacity of the zero precipitation np denotes the total sample capacity of the precipitation 4 marginal cdfs test the empirical cdfs of the p or etp were calculated as 9 cd f e i io n s 1 where iio is the range number of the p or etp observations arranged by the increasing order ns is the sample capacity of the observations the coefficient of determination r2 was calculated and tested using the linear regression and student s t test between the theoretical marginal cdf cdft and cdfe of the p or etp gosset 1942 at a 0 05 significance level we accepted the simulation of the cdf of the p or etp through this test 2 2 2 frank copula based spei constructing the speic was divided into four steps fig 3 step 1 was the estimation of the marginal distribution functions of the p and etp in the meteorological gauges at 3 to 12 month scales listed in section 2 2 1 step 2 was the estimation of the joint cdf of p and etp at meteorological gauges using the frank copula function step 3 was the estimation of the best fitted cdf of the joint cdf step 4 was the normalization of the estimated cdf to build speic the step 2 3 and 4 were interpreted in detail as follows 1 joint cdf of p and etp at meteorological gauges wildly used frank copula was chosen to join the marginal cdfs of the p or etp to form the joint cdf c u v at the meteorological gauges the frank copula is a two dimensional archimedean copula with parameter θ defined as frank 1979 genest and rivest 1993 ogana et al 2020 10 c u v 1 θ ln 1 e θ u 1 e θ v 1 e θ 1 where u and v denote the cdfs of the p and etp at different time scales respectively the functional relationship between the parameter θ and kendall s τ was given as follows naz et al 2019 11 τ 1 4 θ d 1 θ 1 where d1 θ is the debye function for 1 d 1 θ 1 θ 0 θ t e t 1 d t kendall s τ is defined by the difference between the concordant and discordant pairs and expressed as the proportion of the total number of pairs as follows doorn et al 2018 12 τ 1 i j n s n s ξ x i y i x j y j 0 5 n s n s 1 where x and y are the time series vectors of the cdfs of the p and etp respectively the length of which were both ns ξ is the concordance indicator function defined as doorn et al 2018 13 ξ x i y i x j y j 1 for x i x j y i y j 0 1 for x i x j y i y j 0 the kendall s τ τo between the 3 month cdfs of p and etp was assessed by the corr tool in the matlab r2018b manufactured by mathworks inc followed by the 6 9 and 12 month scales parameter θ was estimated based on the τo using the nonlinear programming model as follows 14 min z θ τ θ τ 0 2 1 4 θ d 1 θ 1 τ 0 2 where z is the objective function this model was solved using the fmincon tool in the matlab r2018b manufactured by mathworks inc the calibrated parameter θ is further applied to assess the c p etp according to eq 10 at each meteorological gauge and specified time scale combined with the marginal cdfs of the p and etp 2 best fitted pdf of the joint cdf of p and etp at meteorological gauges the procedure of choosing best fitted pdf of the joint cdf was the same as that of marginal cdfs at meteorological gauges if the log logistic cdf f was proved to be the best fitted one the f of the c p etp f c p e t p and wd f wd were given by vicente serrano et al 2010 15 f c p e t p 1 α c p e t p γ β 1 f w d 1 α wd γ β 1 three parameters of f are assessed using the l moment procedure by singh et al 1993 vicente serrano et al 2010 16 β 2 ω 1 ω 0 6 ω 1 ω 0 6 ω 2 α ω 0 2 ω 1 β γ 1 1 β γ 1 1 β γ ω 0 α γ 1 1 β γ 1 1 β where ω0 ω1 and ω2 are the probability weighted moments the order s of which are given by vicente serrano et al 2010 17 ω s 1 n s i 1 n s 1 f e i s w d i where the fei is a frequency estimator given by hosking 1990 vicente serrano et al 2010 18 f e i i io 0 35 n s 3 the speic and spei we calculated the climatic wd by the p etp at 3 6 9 and 12 month scales and the classical spei can be acquired as the standardized normal distribution s quantile corresponding to the f wd its equations were given by vicente serrano et al 2010 19 spei w c 0 c 1 w c 2 w 2 1 d 1 w d 2 w 2 d 3 w 3 where 20 w 2 ln p c for p c 0 5 pc is defined as the probability of exceeding the specified wd pc 1 f wd the pc is replaced by 1 pc and the sign of the resultant spei is reversed given pc 0 5 c0 2 515517 c1 0 802853 c 2 0 010328 d1 1 432788 d2 0 189269 and d3 0 001308 we could easily obtain the speic as the standardized normal distribution s quantile corresponding to f c p etp the approximation of the speic followed the classical one abramowitz and stegun 1964 vicente serrano et al 2010 just replacing the f wd with f c p etp 2 2 3 assessment of the speic 1 temporal consistence of the speic and spei we calculated the monthly speic and spei indexes at each meteorological gauge china as a whole the water and energy limited regions of china during 1961 2019 the nash sutcliffe efficiency coefficient nse nash and sutcliffe 1970 was estimated between the speic and spei indexes in the same region followed by the r2 gosset 1942 at 3 to 12 month scales those statistics among regions were compared to detect the difference in the spei and speic s temporal consistency 2 detectivity superiority using the speic we compared the drought frequencies using speic and spei to find their difference given the same drought severity in special the drought index di classification values were specified to represent the different drought severities the frequency number was counted for each drought category classified by the spei and speic classification at 3 to 12 month scales table 2 mckee et al 1993 paulo et al 2012 wang et al 2017 then the empirical drought frequencies were calculated based on the counted frequency number eq 9 for each category using the speic and spei both observed frequencies were compared in the same category to test the detectivity superiority of drought frequency using speic we compared the drought severities using speic and spei to find their difference given the same frequency of the p and etp in special the marginal cdfs of the p and etp were specified to be 5 and 25 the corresponding 3 month speic and spei were estimated for both specified frequencies in water or energy limited regions of china we also assessed the 6 month 9 month and 12 month ones for each specified frequency 5 or 25 the estimated 3 to 12 month speic was averaged in water or energy limited followed by the spei the averaged speic and spei were pairwise compared at the same frequency 5 or 25 and region to assess the detectivity superiority of the drought severity using speic 3 results 3 1 marginal distribution functions of the precipitation and potential evapotranspiration in the meteorological gauges from 3 to 12 month scales table 3 shows the applicable ratio of the meteorological gauges for each candidate pdf of the p and etp using the chi2gof test specially 3 to 12 month averaged applicable ratio for the ga distribution of the p was assessed to be 0 93 as the most significant value among the candidate distributions it indicated that the ga distribution was the best fitted pdf for 3 to 12 month p in comparison 3 to 12 month averaged applicable proportion for the ga distribution of the etp was detected to be 0 9 as the most significant value among the candidate distributions it indicated that the ga distribution was also one of the best fitted distributions for 3 to 12 month etp for the sake of a standardized and simplified speic estimation procedure the marginal pdfs of the p and etp were unified to be the ga distribution function with shape and scale parameters the marginal cdfs of the 3 to 12 month p and etp fig 4 a and 4b were estimated based on the corresponding parameters from fig 4e to 4r the marginal cdfs simulation effects of the p and etp were evaluated using linear regression and student s t test between the cdft and cdfe the cdft linearly correlated with cdfe by the slope rates of 1 indicated by the r2 0 99 fig 5 the ga distribution was fitted to estimate the marginal cdfs of p and etp 3 2 frank copula based spei fig 6 shows the spatiotemporal distributions of the mean monthly τ and θ in china at 3 to 12 month scales both the coefficient τ and parameter θ were spatially and substantially bordered by the midline of china displaying high values in the energy limited region fig 6a in contrast they fell into their valley values in the water limited region seasonally coefficient τ s medians presented the multimodal seasonal distributions with the most significant peak values appearing in the same 6th month since the first statistical month at each scale fig 6b in comparison the parameter θ s medians generally displayed the unimodal seasonal distribution at all scales reaching their peak values in the 7th month since the first statistical month of each scale the monthly interquartile ranges of kendall s τ were reduced from 3 to 12 months but remained stable for the parameter θ accordingly the mean monthly τ and θ spatially presented high values in the energy limited region they fluctuated with the seasons appearing at the peak values in the 6th and 7th months since the first statistical month of each scale respectively monthly kendall s τ presented the reducing spatial dispersion from 3 to 12 month scales indicated by the decreasing monthly interquartile ranges conversely the monthly parameter θ showed a similar spatial dispersion characterized by the stable monthly interquartile ranges fig 7 shows the contour maps of the joint cdf of the cdfp and the cdf of cdf etp the joint cdf increased as either cdfp or cdf etp rose the contour was nearly symmetrical about the straight line cdfp 1 03cdf etp at a 3 month scale it meant the cdfp and cdf etp possessed similar marginal curves slope rates vs joint cdf in comparison the slope rate of the symmetrical straight line between the cdf etp and cdfp was assessed to be 1 17 at a 6 month scale 1 16 at a 9 month scale and 1 26 at a 12 month scale it indicated that the cdfp possessed a steeper slope rate of its own marginal curves vs joint cdf than the cdf etp accordingly the joint cdf displayed a positive correlation with the cdfp and cdf etp additionally the cdfp and cdf etp shared a substantially equal marginal effect on the joint cdf at the 3 month scale proved by the similar marginal curves slope rates vs joint cdf but the cdfp exerted a larger marginal impact on the joint cdf at 6 to 12 month scales indicated by its larger marginal curves slope rates table 3 shows the applicable proportion of the meteorological gauges for each candidate pdf of the joint cdf using chi2gof test specially 3 to 12 month averaged applicable proportion for the ll distribution of the joint cdf was assessed to be 0 77 as the most considerable value among different candidate distributions it indicated that the ll distribution function was the best fitted pdf for the joint cdf fig 8 shows the temporal variations of 3 to 12 month di in terms of the spei and speic in the energy limited water limited and whole regions of china the monthly speic temporally fluctuated highly consistent with the spei in three study regions 3 3 assessment of the speic the nse and r2 between the monthly speic and spei were calculated to assess their temporal consistency at 3 to 12 month scales table 4 in special the temporal consistency between the speic and spei was further confirmed by the higher 3 to 12 month averaged nse 0 63 and r2 0 75 for all the study regions the temporal consistency displayed more in the arid areas indicated by the nse 0 88 and r2 0 9 furthermore the temporal inconsistency gradually appeared between the speic and spei along with the extension of the specified time scales indicated by the continuously decreasing nse and r2 from 3 to 12 month scales in all study regions accordingly the monthly speic fluctuated highly consistent with the spei in all the study regions but this consistency gradually decreased with the extension of the specified time scales the drought frequencies were pairwise compared in the same drought category using speic and spei to test their difference table 4 specially the 3 to 12 month averaged drought frequencies using speic were assessed to be 5 96 13 87 among all the study regions for the mild drought events more significant than the frequency using spei in the corresponding area furthermore the 3 to 12 month averaged drought frequencies using speic were assessed to be 0 25 1 24 among all the study regions for the moderate drought events more significant than the frequency using spei in the corresponding area more drought events were detected using the speic than the spei no matter for the mild and moderate drought events indicated by the larger 3 to 12 month averaged drought frequencies accordingly the speic has a more sensitive detectivity of the drought frequency the speic and spei were pairwise compared at the specified cdfs of the p and etp to further find their difference given the p and etp s frequencies of 5 the 3 to 12 month averaged speic were assessed to be 1 45 in the energy limited region and 1 46 in the water limited region in comparison the 3 to 12 month averaged spei was detected to be 1 76 in energy limited and 1 85 in water limited regions the 3 to 12 month averaged speic appeared more significant than the spei no matter for the energy and water limited regions at the specified frequency of 5 given the p and etp s frequencies of 25 the 3 to 12 month averaged speic were assessed to be 0 91 in the energy limited and 0 92 in the water limited regions in comparison the 3 to 12 month averaged spei was detected as 0 82 in energy limited and 1 09 in the water limited regions the 3 to 12 month averaged speic appeared more significant than the spei in the water limited regions at the specified frequency of 25 accordingly the speic has a minor sensitive detectivity of the drought severity represented by the more significant 3 to 12 month averaged value at the same specified p and etp s frequencies in the study regions 4 discussion 4 1 marginal distribution functions of the precipitation and potential evapotranspiration in the meteorological gauges from 3 to 12 month scales best fitted cdfs of p and etp provided a theoretical basis for regionally long term water resources management in special precipitation and evaporation were the major segments in the water vapor cycle process indicated by the p and etp as the process variables respectively the p and etp was regarded as the random variables for a long period the probabilistic method was effective and wildly used for predicting their future scenario values meteorological drought was led by the lack of p at different spatiotemporal scales the best fitted cdfs of p needed to be screened to construct its probabilistic prediction model current studies proved the ga distribution was both temporally and spatially best fitted distribution for p in china wang et al 2019 zhao et al 2020 zuo et al 2021 it was superior to other pdfs in describing p at 1 3 6 9 12 and 24 month scales wang et al 2019 zhao et al 2020 and in the majority of the meteorological gauges in china zuo et al 2021 we drew a similar conclusion in this paper in comparison few papers discussed the cdfs of the etp we found the ga distribution was also the best fitted pdf in describing the etp at 3 6 9 and 12 month scales in china ga distribution could be used for the monthly p and etp s probabilistic prediction in china this tool provided a theoretical basis for regionally long term water resources management 4 2 frank copula based spei the p exerted more significant marginal effects on the joint cdf at 6 9 and 12 month scales which denied the implied assumption of the spei index construction specially the monthly wd was calculated by subtracting etp from the p during the spei index estimation yang et al 2016 given the water balance in the calculation interval mehr et al 2020 theoretically the partial derivative of the wd should be one concerning for either the p or the etp the equal absolute value of the partial derivatives implied the null assumption that p and etp marginally contributed to be equal on the wd at all scales followed by the spei index the slope rate of a symmetrical straight line was detected to be 1 02 between the cdfp and cdfetp at a 3 month scale fig 7 close to 1 this rate meant the cdfs of the p and etp exerted nearly equal marginal effects on the joint cdf this statistical finding validated the null assumption of the spei index construction instead the slope rates of the symmetrical straight lines were detected to be 1 16 1 26 at the 6 9 and 12 month scales these rates implied the p exerted more significant marginal effects on the joint cdf at the different time scales this statistical finding denied the null assumption of the spei index construction the correlation was verified between the p and etp as the independent variables of the spei index construction at 3 to 12 month scales the p and etp were selected as the independent variables to estimate the spei index shi et al 2020 in this paper kendall s rank correlation coefficient was chosen as the targeted index of the correlation between the independent variables its spatiotemporal distribution was assessed in china from 1961 to 2019 the higher kendall s rank correlation coefficient was detected to distribute in energy limited region it meant a higher correlation between the cdfs of the p and etp in this region at 3 to 12 month scales in comparison the lower kendall s rank correlation coefficient distributed in water limited region at 3 to 12 month scales it implied the lower correlation between cdfs of the p and etp in this region besides it was suspected whether the correlation would affect the stability of the index parameters just as the collinearity did júnior and nóbrega 2018 the regional water and energy coupling relationship could be applied to interpret the spatiotemporal distribution of kendall s rank correlation coefficient between the cdfs of the p and etp at 3 to 12 month scales the actual evapotranspiration was largely regulated by the p ukkola and prentice 2013 according to this finding the actual evapotranspiration should temporally go consistent with the p on the whole in water limited regions the actual evapotranspiration presented a complementary relationship with the etp where the contrary temporal tendencies were easily observed in this case the etp was expected to go inconsistent with the p temporally this inconsistency was verified in this paper indicated by the lower kendall s rank correlation coefficient in the water limited region in energy limited areas the actual evapotranspiration displayed a proportional relationship with the etp where consistent temporal tendencies were easily observed in this case the etp was expected to stay consistent with the p this consistency was verified in this paper indicated by the higher kendall s rank correlation coefficient in the energy limited region 4 3 assessment of the speic the new constructed speic index could capture the influences of the wd under different magnitudes of the p and etp the spei was a type of the cwd driven drought index yang et al 2016 lower cwd represented the severer degree of the drought no matter what the magnitudes of the p and etp were the magnitudes determined the types of regions the energy or water limited ones tomas burguera et al 2020 mcvicar et al 2012 zhang et al 2012 even the same cwd would indicate different levels of drought in other regions and periods in this case only the cwd index was insufficient to estimate the water budget based drought in comparison the speic considered the cdfs of the p and etp as the magnitude index besides this index employed the frank copula function to link the cdfs of the p and etp under the condition of the different magnitudes to characterize the wd compared with spei the speic could capture both effects of the wd and magnitude it was designed to compensate for the drought severity estimate bias using the spei in this paper the predicted speic was detected to be larger than spei under the same specified frequencies of the p and etp but the compensation still needed to be further assessed more drought events detected by the speic originated from the speic s ability to estimate the influences of the wd under the magnitudes of the p and etp in special the p and etp time series temporally fluctuated with different amplitudes the constructed wd index was expected to cut the original amplitudes of the p and etp because of the index s subtraction algorithm which weakened the wd index s temporal variation it was deduced that the amplitudes of the spei were also relatively narrow in comparison the speic coupled the cdfs of the p and etp which was not expected to alter the amplitudes of the p and etp accordingly the new constructed speic index was expected to detect more drought events than the spei it was definitely verified in our paper table 4 we assessed the pearson correlation coefficient between the drought indices spei and speic vs p and etp in humid and arid regions the interregional applicability of both indices in comparing drought events was discussed the available water resources could be better represented at the 12 month scale which was selected as an analysis period spei was initially designed as a flexible approach to combine the effects of p and etp mukherjee et al 2018 vicente serrano et al 2010 it performs appropriately by the equal marginal effect according to its definition however the spei may be limited in comparing the drought events among different climatic regions for instance the spei was deduced to be more correlated with p than the etp in the humid area mukherjee et al 2018 vicente serrano et al 2015 which was attributed to the significant magnitude of p this deduction was verified by the higher pearson correlation coefficient between the spei and p in the humid area at the 12 month scale fig 9 b in the arid region a more significant correlation was expected between the spei and etp compared to the humid region it was attributed to the increasing magnitude of the etp this expectation was observed and indicated by the higher pearson correlation coefficient between the spei and etp in the arid area than in the humid area fig 9 the diverse control variables for the spei among different climatic regions were the obstacle in comparing drought events in comparison the speic showed nearly equal correlations with the p and etp at the 12 month scale regardless of the humid and arid regions a similar correlation was attributed to considering the magnitudes of p and etp in the speic construction accordingly the speic provided a more reasonable approach to comparing drought events among different areas the copula based speic still needed to be further compared with the hydrological drought index to test its accuracy the speic was a water budget based drought index the same as the spei it was built according to the regional water balance stagge et al 2015 the streamflow was the direct hydrological observation to estimate the difference between water input and output over an extended period many hydrological drought indexes were constructed based on the streamflow such as the streamflow drought index tabari et al 2013 accordingly the speic still needed to be compared with the hydrological di to test its accuracy 5 conclusion we employed the two parameter gamma function as the best fitted marginal distribution functions of the p and etp at 3 6 9 and 12 month scales the kendall s rank correlation and frank copula coefficients were estimated between marginal cdfs additionally the spei index was reconstructed by coupling the cdfs of p and etp at 760 meteorological gauges in china using frank copula the new index was named after speic the speic s detectivity superiority of drought frequency and severity was assessed using the scenario simulation and analysis to the classical spei the 3 to 12 month averaged applicable ratio of the meteorological gauges for the ga distribution of the p and etp was assessed to be 0 93 and 0 9 as the most significant values among the candidate distributions respectively it indicated that the ga distribution was the best fitted pdfs for 3 to 12 month p or etp besides the marginal cdfs using ga distribution of the 3 to 12 month p and etp were accepted through linear regression and student s t test between the cdft and cdfe the kendall s rank correlation coefficient and frank copula s parameter presented spatially zonal and seasonal distributions in special the mean monthly kendall s rank correlation coefficient and frank copula s parameter spatially showed high values in the energy limited region of china in comparison both the coefficient and parameter displayed low values in water limited region temporally kendall s τ and parameter θ fluctuated with the seasons appearing the larger values in the 6th and 7th months since the first statistical month of each scale respectively and the monthly kendall s τ presented the reducing spatial dispersion from 3 to 12 month scales indicated by the decreasing monthly interquartile ranges conversely the monthly parameter θ showed a similar spatial dispersion characterized by the stable monthly interquartile ranges the joint cdf displayed positive correlations with the cdfp and cdf etp additionally the cdfp and cdf etp shared a substantially equal marginal effect on the joint cdf at a 3 month scale proved by their similar marginal curves slope rates vs joint cdf instead the cdfp exerted a more considerable marginal impact on the joint cdf at 6 to 12 month scales indicated by its larger marginal curves slope rates in general the new constructed speic temporally fluctuated highly consistent with the spei in the whole energy and water limited regions of china indicated by the higher 3 to 12 month averaged nse 0 63 and r2 0 75 furthermore more drought events were detected using the speic than the spei no matter for the mild and moderate drought events as indicated by the larger 3 to 12 month averaged drought frequencies the speic has a more sensitive detectivity of the drought frequency besides it had a minor sensitive detectivity of the drought severity indicated by the larger speic under the same specified frequencies of the p and etp credit authorship contribution statement hua bai conceptualization data curation formal analysis methodology software validation writing original draft writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgment this work was sponsored by the science and technology project for the education department of jiangxi province grant gjj171005 gjj170980 the critical program for the jiangxi provincial hydraulic science and technology projects grant 201922zdkt05 202023zdkt03 kt201726 and the national natural science foundation of china grant 41761058 
2658,precise long term streamflow prediction has always been important in the hydrology field and has provided essential information for efficient water resource management and disaster prevention attention to this field has increased recently owing to water and climate crises despite the remarkable improvements in existing data driven models they still have weaknesses particularly for multistep predictions in poorly gauged basins the purpose of this study is to improve the multistep ahead prediction ability by considering mesoscale hydroclimate data as booster predictors and employing attention based deep learning therefore a meta algorithm is proposed for analyzing time series data in complex geo spatiotemporal environments to assess the superiority of prediction with booster predictors through direct and direct recursive hybrid strategies in the subsequent stage a novel integrated neural network architecture is demonstrated that couples a deep convolutional neural network cnn with a deep attention network in particular the former network performs automatic feature engineering and the latter focuses on lengthy sequence complexities four state of the art combinations for 12 month ahead prediction are introduced including pairs of timedistributed cnn td cnn and 3d cnn along with a long and short term time series network lstnet or a transformer network moreover a base architecture was employed for model comparison that contains the convlstm2d layer that is compatible with multidimensional time series data for this all models were applied to the karkheh river basin in the northeast of the persian gulf where monthly historical records of streamflow are available from 1955 to 2021 the results revealed that the application of hydroclimate sea surface temperature data and mean surface level pressure along with local data increased the prediction accuracy moreover the proposed integrated networks delivered more accurate long term streamflow predictions than the base models through various evaluation criteria including r r2 mean absolute error root mean square error kling gupta efficiency willmott s index legates mccabe s and the akaike information criterion in summary the 3d cnn transformer achieved the best performance followed by the td cnn transformer td cnn lstnet and 3d cnn lstnet with r2 values equal to 0 952 0 930 0 900 and 0 837 respectively this study demonstrates that the application of hydroclimate data with proposed integrated networks are particularly useful for poorly gauged basin thus the proposed models can potentially improve multistep ahead streamflow prediction compared to univariate and equation based models abbreviations ai artificial intelligence aic akaike information criterion ann artificial neural networks ar auto regressive arch autoregressive conditional heteroscedasticity bart bayesian additive regression tree bmwivs binary metaheuristic wrapper based input variable selection brf boruta feature selection algorithm cnn convolutional neural network 2d cnn two dimensional cnn 3d cnn three dimensional cnn convlstm convolutional long and short term memory network csa cooperation search algorithm cspa conditional superior predictive ability dae deep auto encoder ddgn directed graph deep neural network diff differential method dl deep learning eemd ensemble elm extreme learning machine emd empirical mode decomposition fos fast orthogonal search ffnn feedforward neural network gb gradient boosting gru gated recurrent unit kge kling gupta efficiency knn k nearest neighbors lm legates mccabe s lstm long and short term memory lstnet long and short term time series network mae mean absolute error mars multivariate adaptive regression splines mdts multidimensional time series mlr multiple linear regression msa multistep ahead mspl mean surface pressure level nse nash sutcliffe coefficient pca principle component analysis method pcsa parallel cooperation search algorithm r correlation r2 coefficient of determination rf random forest rmse root mean square error rnn recurrent neural network sf single model forecasting ssa single step ahead sst sea surface temperature vmd variational mode decomposition wi willmott s index agreement keywords attention based deep learning climate change monthly streamflow prediction multistep ahead prediction multidimensional time series data availability data will be made available on request 1 introduction streamflow prediction is vital for integrated water resource planning and management as it provides a reliable management plan and prevents the devastating effects of extreme events on human society infrastructure and the natural ecosystem generally streamflow prediction is temporally categorized into short and long term horizons with different time scales ranging from hourly to monthly short term predictions at minor scales aim to facilitate reliable and stable flood and mitigation system operations in contrast long term prediction with a larger scale is an essential precondition for efficient water resource management hydropower generation irrigation management scheduling releases sediment transport and other management scenarios to mitigate water and climate crises yaseen et al 2016 due to complexity nonlinearity and poor data quality long term prediction has not been thoroughly studied despite its importance and broad applicability in the real field this is particularly true in ungauged or data scarce regions which are much more vulnerable to extreme events owing to the lack of in situ data kunnath poovakka et al 2016 sun et al 2018 wang et al 2021 generally streamflow prediction models can be divided into two main categories theoretical based models and data driven models the former includes hydrological and conceptual approaches while the latter involve statistical and artificial intelligence ai approaches zhao et al 2021 statistical models such as multiple linear regression autoregressive ar moving average ma ar moving average arma and ar integrated moving average arima have been traditionally used for developing time series models these models are considered as the most straightforward and conventional methods for short term prediction on the other hand they do not capture the underlying nonlinearities of historical records therefore these models are less sensitive toward anomalies such as drought and floods and do not yield a confident prediction for the extended horizon in contrast ai based models can appropriately manage the nonlinear characteristics and yield more accurate long term predictions overall the ai based models that have been widely used in the field of hydrology are classified into four major subcategories machine learning ml fuzzy logic approach evolutionary computation and wavelet transformation yaseen et al 2015 tabbussum and dar 2021 li et al 2022 owing to the flexibility and accessibility of ml techniques improving prediction capacity by employing them has recently garnered increasing attention among researchers kao et al 2020 ren et al 2021 during the last few decades ml prediction models based on artificial neural networks anns support vector machines svm and sv regressions svr convolutional neural networks cnns and recurrent neural networks rnns have improved the abilities for predicting streamflow cnns are well known algorithms mainly because of their capability in automatic feature engineering rnn algorithms have been introduced with an inner loop and hidden state to capture temporal dependencies and preserve the past input data memory however rnns pose gradient vanishing issues for long term dependencies xiao et al 2021 thus an improved rnns structure long short term memory lstm and gated recurrent unit gru have been introduced by adding the cell state and gating mechanisms tayerani charmchi et al 2021 recently deep learning dl techniques which is considered as a subset of ml have been successfully applied in the field of hydrology ewuzie et al 2022 dl can be employed for both feature extraction and development of predictive models which is considered the most significant difference between dl and ml sarker 2021 several studies claimed the superiority of gradient boosting gb and random forest rf as the well known algorithms for el models in hydrology mainly because of their outstanding performance in multi input and multi output structures zounemat kermani et al 2021 in the last decades with the increasing volume and quality of temporal data dl has emerged as a robust technique for multivariate time series mts prediction while el faces memory issues recently several studies have combined the advantage of both dl as well as el such that the final model yields a better prediction performance the integrated deep ensemble learning methods enhanced the feature engineering performance and allowed the evolution of the prediction algorithms cheng et al 2020 gao et al 2020 kao et al 2020 recent studies of streamflow prediction are summarized in table 1 some researchers have trained models using multiple sources and types of hydrological variables and are more focused on enhancing feature engineering apaydin et al 2021 conversely some studies focused on the improvement of the prediction methods by applying a wide variety of ai algorithms and different training validation and prediction strategies liu et al 2022 tikhamarine et al 2020 in this regard ghimire et al 2021 used an integrated cnn lstm model to predict short term streamflow other studies concurrently investigated the improvement of feature engineering efficiency and predictive modeling most attempts at streamflow prediction have utilized conventional ml models for single step ahead ssa time series prediction mehdizadeh et al 2019 nanda et al 2019 yang et al 2019 adnan et al 2021 apaydin et al 2021 lin et al 2021a 2021b ren et al 2021 zhao et al 2021 masrur ahmed et al 2021 cho and kim 2022 nguyen et al 2022 followed by multistep ahead msa time series prediction osman et al 2020 cheng et al 2020 zuo et al 2020 abbasi et al 2021 feng et al 2021 feng et al 2022 whereas limited research has been conducted to assess and compare the application of state of the art dl models with msa approach for long term streamflow prediction liu et al 2022 in particular msa prediction can be achieved by direct and indirect strategies each of which has merits and limitations conventionally a recursive strategy is employed to indirectly transform msa predictions using an ssa model such that the prior output serves as an input for the subsequent step in contrast the direct strategy involves independent output at each time step for msa predictions comparing ssa studies with msa showed that direct strategies are more promising choices over recursive strategies for long term prediction as chain steps cause accumulated errors despite this advantage msa has not been extensively studied as it is a more complex problem especially in the case of dealing with mts and long term predictions as indicated in table 1 this is because predicting successive steps needs voluminous data expertise and lengthy procedures notably extending the prediction horizon through the msa approach is critical for efficient water resource planning and management which can effectively help mitigate flood and drought damages guo et al 2021 hence considerable research is required to make long term prediction practical especially in the case of lacking data the advent of large scale hydroclimate data with global coverage provides a once for all solution to streamflow prediction at various spatiotemporal scales for regions lacking adequate stations or ungauged basins according to table 1 several prior studies have primarily focused on the evaluation of the applicability of these hydroclimate data on a global scale for increasing the streamflow prediction accuracy through spatiotemporal modeling e g adnan et al 2021 banihabib et al 2018 bhandari et al 2018 du et al 2020 meidani and araghinejad 2014 senatore et al 2020 in these models mts is formed by concatenating a time series that is created for each location across columns new approaches emerged for dealing with mts and showed a great performance for streamflow prediction regarding the open literature review stand alone prediction models such as lstm and gru are not able to achieve appropriate performances for long term prediction owing to gradient vanishing problems in complex mts environments whereas integrated models can achieve improved prediction accuracy barzegar et al 2020 in this regard qin et al 2017 proposed a dual stage attention based rnn for mts prediction which focused on the extraction of relevant features and temporal correlations in the first and second stages respectively lai et al 2018 proposed an integrated cnn gru framework namely long and short term time series network lstnet to learn short term spatial dependencies and long term patterns among mts data using convolutional layer and temporal attention respectively similarly xiao et al 2021 proposed an attention based cnn lstm network to discover the spatiotemporal correlations and achieve more accurate long term predictions of mts data inspired by cognitive neuroscience vaswani et al 2017 introduced the transformer model by stacking self attention layers instead of rnns or cnns as a novel architecture for natural language processing nlp the self attention provides the ability to re represent the input sequence by attending to different positions which help capture precise long range dependencies recent studies have indicated the potential of the transformer model to increase the capability of long term mts prediction however in practice mts frameworks are not compatible with structured volumetric data such as historical remote sensing records and geo spatiotemporal data baumann 2021 to the best of our knowledge a systematic approach for dealing with complex geo spatiotemporal dependencies to achieve a robust long term prediction is still an ongoing challenge in the field of hydrology moreover the automatic feature engineering method compatible with three or higher dimensional data is a major bottleneck in dl gu et al 2021 therefore more intelligent state of the art integrated networks are required to address the complex and dynamic long term interdependencies for accurate msa predictions this study aims to address the research gaps mentioned earlier the original aspects and contributions of this study are fourfold first a multimedia concept is introduced to apply to labeled multidimensional time series mdts data in a geo spatiotemporal environment second the hypothesis is formulated based on two strategies namely direct and direct recursive hybrid predictions to test the conditional superior predictive ability cspa of the 12 month ahead prediction model with hydroclimate booster predictor against the univariate as two scenarios third a meta algorithm is proposed for analyzing dynamic interdependencies among the prepared mdts to construct the four equation based predictive models and evaluate the postulated hypothesis fourth a novel integrated neural network architecture is demonstrated that couples deep cnns with lstnet and the transformer network for automatic feature engineering and robust 12 month ahead prediction framework compatible with four dimensional 4d input data four novel models are developed based on proposed architecture including 3d cnn transformer time distributed 2d cnn transformer 3d cnn lstnet and time distributed 2d cnn lstnet all models are compared with respect to base models that are developed based on direct and recursive strategies by employing convlstm2d as a well known layer the karkheh river basin in the northeast of the persian gulf was employed as a case study with 67 years of available historical monthly streamflow records the geo spatiotemporal correlation among adjacent hydroclimate sea surface temperature mean surface level pressure and local data were reported the remainder of this study proceeds as follows in section 2 the materials and methods are presented in the subsections of tests of conditional superior predictive ability 2 1 data acquisition 2 2 equation based prediction models 2 3 attention based deep learning models 2 4 and prediction model evaluation 2 5 in section 3 a case study and local and mesoscale hydroclimate data are detailed in section 4 the experimental setting is detailed the results are presented in section 5 with two subsections focusing on the evaluation of the application of hydroclimate data 5 1 followed by an evaluation of proposed integrated attention based dl 5 2 the discussion of the results are provided in section 6 ultimately the concluding remarks of this study with the directions for future research are discussed in section 7 2 material and methods in this section hypotheses associated with the conditional superior prediction ability and data acquisition are elucidated equation based models in two prediction strategies under two scenarios and four novel integrated attention based dl models are proposed a logical flowchart of this study is given in fig 1 2 1 tests of conditional superior predictive ability a valid and reliable time series prediction model for the univariate scenario i using only the historical streamflow as input variables was considered as a benchmark model and its performance relative to the multivariate scenario ii was measured using both the hydroclimate data and historical streamflow data as the input variables as follows 1 d t i l y t h y t h ii l y t h y t h i where d t i denotes the loss differential l is the given loss function and y t h denotes the vector of streamflow variables considering the prediction at the instant t after h periods in addition y t h i and y t h ii represent the alternative prediction vectors based on the information available in scenarios i and ii respectively subsequently the cspa test was performed to obtain the desirable features to improve the prediction ability moreover the null hypothesis of this statistical significance test can be expressed as follows 2 h 0 cspa e d t i x t v 0 v v c c where e denotes the conditional expectation functions x t represents the selected underlying construct of the mesoscale variables and v specifies the conditional region as a subset of the domain v c in case the null hypothesis is rejected the local data were combined with the hydroclimate data otherwise only the historical data were used upon the acceptance of the null hypothesis 2 2 data acquisition the current framework involves a data based hydroclimate analysis and modeling wherein satellite based and in situ data are two common sources of hydrometeorological datasets required for streamflow prediction although the use of meteorological data measured by local stations is preferred in most prediction studies the unavailability or lack of reliable measurement devices degrades the quality of the local in situ data thus the following criteria were used as a rationale to acquire nonlocalized data for improving the prediction ability the periodic monitoring prediction of the local hydrological variable can be improved by introducing mesoscale variables into the modeling workflow kingston et al 2016 the spatial correlation between these variables yields a spectrum of regions with a retrospective temporal correlation between a pair of observed streamflow and nonlocalized climate data after the reliable mesoscale datasets are acquired to identify the variables preprocessing is required to reshape and prepare them for application on the remaining framework as temporal correlation varied dynamically with the spatial parameters and vice versa a new preprocessing method was proposed to evaluate concurrently the correlations between the exogenous and endogenous variable series and among any pair of exogenous variables the geo spatiotemporal dataset structure complex relationships in the geo spatiotemporal environment and the first step of the preprocessing method are schematically depicted in fig 2 a c wherein the geospatial time series datasets are mdts arrays according to fig 2 a each value is mapped to the feature latitude longitude and time in addition the measurements in a specific location are expressed as a one dimensional 1d array and the univariate time series is produced by placing these arrays in chronological order as schematically depicted in fig 2 b these series are geo spatially temporally and geo spatiotemporally correlated in which the different types of correlation are expressed with dotted dashed and dash double dotted lines respectively the dataset can be reshaped as an animated image sequence for the concurrent utilization of all these information baumann 2021 thus as the first step of preprocessing the acquired datasets are converted to a multimedia tensor wherein the pixels represent the grids g of arrays based on fig 2 c similarly the ordering of the dimensions was varied in terms of time latitude y longitude x and features corresponding to the depth height width and channels c of the multidimensional tensor after the geo spatiotemporal time series datasets were converted to an mdts tensor using the method discussed earlier the minmaxscaler estimator was applied individually to normalize channels as an appropriate technique for a finite set thus the closure of the instances of each feature and their limits would be rescaled within the range of α to β computed as follows jiawei han et al 2012 3 v c g 1 g t 0 t v t x y c l b c u b c 4 v c i v c i min v c max v c min v c β α α where v c denotes the closure of the superset of channel c values g represents the number of grids in the mesh grid of x and y containing historical values for the channel and t denotes the length of the time series in addition l b c and u b c represents the lower and upper bounds of the channels respectively v c i denotes the i th instance of v c that was linearly transformed into v c i min and max indicate the minimum and maximum values of v c respectively after obtaining the multidimensional tensor the tensor was used for the geo spatiotemporal analysis and equation based modeling furthermore to prepare the input into the integrated attention based dl models additional processing is required and explained in section 2 4 2 3 equation based prediction models we hypothesized that the prediction accuracy of streamflow could be improved using relevant hydroclimate variables in a poorly gauged basin based on the research plan in the first stage a multivariate regression analysis mra was proposed to predict the following h values of streamflow time series to examine this hypothesis based on the two scenarios mentioned earlier the mra was applied to conduct two equation based models direct and direct recursive hybrid strategies are employed to offer the benefits of both methods and avoid the error accumulation problem of recursive strategies in the direct strategy 12 models were fitted individually for each step with the same input set from the recorded dataset the corresponding mathematical expression is as follows 5 y t h m h x t θ h e t h where h 0 1 h where y t h is the predicted value at time t x t is the input set comprising the selected exogenous and endogenous input variables from streamflow time series and hydroclimate mdts respectively in this case m h denotes regression model at the h th step e t h denotes the modeling error and the parameters θ h are estimated independently for each step in contrast predicted values are served as input for the next steps in the direct recursive strategy hence the θ h value at each step estimated by considering previous models and the rest of the input variables vary corresponding to the prediction step the corresponding mathematical expression can be expressed as follows 6 y t h m h y t y t h 1 x t h θ h e t h where h 0 1 h four multistep predictive models are defined for all scenarios and strategies to evaluate their fitting accuracy a meta algorithm is proposed for hybrid feature engineering hfe and multi equation structures to fit each prediction model hfe includes statistical analyses and ai feature selection for extracting and selecting underlying constructs respectively the pseudocode of the proposed method and the corresponding functions are given in the supplementary file s1 and s2 respectively according to fig s1 the statistical analysis was initiated by testing the correlation structure among mdts the historical records of channels for each grid and streamflow are considered as exogenous and endogenous sets respectively the pearson correlation coefficient was employed to quantify the linear correlations and spearman s rank order correlation was used to determine the strength and direction of the monotonic relationships between the exogenous and endogenous sets during the calculations irrelevant exogenous sets were removed using a predefined threshold filter to form a highly correlated map with endogenous sets the remaining pixels were clustered according to their coordinates and the correlation quantity of each channel by using the k means algorithm thus the adjacent pixels and interdependent exogenous sets created homogeneous spatial regions moreover principal component analysis pca was applied after partitioning the map into homogeneous regions as subsets of concurrent time series to project the data into a simple 1d time series array in addition to the cross correlation coefficients these steps were repeated for various time lags to extract the autocorrelation the obtained underlying constructs and their correlations with endogenous sets are used to identify the models and estimate their parameters the direct structure assumes independent relationships among parameters and factors while the parameters of the direct recursive hybrid structure are estimated based on a single degree of freedom in each chained relationship the structural coefficients of the models were determined by combining several estimates using the rf meta estimator as a reliable bagging method for multidimensional regression the outputs of the rf and its built in feature importance algorithm acted as inputs to determine the parametric predictive models by employing a backward feature elimination procedure with cross validation wherein the polynomial regression was used to approximate the functions which represented the structure that could involve linear or nonlinear parameters 2 4 attention based deep learning models after demonstrating the application of the hydroclimate data for prediction accuracy an integrated attention based dl model was used to extract high level complex relations and automatically execute the feature engineering process in context dl algorithms with automatic feature engineering can establish a reliable general and straightforward model nonetheless a special architecture of the dl model is required to satisfy the multidimensional tensor characteristics appropriately as such the proposed architect comprised two major components completely independent topping and bottoming networks which will be explained in the following sections the proposed network architecture and the additional data processing steps for preparing the input are shown in fig 3 in which after obtaining the multidimensional tensor the additional data processing steps used before the dl branch can be summarized as follows advanced interpolation was performed to upscale the channels and merge the images zero padding was applied to assign a channel value of zero for the nodata grids and to avoid losing information at the boundaries for the corresponding feature and log scaling was used to manage a power law distribution that may occur owing to the number of nodata grids the steps discussed earlier are illustrated in fig 3 a and detailed in the supplementary file s3 a schematic of the proposed architecture is shown in fig 3 b it is developed by coupling deep cnns and attention networks as the topping and bottoming networks respectively the prepared mdts is fed to the topping network as an automatic feature engineering solution that is compatible with 4d input data 2 4 1 topping network two architectures based on the cnn layer were proposed as a topping network to extract concurrently the interrelationships of various variables and the spatial features of the mdts the automatic feature engineering abilities of cnn make it a good candidate for our prediction architecture the two 4d compatible convolutional layers are shown schematically in fig 4 specifically one of them is based on 2d cnn and uses the time distributed layer to handle the fourth dimension whereas the other architecture is based on 3d cnn and corresponds to the multidimensional input tensor adequately fig 4 a shows a timedistributed cnn td cnn this layer includes a time distributed td wrapper that allows the 2d cnn to distribute layers across an additional temporal dimension by applying a layer to every temporal slice of the input thus the 2d cnn can independently operate on the individual frame moreover the td layer is an instrumental model that can operate with time series data or multidimensional frames the output of this convolutional operation is a vector that can be represented as 7 v i c x y g m m i h 0 h 0 h i 1 w 0 w i 1 ω i c h w v i 1 m x h y w b i c where g denotes the nonlinear activation function of a convolutional layer m i denotes the selected inputs h i and w i are the height and width of the kernel ω i c h w is the value at the position h w of the kernel connected to the c th feature map and b i c represents the bias of the convolutional kernel the second alternative for the topping network is 3d cnn as illustrated in fig 4 b in this network the frames of multidimensional tensors are treated as sequential sections of volumetric data unlike 2d cnn 3d cnn is able to encode the representation of volumetric data and extract features with 3d spatial information 3d cnn consists of 3d convolutional layers 3d pooling layers and fully connected layers that are successively stacked into a hierarchical architecture each channel in a conv3d is a 3d feature volume and the convolution and max pooling layers are operated in a cubic manner ho et al 2021 the data at a point t x y on the c th feature map in the i th layer can be represented as 8 v i c t x y g m m i d 0 d i 1 h 0 h i 1 w 0 w i 1 ω i c d h w v i 1 m t d x h y w b i c where d i is the size of the 3d kernel along the temporal dimension 2 4 1 1 bottoming network the bottoming network of the proposed structure comprises two state of the art attention based models which are directly fed by the output of the topping network in addition two advanced reliable mature and highly complex dl models namely long and short term time series networks lstnet and transformer were considered as alternatives these two models possessed temporal attention blocks which enhanced their interpretability and candidature for the bottoming model the details of the bottoming model architectures are illustrated in fig 5 a and 5 b the details of the selected alternative bottoming models are discussed in the following sections the lstnet architecture can extract more efficiently the long and short term dependencies in comparison to the stand alone lstm or gru models as displayed in fig 5 a the first layer of the lstnet architecture is a cnn without pooling which is assigned to extract the local dependencies and short term patterns after which the gru processes the cnn output as a conventional rnn the gru maintains long term dependencies because rnns fail to capture long term dependencies a recurrent skip component layer with a temporal skip connection is assigned to extract the temporal dependencies and facilitate the optimization process to alleviate the gradient vanishing issue more importantly the attention mechanism is advantageous because it increases the capability of the lstnet architecture in predicting nonseasonal time series or those with a dynamic period length the final block of the lstnet is decomposed into a linear part which is an ar model the interested readers are referred to lai et al 2018 for more details as displayed in fig 5 b the transformer network employs an encoder decoder architecture similar to that of rnn the input data of the rnn network must be sequentially or serially executed one after the other therefore the inputs of the previous state are required to perform any operations on the current state and the sequential flow does not appropriately utilize the modern gpus which are designed for parallel computation in contrast the input sequence into the transformer network can be executed in a parallel way the encoder and decoder of the transformer network contain distinct modules and an embedding layer exists in the encoder and decoder stacks subsequently the input passes through positional encoding which assists the transformer to learn the temporal dependencies by adding to the embedding the interested readers are referred to vaswani et al 2017 for more details 2 5 prediction model evaluation a 2d convolutional lstm network convlstm2d is employed for developing base models as benchmarks to evaluate the four attention based dl models convlstm2d is a variant of the well known lstm containing a 2d cnn structure inside the lstm cell and it thus similar to an lstm layer however both the input and recurrent transformations are 2d cnns in addition this structure handles spatiotemporal data given that all the inputs cell outputs hidden states and gates of convlstm2d are 3d tensors whose last two dimensions are spatial dimensions shi et al 2015 the proposed and base msa prediction models are summarized in table 2 the key equations and the structure of the convlstm2d network are given in the supplementary file s4 to validate the prediction performance in addition to the conventional built in fit statistics this study adopted a combination of indicators such as the correlation r mean absolute error mae root mean square error rmse determination coefficient r2 kling gupta efficiency kge willmott s index agreement wi legates mccabe s lm and akaike information criterion aic the performance criteria with the corresponding equations and their ranges are listed in table 3 in addition the test statistics of the prediction accuracy based on loss differential were considered to obtain pairwise comparisons between the competing models the following null hypothesis h0 was used for each mode to identify the model producing the improved prediction 9 h 0 e l y t h y t h 1 e l y t h y t h 2 0 against the alternative 10 h 1 e l y t h y t h 1 e l y t h y t h 2 0 where e denotes the expectation operator l represents the given loss function y t h denotes the vector of streamflow variables considering the prediction at time t after h periods y t h 1 and y t h 2 represent alternative predicted vectors based on the information available at time t 3 case study and data acquisition the proposed method was applied to the karkheh river basin located southwest of iran the river was an essential part of the ancient civilization of mesopotamia that provided irrigation for millennia it originates from the central and southern regions of the zagros mountains and is considered the third largest river in iran the basin covers an area of 50 800 km2 that is located between 30 50 35 05 n latitude and 46 06 49 10 e longitude and is distributed into five sub basins namely gamasiab qarasou saymareh kashkan and south karkheh passing through parts of seven provinces in particular the elevation varies from a few meters above the sea level masl in the south to 3 615 masl in the north two thirds of the basin are located in the mountainous region jamali et al 2013 this diverse topography increases the complexity of the hydrological features of this basin wherein the mediterranean climate prevails with wet winters and dry summers moreover the annual precipitation ranges from 300 mm in the southern regions that are covered mainly by plains to 800 mm in the northern areas that are primarily surrounded by mountains the karkheh dam was constructed in 2001 and became operational in august 2002 with a designed storage capacity of 7500 million m3 for basin surface water management and flow measurements fereidoon and koch 2018 the primary objective of the dam is to control flooding and satisfy agricultural requirements followed by hydropower electricity production jamab consulting engineers 2005 fereidoon and koch 2018 the northern snow melting region acts as the primary source of water inflow followed by the air flows originating from the adjacent mediterranean sea in the west the black sea in the northwest and the persian gulf in the south the case study area is illustrated in fig 6 a the local data used in this study included the monthly streamflow time series of the karkheh reservoir spanning from 1955 to 2021 depicted in fig 6 b the quality of the data increased after the construction of the dam more than two thirds of the annual inflow into the reservoir occurs between february and june with a peak in april and the lowest inflow occurs in the dry season starting from july to october the average annual inflow is 5 582 million m3 the major drivers of precipitation in the karkheh basin are air flows and low pressure centers originating from the mediterranean sea persian gulf and the black sea modaresi et al 2016 therefore the study domain corresponds to 23 n 44 n and 23 e 64 e as portrayed in fig 6 a in addition this study utilized two indicators of the global monthly gridded dataset sea surface temperature sst and mean sea level pressure mslp to the extended reconstructed sst and the extended reconstructed mslp version 5 noaa ersst v5 huang et al 2017 the datasets have a spatial grid resolution accuracy of 2 2 and 2 5 2 5 respectively which were derived from the international comprehensive ocean atmosphere dataset icoads release 3 0 and portrayed in fig 6 c and 6 d respectively 4 experimental settings following grigsby et al 2021 for cross validation an out of sample strategy was employed using time based splitting to estimate the loss of the models on unseen samples of the testing period in this regard the datasets were split into three sets the first set accounted for 70 of the data and was used for model training from 1955 to 2000 the second set was used for model validation 15 from 2000 to 2010 and the remaining 15 was used for test purposes starting from 2010 to 2020 more specifically the datasets were split evenly consecutively and compactly across time to prevent data leakage and to preserve temporal dependencies shen and wang 2022 subsequently the sliding window technique with a window size of 12 converted the prepared mdts into supervised learning tensors in chronological order a retrospective input with a length of 12 and a batch size of 12 was used to mimic appropriately the prevailing annual conditions constituting the study target as msa predictions for the next successive 12 months for an appropriate comparison among the prediction models a grid search for hyperparameter tuning was used to ensure the identical evaluation of each model 5 results in this section at the first stage the conditional superior predictive ability of the models for 12 months ahead of streamflow prediction was investigated under two scenarios and two prediction strategies using defined hypothesis and proposed meta algorithm as described in subsections 2 1 2 3 in the second stage the accuracies of long term prediction of the integrated attention based dl models were evaluated by comparing the observed streamflow in the karkheh hydro reservoir versus predicted value obtained from 3d cnn transformer lstnet td cnn transformer lstnet and convlstm d r at monthly scales the corresponding detailed flow diagram describing the application of the proposed method is given in the supplementary file s5 5 1 first stage evaluation of the application of hydroclimate data the highly correlated regions were obtained based on the predefined threshold filter and maximum value of the corresponding lags as described in section 2 3 the selected geo spatiotemporal correlation map between sst and mslp with in situ streamflow considering the 0 95 and 0 99 threshold filters are shown in fig 7 a and 7 b respectively the location and scale specific correlation results with different lags and their clustering are given in the supplementary file s6 s7 the results indicated that streamflow is more correlated with sst than the other hydroclimate data the sst of the mediterranean sea has the highest correlation with the study area followed by the sst values of the caspian sea black sea persian gulf and the red sea in terms of mslp the persian gulf has the highest correlation followed by the grids in the east and south of the studied area the results associated with the application of the hydroclimate data in streamflow prediction for two univariate and multivariate scenarios based on hybrid direct recursive and direct strategies are presented in fig 8 a and 8 b wherein the scatter and residual error plots indicated that the univariate model was not as accurate as the multivariate model for msa monthly streamflow prediction as reported in table 4 the r2 value for both direct and hybrid methods in scenario ii r2 0 860 0 890 was higher than scenario i r2 0 664 0 691 notably the results obtained in scenario ii for the direct recursive hybrid model r2 0 89 had higher values than those in scenario ii for the direct model r2 0 86 and achieved the best performance thus this study had enough evidence to reject the null hypothesis and accept the claim with a p value of 0 05 therefore the application of the hydroclimate data along with the local data increased the accuracy of streamflow prediction the extracted features selected variables and the pca results for the two scenarios are given in the supplementary file s8 5 2 second stage evaluation of the proposed integrated attention based models the prediction results are compared by utilizing the various evaluation criteria introduced in section 2 5 in particular each prediction result was individually examined to determine the quality of the obtained performance and the results of the proposed msa streamflow prediction methods are compared based on the stand alone base model the training validation and test sets of monthly streamflow of karkhe river as prediction targets are shown in fig 9 a the prediction results are compared graphically in fig 9 b c in the form of the normalized residual error and prediction results for each year within the test period 10 years for a more insightful comparison the kernel density estimation plots of normalized residuals of all the prediction models for individual months are displayed in fig 9 d as depicted the kernel density estimation plots are on the top portion with boxplots and the data points of prediction underneath in particular theboxesrepresent the inner quartiles and the vertical lineswithin the box indicate the median whereas thediamondsrepresent the outliers in each model the kernel density estimation of monthly residual for individual models are given in supplementary file s9 along with these results the performance metrics of the proposed models were compared with the b1 and b2 models in terms of r mae rmse r2 kge wi lm and aic as listed in table 5 the results indicate that the models in the proposed architecture delivered a similar accuracy in terms of wi r2 lm and r and their performances were superior to that of the stand alone b1 and b2 models furthermore the results revealed that the stand alone rnn algorithm failed to capture the complexity the stand alone b2 models attained the highest rmse 0 141 mae 0 113 and lowest r 0 57 r2 0 298 kge 0 268 wi 0 599 and lm 0 165 which was closely followed by the b1 model the m1 model outperformed all the models with a high magnitude of r2 kge wi and lm and lower magnitudes of mae rmse overall the errors in both the m1 and m2 models were lower than those of the m3 and m4 models wherein the highest wi values pertained to the m1 with a value of 0 987 followed by m2 with a value of 0 98 which indicated the goodness of fit of these two models in comparison with all the models the hyperparameter search results are given in the supplementary file table s7 the lowest aic metric was the most suitable model for prediction m1 achieved the optimal performance with the lowest aic value of 794 676 followed by m2 m4 and m3 with values of 758 798 725 964 and 669 529 respectively which demonstrated the improved performance of the proposed models in terms of the model predictability of msa prediction in contrast the stand alone b2 model followed by the b1 achieved the most inferior performances with the highest aic values of 471 270 and 513 244 respectively the scatter plots of the predicted and observed monthly streamflow for the six models are displayed on the upper side of fig 10 a c wherein the graph located at the center of each plot is a scatter plot with a 95 confidence interval contour line the right hand side and top borders of the scatter plot represent the distributions of the normalized observed and predicted values the scatter plots implied that the least scattered estimates pertained to the m1 model followed by m2 m4 and m3 in the descending order of their determination coefficients r2 0 952 0 930 0 900 and 0 837 respectively notably all of these values were higher than those of the base models b1 r2 of 0 499 and b2 r2 of 0 298 moreover the scatter plot demonstrated that the prediction of the m1 model was the most proximate to the corresponding actual values in comparison to all the models the normalized residual error n residual of the results is presented on the lower side of fig 10 a c wherein the dashed line represents the baseline with zero residual error in addition the upper portion represents the predicted value with overestimation whereas the values in the bottom portion represent those with underestimation furthermore a taylor diagram was used to quantify the performance of the six models against the observations the model performances based on the taylor diagram are illustrated in fig 11 a which presents a summary of the prediction model results corresponding to the observations in terms of the correlation coefficient r on the radial axis standard deviation std on the polar axis and root mean squared error rmse the red dashed line indicates the observation point the taylor diagram revealed that the m1 with an r value of 0 977 and an rmse of 0 037 exhibited the best overall performance and was much closer to the observation point followed by the m2 with an r value of 0 969 and an rmse of 0 044 the td cnn lstnet with an r value of 0 959 and rmse of 0 053 and the m3 with an r value of 0 933 and rmse of 0 068 moreover the b2 with an r value of 0 570 and rmse of 0 141 achieved the worst simulation performance followed by the b1 with an r value of 0 724 and rmse of 0 125 therefore the proposed integrated models delivered promising prediction performances for achieving accurate and reliable msa long term streamflow predictions the pairwise comparisons of all models with a similar study using eq 14 and rmse values are shown in table 6 table 5 indicates that the 3d cnn lstnet architecture has a poorer capacity for modeling long term patterns using offline learning than the other proposed architectures in this regard time series backtesting was conducted using a sliding window and repeated splitting to examine the performance of the 3d cnn lstnet over the course of two consecutive years in five steps in other words the ten year test set was divided into five separate test sets and for each of them an offline model was developed using the last 56 years with the same structure and hyperparameters same as m3 the results of the time series backtesting are presented in table 7 suggesting that the accuracy of predictions can be enhanced by training the model on the most recent historical data for each target year during time series backtesting the changing properties of the dataset and model adjustment were not taken into account also rather than constructing multiple offline models it is advised to employ online learning to dynamically adapt to new temporal patterns in the data 6 discussion this study addresses the geo spatiotemporal and attention based framework for improving the 12 month ahead prediction of monthly streamflow in the karkheh river the main problems were feature extraction and long term memory compatibility of conventional mts approaches in fulfilling the long sequence time series forecasts using structured volumetric data therefore a meta algorithm was proposed to analyze and select booster predictors among hydroclimate data for poorly gauged basins based on the mdts characteristics four novel 4d dl architecture were developed and compared with univariate and base models according to the prediction capability the results confirmed the msa prediction superiority of the proposed attention based networks however the equation based models had more explainable spatial and temporal feature importance at the cost of significant knowledge and time intensity thus the present framework should be modified by implementing explainable ai in encoder decoder models to quantify the information that flows through attention layers despite the idea of geo spatiotemporal models being validated in karkhe river 4d dl networks can be developed in any other regions of interest for predicting msa streamflow the overall structure of the framework given in fig 1 and s5 is kept untouched so that the other hydroclimate variables would be analyzed first with other transformer variants lin et al 2021a 2021b considered in the next stage the established framework can assist decision makers in improving maintenance planning and minimizing unexpected failures in water management systems in karkhe river the mdts analysis using the proposed meta algorithm shows that streamflow in this region is significantly correlated with hydroclimate data in particular sst this is in agreement with the findings of helali et al 2020 modaresi et al 2016 according to the obtained correlation results among sst and streamflow presented in table s1 fig s7 and fig 7 a the maximum absolute value is approximately 0 8 at lags 5 10 and 11 followed by 0 4 and 12 with an absolute value of 0 7 the persian gulf caspian sea and eastern region of the mediterranean sea have the highest correlation values at lags 5 10 and 11 respectively with a threshold filter of 0 99 considering the threshold filter of 0 90 all the sea grids in the selected study domain were highly correlated with the streamflow except the grids located in the south east region that includes the oman sea moreover the south and east side of mediterranean sea have the highest negative correlation while the persian gulf has the highest positive correlation with respect to the case study according to table s2 fig 7 b and fig s8 the results of mslp correlation showed maximum absolute value of 0 8 at lags 3 and 4 the highest positive value is less than 0 7 at lags 9 and 10 the highly correlated grids in the study domain belong to the adjacent grids with respect to the karkhe river followed by the north side of persian gulf in contrast with sst the grids with positive and negative correlation are easy to separate from each and oman sea south of persian gulf and red sea have the highest positive correlation moreover it has long been known that there are important linkages between atmospheric circulation and river flow kingston et al 2006 owing to the geographic and climatic diversity of iran various hydroclimate data affect its precipitation patterns therefore for other case studies in iran particular care must be taken and correlation analysis must be performed among any endogenous sand exogenous sets for extracting the highly correlated variable the interested readers can refer to helali et al 2020 for further information the prediction results depict that the proposed integrated models could capture the monthly streamflow more appropriately than the stand alone b1 and b2 models convlstm has independent convolutional operations over the input the hidden state and in the input to state transition as shown in fig s10 resulting in a large number of redundant variables and computational costs therefore the redundancy of spatial convolutions in convlstm resulted in significant reduction in prediction accuracy in comparison with the proposed architecture thus the performance of the td layer cnn attention layer and ar in the proposed integrated networks enabled them to detect trends maintain complex long and short term dependencies and predict the highest peak with superior accuracy as shown in fig 9 b the b1 and b2 models underestimated peaks and overestimated particular recessions in the residual error plot whereas m4 appropriately simulated the rising and recession limbs of the hydrographs followed by m3 m1 and m2 note that the transformer model inherently used the recursive method and predicted the future value based on the previously predicted value whereas the lstnet predicted the future values by simultaneously ensemble the results of both direct and recursive methods to report the predicted value based on the results of this study the models that take the advantage of both direct and recursive strategies are more capable of detecting the trend in comparison with the other which use either recursive or direct strategies the standalone base models b1 and b2 are incapable of detecting the trend in april 2018 an extreme flood accrued in the study area with a high return period 400 years that was devastating accordingly in this study predefined lower and upper bound values were used for normalization to maintain this value and not to account for it as an outlier generally conventional prediction methods such as rnns fail to detect the abrupt changes in time series especially in cases wherein abrupt changes occurred outside the training period therefore underestimation or overestimation values were obtained among all the models m4 predicted the extreme flood in 2018 with the highest accuracy followed by m3 whereas both m1 and m2 models predicted this peak with underestimation as this extreme value is located at the end of the test set a high accuracy prediction is not a rational expectation especially in msa predictions however the proposed architecture predicted this extreme flood with acceptable accuracy particularly lstnet which simultaneously takes advantage of direct and recursive strategies the proposed networks predicted the wet feb jun and dry jul oct seasons with higher accuracy in comparison with the base models in comparison with the finding of tayerani charmchi et al 2021 on the same case study the msa streamflow prediction performance dramatically increased in terms of rmse by 75 and 26 reduction for m1 as the best and b2 as the worst prediction model performance respectively 7 conclusions this study focused on improving the accuracy of long term streamflow prediction of a poorly gauged basin in two main stages first a novel meta algorithm was proposed for variable selection and developing equation based models through both direct and hybrid msa prediction strategies second four novel integrated dls were proposed using 4d convolutional and attention based networks to predict the streamflow time series over a long term horizon 1 year 12 steps based on structured volumetric data the proposed framework assessed from the superiority of hydroclimate booster variables and prediction capability prospects in karkheh river a dl architecture of 3d cnn transformer time distributed 2d cnn transformer 3d cnn lstnet and time distributed 2d cnn lstnet constituted the proposed integrated models m1 to m4 the pros and cons of the established framework along with the broader implications have been discussed the following conclusions can be drawn from the results mra results indicate that the hybrid strategies achieved better prediction performance in comparison with direct strategies in both scenarios it should be noted that mra result were not compared with the dl based results since the former was used as a glass box method to test the cspa the latter is used to investigate the effect of the attention based dl and proposed network architectures on msa prediction the application of hydroclimate data enhanced the msa streamflow prediction performance by 29 in terms of r2 in both strategies in the designated case study as a poorly gauged basin it should be noted that hybrid strategy in scenario ii achieved the highest prediction accuracy with 14 increase in terms of correlation 41 decrease in terms of mae and 32 5 decrease in terms of rmse the coupled deep cnns with attention networks reduced the complexity of extracting dynamic complex and nonlinear geo spatiotemporal dependencies the proposed msa models significantly improved long term prediction performance by delivering higher accuracy than the recursive and direct msa prediction using convlstm2d models the proposed integrated models from m1 to m4 confirmed the superior performance with 53 69 52 68 46 64 and 50 67 increase in terms of r2 compared to the base models for two direct and recursive strategies respectively among the four proposed integrated networks both the timing and quantity of the peak were accurately predicted by using lstnet as bottoming m4 m3 the overall performance of the 3d cnn transformer model was superior to the other models in the proposed network architecture however non linear relationships were neglected for the dimension reduction step in the first stage moreover the common assumption of row dependency across time was adopted that is folding and random sampling for cross validation were neglected one major limitation of this study is that further case studies on different climates and sizes in other geographical locations are required for conducting more research on the generalizability of the proposed msa framework findings thus the correlation results network components hyper parameters and model accuracy would vary according to the employed mdts in any regions any poorly gauged basins with univariate historical streamflow data can take the advantage of proposed framework to improve long term streamflow prediction transfer learning and pre trained models can be used if a long historical dataset is not accessible for success training according to lattice data spatial networks other than cnn can be used for more complex environments with sparse and discrete dependencies as previously discussed a huge body of research and implementation can be consolidated into this framework our future works will involve transforming the proposed deterministic prediction framework into a probabilistic one with improved performance and effectiveness for integrated water resource management cnns will be replaced with graph neural networks to concurrently reduce computing costs and improve the overall performance faced by the sheer volume of geo spatiotemporal data with a large number of unmeasured grids furthermore the transductive learning and rolling cross validation will be assigned in the framework to diminish the accumulation error problem in msa as the horizon expands via an online method credit authorship contribution statement fatemeh ghobadi conceptualization methodology investigation software validation formal analysis data curation writing original draft writing review editing visualization doosun kang methodology supervision validation writing review editing resources funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work is financially supported by korea ministry of environment moe as graduate school specialized in climate change appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 128608 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
2658,precise long term streamflow prediction has always been important in the hydrology field and has provided essential information for efficient water resource management and disaster prevention attention to this field has increased recently owing to water and climate crises despite the remarkable improvements in existing data driven models they still have weaknesses particularly for multistep predictions in poorly gauged basins the purpose of this study is to improve the multistep ahead prediction ability by considering mesoscale hydroclimate data as booster predictors and employing attention based deep learning therefore a meta algorithm is proposed for analyzing time series data in complex geo spatiotemporal environments to assess the superiority of prediction with booster predictors through direct and direct recursive hybrid strategies in the subsequent stage a novel integrated neural network architecture is demonstrated that couples a deep convolutional neural network cnn with a deep attention network in particular the former network performs automatic feature engineering and the latter focuses on lengthy sequence complexities four state of the art combinations for 12 month ahead prediction are introduced including pairs of timedistributed cnn td cnn and 3d cnn along with a long and short term time series network lstnet or a transformer network moreover a base architecture was employed for model comparison that contains the convlstm2d layer that is compatible with multidimensional time series data for this all models were applied to the karkheh river basin in the northeast of the persian gulf where monthly historical records of streamflow are available from 1955 to 2021 the results revealed that the application of hydroclimate sea surface temperature data and mean surface level pressure along with local data increased the prediction accuracy moreover the proposed integrated networks delivered more accurate long term streamflow predictions than the base models through various evaluation criteria including r r2 mean absolute error root mean square error kling gupta efficiency willmott s index legates mccabe s and the akaike information criterion in summary the 3d cnn transformer achieved the best performance followed by the td cnn transformer td cnn lstnet and 3d cnn lstnet with r2 values equal to 0 952 0 930 0 900 and 0 837 respectively this study demonstrates that the application of hydroclimate data with proposed integrated networks are particularly useful for poorly gauged basin thus the proposed models can potentially improve multistep ahead streamflow prediction compared to univariate and equation based models abbreviations ai artificial intelligence aic akaike information criterion ann artificial neural networks ar auto regressive arch autoregressive conditional heteroscedasticity bart bayesian additive regression tree bmwivs binary metaheuristic wrapper based input variable selection brf boruta feature selection algorithm cnn convolutional neural network 2d cnn two dimensional cnn 3d cnn three dimensional cnn convlstm convolutional long and short term memory network csa cooperation search algorithm cspa conditional superior predictive ability dae deep auto encoder ddgn directed graph deep neural network diff differential method dl deep learning eemd ensemble elm extreme learning machine emd empirical mode decomposition fos fast orthogonal search ffnn feedforward neural network gb gradient boosting gru gated recurrent unit kge kling gupta efficiency knn k nearest neighbors lm legates mccabe s lstm long and short term memory lstnet long and short term time series network mae mean absolute error mars multivariate adaptive regression splines mdts multidimensional time series mlr multiple linear regression msa multistep ahead mspl mean surface pressure level nse nash sutcliffe coefficient pca principle component analysis method pcsa parallel cooperation search algorithm r correlation r2 coefficient of determination rf random forest rmse root mean square error rnn recurrent neural network sf single model forecasting ssa single step ahead sst sea surface temperature vmd variational mode decomposition wi willmott s index agreement keywords attention based deep learning climate change monthly streamflow prediction multistep ahead prediction multidimensional time series data availability data will be made available on request 1 introduction streamflow prediction is vital for integrated water resource planning and management as it provides a reliable management plan and prevents the devastating effects of extreme events on human society infrastructure and the natural ecosystem generally streamflow prediction is temporally categorized into short and long term horizons with different time scales ranging from hourly to monthly short term predictions at minor scales aim to facilitate reliable and stable flood and mitigation system operations in contrast long term prediction with a larger scale is an essential precondition for efficient water resource management hydropower generation irrigation management scheduling releases sediment transport and other management scenarios to mitigate water and climate crises yaseen et al 2016 due to complexity nonlinearity and poor data quality long term prediction has not been thoroughly studied despite its importance and broad applicability in the real field this is particularly true in ungauged or data scarce regions which are much more vulnerable to extreme events owing to the lack of in situ data kunnath poovakka et al 2016 sun et al 2018 wang et al 2021 generally streamflow prediction models can be divided into two main categories theoretical based models and data driven models the former includes hydrological and conceptual approaches while the latter involve statistical and artificial intelligence ai approaches zhao et al 2021 statistical models such as multiple linear regression autoregressive ar moving average ma ar moving average arma and ar integrated moving average arima have been traditionally used for developing time series models these models are considered as the most straightforward and conventional methods for short term prediction on the other hand they do not capture the underlying nonlinearities of historical records therefore these models are less sensitive toward anomalies such as drought and floods and do not yield a confident prediction for the extended horizon in contrast ai based models can appropriately manage the nonlinear characteristics and yield more accurate long term predictions overall the ai based models that have been widely used in the field of hydrology are classified into four major subcategories machine learning ml fuzzy logic approach evolutionary computation and wavelet transformation yaseen et al 2015 tabbussum and dar 2021 li et al 2022 owing to the flexibility and accessibility of ml techniques improving prediction capacity by employing them has recently garnered increasing attention among researchers kao et al 2020 ren et al 2021 during the last few decades ml prediction models based on artificial neural networks anns support vector machines svm and sv regressions svr convolutional neural networks cnns and recurrent neural networks rnns have improved the abilities for predicting streamflow cnns are well known algorithms mainly because of their capability in automatic feature engineering rnn algorithms have been introduced with an inner loop and hidden state to capture temporal dependencies and preserve the past input data memory however rnns pose gradient vanishing issues for long term dependencies xiao et al 2021 thus an improved rnns structure long short term memory lstm and gated recurrent unit gru have been introduced by adding the cell state and gating mechanisms tayerani charmchi et al 2021 recently deep learning dl techniques which is considered as a subset of ml have been successfully applied in the field of hydrology ewuzie et al 2022 dl can be employed for both feature extraction and development of predictive models which is considered the most significant difference between dl and ml sarker 2021 several studies claimed the superiority of gradient boosting gb and random forest rf as the well known algorithms for el models in hydrology mainly because of their outstanding performance in multi input and multi output structures zounemat kermani et al 2021 in the last decades with the increasing volume and quality of temporal data dl has emerged as a robust technique for multivariate time series mts prediction while el faces memory issues recently several studies have combined the advantage of both dl as well as el such that the final model yields a better prediction performance the integrated deep ensemble learning methods enhanced the feature engineering performance and allowed the evolution of the prediction algorithms cheng et al 2020 gao et al 2020 kao et al 2020 recent studies of streamflow prediction are summarized in table 1 some researchers have trained models using multiple sources and types of hydrological variables and are more focused on enhancing feature engineering apaydin et al 2021 conversely some studies focused on the improvement of the prediction methods by applying a wide variety of ai algorithms and different training validation and prediction strategies liu et al 2022 tikhamarine et al 2020 in this regard ghimire et al 2021 used an integrated cnn lstm model to predict short term streamflow other studies concurrently investigated the improvement of feature engineering efficiency and predictive modeling most attempts at streamflow prediction have utilized conventional ml models for single step ahead ssa time series prediction mehdizadeh et al 2019 nanda et al 2019 yang et al 2019 adnan et al 2021 apaydin et al 2021 lin et al 2021a 2021b ren et al 2021 zhao et al 2021 masrur ahmed et al 2021 cho and kim 2022 nguyen et al 2022 followed by multistep ahead msa time series prediction osman et al 2020 cheng et al 2020 zuo et al 2020 abbasi et al 2021 feng et al 2021 feng et al 2022 whereas limited research has been conducted to assess and compare the application of state of the art dl models with msa approach for long term streamflow prediction liu et al 2022 in particular msa prediction can be achieved by direct and indirect strategies each of which has merits and limitations conventionally a recursive strategy is employed to indirectly transform msa predictions using an ssa model such that the prior output serves as an input for the subsequent step in contrast the direct strategy involves independent output at each time step for msa predictions comparing ssa studies with msa showed that direct strategies are more promising choices over recursive strategies for long term prediction as chain steps cause accumulated errors despite this advantage msa has not been extensively studied as it is a more complex problem especially in the case of dealing with mts and long term predictions as indicated in table 1 this is because predicting successive steps needs voluminous data expertise and lengthy procedures notably extending the prediction horizon through the msa approach is critical for efficient water resource planning and management which can effectively help mitigate flood and drought damages guo et al 2021 hence considerable research is required to make long term prediction practical especially in the case of lacking data the advent of large scale hydroclimate data with global coverage provides a once for all solution to streamflow prediction at various spatiotemporal scales for regions lacking adequate stations or ungauged basins according to table 1 several prior studies have primarily focused on the evaluation of the applicability of these hydroclimate data on a global scale for increasing the streamflow prediction accuracy through spatiotemporal modeling e g adnan et al 2021 banihabib et al 2018 bhandari et al 2018 du et al 2020 meidani and araghinejad 2014 senatore et al 2020 in these models mts is formed by concatenating a time series that is created for each location across columns new approaches emerged for dealing with mts and showed a great performance for streamflow prediction regarding the open literature review stand alone prediction models such as lstm and gru are not able to achieve appropriate performances for long term prediction owing to gradient vanishing problems in complex mts environments whereas integrated models can achieve improved prediction accuracy barzegar et al 2020 in this regard qin et al 2017 proposed a dual stage attention based rnn for mts prediction which focused on the extraction of relevant features and temporal correlations in the first and second stages respectively lai et al 2018 proposed an integrated cnn gru framework namely long and short term time series network lstnet to learn short term spatial dependencies and long term patterns among mts data using convolutional layer and temporal attention respectively similarly xiao et al 2021 proposed an attention based cnn lstm network to discover the spatiotemporal correlations and achieve more accurate long term predictions of mts data inspired by cognitive neuroscience vaswani et al 2017 introduced the transformer model by stacking self attention layers instead of rnns or cnns as a novel architecture for natural language processing nlp the self attention provides the ability to re represent the input sequence by attending to different positions which help capture precise long range dependencies recent studies have indicated the potential of the transformer model to increase the capability of long term mts prediction however in practice mts frameworks are not compatible with structured volumetric data such as historical remote sensing records and geo spatiotemporal data baumann 2021 to the best of our knowledge a systematic approach for dealing with complex geo spatiotemporal dependencies to achieve a robust long term prediction is still an ongoing challenge in the field of hydrology moreover the automatic feature engineering method compatible with three or higher dimensional data is a major bottleneck in dl gu et al 2021 therefore more intelligent state of the art integrated networks are required to address the complex and dynamic long term interdependencies for accurate msa predictions this study aims to address the research gaps mentioned earlier the original aspects and contributions of this study are fourfold first a multimedia concept is introduced to apply to labeled multidimensional time series mdts data in a geo spatiotemporal environment second the hypothesis is formulated based on two strategies namely direct and direct recursive hybrid predictions to test the conditional superior predictive ability cspa of the 12 month ahead prediction model with hydroclimate booster predictor against the univariate as two scenarios third a meta algorithm is proposed for analyzing dynamic interdependencies among the prepared mdts to construct the four equation based predictive models and evaluate the postulated hypothesis fourth a novel integrated neural network architecture is demonstrated that couples deep cnns with lstnet and the transformer network for automatic feature engineering and robust 12 month ahead prediction framework compatible with four dimensional 4d input data four novel models are developed based on proposed architecture including 3d cnn transformer time distributed 2d cnn transformer 3d cnn lstnet and time distributed 2d cnn lstnet all models are compared with respect to base models that are developed based on direct and recursive strategies by employing convlstm2d as a well known layer the karkheh river basin in the northeast of the persian gulf was employed as a case study with 67 years of available historical monthly streamflow records the geo spatiotemporal correlation among adjacent hydroclimate sea surface temperature mean surface level pressure and local data were reported the remainder of this study proceeds as follows in section 2 the materials and methods are presented in the subsections of tests of conditional superior predictive ability 2 1 data acquisition 2 2 equation based prediction models 2 3 attention based deep learning models 2 4 and prediction model evaluation 2 5 in section 3 a case study and local and mesoscale hydroclimate data are detailed in section 4 the experimental setting is detailed the results are presented in section 5 with two subsections focusing on the evaluation of the application of hydroclimate data 5 1 followed by an evaluation of proposed integrated attention based dl 5 2 the discussion of the results are provided in section 6 ultimately the concluding remarks of this study with the directions for future research are discussed in section 7 2 material and methods in this section hypotheses associated with the conditional superior prediction ability and data acquisition are elucidated equation based models in two prediction strategies under two scenarios and four novel integrated attention based dl models are proposed a logical flowchart of this study is given in fig 1 2 1 tests of conditional superior predictive ability a valid and reliable time series prediction model for the univariate scenario i using only the historical streamflow as input variables was considered as a benchmark model and its performance relative to the multivariate scenario ii was measured using both the hydroclimate data and historical streamflow data as the input variables as follows 1 d t i l y t h y t h ii l y t h y t h i where d t i denotes the loss differential l is the given loss function and y t h denotes the vector of streamflow variables considering the prediction at the instant t after h periods in addition y t h i and y t h ii represent the alternative prediction vectors based on the information available in scenarios i and ii respectively subsequently the cspa test was performed to obtain the desirable features to improve the prediction ability moreover the null hypothesis of this statistical significance test can be expressed as follows 2 h 0 cspa e d t i x t v 0 v v c c where e denotes the conditional expectation functions x t represents the selected underlying construct of the mesoscale variables and v specifies the conditional region as a subset of the domain v c in case the null hypothesis is rejected the local data were combined with the hydroclimate data otherwise only the historical data were used upon the acceptance of the null hypothesis 2 2 data acquisition the current framework involves a data based hydroclimate analysis and modeling wherein satellite based and in situ data are two common sources of hydrometeorological datasets required for streamflow prediction although the use of meteorological data measured by local stations is preferred in most prediction studies the unavailability or lack of reliable measurement devices degrades the quality of the local in situ data thus the following criteria were used as a rationale to acquire nonlocalized data for improving the prediction ability the periodic monitoring prediction of the local hydrological variable can be improved by introducing mesoscale variables into the modeling workflow kingston et al 2016 the spatial correlation between these variables yields a spectrum of regions with a retrospective temporal correlation between a pair of observed streamflow and nonlocalized climate data after the reliable mesoscale datasets are acquired to identify the variables preprocessing is required to reshape and prepare them for application on the remaining framework as temporal correlation varied dynamically with the spatial parameters and vice versa a new preprocessing method was proposed to evaluate concurrently the correlations between the exogenous and endogenous variable series and among any pair of exogenous variables the geo spatiotemporal dataset structure complex relationships in the geo spatiotemporal environment and the first step of the preprocessing method are schematically depicted in fig 2 a c wherein the geospatial time series datasets are mdts arrays according to fig 2 a each value is mapped to the feature latitude longitude and time in addition the measurements in a specific location are expressed as a one dimensional 1d array and the univariate time series is produced by placing these arrays in chronological order as schematically depicted in fig 2 b these series are geo spatially temporally and geo spatiotemporally correlated in which the different types of correlation are expressed with dotted dashed and dash double dotted lines respectively the dataset can be reshaped as an animated image sequence for the concurrent utilization of all these information baumann 2021 thus as the first step of preprocessing the acquired datasets are converted to a multimedia tensor wherein the pixels represent the grids g of arrays based on fig 2 c similarly the ordering of the dimensions was varied in terms of time latitude y longitude x and features corresponding to the depth height width and channels c of the multidimensional tensor after the geo spatiotemporal time series datasets were converted to an mdts tensor using the method discussed earlier the minmaxscaler estimator was applied individually to normalize channels as an appropriate technique for a finite set thus the closure of the instances of each feature and their limits would be rescaled within the range of α to β computed as follows jiawei han et al 2012 3 v c g 1 g t 0 t v t x y c l b c u b c 4 v c i v c i min v c max v c min v c β α α where v c denotes the closure of the superset of channel c values g represents the number of grids in the mesh grid of x and y containing historical values for the channel and t denotes the length of the time series in addition l b c and u b c represents the lower and upper bounds of the channels respectively v c i denotes the i th instance of v c that was linearly transformed into v c i min and max indicate the minimum and maximum values of v c respectively after obtaining the multidimensional tensor the tensor was used for the geo spatiotemporal analysis and equation based modeling furthermore to prepare the input into the integrated attention based dl models additional processing is required and explained in section 2 4 2 3 equation based prediction models we hypothesized that the prediction accuracy of streamflow could be improved using relevant hydroclimate variables in a poorly gauged basin based on the research plan in the first stage a multivariate regression analysis mra was proposed to predict the following h values of streamflow time series to examine this hypothesis based on the two scenarios mentioned earlier the mra was applied to conduct two equation based models direct and direct recursive hybrid strategies are employed to offer the benefits of both methods and avoid the error accumulation problem of recursive strategies in the direct strategy 12 models were fitted individually for each step with the same input set from the recorded dataset the corresponding mathematical expression is as follows 5 y t h m h x t θ h e t h where h 0 1 h where y t h is the predicted value at time t x t is the input set comprising the selected exogenous and endogenous input variables from streamflow time series and hydroclimate mdts respectively in this case m h denotes regression model at the h th step e t h denotes the modeling error and the parameters θ h are estimated independently for each step in contrast predicted values are served as input for the next steps in the direct recursive strategy hence the θ h value at each step estimated by considering previous models and the rest of the input variables vary corresponding to the prediction step the corresponding mathematical expression can be expressed as follows 6 y t h m h y t y t h 1 x t h θ h e t h where h 0 1 h four multistep predictive models are defined for all scenarios and strategies to evaluate their fitting accuracy a meta algorithm is proposed for hybrid feature engineering hfe and multi equation structures to fit each prediction model hfe includes statistical analyses and ai feature selection for extracting and selecting underlying constructs respectively the pseudocode of the proposed method and the corresponding functions are given in the supplementary file s1 and s2 respectively according to fig s1 the statistical analysis was initiated by testing the correlation structure among mdts the historical records of channels for each grid and streamflow are considered as exogenous and endogenous sets respectively the pearson correlation coefficient was employed to quantify the linear correlations and spearman s rank order correlation was used to determine the strength and direction of the monotonic relationships between the exogenous and endogenous sets during the calculations irrelevant exogenous sets were removed using a predefined threshold filter to form a highly correlated map with endogenous sets the remaining pixels were clustered according to their coordinates and the correlation quantity of each channel by using the k means algorithm thus the adjacent pixels and interdependent exogenous sets created homogeneous spatial regions moreover principal component analysis pca was applied after partitioning the map into homogeneous regions as subsets of concurrent time series to project the data into a simple 1d time series array in addition to the cross correlation coefficients these steps were repeated for various time lags to extract the autocorrelation the obtained underlying constructs and their correlations with endogenous sets are used to identify the models and estimate their parameters the direct structure assumes independent relationships among parameters and factors while the parameters of the direct recursive hybrid structure are estimated based on a single degree of freedom in each chained relationship the structural coefficients of the models were determined by combining several estimates using the rf meta estimator as a reliable bagging method for multidimensional regression the outputs of the rf and its built in feature importance algorithm acted as inputs to determine the parametric predictive models by employing a backward feature elimination procedure with cross validation wherein the polynomial regression was used to approximate the functions which represented the structure that could involve linear or nonlinear parameters 2 4 attention based deep learning models after demonstrating the application of the hydroclimate data for prediction accuracy an integrated attention based dl model was used to extract high level complex relations and automatically execute the feature engineering process in context dl algorithms with automatic feature engineering can establish a reliable general and straightforward model nonetheless a special architecture of the dl model is required to satisfy the multidimensional tensor characteristics appropriately as such the proposed architect comprised two major components completely independent topping and bottoming networks which will be explained in the following sections the proposed network architecture and the additional data processing steps for preparing the input are shown in fig 3 in which after obtaining the multidimensional tensor the additional data processing steps used before the dl branch can be summarized as follows advanced interpolation was performed to upscale the channels and merge the images zero padding was applied to assign a channel value of zero for the nodata grids and to avoid losing information at the boundaries for the corresponding feature and log scaling was used to manage a power law distribution that may occur owing to the number of nodata grids the steps discussed earlier are illustrated in fig 3 a and detailed in the supplementary file s3 a schematic of the proposed architecture is shown in fig 3 b it is developed by coupling deep cnns and attention networks as the topping and bottoming networks respectively the prepared mdts is fed to the topping network as an automatic feature engineering solution that is compatible with 4d input data 2 4 1 topping network two architectures based on the cnn layer were proposed as a topping network to extract concurrently the interrelationships of various variables and the spatial features of the mdts the automatic feature engineering abilities of cnn make it a good candidate for our prediction architecture the two 4d compatible convolutional layers are shown schematically in fig 4 specifically one of them is based on 2d cnn and uses the time distributed layer to handle the fourth dimension whereas the other architecture is based on 3d cnn and corresponds to the multidimensional input tensor adequately fig 4 a shows a timedistributed cnn td cnn this layer includes a time distributed td wrapper that allows the 2d cnn to distribute layers across an additional temporal dimension by applying a layer to every temporal slice of the input thus the 2d cnn can independently operate on the individual frame moreover the td layer is an instrumental model that can operate with time series data or multidimensional frames the output of this convolutional operation is a vector that can be represented as 7 v i c x y g m m i h 0 h 0 h i 1 w 0 w i 1 ω i c h w v i 1 m x h y w b i c where g denotes the nonlinear activation function of a convolutional layer m i denotes the selected inputs h i and w i are the height and width of the kernel ω i c h w is the value at the position h w of the kernel connected to the c th feature map and b i c represents the bias of the convolutional kernel the second alternative for the topping network is 3d cnn as illustrated in fig 4 b in this network the frames of multidimensional tensors are treated as sequential sections of volumetric data unlike 2d cnn 3d cnn is able to encode the representation of volumetric data and extract features with 3d spatial information 3d cnn consists of 3d convolutional layers 3d pooling layers and fully connected layers that are successively stacked into a hierarchical architecture each channel in a conv3d is a 3d feature volume and the convolution and max pooling layers are operated in a cubic manner ho et al 2021 the data at a point t x y on the c th feature map in the i th layer can be represented as 8 v i c t x y g m m i d 0 d i 1 h 0 h i 1 w 0 w i 1 ω i c d h w v i 1 m t d x h y w b i c where d i is the size of the 3d kernel along the temporal dimension 2 4 1 1 bottoming network the bottoming network of the proposed structure comprises two state of the art attention based models which are directly fed by the output of the topping network in addition two advanced reliable mature and highly complex dl models namely long and short term time series networks lstnet and transformer were considered as alternatives these two models possessed temporal attention blocks which enhanced their interpretability and candidature for the bottoming model the details of the bottoming model architectures are illustrated in fig 5 a and 5 b the details of the selected alternative bottoming models are discussed in the following sections the lstnet architecture can extract more efficiently the long and short term dependencies in comparison to the stand alone lstm or gru models as displayed in fig 5 a the first layer of the lstnet architecture is a cnn without pooling which is assigned to extract the local dependencies and short term patterns after which the gru processes the cnn output as a conventional rnn the gru maintains long term dependencies because rnns fail to capture long term dependencies a recurrent skip component layer with a temporal skip connection is assigned to extract the temporal dependencies and facilitate the optimization process to alleviate the gradient vanishing issue more importantly the attention mechanism is advantageous because it increases the capability of the lstnet architecture in predicting nonseasonal time series or those with a dynamic period length the final block of the lstnet is decomposed into a linear part which is an ar model the interested readers are referred to lai et al 2018 for more details as displayed in fig 5 b the transformer network employs an encoder decoder architecture similar to that of rnn the input data of the rnn network must be sequentially or serially executed one after the other therefore the inputs of the previous state are required to perform any operations on the current state and the sequential flow does not appropriately utilize the modern gpus which are designed for parallel computation in contrast the input sequence into the transformer network can be executed in a parallel way the encoder and decoder of the transformer network contain distinct modules and an embedding layer exists in the encoder and decoder stacks subsequently the input passes through positional encoding which assists the transformer to learn the temporal dependencies by adding to the embedding the interested readers are referred to vaswani et al 2017 for more details 2 5 prediction model evaluation a 2d convolutional lstm network convlstm2d is employed for developing base models as benchmarks to evaluate the four attention based dl models convlstm2d is a variant of the well known lstm containing a 2d cnn structure inside the lstm cell and it thus similar to an lstm layer however both the input and recurrent transformations are 2d cnns in addition this structure handles spatiotemporal data given that all the inputs cell outputs hidden states and gates of convlstm2d are 3d tensors whose last two dimensions are spatial dimensions shi et al 2015 the proposed and base msa prediction models are summarized in table 2 the key equations and the structure of the convlstm2d network are given in the supplementary file s4 to validate the prediction performance in addition to the conventional built in fit statistics this study adopted a combination of indicators such as the correlation r mean absolute error mae root mean square error rmse determination coefficient r2 kling gupta efficiency kge willmott s index agreement wi legates mccabe s lm and akaike information criterion aic the performance criteria with the corresponding equations and their ranges are listed in table 3 in addition the test statistics of the prediction accuracy based on loss differential were considered to obtain pairwise comparisons between the competing models the following null hypothesis h0 was used for each mode to identify the model producing the improved prediction 9 h 0 e l y t h y t h 1 e l y t h y t h 2 0 against the alternative 10 h 1 e l y t h y t h 1 e l y t h y t h 2 0 where e denotes the expectation operator l represents the given loss function y t h denotes the vector of streamflow variables considering the prediction at time t after h periods y t h 1 and y t h 2 represent alternative predicted vectors based on the information available at time t 3 case study and data acquisition the proposed method was applied to the karkheh river basin located southwest of iran the river was an essential part of the ancient civilization of mesopotamia that provided irrigation for millennia it originates from the central and southern regions of the zagros mountains and is considered the third largest river in iran the basin covers an area of 50 800 km2 that is located between 30 50 35 05 n latitude and 46 06 49 10 e longitude and is distributed into five sub basins namely gamasiab qarasou saymareh kashkan and south karkheh passing through parts of seven provinces in particular the elevation varies from a few meters above the sea level masl in the south to 3 615 masl in the north two thirds of the basin are located in the mountainous region jamali et al 2013 this diverse topography increases the complexity of the hydrological features of this basin wherein the mediterranean climate prevails with wet winters and dry summers moreover the annual precipitation ranges from 300 mm in the southern regions that are covered mainly by plains to 800 mm in the northern areas that are primarily surrounded by mountains the karkheh dam was constructed in 2001 and became operational in august 2002 with a designed storage capacity of 7500 million m3 for basin surface water management and flow measurements fereidoon and koch 2018 the primary objective of the dam is to control flooding and satisfy agricultural requirements followed by hydropower electricity production jamab consulting engineers 2005 fereidoon and koch 2018 the northern snow melting region acts as the primary source of water inflow followed by the air flows originating from the adjacent mediterranean sea in the west the black sea in the northwest and the persian gulf in the south the case study area is illustrated in fig 6 a the local data used in this study included the monthly streamflow time series of the karkheh reservoir spanning from 1955 to 2021 depicted in fig 6 b the quality of the data increased after the construction of the dam more than two thirds of the annual inflow into the reservoir occurs between february and june with a peak in april and the lowest inflow occurs in the dry season starting from july to october the average annual inflow is 5 582 million m3 the major drivers of precipitation in the karkheh basin are air flows and low pressure centers originating from the mediterranean sea persian gulf and the black sea modaresi et al 2016 therefore the study domain corresponds to 23 n 44 n and 23 e 64 e as portrayed in fig 6 a in addition this study utilized two indicators of the global monthly gridded dataset sea surface temperature sst and mean sea level pressure mslp to the extended reconstructed sst and the extended reconstructed mslp version 5 noaa ersst v5 huang et al 2017 the datasets have a spatial grid resolution accuracy of 2 2 and 2 5 2 5 respectively which were derived from the international comprehensive ocean atmosphere dataset icoads release 3 0 and portrayed in fig 6 c and 6 d respectively 4 experimental settings following grigsby et al 2021 for cross validation an out of sample strategy was employed using time based splitting to estimate the loss of the models on unseen samples of the testing period in this regard the datasets were split into three sets the first set accounted for 70 of the data and was used for model training from 1955 to 2000 the second set was used for model validation 15 from 2000 to 2010 and the remaining 15 was used for test purposes starting from 2010 to 2020 more specifically the datasets were split evenly consecutively and compactly across time to prevent data leakage and to preserve temporal dependencies shen and wang 2022 subsequently the sliding window technique with a window size of 12 converted the prepared mdts into supervised learning tensors in chronological order a retrospective input with a length of 12 and a batch size of 12 was used to mimic appropriately the prevailing annual conditions constituting the study target as msa predictions for the next successive 12 months for an appropriate comparison among the prediction models a grid search for hyperparameter tuning was used to ensure the identical evaluation of each model 5 results in this section at the first stage the conditional superior predictive ability of the models for 12 months ahead of streamflow prediction was investigated under two scenarios and two prediction strategies using defined hypothesis and proposed meta algorithm as described in subsections 2 1 2 3 in the second stage the accuracies of long term prediction of the integrated attention based dl models were evaluated by comparing the observed streamflow in the karkheh hydro reservoir versus predicted value obtained from 3d cnn transformer lstnet td cnn transformer lstnet and convlstm d r at monthly scales the corresponding detailed flow diagram describing the application of the proposed method is given in the supplementary file s5 5 1 first stage evaluation of the application of hydroclimate data the highly correlated regions were obtained based on the predefined threshold filter and maximum value of the corresponding lags as described in section 2 3 the selected geo spatiotemporal correlation map between sst and mslp with in situ streamflow considering the 0 95 and 0 99 threshold filters are shown in fig 7 a and 7 b respectively the location and scale specific correlation results with different lags and their clustering are given in the supplementary file s6 s7 the results indicated that streamflow is more correlated with sst than the other hydroclimate data the sst of the mediterranean sea has the highest correlation with the study area followed by the sst values of the caspian sea black sea persian gulf and the red sea in terms of mslp the persian gulf has the highest correlation followed by the grids in the east and south of the studied area the results associated with the application of the hydroclimate data in streamflow prediction for two univariate and multivariate scenarios based on hybrid direct recursive and direct strategies are presented in fig 8 a and 8 b wherein the scatter and residual error plots indicated that the univariate model was not as accurate as the multivariate model for msa monthly streamflow prediction as reported in table 4 the r2 value for both direct and hybrid methods in scenario ii r2 0 860 0 890 was higher than scenario i r2 0 664 0 691 notably the results obtained in scenario ii for the direct recursive hybrid model r2 0 89 had higher values than those in scenario ii for the direct model r2 0 86 and achieved the best performance thus this study had enough evidence to reject the null hypothesis and accept the claim with a p value of 0 05 therefore the application of the hydroclimate data along with the local data increased the accuracy of streamflow prediction the extracted features selected variables and the pca results for the two scenarios are given in the supplementary file s8 5 2 second stage evaluation of the proposed integrated attention based models the prediction results are compared by utilizing the various evaluation criteria introduced in section 2 5 in particular each prediction result was individually examined to determine the quality of the obtained performance and the results of the proposed msa streamflow prediction methods are compared based on the stand alone base model the training validation and test sets of monthly streamflow of karkhe river as prediction targets are shown in fig 9 a the prediction results are compared graphically in fig 9 b c in the form of the normalized residual error and prediction results for each year within the test period 10 years for a more insightful comparison the kernel density estimation plots of normalized residuals of all the prediction models for individual months are displayed in fig 9 d as depicted the kernel density estimation plots are on the top portion with boxplots and the data points of prediction underneath in particular theboxesrepresent the inner quartiles and the vertical lineswithin the box indicate the median whereas thediamondsrepresent the outliers in each model the kernel density estimation of monthly residual for individual models are given in supplementary file s9 along with these results the performance metrics of the proposed models were compared with the b1 and b2 models in terms of r mae rmse r2 kge wi lm and aic as listed in table 5 the results indicate that the models in the proposed architecture delivered a similar accuracy in terms of wi r2 lm and r and their performances were superior to that of the stand alone b1 and b2 models furthermore the results revealed that the stand alone rnn algorithm failed to capture the complexity the stand alone b2 models attained the highest rmse 0 141 mae 0 113 and lowest r 0 57 r2 0 298 kge 0 268 wi 0 599 and lm 0 165 which was closely followed by the b1 model the m1 model outperformed all the models with a high magnitude of r2 kge wi and lm and lower magnitudes of mae rmse overall the errors in both the m1 and m2 models were lower than those of the m3 and m4 models wherein the highest wi values pertained to the m1 with a value of 0 987 followed by m2 with a value of 0 98 which indicated the goodness of fit of these two models in comparison with all the models the hyperparameter search results are given in the supplementary file table s7 the lowest aic metric was the most suitable model for prediction m1 achieved the optimal performance with the lowest aic value of 794 676 followed by m2 m4 and m3 with values of 758 798 725 964 and 669 529 respectively which demonstrated the improved performance of the proposed models in terms of the model predictability of msa prediction in contrast the stand alone b2 model followed by the b1 achieved the most inferior performances with the highest aic values of 471 270 and 513 244 respectively the scatter plots of the predicted and observed monthly streamflow for the six models are displayed on the upper side of fig 10 a c wherein the graph located at the center of each plot is a scatter plot with a 95 confidence interval contour line the right hand side and top borders of the scatter plot represent the distributions of the normalized observed and predicted values the scatter plots implied that the least scattered estimates pertained to the m1 model followed by m2 m4 and m3 in the descending order of their determination coefficients r2 0 952 0 930 0 900 and 0 837 respectively notably all of these values were higher than those of the base models b1 r2 of 0 499 and b2 r2 of 0 298 moreover the scatter plot demonstrated that the prediction of the m1 model was the most proximate to the corresponding actual values in comparison to all the models the normalized residual error n residual of the results is presented on the lower side of fig 10 a c wherein the dashed line represents the baseline with zero residual error in addition the upper portion represents the predicted value with overestimation whereas the values in the bottom portion represent those with underestimation furthermore a taylor diagram was used to quantify the performance of the six models against the observations the model performances based on the taylor diagram are illustrated in fig 11 a which presents a summary of the prediction model results corresponding to the observations in terms of the correlation coefficient r on the radial axis standard deviation std on the polar axis and root mean squared error rmse the red dashed line indicates the observation point the taylor diagram revealed that the m1 with an r value of 0 977 and an rmse of 0 037 exhibited the best overall performance and was much closer to the observation point followed by the m2 with an r value of 0 969 and an rmse of 0 044 the td cnn lstnet with an r value of 0 959 and rmse of 0 053 and the m3 with an r value of 0 933 and rmse of 0 068 moreover the b2 with an r value of 0 570 and rmse of 0 141 achieved the worst simulation performance followed by the b1 with an r value of 0 724 and rmse of 0 125 therefore the proposed integrated models delivered promising prediction performances for achieving accurate and reliable msa long term streamflow predictions the pairwise comparisons of all models with a similar study using eq 14 and rmse values are shown in table 6 table 5 indicates that the 3d cnn lstnet architecture has a poorer capacity for modeling long term patterns using offline learning than the other proposed architectures in this regard time series backtesting was conducted using a sliding window and repeated splitting to examine the performance of the 3d cnn lstnet over the course of two consecutive years in five steps in other words the ten year test set was divided into five separate test sets and for each of them an offline model was developed using the last 56 years with the same structure and hyperparameters same as m3 the results of the time series backtesting are presented in table 7 suggesting that the accuracy of predictions can be enhanced by training the model on the most recent historical data for each target year during time series backtesting the changing properties of the dataset and model adjustment were not taken into account also rather than constructing multiple offline models it is advised to employ online learning to dynamically adapt to new temporal patterns in the data 6 discussion this study addresses the geo spatiotemporal and attention based framework for improving the 12 month ahead prediction of monthly streamflow in the karkheh river the main problems were feature extraction and long term memory compatibility of conventional mts approaches in fulfilling the long sequence time series forecasts using structured volumetric data therefore a meta algorithm was proposed to analyze and select booster predictors among hydroclimate data for poorly gauged basins based on the mdts characteristics four novel 4d dl architecture were developed and compared with univariate and base models according to the prediction capability the results confirmed the msa prediction superiority of the proposed attention based networks however the equation based models had more explainable spatial and temporal feature importance at the cost of significant knowledge and time intensity thus the present framework should be modified by implementing explainable ai in encoder decoder models to quantify the information that flows through attention layers despite the idea of geo spatiotemporal models being validated in karkhe river 4d dl networks can be developed in any other regions of interest for predicting msa streamflow the overall structure of the framework given in fig 1 and s5 is kept untouched so that the other hydroclimate variables would be analyzed first with other transformer variants lin et al 2021a 2021b considered in the next stage the established framework can assist decision makers in improving maintenance planning and minimizing unexpected failures in water management systems in karkhe river the mdts analysis using the proposed meta algorithm shows that streamflow in this region is significantly correlated with hydroclimate data in particular sst this is in agreement with the findings of helali et al 2020 modaresi et al 2016 according to the obtained correlation results among sst and streamflow presented in table s1 fig s7 and fig 7 a the maximum absolute value is approximately 0 8 at lags 5 10 and 11 followed by 0 4 and 12 with an absolute value of 0 7 the persian gulf caspian sea and eastern region of the mediterranean sea have the highest correlation values at lags 5 10 and 11 respectively with a threshold filter of 0 99 considering the threshold filter of 0 90 all the sea grids in the selected study domain were highly correlated with the streamflow except the grids located in the south east region that includes the oman sea moreover the south and east side of mediterranean sea have the highest negative correlation while the persian gulf has the highest positive correlation with respect to the case study according to table s2 fig 7 b and fig s8 the results of mslp correlation showed maximum absolute value of 0 8 at lags 3 and 4 the highest positive value is less than 0 7 at lags 9 and 10 the highly correlated grids in the study domain belong to the adjacent grids with respect to the karkhe river followed by the north side of persian gulf in contrast with sst the grids with positive and negative correlation are easy to separate from each and oman sea south of persian gulf and red sea have the highest positive correlation moreover it has long been known that there are important linkages between atmospheric circulation and river flow kingston et al 2006 owing to the geographic and climatic diversity of iran various hydroclimate data affect its precipitation patterns therefore for other case studies in iran particular care must be taken and correlation analysis must be performed among any endogenous sand exogenous sets for extracting the highly correlated variable the interested readers can refer to helali et al 2020 for further information the prediction results depict that the proposed integrated models could capture the monthly streamflow more appropriately than the stand alone b1 and b2 models convlstm has independent convolutional operations over the input the hidden state and in the input to state transition as shown in fig s10 resulting in a large number of redundant variables and computational costs therefore the redundancy of spatial convolutions in convlstm resulted in significant reduction in prediction accuracy in comparison with the proposed architecture thus the performance of the td layer cnn attention layer and ar in the proposed integrated networks enabled them to detect trends maintain complex long and short term dependencies and predict the highest peak with superior accuracy as shown in fig 9 b the b1 and b2 models underestimated peaks and overestimated particular recessions in the residual error plot whereas m4 appropriately simulated the rising and recession limbs of the hydrographs followed by m3 m1 and m2 note that the transformer model inherently used the recursive method and predicted the future value based on the previously predicted value whereas the lstnet predicted the future values by simultaneously ensemble the results of both direct and recursive methods to report the predicted value based on the results of this study the models that take the advantage of both direct and recursive strategies are more capable of detecting the trend in comparison with the other which use either recursive or direct strategies the standalone base models b1 and b2 are incapable of detecting the trend in april 2018 an extreme flood accrued in the study area with a high return period 400 years that was devastating accordingly in this study predefined lower and upper bound values were used for normalization to maintain this value and not to account for it as an outlier generally conventional prediction methods such as rnns fail to detect the abrupt changes in time series especially in cases wherein abrupt changes occurred outside the training period therefore underestimation or overestimation values were obtained among all the models m4 predicted the extreme flood in 2018 with the highest accuracy followed by m3 whereas both m1 and m2 models predicted this peak with underestimation as this extreme value is located at the end of the test set a high accuracy prediction is not a rational expectation especially in msa predictions however the proposed architecture predicted this extreme flood with acceptable accuracy particularly lstnet which simultaneously takes advantage of direct and recursive strategies the proposed networks predicted the wet feb jun and dry jul oct seasons with higher accuracy in comparison with the base models in comparison with the finding of tayerani charmchi et al 2021 on the same case study the msa streamflow prediction performance dramatically increased in terms of rmse by 75 and 26 reduction for m1 as the best and b2 as the worst prediction model performance respectively 7 conclusions this study focused on improving the accuracy of long term streamflow prediction of a poorly gauged basin in two main stages first a novel meta algorithm was proposed for variable selection and developing equation based models through both direct and hybrid msa prediction strategies second four novel integrated dls were proposed using 4d convolutional and attention based networks to predict the streamflow time series over a long term horizon 1 year 12 steps based on structured volumetric data the proposed framework assessed from the superiority of hydroclimate booster variables and prediction capability prospects in karkheh river a dl architecture of 3d cnn transformer time distributed 2d cnn transformer 3d cnn lstnet and time distributed 2d cnn lstnet constituted the proposed integrated models m1 to m4 the pros and cons of the established framework along with the broader implications have been discussed the following conclusions can be drawn from the results mra results indicate that the hybrid strategies achieved better prediction performance in comparison with direct strategies in both scenarios it should be noted that mra result were not compared with the dl based results since the former was used as a glass box method to test the cspa the latter is used to investigate the effect of the attention based dl and proposed network architectures on msa prediction the application of hydroclimate data enhanced the msa streamflow prediction performance by 29 in terms of r2 in both strategies in the designated case study as a poorly gauged basin it should be noted that hybrid strategy in scenario ii achieved the highest prediction accuracy with 14 increase in terms of correlation 41 decrease in terms of mae and 32 5 decrease in terms of rmse the coupled deep cnns with attention networks reduced the complexity of extracting dynamic complex and nonlinear geo spatiotemporal dependencies the proposed msa models significantly improved long term prediction performance by delivering higher accuracy than the recursive and direct msa prediction using convlstm2d models the proposed integrated models from m1 to m4 confirmed the superior performance with 53 69 52 68 46 64 and 50 67 increase in terms of r2 compared to the base models for two direct and recursive strategies respectively among the four proposed integrated networks both the timing and quantity of the peak were accurately predicted by using lstnet as bottoming m4 m3 the overall performance of the 3d cnn transformer model was superior to the other models in the proposed network architecture however non linear relationships were neglected for the dimension reduction step in the first stage moreover the common assumption of row dependency across time was adopted that is folding and random sampling for cross validation were neglected one major limitation of this study is that further case studies on different climates and sizes in other geographical locations are required for conducting more research on the generalizability of the proposed msa framework findings thus the correlation results network components hyper parameters and model accuracy would vary according to the employed mdts in any regions any poorly gauged basins with univariate historical streamflow data can take the advantage of proposed framework to improve long term streamflow prediction transfer learning and pre trained models can be used if a long historical dataset is not accessible for success training according to lattice data spatial networks other than cnn can be used for more complex environments with sparse and discrete dependencies as previously discussed a huge body of research and implementation can be consolidated into this framework our future works will involve transforming the proposed deterministic prediction framework into a probabilistic one with improved performance and effectiveness for integrated water resource management cnns will be replaced with graph neural networks to concurrently reduce computing costs and improve the overall performance faced by the sheer volume of geo spatiotemporal data with a large number of unmeasured grids furthermore the transductive learning and rolling cross validation will be assigned in the framework to diminish the accumulation error problem in msa as the horizon expands via an online method credit authorship contribution statement fatemeh ghobadi conceptualization methodology investigation software validation formal analysis data curation writing original draft writing review editing visualization doosun kang methodology supervision validation writing review editing resources funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work is financially supported by korea ministry of environment moe as graduate school specialized in climate change appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 128608 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
2659,extreme rainfall is a critical agent driving flash floods in urban areas in rainfall frequency analysis rfa however storms are usually assumed to be uniform in space and fixed in time spatially and temporally uniform design storms and area reduction factors are oftentimes used in conjunction with rfa results in engineering practice for infrastructure design and planning the consequences of such assumptions are poorly understood this study examines how spatiotemporal rainfall heterogeneity impacts rfa using a newly introduced bivariate framework consisting of copula theory and stochastic storm transposition sst a large number of regionally extreme storms with specific features rainfall depth duration intensity and level of intra storm spatial organization were collected rainfall intensity durationfrequency idf estimates exhibiting these bivariate features were then generated by synthesizing long records of rainfall via sst the results show that dependencies exist among spatiotemporal storm characteristics bivariate frequency results exhibit smaller uncertainties but more complex physical meanings that the results from conventional methods in particular the highly spatially organized storms play a leading role in frequency estimates keywords rainstorms copula stochastic storm transposition rainfall frequency analysis spatiotemporal heterogeneity data availability the data used in this paper is open source which can be downloaded from https gpm nasa gov data directory this has been stated in acknowledgments samples and data 1 introduction rainstorms are complex hydrometeorological phenomena with both spatial and temporal characteristics playing important roles in flood generation bruni et al 2015 morin et al 2006 nikolopoulos et al 2014 ogden et al 2000 ramos et al 2005 segond et al 2007 wright et al 2014 zhou et al 2017 zhu et al 2018 with the urban expansion and regional to global climate change there are increasing trends in the numbers and severities of storm events and associated flooding rainfall features and their variability including rainfall amount intensity duration and spatial patterns can directly affect rainfall runoff mechanisms and related processes that in turn control flood timing and severity storm events that are extreme with respect to large rainfall intensities or depths are of particular concern multiple attributes for instance highly organized storms i e those that concentrate rainfall into relatively small areas with the extreme storm in beijing on 21 july 2012 brought 100 mm d of rainfall to nearly 90 of the urban area while 460 mm d of rainfall concentrated over the fangshan district resulted in substantial damage see wang et al 2021 zhang et al 2013 with increasing global and urban temperatures intense convective storms may become even more tightly organized peleg et al 2018 enhancing flood risks peleg et al 2019 conventional rainfall frequency analysis rfa however pays little attention to the likelihood of rain events with two or more extreme features obtaining rainfall frequency estimates that better reflect multiple spatiotemporal rainfall features is of growing interest knighton and walter 2016 wu et al 2015 chebana and ouarda 2011 favre et al 2004 bivariate rfa is an approach to probabilistically model multi dimensional specifically two dimensional rainfall features for generating rainfall frequency estimates it fundamentally requires the derivation of a joint distribution that considers both the marginal distributions and dependencies between variates fermanian 2005 several studies have used copulas for this task duan et al 2016 zhang and singh 2006 zhong et al 2021 copula based rfa has often combined rainfall depth and duration as the most common variable pairs because of their typically strong correlations balistrocchi and bacchi 2011 jun et al 2018 kao and govindaraju 2007 others have examined joint cumulative distribution functions of storm durations and amounts lee et al 2010 and storm peak intensities and volumes yue 2000 in previous copula based studies long term about 40 50 years observational records have generally been used bardossy and pegram 2009 lee et al 2010 yoo et al 2016 yue and rasmussen 2002 broader application of copulas is limited however due to them generally being data hungry limited length of data tends to negatively affect the rfa results see dung et al 2015 genest et al 2009 su and tung 2013 the stochastic storm transposition sst method provides an rfa framework for linking rainfall intensity durationfrequency idf to rainfall space time properties with particular strengths when observational record lengths are limited e g a ten year high resolution rainfall dataset was used in wright et al 2013 the core idea of sst is to use regional probabilistic resampling from a storm catalog essentially a collection of rainfall space time fields from historical storm events with storm geospatial translation i e transposition to estimate local scale extreme rainfall frequency without any simplifying assumptions of rainfall space time structure by using high resolution radar rainfall data sst has been shown to produce satisfactory frequency analysis results with some desirable properties not provided by conventional rfa methods wright et al 2013 yu et al 2021 yu et al 2019 zhou et al 2019 combining copula theory with sst this study has two main objectives 1 develop a bivariate rfa framework to connect any two dependent variables of the following rainfall features depth duration intensity and level of rainfall spatial organization and 2 using the proposed framework examine the impact of rainfall spatiotemporal heterogeneity on rfa which will be helpful for incorporating multidimensional rainfall characteristics in urban rainfall frequency estimates the rest of the paper is organized as follows in section 2 we first introduce the study area and data and describe the calculation of storm features as well as the sst and copula methodologies in section 3 an analysis of the storm catalog sst copula bivariate frequency models and the influence of storm spatial heterogeneity on rfa are presented further interpretation of the results including the impact of sample size marginal distribution and copula function are discussed in section 4 a summary and conclusions are presented in section 5 2 data and methods 2 1 study area and data this study focuses on the megacity of shanghai china it is a major coastal city in a relatively flat coastal plain the average annual temperature and rainfall is 18 c and 1320 mm respectively study area a i e shanghai excluding its offshore islands and the larger region a that will be used for storm transposition see section 2 2 for more details share similar hydrometeorological characteristics and are shown in fig 1 this region is impacted by the subtropical monsoon cyclonic storms plum rains i e a season of rainfall in early and mid summer in southern china and intense convective precipitation which leads to a pronounced june september flood season a description of the formative mechanisms of summertime extreme rainfall in the region can be found in tang et al 2021 extreme rainfall occurs frequently and represents a substantial risk for deadly and damaging flooding the integrated multi satellite retrievals for the gpm imerg gridded satellite precipitation dataset e g imerg early v06b were used in this study imerg was obtained from the global precipitation measurement gpm mission https gpm nasa gov data directory and has proved to be superior to other satellite products sharifi et al 2016 and has also shown the potential for application in urban areas kazamias et al 2022 li et al 2021b ground based validation of imerg and its ability to capture extreme rainfall in the shanghai area can be found in the supplementary file the dataset has a spatial resolution of 0 1 0 1 roughly 10 km 10 km in the study area and a temporal resolution of 30 min for the 2000 2020 period 2 2 sst copula coupled bivariate frequency model in this section we provide a step by step methodology for the sst copula coupled bivariate frequency framework the sst frequency analysis model used in this paper is based on rainyday an open source sst software package wright et al 2017 three archimedean copulas frank gumbel clayton were used in this procedure this is the first attempt to integrate multivariate analysis theory with probabilistic resampling copula modeling is used to connect multiple co dependent storm characteristics while the observational record available for this modeling can be effectively lengthened by sst via probabilistic resampling and geospatial transposition the flow chart of the proposed framework is shown in fig 2 the following five steps describe the sst copula procedure 1 the first step is to identify a transposition domain a e g a 436 900 km2 shown in fig 1 that contains the area of interest a e g a 4 900 km2 shown in fig 1 the main principle of defining domain a is to include as many extreme storms as possible in the resulting storm catalog while not including storms that are not too dissimilar the best practice is to confine the domain such that extreme rainfall properties within it are roughly homogeneous see wright et al 2017 as shown in fig 1 and mentioned above the lower reaches of the yangtze river were selected as transposition domain a tropical cyclone rainfall and synoptic patterns are roughly similar over this region see tang et al 2021 2 the second step is to identify the largest m independent storms within a and this set of storms is referred to as a storm catalog from an n 21 year rainfall record from 2000 to 2020 we first identify all independent storms from imerg of the size shape and orientation of a that occurred within domain a two key elements are used to identify independent storms minimum event depth med and minimum inter event time mit in order to filter out light rainfall events areal averaged rainfall of 0 01 mm was chosen as the value of med in this paper 6 5 h was chosen as the value of mit to separate rainfall events from a continuous rainfall series using restrepo s approach restrepo posada and eagleson 1982 the detailed process for identifying independent rainfall events in region a is illustrated in fig 3 this study uses the m 200 these extreme events are referred to as parent storms in the catalog and unlike previous rainyday based sst studies have various durations 3 the third step is to geographically transpose storms to synthesize n years of storm events to do this a subset of k storms is randomly sampled from the storm catalog to reflect one synthetic year of rainfall events where k is a poisson distributed number of storm occurrences with rate parameter λ storms per year λ m n in this study we chose m 200 storms over the 21 year rainfall record for λ 9 52 storms year 1 for each storm all associated rainfall fields were transposed by an east west distance δ x and a north south distance δ y δ x and δ y were drawn from distributions d x x and d y y which in rainyday can be set as uniform or non uniform and are bounded by the limits of the transposition domain a the non uniform option was used in this study see wright et al 2017 for further explanation the spatiotemporal structure of the storms is unaltered during transposition from the transposed k storms the extreme rainfalls over area a can be calculated for the synthetic year the largest in terms of depth of these events is then retained this step is repeated n 200 times to synthesize 200 years of synthetic annual maxima storm events then the multidimensional storm characteristics based on n year annual maximum events were then calculated for each event the basin averaged rainfall accumulation r duration d basin averaged rainfall intensity i and level of rainfall spatial organization clustering represented by moran s i m see moran 1950 were computed as follows 1 basin a v e r a g e r a i n f a l l a c c u m u l a t i o n mm r t r t 2 rainfall d u r a t i o n h d t end t start 3 basin a v e r a g e r a i n f a l l i n t e n s i t y mm h i r d 4 level o f r a i n f a l l s p a t i a l o r g a n i z a t i o n m l i 1 l j 1 l w ij i 1 l j 1 l w ij x i x x j x i 1 l x i x 2 where r t is the rainfall accumulation of the t time step with the same spatial and temporal resolution as the input rainfall data and with the same size shape and orientation of a tend and tstart are the end time and start time respectively of a storm event xi xj are the accumulated rainfall depth at the ith jth satellite grid cell in the storm event l is the total number of grid cells in area a wij is an element in a spatial 0 1 wt matrix w see zhuang et al 2020 for details 0 m 0 4 is defined as low spatial clustering of rainfall 0 4 m 0 6 is moderate clustering and m 0 6 is high clustering see fig s3 in the supplementary file more detailed discussions about rainfall spatial organization as represented by m are provided in the supplement file 4 the fourth step is to fit a copula model for any two user defined variables out of r d i and m using the bivariate copula function two variables and their dependent construction can be represented for instance h x y p x x y y is a joint distribution function with two marginal distributions u f x p x x and v g y p y y to each random pair x y we can associate f x g y and h x y via a copula function c u v 5 h x y c f x g y the frank gumbel and clayton copula functions used in this study are shown in eqs 6 8 6 frank 1 θ log 1 exp θ u 1 exp θ v 1 exp θ 1 θ r 0 7 gumbel exp ln u θ ln v θ 1 θ θ 1 8 clayton max u θ v θ 1 0 1 θ θ 1 0 where θ is the dependency parameter of the copula function these were estimated using maximum likelihood goodness of fit tests were used to select the copula models that best capture the selected variables and their dependence structures the kolmogorov smirnov k s test zhang and singh 2012 was used to evaluate the validity of the marginal distributions the akaike information criterion aic akaike 1974 bayesian information criterion bic schwarz 1978 and root mean square error rmse vittal et al 2015 zhong et al 2021 were used to identify the relative distance between theoretical probabilities calculated using eqs 6 8 and empirical probabilities obtained using gringorten s formula gringorten 1963 to evaluate the good performance of the copula models tests of tail dependence are necessary for copula selection nguyen and jayakumar 2018 serinaldi et al 2015 we evaluated the adequacy of modeled tail dependence by comparing theoretical λ u l t h e o and empirical λ u l e m p tail dependence coefficients with the subscripts u and l representing upper and lower i e left and right tails respectively functions for theoretical tail dependence coefficients are dung et al 2015 9 λ u lim s 1 p x f 1 s y g 1 s lim s 1 p f x s g y s 10 λ l lim s 0 p x f 1 s y g 1 s lim s 0 p f x s g y s where x and y are asymptotically dependent in the upper or lower tail when the λ u o r λ l 0 1 x and y are asymptotically independent in the upper or lower tail when λ u o r λ l 0 after the introduction of copula functions eqs 6 8 into eqs 9 10 the dependence coefficients of frank gumbel and clayton in the upper tail are 0 2 2 1 θ and 0 respectively and in the lower tail are 0 0 and 2 1 θ respectively the empirical tail dependence coefficients are based on the heuristic plateau finding algorithm from frahm et al 2005 the copula function with the best goodness of fit test tail dependence test performance was considered the most suitable copula model 5 the fifth step is to do bivariate frequency analysis estimating joint and conditional return periods derived from the best fitted copula function the joint return periods of bivariate events x x or y y and x x and y y are called or tor and and tand return periods respectively han et al 2018 zhang and singh 2006 11 t or μ t p x x or y y μ t 1 h x y μ t 1 c u v 12 t or μ t p x x or y y μ t 1 f x g y h x y μ t 1 u v c u v the conditional return period evaluates the probability of hydrological events x x given that the y y or y y the conditional return periods of bivariate events x x y y and x x y y are called t and t respectively yue et al 1999 13 t μ t p x x y y μ t 1 p x x y y μ t 1 h x x y y μ t 1 c u v v μ t 1 v c u v v v 14 t μ t p x x y y μ t p x x y y p y y μ t g y h x y g y μ t 1 c f x g y g y μ t 1 c u v v in which μ t is the mean interval years of hydrological extreme events e g μ t 1 2 3 the relationship between univariate and bivariate frequency analyses in univariate frequency analysis unidimensional data are ranked directly by magnitude fig 4 b the return periods tx are average intervals between the occurrence of hydrological events x x in bivariate frequency analysis the ranking of events is more complex as shown in fig 4c the probability of bivariate events x y can be divided into four quadrants p x x y y p x x y y p x x y y and p x x y y are the probabilities that a bivariate event falls into quadrant ⅰ ii iii and ⅳ respectively the sum of the probabilities of the four quadrants equals 1 and the probability of rainfall events falling in the four quadrants can be obtained via integral calculation see yue and rasmussen 2002 for details joint return periods and conditional return periods are then used to describe the average recurrence interval of bivariate events x y as lee et al 2010 noted the conditional return period t more conceptually corresponds to the rainfall return periods estimated from the univariate frequency however the conditional return period can be significantly different for given thresholds y hence using t we define an uncertainty area of conditional probability in fig 4d the area with gray lines represents uncertainty caused by links between two variables the uncertainty area grows depending on the strength of the relationship between x and y this study attempts to explain the influence of rainfall variables on rainfall frequency estimates using u t i to measure this uncertainty between different curves 15 u t i x t i y y 1 x t i y y 2 x t i y y 2 where x t i y y 1 and x t i y y 2 are drawn from idfs of x under y y1 and y y2 conditions for different return periods ti fig 4d 3 results 3 1 the analysis of storm events in the storm catalog the basin average rainfall accumulation r rainfall duration d basin average rainfall intensity i and level of rainfall spatial organization measured by moran s i m were computed for the 200 storms in the storm catalog overall features of storms in the catalog are summarized in fig 5 r ranges from 81 mm to 383 mm with a median of 111 mm the median 75th percentile of d is 26 5 h 38 5 h the median value of i is 4 6 mm h and the maximum reaches 16 5 mm h the median maximum value of m is 0 46 0 7 this indicates that storm depth in the study area varies from 80 to 380 mm and generally falls within two days with moderate and highly spatially organized rainstorms 3 1 1 spatial heterogeneity in the transposition domain spatial heterogeneity over the transposition domain is examined in terms of storm magnitude and the occurrence frequency despite the similarity in hydrometeorological conditions over the region reported by tang et al 2021 there is pronounced variability in rainfall magnitude and occurrence evident within the transposition domain from the composite map of average rainfall depth fig 6 a rainfall increases from the center of the domain toward the coast with the largest rainfalls occurring in the eastern coastal portion of the domain south of shanghai there is less rainfall in the domain s southern and northern margins the spatial probability of storm occurrence fig 6b is computed using a 2 d gaussian kernel based on the locations of 200 storm centroids wright et al 2017 the maximum probability of rainfall occurrence is in the center of the domain while the east coast shows lower smaller occurrence the difference between storm magnitude and storm occurrence indicates that storms with moderate magnitude occur in the center while rarer but more extreme storms occur farther east this spatial heterogeneity is likely associated with the terrain in this area rainfall climatology can depend on regional features such as topography and land water boundaries huang et al 2021 mao et al 2021 smith et al 2012 yang et al 2014 zhou et al 2019 the land ocean boundary wang et al 2018 and the yangtze river li et al 2021a in the domain play important roles in the regional climatology of extreme storms in contrast the distribution of storms with different levels of spatial clustering in domain a is less clearly spatially organized fig 6c these results highlight that the distribution of rainfall accumulation in the region is caused by complex storms with various spatial patterns 3 1 2 occurrence of storm events an upward but not statistically significant p 0 052 the trend in the number of storm occurrences per year within the storm catalog using the mann kendall test mann 1945 the largest annual numbers of storm events were in 2015 and 2016 with 17 events each fig 7 a both 2000 and 2020 were excluded from this analysis because both years were incomplete covering 1 june to 31 december 2000 and 1 january to 28 june 2020 respectively these two years were excluded from the trend test it should be noted that the remaining sample size 19 years is quite limited for temporal trend testing and thus this result should not be considered indicative of a lack of temporal rainfall change storm occurrence shows clear seasonality with the peak in june fig 7b associated with localized summertime thunderstorms xu 2020 the intra annual probability of storm occurrence is analyzed by gaussian kernel density estimation in fig 7c which demonstrates that extreme r occurs most frequently in early july these storms exhibit various spatiotemporal characteristics with different d i and m conditions thus the intra annual probabilities of occurrences for specific events with d i and m exceeding the 75th quantiles of all storms in the catalog are shown in fig 7d the i and m extreme values peak around day 184 early july while extreme d appears on day 213 early august the seasonality of short duration storms d 18 h is found to be consistent with the early july peak in high intensity i and highly clustered m storms occurrence of longer duration d 38 h storms peaks in late july the inter annual and intra annual distributions of rainfall in the storm catalog are consistent with other analyses of storm characteristics in shanghai liang and ding 2017 suggesting that despite the spatial differences across the domain shown in fig 6 the regional storm catalog can be used together with sst to estimate rainfall characteristics in shanghai itself it also confirms that imerg is able to capture basic rainfall properties e g seasonality in the region 3 1 3 space time structure of storm events the scatterplots in fig 8 show the bivariate relationships of the events in the storm catalog the r d and i m pairs show that greater rainfall depth of storms corresponds to longer duration notwithstanding considerable scatter fig 8a a strong inverse relationship in i d pairs indicates that more intense storms have a shorter duration fig 8c bivariate dependencies are further evaluated through the spearman rank correlation test william 1958 r d and i m pairs have significant positive dependence spearman rank correlation coefficient ρ 0 483 p value 0 001 for r d pairs ρ 0 289 p value 0 001 for i m pairs while d m and d i pairs have significant negative dependence ρ 0 238 p value 0 001 for d m pairs ρ 0 803 p value 0 001 for d i pairs there is no significant negative correlation between r m ρ 0 041 p value 0 56 or r i ρ 0 045 p value 0 53 pairs the spatial distribution of the average rainfall in the storm catalog is shown in fig 9 if storms are categorized in terms of the degree of rainfall spatial clustering the results found that the distribution of shanghai shaped storms is significantly different rainfall accumulation in watershed a is localized in the city center when m 0 5 or 0 6 when m 0 3 and 0 4 however the pattern of rainfall is more likely to be uniform or even dispersed over the watershed 3 2 sst copula coupled bivariate frequency models 3 2 1 goodness of fit testing the two pairs with the most significant correlation r d and i m were used to construct sst copula models generalized extreme value gev pearson type iii p3 and 3 parameter log normal ln3 distributions were considered candidates for marginal distributions table 1 a shows the k s test findings which were used to assess how effectively these marginal distributions fit the variables the p3 distribution offers the best fit for both r and d because a lower dn in the k s test denotes a negligibly different distribution between the empirical and theoretical distributions ln3 is the optimal marginal for variable i while gev for variable m the aic bic rmse and tail dependence tests were used to determine which copula function was best for the r d and i m models the 200 years of synthetic annual maxima were used to conduct these tests in this section as shown in table 1b the frank copula outperforms the others with the lowest aic bic and rmse for the r d model however the substantial upper tail dependency of the r d pairs λ u e m p r d 0 35 in table 1c cannot be explained by the frank copula as a result the gumbel copula with upper tail dependence is a better choice for the r d pairs similarly the upper and lower tails of the i m pairs are asymptotically independent λ u e m p i m 0 08 λ l e m p i m 0 and the frank copula is selected to model the bivariate distribution of the i m pairs 3 2 2 analysis of joint and conditional return periods fig 10 presents joint and conditional return periods estimated from sst copula models in the r d model joint return periods of arbitrary combinations of r and d e g events r r or d d or r r and d d can be obtained in which thresholds r and d can be set manually for example r 100 mm and d 24 h has a return period of 2 3 yr the red dot b in fig 10a while r 100 mm and d 100 h has a return period of 55 3 yr the blue dot e in fig 10a in fig 10c and 10d the return periods t and t are shown for various values of d for a given r for the i m model the results are more complicated for example i 7 6 mm h and m 0 3 has a return period of 100 yr fig 10b while i 4 8 mm h and m 0 6 also has a return period of 100 yr if the conditions of m are not taken into account the return periods of univariate events i 4 8 mm h and i 7 6 mm h are 12 5 yr and 100 yr respectively the difference in outcomes indicates that the risk of events with moderate rainfall accompanied by highly clustered conditions such as i 4 8 mm h and m 0 6 will be overlooked in univariate cases two techniques were used to verify the sst copula outputs the independent sst approach and the pearson type iii p3 distribution for fitting the areal rainfall maxima in region a using the r d models shown in fig 10c as an example the results generated by the sst copula models are reasonable outputs of sst copula at d 24 h are higher than p3 but lower than sst the estimated return periods from the sst copula at d 72 h are smaller than those of the other methods while those at d 120 h are the largest however results from the p3 distribution are always smaller than those from sst these findings highlight the complex relationships between rainfall duration and depth that are neglected using univariate frequency analysis methods 3 3 influence of rainfall spatial heterogeneity on rfa 3 3 1 the impact on the idf curves the role of spatial heterogeneity in extreme rainfall frequency analysis is examined by the sst copula model e g r m model the uncertainty areas in idf curves given different values of m are not prominent two conditions of m 0 3 and m 0 7 result in a 4 7 uncertainty u t i in section 2 2 3 from 2 to 200 yr return periods showing that spatial heterogeneity can have a small degree of influence on the idf curves 3 3 2 the impact on the spatial distributions of rainfall return periods the sst copula model can also provide rainfall distributions for different return periods constrained by different spatial heterogeneity conditions estimates of rainfall depths with m 0 3 and m 0 6 exhibit a distinct difference in spatial distribution as shown in fig 11 fig s6 in the supplementary file shows more details with m conditions varying from 0 3 to 0 6 when m 0 3 and t 10 yr the largest depth appears in the east of shanghai when m 0 3 and t 100 yr depths exhibit a decreasing tendency from northwest to southeast when m 0 6 however depths show a highly clustered pattern in the highly urbanized city center this may be indicative of the intensification of extreme rainfall over and downwind of cities e g lorenz et al 2019 yang et al 2021 when m 0 3 the spatial distribution of rainfall depth is inconsistent with the actual situation in shanghai liang and ding 2017 zhuang et al 2020 the reason is probably that a small number of generated extremes may not be plausible in this area with consideration of these erroneous storms the reliability of the outputs is suspect too e g the last line panel of fig 11 therefore based on the sst copula framework we could select locally realistic parameters to obtain robust copula outputs for instance according to the high spatial clustered of storms in shanghai the result in the r d case given m 0 6 will provide better description of the real world situation rainfall spatial heterogeneity associated with rainfall depth brings uncertainty to the univariate based estimates of rainfall depth in table 2 contribution rate is defined as the share of rainfall spatial organization levels measured by m values that contribute to the spatial distribution of rainfall estimates derived from univariate analysis univariate rainfall estimates for area a are used as the dependent variable in a linear regression analysis and bivariate rainfall estimates given different m values for the corresponding locations are used as the independent variable the contribution rate is slopes obtained by regression for various return periods the contribution rate of storms with m 0 6 to univariate based rainfall scenarios is 30 and the contribution ratio varies around 20 when m 0 3 0 4 and 0 5 the results show that the highly clustered storms e g m 0 6 have a substantial impact on rfa results 4 discussion 4 1 sst copula bivariate frequency analysis and its potential meaning in this section we provide interpretations of the results in section 3 2 2 the relationship between conditional return periods t associated with events x x y y and univariate return periods t x can be explained fig 10c d 16 t t x x y y 1 1 f x x y y 1 1 f x t x in which f x x y y f x f f x the results in fig 10c d confirms these inequalities although some researchers graler et al 2013 serinaldi 2015 criticize papers for saying that the marginal joint or conditional return periods over or underestimate one another this paper argues that the difference between the conditional return period is worth discussing different return periods under bivariate conditions depend on the relationship between x and y which can be used to explain the influence of independent rainfall variables on estimated rainfall depths for example in this paper conditions of d 24 h and d 72 h result in a 28 46 uncertainty in r from 10 to 100 yr return periods while m 0 3 and m 0 5 result in a 20 30 uncertainty in i for 10 to 100 yr return periods thus the uncertainty due to the ignored connections between two variables in rfa is quantified the results in this paper can be influenced by the accuracy and resolution of data and the size of the study area figs s1 s7 in the supplemental file despite the relatively coarse scale imerg data available for this study our results still shed light on the importance of accurate representations of rainfall spatiotemporal characterization in obtaining idfs in urban areas the uncertainty caused by the spatiotemporal resolution of input data should be examined in future work furthermore a new procedure of resampling in the sst copula could be explored for instance by evaluating the storm severity using different storm characteristics e g r d i and m and selecting the storms for the catalog the framework of this paper could be extended to flood frequency analysis akin e g to brunner et al 2016 for instance if variable x represents rainfall depth r and y represents rainfall clustering level in space m one potential rainfall flood relationship is hypothesized in fig 12 when heavy rainfall is clustered in a certain area quadrant i the flood events will have a high peak discharge a large flood volume and even an early peak time however when heavy rainfall is dispersed throughout the watershed quadrant ii the flood event can have a bigger volume a lower peak discharge and a later peak time therefore when both rainfall volume and spatial pattern are of interest different combinations of two dimensional rainfall features are possible which result in different flood responses and design variables 4 2 effect of sample size marginal distribution and copula function since there are many moving parts to this rfa approach several sources of uncertainty regarding idfs results merit discussion these include sample size and the choice of marginal distribution and copula function first we consider sample size effects taking r d pairs as an example n 50 100 200 and 500 synthetic years are generated from the same storm catalog as the sample size goes from 50 to 500 r d pairs remain highly upper tail dependent and the gumbel copula outperforms others in all cases in fig 13 a b larger sample sizes result in a conditional larger return period at a certain r value and this difference is more pronounced when d goes from 12 to 72 h there is little influence of sample size on joint return periods both tand and tor from n 50 to 500 in fig 13c d especially for n 200 and n 500 overall the large sample size allowed by the sst copula method significantly reduces uncertainties for copula based bivariate frequency analysis next we examine the effects of marginal distributions and copula function selection copula functions affect the upper tail and lower tail idf results and this influence varies with return period and with d in the r d case fig 14 a c d the influence of marginal distributions on idfs is weaker fig 14b e f it should be noted that the effect of marginal distributions coupled with different copula functions on idf results is quite complex a deeper review of tail behavior and its influence is suggested 5 summary and conclusions this paper presents an approach for bivariate rainfall frequency analysis rfa in urban watersheds that couples copula theory with stochastic storm transposition sst the framework is applied in shanghai china and focuses on rainfall depth r duration d intensity i and degree of rainfall spatial organization m referred to in this study as clustering the main conclusions of the study are 1 extreme storms are multi dimensional with complex dependency among their features significant positive dependencies were found between rainfall accumulation duration and rainfall intensity duration while negative dependencies were found between rainfall duration clustering and rainfall duration intensity 2 the sst copula model provides a framework for bivariate rfa at regional scales the proposed framework highlights two advantages 1 the spatiotemporal characteristics of storms are retained and conditional scenarios can be obtained to describe the spatial distribution of rainfall return periods from a bivariate perspective 2 repeated sampling is allowed in the sst procedure based on a storm catalog increases the effective sample size and reduces the uncertainty in frequency analysis 3 rainfall spatial heterogeneity produces uncertainties both in idf estimates and spatial rainfall distribution the different rainfall clustering conditions result in a 4 7 uncertainty for idf estimates the highly clustered storms are found to play a leading role in the spatial distribution of rainfall return periods and the share of rainfall spatial organization levels with m 0 6 that contribute to the univariate based rainfall estimates is 30 the sst copula framework in cases with relatively short gridded precipitation records 21 years in this study provides a flexible approach to effectively lengthen the rainfall series in bivariate rfa the output provides spatial storm scenarios for scenario based analyses of rainfall and floods and joint return periods could prove useful for flood resilience planning in future work coupling a flood model with each stochastic copula sample could be a meaningful way to interpret the joint probabilities involved in flood estimation credit authorship contribution statement qi zhuang conceptualization methodology visualization formal analysis writing original draft zhengzheng zhou conceptualization methodology software validation writing review editing shuguang liu supervision writing review editing daniel b wright methodology software writing review editing josé tavares araruna júnior supervision writing review editing aleksei n makhinov writing review editing aleksandra f makhinova writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement samples and data the authors declare no conflict of interest the funders had no role in the design of the study nor the interpretation of data or the writing of the manuscript this research was funded by the national natural science foundation of china 51909191 51961145106 52111530045 the authors would like to acknowledge the helpful comments of all reviewers without which the quality of the paper could not be improved the dataset of global precipitation measurement gpm used in this paper can be downloaded from https gpm nasa gov data directory appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 128648 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
2659,extreme rainfall is a critical agent driving flash floods in urban areas in rainfall frequency analysis rfa however storms are usually assumed to be uniform in space and fixed in time spatially and temporally uniform design storms and area reduction factors are oftentimes used in conjunction with rfa results in engineering practice for infrastructure design and planning the consequences of such assumptions are poorly understood this study examines how spatiotemporal rainfall heterogeneity impacts rfa using a newly introduced bivariate framework consisting of copula theory and stochastic storm transposition sst a large number of regionally extreme storms with specific features rainfall depth duration intensity and level of intra storm spatial organization were collected rainfall intensity durationfrequency idf estimates exhibiting these bivariate features were then generated by synthesizing long records of rainfall via sst the results show that dependencies exist among spatiotemporal storm characteristics bivariate frequency results exhibit smaller uncertainties but more complex physical meanings that the results from conventional methods in particular the highly spatially organized storms play a leading role in frequency estimates keywords rainstorms copula stochastic storm transposition rainfall frequency analysis spatiotemporal heterogeneity data availability the data used in this paper is open source which can be downloaded from https gpm nasa gov data directory this has been stated in acknowledgments samples and data 1 introduction rainstorms are complex hydrometeorological phenomena with both spatial and temporal characteristics playing important roles in flood generation bruni et al 2015 morin et al 2006 nikolopoulos et al 2014 ogden et al 2000 ramos et al 2005 segond et al 2007 wright et al 2014 zhou et al 2017 zhu et al 2018 with the urban expansion and regional to global climate change there are increasing trends in the numbers and severities of storm events and associated flooding rainfall features and their variability including rainfall amount intensity duration and spatial patterns can directly affect rainfall runoff mechanisms and related processes that in turn control flood timing and severity storm events that are extreme with respect to large rainfall intensities or depths are of particular concern multiple attributes for instance highly organized storms i e those that concentrate rainfall into relatively small areas with the extreme storm in beijing on 21 july 2012 brought 100 mm d of rainfall to nearly 90 of the urban area while 460 mm d of rainfall concentrated over the fangshan district resulted in substantial damage see wang et al 2021 zhang et al 2013 with increasing global and urban temperatures intense convective storms may become even more tightly organized peleg et al 2018 enhancing flood risks peleg et al 2019 conventional rainfall frequency analysis rfa however pays little attention to the likelihood of rain events with two or more extreme features obtaining rainfall frequency estimates that better reflect multiple spatiotemporal rainfall features is of growing interest knighton and walter 2016 wu et al 2015 chebana and ouarda 2011 favre et al 2004 bivariate rfa is an approach to probabilistically model multi dimensional specifically two dimensional rainfall features for generating rainfall frequency estimates it fundamentally requires the derivation of a joint distribution that considers both the marginal distributions and dependencies between variates fermanian 2005 several studies have used copulas for this task duan et al 2016 zhang and singh 2006 zhong et al 2021 copula based rfa has often combined rainfall depth and duration as the most common variable pairs because of their typically strong correlations balistrocchi and bacchi 2011 jun et al 2018 kao and govindaraju 2007 others have examined joint cumulative distribution functions of storm durations and amounts lee et al 2010 and storm peak intensities and volumes yue 2000 in previous copula based studies long term about 40 50 years observational records have generally been used bardossy and pegram 2009 lee et al 2010 yoo et al 2016 yue and rasmussen 2002 broader application of copulas is limited however due to them generally being data hungry limited length of data tends to negatively affect the rfa results see dung et al 2015 genest et al 2009 su and tung 2013 the stochastic storm transposition sst method provides an rfa framework for linking rainfall intensity durationfrequency idf to rainfall space time properties with particular strengths when observational record lengths are limited e g a ten year high resolution rainfall dataset was used in wright et al 2013 the core idea of sst is to use regional probabilistic resampling from a storm catalog essentially a collection of rainfall space time fields from historical storm events with storm geospatial translation i e transposition to estimate local scale extreme rainfall frequency without any simplifying assumptions of rainfall space time structure by using high resolution radar rainfall data sst has been shown to produce satisfactory frequency analysis results with some desirable properties not provided by conventional rfa methods wright et al 2013 yu et al 2021 yu et al 2019 zhou et al 2019 combining copula theory with sst this study has two main objectives 1 develop a bivariate rfa framework to connect any two dependent variables of the following rainfall features depth duration intensity and level of rainfall spatial organization and 2 using the proposed framework examine the impact of rainfall spatiotemporal heterogeneity on rfa which will be helpful for incorporating multidimensional rainfall characteristics in urban rainfall frequency estimates the rest of the paper is organized as follows in section 2 we first introduce the study area and data and describe the calculation of storm features as well as the sst and copula methodologies in section 3 an analysis of the storm catalog sst copula bivariate frequency models and the influence of storm spatial heterogeneity on rfa are presented further interpretation of the results including the impact of sample size marginal distribution and copula function are discussed in section 4 a summary and conclusions are presented in section 5 2 data and methods 2 1 study area and data this study focuses on the megacity of shanghai china it is a major coastal city in a relatively flat coastal plain the average annual temperature and rainfall is 18 c and 1320 mm respectively study area a i e shanghai excluding its offshore islands and the larger region a that will be used for storm transposition see section 2 2 for more details share similar hydrometeorological characteristics and are shown in fig 1 this region is impacted by the subtropical monsoon cyclonic storms plum rains i e a season of rainfall in early and mid summer in southern china and intense convective precipitation which leads to a pronounced june september flood season a description of the formative mechanisms of summertime extreme rainfall in the region can be found in tang et al 2021 extreme rainfall occurs frequently and represents a substantial risk for deadly and damaging flooding the integrated multi satellite retrievals for the gpm imerg gridded satellite precipitation dataset e g imerg early v06b were used in this study imerg was obtained from the global precipitation measurement gpm mission https gpm nasa gov data directory and has proved to be superior to other satellite products sharifi et al 2016 and has also shown the potential for application in urban areas kazamias et al 2022 li et al 2021b ground based validation of imerg and its ability to capture extreme rainfall in the shanghai area can be found in the supplementary file the dataset has a spatial resolution of 0 1 0 1 roughly 10 km 10 km in the study area and a temporal resolution of 30 min for the 2000 2020 period 2 2 sst copula coupled bivariate frequency model in this section we provide a step by step methodology for the sst copula coupled bivariate frequency framework the sst frequency analysis model used in this paper is based on rainyday an open source sst software package wright et al 2017 three archimedean copulas frank gumbel clayton were used in this procedure this is the first attempt to integrate multivariate analysis theory with probabilistic resampling copula modeling is used to connect multiple co dependent storm characteristics while the observational record available for this modeling can be effectively lengthened by sst via probabilistic resampling and geospatial transposition the flow chart of the proposed framework is shown in fig 2 the following five steps describe the sst copula procedure 1 the first step is to identify a transposition domain a e g a 436 900 km2 shown in fig 1 that contains the area of interest a e g a 4 900 km2 shown in fig 1 the main principle of defining domain a is to include as many extreme storms as possible in the resulting storm catalog while not including storms that are not too dissimilar the best practice is to confine the domain such that extreme rainfall properties within it are roughly homogeneous see wright et al 2017 as shown in fig 1 and mentioned above the lower reaches of the yangtze river were selected as transposition domain a tropical cyclone rainfall and synoptic patterns are roughly similar over this region see tang et al 2021 2 the second step is to identify the largest m independent storms within a and this set of storms is referred to as a storm catalog from an n 21 year rainfall record from 2000 to 2020 we first identify all independent storms from imerg of the size shape and orientation of a that occurred within domain a two key elements are used to identify independent storms minimum event depth med and minimum inter event time mit in order to filter out light rainfall events areal averaged rainfall of 0 01 mm was chosen as the value of med in this paper 6 5 h was chosen as the value of mit to separate rainfall events from a continuous rainfall series using restrepo s approach restrepo posada and eagleson 1982 the detailed process for identifying independent rainfall events in region a is illustrated in fig 3 this study uses the m 200 these extreme events are referred to as parent storms in the catalog and unlike previous rainyday based sst studies have various durations 3 the third step is to geographically transpose storms to synthesize n years of storm events to do this a subset of k storms is randomly sampled from the storm catalog to reflect one synthetic year of rainfall events where k is a poisson distributed number of storm occurrences with rate parameter λ storms per year λ m n in this study we chose m 200 storms over the 21 year rainfall record for λ 9 52 storms year 1 for each storm all associated rainfall fields were transposed by an east west distance δ x and a north south distance δ y δ x and δ y were drawn from distributions d x x and d y y which in rainyday can be set as uniform or non uniform and are bounded by the limits of the transposition domain a the non uniform option was used in this study see wright et al 2017 for further explanation the spatiotemporal structure of the storms is unaltered during transposition from the transposed k storms the extreme rainfalls over area a can be calculated for the synthetic year the largest in terms of depth of these events is then retained this step is repeated n 200 times to synthesize 200 years of synthetic annual maxima storm events then the multidimensional storm characteristics based on n year annual maximum events were then calculated for each event the basin averaged rainfall accumulation r duration d basin averaged rainfall intensity i and level of rainfall spatial organization clustering represented by moran s i m see moran 1950 were computed as follows 1 basin a v e r a g e r a i n f a l l a c c u m u l a t i o n mm r t r t 2 rainfall d u r a t i o n h d t end t start 3 basin a v e r a g e r a i n f a l l i n t e n s i t y mm h i r d 4 level o f r a i n f a l l s p a t i a l o r g a n i z a t i o n m l i 1 l j 1 l w ij i 1 l j 1 l w ij x i x x j x i 1 l x i x 2 where r t is the rainfall accumulation of the t time step with the same spatial and temporal resolution as the input rainfall data and with the same size shape and orientation of a tend and tstart are the end time and start time respectively of a storm event xi xj are the accumulated rainfall depth at the ith jth satellite grid cell in the storm event l is the total number of grid cells in area a wij is an element in a spatial 0 1 wt matrix w see zhuang et al 2020 for details 0 m 0 4 is defined as low spatial clustering of rainfall 0 4 m 0 6 is moderate clustering and m 0 6 is high clustering see fig s3 in the supplementary file more detailed discussions about rainfall spatial organization as represented by m are provided in the supplement file 4 the fourth step is to fit a copula model for any two user defined variables out of r d i and m using the bivariate copula function two variables and their dependent construction can be represented for instance h x y p x x y y is a joint distribution function with two marginal distributions u f x p x x and v g y p y y to each random pair x y we can associate f x g y and h x y via a copula function c u v 5 h x y c f x g y the frank gumbel and clayton copula functions used in this study are shown in eqs 6 8 6 frank 1 θ log 1 exp θ u 1 exp θ v 1 exp θ 1 θ r 0 7 gumbel exp ln u θ ln v θ 1 θ θ 1 8 clayton max u θ v θ 1 0 1 θ θ 1 0 where θ is the dependency parameter of the copula function these were estimated using maximum likelihood goodness of fit tests were used to select the copula models that best capture the selected variables and their dependence structures the kolmogorov smirnov k s test zhang and singh 2012 was used to evaluate the validity of the marginal distributions the akaike information criterion aic akaike 1974 bayesian information criterion bic schwarz 1978 and root mean square error rmse vittal et al 2015 zhong et al 2021 were used to identify the relative distance between theoretical probabilities calculated using eqs 6 8 and empirical probabilities obtained using gringorten s formula gringorten 1963 to evaluate the good performance of the copula models tests of tail dependence are necessary for copula selection nguyen and jayakumar 2018 serinaldi et al 2015 we evaluated the adequacy of modeled tail dependence by comparing theoretical λ u l t h e o and empirical λ u l e m p tail dependence coefficients with the subscripts u and l representing upper and lower i e left and right tails respectively functions for theoretical tail dependence coefficients are dung et al 2015 9 λ u lim s 1 p x f 1 s y g 1 s lim s 1 p f x s g y s 10 λ l lim s 0 p x f 1 s y g 1 s lim s 0 p f x s g y s where x and y are asymptotically dependent in the upper or lower tail when the λ u o r λ l 0 1 x and y are asymptotically independent in the upper or lower tail when λ u o r λ l 0 after the introduction of copula functions eqs 6 8 into eqs 9 10 the dependence coefficients of frank gumbel and clayton in the upper tail are 0 2 2 1 θ and 0 respectively and in the lower tail are 0 0 and 2 1 θ respectively the empirical tail dependence coefficients are based on the heuristic plateau finding algorithm from frahm et al 2005 the copula function with the best goodness of fit test tail dependence test performance was considered the most suitable copula model 5 the fifth step is to do bivariate frequency analysis estimating joint and conditional return periods derived from the best fitted copula function the joint return periods of bivariate events x x or y y and x x and y y are called or tor and and tand return periods respectively han et al 2018 zhang and singh 2006 11 t or μ t p x x or y y μ t 1 h x y μ t 1 c u v 12 t or μ t p x x or y y μ t 1 f x g y h x y μ t 1 u v c u v the conditional return period evaluates the probability of hydrological events x x given that the y y or y y the conditional return periods of bivariate events x x y y and x x y y are called t and t respectively yue et al 1999 13 t μ t p x x y y μ t 1 p x x y y μ t 1 h x x y y μ t 1 c u v v μ t 1 v c u v v v 14 t μ t p x x y y μ t p x x y y p y y μ t g y h x y g y μ t 1 c f x g y g y μ t 1 c u v v in which μ t is the mean interval years of hydrological extreme events e g μ t 1 2 3 the relationship between univariate and bivariate frequency analyses in univariate frequency analysis unidimensional data are ranked directly by magnitude fig 4 b the return periods tx are average intervals between the occurrence of hydrological events x x in bivariate frequency analysis the ranking of events is more complex as shown in fig 4c the probability of bivariate events x y can be divided into four quadrants p x x y y p x x y y p x x y y and p x x y y are the probabilities that a bivariate event falls into quadrant ⅰ ii iii and ⅳ respectively the sum of the probabilities of the four quadrants equals 1 and the probability of rainfall events falling in the four quadrants can be obtained via integral calculation see yue and rasmussen 2002 for details joint return periods and conditional return periods are then used to describe the average recurrence interval of bivariate events x y as lee et al 2010 noted the conditional return period t more conceptually corresponds to the rainfall return periods estimated from the univariate frequency however the conditional return period can be significantly different for given thresholds y hence using t we define an uncertainty area of conditional probability in fig 4d the area with gray lines represents uncertainty caused by links between two variables the uncertainty area grows depending on the strength of the relationship between x and y this study attempts to explain the influence of rainfall variables on rainfall frequency estimates using u t i to measure this uncertainty between different curves 15 u t i x t i y y 1 x t i y y 2 x t i y y 2 where x t i y y 1 and x t i y y 2 are drawn from idfs of x under y y1 and y y2 conditions for different return periods ti fig 4d 3 results 3 1 the analysis of storm events in the storm catalog the basin average rainfall accumulation r rainfall duration d basin average rainfall intensity i and level of rainfall spatial organization measured by moran s i m were computed for the 200 storms in the storm catalog overall features of storms in the catalog are summarized in fig 5 r ranges from 81 mm to 383 mm with a median of 111 mm the median 75th percentile of d is 26 5 h 38 5 h the median value of i is 4 6 mm h and the maximum reaches 16 5 mm h the median maximum value of m is 0 46 0 7 this indicates that storm depth in the study area varies from 80 to 380 mm and generally falls within two days with moderate and highly spatially organized rainstorms 3 1 1 spatial heterogeneity in the transposition domain spatial heterogeneity over the transposition domain is examined in terms of storm magnitude and the occurrence frequency despite the similarity in hydrometeorological conditions over the region reported by tang et al 2021 there is pronounced variability in rainfall magnitude and occurrence evident within the transposition domain from the composite map of average rainfall depth fig 6 a rainfall increases from the center of the domain toward the coast with the largest rainfalls occurring in the eastern coastal portion of the domain south of shanghai there is less rainfall in the domain s southern and northern margins the spatial probability of storm occurrence fig 6b is computed using a 2 d gaussian kernel based on the locations of 200 storm centroids wright et al 2017 the maximum probability of rainfall occurrence is in the center of the domain while the east coast shows lower smaller occurrence the difference between storm magnitude and storm occurrence indicates that storms with moderate magnitude occur in the center while rarer but more extreme storms occur farther east this spatial heterogeneity is likely associated with the terrain in this area rainfall climatology can depend on regional features such as topography and land water boundaries huang et al 2021 mao et al 2021 smith et al 2012 yang et al 2014 zhou et al 2019 the land ocean boundary wang et al 2018 and the yangtze river li et al 2021a in the domain play important roles in the regional climatology of extreme storms in contrast the distribution of storms with different levels of spatial clustering in domain a is less clearly spatially organized fig 6c these results highlight that the distribution of rainfall accumulation in the region is caused by complex storms with various spatial patterns 3 1 2 occurrence of storm events an upward but not statistically significant p 0 052 the trend in the number of storm occurrences per year within the storm catalog using the mann kendall test mann 1945 the largest annual numbers of storm events were in 2015 and 2016 with 17 events each fig 7 a both 2000 and 2020 were excluded from this analysis because both years were incomplete covering 1 june to 31 december 2000 and 1 january to 28 june 2020 respectively these two years were excluded from the trend test it should be noted that the remaining sample size 19 years is quite limited for temporal trend testing and thus this result should not be considered indicative of a lack of temporal rainfall change storm occurrence shows clear seasonality with the peak in june fig 7b associated with localized summertime thunderstorms xu 2020 the intra annual probability of storm occurrence is analyzed by gaussian kernel density estimation in fig 7c which demonstrates that extreme r occurs most frequently in early july these storms exhibit various spatiotemporal characteristics with different d i and m conditions thus the intra annual probabilities of occurrences for specific events with d i and m exceeding the 75th quantiles of all storms in the catalog are shown in fig 7d the i and m extreme values peak around day 184 early july while extreme d appears on day 213 early august the seasonality of short duration storms d 18 h is found to be consistent with the early july peak in high intensity i and highly clustered m storms occurrence of longer duration d 38 h storms peaks in late july the inter annual and intra annual distributions of rainfall in the storm catalog are consistent with other analyses of storm characteristics in shanghai liang and ding 2017 suggesting that despite the spatial differences across the domain shown in fig 6 the regional storm catalog can be used together with sst to estimate rainfall characteristics in shanghai itself it also confirms that imerg is able to capture basic rainfall properties e g seasonality in the region 3 1 3 space time structure of storm events the scatterplots in fig 8 show the bivariate relationships of the events in the storm catalog the r d and i m pairs show that greater rainfall depth of storms corresponds to longer duration notwithstanding considerable scatter fig 8a a strong inverse relationship in i d pairs indicates that more intense storms have a shorter duration fig 8c bivariate dependencies are further evaluated through the spearman rank correlation test william 1958 r d and i m pairs have significant positive dependence spearman rank correlation coefficient ρ 0 483 p value 0 001 for r d pairs ρ 0 289 p value 0 001 for i m pairs while d m and d i pairs have significant negative dependence ρ 0 238 p value 0 001 for d m pairs ρ 0 803 p value 0 001 for d i pairs there is no significant negative correlation between r m ρ 0 041 p value 0 56 or r i ρ 0 045 p value 0 53 pairs the spatial distribution of the average rainfall in the storm catalog is shown in fig 9 if storms are categorized in terms of the degree of rainfall spatial clustering the results found that the distribution of shanghai shaped storms is significantly different rainfall accumulation in watershed a is localized in the city center when m 0 5 or 0 6 when m 0 3 and 0 4 however the pattern of rainfall is more likely to be uniform or even dispersed over the watershed 3 2 sst copula coupled bivariate frequency models 3 2 1 goodness of fit testing the two pairs with the most significant correlation r d and i m were used to construct sst copula models generalized extreme value gev pearson type iii p3 and 3 parameter log normal ln3 distributions were considered candidates for marginal distributions table 1 a shows the k s test findings which were used to assess how effectively these marginal distributions fit the variables the p3 distribution offers the best fit for both r and d because a lower dn in the k s test denotes a negligibly different distribution between the empirical and theoretical distributions ln3 is the optimal marginal for variable i while gev for variable m the aic bic rmse and tail dependence tests were used to determine which copula function was best for the r d and i m models the 200 years of synthetic annual maxima were used to conduct these tests in this section as shown in table 1b the frank copula outperforms the others with the lowest aic bic and rmse for the r d model however the substantial upper tail dependency of the r d pairs λ u e m p r d 0 35 in table 1c cannot be explained by the frank copula as a result the gumbel copula with upper tail dependence is a better choice for the r d pairs similarly the upper and lower tails of the i m pairs are asymptotically independent λ u e m p i m 0 08 λ l e m p i m 0 and the frank copula is selected to model the bivariate distribution of the i m pairs 3 2 2 analysis of joint and conditional return periods fig 10 presents joint and conditional return periods estimated from sst copula models in the r d model joint return periods of arbitrary combinations of r and d e g events r r or d d or r r and d d can be obtained in which thresholds r and d can be set manually for example r 100 mm and d 24 h has a return period of 2 3 yr the red dot b in fig 10a while r 100 mm and d 100 h has a return period of 55 3 yr the blue dot e in fig 10a in fig 10c and 10d the return periods t and t are shown for various values of d for a given r for the i m model the results are more complicated for example i 7 6 mm h and m 0 3 has a return period of 100 yr fig 10b while i 4 8 mm h and m 0 6 also has a return period of 100 yr if the conditions of m are not taken into account the return periods of univariate events i 4 8 mm h and i 7 6 mm h are 12 5 yr and 100 yr respectively the difference in outcomes indicates that the risk of events with moderate rainfall accompanied by highly clustered conditions such as i 4 8 mm h and m 0 6 will be overlooked in univariate cases two techniques were used to verify the sst copula outputs the independent sst approach and the pearson type iii p3 distribution for fitting the areal rainfall maxima in region a using the r d models shown in fig 10c as an example the results generated by the sst copula models are reasonable outputs of sst copula at d 24 h are higher than p3 but lower than sst the estimated return periods from the sst copula at d 72 h are smaller than those of the other methods while those at d 120 h are the largest however results from the p3 distribution are always smaller than those from sst these findings highlight the complex relationships between rainfall duration and depth that are neglected using univariate frequency analysis methods 3 3 influence of rainfall spatial heterogeneity on rfa 3 3 1 the impact on the idf curves the role of spatial heterogeneity in extreme rainfall frequency analysis is examined by the sst copula model e g r m model the uncertainty areas in idf curves given different values of m are not prominent two conditions of m 0 3 and m 0 7 result in a 4 7 uncertainty u t i in section 2 2 3 from 2 to 200 yr return periods showing that spatial heterogeneity can have a small degree of influence on the idf curves 3 3 2 the impact on the spatial distributions of rainfall return periods the sst copula model can also provide rainfall distributions for different return periods constrained by different spatial heterogeneity conditions estimates of rainfall depths with m 0 3 and m 0 6 exhibit a distinct difference in spatial distribution as shown in fig 11 fig s6 in the supplementary file shows more details with m conditions varying from 0 3 to 0 6 when m 0 3 and t 10 yr the largest depth appears in the east of shanghai when m 0 3 and t 100 yr depths exhibit a decreasing tendency from northwest to southeast when m 0 6 however depths show a highly clustered pattern in the highly urbanized city center this may be indicative of the intensification of extreme rainfall over and downwind of cities e g lorenz et al 2019 yang et al 2021 when m 0 3 the spatial distribution of rainfall depth is inconsistent with the actual situation in shanghai liang and ding 2017 zhuang et al 2020 the reason is probably that a small number of generated extremes may not be plausible in this area with consideration of these erroneous storms the reliability of the outputs is suspect too e g the last line panel of fig 11 therefore based on the sst copula framework we could select locally realistic parameters to obtain robust copula outputs for instance according to the high spatial clustered of storms in shanghai the result in the r d case given m 0 6 will provide better description of the real world situation rainfall spatial heterogeneity associated with rainfall depth brings uncertainty to the univariate based estimates of rainfall depth in table 2 contribution rate is defined as the share of rainfall spatial organization levels measured by m values that contribute to the spatial distribution of rainfall estimates derived from univariate analysis univariate rainfall estimates for area a are used as the dependent variable in a linear regression analysis and bivariate rainfall estimates given different m values for the corresponding locations are used as the independent variable the contribution rate is slopes obtained by regression for various return periods the contribution rate of storms with m 0 6 to univariate based rainfall scenarios is 30 and the contribution ratio varies around 20 when m 0 3 0 4 and 0 5 the results show that the highly clustered storms e g m 0 6 have a substantial impact on rfa results 4 discussion 4 1 sst copula bivariate frequency analysis and its potential meaning in this section we provide interpretations of the results in section 3 2 2 the relationship between conditional return periods t associated with events x x y y and univariate return periods t x can be explained fig 10c d 16 t t x x y y 1 1 f x x y y 1 1 f x t x in which f x x y y f x f f x the results in fig 10c d confirms these inequalities although some researchers graler et al 2013 serinaldi 2015 criticize papers for saying that the marginal joint or conditional return periods over or underestimate one another this paper argues that the difference between the conditional return period is worth discussing different return periods under bivariate conditions depend on the relationship between x and y which can be used to explain the influence of independent rainfall variables on estimated rainfall depths for example in this paper conditions of d 24 h and d 72 h result in a 28 46 uncertainty in r from 10 to 100 yr return periods while m 0 3 and m 0 5 result in a 20 30 uncertainty in i for 10 to 100 yr return periods thus the uncertainty due to the ignored connections between two variables in rfa is quantified the results in this paper can be influenced by the accuracy and resolution of data and the size of the study area figs s1 s7 in the supplemental file despite the relatively coarse scale imerg data available for this study our results still shed light on the importance of accurate representations of rainfall spatiotemporal characterization in obtaining idfs in urban areas the uncertainty caused by the spatiotemporal resolution of input data should be examined in future work furthermore a new procedure of resampling in the sst copula could be explored for instance by evaluating the storm severity using different storm characteristics e g r d i and m and selecting the storms for the catalog the framework of this paper could be extended to flood frequency analysis akin e g to brunner et al 2016 for instance if variable x represents rainfall depth r and y represents rainfall clustering level in space m one potential rainfall flood relationship is hypothesized in fig 12 when heavy rainfall is clustered in a certain area quadrant i the flood events will have a high peak discharge a large flood volume and even an early peak time however when heavy rainfall is dispersed throughout the watershed quadrant ii the flood event can have a bigger volume a lower peak discharge and a later peak time therefore when both rainfall volume and spatial pattern are of interest different combinations of two dimensional rainfall features are possible which result in different flood responses and design variables 4 2 effect of sample size marginal distribution and copula function since there are many moving parts to this rfa approach several sources of uncertainty regarding idfs results merit discussion these include sample size and the choice of marginal distribution and copula function first we consider sample size effects taking r d pairs as an example n 50 100 200 and 500 synthetic years are generated from the same storm catalog as the sample size goes from 50 to 500 r d pairs remain highly upper tail dependent and the gumbel copula outperforms others in all cases in fig 13 a b larger sample sizes result in a conditional larger return period at a certain r value and this difference is more pronounced when d goes from 12 to 72 h there is little influence of sample size on joint return periods both tand and tor from n 50 to 500 in fig 13c d especially for n 200 and n 500 overall the large sample size allowed by the sst copula method significantly reduces uncertainties for copula based bivariate frequency analysis next we examine the effects of marginal distributions and copula function selection copula functions affect the upper tail and lower tail idf results and this influence varies with return period and with d in the r d case fig 14 a c d the influence of marginal distributions on idfs is weaker fig 14b e f it should be noted that the effect of marginal distributions coupled with different copula functions on idf results is quite complex a deeper review of tail behavior and its influence is suggested 5 summary and conclusions this paper presents an approach for bivariate rainfall frequency analysis rfa in urban watersheds that couples copula theory with stochastic storm transposition sst the framework is applied in shanghai china and focuses on rainfall depth r duration d intensity i and degree of rainfall spatial organization m referred to in this study as clustering the main conclusions of the study are 1 extreme storms are multi dimensional with complex dependency among their features significant positive dependencies were found between rainfall accumulation duration and rainfall intensity duration while negative dependencies were found between rainfall duration clustering and rainfall duration intensity 2 the sst copula model provides a framework for bivariate rfa at regional scales the proposed framework highlights two advantages 1 the spatiotemporal characteristics of storms are retained and conditional scenarios can be obtained to describe the spatial distribution of rainfall return periods from a bivariate perspective 2 repeated sampling is allowed in the sst procedure based on a storm catalog increases the effective sample size and reduces the uncertainty in frequency analysis 3 rainfall spatial heterogeneity produces uncertainties both in idf estimates and spatial rainfall distribution the different rainfall clustering conditions result in a 4 7 uncertainty for idf estimates the highly clustered storms are found to play a leading role in the spatial distribution of rainfall return periods and the share of rainfall spatial organization levels with m 0 6 that contribute to the univariate based rainfall estimates is 30 the sst copula framework in cases with relatively short gridded precipitation records 21 years in this study provides a flexible approach to effectively lengthen the rainfall series in bivariate rfa the output provides spatial storm scenarios for scenario based analyses of rainfall and floods and joint return periods could prove useful for flood resilience planning in future work coupling a flood model with each stochastic copula sample could be a meaningful way to interpret the joint probabilities involved in flood estimation credit authorship contribution statement qi zhuang conceptualization methodology visualization formal analysis writing original draft zhengzheng zhou conceptualization methodology software validation writing review editing shuguang liu supervision writing review editing daniel b wright methodology software writing review editing josé tavares araruna júnior supervision writing review editing aleksei n makhinov writing review editing aleksandra f makhinova writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement samples and data the authors declare no conflict of interest the funders had no role in the design of the study nor the interpretation of data or the writing of the manuscript this research was funded by the national natural science foundation of china 51909191 51961145106 52111530045 the authors would like to acknowledge the helpful comments of all reviewers without which the quality of the paper could not be improved the dataset of global precipitation measurement gpm used in this paper can be downloaded from https gpm nasa gov data directory appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 128648 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
