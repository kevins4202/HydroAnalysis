index,text
26470,the fields of life cycle assessment lca and integrated assessment ia modelling today have similar interests in assessing macro level transformation pathways with a broad view of environmental concerns prevailing ia models lack a life cycle perspective while lca has traditionally been static and micro oriented we develop a general method for deriving coefficients from detailed bottom up lca suitable for application in ia models thus allowing ia analysts to explore the life cycle impacts of technology and scenario alternatives the method decomposes lca coefficients into life cycle phases and energy carrier use by industries thus facilitating attribution of life cycle effects to appropriate years and consistent and comprehensive use of ia model specific scenario data when the lca coefficients are applied in ia scenario modelling we demonstrate the application of the method for global electricity supply to 2050 and provide numerical results as supplementary material for future use by ia analysts keywords life cycle assessment lca integrated assessment model iam themis climate change mitigation transformation pathways sustainability assessment 1 introduction 1 1 motivation and aims curbing greenhouse gas ghg emissions is a necessary requirement for achieving the international policy objectives of avoiding dangerous interferences with the climate system unfccc 1992 life cycle assessment lca and integrated assessment models iams are two complementary tools for assessing the ghg emission reduction potential of technologies edenhofer et al 2014 hertwich et al 2016a lca offers a systematic bottom up framework and process for attributing environmental impacts that occur in complex international supply chains to one product lca strives to achieve extensive coverage of supply chain activities associated with production use and waste handling of products it also strives to achieve extensive coverage of types of environmental impacts including toxic effects on humans and ecosystems and natural resource use or depletion hauschild et al 2013 hauschild and huijbregts 2015 hellweg and milà i canals 2014 iams are widely used to explore potential strategies to mitigate future climate change krey 2014 o neill et al 2014 schwanitz 2013 1 1 in this work by iams we refer broadly to models that are used to explore transformation pathways and to evaluate climate mitigation policies clarke et al 2014 riahi et al 2012 as distinct from aggregated models that monetize climate change impacts in order to perform cost benefit analysis of climate policy aim gcam image message and remind are examples of models that fall into the former category edmonds et al 2012 in addition we are concerned with models that carry explicit representations of individual energy technologies as distinct from models lacking technology level detail under the principal assumption that different combinations of primary energy resources and energy transfers and transformations can provide substitutable energy services the models select and substitute resource and technology alternatives so that costs are minimized or welfare is maximized subject to constraints e g on emissions allowances resource availability or technology availability important reports targeted to policy makers and the public devote significant attention to scenarios produced by iams edenhofer et al 2014 iea 2014 johansson et al 2012 existing lca literature is for the most part concerned with assessing environmental impacts associated with one small reference unit e g 1 kwh of electricity in a static framework while such assessments can offer useful insights they carry no notion of absolute magnitude or timing of effects at regional or global levels hence they provide limited basis for assessing long term technology transformation pathways especially under scenarios of rapid and large scale deployment of new technologies arvesen and hertwich 2011 dale and benson 2013 also while any lca attributes effects occurring in various supply chains to a specific product most lcas do not capture other types of consequences of products that one may infer considering broader economic or policy contexts such as indirect land use change emissions induced by bioenergy products 2 2 so called consequential lca clca is an exception zamagni et al 2012 clca is much less frequently applied than conventional sometimes termed attributional lca but a significant number of clca studies do exist perhaps in particular clca is used in literature to study bioenergy creutzig et al 2015 iams on the other hand put their focus on representing the dynamics that shape natural and human systems over long time scales and under large scale changes in the economic setting however iams have more narrow boundaries in terms of environmental impacts and do not represent life cycle effects of products or represent such effects only partially and or only implicitly via interactions between energy system and macro economy modules pauliuk et al 2017 we see two principal ways in which lca can be useful for ia modelling one is to integrate lca results in ia modelling so that indirect emissions of technology and scenario alternatives can be explored and potentially taken into account in the decision making routines of the iams technology selection in state of the art iams typically considers some types of indirect emissions such as methane leakages from fossil fuel production and land use change related emissions from biomass production while not considering many other indirect emissions e g emissions from producing metals for power plants more fully considering indirect emissions of technology alternatives can yield more consistent evaluations and thus potentially affect optimal technology selection or overall effectiveness of mitigation strategies in iams the relative importance of indirect emissions may increase over time and increasingly stringent emission reduction targets as technologies with zero or low direct emissions e g electric vehicles fossil fuel combustion with carbon capture gradually replace those using fossil fuels the second way lca can be useful is to improve environmental impact assessment or broaden the range of environmental concerns addressed in iams most state of the art iams have an explicit description of non co2 greenhouse gas emissions and air pollution e g strefler et al 2014 gernaat et al 2015 rao et al 2017 and recently have also considered water demands e g mouratiadou et al 2016 but lack many other crucial environmental impact dimensions lca routinely supports assessment of the effects of hundreds of pollutants resource flows and land incorporating environmental mechanisms e g toxic effects on ecosystems or humans not currently addressed by iams masanet et al 2013 when we refer to impact indicator results in this article we refer broadly to any indices of environmental impacts or natural resource requirements computed using impact assessment methods from lca frischknecht et al 2016 the aims of this article are the following i to develop a general method for deriving energy and impact indicator results from detailed bottom up lca such that the results are suitable for application by ia modellers ii to apply the method to calculate energy and impact indicator results for the global electricity system to 2050 for future use by ia practitioners the method allows for capturing technology variations and changes between geographical regions and over time it enables consistent use of iam specific scenario data e g emission factors lifetime load factors in combination with lca coefficients this is achieved mainly by a separate treatment of main life cycle stages with a unit conversion adapted to the stage and technology in question and by a decomposition of coefficients into individual energy carriers industries and energy service types ia modellers may combine the energy results derived from lca with iam specific emission factors so as to determine emissions related to combustion of energy fuels on a life cycle basis they may use the impact indicator results derived from lca to address types of impact other than those commonly associated with combustion such as toxic effects of pollution loads 1 2 existing literature a few attempts have been made in literature to combine lca and iam perspectives for the purpose of long term and large scale assessment a notable study by daly et al 2015 couples a national united kingdom energy system optimization model with a multiregional economic input output model in order to investigate the significance of indirect emissions for national energy system transformations explicitly accounting for domestic and nondomestic indirect emissions associated with energy supply their results indicate that domestic indirect emissions have little significance while nondomestic indirect emissions appear significant and would if included in an ambitious domestic emission reduction target and in absence of commensurate non domestic mitigation double the marginal abatement cost of meeting the target the study assumes non domestic emission intensities follow baseline trends i e that no climate policies are implemented outside the united kingdom an accompanying study by the same authors identifies that the optimization model selects increased electrification and use of nuclear power as a cost optimal strategy to mitigate the nondomestic indirect emissions scott et al 2016 dandres et al 2011 use a computable general equilibrium model together with lca in order to address economy wide consequences of bioenergy policy the authors report the finding that bioenergy policy increases environmental impacts owing to effects of price changes while also underlining that more work is needed to evaluate the approach used the aforementioned studies rely on economic input output analysis daly et al 2015 scott et al 2016 or a mapping between economic input output sectors and detailed bottom up lca activities dandres et al 2011 to determine emission multipliers all studies rely on price information to convert between monetary and mass units another study implements generic lca type indicators derived from theoretical considerations in a system dynamics model dale et al 2012b a general advantage of approaches that do not require detailed technology information is that owing to relatively easy data compilation extensive coverage of energy technology and fuel types can be achieved as indeed is the case in the above cited works another advantage of employing multiregional input output mrio analysis daly et al 2015 scott et al 2016 is that international trade and geographical differences in production are generally better captured in mrio than in lca the current work adopts a different strategy making use of physical rather than monetary accounting of product systems and a bottom up rather than top down calculation technique for determining indirect energy use and environmental impact coefficients the chief motivation for adopting this approach when analysing current and prospective technologies is to strive for high precision projections avoiding high uncertainty associated with aggregation in mrio and conversion between monetary and mass units in addition owing to greater coverage of pollution types bottom up lca facilitates meaningful assessment of a larger portfolio of impact categories including effects of toxic pollution loads to soil and water than contemporary mrio it also can account more explicitly for the effects of climate policies on the carbon intensity of the underlying energy system another category of studies perform lca of scenario results emanating from iam or energy system model runs arvesen and hertwich 2011 arvesen et al 2014 bergesen et al 2015 berrill et al 2016 gibon et al 2017 hertwich et al 2015 portugal pereira et al 2016 singh et al 2012 volkart et al 2017 with or without consideration of future technological changes and portraying snapshots of impacts in a given future year or evolution of impacts over time with the exception of volkart et al 2017 these studies mainly focus on assessment results as opposed to describing procedures or discussing methodological aspects and they do not address the topic of deriving lca based coefficients for application in iams to our knowledge no attempts have been made in the existing literature to develop formal procedures for how lca where activities are described bottom up and in physical terms can be incorporated into iam while ensuring consistent use of iam specific data e g emission factors and attribution of life cycle effects to appropriate years and avoiding the uncertainty associated with conversions between mass and monetary units 2 overview of study as stated in the introduction section this study has a twofold aim to develop a general method for deriving lca coefficients for use in iams and to demonstrate the application of the method for the case of future global electricity supply before presenting the method in section 3 and results for the case study of electricity in section 4 the current section provides an overview of the study in terms of data sources and modelling framework used and connections to other related studies in the following subsection 2 1 we explain the selection of electricity supply as a case study and provide an account of main assumptions and data sources we then in subsection 2 2 introduce the themis lca analytic model framework used in this work subsection 3 2 further details the study design and clarifies connections to related studies 2 1 case description electricity supply in 2010 one quarter of global ghg emissions was caused by fossil fuel combustion in power plants edenhofer et al 2014 electricity generation is important for climate change mitigation luderer et al 2014 rogelj et al 2015 wiebe 2016 williams et al 2012 because it is relatively easy to decarbonize compared to e g transport as many low carbon energy sources by their nature generate electricity e g wind nuclear and solar power from an lca point of view electricity generation makes an interesting case study because various different types of power plants while serving the same function operate by very different mechanisms and exhibit very different supply chains we adopt multiregional and prospective life cycle inventory data for photovoltaic power concentrating solar power hydropower wind power coal power and natural gas power from hertwich et al 2015 with some incremental improvements to the data the data incorporates regional variations and future technological improvements of electricity production through changes in basic parameters such as photovoltaic module efficiency fossil fuel power plant efficiency insolation and wind load factors as well as through shifts towards higher performance technology generations e g from crystalline silicon photovoltaic to thin film photovoltaic nuclear power and biomass power are not addressed in hertwich et al 2015 in the current work we adopt life cycle inventory data from the ecoinvent lca database to cover nuclear power dones 2007 ecoinvent 2010 assuming that these data are representative for all regions and over time in addition we establish life cycle inventories for electricity from biomass modelling two different biomass feedstocks or sources one biomass feedstock is boreal forest residue modelled using data from singh et al 2014 the other feedstock is lignocellulosic second generation bioenergy crops data for modelling this feedstock are obtained largely from scenario results produced by the global land use model magpie bodirsky et al 2012 klein et al 2014 lotze campen et al 2008 the magpie results describe crop yields land requirements carbon dioxide emissions from land use irrigation water demand nitrogen and phosphorus fertilizer use and nitrous oxide emissions related to fertilization across world regions and years under nine policy scenarios representing different assumptions about carbon pricing the type of bioenergy crops available and whether irrigation is allowed or not further the magpie results are supplemented by data gathered or derived from other sources notably nemecek and kägi 2007 njakou djomo et al 2013 and njakou djomo et al 2015 a full account of data and assumptions used to model bioenergy crops is provided in the supplementary material table 1 lists the electricity generation technology types modelled using lca and their classification into aggregated technology categories also shown are assumed market shares hertwich et al 2015 for detailed technology types e g ground installed polycrystalline silicon solar photovoltaics that we use to aggregate results into main technology categories e g solar photovoltaics the market shares are not a necessary element of our general method to derive lca coefficients for use in ia modelling but are introduced here for our case study of electricity because the aggregation into main technology types may be practical for results interpretation and application in ia modelling the assumed market shares are constant across regions modelled using lca a special note is required for hydro as is evident from table 1 two hydropower facilities are modelled one of which is situated in a remote location and the other not the life cycle inventory data for both of these cases are based on two planned projects in chile owing to comparatively large transport and infrastructure requirements for the remotely situated plant life cycle impacts for this plant are up to one order of magnitude higher than that of the other non remote plant hertwich et al 2015 2016b ideally a larger population of power plants should serve as a basis of the modelling but such assessments are currently not available as a result of this big difference in impacts between the two cases aggregated results for hydropower are highly sensitive to the market shares assigned to each case in the current study all the life cycle inventory data sets are incorporated into the multi regional and prospective model framework themis that will be described in subsection 2 2 the impact indicator categories considered in the case study of electricity supply are the recipe version 1 08 categories freshwater ecotoxicity freshwater eutrophication human toxicity ionizing radiation land occupation marine eutrophication and mineral resource depletion goedkoop et al 2014 recipe 2012 3 3 recipe is a prominent and widely applied method for life cycle impact assessment as well as four categories representing requirements for individual materials namely aluminium cement copper and iron singh et al 2015 climate change impacts and impacts related to local air pollution are excluded from this list as such impacts are preferably addressed by ia analysts by utilizing lca energy coefficients in combination with iam specific emission factors for fuel combustion 2 2 lca modelling framework themis technology hybridized environmental economic model with integrated scenarios is a multi regional and prospective lca modelling framework themis was formally introduced and described by gibon et al 2015 published applications of themis include hertwich et al 2015 bergesen et al 2015 and berrill et al 2016 in this study we employ themis to produce results for each of the power generation technologies listed in table 1 and for three years 2010 2030 2050 two policy scenarios baseline scenario and the blue map climate change mitigation scenario of iea 2010 and nine world regions following the region classification of iea 2010 the current version of themis combines life cycle descriptions of individual power generation technologies developed by hertwich et al 2015 a process based life cycle assessment database ecoinvent 2010 4 4 ecoinvent is a database providing life cycle inventory data sets for a large number of processes for example minerals extraction and materials production and adapts the data so as to represent important regional differences and changes over time towards 2050 the adaptations include changing the electricity mix depending on region and year following either the baseline or climate change mitigation scenario furthermore themis takes into account scenarios for future improvements in performance parameters for selected industrial processes i e aluminium copper nickel iron and steel metallurgical grade silicon flat glass zinc and clinker production for example in themis steel production in 2050 benefits from lower hard coal coke input to blast furnace reduction per unit of iron as well as lower energy fuel requirements cleaner electricity in particular when the climate change mitigation scenario is analysed and reduced emission intensities compared with steel production in 2010 for a full description of the treatment of technological change in themis see the supplementary material to gibon et al 2015 one limitation of the current version of themis is that it does not include any changes in the characteristics of transport activities over time potential future decreases due to technological innovations or increases due to a shift towards less accessible or lower quality resources in the energy required to extract energy fuels hall et al 2014 or metals norgate and haque 2010 norgate et al 2014 from the ground are also not considered in general selected technology representations are adapted to different years in themis 2 3 study design and links to other studies fig 1 illustrates connections between elements data procedures results of the current study as well as other related studies also included in the figure are references to relevant sections in the present article the figure reiterates the information from subsections 2 1 and 2 2 that life cycle inventory data sets for a suite of electricity supply options were compiled for hertwich et al 2015 and integrated into the multi regional and prospective lca model framework themis themis additionally takes into account future projected technological progress in selected industrial processes subsection 2 2 and gibon et al 2015 the current article presents a general method to derive lca coefficients for use in ia modelling section 3 and uses themis to apply the method for the case of electricity supply section 4 and supplementary material as the figure also indicates two related studies apply the derived lca coefficients in ia modelling pehl et al forthcoming integrate the lca energy coefficients in the remind iam in order to explore life cycle greenhouse gas emissions associated with future global electricity systems and to investigate the degree to which endogenizing life cycle emissions impact the computed optimal technology selection in the second related study luderer et al in preparation make use of both the lca energy and impact indicator results to compare climate mitigation strategies for the power sector in terms of their performance by a range of environmental impact and natural resource use criteria 3 method to derive lca coefficients this section presents the method for calculating and organizing results obtained from lca in such a way that the results can form a suitable interface with ia modelling as remarked in the introduction section the interface may be made up of two types of lca results energy results or impact indicator results the former option allows ia analysts to use iam specific emission factors for carbon dioxide and air pollutants to determine energy related emissions on a life cycle basis the latter option involves characterization and aggregation of different types of pollutants or natural resource use into a set of impact categories defined in the lca and may be particularly useful for ia analysts seeking to address types of impacts not already addressed in the iam e g impacts caused by releases of toxic or eutrophying substances to water in connection with mining or agricultural activities the computations of lca energy and impact indicator results both involve a separate treatment of life cycle stages as will be described in subsection 3 2 additional procedures are described in subsection 3 3 for the computation of lca energy results to identify individual energy carriers industries and energy services hence allowing ia analysts to take advantage of available iam specific emission factors it should be noted that while the lca energy results can be used to address greenhouse gas emissions and air pollution associated with combustion industrial process based emissions müller et al 2013 methane leakages from fossil fuel supply brandt et al 2014 gernaat et al 2015 land use related emissions bodirsky et al 2012 popp et al 2013 methane emissions from hydropower reservoirs hertwich 2013 sulphur hexafluoride leakages from electric equipment arvesen et al 2015 turconi et al 2014 and other non combustion emissions may constitute significant sources of greenhouse gas emissions or environmental impact some remarks on non combustion greenhouse gas emission sources and an explanation of how they are dealt with in the present work are offered in the supplementary material 3 1 mathematical representation and notation we follow the general terminology of lca jrc 2010 matthews et al 2015 and its mathematical representation in terms of input output algebra miller and blair 2009 lca requires a systematic mapping of activities associated with production use and waste handling of products any activity initially identified typically has both its own life cycle and its own supply chain raising the need to map a further set of activities again raising a need to map yet further activities the complete set of activities that through such causal chains can be linked to the product being studied together make up a product system further the activities targeted for special modelling attention or for which data have been established specifically for the current work comprise the foreground system the remaining activities make up the background system jrc 2010 wernet et al 2016 depending on the study background activities could include minerals extraction transport and manufacturing activities and more throughout section 3 we use subscripts to indicate that a variable is dependent on or defined for a specific dimension e g year region and superscripts to indicate a particular type of variable we use the subscripts t r τ s and p to denote technology under investigation i e in our case study one detailed power generation technology type shown in table 1 region year scenario and life cycle phase respectively vectors are denoted by lowercase boldface e g y t r τ s f d and matrices by uppercase boldface e g a τ s we denote the demand that is imposed on the system e g to deliver one unit of electricity from onshore wind power for a given technology region year and scenario by the column vector y t r τ s f d this demand vector has only one non zero entry the demand for the product being studied e g onshore wind power for a given technology region year and scenario is set to one and all others are set to zero so that the impacts of the one product can be isolated the superscript fd denotes final demand and is used to distinguish y t r τ s f d from y t r τ s p which we introduce next further the direct requirements matrix a τ s holds information on all interrelationships between the activities that make up a product system in a τ s the entry in row i and column j represents the direct input from activity i to activity j per unit of output j in the approach and exposition of this paper we assume that all modelled technologies i e in our case study of electricity the full set of technologies shown in table 1 are described in the matrix a τ s this is the reason why in our definition a τ s is not technology and region specific we let the total number of foreground processes covering all technologies and regions defined for year τ be n τ s f n τ s b be the total number of background processes and n τ s f b n τ s f n τ s b the combined foreground and background total we define the following sets t is the set consisting of all technologies r the set of regions τ the set of years s the set of scenarios and p the set of life cycle phases table 2 provides a list of key intermediate and final calculated variables and numbers sets and indices used throughout section 3 3 2 separate treatment of life cycle phases it is a principle purpose of ia modelling to address impacts of future scenarios on large scales in order to best serve this purpose coefficients derived from lca for use in iams should distinguish the construction operation and end of life phases this is to ensure that ia users can attribute construction operation and end of life coefficients to appropriate years and combine them with iam specific data on technology performance e g emission factors and technology deployment e g new installed capacities operating capacities pertaining to the same years moreover separating the life cycle phases is necessary if one wants to capture basic transition dynamics stemming from the different timing of infrastructure and operational inputs which may be important during periods of rapid transformation arvesen and hertwich 2011 gonçalves da silva 2010 usubiaga et al 2017 this subsection describes a generic procedure for separating out individual life cycle phases in lca taking as a starting point a standard lca set up with a demand vector containing only one non zero element in addition and the procedure allows for construction phase effects to scale in proportion to installation size capacity and operation phase effects in proportion to utilization we assume that for technology t region r year τ and scenario s the demand that is imposed on the system e g to deliver one unit of electricity by a distinctive technological option is recorded in a demand vector with a single non zero entry y t r τ s f d already introduced in subsection 3 1 of size n τ s f b 1 we let y t r τ s p be an n τ s f b 1 vector representing the first round of activities in phase p after imposing the demand y t r τ s f d on the system in other words y t r τ s p contains any direct inputs for phase p to the demand being studied y t r τ s p may be calculated as shown in equation 1 based on y t r τ s f d the direct requirements matrix a τ s and a binary n τ s f b 1 correspondence vector b τ s p p h a s e assigning foreground processes to life cycle phase p in b τ s p p h a s e the entry in row j is 1 if foreground process j is associated with life cycle phase p and zero otherwise because background processes are used generically and cannot necessarily be unambiguously assigned to a life cycle phase rows in b τ s p p h a s e representing background processes should contain only zeros we assume that there are three life cycle phases n p 3 the construction phase the operation phase and the end of life phase 1 y t r τ s p φ t r τ s p a τ s y t r τ s f d ˆ b τ s p p h a s e t t r r τ τ s s p p here the circumflex ˆ represents diagonalization of a vector the multiplication factor φ t r τ s p a scalar is introduced for the purpose of unit conversion as will be explained at the end of this section the use of equation 1 presupposes that the data are organized in such a way that i there are no energy use or emissions directly associated with y t r τ s f d ii the first round of activities after imposing the demand y t r τ s f d on the system concerns processes defined in the foreground system only not the background system and iii all processes involved in first round activities can be unambiguously assigned to a life cycle phase the two latter requirements are achieved through appropriate definition of a τ s in the manner illustrated by fig 2 for the case study of electricity in the figure processes labelled process to deliver 1 kwh represent processes for which there can be a non zero entry in y t r τ s f d while immediate inputs to 1 kwh process indicate the processes that must be uniquely assigned using b τ s p p h a s e to either the construction c operation o or end of life e phases note that a τ s covers both foreground and background systems but because rows in b τ s p p h a s e representing background processes contain only zeros equation 1 does not involve any actual modelling for the background in equation 1 elements of the product a τ s y t r τ s f d ˆ b τ s p p h a s e will be measured in relation to the single measurement unit used for the demand specified in y t r τ s f d an optional multiplication by a unit conversion factor φ t r τ s p is introduced in equation 1 to make it possible to use different units for the construction operation and end of life phases respectively we anticipate that the value of φ t r τ s p can be determined based on information already contained in the lca foreground system data e g information about the lifetime efficiency and capacity factor of a thermal power station one application of φ t r τ s p can be to perform a unit conversion so that construction phase requirements are measured in relation to the size of installations and operation phase requirements in relation to the utilization of installations φ t r τ s p can also be seen as a means to avoid imposing lca specific assumptions on the ia modelling for example by measuring requirements of power plant construction in relation to nominal capacity as opposed to power generation influence of lca specific assumptions about power plant lifetime and capacity factor on results can be avoided table 3 summarizes our selection of measurement units in the case study of electricity supply a further discussion on the use of is offered in the supplementary material having established y t r τ s p it is straightforward to determine the total output vector x t r τ s p for a given technology t region r year τ and scenario s and life cycle phase p 2 x t r τ s p i a τ s 1 y t r τ s p t t r r τ τ s s p p where i is the identity matrix of appropriate order we now turn to the computation of lca impact indicator coefficients we let n i m p be the number of impact categories considered we let d t r τ s p i m p t o t be an n i m p 1 column vector containing total impact indicator scores for a given combination of the parameters t r τ s and p having determined x t r τ s p it is straightforward to establish the elements of d t r τ s p i m p t o t using standard lca procedure as expressed in equation 3 3 d t r τ s p i m p t o t c i m p f τ s x t r τ s p t t r r τ τ s s p p we let n s t r be the number of environmental load types defined in the system in themis n s t r 1613 in equation 3 f τ s is an n s t r n τ s f b matrix of environmental load intensities e g phosphate leaching to ground water from disposal of spoil from coal mining and c i m p an n i m p n s t r matrix of characterization factors e g representing the potency of phosphate released to ground water for eutrophication impacts recipe 2012 3 3 detailed treatment of energy use in addition to distinguishing the three main life cycle phases subsection 3 2 our method decomposes energy requirements into energy carrier use by industries and selected energy service types while the method is valid for an arbitrary number of energy carriers industries and energy service types we select default options and use them in our case study of electricity supply the selected energy carriers comprise liquid gaseous and solid fuels and electricity and the selected energy services are freight transport iron and steel production and cement production the selection of industries needs to correspond to the energy service types freight transport iron and steel and cement plus electricity as electricity is a secondary energy form one motivation for separating out key energy carriers industries and energy services is to avoid imposing lca specific assumptions on the ia modelling as far as possible by this we mean that electricity mixes transport and industry fuel mixes and fuel characteristics including the emission intensities of fuels should not be predetermined from the lca side rather the ia analyst should be given the opportunity to represent such mixes and characteristics consistently using iam specific representation of these processes by doing this one can achieve unprecedented coverage of technology change in future oriented analyses of life cycle impacts 5 5 consider for example that because the lca coefficients separate out solid fuels by industries one can capture the life cycle effects of biomass replacing coal in ia scenarios and because freight transport is separated out one can capture the effects of shifts to low carbon transport fuels e g biofuels hydrogen in ia scenarios as is demonstrated in the accompanying study by pehl et al forthcoming another motivation for separating out energy carriers by industries is that it may help to address potential problems of double counting when lca coefficients are introduced in iams 6 6 such double counting issues are discussed in daly et al 2015 and volkart et al 2017 in the following we first describe an approach for achieving sound treatment of energy flows when deriving lca energy coefficients for use in iams subsection 3 3 1 this is a prerequisite for the decompositions of energy requirements into energy carriers industries and energy service types which are described next subsections 3 3 2 and 3 3 3 3 3 1 consistent energy accounting the ecoinvent lca database and hence themis which relies extensively on ecoinvent does not support systematic energy accounting at the point of energy use the energy content of losses in fuel supply chains notably such losses can be methane leakages from natural gas extraction sites or pipelines or losses of coal during transport and storage is not easily identifiable and distinguishable from fuel burning furthermore heating value assumptions are not necessarily consistent across fossil fuel supply chains due to internal inconsistencies in energy statistics used as data input to describe different parts of fuel supply chains in ecoinvent arvesen and hertwich 2015 the established lca practice for measuring energy is to consistently track energy streams to the point of resource extraction from nature including energy losses along the chain linking energy carrier use and primary energy withdrawal from nature e g fugitive methane emissions loss in energy content of coal during transport and storage arvesen and hertwich 2015 frischknecht et al 2015 the resulting energy quantity is often referred to as cumulative energy demand consistency is ensured when using the cumulative energy demand method in ecoinvent to perform standard lca type calculations however consistency is not necessarily achieved in calculations involving breaking up supply chains into disaggregated segments in such cases a failure to properly handle heating value variations can lead to errors arvesen and hertwich 2015 in the context of deriving lca energy coefficients for use in iams it is also important to consider that state of the art iams explicitly account for leakages or losses of methane in fossil fuel production and supply hence such methane leaks should be excluded from the lca energy coefficients in a similar manner as energy loss in thermal electricity production should be excluded our method to derive lca energy coefficients resolves both these issues heating value variations and the need to exclude losses already represented in iams by adopting the cumulative energy demand accounting practice in a uniform manner when calculating quantities of combustible energy i e liquid gaseous and solid fuels 7 7 appendix a in arvesen and hertwich 2015 offers an example illustrating the basic procedure this is also the case when measuring flows representing direct energy use in industrial activities a further note of clarification is included in the supplementary material we refer to combustible energy flows determined in accordance with the cumulative energy demand method as characterized energy carriers denoted as cec for the sake of convenience we let electricity be included in the set of characterized energy carriers and express the set as c e c l i q u i d s g a s e s s o l i d s e l e c t r i c i t y n c e c 4 is the number of characterized energy carriers 3 3 2 energy carrier use by industries we let d t r τ s p c e c t o t be an n c e c 1 column vector containing total characterized energy carrier values for the set c e c an expression for determining d t r τ s p c e c t o t is given in equation 4 4 d t r τ s p c e c t o t c τ s c e c t o t x t r τ s p t t r r τ τ s s p p the analyst should define c τ s c e c t o t such that the values for the combustible energy carriers included in the set c e c are calculated in accordance with the cumulative energy demand method and that electricity requirements are captured as well electricity requirements may be calculated by a simple summation of appropriate entries in x t r τ s p while making sure that electricity represented at different voltage levels in the lca database is not double counted this can achieved through equation 4 and by defining c τ s c e c t o t appropriately we let i n d be the complete set of industries i n d e l e c t r i c i t y t r a n s p o r t i r o n s t e e l c e m e n t and n i n d 4 the number of industries for which we need to identify direct energy carrier use we define f b τ s e c as a subset of the set of all foreground and background processes which represents processes delivering energy carriers e g coal electricity and n τ s e c the number of processes included in f b τ s e c at a minimum f b τ s e c must include the processes delivering energy carriers to processes that are part of the set i n d activities by any additional processes included in f b τ s e c will be zeroed out in the calculations that follow we let a τ s e c be an n τ s e c n τ s f b matrix containing only the rows of a τ s corresponding to the set f b τ s e c next we let b τ s i n d be a binary n τ s f b n i n d correspondence matrix assigning foreground and background processes to the industry sectors included in i n d in b τ s i n d a non zero entry indicates that a process belongs to one of the selected industries rows representing processes that do not match with any of the selected industries contain only zeros finally we let e t r τ s p e c d i r be an n τ s e c n i n d matrix representing the direct use of n τ s e c energy carriers by n i n d industries the superscript dir denotes direct e t r τ s p e c d i r may be calculated according to equation 5 5 e t r τ s p e c d i r a τ s e c x t r τ s p ˆ b τ s i n d t t r r τ τ s s p p e t r τ s p e c d i r will typically represent a large number of energy flows individually e g various inputs of electricity of different geographical origin fuel oil burned in various machines or devices there is a need to classify these energy flows into the main energy carrier types comprising the set c e c and to characterize the combustible energy flows using the cumulative energy demand method in order to achieve consistent accounting cf subsection 3 3 1 this implies that entries representing non electricity energy carriers in e t r τ s p e c d i r need to be multiplied by appropriate factors to convert to cumulative energy demand equivalence in order to achieve this we introduce c τ s c e c d i r as an n c e c n τ s e c matrix collecting coefficients to convert non electricity entries in e t r τ s p e c d i r to cumulative energy demand equivalence as well as coefficients allowing for entries representing electricity to be summed together c τ s c e c d i r should be defined such that left multiplying e t r τ s p e c d i r by c τ s c e c d i r equation 6 yields an n c e c n i n d matrix d t r τ s p c e c d i r representing direct non electricity and electricity use in the selected industries 6 d t r τ s p c e c d i r c τ s c e c d i r e t r τ s p e c d i r t t r r τ τ s s p p the characterized energy carrier values in d t r τ s p c e c t o t and d t r τ s p e c d i r are partially overlapping as the direct energy use in the selected industries are accounted for in both variables we now subtract values in d t r τ s p c e c d i r from values in d t r τ s p c e c t o t to obtain residual energy requirements i e the energy use occurring in other industries than those comprising the set i n d as expressed in equation 7 d t r τ s p c e c r e s refers to an n c e c 1 column vector containing the residual energy requirement values 7 d t r τ s p c e c r e s d t r τ s p c e c t o t d t r τ s p e c d i r 1 t t r r τ τ s s p p where 1 is a n i n d 1 column vector of ones 3 3 3 energy service requirements we measure energy service requirements in terms of total output of the industries delivering the energy services in units of tonne kilometres for transport or tonnes for material production as different industries are represented in different ways in the lca database it is not possible to provide a general recipe for how to establish numbers on total industry outputs we establish transport requirements by simple summation of freight transport outputs including different types of road rail and water transport outputs represented in x t r τ s p life cycle accounting of material outputs is less simple and cannot generally be achieved by summation of entries in x t r τ s p this is because x t r τ s p defines outputs from various material processing steps that partially form linear chains of processes and partially looped systems i e output from one process becomes the input to another process in this study we employ the algorithm presented by singh et al 2015 to determine material requirements we let x t r τ s p i n d be an 1 n i n d row vector collecting all industry output levels here understood as analogous to energy service requirements for the industries represented by the set i n d a data set consisting of d t r τ s p e c r e s and x t r τ s p i n d together with iam specific energy intensity and emission intensity factors will contain sufficient information for ia analysts to determine life cycle emission estimates meanwhile iams differ in their resolution and not all iams resolve transport and material producing industries explicitly hence we provide energy multiplication factors for the industries represented by the set i n d as well based on lca model specific data ia analysts may choose to use these data in lieu of iam specific data we let d t r τ s p c e c d i r be an n τ s c e c n i n d matrix representing the use of n τ s c e c energy carriers by n i n d industries normalized to the total output levels of the respective industries d t r τ s p c e c d i r may be determined from equation 8 8 d t r τ s p c e c d i r d t r τ s p c e c d i r x t r τ s p i n d here the empty circle indicates division of all entries in column number j of d t r τ s p c e c d i r by entry number j in x t r τ s p i n d in the case study of electricity supply the numerical values in d t r τ s p c e c d i r are approximately the same irrespective of technology and phase for this reason and in order to simplify data exchange we compute median values across technologies and phases and let d r τ s c e c d i r m e d be an n τ s c e c n i n d matrix recording the median values 4 lca coefficient results for illustration table 4 shows as an illustrative example lca energy and impact indicator results obtained for solar photovoltaic electricity for year 2010 2030 and 2050 results for china are shown as an example the table also clarifies how the numerical results relate to variables defined in the exposition of the approach the rationale for including table 4 is not to present quantitative results per se but rather the table is included for the purposes of illustration for the same purposes figs 3 and 4 offer illustrative energy results the complete set of energy and impact indicator results is available as electronic supplementary material and is utilized in the related studies pehl et al forthcoming and luderer et al in preparation fig 3 displays life cycle indirect energy requirements for a series of power generation options as iams already cover all direct energy use i e energy fuel combustion occurring at the power plants being studied and our current aim is to provide coefficientsfor indirect energy use direct energy use is not treated in our method and not included in fig 3 8 8 it may also be noted that besides application iniams the indirect energy use of supplying energy has relevance for discussionson the importance of energy for economic growth ayres and voudouris 2014 carbajales dale et al 2014 hall et al 2014 results for europe and year 2010 are shown here as an example for the sake of simplicity and because contributions from the end of life phase are uniformly small 2 of totals in this graphical representation the construction and end of life phases are aggregated into one single category for similar reasons energy use occurring in iron and steel production and in cement production are aggregated in the figure another factor to note is that the results shown in fig 3 are produced using capacity factor and lifetime assumptions in themis however these assumptions will effectively be replaced by iam specific assumptions when ia analysts utilize the numerical results as they are presented in the electronic supplement it is evident from fig 3 that fossil and biomass fuel based power generation options generally exhibit the highest total indirect energy requirements this is in different ways for the different options attributable to extraction or collection processing and distribution of fuel energy sources and carriers all power plants utilizing carbon capture and storage ccs have lower efficiencies and additional process inputs compared to their non ccs counterparts which lead to higher indirect energy per unit of electricity output for ccs cases among non biomass renewable alternatives hydropower and solar photovoltaic power show the highest total indirect energy requirements fig 3 for hydro the comparatively large energy requirements are a result of considerable transport requirements for one of the two hydro power facilities modelled namely the facility situated in a remote area as for solar photovoltaic power energy intensive material processing and manufacturing activities in particular connected to solar grade silicon production give rise to considerable indirect energy requirements while fig 3 only shows results for the year 2010 results for 2030 and 2050 reflect substantial technological improvements for solar photovoltaic power as is illustrated by fig 4 and discussed later in this subsection a more detailed discussion of fig 3 including comparisons with results in literature raugei and leccisi 2016 warner and heath 2012 is presented in the supplementary material while fig 3 displays results for year 2010 only we also produce results for the years 2030 and 2050 fig 4 details prospective indirect energy requirements results for solar photovoltaic pv electricity showing results for both the aggregate mix of pv technology types leftmost column in each panel and for each individual type the six rightmost columns in each panel solar pv electricity is chosen here as an example because it is a technology for which considerable future technological improvements are anticipated as opposed to for example hydropower which is based on relatively mature technology as is evident from fig 4 thin film pv here represented by cadmium telluride and copper indium gallium selenide technologies exhibit much lower indirect energy requirements than conventional poly crystalline silicon pv moreover the indirect requirements of the thin film technologies decline noticeably over time mainly owing to projected rises in conversion efficiencies 9 9 a related discussion is available in bergesen et al 2014 in our results the combination of i a shift away from polycrystalline silicon and towards thin film technologies cf table 1 and ii thin film technologies becoming more efficient over time entails a reduction in the energy requirements of the average pv electricity mix of 70 from 2010 to 2050 electricity is an important energy carrier in relative terms for pv compare the relative importance of electricity for pv versus other power generation options evident from fig 3 which implies further reductions in the life cycle greenhouse gas emissions of pv in scenarios where electricity becomes cleaner 5 final remarks we believe that potentials exist for the iam and lca fields to interact in beneficial ways the iam community has a strong tradition in analysing transformation pathways on the macro level while for lca which traditionally has been micro and static minded this is an emerging research interest the lca community has decades of experience in developing formal procedures for assessing impact types as diverse as among others air pollution and toxic contamination of soil and water while ia analysts in recent years have made major strides in incorporating various air pollutants as well as aspects of land use and water demand in their models the life cycle perspective is unique for lca but lca lacks the optimization perspective of iam in this article we present a novel method for deriving lca based coefficients suitable for application in iams the method decomposes lca coefficients into life cycle phases and energy carrier use by industries thus facilitating attribution of life cycle effects to appropriate years and consistent and comprehensive use of ia model specific scenario data e g emission factors lifetime and utilization rates of equipment when the lca coefficients are applied in ia scenario modelling the method is flexible with respect to possible use i e it can be applied to study any kind of product and resolution levels of input data i e the life cycle inventory data can have any degree of resolution and output data i e the final lca coefficients can represent any number of energy carriers or industries separately the method is devised for lca analytic frameworks where activities are described bottom up and in physical terms as opposed to multiregional input output mrio frameworks as employed in other work daly et al 2015 scott et al 2016 bottom up lca and mrio analysis both have their merits and demerits subsection 1 2 and we anticipate that both techniques will be used in future research addressing the role of life cycle effects in climate change mitigation scenarios in the version of themis used to derive lca coefficients for electricity supply scenario data inputs to themis itself come from exogenous sources as described in gibon et al 2015 a possible future improvement when themis is used in conjunction with an iam however would be to obtain scenario data inputs to themis specifically from the iam in question thus enhancing harmonization of scenario data across the lca and iam modelling we regard the method presented in this article as a generally applicable and useful method to derive lca coefficients for use in ia modelling when core structures and data organization principles in lca and iam are given the energy accounting based on cumulative energy demand subsection 3 3 1 may usefully be replaced by a simpler procedure if lca databases adopt a more practical and consistent inventory of secondary and final energy i e an inventory distinguishing supply chain energy losses and energy use based on consistent heating value assumptions in the future parts of the method may be integrated into new and more advanced methods or be replaced by them for example if iams should be re structured to consider indirect energy use and emissions in a systematic fashion and with internal consistency strategies and priorities for taking into account life cycle effects in evaluations of vast scale transformation pathways need to be evaluated continuously considering the moving frontiers of lca and iam research and available evidence on the importance of life cycle effects in the context of climate change mitigation and sustainability assessment as well as practical concerns such as the need to limit model complexity with exceptions daly et al 2015 pehl et al forthcoming scott et al 2016 to date it remains largely unexplored whether or under what circumstances the types of causality relationships that form the heart of lca e g wind turbines require steel steel producers require fossil fuels and fossil fuel use causes emissions can have significant influences on optimized global energy and climate mitigation strategies arvesen et al 2011 dale et al 2012a finally it is worth noting that this article is written largely from the standpoint of lca and to a much lesser degree from the standpoint of iam accompanying articles currently in preparation address this imbalance by applying lca coefficients for electricity supply in integrated assessment luderer et al in preparation pehl et al forthcoming acknowledgments we thank thomas gibon for collaboration and assistance with themis topics bhawna singh for providing us with the raw data for her work on bioelectricity and evert bouman for help with calculating life cycle material requirements we thank the anonymous reviewers for their particularly thorough evaluations and useful comments this research received funding from the european union s seventh programme fp7 2007 2013 under grant agreement number 308329 advance arvesen additionally acknowledges support from the research council of norway through the centre for sustainable energy studies grant 209697 bodirsky received funding from the european union s horizon 2020 research and innovation programme under grant agreement number 689150 sim4nexus appendix a supplementary data the following are the supplementary data related to this article supplementary document supplementary document supplementary excel file supplementary excel file appendix a supplementary data supplementary data related to this article can be found at https doi org 10 1016 j envsoft 2017 09 010 
26470,the fields of life cycle assessment lca and integrated assessment ia modelling today have similar interests in assessing macro level transformation pathways with a broad view of environmental concerns prevailing ia models lack a life cycle perspective while lca has traditionally been static and micro oriented we develop a general method for deriving coefficients from detailed bottom up lca suitable for application in ia models thus allowing ia analysts to explore the life cycle impacts of technology and scenario alternatives the method decomposes lca coefficients into life cycle phases and energy carrier use by industries thus facilitating attribution of life cycle effects to appropriate years and consistent and comprehensive use of ia model specific scenario data when the lca coefficients are applied in ia scenario modelling we demonstrate the application of the method for global electricity supply to 2050 and provide numerical results as supplementary material for future use by ia analysts keywords life cycle assessment lca integrated assessment model iam themis climate change mitigation transformation pathways sustainability assessment 1 introduction 1 1 motivation and aims curbing greenhouse gas ghg emissions is a necessary requirement for achieving the international policy objectives of avoiding dangerous interferences with the climate system unfccc 1992 life cycle assessment lca and integrated assessment models iams are two complementary tools for assessing the ghg emission reduction potential of technologies edenhofer et al 2014 hertwich et al 2016a lca offers a systematic bottom up framework and process for attributing environmental impacts that occur in complex international supply chains to one product lca strives to achieve extensive coverage of supply chain activities associated with production use and waste handling of products it also strives to achieve extensive coverage of types of environmental impacts including toxic effects on humans and ecosystems and natural resource use or depletion hauschild et al 2013 hauschild and huijbregts 2015 hellweg and milà i canals 2014 iams are widely used to explore potential strategies to mitigate future climate change krey 2014 o neill et al 2014 schwanitz 2013 1 1 in this work by iams we refer broadly to models that are used to explore transformation pathways and to evaluate climate mitigation policies clarke et al 2014 riahi et al 2012 as distinct from aggregated models that monetize climate change impacts in order to perform cost benefit analysis of climate policy aim gcam image message and remind are examples of models that fall into the former category edmonds et al 2012 in addition we are concerned with models that carry explicit representations of individual energy technologies as distinct from models lacking technology level detail under the principal assumption that different combinations of primary energy resources and energy transfers and transformations can provide substitutable energy services the models select and substitute resource and technology alternatives so that costs are minimized or welfare is maximized subject to constraints e g on emissions allowances resource availability or technology availability important reports targeted to policy makers and the public devote significant attention to scenarios produced by iams edenhofer et al 2014 iea 2014 johansson et al 2012 existing lca literature is for the most part concerned with assessing environmental impacts associated with one small reference unit e g 1 kwh of electricity in a static framework while such assessments can offer useful insights they carry no notion of absolute magnitude or timing of effects at regional or global levels hence they provide limited basis for assessing long term technology transformation pathways especially under scenarios of rapid and large scale deployment of new technologies arvesen and hertwich 2011 dale and benson 2013 also while any lca attributes effects occurring in various supply chains to a specific product most lcas do not capture other types of consequences of products that one may infer considering broader economic or policy contexts such as indirect land use change emissions induced by bioenergy products 2 2 so called consequential lca clca is an exception zamagni et al 2012 clca is much less frequently applied than conventional sometimes termed attributional lca but a significant number of clca studies do exist perhaps in particular clca is used in literature to study bioenergy creutzig et al 2015 iams on the other hand put their focus on representing the dynamics that shape natural and human systems over long time scales and under large scale changes in the economic setting however iams have more narrow boundaries in terms of environmental impacts and do not represent life cycle effects of products or represent such effects only partially and or only implicitly via interactions between energy system and macro economy modules pauliuk et al 2017 we see two principal ways in which lca can be useful for ia modelling one is to integrate lca results in ia modelling so that indirect emissions of technology and scenario alternatives can be explored and potentially taken into account in the decision making routines of the iams technology selection in state of the art iams typically considers some types of indirect emissions such as methane leakages from fossil fuel production and land use change related emissions from biomass production while not considering many other indirect emissions e g emissions from producing metals for power plants more fully considering indirect emissions of technology alternatives can yield more consistent evaluations and thus potentially affect optimal technology selection or overall effectiveness of mitigation strategies in iams the relative importance of indirect emissions may increase over time and increasingly stringent emission reduction targets as technologies with zero or low direct emissions e g electric vehicles fossil fuel combustion with carbon capture gradually replace those using fossil fuels the second way lca can be useful is to improve environmental impact assessment or broaden the range of environmental concerns addressed in iams most state of the art iams have an explicit description of non co2 greenhouse gas emissions and air pollution e g strefler et al 2014 gernaat et al 2015 rao et al 2017 and recently have also considered water demands e g mouratiadou et al 2016 but lack many other crucial environmental impact dimensions lca routinely supports assessment of the effects of hundreds of pollutants resource flows and land incorporating environmental mechanisms e g toxic effects on ecosystems or humans not currently addressed by iams masanet et al 2013 when we refer to impact indicator results in this article we refer broadly to any indices of environmental impacts or natural resource requirements computed using impact assessment methods from lca frischknecht et al 2016 the aims of this article are the following i to develop a general method for deriving energy and impact indicator results from detailed bottom up lca such that the results are suitable for application by ia modellers ii to apply the method to calculate energy and impact indicator results for the global electricity system to 2050 for future use by ia practitioners the method allows for capturing technology variations and changes between geographical regions and over time it enables consistent use of iam specific scenario data e g emission factors lifetime load factors in combination with lca coefficients this is achieved mainly by a separate treatment of main life cycle stages with a unit conversion adapted to the stage and technology in question and by a decomposition of coefficients into individual energy carriers industries and energy service types ia modellers may combine the energy results derived from lca with iam specific emission factors so as to determine emissions related to combustion of energy fuels on a life cycle basis they may use the impact indicator results derived from lca to address types of impact other than those commonly associated with combustion such as toxic effects of pollution loads 1 2 existing literature a few attempts have been made in literature to combine lca and iam perspectives for the purpose of long term and large scale assessment a notable study by daly et al 2015 couples a national united kingdom energy system optimization model with a multiregional economic input output model in order to investigate the significance of indirect emissions for national energy system transformations explicitly accounting for domestic and nondomestic indirect emissions associated with energy supply their results indicate that domestic indirect emissions have little significance while nondomestic indirect emissions appear significant and would if included in an ambitious domestic emission reduction target and in absence of commensurate non domestic mitigation double the marginal abatement cost of meeting the target the study assumes non domestic emission intensities follow baseline trends i e that no climate policies are implemented outside the united kingdom an accompanying study by the same authors identifies that the optimization model selects increased electrification and use of nuclear power as a cost optimal strategy to mitigate the nondomestic indirect emissions scott et al 2016 dandres et al 2011 use a computable general equilibrium model together with lca in order to address economy wide consequences of bioenergy policy the authors report the finding that bioenergy policy increases environmental impacts owing to effects of price changes while also underlining that more work is needed to evaluate the approach used the aforementioned studies rely on economic input output analysis daly et al 2015 scott et al 2016 or a mapping between economic input output sectors and detailed bottom up lca activities dandres et al 2011 to determine emission multipliers all studies rely on price information to convert between monetary and mass units another study implements generic lca type indicators derived from theoretical considerations in a system dynamics model dale et al 2012b a general advantage of approaches that do not require detailed technology information is that owing to relatively easy data compilation extensive coverage of energy technology and fuel types can be achieved as indeed is the case in the above cited works another advantage of employing multiregional input output mrio analysis daly et al 2015 scott et al 2016 is that international trade and geographical differences in production are generally better captured in mrio than in lca the current work adopts a different strategy making use of physical rather than monetary accounting of product systems and a bottom up rather than top down calculation technique for determining indirect energy use and environmental impact coefficients the chief motivation for adopting this approach when analysing current and prospective technologies is to strive for high precision projections avoiding high uncertainty associated with aggregation in mrio and conversion between monetary and mass units in addition owing to greater coverage of pollution types bottom up lca facilitates meaningful assessment of a larger portfolio of impact categories including effects of toxic pollution loads to soil and water than contemporary mrio it also can account more explicitly for the effects of climate policies on the carbon intensity of the underlying energy system another category of studies perform lca of scenario results emanating from iam or energy system model runs arvesen and hertwich 2011 arvesen et al 2014 bergesen et al 2015 berrill et al 2016 gibon et al 2017 hertwich et al 2015 portugal pereira et al 2016 singh et al 2012 volkart et al 2017 with or without consideration of future technological changes and portraying snapshots of impacts in a given future year or evolution of impacts over time with the exception of volkart et al 2017 these studies mainly focus on assessment results as opposed to describing procedures or discussing methodological aspects and they do not address the topic of deriving lca based coefficients for application in iams to our knowledge no attempts have been made in the existing literature to develop formal procedures for how lca where activities are described bottom up and in physical terms can be incorporated into iam while ensuring consistent use of iam specific data e g emission factors and attribution of life cycle effects to appropriate years and avoiding the uncertainty associated with conversions between mass and monetary units 2 overview of study as stated in the introduction section this study has a twofold aim to develop a general method for deriving lca coefficients for use in iams and to demonstrate the application of the method for the case of future global electricity supply before presenting the method in section 3 and results for the case study of electricity in section 4 the current section provides an overview of the study in terms of data sources and modelling framework used and connections to other related studies in the following subsection 2 1 we explain the selection of electricity supply as a case study and provide an account of main assumptions and data sources we then in subsection 2 2 introduce the themis lca analytic model framework used in this work subsection 3 2 further details the study design and clarifies connections to related studies 2 1 case description electricity supply in 2010 one quarter of global ghg emissions was caused by fossil fuel combustion in power plants edenhofer et al 2014 electricity generation is important for climate change mitigation luderer et al 2014 rogelj et al 2015 wiebe 2016 williams et al 2012 because it is relatively easy to decarbonize compared to e g transport as many low carbon energy sources by their nature generate electricity e g wind nuclear and solar power from an lca point of view electricity generation makes an interesting case study because various different types of power plants while serving the same function operate by very different mechanisms and exhibit very different supply chains we adopt multiregional and prospective life cycle inventory data for photovoltaic power concentrating solar power hydropower wind power coal power and natural gas power from hertwich et al 2015 with some incremental improvements to the data the data incorporates regional variations and future technological improvements of electricity production through changes in basic parameters such as photovoltaic module efficiency fossil fuel power plant efficiency insolation and wind load factors as well as through shifts towards higher performance technology generations e g from crystalline silicon photovoltaic to thin film photovoltaic nuclear power and biomass power are not addressed in hertwich et al 2015 in the current work we adopt life cycle inventory data from the ecoinvent lca database to cover nuclear power dones 2007 ecoinvent 2010 assuming that these data are representative for all regions and over time in addition we establish life cycle inventories for electricity from biomass modelling two different biomass feedstocks or sources one biomass feedstock is boreal forest residue modelled using data from singh et al 2014 the other feedstock is lignocellulosic second generation bioenergy crops data for modelling this feedstock are obtained largely from scenario results produced by the global land use model magpie bodirsky et al 2012 klein et al 2014 lotze campen et al 2008 the magpie results describe crop yields land requirements carbon dioxide emissions from land use irrigation water demand nitrogen and phosphorus fertilizer use and nitrous oxide emissions related to fertilization across world regions and years under nine policy scenarios representing different assumptions about carbon pricing the type of bioenergy crops available and whether irrigation is allowed or not further the magpie results are supplemented by data gathered or derived from other sources notably nemecek and kägi 2007 njakou djomo et al 2013 and njakou djomo et al 2015 a full account of data and assumptions used to model bioenergy crops is provided in the supplementary material table 1 lists the electricity generation technology types modelled using lca and their classification into aggregated technology categories also shown are assumed market shares hertwich et al 2015 for detailed technology types e g ground installed polycrystalline silicon solar photovoltaics that we use to aggregate results into main technology categories e g solar photovoltaics the market shares are not a necessary element of our general method to derive lca coefficients for use in ia modelling but are introduced here for our case study of electricity because the aggregation into main technology types may be practical for results interpretation and application in ia modelling the assumed market shares are constant across regions modelled using lca a special note is required for hydro as is evident from table 1 two hydropower facilities are modelled one of which is situated in a remote location and the other not the life cycle inventory data for both of these cases are based on two planned projects in chile owing to comparatively large transport and infrastructure requirements for the remotely situated plant life cycle impacts for this plant are up to one order of magnitude higher than that of the other non remote plant hertwich et al 2015 2016b ideally a larger population of power plants should serve as a basis of the modelling but such assessments are currently not available as a result of this big difference in impacts between the two cases aggregated results for hydropower are highly sensitive to the market shares assigned to each case in the current study all the life cycle inventory data sets are incorporated into the multi regional and prospective model framework themis that will be described in subsection 2 2 the impact indicator categories considered in the case study of electricity supply are the recipe version 1 08 categories freshwater ecotoxicity freshwater eutrophication human toxicity ionizing radiation land occupation marine eutrophication and mineral resource depletion goedkoop et al 2014 recipe 2012 3 3 recipe is a prominent and widely applied method for life cycle impact assessment as well as four categories representing requirements for individual materials namely aluminium cement copper and iron singh et al 2015 climate change impacts and impacts related to local air pollution are excluded from this list as such impacts are preferably addressed by ia analysts by utilizing lca energy coefficients in combination with iam specific emission factors for fuel combustion 2 2 lca modelling framework themis technology hybridized environmental economic model with integrated scenarios is a multi regional and prospective lca modelling framework themis was formally introduced and described by gibon et al 2015 published applications of themis include hertwich et al 2015 bergesen et al 2015 and berrill et al 2016 in this study we employ themis to produce results for each of the power generation technologies listed in table 1 and for three years 2010 2030 2050 two policy scenarios baseline scenario and the blue map climate change mitigation scenario of iea 2010 and nine world regions following the region classification of iea 2010 the current version of themis combines life cycle descriptions of individual power generation technologies developed by hertwich et al 2015 a process based life cycle assessment database ecoinvent 2010 4 4 ecoinvent is a database providing life cycle inventory data sets for a large number of processes for example minerals extraction and materials production and adapts the data so as to represent important regional differences and changes over time towards 2050 the adaptations include changing the electricity mix depending on region and year following either the baseline or climate change mitigation scenario furthermore themis takes into account scenarios for future improvements in performance parameters for selected industrial processes i e aluminium copper nickel iron and steel metallurgical grade silicon flat glass zinc and clinker production for example in themis steel production in 2050 benefits from lower hard coal coke input to blast furnace reduction per unit of iron as well as lower energy fuel requirements cleaner electricity in particular when the climate change mitigation scenario is analysed and reduced emission intensities compared with steel production in 2010 for a full description of the treatment of technological change in themis see the supplementary material to gibon et al 2015 one limitation of the current version of themis is that it does not include any changes in the characteristics of transport activities over time potential future decreases due to technological innovations or increases due to a shift towards less accessible or lower quality resources in the energy required to extract energy fuels hall et al 2014 or metals norgate and haque 2010 norgate et al 2014 from the ground are also not considered in general selected technology representations are adapted to different years in themis 2 3 study design and links to other studies fig 1 illustrates connections between elements data procedures results of the current study as well as other related studies also included in the figure are references to relevant sections in the present article the figure reiterates the information from subsections 2 1 and 2 2 that life cycle inventory data sets for a suite of electricity supply options were compiled for hertwich et al 2015 and integrated into the multi regional and prospective lca model framework themis themis additionally takes into account future projected technological progress in selected industrial processes subsection 2 2 and gibon et al 2015 the current article presents a general method to derive lca coefficients for use in ia modelling section 3 and uses themis to apply the method for the case of electricity supply section 4 and supplementary material as the figure also indicates two related studies apply the derived lca coefficients in ia modelling pehl et al forthcoming integrate the lca energy coefficients in the remind iam in order to explore life cycle greenhouse gas emissions associated with future global electricity systems and to investigate the degree to which endogenizing life cycle emissions impact the computed optimal technology selection in the second related study luderer et al in preparation make use of both the lca energy and impact indicator results to compare climate mitigation strategies for the power sector in terms of their performance by a range of environmental impact and natural resource use criteria 3 method to derive lca coefficients this section presents the method for calculating and organizing results obtained from lca in such a way that the results can form a suitable interface with ia modelling as remarked in the introduction section the interface may be made up of two types of lca results energy results or impact indicator results the former option allows ia analysts to use iam specific emission factors for carbon dioxide and air pollutants to determine energy related emissions on a life cycle basis the latter option involves characterization and aggregation of different types of pollutants or natural resource use into a set of impact categories defined in the lca and may be particularly useful for ia analysts seeking to address types of impacts not already addressed in the iam e g impacts caused by releases of toxic or eutrophying substances to water in connection with mining or agricultural activities the computations of lca energy and impact indicator results both involve a separate treatment of life cycle stages as will be described in subsection 3 2 additional procedures are described in subsection 3 3 for the computation of lca energy results to identify individual energy carriers industries and energy services hence allowing ia analysts to take advantage of available iam specific emission factors it should be noted that while the lca energy results can be used to address greenhouse gas emissions and air pollution associated with combustion industrial process based emissions müller et al 2013 methane leakages from fossil fuel supply brandt et al 2014 gernaat et al 2015 land use related emissions bodirsky et al 2012 popp et al 2013 methane emissions from hydropower reservoirs hertwich 2013 sulphur hexafluoride leakages from electric equipment arvesen et al 2015 turconi et al 2014 and other non combustion emissions may constitute significant sources of greenhouse gas emissions or environmental impact some remarks on non combustion greenhouse gas emission sources and an explanation of how they are dealt with in the present work are offered in the supplementary material 3 1 mathematical representation and notation we follow the general terminology of lca jrc 2010 matthews et al 2015 and its mathematical representation in terms of input output algebra miller and blair 2009 lca requires a systematic mapping of activities associated with production use and waste handling of products any activity initially identified typically has both its own life cycle and its own supply chain raising the need to map a further set of activities again raising a need to map yet further activities the complete set of activities that through such causal chains can be linked to the product being studied together make up a product system further the activities targeted for special modelling attention or for which data have been established specifically for the current work comprise the foreground system the remaining activities make up the background system jrc 2010 wernet et al 2016 depending on the study background activities could include minerals extraction transport and manufacturing activities and more throughout section 3 we use subscripts to indicate that a variable is dependent on or defined for a specific dimension e g year region and superscripts to indicate a particular type of variable we use the subscripts t r τ s and p to denote technology under investigation i e in our case study one detailed power generation technology type shown in table 1 region year scenario and life cycle phase respectively vectors are denoted by lowercase boldface e g y t r τ s f d and matrices by uppercase boldface e g a τ s we denote the demand that is imposed on the system e g to deliver one unit of electricity from onshore wind power for a given technology region year and scenario by the column vector y t r τ s f d this demand vector has only one non zero entry the demand for the product being studied e g onshore wind power for a given technology region year and scenario is set to one and all others are set to zero so that the impacts of the one product can be isolated the superscript fd denotes final demand and is used to distinguish y t r τ s f d from y t r τ s p which we introduce next further the direct requirements matrix a τ s holds information on all interrelationships between the activities that make up a product system in a τ s the entry in row i and column j represents the direct input from activity i to activity j per unit of output j in the approach and exposition of this paper we assume that all modelled technologies i e in our case study of electricity the full set of technologies shown in table 1 are described in the matrix a τ s this is the reason why in our definition a τ s is not technology and region specific we let the total number of foreground processes covering all technologies and regions defined for year τ be n τ s f n τ s b be the total number of background processes and n τ s f b n τ s f n τ s b the combined foreground and background total we define the following sets t is the set consisting of all technologies r the set of regions τ the set of years s the set of scenarios and p the set of life cycle phases table 2 provides a list of key intermediate and final calculated variables and numbers sets and indices used throughout section 3 3 2 separate treatment of life cycle phases it is a principle purpose of ia modelling to address impacts of future scenarios on large scales in order to best serve this purpose coefficients derived from lca for use in iams should distinguish the construction operation and end of life phases this is to ensure that ia users can attribute construction operation and end of life coefficients to appropriate years and combine them with iam specific data on technology performance e g emission factors and technology deployment e g new installed capacities operating capacities pertaining to the same years moreover separating the life cycle phases is necessary if one wants to capture basic transition dynamics stemming from the different timing of infrastructure and operational inputs which may be important during periods of rapid transformation arvesen and hertwich 2011 gonçalves da silva 2010 usubiaga et al 2017 this subsection describes a generic procedure for separating out individual life cycle phases in lca taking as a starting point a standard lca set up with a demand vector containing only one non zero element in addition and the procedure allows for construction phase effects to scale in proportion to installation size capacity and operation phase effects in proportion to utilization we assume that for technology t region r year τ and scenario s the demand that is imposed on the system e g to deliver one unit of electricity by a distinctive technological option is recorded in a demand vector with a single non zero entry y t r τ s f d already introduced in subsection 3 1 of size n τ s f b 1 we let y t r τ s p be an n τ s f b 1 vector representing the first round of activities in phase p after imposing the demand y t r τ s f d on the system in other words y t r τ s p contains any direct inputs for phase p to the demand being studied y t r τ s p may be calculated as shown in equation 1 based on y t r τ s f d the direct requirements matrix a τ s and a binary n τ s f b 1 correspondence vector b τ s p p h a s e assigning foreground processes to life cycle phase p in b τ s p p h a s e the entry in row j is 1 if foreground process j is associated with life cycle phase p and zero otherwise because background processes are used generically and cannot necessarily be unambiguously assigned to a life cycle phase rows in b τ s p p h a s e representing background processes should contain only zeros we assume that there are three life cycle phases n p 3 the construction phase the operation phase and the end of life phase 1 y t r τ s p φ t r τ s p a τ s y t r τ s f d ˆ b τ s p p h a s e t t r r τ τ s s p p here the circumflex ˆ represents diagonalization of a vector the multiplication factor φ t r τ s p a scalar is introduced for the purpose of unit conversion as will be explained at the end of this section the use of equation 1 presupposes that the data are organized in such a way that i there are no energy use or emissions directly associated with y t r τ s f d ii the first round of activities after imposing the demand y t r τ s f d on the system concerns processes defined in the foreground system only not the background system and iii all processes involved in first round activities can be unambiguously assigned to a life cycle phase the two latter requirements are achieved through appropriate definition of a τ s in the manner illustrated by fig 2 for the case study of electricity in the figure processes labelled process to deliver 1 kwh represent processes for which there can be a non zero entry in y t r τ s f d while immediate inputs to 1 kwh process indicate the processes that must be uniquely assigned using b τ s p p h a s e to either the construction c operation o or end of life e phases note that a τ s covers both foreground and background systems but because rows in b τ s p p h a s e representing background processes contain only zeros equation 1 does not involve any actual modelling for the background in equation 1 elements of the product a τ s y t r τ s f d ˆ b τ s p p h a s e will be measured in relation to the single measurement unit used for the demand specified in y t r τ s f d an optional multiplication by a unit conversion factor φ t r τ s p is introduced in equation 1 to make it possible to use different units for the construction operation and end of life phases respectively we anticipate that the value of φ t r τ s p can be determined based on information already contained in the lca foreground system data e g information about the lifetime efficiency and capacity factor of a thermal power station one application of φ t r τ s p can be to perform a unit conversion so that construction phase requirements are measured in relation to the size of installations and operation phase requirements in relation to the utilization of installations φ t r τ s p can also be seen as a means to avoid imposing lca specific assumptions on the ia modelling for example by measuring requirements of power plant construction in relation to nominal capacity as opposed to power generation influence of lca specific assumptions about power plant lifetime and capacity factor on results can be avoided table 3 summarizes our selection of measurement units in the case study of electricity supply a further discussion on the use of is offered in the supplementary material having established y t r τ s p it is straightforward to determine the total output vector x t r τ s p for a given technology t region r year τ and scenario s and life cycle phase p 2 x t r τ s p i a τ s 1 y t r τ s p t t r r τ τ s s p p where i is the identity matrix of appropriate order we now turn to the computation of lca impact indicator coefficients we let n i m p be the number of impact categories considered we let d t r τ s p i m p t o t be an n i m p 1 column vector containing total impact indicator scores for a given combination of the parameters t r τ s and p having determined x t r τ s p it is straightforward to establish the elements of d t r τ s p i m p t o t using standard lca procedure as expressed in equation 3 3 d t r τ s p i m p t o t c i m p f τ s x t r τ s p t t r r τ τ s s p p we let n s t r be the number of environmental load types defined in the system in themis n s t r 1613 in equation 3 f τ s is an n s t r n τ s f b matrix of environmental load intensities e g phosphate leaching to ground water from disposal of spoil from coal mining and c i m p an n i m p n s t r matrix of characterization factors e g representing the potency of phosphate released to ground water for eutrophication impacts recipe 2012 3 3 detailed treatment of energy use in addition to distinguishing the three main life cycle phases subsection 3 2 our method decomposes energy requirements into energy carrier use by industries and selected energy service types while the method is valid for an arbitrary number of energy carriers industries and energy service types we select default options and use them in our case study of electricity supply the selected energy carriers comprise liquid gaseous and solid fuels and electricity and the selected energy services are freight transport iron and steel production and cement production the selection of industries needs to correspond to the energy service types freight transport iron and steel and cement plus electricity as electricity is a secondary energy form one motivation for separating out key energy carriers industries and energy services is to avoid imposing lca specific assumptions on the ia modelling as far as possible by this we mean that electricity mixes transport and industry fuel mixes and fuel characteristics including the emission intensities of fuels should not be predetermined from the lca side rather the ia analyst should be given the opportunity to represent such mixes and characteristics consistently using iam specific representation of these processes by doing this one can achieve unprecedented coverage of technology change in future oriented analyses of life cycle impacts 5 5 consider for example that because the lca coefficients separate out solid fuels by industries one can capture the life cycle effects of biomass replacing coal in ia scenarios and because freight transport is separated out one can capture the effects of shifts to low carbon transport fuels e g biofuels hydrogen in ia scenarios as is demonstrated in the accompanying study by pehl et al forthcoming another motivation for separating out energy carriers by industries is that it may help to address potential problems of double counting when lca coefficients are introduced in iams 6 6 such double counting issues are discussed in daly et al 2015 and volkart et al 2017 in the following we first describe an approach for achieving sound treatment of energy flows when deriving lca energy coefficients for use in iams subsection 3 3 1 this is a prerequisite for the decompositions of energy requirements into energy carriers industries and energy service types which are described next subsections 3 3 2 and 3 3 3 3 3 1 consistent energy accounting the ecoinvent lca database and hence themis which relies extensively on ecoinvent does not support systematic energy accounting at the point of energy use the energy content of losses in fuel supply chains notably such losses can be methane leakages from natural gas extraction sites or pipelines or losses of coal during transport and storage is not easily identifiable and distinguishable from fuel burning furthermore heating value assumptions are not necessarily consistent across fossil fuel supply chains due to internal inconsistencies in energy statistics used as data input to describe different parts of fuel supply chains in ecoinvent arvesen and hertwich 2015 the established lca practice for measuring energy is to consistently track energy streams to the point of resource extraction from nature including energy losses along the chain linking energy carrier use and primary energy withdrawal from nature e g fugitive methane emissions loss in energy content of coal during transport and storage arvesen and hertwich 2015 frischknecht et al 2015 the resulting energy quantity is often referred to as cumulative energy demand consistency is ensured when using the cumulative energy demand method in ecoinvent to perform standard lca type calculations however consistency is not necessarily achieved in calculations involving breaking up supply chains into disaggregated segments in such cases a failure to properly handle heating value variations can lead to errors arvesen and hertwich 2015 in the context of deriving lca energy coefficients for use in iams it is also important to consider that state of the art iams explicitly account for leakages or losses of methane in fossil fuel production and supply hence such methane leaks should be excluded from the lca energy coefficients in a similar manner as energy loss in thermal electricity production should be excluded our method to derive lca energy coefficients resolves both these issues heating value variations and the need to exclude losses already represented in iams by adopting the cumulative energy demand accounting practice in a uniform manner when calculating quantities of combustible energy i e liquid gaseous and solid fuels 7 7 appendix a in arvesen and hertwich 2015 offers an example illustrating the basic procedure this is also the case when measuring flows representing direct energy use in industrial activities a further note of clarification is included in the supplementary material we refer to combustible energy flows determined in accordance with the cumulative energy demand method as characterized energy carriers denoted as cec for the sake of convenience we let electricity be included in the set of characterized energy carriers and express the set as c e c l i q u i d s g a s e s s o l i d s e l e c t r i c i t y n c e c 4 is the number of characterized energy carriers 3 3 2 energy carrier use by industries we let d t r τ s p c e c t o t be an n c e c 1 column vector containing total characterized energy carrier values for the set c e c an expression for determining d t r τ s p c e c t o t is given in equation 4 4 d t r τ s p c e c t o t c τ s c e c t o t x t r τ s p t t r r τ τ s s p p the analyst should define c τ s c e c t o t such that the values for the combustible energy carriers included in the set c e c are calculated in accordance with the cumulative energy demand method and that electricity requirements are captured as well electricity requirements may be calculated by a simple summation of appropriate entries in x t r τ s p while making sure that electricity represented at different voltage levels in the lca database is not double counted this can achieved through equation 4 and by defining c τ s c e c t o t appropriately we let i n d be the complete set of industries i n d e l e c t r i c i t y t r a n s p o r t i r o n s t e e l c e m e n t and n i n d 4 the number of industries for which we need to identify direct energy carrier use we define f b τ s e c as a subset of the set of all foreground and background processes which represents processes delivering energy carriers e g coal electricity and n τ s e c the number of processes included in f b τ s e c at a minimum f b τ s e c must include the processes delivering energy carriers to processes that are part of the set i n d activities by any additional processes included in f b τ s e c will be zeroed out in the calculations that follow we let a τ s e c be an n τ s e c n τ s f b matrix containing only the rows of a τ s corresponding to the set f b τ s e c next we let b τ s i n d be a binary n τ s f b n i n d correspondence matrix assigning foreground and background processes to the industry sectors included in i n d in b τ s i n d a non zero entry indicates that a process belongs to one of the selected industries rows representing processes that do not match with any of the selected industries contain only zeros finally we let e t r τ s p e c d i r be an n τ s e c n i n d matrix representing the direct use of n τ s e c energy carriers by n i n d industries the superscript dir denotes direct e t r τ s p e c d i r may be calculated according to equation 5 5 e t r τ s p e c d i r a τ s e c x t r τ s p ˆ b τ s i n d t t r r τ τ s s p p e t r τ s p e c d i r will typically represent a large number of energy flows individually e g various inputs of electricity of different geographical origin fuel oil burned in various machines or devices there is a need to classify these energy flows into the main energy carrier types comprising the set c e c and to characterize the combustible energy flows using the cumulative energy demand method in order to achieve consistent accounting cf subsection 3 3 1 this implies that entries representing non electricity energy carriers in e t r τ s p e c d i r need to be multiplied by appropriate factors to convert to cumulative energy demand equivalence in order to achieve this we introduce c τ s c e c d i r as an n c e c n τ s e c matrix collecting coefficients to convert non electricity entries in e t r τ s p e c d i r to cumulative energy demand equivalence as well as coefficients allowing for entries representing electricity to be summed together c τ s c e c d i r should be defined such that left multiplying e t r τ s p e c d i r by c τ s c e c d i r equation 6 yields an n c e c n i n d matrix d t r τ s p c e c d i r representing direct non electricity and electricity use in the selected industries 6 d t r τ s p c e c d i r c τ s c e c d i r e t r τ s p e c d i r t t r r τ τ s s p p the characterized energy carrier values in d t r τ s p c e c t o t and d t r τ s p e c d i r are partially overlapping as the direct energy use in the selected industries are accounted for in both variables we now subtract values in d t r τ s p c e c d i r from values in d t r τ s p c e c t o t to obtain residual energy requirements i e the energy use occurring in other industries than those comprising the set i n d as expressed in equation 7 d t r τ s p c e c r e s refers to an n c e c 1 column vector containing the residual energy requirement values 7 d t r τ s p c e c r e s d t r τ s p c e c t o t d t r τ s p e c d i r 1 t t r r τ τ s s p p where 1 is a n i n d 1 column vector of ones 3 3 3 energy service requirements we measure energy service requirements in terms of total output of the industries delivering the energy services in units of tonne kilometres for transport or tonnes for material production as different industries are represented in different ways in the lca database it is not possible to provide a general recipe for how to establish numbers on total industry outputs we establish transport requirements by simple summation of freight transport outputs including different types of road rail and water transport outputs represented in x t r τ s p life cycle accounting of material outputs is less simple and cannot generally be achieved by summation of entries in x t r τ s p this is because x t r τ s p defines outputs from various material processing steps that partially form linear chains of processes and partially looped systems i e output from one process becomes the input to another process in this study we employ the algorithm presented by singh et al 2015 to determine material requirements we let x t r τ s p i n d be an 1 n i n d row vector collecting all industry output levels here understood as analogous to energy service requirements for the industries represented by the set i n d a data set consisting of d t r τ s p e c r e s and x t r τ s p i n d together with iam specific energy intensity and emission intensity factors will contain sufficient information for ia analysts to determine life cycle emission estimates meanwhile iams differ in their resolution and not all iams resolve transport and material producing industries explicitly hence we provide energy multiplication factors for the industries represented by the set i n d as well based on lca model specific data ia analysts may choose to use these data in lieu of iam specific data we let d t r τ s p c e c d i r be an n τ s c e c n i n d matrix representing the use of n τ s c e c energy carriers by n i n d industries normalized to the total output levels of the respective industries d t r τ s p c e c d i r may be determined from equation 8 8 d t r τ s p c e c d i r d t r τ s p c e c d i r x t r τ s p i n d here the empty circle indicates division of all entries in column number j of d t r τ s p c e c d i r by entry number j in x t r τ s p i n d in the case study of electricity supply the numerical values in d t r τ s p c e c d i r are approximately the same irrespective of technology and phase for this reason and in order to simplify data exchange we compute median values across technologies and phases and let d r τ s c e c d i r m e d be an n τ s c e c n i n d matrix recording the median values 4 lca coefficient results for illustration table 4 shows as an illustrative example lca energy and impact indicator results obtained for solar photovoltaic electricity for year 2010 2030 and 2050 results for china are shown as an example the table also clarifies how the numerical results relate to variables defined in the exposition of the approach the rationale for including table 4 is not to present quantitative results per se but rather the table is included for the purposes of illustration for the same purposes figs 3 and 4 offer illustrative energy results the complete set of energy and impact indicator results is available as electronic supplementary material and is utilized in the related studies pehl et al forthcoming and luderer et al in preparation fig 3 displays life cycle indirect energy requirements for a series of power generation options as iams already cover all direct energy use i e energy fuel combustion occurring at the power plants being studied and our current aim is to provide coefficientsfor indirect energy use direct energy use is not treated in our method and not included in fig 3 8 8 it may also be noted that besides application iniams the indirect energy use of supplying energy has relevance for discussionson the importance of energy for economic growth ayres and voudouris 2014 carbajales dale et al 2014 hall et al 2014 results for europe and year 2010 are shown here as an example for the sake of simplicity and because contributions from the end of life phase are uniformly small 2 of totals in this graphical representation the construction and end of life phases are aggregated into one single category for similar reasons energy use occurring in iron and steel production and in cement production are aggregated in the figure another factor to note is that the results shown in fig 3 are produced using capacity factor and lifetime assumptions in themis however these assumptions will effectively be replaced by iam specific assumptions when ia analysts utilize the numerical results as they are presented in the electronic supplement it is evident from fig 3 that fossil and biomass fuel based power generation options generally exhibit the highest total indirect energy requirements this is in different ways for the different options attributable to extraction or collection processing and distribution of fuel energy sources and carriers all power plants utilizing carbon capture and storage ccs have lower efficiencies and additional process inputs compared to their non ccs counterparts which lead to higher indirect energy per unit of electricity output for ccs cases among non biomass renewable alternatives hydropower and solar photovoltaic power show the highest total indirect energy requirements fig 3 for hydro the comparatively large energy requirements are a result of considerable transport requirements for one of the two hydro power facilities modelled namely the facility situated in a remote area as for solar photovoltaic power energy intensive material processing and manufacturing activities in particular connected to solar grade silicon production give rise to considerable indirect energy requirements while fig 3 only shows results for the year 2010 results for 2030 and 2050 reflect substantial technological improvements for solar photovoltaic power as is illustrated by fig 4 and discussed later in this subsection a more detailed discussion of fig 3 including comparisons with results in literature raugei and leccisi 2016 warner and heath 2012 is presented in the supplementary material while fig 3 displays results for year 2010 only we also produce results for the years 2030 and 2050 fig 4 details prospective indirect energy requirements results for solar photovoltaic pv electricity showing results for both the aggregate mix of pv technology types leftmost column in each panel and for each individual type the six rightmost columns in each panel solar pv electricity is chosen here as an example because it is a technology for which considerable future technological improvements are anticipated as opposed to for example hydropower which is based on relatively mature technology as is evident from fig 4 thin film pv here represented by cadmium telluride and copper indium gallium selenide technologies exhibit much lower indirect energy requirements than conventional poly crystalline silicon pv moreover the indirect requirements of the thin film technologies decline noticeably over time mainly owing to projected rises in conversion efficiencies 9 9 a related discussion is available in bergesen et al 2014 in our results the combination of i a shift away from polycrystalline silicon and towards thin film technologies cf table 1 and ii thin film technologies becoming more efficient over time entails a reduction in the energy requirements of the average pv electricity mix of 70 from 2010 to 2050 electricity is an important energy carrier in relative terms for pv compare the relative importance of electricity for pv versus other power generation options evident from fig 3 which implies further reductions in the life cycle greenhouse gas emissions of pv in scenarios where electricity becomes cleaner 5 final remarks we believe that potentials exist for the iam and lca fields to interact in beneficial ways the iam community has a strong tradition in analysing transformation pathways on the macro level while for lca which traditionally has been micro and static minded this is an emerging research interest the lca community has decades of experience in developing formal procedures for assessing impact types as diverse as among others air pollution and toxic contamination of soil and water while ia analysts in recent years have made major strides in incorporating various air pollutants as well as aspects of land use and water demand in their models the life cycle perspective is unique for lca but lca lacks the optimization perspective of iam in this article we present a novel method for deriving lca based coefficients suitable for application in iams the method decomposes lca coefficients into life cycle phases and energy carrier use by industries thus facilitating attribution of life cycle effects to appropriate years and consistent and comprehensive use of ia model specific scenario data e g emission factors lifetime and utilization rates of equipment when the lca coefficients are applied in ia scenario modelling the method is flexible with respect to possible use i e it can be applied to study any kind of product and resolution levels of input data i e the life cycle inventory data can have any degree of resolution and output data i e the final lca coefficients can represent any number of energy carriers or industries separately the method is devised for lca analytic frameworks where activities are described bottom up and in physical terms as opposed to multiregional input output mrio frameworks as employed in other work daly et al 2015 scott et al 2016 bottom up lca and mrio analysis both have their merits and demerits subsection 1 2 and we anticipate that both techniques will be used in future research addressing the role of life cycle effects in climate change mitigation scenarios in the version of themis used to derive lca coefficients for electricity supply scenario data inputs to themis itself come from exogenous sources as described in gibon et al 2015 a possible future improvement when themis is used in conjunction with an iam however would be to obtain scenario data inputs to themis specifically from the iam in question thus enhancing harmonization of scenario data across the lca and iam modelling we regard the method presented in this article as a generally applicable and useful method to derive lca coefficients for use in ia modelling when core structures and data organization principles in lca and iam are given the energy accounting based on cumulative energy demand subsection 3 3 1 may usefully be replaced by a simpler procedure if lca databases adopt a more practical and consistent inventory of secondary and final energy i e an inventory distinguishing supply chain energy losses and energy use based on consistent heating value assumptions in the future parts of the method may be integrated into new and more advanced methods or be replaced by them for example if iams should be re structured to consider indirect energy use and emissions in a systematic fashion and with internal consistency strategies and priorities for taking into account life cycle effects in evaluations of vast scale transformation pathways need to be evaluated continuously considering the moving frontiers of lca and iam research and available evidence on the importance of life cycle effects in the context of climate change mitigation and sustainability assessment as well as practical concerns such as the need to limit model complexity with exceptions daly et al 2015 pehl et al forthcoming scott et al 2016 to date it remains largely unexplored whether or under what circumstances the types of causality relationships that form the heart of lca e g wind turbines require steel steel producers require fossil fuels and fossil fuel use causes emissions can have significant influences on optimized global energy and climate mitigation strategies arvesen et al 2011 dale et al 2012a finally it is worth noting that this article is written largely from the standpoint of lca and to a much lesser degree from the standpoint of iam accompanying articles currently in preparation address this imbalance by applying lca coefficients for electricity supply in integrated assessment luderer et al in preparation pehl et al forthcoming acknowledgments we thank thomas gibon for collaboration and assistance with themis topics bhawna singh for providing us with the raw data for her work on bioelectricity and evert bouman for help with calculating life cycle material requirements we thank the anonymous reviewers for their particularly thorough evaluations and useful comments this research received funding from the european union s seventh programme fp7 2007 2013 under grant agreement number 308329 advance arvesen additionally acknowledges support from the research council of norway through the centre for sustainable energy studies grant 209697 bodirsky received funding from the european union s horizon 2020 research and innovation programme under grant agreement number 689150 sim4nexus appendix a supplementary data the following are the supplementary data related to this article supplementary document supplementary document supplementary excel file supplementary excel file appendix a supplementary data supplementary data related to this article can be found at https doi org 10 1016 j envsoft 2017 09 010 
26471,many watershed models simulate overland and instream microbial fate and transport but few provide loading rates on land surfaces and point sources to the waterbody network this paper describes the underlying equations for microbial loading rates associated with 1 land applied manure on undeveloped areas from domestic animals 2 direct shedding excretion on undeveloped lands by domestic animals and wildlife 3 urban or engineered areas and 4 point sources that directly discharge to streams from septic systems and shedding by domestic animals a microbial source module which houses these formulations is part of a workflow containing multiple models and databases that form a loosely configured modeling infrastructure which supports watershed scale microbial source to receptor modeling by focusing on animal and human impacted catchments a hypothetical application accessing retrieving and using real world data demonstrates how the infrastructure can automate many of the manual steps associated with a standard watershed assessment culminating in calibrated flow and microbial densities at the watershed s pour point keywords integrated environmental modeling qmra risk assessment pathogens manure watershed modeling 1 introduction the united states environmental protection agency epa is interested in characterizing managing and minimizing the risks of human exposure to pathogens in water resources impacted by effluents and runoff from both agricultural activities and built infrastructure epa 2016a indicates that 52 8 of the assessed river and stream miles are impaired with pathogens being the main cause followed by sediment contamination and nutrients the designation pathogen is used in the broadest sense based upon detection of fecal indicator bacteria fib escherichia coli e coli and fecal coliforms monitoring for the presence of pathogens in manure and sewage contaminated waters is extremely challenging as pathogen concentrations in water samples are often low such low concentrations make detection unfeasible unless large volumes of water are analyzed most monitoring approaches and microbial water quality regulations are based on indicator bacteria since they are easier to sample and quantify epa 2012 2015 although good correlations between indicators and pathogens may be suspect for example haack and duris 2013 note that there is a widely acknowledged variable relationship between fib and pathogen concentrations field and samadpour 2007 savichtcheva et al 2007 therefore states might avail themselves of water quality criteria if they can demonstrate an equivalent level of public health protection with higher indicator concentrations agriculture is one of the most likely causes of pollution affecting almost 13 of the total river miles assessed since applying manure for crop nutrition and production and animal shedding due to grazing are common practices manure applications may carry environmental contaminants such as pathogens organic chemical residues and heavy metals edwards and daniel 1992 these contaminants adversely affect water quality mainly due to runoff producing rainfall events among the various animal fecal sources poultry are responsible for 44 of the total feces production in the united states followed by cattle 31 and swine 24 kellog et al 2000 in comparison humans contribute only a small fraction 0 7 on an equal weight basis however human sewage wastewater is generally thought to constitute a much higher risk to public health due to the likelihood of viral pathogen presence soller et al 2010 schoen et al 2011 dufour 1984 models can play a role in assessing the distribution of microbes in a mixed use watershed and the potential risks associated with both measured and predicted indicator concentrations i e degree to which concentrations indicate threats to public health under varying circumstances assessment of potential risks is critical in determining the appropriateness of waivers to criteria and concentration standards based on site specific environmental settings and source conditions site surveys coupled with modeling tools are a basic way to identify sources characterizing them associate a level of infectivity with the source and assess its level of impact at the point of exposure a quantitative microbial risk assessment qmra is a source to receptor modeling approach that integrates disparate data such as fate transport exposure and human health effect relationships to characterize the distribution of indicator and pathogenic microbes within a watershed and the potential health impacts risks from exposure to pathogenic microorganisms soller et al 2010 whelan et al 2014a 2014b haas et al 1999 hunter et al 2003 as whelan et al 2014b note a qmra s conceptual design fits well within an integrated multi disciplinary modeling perspective which describes the problem statement data access retrieval and processing e g d4em epa 2013a wolfe et al 2007 software frameworks for integrating models and databases e g frames whelan et al 2014b johnston et al 2011 infrastructures for performing sensitivity variability and uncertainty analyses e g supermuse babendreier and castleton 2005 and risk quantification coupling modeling results with epidemiology studies allows policy related issues epa 2010 epa and usda 2012 for example to be explored an important aspect of the integrated environmental modeling iem laniak et al 2013 microbial workflow is its ability to define spatial and temporal microbial loadings from human and animal sources within a mixed use watershed multiple software tools have been developed to estimate microbial source loadings to a watershed such as mwaste coli sedmod modifications to swat select bit and bslc moore et al 1989 developed mwaste to simulate waste generation and calculate bacterial concentrations in runoff from the land applied waste of various animals and management techniques mwaste only considers animal borne bacteria and allows only one animal per execution so multiple runs are required for the consideration of different animal species walker et al 1990 developed the coli model to predict bacteria concentration in runoff resulting from a single storm occurring immediately after land application of manure it uses a monte carlo simulation to combine a deterministic relationship with rainfall and temperature variations and calculates maximum and minimum bacteria concentration in runoff fraser et al 1996 developed a gis based spatially explicit delivery model sedmod that estimates spatially distributed delivery ratios for eroded soil and associated nonpoint source pollutants the model predicts fecal coliform loading in rivers and calculates pollutant loadings in streams by multiplying livestock fecal coliform output and a delivery ratio estimated for each watershed cell to predict the proportion of eroded sediment or other non point source pollutant transported from the cell to the stream channel parajuli 2007 manually estimated fecal bacterial loading considering different sources such as livestock manure application grazing human septic and wildlife for the swat bacteria sub model guber et al 2016 followed this up with a limited effort that integrated infection and recovery of white tailed deer and cattle into the watershed model swat it predicted pathogen transmission between livestock and deer by considering seasonal changes in deer population habitat and foliage consumption ingestion of pathogens with water foliage and grooming soiled hide by deer and grazing cattle infection and recovery of deer and co grazing cattle pathogen shedding by infected animals survival of pathogens in manure and kinetic release of pathogens from applied manure and fecal material teague et al 2009 developed the spatially explicit load enrichment calculation tool select to identify potential e coli sources in plum creek watershed in texas select is a grid based load assessment tool that considers multiple point and non point sources wastewater treatment plant livestock pets wildlife septic urban riebschleager et al 2012 automated select within arcgis and added the pollutant connectivity factor component which is based on potential pollutant loading runoff potential and travel distance select has been used to identify e coli teague et al 2009 mckee et al 2011 riebschleager et al 2012 mcfarland and adams 2014 borel et al 2015 and enterococci borel et al 2015 sources in multiple watersheds in texas the bacterial indicator tool bit estimates microbial loading from domestic animals wildlife and human activities to a mixed use watershed epa 2000 it accounts for land application of manure and direct shedding from certain domestic animals to pasture and cropland and from wildlife to cropland pasture and forest it also estimates point source loadings from septic system failures and direct shedding to the stream from certain domestic animals finally it accounts for loading in urban built up areas such as residential commercial transportation etc bit uses microsoft excel for calculations and considers only 10 subwatersheds when distributing loads land applied loading rates are adjusted for die off all loadings vary monthly except for those from wildlife in urban areas and from septic systems which use constant loading rates to the stream based on the fraction of septic systems that fail urbanized areas include categories such as commercial mixed urban or built up residential and roadways loading rates to urbanized areas are supplied by the user although default values are suggested stormwater runoff through drainage pipes and combined and non combined sewer systems are not accounted for in a similar manner to bit the bacterial source load calculator bslc was designed to organize and process bacterial inputs for a total maximum daily load tmdl bacterial impairment analysis zeckoski et al 2005 bslc calculates bacterial loads based on animal numbers and default values for manure and bacterial production rates accounting for die off and the fraction of domestic animal confinement it uses externally generated user supplied inputs of watershed delineations and land use distribution as well as domestic animal wildlife and human population estimates to suggest monthly land based and hourly stream based bacterial loadings neither bit nor bslc offer software that supports data collection to meet model input requirements although their documentation suggests some default values prior to allocating microbial sources within a watershed the watershed must first be delineated into subwatersheds which are the smallest modeling units to do so many models require users to manually and externally delineate a watershed then manually assign environmental characteristics animal numbers and types farming practices and human activities to each subwatershed this can be a daunting task especially if the user re delineates the watershed because the delineation pattern determines size and location of subwatersheds it has a significant impact on distribution and magnitude of microbial loading rates within them hence it is desirable to have an automated process to delineate a watershed populate its subwatersheds with environmental characteristics land use types waterbody network slope soil type meteorological met data etc and overlay sources of microbial contamination so appropriate loading rates can be easily computed on land and in stream the work reported here describes the expansion and modification of bit developing a new microbial source module msm wolfe et al 2016 whelan et al 2015a additionally its use and implementation was demonstrated as a component of an iem workflow the workflow automates the manual processes that perform qmras on mixed use watersheds anywhere in the united states by determining microbial sources and estimates of microbial loadings to land and streams the mathematical formulations of msm and its context within an iem workflow are described here 2 materials and methods the msm organizes analyzes and supplies data that calculates microbial loading rates within subwatersheds the smallest spatial units for data that it consumes and produces msm correlates sources to cropland pasture forest and urbanized mixed use land use types for each subwatershed microbial sources include numbers and locations of domestic agricultural animals dairy and beef cattle swine poultry etc and wildlife deer duck raccoon etc with estimated shedding rates manure application rates where manure is directly incorporated into cropland s and pasture s soil and loading rates due to urbanized mixed use activities commercial transportation etc manure contains microbes and the monthly maximum microbial storage and accumulation rates on the land surface adjusted for die off are computed over a season to represent the source for overland fate and transport to instream locations monthly point source microbial loadings to instream locations are also determined for septic systems and instream shedding by cattle the type of septic system e g gravity pressure distribution sand filter or mound is not differentiated in the model flow microbial and chemical loadings also originate from point sources such as publicly owned treatment works wastewater treatment plants potws wwtps although they are not simulated their discharge time series can be accounted for as direct input to the watershed model the user interface that externally supports msm automatically formats the watershed input file so when the user registers the potws wwtps time series it is seamlessly incorporated into the input file the msm has been seamlessly linked with a user interface based on data for environmental modeling d4em and site data manager project builder sdmprojectbuilder or sdmpb these three components are part of an iem workflow also containing the hydrologic simulation program fortran hspf watershed model bicknell et al 1997 better assessment science integrating point and nonpoint sources basins modeling infrastructure epa 2001a and parameter estimation and uncertainty analysis pest inverse model doherty 2005 2 1 assumptions and constraints assumptions and constraints associated with the msm are presented in table 1 and correlations between manure application land use type domestic animal and wildlife are summarized in table 2 an index glossary that correlates subscripts used in the mathematical formulas is provided in table 3 2 2 land application of domestic animal manure as indicated in table 2 cropland and pasture are land use types that receive land applied domestic animal manure and whose mathematical formulations are described in the following sections 2 2 1 domestic animal waste available for land application the fraction of annual manure application available for runoff each month by domestic animals based on the monthly fraction applied and incorporated into the soil is computed as follows epa 2013b 2013c 1 f r a c t i o n m a n u r e a v a i l a b l e r u n o f f m q a p p l i c a t i o n m q a n i m a l f r a c t i o n a v a i l a b l e m in which 2 a n i m a l f r a c t i o n a v a i l a b l e m 1 m a n u r e i n c o r p o r a t e d i n t o s o i l m 2 m 1 2 3 or 5 1 m a n u r e i n c o r p o r a t e d i n t o s o i l m 3 m 4 where f r a c t i o n m a n u r e a v a i l a b l e r u n o f f m q is the fraction of annual manure application available for runoff by month q by domestic animal m equivalent to the ratio of microbial cells available for runoff each month to cells available for runoff per year ratio a p p l i c a t i o n m q is the fraction of annual manure applied each month q by domestic animal m equivalent to the ratio of cells applied each month to cells applied per year ratio m a n u r e i n c o r p o r a t e d i n t o s o i l m is the fraction of applied manure incorporated into the soil by domestic animal m ratio and a n i m a l f r a c t i o n a v a i l a b l e m is the fraction of domestic animal m manure available for runoff ratio 2 2 2 land application of manures from domestic animals the monthly microbial loading rate from land application of domestic animal manure associated with each subwatershed by land use type is equal to 3 m i c r o b e r a t e a p p l y i k m q 0 for m 1 or 2 and k 3 or 4 m 3 or 4 and k 2 3 or 4 m 5 and k 1 3 or 4 m 6 or 7 and k 1 2 3 or 4 n u m b e r o f a n i m a l s i m m i c r o b e a n i m a l p r o d u c t i o n r a t e s m f r a c t i o n m a n u r e a v a i l a b l e r u n o f f m q a p p l y m o n t h s q a p p l y a r e a i k in which 4 a p p l y m o n t h s q 365 d a y i n m o n t h q for m 1 and k 1 or 2 m 3 or 4 and k 1 365 t o t a l g r a z e d a y s m d a y i n m o n t h q for m 2 and k 1 or 2 m 5 and k 2 5 a p p l y a r e a i k a r e a t i for m 1 or 2 and k 1 or 2 a r e a i k for m 3 or 4 and k 1 m 5 and k 2 6 t o t a l g r a z e d a y s m q g r a z i n g d a y s m q 7 a r e a t i k 1 2 a r e a i k where m i c r o b e r a t e a p p l y i k m q is the microbial loading rate per area to land use type k from land application of domestic animal m manure by month q by subwatershed i cells time area n u m b e r o f a n i m a l s i m is the number of domestic animals m by subwatershed i number of domestic animal m i c r o b e a n i m a l p r o d u c t i o n r a t e s m is the microbial production rate shed per domestic animal m cells d domestic animal equals the multiple of domestic animal shedding rate of waste in mass of wet weight ww per time mass d domestic animal and microbial density concentration based on mass of waste shed by domestic animal cells mass a p p l y m o n t h s q is the conversion for the number of months per year weighted by the actual number of days in month q when land application of manure might be possible mo yr a p p l y a r e a i k is the area associated with the land application of manure by subwatershed i by land use type k 365 is the conversion constant for days in a year d yr d a y i n m o n t h q is the conversion constant for days per month q january 31 february 28 december 31 in which the months are indexed by q as 1 january 12 december d mo g r a z i n g d a y s m q is the number of grazing days by domestic animal m per month q d mo t o t a l g r a z e d a y s m is the total number of grazing days per year for domestic animal m d yr a r e a i k is the subwatershed i area by land use type k area and a r e a t i is the total summed area for cropland k 1 and pasture k 2 by subwatershed i area 2 3 domestic animal and wildlife shedding rates to land surfaces land use types that receive domestic animal and wildlife shedding are captured in table 2 the monthly microbial loading rates to different land use types due to shedding from domestic animals while grazing by subwatershed is equal to 8 m i c r o b e r a t e s h e d i k m q 0 for m 1 3 or 4 and k 1 2 3 or 4 m 2 5 6 or 7 and k 1 3 or 4 n u m b e r o f a n i m a l s i m s h e d m o n t h s m q m i c r o b e a n i m a l p r o d u c t i o n r a t e s m a r e a i k in which 9 s h e d m o n t h s m q g r a z i n g d a y s m q 1 t i m e s p e n t i n s t r e a m s m q d a y i n m o n t h q for m 2 and k 2 g r a z i n g d a y s m q d a y i n m o n t h q for m 5 6 or 7 and k 2 where m i c r o b e r a t e s h e d i k m q is the microbial loading rate to land use type k due to grazing of domestic animal m by month q by subwatershed i cells time area and s h e d m o n t h s m q is the fraction of the month q that domestic animal m spends grazing shedding ratio and t i m e s p e n t i n s t r e a m s m q is the fraction of the number of grazing days that domestic animal m spends in a stream each month q ratio the monthly microbial loading rates to different land use types due to shedding from wildlife equals 10 w i l d l i f e m i c r o b e r a t e s h e d k n d e n s i t y k n m i c r o b e w i l d l i f e p r o d u c t i o n r a t e s n for k 1 2 or 3 0 for k 4 where w i l d l i f e m i c r o b e r a t e s h e d k n is the microbial shedding rate per area by wildlife n by land use type k cells time area d e n s i t y k n is the number of wildlife n per area by land use type k number of wildlife area and m i c r o b e w i l d l i f e p r o d u c t i o n r a t e s n is the microbial shedding rate per wildlife n cells time number of wildlife the total microbial shedding rate per land use type per area summed across all wildlife is 11 w i l d l i f e m i c r o b e r a t e s h e d s u m k n 1 6 w i l d l i f e m i c r o b e r a t e s h e d k n where w i l d l i f e m i c r o b e r a t e s h e d s u m k is the microbial shedding rate per area by land use type k summed across all wildlife cells time area 2 4 accumulated microbial loading rates on urbanized areas urbanized land use is divided into four urbanized categories r 1 for commercial and services r 2 for mixed urban or built up r 3 for residential and r 4 for transportation communications and utilities which are further divided into urbanized sub categories u 1 for commercial u 2 for single family low density u 3 for single family high density u 4 for multi family residential and u 5 for road single family low density is a single detached dwelling single family residence or separate house that is a free standing residential building wikipedia 2015a single family high density is a suite of smaller scale single family dwellings representing a more compact single family residential development 13 40 units ac garnett 2012 multi family residential is a unit with multiple separate housing units for residential inhabitants contained within one building or several buildings within one complex such as an apartment or condominium wikipedia 2015b accumulation rates in median microbial cells per urbanized land use type r per area per time indexed by the urbanized subcategories u are computed as follows 12 b u i l t u p r a t e k r s u b u r b a n i z e d b u i l t u p r a t e u for k 4 r 1 u 1 u 1 5 s u b u r b a n i z e d b u i l t u p r a t e u 5 for k 4 r 2 u 2 4 s u b u r b a n i z e d b u i l t u p r a t e u 3 for k 4 r 3 s u b u r b a n i z e d b u i l t u p r a t e u for k 4 r 4 u 5 where b u i l t u p r a t e k r is the accumulation rate in median microbial cells per urbanized land use type k 4 per area per time indexed by the urbanized category r by urbanized sub category u cells time area and s u b u r b a n i z e d b u i l t u p r a t e u is the general microbial loading rate by urbanized sub category u cells time area accumulated microbial loading rate associated with the urbanized land use type per subwatershed weighted by the areas associated with the four urbanized categories for all months i e applicable throughout the year is computed as follows 13 a c c u m b u i l t u p r a t e i k 0 for k 1 2 or 3 r 1 4 a r e a f r a c t i o n i k r b u i l t u p r a t e k r for k 4 where a c c u m b u i l t u p r a t e i k is the accumulated microbial loading rate associated by land use type k by subwatershed i weighted by areas associated with four urbanized categories r for all months i e throughout the year cells time area and a r e a f r a c t i o n i k r is the fraction of land use type k indexed to the four subcategories of urbanized r by subwatershed i 2 5 accumulated overland microbial loading rates to land surfaces and maximum microbial storage adjusted for removal land use types that receive domestic animal and wildlife shedding are captured in table 2 and described in the following sections 2 5 1 accumulated overland microbial loading rates to land surfaces the overland microbial loading rates to land surfaces accumulated for shedding and land application are computed by subwatershed by month across all domestic animals and wildlife are computed for the different land use types as follows 14 a c c u m u l a t i o n r a t e m o n t h i k q w i l d l i f e m i c r o b e r a t e s h e d s u m k m 1 4 m i c r o b e r a t e a p p l y i k m q for k 1 w i l d l i f e m i c r o b e r a t e s h e d s u m k m 1 2 5 m i c r o b e r a t e a p p l y i k m q m 2 5 6 7 m i c r o b e r a t e s h e d i k m q for k 2 w i l d l i f e m i c r o b e r a t e s h e d s u m k for k 3 a c c u m b u i l t u p r a t e i k for k 4 where a c c u m u l a t i o n r a t e m o n t h i k q is the microbial loading rate by subwatershed i by month q across all domestic animals m and wildlife n for each land use type k cells time area 2 5 2 maximum microbial storage adjusted for removal the maximum microbial storage accumulation on the land surface is based on a formulation associated with hspf removal from overland surfaces is simulated as a function of the input accumulation rate and maximum storage of microbes which represents accumulation without removal the unit removal rate of stored microbes e g cells removed per day represents processes such as die off and wind erosion bicknell et al 1997 and is computed as the microbial accumulation rate divided by the maximum microbial storage accumulation storage limit 15 s t o r a g e l i m i t m o n t h i k q a c c u m u l a t i o n r a t e m o n t h i k q 0 d a y i n m o n t h q 10 d i e o f f q t d t a c c u m u l a t i o n r a t e m o n t h i k q 2 303 d i e o f f q 1 10 d a y i n m o n t h q d i e o f f q a c c u m u l a t i o n r a t e m o n t h i k q 2 303 d i e o f f q f o r 1 10 d a y i n m o n t h q d i e o f f q a c c u m u l a t i o n r a t e m o n t h i k q d a y i n m o n t h q a s d i e o f f q 0 where s t o r a g e l i m i t m o n t h i k q is the maximum microbial storage by subwatershed i by month q by land use type k across all domestic animals and wildlife adjusted for die off removal cells area and d i e o f f q is the first order microbial removal inactivation die off rate on the land surface by month q 1 time 2 6 microbial point source loading rates monthly microbial point source loadings to a stream include shedding of beef cattle while wading in the stream and leakage from an average septic system which are used by msm 2 6 1 shedding rates of beef cattle in streams the monthly microbial loading rate of beef cattle shedding to a stream by subwatershed is as follows 16 b e e f c a t t l e s h e d r a t e s t r e a m i q n u m b e r o f a n i m a l s i m m i c r o b e a n i m a l p r o d u c t i o n r a t e s m g r a z i n g d a y s m q d a y i n m o n t h q t i m e s p e n t i n s t r e a m s m q for m 2 where b e e f c a t t l e s h e d r a t e s t r e a m i q is the microbial loading rate of beef cattle m 2 shedding into a stream by subwatershed i by month q cells time 2 6 2 microbial loadings due to septics the average septic flow rate to the stream by subwatershed is as follows 17 s e p t i c s t r e a m f l o w r a t e i s e p t i c n u m b e r i s e p t i c n u m b e r p e o p l e s e p t i c o v e r c h a r g e s e p t i c f a i l u r e r a t e where s e p t i c s t r e a m f l o w r a t e i is the average septic flow rate to the stream by subwatershed i volume time s e p t i c n u m b e r i is the number of septic systems associated with subwatershed i number of septics s e p t i c n u m b e r p e o p l e is the average number of people per septic system number of people septic s e p t i c o v e r c h a r g e is the typical septic overcharge flow rate volume time person and s e p t i c f a i l u r e r a t e is the typical fraction of septic systems that fail ratio the microbial loading rate associated with septic systems by subwatershed is as follows 18 s e p t i c s t r e a m l o a d i n g r a t e i s e p t i c s t r e a m f l o w r a t e i s e p t i c c o n c where s e p t i c s t r e a m l o a d i n g r a t e i is the microbial loading rate to the stream from leaking septic systems by subwatershed i cells time and s e p t i c c o n c is the typical microbial density concentration in septic system waste cells volume 2 7 workflow components a software infrastructure is developed to automate the manual process of characterizing transport of pathogens and indicator microorganisms from sources of release to points of exposure by loosely configuring a set of modules and process based models a design schematic of the workflow which tracks data from sources to downstream locations within a watershed and visualizes simulation results is presented in fig 1 models in addition to msm include d4em sdmpb hspf pest and basins d4em manages accesses retrieves analyzes and caches web based environmental data epa 2013a it is an open source automated data access and processing library that accesses a variety of data types including water quality land use hydrology soils meteorological met stream flow groundwater levels and crop data uses dotspatial geo processing libraries to perform cartographic re projections intersection clipping overlaying joining and merging of geographic features and areas of interest delineation performs statistical processing extraction interpolation and averaging of time series data incorporates automatic data access functionality and consists of a collection of net dynamic link libraries that can be linked to a modeling utility such as a batch processor or script to access data for multiple sites or used with a custom built user interface the sdmpb leverages d4em provides geographical information system gis capabilities using dotspatial technology converts dotspatial based project files to mapwindow based project files mapwindow 2013 watry and ames 2008 and pre populates input files of fate and transport models automatically hspf bicknell et al 1997 is a comprehensive package for simulating watershed hydrology and water quality for conventional e g sediment or nutrients and nonconventional pollutants e g toxic organics and microbes it uses basin scale analysis for integrated simulation of land and soil contaminant runoff processes with instream hydraulic and microbial interactions on user defined time scales hour day month or year and provides a history of runoff flow rates and microbial concentrations at any point in a watershed interflow and groundwater supplying the streams are also simulated but contaminant levels are accounted for by a user specified constant concentration level hspf executes as a stand alone or within basins pest is a model independent nonlinear parameter estimation package that can estimate parameter values for almost any existing computer model whether a user has access to the model s source code doherty 2005 or not pest is designed to interface with an existing model modify designated input run the model as often as needed and adjust its parameters until differences between simulated and monitored output results are minimized in a weighted least squares sense pest communicates with a model through the model s own input and output files pest implements a variant of the gauss marquardt levenberg method of nonlinear parameter estimation and also allows fine tuning of parameter estimation via control variables basins epa 2001a provides graphical and tabular viewers of input data and flow and concentration output it is a multipurpose environmental analysis infrastructure that performs watershed and water quality based analyses by integrating environmental data analysis tools and watershed and water quality models a mapwindow based gis organizes spatial information that displays maps tables or graphics analyzes landscape information and integrates and displays relationships among data at a user chosen scale 3 results 3 1 input requirements the msm has been seamlessly linked with a suite of comma separated values csv files that supply user defined microbial data additional data supplied by sdmpb d4em on watershed characteristics are also consumed by msm microbial loadings data produced by msm represent input to sdmpb which passes the information to downstream models an example application to a real world watershed using the qmra workflow illustrates flow and microbial loadings at the pour point 3 1 1 microbial input comma separated values files twelve user defined csv files and their microbial source term input data requirements for a microbial assessment using msm whelan et al 2015b are listed in table 4 column 1 identifies the csv file name and corresponding model sdmpb or msm that consumes data columns 2 and 3 define each parameter and its corresponding units respectively sdmpb uses some of these data in calculations to produce output column 4 which is the input to msm for example input location points defined by latitude and longitude for sdmpb column 2 are spatially overlaid automatically onto the watershed to identify corresponding subwatersheds which are required input to msm example csv files and input requirements are presented in appendix a tables a1 through a10 3 1 2 watershed characteristics the sdmpb manages and acquires mixed use watershed information from standard national databases table 5 using d4em which is based on the basins watershed modeling system data download tool which accesses retrieves analyzes and caches web based data a suite of gis map layers includes gaging station locations nhdplus flowlines waterbody network subwatersheds elevation e g slope soil types land use types met stations and multiple legal boundaries state county roads eco regions national water quality assessment nawqa regions etc 3 2 output requirements five pieces of information produced by msm 1 microbial loading rate by subwatershed i by month q summed across all domestic animals m and wildlife n for each land use type k without die off a k a mon accum in hspf 2 maximum microbial storage per land use type k area per subwatershed i by month q summed across all domestic animals m and wildlife n adjusted for die off a k a mon sqolim in hspf 3 microbial loading rate of domestic animal beef cattle m 2 shedding to streams by subwatershed i by month q 4 average septic flow rate to the stream by subwatershed i 5 microbial loading rate to the stream from leaking septic systems by subwatershed i 3 3 modeling workflow an example application of a qmra workflow using msm is presented in fig 1 although hypothetical it accesses retrieves and uses real world data coupled with microbial properties data contained in the csv data files and d4em retrieved data sdmpb produces a delineated watershed fig 2 of 1358 km2 524 mi2 containing a suite of gis map layers these layers include farms with domestic animal types numbers and locations septic system locations nhdplus flowlines subwatersheds waterbody network elevation e g slope soil types land use types met stations gaging stations and multiple legal boundaries table 5 fig 3 presents flow calibration results at the pour point of the watershed including the initial uncalibrated simulation monitored gage data and the initial calibration with the inverse model pest correlation coefficient r of 0 86 fig 4 presents enterococci calibration results at the pour point of the watershed including uncalibrated simulation results 41 monitored sample densities and the initial calibration with pest correlation coefficient r of 0 45 initial microbial loadings and instream die off rates within the watershed were used in the calibration microbial densities in interflow and groundwater were set to zero because local well data indicated an absence of enterococci 4 discussion qmra organizes captures and executes microbial data to address impacts to mixed use watersheds within a modeling workflow which involves watershed characterizations microbial source mapping and instantiation of the workflow in an assessment source term data are critical to development of a qmra and thus emphasized in this manuscript 4 1 automating watershed delineation and microbial source mapping the workflow that contains the msm allows for automated watershed delineation and collation of microbial sources within each subwatershed this allows users to easily change the number and size of subwatersheds and microbial sources are automatically placed within the correct subwatershed and collated accordingly users therefore do not have to manually assign sources domestic animals humans engineered point sources or septics to subwatersheds the sdmpb d4em automates watershed delineation and microbial source mapping as it links to a gis system mapwindow to visualize map layers of data accesses and retrieves web based data from sources outlined in table 5 to automatically create input files for msm including automatic delineation of watersheds into subwatersheds areas for and land use types in each subwatershed etc allows users to specify intermediate locations e g gaging monitoring within a watershed to ensure that the automated delineation process has subwatershed boundaries going through those points provides user control for watershed delineation as it relates to number of subwatersheds minimum subwatershed size and minimum stream length the latter two prevent watershed modeling of areas and streams that are too small although the smallest areas are those defined by the minimum nhd delineations accesses and retrieves user defined local data appendix a tables a1 through a10 which compute microbial loading rates distributed spatially and temporally by subwatersheds allows manual manipulation of input data for more refined site specific assessments facilitates linkage between microbial sources and loadings through msm with fate and transport modeling within a mixed use watershed assigns north american land data assimilation system nldas radar or national climatic data center ncdc land based met data to individual subwatersheds kim et al 2014 creates the msm input file allows users to designate snow accumulation melt microbial fate and transport and simulation time increments e g hourly daily monthly or annually whelan et al 2015c creates map layers to visualize locations of subwatersheds land use types farms domestic animals septics engineered point sources monitoring and gaging stations and met stations an example watershed with delineated subwatersheds water body network gaging stations and farms with domestic animal and septic system locations is presented in fig 2 4 2 microbial source characterization microbial source characterization identifies types and locations of sources and information that capture microbial loadings and influence fate and transport in the watershed including locations and types of microbial sources shedding and production rates and die off microbial sources include domestic animals wildlife septic systems point sources wwtps and potws and urban loadings microbial source characterization data supplied by the user are illustrated in appendix a tables a1 through a10 4 2 1 microbial source locations and points of interest example file formats that document locations of farms containing domestic animals point sources that discharge directly to the stream and septic system output and boundary points as a function of latitude and longitude are captured see tables a1 a2 and a 3 respectively output points are intermediate locations within the watershed where simulation results are produced and boundary points are locations where upstream areas have been evaluated a priori and represent flow and concentration boundary conditions for downstream evaluation see table 4 latitude and longitude are used because the data gathering process on microbial sources is typically determined prior to watershed delineation and can dictate how delineation proceeds for example output and boundary locations are of particular importance and must be identified in advance sdmpb automatically delineates a watershed into subwatersheds accounting for the output and boundary locations overlays latitude longitude locations and assigns these locations to subwatersheds if locations are outside the watershed boundary these data will be ignored on the other hand non gis based models such as mwaste moore et al 1989 coli walker et al 1990 and bslc zeckoski et al 2005 assume that the watershed was delineated prior to manually assigning sources to subwatersheds and therefore do not consider points of interest such as monitoring locations or boundary conditions if the watershed is re delineated with these models users must manually repeat the process in msm delineation and overlaying of source locations are automated so mapping microbial sources and output and boundary points align exactly to the correct subwatersheds without user intervention 4 2 2 domestic animals the number and type of domestic animals associated with each farm location are considered table a1 and these numbers are used in eqs 3 8 and 16 county wide agricultural census data can be retrieved from usda 2016 although many states track the numbers and types of domestic animals by farm especially if the numbers exceed a threshold as with designated concentrated animal feeding operations cafos in mwaste coli sedmod bslc and select domestic animals are considered a major source of microbial loadings in watersheds with some differences from msm i e number of animal species consideration of manure application grazing in stream shedding etc msm s approach is more consistent with bslc but bslc also includes additional domestic animals such as goats and multiple types of chickens and turkeys msm includes a catch all category for other animals otherag in table a1 when only county level data are available zeckoski et al 2005 suggests estimating and distributing the number of animals among subwatersheds based on pasture area e g heads per area of pasture a single shedding rate is captured table a4 and associated with each domestic animal as defined in table 2 these numbers are used in eqs 3 8 and 16 a single shedding rate is consistent with other models e g mwaste coli sedmod bslc select if different age groups or types of domestic animals calf heifer cow bull steer etc are of concern for grazing shedding these may also be captured in msm using categories such as other in table 2 otherag in table a1 and otheraganimal in table a4 msm assumes that wastes generated from and associated with a location are released within the assigned subwatershed which is consistent with models such as mwaste coli sedmod and select the schedule of land application of manure for each domestic animal as the fraction of manure applied to soil used in eq 1 is captured monthly table a5 in addition the fraction of manure shed by each domestic animal eventually incorporated into soil used in eq 2 is also captured a concept consistent with coli monthly schedules capture seasonal trends and are consistent with models like coli and bslc msm considers the number of days per month that a domestic animal grazes used in eqs 6 9 and 16 and fraction of the number of grazing days per month that beef cattle spend in stream used in eqs 9 and 16 table a 6 the bslc on the other hand gives users the option to define the fraction of time livestock is confined and also considers that both dairy cows and wildlife have access to streams the msm assumes that the category dairy cow is confined and that beef cattle are allowed to graze and enter the stream these terms only differentiate between non grazing and grazing animals respectively for example if dairy cows graze and or shed directly to the stream users can designate them as beef cattle if beef cattle are restricted from entering the stream then time spent in stream can be set to zero schedules see table a 6 apply across the watershed while bslc allows schedules to vary by subwatershed the number of grazing days per month cannot be defined in other models such as mwaste coli sedmod and select 4 2 3 septic systems and point sources instream loadings from septic systems and point sources are considered see tables a 7 and a 8 respectively septics data accounts for the average number of people per septic unit fraction of systems that fail and overcharge flow rate all used in eq 17 as well as microbial density associated with the overcharge used in eq 18 information supporting septic releases represent the watershed as a whole that is the same average usage rate failure and overcharge rates and microbial densities are applied to each septic location all septic systems within each subwatershed are combined to represent a single loading to the respective subwatershed stream segment the same parameters and methodology are used in select to estimate loadings from septic systems bslc is similar since it assumes an average number of people per septic unit a human shedding rate and fraction of failures that cause septic material to rise to the land surface and be carried away by overland runoff bslc also considers septic system age oldest mid age and newest and homes that discharge directly to the stream point source discharges also include direct input to streams from engineered sources such as wwtps and potws the sdmpb consumes a single annual average discharge and microbial and chemical loading rates at specified point locations if the user wants to assess only microbes the file is modified by removing rows for chemicals if there is only one point source rows related to other point sources are removed additional point sources can be identified and added sdmpb consumes these data as a function of point source id name and latitude and longitude see table a2 it spatially overlays latitude and longitude locations onto the watershed mapping to corresponding subwatershed locations and produces the following data for watershed model consumption annual average discharge by subwatershed i ft3 s annual average microbe loading rate by subwatershed i cells yr and annual average chemical loading rate by subwatershed i lbs yr the annual average point source data are essentially placeholders for when the user replaces these constant values with actual point source time series e g daily values this is accomplished by editing the hspf wdm file through the basins inteface and activating the point source location in the hspf interface because msm consumes only microbial data chemical data are of no importance for a microbial assessment in this case and thus are not discussed automatically including a place holder in the watershed input file allows it to be more easily updated with the actual time series through watershed modeling user interfaces hspf and basins other models such as bslc and select do not directly address point sources although the user can manually account for them separately when using a watershed model other models mwaste coli and sedmod do not consider loading from point sources 4 2 4 wildlife msm considers six wildlife categories table 3 wildlife shedding rates table a4 and microbial densities table a 9 vary by land use type and appear in eq 10 wildlife is assumed to shed on forest cropland and pasture but not in urban areas or streams although certain wildlife e g geese may shed in large quantities in urban areas and streams numbers for selected wildlife such as deer are typically available for each state bslc considers seven default wildlife categories only migratory waterfowl loadings are distributed between the land surface and stream on a monthly basis although users can add additional wildlife as needed bslc assumes that wildlife sheds on forest cropland and three pasture designations select also considers wildlife by distributing the population across suitable habitats riebschleager et al 2012 other models mwaste coli and sedmod do not consider loadings from wildlife 4 2 5 microbial die off monthly first order microbial die off rates due to manure on surface soils captured by eq 15 table a10 allow users to account for variations in die off by season die off rates apply to both domestic animals and wildlife loadings to land surfaces bslc uses a constant die off rate no monthly variations while a temperature correction factor in coli and mwaste and soil ph factor in mwaste are considered sedmod and select do not consider die off bslc uses a similar approach although it provides an approximate of maximum storage limit storagelimitmonth a k a mon sqolim in hspf in eq 15 based on the asymptotic limit over the month msm however integrates the first order microbial die off equation over the month to obtain the exact closed form solution see eq 15 for example for a die off rate of 0 36 d 1 bslc has a surface accumulation multiplier of 1 77 1 10 0 36 1 versus the exact solution used in msm of 1 21 0 36 ln 10 1 4 2 6 urban sources user supplied loading rates i e wash off directly to the stream from urban areas according to the following categories and subcategories used in eq 12 are accounted for see table a4 commercial and services commercial mixed urban or built up road commercial single family low density single family high density and multi family residential residential single family low density single family high density and multi family residential transportation communications and utilities urbanized built up areas include roads road commercial property commercial single family low density residence singlefamilylowdensity single family high density residence singlefamilyhighdensity and multi family residential multi familyresidential a single weighted urbanized loading rate is quantified for each subwatershed all months based on individual urbanized land uses eqs 13 and 14 bslc and select do not consider different urbanized land use types although they capture residential areas through consideration of septic systems residential areas do not include those on a sewer network zeckoski et al 2005 or within a city limit teague et al 2009 and are mostly found in urban areas thus residential areas in these models are more applicable to rural not urban settings mwaste coli and sedmod do not consider microbial loadings to urban areas 4 2 7 supporting literature information normal microbial composition of animal feces is different from human feces and can change dramatically over time and space boehm et al 2002 dorner et al 2007 so animal and human sources of pathogens and indicators can be treated differently depending on characterization of fecal material and availability of technology that can accurately and reliably differentiate between sources epa 2009 wide variability remains within and between sites fraser et al 1998 and in relevant literature for example kim et al 2016 performed detailed monitoring of microbial release from manure and subsequent overland runoff on 36 identically prepared side by side plots in the same field which resulted in 144 plot scale rainfall runoff events the range in microbial densities was more than eight orders of magnitude wolfe et al 2016 demonstrated that microbial loading rates to a mixed use watershed based on numbers and types of domestic animals and wildlife microbial densities shedding and production rates by domestic animal wildlife and septics and microbial die off rates represent only estimates and require calibration using observed densities downstream a summary of densities and production rates is not tabularized herein although suggested values are found in the published literature soller et al 2015 and epa 2010 provided studies related to occurrence and abundance shedding densities in cells g manure of pathogens e g e coli o157 h7 campylobacter salmonella spp cryptosporidium spp giardia spp in manures from domestic animals beef cattle dairy cows and disinfected secondary effluent epa 2009 provided representative fecal indicator bacteria and zoonotic i e passage from animals to humans pathogen densities in human and animal feces and sewage soller et al 2010 documented ranges used to characterize densities of indicators e coli and enterococci and reference pathogens e coli o157 h7 cryptosporidium spp salmonella spp giardia spp norovirus in the fecal sources primary sewage secondary chlorinated effluent gulls cattle pigs chickens schoen and ashbolt 2010 epa 2010 and butler et al 2008 provided example shedding rates for cows whelan et al 2014b geldreich 1978 and asae 2005 provided manure production rates and fecal coliform shedding rates associated with various domestic animals and wildlife zeckoski et al 2005 overcash et al 1983 provided fecal coliform densities from domestic animal manures moore et al 1989 walker et al 1990 used geldreich s 1978 values for fecal coliform densities in manure they also provided suggested values for the fraction of manure incorporated by month epa 2000 provided example values for fecal coliform shed from domestic animals and wildlife fecal coliform production rates associated with urban areas road commercial single family low and high density and multi family residential and supporting information on septics users of the select model e g mcfarland and adams 2014 riebschleager et al 2012 mckee et al 2011 teague et al 2009 provided example shedding rates for e coli based on fecal coliform production rates for domestic animals and wildlife epa 2001b assuming a fecal coliform to e coli conversion factor of 0 5 recommended by doyle and erickson 2006 riebschleager et al 2012 and teague et al 2009 provided production rates for septic on site wastewater treatment systems and riebschleager et al 2012 also considered urban development and built areas including low medium and high density land use consisting of single and multi family housing commercial service industrial and utilities transportation kim et al 2016 provided a summary of e coli die off rates from published literature crane and moore 1986 wang et al 2004 meals and braun 2006 gu et al 2012 blaustein et al 2013 martinez et al 2013 oladeinde et al 2014 based on moore et al 1988 walker et al 1990 and moore et al 1989 tried to account for bacterial die off in stored manure 4 3 workflow instantiation instantiation of the qmra workflow fig 1 begins with the user initiating sdmpb d4em then navigating the united states by state county and 8 digit hydrologic unit code huc 8 which typically represents an area of 1800 km2 700 mi2 from here the user may stay with the huc 8 selection or select a different pour point or huc 12 100 km2 40 mi2 of interest whelan et al 2015c with user defined simulation output intervals hourly daily etc simulation start and end times selected data sources and a pour point selection sdmpb automatically identifies the upstream basin boundary and registers the 12 user defined csv data files table 4 and appendix a whelan et al 2015b the number of subwatersheds can also be controlled with user defined minimum subwatershed areas and stream lengths the sdmpb manages data acquisition from standard national databases with d4em and caches web based data table 5 coupled with boundary and output points e g table a3 and user defined minimum stream lengths and subwatershed areas the sdmpb produces a delineated watershed fig 2 of 1358 km2 524 mi2 containing a suite of gis map layers that include gaging stations farms with domestic animal and septic system locations waterbody network elevation e g slope soil types land use types and met stations number and type of domestic animals as well as wildlife density were collected a priori although these data exist they are not always routinely known due to privacy security the msm develops microbial loadings e g cells area time adjusted for die off to the overland subwatershed areas by land use and to instream e g cells time locations within a watershed the sdmpb automatically pre populates input needs of the fate and transport watershed model hspf by automatically creating its users control input uci file a collection of geospatial data files a dotspatial based project file and a mapwindow based project file wmprj currently used by basins using hspf basins windows interfaces non spatially related data may be modified without re delineation for example if a point source exists within the watershed its time series loadings can be registered within basins prior to hspf execution replacing the annually averaged default values provided in the csv file e g table a8 hspf is then executed creating flows and microbial concentrations that are spatially and temporally distributed throughout the watershed e g whelan et al 2015c basins e g epa 2013b 2013c whelan et al 2015c provides a user interface and visualization tool for hspf and accesses gage data for subsequent inverse modeling pest uses hspf flow and microbial density simulations with monitored flow and microbial density data at the pour point for an initial calibration that will require a final manual calibration hspf flow calibration has been discussed by duda et al 2012 key calibration parameters produced by msm and consumed by hspf included loadings by microbe and by land use type maximum microbial storage accumulation on the land surface and point source loading rates to the stream from septic systems and direct shedding key hspf microbial calibration parameters include rate of surface runoff which removes 90 of stored microbes per hour instream first order die off rate and temperature correction for first order die off although microbial densities in interflow and groundwater outflow can be considered they were set to zero because local well data indicated an absence of enterococci using basins as a viewer figs 3 and 4 overlay time series of the initial uncalibrated results those calibrated with pest and the monitored gage data at the watershed pour point used in the calibration fig 3 plots flow data while fig 4 plots microbial densities the improvement is significant when gage data are factored into the assessment the correlation coefficient r for flow was 0 86 while it was 0 45 for microbial density based on only 41 samples over two summers 24 from 2011 to 17 from 2012 the microbial calibration shows poor correlation at very low densities as illustrated by the 2011 observations in fig 4 pest minimizes the squared error by not weighting the smaller values as heavily hence the better correlation at higher more important densities wolfe et al 2016 demonstrated this when only 17 higher valued observations were initially employed in their calibration r 0 70 their densities during winter months were not much different than those during the summer months however by incorporating additional data even though they contained more variability i e 2011 data in fig 4 base flow due to groundwater is now more appropriately captured during non summer months resulting in densities one to two orders of magnitude lower than summer values additional sampling would confirm these findings and add to the final calibration a typical problem with microbial watershed assessments is lack of data which limits the ability to fully understand and capture nuances of cause and effect of microbial levels within the watershed wolfe et al 2016 the initial uncalibrated simulation illustrates the need to anchor modeling to sampling monitoring in fact even with limited samples an initial calibration can significantly improve the uncalibrated results as illustrated by figs 3 and 4 because results are for an indicator not a pathogen there is no risk of infection although the framework is designed to simulate risk of infections to pathogens risk is not computed in the example because results are for an indicator whelan et al 2014b presents an example where risk is computed for pathogens 5 limitations and future efforts 5 1 limitations although msm and hspf are not specific to the continental united states the qmra system is currently designed to access databases that specifically support assessments within the united states msm accounts for variations in monthly agricultural practices in a typical one year cycle i e january december but does not account for variations from year to year the only direct input to streams from shedding is from cattle neglecting other domestic animals wildlife and birds source term data requirements documented in appendix a are typically available in various forms at the state level whelan et al 2017 but currently in a form that requires the user to manually search existing documentation capturing these data in a searchable state by state database would be a significant improvement data access and retrieval would be automated which would result in more consistency fewer errors associated with data transfer and faster assessments the user is currently required to re run sdmpb to change the spatial delineation of the watershed e g number of subwatersheds once sdmpb has been executed even though the current process is automated executing re delineations on the fly would speed the selection of the most appropriate user required resolution once the spatial delineation of the watershed is determined by executing sdmpb the user can change parameter values but not the spatial orientation or delineation of the watershed through hspf and basins user interfaces yakirevich et al 2014 note that bottom sediments have been shown to be an important reservoir of e coli since they can survive and grow in streambed sediments cho et al 2016a 2016b pachepsky and shelton 2011 existing frameworks for modeling microbial transport in steams including our qmra framework disregard the effect of transient storage dead end zones represented by stagnant pools eddies etc bencala and walters 1983 gooseff et al 2008 which does not allow one to simulate long tails observed in the time series of microbial densities yakirevich et al 2014 cho et al 2016b introduced temperature as a critical parameter in simulating bacterial growth die off and reproducing seasonal variability of bacteria msm allows the user to account for seasonal variations in inactivation die off with monthly values see table a10 hspf has limitations in simulating seasonal variability of microbes as it excludes simulations of alternating bacterial growth and die off by temperature 5 2 future efforts a storm drain or sewer is designed to drain excess rain and groundwater from impervious surfaces such as paved streets parking lots footpaths sidewalks and roofs to and through a water distribution system such as pipes flow from impervious areas in the current qmra framework is simulated in hspf by assuming runoff directly enters the stream therefore stormwater runoff through a channel network is unaccounted for recent research and modifications have been made to hspf using swmm epa 2016b to more appropriately account for urbanization by incorporating stormwater drainage into hspf mohamoud and flaishans 2013 if deemed an improvement in urban areas the current version of hspf will be replaced by this modified version the qmra system is being exercised on watersheds across the united states e g manitowoc wi tillamook or biloxi ms teton river id salt river id to determine its efficacy in supporting microbial source allocation assessments a number of these studies investigate 1 which sources and their locations and under what environmental conditions have the greatest impact on downstream microbial density levels within the basin and 2 which strategies mitigate adverse impacts on downstream locations there is currently a two step process for registering point source data direct discharge from potws wwtps within the qmra process 1 sdmpb formats the hspf uci file to receive and account for point source data recorded as annual average loadings then 2 hspf and basins user interfaces replace these data with the actual time series automating the process of seamlessly registering point source data would result in more consistency a reduction in errors associated with data transfer and faster assessments the current version of the qmra framework is loosely configured d4em sdmpb and msm are seamlessly linked and executed within a single user interface the user currently executes hspf basins pest and mra it separately input files for execution are automatically constructed although the user can edit them even though these assessments can be completed in hours or days versus months and years expanding the single user interface concept to seamlessly execute all components would improve usability and repeatability 6 summary a quantitative microbial risk assessment qmra integrates databases and interdisciplinary multiple media exposure and effects models assessment of predicted indicator concentrations from modeling could be used in determining the appropriateness of waivers to criteria and standards concentration numbers on the basis of site specific environmental settings and source conditions although qmra does not preclude using source term data and source and watershed models it starts and is applied most commonly at the exposure point skipping release and transport the work described here documents a new microbial source module msm and describes its mathematical formulations and integration in an environmental modeling workflow to support qmras the msm estimates microbial loadings within a mixed use watershed due to land application and shedding of manure from domestic animals and wildlife to pervious areas e g cropland pasture and forest from cattle shedding directly to streams and from failing septic systems discharging to streams msm loadings are monthly the msm has been seamlessly linked with a user interface that consumes a suite of comma separated values csv files that supply user defined microbial data the interface is based on the data for environmental modeling d4em and site data manager project builder sdmprojectbuilder or sdmpb the two components are linked to include sdmprojectbuilder d4em msm accessing and reading the microbial input csv files and constructing and populating the hydrological simulation program fortran hspf input file the process has been automated from source to receptor within a loosely coupled workflow which allows many of the components to operate individually or within the workflow msm works with the sdmpb to read a pre populated file with microbial source locations animal numbers and types agricultural animals cattle swine poultry etc wildlife ducks deer etc manure application schedules grazing patterns and point source releases septic systems where applicable source locations are defined by latitude longitude and correlated with land use type built up impervious pastureland cropland or forest and subwatersheds delineated by the sdmpb the msm develops monthly microbial loadings adjusted for die off to the soil surface by land use type and to the stream engineered point source releases are captured by sdmpb as annual average point source data that represent placeholders so the user can replace these constant values with actual point source time series e g daily values using hspf and the better assessment science integrating point non point sources basins system the sdmpb automatically pre populates the hspf input file with microbial loading rates and other data needs automating data collection and input needs significantly reduces data transfer errors decreases time for assessment set up and execution and allows the user to focus on interrogating results hspf routes microbes to the watershed pour point and basins provides a user interface and visualization tool for hspf and accesses gage data for subsequent inverse modeling using parameter estimation and uncertainty analysis pest pest uses hspf flow and microbial density simulations with monitored flow and microbial density data at the pour point to provide an initial calibration of microbial loadings and densities an example is presented and although hypothetical it accesses retrieves and uses real world data it also illustrates the importance of using microbial observations in an assessment acknowledgements the united states environmental protection agency epa through its office of research and development partially funded and collaborated in the research described here under dw 089 92399101 to idaho national laboratory dw 012 92348101 to the u s department of agriculture agricultural research service and ep c 12 021 wa 3 52 to eastern research group inc thanks are extended to ms fran rauschenberg of epa for editing the document mention of trade names or commercial products does not constitute endorsement or recommendation for use it has been subjected to agency review and approved for publication appendix a user supplied microbial source term data examples of 12 comma separated values csv files that capture data needs for a microbial assessment three of which have the same format are documented in the following 10 tables table 4 can be used to help correlate parameter names and their units with the information contained within tables a1 through a10 locations of farms that contain domestic animals point sources that discharge directly into the stream and septic system output and boundary points are documented in tables a1 a2 and a3 respectively output points are intermediate locations within the watershed where simulation results are produced boundary points are locations where upstream areas have been evaluated a priori and represent flow and concentration boundary conditions for downstream evaluation information associated with domestic animals is captured in tables a1 and a4 through a6 instream loadings from septic systems and point sources are shown in tables a3 and a7 and tables a2 and a8 respectively wildlife shedding rates and wildlife densities by land use type are captured in tables a4 and a9 respectively table a4 also captures loading rates associated with four different urbanized built up areas with each sub divided as appropriate into urbanized sub categories monthly first order microbial die off rates in surface soils appear in table a10 table a 1 animalll csv template and example data table a 1 latitude longitude beefcow swine dairycow poultry horse sheep otherag 44 23752 88 0046 30 0 30 0 0 0 0 44 19700 88 0954 0 0 0 0 0 0 0 44 16789 88 0410 75 0 75 0 0 0 0 44 05979 87 8475 0 0 0 93 0 0 0 44 09854 88 0243 0 0 0 66 0 0 0 44 08787 87 9167 0 0 0 25 0 0 0 table a 2 pointsourcell csv template and example data for two point sources table a 2 latitude longitude ptsrcid 44 112 88 256 pt001 44 06 88 191 pt002 table a 3 template and example data for septicsll csv outputpointsll csv and boundarypointsll csv table a 3 latitude longitude 44 23752 88 0046 44 19700 88 0954 44 09854 88 0243 44 08787 87 9167 table a 4 fcprodrates csv template and example shedding rates by domestic animal and wildlife and production rates by urban built up areas table a 4 source value units dairycow 2 50e 10 countperanimalperday beefcow 3 30e 10 countperanimalperday swine 1 10e 10 countperanimalperday sheep 1 20e 10 countperanimalperday horse 4 20e 08 countperanimalperday poultry 1 31e 08 countperanimalperday duck 2 40e 09 countperanimalperday goose 8 00e 08 countperanimalperday deer 3 50e 08 countperanimalperday beaver 2 50e 08 countperanimalperday raccoon 1 25e 08 countperanimalperday otheraganimal 0 00e 00 countperanimalperday otherwildlife 0 00e 00 countperanimalperday road 2 00e 05 countperacreperday commercial 6 21e 06 countperacreperday singlefamilylowdensity 1 03e 07 countperacreperday singlefamilyhighdensity 1 66e 07 countperacreperday multifamilyresidential 2 33e 07 countperacreperday table a 5 manureapplication csv template and example data table a 5 manuretype janfractionapplied febfractionapplied marfractionapplied aprfractionapplied mayfractionapplied junfractionapplied julfractionapplied augfractionapplied sepfractionapplied octfractionappied novfractionapplied decfractionapplied fractionincorporatedintosoil swinemanure 0 0 0 0 15 0 3 0 2 0 15 0 1 0 05 0 05 0 0 0 8 cowmanure 0 0 0 0 15 0 3 0 2 0 15 0 1 0 05 0 05 0 0 0 75 cattlemanure 0 0 0 0 15 0 3 0 2 0 15 0 1 0 05 0 05 0 0 0 75 horsemanue 0 0 0 0 1 0 1 0 0 0 0 0 4 0 4 0 0 75 poultrylitter 0 0 0 0 15 0 3 0 2 0 15 0 1 0 05 0 05 0 0 0 96 table a 6 grazingdays csv template and example data table a 6 month beefcattlegrazingdays horsegrazingdays sheepgrazingdays otheraganimalgrazingdays fractionoftimebeefcattleinstreams january 0 3 1 31 0 0 february 0 2 8 28 0 0 march 0 3 31 0 0 april 30 27 30 0 0 may 31 27 9 31 0 0 june 30 27 30 0 0 1 july 31 27 9 31 0 0 1 august 31 27 9 31 0 0 1 september 30 27 30 0 0 october 31 27 9 31 0 0 november 0 27 30 0 0 december 0 3 1 31 0 0 table a 7 septicsdatawatershed csv template and example data correlated with septicsll csv table a 7 numberofpeoplepersepticunit septicfailurerate fraction septicoverchargeflowrate gallonsperdayperperson fcconcentrationreachingstreamfromsepticovercharge countsperliter 3 75 0 12 70 1 0e 7 table a 8 pointsourcedata csv template and example data for two point sources with flow microbes and chemicals correlated with pointsourcell csv table a 8 ptsrcid facname load parm pt001 pointsource1 1 flow pt001 pointsource1 1000 microbes pt001 pointsource1 5 diazinon pt002 pointsource2 2 flow pt002 pointsource2 2000 microbes pt002 pointsource2 4 diazinon table a 9 wildlifedensities csv template and example data table a 9 animal densitypersqmile cropland densitypersqmile pasture densitypersqmile forest duck 14 13 14 13 14 13 goose 2 22 2 22 2 22 deer 20 51 20 51 20 51 beaver 0 0 0 raccoon 0 0 0 otherwildlife 0 0 0 table a 10 template and example data for monthlyfirstorderdieoffrateconstants csv table a 10 month dieoffratecontant january 0 027 february 0 035 march 0 042 april 0 050 may 0 058 june 0 065 july 0 073 august 0 065 september 0 058 october 0 050 november 0 042 december 0 035 appendix b software data availability categories of free and nonfree software include the following gnu 2013a 2013b free i e open source software that permits anyone to use copy and or distribute verbatim or with modifications gratis or for a fee most free software is copyrighted and the copyright holders have legally given permission to use it with a free software license public domain software is not copyrighted proprietary i e non free software is licensed under the exclusive legal rights of its owner msm software developer epa address epa 960 college station road athens ga 30605 usa tel 1 706 355 8306 fax 1 706 355 8302 e mail parmar rajbir epa gov first available 2016 hardware requirements 1 5 ghz cpu 2 gb ram software requirements windows 7 availability open source no license source code available upon request cost free program language c program size 202 kb on disk after installation software access https github com usepa microbialsourcemodule sdmpb software developer epa respec address epa 960 college station road athens ga 30605 usa tel 1 706 355 8306 fax 1 706 355 8302 e mail parmar rajbir epa gov first available 2016 hardware requirements 2 ghz cpu 4 gb ram software requirements windows 7 availability open source no license source code available upon request cost free program language vb net c program size 523 mb mb on disk after installation software access https github com usepa d4em tree master sdmpb d4em software developer epa respec address epa 960 college station road athens ga 30605 usa tel 1 706 355 8306 fax 1 706 355 8302 e mail parmar rajbir epa gov first available 201x hardware requirements 2 0 ghz cpu 4 gb ram software requirements windows 7 availability open source no license source code available upon request cost free program language vb net c program size 200 mb on disk after installation software access https github com usepa d4em hspf software developer epa respec address epa 960 college station road athens ga 30605 usa tel 1 706 355 8306 fax 1 706 355 8302 e mail parmar rajbir epa gov first available 1970 hardware requirements 1 ghz cpu 4 gb ram software requirements windows 7 availability open source no license source code available upon request cost free program language fortran program size 6 4 mb on disk after installation software access https www epa gov exposure assessment models hspf basins software developer epa respec address epa 960 college station road athens ga 30605 usa tel 1 706 355 8306 fax 1 706 355 8302 e mail parmar rajbir epa gov first available 2008 hardware requirements 2 ghz cpu 4 gb ram software requirements windows 7 availability open source no license source code available upon request cost free program language vb net c program size 2 gb on disk after installation software access https www epa gov exposure assessment models basins pest software developer john doherty address flinders university gpo box 2100 adelaide 5001 south australia tel 1 301 718 8900 s s papadopulos associates e mail john doherty flinders edu au first available 1994 hardware requirements 1 ghz cpu 2 gb ram software requirements windows 7 availability open source no license cost free program language fortran or unix program size 50 mb 3 mb on disk after installation software access http www pesthomepage org downloads php 
26471,many watershed models simulate overland and instream microbial fate and transport but few provide loading rates on land surfaces and point sources to the waterbody network this paper describes the underlying equations for microbial loading rates associated with 1 land applied manure on undeveloped areas from domestic animals 2 direct shedding excretion on undeveloped lands by domestic animals and wildlife 3 urban or engineered areas and 4 point sources that directly discharge to streams from septic systems and shedding by domestic animals a microbial source module which houses these formulations is part of a workflow containing multiple models and databases that form a loosely configured modeling infrastructure which supports watershed scale microbial source to receptor modeling by focusing on animal and human impacted catchments a hypothetical application accessing retrieving and using real world data demonstrates how the infrastructure can automate many of the manual steps associated with a standard watershed assessment culminating in calibrated flow and microbial densities at the watershed s pour point keywords integrated environmental modeling qmra risk assessment pathogens manure watershed modeling 1 introduction the united states environmental protection agency epa is interested in characterizing managing and minimizing the risks of human exposure to pathogens in water resources impacted by effluents and runoff from both agricultural activities and built infrastructure epa 2016a indicates that 52 8 of the assessed river and stream miles are impaired with pathogens being the main cause followed by sediment contamination and nutrients the designation pathogen is used in the broadest sense based upon detection of fecal indicator bacteria fib escherichia coli e coli and fecal coliforms monitoring for the presence of pathogens in manure and sewage contaminated waters is extremely challenging as pathogen concentrations in water samples are often low such low concentrations make detection unfeasible unless large volumes of water are analyzed most monitoring approaches and microbial water quality regulations are based on indicator bacteria since they are easier to sample and quantify epa 2012 2015 although good correlations between indicators and pathogens may be suspect for example haack and duris 2013 note that there is a widely acknowledged variable relationship between fib and pathogen concentrations field and samadpour 2007 savichtcheva et al 2007 therefore states might avail themselves of water quality criteria if they can demonstrate an equivalent level of public health protection with higher indicator concentrations agriculture is one of the most likely causes of pollution affecting almost 13 of the total river miles assessed since applying manure for crop nutrition and production and animal shedding due to grazing are common practices manure applications may carry environmental contaminants such as pathogens organic chemical residues and heavy metals edwards and daniel 1992 these contaminants adversely affect water quality mainly due to runoff producing rainfall events among the various animal fecal sources poultry are responsible for 44 of the total feces production in the united states followed by cattle 31 and swine 24 kellog et al 2000 in comparison humans contribute only a small fraction 0 7 on an equal weight basis however human sewage wastewater is generally thought to constitute a much higher risk to public health due to the likelihood of viral pathogen presence soller et al 2010 schoen et al 2011 dufour 1984 models can play a role in assessing the distribution of microbes in a mixed use watershed and the potential risks associated with both measured and predicted indicator concentrations i e degree to which concentrations indicate threats to public health under varying circumstances assessment of potential risks is critical in determining the appropriateness of waivers to criteria and concentration standards based on site specific environmental settings and source conditions site surveys coupled with modeling tools are a basic way to identify sources characterizing them associate a level of infectivity with the source and assess its level of impact at the point of exposure a quantitative microbial risk assessment qmra is a source to receptor modeling approach that integrates disparate data such as fate transport exposure and human health effect relationships to characterize the distribution of indicator and pathogenic microbes within a watershed and the potential health impacts risks from exposure to pathogenic microorganisms soller et al 2010 whelan et al 2014a 2014b haas et al 1999 hunter et al 2003 as whelan et al 2014b note a qmra s conceptual design fits well within an integrated multi disciplinary modeling perspective which describes the problem statement data access retrieval and processing e g d4em epa 2013a wolfe et al 2007 software frameworks for integrating models and databases e g frames whelan et al 2014b johnston et al 2011 infrastructures for performing sensitivity variability and uncertainty analyses e g supermuse babendreier and castleton 2005 and risk quantification coupling modeling results with epidemiology studies allows policy related issues epa 2010 epa and usda 2012 for example to be explored an important aspect of the integrated environmental modeling iem laniak et al 2013 microbial workflow is its ability to define spatial and temporal microbial loadings from human and animal sources within a mixed use watershed multiple software tools have been developed to estimate microbial source loadings to a watershed such as mwaste coli sedmod modifications to swat select bit and bslc moore et al 1989 developed mwaste to simulate waste generation and calculate bacterial concentrations in runoff from the land applied waste of various animals and management techniques mwaste only considers animal borne bacteria and allows only one animal per execution so multiple runs are required for the consideration of different animal species walker et al 1990 developed the coli model to predict bacteria concentration in runoff resulting from a single storm occurring immediately after land application of manure it uses a monte carlo simulation to combine a deterministic relationship with rainfall and temperature variations and calculates maximum and minimum bacteria concentration in runoff fraser et al 1996 developed a gis based spatially explicit delivery model sedmod that estimates spatially distributed delivery ratios for eroded soil and associated nonpoint source pollutants the model predicts fecal coliform loading in rivers and calculates pollutant loadings in streams by multiplying livestock fecal coliform output and a delivery ratio estimated for each watershed cell to predict the proportion of eroded sediment or other non point source pollutant transported from the cell to the stream channel parajuli 2007 manually estimated fecal bacterial loading considering different sources such as livestock manure application grazing human septic and wildlife for the swat bacteria sub model guber et al 2016 followed this up with a limited effort that integrated infection and recovery of white tailed deer and cattle into the watershed model swat it predicted pathogen transmission between livestock and deer by considering seasonal changes in deer population habitat and foliage consumption ingestion of pathogens with water foliage and grooming soiled hide by deer and grazing cattle infection and recovery of deer and co grazing cattle pathogen shedding by infected animals survival of pathogens in manure and kinetic release of pathogens from applied manure and fecal material teague et al 2009 developed the spatially explicit load enrichment calculation tool select to identify potential e coli sources in plum creek watershed in texas select is a grid based load assessment tool that considers multiple point and non point sources wastewater treatment plant livestock pets wildlife septic urban riebschleager et al 2012 automated select within arcgis and added the pollutant connectivity factor component which is based on potential pollutant loading runoff potential and travel distance select has been used to identify e coli teague et al 2009 mckee et al 2011 riebschleager et al 2012 mcfarland and adams 2014 borel et al 2015 and enterococci borel et al 2015 sources in multiple watersheds in texas the bacterial indicator tool bit estimates microbial loading from domestic animals wildlife and human activities to a mixed use watershed epa 2000 it accounts for land application of manure and direct shedding from certain domestic animals to pasture and cropland and from wildlife to cropland pasture and forest it also estimates point source loadings from septic system failures and direct shedding to the stream from certain domestic animals finally it accounts for loading in urban built up areas such as residential commercial transportation etc bit uses microsoft excel for calculations and considers only 10 subwatersheds when distributing loads land applied loading rates are adjusted for die off all loadings vary monthly except for those from wildlife in urban areas and from septic systems which use constant loading rates to the stream based on the fraction of septic systems that fail urbanized areas include categories such as commercial mixed urban or built up residential and roadways loading rates to urbanized areas are supplied by the user although default values are suggested stormwater runoff through drainage pipes and combined and non combined sewer systems are not accounted for in a similar manner to bit the bacterial source load calculator bslc was designed to organize and process bacterial inputs for a total maximum daily load tmdl bacterial impairment analysis zeckoski et al 2005 bslc calculates bacterial loads based on animal numbers and default values for manure and bacterial production rates accounting for die off and the fraction of domestic animal confinement it uses externally generated user supplied inputs of watershed delineations and land use distribution as well as domestic animal wildlife and human population estimates to suggest monthly land based and hourly stream based bacterial loadings neither bit nor bslc offer software that supports data collection to meet model input requirements although their documentation suggests some default values prior to allocating microbial sources within a watershed the watershed must first be delineated into subwatersheds which are the smallest modeling units to do so many models require users to manually and externally delineate a watershed then manually assign environmental characteristics animal numbers and types farming practices and human activities to each subwatershed this can be a daunting task especially if the user re delineates the watershed because the delineation pattern determines size and location of subwatersheds it has a significant impact on distribution and magnitude of microbial loading rates within them hence it is desirable to have an automated process to delineate a watershed populate its subwatersheds with environmental characteristics land use types waterbody network slope soil type meteorological met data etc and overlay sources of microbial contamination so appropriate loading rates can be easily computed on land and in stream the work reported here describes the expansion and modification of bit developing a new microbial source module msm wolfe et al 2016 whelan et al 2015a additionally its use and implementation was demonstrated as a component of an iem workflow the workflow automates the manual processes that perform qmras on mixed use watersheds anywhere in the united states by determining microbial sources and estimates of microbial loadings to land and streams the mathematical formulations of msm and its context within an iem workflow are described here 2 materials and methods the msm organizes analyzes and supplies data that calculates microbial loading rates within subwatersheds the smallest spatial units for data that it consumes and produces msm correlates sources to cropland pasture forest and urbanized mixed use land use types for each subwatershed microbial sources include numbers and locations of domestic agricultural animals dairy and beef cattle swine poultry etc and wildlife deer duck raccoon etc with estimated shedding rates manure application rates where manure is directly incorporated into cropland s and pasture s soil and loading rates due to urbanized mixed use activities commercial transportation etc manure contains microbes and the monthly maximum microbial storage and accumulation rates on the land surface adjusted for die off are computed over a season to represent the source for overland fate and transport to instream locations monthly point source microbial loadings to instream locations are also determined for septic systems and instream shedding by cattle the type of septic system e g gravity pressure distribution sand filter or mound is not differentiated in the model flow microbial and chemical loadings also originate from point sources such as publicly owned treatment works wastewater treatment plants potws wwtps although they are not simulated their discharge time series can be accounted for as direct input to the watershed model the user interface that externally supports msm automatically formats the watershed input file so when the user registers the potws wwtps time series it is seamlessly incorporated into the input file the msm has been seamlessly linked with a user interface based on data for environmental modeling d4em and site data manager project builder sdmprojectbuilder or sdmpb these three components are part of an iem workflow also containing the hydrologic simulation program fortran hspf watershed model bicknell et al 1997 better assessment science integrating point and nonpoint sources basins modeling infrastructure epa 2001a and parameter estimation and uncertainty analysis pest inverse model doherty 2005 2 1 assumptions and constraints assumptions and constraints associated with the msm are presented in table 1 and correlations between manure application land use type domestic animal and wildlife are summarized in table 2 an index glossary that correlates subscripts used in the mathematical formulas is provided in table 3 2 2 land application of domestic animal manure as indicated in table 2 cropland and pasture are land use types that receive land applied domestic animal manure and whose mathematical formulations are described in the following sections 2 2 1 domestic animal waste available for land application the fraction of annual manure application available for runoff each month by domestic animals based on the monthly fraction applied and incorporated into the soil is computed as follows epa 2013b 2013c 1 f r a c t i o n m a n u r e a v a i l a b l e r u n o f f m q a p p l i c a t i o n m q a n i m a l f r a c t i o n a v a i l a b l e m in which 2 a n i m a l f r a c t i o n a v a i l a b l e m 1 m a n u r e i n c o r p o r a t e d i n t o s o i l m 2 m 1 2 3 or 5 1 m a n u r e i n c o r p o r a t e d i n t o s o i l m 3 m 4 where f r a c t i o n m a n u r e a v a i l a b l e r u n o f f m q is the fraction of annual manure application available for runoff by month q by domestic animal m equivalent to the ratio of microbial cells available for runoff each month to cells available for runoff per year ratio a p p l i c a t i o n m q is the fraction of annual manure applied each month q by domestic animal m equivalent to the ratio of cells applied each month to cells applied per year ratio m a n u r e i n c o r p o r a t e d i n t o s o i l m is the fraction of applied manure incorporated into the soil by domestic animal m ratio and a n i m a l f r a c t i o n a v a i l a b l e m is the fraction of domestic animal m manure available for runoff ratio 2 2 2 land application of manures from domestic animals the monthly microbial loading rate from land application of domestic animal manure associated with each subwatershed by land use type is equal to 3 m i c r o b e r a t e a p p l y i k m q 0 for m 1 or 2 and k 3 or 4 m 3 or 4 and k 2 3 or 4 m 5 and k 1 3 or 4 m 6 or 7 and k 1 2 3 or 4 n u m b e r o f a n i m a l s i m m i c r o b e a n i m a l p r o d u c t i o n r a t e s m f r a c t i o n m a n u r e a v a i l a b l e r u n o f f m q a p p l y m o n t h s q a p p l y a r e a i k in which 4 a p p l y m o n t h s q 365 d a y i n m o n t h q for m 1 and k 1 or 2 m 3 or 4 and k 1 365 t o t a l g r a z e d a y s m d a y i n m o n t h q for m 2 and k 1 or 2 m 5 and k 2 5 a p p l y a r e a i k a r e a t i for m 1 or 2 and k 1 or 2 a r e a i k for m 3 or 4 and k 1 m 5 and k 2 6 t o t a l g r a z e d a y s m q g r a z i n g d a y s m q 7 a r e a t i k 1 2 a r e a i k where m i c r o b e r a t e a p p l y i k m q is the microbial loading rate per area to land use type k from land application of domestic animal m manure by month q by subwatershed i cells time area n u m b e r o f a n i m a l s i m is the number of domestic animals m by subwatershed i number of domestic animal m i c r o b e a n i m a l p r o d u c t i o n r a t e s m is the microbial production rate shed per domestic animal m cells d domestic animal equals the multiple of domestic animal shedding rate of waste in mass of wet weight ww per time mass d domestic animal and microbial density concentration based on mass of waste shed by domestic animal cells mass a p p l y m o n t h s q is the conversion for the number of months per year weighted by the actual number of days in month q when land application of manure might be possible mo yr a p p l y a r e a i k is the area associated with the land application of manure by subwatershed i by land use type k 365 is the conversion constant for days in a year d yr d a y i n m o n t h q is the conversion constant for days per month q january 31 february 28 december 31 in which the months are indexed by q as 1 january 12 december d mo g r a z i n g d a y s m q is the number of grazing days by domestic animal m per month q d mo t o t a l g r a z e d a y s m is the total number of grazing days per year for domestic animal m d yr a r e a i k is the subwatershed i area by land use type k area and a r e a t i is the total summed area for cropland k 1 and pasture k 2 by subwatershed i area 2 3 domestic animal and wildlife shedding rates to land surfaces land use types that receive domestic animal and wildlife shedding are captured in table 2 the monthly microbial loading rates to different land use types due to shedding from domestic animals while grazing by subwatershed is equal to 8 m i c r o b e r a t e s h e d i k m q 0 for m 1 3 or 4 and k 1 2 3 or 4 m 2 5 6 or 7 and k 1 3 or 4 n u m b e r o f a n i m a l s i m s h e d m o n t h s m q m i c r o b e a n i m a l p r o d u c t i o n r a t e s m a r e a i k in which 9 s h e d m o n t h s m q g r a z i n g d a y s m q 1 t i m e s p e n t i n s t r e a m s m q d a y i n m o n t h q for m 2 and k 2 g r a z i n g d a y s m q d a y i n m o n t h q for m 5 6 or 7 and k 2 where m i c r o b e r a t e s h e d i k m q is the microbial loading rate to land use type k due to grazing of domestic animal m by month q by subwatershed i cells time area and s h e d m o n t h s m q is the fraction of the month q that domestic animal m spends grazing shedding ratio and t i m e s p e n t i n s t r e a m s m q is the fraction of the number of grazing days that domestic animal m spends in a stream each month q ratio the monthly microbial loading rates to different land use types due to shedding from wildlife equals 10 w i l d l i f e m i c r o b e r a t e s h e d k n d e n s i t y k n m i c r o b e w i l d l i f e p r o d u c t i o n r a t e s n for k 1 2 or 3 0 for k 4 where w i l d l i f e m i c r o b e r a t e s h e d k n is the microbial shedding rate per area by wildlife n by land use type k cells time area d e n s i t y k n is the number of wildlife n per area by land use type k number of wildlife area and m i c r o b e w i l d l i f e p r o d u c t i o n r a t e s n is the microbial shedding rate per wildlife n cells time number of wildlife the total microbial shedding rate per land use type per area summed across all wildlife is 11 w i l d l i f e m i c r o b e r a t e s h e d s u m k n 1 6 w i l d l i f e m i c r o b e r a t e s h e d k n where w i l d l i f e m i c r o b e r a t e s h e d s u m k is the microbial shedding rate per area by land use type k summed across all wildlife cells time area 2 4 accumulated microbial loading rates on urbanized areas urbanized land use is divided into four urbanized categories r 1 for commercial and services r 2 for mixed urban or built up r 3 for residential and r 4 for transportation communications and utilities which are further divided into urbanized sub categories u 1 for commercial u 2 for single family low density u 3 for single family high density u 4 for multi family residential and u 5 for road single family low density is a single detached dwelling single family residence or separate house that is a free standing residential building wikipedia 2015a single family high density is a suite of smaller scale single family dwellings representing a more compact single family residential development 13 40 units ac garnett 2012 multi family residential is a unit with multiple separate housing units for residential inhabitants contained within one building or several buildings within one complex such as an apartment or condominium wikipedia 2015b accumulation rates in median microbial cells per urbanized land use type r per area per time indexed by the urbanized subcategories u are computed as follows 12 b u i l t u p r a t e k r s u b u r b a n i z e d b u i l t u p r a t e u for k 4 r 1 u 1 u 1 5 s u b u r b a n i z e d b u i l t u p r a t e u 5 for k 4 r 2 u 2 4 s u b u r b a n i z e d b u i l t u p r a t e u 3 for k 4 r 3 s u b u r b a n i z e d b u i l t u p r a t e u for k 4 r 4 u 5 where b u i l t u p r a t e k r is the accumulation rate in median microbial cells per urbanized land use type k 4 per area per time indexed by the urbanized category r by urbanized sub category u cells time area and s u b u r b a n i z e d b u i l t u p r a t e u is the general microbial loading rate by urbanized sub category u cells time area accumulated microbial loading rate associated with the urbanized land use type per subwatershed weighted by the areas associated with the four urbanized categories for all months i e applicable throughout the year is computed as follows 13 a c c u m b u i l t u p r a t e i k 0 for k 1 2 or 3 r 1 4 a r e a f r a c t i o n i k r b u i l t u p r a t e k r for k 4 where a c c u m b u i l t u p r a t e i k is the accumulated microbial loading rate associated by land use type k by subwatershed i weighted by areas associated with four urbanized categories r for all months i e throughout the year cells time area and a r e a f r a c t i o n i k r is the fraction of land use type k indexed to the four subcategories of urbanized r by subwatershed i 2 5 accumulated overland microbial loading rates to land surfaces and maximum microbial storage adjusted for removal land use types that receive domestic animal and wildlife shedding are captured in table 2 and described in the following sections 2 5 1 accumulated overland microbial loading rates to land surfaces the overland microbial loading rates to land surfaces accumulated for shedding and land application are computed by subwatershed by month across all domestic animals and wildlife are computed for the different land use types as follows 14 a c c u m u l a t i o n r a t e m o n t h i k q w i l d l i f e m i c r o b e r a t e s h e d s u m k m 1 4 m i c r o b e r a t e a p p l y i k m q for k 1 w i l d l i f e m i c r o b e r a t e s h e d s u m k m 1 2 5 m i c r o b e r a t e a p p l y i k m q m 2 5 6 7 m i c r o b e r a t e s h e d i k m q for k 2 w i l d l i f e m i c r o b e r a t e s h e d s u m k for k 3 a c c u m b u i l t u p r a t e i k for k 4 where a c c u m u l a t i o n r a t e m o n t h i k q is the microbial loading rate by subwatershed i by month q across all domestic animals m and wildlife n for each land use type k cells time area 2 5 2 maximum microbial storage adjusted for removal the maximum microbial storage accumulation on the land surface is based on a formulation associated with hspf removal from overland surfaces is simulated as a function of the input accumulation rate and maximum storage of microbes which represents accumulation without removal the unit removal rate of stored microbes e g cells removed per day represents processes such as die off and wind erosion bicknell et al 1997 and is computed as the microbial accumulation rate divided by the maximum microbial storage accumulation storage limit 15 s t o r a g e l i m i t m o n t h i k q a c c u m u l a t i o n r a t e m o n t h i k q 0 d a y i n m o n t h q 10 d i e o f f q t d t a c c u m u l a t i o n r a t e m o n t h i k q 2 303 d i e o f f q 1 10 d a y i n m o n t h q d i e o f f q a c c u m u l a t i o n r a t e m o n t h i k q 2 303 d i e o f f q f o r 1 10 d a y i n m o n t h q d i e o f f q a c c u m u l a t i o n r a t e m o n t h i k q d a y i n m o n t h q a s d i e o f f q 0 where s t o r a g e l i m i t m o n t h i k q is the maximum microbial storage by subwatershed i by month q by land use type k across all domestic animals and wildlife adjusted for die off removal cells area and d i e o f f q is the first order microbial removal inactivation die off rate on the land surface by month q 1 time 2 6 microbial point source loading rates monthly microbial point source loadings to a stream include shedding of beef cattle while wading in the stream and leakage from an average septic system which are used by msm 2 6 1 shedding rates of beef cattle in streams the monthly microbial loading rate of beef cattle shedding to a stream by subwatershed is as follows 16 b e e f c a t t l e s h e d r a t e s t r e a m i q n u m b e r o f a n i m a l s i m m i c r o b e a n i m a l p r o d u c t i o n r a t e s m g r a z i n g d a y s m q d a y i n m o n t h q t i m e s p e n t i n s t r e a m s m q for m 2 where b e e f c a t t l e s h e d r a t e s t r e a m i q is the microbial loading rate of beef cattle m 2 shedding into a stream by subwatershed i by month q cells time 2 6 2 microbial loadings due to septics the average septic flow rate to the stream by subwatershed is as follows 17 s e p t i c s t r e a m f l o w r a t e i s e p t i c n u m b e r i s e p t i c n u m b e r p e o p l e s e p t i c o v e r c h a r g e s e p t i c f a i l u r e r a t e where s e p t i c s t r e a m f l o w r a t e i is the average septic flow rate to the stream by subwatershed i volume time s e p t i c n u m b e r i is the number of septic systems associated with subwatershed i number of septics s e p t i c n u m b e r p e o p l e is the average number of people per septic system number of people septic s e p t i c o v e r c h a r g e is the typical septic overcharge flow rate volume time person and s e p t i c f a i l u r e r a t e is the typical fraction of septic systems that fail ratio the microbial loading rate associated with septic systems by subwatershed is as follows 18 s e p t i c s t r e a m l o a d i n g r a t e i s e p t i c s t r e a m f l o w r a t e i s e p t i c c o n c where s e p t i c s t r e a m l o a d i n g r a t e i is the microbial loading rate to the stream from leaking septic systems by subwatershed i cells time and s e p t i c c o n c is the typical microbial density concentration in septic system waste cells volume 2 7 workflow components a software infrastructure is developed to automate the manual process of characterizing transport of pathogens and indicator microorganisms from sources of release to points of exposure by loosely configuring a set of modules and process based models a design schematic of the workflow which tracks data from sources to downstream locations within a watershed and visualizes simulation results is presented in fig 1 models in addition to msm include d4em sdmpb hspf pest and basins d4em manages accesses retrieves analyzes and caches web based environmental data epa 2013a it is an open source automated data access and processing library that accesses a variety of data types including water quality land use hydrology soils meteorological met stream flow groundwater levels and crop data uses dotspatial geo processing libraries to perform cartographic re projections intersection clipping overlaying joining and merging of geographic features and areas of interest delineation performs statistical processing extraction interpolation and averaging of time series data incorporates automatic data access functionality and consists of a collection of net dynamic link libraries that can be linked to a modeling utility such as a batch processor or script to access data for multiple sites or used with a custom built user interface the sdmpb leverages d4em provides geographical information system gis capabilities using dotspatial technology converts dotspatial based project files to mapwindow based project files mapwindow 2013 watry and ames 2008 and pre populates input files of fate and transport models automatically hspf bicknell et al 1997 is a comprehensive package for simulating watershed hydrology and water quality for conventional e g sediment or nutrients and nonconventional pollutants e g toxic organics and microbes it uses basin scale analysis for integrated simulation of land and soil contaminant runoff processes with instream hydraulic and microbial interactions on user defined time scales hour day month or year and provides a history of runoff flow rates and microbial concentrations at any point in a watershed interflow and groundwater supplying the streams are also simulated but contaminant levels are accounted for by a user specified constant concentration level hspf executes as a stand alone or within basins pest is a model independent nonlinear parameter estimation package that can estimate parameter values for almost any existing computer model whether a user has access to the model s source code doherty 2005 or not pest is designed to interface with an existing model modify designated input run the model as often as needed and adjust its parameters until differences between simulated and monitored output results are minimized in a weighted least squares sense pest communicates with a model through the model s own input and output files pest implements a variant of the gauss marquardt levenberg method of nonlinear parameter estimation and also allows fine tuning of parameter estimation via control variables basins epa 2001a provides graphical and tabular viewers of input data and flow and concentration output it is a multipurpose environmental analysis infrastructure that performs watershed and water quality based analyses by integrating environmental data analysis tools and watershed and water quality models a mapwindow based gis organizes spatial information that displays maps tables or graphics analyzes landscape information and integrates and displays relationships among data at a user chosen scale 3 results 3 1 input requirements the msm has been seamlessly linked with a suite of comma separated values csv files that supply user defined microbial data additional data supplied by sdmpb d4em on watershed characteristics are also consumed by msm microbial loadings data produced by msm represent input to sdmpb which passes the information to downstream models an example application to a real world watershed using the qmra workflow illustrates flow and microbial loadings at the pour point 3 1 1 microbial input comma separated values files twelve user defined csv files and their microbial source term input data requirements for a microbial assessment using msm whelan et al 2015b are listed in table 4 column 1 identifies the csv file name and corresponding model sdmpb or msm that consumes data columns 2 and 3 define each parameter and its corresponding units respectively sdmpb uses some of these data in calculations to produce output column 4 which is the input to msm for example input location points defined by latitude and longitude for sdmpb column 2 are spatially overlaid automatically onto the watershed to identify corresponding subwatersheds which are required input to msm example csv files and input requirements are presented in appendix a tables a1 through a10 3 1 2 watershed characteristics the sdmpb manages and acquires mixed use watershed information from standard national databases table 5 using d4em which is based on the basins watershed modeling system data download tool which accesses retrieves analyzes and caches web based data a suite of gis map layers includes gaging station locations nhdplus flowlines waterbody network subwatersheds elevation e g slope soil types land use types met stations and multiple legal boundaries state county roads eco regions national water quality assessment nawqa regions etc 3 2 output requirements five pieces of information produced by msm 1 microbial loading rate by subwatershed i by month q summed across all domestic animals m and wildlife n for each land use type k without die off a k a mon accum in hspf 2 maximum microbial storage per land use type k area per subwatershed i by month q summed across all domestic animals m and wildlife n adjusted for die off a k a mon sqolim in hspf 3 microbial loading rate of domestic animal beef cattle m 2 shedding to streams by subwatershed i by month q 4 average septic flow rate to the stream by subwatershed i 5 microbial loading rate to the stream from leaking septic systems by subwatershed i 3 3 modeling workflow an example application of a qmra workflow using msm is presented in fig 1 although hypothetical it accesses retrieves and uses real world data coupled with microbial properties data contained in the csv data files and d4em retrieved data sdmpb produces a delineated watershed fig 2 of 1358 km2 524 mi2 containing a suite of gis map layers these layers include farms with domestic animal types numbers and locations septic system locations nhdplus flowlines subwatersheds waterbody network elevation e g slope soil types land use types met stations gaging stations and multiple legal boundaries table 5 fig 3 presents flow calibration results at the pour point of the watershed including the initial uncalibrated simulation monitored gage data and the initial calibration with the inverse model pest correlation coefficient r of 0 86 fig 4 presents enterococci calibration results at the pour point of the watershed including uncalibrated simulation results 41 monitored sample densities and the initial calibration with pest correlation coefficient r of 0 45 initial microbial loadings and instream die off rates within the watershed were used in the calibration microbial densities in interflow and groundwater were set to zero because local well data indicated an absence of enterococci 4 discussion qmra organizes captures and executes microbial data to address impacts to mixed use watersheds within a modeling workflow which involves watershed characterizations microbial source mapping and instantiation of the workflow in an assessment source term data are critical to development of a qmra and thus emphasized in this manuscript 4 1 automating watershed delineation and microbial source mapping the workflow that contains the msm allows for automated watershed delineation and collation of microbial sources within each subwatershed this allows users to easily change the number and size of subwatersheds and microbial sources are automatically placed within the correct subwatershed and collated accordingly users therefore do not have to manually assign sources domestic animals humans engineered point sources or septics to subwatersheds the sdmpb d4em automates watershed delineation and microbial source mapping as it links to a gis system mapwindow to visualize map layers of data accesses and retrieves web based data from sources outlined in table 5 to automatically create input files for msm including automatic delineation of watersheds into subwatersheds areas for and land use types in each subwatershed etc allows users to specify intermediate locations e g gaging monitoring within a watershed to ensure that the automated delineation process has subwatershed boundaries going through those points provides user control for watershed delineation as it relates to number of subwatersheds minimum subwatershed size and minimum stream length the latter two prevent watershed modeling of areas and streams that are too small although the smallest areas are those defined by the minimum nhd delineations accesses and retrieves user defined local data appendix a tables a1 through a10 which compute microbial loading rates distributed spatially and temporally by subwatersheds allows manual manipulation of input data for more refined site specific assessments facilitates linkage between microbial sources and loadings through msm with fate and transport modeling within a mixed use watershed assigns north american land data assimilation system nldas radar or national climatic data center ncdc land based met data to individual subwatersheds kim et al 2014 creates the msm input file allows users to designate snow accumulation melt microbial fate and transport and simulation time increments e g hourly daily monthly or annually whelan et al 2015c creates map layers to visualize locations of subwatersheds land use types farms domestic animals septics engineered point sources monitoring and gaging stations and met stations an example watershed with delineated subwatersheds water body network gaging stations and farms with domestic animal and septic system locations is presented in fig 2 4 2 microbial source characterization microbial source characterization identifies types and locations of sources and information that capture microbial loadings and influence fate and transport in the watershed including locations and types of microbial sources shedding and production rates and die off microbial sources include domestic animals wildlife septic systems point sources wwtps and potws and urban loadings microbial source characterization data supplied by the user are illustrated in appendix a tables a1 through a10 4 2 1 microbial source locations and points of interest example file formats that document locations of farms containing domestic animals point sources that discharge directly to the stream and septic system output and boundary points as a function of latitude and longitude are captured see tables a1 a2 and a 3 respectively output points are intermediate locations within the watershed where simulation results are produced and boundary points are locations where upstream areas have been evaluated a priori and represent flow and concentration boundary conditions for downstream evaluation see table 4 latitude and longitude are used because the data gathering process on microbial sources is typically determined prior to watershed delineation and can dictate how delineation proceeds for example output and boundary locations are of particular importance and must be identified in advance sdmpb automatically delineates a watershed into subwatersheds accounting for the output and boundary locations overlays latitude longitude locations and assigns these locations to subwatersheds if locations are outside the watershed boundary these data will be ignored on the other hand non gis based models such as mwaste moore et al 1989 coli walker et al 1990 and bslc zeckoski et al 2005 assume that the watershed was delineated prior to manually assigning sources to subwatersheds and therefore do not consider points of interest such as monitoring locations or boundary conditions if the watershed is re delineated with these models users must manually repeat the process in msm delineation and overlaying of source locations are automated so mapping microbial sources and output and boundary points align exactly to the correct subwatersheds without user intervention 4 2 2 domestic animals the number and type of domestic animals associated with each farm location are considered table a1 and these numbers are used in eqs 3 8 and 16 county wide agricultural census data can be retrieved from usda 2016 although many states track the numbers and types of domestic animals by farm especially if the numbers exceed a threshold as with designated concentrated animal feeding operations cafos in mwaste coli sedmod bslc and select domestic animals are considered a major source of microbial loadings in watersheds with some differences from msm i e number of animal species consideration of manure application grazing in stream shedding etc msm s approach is more consistent with bslc but bslc also includes additional domestic animals such as goats and multiple types of chickens and turkeys msm includes a catch all category for other animals otherag in table a1 when only county level data are available zeckoski et al 2005 suggests estimating and distributing the number of animals among subwatersheds based on pasture area e g heads per area of pasture a single shedding rate is captured table a4 and associated with each domestic animal as defined in table 2 these numbers are used in eqs 3 8 and 16 a single shedding rate is consistent with other models e g mwaste coli sedmod bslc select if different age groups or types of domestic animals calf heifer cow bull steer etc are of concern for grazing shedding these may also be captured in msm using categories such as other in table 2 otherag in table a1 and otheraganimal in table a4 msm assumes that wastes generated from and associated with a location are released within the assigned subwatershed which is consistent with models such as mwaste coli sedmod and select the schedule of land application of manure for each domestic animal as the fraction of manure applied to soil used in eq 1 is captured monthly table a5 in addition the fraction of manure shed by each domestic animal eventually incorporated into soil used in eq 2 is also captured a concept consistent with coli monthly schedules capture seasonal trends and are consistent with models like coli and bslc msm considers the number of days per month that a domestic animal grazes used in eqs 6 9 and 16 and fraction of the number of grazing days per month that beef cattle spend in stream used in eqs 9 and 16 table a 6 the bslc on the other hand gives users the option to define the fraction of time livestock is confined and also considers that both dairy cows and wildlife have access to streams the msm assumes that the category dairy cow is confined and that beef cattle are allowed to graze and enter the stream these terms only differentiate between non grazing and grazing animals respectively for example if dairy cows graze and or shed directly to the stream users can designate them as beef cattle if beef cattle are restricted from entering the stream then time spent in stream can be set to zero schedules see table a 6 apply across the watershed while bslc allows schedules to vary by subwatershed the number of grazing days per month cannot be defined in other models such as mwaste coli sedmod and select 4 2 3 septic systems and point sources instream loadings from septic systems and point sources are considered see tables a 7 and a 8 respectively septics data accounts for the average number of people per septic unit fraction of systems that fail and overcharge flow rate all used in eq 17 as well as microbial density associated with the overcharge used in eq 18 information supporting septic releases represent the watershed as a whole that is the same average usage rate failure and overcharge rates and microbial densities are applied to each septic location all septic systems within each subwatershed are combined to represent a single loading to the respective subwatershed stream segment the same parameters and methodology are used in select to estimate loadings from septic systems bslc is similar since it assumes an average number of people per septic unit a human shedding rate and fraction of failures that cause septic material to rise to the land surface and be carried away by overland runoff bslc also considers septic system age oldest mid age and newest and homes that discharge directly to the stream point source discharges also include direct input to streams from engineered sources such as wwtps and potws the sdmpb consumes a single annual average discharge and microbial and chemical loading rates at specified point locations if the user wants to assess only microbes the file is modified by removing rows for chemicals if there is only one point source rows related to other point sources are removed additional point sources can be identified and added sdmpb consumes these data as a function of point source id name and latitude and longitude see table a2 it spatially overlays latitude and longitude locations onto the watershed mapping to corresponding subwatershed locations and produces the following data for watershed model consumption annual average discharge by subwatershed i ft3 s annual average microbe loading rate by subwatershed i cells yr and annual average chemical loading rate by subwatershed i lbs yr the annual average point source data are essentially placeholders for when the user replaces these constant values with actual point source time series e g daily values this is accomplished by editing the hspf wdm file through the basins inteface and activating the point source location in the hspf interface because msm consumes only microbial data chemical data are of no importance for a microbial assessment in this case and thus are not discussed automatically including a place holder in the watershed input file allows it to be more easily updated with the actual time series through watershed modeling user interfaces hspf and basins other models such as bslc and select do not directly address point sources although the user can manually account for them separately when using a watershed model other models mwaste coli and sedmod do not consider loading from point sources 4 2 4 wildlife msm considers six wildlife categories table 3 wildlife shedding rates table a4 and microbial densities table a 9 vary by land use type and appear in eq 10 wildlife is assumed to shed on forest cropland and pasture but not in urban areas or streams although certain wildlife e g geese may shed in large quantities in urban areas and streams numbers for selected wildlife such as deer are typically available for each state bslc considers seven default wildlife categories only migratory waterfowl loadings are distributed between the land surface and stream on a monthly basis although users can add additional wildlife as needed bslc assumes that wildlife sheds on forest cropland and three pasture designations select also considers wildlife by distributing the population across suitable habitats riebschleager et al 2012 other models mwaste coli and sedmod do not consider loadings from wildlife 4 2 5 microbial die off monthly first order microbial die off rates due to manure on surface soils captured by eq 15 table a10 allow users to account for variations in die off by season die off rates apply to both domestic animals and wildlife loadings to land surfaces bslc uses a constant die off rate no monthly variations while a temperature correction factor in coli and mwaste and soil ph factor in mwaste are considered sedmod and select do not consider die off bslc uses a similar approach although it provides an approximate of maximum storage limit storagelimitmonth a k a mon sqolim in hspf in eq 15 based on the asymptotic limit over the month msm however integrates the first order microbial die off equation over the month to obtain the exact closed form solution see eq 15 for example for a die off rate of 0 36 d 1 bslc has a surface accumulation multiplier of 1 77 1 10 0 36 1 versus the exact solution used in msm of 1 21 0 36 ln 10 1 4 2 6 urban sources user supplied loading rates i e wash off directly to the stream from urban areas according to the following categories and subcategories used in eq 12 are accounted for see table a4 commercial and services commercial mixed urban or built up road commercial single family low density single family high density and multi family residential residential single family low density single family high density and multi family residential transportation communications and utilities urbanized built up areas include roads road commercial property commercial single family low density residence singlefamilylowdensity single family high density residence singlefamilyhighdensity and multi family residential multi familyresidential a single weighted urbanized loading rate is quantified for each subwatershed all months based on individual urbanized land uses eqs 13 and 14 bslc and select do not consider different urbanized land use types although they capture residential areas through consideration of septic systems residential areas do not include those on a sewer network zeckoski et al 2005 or within a city limit teague et al 2009 and are mostly found in urban areas thus residential areas in these models are more applicable to rural not urban settings mwaste coli and sedmod do not consider microbial loadings to urban areas 4 2 7 supporting literature information normal microbial composition of animal feces is different from human feces and can change dramatically over time and space boehm et al 2002 dorner et al 2007 so animal and human sources of pathogens and indicators can be treated differently depending on characterization of fecal material and availability of technology that can accurately and reliably differentiate between sources epa 2009 wide variability remains within and between sites fraser et al 1998 and in relevant literature for example kim et al 2016 performed detailed monitoring of microbial release from manure and subsequent overland runoff on 36 identically prepared side by side plots in the same field which resulted in 144 plot scale rainfall runoff events the range in microbial densities was more than eight orders of magnitude wolfe et al 2016 demonstrated that microbial loading rates to a mixed use watershed based on numbers and types of domestic animals and wildlife microbial densities shedding and production rates by domestic animal wildlife and septics and microbial die off rates represent only estimates and require calibration using observed densities downstream a summary of densities and production rates is not tabularized herein although suggested values are found in the published literature soller et al 2015 and epa 2010 provided studies related to occurrence and abundance shedding densities in cells g manure of pathogens e g e coli o157 h7 campylobacter salmonella spp cryptosporidium spp giardia spp in manures from domestic animals beef cattle dairy cows and disinfected secondary effluent epa 2009 provided representative fecal indicator bacteria and zoonotic i e passage from animals to humans pathogen densities in human and animal feces and sewage soller et al 2010 documented ranges used to characterize densities of indicators e coli and enterococci and reference pathogens e coli o157 h7 cryptosporidium spp salmonella spp giardia spp norovirus in the fecal sources primary sewage secondary chlorinated effluent gulls cattle pigs chickens schoen and ashbolt 2010 epa 2010 and butler et al 2008 provided example shedding rates for cows whelan et al 2014b geldreich 1978 and asae 2005 provided manure production rates and fecal coliform shedding rates associated with various domestic animals and wildlife zeckoski et al 2005 overcash et al 1983 provided fecal coliform densities from domestic animal manures moore et al 1989 walker et al 1990 used geldreich s 1978 values for fecal coliform densities in manure they also provided suggested values for the fraction of manure incorporated by month epa 2000 provided example values for fecal coliform shed from domestic animals and wildlife fecal coliform production rates associated with urban areas road commercial single family low and high density and multi family residential and supporting information on septics users of the select model e g mcfarland and adams 2014 riebschleager et al 2012 mckee et al 2011 teague et al 2009 provided example shedding rates for e coli based on fecal coliform production rates for domestic animals and wildlife epa 2001b assuming a fecal coliform to e coli conversion factor of 0 5 recommended by doyle and erickson 2006 riebschleager et al 2012 and teague et al 2009 provided production rates for septic on site wastewater treatment systems and riebschleager et al 2012 also considered urban development and built areas including low medium and high density land use consisting of single and multi family housing commercial service industrial and utilities transportation kim et al 2016 provided a summary of e coli die off rates from published literature crane and moore 1986 wang et al 2004 meals and braun 2006 gu et al 2012 blaustein et al 2013 martinez et al 2013 oladeinde et al 2014 based on moore et al 1988 walker et al 1990 and moore et al 1989 tried to account for bacterial die off in stored manure 4 3 workflow instantiation instantiation of the qmra workflow fig 1 begins with the user initiating sdmpb d4em then navigating the united states by state county and 8 digit hydrologic unit code huc 8 which typically represents an area of 1800 km2 700 mi2 from here the user may stay with the huc 8 selection or select a different pour point or huc 12 100 km2 40 mi2 of interest whelan et al 2015c with user defined simulation output intervals hourly daily etc simulation start and end times selected data sources and a pour point selection sdmpb automatically identifies the upstream basin boundary and registers the 12 user defined csv data files table 4 and appendix a whelan et al 2015b the number of subwatersheds can also be controlled with user defined minimum subwatershed areas and stream lengths the sdmpb manages data acquisition from standard national databases with d4em and caches web based data table 5 coupled with boundary and output points e g table a3 and user defined minimum stream lengths and subwatershed areas the sdmpb produces a delineated watershed fig 2 of 1358 km2 524 mi2 containing a suite of gis map layers that include gaging stations farms with domestic animal and septic system locations waterbody network elevation e g slope soil types land use types and met stations number and type of domestic animals as well as wildlife density were collected a priori although these data exist they are not always routinely known due to privacy security the msm develops microbial loadings e g cells area time adjusted for die off to the overland subwatershed areas by land use and to instream e g cells time locations within a watershed the sdmpb automatically pre populates input needs of the fate and transport watershed model hspf by automatically creating its users control input uci file a collection of geospatial data files a dotspatial based project file and a mapwindow based project file wmprj currently used by basins using hspf basins windows interfaces non spatially related data may be modified without re delineation for example if a point source exists within the watershed its time series loadings can be registered within basins prior to hspf execution replacing the annually averaged default values provided in the csv file e g table a8 hspf is then executed creating flows and microbial concentrations that are spatially and temporally distributed throughout the watershed e g whelan et al 2015c basins e g epa 2013b 2013c whelan et al 2015c provides a user interface and visualization tool for hspf and accesses gage data for subsequent inverse modeling pest uses hspf flow and microbial density simulations with monitored flow and microbial density data at the pour point for an initial calibration that will require a final manual calibration hspf flow calibration has been discussed by duda et al 2012 key calibration parameters produced by msm and consumed by hspf included loadings by microbe and by land use type maximum microbial storage accumulation on the land surface and point source loading rates to the stream from septic systems and direct shedding key hspf microbial calibration parameters include rate of surface runoff which removes 90 of stored microbes per hour instream first order die off rate and temperature correction for first order die off although microbial densities in interflow and groundwater outflow can be considered they were set to zero because local well data indicated an absence of enterococci using basins as a viewer figs 3 and 4 overlay time series of the initial uncalibrated results those calibrated with pest and the monitored gage data at the watershed pour point used in the calibration fig 3 plots flow data while fig 4 plots microbial densities the improvement is significant when gage data are factored into the assessment the correlation coefficient r for flow was 0 86 while it was 0 45 for microbial density based on only 41 samples over two summers 24 from 2011 to 17 from 2012 the microbial calibration shows poor correlation at very low densities as illustrated by the 2011 observations in fig 4 pest minimizes the squared error by not weighting the smaller values as heavily hence the better correlation at higher more important densities wolfe et al 2016 demonstrated this when only 17 higher valued observations were initially employed in their calibration r 0 70 their densities during winter months were not much different than those during the summer months however by incorporating additional data even though they contained more variability i e 2011 data in fig 4 base flow due to groundwater is now more appropriately captured during non summer months resulting in densities one to two orders of magnitude lower than summer values additional sampling would confirm these findings and add to the final calibration a typical problem with microbial watershed assessments is lack of data which limits the ability to fully understand and capture nuances of cause and effect of microbial levels within the watershed wolfe et al 2016 the initial uncalibrated simulation illustrates the need to anchor modeling to sampling monitoring in fact even with limited samples an initial calibration can significantly improve the uncalibrated results as illustrated by figs 3 and 4 because results are for an indicator not a pathogen there is no risk of infection although the framework is designed to simulate risk of infections to pathogens risk is not computed in the example because results are for an indicator whelan et al 2014b presents an example where risk is computed for pathogens 5 limitations and future efforts 5 1 limitations although msm and hspf are not specific to the continental united states the qmra system is currently designed to access databases that specifically support assessments within the united states msm accounts for variations in monthly agricultural practices in a typical one year cycle i e january december but does not account for variations from year to year the only direct input to streams from shedding is from cattle neglecting other domestic animals wildlife and birds source term data requirements documented in appendix a are typically available in various forms at the state level whelan et al 2017 but currently in a form that requires the user to manually search existing documentation capturing these data in a searchable state by state database would be a significant improvement data access and retrieval would be automated which would result in more consistency fewer errors associated with data transfer and faster assessments the user is currently required to re run sdmpb to change the spatial delineation of the watershed e g number of subwatersheds once sdmpb has been executed even though the current process is automated executing re delineations on the fly would speed the selection of the most appropriate user required resolution once the spatial delineation of the watershed is determined by executing sdmpb the user can change parameter values but not the spatial orientation or delineation of the watershed through hspf and basins user interfaces yakirevich et al 2014 note that bottom sediments have been shown to be an important reservoir of e coli since they can survive and grow in streambed sediments cho et al 2016a 2016b pachepsky and shelton 2011 existing frameworks for modeling microbial transport in steams including our qmra framework disregard the effect of transient storage dead end zones represented by stagnant pools eddies etc bencala and walters 1983 gooseff et al 2008 which does not allow one to simulate long tails observed in the time series of microbial densities yakirevich et al 2014 cho et al 2016b introduced temperature as a critical parameter in simulating bacterial growth die off and reproducing seasonal variability of bacteria msm allows the user to account for seasonal variations in inactivation die off with monthly values see table a10 hspf has limitations in simulating seasonal variability of microbes as it excludes simulations of alternating bacterial growth and die off by temperature 5 2 future efforts a storm drain or sewer is designed to drain excess rain and groundwater from impervious surfaces such as paved streets parking lots footpaths sidewalks and roofs to and through a water distribution system such as pipes flow from impervious areas in the current qmra framework is simulated in hspf by assuming runoff directly enters the stream therefore stormwater runoff through a channel network is unaccounted for recent research and modifications have been made to hspf using swmm epa 2016b to more appropriately account for urbanization by incorporating stormwater drainage into hspf mohamoud and flaishans 2013 if deemed an improvement in urban areas the current version of hspf will be replaced by this modified version the qmra system is being exercised on watersheds across the united states e g manitowoc wi tillamook or biloxi ms teton river id salt river id to determine its efficacy in supporting microbial source allocation assessments a number of these studies investigate 1 which sources and their locations and under what environmental conditions have the greatest impact on downstream microbial density levels within the basin and 2 which strategies mitigate adverse impacts on downstream locations there is currently a two step process for registering point source data direct discharge from potws wwtps within the qmra process 1 sdmpb formats the hspf uci file to receive and account for point source data recorded as annual average loadings then 2 hspf and basins user interfaces replace these data with the actual time series automating the process of seamlessly registering point source data would result in more consistency a reduction in errors associated with data transfer and faster assessments the current version of the qmra framework is loosely configured d4em sdmpb and msm are seamlessly linked and executed within a single user interface the user currently executes hspf basins pest and mra it separately input files for execution are automatically constructed although the user can edit them even though these assessments can be completed in hours or days versus months and years expanding the single user interface concept to seamlessly execute all components would improve usability and repeatability 6 summary a quantitative microbial risk assessment qmra integrates databases and interdisciplinary multiple media exposure and effects models assessment of predicted indicator concentrations from modeling could be used in determining the appropriateness of waivers to criteria and standards concentration numbers on the basis of site specific environmental settings and source conditions although qmra does not preclude using source term data and source and watershed models it starts and is applied most commonly at the exposure point skipping release and transport the work described here documents a new microbial source module msm and describes its mathematical formulations and integration in an environmental modeling workflow to support qmras the msm estimates microbial loadings within a mixed use watershed due to land application and shedding of manure from domestic animals and wildlife to pervious areas e g cropland pasture and forest from cattle shedding directly to streams and from failing septic systems discharging to streams msm loadings are monthly the msm has been seamlessly linked with a user interface that consumes a suite of comma separated values csv files that supply user defined microbial data the interface is based on the data for environmental modeling d4em and site data manager project builder sdmprojectbuilder or sdmpb the two components are linked to include sdmprojectbuilder d4em msm accessing and reading the microbial input csv files and constructing and populating the hydrological simulation program fortran hspf input file the process has been automated from source to receptor within a loosely coupled workflow which allows many of the components to operate individually or within the workflow msm works with the sdmpb to read a pre populated file with microbial source locations animal numbers and types agricultural animals cattle swine poultry etc wildlife ducks deer etc manure application schedules grazing patterns and point source releases septic systems where applicable source locations are defined by latitude longitude and correlated with land use type built up impervious pastureland cropland or forest and subwatersheds delineated by the sdmpb the msm develops monthly microbial loadings adjusted for die off to the soil surface by land use type and to the stream engineered point source releases are captured by sdmpb as annual average point source data that represent placeholders so the user can replace these constant values with actual point source time series e g daily values using hspf and the better assessment science integrating point non point sources basins system the sdmpb automatically pre populates the hspf input file with microbial loading rates and other data needs automating data collection and input needs significantly reduces data transfer errors decreases time for assessment set up and execution and allows the user to focus on interrogating results hspf routes microbes to the watershed pour point and basins provides a user interface and visualization tool for hspf and accesses gage data for subsequent inverse modeling using parameter estimation and uncertainty analysis pest pest uses hspf flow and microbial density simulations with monitored flow and microbial density data at the pour point to provide an initial calibration of microbial loadings and densities an example is presented and although hypothetical it accesses retrieves and uses real world data it also illustrates the importance of using microbial observations in an assessment acknowledgements the united states environmental protection agency epa through its office of research and development partially funded and collaborated in the research described here under dw 089 92399101 to idaho national laboratory dw 012 92348101 to the u s department of agriculture agricultural research service and ep c 12 021 wa 3 52 to eastern research group inc thanks are extended to ms fran rauschenberg of epa for editing the document mention of trade names or commercial products does not constitute endorsement or recommendation for use it has been subjected to agency review and approved for publication appendix a user supplied microbial source term data examples of 12 comma separated values csv files that capture data needs for a microbial assessment three of which have the same format are documented in the following 10 tables table 4 can be used to help correlate parameter names and their units with the information contained within tables a1 through a10 locations of farms that contain domestic animals point sources that discharge directly into the stream and septic system output and boundary points are documented in tables a1 a2 and a3 respectively output points are intermediate locations within the watershed where simulation results are produced boundary points are locations where upstream areas have been evaluated a priori and represent flow and concentration boundary conditions for downstream evaluation information associated with domestic animals is captured in tables a1 and a4 through a6 instream loadings from septic systems and point sources are shown in tables a3 and a7 and tables a2 and a8 respectively wildlife shedding rates and wildlife densities by land use type are captured in tables a4 and a9 respectively table a4 also captures loading rates associated with four different urbanized built up areas with each sub divided as appropriate into urbanized sub categories monthly first order microbial die off rates in surface soils appear in table a10 table a 1 animalll csv template and example data table a 1 latitude longitude beefcow swine dairycow poultry horse sheep otherag 44 23752 88 0046 30 0 30 0 0 0 0 44 19700 88 0954 0 0 0 0 0 0 0 44 16789 88 0410 75 0 75 0 0 0 0 44 05979 87 8475 0 0 0 93 0 0 0 44 09854 88 0243 0 0 0 66 0 0 0 44 08787 87 9167 0 0 0 25 0 0 0 table a 2 pointsourcell csv template and example data for two point sources table a 2 latitude longitude ptsrcid 44 112 88 256 pt001 44 06 88 191 pt002 table a 3 template and example data for septicsll csv outputpointsll csv and boundarypointsll csv table a 3 latitude longitude 44 23752 88 0046 44 19700 88 0954 44 09854 88 0243 44 08787 87 9167 table a 4 fcprodrates csv template and example shedding rates by domestic animal and wildlife and production rates by urban built up areas table a 4 source value units dairycow 2 50e 10 countperanimalperday beefcow 3 30e 10 countperanimalperday swine 1 10e 10 countperanimalperday sheep 1 20e 10 countperanimalperday horse 4 20e 08 countperanimalperday poultry 1 31e 08 countperanimalperday duck 2 40e 09 countperanimalperday goose 8 00e 08 countperanimalperday deer 3 50e 08 countperanimalperday beaver 2 50e 08 countperanimalperday raccoon 1 25e 08 countperanimalperday otheraganimal 0 00e 00 countperanimalperday otherwildlife 0 00e 00 countperanimalperday road 2 00e 05 countperacreperday commercial 6 21e 06 countperacreperday singlefamilylowdensity 1 03e 07 countperacreperday singlefamilyhighdensity 1 66e 07 countperacreperday multifamilyresidential 2 33e 07 countperacreperday table a 5 manureapplication csv template and example data table a 5 manuretype janfractionapplied febfractionapplied marfractionapplied aprfractionapplied mayfractionapplied junfractionapplied julfractionapplied augfractionapplied sepfractionapplied octfractionappied novfractionapplied decfractionapplied fractionincorporatedintosoil swinemanure 0 0 0 0 15 0 3 0 2 0 15 0 1 0 05 0 05 0 0 0 8 cowmanure 0 0 0 0 15 0 3 0 2 0 15 0 1 0 05 0 05 0 0 0 75 cattlemanure 0 0 0 0 15 0 3 0 2 0 15 0 1 0 05 0 05 0 0 0 75 horsemanue 0 0 0 0 1 0 1 0 0 0 0 0 4 0 4 0 0 75 poultrylitter 0 0 0 0 15 0 3 0 2 0 15 0 1 0 05 0 05 0 0 0 96 table a 6 grazingdays csv template and example data table a 6 month beefcattlegrazingdays horsegrazingdays sheepgrazingdays otheraganimalgrazingdays fractionoftimebeefcattleinstreams january 0 3 1 31 0 0 february 0 2 8 28 0 0 march 0 3 31 0 0 april 30 27 30 0 0 may 31 27 9 31 0 0 june 30 27 30 0 0 1 july 31 27 9 31 0 0 1 august 31 27 9 31 0 0 1 september 30 27 30 0 0 october 31 27 9 31 0 0 november 0 27 30 0 0 december 0 3 1 31 0 0 table a 7 septicsdatawatershed csv template and example data correlated with septicsll csv table a 7 numberofpeoplepersepticunit septicfailurerate fraction septicoverchargeflowrate gallonsperdayperperson fcconcentrationreachingstreamfromsepticovercharge countsperliter 3 75 0 12 70 1 0e 7 table a 8 pointsourcedata csv template and example data for two point sources with flow microbes and chemicals correlated with pointsourcell csv table a 8 ptsrcid facname load parm pt001 pointsource1 1 flow pt001 pointsource1 1000 microbes pt001 pointsource1 5 diazinon pt002 pointsource2 2 flow pt002 pointsource2 2000 microbes pt002 pointsource2 4 diazinon table a 9 wildlifedensities csv template and example data table a 9 animal densitypersqmile cropland densitypersqmile pasture densitypersqmile forest duck 14 13 14 13 14 13 goose 2 22 2 22 2 22 deer 20 51 20 51 20 51 beaver 0 0 0 raccoon 0 0 0 otherwildlife 0 0 0 table a 10 template and example data for monthlyfirstorderdieoffrateconstants csv table a 10 month dieoffratecontant january 0 027 february 0 035 march 0 042 april 0 050 may 0 058 june 0 065 july 0 073 august 0 065 september 0 058 october 0 050 november 0 042 december 0 035 appendix b software data availability categories of free and nonfree software include the following gnu 2013a 2013b free i e open source software that permits anyone to use copy and or distribute verbatim or with modifications gratis or for a fee most free software is copyrighted and the copyright holders have legally given permission to use it with a free software license public domain software is not copyrighted proprietary i e non free software is licensed under the exclusive legal rights of its owner msm software developer epa address epa 960 college station road athens ga 30605 usa tel 1 706 355 8306 fax 1 706 355 8302 e mail parmar rajbir epa gov first available 2016 hardware requirements 1 5 ghz cpu 2 gb ram software requirements windows 7 availability open source no license source code available upon request cost free program language c program size 202 kb on disk after installation software access https github com usepa microbialsourcemodule sdmpb software developer epa respec address epa 960 college station road athens ga 30605 usa tel 1 706 355 8306 fax 1 706 355 8302 e mail parmar rajbir epa gov first available 2016 hardware requirements 2 ghz cpu 4 gb ram software requirements windows 7 availability open source no license source code available upon request cost free program language vb net c program size 523 mb mb on disk after installation software access https github com usepa d4em tree master sdmpb d4em software developer epa respec address epa 960 college station road athens ga 30605 usa tel 1 706 355 8306 fax 1 706 355 8302 e mail parmar rajbir epa gov first available 201x hardware requirements 2 0 ghz cpu 4 gb ram software requirements windows 7 availability open source no license source code available upon request cost free program language vb net c program size 200 mb on disk after installation software access https github com usepa d4em hspf software developer epa respec address epa 960 college station road athens ga 30605 usa tel 1 706 355 8306 fax 1 706 355 8302 e mail parmar rajbir epa gov first available 1970 hardware requirements 1 ghz cpu 4 gb ram software requirements windows 7 availability open source no license source code available upon request cost free program language fortran program size 6 4 mb on disk after installation software access https www epa gov exposure assessment models hspf basins software developer epa respec address epa 960 college station road athens ga 30605 usa tel 1 706 355 8306 fax 1 706 355 8302 e mail parmar rajbir epa gov first available 2008 hardware requirements 2 ghz cpu 4 gb ram software requirements windows 7 availability open source no license source code available upon request cost free program language vb net c program size 2 gb on disk after installation software access https www epa gov exposure assessment models basins pest software developer john doherty address flinders university gpo box 2100 adelaide 5001 south australia tel 1 301 718 8900 s s papadopulos associates e mail john doherty flinders edu au first available 1994 hardware requirements 1 ghz cpu 2 gb ram software requirements windows 7 availability open source no license cost free program language fortran or unix program size 50 mb 3 mb on disk after installation software access http www pesthomepage org downloads php 
26472,global stocks of freshwater fish have been on the decline for decades driven in part by the obstruction of their migration routes by anthropogenic barriers to mitigate such impacts fishways have been developed to facilitate bidirectional fish migration these structures are affected by the hydrological variability of rivers which can cause changes in the up and downstream boundary conditions of fishways leading to non uniform hydraulic performance current methodologies in fishway design and analysis often assume uniform performance most commonly relying on 1d approximations of the water level distribution in this study we highlight the necessity of considering non uniform performance we provide an in depth analysis methodology for non uniform conditions demonstrating the necessity of 3d models to correctly characterize non uniformity and leveraging the synergy between 1d and 3d models for this vof method together with two turbulence modelling technics rans standard k ε and les smagorinsky models are analyzed using openfoam cfd platform keywords fishways cfd rans les openfoam hydraulic design non uniform performance 1 introduction river fragmentation caused by man made structures is a major driver of ecological disruption in aquatic systems as it limits the free movement of freshwater organisms branco et al 2012 nilsson et al 2005 the current focus of restoration science is to reestablish connectivity of regulated river systems considerable efforts have been devoted to the development and improvement of fish passage structures in order to define design criteria adequate to the migration requirements of multiple species and life stages pool type fishways are the most popular alternative to allow free bidirectional movement of fish clay 1995 fao dvwk 2002 fuentes pérez et al 2016 larinier 2002a this type of hydraulic structures consists of consecutive pools separated by cross walls arranged in a stepped pattern equipped with slots weirs or orifices which are used by the fish to move from pool to pool these structures aim to facilitate fish passage by reducing the total height of the obstacle h into a series of smaller drops δh providing compatible hydraulic conditions e g velocity turbulence level power dissipation or flow distribution with the fish biomechanics skills in the past years studies have been focusing in understanding the impact of hydraulics on fish behaviour and swimming capability within fishways this analysis is commonly simplified by assuming uniform flow profiles within the fishway where δh is equal to the topographic difference between pools δz i e same water depth in all pools bermúdez et al 2010 cea et al 2007 puertas et al 2012 2004 rajaratnam et al 1992 1986 tarrade et al 2011 wu et al 1999 however all constructed fishways are subject to the hydrological variability of the rivers they are connected to and thus uniformity is seldom observed under natural conditions fuentes pérez et al 2016 marriner et al 2016 non uniform profiles cause a range of different drops between all pools δh δz and the varied hydraulic conditions may lead to significant differences in the passage efficiency defined as the percentage of fish which entered and successfully moved through a fishway observed under uniform conditions fig 1 non uniform performance will produce different mean water levels h 0 between the pools of a fishway in idealized conditions manifested as a progressive decrement or increment of h 0 distribution fig 1 a these profiles were named by rajaratnam et al 1986 comparing the distribution generated by h 0 in pools to the water profiles provided by the bakhmeteff chow method fig 1 b resulting in two mean non uniform water level distributions backwater m1 and drawdown m2 profiles fig 1 m1 profiles are generated by the decrease of headwater or the increase of tailwater levels producing higher h 0 and lower drops δh δz in the downstream pools conversely m2 profiles are produced when the headwater level increases or the tailwater level decreases generating lower h 0 and higher drops δh δz in the downstream pools fuentes pérez et al 2016 furthermore depending on the complexity of the design e g mixed cross wall connections different slopes or direction changes both profiles can appear mixed the modification of h 0 and δh profiles fig 1 may have direct consequences on fishways efficiency as these variables have the potential to alter the spatial distribution and magnitude of velocity and turbulence fields tarrade et al 2008 wu et al 1999 turbulence has a direct impact on fish behaviour due to its influence on fish locomotion lupandin 2005 fish stability silva et al 2012 as well as on path selection goettel et al 2015 elevated turbulence has also been found to increase energy expenditure of swimming fish enders et al 2005 2003 guiny et al 2005 likewise high turbulence levels can alter the detection of walls and avoidance of other hazards causing bodily damage of fish and in drastic situations leading to fish mortality e g impingement and entrance in intakes of hydropower stations odeh et al 2002 furthermore excessive δh will produce high velocities and turbulent levels which may limit the entrance or passage of fish larinier 2002a thus it is possible to account for possible misinterpretation of fish behaviour by under or over estimate of fishway efficiency when assuming that fishways run only under uniform profiles therefore it is imperative to study non uniform conditions in fishways to improve the knowledge of the local hydrodynamics under field conditions few studies have analyzed the non uniform profiles within a fishway at one dimensional 1d level water level fuentes pérez et al 2017 2014 krüger et al 2010 marriner et al 2016 nonetheless the hydrodynamics of non uniform conditions within a fishway is a complex phenomenon that produces alterations of the flow at a three dimensional 3d level and should be taken into consideration in order to analyze and to understand the consequences of non uniformity within fishways for bidirectional passage of fish as well as to demonstrate the feasibility of modelling this hydraulic situation in this work 3d modelling of vertical slot fishways vsf was studied under uniform and non uniform conditions this was accomplished using openfoam an open source computational fluid dynamics cfd software greenshields 2015 the unsteady flow was simulated using the volume of fluid vof method interfoam solver with two different turbulence modelling techniques 1 reynolds averaged navier stokes rans method using standard k ε model which is a benchmark in fishway studies barton et al 2009 cea et al 2007 khan 2006 marriner et al 2016 2014 xu and sun 2009 and 2 large eddy simulation les method using the smagorinsky turbulence model which has demonstrated in some cases better simulation performance of turbulence parameters than rans van balen et al 2010 vuorinen et al 2015 the numerical model results were compared to measured data from an acoustic doppler velocimeter adv in a laboratory fishways model the main goals of our work were to 1 show the effect of non uniformity in vsfs in the 3d domain 2 validate 3d modelling results for non uniform conditions comparing them with measured data 3 illustrate the use of 1d models to define boundary conditions for 3d models and 4 highlight the necessity of considering non uniform performance to adapt fishways hydrodynamics to the requirements of target species 2 numerical models 2 1 1d model 1d numerical methods are the benchmark for simulating non uniformity in stepped fishways however these methods tend to oversimplify the underlying physics of flow field as they provide an average estimation of the mean water levels of each of the pool of the fishways neglecting the vertical and horizontal spatial distribution of the flow water levels are calculated via an iterative bottom up calculus considering the boundary conditions of the system which are the discharge through the fishway q or the headwater level upstream h 1 1 and tailwater level h 2 n where n corresponds to the total number of cross walls in the fishway fig 1 the discharge equations involved in cross walls fuentes pérez et al 2014 and the basic geometrical parameters of the fishway in case of vsf δz and slot width b fig 2 the main component in the workflow are the discharge equations as they must be able to calculate discharge correctly during different boundary conditions in this regard it is possible to predict accurately uniform and non uniform profiles using poleni s discharge equation eq 1 poleni 1717 together with villemonte s submergence coefficient c v eq 2 villemonte 1947 this has been demonstrated in the most common type of stepped fishways vertical slot pool and weir and step pool nature like fishways in both field and laboratory conditions fuentes pérez et al 2017 2014 1 q 2 3 c v b h 1 1 5 2 g 2 c v β 0 1 h 2 h 1 1 5 β 1 where g stands for the acceleration due gravity 9 81 m2 s and β 0 and β 1 are coefficients which depend on the geometry of the flow control structure in the cross wall the bottom up calculation of the water level can be calculated manually using the defined algorithm fig 2 or by implementing it in the desired program once the water levels are calculated it is possible to derive more complex information such as maximum velocity in the slot u max 2 g δ h rajaratnam et al 1986 or the volumetric power dissipation in the pool v p d q δ h g ρ h 0 b l where ρ is the water density 1000 kg m3 b is the pool width and l the pool length fao dvwk 2002 2 2 3d model in order to reach a complete characterization of the non uniform phenomena and analyze its real consequences 3d models seem to be an interesting alternative as they have the potential of simulating any variable of interest as well as reproducing its performance over time in this study the 3d model is implemented using the open source numerical code openfoam release 3 0 1 greenshields 2015 openfoam is a c toolbox that uses a tensorial approach and finite volume method fvm for the resolution of continuum mechanics problems including cfd weller et al 1998 the resolution of transient flow of two fluids separated by a sharp interface can be achieved with the prebuilt eulerian solver interfoam ubbink 1997 which is an implementation of the classical vof method hirt and nichols 1981 and uses the pimple algorithm higuera et al 2013 for the pressure velocity coupling 2 2 1 flow equations for the description of the 3d system under study incompressible ρ constant and isothermal the navier stokes equations in their incompressible form are used eqs 3 continuity equation and 4 momentum equation bayon et al 2016 ubbink 1997 3 u 0 4 u t u u 1 ρ p υ 2 u f b where p is the pressure υ is the kinematic viscosity f b are the body forces g and t is the time the coexistence of the two immiscible fluids named as water 1 and air 2 involved in the relation is managed by vof method where the volume fraction α defines the portion in each mesh element occupied by the different fluids hirt and nichols 1981 α 1 when is occupied by water 0 α 1 in the interface and α 0 for air considering this the transport of α in time is expressed by 5 α t u α 0 other properties ϕ are treated as a weighted mixture of both fluids in each mesh element 6 ϕ ϕ 1 α ϕ 2 1 α consequently a set of values from 0 to 1 are obtained without an explicit interface between fluid in this sense to define a fluid interface α 0 5 and to avoid the use of interface reconstruction schemes lopes et al 2016 interfoam adds an artificial compression term u c α 1 α where u c is the vector of relative velocity between the two fluids or compression velocity berberović et al 2009 to the left side of eq 5 2 2 2 turbulence modelling local hydrodynamic conditions within a vsfs are characterized by intermittent large and small scale fluctuations in vorticity pressure and velocity thus the modelling of these fluctuations is essential for correct calculation bombač et al 2014 and has demonstrated to be an extremely important factor in the characterization and evaluation of the performance of fishways for fish passage silva et al 2011 although turbulence can be numerically resolved in its different scales using direct numerical simulations dns it is too computationally demanding blocken and gualtieri 2012 thus to solve a computationally manageable problem rans and les methods are the most reasonable alternatives the majority of studies have implemented rans methods as numerical technique for the 3d modelling of vsf barton et al 2009 cea et al 2007 khan 2006 marriner et al 2016 2014 among others this is due to their proven application in a wide range of flows bombač et al 2014 as well as their agreement in time averaged or ensemble averaged velocity distribution predictions compared to experimental data barton et al 2009 cea et al 2007 marriner et al 2014 in general rans methods have shown that they are capable of providing a compromise between accuracy and computational cost blocken and gualtieri 2012 vuorinen et al 2015 however a major setback in using rans is that the approach only resolves mean flow characteristics blocken and gualtieri 2012 largely neglecting the more rapid turbulent structures in the flow these effects are modelled in rans using simplifying equations which limit their results in highly dynamic flows pope 2001 due to the higher computational demand there are few studies using 3d les models in vsfs klein and oertel 2015 musall et al 2015 oberle et al 2012 in contrast to rans les includes large scale turbulent velocity fluctuations and provides time resolved flow fields including turbulent structures this is achieved by spatial filtering large scale eddies are included in the numerical solver whereas smaller ones are modelled semi empirically thus the results of les are usually closer to those of dns zhang et al 2014 and they have the potential of more accurately resolving the turbulence parameters nonetheless les methods typically require higher mesh spatial resolution pope 2001 and thus they are more computationally demanding the final resolved scale of any given model depends on the grid size of the mesh never achieving a mesh independent solution celik et al 2009 due to the pros and cons of both methods in the present work both rans and les have been compared the rans method has been evaluated by means of the standard k ε model furbo 2010 launder and spalding 1974 and the les method using the smagorinsky model deardorff 1970 smagorinsky 1963 2 2 2 1 standard k ε model the turbulence k ε model is based on the substitution of υ by the effective viscosity υ eff eq 7 in the momentum equation where υ eff is a modelled viscosity that takes into account the transport and dissipation of energy caused by the velocity fluctuations 7 υ e f f υ υ t υ t is the turbulent viscosity and it is expressed in terms of the turbulent kinetic energy k and the dissipation rate ε eq 8 8 υ t c υ k 2 ε in order to estimate k and ε their transport equations are solved 9 k t u j k x j x j υ υ t σ k k x j υ t u i x j u i x j u j x i ε 10 ε t u j ε x j x j υ υ t σ ε ε x j c 1 ε k υ t u i x j u i x j u j x i c 2 ε 2 k where x i and x j are cartesian space coordinates and u i u j are the mean velocity components in direction x i and x j respectively regarding c υ c 1 c 2 σ k and σ ε they are model parameters whose values can be found in launder and spalding 1974 table 1 2 2 2 2 smagorinsky model in the case of smagorinsky model similarly to k ε model an effective viscosity is defined 11 υ e f f υ υ s g s 12 υ s g s c k δ k where υ sgs is the subgrid scale kinematic viscosity eq 12 and δ is the filter width defined as the cube root volume of each cell note that k is not solved by a transport equation but rather it is calculated from the velocity field eq 13 13 k c k c e δ 2 s 2 14 υ s g s c k c k c e δ 2 s c s δ 2 s where s 2 s i j s i j and s ij is the rate of strain of the large scale or resolved field c k and c e are both model constants table 2 which are related with the classical smagorinsky constant c s eq 14 2 2 3 spatial and temporal discretization the problem under study consists of a sloped channel divided by cross walls of differing shape depending on the type of vsf under study these complex geometries make it challenging to apply structured meshes for this reason all studied meshes were generated in this work using a two step procedure first the blockmesh utility greenshields 2015 was used to create a simple fully structured hexahedral mesh of the channel without considering the cross walls defining cubic element of size δx fig 3 after using the structured mesh as a base the snappyhexmesh utility greenshields 2015 was applied to create a high quality hex dominant mesh based on the vsf cross wall definition fig 3 in all studied cases the surface refinements jackson 2012 where defined to obtain a suitable dimensionless wall distance y section 2 2 4 the final choice of mesh element size is highly case specific bayon et al 2016 therefore a mesh sensitivity analysis was performed according to the american society of mechanical engineers asme criteria celik et al 2008 to study the influence of δx section 4 time discretization was dynamically controlled using the courant number cr as threshold in this sense openfoam uses a semi implicit variant of the multidimensional limiter for explicit solution mules with an operator splicing procedure to solve the transport equation of the phase fraction greenshields 2015 in this way the convergence is possible with larger cr than usual usually cr 1 mooney et al 2014 thus a cr threshold of 6 was used until convergence evaluated by monitoring the evolution of inlet outlet discharge rate and mean water depth h 0 stability in all the pools and then cr was decreased to 1 to report the final results 2 2 4 boundary conditions table 3 summarizes the boundary conditions bc for the four different types of boundaries defined inlet outlet atmosphere and walls fig 3 a detailed explanation of the boundary types and their definitions can be found in the next foam 2014 or openfoam 2016 literature the overall performance of each scenario was controlled by defining a constant flow rate at the inlet variableheightflowrateinletvelocity enabling the free water level oscillation variableheightflowrate and a constant mean velocity in the outlet outletphasemeanvelocity all of them correspond to mixed bcs pressure bcs at the inlet and outlet were set to fixedfluxpressure which adjusts the pressure gradient such that the flux on the boundary is specified by the velocity bc neumann bc at the walls a no slip condition was imposed the upper surfaces of the mesh as they were exposed to atmospheric pressure were considered as a free surface and should allow the flow to enter and leave the domain freely this was achieved defining an outflow condition for u pressureinletoutletvelocity mixed bc and fixing the value of the total pressure totalpressure dirichlet bc likewise at the inlet the boundary values of k and ε were set to low constant values and allowed to develop within the fishway regarding bcs of k ε and υ t in walls they require a special treatment because of the viscous flow region attached to physical bodies bayon et al 2016 for k it was set to be kqrwallfunction which simply acts as a neumann bc for ε it was set to be epsilonwallfunction which provides a condition for high reynolds number turbulent flow cases furbo 2010 next foam 2014 and for υ t it was set to be nutkwallfunction which provides a turbulent kinematic viscosity condition based on turbulent kinetic energy moukalled et al 2016 next foam 2014 likewise roughness in walls was neglected given the small roughness of the material used in the experimental setup section 3 likewise many studies have demonstrated that wall friction does not play an important role in this type of flow barton and keller 2003 bombač et al 2014 cea et al 2007 the fundamental concept behind the use of wall functions is to apply them at some distance from the wall so that the turbulence models can be solved correctly furbo 2010 in this sense the main requirement to apply these wall functions is that mesh elements in contact with solid boundaries must have a dimensionless wall distance y law of the wall von kármán 1931 between the buffer and the logarithmic sublayers usually defined as 30 y 300 bayon et al 2016 furbo 2010 for the final models a mean value of 132 58 46 09 was obtained 3 experimental setup the outcomes of the 3d numerical models were validated comparing the results to a laboratory case study the laboratory data was collected from a scale model 1 1 6 of 2 pools and 3 cross walls at zero slope of a vsf situated in koblenz germany fig 4 a musall et al 2015 the absence of slope always provides a m2 profile fig 1 a and is a typical solution chosen for small obstacles exposed to high hydrological variability bice et al 2017 the aim of this setup was to study the change of velocity and turbulence profiles under the modification of h 0 and δh produced by non uniform conditions to test its possible 3d simulation to achieve this velocity and turbulence profiles in the most downstream pool were studied for two flow scenarios q 0 130 m3 s with a h 2 3 of 0 40 m h 0 0 520 m in the measured pool and δh 0 058 m in the upstream slot and q 0 170 m3 s with a h 2 3 of 0 46 m h 0 0 560 m in the measured pool and δh 0 078 m the most downstream pool was selected due to the possibility of reaching to higher δhs in both cases for the profiles at 0 60 h 0 depth 410 sample points were measured with an 3d adv vectrino nortek at 25 hz for 60 s fig 4 a the recording time was selected to obtain a stable time averaged value for the measured velocities in a post processing phase adv measurements were filtered with winadv release 2 0 31 software using the goring and nikora 2002 phase space threshold despiking modified by wahl 2003 and detected spikes were discarded achieved overall mean correlation after filtering was 91 22 min correlation 78 15 additionally to show the possible synergy between 1d models and 3d models an example from the literature was also included this example consists on the uniform and non uniform depth profiles m1 m2 and u observed by rajaratnam et al in their serial vsf study conducted in 1986 fig 1 b for geometrical description see design no 3 in rajaratnam et al 1986 this case is presented just as an example convergence of a larger model 10 pools thus results and conclusions obtained from the real study case were applied to show the strengths of 1d models in the boundary definition of 3d models the flow rate in all the modelled scenarios was 0 66 m3 s and h 2 10 was 2 712 m 0 931 m and 1 416 m for m1 m2 and u respectively 4 mesh and time sensitivity analysis the mesh sensitivity analysis was performed based on the asme criteria bayon et al 2016 celik et al 2008 the mesh size employed for the analysis were 0 20 0 15 0 10 0 08 0 06 0 04 0 03 and 0 02 m with the global refinement ratio of 10 0 2 0 02 above of the recommended minimum value of 1 30 bayon et al 2016 celik et al 2008 fig 5 shows the difference in percentage between two consecutive mesh sizes as well as the apparent order p a for average h 0 distribution in all pools and the mean of the average velocity distribution in the vertical axis in jet region a in fig 4 quiescent region c in fig 4 and shear layer d in fig 4 for both turbulence models the observed apparent order distribution of the rans model fig 5 a demonstrates that oscillatory convergence for velocity distribution was reached in sizes below 0 06 m celik et al 2008 likewise the convergence of the water level was reached slightly faster 0 08 m considering the error distribution between meshes regarding les it is important to mention that the smagorinsky method is an implicit approach and thus the filter size will change with the selected grid size as a result there is no truly grid independent solution thus the selected les method approaches dns if the grid size is refined celik et al 2009 this can be seen in the observed error pattern which is continuously descending especially when considering the velocity fig 5 b nevertheless for the case under study the p a distribution for h 0 below δx 0 08 m seemed to decelerate it was found that the best overall choice of mesh resolution was δx 0 03 m this value was below the 0 06 m considered for rans and at the same time allows to study the potentiality of les solutions using still a computationally manageable solution number of cells 1 08 106 in cases where only depth profile distributions were going to be considered δx 0 08 m seemed a reasonable grid size for both turbulence models the numerical uncertainty of the model was calculated after celik et al 2008 resulting in a mean value in the asymptotic range for les 0 72 and 7 61 and for rans 1 27 and 10 88 for h 0 distribution and velocity profile respectively despite the chaotic behaviour of flow when simulation converged to a stable solution the differences between time steps were reduced until they reach an oscillatory behaviour in all the variables fig 6 this behaviour was monitored for all studied scenarios and was visualized by plotting the difference between consecutive time steps for the hydraulic parameter within the fishway e g mass flow stability of global water levels or stability of water level upstream and choosing to end the simulation when an asymptotic behaviour was reached 5 results and discussion 5 1 turbulence model comparison figs 7 and 8 show the hydrodynamics of the same koblenz vsf pool subject to the different boundary conditions simulated by means of the two turbulence models considered as well as measured with the adv according to these figures both turbulence modelling techniques seem able to simulate the spatial distribution of the considered hydrodynamic variables accurately in the cases of velocity u in fig 7 and the time averaged vorticity in the vertical plane ω ij in fig 8 and slightly overestimating les or underestimating rans in the case of turbulent kinetic energy k in fig 7 and reynold stress τ ij in fig 8 table 4 shows the numerical values mean absolute error mae root mean square error rms and squared pearson correlation coefficient of determination r 2 of the profile comparison and confirms numerically the observed in the profiles u and ω ij are the best estimated variables when the errors of both turbulence methods are compared no significant differences are detected t test for two samples significance level 0 05 p value 0 363 for mae and p value 0 246 for rms however for the studied cases les method offers a significantly better linear correlation with respect to the adv data t test for two samples significance level 0 05 p value 0 038 which seems to indicate an overall better spatial agreement with the measured data for a graphical comparison check supplementary material fig s1 in les models errors were higher at high discharge scenario which may indicate that an increase of flow complexity due to a higher discharge may require a further refinement to obtain same error magnitudes nevertheless at the studied level the differences were not significant t test p value 0 372 for mae and p value 0 379 for rms in general the observed errors are in accordance or smaller than other specialized references with numerical information about model validation for instance marriner et al 2014 observed a mae for the u of 0 06 m s and an et al 2016 of 0 1 m s in both cases using rans k ε model in general it is worth mentioning the difficulty of finding numerical validation data in the simulation studies of vsfs moreover for turbulence metrics rans methods are the usual alternative when modelling vsfs barton et al 2009 cea et al 2007 khan 2006 marriner et al 2016 2014 because 1 rans provides an easier way to select the mesh size as a mesh independent solution can be reached and 2 this solution may be found with a coarser mesh than les in this work the suitable rans mesh resolution was found to be δx 0 06 m for the studied cases section 4 which is also smaller than the mesh sizes used in other studies e g an et al 2016 marriner et al 2014 quaranta et al 2016 les method was found to provide a small but significant improvement when compared with the measured data under the considered model configuration likewise further refinement may further increase the accuracy but this increase in accuracy always comes at the expense of higher computational costs in contrast to rans in les the larger eddies are explicitly resolved and the desired temporal resolution can be reached this has been identified as a missing piece of information in studies on fish swimming and turbulent flows and as imperative to a better understanding of the relationship between fish behaviour and hydraulic conditions within a fishway silva et al 2012 in this sense fig 9 shows the velocity signal recorded by adv faced to the one simulated by les model as well as their power spectral density in two different points slot a and pool b fig 4 the magnitude of the velocity fluctuations is in accordance with measurements however as pointed out in the methodology section les filters out high frequency oscillation according to the size of the used cell size eq 12 fig 9 b shows the difficulty of the model to estimate the high frequency oscillations which could be adjusted by adjusting cell size nevertheless it is yet to be determined which fluctuations are relevant for fish considering the results of the comparison between models and point velocity measurements both turbulence models seem to provide acceptable results for the study case specifically it was found that les provided a closer spatial agreement with the measured data as previously discussed rans can provide a mesh independent solution with coarser discretization which makes it a good candidate to simulate larger models nevertheless the absence of the possibility in rans of calculating the temporal fluctuations makes les more interesting for biological studies interested in smaller spatial and temporal scales such as behavioural studies inside the pool thus an integrated approach combining both turbulence models can be a good alternative using rans to simulate the global scenario and les to focus in key smaller areas of interest 5 2 non uniformity different river scenarios will generate different boundary conditions which in turns will produce different non uniform profiles in fishways altering the distribution of h 0 in the pools as well as δh in slots to find a new equilibrium balance in the fishway fig 1 δh is related with the velocity in the slot and h 0 with the volume of the pool therefore different non uniform situations are likely to produce different turbulence and velocity fields either in the same pool during different scenarios figs 7 and 8 or between different pools during the same scenario fig 10 this work confirms this fact by demonstrating the importance of considering the influence of river variability in the form of non uniform boundary conditions for the hydraulic and biological analysis of fishways fig 10 shows the u distribution for the two studied pools during the two considered scenarios a structure without slope such as the model used in this work provides a suitable example to illustrate the effects of non uniformity from a classical 1d perspective to move the water from one pool to the next it is necessary a water drop which leads to a reduction of the water level from one pool to the next considering that the flow is constant and that useful area to move to the next pool is reduced h 0 decreases from pool to pool m2 profile fig 1 and invoking the continuity equation q u area u b h 0 as we move forward this will produce a progressive increment of the velocity in the slot c f vertical profiles in fig 10 and an increase of the drop between pools in the presence of a slope another two profiles are possible rajaratnam et al 1986 a uniform profile which is usually the reference case is produced when the fishway is in geometrical and hydraulic equilibrium and the m1 profile which generates the contrary effect of m2 a progressive increment of h 0 and a reduction of the water drop and velocity in the slots it is also necessary to consider that non uniformity between pools is also generated by geometrical deviations fuentes pérez et al 2014 marriner et al 2016 or local hydraulic effects e g changes in the flow rates into and out of the fishway in this sense entrances and exits are likely to produce flow patterns that may alter the performance of a pool assumed to be working in equilibrium that is to say a pool surrounded by other pools eliminating the influence of these in fishway studies may be nearly impossible as a fish is going to be also subject to these conditions regarding the velocity local hydraulic variability will change the velocities between scenarios fig 10 b against fig 10 a and between pools in the same scenario this fact has direct consequences for fish fish need to be able to swim faster than observed velocities in the slot for moving upstream and to make this possible fishways are usually designed considering uniform conditions and the burst speed of fish highest speed attainable and maintainable for a short period of time fao dvwk 2002 katopodis 1992 larinier 2002b therefore m2 profiles which increase velocities and drops in the most downstream slot may lead to impassable scenarios in other cases lower drops and velocity profiles in the most downstream slots such as the ones generate by m1 profiles may reduce the attraction and localization of the fishway entrance regarding turbulence figs 7 and 8 shows that it is also highly affected in magnitude and spatial distribution by non uniformity and it may affect fish in different ways indeed turbulence has been deemed as a twofold regarding its impact on fish swimming capacity and behaviour it has been postulated that high turbulence can decrease swimming performance lupandin 2005 and increase the energetic cost of swimming performance enders et al 2005 guiny et al 2005 fish have also exhibiting preferences for low turbulence regions within fishways duarte and ramos 2012 silva et al 2012 2011 and in general high turbulence levels seems to affect negatively fishway passage mallen cooper et al 2008 however turbulence is not intrinsically costly and might be controlled to enhance the passage efficiency castro santos et al 2009 tarrade et al 2011 for instance by controlling or designing structures that provide vortices of a specific size and periodicity inside the pool liao 2004 in order to study the spatial distribution of turbulence 3d models provide a necessary tool to relate the possible effect of non uniformity and design specific solutions 5 3 1d against 3d models 1d model are based in the resolution of two equations eqs 1 and 2 for each cross wall fig 2 thus they offer an instantaneous convergence to a solution nevertheless the characterization of the performance using 1d model is limited to predict the water level distribution u max and vpd section 2 1 although these have been the classical parameters to evaluate the suitability for fish fauna fao dvwk 2002 larinier 2002c they have several limitations for instance vpd assumes a mean dissipated turbulence value for a whole pool omitting the turbulence structure and making possible to reach results within the recommenced limits fao dvwk 2002 larinier 2002b but with inadequate dimensions for fish passage e g small l and large b if certain dimensional guidelines are not followed larinier 2002b in the same way u max may poorly represent the complexity of the flow over the slot as in addition to a maximum there is a minimum and a range of values which may be suitable for the passage of fish fauna see vertical profile in fig 10 moreover retrofitting via small geometrical changes in the fishway can impact both parameters by reducing the overall turbulence mallen cooper et al 2008 modifying turbulence structure or ensuring regions with low velocities tarrade et al 2008 however these changes cannot be measured or empirically evaluated fundamentally as it has been demonstrated the hydrodynamics of fishways is an amalgamation of rapidly occurring 3d flow phenomenon however we found that 1d models can be an interesting tool for a preliminary assessment of well known design types in the same way they can be used to correctly define the initial conditions within a 3d model and accelerate its convergence fig 11 as it is shown in fig 11 the use of the calculated water levels in 1d model as water level initial conditions in 3d models reduces the time to reach the asymptotic region and in turns can lead to a reduction the modelling effort and computational cost 6 summary and conclusions in the present study the performance of vsfs under non uniform condition is modelled and studied using openfoam cfd platform two different turbulence modelling techniques have been applied rans k ε and les smagorinsky both turbulence models are able to provide acceptable results when compared to laboratory velocity measurements and it was found that the les model outperformed rans when comparing the spatial distributions of the measured velocity data taking into account the strengths and weaknesses of both models an integrated approach is suggested which may generate resource efficient alternatives using rans to simulate larger spatial scales corresponding to the time averaged flow and les in regions where a more detailed analysis is required it was observed that non uniformity alters the h 0 and δhs profile distributions within a fishway due to their influence on large scale flow characteristics the turbulence and velocity fields were also observed to change in response this highlights the necessity of considering non uniformity for the design and evaluation of fishways it was also found that 3d modelling offers several advantages over classical 1d modelling techniques 3d models produce a higher level of spatial detail which can aid in the analysis of the influence of local hydrodynamics and the fish s probability of occurrence in a particular region of the flow field a major finding of this work is that 1d models can be very useful to define the boundary conditions of 3d models we conclude that each method 3d les 3d rans and 1d can be leveraged in synergy to provide time and resource efficient fishway models capable of accurately representing the highly turbulent flows found in vertical slot fishways the use of each model is study case dependent and the use of 1d models to first determine the basic operational conditions considering non uniformity is highly encouraged before 3d modelling is applied acknowledgments authors will like to thank the two anonymous reviewer for their constructive inputs and suggestions to the first version of the manuscript this project has received funding from the european union s horizon 2020 research and innovation programme under grant agreement no 727830 fithydro the research leading to these results has received funding from bonus fishview the joint baltic sea research and development programme art 185 funded jointly from the european union s seventh programme for research technological development and demonstration and from the academy of finland under the grant no 280715 the german federal ministry for education and research bmbffkz 03f0687a and the estonian environmental investment centre kik p 7254 c 3255 juan francisco fuentes perez has also been partly financed by the eu fp7 project robocademy no 608096 ana t silva was financed by the safepass project no 244022 funded by the research council of norway rcn under the energix program j tuhtan s contribution was financed in part by the estonian base financing grant octavo no b53 and put grant no 1690 bioinspired flow sensing ana garcía vega s contribution was financed by a ph d grant from the university of valladolid pif uva 2017 notation the following symbols are used in this paper b pool width m b slot width m c v villemonte discharge coefficient dimensionless c υ standard k ε turbulent model coefficient dimensionless c 1 standard k ε turbulent model coefficient dimensionless c 2 standard k ε turbulent model coefficient dimensionless c k smagorinsky turbulent model coefficient dimensionless c e smagorinsky turbulent model coefficient dimensionless cr courant number dimensionless c s smagorinsky constant dimensionless psd power spectral density m2s 2 hz g acceleration due to gravity m s2 h total height of the transversal obstacle m h 0 mean water level of the flow in the pool m h 1 mean water level of the flow in the pool upstream of the cross wall m h 2 mean water level of the flow in the pool downstream of the cross wall m k turbulence kinetic energy m2 s2 j kg l pool length m p pressure pa q discharge or flow rate m3 s r 2 determination coefficient dimensionless s ij rate of strain s 1 i turbulence intensity dimensionless t time s u velocity m s u velocity fluctuations m s u c compression velocity m s u max maximum velocity m s u i u j u k velocity components m s vpd volumetric power dissipation w m3 x i x j x k cartesian coordinates m β 0 β 1 villemonte s equation coefficients dimensionless δ filter width m δh water level difference between pools or head drop δh h 1 h 2 m δx size of cubic element m δz topographic difference between cross walls m α volume fraction σ k standard k ε turbulent model coefficient dimensionless σ ε standard k ε turbulent model coefficient dimensionless ε turbulence dissipation rate m2 s3 j kg s ρ density of water kg m3 υ kinematic viscosity m2 s υ eff effective viscosity m2 s υ t turbulent kinematic viscosity m2 s υ sgs subgrid scale kinematic viscosity m2 s ω vorticity s 1 τ reynolds stress n m2 ϕ auxiliary symbol for representing other fluid properties appendix a supplementary data the following is the supplementary data related to this article revised manuscript docx revised manuscript docx appendix a supplementary data supplementary data related to this article can be found at https doi org 10 1016 j envsoft 2017 09 011 
26472,global stocks of freshwater fish have been on the decline for decades driven in part by the obstruction of their migration routes by anthropogenic barriers to mitigate such impacts fishways have been developed to facilitate bidirectional fish migration these structures are affected by the hydrological variability of rivers which can cause changes in the up and downstream boundary conditions of fishways leading to non uniform hydraulic performance current methodologies in fishway design and analysis often assume uniform performance most commonly relying on 1d approximations of the water level distribution in this study we highlight the necessity of considering non uniform performance we provide an in depth analysis methodology for non uniform conditions demonstrating the necessity of 3d models to correctly characterize non uniformity and leveraging the synergy between 1d and 3d models for this vof method together with two turbulence modelling technics rans standard k ε and les smagorinsky models are analyzed using openfoam cfd platform keywords fishways cfd rans les openfoam hydraulic design non uniform performance 1 introduction river fragmentation caused by man made structures is a major driver of ecological disruption in aquatic systems as it limits the free movement of freshwater organisms branco et al 2012 nilsson et al 2005 the current focus of restoration science is to reestablish connectivity of regulated river systems considerable efforts have been devoted to the development and improvement of fish passage structures in order to define design criteria adequate to the migration requirements of multiple species and life stages pool type fishways are the most popular alternative to allow free bidirectional movement of fish clay 1995 fao dvwk 2002 fuentes pérez et al 2016 larinier 2002a this type of hydraulic structures consists of consecutive pools separated by cross walls arranged in a stepped pattern equipped with slots weirs or orifices which are used by the fish to move from pool to pool these structures aim to facilitate fish passage by reducing the total height of the obstacle h into a series of smaller drops δh providing compatible hydraulic conditions e g velocity turbulence level power dissipation or flow distribution with the fish biomechanics skills in the past years studies have been focusing in understanding the impact of hydraulics on fish behaviour and swimming capability within fishways this analysis is commonly simplified by assuming uniform flow profiles within the fishway where δh is equal to the topographic difference between pools δz i e same water depth in all pools bermúdez et al 2010 cea et al 2007 puertas et al 2012 2004 rajaratnam et al 1992 1986 tarrade et al 2011 wu et al 1999 however all constructed fishways are subject to the hydrological variability of the rivers they are connected to and thus uniformity is seldom observed under natural conditions fuentes pérez et al 2016 marriner et al 2016 non uniform profiles cause a range of different drops between all pools δh δz and the varied hydraulic conditions may lead to significant differences in the passage efficiency defined as the percentage of fish which entered and successfully moved through a fishway observed under uniform conditions fig 1 non uniform performance will produce different mean water levels h 0 between the pools of a fishway in idealized conditions manifested as a progressive decrement or increment of h 0 distribution fig 1 a these profiles were named by rajaratnam et al 1986 comparing the distribution generated by h 0 in pools to the water profiles provided by the bakhmeteff chow method fig 1 b resulting in two mean non uniform water level distributions backwater m1 and drawdown m2 profiles fig 1 m1 profiles are generated by the decrease of headwater or the increase of tailwater levels producing higher h 0 and lower drops δh δz in the downstream pools conversely m2 profiles are produced when the headwater level increases or the tailwater level decreases generating lower h 0 and higher drops δh δz in the downstream pools fuentes pérez et al 2016 furthermore depending on the complexity of the design e g mixed cross wall connections different slopes or direction changes both profiles can appear mixed the modification of h 0 and δh profiles fig 1 may have direct consequences on fishways efficiency as these variables have the potential to alter the spatial distribution and magnitude of velocity and turbulence fields tarrade et al 2008 wu et al 1999 turbulence has a direct impact on fish behaviour due to its influence on fish locomotion lupandin 2005 fish stability silva et al 2012 as well as on path selection goettel et al 2015 elevated turbulence has also been found to increase energy expenditure of swimming fish enders et al 2005 2003 guiny et al 2005 likewise high turbulence levels can alter the detection of walls and avoidance of other hazards causing bodily damage of fish and in drastic situations leading to fish mortality e g impingement and entrance in intakes of hydropower stations odeh et al 2002 furthermore excessive δh will produce high velocities and turbulent levels which may limit the entrance or passage of fish larinier 2002a thus it is possible to account for possible misinterpretation of fish behaviour by under or over estimate of fishway efficiency when assuming that fishways run only under uniform profiles therefore it is imperative to study non uniform conditions in fishways to improve the knowledge of the local hydrodynamics under field conditions few studies have analyzed the non uniform profiles within a fishway at one dimensional 1d level water level fuentes pérez et al 2017 2014 krüger et al 2010 marriner et al 2016 nonetheless the hydrodynamics of non uniform conditions within a fishway is a complex phenomenon that produces alterations of the flow at a three dimensional 3d level and should be taken into consideration in order to analyze and to understand the consequences of non uniformity within fishways for bidirectional passage of fish as well as to demonstrate the feasibility of modelling this hydraulic situation in this work 3d modelling of vertical slot fishways vsf was studied under uniform and non uniform conditions this was accomplished using openfoam an open source computational fluid dynamics cfd software greenshields 2015 the unsteady flow was simulated using the volume of fluid vof method interfoam solver with two different turbulence modelling techniques 1 reynolds averaged navier stokes rans method using standard k ε model which is a benchmark in fishway studies barton et al 2009 cea et al 2007 khan 2006 marriner et al 2016 2014 xu and sun 2009 and 2 large eddy simulation les method using the smagorinsky turbulence model which has demonstrated in some cases better simulation performance of turbulence parameters than rans van balen et al 2010 vuorinen et al 2015 the numerical model results were compared to measured data from an acoustic doppler velocimeter adv in a laboratory fishways model the main goals of our work were to 1 show the effect of non uniformity in vsfs in the 3d domain 2 validate 3d modelling results for non uniform conditions comparing them with measured data 3 illustrate the use of 1d models to define boundary conditions for 3d models and 4 highlight the necessity of considering non uniform performance to adapt fishways hydrodynamics to the requirements of target species 2 numerical models 2 1 1d model 1d numerical methods are the benchmark for simulating non uniformity in stepped fishways however these methods tend to oversimplify the underlying physics of flow field as they provide an average estimation of the mean water levels of each of the pool of the fishways neglecting the vertical and horizontal spatial distribution of the flow water levels are calculated via an iterative bottom up calculus considering the boundary conditions of the system which are the discharge through the fishway q or the headwater level upstream h 1 1 and tailwater level h 2 n where n corresponds to the total number of cross walls in the fishway fig 1 the discharge equations involved in cross walls fuentes pérez et al 2014 and the basic geometrical parameters of the fishway in case of vsf δz and slot width b fig 2 the main component in the workflow are the discharge equations as they must be able to calculate discharge correctly during different boundary conditions in this regard it is possible to predict accurately uniform and non uniform profiles using poleni s discharge equation eq 1 poleni 1717 together with villemonte s submergence coefficient c v eq 2 villemonte 1947 this has been demonstrated in the most common type of stepped fishways vertical slot pool and weir and step pool nature like fishways in both field and laboratory conditions fuentes pérez et al 2017 2014 1 q 2 3 c v b h 1 1 5 2 g 2 c v β 0 1 h 2 h 1 1 5 β 1 where g stands for the acceleration due gravity 9 81 m2 s and β 0 and β 1 are coefficients which depend on the geometry of the flow control structure in the cross wall the bottom up calculation of the water level can be calculated manually using the defined algorithm fig 2 or by implementing it in the desired program once the water levels are calculated it is possible to derive more complex information such as maximum velocity in the slot u max 2 g δ h rajaratnam et al 1986 or the volumetric power dissipation in the pool v p d q δ h g ρ h 0 b l where ρ is the water density 1000 kg m3 b is the pool width and l the pool length fao dvwk 2002 2 2 3d model in order to reach a complete characterization of the non uniform phenomena and analyze its real consequences 3d models seem to be an interesting alternative as they have the potential of simulating any variable of interest as well as reproducing its performance over time in this study the 3d model is implemented using the open source numerical code openfoam release 3 0 1 greenshields 2015 openfoam is a c toolbox that uses a tensorial approach and finite volume method fvm for the resolution of continuum mechanics problems including cfd weller et al 1998 the resolution of transient flow of two fluids separated by a sharp interface can be achieved with the prebuilt eulerian solver interfoam ubbink 1997 which is an implementation of the classical vof method hirt and nichols 1981 and uses the pimple algorithm higuera et al 2013 for the pressure velocity coupling 2 2 1 flow equations for the description of the 3d system under study incompressible ρ constant and isothermal the navier stokes equations in their incompressible form are used eqs 3 continuity equation and 4 momentum equation bayon et al 2016 ubbink 1997 3 u 0 4 u t u u 1 ρ p υ 2 u f b where p is the pressure υ is the kinematic viscosity f b are the body forces g and t is the time the coexistence of the two immiscible fluids named as water 1 and air 2 involved in the relation is managed by vof method where the volume fraction α defines the portion in each mesh element occupied by the different fluids hirt and nichols 1981 α 1 when is occupied by water 0 α 1 in the interface and α 0 for air considering this the transport of α in time is expressed by 5 α t u α 0 other properties ϕ are treated as a weighted mixture of both fluids in each mesh element 6 ϕ ϕ 1 α ϕ 2 1 α consequently a set of values from 0 to 1 are obtained without an explicit interface between fluid in this sense to define a fluid interface α 0 5 and to avoid the use of interface reconstruction schemes lopes et al 2016 interfoam adds an artificial compression term u c α 1 α where u c is the vector of relative velocity between the two fluids or compression velocity berberović et al 2009 to the left side of eq 5 2 2 2 turbulence modelling local hydrodynamic conditions within a vsfs are characterized by intermittent large and small scale fluctuations in vorticity pressure and velocity thus the modelling of these fluctuations is essential for correct calculation bombač et al 2014 and has demonstrated to be an extremely important factor in the characterization and evaluation of the performance of fishways for fish passage silva et al 2011 although turbulence can be numerically resolved in its different scales using direct numerical simulations dns it is too computationally demanding blocken and gualtieri 2012 thus to solve a computationally manageable problem rans and les methods are the most reasonable alternatives the majority of studies have implemented rans methods as numerical technique for the 3d modelling of vsf barton et al 2009 cea et al 2007 khan 2006 marriner et al 2016 2014 among others this is due to their proven application in a wide range of flows bombač et al 2014 as well as their agreement in time averaged or ensemble averaged velocity distribution predictions compared to experimental data barton et al 2009 cea et al 2007 marriner et al 2014 in general rans methods have shown that they are capable of providing a compromise between accuracy and computational cost blocken and gualtieri 2012 vuorinen et al 2015 however a major setback in using rans is that the approach only resolves mean flow characteristics blocken and gualtieri 2012 largely neglecting the more rapid turbulent structures in the flow these effects are modelled in rans using simplifying equations which limit their results in highly dynamic flows pope 2001 due to the higher computational demand there are few studies using 3d les models in vsfs klein and oertel 2015 musall et al 2015 oberle et al 2012 in contrast to rans les includes large scale turbulent velocity fluctuations and provides time resolved flow fields including turbulent structures this is achieved by spatial filtering large scale eddies are included in the numerical solver whereas smaller ones are modelled semi empirically thus the results of les are usually closer to those of dns zhang et al 2014 and they have the potential of more accurately resolving the turbulence parameters nonetheless les methods typically require higher mesh spatial resolution pope 2001 and thus they are more computationally demanding the final resolved scale of any given model depends on the grid size of the mesh never achieving a mesh independent solution celik et al 2009 due to the pros and cons of both methods in the present work both rans and les have been compared the rans method has been evaluated by means of the standard k ε model furbo 2010 launder and spalding 1974 and the les method using the smagorinsky model deardorff 1970 smagorinsky 1963 2 2 2 1 standard k ε model the turbulence k ε model is based on the substitution of υ by the effective viscosity υ eff eq 7 in the momentum equation where υ eff is a modelled viscosity that takes into account the transport and dissipation of energy caused by the velocity fluctuations 7 υ e f f υ υ t υ t is the turbulent viscosity and it is expressed in terms of the turbulent kinetic energy k and the dissipation rate ε eq 8 8 υ t c υ k 2 ε in order to estimate k and ε their transport equations are solved 9 k t u j k x j x j υ υ t σ k k x j υ t u i x j u i x j u j x i ε 10 ε t u j ε x j x j υ υ t σ ε ε x j c 1 ε k υ t u i x j u i x j u j x i c 2 ε 2 k where x i and x j are cartesian space coordinates and u i u j are the mean velocity components in direction x i and x j respectively regarding c υ c 1 c 2 σ k and σ ε they are model parameters whose values can be found in launder and spalding 1974 table 1 2 2 2 2 smagorinsky model in the case of smagorinsky model similarly to k ε model an effective viscosity is defined 11 υ e f f υ υ s g s 12 υ s g s c k δ k where υ sgs is the subgrid scale kinematic viscosity eq 12 and δ is the filter width defined as the cube root volume of each cell note that k is not solved by a transport equation but rather it is calculated from the velocity field eq 13 13 k c k c e δ 2 s 2 14 υ s g s c k c k c e δ 2 s c s δ 2 s where s 2 s i j s i j and s ij is the rate of strain of the large scale or resolved field c k and c e are both model constants table 2 which are related with the classical smagorinsky constant c s eq 14 2 2 3 spatial and temporal discretization the problem under study consists of a sloped channel divided by cross walls of differing shape depending on the type of vsf under study these complex geometries make it challenging to apply structured meshes for this reason all studied meshes were generated in this work using a two step procedure first the blockmesh utility greenshields 2015 was used to create a simple fully structured hexahedral mesh of the channel without considering the cross walls defining cubic element of size δx fig 3 after using the structured mesh as a base the snappyhexmesh utility greenshields 2015 was applied to create a high quality hex dominant mesh based on the vsf cross wall definition fig 3 in all studied cases the surface refinements jackson 2012 where defined to obtain a suitable dimensionless wall distance y section 2 2 4 the final choice of mesh element size is highly case specific bayon et al 2016 therefore a mesh sensitivity analysis was performed according to the american society of mechanical engineers asme criteria celik et al 2008 to study the influence of δx section 4 time discretization was dynamically controlled using the courant number cr as threshold in this sense openfoam uses a semi implicit variant of the multidimensional limiter for explicit solution mules with an operator splicing procedure to solve the transport equation of the phase fraction greenshields 2015 in this way the convergence is possible with larger cr than usual usually cr 1 mooney et al 2014 thus a cr threshold of 6 was used until convergence evaluated by monitoring the evolution of inlet outlet discharge rate and mean water depth h 0 stability in all the pools and then cr was decreased to 1 to report the final results 2 2 4 boundary conditions table 3 summarizes the boundary conditions bc for the four different types of boundaries defined inlet outlet atmosphere and walls fig 3 a detailed explanation of the boundary types and their definitions can be found in the next foam 2014 or openfoam 2016 literature the overall performance of each scenario was controlled by defining a constant flow rate at the inlet variableheightflowrateinletvelocity enabling the free water level oscillation variableheightflowrate and a constant mean velocity in the outlet outletphasemeanvelocity all of them correspond to mixed bcs pressure bcs at the inlet and outlet were set to fixedfluxpressure which adjusts the pressure gradient such that the flux on the boundary is specified by the velocity bc neumann bc at the walls a no slip condition was imposed the upper surfaces of the mesh as they were exposed to atmospheric pressure were considered as a free surface and should allow the flow to enter and leave the domain freely this was achieved defining an outflow condition for u pressureinletoutletvelocity mixed bc and fixing the value of the total pressure totalpressure dirichlet bc likewise at the inlet the boundary values of k and ε were set to low constant values and allowed to develop within the fishway regarding bcs of k ε and υ t in walls they require a special treatment because of the viscous flow region attached to physical bodies bayon et al 2016 for k it was set to be kqrwallfunction which simply acts as a neumann bc for ε it was set to be epsilonwallfunction which provides a condition for high reynolds number turbulent flow cases furbo 2010 next foam 2014 and for υ t it was set to be nutkwallfunction which provides a turbulent kinematic viscosity condition based on turbulent kinetic energy moukalled et al 2016 next foam 2014 likewise roughness in walls was neglected given the small roughness of the material used in the experimental setup section 3 likewise many studies have demonstrated that wall friction does not play an important role in this type of flow barton and keller 2003 bombač et al 2014 cea et al 2007 the fundamental concept behind the use of wall functions is to apply them at some distance from the wall so that the turbulence models can be solved correctly furbo 2010 in this sense the main requirement to apply these wall functions is that mesh elements in contact with solid boundaries must have a dimensionless wall distance y law of the wall von kármán 1931 between the buffer and the logarithmic sublayers usually defined as 30 y 300 bayon et al 2016 furbo 2010 for the final models a mean value of 132 58 46 09 was obtained 3 experimental setup the outcomes of the 3d numerical models were validated comparing the results to a laboratory case study the laboratory data was collected from a scale model 1 1 6 of 2 pools and 3 cross walls at zero slope of a vsf situated in koblenz germany fig 4 a musall et al 2015 the absence of slope always provides a m2 profile fig 1 a and is a typical solution chosen for small obstacles exposed to high hydrological variability bice et al 2017 the aim of this setup was to study the change of velocity and turbulence profiles under the modification of h 0 and δh produced by non uniform conditions to test its possible 3d simulation to achieve this velocity and turbulence profiles in the most downstream pool were studied for two flow scenarios q 0 130 m3 s with a h 2 3 of 0 40 m h 0 0 520 m in the measured pool and δh 0 058 m in the upstream slot and q 0 170 m3 s with a h 2 3 of 0 46 m h 0 0 560 m in the measured pool and δh 0 078 m the most downstream pool was selected due to the possibility of reaching to higher δhs in both cases for the profiles at 0 60 h 0 depth 410 sample points were measured with an 3d adv vectrino nortek at 25 hz for 60 s fig 4 a the recording time was selected to obtain a stable time averaged value for the measured velocities in a post processing phase adv measurements were filtered with winadv release 2 0 31 software using the goring and nikora 2002 phase space threshold despiking modified by wahl 2003 and detected spikes were discarded achieved overall mean correlation after filtering was 91 22 min correlation 78 15 additionally to show the possible synergy between 1d models and 3d models an example from the literature was also included this example consists on the uniform and non uniform depth profiles m1 m2 and u observed by rajaratnam et al in their serial vsf study conducted in 1986 fig 1 b for geometrical description see design no 3 in rajaratnam et al 1986 this case is presented just as an example convergence of a larger model 10 pools thus results and conclusions obtained from the real study case were applied to show the strengths of 1d models in the boundary definition of 3d models the flow rate in all the modelled scenarios was 0 66 m3 s and h 2 10 was 2 712 m 0 931 m and 1 416 m for m1 m2 and u respectively 4 mesh and time sensitivity analysis the mesh sensitivity analysis was performed based on the asme criteria bayon et al 2016 celik et al 2008 the mesh size employed for the analysis were 0 20 0 15 0 10 0 08 0 06 0 04 0 03 and 0 02 m with the global refinement ratio of 10 0 2 0 02 above of the recommended minimum value of 1 30 bayon et al 2016 celik et al 2008 fig 5 shows the difference in percentage between two consecutive mesh sizes as well as the apparent order p a for average h 0 distribution in all pools and the mean of the average velocity distribution in the vertical axis in jet region a in fig 4 quiescent region c in fig 4 and shear layer d in fig 4 for both turbulence models the observed apparent order distribution of the rans model fig 5 a demonstrates that oscillatory convergence for velocity distribution was reached in sizes below 0 06 m celik et al 2008 likewise the convergence of the water level was reached slightly faster 0 08 m considering the error distribution between meshes regarding les it is important to mention that the smagorinsky method is an implicit approach and thus the filter size will change with the selected grid size as a result there is no truly grid independent solution thus the selected les method approaches dns if the grid size is refined celik et al 2009 this can be seen in the observed error pattern which is continuously descending especially when considering the velocity fig 5 b nevertheless for the case under study the p a distribution for h 0 below δx 0 08 m seemed to decelerate it was found that the best overall choice of mesh resolution was δx 0 03 m this value was below the 0 06 m considered for rans and at the same time allows to study the potentiality of les solutions using still a computationally manageable solution number of cells 1 08 106 in cases where only depth profile distributions were going to be considered δx 0 08 m seemed a reasonable grid size for both turbulence models the numerical uncertainty of the model was calculated after celik et al 2008 resulting in a mean value in the asymptotic range for les 0 72 and 7 61 and for rans 1 27 and 10 88 for h 0 distribution and velocity profile respectively despite the chaotic behaviour of flow when simulation converged to a stable solution the differences between time steps were reduced until they reach an oscillatory behaviour in all the variables fig 6 this behaviour was monitored for all studied scenarios and was visualized by plotting the difference between consecutive time steps for the hydraulic parameter within the fishway e g mass flow stability of global water levels or stability of water level upstream and choosing to end the simulation when an asymptotic behaviour was reached 5 results and discussion 5 1 turbulence model comparison figs 7 and 8 show the hydrodynamics of the same koblenz vsf pool subject to the different boundary conditions simulated by means of the two turbulence models considered as well as measured with the adv according to these figures both turbulence modelling techniques seem able to simulate the spatial distribution of the considered hydrodynamic variables accurately in the cases of velocity u in fig 7 and the time averaged vorticity in the vertical plane ω ij in fig 8 and slightly overestimating les or underestimating rans in the case of turbulent kinetic energy k in fig 7 and reynold stress τ ij in fig 8 table 4 shows the numerical values mean absolute error mae root mean square error rms and squared pearson correlation coefficient of determination r 2 of the profile comparison and confirms numerically the observed in the profiles u and ω ij are the best estimated variables when the errors of both turbulence methods are compared no significant differences are detected t test for two samples significance level 0 05 p value 0 363 for mae and p value 0 246 for rms however for the studied cases les method offers a significantly better linear correlation with respect to the adv data t test for two samples significance level 0 05 p value 0 038 which seems to indicate an overall better spatial agreement with the measured data for a graphical comparison check supplementary material fig s1 in les models errors were higher at high discharge scenario which may indicate that an increase of flow complexity due to a higher discharge may require a further refinement to obtain same error magnitudes nevertheless at the studied level the differences were not significant t test p value 0 372 for mae and p value 0 379 for rms in general the observed errors are in accordance or smaller than other specialized references with numerical information about model validation for instance marriner et al 2014 observed a mae for the u of 0 06 m s and an et al 2016 of 0 1 m s in both cases using rans k ε model in general it is worth mentioning the difficulty of finding numerical validation data in the simulation studies of vsfs moreover for turbulence metrics rans methods are the usual alternative when modelling vsfs barton et al 2009 cea et al 2007 khan 2006 marriner et al 2016 2014 because 1 rans provides an easier way to select the mesh size as a mesh independent solution can be reached and 2 this solution may be found with a coarser mesh than les in this work the suitable rans mesh resolution was found to be δx 0 06 m for the studied cases section 4 which is also smaller than the mesh sizes used in other studies e g an et al 2016 marriner et al 2014 quaranta et al 2016 les method was found to provide a small but significant improvement when compared with the measured data under the considered model configuration likewise further refinement may further increase the accuracy but this increase in accuracy always comes at the expense of higher computational costs in contrast to rans in les the larger eddies are explicitly resolved and the desired temporal resolution can be reached this has been identified as a missing piece of information in studies on fish swimming and turbulent flows and as imperative to a better understanding of the relationship between fish behaviour and hydraulic conditions within a fishway silva et al 2012 in this sense fig 9 shows the velocity signal recorded by adv faced to the one simulated by les model as well as their power spectral density in two different points slot a and pool b fig 4 the magnitude of the velocity fluctuations is in accordance with measurements however as pointed out in the methodology section les filters out high frequency oscillation according to the size of the used cell size eq 12 fig 9 b shows the difficulty of the model to estimate the high frequency oscillations which could be adjusted by adjusting cell size nevertheless it is yet to be determined which fluctuations are relevant for fish considering the results of the comparison between models and point velocity measurements both turbulence models seem to provide acceptable results for the study case specifically it was found that les provided a closer spatial agreement with the measured data as previously discussed rans can provide a mesh independent solution with coarser discretization which makes it a good candidate to simulate larger models nevertheless the absence of the possibility in rans of calculating the temporal fluctuations makes les more interesting for biological studies interested in smaller spatial and temporal scales such as behavioural studies inside the pool thus an integrated approach combining both turbulence models can be a good alternative using rans to simulate the global scenario and les to focus in key smaller areas of interest 5 2 non uniformity different river scenarios will generate different boundary conditions which in turns will produce different non uniform profiles in fishways altering the distribution of h 0 in the pools as well as δh in slots to find a new equilibrium balance in the fishway fig 1 δh is related with the velocity in the slot and h 0 with the volume of the pool therefore different non uniform situations are likely to produce different turbulence and velocity fields either in the same pool during different scenarios figs 7 and 8 or between different pools during the same scenario fig 10 this work confirms this fact by demonstrating the importance of considering the influence of river variability in the form of non uniform boundary conditions for the hydraulic and biological analysis of fishways fig 10 shows the u distribution for the two studied pools during the two considered scenarios a structure without slope such as the model used in this work provides a suitable example to illustrate the effects of non uniformity from a classical 1d perspective to move the water from one pool to the next it is necessary a water drop which leads to a reduction of the water level from one pool to the next considering that the flow is constant and that useful area to move to the next pool is reduced h 0 decreases from pool to pool m2 profile fig 1 and invoking the continuity equation q u area u b h 0 as we move forward this will produce a progressive increment of the velocity in the slot c f vertical profiles in fig 10 and an increase of the drop between pools in the presence of a slope another two profiles are possible rajaratnam et al 1986 a uniform profile which is usually the reference case is produced when the fishway is in geometrical and hydraulic equilibrium and the m1 profile which generates the contrary effect of m2 a progressive increment of h 0 and a reduction of the water drop and velocity in the slots it is also necessary to consider that non uniformity between pools is also generated by geometrical deviations fuentes pérez et al 2014 marriner et al 2016 or local hydraulic effects e g changes in the flow rates into and out of the fishway in this sense entrances and exits are likely to produce flow patterns that may alter the performance of a pool assumed to be working in equilibrium that is to say a pool surrounded by other pools eliminating the influence of these in fishway studies may be nearly impossible as a fish is going to be also subject to these conditions regarding the velocity local hydraulic variability will change the velocities between scenarios fig 10 b against fig 10 a and between pools in the same scenario this fact has direct consequences for fish fish need to be able to swim faster than observed velocities in the slot for moving upstream and to make this possible fishways are usually designed considering uniform conditions and the burst speed of fish highest speed attainable and maintainable for a short period of time fao dvwk 2002 katopodis 1992 larinier 2002b therefore m2 profiles which increase velocities and drops in the most downstream slot may lead to impassable scenarios in other cases lower drops and velocity profiles in the most downstream slots such as the ones generate by m1 profiles may reduce the attraction and localization of the fishway entrance regarding turbulence figs 7 and 8 shows that it is also highly affected in magnitude and spatial distribution by non uniformity and it may affect fish in different ways indeed turbulence has been deemed as a twofold regarding its impact on fish swimming capacity and behaviour it has been postulated that high turbulence can decrease swimming performance lupandin 2005 and increase the energetic cost of swimming performance enders et al 2005 guiny et al 2005 fish have also exhibiting preferences for low turbulence regions within fishways duarte and ramos 2012 silva et al 2012 2011 and in general high turbulence levels seems to affect negatively fishway passage mallen cooper et al 2008 however turbulence is not intrinsically costly and might be controlled to enhance the passage efficiency castro santos et al 2009 tarrade et al 2011 for instance by controlling or designing structures that provide vortices of a specific size and periodicity inside the pool liao 2004 in order to study the spatial distribution of turbulence 3d models provide a necessary tool to relate the possible effect of non uniformity and design specific solutions 5 3 1d against 3d models 1d model are based in the resolution of two equations eqs 1 and 2 for each cross wall fig 2 thus they offer an instantaneous convergence to a solution nevertheless the characterization of the performance using 1d model is limited to predict the water level distribution u max and vpd section 2 1 although these have been the classical parameters to evaluate the suitability for fish fauna fao dvwk 2002 larinier 2002c they have several limitations for instance vpd assumes a mean dissipated turbulence value for a whole pool omitting the turbulence structure and making possible to reach results within the recommenced limits fao dvwk 2002 larinier 2002b but with inadequate dimensions for fish passage e g small l and large b if certain dimensional guidelines are not followed larinier 2002b in the same way u max may poorly represent the complexity of the flow over the slot as in addition to a maximum there is a minimum and a range of values which may be suitable for the passage of fish fauna see vertical profile in fig 10 moreover retrofitting via small geometrical changes in the fishway can impact both parameters by reducing the overall turbulence mallen cooper et al 2008 modifying turbulence structure or ensuring regions with low velocities tarrade et al 2008 however these changes cannot be measured or empirically evaluated fundamentally as it has been demonstrated the hydrodynamics of fishways is an amalgamation of rapidly occurring 3d flow phenomenon however we found that 1d models can be an interesting tool for a preliminary assessment of well known design types in the same way they can be used to correctly define the initial conditions within a 3d model and accelerate its convergence fig 11 as it is shown in fig 11 the use of the calculated water levels in 1d model as water level initial conditions in 3d models reduces the time to reach the asymptotic region and in turns can lead to a reduction the modelling effort and computational cost 6 summary and conclusions in the present study the performance of vsfs under non uniform condition is modelled and studied using openfoam cfd platform two different turbulence modelling techniques have been applied rans k ε and les smagorinsky both turbulence models are able to provide acceptable results when compared to laboratory velocity measurements and it was found that the les model outperformed rans when comparing the spatial distributions of the measured velocity data taking into account the strengths and weaknesses of both models an integrated approach is suggested which may generate resource efficient alternatives using rans to simulate larger spatial scales corresponding to the time averaged flow and les in regions where a more detailed analysis is required it was observed that non uniformity alters the h 0 and δhs profile distributions within a fishway due to their influence on large scale flow characteristics the turbulence and velocity fields were also observed to change in response this highlights the necessity of considering non uniformity for the design and evaluation of fishways it was also found that 3d modelling offers several advantages over classical 1d modelling techniques 3d models produce a higher level of spatial detail which can aid in the analysis of the influence of local hydrodynamics and the fish s probability of occurrence in a particular region of the flow field a major finding of this work is that 1d models can be very useful to define the boundary conditions of 3d models we conclude that each method 3d les 3d rans and 1d can be leveraged in synergy to provide time and resource efficient fishway models capable of accurately representing the highly turbulent flows found in vertical slot fishways the use of each model is study case dependent and the use of 1d models to first determine the basic operational conditions considering non uniformity is highly encouraged before 3d modelling is applied acknowledgments authors will like to thank the two anonymous reviewer for their constructive inputs and suggestions to the first version of the manuscript this project has received funding from the european union s horizon 2020 research and innovation programme under grant agreement no 727830 fithydro the research leading to these results has received funding from bonus fishview the joint baltic sea research and development programme art 185 funded jointly from the european union s seventh programme for research technological development and demonstration and from the academy of finland under the grant no 280715 the german federal ministry for education and research bmbffkz 03f0687a and the estonian environmental investment centre kik p 7254 c 3255 juan francisco fuentes perez has also been partly financed by the eu fp7 project robocademy no 608096 ana t silva was financed by the safepass project no 244022 funded by the research council of norway rcn under the energix program j tuhtan s contribution was financed in part by the estonian base financing grant octavo no b53 and put grant no 1690 bioinspired flow sensing ana garcía vega s contribution was financed by a ph d grant from the university of valladolid pif uva 2017 notation the following symbols are used in this paper b pool width m b slot width m c v villemonte discharge coefficient dimensionless c υ standard k ε turbulent model coefficient dimensionless c 1 standard k ε turbulent model coefficient dimensionless c 2 standard k ε turbulent model coefficient dimensionless c k smagorinsky turbulent model coefficient dimensionless c e smagorinsky turbulent model coefficient dimensionless cr courant number dimensionless c s smagorinsky constant dimensionless psd power spectral density m2s 2 hz g acceleration due to gravity m s2 h total height of the transversal obstacle m h 0 mean water level of the flow in the pool m h 1 mean water level of the flow in the pool upstream of the cross wall m h 2 mean water level of the flow in the pool downstream of the cross wall m k turbulence kinetic energy m2 s2 j kg l pool length m p pressure pa q discharge or flow rate m3 s r 2 determination coefficient dimensionless s ij rate of strain s 1 i turbulence intensity dimensionless t time s u velocity m s u velocity fluctuations m s u c compression velocity m s u max maximum velocity m s u i u j u k velocity components m s vpd volumetric power dissipation w m3 x i x j x k cartesian coordinates m β 0 β 1 villemonte s equation coefficients dimensionless δ filter width m δh water level difference between pools or head drop δh h 1 h 2 m δx size of cubic element m δz topographic difference between cross walls m α volume fraction σ k standard k ε turbulent model coefficient dimensionless σ ε standard k ε turbulent model coefficient dimensionless ε turbulence dissipation rate m2 s3 j kg s ρ density of water kg m3 υ kinematic viscosity m2 s υ eff effective viscosity m2 s υ t turbulent kinematic viscosity m2 s υ sgs subgrid scale kinematic viscosity m2 s ω vorticity s 1 τ reynolds stress n m2 ϕ auxiliary symbol for representing other fluid properties appendix a supplementary data the following is the supplementary data related to this article revised manuscript docx revised manuscript docx appendix a supplementary data supplementary data related to this article can be found at https doi org 10 1016 j envsoft 2017 09 011 
26473,the reported research developed a generic nutrient recovery model nrm library based on detailed chemical solution speciation and reaction kinetics with focus on fertilizer quality and quantity as model outputs dynamic physicochemical three phase process models for precipitation crystallization stripping and acidic air scrubbing as key unit processes were developed in addition a compatible biological physicochemical anaerobic digester model was built the latter includes sulfurgenesis biological n p k s release uptake interactions with organics among other relevant processes such as precipitation ion pairing and liquid gas transfer using a systematic database reduction procedure a 3 to 5 fold improvement of model simulation speeds was obtained as compared to using full standard thermodynamic databases missing components and reactions in existing standard databases were discovered hence a generic nutrient recovery database was created for future applications the models were verified and validated against a range of experimental results their functionality in terms of increased process understanding and optimization was demonstrated graphical abstract image 1 keywords generic physicochemical model framework reduced phreeqc resource recovery mathematical modelling numerical solution water chemistry anaerobic digestion model software and database availability name nutrient recovery model nrm library nutricover dat database contact céline vaneeckhaute bioengine research team on green process engineering and biorefineries chemical engineering department université laval 1065 avenue de la médecine pavillon adrien pouliot québec qc canada g1v 0a6 tel 1 418 656 28 59 e mail celine vaneeckhaute gch ulaval ca year first available 2016 software required west or tornado http www mikepoweredbydhi com products west and or phreeqc http wwwbrr cr usgs gov projects gwc coupled phreeqc programming language modelica and c availability source code and databases can be obtained on request by contacting the corresponding author cost free 1 introduction in the transition from waste water treatment plants wwtps to water resource recovery facilities wrrfs mathematical models are becoming important tools to hasten nutrient recovery process implementation and optimization vanrolleghem and vaneeckhaute 2014 indeed models may aid in technology development process operation optimization and scale up in a cost effective way rieger et al 2012 yu et al 2011 although to date many processes for the recovery of nutrients from waste water have been proposed and applied to varying degrees for example struvite precipitation ammonia stripping and acidic air scrubbing vaneeckhaute et al 2017a no generic models for nutrient recovery aiming at the construction and optimization of treatment trains for resource recovery are currently available vaneeckhaute et al 2017b moreover existing model libraries for wwtps e g activated sludge models asms provided by the international water association iwa henze et al 2000 gernaey et al 2004 do not allow the integration of nutrient recovery unit processes and or the coupling of a nutrient recovery treatment train this is due to the omission of key fundamental physicochemical components and transformations that are essential to describe nutrient recovery unit processes batstone et al 2012 brouckaert et al 2010 flores alsina et al 2015 critical elements to be dealt with include accurate descriptions of acid base reactions slow precipitation kinetics liquid gas exchange and sorption desorption in the complex mixture of chemical species that the resource recovery systems in place deal with batstone et al 2012 consequently the potential to use models to adequately put together an optimal treatment train of unit processes and set the operating conditions that maximize nutrient recovery and fertilizer quality is missing over the last 10 years important progress was made towards the development and integration of a physicochemical modelling framework compatible with the current more biological process oriented modelling frameworks provided by iwa flores alsina et al 2016 hauduc et al 2015 lizarralde et al 2015 mbamba et al 2016 however the scope of the existing studies stops at the anaerobic digestion of wwtp sludge where it mainly aims at the prediction of uncontrolled struvite precipitation during digestion through phosphorus modelling at the start of this research no generic models were available that may allow to predict optimize and control under dynamic conditions the recovered product quality e g macronutrient content particle size density yield and process performance of a series of nutrient recovery technologies following digestion of various waste water flows manure sludge food waste etc the reported research aimed at developing a library of generic integrated biological physicochemical three phase mathematical process models for the most established nutrient recovery systems currently available as selected in vaneeckhaute et al 2017a as well as a compatible model for anaerobic digestion the models are based on detailed solution speciation and reaction kinetics as brought forward in vaneeckhaute et al 2017b this nutrient recovery model nrm library is a synthesis of the large body of knowledge on nutrient recovery processes that is currently available from research studies and operational experience in contrast to existing model libraries for waste water treatment e g the asm library henze et al 2000 gernaey et al 2004 the scope of the proposed nrm library starts at the anaerobic digester and focusses on the nutrient recovery treatment train following the digester in addition to the development of a generic physicochemical modelling framework a critical and challenging step when combining biological and physicochemical differential equations is their numerical solution lizarralde et al 2015 this is due to the stiffness that arises when considering reactions with very different conversion rates i e the range of system time constants is large batstone et al 2012 brouckaert et al 2010 lizarralde et al 2015 musvoto et al 2000 rosen and jeppsson 2006 sotemann et al 2005 previous attempts towards inclusion of a physicochemical modelling framework in existing wwtp models e g flores alsina et al 2016 hauduc et al 2015 mbamba et al 2016 takács et al 2006 applied a limited literature based selection of chemical species and reactions for self implementation in the modelling software and used self coded numerical solvers that have shown difficulties with convergence flores alsina et al 2015 moreover when one wants to extend these models with new species and reactions time consuming and complicated programming work is required model flexibility is however particularly important for modelling of wrrfs due to the variability of waste water flows in time and between different facilities vanrolleghem and vaneeckhaute 2014 lizarralde et al 2015 proposed the coupling of an external existing geochemical software tool for inclusion of some basic speciation calculations in dynamic process models the use of an external geochemical software tool with designated thermodynamic databases is interesting for accurate calculation of chemical speciation and ph software tools as phreeqc and minteq are generally accepted tools for equilibrium water quality modelling and have a dedicated and proven solver for chemical speciation calculations allison et al 1991 parkhurst and appelo 2013 however simulation times using the full phreeqc minteq thermodynamic databases for chemical speciation may be longer than when dedicated program code is used lizarralde et al 2015 hence an important challenge exists in the development of an efficient methodology for including and solving the stiff equations related to the chemical speciation submodel in nutrient recovery models a compromise should be found between model accuracy and simulation times the present paper describes the specifications the development methodology and the implementation of the generic nrm framework a systematic procedure to allow for inclusion of accurate chemical speciation in dynamic nutrient recovery process models at minimal computational effort is proposed model functionality in terms of increased process understanding and optimization is demonstrated through testing and validation recommendations for further experimental research required to fully calibrate the model dynamics as well as case specific potential model extensions are provided 2 nutrient recovery model nrm building methodology the methodology used for development of the nrm library can be represented by six steps shown in fig 1 and described in detail in the sections below the proposed generic models are based on mass balances to describe physicochemical and biochemical transformation and transport processes as well as an accurate calculation of water chemistry in order to correctly define solution speciation and driving forces for component transformation two key features of the models should be stressed first a dynamic modelling approach i e one that accounts for time dependent changes in the state of the system was applied because the models should be applicable to time varying situations and variable operating conditions such as i periodical load variations e g truck loads of waste sludge treatment during working hours only and seasonal variations ii individual disturbances e g rain events and incorrect manipulations and iii systems that are operated intermittently or cyclically as is the case for multiple nutrient recovery processes e g intermittent aeration in stripping systems and semi batch processes to obtain target fertilizer specifications e g a predefined ammonium sulfate ams concentration in an acidic air scrubber second the geochemical software tool phreeqc was used for two purposes in the development of the nrm library 1 phreeqc for nrm building section 2 2 1 which involves the selection of species and reactions to be included in the models the preparation of a reduced phreeqc model database and the definition of phreeqc selected outputs 2 phreeqc for nrm simulation section 2 3 which involves the tight coupling of the reduced phreeqc model to a kinetic and dynamic mass balance model in order to accurately and efficiently calculate speciation and driving forces for component transformations at each time step during the model simulations as opposed to previously used speciation modelling methodologies e g flores alsina et al 2016 hauduc et al 2015 mbamba et al 2016 takács et al 2006 the proposed methodology guarantees convergence and flexibility lizarralde et al 2015 in order to reduce simulation times a systematic procedure for thermodynamic model database reduction was proposed finally it should be noted that in the following sections variables will be defined with their dimension given in straight brackets m for mass l for length and t for time 2 1 step i definition of modelling objectives 2 1 1 selection of considered included unit processes and input waste streams a literature review on nutrient recovery technologies vaneeckhaute et al 2017a was conducted in order to select the best available technologies as key unit processes for modelling table 1 four key units the selection was made based on the economic feasibility full scale application at this stage and the potential to produce marketable end products for agricultural applications with the purpose of modelling treatment trains four ancillary units were additionally selected table 1 as mentioned above in contrast to existing studies the scope of the present research starts at the anaerobic digestion unit and focusses on the nutrient recovery treatment train following the digester no recycle flows to upstream facilities in the wrrf e g to an activated sludge as system were currently considered in later stages the proposed nrm models could be coupled to activated sludge models asms if a generic physicochemical framework is also integrated in the asms as input waste stream to the digester manure and sludge primary and secondary sludge and mixtures of these from wwtps removing nitrogen n and chemical oxygen demand cod were considered digestate the remaining product after digestion was considered as input stream to the key units for controlled nutrient recovery following the digester next to manure wwtp sludge was selected since the current most advanced models for anaerobic digestion originate from the municipal wastewater and sludge treatment sector nevertheless for future applications the generic nrm ad implementation allows easy extension to co digestion of other organic biological wastes e g using the general integrated solid waste co digestion giscod modelling tool proposed by zaher et al 2009 the nrm ad model can also be extended to allow for specific reactions occurring during the treatment of sludge from enhanced biological phosphorus p removal ebpr as e g in ikumi 2011 or wang et al 2016 but this was considered to be outside the scope of this paper 2 1 2 specification of model outputs and influencing factors in order to develop valuable tools for process optimization the desired model outputs and factors that may affect these outputs were defined for each nrm key unit on the basis of a detailed literature review vaneeckhaute et al 2017b obviously the total content of principal macronutrients n p and potassium k in the fertilizer product and the amount of biogas produced are important model outputs so as to quantitatively and qualitatively determine the overall resource recovery next to the three principal macronutrients n p and k previous studies have shown the relevance of the secondary macronutrient sulfur s in the context of nutrient recovery vaneeckhaute et al 2014 some motivations for inclusion of s in the models were i the demand for s fertilization in agriculture is increasing hence its recovery deserves attention till 2010 ii s may precipitate with iron fe making fe less available for p precipitation iii sulfate reducing bacteria srbs compete with methane ch4 producing bacteria for the same substrate hence ch4 production may be reduced at high s concentrations oyekola et al 2007 iv hydrogen sulfide h2s is an important inhibitor of ch4 producing bacteria oyekola et al 2007 and v high biogas h2s values cause important concerns toxicity corrosion biogas pollution e g in the paper industry reiter and piccot 2004 calcium ca and magnesium mg are also of importance mainly for their soil improving properties and their interaction with p vaneeckhaute et al 2016 for all nutrient recovery systems the percentage recovery of the target nutrient is a key performance measure it was calculated using equation 1 1 r e c o v e r y s i i q i n s i o u t q o u t s i i n q i n 100 in which s i i n and s i o u t are the in and outgoing liquid flow concentrations for component i m l 3 and q i n and q o u t are the in and outgoing flow rates l 3 t 1 furthermore the macronutrient use efficiency n p k s in the fertilizer end products is an important factor in determining the agronomic potential and sustainability of the produced fertilizers it was evaluated as the percentage available or mineralized nutrient content over the total nutrient content e g nh4 n total n and ortho p total p this percentage can be obtained by means of a chemical solution speciation calculation section 2 2 1 next the fertilizer ph and salt content are of important concern as they may impact soil quality the ph was directly calculated from solution speciation salts were characterized using the sodium adsorption ratio sar i e the relative amount of available sodium na over divalent cations ca and mg hillel 2008 factors that may additionally determine the value of the recovered product are the particle size for solid fertilizers the density for liquid fertilizers and the product purity in this work the particle size was evaluated as mean particle diameter section 2 2 2 but in future research one may be interested in particle size distributions psds nopens et al 2014 perez et al 2008 for the nrm prec unit product purity was evaluated by calculating the fraction of precipitated target mineral s over the total product collected taking in account the presence of multiple competing and concurrent precipitation reactions to this end also the precipitation of principal micronutrients occurring in waste water treatment such as fe and aluminium al were evaluated since these precipitates may negatively impact the fertilizer p release in the soil vaneeckhaute et al 2016 moreover pollution with organics was accounted for see section 2 2 1 for the nrm strip nrm scrub units purity was evaluated by calculating the amount of volatile target component s captured over the total amount of gas liquid captured finally the formation of scale within the treatment unit is an important operational bottleneck for multiple nutrient recovery technologies especially calcium carbonate caco3 and magnesium carbonate mgco3 formation in the stripping and scrubbing units are of concern to determine scale formation the amount of caco3 and mgco3 precipitates formed were evaluated next to other relevant precipitation reactions the scaling potential was then examined by using the scaling criteria of the ryzner index tchobanoglous et al 2003 2 2 step ii theoretical model development the dynamic mathematical model of each unit process was built using fig 2 i the definition of a chemical speciation model by means of geochemical modelling software phreeqc for model building section 2 2 1 ii the description of a kinetic physicochemical and biochemical transformation model tailored to the models developed in the first step section 2 2 2 and iii the selection of a reactor mass balance model to describe the time dependent process conditions section 2 2 3 2 2 1 chemical speciation model phreeqc for nrm building in order to describe the water chemistry in each system first the potentially present chemical components and species were identified step 1 and the possible heterogeneous physicochemical transformation reactions gas transfer precipitation were selected using generally accepted geochemical software for equilibrium water quality modelling phreeqc 3 0 6 parkhurst and appelo 2013 visual minteq 3 1 was used as a control allison et al 1991 since the involved homogeneous reactions acid base ion pairing in a speciation calculation are very rapid compared to heterogeneous physicochemical reactions and biological reactions instantaneous equilibrium can be assumed adequate for solving water chemistry in nrms batstone et al 2012 in order to compromise between model accuracy and simulation times when coupling the speciation model to the dynamic mass balance model a reduced phreeqc database and input script with defined selected model outputs were developed for each key unit section 2 3 1 the four step procedure proposed for nrm building involving the selection of the relevant species reactions and the preparation of the reduced phreeqc chemical speciation model is presented in fig 3 and further described below 2 2 1 1 step 1 selection of relevant components for each unit process based on literature collected experimental data and prior knowledge the most important physicochemical dissolved components to include in models for nutrient recovery from both digested manure and sludge were selected for each key unit process table 2 in line with the selected model outputs section 2 1 2 it was aimed to represent five important component classes 1 all important macronutrients for recovery in line with the findings in vaneeckhaute et al 2014 impact recovery efficiency and fertilizer value 2 gaseous compounds impact biogas production volatilization odors greenhouse gas emissions among other 3 salts impact ionic strength and soil quality 4 inorganic and organic carbon compounds impact biogas production product purity and scaling 5 micronutrients that may occur in large quantities in waste water treatment e g fe and al as a result of coagulation flocculation practices impact product purity and recovery potential since redox reactions were also considered components that exist in more than one valence state in solution were identified by their component name followed by their valence for instance i the component s c 4 carbon iv constitutes co3 2 plus hco3 plus h2co3 or co2 aq plus various other carbonate complexes present in the solution such as mgco3 and cahco3 and ii s n min3 nitrogen iii constitutes both nh4 and dissolved nh3 as well as its various complexes only for fe the two valence states fe ii and fe iii were lumped together into one component for total fe since the measurement of its valence is complicated and generally not provided in practice in wrrfs nor in literature yet in the speciation calculation the fe ii fe iii redox equilibrium was considered as calculated from the occurring redox potential the input fe redox states e g fe iii cl3 and fe ii so4 can optionally be specified if such data are available as it is well known that the presence of organic compounds may influence the purity of recovered products kozic et al 2011 relevant interactions between inorganic and organic components were also accounted for among the organic biological components considered see section 2 2 3 volatile fatty acids vfas up to valerate were included as individual components in the physicochemical models oh and martin 2010 indeed emphasized the particular importance of their physicochemical behaviour in wrrfs the remaining soluble organic chemical oxygen demand cod fractions see section 2 2 3 were lumped into one component i e dissolved organic carbon doc 1 g doc 0 33 g cod for doc the complexation with metals ca mg was computed using a competitive gaussian model for dissolved organic matter dom 1 mol doc 8 6 10 2 mol dom usepa 1999 this simplified approach may be further refined for future applications if more insights in the physicochemical behaviour of each particular cod fraction become available finally it should be remarked that heavy metals such as cadmium cd copper cu and zinc zn were not yet included in the speciation models nevertheless heavy metals and the corresponding reactions are available in phreeqc hence the generic approach used for chemical speciation allows easy extension of the models to incorporate heavy metals for future applications 2 2 1 2 step 2 addition of relevant components species reactions to generic geochemical databases to verify completeness the generic phreeqc phreeqc dat and minteq minteq v4 dat databases were compared with each other as well as with prior knowledge and with literature two observations were made 1 the generic minteq database is more complete than the phreeqc one in view of wrrf modelling 2 some important components species and reactions that can be expected in wrrfs are not included in either database hence the generic database files were extended prior to use for speciation calculation table 3 the corresponding acid base constants ion pairing constants solubility products and other thermodynamics were taken from literature or other model libraries as indicated in table 3 it should be noted that in the context of nutrient recovery from waste water flows as fertilizer products the database extensions provided concern a fundamental contribution to the field for example k struvite is next to n struvite an interesting fertilizer though its precipitation reaction is not included in the standard databases also precipitation of aluminium phosphate alpo4 is highly important in waste water treatment since al salts are often dosed for sludge conditioning whereas the precipitation reaction of ammonium sulfate nh4 2so4 is essential for description of the scrubbing process noteworthy is also the clear impact of the omission of the species monosodium phosphate i e nah2po4 aq on the simulation results as was observed during model validation of the nrm prec see section 3 4 1 the generic extended database in view of nutrient recovery was named nutricover dat and will be made available for inclusion in future phreeqc and minteq software packages 2 2 1 3 step 3 setting up the speciation submodel selection of relevant species and reactions the following methodology was used for selection of the relevant species and reactions a specification of input scenarios components operational conditions b run phreeqc under the various conditions defined in a c select relevant species and reactions based on the phreeqc outputs d verify the selection of species and reactions with literature a specification of input scenarios realistic ranges for the input component concentrations and operational conditions e g ph and temperature for the speciation calculations were adopted from literature and experimental data as described in section 2 4 as well as through contact with technology providers the operational conditions and input streams tested for each key unit process are the following anaerobic digestion no oxygen ph 5 8 5 temperature 20 55 c input sludge and manure precipitation unit ph 7 11 temperature 20 50 c with and without ca oh 2 cao mgcl2 mg oh 2 or mgo dosing 0 500 mol m 3 input digestate stripping unit ph 7 11 temperature 20 70 c with and without naoh ca oh 2 cao mg oh 2 or mgo dosing for ph increase 0 500 mol m 3 input digestate air scrubber h2so4 solution at ph 1 4 and temperature 15 25 c input stripped air phreeqc makes calculations using an input script in which the problem is specified via keywords and associated data blocks first all possible realistic scenarios were introduced using the maximum minimum values of all considered operational factors and input variables for each unit separately next for each unit the composition of 20 different possible input flows from literature astals et al 2013 bhuiyan et al 2007 cesur and albertson 2005 martin 2003 mattocks et al 2002 tchobanoglous et al 2003 vaneeckhaute et al 2012 2013a 2014 vlaco 2012 zaher et al 2009 was used for simulation under variable operating conditions to this end a phreeqc input script was developed for each unit involving the identification of the input waste flows phreeqc data blocks solution and or gas a batch reaction calculation was also coded in case there is both a gas and liquid input i e for the stripper and scrubbing unit phreeqc data block reaction then one factor at a time was allowed to increase within its range e g phreeqc code reaction temperature 20 0 70 0 in 51 steps while the other factors were kept fixed as such a broad range of input scenarios was screened note that currently no alternative strategy is available in phreeqc for selection of the various simulation scenarios parkhurst d personal communication 2014 yet the development of an adequate but more time efficient procedure to go through a multidimensional set of factors will be aspect of further research b run phreeqc speciation calculations in phreeqc minteq are made using designated thermodynamic databases that include a wide range of data for mineral phases and compounds the calculations are based on three types of equations 1 equilibrium relationships 2 concentration conditions or mass balances one per component and 3 electro neutrality conditions or charge balances chapra 2008 stumm and morgan 1996 by inclusion of oxidation reduction reactions in the database also the components redox states were defined in the speciation calculations the ph may be defined or adjusted according to the charge balance the davies equation was selected for ion activity correction in the nrms similar to ali and schneider 2008 galbraith et al 2014 lizarralde et al 2015 ohlinger et al 1998 and flores alsina et al 2016 the davies ion activity correction was also recommended by hafner and bisogni 2009 above other relevant approaches such as the pitzer ion interaction approach moreover the peng robinson equation of state which corrects for the non ideal behaviour of gases was used for calculating partial pressures p and solubility parkhurst and appelo 2013 furthermore the temperature dependency of the thermodynamic equilibrium coefficients was expressed by means of the van t hoff relationship zumdahl 2005 while the value of the water dissociation constant k w at different temperatures other than 25 c was computed using the equation of harned and hamer 1933 c d selection criteria verification from the speciation calculations the distribution of aqueous species ion activities and saturation indices s i for phases driving forces for precipitation and gas transfer were obtained soluble species with an insignificantly low activity i e less than 0 01 of the total component activity in all scenarios were excluded from the nrms solids that may potentially precipitate s i 0 as well as gases that may volatilize partial pressure p 0 in the different units were selected conditions ph temperature and rates for precipitation of the various forms of the selected minerals were also researched in the literature the aim was to confirm the exclusion of the selected insignificant species and precipitates while further identifying potential species and reactions that should be included in the database for each unit the number of species and reactions that were found to be relevant according the speciation calculations and that were included in each nrm are presented in table 4 a the list of species involved and the transformation reactions included in each model are presented in appendix 1 table a1 1 and tables a1 2 1 6 respectively 2 2 1 4 step 4 building of a reduced model knowing that the generic geochemical model databases contain more than 3000 species allison et al 1991 it was expected that the elimination of irrelevant species and reactions can have a significant impact on the simulation speed as such with the purpose of reducing model complexity and simulation times when coupling phreeqc for nrm simulation section 2 3 a new phreeqc database file including only the selected reactions and species was set up for each unit process moreover a selected output data block was coded in the input script for each unit in order to transcribe only the appointed species and driving forces to the resulting output file the latter is required for efficient coupling of the selected outputs to the kinetic and mass balance model section 2 3 finally simulation results and speeds using the reduced model were compared with results and speeds obtained by running the developed chemical speciation scripts using the full phreeqc dat p and minteq v4 dat m databases available in the phreeqc 3 0 6 release 2 2 2 physicochemical transformation model heterogeneous physicochemical reactions such as liquid gas transfer and precipitation occur much slower than the homogeneous reactions involved in the speciation calculations presented above hence a kinetic approach was applied in order to allow for dynamic variation of the constituents gas exchange processes in resource recovery systems can occur passively i e without intensive gas bubbling nrm ad or actively i e with gas bubbling driven by an external air flow nrm strip nrm scrub in each case similar kinetic gas exchange formulations based on the concentration driving force between the liquid and gas phases apply eq 2 2 ρ t i m l 3 t 1 k l g i a s l i q i h t i p g a s i where s l i q i is the liquid phase activity of component i m l 3 p g a s i is the partial pressure in the gas phase of component i atm h t i is the temperature dependent henry coefficient m l 3 atm 1 h t i p g a s i represents the saturation concentration of gas component i in the liquid k l g i is the overall liquid gas mass transfer coefficient l t 1 and a is the specific surface of the gas bubbles per reactor volume l 1 temperature dependency of h was described by a van t hoff relationship powers et al 1987 while temperature dependency of k l g i a was described using the arrhenius equation chapra 2008 through the coupling with phreeqc section 2 3 1 both s l i q i and p g a s i can be calculated at every time step during the simulations the total gas phase pressure was computed using dalton s law of partial pressures stumm and morgan 1996 for calculation of k l g i a a distinction was made between active and passive systems since the values may differ significantly in practice chapra 2008 sotemann et al 2006 tchobanoglous et al 2003 moreover a second distinction was made depending on the solubility of the gas considered which determines whether mass transfer is liquid film controlled for low to moderate soluble gases h 0 55 i e for ch4 co2 h2 h2s n2 o2 all gases considered in the nrms except for nh3 or gas film controlled for very soluble gases h 0 55 e g for nh3 as such four potential mass transfer scenarios were considered which are described in detail in appendix 2 1 active liquid gas gas liquid transfer nrm strip nrm scrub of low to moderately soluble gases 2 active liquid gas gas liquid transfer nrm strip nrm scrub of very soluble gases 3 passive liquid gas gas liquid transfer nrm ad of low to moderately soluble gases 4 passive liquid gas gas liquid transfer nrm ad of very soluble gases the kinetic liquid solid solid liquid transfer mechanisms described in all nrms are nucleation birth of crystals crystal growth and redissolution all reactions were represented by an empirical power law eq 3 using relative supersaturation s 1 as driving force ali and schneider 2008 galbraith et al 2014 harrison et al 2011 nielsen 1984 3 ρ t i m l 3 t 1 k t s 1 n in which s is the saturation ratio i a p k s 1 v v refers to the stoichiometric precipitation coefficient which represents the total number of species involved in the precipitation reaction i a p is the ion activity product m l 3 k s is the solubility product m l 3 k t is the temperature dependent transfer coefficient m l 3 t 1 and n is the reaction order the value of s was directly derived from the saturation index log i a p k s which is calculated by phreeqc at every time step during model simulations the temperature dependency of the reaction rate was modelled by means of the arrhenius equation greenberg and tomson 1992 nielsen 1984 using literature values for the molecular weight mw and density of the different precipitates the total volume v f e r t i l i z e r total mass moles m f e r t i l i z e r and mw m w f e r t i l i z e r of the recovered fertilizer product composed of the various precipitates was calculated at every time step the time dependent number of particles n p a r t was then determined using the avogadro constant n a 6 022 1023 mol 1 the mean particle diameter d p of the precipitates was calculated assuming spherical particles using equation 4 4 d p l v f e r t i l i z e r n p a r t π 6 3 the kinetic precipitation dissolution coefficient k t and the reaction order n in equation 3 were adjusted according to the liquid solid solid liquid transfer mechanism occurring k g t and n g for growth k b t and n b for nucleation k d t and n d for dissolution the prevalent mechanism depends on the value of s and the amount of seed material in the reactor hence these values were checked at every time step as such four possible scenarios were considered which are described in detail in appendix 2 1 supersaturation occurs s 1 s i 0 and seed material is available 2 supersaturation occurs s 1 s i 0 but no seed material is available and or the crystal size is not large enough to have any influence on the process i e the induction time is not exceeded 3 the solution is undersaturated s 1 s i 0 and precipitate is present in the system 4 equilibrium occurs s 1 s i 0 finally for the nrm prec a generic mechanism for agglomeration and floc break up through the effect of mixing was included using the spherical particle model for macroscale flocculation crittenden et al 2012 appendix 2 a time dependent agglomerate number balance was also provided section 2 2 4 by division of the total fertilizer volume by the number of agglomerates the agglomerate volume was obtained the mean agglomerate diameter can then be computed in the same way as the particle diameter eq 4 it should be remarked that mixing energy may also have to be included in equation 3 growth can be assumed surface integrated controlled when the system is well mixed so the mixing effect can be neglected for the growth equations in unit processes with proper mixing galbraith et al 2014 rahaman et al 2014 however mixing may affect the nucleation mechanism and induction time through microscale flocculation ohlinger et al 1998 this mechanism is very site and species specific hence it was considered out of the scope of the present generic model development study however by selecting a generic empirical equation based on s eq 3 the models could easily be extended to include mixing effects galbraith et al 2014 perez et al 2008 if appropriate parameter correlations are available as mentioned above future extensions may also involve particle size distributions psds nopens et al 2014 perez et al 2008 2 2 3 biochemical transformation model biochemical processes and state variables are clearly important for the nrm ad model the description stoichiometry and kinetics of biochemical transformations that may be expected in the nrm ad were based on the anaerobic digestion model no 1 adm1 batstone et al 2002 resulting in a total of 19 processes appendix 3 table a3 1 ph h2 and nh3 inhibition expressions were taken from batstone et al 2002 over the last ten years various wrrf modellers e g flores alsina et al 2016 mbamba et al 2016 solon et al 2015 wang et al 2016 have developed extensions of adm1 mainly focused on the inclusion of a limited selection of chemical species and reactions to predict unwanted struvite precipitation and s inhibition in the digester since ph plays a critical role in anaerobic digestion modelling batstone et al 2012 solon et al 2015 vaneeckhaute et al 2017b inclusion of a more accurate and complete chemical speciation calculation with associated efficient numerical solution procedure to predict ph and driving forces for physicochemical and biochemical transformations is highly relevant in this study adm1 was for the first time extended with all essential physicochemical components and processes acid base reactions ion pairing liquid solid transfer liquid gas transfer redox transformations that significantly impact anaerobic digester performance and digestate quality selected in section 2 2 1 appendix 3 table a3 1 extension 1 ion pairing of cations with vfas was also accounted for on top of being important for predicting anaerobic digestion ph and performance inclusion of such detailed physicochemical framework is essential for predicting process performance and product quality of physicochemical nutrient recovery unit processes that follow the digester indeed the output digestate characteristics from the anaerobic digestion model should be sufficiently specified and compatible with the required input to the nutrient recovery unit process models similar as in lizarralde et al 2010 biological sulfate reduction sulfurgenesis was incorporated based on the model proposed by knobel and lewis appendix 3 table a3 1 extension 2 an inhibition term for h2s was incorporated in the appropriate bio kinetics ih2s and its transfer to the gas phase was included as described in section 2 2 2 the decay of srbs was included in the same way as the decay of other organisms described in the adm1 model batstone et al 2002 n p k and s release from biomass as well as nutrient uptake by growing biomass was accounted for appendix 3 table a3 1 extension 3 modelling of ebpr sludge was considered beyond the scope of this study section 2 1 1 but for future applications the nrm ad could be further extended using equations from e g ikumi 2011 flores alsina et al 2016 or wang et al 2016 appendix 3 table a3 1 potential extension 4 finally n and p release through disintegration of complex particulates p release from lipid hydrolysis n release from protein degradation and amino acid uptake as well as the n and p content of soluble and particulate inerts were also included the detailed stoichiometric matrix and kinetic transformation equations proposed can be found in appendix 3 tables a3 2 a3 4 in this study the biological solids leaving the digester were supposed to end up mainly in the solid fraction after solid liquid separation of the digestate hence in the subsequent key units for nutrient recovery it was assumed that biochemical particulate transformations do not play a significant role nevertheless in order to allow coupling of nrms to activated sludge models asms in a later stage through return liquors for instance the biological state variables were integrated in all nrms note that the physicochemical interactions with the remaining soluble cod components were included in all models section 2 2 1 2 2 4 reactor model the used reactor design and the default specifications and features for each unit process are compiled in appendix 4 for each unit process a mass balance was written not only for all components in the liquid phase s e g equation 5 but also for all components in the gas phase g all precipitated components p and all particulate biological solids x including both a transport term based on in and outgoing flow rates and a transformation term involving liquid gas gas liquid transfer liquid solid solid liquid transfer and biochemical transformations 5 d s l i q i v l i q d t m t 1 s l i q i n i q l i q i n s l i q i q l i q o u t v l i q j 1 n ρ j v i j where j 1 n ρ j v i j is the summation of the specific kinetic process rates for process j ρ j m l 3 t 1 multiplied by the stoichiometric coefficient for component i on process j v i j m m 1 q l i q i n and q l i q o u t are the in and outgoing liquid flow rates l 3 t 1 v l i q is the bulk reactor volume l 3 and s l i q i n i and s l i q i refer to the activities of the in and outgoing liquid components m l 3 in addition a mass balance for the seed material in the reactor was included similar as equation 5 the mass of seed material was adjusted in time according to the mass of precipitates present in the reactor and the liquid volume hence it was assumed that newly formed crystals act as seed material for precipitation similar as was experimentally discovered by le corre et al 2007 external seed material can also be added for the precipitation unit nrm prec also particle and agglomerate number balances were implemented the number of free precipitated particles was assumed to reduce according to the agglomerates formed as in crittenden et al 2012 note that agglomeration was only accounted for when mixing is present in the reactor section 2 2 2 2 3 step iii model implementation and numerical solution 2 3 1 model coding and state vector definition the main coding language used in this study was modelica which is a high level declarative and object oriented modelling language claeys et al 2006 elmqvist et al 1999 it is similar to the model specification language msl which is currently used in tornado west mikebydhi com vanhooren et al 2003 one of the most common software packages used in waste water quality modelling however modelica has a better readability and expressiveness and because of the more important industrial use audi ford siemens etc of modelica compared to msl the modelling community using tornado west recently decided to convert all conventional models for waste water treatment from msl to the more powerful and more widely supported modelica coding language tornado west supports the use of both msl and modelica languages claeys et al 2006 as mentioned above section 2 2 1 a phreeqc script was written for each unit process separately in order to include water chemistry a selected output statement involving the selected species activities saturation indices s i s partial pressures p s as well as the ph temperature alkalinity and ionic strength was defined the obtained s i s and p s are then used as driving forces for precipitation and gas transfer in the modelica code describing the slow transformation processes eqs 2 and 3 since only small differences exist between the selected components for the different nrms table 2 it was decided to define one generic component state vector for each different phase as such five different nrm component state vectors were enumerated appendix 5 table a5 1 1 components s1 the components in the liquid phase i e the main waste flow 2 components s2 the components in the h2so4 solution used in nrm scrub 3 components g the components in the gas phase 4 components p the components in the precipitated phase 5 components x the particulate biological solids the components s1 state vector was further split into a components s1 pc and a components s1 bio state vector in order to describe physicochemical transformations and biological cod transformations separately all state variable quantities involved in the physicochemical calculations components g components p components s1 pc were expressed on a molar base whereas the state variables only involved in biological transformations components x components s1 bio were expressed on a cod base moreover for each model separately a species state vector was enumerated referring to the phreeqc selected output which is different for each unit process parameters and equations for the slow physicochemical and biochemical transformations and mass balances for all total components were implemented in modelica using a multi matrix structure the tableau method matrix implementation of morel and herring 1993 was used as generic method for linking total soluble component activities to species activities and total precipitated component concentrations to precipitate concentrations in the nrms whereas the gujer 2008 matrix implementation was used to describe the biochemical reactions involved 2 3 2 numerical solution and model execution procedure to overcome problems related to the numerical solution of stiff systems see section 1 the slower reactions sections 2 2 2 2 2 4 and mass balances section 2 2 5 were represented by ordinary differential equations ode coded in modelica while the fast reactions section 2 2 1 were assumed to reach steady state instantaneously and were calculated algebraically by use of algebraic equations ae at each iteration step using the software tool phreeqc parkhurst and appelo 2013 in contrast to other wrrf modellers e g flores alsina et al 2016 hauduc et al 2015 mbamba et al 2016 takács et al 2006 that implemented their own water chemistry module the use of preeqc to solve water chemistry was brought forward in this study see section 2 vaneeckhaute et al 2017b phreeqc has a dedicated and proven solver newton raphson based for the complex set of implicit non linear equilibrium equations involved phreeqc was preferred over other geochemical models e g minteq wham and wateq4f because of its ease of integration with diverse scripting languages and other model libraries next to its more precise methodology for precipitation calculations charlton and parkhurst 2011 recently a c callable api application programming interface for the phreeqc engine has become available under the name iphreeqc it allows for easily coupling of the phreeqc engine to software developed in other programming languages the api provides direct access to the geochemical processes in the phreeqc library as well as support for new phreeqc specification keywords that allow for easier manipulation of phreeqc input and output data charlton and parkhurst 2011 the models coded in the modelica language with invocations of the phreeqc engine for speciation calculation were then executed through the tornado west framework for modelling and virtual experimentation on the basis of sets of complex odes and aes a generic mechanism for calling phreeqc from modelica specified models using tornado was developed fig 4 it consists of a tornado specific phreeqc wrapper library containing only a predefined set of methods to be used in tornado west as well as a reduced phreeqc database and a phreeqc script with selected outputs section 2 2 1 any phreeqc code can now be run using input data supplied by tornado west and providing output data to be used by tornado west in a flexible manner without the need for any case specific c c code modifications by the user as a result the combined kinetic equilibrium models can now be used for simulation and other tasks such as parameter estimation optimization scenario analysis monte carlo simulation sensitivity analysis and steady state analysis through the tornado cui command line user interface tool the user friendly tornado experimenter gui graphical user interface or west fig 4 finally for numerical solution in tornado two different solvers rk4asc runge kutta 4 adaptive step size control integration algorithm press et al 1992 and vode variable coefficient ordinary differential equation solver brown et al 1989 were compared the rk4asc algorithm was retained since simulation times were much faster and results more stable this is likely related to its higher ability to solve models with certain discontinuities i e sharp switches in behaviour e g transitions in precipitation mechanisms as function of the saturation index and dynamic inputs disturbances claeys 2008 2 3 3 phreeqc tornado interface in order to connect state vectors used by phreeqc c code and tornado modelica code a phreeqc tornado interface was developed fig 5 the interface makes special use of the data defined by the selected output data blocks section 2 3 1 and allows this array of data to be returned to tornado without the necessity to read or write files hence the data can be transferred between phreeqc and tornado through internal computer memory this method of tight model coupling has significant merits with respect to calculation time and programming a phreeqc instance is only created once and is subsequently reused preserving its internal state in general an order of magnitude decrease in run times is obtained compared to a loosely coupled model which requires starting phreeqc as an external process for each time step müller et al 2011 on top of that comes the gain in simulation time by using the developed reduced phreeqc databases and scripts instead of full phreeqc section 2 2 1 hence a reduction of execution time is obtained at two critical points during model simulations i the uploading and reading of database and input files and ii the transfer of data between phreeqc and tornado 2 3 4 model verification and debugging after implementation the models were subjected to a battery of tests to ensure implementation correctness also referred to as model verification dochain and vanrolleghem 2001 a generic six step procedure for model verification of nrms was developed and applied to each unit process separately 1 verification of the phreeqc tornado interface comparison of speciation calculations in tornado through tight coupling to reduced phreeqc with simulation results from the independent full phreeqc engine 2 verification of the physicochemical transformation model implementation of slow physicochemical transformations in modelica code execution in tornado and mass balance check 3 verification of the biochemical transformation model implementation of slow biochemical reactions in modelica code execution in tornado and i mass balance check ii check against independent implementations e g adm1 batstone et al 2002 and the lizarralde et al 2010 model for anaerobic s degradation 4 verification validation at steady state performance of steady state simulations using different initial values from literature and comparison with experimental literature results 5 verification validation of dynamics performance of dynamic simulations using realistic databases and checking the effect of disturbances e g different loading scenarios on model outputs through comparison with prior knowledge and literature 6 verification of the generic nrm implementation comparison of simulation results obtained with two different independent implementations of each unit process model one based on all separate individual equations and one compact implementation based on vectors and matrices as such typing errors inconsistencies gaps and conceptual errors were eliminated while software bugs were discovered and dealt with 2 4 step iv dataset collection and identification of data needs one of the issues in the development of new models is the necessity to provide data for the estimation of model parameters and for the input variables the different types of data required for each key nrm and the datasets that were used are provided in appendix 6 table a6 1 first a thorough review of literature and existing models was conducted to provide default values for the different parameters involved appendix 6 table a6 2 a6 5 physicochemical stoichiometry and thermodynamic parameters are incorporated in the phreeqc and visual minteq modelling software where they are mainly taken from the national institute of standards and technology nist 2001 database default values for the kinetic precipitation coefficients were taken from literature while default values for biomass kinetic coefficients were taken from the adm1 model batstone et al 2002 except for the srb kinetics for which the parameters were taken from knobel and lewis 2002 and lizarralde et al 2010 next to literature studies also new experimental data aiming at nrm validation were collected through lab pilot scale testing and contact with industry for nrm ad full scale data at steady state from an anaerobic reactor treating s rich paper mill primary sludge located at the wrrf holmen paper madrid spain has been obtained from the center of studies and technical research ceit san sebastian spain appendix 6 table a6 6 an input fractionation was conducted following the procedure proposed by grau et al 2007 for validation of the nrm prec lab tests were conducted for p recovery from digestate under different operating conditions i e different mg p ratios and contact time notably for this purpose two different digestates were sampled at the full scale biogas plants of sap eneco energy houthulst belgium and wittevrongel eneco energy aalter belgium which both treat agricultural wastes mainly manure a detailed input characterization was performed prior to the experiment appendix 6 table a6 7 the precipitate was separated from the effluent by means of a centrifuge 5 min at 2000 rpm heraeus megafuge 1 0 kendro laboratory products hanau germany after which both fractions were also physicochemically analyzed the p recovery efficiency was then calculated using the p recovery of a control no mg addition as a reference for detailed methodology and experimental results reference is made to de corte 2012 to obtain data for the nrm strip nrm scrub a technical and financial survey for a case treating 2000 m3 d 1 of digestate at 200 mol nh4 n m 3 more details appendix 6 table a6 8 was carried out with various key suppliers in the field as such insights in the variability of the processes available to date were obtained e g different target ammonium sulfate concentrations operational ph and temperature consumables among other these detailed data provided by the suppliers were used for further model refining and validation finally it should be stated that during model development new data needs appeared for which to date literature references are lacking such data gaps were identified and recommendations for future experiments and data collection are provided further in this paper section 3 5 2 5 step v model validation model validation was performed in four different ways i validation against prior knowledge ii validation against existing models iii validation against literature or technical inquiries and iv validation against collected experimental results in all cases the default stoichiometric and kinetic parameter values determined in section 2 4 were used input waste stream compositions design data and operational conditions were taken from the dataset involved during the validation procedure attention was given to the reduced phreeqc database used in order to assure that all required species and reactions are included in the calculations if required an additional evaluation was conducted using the full phreeqc and or minteq database and missing species reactions were additionally added to the reduced database 2 6 step vi scenario analyses and process optimization to gain more insight into the results and to further explore the model outcomes scenario analyses were performed in tornado west claeys 2008 moreover the applicability of the models for process optimization was demonstrated by running optimization experiments in tornado west claeys 2008 3 results and discussion the implementation of the models developed in section 2 was verified and validated first simulation times for the reduced models are evaluated in section 3 1 general verification results and verification examples showing the correctness of the phreeqc tornado interface are presented in section 3 2 an example of model validation against experimental results including scenario analyses and or process optimization is given for each nrm in sections 3 3 3 5 finally recommendations for further research are provided in section 3 6 3 1 evaluation of reduced phreeqc simulation times a comparison of simulation times of the developed scripts for each unit process model using the full databases and the corresponding reduced database is presented in table 4 b a 3 to 5 fold average improvement of model simulation speeds was obtained using the reduced database as compared to full phreeqc dat and minteq v4 dat respectively the observed deviation in simulation times between phreeqc and minteq shows again the higher completeness of the minteq database note that the presented simulation times in table 4b concern the chemical speciation model only so without the coupling to the kinetic and mass balance model yet this model reduction is clearly relevant for simulation of wrrfs since the speciation model is run at every time step during nrm model simulations section 2 3 3 as such running a complete digestate treatment train under dynamic conditions for one year would take approximately 15 min depending on the operating conditions and input characterization using the reduced phreeqc model whereas it would take 45 min using the full phreeqc model both with tight model coupling section 2 3 3 to the kinetic model as mentioned above it is important for model validation to keep in mind that a model reduction was performed as such for example it was discovered during initial validation of the nrm prec model that the species nah2po4 aq was lacking though essential for correct prediction of p recovery section 3 4 1 3 2 model verification 3 2 1 general results and issues during model verification various software bugs were discovered and communicated to dhi merelbeke belgium who successfully resolved the issues as such this research also contributed to the development of the tornado west software kernel each step in the verification procedure was completed successfully first the phreeqc tornado interface was found to be effective see section 3 2 2 next the mass balance check provided good results for each nrm the step by step comparison of the gujer matrix with other digester model implementations showed that the biochemical reactions were correctly implemented tests performed to check the ability of the models to realistically respond to model inputs both under steady state and dynamic conditions allowed eliminating small implementation errors some examples of tests and effects performed for model verification validation can be found in appendix 7 finally simulation results obtained from the two different independent implementations of the same model for each unit process i e one using individual equations and one using a multi matrix structure were identical during model verification three important general issues were observed to which future wrrf model developers must pay attention first it was found that some components species and precipitates that are highly important for modelling of wrrfs are not yet included in the generic phreeqc and or minteq databases section 2 2 1 table 3 hence for each new nutrient recovery model the chemical speciation calculation should be verified with multiple software packages with literature and with prior knowledge in order to comprehensively select which components species and precipitates should be included in the model and which ones can be excluded secondly if an input to phreeqc is set to 0 or if a species is not defined or not present in the calculation then a value of 999 999 is printed as output for this component s species distribution and the corresponding saturation indices and partial pressures in the modelica code these outputs are then used as driving forces for slow transformations leading to incorrect calculations this issue was solved by introduction of an if then else statement in the phreeqc tornado interface finally attention should be paid to the use of units for input and output variables input concentrations in phreeqc are expressed by default as mole m 3 whereas the outputs are given by default as kmole m 3 deviations from these standard units should be declared in the phreeqc script 3 2 2 verification of phreeqc tornado interface when comparing simulation results using the stand alone full phreeqc engine and tornado with tight coupling to reduced phreeqc identical model outputs were obtained for all nrms as an example the results for the nrm scrub are given in table 5 an initial gas phase flow with high nh3 load coming from the nrm strip was used as input to the nrm scrub and brought into contact with a sulfuric acid solution for nh3 absorption the outputs i e the logarithm of the partial pressures log p atm in the purified gas phase and the activities mole m 3 of some species in the ammonium sulfate solution after gas liquid exchange obtained with both the stand alone phreeqc engine and tornado phreeqc are presented it can be concluded that the implementation of the phreeqc tornado interface and the phreeqc invocation in modelica are correct 3 3 nrm ad validation 3 3 1 case study anaerobic reactor at holmen paper madrid spain the nrm ad model was validated using experimental data collected under steady state conditions from an anaerobic digester for treatment of s rich paper mill primary sludge at a full scale wrrf holmen paper madrid spain the same case was previously used for validation of the lizarralde et al 2010 model for anaerobic s reduction the input sludge characteristics design parameters initial reactor state variables and operating conditions are given in appendix 6 table a6 6 kinetic and stoichiometric parameters were set at default section 2 4 a comparison of experimental and simulation results using the nrm ad and the model proposed by lizarralde et al 2010 is given in table 6 simulation results using the nrm ad show good agreement with the experimental results for cod removal and biogas ch4 and co2 composition at a particular ph the model also seems to give a very good prediction of the digestate ph and p content and a relatively good prediction for nh4 n in the digestate the slightly higher digestate nutrient value for nh4 n obtained with the nrm ad may be attributed to losses of nh3 during digestate sampling and analysis although potential model deficiencies may not be excluded the nrm ad seems to underpredict the biological so4 removal and corresponding h2s production by srbs as will be explored below however from a pure validation perspective note no parameters were calibrated when comparing with the lizarralde et al 2010 model overall the performance of the nrm ad is significantly better very probably due to the underlying more detailed chemical speciation and the inclusion of multiple competing physicochemical transformation reactions 3 3 2 exploration of hypotheses regarding s cycle measurements through model scenario analyses four potential hypotheses were tested to explore the underestimation of biological so4 removal in the above case study first it was observed that the biogas h2s concentration was very sensitive to variations in ph cfr al zuhair et al 2008 model simulations were carried out at the digestate ph 7 21 however the input ph was significantly lower 6 66 and the digestate ph may be influenced through contact with air hence there exists some uncertainty about the actual reactor ph to explore this hypothesis a scenario analysis was conducted in order to evaluate the effect of ph variable on the ch4 co2 and h2s in the biogas at fixed waste input cod so4 ratio assuming that the ph in the reactor ranged from 6 66 waste input ph to 7 21 digestate ph the biogas composition varied from 61 ch4 34 co2 2 94 h2s to 80 ch4 16 co2 1 90 h2s hence with the present implementation it was not possible to obtain 6 h2s in the biogas at a ph in that range it should be remarked that the experimentally obtained biogas h2s content of 6 is extremely high compared to literature values typical biogas h2s values for similar concentrated sulfurous streams from the paper industry range between 1 and 2 h2s reiter and piccot 2004 hence a second reason for the uncertainty may be related to the h2s analysis itself conducted by the operators a third explanation may be the exclusion of lactate in the present nrm ad implementation lactate is a preferred substrate for sulfate reducing bacteria and would thus aid in increasing so4 removal and h2s production oyekola et al 2007 this may explain the slight overestimation of biogas co2 production and underestimation of h2s production in the present case no lactate measurements were available but future research should consider this component furthermore the non consideration of reactions precipitation ion pairing with al and fe due to lack of input al fe measurements at the wrrf may explain the lower so4 removal found through simulation cfr zhang et al 2013 this can also explain why model predictions for cod removal and ch4 production were good while additional cod would be required for additional so4 removal by srbs based on a similar reasoning lizarralde et al 2010 assigned potential sulfate precipitation which was not considered in their model to the highly overestimated h2s production found with their model an attempt to calibrate input al in the present case study showed that a reactor concentration of 276 mol al m 3 resulted in a so4 removal of 78 experimental value in table 6 and a biogas h2s concentration of 3 however in this scenario the ph lowered to a value of 6 26 the higher so4 removal found through addition of al was likely the result of a combination of multiple effects it was for example observed that the addition of al affected the amount of ca mg sulfates and ca mg precipitates formed the addition of fe resulted in a lower h2s production because of fes precipitation but it did not aid in so4 removal finally other model gaps can of course not be ruled out and one should bear in mind that the above validation is based on a one time test it can be concluded that more detailed waste water input characterizations including all selected components for the nrm ad unit process section 2 2 1 table 2 as well as instantaneous ph measurements in the reactor are required in order to correctly calibrate the model for biological s removal nevertheless clearly exploration using the nrm ad leads to increased insights and better understanding of the various interacting processes occurring in digesters 3 4 nrm prec validation 3 4 1 phosphorus precipitation at different mg p ratios for validation of the nrm prec model batch experiments were carried out in the lab for p recovery from two different crude digestates section 2 4 appendix 6 table a6 7 different mg p ratios obtained through dosing of mgcl2 6h2o were applied aiming at the production of n struvite mgnh4po4 6h2o or map or k struvite mgkpo4 6h2o or mkp fertilizer initial simulation results showed a large deviation from the experimental results table 7 after evaluation using the full phreeqc and minteq databases this deviation could be attributed to ion pair formation of nah2po4 a species that was initially not included in the reduced phreeqc database nor in the generic phreeqc database table 3 indeed due to the high na concentration of both digestates na paired with p making it less available for precipitation when nah2po4 was added as species to the reduced database a very good agreement between the simulation and the experimental results was obtained for p recovery at steady state after 12 h table 7 this finding is in line with the results obtained by li et al 2012 who found a five times higher residual effluent p concentration when nah2po4 mgcl2 6h2o were dosed for struvite precipitation compared to the dosing of h3po4 mgcl2 6h2o moreover recently chauhan and joshi 2014 found that at high na nh4 ratios nah2po4 is formed instead of or next to nh4h2po4 the precursor for map precipitation in turn this compound may be transformed into na struvite through the following reaction nah2po4 2h2o mg ch3coo 2 4h2o h2o namgpo4 7h2o 2ch3cooh the formation of na struvite was not yet included in the nrm prec model due to lack of knowledge on the existence the stoichiometry and the kinetics of this precipitation reaction however knowing that current practice often involves the addition of naoh for ph increase prior to struvite crystallization the case study above clearly shows the relevance of further research on na p ion pair formation and na struvite precipitation kinetics in waste waters the phenomenon may not only impact the effluent quality but also the quality of the resulting recovered fertilizer product i e a potential mixture of n k and na struvite may appear 3 4 2 exploration for process understanding and optimization two questions arise from the experimental and simulation results presented above table 7 1 why is the p recovery efficiency rather low for both digestates 2 why does increasing the mg dose not improve the p recovery efficiency the ability of the models to find an answer to such questions is presented below first it was observed experimentally and through simulations that the main precipitated components next to p were al ca fe k mg and n iii hence the product recovered was definitely not pure map or mkp a scenario analysis evaluating these components was conducted for both digestates in order to obtain more insights in the results fig 6 the two tested digestate compositions under study are marked as stars in fig 6 the maximum achievable p recovery as function of the input mg and ca content was 56 2 for digestate 1 fig 6a whereas it amounted to 90 7 for digestate 2 fig 6b this discrepancy can be attributed to the higher concentration of fe and al in digestate 1 compared to digestate 2 appendix 6 table a6 7 indeed at high concentrations of both fe and al mainly hercynite feal2o4 precipitation occurs whereas at low concentrations p recovery increases through precipitation of alpo4 and vivianite fe3 po4 2 8h2o furthermore the inhibition of p precipitation due to the presence of soluble ca is very clear for both cases see details fig 6 up to 110 mol m 3 of input ca the margin in which the digestates under study are situated mainly ion pairing of cahpo4 aq and capo4 was observed which decreased the amount of p available for precipitation cfr lin 2012 above a value of 110 mol m 3 calcium phosphates became oversaturated precipitation occurred and p recovery increased this effect of ca inhibition observed through model simulations is in agreement with the experimental findings of huchzermeier and wendong 2012 the latter concluded that struvite purity decreased because of the formation of calcium phosphates when the ca p activity ratio was greater than 0 5 to 1 secondly the fact that the p recovery efficiency in the presented experiment was not much influenced by increasing mg p ratios can according to the model be attributed to the formation of dolomite camg co3 2 as well as mg oh 2 and mg2 co3 oh 2 3h2o at higher ca and mg concentrations indeed higher ca and mg doses are associated with a ph increase which favours carbonate and hydroxide precipitation zumdahl 2005 when the input ca concentration would be 0 one can see an increase in p recovery with increasing mg dose due to the formation of mkp note high k concentration in the input waste stream and mg phosphates this competitive effect between mg ca and p found through nrm prec simulations is in agreement with the findings of lin 2012 who obtained a precipitate mixture of struvite dolomite mg oh 2 calcium phosphates and caco3 in experiments on p recovery from digested swine manure based on the above mentioned findings two optimizations of the process can be proposed if the aim would be to produce high purity struvite 1 removal of caco3 through precipitation prior to the experiment e g using a filtration system as in huchzermeier and wendong 2012 2 elimination or reduction of the use of fe and al in the wrrf processes upstream of the precipitation unit e g for improved sludge dewatering this measure could also be assessed by locating the struvite precipitation unit upstream in the wrrf e g immediately after the activated sludge as system cfr combined use of the wasstrip and pearl process for improved p release and struvite recovery cullen et al 2013 in fact the as system itself could also partially be replaced by a strip scrub system when applying these proposed measures in a treatment train for digestate 1 the maximum achievable p recovery through simulation became 91 consisting of mkp mg oh 2 and mg3 po4 2 hence a pure mg p k fertilizer would be obtained fig 7 remark that the main precipitate found mkp is not included in the standard phreeqc minteq databases hence again the extensions provided to the database are clearly relevant section 2 2 1 it should also be noted that in fig 7 the mg dose was allowed to change within the range of 0 500 mol m 3 so no point measurements are presented hence the abrupt changes in slope are related to actual changes in precipitation mechanisms which could e g involve transitions from nucleation to particle growth and or agglomeration and or redissolution and changes in precipitated species due to changes in saturation indices moreover an interesting observation made through model simulations was that without any addition of mg a high p recovery efficiency of 72 could be obtained this could be appointed to the precipitation of k2nh4po4 6h2o pure n p k fertilizer due to the high amounts of k available in the digestate appendix 6 table a6 7 in this case an economic analysis is recommended to select a target fertilizer thereby taking into account local fertilizer market demands and environmental and fertilizer regulations on the one hand the use of chemical mg may increase the operational costs of p recovery while on the other hand a higher recovery efficiency can be obtained with larger mean particle diameter of the recovered precipitates mainly mkp as predicted with the nrm prec larger particles generally increase the revenues from fertilizer sales vaneeckhaute et al 2017a 3 5 nrm strip nrm scrub validation 3 5 1 nh3 recovery at different operating conditions during validation of the nrm strip and nrm scrub models nh3 stripping was found to be very sensitive to the total and relative input concentration of carbonates ca and na since these determine the input alkalinity and ph since operators usually only measure nh3 and ph sometimes total alkalinity an identifiability problem arises for example when using the design parameters and input flow characterization s n min3 ph of collivignarelli et al 1998 a good agreement was obtained between experimental and simulation results for nh3 recovery table 8 however due to lack of some fundamental input flow characteristics for ph calculation using the nrm strip model the input composition had to be calibrated in order to approximate the operational ph evidently there are multiple ion combinations possible to obtain the specified ph and the choice of the combination may influence the model outputs hence in order to effectively use the nrm strip nrm scrub models for process optimization the initial waste flow composition should be characterized in more detail than is usually done at wrrfs today irrespective thereof it can be seen in table 8 that the model responded correctly to disturbances operational decisions such as an increase in ph temperature and air flow rate cfr collivignarelli et al 1998 3 5 2 treatment train for nh3 recovery in order to overcome the above mentioned identifiability issue a technical survey was sent out to key suppliers of strip scrub units for the treatment of a particular digestate flow section 2 4 using the predefined input characteristics appendix 6 table a6 8 as well as the dimensions operating conditions effluent quality and stripping performance offered by the different suppliers the models were again validated for the different configurations received to this end first a treatment train consisting of nrm chem nrm strip and nrm scrub was built to reflect a full scale installation then model simulations using the design data were conducted and scenario analyses were performed in order to compare simulation results with the experimental data obtained from the suppliers the data of the supplier who provided the most detailed experimental results rvt process equipment gmbh are presented below as an example an nh3 recovery efficiency of 90 at 55 c was guaranteed by the supplier when increasing the ph to a value of 10 3 by addition of 102 5 mol m 3 naoh d 1 under the design conditions provided in appendix 6 table a6 8 the same results were obtained through treatment train simulation table 9 finally technology providers also advised to remove excess input carbonate buffer capacity prior to treatment e g through co2 stripping in order to minimize naoh consumption for ph increase as well as caco3 precipitation in the reactor pérez 2002 this recommendation could be confirmed using the nrm strip model fig 8 shows the decreasing nh3 recovery efficiency as function of carbonate buffer capacity if the naoh consumption and other operating conditions would not be adjusted hence the more carbonate is stripped off the higher the reactor ph and the higher the nh3 recovery efficiency note that based on this principle some technology suppliers provide an integrated co2 and nh3 stripping process without using naoh for ph increase vaneeckhaute et al 2017a 3 6 recommendations for further experimental research the results show that the performance of all resource recovery systems under study is very sensitive to the input waste stream composition e g through its direct effect on the ph therefore in order to obtain good model predictions for a particular waste flow the input flow should be characterized in more detail than is usually done at wrrfs today this observation is similar to activated sludge modelling in which influent characterization is considered as the most important step for achieving accurate results rieger et al 2012 it is clear that a better characterization of the input composition may help to adjust the use of consumables e g chemical dose and air requirements to a minimum thereby reducing the operational costs as such the models can be used as an invaluable tool for process optimization new experimental results including detailed input characterizations are currently being collected at pilot full scale under dynamic conditions in order to further calibrate and validate the proposed nrms a second issue observed is that values for the precipitation kinetics k t and gas transfer coefficients k l g a used from literature are commonly determined under ideal conditions i e gas transfer in clean water and precipitation in a synthetic solution containing only the target species involved in the reaction e g mg nh4 and p for struvite precipitation however the actual value of these parameters may be highly influenced by the complex matrix of the waste streams involved e g through ion pairing section 3 4 1 concurrent and competing precipitation reactions section 3 4 2 and the presence of seed material studies evaluating kinetic rates under actual process conditions are lacking in literature but should be focus of further research in order to correctly calibrate these parameters in the nrms moreover rates and mechanisms for nucleation agglomeration and dissolution of various precipitates are still unknown and should be further studied in this perspective the use of the simple empirical equation eq 3 for liquid solid solid liquid transfer in the nrms is interesting compared to previously used approaches in wastewater treatment e g hauduc et al 2015 lizarralde et al 2015 musvoto et al 2000 another important complication is related to the characterization of the precipitates formed x ray diffraction is the commonly used technique to characterize precipitates in pure solutions however it generally requires pure crystals of high regularity to solve the structure of a complicated arrangement of atoms also the results usually represent a very local microstructure and it requires a lot of work to obtain a certain statistical reliability on the results tanigawa et al 2003 more research is required on the development of a generic and cost effective experimental method to accurately characterize the different precipitated species from a complex waste matrix such a procedure may not only be used to determine the precipitated species in precipitation units and hence the recovered product purity vanrolleghem and vaneeckhaute 2014 but also for example the precipitates in the digestate leaving the digester the latter is relevant as these precipitates may act as seed material for precipitation downstream finally interesting model extensions have been identified they lead to the inclusion of i lactate as specific substrate for biological sulfate removal in the nrm ad e g as in uct 2007 ii a transformer tool in the nrm ad to allow for co digestion of multiple input streams e g the giscod tool zaher et al 2009 iii biochemical transformations of ebpr sludge in the nrm ad e g as in flores alsina et al 2016 ikumi 2011 or wang et al 2016 iv microscale flocculation in the nrm prec e g as in crittenden et al 2012 v particle size distributions in the nrm prec e g as in perez et al 2008 vi differential settling in the nrm settle and if relevant in the nrm prec e g using the stokes equation crittenden et al 2012 or a particle settling velocity distribution bachis et al 2015 vii heavy metals and other contaminants in all nrm models these extensions will of course lead to further experimental data requirements 4 conclusions and future perspectives the first available generic nutrient recovery model nrm library including dynamic mathematical models based on both detailed chemical solution speciation calculations as well as physicochemical and biochemical reaction kinetics was developed through phreeqc tornado west coupling and successfully validated at steady state implementation correctness was verified under steady state and dynamic conditions using a 6 step procedure including e g a comparison of the simulation outputs of two independent model implementations for each unit process one based on individual equations and one compact matrix based implementation using a systematic procedure for phreeqc database reduction a 3 to 5 fold improvement of model simulation speed was obtained as compared to the use of standard thermodynamic databases on top of the improvement obtained through tight model coupling because of gaps in existing standard thermodynamic databases an extended database with the purpose of nutrient recovery was made available named nutricover dat detailed input characterization was found to be most critical for accurate prediction of resource recovery process performance simulation results showed the high potential of the nrm library to increase understanding of nutrient recovery process interactions and to optimize integrated nutrient and energy recovery systems the use of the nrm library by the various stakeholders in the field to facilitate the implementation operation and optimization of nutrient recovery technologies can stimulate the transition from wwtps to more sustainable wrrfs acknowledgements this work has been funded by the natural science and engineering research council of canada nserc the fonds de recherche de québec sur la nature et les technologies frqnt and primodal inc québec qc canada through an industrial innovation scholarship bmp innovation 178263 and an nserc discovery grant rgpin 2017 04838 awarded to the first author peter vanrolleghem holds the canada research chair in water quality modelling the authors would like to thank lizarralde izaro ceit spain for experimental data delivery appendix 1 physicochemical species and reactions included in the nutrient recovery models nrm table a1 1 dissolved species included in each nutrient recovery model nrm 1 nrm ad anaerobic digestion 2 nrm prec precipitation crystallization 3 nrm strip stripper 4 nrm scrub scrubber resulting from speciation calculations using phreeqc and visual minteq modelling software table a1 1 species 1 2 3 4 species 1 2 3 4 species 1 2 3 4 species 1 2 3 4 acetate x x x dom x x hso4 x nacl aq x x x al3 x x x fe2 x x x h valerate x x x naco3 x x al oh 2 x x fe3 x x x k x x x nahco3 aq x x al oh 3 aq x x fecl x k acetate aq x x x nahpo4 x x x al oh 4 x x x feco3 x kcl aq x x x nah2po4 aq x x butyrate aq x x x fehpo4 aq x x khpo4 x x x nano3 aq x x ca2 x x x fehs x kh2po4 x x naoh x x ca acetate x x x fe hs 2 x kno3 aq x x napo4 2 x ca butyrate aq x x x feh2po4 x koh aq x x naso4 x x x cacl x x x fenh3 2 x x x kpo4 2 x n2 aq a x x x x caco3 aq x x x fe nh3 2 2 x x x kso4 x x x nh2coo x x ca dom x x fe nh3 3 2 x mg2 x x x nh3 aq x x x x cahco3 x x feoh x x x mg acetate x x x nh4 x x x x cahpo4 aq x x x fe oh 2 aq x x x mg butyrate x x x nh4so4 x x x x cah2po4 x fe oh 3 x x mgcl x x x no3 x x x x canh3 2 x x x feso4 aq x mgco3 aq x x x oh x x x x ca nh3 2 2 x h x x x x mg2co3 2 x x o2 aq x x x cano3 x h2 aq x x x mg dom x x po4 3 x x x caoh x h acetate x x x mghco3 x x x propionate x x x capo4 x x x h butyrate x x x mghpo4 aq x x x so4 2 x x x x ca propionate x x x h dom x x mg nh3 2 2 x x x valerate x x x caso4 aq x x x hco3 x x x x mgoh x x x ca valerate aq x x x hpo4 2 x x x mgpo4 x x x ch4 x x x x h2po4 x x mg propionate x x x cl x x x hs x x x mgso4 aq x x x co2 x x x x h2s aq x x x na x x x co3 2 x x x x h propionate x x x na acetate aq x x x a values between brackets represent the use of air instead of chemicals for ph adjustment table a1 2 acid base systems and reactions ab included in each nutrient recovery model nrm ad anaerobic digestion prec precipitation crystallization strip stripper scrub scrubber ac acetate bu butyrate pro propionate va valerate table a1 2 acid base system no acid base reaction ad prec strip scrub acetate ab1 ac h hac x x x ammonia ab2 nh3 aq h nh4 x x x x butyrate ab3 bu h hbu x x x carbonate ab4 co3 2 h hco3 x x x x ab5 hco3 h h2co3 aq x x x x phosphate ab6 po4 3 h hpo4 2 x x x ab7 hpo4 2 h h2po4 x x ab8 h2po4 h h3po4 x x propionate ab9 pro h hpro x x x sulfate ab10 so4 2 h hso4 x sulfide ab11 hs h h2s x x x valerate ab12 va h hva x x x water ab13 h oh h2o x x x x table a1 3 redox couples and reactions r included in each nutrient recovery model nrm ad ad anaerobic digestion prec precipitation crystallization strip stripper scrub scrubber ac acetate bu butyrate pro propionate va valerate table a1 3 redox system no redox reaction ad prec strip scrub c iv c iv r1 co3 2 10h 8e ch4 3h2o x x x x fe ii fe iii r2 fe3 e fe2 x x x h 0 h i r3 2h 2e h2 x x x n iii n v r4 no3 10h 8e nh4 3h2o x x x x n 0 n v r5 2no3 12h 10e n2 6h2o x x a x x o ii o 0 r6 o2 4h 4e 2h2o x x x s ii s vi r7 so4 2 9h 8e hs 4h2o x x x a values between brackets represent the use of air instead of chemicals for ph adjustment table a1 4 ion pairing reactions ip included in each nutrient recovery model nrm ad anaerobic digestion prec precipitation crystallization strip stripper scrub scrubber table a1 4 no ion pairing reaction ad prec strip scrub no ion pairing reaction ad prec strip scrub ip1 al3 2oh al oh 2 x ip34 k cl kcl x x x ip2 al3 3oh al oh 3 x x ip35 k hpo4 2 khpo4 x x x ip3 al3 4oh al oh 4 x x x ip36 k no3 kno3 x x ip4 ca2 ac caac x x x ip37 k oh koh x x ip5 ca2 bu cabu x x x ip38 k po4 3 kpo4 2 x ip6 ca2 cl cacl x x x ip39 k h2po4 kh2po4 x x ip7 ca2 co3 2 caco3 x x x ip40 k so4 2 kso4 x x x ip8 ca2 dom ca dom x x ip41 mg2 ac mgac x x x ip9 ca2 hco3 cahco3 x x ip42 mg2 bu mgbu x x x ip10 ca2 hpo4 2 cahpo4 x x x ip43 mg2 cl mgcl x x x ip11 ca2 h2po4 cah2po4 x ip44 mg2 co3 2 mgco3 x x x ip12 ca2 nh3 canh3 2 x x x ip45 2mg2 co3 2 mg2co3 2 x x ip13 ca2 2nh3 ca nh3 2 2 x ip46 mg2 dom mg dom x x ip14 ca2 no3 cano3 x ip47 mg2 hco3 mghco3 x x x ip15 ca2 oh caoh x ip48 mg2 hpo4 2 mghpo4 x x x ip16 ca2 po4 3 capo4 x x x ip49 mg2 2nh3 mg nh3 2 2 x x x ip17 ca2 pro capro x x x ip50 mg2 oh mgoh x x x ip18 ca2 so4 2 caso4 x x x ip51 mg2 po4 3 mgpo4 x x x ip19 ca2 va cava x x x ip52 mg2 pro mgpro x x x ip20 fe2 cl fecl x ip53 mg2 so4 2 mgso4 x x x ip21 fe2 co3 2 feco3 x ip54 na ac naac x x x ip22 fe2 hpo4 2 fehpo4 x x ip55 na cl nacl x x x ip23 fe2 hs fehs x ip56 na co3 2 naco3 x x ip24 fe2 2hs fe hs 2 x ip57 na hco3 nahco3 x x ip25 fe2 h2po4 feh2po4 x ip58 na hpo4 2 nahpo4 x x x ip26 fe2 nh3 fenh3 2 x x x ip59 na h2po4 nah2po4 aq x x ip27 fe2 2nh3 fe nh3 2 2 x x x ip60 na no3 nano3 x x ip28 fe2 3nh3 fe nh3 3 2 x ip61 na oh naoh x x ip29 fe2 oh feoh x x x ip62 na po4 3 napo4 2 x ip30 fe2 2oh fe oh 2 x x x ip63 na so4 2 naso4 x x x ip31 fe3 3oh fe oh 3 x x ip64 nh3 hco3 nh2coo h2o x x ip32 fe2 so4 2 feso4 aq x ip65 nh4 so4 2 nh4so4 x x x x ip33 k ac kac x x x table a1 5 liquid solid solid liquid transfer reactions p included in each nutrient recovery model nrm ad anaerobic digestion prec precipitation crystallization p precipitation strip stripper scrub scrubber table a1 5 no phreeqcphase name liquid solid solid liquid transfer reaction ad prec strip scrub p1 al2o3 s al2o3 s 6h 2al3 3h2o x p2 alpo4 alpo4 al3 po4 3 x x p3 ammoniumsulfate nh4 2so4 2nh4 so4 2 x p4 anhydrite caso4 ca2 so4 2 x p5 aragonite caco3 ca2 co3 2 x x x p6 artinite mgco3 mg oh 2 3h2o 2h 2mg2 co3 2 5h2o x x p7 boehmite alooh 3h al3 2h2o x x p8 brucite mg oh 2 2h mg2 2h2o x x p9 cahpo4 s cahpo4 ca2 h po4 3 x x x p10 cahpo4 2h2o s cahpo4 2h2o ca2 h po4 3 2h2o x x x p11 ca4h po4 3 3h2o s ca4h po4 3 3h2o 4ca2 h 3po4 3 3h2o x x x p12 calcite caco3 ca2 co3 2 x x x p13 ca3 po4 2 am1 ca3 po4 2 3ca2 2po4 3 x x x p14 ca3 po4 2 am2 ca3 po4 2 3ca2 2po4 3 x x x p15 ca3 po4 2 beta ca3 po4 2 3ca2 2po4 3 x x x p16 diaspore alooh 3h al3 2h2o x x x p17 dolomite ordered camg co3 2 ca2 mg2 2co3 2 x x x p18 dolomite disordered camg co3 2 ca2 mg2 2co3 2 x x x p19 fe oh 2 am fe oh 2 2h fe2 2h2o x x p20 fes ppt fes h fe2 hs x p21 gibbsite al oh 3 3h al3 3h2o x x p22 hercynite feal2o4 8h fe2 2al3 4h2o x x x p23 huntite camg3 co3 4 3mg2 ca2 4co3 2 x p24 hydromagnesite mg5 co3 4 oh 2 4h2o 2h 5mg2 4co3 2 6h2o x p25 hydroxyapatite ca10 po4 6 oh 5 5h 10ca2 6po4 3 5h2o x x x p26 k struvite mgkpo4 6h2o mg2 k po4 3 6h2o x x x p27 mackinawite fes h fe2 hs x p28 magnesite mgco3 mg2 co3 2 x x x p29 mg oh 2 active mg oh 2 2h mg2 2h2o x x p30 mg3 po4 2 s mg3 po4 2 3mg2 2po4 3 x x x p31 newberyite mghpo4 3h2o mg2 h po4 3 3h2o x x x p32 periclase mgo 2h mg2 h2o x p33 portlandite ca oh 2 2h ca2 2h2o x p34 siderite feco3 fe2 co3 2 x x x p35 spinel mgal2o4 8h mg2 2al3 4h2o x p36 struvite mgnh4po4 6h2o mg2 nh4 po4 3 x x x p37 vaterite caco3 ca2 co3 2 x x p38 vivianite fe3 po4 2 8h2o 3fe2 2po4 3 8h2o x x x table a1 6 gas liquid liquid gas exchange reactions gl included in each nutrient recovery model nrm ad anaerobic digestion prec precipitation crystallization strip stripper scrub scrubber table a1 6 no gas liquid liquid gas exchange reaction ad prec strip scrub gl1 ch4 aq ch4 g x gl2 co2 aq co2 g x x a x x gl3 h2 aq h2 g x x x gl4 h2o aq h2o g x x a x x gl5 h2s aq h2s g x x x gl6 n2 aq n2 g x x a x x gl7 nh3 aq nh3 g x x a x x gl8 o2 aq o2 g x a x x a values between brackets represent the use of air instead of chemicals for ph adjustment appendix 2 detailed description of mass transfer scenarios for a liquid gas gas liquid transfer and b liquid solid solid liquid transfer a liquid gas gas liquid transfer if the resistance to mass transfer is on the liquid side the overall liquid mass transfer coefficient k l i can be perfectly adequate while the overall gaseous mass transfer coefficient k g i provides a good estimation if the resistance is on the gas side the relationship between the two coefficients can be represented by equation a1 chapra 2008 tchobanoglous et al 2003 a1 1 k l i h t i r t k g i in which r is the universal gas law constant 0 082 l atm mol 1 k 1 and t the temperature k it should be noted that the above mentionned overall mass transfer coefficients are actually derived from the individual mass transfer coefficients by equation a2 combined with eq a1 for k g i a2 1 k l i 1 k l i h t i r t k g i in which k l i and k g i are the individual mass transfer coefficients that depend on the conditions at the interface and the bulk of the liquid and gas phase respectively chapra 2008 tchobanoglous et al 2003 nevertheless since the concentrations at the interface are difficult to measure the overall mass transfer coefficient is generally used for practical purposes as such four potential mass transfer scenarios were considered 1 active liquid gas gas liquid transfer nrm strip nrm scrub of low to moderately soluble gases in this case the penetration theory of higbie 1935 was used to calculate the liquid mass transfer coefficient k l a t 1 it states that diffusion is a non steady state process and that the molecules of the solute are in constant random motion clusters of these molecules arrive at the interface remain there for a fixed period of time and some of them penetrate while the rest mixes back into the bulk of the phase the transfer velocity was then formulated in terms of the average contact time of a gas bubble at the interface eq a3 chapra 2008 gujer 2008 a3 k l g a k l a t 1 4 d l u π d θ g a s 6 q g a s i n d v l i q in which d is the average gas bubble diameter default 3 mm gujer 2008 u is the rise velocity of the gas bubbles default 0 3 m s 1 gujer 2008 θ g a s v g a s q g a s is the mean residence time of a gas bubble in the reactor t v g a s is the volume of all bubbles in the reactor or the total gas volume l 3 and d l is the liquid phase diffusion coefficient l 2 t 1 the latter was calculated at 298 k using the equation proposed by schwarzenbach et al 1993 eq a4 based on the component s molecular weight m w g mol 1 a4 d l l 2 t 1 2 7 10 4 m w 0 71 the obtained d l values using equation a4 showed good equivalence with d l values found in literature for wastewater systems chapra 2008 gujer 2008 tchobanoglous et al 2003 2 active liquid gas gas liquid transfer nrm strip nrm scrub of very soluble gases in this case equation a3 was again applied but now the gaseous phase diffusion coefficient d g was used arogo et al 1999 3 passive liquid gas gas liquid transfer nrm ad of low to moderately soluble gases in this case the mass transfer rate needs to be calibrated based on experimental results e g as in tourlousse and ahmad 2007 because the rise velocity of gas bubbles is usually not measurable or very difficult to measure for convenience the k l a is usually calculated from the k l a of oxygen gas o2 as a reference compound since the latter is easy to deduce from experimental data and rate constants for volatile solutes can be assumed proportional to each other chapra 2008 ikumi 2011 mackay and yeun 1983 munz and roberts 1989 musvoto et al 2000 however the use of o2 as a reference compound as selected by musvoto et al 2000 is quite odd for anaerobic digestion because normally no o2 is present in such reactors therefore in the nrm ad model h2 was used as volatile reference compound occurring in digesters similar as in pauss et al 1990 eq a5 a5 k l g a k l a t 1 k l h 2 a d l d l h 2 0 5 4 passive liquid gas gas liquid transfer nrm ad of very soluble gases in this case the mass transfer rate should be determined independently of the low to moderately soluble gases above sotemann et al 2005 if no experimental data are available the k g a value for nh3 in anaerobic digestion is usually set to a very low value ranging from 1 92 to 3 2 d 1 default in nrm ad 3 2 d 1 ikumi 2011 musvoto et al 2000 sotemann et al 2005 this is to ensure an extremely low loss from the liquid phase through stripping however as the transfer rate depends much on design operating conditions and characteristics of the waste flow to be treated it is advised to determine the k g n h 3 a under actual environmental conditions as e g in arogo et al 1999 this is especially important for the stripper and scrubber unit processes b liquid solid solid liquid transfer 1 supersaturation occurs s 1 s i 0 and seed material is available in this case the crystallization of sparingly soluble salts in wrrfs is mainly controlled by surface spiral growth this means that the integration of the cations into crystal lattice positions at kinks in the surface is the rate determining molecular mechanism galbraith et al 2014 hauduc et al 2015 koutsoukos et al 1980 musvoto et al 2000 nielsen 1984 the kinetic precipitation coefficient eq a6 was then assumed to be proportional to the available seed material cfr koutsoukos et al 1980 parkhurst and appelo 2013 a6 k t m l 3 t 1 k g t a s e e d m s e e d v l i q in which k g t is the temperature dependent growth rate coefficient m l 2 t 1 a s e e d is the specific area of surface per gram of seed material before the seed crystals start to grow in the crystallizing solution l 2 m 1 default 600 m2 g 1 parkhurst and appelo 2013 and m s e e d is the time dependent mass of seed material in the reactor m default initial mass 0 0005 kg parkhurst and appelo 2013 the latter is calculated at every time step by means of mass balances on the seed material for each precipitate section 2 2 4 taking in account the mass of newly formed precipitates and redissolution the default reaction order for surface controlled growth n g was set at 2 which generally provides a good approximation to represent precipitation in wrrfs bouropoulos and koutsoukos 2000 mehta and batstone 2013 musvoto et al 2000 nielsen 1984 2 supersaturation occurs s 1 s i 0 but no seed material is available and or the crystal size is not large enough to have any influence on the process i e the induction time is not exceeded in this case primary nucleation occurs which was often not accounted for in previous studies harrison et al 2011 nielsen 1984 schneider et al 2013 though very relevant bhuiyan et al 2008 the value of k t and n in equation 3 are then switched to the nucleation rate k b t default 106 nuclei l 1 t 1 mehta and batstone 2013 and the nucleation reaction order n b the latter is usually higher for nucleation than for growth 3 4 default 3 tavare 1995 the induction time is inversely proportional to the logarithm of s and should be estimated experimentally for each precipitate bhuiyan et al 2008 mehta and batstone 2013 3 the solution is undersaturated s 1 s i 0 and precipitate is present in the system in this case the nrms allow for precipitate redissolution until equilibrium is reached using the reverse reaction of equation 3 morse and arvidson 2002 however the kinetic dissolution rate k d t and the reaction order for dissolution n d may be different than those for precipitation significantly more work is needed to better understand the dissolution behaviour of the various precipitates in complex waste water matrices greenberg and tomson 1992 morse and arvidson 2002 4 equilibrium occurs s 1 s i 0 in this case the liquid solid solid liquid transfer rate is set at 0 finally for the nrm prec a generic mechanism for agglomeration and floc break up through the effect of mixing was included using the spherical particle model for macroscale flocculation crittenden et al 2012 the net rate of floc appearance eq a7 was written as a7 ρ a g g l l 3 t 1 k a g n p a r t v l i q v f e r t i l i z e r v l i q k b g δ in which k a is the aggregation constant 4 α π for laminar flow where α is the collision efficiency factor default for turbulent flow 5 10 4 k b t δ 1 l 3 is the floc break up constant 0 for laminar flow default for turbulent flow 10 7 crittenden et al 2012 g is the root mean square velocity gradient t 1 which depends on the power input camp and stein 1943 and δ is the turbulence constant under turbulent conditions the values of k a and k b should be determined empirically in laboratory or pilot scale tests argaman 1971 parker et al 1972 note that when the g value is set to 0 it is assumed that no agglomeration occurs appendix 3 biochemical processes and gujer matrix included in the nutrient recovery model for the anaerobic digester nrm ad table a3 1 biochemical bc processes included in the nutrient recovery model for anaerobic digestion nrm ad and extensions made as compared to the anaerobic digestion model no 1 adm1 ac acetate bu butyrate ebpr enhanced biological phosphorus p removal lcfa long chain fatty acids pao p accumulating organism pha poly hydroxy alkanoate pp poly phosphate pro propionate srb sulfate reducing bacteria va valerate table a3 1 physicochemical processes biochemical processes adm1 adm1 nrm ad extension 2 nrm ad extension 3 nrm ad potential extension 4 4 acid base systems nh4 nh3 co2 hco3 vfa vfa h2o oh h 4 gas liquid exchange reactions co2 ch4 h2 h2o disintegration hydrolysis acidogenesis acetogenesis methanogenesis batstone et al 2002 sulfurgenesis knobel and lewis 2002 lizarralde et al 2010 release uptake of p k s from bacterial cells and other biochemical components ebpr sludge ikumi 2011 nrm ad extension 1 acid base systems table a1 2 redox reactions table a1 3 ion pairing reactions table a1 4 solid liquid transfer table a1 5 gas liquid exchange table a1 6 bc1 disintegration of complex particulatesbc2 hydrolysis of carbohydratesbc3 hydrolysis of proteinsbc4 hydrolysis of lipidsbc5 uptake of monosaccharidesbc6 uptake of aminoacidsbc7 uptake of lcfabc8 uptake of vabc9 uptake of bubc10 uptake of probc11 uptake of acbc12 uptake of h2 bc13 decay of monosaccharide degradersbc14 decay of amino acid degradersbc15 decay of lcfa degradersbc16 decay of va and bu degradersbc17 decay of pro degradersbc18 decay of ac degradersbc19 decay of h degraders bc20 sulfate reduction on acbc21 sulfate reduction on bubc22 sulfate reduction on h2 bc23 sulfate reduction on probc24 decay of srbs using acbc25 decay of srbs using bubc26 decay of srbs using h2 bc27 decay of srbs using pro inclusion in stoichiometric gujer matrix table a2 2 a2 4 bc28 release of pp with uptake of ac by paosbc29 decay of paosbc30 hydrolysis of pp release of k ca mgbc31 hydrolysis of pha table a3 2 stoichiometry of the biochemical bc gujer matrix incorporated in the nutrient recovery model for the anaerobic digester nrm ad for process description see table a3 1 for nomenclature see table a3 4 for state variable description see appendix 5 component process s aakg cod m 3 s co2 kmol m 3 s hackg cod m 3 s hbukg cod m 3 bc1 c xc f ch xc c ch f si xc c si f pr xc c pr f xi xc c xi f li xc c li bc2 c ch c su bc3 1 c aa c pr bc4 f fa li 1 c su f fa li c fa c li bc5 c su 1 y su f ac su c ac 1 y su f pro su c pro 1 y su f bu su c bu y su c biom 1 y su f ac su 1 y su f bu su bc6 1 c aa 1 y aa f ac aa c ac 1 y aa f bu aa c bu 1 y aa f pro aa c pro 1 y aa f va aa c va y aa c biom 1 y aa f ac aa 1 y aa f bu aa bc7 c fa 1 y fa 0 7 c ac y fa c biom 1 y fa 0 7 bc8 c va 1 y c4 0 54 c pro y c4 c biom 1 y c4 0 31 c ac 1 y c4 0 31 bc9 c bu 1 y c4 0 8 c ac y c4 c biom 1 y c4 0 8 1 bc10 c pro 1 y pro 0 57 c ac y pro c biom 1 y pro 0 57 bc11 c ac y ac c biom 1 y ac c ch4 1 bc12 y h2 c biom 1 y h2 c ch4 bc13 c biom c xc bc14 c biom c xc bc15 c biom c xc bc16 c biom c xc bc17 c biom c xc bc18 c biom c xc bc19 c biom c xc bc20 f co2 ac 1 bc21 f co2 bu 1 bc22 f co2 h bc23 f co2 pro bc24 c biom c xc bc25 c biom c xc bc26 c biom c xc bc27 c biom c xc table a3 2 continuation stoichiometry of the biochemical bc gujer matrix incorporated in the nutrient recovery model for the anaerobic digester nrm ad for process description see table a3 1 for nomenclature see table a3 4 for state variable description see appendix 5 component process s hpo4 2 kmol m 3 s hvakg cod m 3 s ch4 kg cod m 3 s fakg cod m 3 s h2 kg cod m 3 s h2skmol m 3 s inertkg cod m 3 s k kmol m 3 bc1 p xc f xi xc p xi f si xc p si f li xc p li f si xc bc2 bc3 bc4 p li f fa li bc5 y su p biom 1 y su f h2 su y su k biom bc6 y aa p biom 1 y aa f va aa 1 y aa f h2 aa y aa k biom bc7 p fa y fa p biom 1 1 y fa 0 3 y fa k biom bc8 y c4 p biom 1 1 y c4 0 15 y c4 k biom bc9 y c4 p biom 1 y c4 0 2 y c4 k biom bc10 y pro p biom 1 y pro 0 43 y pro k biom bc11 y ac p biom 1 y ac y ac k biom bc12 y h2 p biom 1 y h2 1 y h2 k biom bc13 p biom p xc k biom k xc bc14 p biom p xc k biom k xc bc15 p biom p xc k biom k xc bc16 p biom p xc k biom k xc bc17 p biom p xc k biom k xc bc18 p biom p xc k biom k xc bc19 p biom p xc k biom k xc bc20 f s ac bc21 f s bu bc22 1 f s h bc23 f s pro bc24 p biom p xc k biom k xc bc25 p biom p xc k biom k xc bc26 p biom p xc k biom k xc bc27 p biom p xc k biom k xc table a3 2 continuation stoichiometry of the biochemical bc gujer matrix incorporated in the nutrient recovery model for the anaerobic digester nrm ad for process description see table a3 1 for nomenclature see table a3 4 for state variable description see appendix 5 component process s nh4 kmol m 3 s prokg cod m 3 s so4 2 kmol m 3 s sukg cod m 3 x aakg cod m 3 x ackg cod m 3 x ckg cod m 3 x c4kg cod m 3 x chkg cod m 3 x fakg cod m 3 bc1 n xc f xi xc n xi f si xc n si f pr xc n aa 1 f ch xc bc2 1 1 bc3 bc4 1 f fa li bc5 n biom y su 1 y su f pro su y su s biom 1 bc6 n aa y aa n biom 1 y aa f pro aa y aa s biom y aa bc7 n biom y fa y c4 s biom y fa bc8 n biom y c4 1 y c4 0 54 y c4 s biom y c4 bc9 n biom y c4 y ac s biom y c4 bc10 n biom y pro 1 y pro s biom bc11 n biom y ac y ac s biom y ac bc12 n biom y h2 y h2 s biom bc13 n biom n xc s biom s xc 1 bc14 n biom n xc s biom s xc 1 1 bc15 n biom n xc s biom s xc 1 1 bc16 n biom n xc s biom s xc 1 1 bc17 n biom n xc s biom s xc 1 bc18 n biom n xc s biom s xc 1 1 bc19 n biom n xc s biom s xc 1 bc20 f s ac bc21 f s bu bc22 f s h bc23 1 f s pro bc24 n biom n xc s biom s xc 1 bc25 n biom n xc s biom s xc 1 bc26 n biom n xc s biom s xc 1 bc27 n biom n xc s biom s xc 1 table a3 2 continuation stoichiometry of the biochemical bc gujer matrix incorporated in the nutrient recovery model for the anaerobic digester nrm ad for process description see table a3 1 for nomenclature see table a3 4 for state variable description see appendix 5 table a3 2 component process x h2kg cod m 3 x prkg cod m 3 x prokg cod m 3 x sukg cod m 3 x inertkg cod m 3 x likg cod m 3 x srb ackg cod m 3 x srb bukg cod m 3 x srb hkg cod m 3 x srb prokg cod m 3 bc1 f pr xc f xi xc f li xc bc2 bc3 1 bc4 1 bc5 y su bc6 bc7 bc8 bc9 bc10 y pro bc11 bc12 y h2 bc13 1 bc14 bc15 bc16 bc17 1 bc18 bc19 1 bc20 y srb ac bc21 y srb bu bc22 y srb h bc23 y srb pro bc24 1 bc25 1 bc26 1 bc27 1 table a3 3 biochemical bc kinetic equations of the gujer matrix incorporated in the nutrient recovery model for the anaerobic digester nrm ad for process description see table a3 1 for nomenclature see table a3 4 for state variable description see appendix 5 table a3 3 process kinetic equation kg cod m 3 d 1 bc1 k d i s x c bc2 k h y d x c h x c h bc3 k h y d x p r x p r bc4 k h y d x l i x l i bc5 k m s u x s u s s u k s s u s s u i p h b a c i n h l i m i t bc6 k m a a x a a s a a k s a a s a a i p h b a c i n h l i m i t bc7 k m f a x f a s f a k s f a s f a i p h b a c i n h l i m i t i h 2 f a bc8 k m c 4 x c 4 s h v a k s c 4 s h v a s h v a s h v a s h b u i p h b a c i n h l i m i t i h 2 c 4 bc9 k m c 4 x c 4 s h b u k s c 4 s h b u s h b u s h b u s h v a i p h b a c i n h l i m i t i h 2 c 4 bc10 k m p r o x p r o s h p r o k s p r o s h p r o i p h b a c i n h l i m i t i h 2 p r o bc11 k m a c x a c s h a c k s a c s h a c i p h a c i n h 3 a c i n h l i m i t bc12 k m h 2 x h 2 s h 2 k s h 2 s h 2 i p h h 2 i n h l i m i t bc13 k d e c x s u x s u bc14 k d e c x a a x a a bc15 k d e c x f a x f a bc16 k d e c x c 4 x c 4 bc17 k d e c x p r o x p r o bc18 k d e c x a c x a c bc19 k d e c x h 2 x h 2 bc20 k m s r b a c x s r b a c s h a c k s s r b a c s h a c s s o 4 k s s o 4 a c s s o 4 i p h s r b i h 2 s a c bc21 k m s r b b u x s r b b u s h b u k s s r b b u s h b u s s o 4 k s s o 4 b u s s o 4 i p h s r b i h 2 s b u bc22 k m s r b h 2 x s r b h 2 s h 2 k s s r b h 2 s h 2 s s o 4 k s s o 4 h 2 s s o 4 i p h s r b i h 2 s h 2 bc23 k m s r b p r o x s r b p r o s h p r o k s s r b p r o s h p r o s s o 4 k s s o 4 p r o s s o 4 i p h s r b i h 2 s p r o bc24 k d e c x s r b a c x s r b a c bc25 k d e c x s r b b u x s r b b u bc26 k d e c x s r b h 2 x s r b h 2 bc27 k d e c x p r o x p r o table a3 4 nomenclature for tables a3 2 and a3 3 table a3 4 symbol description unit c i carbon content of component i kmol c kg 1 cod f product substrate yield catabolism only of product on substrate kg cod kg 1 cod i h 2 s u b s t r a t e hydrogen inhibition for substrate degradation i h 2 s s u b s t r a t e hydrogen sulfide inhibition for substrate degradation i n h l i m i t inhibition of biomass growth due to lack of inorganic nitrogen i p h b a c ph inhibition of acetogens and acidogens i p h i ph inhibition of component i k d e c i first order decay rate for biomass death of component i d 1 k d i s i complex particulate first order disintegration rate of component i d 1 k h y d i first order hydrolysis rate of component i d 1 k i potassium content of component i kmol k kg 1 cod k m i specific monod maximum uptake rate of component i d 1 k s i monod half saturation constant of component i kg cod m 3 n i nitrogen content of component i kmol n kg 1 cod p i phosphorus content of component i kmol p kg 1 cod s i sulfur content of component i kmol s kg 1 cod y substrate yield of biomass on substrate kg cod x kg 1 cod s appendix 4 reactor design and the default specifications and features for each unit process table a4 1 reactor design default specifications and features for each unit in the nutrient recovery model nrm library ad anaerobic digestion ams ammonium sulfate chem chemical dosing cstr continuously stirred tank reactor heat heater tss total suspended solids p precipitates prec precipitation crystallization scrub scrubber settle settler store storage tank strip stripper wrrf water resource recovery facility x biological particulate solids table a4 1 unit reactor design default specifications and features nrm ad cstr based on gujer 2008 constant liquid volume sealed gas phase at atmospheric pressure gas removed to downstream treatment process nrm prec cstr as generally used for coagulation flocculation units crittenden et al 2012 variable volume as function of retained precipitant volume precipitate flow rate q prec extracts fraction of the precipitates continuously or at specific times when selected specifications are reached e g target particle diameter purity etc allows to study the effect of mixing power and reactor seeding on e g the mean particle aggregate diameter optional use of gas flow instead of chemicals for ph increase in the reactor potential extension inclusion of particle differential settling velocity crittenden et al 2012 nrm strip stirred tank for active liquid gas exchange based on gujer 2008 continuous in and outgoing liquid and gas flows newly formed gas bubble enters the reactor at an initial gas phase concentration model parameters averaged over all bubbles heterogenous gas transfer throughout the reactor height user selectable number of liquid layers to represent spatially dependent liquid transfer a nrm scrub stirred tank for active gas liquid exchange gujer 2008 similar specifications as nrm strip but i default use of sulfuric acid solution at ph 1 3 for nh3 absorption ii ams recycle flow q rec with extraction as fertilizer flow when user selected ams specifications usually 25 40 ams concentration are reached cfr semi batch process nrm store tank with gas recovery for digestate storing continued non controlled anaerobic digestion and biogas recovery continuously emptied to a user specified minimum level default 15 agridigestore ludlow uk complete digestion energy recovery digestate nutrient availability nrm settle point settler simplified design based on tss removal efficiency and tss settleability hendricks 2010 default 0 5 non settleable x and 10 non settleable p potential extension inclusion of particle differential settling velocity crittenden et al 2012 no longer simplified design nrm chem point mixer closed tank to avoid nh3 emissions through ph increase allows addition of the most important amendments in wrrfs i mgcl2 mg oh 2 and ca oh 2 prior to p precipitation ii naoh and ca oh 2 prior to stripping goal ph caco3 scaling usually followed by nrm prec to allow for species precipitation and flocculation nrm heat point heater colder fluid gaining heat from a hot gas steam flow or a hot liquid flow generic equation based on the specific heat of the fluid the surface area of the heat exchanger and the overall heat transfer coefficient aic 2014 application prior to nrm ad and nrm strip a some literature studies show that hydraulic levels and reactor design have no effect on the nh3 recovery efficiency as equilibrium conditions are reached in a very small time interval arogo et al 1999 collivignarelli et al 1998 gujer 2008 powers et al 1987 however other studies believe that liquid transfer should be modelled heterogeneously i e spatially dependent yu et al 2011 because of this discussion an option was included in the nrm strip and nrm scrub to calculate nh3 removal and absorption for a user selectable number of liquid layers the gujer 2008 model is based on homogeneous liquid transfer appendix 5 state vectors used in the nutrient recovery model nrm library table a5 1 generic state vectors used in the nutrient recovery model nrm library component symbols and descriptions table a5 1 state vector component symbol description component symbol description components s1 pc s acetate soluble acetate s mg soluble magnesium s al soluble aluminium s na soluble sodium s butyrate soluble butyrate s n min3 soluble ammonia n iii s ca soluble calcium s n 0 soluble nitrogen n 0 s c 4 soluble carbonate c iv s n 5 soluble nitrate n v s cl soluble chloride s o 0 soluble oxygen o 0 s c min4 soluble methane c iv s p soluble phosphorus s dom soluble dissolved organic matter s propionate soluble propionate s fe soluble iron s s min2 soluble sulfide s ii s h 0 soluble hydrogen h 0 s s 6 soluble sulfate s vi s k soluble potassium s valerate soluble valerate components s1 bio s aa soluble aminoacids s inert soluble inerts s fa soluble long chain fatty acids s su soluble sugars components s2 s c 4 soluble carbonate c iv s n 5 soluble nitrate n v s c min4 soluble methane c iv s o 0 soluble oxygen o 0 s h 0 soluble hydrogen h 0 s s min2 soluble sulfide s ii s n min3 soluble ammonia n iii s s 6 soluble sulfate s vi s n 0 soluble nitrogen n 0 components g g ch4 methane gas g h2s hydrogen sulfide gas g co2 carbon dioxide gas g nh3 ammonia gas g h2 hydrogen gas g n2 nitrogen gas g h2o water vapour g o2 oxygen gas components p p al precipitated aluminium p mg precipitated magnesium p ca precipitated calcium p n min3 precipitated ammonia n iii p c 4 precipitated carbonate c iv p p precipitated phosphorus p fe precipitated iron p s min2 precipitated sulfide s ii p k precipitated potassium p s 6 precipitated sulfate s vi components x x aa aminoacid degraders x li lipids x ac acetate degraders x pr proteins x c composites x pro propionate degraders x ch carbohydrates x su sugar degraders x c4 valerate and butyrate degraders x srb ac sulfate reducing bacteria using acetate x fa long chain fatty acid degraders x srb bu sulfate reducing bacteria using butyrate x h2 hydrogen reducing bacteria x srb h sulfate reducing bacteria using hydrogen x inert particulate inerts x srb pro sulfate reducing bacteria using propionate appendix 6 data requirements and data used for nutrient recovery model nrm validation table a6 1 types of data required and datasets available for each key unit in the nutrient recovery model nrm library ad anaerobic digestion prec precipitation crystallization strip stripper scrub scrubber n a not applicable table a6 1 nrm ad nrm prec nrm strip nrm scrub input waste characteristics biological components sludge astals et al 2013 ikumi 2011 tchobanoglous et al 2003 manure cesur and albertson 2005 martin 2003 mattocks et al 2002 co digestion zaher et al 2009 own data n a n a n a physicochemical components ali and schneider 2008 bhuiyan et al 2007 harrison et al 2011 schneider et al 2013 own data bhuiyan et al 2007 campos et al 2013 collivignarelli et al 1998 powers et al 1987 yu et al 2011 own data campos et al 2013 collivignarelli et al 1998 manuzon et al 2007 powers et al 1987 yu et al 2011 own data physicochemical stoichiometric parameters acid base ion pairing equilibrium constants k a b k i p nist 2001 phreeqc nist 2001 phreeqc nist 2001 phreeqc nist 2001 phreeqc water dissociation constant k w nist 2001 phreeqc nist 2001 phreeqc nist 2001 phreeqc nist 2001 phreeqc solubility products k s nist 2001 phreeqc nist 2001 phreeqc nist 2001 phreeqc nist 2001 phreeqc henry s law coefficients h sander 1999 sander 1999 sander 1999 sander 1999 physicochemical kinetic parameters precipitation dissolution transfer coefficients and reaction order k n bénézeth et al 2008 chauhan et al 2011 ikumi 2011 inskeep and silvertooth 1988 johnson 1990 musvoto et al 1997 musvoto et al 2000 nielsen 1984 nist 2001 to mention a few ali and schneider 2008 bhuiyan et al 2008 galbraith et al 2014 harrison et al 2011 nist 2001 schneider et al 2013 to mention a few bénézeth et al 2008 chauhan et al 2011 ikumi 2011 inskeep and silvertooth 1988 johnson 1990 musvoto et al 1997 musvoto et al 2000 nielsen 1984 nist 2001 to mention a few belcu and turtoi 1996 nist 2001 liquid gas transfer coefficients k l g a batstone et al 2002 chapra 2008 lizarralde et al 2013 musvoto et al 1997 munz and roberts 1989 if ph increase with aeration batstone et al 2002 chapra 2008 lizarralde et al 2013 musvoto et al 1997 munz and roberts 1989 collivignarelli et al 1998 musvoto et al 1997 musvoto et al 2000 powers et al 1987 yu et al 2011 collivignarelli et al 1998 manuzon et al 2007 yu et al 2011 biological stoichiometric parameters biomass composition batstone et al 2002 ikumi 2011 tchobanoglous et al 2003 zaher et al 2009 n a n a n a pre set fractions f product substrate batstone et al 2002 ikumi 2011 knobel and lewis 2002 lizarralde et al 2010 n a n a n a biomass substrate yield y substrate batstone et al 2002 ikumi 2011 knobel and lewis 2002 lizarralde et al 2010 n a n a n a biological kinetic parameters uptake rates k m disintegration rates k d i s decay rates k d e c etc batstone et al 2002 ikumi 2011 knobel and lewis 2002 lizarralde et al 2010 n a n a n a input output data operational factors temperature ph etc calibration validation data sludge astals et al 2013 manure cesur and albertson 2005 martin 2003 mattocks et al 2002 own data data from industry ali and schneider 2008 bhuiyan et al 2007 2008 harrison et al 2011 schneider et al 2013 own data data from industry campos et al 2013 collivignarelli et al 1998 powers et al 1987 yu et al 2011 own data data from industry campos et al 2013 collivignarelli et al 1998 koptev 1966 manuzon et al 2007 melse and ogink 2005 powers et al 1987 yu et al 2011 own data data from industry table a6 2 parameter categories names default values and units for the nrm ad table a6 2 category name default value unit dimension volume vol gas 1 m3 vol liq 2 8 m3 kinetics liquid gas diffusion coefficient at t diff d ch4 g 3 771e 05 m2 d d co2 g 0 000156 m2 d d h2s g 2 2043e 05 m2 d d h2 g 0 000165 m2 d d n2 g 0 0001536 m2 d d nh3 g 0 000169 m2 d d o2 0 0001608 m2 d inhibitory concentration ki h2 c4 1e 05 kg m3 ki h2 fa 5e 06 kg m3 ki h2 pro 3 5e 06 kg m3 ki h2s ac 0 00475 kg m3 ki h2s bu 0 0156 kg m3 ki h2s h2 0 00465 kg m3 ki h2s pro 0 00889 kg m3 ki nh3 ac 0 0252 kmol m3 saturation constant ks in 0 0001 kg m3 ks aa 0 3 kg m3 ks ac 0 15 kg m3 ks c4 0 2 kg m3 ks fa 0 4 kg m3 ks h2 7e 06 kg m3 ks pro 0 1 kg m3 ks so4 ac 0 0002 kg m3 ks so4 bu 0 00017 kg m3 ks so4 h2 9 3e 06 kg m3 ks so4 pro 7 7e 05 kg m3 ks srb ac 0 024 kg m3 ks srb bu 0 28672 kg m3 ks srb h2 2 4e 05 kg m3 ks srb pro 0 04944 kg m3 ks su 0 5 kg m3 temperature of diffusion coefficient t diff ch4 g 298 k t diff co2 g 293 k t diff h2s g 298 k t diff h2 g 298 k t diff n2 g 293 k t diff nh3 g 298 k liquid mass transfer rate kla o2 200 1 d liquid solid transfer rate k al2o3 0 0001 mol m2 d k alpo4 0 0001 mol m2 d k anhydrite 0 0001 mol m2 d k aragonite 0 61166516 mol m2 d k boehmite 0 00028 mol m2 d k ca4h po4 3 3h2o 0 1 mol m2 d k cahpo4 2h2o 14 6435 mol m2 d k cahpo4bis 0 1 mol m2 d k calcite 1080 mol m2 d k diaspore 0 1 mol m2 d k dolomite 11 22 mol m2 d k fes ppt 0 0001 mol m2 d k gibbsite 0 0001192652 mol m2 d k hercynite 0 1 mol m2 d k hydroxyapatite 986 64761 mol m2 d k kstruvite 4 64e 06 mol m2 d k mackinawite 0 0001 mol m2 d k magnesite 0 000988416 mol m2 d k mg3 po4 2 0 1 mol m2 d k mghpo4 3h2o 4 78021e 07 mol m2 d k siderite 0 00209952 mol m2 d k struvite 0 002037407 mol m2 d k vivianite 1 66165e 06 mol m2 d decay rate kdec xaa 0 02 1 d kdec xac 0 02 1 d kdec xc4 0 02 1 d kdec xfa 0 02 1 d kdec xh2 0 02 1 d kdec xpro 0 02 1 d kdec xsrbac 0 02 1 d kdec xsrbbu 0 02 1 d kdec xsrbh 0 02 1 d kdec xsrbpro 0 02 1 d kdec xsu 0 02 1 d dissociation rate kdis 0 5 1 d hydrolysis rate khyd ch 10 1 d khyd li 10 1 d khyd pr 10 1 d maximum uptake rate km aa 50 1 d km ac 9 1 d km c4 20 1 d km fa 6 1 d km h2 35 1 d km pro 9 1 d km srb ac 12 55 1 d km srb bu 14 51 1 d km srb h2 20 1 d km srb pro 20 1 d km su 30 1 d reaction order precipitation n al2o3 2 n alpo4 2 n anhydrite 2 n aragonite 2 n boehmite 2 n ca4h po4 3 3h2o 2 n cahpo4 2h2o 2 n cahpo4bis 2 n calcite 2 n diaspore 2 n dolomite 2 n fes ppt 2 n gibbsite 2 n hercynite 2 n hydroxyapatite 2 n kstruvite 2 n mackinawite 2 n magnesite 2 n mg3 po4 2 2 n mghpo4 3h2o 2 n siderite 2 n struvite 2 n vivianite 2 ph inhibitory levels ph ac ll 6 3 ph ac ul 9 ph bac ll 4 ph bac ul 5 5 ph h2 ll 5 3 ph h2 ul 9 ph srb ll 5 5 ph srb ul 8 alfa ll 6 alfa ul 6 arrhenius coefficient for temperature dependency theta ch4 g 1 024 theta co2 g 1 024 theta h2s g 1 024 theta h2 g 1 024 theta n2 g 1 024 theta nh3 g 1 a operation gas flow constant k p 50000 mass of seed material m seed al2o3 0 0005 kg m seed alpo4 0 0005 kg m seed anhydrite 0 0005 kg m seed aragonite 0 0005 kg m seed boehmite 0 0005 kg m seed ca4h po4 3 3h2o 0 0005 kg m seed cahpo4 2h2o 0 0005 kg m seed cahpo4bis 0 0005 kg m seed calcite 0 0005 kg m seed diaspore 0 0005 kg m seed dolomite 0 0005 kg m seed fes ppt 0 0005 kg m seed gibbsite 0 0005 kg m seed hercynite 0 0005 kg m seed hydroxyapatite 0 0005 kg m seed kstruvite 0 0005 kg m seed mackinawite 0 0005 kg m seed magnesite 0 0005 kg m seed mg3 po4 2 0 0005 kg m seed mghpo4 3h2o 0 0005 kg m seed siderite 0 0005 kg m seed struvite 0 0005 kg m seed vivianite 0 0005 kg temperature t op 302 15 k surface area of seed material a seed 600 m2 g fraction of particulate matter that leaves the reactor f x out 0 002 atmospheric pressure p atm 1 atm stoichiometry cod content cod acetatemin 64 g mol cod butyratemin 160 g mol cod ch4 64 g mol cod co2 1 g mol cod co3min2 1 g mol cod h2s 1 g mol cod h2 16 g mol cod kplus 1 g mol cod nh4plus 1 g mol cod po4min3 1 g mol cod propionatemin 112 g mol cod so4min2 1 g mol cod valeratemin 208 g mol carbon content c si 0 03 mol g c xi 0 03 mol g c xc 0 02786 mol g c aa 0 03 mol g c ac 0 0313 mol g c biom 0 0313 mol g c bu 0 025 mol g c ch 0 0313 mol g c ch4 0 0156 mol g c fa 0 0217 mol g c li 0 022 mol g c pr 0 03 mol g c pro 0 0268 mol g c su 0 0313 mol g c va 0 024 mol g reaction enthalphie of gas liquid transfer h gas ch4 g 1700 h gas co2 g 236534 h gas h2s g 3000 h gas h2 g 500 h gas n2 g 1300 h gas nh3 g 4200 potassium content k xc 0 0001278828 mol g k biom 0 0002557656 mol g nitrogen content n si 0 0042857143 mol g n xi 0 0042857143 mol g n xc 0 0026857143 mol g n aa 0 007 mol g n biom 0 0057142857 mol g phosphorus content p xc 0 00032285392 mol g p biom 0 00064570783 mol g sulfur content s xc 0 0001278828 mol g s biom 0 0002557656 mol g biomass yield y aa 0 08 y ac 0 05 y c4 0 06 y fa 0 06 y h2 0 06 y pro 0 04 y srb ac 0 05437 y srb bu 0 03809 y srb h 0 17355 y srb pro 0 04081 y su 0 1 enthalpy of heat for precipitation delta h al2o3 258 5901 kj mol delta h alpo4 458 6 kj mol delta h anhydrite 7 2 kj mol delta h aragonite 8 kj mol delta h boehmite 117 6959 kj mol delta h ca4h po4 3 3h2o 105 kj mol delta h cahpo4 2h2o 23 kj mol delta h cahpo4bis 31 kj mol delta h calcite 8 kj mol delta h diaspore 103 0519 kj mol delta h dolomite 31 9 kj mol delta h fes ppt 11 kj mol delta h gibbsite 105 kj mol delta h hercynite 313 9199 kj mol delta h hydroxyapatite 0 kj mol delta h kstruvite 83 21 kj mol delta h mackinawite 0 kj mol delta h magnesite 20 kj mol delta h mg3 po4 2 0 kj mol delta h mghpo4 3h2o 0 kj mol delta h siderite 7 3 kj mol delta h struvite 0 kj mol delta h vivianite 5 06 kj mol pre set fraction and yield f si xc 0 1 f xi xc 0 2 f ac aa 0 4 f ac su 0 41 f bu aa 0 26 f bu su 0 13 f ch xc 0 1 f co2 ac 0 02955 mol gcod f co2 bu 0 mol gcod f co2 h 0 00542 mol gcod f co2 pro 0 0085 mol gcod f fa li 0 95 f h2 aa 0 06 f h2 su 0 19 f li xc 0 3 f pr xc 0 52 f pro aa 0 05 f pro su 0 27 f s ac 0 mol gcod f s bu 0 00542 mol gcod f s h 0 mol gcod f s pro 0 mol gcod f va aa 0 23 henry coefficient at 298 15 k kh ch4 g 0 0014 mol l atm kh co2 g 0 035 mol l atm kh h2s g 0 1 mol l atm kh h2 g 0 00078 mol l atm kh n2 g 0 00065 mol l atm kh nh3 g 61 mol l atm a passive liquid gas transfer kla 3 2 table a6 3 parameter categories names default values and units for the nrm prec table a6 3 category name default value unit dimension volume vol liq 1000 m3 fertilizer extraction rate q prec target 10 m3 d kinetics liquid solid transfer rate k alpo4 0 0001 mol m2 d k aragonite 6 1166516 mol m2 d k artinite 50 mol m2 d k boehmite 0 00028 mol m2 d k brucite 0 1 mol m2 d k ca3 po4 2 am1 50 mol m2 d k ca3 po4 2 am2 50 mol m2 d k ca3 po4 2 beta 50 mol m2 d k ca4h po4 3 3h2o 0 1 mol m2 d k cahpo4 2h2o 14 6435 mol m2 d k cahpo4bis 0 1 mol m2 d k calcite 1080 mol m2 d k diaspore 0 1 mol m2 d k dolomite 11 22 mol m2 d k dolomite dis 0 1 mol m2 d k fe oh 2 s 0 1 mol m2 d k gibbsite 0 0001192652 mol m2 d k hercynite 0 1 mol m2 d k hydroxyapatite 986 64761 mol m2 d k kstruvite 4 64e 06 mol m2 d k magnesite 0 000988416 mol m2 d k mg3 po4 2 0 1 mol m2 d k mghpo4 3h2o 4 78021e 07 mol m2 d k mg oh 2 act 0 1 mol m2 d k siderite 0 00209952 mol m2 d k struvite 0 002037407 mol m2 d k vaterite 0 1 mol m2 d k vivianite 1 66165e 06 mol m2 d operation target minimum diameter of particels d fertilizer target 0 001 m mass of seed material m seed alpo4 0 0005 kg m seed aragonite 0 0005 kg m seed artinite 0 0005 kg m seed boehmite 0 0005 kg m seed brucite 0 0005 kg m seed ca3 po4 2 am1 0 0005 kg m seed ca3 po4 2 am2 0 0005 kg m seed ca3 po4 2 beta 0 0005 kg m seed ca4h po4 3 3h2o 0 0005 kg m seed cahpo4 2h2o 0 0005 kg m seed cahpo4bis 0 0005 kg m seed calcite 0 0005 kg m seed diaspore 0 0005 kg m seed dolomite 0 0005 kg m seed dolomite dis 0 0005 kg m seed fe oh 2 s 0 0005 kg m seed gibbsite 0 0005 kg m seed hercynite 0 0005 kg m seed hydroxyapatite 0 0005 kg m seed kstruvite 0 0005 kg m seed magnesite 0 0005 kg m seed mg3 po4 2 0 0005 kg m seed mghpo4 3h2o 0 0005 kg m seed mg oh 2 act 0 0005 kg m seed siderite 0 0005 kg m seed struvite 0 0005 kg m seed vaterite 0 0005 kg m seed vivianite 0 0005 kg residence time res time liq 10 d temperature t op 0 k surface area of seed material a seed 600 m2 g fraction of precipitates removed from the reactor per extraction f prec 1 ph ph op 10 stoichiometry enthalpy of heat for precipitation delta h alpo4 458 6 kj mol delta h aragonite 8 kj mol delta h artinite 120 2565 kj mol delta h boehmite 117 6959 kj mol delta h brucite 114 kj mol delta h ca3 po4 2 am1 94 kj mol delta h ca3 po4 2 am2 87 kj mol delta h ca3 po4 2 beta 54 kj mol delta h ca4h po4 3 3h2o 105 kj mol delta h cahpo4 2h2o 23 kj mol delta h cahpo4bis 31 kj mol delta h calcite 8 kj mol delta h diaspore 103 0519 kj mol delta h dolomite 31 9 kj mol delta h dolomite dis 46 4 kj mol delta h fe oh 2 s 91 62 kj mol delta h gibbsite 105 kj mol delta h hercynite 313 9199 kj mol delta h hydroxyapatite 0 kj mol delta h kstruvite 83 21 kj mol delta h magnesite 20 kj mol delta h mg3 po4 2 0 kj mol delta h mghpo4 3h2o 0 kj mol delta h mg oh 2 act 0 kj mol delta h siderite 7 3 kj mol delta h struvite 0 kj mol delta h vaterite 8 kj mol delta h vivianite 5 06 kj mol table a6 4 parameter categories names default values and units for the nrm strip table a6 4 category name default value unit dimension height h reactor 11 5 m safety factor on air requirements sf air 1 5 safety factor on reactor height sf height 1 5 volume v liq 81 3 m3 number of layers nroflayers 3 initial gas flow rate q gas in 2400 m3 d initial liquid flow rate q liq in 1560000 m3 d kinetics liquid gas diffusion coefficient at t diff d ch4 g 3 771e 05 m2 d d co2 g 0 000156 m2 d d h2s g 2 2043e 05 m2 d d h2 g 0 000165 m2 d d n2 g 0 0001536 m2 d d nh3 g 0 000169 m2 d d o2 g 0 0001608 m2 d temperature of diffusion coefficient t diff ch4 g 298 k t diff co2 g 293 k t diff h2s g 298 k t diff h2 g 298 k t diff n2 g 293 k t diff nh3 g 298 k t diff o2 g 293 k liquid solid transfer rate k aragonite 6 1166516 mol m2 d k artinite 50 mol m2 d k brucite 0 1 mol m2 d k ca3 po4 2 am1 50 mol m2 d k ca3 po4 2 am2 50 mol m2 d k ca3 po4 2 beta 50 mol m2 d k ca4h po4 3 3h2o 0 1 mol m2 d k cahpo4 2h2o 14 6435 mol m2 d k cahpo4bis 0 1 mol m2 d k calcite 1080 mol m2 d k diaspore 0 1 mol m2 d k dolomite 11 22 mol m2 d k dolomite dis 0 1 mol m2 d k fe oh 2 0 1 mol m2 d k hercynite 0 1 mol m2 d k huntite 0 1 mol m2 d k hydromagnesite 50 mol m2 d k hydroxyapatite 986 64761 mol m2 d k kstruvite 4 64e 06 mol m2 d k magnesite 0 000988416 mol m2 d k mg3 po4 2 0 1 mol m2 d k mghpo4 3h2o 4 78021e 07 mol m2 d k mg oh 2 act 0 1 mol m2 d k periclase 0 1 mol m2 d k portlandite 0 1 mol m2 d k siderite 0 00209952 mol m2 d k spinel 0 1 mol m2 d k struvite 0 002037407 mol m2 d k vivianite 1 66165e 06 mol m2 d reaction order for precipitation n aragonite 2 n artinite 2 n brucite 2 n ca3 po4 2 am1 2 n ca3 po4 2 am2 2 n ca3 po4 2 beta 2 n ca4h po4 3 3h2o 2 n cahpo4 2h2o 2 n cahpo4bis 2 n calcite 2 n diaspore 2 n dolomite 2 n dolomite dis 2 n fe oh 2 2 n hercynite 2 n huntite 2 n hydromagnesite 2 n hydroxyapatite 2 n kstruvite 2 n magnesite 2 n mg3 po4 2 2 n mghpo4 3h2o 2 n mg oh 2 act 2 n periclase 2 n portlandite 2 n siderite 2 n spinel 2 n struvite 2 n vivianite 2 arrhenius coefficient for temperature dependency theta ch4 g 1 024 theta co2 g 1 024 theta h2s g 1 024 theta h2 g 1 024 theta n2 g 1 024 theta nh3 g 1 024 theta o2 g 1 024 operation bubble size diam gas 0 003 m target removal efficiency eff target nh3 0 9 mass of seed material m seed aragonite 0 0005 kg m seed artinite 0 0005 kg m seed brucite 0 0005 kg m seed ca3 po4 2 am1 0 0005 kg m seed ca3 po4 2 am2 0 0005 kg m seed ca3 po4 2 beta 0 0005 kg m seed ca4h po4 3 3h2o 0 0005 kg m seed cahpo4 2h2o 0 0005 kg m seed cahpo4bis 0 0005 kg m seed calcite 0 0005 kg m seed diaspore 0 0005 kg m seed dolomite 0 0005 kg m seed dolomite dis 0 0005 kg m seed fe oh 2 0 0005 kg m seed hercynite 0 0005 kg m seed huntite 0 0005 kg m seed hydromagnesite 0 0005 kg m seed hydroxyapatite 0 0005 kg m seed kstruvite 0 0005 kg m seed magnesite 0 0005 kg m seed mg3 po4 2 0 0005 kg m seed mghpo4 3h2o 0 0005 kg m seed mg oh 2 act 0 0005 kg m seed periclase 0 0005 kg m seed portlandite 0 0005 kg m seed siderite 0 0005 kg m seed spinel 0 0005 kg m seed struvite 0 0005 kg m seed vivianite 0 0005 kg initial gas temperature t gas in 0 k stripping temperature t op 0 k surface area of seed material a seed 600 m2 g stripping ph ph op 10 5 rise velocity of bubbles u 25 920 m d stoichiometry reaction enthalphie of gas liquid transfer h gas ch4 g 1700 h gas co2 g 236 534 h gas h2s g 3000 h gas h2 g 500 h gas n2 g 1300 h gas nh3 g 4200 h gas o2 g 1700 enthalpy of heat for precipitation delta h aragonite 8 kj mol delta h artinite 120 2565 kj mol delta h brucite 114 kj mol delta h ca3 po4 2 am1 94 kj mol delta h ca3 po4 2 am2 87 kj mol delta h ca3 po4 2 beta 54 kj mol delta h ca4h po4 3 3h2o 105 kj mol delta h cahpo4 2h2o 23 kj mol delta h cahpo4bis 31 kj mol delta h calcite 8 kj mol delta h diaspore 103 0519 kj mol delta h dolomite 31 9 kj mol delta h dolomite dis 46 4 kj mol delta h fe oh 2 91 62 kj mol delta h hercynite 313 9199 kj mol delta h huntite 107 7798 kj mol delta h hydromagnesite 218 4466 kj mol delta h hydroxyapatite 0 kj mol delta h kstruvite 83 21 kj mol delta h magnesite 20 kj mol delta h mg3 po4 2 0 kj mol delta h mghpo4 3h2o 0 kj mol delta h mg oh 2 act 0 kj mol delta h periclase 151 23 kj mol delta h portlandite 128 62 kj mol delta h siderite 7 3 kj mol delta h spinel 388 0122 kj mol delta h struvite 0 kj mol delta h vivianite 5 06 kj mol dimensionless henry coefficient at 298 15 k kh ch4 g 0 0342527 kh co2 g 0 085632 kh h2s g 2 44662 kh h2 g 0 019 kh n2 g 0 0159 kh nh3 g 1492 kh o2 g 0 0318 table a6 5 parameter categories names default values and units for the nrm scrub table a6 5 category name default value unit dimension height h reactor 11 5 m safety factor on acid requirements sf acid 1 5 safety factor on reactor height sf height 1 5 volume v liq 81 3 m3 kinetics liquid gas diffusion coefficient at t diff d ch4 g 3 771e 05 m2 d d co2 g 0 000156 m2 d d h2s g 2 2043e 05 m2 d d h2 g 0 000165 m2 d d n2 g 0 0001536 m2 d d nh3 g 0 000169 m2 d d o2 g 0 0001608 m2 d temperature of diffusion coefficient t diff ch4 g 298 k t diff co2 g 293 k t diff h2s g 298 k t diff h2 g 298 k t diff n2 g 293 k t diff nh3 g 298 k t diff o2 g 293 k liquid solid transfer rate k nh4 2 so4 s 0 001 mol m2 d arrhenius coefficient for temperature dependency theta ch4 g 1 024 theta co2 g 1 024 theta h2s g 1 024 theta h2 g 1 024 theta n2 g 1 024 theta nh3 g 1 024 theta o2 g 1 024 operation bubble size diam gas 0 003 m target recovery efficiency eff target nh3 0 9 mass of seed material m seed nh4 2 so4 s 0 0005 kg initial gas temperature t gas in 0 k scrubbing temperature t op 0 k surface area of seed material a seed 600 m2 g rise velocity of bubbles u 25 920 m d stoichiometry reaction enthalphie of gas liquid transfer h gas ch4 g 1700 h gas co2 g 236 534 h gas h2s g 3000 h gas h2 g 500 h gas n2 g 1300 h gas nh3 g 4200 h gas o2 g 1700 enthalpy of heat for precipitation delta h nh4 2 so4 s 0 kj mol dimensionless henry coefficient at 298 15 k kh ch4 g 0 0342527 kh co2 g 0 085632 kh h2s g 2 44662 kh h2 g 0 019 kh n2 g 0 0159 kh nh3 g 1492 kh o2 g 0 0318 table a6 6 input sludge characteristics reactor design initial values and operating conditions for the anaerobic digester at holmen paper madrid spain data used for validation of the nutrient recovery model for the anaerobic digester nrm ad cod chemical oxygen demand cod input fractionation was conducted following the procedure proposed by grau et al 2007 for state variable description see appendix 5 cod chemical oxygen demand hrt hydraulic residence time q liq liquid flow rate t liq liquid temperature t operational operational temperature v liq liquid volume table a6 6 input flow reactor design initial values operation s aa kg cod m 3 0 s acetate mol m 3 2 85 s aa kg cod m 3 0 0172 s acetate mol m 3 0 0347 s fa kg cod m 3 0 217 s al mol m 3 unknown s fa kg cod m 3 0 0113 s al mol m 3 unknown s inert kg cod m 3 0 170 s butyrate mol m 3 1 14 s inert kg cod m 3 0 480 s butyrate mol m 3 0 322 s su kg cod m 3 1 05 s c 4 mol m 3 12 8 s su g cod m 3 0 569 s c 4 mol m 3 60 1 x aa kg cod m 3 0 s c min4 mol m 3 0 x aa kg cod m 3 0 112 s c min4 mol m 3 1 23 x ac kg cod m 3 0 s ca mol m 3 2 85 x ac kg cod m 3 0 0178 s ca mol m 3 7 10 x c4 kg cod m 3 0 s cl mol m 3 0 0357 x c4 kg cod m 3 1 33 s cl mol m 3 0 0357 x c kg cod m 3 0 s fe mol m 3 unknown x c kg cod m 3 31 3 s fe mol m 3 unknown x ch kg cod m 3 0 187 s h 0 mol m 3 0 x ch kg cod m 3 4 03 s h 0 mol m 3 0 0344 x fa kg cod m 3 0 s k mol m 3 0 0350 x fa kg cod m 3 2 30 s k mol m 3 6 39 x h2 kg cod m 3 0 s mg mol m 3 2 41 x h2 kg cod m 3 0 127 s mg mol m 3 2 69 x inert kg cod m 3 0 0936 s n 0 mol m 3 0 x inert kg cod m 3 13 8 s n 0 mol m 3 0 000256 x li kg cod m 3 0 140 s n 5 mol m 3 0 x li kg cod m 3 6 98 s n 5 mol m 3 0 00100 x pr kg cod m 3 0 s n min3 mol m 3 7 36 x pr kg cod m 3 0 998 s n min3 mol m 3 4 57 x pro kg cod m 3 0 s na mol m 3 0 0357 x pro kg cod m 3 0 0178 s na mol m 3 0 0357 x srb ac kg cod m 3 0 s o 0 mol m 3 3 98 x srb ac kg cod m 3 0 469 s o 0 mol m 3 0 x srb bu kg cod m 3 0 s p mol m 3 0 309 x srb bu kg cod m 3 4 99 s p mol m 3 0 245 x srb h kg cod m 3 0 s propionate mol m 3 1 63 x srb h kg cod m 3 43 6 s propionate mol m 3 0 0451 x srb pro kg cod m 3 0 s s 6 mol m 3 5 42 x srb pro kg cod m 3 16 6 s s 6 mol m 3 1 16 x su kg cod m 3 0 s s min2 mol m 3 0 0106 x su kg cod m 3 7 20 s s min2 mol m 3 6 35 s valerate mol m 3 0 878 s valerate mol m 3 0 402 q liq m3 d 1 15 0 t liq k 28 9 fraction of solids in effluent 0 002 v liq m3 2 80 ph 6 66 t operational k 302 15 hrt h 4 48 table a6 7 input digestate characteristics and operating conditions used for the lab scale experiments on struvite precipitation data used for validation of the nutrient recovery model for the precipitation crystallization unit nrm prec for state variable description see appendix 5 table a6 7 variable digestate 1 digestate 2 variable digestate 1 digestate 2 s acetate a mol m 3 0 100 0 100 s mg mol m 3 26 1 26 4 s al mol m 3 0 0100 1 00 s n 5 mol m 3 98 0 127 s butyrate a mol m 3 0 100 0 100 s n min3 mol m 3 362 346 s c 4 mol m 3 10 0 10 0 s na mol m 3 100 127 s c min4 a mmol m 3 0 100 0 100 s p mol m 3 38 8 45 5 s ca mol m 3 42 1 57 1 s propionate a mol m 3 0 0100 0 0100 s cl mol m 3 73 3 25 0 s s 6 mol m 3 40 0 20 0 s fe mol m 3 170 0 100 s s min2 mol m 3 0 100 0 100 s k mol m 3 104 122 s valerate a mol m 3 0 100 0 100 ph 8 43 7 83 temperature k 293 15 293 15 a estimated from the soluble chemical oxygen demand cod content following the procedure described in cesur and albertson 2005 table a6 8 input flow composition and operating conditions used for validation of the treatment train nrm chem nrm strip nrm scrub operational data were obtained from a technical inquiry at company x chem chemical dosing unit strip stripper scrub scrubber for state variable description see appendix 5 dom dissolved organic matter p gas gas pressure q gas gas flow rate q liq liquid flow rate table a6 8 input flow after naoh dose a operation nrm strip operation nrm scrub s al mol m 3 20 q liq in m3 d 1 2004 h2so4 dose m3 d 1 20 16 s c 4 mol m 3 80 q gas in m3 d 1 1 560 000 q gas in m3 d 1 output nrm strip s c min4 mol m 3 0 0080 column height m 11 5 column height m 11 5 s ca mol m 3 60 temperature k 328 15 temperature k output nrm strip s cl mol m 3 80 ph 10 3 ph acid 1 3 s dom mol m 3 10 vol liq m3 81 3 vol liq m3 20 16 s fe mol m 3 1 2 p gas in atm 2 42 p gas in atm output nrm strip s h 0 mol m 3 0 0010 s k mol m 3 33 s mg mol m 3 43 s n 0 mol m 3 0 10 s n 5 mol m 3 59 s n min3 mol m 3 199 s na mol m 3 102 s o 0 mol m 3 0 s p mol m 3 33 s s 6 mol m 3 40 s s min2 mol m 3 0 temperature k 293 15 a dose of 4 1 kg naoh m 3 as specified by company x appendix 7 model verification validation examples table a7 1 model verification validation against prior knowledge some dynamic simulation tests and effects all results were found to be realistic for state variable description see appendix 5 ad anaerobic digestion prec precipitation crystallization scrub scrubber srb sulfate reducing bacteria strip stripper vfa volatile fatty acids table a7 1 nrm ad nrm prec nrm strip nrm scrub s c 4 in alkalinity delayed ph s c 4 out vfa biogas production s p in struvite precipitation reactor height no influence on performance reactor height no influence on performance ph co3 precipitation ph co2 stripping not biologically mediated s mg in ph s p out phosphorus recovery efficiency temperature s n min3 out p nh3 out gas phase partial pressure nh3 recovery efficiency effluent ph p nh3 in gas phase partial pressure fertilizer alkalinity nh2coo formation n fertilizer modification ph inhibition level srbs 5 other bacteria 6 h2s production if ph 6 s p in phosphorus precipitation supersaturation q liq in residence time caco3 precipitation scaling potential temperature biogas production ph input nutrient contents fertilizer density and molecular weight nrm ad reducing the input alkalinity to the digester results in a delayed ph decrease less carbonate buffer because of volatile fatty acid accumulation methanogenic bacteria are very sensitive to ph decreases vanrolleghem and lee 2003 hence a reduction of the biogas production is observed obviously the output alkalinity decreases as well increasing the input ph results in an increased formation of carbonate precipitates in the digester whereas decreasing the ph stimulates the stripping of co2 see carbonate equilibria as function of ph zumdahl 2005 setting the ph inhibition level of sulfate reducing bacteria srbs at 5 but for the other bacteria at 6 leads to increased h2s production if the ph in the digester becomes lower than 6 hence the other bacteria are inhibited whereas the srbs still work at ph values lower than 6 increasing the temperature in the digester stimulates the production of biogas the increased temperatures facilitate faster reaction rates and thus more biogas can be produced from the organic matter in an equal amount of time tchobanoglous et al 2003 nrm prec decreasing the p concentration in the input waste flow reduces the potential for struvite mgnh4po4 6h2o precipitation decreasing the mg concentration in the input waste flow decreases the ph in the reactor which is obvious as a mg source is often added to induce p precipitation le corre et al 2007 hence less mg p precipitates are formed the effluent p concentration increases while the p recovery efficiency decreases increasing the p concentration in the input waste flow at a particular neutral to high ph increases the amount of p precipitates formed precipitation is driven by supersaturation decreasing the ph by decreasing the concentration of nutrients such as mg and ca in the input waste flow reduces the resulting fertilizer density and molecular weight fewer and less heavy p precipitates nrm strip decreasing the reactor height has no influence on the n recovery efficiency because the nh3 nh4 equilibrium between a gas bubble and the surrounding water is reached in a very small time interval gujer 2008 increasing the temperature increases the nh3 stripping performance wang et al 2007 hence lower effluent nh4 n concentrations and higher nh3 partial pressures in the gas phase are found the more nh3 is stripped out the lower the effluent ph increasing the liquid flow rate reduces the residence time in the system as such the slow formation of caco3 precipitates in the reactor is reduced and thus also the scaling potential nrm scrub decreasing the reactor height has no influence on the n recovery efficiency because the nh3 nh4 equilibrium between a gas bubble and the surrounding water is reached in a very small time interval gujer 2008 increasing the partial pressure of nh3 in the incoming gas phase coming from the stripper decreases the fertilizer alkalinity through nh2coo formation and increases the n concentration in the resulting ammonium sulfate solution hence more n can be recovered in an equal amount of time 
26473,the reported research developed a generic nutrient recovery model nrm library based on detailed chemical solution speciation and reaction kinetics with focus on fertilizer quality and quantity as model outputs dynamic physicochemical three phase process models for precipitation crystallization stripping and acidic air scrubbing as key unit processes were developed in addition a compatible biological physicochemical anaerobic digester model was built the latter includes sulfurgenesis biological n p k s release uptake interactions with organics among other relevant processes such as precipitation ion pairing and liquid gas transfer using a systematic database reduction procedure a 3 to 5 fold improvement of model simulation speeds was obtained as compared to using full standard thermodynamic databases missing components and reactions in existing standard databases were discovered hence a generic nutrient recovery database was created for future applications the models were verified and validated against a range of experimental results their functionality in terms of increased process understanding and optimization was demonstrated graphical abstract image 1 keywords generic physicochemical model framework reduced phreeqc resource recovery mathematical modelling numerical solution water chemistry anaerobic digestion model software and database availability name nutrient recovery model nrm library nutricover dat database contact céline vaneeckhaute bioengine research team on green process engineering and biorefineries chemical engineering department université laval 1065 avenue de la médecine pavillon adrien pouliot québec qc canada g1v 0a6 tel 1 418 656 28 59 e mail celine vaneeckhaute gch ulaval ca year first available 2016 software required west or tornado http www mikepoweredbydhi com products west and or phreeqc http wwwbrr cr usgs gov projects gwc coupled phreeqc programming language modelica and c availability source code and databases can be obtained on request by contacting the corresponding author cost free 1 introduction in the transition from waste water treatment plants wwtps to water resource recovery facilities wrrfs mathematical models are becoming important tools to hasten nutrient recovery process implementation and optimization vanrolleghem and vaneeckhaute 2014 indeed models may aid in technology development process operation optimization and scale up in a cost effective way rieger et al 2012 yu et al 2011 although to date many processes for the recovery of nutrients from waste water have been proposed and applied to varying degrees for example struvite precipitation ammonia stripping and acidic air scrubbing vaneeckhaute et al 2017a no generic models for nutrient recovery aiming at the construction and optimization of treatment trains for resource recovery are currently available vaneeckhaute et al 2017b moreover existing model libraries for wwtps e g activated sludge models asms provided by the international water association iwa henze et al 2000 gernaey et al 2004 do not allow the integration of nutrient recovery unit processes and or the coupling of a nutrient recovery treatment train this is due to the omission of key fundamental physicochemical components and transformations that are essential to describe nutrient recovery unit processes batstone et al 2012 brouckaert et al 2010 flores alsina et al 2015 critical elements to be dealt with include accurate descriptions of acid base reactions slow precipitation kinetics liquid gas exchange and sorption desorption in the complex mixture of chemical species that the resource recovery systems in place deal with batstone et al 2012 consequently the potential to use models to adequately put together an optimal treatment train of unit processes and set the operating conditions that maximize nutrient recovery and fertilizer quality is missing over the last 10 years important progress was made towards the development and integration of a physicochemical modelling framework compatible with the current more biological process oriented modelling frameworks provided by iwa flores alsina et al 2016 hauduc et al 2015 lizarralde et al 2015 mbamba et al 2016 however the scope of the existing studies stops at the anaerobic digestion of wwtp sludge where it mainly aims at the prediction of uncontrolled struvite precipitation during digestion through phosphorus modelling at the start of this research no generic models were available that may allow to predict optimize and control under dynamic conditions the recovered product quality e g macronutrient content particle size density yield and process performance of a series of nutrient recovery technologies following digestion of various waste water flows manure sludge food waste etc the reported research aimed at developing a library of generic integrated biological physicochemical three phase mathematical process models for the most established nutrient recovery systems currently available as selected in vaneeckhaute et al 2017a as well as a compatible model for anaerobic digestion the models are based on detailed solution speciation and reaction kinetics as brought forward in vaneeckhaute et al 2017b this nutrient recovery model nrm library is a synthesis of the large body of knowledge on nutrient recovery processes that is currently available from research studies and operational experience in contrast to existing model libraries for waste water treatment e g the asm library henze et al 2000 gernaey et al 2004 the scope of the proposed nrm library starts at the anaerobic digester and focusses on the nutrient recovery treatment train following the digester in addition to the development of a generic physicochemical modelling framework a critical and challenging step when combining biological and physicochemical differential equations is their numerical solution lizarralde et al 2015 this is due to the stiffness that arises when considering reactions with very different conversion rates i e the range of system time constants is large batstone et al 2012 brouckaert et al 2010 lizarralde et al 2015 musvoto et al 2000 rosen and jeppsson 2006 sotemann et al 2005 previous attempts towards inclusion of a physicochemical modelling framework in existing wwtp models e g flores alsina et al 2016 hauduc et al 2015 mbamba et al 2016 takács et al 2006 applied a limited literature based selection of chemical species and reactions for self implementation in the modelling software and used self coded numerical solvers that have shown difficulties with convergence flores alsina et al 2015 moreover when one wants to extend these models with new species and reactions time consuming and complicated programming work is required model flexibility is however particularly important for modelling of wrrfs due to the variability of waste water flows in time and between different facilities vanrolleghem and vaneeckhaute 2014 lizarralde et al 2015 proposed the coupling of an external existing geochemical software tool for inclusion of some basic speciation calculations in dynamic process models the use of an external geochemical software tool with designated thermodynamic databases is interesting for accurate calculation of chemical speciation and ph software tools as phreeqc and minteq are generally accepted tools for equilibrium water quality modelling and have a dedicated and proven solver for chemical speciation calculations allison et al 1991 parkhurst and appelo 2013 however simulation times using the full phreeqc minteq thermodynamic databases for chemical speciation may be longer than when dedicated program code is used lizarralde et al 2015 hence an important challenge exists in the development of an efficient methodology for including and solving the stiff equations related to the chemical speciation submodel in nutrient recovery models a compromise should be found between model accuracy and simulation times the present paper describes the specifications the development methodology and the implementation of the generic nrm framework a systematic procedure to allow for inclusion of accurate chemical speciation in dynamic nutrient recovery process models at minimal computational effort is proposed model functionality in terms of increased process understanding and optimization is demonstrated through testing and validation recommendations for further experimental research required to fully calibrate the model dynamics as well as case specific potential model extensions are provided 2 nutrient recovery model nrm building methodology the methodology used for development of the nrm library can be represented by six steps shown in fig 1 and described in detail in the sections below the proposed generic models are based on mass balances to describe physicochemical and biochemical transformation and transport processes as well as an accurate calculation of water chemistry in order to correctly define solution speciation and driving forces for component transformation two key features of the models should be stressed first a dynamic modelling approach i e one that accounts for time dependent changes in the state of the system was applied because the models should be applicable to time varying situations and variable operating conditions such as i periodical load variations e g truck loads of waste sludge treatment during working hours only and seasonal variations ii individual disturbances e g rain events and incorrect manipulations and iii systems that are operated intermittently or cyclically as is the case for multiple nutrient recovery processes e g intermittent aeration in stripping systems and semi batch processes to obtain target fertilizer specifications e g a predefined ammonium sulfate ams concentration in an acidic air scrubber second the geochemical software tool phreeqc was used for two purposes in the development of the nrm library 1 phreeqc for nrm building section 2 2 1 which involves the selection of species and reactions to be included in the models the preparation of a reduced phreeqc model database and the definition of phreeqc selected outputs 2 phreeqc for nrm simulation section 2 3 which involves the tight coupling of the reduced phreeqc model to a kinetic and dynamic mass balance model in order to accurately and efficiently calculate speciation and driving forces for component transformations at each time step during the model simulations as opposed to previously used speciation modelling methodologies e g flores alsina et al 2016 hauduc et al 2015 mbamba et al 2016 takács et al 2006 the proposed methodology guarantees convergence and flexibility lizarralde et al 2015 in order to reduce simulation times a systematic procedure for thermodynamic model database reduction was proposed finally it should be noted that in the following sections variables will be defined with their dimension given in straight brackets m for mass l for length and t for time 2 1 step i definition of modelling objectives 2 1 1 selection of considered included unit processes and input waste streams a literature review on nutrient recovery technologies vaneeckhaute et al 2017a was conducted in order to select the best available technologies as key unit processes for modelling table 1 four key units the selection was made based on the economic feasibility full scale application at this stage and the potential to produce marketable end products for agricultural applications with the purpose of modelling treatment trains four ancillary units were additionally selected table 1 as mentioned above in contrast to existing studies the scope of the present research starts at the anaerobic digestion unit and focusses on the nutrient recovery treatment train following the digester no recycle flows to upstream facilities in the wrrf e g to an activated sludge as system were currently considered in later stages the proposed nrm models could be coupled to activated sludge models asms if a generic physicochemical framework is also integrated in the asms as input waste stream to the digester manure and sludge primary and secondary sludge and mixtures of these from wwtps removing nitrogen n and chemical oxygen demand cod were considered digestate the remaining product after digestion was considered as input stream to the key units for controlled nutrient recovery following the digester next to manure wwtp sludge was selected since the current most advanced models for anaerobic digestion originate from the municipal wastewater and sludge treatment sector nevertheless for future applications the generic nrm ad implementation allows easy extension to co digestion of other organic biological wastes e g using the general integrated solid waste co digestion giscod modelling tool proposed by zaher et al 2009 the nrm ad model can also be extended to allow for specific reactions occurring during the treatment of sludge from enhanced biological phosphorus p removal ebpr as e g in ikumi 2011 or wang et al 2016 but this was considered to be outside the scope of this paper 2 1 2 specification of model outputs and influencing factors in order to develop valuable tools for process optimization the desired model outputs and factors that may affect these outputs were defined for each nrm key unit on the basis of a detailed literature review vaneeckhaute et al 2017b obviously the total content of principal macronutrients n p and potassium k in the fertilizer product and the amount of biogas produced are important model outputs so as to quantitatively and qualitatively determine the overall resource recovery next to the three principal macronutrients n p and k previous studies have shown the relevance of the secondary macronutrient sulfur s in the context of nutrient recovery vaneeckhaute et al 2014 some motivations for inclusion of s in the models were i the demand for s fertilization in agriculture is increasing hence its recovery deserves attention till 2010 ii s may precipitate with iron fe making fe less available for p precipitation iii sulfate reducing bacteria srbs compete with methane ch4 producing bacteria for the same substrate hence ch4 production may be reduced at high s concentrations oyekola et al 2007 iv hydrogen sulfide h2s is an important inhibitor of ch4 producing bacteria oyekola et al 2007 and v high biogas h2s values cause important concerns toxicity corrosion biogas pollution e g in the paper industry reiter and piccot 2004 calcium ca and magnesium mg are also of importance mainly for their soil improving properties and their interaction with p vaneeckhaute et al 2016 for all nutrient recovery systems the percentage recovery of the target nutrient is a key performance measure it was calculated using equation 1 1 r e c o v e r y s i i q i n s i o u t q o u t s i i n q i n 100 in which s i i n and s i o u t are the in and outgoing liquid flow concentrations for component i m l 3 and q i n and q o u t are the in and outgoing flow rates l 3 t 1 furthermore the macronutrient use efficiency n p k s in the fertilizer end products is an important factor in determining the agronomic potential and sustainability of the produced fertilizers it was evaluated as the percentage available or mineralized nutrient content over the total nutrient content e g nh4 n total n and ortho p total p this percentage can be obtained by means of a chemical solution speciation calculation section 2 2 1 next the fertilizer ph and salt content are of important concern as they may impact soil quality the ph was directly calculated from solution speciation salts were characterized using the sodium adsorption ratio sar i e the relative amount of available sodium na over divalent cations ca and mg hillel 2008 factors that may additionally determine the value of the recovered product are the particle size for solid fertilizers the density for liquid fertilizers and the product purity in this work the particle size was evaluated as mean particle diameter section 2 2 2 but in future research one may be interested in particle size distributions psds nopens et al 2014 perez et al 2008 for the nrm prec unit product purity was evaluated by calculating the fraction of precipitated target mineral s over the total product collected taking in account the presence of multiple competing and concurrent precipitation reactions to this end also the precipitation of principal micronutrients occurring in waste water treatment such as fe and aluminium al were evaluated since these precipitates may negatively impact the fertilizer p release in the soil vaneeckhaute et al 2016 moreover pollution with organics was accounted for see section 2 2 1 for the nrm strip nrm scrub units purity was evaluated by calculating the amount of volatile target component s captured over the total amount of gas liquid captured finally the formation of scale within the treatment unit is an important operational bottleneck for multiple nutrient recovery technologies especially calcium carbonate caco3 and magnesium carbonate mgco3 formation in the stripping and scrubbing units are of concern to determine scale formation the amount of caco3 and mgco3 precipitates formed were evaluated next to other relevant precipitation reactions the scaling potential was then examined by using the scaling criteria of the ryzner index tchobanoglous et al 2003 2 2 step ii theoretical model development the dynamic mathematical model of each unit process was built using fig 2 i the definition of a chemical speciation model by means of geochemical modelling software phreeqc for model building section 2 2 1 ii the description of a kinetic physicochemical and biochemical transformation model tailored to the models developed in the first step section 2 2 2 and iii the selection of a reactor mass balance model to describe the time dependent process conditions section 2 2 3 2 2 1 chemical speciation model phreeqc for nrm building in order to describe the water chemistry in each system first the potentially present chemical components and species were identified step 1 and the possible heterogeneous physicochemical transformation reactions gas transfer precipitation were selected using generally accepted geochemical software for equilibrium water quality modelling phreeqc 3 0 6 parkhurst and appelo 2013 visual minteq 3 1 was used as a control allison et al 1991 since the involved homogeneous reactions acid base ion pairing in a speciation calculation are very rapid compared to heterogeneous physicochemical reactions and biological reactions instantaneous equilibrium can be assumed adequate for solving water chemistry in nrms batstone et al 2012 in order to compromise between model accuracy and simulation times when coupling the speciation model to the dynamic mass balance model a reduced phreeqc database and input script with defined selected model outputs were developed for each key unit section 2 3 1 the four step procedure proposed for nrm building involving the selection of the relevant species reactions and the preparation of the reduced phreeqc chemical speciation model is presented in fig 3 and further described below 2 2 1 1 step 1 selection of relevant components for each unit process based on literature collected experimental data and prior knowledge the most important physicochemical dissolved components to include in models for nutrient recovery from both digested manure and sludge were selected for each key unit process table 2 in line with the selected model outputs section 2 1 2 it was aimed to represent five important component classes 1 all important macronutrients for recovery in line with the findings in vaneeckhaute et al 2014 impact recovery efficiency and fertilizer value 2 gaseous compounds impact biogas production volatilization odors greenhouse gas emissions among other 3 salts impact ionic strength and soil quality 4 inorganic and organic carbon compounds impact biogas production product purity and scaling 5 micronutrients that may occur in large quantities in waste water treatment e g fe and al as a result of coagulation flocculation practices impact product purity and recovery potential since redox reactions were also considered components that exist in more than one valence state in solution were identified by their component name followed by their valence for instance i the component s c 4 carbon iv constitutes co3 2 plus hco3 plus h2co3 or co2 aq plus various other carbonate complexes present in the solution such as mgco3 and cahco3 and ii s n min3 nitrogen iii constitutes both nh4 and dissolved nh3 as well as its various complexes only for fe the two valence states fe ii and fe iii were lumped together into one component for total fe since the measurement of its valence is complicated and generally not provided in practice in wrrfs nor in literature yet in the speciation calculation the fe ii fe iii redox equilibrium was considered as calculated from the occurring redox potential the input fe redox states e g fe iii cl3 and fe ii so4 can optionally be specified if such data are available as it is well known that the presence of organic compounds may influence the purity of recovered products kozic et al 2011 relevant interactions between inorganic and organic components were also accounted for among the organic biological components considered see section 2 2 3 volatile fatty acids vfas up to valerate were included as individual components in the physicochemical models oh and martin 2010 indeed emphasized the particular importance of their physicochemical behaviour in wrrfs the remaining soluble organic chemical oxygen demand cod fractions see section 2 2 3 were lumped into one component i e dissolved organic carbon doc 1 g doc 0 33 g cod for doc the complexation with metals ca mg was computed using a competitive gaussian model for dissolved organic matter dom 1 mol doc 8 6 10 2 mol dom usepa 1999 this simplified approach may be further refined for future applications if more insights in the physicochemical behaviour of each particular cod fraction become available finally it should be remarked that heavy metals such as cadmium cd copper cu and zinc zn were not yet included in the speciation models nevertheless heavy metals and the corresponding reactions are available in phreeqc hence the generic approach used for chemical speciation allows easy extension of the models to incorporate heavy metals for future applications 2 2 1 2 step 2 addition of relevant components species reactions to generic geochemical databases to verify completeness the generic phreeqc phreeqc dat and minteq minteq v4 dat databases were compared with each other as well as with prior knowledge and with literature two observations were made 1 the generic minteq database is more complete than the phreeqc one in view of wrrf modelling 2 some important components species and reactions that can be expected in wrrfs are not included in either database hence the generic database files were extended prior to use for speciation calculation table 3 the corresponding acid base constants ion pairing constants solubility products and other thermodynamics were taken from literature or other model libraries as indicated in table 3 it should be noted that in the context of nutrient recovery from waste water flows as fertilizer products the database extensions provided concern a fundamental contribution to the field for example k struvite is next to n struvite an interesting fertilizer though its precipitation reaction is not included in the standard databases also precipitation of aluminium phosphate alpo4 is highly important in waste water treatment since al salts are often dosed for sludge conditioning whereas the precipitation reaction of ammonium sulfate nh4 2so4 is essential for description of the scrubbing process noteworthy is also the clear impact of the omission of the species monosodium phosphate i e nah2po4 aq on the simulation results as was observed during model validation of the nrm prec see section 3 4 1 the generic extended database in view of nutrient recovery was named nutricover dat and will be made available for inclusion in future phreeqc and minteq software packages 2 2 1 3 step 3 setting up the speciation submodel selection of relevant species and reactions the following methodology was used for selection of the relevant species and reactions a specification of input scenarios components operational conditions b run phreeqc under the various conditions defined in a c select relevant species and reactions based on the phreeqc outputs d verify the selection of species and reactions with literature a specification of input scenarios realistic ranges for the input component concentrations and operational conditions e g ph and temperature for the speciation calculations were adopted from literature and experimental data as described in section 2 4 as well as through contact with technology providers the operational conditions and input streams tested for each key unit process are the following anaerobic digestion no oxygen ph 5 8 5 temperature 20 55 c input sludge and manure precipitation unit ph 7 11 temperature 20 50 c with and without ca oh 2 cao mgcl2 mg oh 2 or mgo dosing 0 500 mol m 3 input digestate stripping unit ph 7 11 temperature 20 70 c with and without naoh ca oh 2 cao mg oh 2 or mgo dosing for ph increase 0 500 mol m 3 input digestate air scrubber h2so4 solution at ph 1 4 and temperature 15 25 c input stripped air phreeqc makes calculations using an input script in which the problem is specified via keywords and associated data blocks first all possible realistic scenarios were introduced using the maximum minimum values of all considered operational factors and input variables for each unit separately next for each unit the composition of 20 different possible input flows from literature astals et al 2013 bhuiyan et al 2007 cesur and albertson 2005 martin 2003 mattocks et al 2002 tchobanoglous et al 2003 vaneeckhaute et al 2012 2013a 2014 vlaco 2012 zaher et al 2009 was used for simulation under variable operating conditions to this end a phreeqc input script was developed for each unit involving the identification of the input waste flows phreeqc data blocks solution and or gas a batch reaction calculation was also coded in case there is both a gas and liquid input i e for the stripper and scrubbing unit phreeqc data block reaction then one factor at a time was allowed to increase within its range e g phreeqc code reaction temperature 20 0 70 0 in 51 steps while the other factors were kept fixed as such a broad range of input scenarios was screened note that currently no alternative strategy is available in phreeqc for selection of the various simulation scenarios parkhurst d personal communication 2014 yet the development of an adequate but more time efficient procedure to go through a multidimensional set of factors will be aspect of further research b run phreeqc speciation calculations in phreeqc minteq are made using designated thermodynamic databases that include a wide range of data for mineral phases and compounds the calculations are based on three types of equations 1 equilibrium relationships 2 concentration conditions or mass balances one per component and 3 electro neutrality conditions or charge balances chapra 2008 stumm and morgan 1996 by inclusion of oxidation reduction reactions in the database also the components redox states were defined in the speciation calculations the ph may be defined or adjusted according to the charge balance the davies equation was selected for ion activity correction in the nrms similar to ali and schneider 2008 galbraith et al 2014 lizarralde et al 2015 ohlinger et al 1998 and flores alsina et al 2016 the davies ion activity correction was also recommended by hafner and bisogni 2009 above other relevant approaches such as the pitzer ion interaction approach moreover the peng robinson equation of state which corrects for the non ideal behaviour of gases was used for calculating partial pressures p and solubility parkhurst and appelo 2013 furthermore the temperature dependency of the thermodynamic equilibrium coefficients was expressed by means of the van t hoff relationship zumdahl 2005 while the value of the water dissociation constant k w at different temperatures other than 25 c was computed using the equation of harned and hamer 1933 c d selection criteria verification from the speciation calculations the distribution of aqueous species ion activities and saturation indices s i for phases driving forces for precipitation and gas transfer were obtained soluble species with an insignificantly low activity i e less than 0 01 of the total component activity in all scenarios were excluded from the nrms solids that may potentially precipitate s i 0 as well as gases that may volatilize partial pressure p 0 in the different units were selected conditions ph temperature and rates for precipitation of the various forms of the selected minerals were also researched in the literature the aim was to confirm the exclusion of the selected insignificant species and precipitates while further identifying potential species and reactions that should be included in the database for each unit the number of species and reactions that were found to be relevant according the speciation calculations and that were included in each nrm are presented in table 4 a the list of species involved and the transformation reactions included in each model are presented in appendix 1 table a1 1 and tables a1 2 1 6 respectively 2 2 1 4 step 4 building of a reduced model knowing that the generic geochemical model databases contain more than 3000 species allison et al 1991 it was expected that the elimination of irrelevant species and reactions can have a significant impact on the simulation speed as such with the purpose of reducing model complexity and simulation times when coupling phreeqc for nrm simulation section 2 3 a new phreeqc database file including only the selected reactions and species was set up for each unit process moreover a selected output data block was coded in the input script for each unit in order to transcribe only the appointed species and driving forces to the resulting output file the latter is required for efficient coupling of the selected outputs to the kinetic and mass balance model section 2 3 finally simulation results and speeds using the reduced model were compared with results and speeds obtained by running the developed chemical speciation scripts using the full phreeqc dat p and minteq v4 dat m databases available in the phreeqc 3 0 6 release 2 2 2 physicochemical transformation model heterogeneous physicochemical reactions such as liquid gas transfer and precipitation occur much slower than the homogeneous reactions involved in the speciation calculations presented above hence a kinetic approach was applied in order to allow for dynamic variation of the constituents gas exchange processes in resource recovery systems can occur passively i e without intensive gas bubbling nrm ad or actively i e with gas bubbling driven by an external air flow nrm strip nrm scrub in each case similar kinetic gas exchange formulations based on the concentration driving force between the liquid and gas phases apply eq 2 2 ρ t i m l 3 t 1 k l g i a s l i q i h t i p g a s i where s l i q i is the liquid phase activity of component i m l 3 p g a s i is the partial pressure in the gas phase of component i atm h t i is the temperature dependent henry coefficient m l 3 atm 1 h t i p g a s i represents the saturation concentration of gas component i in the liquid k l g i is the overall liquid gas mass transfer coefficient l t 1 and a is the specific surface of the gas bubbles per reactor volume l 1 temperature dependency of h was described by a van t hoff relationship powers et al 1987 while temperature dependency of k l g i a was described using the arrhenius equation chapra 2008 through the coupling with phreeqc section 2 3 1 both s l i q i and p g a s i can be calculated at every time step during the simulations the total gas phase pressure was computed using dalton s law of partial pressures stumm and morgan 1996 for calculation of k l g i a a distinction was made between active and passive systems since the values may differ significantly in practice chapra 2008 sotemann et al 2006 tchobanoglous et al 2003 moreover a second distinction was made depending on the solubility of the gas considered which determines whether mass transfer is liquid film controlled for low to moderate soluble gases h 0 55 i e for ch4 co2 h2 h2s n2 o2 all gases considered in the nrms except for nh3 or gas film controlled for very soluble gases h 0 55 e g for nh3 as such four potential mass transfer scenarios were considered which are described in detail in appendix 2 1 active liquid gas gas liquid transfer nrm strip nrm scrub of low to moderately soluble gases 2 active liquid gas gas liquid transfer nrm strip nrm scrub of very soluble gases 3 passive liquid gas gas liquid transfer nrm ad of low to moderately soluble gases 4 passive liquid gas gas liquid transfer nrm ad of very soluble gases the kinetic liquid solid solid liquid transfer mechanisms described in all nrms are nucleation birth of crystals crystal growth and redissolution all reactions were represented by an empirical power law eq 3 using relative supersaturation s 1 as driving force ali and schneider 2008 galbraith et al 2014 harrison et al 2011 nielsen 1984 3 ρ t i m l 3 t 1 k t s 1 n in which s is the saturation ratio i a p k s 1 v v refers to the stoichiometric precipitation coefficient which represents the total number of species involved in the precipitation reaction i a p is the ion activity product m l 3 k s is the solubility product m l 3 k t is the temperature dependent transfer coefficient m l 3 t 1 and n is the reaction order the value of s was directly derived from the saturation index log i a p k s which is calculated by phreeqc at every time step during model simulations the temperature dependency of the reaction rate was modelled by means of the arrhenius equation greenberg and tomson 1992 nielsen 1984 using literature values for the molecular weight mw and density of the different precipitates the total volume v f e r t i l i z e r total mass moles m f e r t i l i z e r and mw m w f e r t i l i z e r of the recovered fertilizer product composed of the various precipitates was calculated at every time step the time dependent number of particles n p a r t was then determined using the avogadro constant n a 6 022 1023 mol 1 the mean particle diameter d p of the precipitates was calculated assuming spherical particles using equation 4 4 d p l v f e r t i l i z e r n p a r t π 6 3 the kinetic precipitation dissolution coefficient k t and the reaction order n in equation 3 were adjusted according to the liquid solid solid liquid transfer mechanism occurring k g t and n g for growth k b t and n b for nucleation k d t and n d for dissolution the prevalent mechanism depends on the value of s and the amount of seed material in the reactor hence these values were checked at every time step as such four possible scenarios were considered which are described in detail in appendix 2 1 supersaturation occurs s 1 s i 0 and seed material is available 2 supersaturation occurs s 1 s i 0 but no seed material is available and or the crystal size is not large enough to have any influence on the process i e the induction time is not exceeded 3 the solution is undersaturated s 1 s i 0 and precipitate is present in the system 4 equilibrium occurs s 1 s i 0 finally for the nrm prec a generic mechanism for agglomeration and floc break up through the effect of mixing was included using the spherical particle model for macroscale flocculation crittenden et al 2012 appendix 2 a time dependent agglomerate number balance was also provided section 2 2 4 by division of the total fertilizer volume by the number of agglomerates the agglomerate volume was obtained the mean agglomerate diameter can then be computed in the same way as the particle diameter eq 4 it should be remarked that mixing energy may also have to be included in equation 3 growth can be assumed surface integrated controlled when the system is well mixed so the mixing effect can be neglected for the growth equations in unit processes with proper mixing galbraith et al 2014 rahaman et al 2014 however mixing may affect the nucleation mechanism and induction time through microscale flocculation ohlinger et al 1998 this mechanism is very site and species specific hence it was considered out of the scope of the present generic model development study however by selecting a generic empirical equation based on s eq 3 the models could easily be extended to include mixing effects galbraith et al 2014 perez et al 2008 if appropriate parameter correlations are available as mentioned above future extensions may also involve particle size distributions psds nopens et al 2014 perez et al 2008 2 2 3 biochemical transformation model biochemical processes and state variables are clearly important for the nrm ad model the description stoichiometry and kinetics of biochemical transformations that may be expected in the nrm ad were based on the anaerobic digestion model no 1 adm1 batstone et al 2002 resulting in a total of 19 processes appendix 3 table a3 1 ph h2 and nh3 inhibition expressions were taken from batstone et al 2002 over the last ten years various wrrf modellers e g flores alsina et al 2016 mbamba et al 2016 solon et al 2015 wang et al 2016 have developed extensions of adm1 mainly focused on the inclusion of a limited selection of chemical species and reactions to predict unwanted struvite precipitation and s inhibition in the digester since ph plays a critical role in anaerobic digestion modelling batstone et al 2012 solon et al 2015 vaneeckhaute et al 2017b inclusion of a more accurate and complete chemical speciation calculation with associated efficient numerical solution procedure to predict ph and driving forces for physicochemical and biochemical transformations is highly relevant in this study adm1 was for the first time extended with all essential physicochemical components and processes acid base reactions ion pairing liquid solid transfer liquid gas transfer redox transformations that significantly impact anaerobic digester performance and digestate quality selected in section 2 2 1 appendix 3 table a3 1 extension 1 ion pairing of cations with vfas was also accounted for on top of being important for predicting anaerobic digestion ph and performance inclusion of such detailed physicochemical framework is essential for predicting process performance and product quality of physicochemical nutrient recovery unit processes that follow the digester indeed the output digestate characteristics from the anaerobic digestion model should be sufficiently specified and compatible with the required input to the nutrient recovery unit process models similar as in lizarralde et al 2010 biological sulfate reduction sulfurgenesis was incorporated based on the model proposed by knobel and lewis appendix 3 table a3 1 extension 2 an inhibition term for h2s was incorporated in the appropriate bio kinetics ih2s and its transfer to the gas phase was included as described in section 2 2 2 the decay of srbs was included in the same way as the decay of other organisms described in the adm1 model batstone et al 2002 n p k and s release from biomass as well as nutrient uptake by growing biomass was accounted for appendix 3 table a3 1 extension 3 modelling of ebpr sludge was considered beyond the scope of this study section 2 1 1 but for future applications the nrm ad could be further extended using equations from e g ikumi 2011 flores alsina et al 2016 or wang et al 2016 appendix 3 table a3 1 potential extension 4 finally n and p release through disintegration of complex particulates p release from lipid hydrolysis n release from protein degradation and amino acid uptake as well as the n and p content of soluble and particulate inerts were also included the detailed stoichiometric matrix and kinetic transformation equations proposed can be found in appendix 3 tables a3 2 a3 4 in this study the biological solids leaving the digester were supposed to end up mainly in the solid fraction after solid liquid separation of the digestate hence in the subsequent key units for nutrient recovery it was assumed that biochemical particulate transformations do not play a significant role nevertheless in order to allow coupling of nrms to activated sludge models asms in a later stage through return liquors for instance the biological state variables were integrated in all nrms note that the physicochemical interactions with the remaining soluble cod components were included in all models section 2 2 1 2 2 4 reactor model the used reactor design and the default specifications and features for each unit process are compiled in appendix 4 for each unit process a mass balance was written not only for all components in the liquid phase s e g equation 5 but also for all components in the gas phase g all precipitated components p and all particulate biological solids x including both a transport term based on in and outgoing flow rates and a transformation term involving liquid gas gas liquid transfer liquid solid solid liquid transfer and biochemical transformations 5 d s l i q i v l i q d t m t 1 s l i q i n i q l i q i n s l i q i q l i q o u t v l i q j 1 n ρ j v i j where j 1 n ρ j v i j is the summation of the specific kinetic process rates for process j ρ j m l 3 t 1 multiplied by the stoichiometric coefficient for component i on process j v i j m m 1 q l i q i n and q l i q o u t are the in and outgoing liquid flow rates l 3 t 1 v l i q is the bulk reactor volume l 3 and s l i q i n i and s l i q i refer to the activities of the in and outgoing liquid components m l 3 in addition a mass balance for the seed material in the reactor was included similar as equation 5 the mass of seed material was adjusted in time according to the mass of precipitates present in the reactor and the liquid volume hence it was assumed that newly formed crystals act as seed material for precipitation similar as was experimentally discovered by le corre et al 2007 external seed material can also be added for the precipitation unit nrm prec also particle and agglomerate number balances were implemented the number of free precipitated particles was assumed to reduce according to the agglomerates formed as in crittenden et al 2012 note that agglomeration was only accounted for when mixing is present in the reactor section 2 2 2 2 3 step iii model implementation and numerical solution 2 3 1 model coding and state vector definition the main coding language used in this study was modelica which is a high level declarative and object oriented modelling language claeys et al 2006 elmqvist et al 1999 it is similar to the model specification language msl which is currently used in tornado west mikebydhi com vanhooren et al 2003 one of the most common software packages used in waste water quality modelling however modelica has a better readability and expressiveness and because of the more important industrial use audi ford siemens etc of modelica compared to msl the modelling community using tornado west recently decided to convert all conventional models for waste water treatment from msl to the more powerful and more widely supported modelica coding language tornado west supports the use of both msl and modelica languages claeys et al 2006 as mentioned above section 2 2 1 a phreeqc script was written for each unit process separately in order to include water chemistry a selected output statement involving the selected species activities saturation indices s i s partial pressures p s as well as the ph temperature alkalinity and ionic strength was defined the obtained s i s and p s are then used as driving forces for precipitation and gas transfer in the modelica code describing the slow transformation processes eqs 2 and 3 since only small differences exist between the selected components for the different nrms table 2 it was decided to define one generic component state vector for each different phase as such five different nrm component state vectors were enumerated appendix 5 table a5 1 1 components s1 the components in the liquid phase i e the main waste flow 2 components s2 the components in the h2so4 solution used in nrm scrub 3 components g the components in the gas phase 4 components p the components in the precipitated phase 5 components x the particulate biological solids the components s1 state vector was further split into a components s1 pc and a components s1 bio state vector in order to describe physicochemical transformations and biological cod transformations separately all state variable quantities involved in the physicochemical calculations components g components p components s1 pc were expressed on a molar base whereas the state variables only involved in biological transformations components x components s1 bio were expressed on a cod base moreover for each model separately a species state vector was enumerated referring to the phreeqc selected output which is different for each unit process parameters and equations for the slow physicochemical and biochemical transformations and mass balances for all total components were implemented in modelica using a multi matrix structure the tableau method matrix implementation of morel and herring 1993 was used as generic method for linking total soluble component activities to species activities and total precipitated component concentrations to precipitate concentrations in the nrms whereas the gujer 2008 matrix implementation was used to describe the biochemical reactions involved 2 3 2 numerical solution and model execution procedure to overcome problems related to the numerical solution of stiff systems see section 1 the slower reactions sections 2 2 2 2 2 4 and mass balances section 2 2 5 were represented by ordinary differential equations ode coded in modelica while the fast reactions section 2 2 1 were assumed to reach steady state instantaneously and were calculated algebraically by use of algebraic equations ae at each iteration step using the software tool phreeqc parkhurst and appelo 2013 in contrast to other wrrf modellers e g flores alsina et al 2016 hauduc et al 2015 mbamba et al 2016 takács et al 2006 that implemented their own water chemistry module the use of preeqc to solve water chemistry was brought forward in this study see section 2 vaneeckhaute et al 2017b phreeqc has a dedicated and proven solver newton raphson based for the complex set of implicit non linear equilibrium equations involved phreeqc was preferred over other geochemical models e g minteq wham and wateq4f because of its ease of integration with diverse scripting languages and other model libraries next to its more precise methodology for precipitation calculations charlton and parkhurst 2011 recently a c callable api application programming interface for the phreeqc engine has become available under the name iphreeqc it allows for easily coupling of the phreeqc engine to software developed in other programming languages the api provides direct access to the geochemical processes in the phreeqc library as well as support for new phreeqc specification keywords that allow for easier manipulation of phreeqc input and output data charlton and parkhurst 2011 the models coded in the modelica language with invocations of the phreeqc engine for speciation calculation were then executed through the tornado west framework for modelling and virtual experimentation on the basis of sets of complex odes and aes a generic mechanism for calling phreeqc from modelica specified models using tornado was developed fig 4 it consists of a tornado specific phreeqc wrapper library containing only a predefined set of methods to be used in tornado west as well as a reduced phreeqc database and a phreeqc script with selected outputs section 2 2 1 any phreeqc code can now be run using input data supplied by tornado west and providing output data to be used by tornado west in a flexible manner without the need for any case specific c c code modifications by the user as a result the combined kinetic equilibrium models can now be used for simulation and other tasks such as parameter estimation optimization scenario analysis monte carlo simulation sensitivity analysis and steady state analysis through the tornado cui command line user interface tool the user friendly tornado experimenter gui graphical user interface or west fig 4 finally for numerical solution in tornado two different solvers rk4asc runge kutta 4 adaptive step size control integration algorithm press et al 1992 and vode variable coefficient ordinary differential equation solver brown et al 1989 were compared the rk4asc algorithm was retained since simulation times were much faster and results more stable this is likely related to its higher ability to solve models with certain discontinuities i e sharp switches in behaviour e g transitions in precipitation mechanisms as function of the saturation index and dynamic inputs disturbances claeys 2008 2 3 3 phreeqc tornado interface in order to connect state vectors used by phreeqc c code and tornado modelica code a phreeqc tornado interface was developed fig 5 the interface makes special use of the data defined by the selected output data blocks section 2 3 1 and allows this array of data to be returned to tornado without the necessity to read or write files hence the data can be transferred between phreeqc and tornado through internal computer memory this method of tight model coupling has significant merits with respect to calculation time and programming a phreeqc instance is only created once and is subsequently reused preserving its internal state in general an order of magnitude decrease in run times is obtained compared to a loosely coupled model which requires starting phreeqc as an external process for each time step müller et al 2011 on top of that comes the gain in simulation time by using the developed reduced phreeqc databases and scripts instead of full phreeqc section 2 2 1 hence a reduction of execution time is obtained at two critical points during model simulations i the uploading and reading of database and input files and ii the transfer of data between phreeqc and tornado 2 3 4 model verification and debugging after implementation the models were subjected to a battery of tests to ensure implementation correctness also referred to as model verification dochain and vanrolleghem 2001 a generic six step procedure for model verification of nrms was developed and applied to each unit process separately 1 verification of the phreeqc tornado interface comparison of speciation calculations in tornado through tight coupling to reduced phreeqc with simulation results from the independent full phreeqc engine 2 verification of the physicochemical transformation model implementation of slow physicochemical transformations in modelica code execution in tornado and mass balance check 3 verification of the biochemical transformation model implementation of slow biochemical reactions in modelica code execution in tornado and i mass balance check ii check against independent implementations e g adm1 batstone et al 2002 and the lizarralde et al 2010 model for anaerobic s degradation 4 verification validation at steady state performance of steady state simulations using different initial values from literature and comparison with experimental literature results 5 verification validation of dynamics performance of dynamic simulations using realistic databases and checking the effect of disturbances e g different loading scenarios on model outputs through comparison with prior knowledge and literature 6 verification of the generic nrm implementation comparison of simulation results obtained with two different independent implementations of each unit process model one based on all separate individual equations and one compact implementation based on vectors and matrices as such typing errors inconsistencies gaps and conceptual errors were eliminated while software bugs were discovered and dealt with 2 4 step iv dataset collection and identification of data needs one of the issues in the development of new models is the necessity to provide data for the estimation of model parameters and for the input variables the different types of data required for each key nrm and the datasets that were used are provided in appendix 6 table a6 1 first a thorough review of literature and existing models was conducted to provide default values for the different parameters involved appendix 6 table a6 2 a6 5 physicochemical stoichiometry and thermodynamic parameters are incorporated in the phreeqc and visual minteq modelling software where they are mainly taken from the national institute of standards and technology nist 2001 database default values for the kinetic precipitation coefficients were taken from literature while default values for biomass kinetic coefficients were taken from the adm1 model batstone et al 2002 except for the srb kinetics for which the parameters were taken from knobel and lewis 2002 and lizarralde et al 2010 next to literature studies also new experimental data aiming at nrm validation were collected through lab pilot scale testing and contact with industry for nrm ad full scale data at steady state from an anaerobic reactor treating s rich paper mill primary sludge located at the wrrf holmen paper madrid spain has been obtained from the center of studies and technical research ceit san sebastian spain appendix 6 table a6 6 an input fractionation was conducted following the procedure proposed by grau et al 2007 for validation of the nrm prec lab tests were conducted for p recovery from digestate under different operating conditions i e different mg p ratios and contact time notably for this purpose two different digestates were sampled at the full scale biogas plants of sap eneco energy houthulst belgium and wittevrongel eneco energy aalter belgium which both treat agricultural wastes mainly manure a detailed input characterization was performed prior to the experiment appendix 6 table a6 7 the precipitate was separated from the effluent by means of a centrifuge 5 min at 2000 rpm heraeus megafuge 1 0 kendro laboratory products hanau germany after which both fractions were also physicochemically analyzed the p recovery efficiency was then calculated using the p recovery of a control no mg addition as a reference for detailed methodology and experimental results reference is made to de corte 2012 to obtain data for the nrm strip nrm scrub a technical and financial survey for a case treating 2000 m3 d 1 of digestate at 200 mol nh4 n m 3 more details appendix 6 table a6 8 was carried out with various key suppliers in the field as such insights in the variability of the processes available to date were obtained e g different target ammonium sulfate concentrations operational ph and temperature consumables among other these detailed data provided by the suppliers were used for further model refining and validation finally it should be stated that during model development new data needs appeared for which to date literature references are lacking such data gaps were identified and recommendations for future experiments and data collection are provided further in this paper section 3 5 2 5 step v model validation model validation was performed in four different ways i validation against prior knowledge ii validation against existing models iii validation against literature or technical inquiries and iv validation against collected experimental results in all cases the default stoichiometric and kinetic parameter values determined in section 2 4 were used input waste stream compositions design data and operational conditions were taken from the dataset involved during the validation procedure attention was given to the reduced phreeqc database used in order to assure that all required species and reactions are included in the calculations if required an additional evaluation was conducted using the full phreeqc and or minteq database and missing species reactions were additionally added to the reduced database 2 6 step vi scenario analyses and process optimization to gain more insight into the results and to further explore the model outcomes scenario analyses were performed in tornado west claeys 2008 moreover the applicability of the models for process optimization was demonstrated by running optimization experiments in tornado west claeys 2008 3 results and discussion the implementation of the models developed in section 2 was verified and validated first simulation times for the reduced models are evaluated in section 3 1 general verification results and verification examples showing the correctness of the phreeqc tornado interface are presented in section 3 2 an example of model validation against experimental results including scenario analyses and or process optimization is given for each nrm in sections 3 3 3 5 finally recommendations for further research are provided in section 3 6 3 1 evaluation of reduced phreeqc simulation times a comparison of simulation times of the developed scripts for each unit process model using the full databases and the corresponding reduced database is presented in table 4 b a 3 to 5 fold average improvement of model simulation speeds was obtained using the reduced database as compared to full phreeqc dat and minteq v4 dat respectively the observed deviation in simulation times between phreeqc and minteq shows again the higher completeness of the minteq database note that the presented simulation times in table 4b concern the chemical speciation model only so without the coupling to the kinetic and mass balance model yet this model reduction is clearly relevant for simulation of wrrfs since the speciation model is run at every time step during nrm model simulations section 2 3 3 as such running a complete digestate treatment train under dynamic conditions for one year would take approximately 15 min depending on the operating conditions and input characterization using the reduced phreeqc model whereas it would take 45 min using the full phreeqc model both with tight model coupling section 2 3 3 to the kinetic model as mentioned above it is important for model validation to keep in mind that a model reduction was performed as such for example it was discovered during initial validation of the nrm prec model that the species nah2po4 aq was lacking though essential for correct prediction of p recovery section 3 4 1 3 2 model verification 3 2 1 general results and issues during model verification various software bugs were discovered and communicated to dhi merelbeke belgium who successfully resolved the issues as such this research also contributed to the development of the tornado west software kernel each step in the verification procedure was completed successfully first the phreeqc tornado interface was found to be effective see section 3 2 2 next the mass balance check provided good results for each nrm the step by step comparison of the gujer matrix with other digester model implementations showed that the biochemical reactions were correctly implemented tests performed to check the ability of the models to realistically respond to model inputs both under steady state and dynamic conditions allowed eliminating small implementation errors some examples of tests and effects performed for model verification validation can be found in appendix 7 finally simulation results obtained from the two different independent implementations of the same model for each unit process i e one using individual equations and one using a multi matrix structure were identical during model verification three important general issues were observed to which future wrrf model developers must pay attention first it was found that some components species and precipitates that are highly important for modelling of wrrfs are not yet included in the generic phreeqc and or minteq databases section 2 2 1 table 3 hence for each new nutrient recovery model the chemical speciation calculation should be verified with multiple software packages with literature and with prior knowledge in order to comprehensively select which components species and precipitates should be included in the model and which ones can be excluded secondly if an input to phreeqc is set to 0 or if a species is not defined or not present in the calculation then a value of 999 999 is printed as output for this component s species distribution and the corresponding saturation indices and partial pressures in the modelica code these outputs are then used as driving forces for slow transformations leading to incorrect calculations this issue was solved by introduction of an if then else statement in the phreeqc tornado interface finally attention should be paid to the use of units for input and output variables input concentrations in phreeqc are expressed by default as mole m 3 whereas the outputs are given by default as kmole m 3 deviations from these standard units should be declared in the phreeqc script 3 2 2 verification of phreeqc tornado interface when comparing simulation results using the stand alone full phreeqc engine and tornado with tight coupling to reduced phreeqc identical model outputs were obtained for all nrms as an example the results for the nrm scrub are given in table 5 an initial gas phase flow with high nh3 load coming from the nrm strip was used as input to the nrm scrub and brought into contact with a sulfuric acid solution for nh3 absorption the outputs i e the logarithm of the partial pressures log p atm in the purified gas phase and the activities mole m 3 of some species in the ammonium sulfate solution after gas liquid exchange obtained with both the stand alone phreeqc engine and tornado phreeqc are presented it can be concluded that the implementation of the phreeqc tornado interface and the phreeqc invocation in modelica are correct 3 3 nrm ad validation 3 3 1 case study anaerobic reactor at holmen paper madrid spain the nrm ad model was validated using experimental data collected under steady state conditions from an anaerobic digester for treatment of s rich paper mill primary sludge at a full scale wrrf holmen paper madrid spain the same case was previously used for validation of the lizarralde et al 2010 model for anaerobic s reduction the input sludge characteristics design parameters initial reactor state variables and operating conditions are given in appendix 6 table a6 6 kinetic and stoichiometric parameters were set at default section 2 4 a comparison of experimental and simulation results using the nrm ad and the model proposed by lizarralde et al 2010 is given in table 6 simulation results using the nrm ad show good agreement with the experimental results for cod removal and biogas ch4 and co2 composition at a particular ph the model also seems to give a very good prediction of the digestate ph and p content and a relatively good prediction for nh4 n in the digestate the slightly higher digestate nutrient value for nh4 n obtained with the nrm ad may be attributed to losses of nh3 during digestate sampling and analysis although potential model deficiencies may not be excluded the nrm ad seems to underpredict the biological so4 removal and corresponding h2s production by srbs as will be explored below however from a pure validation perspective note no parameters were calibrated when comparing with the lizarralde et al 2010 model overall the performance of the nrm ad is significantly better very probably due to the underlying more detailed chemical speciation and the inclusion of multiple competing physicochemical transformation reactions 3 3 2 exploration of hypotheses regarding s cycle measurements through model scenario analyses four potential hypotheses were tested to explore the underestimation of biological so4 removal in the above case study first it was observed that the biogas h2s concentration was very sensitive to variations in ph cfr al zuhair et al 2008 model simulations were carried out at the digestate ph 7 21 however the input ph was significantly lower 6 66 and the digestate ph may be influenced through contact with air hence there exists some uncertainty about the actual reactor ph to explore this hypothesis a scenario analysis was conducted in order to evaluate the effect of ph variable on the ch4 co2 and h2s in the biogas at fixed waste input cod so4 ratio assuming that the ph in the reactor ranged from 6 66 waste input ph to 7 21 digestate ph the biogas composition varied from 61 ch4 34 co2 2 94 h2s to 80 ch4 16 co2 1 90 h2s hence with the present implementation it was not possible to obtain 6 h2s in the biogas at a ph in that range it should be remarked that the experimentally obtained biogas h2s content of 6 is extremely high compared to literature values typical biogas h2s values for similar concentrated sulfurous streams from the paper industry range between 1 and 2 h2s reiter and piccot 2004 hence a second reason for the uncertainty may be related to the h2s analysis itself conducted by the operators a third explanation may be the exclusion of lactate in the present nrm ad implementation lactate is a preferred substrate for sulfate reducing bacteria and would thus aid in increasing so4 removal and h2s production oyekola et al 2007 this may explain the slight overestimation of biogas co2 production and underestimation of h2s production in the present case no lactate measurements were available but future research should consider this component furthermore the non consideration of reactions precipitation ion pairing with al and fe due to lack of input al fe measurements at the wrrf may explain the lower so4 removal found through simulation cfr zhang et al 2013 this can also explain why model predictions for cod removal and ch4 production were good while additional cod would be required for additional so4 removal by srbs based on a similar reasoning lizarralde et al 2010 assigned potential sulfate precipitation which was not considered in their model to the highly overestimated h2s production found with their model an attempt to calibrate input al in the present case study showed that a reactor concentration of 276 mol al m 3 resulted in a so4 removal of 78 experimental value in table 6 and a biogas h2s concentration of 3 however in this scenario the ph lowered to a value of 6 26 the higher so4 removal found through addition of al was likely the result of a combination of multiple effects it was for example observed that the addition of al affected the amount of ca mg sulfates and ca mg precipitates formed the addition of fe resulted in a lower h2s production because of fes precipitation but it did not aid in so4 removal finally other model gaps can of course not be ruled out and one should bear in mind that the above validation is based on a one time test it can be concluded that more detailed waste water input characterizations including all selected components for the nrm ad unit process section 2 2 1 table 2 as well as instantaneous ph measurements in the reactor are required in order to correctly calibrate the model for biological s removal nevertheless clearly exploration using the nrm ad leads to increased insights and better understanding of the various interacting processes occurring in digesters 3 4 nrm prec validation 3 4 1 phosphorus precipitation at different mg p ratios for validation of the nrm prec model batch experiments were carried out in the lab for p recovery from two different crude digestates section 2 4 appendix 6 table a6 7 different mg p ratios obtained through dosing of mgcl2 6h2o were applied aiming at the production of n struvite mgnh4po4 6h2o or map or k struvite mgkpo4 6h2o or mkp fertilizer initial simulation results showed a large deviation from the experimental results table 7 after evaluation using the full phreeqc and minteq databases this deviation could be attributed to ion pair formation of nah2po4 a species that was initially not included in the reduced phreeqc database nor in the generic phreeqc database table 3 indeed due to the high na concentration of both digestates na paired with p making it less available for precipitation when nah2po4 was added as species to the reduced database a very good agreement between the simulation and the experimental results was obtained for p recovery at steady state after 12 h table 7 this finding is in line with the results obtained by li et al 2012 who found a five times higher residual effluent p concentration when nah2po4 mgcl2 6h2o were dosed for struvite precipitation compared to the dosing of h3po4 mgcl2 6h2o moreover recently chauhan and joshi 2014 found that at high na nh4 ratios nah2po4 is formed instead of or next to nh4h2po4 the precursor for map precipitation in turn this compound may be transformed into na struvite through the following reaction nah2po4 2h2o mg ch3coo 2 4h2o h2o namgpo4 7h2o 2ch3cooh the formation of na struvite was not yet included in the nrm prec model due to lack of knowledge on the existence the stoichiometry and the kinetics of this precipitation reaction however knowing that current practice often involves the addition of naoh for ph increase prior to struvite crystallization the case study above clearly shows the relevance of further research on na p ion pair formation and na struvite precipitation kinetics in waste waters the phenomenon may not only impact the effluent quality but also the quality of the resulting recovered fertilizer product i e a potential mixture of n k and na struvite may appear 3 4 2 exploration for process understanding and optimization two questions arise from the experimental and simulation results presented above table 7 1 why is the p recovery efficiency rather low for both digestates 2 why does increasing the mg dose not improve the p recovery efficiency the ability of the models to find an answer to such questions is presented below first it was observed experimentally and through simulations that the main precipitated components next to p were al ca fe k mg and n iii hence the product recovered was definitely not pure map or mkp a scenario analysis evaluating these components was conducted for both digestates in order to obtain more insights in the results fig 6 the two tested digestate compositions under study are marked as stars in fig 6 the maximum achievable p recovery as function of the input mg and ca content was 56 2 for digestate 1 fig 6a whereas it amounted to 90 7 for digestate 2 fig 6b this discrepancy can be attributed to the higher concentration of fe and al in digestate 1 compared to digestate 2 appendix 6 table a6 7 indeed at high concentrations of both fe and al mainly hercynite feal2o4 precipitation occurs whereas at low concentrations p recovery increases through precipitation of alpo4 and vivianite fe3 po4 2 8h2o furthermore the inhibition of p precipitation due to the presence of soluble ca is very clear for both cases see details fig 6 up to 110 mol m 3 of input ca the margin in which the digestates under study are situated mainly ion pairing of cahpo4 aq and capo4 was observed which decreased the amount of p available for precipitation cfr lin 2012 above a value of 110 mol m 3 calcium phosphates became oversaturated precipitation occurred and p recovery increased this effect of ca inhibition observed through model simulations is in agreement with the experimental findings of huchzermeier and wendong 2012 the latter concluded that struvite purity decreased because of the formation of calcium phosphates when the ca p activity ratio was greater than 0 5 to 1 secondly the fact that the p recovery efficiency in the presented experiment was not much influenced by increasing mg p ratios can according to the model be attributed to the formation of dolomite camg co3 2 as well as mg oh 2 and mg2 co3 oh 2 3h2o at higher ca and mg concentrations indeed higher ca and mg doses are associated with a ph increase which favours carbonate and hydroxide precipitation zumdahl 2005 when the input ca concentration would be 0 one can see an increase in p recovery with increasing mg dose due to the formation of mkp note high k concentration in the input waste stream and mg phosphates this competitive effect between mg ca and p found through nrm prec simulations is in agreement with the findings of lin 2012 who obtained a precipitate mixture of struvite dolomite mg oh 2 calcium phosphates and caco3 in experiments on p recovery from digested swine manure based on the above mentioned findings two optimizations of the process can be proposed if the aim would be to produce high purity struvite 1 removal of caco3 through precipitation prior to the experiment e g using a filtration system as in huchzermeier and wendong 2012 2 elimination or reduction of the use of fe and al in the wrrf processes upstream of the precipitation unit e g for improved sludge dewatering this measure could also be assessed by locating the struvite precipitation unit upstream in the wrrf e g immediately after the activated sludge as system cfr combined use of the wasstrip and pearl process for improved p release and struvite recovery cullen et al 2013 in fact the as system itself could also partially be replaced by a strip scrub system when applying these proposed measures in a treatment train for digestate 1 the maximum achievable p recovery through simulation became 91 consisting of mkp mg oh 2 and mg3 po4 2 hence a pure mg p k fertilizer would be obtained fig 7 remark that the main precipitate found mkp is not included in the standard phreeqc minteq databases hence again the extensions provided to the database are clearly relevant section 2 2 1 it should also be noted that in fig 7 the mg dose was allowed to change within the range of 0 500 mol m 3 so no point measurements are presented hence the abrupt changes in slope are related to actual changes in precipitation mechanisms which could e g involve transitions from nucleation to particle growth and or agglomeration and or redissolution and changes in precipitated species due to changes in saturation indices moreover an interesting observation made through model simulations was that without any addition of mg a high p recovery efficiency of 72 could be obtained this could be appointed to the precipitation of k2nh4po4 6h2o pure n p k fertilizer due to the high amounts of k available in the digestate appendix 6 table a6 7 in this case an economic analysis is recommended to select a target fertilizer thereby taking into account local fertilizer market demands and environmental and fertilizer regulations on the one hand the use of chemical mg may increase the operational costs of p recovery while on the other hand a higher recovery efficiency can be obtained with larger mean particle diameter of the recovered precipitates mainly mkp as predicted with the nrm prec larger particles generally increase the revenues from fertilizer sales vaneeckhaute et al 2017a 3 5 nrm strip nrm scrub validation 3 5 1 nh3 recovery at different operating conditions during validation of the nrm strip and nrm scrub models nh3 stripping was found to be very sensitive to the total and relative input concentration of carbonates ca and na since these determine the input alkalinity and ph since operators usually only measure nh3 and ph sometimes total alkalinity an identifiability problem arises for example when using the design parameters and input flow characterization s n min3 ph of collivignarelli et al 1998 a good agreement was obtained between experimental and simulation results for nh3 recovery table 8 however due to lack of some fundamental input flow characteristics for ph calculation using the nrm strip model the input composition had to be calibrated in order to approximate the operational ph evidently there are multiple ion combinations possible to obtain the specified ph and the choice of the combination may influence the model outputs hence in order to effectively use the nrm strip nrm scrub models for process optimization the initial waste flow composition should be characterized in more detail than is usually done at wrrfs today irrespective thereof it can be seen in table 8 that the model responded correctly to disturbances operational decisions such as an increase in ph temperature and air flow rate cfr collivignarelli et al 1998 3 5 2 treatment train for nh3 recovery in order to overcome the above mentioned identifiability issue a technical survey was sent out to key suppliers of strip scrub units for the treatment of a particular digestate flow section 2 4 using the predefined input characteristics appendix 6 table a6 8 as well as the dimensions operating conditions effluent quality and stripping performance offered by the different suppliers the models were again validated for the different configurations received to this end first a treatment train consisting of nrm chem nrm strip and nrm scrub was built to reflect a full scale installation then model simulations using the design data were conducted and scenario analyses were performed in order to compare simulation results with the experimental data obtained from the suppliers the data of the supplier who provided the most detailed experimental results rvt process equipment gmbh are presented below as an example an nh3 recovery efficiency of 90 at 55 c was guaranteed by the supplier when increasing the ph to a value of 10 3 by addition of 102 5 mol m 3 naoh d 1 under the design conditions provided in appendix 6 table a6 8 the same results were obtained through treatment train simulation table 9 finally technology providers also advised to remove excess input carbonate buffer capacity prior to treatment e g through co2 stripping in order to minimize naoh consumption for ph increase as well as caco3 precipitation in the reactor pérez 2002 this recommendation could be confirmed using the nrm strip model fig 8 shows the decreasing nh3 recovery efficiency as function of carbonate buffer capacity if the naoh consumption and other operating conditions would not be adjusted hence the more carbonate is stripped off the higher the reactor ph and the higher the nh3 recovery efficiency note that based on this principle some technology suppliers provide an integrated co2 and nh3 stripping process without using naoh for ph increase vaneeckhaute et al 2017a 3 6 recommendations for further experimental research the results show that the performance of all resource recovery systems under study is very sensitive to the input waste stream composition e g through its direct effect on the ph therefore in order to obtain good model predictions for a particular waste flow the input flow should be characterized in more detail than is usually done at wrrfs today this observation is similar to activated sludge modelling in which influent characterization is considered as the most important step for achieving accurate results rieger et al 2012 it is clear that a better characterization of the input composition may help to adjust the use of consumables e g chemical dose and air requirements to a minimum thereby reducing the operational costs as such the models can be used as an invaluable tool for process optimization new experimental results including detailed input characterizations are currently being collected at pilot full scale under dynamic conditions in order to further calibrate and validate the proposed nrms a second issue observed is that values for the precipitation kinetics k t and gas transfer coefficients k l g a used from literature are commonly determined under ideal conditions i e gas transfer in clean water and precipitation in a synthetic solution containing only the target species involved in the reaction e g mg nh4 and p for struvite precipitation however the actual value of these parameters may be highly influenced by the complex matrix of the waste streams involved e g through ion pairing section 3 4 1 concurrent and competing precipitation reactions section 3 4 2 and the presence of seed material studies evaluating kinetic rates under actual process conditions are lacking in literature but should be focus of further research in order to correctly calibrate these parameters in the nrms moreover rates and mechanisms for nucleation agglomeration and dissolution of various precipitates are still unknown and should be further studied in this perspective the use of the simple empirical equation eq 3 for liquid solid solid liquid transfer in the nrms is interesting compared to previously used approaches in wastewater treatment e g hauduc et al 2015 lizarralde et al 2015 musvoto et al 2000 another important complication is related to the characterization of the precipitates formed x ray diffraction is the commonly used technique to characterize precipitates in pure solutions however it generally requires pure crystals of high regularity to solve the structure of a complicated arrangement of atoms also the results usually represent a very local microstructure and it requires a lot of work to obtain a certain statistical reliability on the results tanigawa et al 2003 more research is required on the development of a generic and cost effective experimental method to accurately characterize the different precipitated species from a complex waste matrix such a procedure may not only be used to determine the precipitated species in precipitation units and hence the recovered product purity vanrolleghem and vaneeckhaute 2014 but also for example the precipitates in the digestate leaving the digester the latter is relevant as these precipitates may act as seed material for precipitation downstream finally interesting model extensions have been identified they lead to the inclusion of i lactate as specific substrate for biological sulfate removal in the nrm ad e g as in uct 2007 ii a transformer tool in the nrm ad to allow for co digestion of multiple input streams e g the giscod tool zaher et al 2009 iii biochemical transformations of ebpr sludge in the nrm ad e g as in flores alsina et al 2016 ikumi 2011 or wang et al 2016 iv microscale flocculation in the nrm prec e g as in crittenden et al 2012 v particle size distributions in the nrm prec e g as in perez et al 2008 vi differential settling in the nrm settle and if relevant in the nrm prec e g using the stokes equation crittenden et al 2012 or a particle settling velocity distribution bachis et al 2015 vii heavy metals and other contaminants in all nrm models these extensions will of course lead to further experimental data requirements 4 conclusions and future perspectives the first available generic nutrient recovery model nrm library including dynamic mathematical models based on both detailed chemical solution speciation calculations as well as physicochemical and biochemical reaction kinetics was developed through phreeqc tornado west coupling and successfully validated at steady state implementation correctness was verified under steady state and dynamic conditions using a 6 step procedure including e g a comparison of the simulation outputs of two independent model implementations for each unit process one based on individual equations and one compact matrix based implementation using a systematic procedure for phreeqc database reduction a 3 to 5 fold improvement of model simulation speed was obtained as compared to the use of standard thermodynamic databases on top of the improvement obtained through tight model coupling because of gaps in existing standard thermodynamic databases an extended database with the purpose of nutrient recovery was made available named nutricover dat detailed input characterization was found to be most critical for accurate prediction of resource recovery process performance simulation results showed the high potential of the nrm library to increase understanding of nutrient recovery process interactions and to optimize integrated nutrient and energy recovery systems the use of the nrm library by the various stakeholders in the field to facilitate the implementation operation and optimization of nutrient recovery technologies can stimulate the transition from wwtps to more sustainable wrrfs acknowledgements this work has been funded by the natural science and engineering research council of canada nserc the fonds de recherche de québec sur la nature et les technologies frqnt and primodal inc québec qc canada through an industrial innovation scholarship bmp innovation 178263 and an nserc discovery grant rgpin 2017 04838 awarded to the first author peter vanrolleghem holds the canada research chair in water quality modelling the authors would like to thank lizarralde izaro ceit spain for experimental data delivery appendix 1 physicochemical species and reactions included in the nutrient recovery models nrm table a1 1 dissolved species included in each nutrient recovery model nrm 1 nrm ad anaerobic digestion 2 nrm prec precipitation crystallization 3 nrm strip stripper 4 nrm scrub scrubber resulting from speciation calculations using phreeqc and visual minteq modelling software table a1 1 species 1 2 3 4 species 1 2 3 4 species 1 2 3 4 species 1 2 3 4 acetate x x x dom x x hso4 x nacl aq x x x al3 x x x fe2 x x x h valerate x x x naco3 x x al oh 2 x x fe3 x x x k x x x nahco3 aq x x al oh 3 aq x x fecl x k acetate aq x x x nahpo4 x x x al oh 4 x x x feco3 x kcl aq x x x nah2po4 aq x x butyrate aq x x x fehpo4 aq x x khpo4 x x x nano3 aq x x ca2 x x x fehs x kh2po4 x x naoh x x ca acetate x x x fe hs 2 x kno3 aq x x napo4 2 x ca butyrate aq x x x feh2po4 x koh aq x x naso4 x x x cacl x x x fenh3 2 x x x kpo4 2 x n2 aq a x x x x caco3 aq x x x fe nh3 2 2 x x x kso4 x x x nh2coo x x ca dom x x fe nh3 3 2 x mg2 x x x nh3 aq x x x x cahco3 x x feoh x x x mg acetate x x x nh4 x x x x cahpo4 aq x x x fe oh 2 aq x x x mg butyrate x x x nh4so4 x x x x cah2po4 x fe oh 3 x x mgcl x x x no3 x x x x canh3 2 x x x feso4 aq x mgco3 aq x x x oh x x x x ca nh3 2 2 x h x x x x mg2co3 2 x x o2 aq x x x cano3 x h2 aq x x x mg dom x x po4 3 x x x caoh x h acetate x x x mghco3 x x x propionate x x x capo4 x x x h butyrate x x x mghpo4 aq x x x so4 2 x x x x ca propionate x x x h dom x x mg nh3 2 2 x x x valerate x x x caso4 aq x x x hco3 x x x x mgoh x x x ca valerate aq x x x hpo4 2 x x x mgpo4 x x x ch4 x x x x h2po4 x x mg propionate x x x cl x x x hs x x x mgso4 aq x x x co2 x x x x h2s aq x x x na x x x co3 2 x x x x h propionate x x x na acetate aq x x x a values between brackets represent the use of air instead of chemicals for ph adjustment table a1 2 acid base systems and reactions ab included in each nutrient recovery model nrm ad anaerobic digestion prec precipitation crystallization strip stripper scrub scrubber ac acetate bu butyrate pro propionate va valerate table a1 2 acid base system no acid base reaction ad prec strip scrub acetate ab1 ac h hac x x x ammonia ab2 nh3 aq h nh4 x x x x butyrate ab3 bu h hbu x x x carbonate ab4 co3 2 h hco3 x x x x ab5 hco3 h h2co3 aq x x x x phosphate ab6 po4 3 h hpo4 2 x x x ab7 hpo4 2 h h2po4 x x ab8 h2po4 h h3po4 x x propionate ab9 pro h hpro x x x sulfate ab10 so4 2 h hso4 x sulfide ab11 hs h h2s x x x valerate ab12 va h hva x x x water ab13 h oh h2o x x x x table a1 3 redox couples and reactions r included in each nutrient recovery model nrm ad ad anaerobic digestion prec precipitation crystallization strip stripper scrub scrubber ac acetate bu butyrate pro propionate va valerate table a1 3 redox system no redox reaction ad prec strip scrub c iv c iv r1 co3 2 10h 8e ch4 3h2o x x x x fe ii fe iii r2 fe3 e fe2 x x x h 0 h i r3 2h 2e h2 x x x n iii n v r4 no3 10h 8e nh4 3h2o x x x x n 0 n v r5 2no3 12h 10e n2 6h2o x x a x x o ii o 0 r6 o2 4h 4e 2h2o x x x s ii s vi r7 so4 2 9h 8e hs 4h2o x x x a values between brackets represent the use of air instead of chemicals for ph adjustment table a1 4 ion pairing reactions ip included in each nutrient recovery model nrm ad anaerobic digestion prec precipitation crystallization strip stripper scrub scrubber table a1 4 no ion pairing reaction ad prec strip scrub no ion pairing reaction ad prec strip scrub ip1 al3 2oh al oh 2 x ip34 k cl kcl x x x ip2 al3 3oh al oh 3 x x ip35 k hpo4 2 khpo4 x x x ip3 al3 4oh al oh 4 x x x ip36 k no3 kno3 x x ip4 ca2 ac caac x x x ip37 k oh koh x x ip5 ca2 bu cabu x x x ip38 k po4 3 kpo4 2 x ip6 ca2 cl cacl x x x ip39 k h2po4 kh2po4 x x ip7 ca2 co3 2 caco3 x x x ip40 k so4 2 kso4 x x x ip8 ca2 dom ca dom x x ip41 mg2 ac mgac x x x ip9 ca2 hco3 cahco3 x x ip42 mg2 bu mgbu x x x ip10 ca2 hpo4 2 cahpo4 x x x ip43 mg2 cl mgcl x x x ip11 ca2 h2po4 cah2po4 x ip44 mg2 co3 2 mgco3 x x x ip12 ca2 nh3 canh3 2 x x x ip45 2mg2 co3 2 mg2co3 2 x x ip13 ca2 2nh3 ca nh3 2 2 x ip46 mg2 dom mg dom x x ip14 ca2 no3 cano3 x ip47 mg2 hco3 mghco3 x x x ip15 ca2 oh caoh x ip48 mg2 hpo4 2 mghpo4 x x x ip16 ca2 po4 3 capo4 x x x ip49 mg2 2nh3 mg nh3 2 2 x x x ip17 ca2 pro capro x x x ip50 mg2 oh mgoh x x x ip18 ca2 so4 2 caso4 x x x ip51 mg2 po4 3 mgpo4 x x x ip19 ca2 va cava x x x ip52 mg2 pro mgpro x x x ip20 fe2 cl fecl x ip53 mg2 so4 2 mgso4 x x x ip21 fe2 co3 2 feco3 x ip54 na ac naac x x x ip22 fe2 hpo4 2 fehpo4 x x ip55 na cl nacl x x x ip23 fe2 hs fehs x ip56 na co3 2 naco3 x x ip24 fe2 2hs fe hs 2 x ip57 na hco3 nahco3 x x ip25 fe2 h2po4 feh2po4 x ip58 na hpo4 2 nahpo4 x x x ip26 fe2 nh3 fenh3 2 x x x ip59 na h2po4 nah2po4 aq x x ip27 fe2 2nh3 fe nh3 2 2 x x x ip60 na no3 nano3 x x ip28 fe2 3nh3 fe nh3 3 2 x ip61 na oh naoh x x ip29 fe2 oh feoh x x x ip62 na po4 3 napo4 2 x ip30 fe2 2oh fe oh 2 x x x ip63 na so4 2 naso4 x x x ip31 fe3 3oh fe oh 3 x x ip64 nh3 hco3 nh2coo h2o x x ip32 fe2 so4 2 feso4 aq x ip65 nh4 so4 2 nh4so4 x x x x ip33 k ac kac x x x table a1 5 liquid solid solid liquid transfer reactions p included in each nutrient recovery model nrm ad anaerobic digestion prec precipitation crystallization p precipitation strip stripper scrub scrubber table a1 5 no phreeqcphase name liquid solid solid liquid transfer reaction ad prec strip scrub p1 al2o3 s al2o3 s 6h 2al3 3h2o x p2 alpo4 alpo4 al3 po4 3 x x p3 ammoniumsulfate nh4 2so4 2nh4 so4 2 x p4 anhydrite caso4 ca2 so4 2 x p5 aragonite caco3 ca2 co3 2 x x x p6 artinite mgco3 mg oh 2 3h2o 2h 2mg2 co3 2 5h2o x x p7 boehmite alooh 3h al3 2h2o x x p8 brucite mg oh 2 2h mg2 2h2o x x p9 cahpo4 s cahpo4 ca2 h po4 3 x x x p10 cahpo4 2h2o s cahpo4 2h2o ca2 h po4 3 2h2o x x x p11 ca4h po4 3 3h2o s ca4h po4 3 3h2o 4ca2 h 3po4 3 3h2o x x x p12 calcite caco3 ca2 co3 2 x x x p13 ca3 po4 2 am1 ca3 po4 2 3ca2 2po4 3 x x x p14 ca3 po4 2 am2 ca3 po4 2 3ca2 2po4 3 x x x p15 ca3 po4 2 beta ca3 po4 2 3ca2 2po4 3 x x x p16 diaspore alooh 3h al3 2h2o x x x p17 dolomite ordered camg co3 2 ca2 mg2 2co3 2 x x x p18 dolomite disordered camg co3 2 ca2 mg2 2co3 2 x x x p19 fe oh 2 am fe oh 2 2h fe2 2h2o x x p20 fes ppt fes h fe2 hs x p21 gibbsite al oh 3 3h al3 3h2o x x p22 hercynite feal2o4 8h fe2 2al3 4h2o x x x p23 huntite camg3 co3 4 3mg2 ca2 4co3 2 x p24 hydromagnesite mg5 co3 4 oh 2 4h2o 2h 5mg2 4co3 2 6h2o x p25 hydroxyapatite ca10 po4 6 oh 5 5h 10ca2 6po4 3 5h2o x x x p26 k struvite mgkpo4 6h2o mg2 k po4 3 6h2o x x x p27 mackinawite fes h fe2 hs x p28 magnesite mgco3 mg2 co3 2 x x x p29 mg oh 2 active mg oh 2 2h mg2 2h2o x x p30 mg3 po4 2 s mg3 po4 2 3mg2 2po4 3 x x x p31 newberyite mghpo4 3h2o mg2 h po4 3 3h2o x x x p32 periclase mgo 2h mg2 h2o x p33 portlandite ca oh 2 2h ca2 2h2o x p34 siderite feco3 fe2 co3 2 x x x p35 spinel mgal2o4 8h mg2 2al3 4h2o x p36 struvite mgnh4po4 6h2o mg2 nh4 po4 3 x x x p37 vaterite caco3 ca2 co3 2 x x p38 vivianite fe3 po4 2 8h2o 3fe2 2po4 3 8h2o x x x table a1 6 gas liquid liquid gas exchange reactions gl included in each nutrient recovery model nrm ad anaerobic digestion prec precipitation crystallization strip stripper scrub scrubber table a1 6 no gas liquid liquid gas exchange reaction ad prec strip scrub gl1 ch4 aq ch4 g x gl2 co2 aq co2 g x x a x x gl3 h2 aq h2 g x x x gl4 h2o aq h2o g x x a x x gl5 h2s aq h2s g x x x gl6 n2 aq n2 g x x a x x gl7 nh3 aq nh3 g x x a x x gl8 o2 aq o2 g x a x x a values between brackets represent the use of air instead of chemicals for ph adjustment appendix 2 detailed description of mass transfer scenarios for a liquid gas gas liquid transfer and b liquid solid solid liquid transfer a liquid gas gas liquid transfer if the resistance to mass transfer is on the liquid side the overall liquid mass transfer coefficient k l i can be perfectly adequate while the overall gaseous mass transfer coefficient k g i provides a good estimation if the resistance is on the gas side the relationship between the two coefficients can be represented by equation a1 chapra 2008 tchobanoglous et al 2003 a1 1 k l i h t i r t k g i in which r is the universal gas law constant 0 082 l atm mol 1 k 1 and t the temperature k it should be noted that the above mentionned overall mass transfer coefficients are actually derived from the individual mass transfer coefficients by equation a2 combined with eq a1 for k g i a2 1 k l i 1 k l i h t i r t k g i in which k l i and k g i are the individual mass transfer coefficients that depend on the conditions at the interface and the bulk of the liquid and gas phase respectively chapra 2008 tchobanoglous et al 2003 nevertheless since the concentrations at the interface are difficult to measure the overall mass transfer coefficient is generally used for practical purposes as such four potential mass transfer scenarios were considered 1 active liquid gas gas liquid transfer nrm strip nrm scrub of low to moderately soluble gases in this case the penetration theory of higbie 1935 was used to calculate the liquid mass transfer coefficient k l a t 1 it states that diffusion is a non steady state process and that the molecules of the solute are in constant random motion clusters of these molecules arrive at the interface remain there for a fixed period of time and some of them penetrate while the rest mixes back into the bulk of the phase the transfer velocity was then formulated in terms of the average contact time of a gas bubble at the interface eq a3 chapra 2008 gujer 2008 a3 k l g a k l a t 1 4 d l u π d θ g a s 6 q g a s i n d v l i q in which d is the average gas bubble diameter default 3 mm gujer 2008 u is the rise velocity of the gas bubbles default 0 3 m s 1 gujer 2008 θ g a s v g a s q g a s is the mean residence time of a gas bubble in the reactor t v g a s is the volume of all bubbles in the reactor or the total gas volume l 3 and d l is the liquid phase diffusion coefficient l 2 t 1 the latter was calculated at 298 k using the equation proposed by schwarzenbach et al 1993 eq a4 based on the component s molecular weight m w g mol 1 a4 d l l 2 t 1 2 7 10 4 m w 0 71 the obtained d l values using equation a4 showed good equivalence with d l values found in literature for wastewater systems chapra 2008 gujer 2008 tchobanoglous et al 2003 2 active liquid gas gas liquid transfer nrm strip nrm scrub of very soluble gases in this case equation a3 was again applied but now the gaseous phase diffusion coefficient d g was used arogo et al 1999 3 passive liquid gas gas liquid transfer nrm ad of low to moderately soluble gases in this case the mass transfer rate needs to be calibrated based on experimental results e g as in tourlousse and ahmad 2007 because the rise velocity of gas bubbles is usually not measurable or very difficult to measure for convenience the k l a is usually calculated from the k l a of oxygen gas o2 as a reference compound since the latter is easy to deduce from experimental data and rate constants for volatile solutes can be assumed proportional to each other chapra 2008 ikumi 2011 mackay and yeun 1983 munz and roberts 1989 musvoto et al 2000 however the use of o2 as a reference compound as selected by musvoto et al 2000 is quite odd for anaerobic digestion because normally no o2 is present in such reactors therefore in the nrm ad model h2 was used as volatile reference compound occurring in digesters similar as in pauss et al 1990 eq a5 a5 k l g a k l a t 1 k l h 2 a d l d l h 2 0 5 4 passive liquid gas gas liquid transfer nrm ad of very soluble gases in this case the mass transfer rate should be determined independently of the low to moderately soluble gases above sotemann et al 2005 if no experimental data are available the k g a value for nh3 in anaerobic digestion is usually set to a very low value ranging from 1 92 to 3 2 d 1 default in nrm ad 3 2 d 1 ikumi 2011 musvoto et al 2000 sotemann et al 2005 this is to ensure an extremely low loss from the liquid phase through stripping however as the transfer rate depends much on design operating conditions and characteristics of the waste flow to be treated it is advised to determine the k g n h 3 a under actual environmental conditions as e g in arogo et al 1999 this is especially important for the stripper and scrubber unit processes b liquid solid solid liquid transfer 1 supersaturation occurs s 1 s i 0 and seed material is available in this case the crystallization of sparingly soluble salts in wrrfs is mainly controlled by surface spiral growth this means that the integration of the cations into crystal lattice positions at kinks in the surface is the rate determining molecular mechanism galbraith et al 2014 hauduc et al 2015 koutsoukos et al 1980 musvoto et al 2000 nielsen 1984 the kinetic precipitation coefficient eq a6 was then assumed to be proportional to the available seed material cfr koutsoukos et al 1980 parkhurst and appelo 2013 a6 k t m l 3 t 1 k g t a s e e d m s e e d v l i q in which k g t is the temperature dependent growth rate coefficient m l 2 t 1 a s e e d is the specific area of surface per gram of seed material before the seed crystals start to grow in the crystallizing solution l 2 m 1 default 600 m2 g 1 parkhurst and appelo 2013 and m s e e d is the time dependent mass of seed material in the reactor m default initial mass 0 0005 kg parkhurst and appelo 2013 the latter is calculated at every time step by means of mass balances on the seed material for each precipitate section 2 2 4 taking in account the mass of newly formed precipitates and redissolution the default reaction order for surface controlled growth n g was set at 2 which generally provides a good approximation to represent precipitation in wrrfs bouropoulos and koutsoukos 2000 mehta and batstone 2013 musvoto et al 2000 nielsen 1984 2 supersaturation occurs s 1 s i 0 but no seed material is available and or the crystal size is not large enough to have any influence on the process i e the induction time is not exceeded in this case primary nucleation occurs which was often not accounted for in previous studies harrison et al 2011 nielsen 1984 schneider et al 2013 though very relevant bhuiyan et al 2008 the value of k t and n in equation 3 are then switched to the nucleation rate k b t default 106 nuclei l 1 t 1 mehta and batstone 2013 and the nucleation reaction order n b the latter is usually higher for nucleation than for growth 3 4 default 3 tavare 1995 the induction time is inversely proportional to the logarithm of s and should be estimated experimentally for each precipitate bhuiyan et al 2008 mehta and batstone 2013 3 the solution is undersaturated s 1 s i 0 and precipitate is present in the system in this case the nrms allow for precipitate redissolution until equilibrium is reached using the reverse reaction of equation 3 morse and arvidson 2002 however the kinetic dissolution rate k d t and the reaction order for dissolution n d may be different than those for precipitation significantly more work is needed to better understand the dissolution behaviour of the various precipitates in complex waste water matrices greenberg and tomson 1992 morse and arvidson 2002 4 equilibrium occurs s 1 s i 0 in this case the liquid solid solid liquid transfer rate is set at 0 finally for the nrm prec a generic mechanism for agglomeration and floc break up through the effect of mixing was included using the spherical particle model for macroscale flocculation crittenden et al 2012 the net rate of floc appearance eq a7 was written as a7 ρ a g g l l 3 t 1 k a g n p a r t v l i q v f e r t i l i z e r v l i q k b g δ in which k a is the aggregation constant 4 α π for laminar flow where α is the collision efficiency factor default for turbulent flow 5 10 4 k b t δ 1 l 3 is the floc break up constant 0 for laminar flow default for turbulent flow 10 7 crittenden et al 2012 g is the root mean square velocity gradient t 1 which depends on the power input camp and stein 1943 and δ is the turbulence constant under turbulent conditions the values of k a and k b should be determined empirically in laboratory or pilot scale tests argaman 1971 parker et al 1972 note that when the g value is set to 0 it is assumed that no agglomeration occurs appendix 3 biochemical processes and gujer matrix included in the nutrient recovery model for the anaerobic digester nrm ad table a3 1 biochemical bc processes included in the nutrient recovery model for anaerobic digestion nrm ad and extensions made as compared to the anaerobic digestion model no 1 adm1 ac acetate bu butyrate ebpr enhanced biological phosphorus p removal lcfa long chain fatty acids pao p accumulating organism pha poly hydroxy alkanoate pp poly phosphate pro propionate srb sulfate reducing bacteria va valerate table a3 1 physicochemical processes biochemical processes adm1 adm1 nrm ad extension 2 nrm ad extension 3 nrm ad potential extension 4 4 acid base systems nh4 nh3 co2 hco3 vfa vfa h2o oh h 4 gas liquid exchange reactions co2 ch4 h2 h2o disintegration hydrolysis acidogenesis acetogenesis methanogenesis batstone et al 2002 sulfurgenesis knobel and lewis 2002 lizarralde et al 2010 release uptake of p k s from bacterial cells and other biochemical components ebpr sludge ikumi 2011 nrm ad extension 1 acid base systems table a1 2 redox reactions table a1 3 ion pairing reactions table a1 4 solid liquid transfer table a1 5 gas liquid exchange table a1 6 bc1 disintegration of complex particulatesbc2 hydrolysis of carbohydratesbc3 hydrolysis of proteinsbc4 hydrolysis of lipidsbc5 uptake of monosaccharidesbc6 uptake of aminoacidsbc7 uptake of lcfabc8 uptake of vabc9 uptake of bubc10 uptake of probc11 uptake of acbc12 uptake of h2 bc13 decay of monosaccharide degradersbc14 decay of amino acid degradersbc15 decay of lcfa degradersbc16 decay of va and bu degradersbc17 decay of pro degradersbc18 decay of ac degradersbc19 decay of h degraders bc20 sulfate reduction on acbc21 sulfate reduction on bubc22 sulfate reduction on h2 bc23 sulfate reduction on probc24 decay of srbs using acbc25 decay of srbs using bubc26 decay of srbs using h2 bc27 decay of srbs using pro inclusion in stoichiometric gujer matrix table a2 2 a2 4 bc28 release of pp with uptake of ac by paosbc29 decay of paosbc30 hydrolysis of pp release of k ca mgbc31 hydrolysis of pha table a3 2 stoichiometry of the biochemical bc gujer matrix incorporated in the nutrient recovery model for the anaerobic digester nrm ad for process description see table a3 1 for nomenclature see table a3 4 for state variable description see appendix 5 component process s aakg cod m 3 s co2 kmol m 3 s hackg cod m 3 s hbukg cod m 3 bc1 c xc f ch xc c ch f si xc c si f pr xc c pr f xi xc c xi f li xc c li bc2 c ch c su bc3 1 c aa c pr bc4 f fa li 1 c su f fa li c fa c li bc5 c su 1 y su f ac su c ac 1 y su f pro su c pro 1 y su f bu su c bu y su c biom 1 y su f ac su 1 y su f bu su bc6 1 c aa 1 y aa f ac aa c ac 1 y aa f bu aa c bu 1 y aa f pro aa c pro 1 y aa f va aa c va y aa c biom 1 y aa f ac aa 1 y aa f bu aa bc7 c fa 1 y fa 0 7 c ac y fa c biom 1 y fa 0 7 bc8 c va 1 y c4 0 54 c pro y c4 c biom 1 y c4 0 31 c ac 1 y c4 0 31 bc9 c bu 1 y c4 0 8 c ac y c4 c biom 1 y c4 0 8 1 bc10 c pro 1 y pro 0 57 c ac y pro c biom 1 y pro 0 57 bc11 c ac y ac c biom 1 y ac c ch4 1 bc12 y h2 c biom 1 y h2 c ch4 bc13 c biom c xc bc14 c biom c xc bc15 c biom c xc bc16 c biom c xc bc17 c biom c xc bc18 c biom c xc bc19 c biom c xc bc20 f co2 ac 1 bc21 f co2 bu 1 bc22 f co2 h bc23 f co2 pro bc24 c biom c xc bc25 c biom c xc bc26 c biom c xc bc27 c biom c xc table a3 2 continuation stoichiometry of the biochemical bc gujer matrix incorporated in the nutrient recovery model for the anaerobic digester nrm ad for process description see table a3 1 for nomenclature see table a3 4 for state variable description see appendix 5 component process s hpo4 2 kmol m 3 s hvakg cod m 3 s ch4 kg cod m 3 s fakg cod m 3 s h2 kg cod m 3 s h2skmol m 3 s inertkg cod m 3 s k kmol m 3 bc1 p xc f xi xc p xi f si xc p si f li xc p li f si xc bc2 bc3 bc4 p li f fa li bc5 y su p biom 1 y su f h2 su y su k biom bc6 y aa p biom 1 y aa f va aa 1 y aa f h2 aa y aa k biom bc7 p fa y fa p biom 1 1 y fa 0 3 y fa k biom bc8 y c4 p biom 1 1 y c4 0 15 y c4 k biom bc9 y c4 p biom 1 y c4 0 2 y c4 k biom bc10 y pro p biom 1 y pro 0 43 y pro k biom bc11 y ac p biom 1 y ac y ac k biom bc12 y h2 p biom 1 y h2 1 y h2 k biom bc13 p biom p xc k biom k xc bc14 p biom p xc k biom k xc bc15 p biom p xc k biom k xc bc16 p biom p xc k biom k xc bc17 p biom p xc k biom k xc bc18 p biom p xc k biom k xc bc19 p biom p xc k biom k xc bc20 f s ac bc21 f s bu bc22 1 f s h bc23 f s pro bc24 p biom p xc k biom k xc bc25 p biom p xc k biom k xc bc26 p biom p xc k biom k xc bc27 p biom p xc k biom k xc table a3 2 continuation stoichiometry of the biochemical bc gujer matrix incorporated in the nutrient recovery model for the anaerobic digester nrm ad for process description see table a3 1 for nomenclature see table a3 4 for state variable description see appendix 5 component process s nh4 kmol m 3 s prokg cod m 3 s so4 2 kmol m 3 s sukg cod m 3 x aakg cod m 3 x ackg cod m 3 x ckg cod m 3 x c4kg cod m 3 x chkg cod m 3 x fakg cod m 3 bc1 n xc f xi xc n xi f si xc n si f pr xc n aa 1 f ch xc bc2 1 1 bc3 bc4 1 f fa li bc5 n biom y su 1 y su f pro su y su s biom 1 bc6 n aa y aa n biom 1 y aa f pro aa y aa s biom y aa bc7 n biom y fa y c4 s biom y fa bc8 n biom y c4 1 y c4 0 54 y c4 s biom y c4 bc9 n biom y c4 y ac s biom y c4 bc10 n biom y pro 1 y pro s biom bc11 n biom y ac y ac s biom y ac bc12 n biom y h2 y h2 s biom bc13 n biom n xc s biom s xc 1 bc14 n biom n xc s biom s xc 1 1 bc15 n biom n xc s biom s xc 1 1 bc16 n biom n xc s biom s xc 1 1 bc17 n biom n xc s biom s xc 1 bc18 n biom n xc s biom s xc 1 1 bc19 n biom n xc s biom s xc 1 bc20 f s ac bc21 f s bu bc22 f s h bc23 1 f s pro bc24 n biom n xc s biom s xc 1 bc25 n biom n xc s biom s xc 1 bc26 n biom n xc s biom s xc 1 bc27 n biom n xc s biom s xc 1 table a3 2 continuation stoichiometry of the biochemical bc gujer matrix incorporated in the nutrient recovery model for the anaerobic digester nrm ad for process description see table a3 1 for nomenclature see table a3 4 for state variable description see appendix 5 table a3 2 component process x h2kg cod m 3 x prkg cod m 3 x prokg cod m 3 x sukg cod m 3 x inertkg cod m 3 x likg cod m 3 x srb ackg cod m 3 x srb bukg cod m 3 x srb hkg cod m 3 x srb prokg cod m 3 bc1 f pr xc f xi xc f li xc bc2 bc3 1 bc4 1 bc5 y su bc6 bc7 bc8 bc9 bc10 y pro bc11 bc12 y h2 bc13 1 bc14 bc15 bc16 bc17 1 bc18 bc19 1 bc20 y srb ac bc21 y srb bu bc22 y srb h bc23 y srb pro bc24 1 bc25 1 bc26 1 bc27 1 table a3 3 biochemical bc kinetic equations of the gujer matrix incorporated in the nutrient recovery model for the anaerobic digester nrm ad for process description see table a3 1 for nomenclature see table a3 4 for state variable description see appendix 5 table a3 3 process kinetic equation kg cod m 3 d 1 bc1 k d i s x c bc2 k h y d x c h x c h bc3 k h y d x p r x p r bc4 k h y d x l i x l i bc5 k m s u x s u s s u k s s u s s u i p h b a c i n h l i m i t bc6 k m a a x a a s a a k s a a s a a i p h b a c i n h l i m i t bc7 k m f a x f a s f a k s f a s f a i p h b a c i n h l i m i t i h 2 f a bc8 k m c 4 x c 4 s h v a k s c 4 s h v a s h v a s h v a s h b u i p h b a c i n h l i m i t i h 2 c 4 bc9 k m c 4 x c 4 s h b u k s c 4 s h b u s h b u s h b u s h v a i p h b a c i n h l i m i t i h 2 c 4 bc10 k m p r o x p r o s h p r o k s p r o s h p r o i p h b a c i n h l i m i t i h 2 p r o bc11 k m a c x a c s h a c k s a c s h a c i p h a c i n h 3 a c i n h l i m i t bc12 k m h 2 x h 2 s h 2 k s h 2 s h 2 i p h h 2 i n h l i m i t bc13 k d e c x s u x s u bc14 k d e c x a a x a a bc15 k d e c x f a x f a bc16 k d e c x c 4 x c 4 bc17 k d e c x p r o x p r o bc18 k d e c x a c x a c bc19 k d e c x h 2 x h 2 bc20 k m s r b a c x s r b a c s h a c k s s r b a c s h a c s s o 4 k s s o 4 a c s s o 4 i p h s r b i h 2 s a c bc21 k m s r b b u x s r b b u s h b u k s s r b b u s h b u s s o 4 k s s o 4 b u s s o 4 i p h s r b i h 2 s b u bc22 k m s r b h 2 x s r b h 2 s h 2 k s s r b h 2 s h 2 s s o 4 k s s o 4 h 2 s s o 4 i p h s r b i h 2 s h 2 bc23 k m s r b p r o x s r b p r o s h p r o k s s r b p r o s h p r o s s o 4 k s s o 4 p r o s s o 4 i p h s r b i h 2 s p r o bc24 k d e c x s r b a c x s r b a c bc25 k d e c x s r b b u x s r b b u bc26 k d e c x s r b h 2 x s r b h 2 bc27 k d e c x p r o x p r o table a3 4 nomenclature for tables a3 2 and a3 3 table a3 4 symbol description unit c i carbon content of component i kmol c kg 1 cod f product substrate yield catabolism only of product on substrate kg cod kg 1 cod i h 2 s u b s t r a t e hydrogen inhibition for substrate degradation i h 2 s s u b s t r a t e hydrogen sulfide inhibition for substrate degradation i n h l i m i t inhibition of biomass growth due to lack of inorganic nitrogen i p h b a c ph inhibition of acetogens and acidogens i p h i ph inhibition of component i k d e c i first order decay rate for biomass death of component i d 1 k d i s i complex particulate first order disintegration rate of component i d 1 k h y d i first order hydrolysis rate of component i d 1 k i potassium content of component i kmol k kg 1 cod k m i specific monod maximum uptake rate of component i d 1 k s i monod half saturation constant of component i kg cod m 3 n i nitrogen content of component i kmol n kg 1 cod p i phosphorus content of component i kmol p kg 1 cod s i sulfur content of component i kmol s kg 1 cod y substrate yield of biomass on substrate kg cod x kg 1 cod s appendix 4 reactor design and the default specifications and features for each unit process table a4 1 reactor design default specifications and features for each unit in the nutrient recovery model nrm library ad anaerobic digestion ams ammonium sulfate chem chemical dosing cstr continuously stirred tank reactor heat heater tss total suspended solids p precipitates prec precipitation crystallization scrub scrubber settle settler store storage tank strip stripper wrrf water resource recovery facility x biological particulate solids table a4 1 unit reactor design default specifications and features nrm ad cstr based on gujer 2008 constant liquid volume sealed gas phase at atmospheric pressure gas removed to downstream treatment process nrm prec cstr as generally used for coagulation flocculation units crittenden et al 2012 variable volume as function of retained precipitant volume precipitate flow rate q prec extracts fraction of the precipitates continuously or at specific times when selected specifications are reached e g target particle diameter purity etc allows to study the effect of mixing power and reactor seeding on e g the mean particle aggregate diameter optional use of gas flow instead of chemicals for ph increase in the reactor potential extension inclusion of particle differential settling velocity crittenden et al 2012 nrm strip stirred tank for active liquid gas exchange based on gujer 2008 continuous in and outgoing liquid and gas flows newly formed gas bubble enters the reactor at an initial gas phase concentration model parameters averaged over all bubbles heterogenous gas transfer throughout the reactor height user selectable number of liquid layers to represent spatially dependent liquid transfer a nrm scrub stirred tank for active gas liquid exchange gujer 2008 similar specifications as nrm strip but i default use of sulfuric acid solution at ph 1 3 for nh3 absorption ii ams recycle flow q rec with extraction as fertilizer flow when user selected ams specifications usually 25 40 ams concentration are reached cfr semi batch process nrm store tank with gas recovery for digestate storing continued non controlled anaerobic digestion and biogas recovery continuously emptied to a user specified minimum level default 15 agridigestore ludlow uk complete digestion energy recovery digestate nutrient availability nrm settle point settler simplified design based on tss removal efficiency and tss settleability hendricks 2010 default 0 5 non settleable x and 10 non settleable p potential extension inclusion of particle differential settling velocity crittenden et al 2012 no longer simplified design nrm chem point mixer closed tank to avoid nh3 emissions through ph increase allows addition of the most important amendments in wrrfs i mgcl2 mg oh 2 and ca oh 2 prior to p precipitation ii naoh and ca oh 2 prior to stripping goal ph caco3 scaling usually followed by nrm prec to allow for species precipitation and flocculation nrm heat point heater colder fluid gaining heat from a hot gas steam flow or a hot liquid flow generic equation based on the specific heat of the fluid the surface area of the heat exchanger and the overall heat transfer coefficient aic 2014 application prior to nrm ad and nrm strip a some literature studies show that hydraulic levels and reactor design have no effect on the nh3 recovery efficiency as equilibrium conditions are reached in a very small time interval arogo et al 1999 collivignarelli et al 1998 gujer 2008 powers et al 1987 however other studies believe that liquid transfer should be modelled heterogeneously i e spatially dependent yu et al 2011 because of this discussion an option was included in the nrm strip and nrm scrub to calculate nh3 removal and absorption for a user selectable number of liquid layers the gujer 2008 model is based on homogeneous liquid transfer appendix 5 state vectors used in the nutrient recovery model nrm library table a5 1 generic state vectors used in the nutrient recovery model nrm library component symbols and descriptions table a5 1 state vector component symbol description component symbol description components s1 pc s acetate soluble acetate s mg soluble magnesium s al soluble aluminium s na soluble sodium s butyrate soluble butyrate s n min3 soluble ammonia n iii s ca soluble calcium s n 0 soluble nitrogen n 0 s c 4 soluble carbonate c iv s n 5 soluble nitrate n v s cl soluble chloride s o 0 soluble oxygen o 0 s c min4 soluble methane c iv s p soluble phosphorus s dom soluble dissolved organic matter s propionate soluble propionate s fe soluble iron s s min2 soluble sulfide s ii s h 0 soluble hydrogen h 0 s s 6 soluble sulfate s vi s k soluble potassium s valerate soluble valerate components s1 bio s aa soluble aminoacids s inert soluble inerts s fa soluble long chain fatty acids s su soluble sugars components s2 s c 4 soluble carbonate c iv s n 5 soluble nitrate n v s c min4 soluble methane c iv s o 0 soluble oxygen o 0 s h 0 soluble hydrogen h 0 s s min2 soluble sulfide s ii s n min3 soluble ammonia n iii s s 6 soluble sulfate s vi s n 0 soluble nitrogen n 0 components g g ch4 methane gas g h2s hydrogen sulfide gas g co2 carbon dioxide gas g nh3 ammonia gas g h2 hydrogen gas g n2 nitrogen gas g h2o water vapour g o2 oxygen gas components p p al precipitated aluminium p mg precipitated magnesium p ca precipitated calcium p n min3 precipitated ammonia n iii p c 4 precipitated carbonate c iv p p precipitated phosphorus p fe precipitated iron p s min2 precipitated sulfide s ii p k precipitated potassium p s 6 precipitated sulfate s vi components x x aa aminoacid degraders x li lipids x ac acetate degraders x pr proteins x c composites x pro propionate degraders x ch carbohydrates x su sugar degraders x c4 valerate and butyrate degraders x srb ac sulfate reducing bacteria using acetate x fa long chain fatty acid degraders x srb bu sulfate reducing bacteria using butyrate x h2 hydrogen reducing bacteria x srb h sulfate reducing bacteria using hydrogen x inert particulate inerts x srb pro sulfate reducing bacteria using propionate appendix 6 data requirements and data used for nutrient recovery model nrm validation table a6 1 types of data required and datasets available for each key unit in the nutrient recovery model nrm library ad anaerobic digestion prec precipitation crystallization strip stripper scrub scrubber n a not applicable table a6 1 nrm ad nrm prec nrm strip nrm scrub input waste characteristics biological components sludge astals et al 2013 ikumi 2011 tchobanoglous et al 2003 manure cesur and albertson 2005 martin 2003 mattocks et al 2002 co digestion zaher et al 2009 own data n a n a n a physicochemical components ali and schneider 2008 bhuiyan et al 2007 harrison et al 2011 schneider et al 2013 own data bhuiyan et al 2007 campos et al 2013 collivignarelli et al 1998 powers et al 1987 yu et al 2011 own data campos et al 2013 collivignarelli et al 1998 manuzon et al 2007 powers et al 1987 yu et al 2011 own data physicochemical stoichiometric parameters acid base ion pairing equilibrium constants k a b k i p nist 2001 phreeqc nist 2001 phreeqc nist 2001 phreeqc nist 2001 phreeqc water dissociation constant k w nist 2001 phreeqc nist 2001 phreeqc nist 2001 phreeqc nist 2001 phreeqc solubility products k s nist 2001 phreeqc nist 2001 phreeqc nist 2001 phreeqc nist 2001 phreeqc henry s law coefficients h sander 1999 sander 1999 sander 1999 sander 1999 physicochemical kinetic parameters precipitation dissolution transfer coefficients and reaction order k n bénézeth et al 2008 chauhan et al 2011 ikumi 2011 inskeep and silvertooth 1988 johnson 1990 musvoto et al 1997 musvoto et al 2000 nielsen 1984 nist 2001 to mention a few ali and schneider 2008 bhuiyan et al 2008 galbraith et al 2014 harrison et al 2011 nist 2001 schneider et al 2013 to mention a few bénézeth et al 2008 chauhan et al 2011 ikumi 2011 inskeep and silvertooth 1988 johnson 1990 musvoto et al 1997 musvoto et al 2000 nielsen 1984 nist 2001 to mention a few belcu and turtoi 1996 nist 2001 liquid gas transfer coefficients k l g a batstone et al 2002 chapra 2008 lizarralde et al 2013 musvoto et al 1997 munz and roberts 1989 if ph increase with aeration batstone et al 2002 chapra 2008 lizarralde et al 2013 musvoto et al 1997 munz and roberts 1989 collivignarelli et al 1998 musvoto et al 1997 musvoto et al 2000 powers et al 1987 yu et al 2011 collivignarelli et al 1998 manuzon et al 2007 yu et al 2011 biological stoichiometric parameters biomass composition batstone et al 2002 ikumi 2011 tchobanoglous et al 2003 zaher et al 2009 n a n a n a pre set fractions f product substrate batstone et al 2002 ikumi 2011 knobel and lewis 2002 lizarralde et al 2010 n a n a n a biomass substrate yield y substrate batstone et al 2002 ikumi 2011 knobel and lewis 2002 lizarralde et al 2010 n a n a n a biological kinetic parameters uptake rates k m disintegration rates k d i s decay rates k d e c etc batstone et al 2002 ikumi 2011 knobel and lewis 2002 lizarralde et al 2010 n a n a n a input output data operational factors temperature ph etc calibration validation data sludge astals et al 2013 manure cesur and albertson 2005 martin 2003 mattocks et al 2002 own data data from industry ali and schneider 2008 bhuiyan et al 2007 2008 harrison et al 2011 schneider et al 2013 own data data from industry campos et al 2013 collivignarelli et al 1998 powers et al 1987 yu et al 2011 own data data from industry campos et al 2013 collivignarelli et al 1998 koptev 1966 manuzon et al 2007 melse and ogink 2005 powers et al 1987 yu et al 2011 own data data from industry table a6 2 parameter categories names default values and units for the nrm ad table a6 2 category name default value unit dimension volume vol gas 1 m3 vol liq 2 8 m3 kinetics liquid gas diffusion coefficient at t diff d ch4 g 3 771e 05 m2 d d co2 g 0 000156 m2 d d h2s g 2 2043e 05 m2 d d h2 g 0 000165 m2 d d n2 g 0 0001536 m2 d d nh3 g 0 000169 m2 d d o2 0 0001608 m2 d inhibitory concentration ki h2 c4 1e 05 kg m3 ki h2 fa 5e 06 kg m3 ki h2 pro 3 5e 06 kg m3 ki h2s ac 0 00475 kg m3 ki h2s bu 0 0156 kg m3 ki h2s h2 0 00465 kg m3 ki h2s pro 0 00889 kg m3 ki nh3 ac 0 0252 kmol m3 saturation constant ks in 0 0001 kg m3 ks aa 0 3 kg m3 ks ac 0 15 kg m3 ks c4 0 2 kg m3 ks fa 0 4 kg m3 ks h2 7e 06 kg m3 ks pro 0 1 kg m3 ks so4 ac 0 0002 kg m3 ks so4 bu 0 00017 kg m3 ks so4 h2 9 3e 06 kg m3 ks so4 pro 7 7e 05 kg m3 ks srb ac 0 024 kg m3 ks srb bu 0 28672 kg m3 ks srb h2 2 4e 05 kg m3 ks srb pro 0 04944 kg m3 ks su 0 5 kg m3 temperature of diffusion coefficient t diff ch4 g 298 k t diff co2 g 293 k t diff h2s g 298 k t diff h2 g 298 k t diff n2 g 293 k t diff nh3 g 298 k liquid mass transfer rate kla o2 200 1 d liquid solid transfer rate k al2o3 0 0001 mol m2 d k alpo4 0 0001 mol m2 d k anhydrite 0 0001 mol m2 d k aragonite 0 61166516 mol m2 d k boehmite 0 00028 mol m2 d k ca4h po4 3 3h2o 0 1 mol m2 d k cahpo4 2h2o 14 6435 mol m2 d k cahpo4bis 0 1 mol m2 d k calcite 1080 mol m2 d k diaspore 0 1 mol m2 d k dolomite 11 22 mol m2 d k fes ppt 0 0001 mol m2 d k gibbsite 0 0001192652 mol m2 d k hercynite 0 1 mol m2 d k hydroxyapatite 986 64761 mol m2 d k kstruvite 4 64e 06 mol m2 d k mackinawite 0 0001 mol m2 d k magnesite 0 000988416 mol m2 d k mg3 po4 2 0 1 mol m2 d k mghpo4 3h2o 4 78021e 07 mol m2 d k siderite 0 00209952 mol m2 d k struvite 0 002037407 mol m2 d k vivianite 1 66165e 06 mol m2 d decay rate kdec xaa 0 02 1 d kdec xac 0 02 1 d kdec xc4 0 02 1 d kdec xfa 0 02 1 d kdec xh2 0 02 1 d kdec xpro 0 02 1 d kdec xsrbac 0 02 1 d kdec xsrbbu 0 02 1 d kdec xsrbh 0 02 1 d kdec xsrbpro 0 02 1 d kdec xsu 0 02 1 d dissociation rate kdis 0 5 1 d hydrolysis rate khyd ch 10 1 d khyd li 10 1 d khyd pr 10 1 d maximum uptake rate km aa 50 1 d km ac 9 1 d km c4 20 1 d km fa 6 1 d km h2 35 1 d km pro 9 1 d km srb ac 12 55 1 d km srb bu 14 51 1 d km srb h2 20 1 d km srb pro 20 1 d km su 30 1 d reaction order precipitation n al2o3 2 n alpo4 2 n anhydrite 2 n aragonite 2 n boehmite 2 n ca4h po4 3 3h2o 2 n cahpo4 2h2o 2 n cahpo4bis 2 n calcite 2 n diaspore 2 n dolomite 2 n fes ppt 2 n gibbsite 2 n hercynite 2 n hydroxyapatite 2 n kstruvite 2 n mackinawite 2 n magnesite 2 n mg3 po4 2 2 n mghpo4 3h2o 2 n siderite 2 n struvite 2 n vivianite 2 ph inhibitory levels ph ac ll 6 3 ph ac ul 9 ph bac ll 4 ph bac ul 5 5 ph h2 ll 5 3 ph h2 ul 9 ph srb ll 5 5 ph srb ul 8 alfa ll 6 alfa ul 6 arrhenius coefficient for temperature dependency theta ch4 g 1 024 theta co2 g 1 024 theta h2s g 1 024 theta h2 g 1 024 theta n2 g 1 024 theta nh3 g 1 a operation gas flow constant k p 50000 mass of seed material m seed al2o3 0 0005 kg m seed alpo4 0 0005 kg m seed anhydrite 0 0005 kg m seed aragonite 0 0005 kg m seed boehmite 0 0005 kg m seed ca4h po4 3 3h2o 0 0005 kg m seed cahpo4 2h2o 0 0005 kg m seed cahpo4bis 0 0005 kg m seed calcite 0 0005 kg m seed diaspore 0 0005 kg m seed dolomite 0 0005 kg m seed fes ppt 0 0005 kg m seed gibbsite 0 0005 kg m seed hercynite 0 0005 kg m seed hydroxyapatite 0 0005 kg m seed kstruvite 0 0005 kg m seed mackinawite 0 0005 kg m seed magnesite 0 0005 kg m seed mg3 po4 2 0 0005 kg m seed mghpo4 3h2o 0 0005 kg m seed siderite 0 0005 kg m seed struvite 0 0005 kg m seed vivianite 0 0005 kg temperature t op 302 15 k surface area of seed material a seed 600 m2 g fraction of particulate matter that leaves the reactor f x out 0 002 atmospheric pressure p atm 1 atm stoichiometry cod content cod acetatemin 64 g mol cod butyratemin 160 g mol cod ch4 64 g mol cod co2 1 g mol cod co3min2 1 g mol cod h2s 1 g mol cod h2 16 g mol cod kplus 1 g mol cod nh4plus 1 g mol cod po4min3 1 g mol cod propionatemin 112 g mol cod so4min2 1 g mol cod valeratemin 208 g mol carbon content c si 0 03 mol g c xi 0 03 mol g c xc 0 02786 mol g c aa 0 03 mol g c ac 0 0313 mol g c biom 0 0313 mol g c bu 0 025 mol g c ch 0 0313 mol g c ch4 0 0156 mol g c fa 0 0217 mol g c li 0 022 mol g c pr 0 03 mol g c pro 0 0268 mol g c su 0 0313 mol g c va 0 024 mol g reaction enthalphie of gas liquid transfer h gas ch4 g 1700 h gas co2 g 236534 h gas h2s g 3000 h gas h2 g 500 h gas n2 g 1300 h gas nh3 g 4200 potassium content k xc 0 0001278828 mol g k biom 0 0002557656 mol g nitrogen content n si 0 0042857143 mol g n xi 0 0042857143 mol g n xc 0 0026857143 mol g n aa 0 007 mol g n biom 0 0057142857 mol g phosphorus content p xc 0 00032285392 mol g p biom 0 00064570783 mol g sulfur content s xc 0 0001278828 mol g s biom 0 0002557656 mol g biomass yield y aa 0 08 y ac 0 05 y c4 0 06 y fa 0 06 y h2 0 06 y pro 0 04 y srb ac 0 05437 y srb bu 0 03809 y srb h 0 17355 y srb pro 0 04081 y su 0 1 enthalpy of heat for precipitation delta h al2o3 258 5901 kj mol delta h alpo4 458 6 kj mol delta h anhydrite 7 2 kj mol delta h aragonite 8 kj mol delta h boehmite 117 6959 kj mol delta h ca4h po4 3 3h2o 105 kj mol delta h cahpo4 2h2o 23 kj mol delta h cahpo4bis 31 kj mol delta h calcite 8 kj mol delta h diaspore 103 0519 kj mol delta h dolomite 31 9 kj mol delta h fes ppt 11 kj mol delta h gibbsite 105 kj mol delta h hercynite 313 9199 kj mol delta h hydroxyapatite 0 kj mol delta h kstruvite 83 21 kj mol delta h mackinawite 0 kj mol delta h magnesite 20 kj mol delta h mg3 po4 2 0 kj mol delta h mghpo4 3h2o 0 kj mol delta h siderite 7 3 kj mol delta h struvite 0 kj mol delta h vivianite 5 06 kj mol pre set fraction and yield f si xc 0 1 f xi xc 0 2 f ac aa 0 4 f ac su 0 41 f bu aa 0 26 f bu su 0 13 f ch xc 0 1 f co2 ac 0 02955 mol gcod f co2 bu 0 mol gcod f co2 h 0 00542 mol gcod f co2 pro 0 0085 mol gcod f fa li 0 95 f h2 aa 0 06 f h2 su 0 19 f li xc 0 3 f pr xc 0 52 f pro aa 0 05 f pro su 0 27 f s ac 0 mol gcod f s bu 0 00542 mol gcod f s h 0 mol gcod f s pro 0 mol gcod f va aa 0 23 henry coefficient at 298 15 k kh ch4 g 0 0014 mol l atm kh co2 g 0 035 mol l atm kh h2s g 0 1 mol l atm kh h2 g 0 00078 mol l atm kh n2 g 0 00065 mol l atm kh nh3 g 61 mol l atm a passive liquid gas transfer kla 3 2 table a6 3 parameter categories names default values and units for the nrm prec table a6 3 category name default value unit dimension volume vol liq 1000 m3 fertilizer extraction rate q prec target 10 m3 d kinetics liquid solid transfer rate k alpo4 0 0001 mol m2 d k aragonite 6 1166516 mol m2 d k artinite 50 mol m2 d k boehmite 0 00028 mol m2 d k brucite 0 1 mol m2 d k ca3 po4 2 am1 50 mol m2 d k ca3 po4 2 am2 50 mol m2 d k ca3 po4 2 beta 50 mol m2 d k ca4h po4 3 3h2o 0 1 mol m2 d k cahpo4 2h2o 14 6435 mol m2 d k cahpo4bis 0 1 mol m2 d k calcite 1080 mol m2 d k diaspore 0 1 mol m2 d k dolomite 11 22 mol m2 d k dolomite dis 0 1 mol m2 d k fe oh 2 s 0 1 mol m2 d k gibbsite 0 0001192652 mol m2 d k hercynite 0 1 mol m2 d k hydroxyapatite 986 64761 mol m2 d k kstruvite 4 64e 06 mol m2 d k magnesite 0 000988416 mol m2 d k mg3 po4 2 0 1 mol m2 d k mghpo4 3h2o 4 78021e 07 mol m2 d k mg oh 2 act 0 1 mol m2 d k siderite 0 00209952 mol m2 d k struvite 0 002037407 mol m2 d k vaterite 0 1 mol m2 d k vivianite 1 66165e 06 mol m2 d operation target minimum diameter of particels d fertilizer target 0 001 m mass of seed material m seed alpo4 0 0005 kg m seed aragonite 0 0005 kg m seed artinite 0 0005 kg m seed boehmite 0 0005 kg m seed brucite 0 0005 kg m seed ca3 po4 2 am1 0 0005 kg m seed ca3 po4 2 am2 0 0005 kg m seed ca3 po4 2 beta 0 0005 kg m seed ca4h po4 3 3h2o 0 0005 kg m seed cahpo4 2h2o 0 0005 kg m seed cahpo4bis 0 0005 kg m seed calcite 0 0005 kg m seed diaspore 0 0005 kg m seed dolomite 0 0005 kg m seed dolomite dis 0 0005 kg m seed fe oh 2 s 0 0005 kg m seed gibbsite 0 0005 kg m seed hercynite 0 0005 kg m seed hydroxyapatite 0 0005 kg m seed kstruvite 0 0005 kg m seed magnesite 0 0005 kg m seed mg3 po4 2 0 0005 kg m seed mghpo4 3h2o 0 0005 kg m seed mg oh 2 act 0 0005 kg m seed siderite 0 0005 kg m seed struvite 0 0005 kg m seed vaterite 0 0005 kg m seed vivianite 0 0005 kg residence time res time liq 10 d temperature t op 0 k surface area of seed material a seed 600 m2 g fraction of precipitates removed from the reactor per extraction f prec 1 ph ph op 10 stoichiometry enthalpy of heat for precipitation delta h alpo4 458 6 kj mol delta h aragonite 8 kj mol delta h artinite 120 2565 kj mol delta h boehmite 117 6959 kj mol delta h brucite 114 kj mol delta h ca3 po4 2 am1 94 kj mol delta h ca3 po4 2 am2 87 kj mol delta h ca3 po4 2 beta 54 kj mol delta h ca4h po4 3 3h2o 105 kj mol delta h cahpo4 2h2o 23 kj mol delta h cahpo4bis 31 kj mol delta h calcite 8 kj mol delta h diaspore 103 0519 kj mol delta h dolomite 31 9 kj mol delta h dolomite dis 46 4 kj mol delta h fe oh 2 s 91 62 kj mol delta h gibbsite 105 kj mol delta h hercynite 313 9199 kj mol delta h hydroxyapatite 0 kj mol delta h kstruvite 83 21 kj mol delta h magnesite 20 kj mol delta h mg3 po4 2 0 kj mol delta h mghpo4 3h2o 0 kj mol delta h mg oh 2 act 0 kj mol delta h siderite 7 3 kj mol delta h struvite 0 kj mol delta h vaterite 8 kj mol delta h vivianite 5 06 kj mol table a6 4 parameter categories names default values and units for the nrm strip table a6 4 category name default value unit dimension height h reactor 11 5 m safety factor on air requirements sf air 1 5 safety factor on reactor height sf height 1 5 volume v liq 81 3 m3 number of layers nroflayers 3 initial gas flow rate q gas in 2400 m3 d initial liquid flow rate q liq in 1560000 m3 d kinetics liquid gas diffusion coefficient at t diff d ch4 g 3 771e 05 m2 d d co2 g 0 000156 m2 d d h2s g 2 2043e 05 m2 d d h2 g 0 000165 m2 d d n2 g 0 0001536 m2 d d nh3 g 0 000169 m2 d d o2 g 0 0001608 m2 d temperature of diffusion coefficient t diff ch4 g 298 k t diff co2 g 293 k t diff h2s g 298 k t diff h2 g 298 k t diff n2 g 293 k t diff nh3 g 298 k t diff o2 g 293 k liquid solid transfer rate k aragonite 6 1166516 mol m2 d k artinite 50 mol m2 d k brucite 0 1 mol m2 d k ca3 po4 2 am1 50 mol m2 d k ca3 po4 2 am2 50 mol m2 d k ca3 po4 2 beta 50 mol m2 d k ca4h po4 3 3h2o 0 1 mol m2 d k cahpo4 2h2o 14 6435 mol m2 d k cahpo4bis 0 1 mol m2 d k calcite 1080 mol m2 d k diaspore 0 1 mol m2 d k dolomite 11 22 mol m2 d k dolomite dis 0 1 mol m2 d k fe oh 2 0 1 mol m2 d k hercynite 0 1 mol m2 d k huntite 0 1 mol m2 d k hydromagnesite 50 mol m2 d k hydroxyapatite 986 64761 mol m2 d k kstruvite 4 64e 06 mol m2 d k magnesite 0 000988416 mol m2 d k mg3 po4 2 0 1 mol m2 d k mghpo4 3h2o 4 78021e 07 mol m2 d k mg oh 2 act 0 1 mol m2 d k periclase 0 1 mol m2 d k portlandite 0 1 mol m2 d k siderite 0 00209952 mol m2 d k spinel 0 1 mol m2 d k struvite 0 002037407 mol m2 d k vivianite 1 66165e 06 mol m2 d reaction order for precipitation n aragonite 2 n artinite 2 n brucite 2 n ca3 po4 2 am1 2 n ca3 po4 2 am2 2 n ca3 po4 2 beta 2 n ca4h po4 3 3h2o 2 n cahpo4 2h2o 2 n cahpo4bis 2 n calcite 2 n diaspore 2 n dolomite 2 n dolomite dis 2 n fe oh 2 2 n hercynite 2 n huntite 2 n hydromagnesite 2 n hydroxyapatite 2 n kstruvite 2 n magnesite 2 n mg3 po4 2 2 n mghpo4 3h2o 2 n mg oh 2 act 2 n periclase 2 n portlandite 2 n siderite 2 n spinel 2 n struvite 2 n vivianite 2 arrhenius coefficient for temperature dependency theta ch4 g 1 024 theta co2 g 1 024 theta h2s g 1 024 theta h2 g 1 024 theta n2 g 1 024 theta nh3 g 1 024 theta o2 g 1 024 operation bubble size diam gas 0 003 m target removal efficiency eff target nh3 0 9 mass of seed material m seed aragonite 0 0005 kg m seed artinite 0 0005 kg m seed brucite 0 0005 kg m seed ca3 po4 2 am1 0 0005 kg m seed ca3 po4 2 am2 0 0005 kg m seed ca3 po4 2 beta 0 0005 kg m seed ca4h po4 3 3h2o 0 0005 kg m seed cahpo4 2h2o 0 0005 kg m seed cahpo4bis 0 0005 kg m seed calcite 0 0005 kg m seed diaspore 0 0005 kg m seed dolomite 0 0005 kg m seed dolomite dis 0 0005 kg m seed fe oh 2 0 0005 kg m seed hercynite 0 0005 kg m seed huntite 0 0005 kg m seed hydromagnesite 0 0005 kg m seed hydroxyapatite 0 0005 kg m seed kstruvite 0 0005 kg m seed magnesite 0 0005 kg m seed mg3 po4 2 0 0005 kg m seed mghpo4 3h2o 0 0005 kg m seed mg oh 2 act 0 0005 kg m seed periclase 0 0005 kg m seed portlandite 0 0005 kg m seed siderite 0 0005 kg m seed spinel 0 0005 kg m seed struvite 0 0005 kg m seed vivianite 0 0005 kg initial gas temperature t gas in 0 k stripping temperature t op 0 k surface area of seed material a seed 600 m2 g stripping ph ph op 10 5 rise velocity of bubbles u 25 920 m d stoichiometry reaction enthalphie of gas liquid transfer h gas ch4 g 1700 h gas co2 g 236 534 h gas h2s g 3000 h gas h2 g 500 h gas n2 g 1300 h gas nh3 g 4200 h gas o2 g 1700 enthalpy of heat for precipitation delta h aragonite 8 kj mol delta h artinite 120 2565 kj mol delta h brucite 114 kj mol delta h ca3 po4 2 am1 94 kj mol delta h ca3 po4 2 am2 87 kj mol delta h ca3 po4 2 beta 54 kj mol delta h ca4h po4 3 3h2o 105 kj mol delta h cahpo4 2h2o 23 kj mol delta h cahpo4bis 31 kj mol delta h calcite 8 kj mol delta h diaspore 103 0519 kj mol delta h dolomite 31 9 kj mol delta h dolomite dis 46 4 kj mol delta h fe oh 2 91 62 kj mol delta h hercynite 313 9199 kj mol delta h huntite 107 7798 kj mol delta h hydromagnesite 218 4466 kj mol delta h hydroxyapatite 0 kj mol delta h kstruvite 83 21 kj mol delta h magnesite 20 kj mol delta h mg3 po4 2 0 kj mol delta h mghpo4 3h2o 0 kj mol delta h mg oh 2 act 0 kj mol delta h periclase 151 23 kj mol delta h portlandite 128 62 kj mol delta h siderite 7 3 kj mol delta h spinel 388 0122 kj mol delta h struvite 0 kj mol delta h vivianite 5 06 kj mol dimensionless henry coefficient at 298 15 k kh ch4 g 0 0342527 kh co2 g 0 085632 kh h2s g 2 44662 kh h2 g 0 019 kh n2 g 0 0159 kh nh3 g 1492 kh o2 g 0 0318 table a6 5 parameter categories names default values and units for the nrm scrub table a6 5 category name default value unit dimension height h reactor 11 5 m safety factor on acid requirements sf acid 1 5 safety factor on reactor height sf height 1 5 volume v liq 81 3 m3 kinetics liquid gas diffusion coefficient at t diff d ch4 g 3 771e 05 m2 d d co2 g 0 000156 m2 d d h2s g 2 2043e 05 m2 d d h2 g 0 000165 m2 d d n2 g 0 0001536 m2 d d nh3 g 0 000169 m2 d d o2 g 0 0001608 m2 d temperature of diffusion coefficient t diff ch4 g 298 k t diff co2 g 293 k t diff h2s g 298 k t diff h2 g 298 k t diff n2 g 293 k t diff nh3 g 298 k t diff o2 g 293 k liquid solid transfer rate k nh4 2 so4 s 0 001 mol m2 d arrhenius coefficient for temperature dependency theta ch4 g 1 024 theta co2 g 1 024 theta h2s g 1 024 theta h2 g 1 024 theta n2 g 1 024 theta nh3 g 1 024 theta o2 g 1 024 operation bubble size diam gas 0 003 m target recovery efficiency eff target nh3 0 9 mass of seed material m seed nh4 2 so4 s 0 0005 kg initial gas temperature t gas in 0 k scrubbing temperature t op 0 k surface area of seed material a seed 600 m2 g rise velocity of bubbles u 25 920 m d stoichiometry reaction enthalphie of gas liquid transfer h gas ch4 g 1700 h gas co2 g 236 534 h gas h2s g 3000 h gas h2 g 500 h gas n2 g 1300 h gas nh3 g 4200 h gas o2 g 1700 enthalpy of heat for precipitation delta h nh4 2 so4 s 0 kj mol dimensionless henry coefficient at 298 15 k kh ch4 g 0 0342527 kh co2 g 0 085632 kh h2s g 2 44662 kh h2 g 0 019 kh n2 g 0 0159 kh nh3 g 1492 kh o2 g 0 0318 table a6 6 input sludge characteristics reactor design initial values and operating conditions for the anaerobic digester at holmen paper madrid spain data used for validation of the nutrient recovery model for the anaerobic digester nrm ad cod chemical oxygen demand cod input fractionation was conducted following the procedure proposed by grau et al 2007 for state variable description see appendix 5 cod chemical oxygen demand hrt hydraulic residence time q liq liquid flow rate t liq liquid temperature t operational operational temperature v liq liquid volume table a6 6 input flow reactor design initial values operation s aa kg cod m 3 0 s acetate mol m 3 2 85 s aa kg cod m 3 0 0172 s acetate mol m 3 0 0347 s fa kg cod m 3 0 217 s al mol m 3 unknown s fa kg cod m 3 0 0113 s al mol m 3 unknown s inert kg cod m 3 0 170 s butyrate mol m 3 1 14 s inert kg cod m 3 0 480 s butyrate mol m 3 0 322 s su kg cod m 3 1 05 s c 4 mol m 3 12 8 s su g cod m 3 0 569 s c 4 mol m 3 60 1 x aa kg cod m 3 0 s c min4 mol m 3 0 x aa kg cod m 3 0 112 s c min4 mol m 3 1 23 x ac kg cod m 3 0 s ca mol m 3 2 85 x ac kg cod m 3 0 0178 s ca mol m 3 7 10 x c4 kg cod m 3 0 s cl mol m 3 0 0357 x c4 kg cod m 3 1 33 s cl mol m 3 0 0357 x c kg cod m 3 0 s fe mol m 3 unknown x c kg cod m 3 31 3 s fe mol m 3 unknown x ch kg cod m 3 0 187 s h 0 mol m 3 0 x ch kg cod m 3 4 03 s h 0 mol m 3 0 0344 x fa kg cod m 3 0 s k mol m 3 0 0350 x fa kg cod m 3 2 30 s k mol m 3 6 39 x h2 kg cod m 3 0 s mg mol m 3 2 41 x h2 kg cod m 3 0 127 s mg mol m 3 2 69 x inert kg cod m 3 0 0936 s n 0 mol m 3 0 x inert kg cod m 3 13 8 s n 0 mol m 3 0 000256 x li kg cod m 3 0 140 s n 5 mol m 3 0 x li kg cod m 3 6 98 s n 5 mol m 3 0 00100 x pr kg cod m 3 0 s n min3 mol m 3 7 36 x pr kg cod m 3 0 998 s n min3 mol m 3 4 57 x pro kg cod m 3 0 s na mol m 3 0 0357 x pro kg cod m 3 0 0178 s na mol m 3 0 0357 x srb ac kg cod m 3 0 s o 0 mol m 3 3 98 x srb ac kg cod m 3 0 469 s o 0 mol m 3 0 x srb bu kg cod m 3 0 s p mol m 3 0 309 x srb bu kg cod m 3 4 99 s p mol m 3 0 245 x srb h kg cod m 3 0 s propionate mol m 3 1 63 x srb h kg cod m 3 43 6 s propionate mol m 3 0 0451 x srb pro kg cod m 3 0 s s 6 mol m 3 5 42 x srb pro kg cod m 3 16 6 s s 6 mol m 3 1 16 x su kg cod m 3 0 s s min2 mol m 3 0 0106 x su kg cod m 3 7 20 s s min2 mol m 3 6 35 s valerate mol m 3 0 878 s valerate mol m 3 0 402 q liq m3 d 1 15 0 t liq k 28 9 fraction of solids in effluent 0 002 v liq m3 2 80 ph 6 66 t operational k 302 15 hrt h 4 48 table a6 7 input digestate characteristics and operating conditions used for the lab scale experiments on struvite precipitation data used for validation of the nutrient recovery model for the precipitation crystallization unit nrm prec for state variable description see appendix 5 table a6 7 variable digestate 1 digestate 2 variable digestate 1 digestate 2 s acetate a mol m 3 0 100 0 100 s mg mol m 3 26 1 26 4 s al mol m 3 0 0100 1 00 s n 5 mol m 3 98 0 127 s butyrate a mol m 3 0 100 0 100 s n min3 mol m 3 362 346 s c 4 mol m 3 10 0 10 0 s na mol m 3 100 127 s c min4 a mmol m 3 0 100 0 100 s p mol m 3 38 8 45 5 s ca mol m 3 42 1 57 1 s propionate a mol m 3 0 0100 0 0100 s cl mol m 3 73 3 25 0 s s 6 mol m 3 40 0 20 0 s fe mol m 3 170 0 100 s s min2 mol m 3 0 100 0 100 s k mol m 3 104 122 s valerate a mol m 3 0 100 0 100 ph 8 43 7 83 temperature k 293 15 293 15 a estimated from the soluble chemical oxygen demand cod content following the procedure described in cesur and albertson 2005 table a6 8 input flow composition and operating conditions used for validation of the treatment train nrm chem nrm strip nrm scrub operational data were obtained from a technical inquiry at company x chem chemical dosing unit strip stripper scrub scrubber for state variable description see appendix 5 dom dissolved organic matter p gas gas pressure q gas gas flow rate q liq liquid flow rate table a6 8 input flow after naoh dose a operation nrm strip operation nrm scrub s al mol m 3 20 q liq in m3 d 1 2004 h2so4 dose m3 d 1 20 16 s c 4 mol m 3 80 q gas in m3 d 1 1 560 000 q gas in m3 d 1 output nrm strip s c min4 mol m 3 0 0080 column height m 11 5 column height m 11 5 s ca mol m 3 60 temperature k 328 15 temperature k output nrm strip s cl mol m 3 80 ph 10 3 ph acid 1 3 s dom mol m 3 10 vol liq m3 81 3 vol liq m3 20 16 s fe mol m 3 1 2 p gas in atm 2 42 p gas in atm output nrm strip s h 0 mol m 3 0 0010 s k mol m 3 33 s mg mol m 3 43 s n 0 mol m 3 0 10 s n 5 mol m 3 59 s n min3 mol m 3 199 s na mol m 3 102 s o 0 mol m 3 0 s p mol m 3 33 s s 6 mol m 3 40 s s min2 mol m 3 0 temperature k 293 15 a dose of 4 1 kg naoh m 3 as specified by company x appendix 7 model verification validation examples table a7 1 model verification validation against prior knowledge some dynamic simulation tests and effects all results were found to be realistic for state variable description see appendix 5 ad anaerobic digestion prec precipitation crystallization scrub scrubber srb sulfate reducing bacteria strip stripper vfa volatile fatty acids table a7 1 nrm ad nrm prec nrm strip nrm scrub s c 4 in alkalinity delayed ph s c 4 out vfa biogas production s p in struvite precipitation reactor height no influence on performance reactor height no influence on performance ph co3 precipitation ph co2 stripping not biologically mediated s mg in ph s p out phosphorus recovery efficiency temperature s n min3 out p nh3 out gas phase partial pressure nh3 recovery efficiency effluent ph p nh3 in gas phase partial pressure fertilizer alkalinity nh2coo formation n fertilizer modification ph inhibition level srbs 5 other bacteria 6 h2s production if ph 6 s p in phosphorus precipitation supersaturation q liq in residence time caco3 precipitation scaling potential temperature biogas production ph input nutrient contents fertilizer density and molecular weight nrm ad reducing the input alkalinity to the digester results in a delayed ph decrease less carbonate buffer because of volatile fatty acid accumulation methanogenic bacteria are very sensitive to ph decreases vanrolleghem and lee 2003 hence a reduction of the biogas production is observed obviously the output alkalinity decreases as well increasing the input ph results in an increased formation of carbonate precipitates in the digester whereas decreasing the ph stimulates the stripping of co2 see carbonate equilibria as function of ph zumdahl 2005 setting the ph inhibition level of sulfate reducing bacteria srbs at 5 but for the other bacteria at 6 leads to increased h2s production if the ph in the digester becomes lower than 6 hence the other bacteria are inhibited whereas the srbs still work at ph values lower than 6 increasing the temperature in the digester stimulates the production of biogas the increased temperatures facilitate faster reaction rates and thus more biogas can be produced from the organic matter in an equal amount of time tchobanoglous et al 2003 nrm prec decreasing the p concentration in the input waste flow reduces the potential for struvite mgnh4po4 6h2o precipitation decreasing the mg concentration in the input waste flow decreases the ph in the reactor which is obvious as a mg source is often added to induce p precipitation le corre et al 2007 hence less mg p precipitates are formed the effluent p concentration increases while the p recovery efficiency decreases increasing the p concentration in the input waste flow at a particular neutral to high ph increases the amount of p precipitates formed precipitation is driven by supersaturation decreasing the ph by decreasing the concentration of nutrients such as mg and ca in the input waste flow reduces the resulting fertilizer density and molecular weight fewer and less heavy p precipitates nrm strip decreasing the reactor height has no influence on the n recovery efficiency because the nh3 nh4 equilibrium between a gas bubble and the surrounding water is reached in a very small time interval gujer 2008 increasing the temperature increases the nh3 stripping performance wang et al 2007 hence lower effluent nh4 n concentrations and higher nh3 partial pressures in the gas phase are found the more nh3 is stripped out the lower the effluent ph increasing the liquid flow rate reduces the residence time in the system as such the slow formation of caco3 precipitates in the reactor is reduced and thus also the scaling potential nrm scrub decreasing the reactor height has no influence on the n recovery efficiency because the nh3 nh4 equilibrium between a gas bubble and the surrounding water is reached in a very small time interval gujer 2008 increasing the partial pressure of nh3 in the incoming gas phase coming from the stripper decreases the fertilizer alkalinity through nh2coo formation and increases the n concentration in the resulting ammonium sulfate solution hence more n can be recovered in an equal amount of time 
