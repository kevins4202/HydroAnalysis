index,text
4385,probabilistic hydrological forecasting and ensemble techniques have leveraged streamflow prediction at regional to continental scales up to several weeks in advance however ensembles that only account for meteorological forecast uncertainty are typically biased and subject to dispersion errors thus limiting their use for rational decision making and optimization systems statistical postprocessing is therefore necessary to convert ensemble forecasts into calibrated and sharp predictive distributions and it should also account for dependencies between lead times to enable realistic forecast trajectories this work provides a continental scale assessment of the use of statistical postprocessing on medium range ensemble streamflow forecasts over south america sa these forecasts were produced through a large scale hydrologic hydrodynamic model forced with a global precipitation dataset and ecmwf reforecast data the ensemble model output statistics emos technique was used to generate conditional predictive distributions in 488 locations at each forecast lead time while the ensemble copula coupling method with the transformation scheme ecc t was applied to derive ensemble traces from emos distributions postprocessed streamflow forecasts were cross validated for the period from 1996 to 2014 using a range of verification metrics results showed that the skill and reliability of emos forecasts substantially improve over the raw ensembles and that emos leads to skillful predictions relative to discharge climatology and persistence forecasts up to 15 days in advance in most locations furthermore emos results in predictive distributions that are generally sharper than the climatology limitations in depicting autocorrelations of forecast trajectories were observed in rivers for which the raw ensemble spread is very low and emos has to largely increase dispersion especially at short lead times the study s findings suggest that combining a continental scale hydrological model with emos and ecc t methods can lead to skillful predictions and realistic ensemble traces in several locations in sa even if in situ hydrometeorological observations are not available in real time keywords emos ecc south america ensemble forecasting post processing medium range 1 introduction medium range hydrological forecasts up to 15 days play a key role in decision making on water resources management and planning in south america sa such forecasts may help to increase awareness and anticipate extreme hydrometeorological events in large national and transnational basins siqueira et al 2020 to optimize energy production in reservoirs subject to flood control fan et al 2014 2016a schwanenberg et al 2015 and to define energy prices in the short term market reis et al 2020 over the past few years several studies have investigated the potential use of medium range ensembles to forecast streamflow in south american basins both for flood early warning systems and reservoir operation e g casagrande et al 2017 fan et al 2014 2016a 2016c meller et al 2014 raso et al 2014 siqueira et al 2016 tomasella et al 2019 the common approach of these studies is to force a hydrological model with meteorological predictions resulting from multiple realizations of one or more atmospheric models producing probabilistic outcomes that represent the likelihood of discharge exceeding a certain decision threshold e g for triggering actions or setting operation rules in reservoirs more recently ensemble hydrological forecasts have also been assessed at the level of full coverage of sa siqueira et al 2020 motivated by operational applications of continental to global scale forecasting systems around the world e g alfieri et al 2013 bennett et al 2014 demargne et al 2014 thielen et al 2009 continental to global ensemble forecasting systems are becoming increasingly popular aiming to deliver hydrological predictions at multiple timescales to support trans national forecasting capabilities emerton et al 2016 lavers et al 2020 even with the use of ensembles there will be uncertainties that are not accounted for in the issued hydrological forecasts for instance numerical weather models are often biased due to the incomplete representation of physical processes and they can integrate only a finite sample of the possible states of the atmosphere buizza et al 2005 hamill et al 2006 hydrological models in general are subject to errors in input data structure and parameterization renard et al 2010 while those focused on continental to global domains are less calibrated and typically have input data with coarser resolution and large uncertainties beck et al 2017a bierkens 2015 siqueira et al 2018 sperna weiland et al 2015 this causes hydrological ensemble forecasts to fail to provide reliable i e probabilistically unbiased estimates of the total uncertainty thus hampering their use for rational decision making statistical postprocessing is therefore necessary to correct model outputs and improve the skill and reliability of forecasts it can be used either to model errors from individual sources separately before aggregating them into a single predictive distribution demargne et al 2014 krzysztofowicz 1999 seo et al 2006 or to quantify the total uncertainty by modeling the residual errors of the whole forecasting chain in a lumped fashion montanari and grossi 2008 reggiani et al 2009 regonda et al 2013 todini 2008 weerts et al 2011 in the latter case hydrological forecasts and corresponding observations are used to fit a statistical model to estimate predictive uncertainty conditionally upon one or more predictors coccia and todini 2011 krzysztofowicz 1999 li et al 2017 todini 2008 producing probability density functions pdfs that must be as sharp as possible while subject to calibration i e statistical consistency between forecast pdfs and observed values gneiting et al 2007 raftery et al 2005 statistical postprocessors may also require homogeneous samples of streamflow forecasts collected over a long period of time and these can be achieved by using retrospective meteorological forecasts of the same atmospheric model cycle i e reforecasts as inputs to a hydrological model hamill et al 2006 harrigan et al 2020 reforecasts not only increase the chance of including very high or low flow events in training data van den bergh and roulin 2016 but also allow for the separation of data into subsets to refine training according to seasonal e g hemri et al 2015 or event based analogs e g hemri and klein 2017 initial efforts in statistical postprocessing of hydrological forecasts were made by krzysztofowicz 1999 who proposed a bayesian forecasting system to estimate predictive uncertainty through a deterministic hydrological model since then a plethora of methods have been developed or adapted for this purpose such as those based on parametric or nonparametric regression e g regonda et al 2013 weerts et al 2011 bayesian formulations applied to ensembles e g reggiani et al 2009 todini 2008 kernel dressing e g pagano et al 2013 verkade et al 2017 copula based functions e g klein et al 2016 madadgar et al 2014 autoregressive approaches e g bogner and pappenberger 2011 and combinations thereof see li et al 2017 for a detailed review there is no single postprocessing method that outperforms all the others in any case herr and krzysztofowicz 2015 li et al 2017 in addition to its effectiveness the ideal postprocessing method should be parsimonious and efficient in order to be applied in real time boucher et al 2015 seo et al 2006 the ensemble model output statistics emos gneiting et al 2005 for instance is a simple linear regression based method that has the advantage of using the raw ensemble spread as a predictor of the variance of predictive distributions the ability to incorporate the ensemble spread information is a general recommendation for hydrological uncertainty processors biondi and todini 2018 emos was initially designed for postprocessing weather quantities for which the pdf may be normally distributed such as temperature and pressure gneiting et al 2005 but has undergone adaptations for variables with skewed distributions like wind speed e g thorarinsdottir and gneiting 2010 precipitation e g baran and nemoda 2016 and streamflow e g baran et al 2019 hemri and klein 2017 hemri et al 2015 zhong et al 2020 moreover it has been shown that emos has the potential to postprocess ensemble streamflow forecasts not only in locations where data is available but also along the entire river network by making use of parameter regionalization approaches skøien et al 2016 as with most statistical postprocessing methods emos applies only for a single forecast quantity location and lead time this produces univariate pdfs that are marginally calibrated but do not preserve any spatial or temporal between lead times dependencies schefzik et al 2013 in turn postprocessed predictive distributions should be also given in the form of streamflow ensemble traces to allow their use as inputs for decision support systems including optimization models for reservoir management waterway operations and detailed hydrodynamic models for the prediction of flooded areas bellier et al 2018 engeland and steinsland 2014 hemri et al 2015 herr and krzysztofowicz 2010 realistic forecast trajectories that is time series that have correct autocorrelation and are unbiased bennett et al 2016 can be drawn from predictive distributions by using multivariate postprocessing methods that account for dependence structures such as empirical methods that follow reordering notions like the schaake shuffle clark et al 2004 and ensemble copula coupling ecc schefzik et al 2013 while the former uses observed data to model realistic spatial and temporal dependencies ecc relies only on the rank structure of the raw ensemble and has been applied in hydrological postprocessing as a multivariate extension for both emos e g hemri et al 2015 schefzik 2017 and bayesian model averaging bma e g bellier et al 2018 sharma et al 2019 the ecc approach is very attractive due to its simplicity and ability to handle high dimensionality problems e g large number of locations lead times while adding no computational cost beyond the univariate postprocessing schefzik et al 2013 most studies regarding statistical postprocessing of short to medium range hydrological forecasts have been carried out in regions with relatively good availability of real time hydrometeorological data applications typically are limited to a few or a dozen stations in small to medium sized basins up to few thousand km2 e g pagano et al 2013 roulin and vannitsem 2015 zalachori et al 2012 but some of them include medium to large catchment areas 10 000 km2 e g abaza et al 2017 hemri et al 2015 sharma et al 2018 siddique and mejia 2017 or also very large basins 100 000 km2 the latter usually in the rhine river in europe e g baran et al 2019 hemri and klein 2017 reggiani et al 2009 verkade et al 2017 although the use of statistical postprocessors has also been reported in continental scale forecasting systems as in the us e g demargne et al 2014 europe e g bogner and pappenberger 2011 thielen del pozo et al 2019 and australia e g bennett et al 2014 a comprehensive evaluation of such techniques over a large number of gauge stations drainage areas and hydrological regimes is not very common in the literature a few postprocessing studies consider these aspects but are focused on longer timescales e g woldemeskel et al 2018 or are restricted to quantification of hydrological uncertainty only alizadeh et al 2020 or evaluation of forecast skill improvement only zsoter et al 2016 in sa in particular there is a general lack of studies addressing this topic despite being a continent with great hydrological and climate diversity one challenge is that countries typically have sparse real time hydrometeorological networks often with short time series fan et al 2014 2015 salio et al 2015 tomasella et al 2019 which may place additional constraints on setting up and validating statistical postprocessors in hydrological forecasting systems integrating large scale hydrological models with global precipitation data e g satellite reanalysis or multiple sources may overcome some of these limitations because they allow for the production of spatially consistent streamflow forecasts for the entire river network alfieri et al 2013 siqueira et al 2020 and for multiple years in the past harrigan et al 2020 despite the well recognized large uncertainties of such approaches alfieri et al 2020 emerton et al 2016 li et al 2016 wu et al 2014 2020 zsoter et al 2016 thus a question emerges as to what extent statistical postprocessing would enable the obtainment of skillful and informative streamflow forecasts at the continental scale of sa that is forecasts that would translate into proper estimates of predictive uncertainty and also realistic ensemble traces to allow their use by multiple stakeholders addressing this question may help to foster probabilistic forecasting with state of the art meteorological and hydrological modeling techniques in sa where most of the existing systems still make use of pure statistical or deterministic forecasting models for predicting floods and planning the operation of hydropower plants fan et al 2016b tucci et al 2019 in this context the objective of this study is to investigate how emos contributes to the skill and reliability of continental scale medium range ensemble streamflow forecasts in sa and to assess the performance and limitations of ecc in producing forecast trajectories from emos predictive distributions the analysis is performed across hundreds of locations in sa using a continental hydrological model and reforecasts from the european center of medium range weather forecasting ecmwf the next sections are organized as follows section 2 provides information on the study area and observed data section 3 describes the methods used to produce ensemble streamflow forecasts general concepts about emos and ecc methods configurations adopted for postprocessing and strategies of forecast verification results are presented in section 4 while the discussion and main conclusions are offered in sections 5 and 6 respectively 2 study domain and streamflow data the study domain encompasses the south american continent the territory hosts some of the largest basins in the world such as the amazon 5 9 106 km2 and la plata 3 2 106 km2 most of them draining to the atlantic ocean as an effect of the n s oriented andes cordillera in the western part of the continent a particular focus is given to brazil which is the largest country by far almost 50 of the total land area and in which the majority of surface water resources in sa are concentrated the same observed discharge data as used by siqueira et al 2018 was selected for this study these data were collected from many hydrological centers in sa and consist of daily observed discharge in gauge stations and naturalized flows at reservoir locations for drainage areas larger than 10 000 km2 with few exceptions naturalized flows are those that would be observed at hydropower dam locations in the absence of upstream reservoirs and water withdrawals and are routinely provided by the brazilian national water agency ana and the brazilian national electric system operator ons a visual inspection was carried out to exclude gauge stations affected by reservoir regulation and only those with more than 10 years of data not necessarily consecutive were selected 488 gauges in total an overview of the political borders major hydrographic features and spatial distribution of gauge stations is shown in fig 1 while the drainage areas covered by the selected gauge stations are summarized in table 1 3 methods 3 1 modeling framework 3 1 1 mgb hydrological model mgb acronym of modelo de grandes bacias is a conceptual semi distributed hydrological model with a history of development focused on south american water issues collischonn et al 2007 and hydrological processes paiva et al 2013a it has been applied in many studies related to large sa river basins including works on the topic of ensemble hydrological forecasting e g fan et al 2014 2016a 2016c meller et al 2014 paiva et al 2012 siqueira et al 2016 2020 for this study the continental scale mgb model developed for the sa domain hereafter the mgb sa was chosen due to its enhanced discharge accuracy compared to global models siqueira et al 2018 aimed at producing streamflow forecasts to meet societal needs regarding the model structure mgb sa is discretized into 33 749 unit catchments with median p5 and p95 areas of 327 85 and 1322 km2 respectively each one containing a river segment with a fixed length equal to 15 km unit catchments are further subdivided into hydrological response units hru taking into account combinations of land use and soil type vertical hydrological processes e g soil water budget energy balance evapotranspiration are computed independently for each hru at a daily time step surface subsurface and groundwater runoff produced at the hru level are propagated to the unit catchment main channel using linear reservoirs and flow routing through drainage networks is computed using an explicit inertial approximation of 1d saint venant equations to deal with hydrodynamic effects associated with lowland rivers and floodplains for the latter mgb sa uses an adaptive time step usually 3 4 min to satisfy the courant friedrichs lewy cfl condition snow processes are not represented in the current model structure since the mgb was primarily developed for tropical regions mgb sa uses daily precipitation data from the 0 25 global multi source weighted ensemble precipitation mswep v1 1 beck et al 2017b and cru v 2 long term monthly means of other climatic variables temperature relative humidity radiation wind speed and pressure new et al 2002 as meteorological forcing calibration was performed manually for the period from 1990 to 2010 using observed data from 604 in situ gauge stations and the model was validated with several remote sensing datasets it was shown that mgb sa was able to reproduce daily discharges satisfactorily over several regions of south america 70 55 of the gauges with kge nse 0 6 fig 2 shows the spatial distribution of model performance nse regarding the locations selected for this study and further details about model datasets calibration and performance can be found in siqueira et al 2018 3 1 2 hydrological forecasting setup to produce raw ensemble streamflow forecasts precipitation reforecasts from the ecmwf integrated forecast system ifs were used the operational medium range monthly ensemble forecast component of ifs ecmwf ens consists of a 51 member ensemble control run 50 perturbed forecasts and horizontal resolutions of 16 km for lead times up to day 15 and 36 km onwards reforecasts are issued twice a week on mondays and thursdays for the same calendar day for the previous 20 years using the same ecmwf ens operational model cycle but with a reduced ensemble of 11 members for instance the reforecasts issued on march 10 2016 are 11 member hindcasts produced with initial conditions of march 10 1996 march 10 1997 and so forth until march 10 2015 ecmwf precipitation reforecasts issued between march 2016 and february 2017 were achieved with a grid of 0 2 0 2 resolution 6 h accumulated intervals and lead times up to 15 days although only the hindcasts from before january 2015 i e 1996 2014 were used due to the availability of mswep v1 1 precipitation data were first aggregated from 6 h to daily values and then interpolated to the mgb sa unit catchment centroids using the inverse distance squared weighting method to enable hydrological forecast initialization a long term mgb sa run was performed spanning from january 1990 to december 2014 and model state variables e g soil moisture volume of water in rivers and floodplains were saved for each day with available ecmwf reforecast data as in siqueira et al 2020 the cru v 2 monthly means of climatic variables other than precipitation used by mgb sa to compute evapotranspiration in simulation mode were also used as model inputs in the forecast mode 3 2 postprocessing of raw hydrological ensemble forecasts statistical postprocessing was conducted in two stages initially emos was applied to transform raw streamflow ensembles into univariate predictive distributions at each location forecast day and lead time afterwards the ecc method was used to extract forecast trajectories from the emos predictive distributions the postprocessing techniques and their assumptions are detailed in the following sections 3 2 1 ensemble model output statistics emos emos is a univariate nonhomogeneous regression based method that was proposed by gneiting et al 2005 the original formulation assumes that predictive densities are gaussian and the raw ensemble is a predictor of the variance of forecast errors for a given forecast variable location and lead time the parameters of the normal distribution n μ σ 2 are defined by the regression estimate and a linear function of the raw ensemble spread 1 μ a b 1 x 1 b 2 x 2 b m x m 2 σ 2 c d s 2 3 s 2 1 m m 1 m x m x 2 where µ and σ2 are respectively the mean and variance of the gaussian predictive distribution s2 is the spread of the raw ensemble forecasts xm is the forecasted value for the ensemble member m x is the ensemble mean of the raw hydrological forecasts m is the number of ensemble members a b c and d are parameters note that bm represents the weight of a given ensemble member for the regression estimate as the raw ensemble members derived by forcing the mgb sa model with ecmwf reforecasts individually lack distinguishable physical characteristics they are equally likely and belong to the same exchangeable group fraley et al 2010 that is they can be assumed to have the same weight therefore the notation of the normal predictive distribution can be written in terms of the ensemble mean according to 4 n μ σ 2 n a b x c d s 2 where x is the ensemble mean of the raw hydrological forecasts and n denotes the normal predictive distribution with mean equal to a b x and variance equal to c ds2 the regression estimate of eq 1 corrects for bias in the ensemble mean while the non static variance term eq 2 accounts for dispersion errors according to gneiting et al 2005 the parameters a b c and d of eq 4 can be fitted through the minimization of the continuous ranked probability score crps hersbach 2000 which is also one of the most used verification metrics to assess the performance of hydrological forecasts pappenberger et al 2015 while the assumption of gaussianity applies well for meteorological variables such as temperature and sea level pressure raftery et al 2005 it may not be applicable to river discharge since the latter typically follows a positive skewed distribution therefore hydrological forecasts and corresponding observations must be transformed to make the distributions as nearly normal as possible examples of commonly used transformations in the topic of hydrological postprocessing are the normal quantile transform e g bellier et al 2018 verkade et al 2017 weerts et al 2011 log sinh e g pagano et al 2013 wang et al 2012 and the box cox power transformation e g baran et al 2019 duan et al 2007 engeland and steinsland 2014 hemri and klein 2017 hemri et al 2015 madadgar and moradkhani 2014 qu et al 2017 here the box cox approach was applied according to 5 h x x λ 1 λ λ 0 log x λ 0 where h x is the box cox transformed variable x is the observed forecasted streamflow and λ is the box cox parameter the optimal λ value for each location can be found through a grid search with a pre defined range selecting the value that minimizes the kolmogorov smirnov statistics e g duan et al 2007 hemri et al 2015 the shapiro wilk test e g engeland and steinsland 2014 or the crps value e g baran et al 2019 hemri and klein 2017 however performing such a grid search in a continental domain that comprises a large number of locations is computationally expensive furthermore calibrating λ is not always a good choice since it is very sensitive to medium and low flows mcinerney et al 2017 woldemeskel et al 2018 showed that a box cox λ 0 2 performed reasonably well for monthly and seasonal forecasts across many gauges and different climate regions in australia by applying different transformations on discharges using a large set of french catchments berthet et al 2020 also suggested a box cox λ 0 2 as a robust choice for operational flood forecasting following the aforementioned studies a fixed value of λ 0 2 was set for applying the box cox transformation on observed forecasted values in all available locations emos models are fitted to the box cox transformed streamflow forecasts and the resulting quantiles are back transformed to finally produce univariate predictive distributions however hemri et al 2015 state that emos sometimes produces positive probabilities for unrealistic high and low flows after back transformation therefore a variant of the truncated emos model presented by thorarinsdottir and gneiting 2010 was adopted following hemri and klein 2017 and baran et al 2019 in which both left and right tails of the gaussian distribution are truncated at half of the minimum and two times the maximum observed flow during the hindcast period respectively the cumulative distribution function cdf f of the double truncated gaussian n α β μ σ 2 is then described as follows 6 f y 0 f o r y α φ y μ σ φ α μ σ φ β μ σ φ α μ σ f o r α y β 1 f o r y β where y denotes the variable to be forecasted φ denotes the cdf of the standard normal distribution α and β are truncation limits corresponding to the half of minimum and two times the maximum observed flow between march 1996 and december 2014 respectively for simplicity the double truncated emos is referred to hereafter as emos 3 2 2 ensemble copula coupling ecc emos estimates a continuous predictive distribution for a given forecast variable lead time and location therefore a multivariate postprocessing method must be also applied in order to produce coherent forecast trajectories here the ecc technique schefzik 2017 schefzik et al 2013 was used because of its simplicity and low computational burden which makes it attractive for modeling multivariate dependencies in such a large continental domain in a nutshell the ecc inherits the rank order structure from the raw ensemble with the implicit assumption that the latter is able to represent the correlations between forecasted variables lead times and locations appropriately as this study deals only with river discharge as a forecast quantity let k j l be a multi index that summarizes a forecast lead time j 1 j and a location l 1 l and let k be the dimension of the vector consisting of all lead times and locations i e k j l for a given forecast date the set of k raw ensembles with m members x 1 x m are defined as a dependence template z x 1 1 x m 1 x 1 k x m k where the subscript indices 1 m are unique member labels that do not change across the j lead times since each univariate emos predictive density can be described by a cumulative distribution function cdf fk the multivariate problem is solved by drawing samples from these distributions and reordering them according to the rank order of the dependence template zk by definition the number of samples derived from each univariate quantity should be equal to the number of elements of zk which implies that the multivariate postprocessed ensemble will have the same size m of the raw hydrological ensemble schefzik et al 2013 present three variants of the ecc method for the sampling reordering procedure namely ecc r random sampling ecc q equally spaced quantiles and ecc t transformation according to hemri et al 2015 the t variant is the most suitable approach since it reduces jumps in the trajectories of predicted discharges which is particularly important for the case of strongly autocorrelated river flows for the ecc t a parametric continuous cdf sk is fitted to the dependence template zk and the postprocessed ensemble x k x 1 k x m k is derived by determining to which quantiles of sk the raw ensemble members correspond before mapping them to the quantiles of emos cdf fk this is performed after the template zk is box cox transformed as the sk is assumed to be normally distributed bellier et al 2018 hemri and klein 2017 hemri et al 2015 the cdf sk is fitted using maximum likelihood estimation assuming a gaussian distribution note that the rank dependence of the postprocessed ensemble is automatically preserved according to the dependence template z that is the reordering step occurs naturally through the quantile mapping procedure of ecc t schefzik 2017 the postprocessing of hydrological forecasts is summarized in the flowchart presented in fig 3 in cases where the raw ensemble spread is too low an additional correction is made to avoid unrealistically extreme quantiles by setting the variance of sk to hemri et al 2015 7 σ k 2 m a x σ k 2 h 1 d x k h 1 d x k 2 where σ k 2 is the variance of sk h denotes de box cox transformation x k is the raw ensemble mean k is the index related to a given location and lead time and d is a parameter to be tuned while other authors have adopted values of 0 001 hemri et al 2015 and 0 0001 bellier et al 2018 for the d parameter here d was set to 0 005 based on previous experience and a sensitivity analysis was performed since it affects the forecasted ensemble traces and their calibration supplementary material s 1 3 3 experiment setup 3 3 1 training emos models and deriving ensemble forecast trajectories as most of the rivers of south america have a well defined seasonal pattern the emos models were trained for each location and lead time using subsets of data according to the season djf mam jja and son a leave one year out cross validation was applied in a similar way to other postprocessing studies e g fundel and zappa 2011 hemri et al 2015 verkade et al 2017 in order to maximize the verification period and to carry out a robust statistical analysis for instance parameters of the emos model that correspond to djf of validation year 2010 were fitted using training data from djf for all years except the target one i e 2010 in addition emos parameters across lead times were further smoothed using a cubic spline interpolation this was necessary to reduce undesirable jumps in the quantiles of the marginal predictive distributions between individual lead times bellier et al 2018 hemri et al 2015 and was performed before applying the ecc t to produce forecast trajectories the same procedure was applied for all seasons and years spanning from march 1996 to december 2014 finally postprocessed forecasts resulting from the validation years were merged together in order to cover all the reforecast period for training the emos models applying parameter smoothing between lead times and deriving forecast trajectories with ecc t the r software r core team 2013 with the package called hydemos klein and hemri 2017 was used note that data assimilation or autoregressive models were not applied to adjust the initial forecast values prior to the postprocessing step the objective was to reproduce the simplest operational settings in which real time observed flows are not readily available to the continental scale forecasting system 3 3 2 verification strategy the general aim of postprocessing is to provide forecasts that are as sharp as possible subject to calibration gneiting et al 2007 raftery et al 2005 it may also preserve the predictive skill of raw forecasts li et al 2017 and allow the generation of coherent ensemble traces bellier et al 2018 herr and krzysztofowicz 2010 schefzik et al 2013 to evaluate the postprocessing performance a set of metrics in geographic space were analyzed for different lead times and flow conditions and a visual inspection of forecast hydrographs and graphical measures of forecast attributes was carried out at specific locations to allow for a direct comparison between emos distributions and ensemble streamflow forecasts i e raw and emos ecc t 11 members for each forecast day were derived by drawing m equally spaced samples from the univariate emos predictive cdfs f k 1 1 m 1 f k 1 2 m 1 f k 1 m m 1 the evaluation of forecast skill is generally performed against benchmarks that is alternative forecasts that use simpler strategies of predicting flows such as climatology or persistence of the last observed discharge the former is more appropriate for longer lead times since the forecast signal tends to be controlled by the seasonality of flows whereas the latter is recommended for shorter lead times where the forecast signal is controlled by serial correlation of flows harrigan et al 2020 pappenberger et al 2015 as the study area encompasses multiple catchment characteristics and flow regimes and because forecast lead times are considered up to 15 days ahead both climatology and persistence are used here as benchmarks discharge climatology was calculated by resampling observed data within the reforecast period for the target calendar day and using the leave one year out procedure to exclude data from climatology that correspond to the evaluated year persistence was computed by simply assuming the most recent observation available at the time of issuing a forecast for all lead times predictive skill can be quantified using scoring rules such as the crps hersbach 2000 it summarizes calibration and sharpness of a probabilistic forecast into a single overall score expressed as a mean of all individual crps values 8 c r p s 1 n f y f 0 y 2 d y 9 f 0 y 0 y o b s e r v e d v a l u e 1 y o b s e r v e d v a l u e where f y is the cdf of the ensemble forecast y and f0 y is the heaviside step function that equals one when forecast values are greater than the observed value and zero otherwise c r p s is then converted into an overall skill score according to crpss 1 c r p s forecast c r p s reference using both daily climatology and persistence of the last observed discharge as reference for the specific case of persistence i e a deterministic forecast c r p s reduces to the mean absolute error maximum skill is achieved when crpss 1 forecast calibration or reliability is analyzed by means of the rank histogram anderson 1996 it is closely related to the probability integral transform pit histogram used to assess the calibration of predictive distributions gneiting et al 2007 with the difference that it applies to the discrete case of ensembles rank histograms describe the proportion of observations falling in a given forecast probability interval each one defined between two consecutive ensemble members a horizontally flat histogram indicates a well calibrated ensemble u shaped histograms indicate underdispersion whereas u inverted ones represent overdispersion moreover histograms with an l shaped or l inverted pattern are indicative of positive or negative bias respectively the information provided by the rank histogram can be also summarized by the reliability index ri delle monache et al 2006 which expresses the deviation from flatness 10 ri i 1 m 1 ξ i 1 m 1 where ξ i is the frequency of observations in bin i and m is the number of ensemble members an ri 0 would result in perfect calibration to provide further details on forecast calibration we computed the proportion of observations falling within the nominal coverage of the raw ensemble i e the interval between the upper and lower member which is given by the m 1 m 1 100 centered prediction intervals baran et al 2019 for an 11 member ensemble the nominal coverage refers to the 83 3 centered prediction intervals that should be matched by the actual ensemble coverage denoted here by the coverage rate cr 11 c nc c where c is the number of observations falling inside the ensemble range and nc is the number of observations not captured by the ensemble sharpness is a property of the forecasts only and refers to the width of predictive distributions gneiting et al 2007 sharper forecasts have more concentrated prediction intervals lower spread in the case of ensembles and thus greater ability to forecast extreme probabilities near 0 and 100 sharpness is given here in terms of an average spread computed as the square root of mean variance fortin et al 2014 roulin and vannitsem 2015 12 s 1 n i 1 n m 1 m x m i x i 2 m where n is the number of forecasts issued m is the number of ensemble members xm i is the streamflow for the ensemble member m and forecast day i and x i is the ensemble mean for forecast day i similarly to crps sharpness can assume the form of a skill score when computed against daily climatology ss 1 s forecast s climatology maximum sharpness skill occurs for an ss 1 to investigate whether the individual ensemble traces from emos ecc t are able to represent the serial dependence of hydrological forecasts i e produce trajectories that are realistic across lead times the auto correlation function acf of emos ecc t was compared to the acf of the raw ensemble as suggested by bellier et al 2018 firstly the forecast values were transformed into series of lag one differences to remove seasonality and trends the resulting multiple series samples m ensemble traces n forecast dates were concatenated to compute acf but ensuring that pairs from different samples were excluded from the calculation moreover to summarize the acf into a single score the area between acf curves acfarea was also calculated using a trapezium approach where an area 0 indicates perfect match similarly to sharpness the acf is a property of the forecasts only 4 results 4 1 forecast hydrographs and emos distributions the analysis of hydrological forecasts starts with a closer look at the corresponding hydrographs and postprocessed predictive distributions examples of ensemble streamflow forecasts with lead times up to 15 days ahead produced by the mgb sa forced with ecmwf reforecasts in selected locations hydropower reservoirs of the brazilian national interconnected system sin and for a particular date are presented in fig 4 postprocessing results are shown in the form of emos probabilities for the centered prediction intervals of 90 5 95 and 50 25 75 and also in the form of ensemble traces derived from the predictive distributions of emos after applying the ecc t method it is worth mentioning that the emos quantiles that correspond to the above centered prediction intervals are used here only for plotting purposes which differ from the 11 equally spaced quantiles of emos that were selected for verification in the later sections observed flows for the locations in fig 4 refer to naturalized river flows while the selected forecast dates represent cases of flood events in which discharges are 2 year return period flows additional graphs of extended forecast time series at these locations are available in the supplementary material s 2 as noted hydrological behavior varies greatly between locations some of these show a rapid rise in the hydrograph e g itá at uruguay river fig 4 1 while others exhibit a slower variation of flows e g teles pires at teles pires river fig 4 9 the raw ensemble is able to predict the occurrence of high flows in most cases but tends to partially capture the observed discharges when looking to the postprocessed forecasts observations usually fall within the emos centered prediction intervals of 5 95 because streamflow forecasts are issued without further correction by data assimilation or autoregressive models predicted discharges that are close to the forecast initialization day are often displaced in relation to the observed values notably in três marias são francisco river fig 4 6 and lajeado tocantins river fig 4 8 as a result the predictive uncertainty estimated by emos postprocessing can be relatively large even at the initial lead times the forecast trajectories obtained with the ecc t maintain the rank order structure of the raw ensemble but generally increase the ensemble spread in relation to the latter in some cases such as itá salto santiago iguazu river fig 4 2 itaipu paraná river fig 4 3 lajeado and aimorés doce river fig 4 5 there is good agreement between the postprocessed forecast trajectories and those from the raw ensemble but in other locations e g furnas at grande river fig 4 4 boa esperança at parnaíba river fig 4 7 and teles pires the ensemble traces tend to demonstrate a more distinct behavior 4 2 spatial assessment of forecast skill overall quality and sharpness in order to assess the forecast skill the raw ensemble emos and emos ecc t were compared with the reference forecasts in terms of crpss and sharpness skill ss considering a lead time of seven days fig 5 at the top shows the results of crpss of hydrological forecasts computed against the persistence pers of the last observed discharge the crpsspers of raw forecasts has a clear heterogeneous pattern where skillful predictions are more concentrated in the eastern and southeastern sa negative crpsspers values are observed mainly in central and western regions of sa notably in large basins such as the amazon orinoco tocantins araguaia and paraguay west of la plata and also along the são francisco basin in eastern sa this indicates that the overall quality of the raw ensemble is lower than the benchmark at these locations with respect to streamflow forecasts issued for one week ahead emos postprocessing improves the overall skill in relation to the raw ensemble and demonstrates a positive crpsspers in eastern sa as well as in most western regions in addition the spatial pattern of the overall performance of postprocessed forecasts in sa does not change after the derivation of ensemble traces with the ecc t method when the overall skill is computed against the daily streamflow climatology fig 5 bottom the geographical distribution of crpsscli values for raw and postprocessed forecasts resembles that found in the case with persistence as the reference however clear differences between emoscli and emospers are notable in the main stem of large rivers like the amazon and paraguay as well as in the lower magdalena basin and araguaia river west of the tocantins araguaia basin fig 6 shows the sharpness skill ss values spatially distributed over the gauge stations in sa unlike crpss forecasts are compared only with daily climatology since a deterministic benchmark such as the persistence does not provide uncertainty information as expected the raw ensemble exhibits the highest sharpness ss generally 0 6 emos postprocessing generally degrades the skill of the raw ensemble but it still demonstrates greater sharpness than daily climatology this reduction in skill tends to be larger in some specific regions such as the amazon northern sa and western la plata basin e g the paraguay river furthermore the application of ecc t slightly reduces the sharpness skill of emos in most of the gauges although ss values are higher in locations where the flood rise is very slow e g the main stem of the amazon 4 3 spatial assessment of forecast calibration to evaluate forecast calibration first the rank histograms were plotted for the selected locations considering a lead time of seven days fig 7 results obtained for the raw ensemble emos and emos ecc t are separated by the colored vertical bars in the histograms each ensemble interval is represented by a rank with the tails of the histograms representing the observations lying below the lower or above the upper member of the ensemble ri values that summarize the calibration performance are also shown for each rank histogram the diagrams clearly show that the frequency of observations at intermediate probabilities is very low in the case of raw ensemble forecasts that is the latter are markedly unreliable with high ri values ranging between 0 58 and 1 78 in specific cases located in southern brazil such as in the itá and salto santiago reservoirs the rank histograms indicate that raw forecasts are underspread u shaped histograms while in the other analyzed locations there is a tendency of the observations to fall below the lower limit of the ensemble i e a signal of large conditional positive bias given by the l shaped histograms on the other hand emos postprocessing fosters a better calibration of the forecast ensemble producing rank histograms that are approximately flat with low values of ri varying between 0 07 and 0 2 with observed frequencies remarkably close to the perfect reliability line 1 m 1 except for itá and salto santiago the emos ecc t reduces the improvement gained in calibration in comparison with emos which is highlighted by the higher values of ri between 0 11 and 0 51 figs 8 and 9 show respectively the values of ri and cr plotted over sa for a lead time of seven days for the raw ensemble most ri values are very large usually 1 which indicates that there is little or no agreement between the forecasted probabilities and relative observed frequencies of river discharges the lack of calibration is reflected in the underestimation of cr values with the ensemble coverage usually capturing less than 30 of observations in the verification period this means that observed values are often lying outside the limits of the ensemble on the other hand the statistical consistency of the emos postprocessed forecasts previously identified in the rank histograms of fig 7 seems to occur in most of the gauge stations ri values closer to 0 globally with the exception of a few locations in northeast brazil characterized by intermittent flows the frequency of observations falling between the upper and lower limits of the ensemble derived from univariate emos is also very close to the expected value of 83 3 for the case of emos ecc t the improvement in forecast calibration is reduced in several gauges when compared with the univariate emos postprocessing in particular calibration with emos ecc t is notably lower in the são francisco tocantins araguaia parnaíba and northern la plata upper paraguay basins ri between 0 5 and 1 0 and cr ranging from 50 to 60 and exhibits a poor performance in the main stem of the amazon ri 1 0 and cr 30 4 4 forecast performance according to lead time fig 10 shows the performance of the streamflow forecasts as a function of lead time results were plotted in a summarized manner and refer to the median of verifying gauge stations throughout sa while the raw ensemble shows crpss values below the no skill line over the entire forecast horizon against climatology and exhibits overall skill relative to the persistence benchmark only after 10 days ahead postprocessed forecasts anticipate the latter by approximately six days also showing positive crpss values in relation to climatology ranging between 0 2 and 0 4 in contrast the median ss is the highest for the raw ensemble at the 1 day lead time ss close to 1 but the differences of ss between raw and postprocessed forecasts gradually reduce in the subsequent lead times although emos degrades the ss compared to the raw ensemble in more than 50 of the gauges it outperforms the skill of daily climatology along the entire forecast horizon while providing a well calibrated ensemble for example low values of ri that were identified for one week ahead over multiple gauges in sa fig 8 are also observed in the other lead times with almost no change in the median relatively constant ri 0 2 whereas the corresponding cr is kept systematically close to the nominal coverage of 83 3 the application of multivariate ecc t on emos has a small effect on the overall skill measured by the crpss both for climatology and persistence compared with the univariate postprocessing but for calibration and sharpness the differences are more apparent and vary with lead time performances of emos ecc t closer to those obtained from univariate emos are achieved only more than 10 days in advance but at the cost of a larger ensemble spread as explained by the lower median ss 4 5 forecast performance according to flow conditions performance metrics for different flow categories at the lead time of seven days are given in the box plots of fig 11 results are shown for the entire verification period and also for subsets of the verification data conditioned on forecasts both for low to moderate q50 and high forecasted discharges q90 of non exceedance flows the analysis was conditioned on forecasts using the ensemble mean as the stratification criterion that is the subsets of verification data are given for the cases in which the ensemble mean exceeds or is below its forecast climatological probabilities of 90 q90 and 50 q50 respectively these climatological probabilities of the ensemble mean were computed using all available forecast dates and the evaluation was performed separately for each lead time the forecast based data stratification is recommended over the observed conditioning since the latter can lead to non flat histograms for calibrated forecasts bellier et al 2017 for the case of low to moderate forecasted flows q50 postprocessing results tend to be similar or slightly better than the ones found for the entire verification data except for emos ecc t when looking at calibration on the other hand differences in performance are generally more visible for high forecasted discharges q90 for instance the overall skill of postprocessed ensembles decreases substantially when compared with daily climatology reaching median values slightly above the no skill line despite emos and emos ecc t still exhibiting positive ss values for the q90 condition in most locations sharpness is reduced and the ensemble spread becomes closer to that of climatology regarding calibration the statistical consistency of emos decreases while the emos ecc t increases compared with the entire verification data and the range of ri values in both cases becomes similar with median ri around 0 3 the same pattern is observed for the cr with median values of coverage close to 80 box plots also indicate that over dispersive forecasts are more likely to occur for the q90 condition after postprocessing since more than 25 of cr values lie above the nominal coverage of 83 3 4 6 evaluation of the ensemble traces derived using ecc t this section explores the performance of the ecc t for extracting realistic forecasting trajectories from the emos predictive distributions fig 12 shows the resulting acf of the lag one differences of forecasted discharges plotted for the selected locations both for the raw ensemble i e the reference acf expressed by acfref and emos ecc t acfemos ecc t the agreement between both acfs is summarized by the area between the curves shown in each diagram unlike a metric or graphic measure that evaluates the univariate performance for a single lead time the acfarea is an aggregated result for all lead times within the forecast horizon in some locations such as the itá salto santiago and aimorés reservoirs acfemos ecc t and acfref are almost identical with acfarea ranging between 0 08 and 0 24 the rapid decrease in acf in these cases is indicative of larger fluctuations in the predicted flows in addition emos ecc t also produces an acf relatively close to the reference in itaipu and lajeado acfarea 0 8 while larger differences occur in the other analyzed locations with acfarea ranging between 1 65 and 2 83 respectively in furnas and teles pires postprocessed forecast trajectories tend to perform worse in locations for which the raw ensemble exhibits stronger autocorrelations in forecast time series to provide broader insight into the behavior of forecast trajectories derived using ecc t the areas between the acfemos ecc t and acfref curves were plotted for the analyzed gauge stations in sa fig 13 the spatial distribution of acfarea shows that emos ecc t performance varies largely across the continent for instance acfarea values are relatively low in most of la plata basin usually in the eastern region drained by the upper paraná and uruguay rivers generally reaching magnitudes less than 0 5 similar performances by emos ecc t are also found in large basins such as parnaíba and tocantins on the eastern side of the tocantins araguaia basin except at locations characterized by large reservoirs e g boa esperança in parnaíba basin in turn a low agreement between raw and postprocessed acf curves with a very high acfarea generally 2 0 is observed in much of the amazon basin and also in areas affected by floodplains where the raw ensemble spread is expected to be low for lead times up to 15 days in advance this is the case for the araguaia river on the western side of tocantins araguaia basin upper paraguay and lower magdalena to analyze the effect of the raw ensemble spread on emos ecc t forecast trajectories the sharpness skill ss of both the raw ensemble and emos were plotted against the acfarea fig 14 as can be clearly observed gauges with large acfarea values tend to be concentrated at the top of the diagrams this means that the autocorrelation in forecast time series is not well depicted by ecc t when the raw ensemble has very low spread ssraw close to 1 at the same time that emos has to largely increase dispersion ssemos usually 0 7 this effect is more pronounced at shorter leads because of the delayed response of streamflow to predicted precipitation and it undermines the extraction of coherent forecast trajectories as it favors unrealistic jumps during the quantile mapping procedure of ecc t 5 discussion as shown in the previous sections raw ensemble streamflow forecasts issued from a continental scale forecasting system can often lead to lower overall performance than that of simpler alternatives like daily climatology or persistence forecasts from a spatial point of view the lack of skill regarding the raw ensemble was identified in a considerable number of gauge stations located mainly in central to western tropical regions of sa negative values of crpss were noted also in large basins in such regions although other studies have shown that forecast skill typically increases with basin size alfieri et al 2014 pappenberger et al 2011 siddique and mejia 2017 it should be noted that the assessment of forecast skill is here performed in south american basins that can reach up to hundreds of thousands or even millions of square kilometers encompassing distinct geographic regions multiple hydroclimatic features and flow regimes ranging from highly variable year round to unimodal flood peak regimes benchmarks for instance may perform better when the seasonality or serial correlation of discharges is strong thus streamflow forecast skill is expected to be lower in these situations even in large basins forecast skill is also closely linked to the hydrological model performance and it is likely that crpss would increase with catchment area in some of these regions if hydrological initial conditions were more evenly and well estimated across the continent siqueira et al 2020 this is not the case as simulated discharges perform very differently in space due to limitations in process representation model calibration and variations in quality of rainfall estimates mswep used for forecast initialization in addition predicted precipitation often dictates the skill of streamflow forecasts especially at longer lead times the contribution of skill coming from ecmwf rainfall prediction has been found to be spatially dependent in sa exhibiting higher skill in eastern and southeastern regions but lower skill in the amazon and western areas close to the andes cordillera medina et al 2019 siqueira et al 2020 by assessing calibration low ensemble coverage rates and large deviations from horizontally flat rank histograms were systematically found which clearly indicates that raw streamflow forecasts are far from being samples from the true pdfs even at longer lead times such as one week ahead the emos postprocessor substantially improved the skill and statistical consistency of raw hydrological forecasts also leading to narrower uncertainty ranges in relation to climatology in most of the analyzed gauge stations in some regions such as the amazon northern sa and western la plata larger reductions of sharpness skill in relation to other areas were observed after postprocessing this probably occurs because streamflow forecasts i are being affected by the low skill of predicted precipitation mainly indicated by low crpsscli in fig 5 at the bottom center or ii have almost no spread in the raw ensemble mainly indicated by low crpsspers in fig 5 at the top center these factors may result in a high frequency of large random errors in streamflow forecasts after bias correction eq 1 consequently leading to a larger increase in the width of emos predictive distributions in order to appropriately calibrate forecasts furthermore simulated discharges in these areas are often subject to significant timing errors paiva et al 2013a siqueira et al 2018 delayed or advanced in time flows are expected to contribute to non systematic errors e g underestimation during rising flows and overestimation during hydrograph recession or vice versa and could be also one of the reasons for the degradation of sharpness skill it is worth noting that despite the postprocessed forecasts are generally less sharp than the raw ensembles the number of locations with ssemos ssraw tends to increase with lead time as indicated in fig 14 this means that emos can contribute positively to sharpness to some extent by reducing the average spread of raw forecasts especially at longer leads a sample reordering method such as the ecc is an interesting way to extract forecast trajectories from postprocessed distributions combining emos and ecc techniques for medium range streamflow forecasting can be promising especially in some regions of sa such as the la plata basin this is important since hydropower in la plata plays a key role in energy production for many south american countries popescu et al 2012 this study s assessment is the first that demonstrates the applicability of emos and ecc methods for streamflow forecasting on a very large scale using approaches and global datasets that are potentially available for less developed regions once the parameters of emos models are adjusted predictive distributions and postprocessed ensemble traces could be easily obtained for hundreds of gauge stations across the sa continent nonetheless some considerations must be outlined here the performance of emos depends on how close the forecasting errors are normally distributed recent studies have shown that data transformations e g box cox or any others can stabilize the variance of errors in a forecasting context although normal distributions are difficult to achieve in practice berthet et al 2020 this may be even more difficult when dealing with different hydrological regimes occurring in a large domain such as sa it was found that in general applying the ecc with the t sampling scheme on emos predictive densities causes little impact on the overall skill of emos on the other hand it reduces the calibration obtained from univariate postprocessing which is consistent with previous findings bellier et al 2018 hemri et al 2015 the loss of calibration may be attributed to the sampling levels of ecc t which are not equally spaced as they are connected to the raw ensemble another important consideration is that the ecc strongly depends on the ability of the model used to simulate the real system schefzik et al 2013 this imposes additional limitations for continental domains such as sa since large scale hydrological models usually have coarse resolutions regarding model discretization input data etc and are likely to provide a lower performance than the ones tailored for specific basins in this context fleischmann et al 2020 identified artefacts causing excessive attenuation in simulated flows at large reservoirs e g três marias which can occur not only in mgb sa but also in any other large scale model with hydrodynamic routing this artificially reduces the spread in the raw ensemble and may lead to a lower performance of ecc t as indicated from the experiments the ability of ecc t to recover temporal dependencies and derive realistic ensemble traces from emos postprocessing vary from one place to another for instance substantial differences between the acf curves of emos ecc t and raw ensemble were observed in areas such as the amazon and upper paraguay time series of forecasted streamflow in these regions are more strongly correlated due to longer travel times and slow propagation in rivers as the flow routing is subject to delay effects caused by floodplain storage processes paiva et al 2013a paz et al 2011 pontes et al 2017 siqueira et al 2018 yamazaki et al 2011 as a result streamflow predictability in large sa rivers is often dominated by initial hydrological conditions rather than predicted precipitation even for some weeks ahead paiva et al 2012 as the predicted rainfall is the only uncertainty source cascaded to the raw streamflow ensemble the corresponding spread in the aforementioned cases is expected to be systematically low which consequently provides little information on emos variance besides in ecc t the quantiles from the raw ensemble are mapped to emos predictive distributions which means that some members may be linked to very low probabilities at low ensemble spread conditions producing unrealistic jumps in forecast trajectories hemri et al 2015 increasing the minimum variance of the normal distribution that is fitted to the raw ensemble sk may help to reduce these jumps between lead times albeit at the cost of additional loss of calibration see supplementary material s 1 performing data assimilation prior to emos postprocessing would be more appropriate and necessary for narrowing the predictive uncertainty consequently improving the forecast trajectories finally both the skill of postprocessed forecasts and the generation of ensemble traces could be further improved by making use of variants of emos and ecc methods one possibility is to fit emos models using subsets of training data according to forecast analogs hemri and klein 2017 which can take advantage of long past hydrological ensemble predictions based on meteorological reforecasts the use of analog based training periods has been shown to make the skill of emos predictive distributions comparable to those generated by more sophisticated postprocessing techniques like bma for example baran et al 2019 regarding ecc t random perturbations could be made to the dependence template to improve the fits of the corresponding cdf s in low spread conditions bellier et al 2018 another option would be to apply trajectory smoothing over ensemble traces produced with ecc q i e the equally spaced sampling instead of using the ecc t method which could handle the known strong fluctuations jumps of the former while improving the calibration over the t scheme bellier et al 2018 in addition a temporal component could be introduced into the ecc template by using past data statistics thus enabling it to account for the autocorrelation of the forecast error between consecutive lead times ben bouallègue et al 2016 although testing these variants is beyond the scope of this study assessing their suitability for a continental scale forecasting system is also of great interest and could be the subject of future work 6 conclusions and outlook this work provides a comprehensive evaluation of the use of statistical postprocessing on medium range ensemble streamflow forecasts up to 15 days ahead over south america sa forecasts were produced through a continental scale hydrologic hydrodynamic model forced with a global precipitation dataset and reforecasts from the ecmwf ensemble prediction system eps the ensemble model output statistics emos method was used to convert the raw ensemble into predictive distributions for each location forecast day and lead time additionally ensemble copula coupling with the transformation scheme ecc t was applied to derive ensemble traces from emos distributions a set of metrics was used to assess skill calibration and sharpness of raw and postprocessed forecasts against simpler forecasting alternatives such as daily climatology and persistence and the capacity of generating realistic postprocessed forecast trajectories was also evaluated the assessment was carried out for hundreds of gauge stations spread throughout sa the main conclusions can be summarized as follows raw ensemble streamflow forecasts issued by a continental scale hydrological model in sa do not necessarily offer better results in comparison with simpler alternatives such as daily climatology and persistence of the last observed flows while raw ensembles may exhibit some skill in southeastern and eastern regions except são francisco basin for one week in advance generally no skill was found in large basins such as the amazon orinoco tocantins araguaia and west of la plata paraguay by applying emos postprocessing the forecast skill over climatology improved in most locations up to 15 days ahead and skill over persistence was generally observed after four days in advance raw ensemble streamflow forecasts were markedly unreliable in most of the gauge stations even for lead times of one week ahead usually less than 30 of observations were captured by the ensemble emos postprocessing generally increases the spread of raw forecasts and also improves the statistical consistency between forecasted probabilities and observed relative frequencies along the entire forecast horizon however emos was not able to produce skillful forecasts in large rivers where initial hydrological conditions may largely contribute to streamflow predictability emos provided streamflow forecasts that were usually less sharp than the raw ensembles however the differences in average spread between both approaches reduced with lead time with emos exhibiting better sharpness in several locations at longer leads in addition emos resulted in skillful predictions in terms of width of predictive distribution when compared to discharge climatology generating ensemble traces from emos distributions by applying the ecc t method caused little impact on the overall skill achieved by univariate postprocessing however both sharpness skill and improvement in calibration were reduced in comparison with univariate emos especially at shorter leads with differences being smaller for increasing lead times when verification was conditioned on high forecasted discharges ensemble mean non exceedance probabilities of 90 the overall skill sharpness skill and also calibration gained with emos postprocessing decreased in comparison with the results obtained from the entire verification data while the ability of ecc t to represent the autocorrelation of forecasted streamflow was variable in space a relatively good performance was observed mainly in the eastern la plata basin in general limitations for generating realistic forecast trajectories were observed in rivers for which the raw ensemble spread is very low and emos has to largely increase dispersion especially at short lead times for such locations more real time discharge observations may be required for performing further corrections in order to reduce the width of emos distributions the findings of this study suggest that skillful medium range streamflow forecasts could be achieved at the continental scale of sa even if global precipitation data have to be used to initialize the hydrological model future research paths should include assessing the utility of this forecast framework for particular applications e g flood forecast hydropower reservoir operation moreover a further important step in improving the performance of such forecasts is through data assimilation da of river discharge experiments using the mgb sa model and da are ongoing e g wongchuig et al 2019 and the benefits of implementing da together with statistical postprocessing will likely be explored in the near future of course given the large domain of interest performing da would be a great challenge due to the amount of good quality river discharge observations required which are often not available in real time assimilating other sources of data such as the ones derived from remote sensing e g radar altimetry flood extent e g paiva et al 2013b wongchuig et al 2020 can be also a promising way to improve forecasting capabilities in south american countries credit authorship contribution statement vinícius alencar siqueira conceptualization methodology software formal analysis investigation visualization writing original draft writing review editing albrecht weerts supervision conceptualization resources writing review editing bastian klein software writing review editing fernando mainardi fan writing review editing rodrigo cauduro dias paiva conceptualization writing review editing walter collischonn conceptualization supervision writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the first author would like to acknowledge the brazilian coordination for the improvement of higher education personnel capes under grant number 88881 189000 2018 01 capes pdse programa de doutorado sanduíche no exterior and the brazilian national council for scientific research cnpq under grant numbers 141450 2015 and 422422 2016 project south america flood awareness system safas for the financial support we also acknowledge all the hydrological centers that provided observed discharge data ana ons ideam dga grdc ina hybam senamhis princeton university for the mswep precipitation data and the european center of medium range weather forecast ecmwf for making available the reforecast data used in this study finally we thank jan verkade for the support given during the development of this work and the two anonymous reviewers for their useful suggestions which helped us to improve the quality of this manuscript appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2021 126520 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
4385,probabilistic hydrological forecasting and ensemble techniques have leveraged streamflow prediction at regional to continental scales up to several weeks in advance however ensembles that only account for meteorological forecast uncertainty are typically biased and subject to dispersion errors thus limiting their use for rational decision making and optimization systems statistical postprocessing is therefore necessary to convert ensemble forecasts into calibrated and sharp predictive distributions and it should also account for dependencies between lead times to enable realistic forecast trajectories this work provides a continental scale assessment of the use of statistical postprocessing on medium range ensemble streamflow forecasts over south america sa these forecasts were produced through a large scale hydrologic hydrodynamic model forced with a global precipitation dataset and ecmwf reforecast data the ensemble model output statistics emos technique was used to generate conditional predictive distributions in 488 locations at each forecast lead time while the ensemble copula coupling method with the transformation scheme ecc t was applied to derive ensemble traces from emos distributions postprocessed streamflow forecasts were cross validated for the period from 1996 to 2014 using a range of verification metrics results showed that the skill and reliability of emos forecasts substantially improve over the raw ensembles and that emos leads to skillful predictions relative to discharge climatology and persistence forecasts up to 15 days in advance in most locations furthermore emos results in predictive distributions that are generally sharper than the climatology limitations in depicting autocorrelations of forecast trajectories were observed in rivers for which the raw ensemble spread is very low and emos has to largely increase dispersion especially at short lead times the study s findings suggest that combining a continental scale hydrological model with emos and ecc t methods can lead to skillful predictions and realistic ensemble traces in several locations in sa even if in situ hydrometeorological observations are not available in real time keywords emos ecc south america ensemble forecasting post processing medium range 1 introduction medium range hydrological forecasts up to 15 days play a key role in decision making on water resources management and planning in south america sa such forecasts may help to increase awareness and anticipate extreme hydrometeorological events in large national and transnational basins siqueira et al 2020 to optimize energy production in reservoirs subject to flood control fan et al 2014 2016a schwanenberg et al 2015 and to define energy prices in the short term market reis et al 2020 over the past few years several studies have investigated the potential use of medium range ensembles to forecast streamflow in south american basins both for flood early warning systems and reservoir operation e g casagrande et al 2017 fan et al 2014 2016a 2016c meller et al 2014 raso et al 2014 siqueira et al 2016 tomasella et al 2019 the common approach of these studies is to force a hydrological model with meteorological predictions resulting from multiple realizations of one or more atmospheric models producing probabilistic outcomes that represent the likelihood of discharge exceeding a certain decision threshold e g for triggering actions or setting operation rules in reservoirs more recently ensemble hydrological forecasts have also been assessed at the level of full coverage of sa siqueira et al 2020 motivated by operational applications of continental to global scale forecasting systems around the world e g alfieri et al 2013 bennett et al 2014 demargne et al 2014 thielen et al 2009 continental to global ensemble forecasting systems are becoming increasingly popular aiming to deliver hydrological predictions at multiple timescales to support trans national forecasting capabilities emerton et al 2016 lavers et al 2020 even with the use of ensembles there will be uncertainties that are not accounted for in the issued hydrological forecasts for instance numerical weather models are often biased due to the incomplete representation of physical processes and they can integrate only a finite sample of the possible states of the atmosphere buizza et al 2005 hamill et al 2006 hydrological models in general are subject to errors in input data structure and parameterization renard et al 2010 while those focused on continental to global domains are less calibrated and typically have input data with coarser resolution and large uncertainties beck et al 2017a bierkens 2015 siqueira et al 2018 sperna weiland et al 2015 this causes hydrological ensemble forecasts to fail to provide reliable i e probabilistically unbiased estimates of the total uncertainty thus hampering their use for rational decision making statistical postprocessing is therefore necessary to correct model outputs and improve the skill and reliability of forecasts it can be used either to model errors from individual sources separately before aggregating them into a single predictive distribution demargne et al 2014 krzysztofowicz 1999 seo et al 2006 or to quantify the total uncertainty by modeling the residual errors of the whole forecasting chain in a lumped fashion montanari and grossi 2008 reggiani et al 2009 regonda et al 2013 todini 2008 weerts et al 2011 in the latter case hydrological forecasts and corresponding observations are used to fit a statistical model to estimate predictive uncertainty conditionally upon one or more predictors coccia and todini 2011 krzysztofowicz 1999 li et al 2017 todini 2008 producing probability density functions pdfs that must be as sharp as possible while subject to calibration i e statistical consistency between forecast pdfs and observed values gneiting et al 2007 raftery et al 2005 statistical postprocessors may also require homogeneous samples of streamflow forecasts collected over a long period of time and these can be achieved by using retrospective meteorological forecasts of the same atmospheric model cycle i e reforecasts as inputs to a hydrological model hamill et al 2006 harrigan et al 2020 reforecasts not only increase the chance of including very high or low flow events in training data van den bergh and roulin 2016 but also allow for the separation of data into subsets to refine training according to seasonal e g hemri et al 2015 or event based analogs e g hemri and klein 2017 initial efforts in statistical postprocessing of hydrological forecasts were made by krzysztofowicz 1999 who proposed a bayesian forecasting system to estimate predictive uncertainty through a deterministic hydrological model since then a plethora of methods have been developed or adapted for this purpose such as those based on parametric or nonparametric regression e g regonda et al 2013 weerts et al 2011 bayesian formulations applied to ensembles e g reggiani et al 2009 todini 2008 kernel dressing e g pagano et al 2013 verkade et al 2017 copula based functions e g klein et al 2016 madadgar et al 2014 autoregressive approaches e g bogner and pappenberger 2011 and combinations thereof see li et al 2017 for a detailed review there is no single postprocessing method that outperforms all the others in any case herr and krzysztofowicz 2015 li et al 2017 in addition to its effectiveness the ideal postprocessing method should be parsimonious and efficient in order to be applied in real time boucher et al 2015 seo et al 2006 the ensemble model output statistics emos gneiting et al 2005 for instance is a simple linear regression based method that has the advantage of using the raw ensemble spread as a predictor of the variance of predictive distributions the ability to incorporate the ensemble spread information is a general recommendation for hydrological uncertainty processors biondi and todini 2018 emos was initially designed for postprocessing weather quantities for which the pdf may be normally distributed such as temperature and pressure gneiting et al 2005 but has undergone adaptations for variables with skewed distributions like wind speed e g thorarinsdottir and gneiting 2010 precipitation e g baran and nemoda 2016 and streamflow e g baran et al 2019 hemri and klein 2017 hemri et al 2015 zhong et al 2020 moreover it has been shown that emos has the potential to postprocess ensemble streamflow forecasts not only in locations where data is available but also along the entire river network by making use of parameter regionalization approaches skøien et al 2016 as with most statistical postprocessing methods emos applies only for a single forecast quantity location and lead time this produces univariate pdfs that are marginally calibrated but do not preserve any spatial or temporal between lead times dependencies schefzik et al 2013 in turn postprocessed predictive distributions should be also given in the form of streamflow ensemble traces to allow their use as inputs for decision support systems including optimization models for reservoir management waterway operations and detailed hydrodynamic models for the prediction of flooded areas bellier et al 2018 engeland and steinsland 2014 hemri et al 2015 herr and krzysztofowicz 2010 realistic forecast trajectories that is time series that have correct autocorrelation and are unbiased bennett et al 2016 can be drawn from predictive distributions by using multivariate postprocessing methods that account for dependence structures such as empirical methods that follow reordering notions like the schaake shuffle clark et al 2004 and ensemble copula coupling ecc schefzik et al 2013 while the former uses observed data to model realistic spatial and temporal dependencies ecc relies only on the rank structure of the raw ensemble and has been applied in hydrological postprocessing as a multivariate extension for both emos e g hemri et al 2015 schefzik 2017 and bayesian model averaging bma e g bellier et al 2018 sharma et al 2019 the ecc approach is very attractive due to its simplicity and ability to handle high dimensionality problems e g large number of locations lead times while adding no computational cost beyond the univariate postprocessing schefzik et al 2013 most studies regarding statistical postprocessing of short to medium range hydrological forecasts have been carried out in regions with relatively good availability of real time hydrometeorological data applications typically are limited to a few or a dozen stations in small to medium sized basins up to few thousand km2 e g pagano et al 2013 roulin and vannitsem 2015 zalachori et al 2012 but some of them include medium to large catchment areas 10 000 km2 e g abaza et al 2017 hemri et al 2015 sharma et al 2018 siddique and mejia 2017 or also very large basins 100 000 km2 the latter usually in the rhine river in europe e g baran et al 2019 hemri and klein 2017 reggiani et al 2009 verkade et al 2017 although the use of statistical postprocessors has also been reported in continental scale forecasting systems as in the us e g demargne et al 2014 europe e g bogner and pappenberger 2011 thielen del pozo et al 2019 and australia e g bennett et al 2014 a comprehensive evaluation of such techniques over a large number of gauge stations drainage areas and hydrological regimes is not very common in the literature a few postprocessing studies consider these aspects but are focused on longer timescales e g woldemeskel et al 2018 or are restricted to quantification of hydrological uncertainty only alizadeh et al 2020 or evaluation of forecast skill improvement only zsoter et al 2016 in sa in particular there is a general lack of studies addressing this topic despite being a continent with great hydrological and climate diversity one challenge is that countries typically have sparse real time hydrometeorological networks often with short time series fan et al 2014 2015 salio et al 2015 tomasella et al 2019 which may place additional constraints on setting up and validating statistical postprocessors in hydrological forecasting systems integrating large scale hydrological models with global precipitation data e g satellite reanalysis or multiple sources may overcome some of these limitations because they allow for the production of spatially consistent streamflow forecasts for the entire river network alfieri et al 2013 siqueira et al 2020 and for multiple years in the past harrigan et al 2020 despite the well recognized large uncertainties of such approaches alfieri et al 2020 emerton et al 2016 li et al 2016 wu et al 2014 2020 zsoter et al 2016 thus a question emerges as to what extent statistical postprocessing would enable the obtainment of skillful and informative streamflow forecasts at the continental scale of sa that is forecasts that would translate into proper estimates of predictive uncertainty and also realistic ensemble traces to allow their use by multiple stakeholders addressing this question may help to foster probabilistic forecasting with state of the art meteorological and hydrological modeling techniques in sa where most of the existing systems still make use of pure statistical or deterministic forecasting models for predicting floods and planning the operation of hydropower plants fan et al 2016b tucci et al 2019 in this context the objective of this study is to investigate how emos contributes to the skill and reliability of continental scale medium range ensemble streamflow forecasts in sa and to assess the performance and limitations of ecc in producing forecast trajectories from emos predictive distributions the analysis is performed across hundreds of locations in sa using a continental hydrological model and reforecasts from the european center of medium range weather forecasting ecmwf the next sections are organized as follows section 2 provides information on the study area and observed data section 3 describes the methods used to produce ensemble streamflow forecasts general concepts about emos and ecc methods configurations adopted for postprocessing and strategies of forecast verification results are presented in section 4 while the discussion and main conclusions are offered in sections 5 and 6 respectively 2 study domain and streamflow data the study domain encompasses the south american continent the territory hosts some of the largest basins in the world such as the amazon 5 9 106 km2 and la plata 3 2 106 km2 most of them draining to the atlantic ocean as an effect of the n s oriented andes cordillera in the western part of the continent a particular focus is given to brazil which is the largest country by far almost 50 of the total land area and in which the majority of surface water resources in sa are concentrated the same observed discharge data as used by siqueira et al 2018 was selected for this study these data were collected from many hydrological centers in sa and consist of daily observed discharge in gauge stations and naturalized flows at reservoir locations for drainage areas larger than 10 000 km2 with few exceptions naturalized flows are those that would be observed at hydropower dam locations in the absence of upstream reservoirs and water withdrawals and are routinely provided by the brazilian national water agency ana and the brazilian national electric system operator ons a visual inspection was carried out to exclude gauge stations affected by reservoir regulation and only those with more than 10 years of data not necessarily consecutive were selected 488 gauges in total an overview of the political borders major hydrographic features and spatial distribution of gauge stations is shown in fig 1 while the drainage areas covered by the selected gauge stations are summarized in table 1 3 methods 3 1 modeling framework 3 1 1 mgb hydrological model mgb acronym of modelo de grandes bacias is a conceptual semi distributed hydrological model with a history of development focused on south american water issues collischonn et al 2007 and hydrological processes paiva et al 2013a it has been applied in many studies related to large sa river basins including works on the topic of ensemble hydrological forecasting e g fan et al 2014 2016a 2016c meller et al 2014 paiva et al 2012 siqueira et al 2016 2020 for this study the continental scale mgb model developed for the sa domain hereafter the mgb sa was chosen due to its enhanced discharge accuracy compared to global models siqueira et al 2018 aimed at producing streamflow forecasts to meet societal needs regarding the model structure mgb sa is discretized into 33 749 unit catchments with median p5 and p95 areas of 327 85 and 1322 km2 respectively each one containing a river segment with a fixed length equal to 15 km unit catchments are further subdivided into hydrological response units hru taking into account combinations of land use and soil type vertical hydrological processes e g soil water budget energy balance evapotranspiration are computed independently for each hru at a daily time step surface subsurface and groundwater runoff produced at the hru level are propagated to the unit catchment main channel using linear reservoirs and flow routing through drainage networks is computed using an explicit inertial approximation of 1d saint venant equations to deal with hydrodynamic effects associated with lowland rivers and floodplains for the latter mgb sa uses an adaptive time step usually 3 4 min to satisfy the courant friedrichs lewy cfl condition snow processes are not represented in the current model structure since the mgb was primarily developed for tropical regions mgb sa uses daily precipitation data from the 0 25 global multi source weighted ensemble precipitation mswep v1 1 beck et al 2017b and cru v 2 long term monthly means of other climatic variables temperature relative humidity radiation wind speed and pressure new et al 2002 as meteorological forcing calibration was performed manually for the period from 1990 to 2010 using observed data from 604 in situ gauge stations and the model was validated with several remote sensing datasets it was shown that mgb sa was able to reproduce daily discharges satisfactorily over several regions of south america 70 55 of the gauges with kge nse 0 6 fig 2 shows the spatial distribution of model performance nse regarding the locations selected for this study and further details about model datasets calibration and performance can be found in siqueira et al 2018 3 1 2 hydrological forecasting setup to produce raw ensemble streamflow forecasts precipitation reforecasts from the ecmwf integrated forecast system ifs were used the operational medium range monthly ensemble forecast component of ifs ecmwf ens consists of a 51 member ensemble control run 50 perturbed forecasts and horizontal resolutions of 16 km for lead times up to day 15 and 36 km onwards reforecasts are issued twice a week on mondays and thursdays for the same calendar day for the previous 20 years using the same ecmwf ens operational model cycle but with a reduced ensemble of 11 members for instance the reforecasts issued on march 10 2016 are 11 member hindcasts produced with initial conditions of march 10 1996 march 10 1997 and so forth until march 10 2015 ecmwf precipitation reforecasts issued between march 2016 and february 2017 were achieved with a grid of 0 2 0 2 resolution 6 h accumulated intervals and lead times up to 15 days although only the hindcasts from before january 2015 i e 1996 2014 were used due to the availability of mswep v1 1 precipitation data were first aggregated from 6 h to daily values and then interpolated to the mgb sa unit catchment centroids using the inverse distance squared weighting method to enable hydrological forecast initialization a long term mgb sa run was performed spanning from january 1990 to december 2014 and model state variables e g soil moisture volume of water in rivers and floodplains were saved for each day with available ecmwf reforecast data as in siqueira et al 2020 the cru v 2 monthly means of climatic variables other than precipitation used by mgb sa to compute evapotranspiration in simulation mode were also used as model inputs in the forecast mode 3 2 postprocessing of raw hydrological ensemble forecasts statistical postprocessing was conducted in two stages initially emos was applied to transform raw streamflow ensembles into univariate predictive distributions at each location forecast day and lead time afterwards the ecc method was used to extract forecast trajectories from the emos predictive distributions the postprocessing techniques and their assumptions are detailed in the following sections 3 2 1 ensemble model output statistics emos emos is a univariate nonhomogeneous regression based method that was proposed by gneiting et al 2005 the original formulation assumes that predictive densities are gaussian and the raw ensemble is a predictor of the variance of forecast errors for a given forecast variable location and lead time the parameters of the normal distribution n μ σ 2 are defined by the regression estimate and a linear function of the raw ensemble spread 1 μ a b 1 x 1 b 2 x 2 b m x m 2 σ 2 c d s 2 3 s 2 1 m m 1 m x m x 2 where µ and σ2 are respectively the mean and variance of the gaussian predictive distribution s2 is the spread of the raw ensemble forecasts xm is the forecasted value for the ensemble member m x is the ensemble mean of the raw hydrological forecasts m is the number of ensemble members a b c and d are parameters note that bm represents the weight of a given ensemble member for the regression estimate as the raw ensemble members derived by forcing the mgb sa model with ecmwf reforecasts individually lack distinguishable physical characteristics they are equally likely and belong to the same exchangeable group fraley et al 2010 that is they can be assumed to have the same weight therefore the notation of the normal predictive distribution can be written in terms of the ensemble mean according to 4 n μ σ 2 n a b x c d s 2 where x is the ensemble mean of the raw hydrological forecasts and n denotes the normal predictive distribution with mean equal to a b x and variance equal to c ds2 the regression estimate of eq 1 corrects for bias in the ensemble mean while the non static variance term eq 2 accounts for dispersion errors according to gneiting et al 2005 the parameters a b c and d of eq 4 can be fitted through the minimization of the continuous ranked probability score crps hersbach 2000 which is also one of the most used verification metrics to assess the performance of hydrological forecasts pappenberger et al 2015 while the assumption of gaussianity applies well for meteorological variables such as temperature and sea level pressure raftery et al 2005 it may not be applicable to river discharge since the latter typically follows a positive skewed distribution therefore hydrological forecasts and corresponding observations must be transformed to make the distributions as nearly normal as possible examples of commonly used transformations in the topic of hydrological postprocessing are the normal quantile transform e g bellier et al 2018 verkade et al 2017 weerts et al 2011 log sinh e g pagano et al 2013 wang et al 2012 and the box cox power transformation e g baran et al 2019 duan et al 2007 engeland and steinsland 2014 hemri and klein 2017 hemri et al 2015 madadgar and moradkhani 2014 qu et al 2017 here the box cox approach was applied according to 5 h x x λ 1 λ λ 0 log x λ 0 where h x is the box cox transformed variable x is the observed forecasted streamflow and λ is the box cox parameter the optimal λ value for each location can be found through a grid search with a pre defined range selecting the value that minimizes the kolmogorov smirnov statistics e g duan et al 2007 hemri et al 2015 the shapiro wilk test e g engeland and steinsland 2014 or the crps value e g baran et al 2019 hemri and klein 2017 however performing such a grid search in a continental domain that comprises a large number of locations is computationally expensive furthermore calibrating λ is not always a good choice since it is very sensitive to medium and low flows mcinerney et al 2017 woldemeskel et al 2018 showed that a box cox λ 0 2 performed reasonably well for monthly and seasonal forecasts across many gauges and different climate regions in australia by applying different transformations on discharges using a large set of french catchments berthet et al 2020 also suggested a box cox λ 0 2 as a robust choice for operational flood forecasting following the aforementioned studies a fixed value of λ 0 2 was set for applying the box cox transformation on observed forecasted values in all available locations emos models are fitted to the box cox transformed streamflow forecasts and the resulting quantiles are back transformed to finally produce univariate predictive distributions however hemri et al 2015 state that emos sometimes produces positive probabilities for unrealistic high and low flows after back transformation therefore a variant of the truncated emos model presented by thorarinsdottir and gneiting 2010 was adopted following hemri and klein 2017 and baran et al 2019 in which both left and right tails of the gaussian distribution are truncated at half of the minimum and two times the maximum observed flow during the hindcast period respectively the cumulative distribution function cdf f of the double truncated gaussian n α β μ σ 2 is then described as follows 6 f y 0 f o r y α φ y μ σ φ α μ σ φ β μ σ φ α μ σ f o r α y β 1 f o r y β where y denotes the variable to be forecasted φ denotes the cdf of the standard normal distribution α and β are truncation limits corresponding to the half of minimum and two times the maximum observed flow between march 1996 and december 2014 respectively for simplicity the double truncated emos is referred to hereafter as emos 3 2 2 ensemble copula coupling ecc emos estimates a continuous predictive distribution for a given forecast variable lead time and location therefore a multivariate postprocessing method must be also applied in order to produce coherent forecast trajectories here the ecc technique schefzik 2017 schefzik et al 2013 was used because of its simplicity and low computational burden which makes it attractive for modeling multivariate dependencies in such a large continental domain in a nutshell the ecc inherits the rank order structure from the raw ensemble with the implicit assumption that the latter is able to represent the correlations between forecasted variables lead times and locations appropriately as this study deals only with river discharge as a forecast quantity let k j l be a multi index that summarizes a forecast lead time j 1 j and a location l 1 l and let k be the dimension of the vector consisting of all lead times and locations i e k j l for a given forecast date the set of k raw ensembles with m members x 1 x m are defined as a dependence template z x 1 1 x m 1 x 1 k x m k where the subscript indices 1 m are unique member labels that do not change across the j lead times since each univariate emos predictive density can be described by a cumulative distribution function cdf fk the multivariate problem is solved by drawing samples from these distributions and reordering them according to the rank order of the dependence template zk by definition the number of samples derived from each univariate quantity should be equal to the number of elements of zk which implies that the multivariate postprocessed ensemble will have the same size m of the raw hydrological ensemble schefzik et al 2013 present three variants of the ecc method for the sampling reordering procedure namely ecc r random sampling ecc q equally spaced quantiles and ecc t transformation according to hemri et al 2015 the t variant is the most suitable approach since it reduces jumps in the trajectories of predicted discharges which is particularly important for the case of strongly autocorrelated river flows for the ecc t a parametric continuous cdf sk is fitted to the dependence template zk and the postprocessed ensemble x k x 1 k x m k is derived by determining to which quantiles of sk the raw ensemble members correspond before mapping them to the quantiles of emos cdf fk this is performed after the template zk is box cox transformed as the sk is assumed to be normally distributed bellier et al 2018 hemri and klein 2017 hemri et al 2015 the cdf sk is fitted using maximum likelihood estimation assuming a gaussian distribution note that the rank dependence of the postprocessed ensemble is automatically preserved according to the dependence template z that is the reordering step occurs naturally through the quantile mapping procedure of ecc t schefzik 2017 the postprocessing of hydrological forecasts is summarized in the flowchart presented in fig 3 in cases where the raw ensemble spread is too low an additional correction is made to avoid unrealistically extreme quantiles by setting the variance of sk to hemri et al 2015 7 σ k 2 m a x σ k 2 h 1 d x k h 1 d x k 2 where σ k 2 is the variance of sk h denotes de box cox transformation x k is the raw ensemble mean k is the index related to a given location and lead time and d is a parameter to be tuned while other authors have adopted values of 0 001 hemri et al 2015 and 0 0001 bellier et al 2018 for the d parameter here d was set to 0 005 based on previous experience and a sensitivity analysis was performed since it affects the forecasted ensemble traces and their calibration supplementary material s 1 3 3 experiment setup 3 3 1 training emos models and deriving ensemble forecast trajectories as most of the rivers of south america have a well defined seasonal pattern the emos models were trained for each location and lead time using subsets of data according to the season djf mam jja and son a leave one year out cross validation was applied in a similar way to other postprocessing studies e g fundel and zappa 2011 hemri et al 2015 verkade et al 2017 in order to maximize the verification period and to carry out a robust statistical analysis for instance parameters of the emos model that correspond to djf of validation year 2010 were fitted using training data from djf for all years except the target one i e 2010 in addition emos parameters across lead times were further smoothed using a cubic spline interpolation this was necessary to reduce undesirable jumps in the quantiles of the marginal predictive distributions between individual lead times bellier et al 2018 hemri et al 2015 and was performed before applying the ecc t to produce forecast trajectories the same procedure was applied for all seasons and years spanning from march 1996 to december 2014 finally postprocessed forecasts resulting from the validation years were merged together in order to cover all the reforecast period for training the emos models applying parameter smoothing between lead times and deriving forecast trajectories with ecc t the r software r core team 2013 with the package called hydemos klein and hemri 2017 was used note that data assimilation or autoregressive models were not applied to adjust the initial forecast values prior to the postprocessing step the objective was to reproduce the simplest operational settings in which real time observed flows are not readily available to the continental scale forecasting system 3 3 2 verification strategy the general aim of postprocessing is to provide forecasts that are as sharp as possible subject to calibration gneiting et al 2007 raftery et al 2005 it may also preserve the predictive skill of raw forecasts li et al 2017 and allow the generation of coherent ensemble traces bellier et al 2018 herr and krzysztofowicz 2010 schefzik et al 2013 to evaluate the postprocessing performance a set of metrics in geographic space were analyzed for different lead times and flow conditions and a visual inspection of forecast hydrographs and graphical measures of forecast attributes was carried out at specific locations to allow for a direct comparison between emos distributions and ensemble streamflow forecasts i e raw and emos ecc t 11 members for each forecast day were derived by drawing m equally spaced samples from the univariate emos predictive cdfs f k 1 1 m 1 f k 1 2 m 1 f k 1 m m 1 the evaluation of forecast skill is generally performed against benchmarks that is alternative forecasts that use simpler strategies of predicting flows such as climatology or persistence of the last observed discharge the former is more appropriate for longer lead times since the forecast signal tends to be controlled by the seasonality of flows whereas the latter is recommended for shorter lead times where the forecast signal is controlled by serial correlation of flows harrigan et al 2020 pappenberger et al 2015 as the study area encompasses multiple catchment characteristics and flow regimes and because forecast lead times are considered up to 15 days ahead both climatology and persistence are used here as benchmarks discharge climatology was calculated by resampling observed data within the reforecast period for the target calendar day and using the leave one year out procedure to exclude data from climatology that correspond to the evaluated year persistence was computed by simply assuming the most recent observation available at the time of issuing a forecast for all lead times predictive skill can be quantified using scoring rules such as the crps hersbach 2000 it summarizes calibration and sharpness of a probabilistic forecast into a single overall score expressed as a mean of all individual crps values 8 c r p s 1 n f y f 0 y 2 d y 9 f 0 y 0 y o b s e r v e d v a l u e 1 y o b s e r v e d v a l u e where f y is the cdf of the ensemble forecast y and f0 y is the heaviside step function that equals one when forecast values are greater than the observed value and zero otherwise c r p s is then converted into an overall skill score according to crpss 1 c r p s forecast c r p s reference using both daily climatology and persistence of the last observed discharge as reference for the specific case of persistence i e a deterministic forecast c r p s reduces to the mean absolute error maximum skill is achieved when crpss 1 forecast calibration or reliability is analyzed by means of the rank histogram anderson 1996 it is closely related to the probability integral transform pit histogram used to assess the calibration of predictive distributions gneiting et al 2007 with the difference that it applies to the discrete case of ensembles rank histograms describe the proportion of observations falling in a given forecast probability interval each one defined between two consecutive ensemble members a horizontally flat histogram indicates a well calibrated ensemble u shaped histograms indicate underdispersion whereas u inverted ones represent overdispersion moreover histograms with an l shaped or l inverted pattern are indicative of positive or negative bias respectively the information provided by the rank histogram can be also summarized by the reliability index ri delle monache et al 2006 which expresses the deviation from flatness 10 ri i 1 m 1 ξ i 1 m 1 where ξ i is the frequency of observations in bin i and m is the number of ensemble members an ri 0 would result in perfect calibration to provide further details on forecast calibration we computed the proportion of observations falling within the nominal coverage of the raw ensemble i e the interval between the upper and lower member which is given by the m 1 m 1 100 centered prediction intervals baran et al 2019 for an 11 member ensemble the nominal coverage refers to the 83 3 centered prediction intervals that should be matched by the actual ensemble coverage denoted here by the coverage rate cr 11 c nc c where c is the number of observations falling inside the ensemble range and nc is the number of observations not captured by the ensemble sharpness is a property of the forecasts only and refers to the width of predictive distributions gneiting et al 2007 sharper forecasts have more concentrated prediction intervals lower spread in the case of ensembles and thus greater ability to forecast extreme probabilities near 0 and 100 sharpness is given here in terms of an average spread computed as the square root of mean variance fortin et al 2014 roulin and vannitsem 2015 12 s 1 n i 1 n m 1 m x m i x i 2 m where n is the number of forecasts issued m is the number of ensemble members xm i is the streamflow for the ensemble member m and forecast day i and x i is the ensemble mean for forecast day i similarly to crps sharpness can assume the form of a skill score when computed against daily climatology ss 1 s forecast s climatology maximum sharpness skill occurs for an ss 1 to investigate whether the individual ensemble traces from emos ecc t are able to represent the serial dependence of hydrological forecasts i e produce trajectories that are realistic across lead times the auto correlation function acf of emos ecc t was compared to the acf of the raw ensemble as suggested by bellier et al 2018 firstly the forecast values were transformed into series of lag one differences to remove seasonality and trends the resulting multiple series samples m ensemble traces n forecast dates were concatenated to compute acf but ensuring that pairs from different samples were excluded from the calculation moreover to summarize the acf into a single score the area between acf curves acfarea was also calculated using a trapezium approach where an area 0 indicates perfect match similarly to sharpness the acf is a property of the forecasts only 4 results 4 1 forecast hydrographs and emos distributions the analysis of hydrological forecasts starts with a closer look at the corresponding hydrographs and postprocessed predictive distributions examples of ensemble streamflow forecasts with lead times up to 15 days ahead produced by the mgb sa forced with ecmwf reforecasts in selected locations hydropower reservoirs of the brazilian national interconnected system sin and for a particular date are presented in fig 4 postprocessing results are shown in the form of emos probabilities for the centered prediction intervals of 90 5 95 and 50 25 75 and also in the form of ensemble traces derived from the predictive distributions of emos after applying the ecc t method it is worth mentioning that the emos quantiles that correspond to the above centered prediction intervals are used here only for plotting purposes which differ from the 11 equally spaced quantiles of emos that were selected for verification in the later sections observed flows for the locations in fig 4 refer to naturalized river flows while the selected forecast dates represent cases of flood events in which discharges are 2 year return period flows additional graphs of extended forecast time series at these locations are available in the supplementary material s 2 as noted hydrological behavior varies greatly between locations some of these show a rapid rise in the hydrograph e g itá at uruguay river fig 4 1 while others exhibit a slower variation of flows e g teles pires at teles pires river fig 4 9 the raw ensemble is able to predict the occurrence of high flows in most cases but tends to partially capture the observed discharges when looking to the postprocessed forecasts observations usually fall within the emos centered prediction intervals of 5 95 because streamflow forecasts are issued without further correction by data assimilation or autoregressive models predicted discharges that are close to the forecast initialization day are often displaced in relation to the observed values notably in três marias são francisco river fig 4 6 and lajeado tocantins river fig 4 8 as a result the predictive uncertainty estimated by emos postprocessing can be relatively large even at the initial lead times the forecast trajectories obtained with the ecc t maintain the rank order structure of the raw ensemble but generally increase the ensemble spread in relation to the latter in some cases such as itá salto santiago iguazu river fig 4 2 itaipu paraná river fig 4 3 lajeado and aimorés doce river fig 4 5 there is good agreement between the postprocessed forecast trajectories and those from the raw ensemble but in other locations e g furnas at grande river fig 4 4 boa esperança at parnaíba river fig 4 7 and teles pires the ensemble traces tend to demonstrate a more distinct behavior 4 2 spatial assessment of forecast skill overall quality and sharpness in order to assess the forecast skill the raw ensemble emos and emos ecc t were compared with the reference forecasts in terms of crpss and sharpness skill ss considering a lead time of seven days fig 5 at the top shows the results of crpss of hydrological forecasts computed against the persistence pers of the last observed discharge the crpsspers of raw forecasts has a clear heterogeneous pattern where skillful predictions are more concentrated in the eastern and southeastern sa negative crpsspers values are observed mainly in central and western regions of sa notably in large basins such as the amazon orinoco tocantins araguaia and paraguay west of la plata and also along the são francisco basin in eastern sa this indicates that the overall quality of the raw ensemble is lower than the benchmark at these locations with respect to streamflow forecasts issued for one week ahead emos postprocessing improves the overall skill in relation to the raw ensemble and demonstrates a positive crpsspers in eastern sa as well as in most western regions in addition the spatial pattern of the overall performance of postprocessed forecasts in sa does not change after the derivation of ensemble traces with the ecc t method when the overall skill is computed against the daily streamflow climatology fig 5 bottom the geographical distribution of crpsscli values for raw and postprocessed forecasts resembles that found in the case with persistence as the reference however clear differences between emoscli and emospers are notable in the main stem of large rivers like the amazon and paraguay as well as in the lower magdalena basin and araguaia river west of the tocantins araguaia basin fig 6 shows the sharpness skill ss values spatially distributed over the gauge stations in sa unlike crpss forecasts are compared only with daily climatology since a deterministic benchmark such as the persistence does not provide uncertainty information as expected the raw ensemble exhibits the highest sharpness ss generally 0 6 emos postprocessing generally degrades the skill of the raw ensemble but it still demonstrates greater sharpness than daily climatology this reduction in skill tends to be larger in some specific regions such as the amazon northern sa and western la plata basin e g the paraguay river furthermore the application of ecc t slightly reduces the sharpness skill of emos in most of the gauges although ss values are higher in locations where the flood rise is very slow e g the main stem of the amazon 4 3 spatial assessment of forecast calibration to evaluate forecast calibration first the rank histograms were plotted for the selected locations considering a lead time of seven days fig 7 results obtained for the raw ensemble emos and emos ecc t are separated by the colored vertical bars in the histograms each ensemble interval is represented by a rank with the tails of the histograms representing the observations lying below the lower or above the upper member of the ensemble ri values that summarize the calibration performance are also shown for each rank histogram the diagrams clearly show that the frequency of observations at intermediate probabilities is very low in the case of raw ensemble forecasts that is the latter are markedly unreliable with high ri values ranging between 0 58 and 1 78 in specific cases located in southern brazil such as in the itá and salto santiago reservoirs the rank histograms indicate that raw forecasts are underspread u shaped histograms while in the other analyzed locations there is a tendency of the observations to fall below the lower limit of the ensemble i e a signal of large conditional positive bias given by the l shaped histograms on the other hand emos postprocessing fosters a better calibration of the forecast ensemble producing rank histograms that are approximately flat with low values of ri varying between 0 07 and 0 2 with observed frequencies remarkably close to the perfect reliability line 1 m 1 except for itá and salto santiago the emos ecc t reduces the improvement gained in calibration in comparison with emos which is highlighted by the higher values of ri between 0 11 and 0 51 figs 8 and 9 show respectively the values of ri and cr plotted over sa for a lead time of seven days for the raw ensemble most ri values are very large usually 1 which indicates that there is little or no agreement between the forecasted probabilities and relative observed frequencies of river discharges the lack of calibration is reflected in the underestimation of cr values with the ensemble coverage usually capturing less than 30 of observations in the verification period this means that observed values are often lying outside the limits of the ensemble on the other hand the statistical consistency of the emos postprocessed forecasts previously identified in the rank histograms of fig 7 seems to occur in most of the gauge stations ri values closer to 0 globally with the exception of a few locations in northeast brazil characterized by intermittent flows the frequency of observations falling between the upper and lower limits of the ensemble derived from univariate emos is also very close to the expected value of 83 3 for the case of emos ecc t the improvement in forecast calibration is reduced in several gauges when compared with the univariate emos postprocessing in particular calibration with emos ecc t is notably lower in the são francisco tocantins araguaia parnaíba and northern la plata upper paraguay basins ri between 0 5 and 1 0 and cr ranging from 50 to 60 and exhibits a poor performance in the main stem of the amazon ri 1 0 and cr 30 4 4 forecast performance according to lead time fig 10 shows the performance of the streamflow forecasts as a function of lead time results were plotted in a summarized manner and refer to the median of verifying gauge stations throughout sa while the raw ensemble shows crpss values below the no skill line over the entire forecast horizon against climatology and exhibits overall skill relative to the persistence benchmark only after 10 days ahead postprocessed forecasts anticipate the latter by approximately six days also showing positive crpss values in relation to climatology ranging between 0 2 and 0 4 in contrast the median ss is the highest for the raw ensemble at the 1 day lead time ss close to 1 but the differences of ss between raw and postprocessed forecasts gradually reduce in the subsequent lead times although emos degrades the ss compared to the raw ensemble in more than 50 of the gauges it outperforms the skill of daily climatology along the entire forecast horizon while providing a well calibrated ensemble for example low values of ri that were identified for one week ahead over multiple gauges in sa fig 8 are also observed in the other lead times with almost no change in the median relatively constant ri 0 2 whereas the corresponding cr is kept systematically close to the nominal coverage of 83 3 the application of multivariate ecc t on emos has a small effect on the overall skill measured by the crpss both for climatology and persistence compared with the univariate postprocessing but for calibration and sharpness the differences are more apparent and vary with lead time performances of emos ecc t closer to those obtained from univariate emos are achieved only more than 10 days in advance but at the cost of a larger ensemble spread as explained by the lower median ss 4 5 forecast performance according to flow conditions performance metrics for different flow categories at the lead time of seven days are given in the box plots of fig 11 results are shown for the entire verification period and also for subsets of the verification data conditioned on forecasts both for low to moderate q50 and high forecasted discharges q90 of non exceedance flows the analysis was conditioned on forecasts using the ensemble mean as the stratification criterion that is the subsets of verification data are given for the cases in which the ensemble mean exceeds or is below its forecast climatological probabilities of 90 q90 and 50 q50 respectively these climatological probabilities of the ensemble mean were computed using all available forecast dates and the evaluation was performed separately for each lead time the forecast based data stratification is recommended over the observed conditioning since the latter can lead to non flat histograms for calibrated forecasts bellier et al 2017 for the case of low to moderate forecasted flows q50 postprocessing results tend to be similar or slightly better than the ones found for the entire verification data except for emos ecc t when looking at calibration on the other hand differences in performance are generally more visible for high forecasted discharges q90 for instance the overall skill of postprocessed ensembles decreases substantially when compared with daily climatology reaching median values slightly above the no skill line despite emos and emos ecc t still exhibiting positive ss values for the q90 condition in most locations sharpness is reduced and the ensemble spread becomes closer to that of climatology regarding calibration the statistical consistency of emos decreases while the emos ecc t increases compared with the entire verification data and the range of ri values in both cases becomes similar with median ri around 0 3 the same pattern is observed for the cr with median values of coverage close to 80 box plots also indicate that over dispersive forecasts are more likely to occur for the q90 condition after postprocessing since more than 25 of cr values lie above the nominal coverage of 83 3 4 6 evaluation of the ensemble traces derived using ecc t this section explores the performance of the ecc t for extracting realistic forecasting trajectories from the emos predictive distributions fig 12 shows the resulting acf of the lag one differences of forecasted discharges plotted for the selected locations both for the raw ensemble i e the reference acf expressed by acfref and emos ecc t acfemos ecc t the agreement between both acfs is summarized by the area between the curves shown in each diagram unlike a metric or graphic measure that evaluates the univariate performance for a single lead time the acfarea is an aggregated result for all lead times within the forecast horizon in some locations such as the itá salto santiago and aimorés reservoirs acfemos ecc t and acfref are almost identical with acfarea ranging between 0 08 and 0 24 the rapid decrease in acf in these cases is indicative of larger fluctuations in the predicted flows in addition emos ecc t also produces an acf relatively close to the reference in itaipu and lajeado acfarea 0 8 while larger differences occur in the other analyzed locations with acfarea ranging between 1 65 and 2 83 respectively in furnas and teles pires postprocessed forecast trajectories tend to perform worse in locations for which the raw ensemble exhibits stronger autocorrelations in forecast time series to provide broader insight into the behavior of forecast trajectories derived using ecc t the areas between the acfemos ecc t and acfref curves were plotted for the analyzed gauge stations in sa fig 13 the spatial distribution of acfarea shows that emos ecc t performance varies largely across the continent for instance acfarea values are relatively low in most of la plata basin usually in the eastern region drained by the upper paraná and uruguay rivers generally reaching magnitudes less than 0 5 similar performances by emos ecc t are also found in large basins such as parnaíba and tocantins on the eastern side of the tocantins araguaia basin except at locations characterized by large reservoirs e g boa esperança in parnaíba basin in turn a low agreement between raw and postprocessed acf curves with a very high acfarea generally 2 0 is observed in much of the amazon basin and also in areas affected by floodplains where the raw ensemble spread is expected to be low for lead times up to 15 days in advance this is the case for the araguaia river on the western side of tocantins araguaia basin upper paraguay and lower magdalena to analyze the effect of the raw ensemble spread on emos ecc t forecast trajectories the sharpness skill ss of both the raw ensemble and emos were plotted against the acfarea fig 14 as can be clearly observed gauges with large acfarea values tend to be concentrated at the top of the diagrams this means that the autocorrelation in forecast time series is not well depicted by ecc t when the raw ensemble has very low spread ssraw close to 1 at the same time that emos has to largely increase dispersion ssemos usually 0 7 this effect is more pronounced at shorter leads because of the delayed response of streamflow to predicted precipitation and it undermines the extraction of coherent forecast trajectories as it favors unrealistic jumps during the quantile mapping procedure of ecc t 5 discussion as shown in the previous sections raw ensemble streamflow forecasts issued from a continental scale forecasting system can often lead to lower overall performance than that of simpler alternatives like daily climatology or persistence forecasts from a spatial point of view the lack of skill regarding the raw ensemble was identified in a considerable number of gauge stations located mainly in central to western tropical regions of sa negative values of crpss were noted also in large basins in such regions although other studies have shown that forecast skill typically increases with basin size alfieri et al 2014 pappenberger et al 2011 siddique and mejia 2017 it should be noted that the assessment of forecast skill is here performed in south american basins that can reach up to hundreds of thousands or even millions of square kilometers encompassing distinct geographic regions multiple hydroclimatic features and flow regimes ranging from highly variable year round to unimodal flood peak regimes benchmarks for instance may perform better when the seasonality or serial correlation of discharges is strong thus streamflow forecast skill is expected to be lower in these situations even in large basins forecast skill is also closely linked to the hydrological model performance and it is likely that crpss would increase with catchment area in some of these regions if hydrological initial conditions were more evenly and well estimated across the continent siqueira et al 2020 this is not the case as simulated discharges perform very differently in space due to limitations in process representation model calibration and variations in quality of rainfall estimates mswep used for forecast initialization in addition predicted precipitation often dictates the skill of streamflow forecasts especially at longer lead times the contribution of skill coming from ecmwf rainfall prediction has been found to be spatially dependent in sa exhibiting higher skill in eastern and southeastern regions but lower skill in the amazon and western areas close to the andes cordillera medina et al 2019 siqueira et al 2020 by assessing calibration low ensemble coverage rates and large deviations from horizontally flat rank histograms were systematically found which clearly indicates that raw streamflow forecasts are far from being samples from the true pdfs even at longer lead times such as one week ahead the emos postprocessor substantially improved the skill and statistical consistency of raw hydrological forecasts also leading to narrower uncertainty ranges in relation to climatology in most of the analyzed gauge stations in some regions such as the amazon northern sa and western la plata larger reductions of sharpness skill in relation to other areas were observed after postprocessing this probably occurs because streamflow forecasts i are being affected by the low skill of predicted precipitation mainly indicated by low crpsscli in fig 5 at the bottom center or ii have almost no spread in the raw ensemble mainly indicated by low crpsspers in fig 5 at the top center these factors may result in a high frequency of large random errors in streamflow forecasts after bias correction eq 1 consequently leading to a larger increase in the width of emos predictive distributions in order to appropriately calibrate forecasts furthermore simulated discharges in these areas are often subject to significant timing errors paiva et al 2013a siqueira et al 2018 delayed or advanced in time flows are expected to contribute to non systematic errors e g underestimation during rising flows and overestimation during hydrograph recession or vice versa and could be also one of the reasons for the degradation of sharpness skill it is worth noting that despite the postprocessed forecasts are generally less sharp than the raw ensembles the number of locations with ssemos ssraw tends to increase with lead time as indicated in fig 14 this means that emos can contribute positively to sharpness to some extent by reducing the average spread of raw forecasts especially at longer leads a sample reordering method such as the ecc is an interesting way to extract forecast trajectories from postprocessed distributions combining emos and ecc techniques for medium range streamflow forecasting can be promising especially in some regions of sa such as the la plata basin this is important since hydropower in la plata plays a key role in energy production for many south american countries popescu et al 2012 this study s assessment is the first that demonstrates the applicability of emos and ecc methods for streamflow forecasting on a very large scale using approaches and global datasets that are potentially available for less developed regions once the parameters of emos models are adjusted predictive distributions and postprocessed ensemble traces could be easily obtained for hundreds of gauge stations across the sa continent nonetheless some considerations must be outlined here the performance of emos depends on how close the forecasting errors are normally distributed recent studies have shown that data transformations e g box cox or any others can stabilize the variance of errors in a forecasting context although normal distributions are difficult to achieve in practice berthet et al 2020 this may be even more difficult when dealing with different hydrological regimes occurring in a large domain such as sa it was found that in general applying the ecc with the t sampling scheme on emos predictive densities causes little impact on the overall skill of emos on the other hand it reduces the calibration obtained from univariate postprocessing which is consistent with previous findings bellier et al 2018 hemri et al 2015 the loss of calibration may be attributed to the sampling levels of ecc t which are not equally spaced as they are connected to the raw ensemble another important consideration is that the ecc strongly depends on the ability of the model used to simulate the real system schefzik et al 2013 this imposes additional limitations for continental domains such as sa since large scale hydrological models usually have coarse resolutions regarding model discretization input data etc and are likely to provide a lower performance than the ones tailored for specific basins in this context fleischmann et al 2020 identified artefacts causing excessive attenuation in simulated flows at large reservoirs e g três marias which can occur not only in mgb sa but also in any other large scale model with hydrodynamic routing this artificially reduces the spread in the raw ensemble and may lead to a lower performance of ecc t as indicated from the experiments the ability of ecc t to recover temporal dependencies and derive realistic ensemble traces from emos postprocessing vary from one place to another for instance substantial differences between the acf curves of emos ecc t and raw ensemble were observed in areas such as the amazon and upper paraguay time series of forecasted streamflow in these regions are more strongly correlated due to longer travel times and slow propagation in rivers as the flow routing is subject to delay effects caused by floodplain storage processes paiva et al 2013a paz et al 2011 pontes et al 2017 siqueira et al 2018 yamazaki et al 2011 as a result streamflow predictability in large sa rivers is often dominated by initial hydrological conditions rather than predicted precipitation even for some weeks ahead paiva et al 2012 as the predicted rainfall is the only uncertainty source cascaded to the raw streamflow ensemble the corresponding spread in the aforementioned cases is expected to be systematically low which consequently provides little information on emos variance besides in ecc t the quantiles from the raw ensemble are mapped to emos predictive distributions which means that some members may be linked to very low probabilities at low ensemble spread conditions producing unrealistic jumps in forecast trajectories hemri et al 2015 increasing the minimum variance of the normal distribution that is fitted to the raw ensemble sk may help to reduce these jumps between lead times albeit at the cost of additional loss of calibration see supplementary material s 1 performing data assimilation prior to emos postprocessing would be more appropriate and necessary for narrowing the predictive uncertainty consequently improving the forecast trajectories finally both the skill of postprocessed forecasts and the generation of ensemble traces could be further improved by making use of variants of emos and ecc methods one possibility is to fit emos models using subsets of training data according to forecast analogs hemri and klein 2017 which can take advantage of long past hydrological ensemble predictions based on meteorological reforecasts the use of analog based training periods has been shown to make the skill of emos predictive distributions comparable to those generated by more sophisticated postprocessing techniques like bma for example baran et al 2019 regarding ecc t random perturbations could be made to the dependence template to improve the fits of the corresponding cdf s in low spread conditions bellier et al 2018 another option would be to apply trajectory smoothing over ensemble traces produced with ecc q i e the equally spaced sampling instead of using the ecc t method which could handle the known strong fluctuations jumps of the former while improving the calibration over the t scheme bellier et al 2018 in addition a temporal component could be introduced into the ecc template by using past data statistics thus enabling it to account for the autocorrelation of the forecast error between consecutive lead times ben bouallègue et al 2016 although testing these variants is beyond the scope of this study assessing their suitability for a continental scale forecasting system is also of great interest and could be the subject of future work 6 conclusions and outlook this work provides a comprehensive evaluation of the use of statistical postprocessing on medium range ensemble streamflow forecasts up to 15 days ahead over south america sa forecasts were produced through a continental scale hydrologic hydrodynamic model forced with a global precipitation dataset and reforecasts from the ecmwf ensemble prediction system eps the ensemble model output statistics emos method was used to convert the raw ensemble into predictive distributions for each location forecast day and lead time additionally ensemble copula coupling with the transformation scheme ecc t was applied to derive ensemble traces from emos distributions a set of metrics was used to assess skill calibration and sharpness of raw and postprocessed forecasts against simpler forecasting alternatives such as daily climatology and persistence and the capacity of generating realistic postprocessed forecast trajectories was also evaluated the assessment was carried out for hundreds of gauge stations spread throughout sa the main conclusions can be summarized as follows raw ensemble streamflow forecasts issued by a continental scale hydrological model in sa do not necessarily offer better results in comparison with simpler alternatives such as daily climatology and persistence of the last observed flows while raw ensembles may exhibit some skill in southeastern and eastern regions except são francisco basin for one week in advance generally no skill was found in large basins such as the amazon orinoco tocantins araguaia and west of la plata paraguay by applying emos postprocessing the forecast skill over climatology improved in most locations up to 15 days ahead and skill over persistence was generally observed after four days in advance raw ensemble streamflow forecasts were markedly unreliable in most of the gauge stations even for lead times of one week ahead usually less than 30 of observations were captured by the ensemble emos postprocessing generally increases the spread of raw forecasts and also improves the statistical consistency between forecasted probabilities and observed relative frequencies along the entire forecast horizon however emos was not able to produce skillful forecasts in large rivers where initial hydrological conditions may largely contribute to streamflow predictability emos provided streamflow forecasts that were usually less sharp than the raw ensembles however the differences in average spread between both approaches reduced with lead time with emos exhibiting better sharpness in several locations at longer leads in addition emos resulted in skillful predictions in terms of width of predictive distribution when compared to discharge climatology generating ensemble traces from emos distributions by applying the ecc t method caused little impact on the overall skill achieved by univariate postprocessing however both sharpness skill and improvement in calibration were reduced in comparison with univariate emos especially at shorter leads with differences being smaller for increasing lead times when verification was conditioned on high forecasted discharges ensemble mean non exceedance probabilities of 90 the overall skill sharpness skill and also calibration gained with emos postprocessing decreased in comparison with the results obtained from the entire verification data while the ability of ecc t to represent the autocorrelation of forecasted streamflow was variable in space a relatively good performance was observed mainly in the eastern la plata basin in general limitations for generating realistic forecast trajectories were observed in rivers for which the raw ensemble spread is very low and emos has to largely increase dispersion especially at short lead times for such locations more real time discharge observations may be required for performing further corrections in order to reduce the width of emos distributions the findings of this study suggest that skillful medium range streamflow forecasts could be achieved at the continental scale of sa even if global precipitation data have to be used to initialize the hydrological model future research paths should include assessing the utility of this forecast framework for particular applications e g flood forecast hydropower reservoir operation moreover a further important step in improving the performance of such forecasts is through data assimilation da of river discharge experiments using the mgb sa model and da are ongoing e g wongchuig et al 2019 and the benefits of implementing da together with statistical postprocessing will likely be explored in the near future of course given the large domain of interest performing da would be a great challenge due to the amount of good quality river discharge observations required which are often not available in real time assimilating other sources of data such as the ones derived from remote sensing e g radar altimetry flood extent e g paiva et al 2013b wongchuig et al 2020 can be also a promising way to improve forecasting capabilities in south american countries credit authorship contribution statement vinícius alencar siqueira conceptualization methodology software formal analysis investigation visualization writing original draft writing review editing albrecht weerts supervision conceptualization resources writing review editing bastian klein software writing review editing fernando mainardi fan writing review editing rodrigo cauduro dias paiva conceptualization writing review editing walter collischonn conceptualization supervision writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the first author would like to acknowledge the brazilian coordination for the improvement of higher education personnel capes under grant number 88881 189000 2018 01 capes pdse programa de doutorado sanduíche no exterior and the brazilian national council for scientific research cnpq under grant numbers 141450 2015 and 422422 2016 project south america flood awareness system safas for the financial support we also acknowledge all the hydrological centers that provided observed discharge data ana ons ideam dga grdc ina hybam senamhis princeton university for the mswep precipitation data and the european center of medium range weather forecast ecmwf for making available the reforecast data used in this study finally we thank jan verkade for the support given during the development of this work and the two anonymous reviewers for their useful suggestions which helped us to improve the quality of this manuscript appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2021 126520 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
4386,ensemble streamflow predictions esp from a single hydrological model tend to under sample the variability needed to provide a good representation of streamflow observations esps typically end up being biased and under dispersed making them imprecise and less valuable in an operational context in this study a proposed methodology based on a multi hydrological model approach is applied to address these issues the forecast methodology includes eight lumped hydrological models whose states were updated through data assimilation using an ensemble kalman filter enkf to provide initial states to the models allowing them to better sample uncertainty in the hydrometeorological observations and reduce initial condition errors esp forecasts are then driven by numerical weather prediction ensemble forecasts of the european centre for medium range weather forecasts ecmwf for a nine day lead time on five snowmelt dominated catchments in quebec canada these eight assimilated individual esps are then post processed using a quantile mapping bias correction method after which they are combined in a larger ensemble known as a grand ensemble streamflow prediction gesp using a multi model approach results indicate that the proposed methodology allowed reducing both forecast biases and under dispersion problems for all catchments and four periods corresponding to the seasonality of the streamflow on their own the data assimilation da and post processing manipulations allowed shifting the hydrological ensembles to better encompass the observed streamflow the multi model approach further improved the forecasts by increasing their reliability talagrand diagrams supported by the kolmogorov smirnov test for uniformity as well as the average bin distance to uniformity abdu and the continuous ranked probability skill score crpss were chosen as performance metrics to evaluate the robustness of the methodology these findings suggest that it is possible to improve hydrological short term forecast reliability through a multi model approach in an operational forecasting context keywords hydrological ensemble forecasting hydrological modelling data assimilation streamflow post processing multi model 1 introduction streamflow forecasts play a crucial role in the operational contexts of hydropower generation flood forecasting and water resource management for hydropower and water resource management the goal is to exploit the water resource as efficiently as possible for flood forecasting the objective is to protect and possibly evacuate affected zones as quickly and as safely as possible streamflow forecasts are available in the form of deterministic forecasts or ensemble streamflow forecasts better known as ensemble streamflow predictions esp a deterministic forecast provides a single estimation of incoming streamflow while an ensemble forecast provides a set of several equiprobable streamflow scenarios the term esp is used in this study in the context of numerical weather prediction ensemble nwpe forecasting and should not be confused with extended streamflow prediction performed using past climate observations although a deterministic streamflow forecast requires less computing time and typically has a higher resolution than an esp it can have the perverse effect of giving the impression of certainty by providing a single forecasted value krzysztofowicz 2001 this interpretation can be especially dangerous in an operational context resulting in an overestimation or worse an underestimation of reality on the other hand esp makes it possible to include part of the uncertainty associated with the overall hydrological forecasting processes to assist in rational decision making reducing economic risk krzysztofowicz 2001 for instance including well calibrated uncertainty allows for a better representation of extreme events which can result in decisions that ultimately lead to less economic loss thus esps are an important tool for water resource system managers the nwpe demargne et al 2014 and the hydrological model bennett et al 2014 are two of the different sources of uncertainty included in esps the latter has been found to be usually predominant in the context of short term forecasts bennett et al 2014 krzysztofowicz and maranzano 2004 however several studies arsenault et al 2016 boucher et al 2019 hemri et al 2013 have reported two recurring problems related to the use of esps the forecasts are generally biased and under dispersed when forecasts are biased and under dispersed the realization i e observations when working in hindcast is more likely to fall outside or near the extremities of the forecast envelope one of the elements that contributes to these scenarios is the predominant uncertainty associated with hydrological models hemri et al 2013 it may be due to the hydrological model structure the parameters used the initial states the system calibration and even the observed streamflow used during the model calibration ajami et al 2008 several data manipulation techniques are available to address these issues specifically first and foremost automatic data assimilation cloke and pappenberger 2009 cuo et al 2011 can be used to realign the hydrological model s initial states to reproduce the best estimate of the true observed streamflow this manipulation is typically done at the beginning of each hydrological forecast using in situ information i e streamflow and snow water equivalent measurements as well as observed meteorological and evapotranspiration data data assimilation of deterministic forecasts is often done manually but the process is laborious and unsuitable for esps seo et al 2014 studies have shown that automatic data assimilation methods such as the particle filters pf dechant and moradkhani 2011 and ensemble kalman filters enkf liu et al 2012 methods as well as the bayesian forecasting system bfs reggiani and weerts 2008 are able to improve the streamflow forecast distribution i e a forecast envelope that better encompasses reality performing bias correction i e pre processing on nwpes or post processing on esps is another way to improve the distribution and accuracy of esps since it allows producing forecasts that are statistically inseparable from past observations hopson et al 2019 nwpes pre processing reduces the bias in weather simulations by removing systematic errors georgakakos et al 2014 however in order to be usable in a hydrological modeling framework this pre processing must be carried out while maintaining consistency and correlation between the meteorological variables e g precipitation and temperature that will be fed to the hydrological model wetterhall and smith 2019 alternatively a simpler post processing of the esps can be used to correct the hydrological forecast distribution with the one obtained from the observed streamflow muhammad et al 2018 when only one technique is used some studies have shown that post processing is more efficient than pre processing arheimer et al 2011 wetterhall and smith 2019 several streamflow post processing methods have proven to be effective and are used in different studies such as those involving ensemble model output statistics emos hemri and klein 2017 quantile regression qr muthusamy et al 2016 and quantile mapping qm wood and schaake 2008 the variability of esps can also be improved by addressing the uncertainty of hydrological models which can be different from one model to another in order to exploit the strengths of several different hydrological models and compensate for certain weaknesses the multi hydrological model approach may represent a promising solution arsenault et al 2015 several algorithms are available to average multiple esps these include the maximum likelihood bayesian model averaging mlbma neuman 2003 and the ensemble model output statistics emos hemri 2019 esps from various hydrological models can also be combined to create a larger ensemble called the grand ensemble streamflow prediction gesp resulting in a better representation of uncertainty brochero et al 2011 velázquez et al 2011 the studies referenced above obtained promising results by showing that the overall reliability of the ensemble forecasts increased the main objective of this study is to develop a methodology that allows combining methods that have proven to be successful in the literature in a bid to correct the biases and the under dispersion issues in esp forecasts to this end esps from eight different hydrological models were combined by a multi model framework which was then evaluated on four hydrological period regimes over five catchments in canada the study area and methodology are presented in sect 2 and 3 respectively followed by the results in sect 4 and a discussion in sect 5 the conclusion and recommendations of this paper are presented in sect 6 2 study area the study area is comprised of five sub catchments of the 74 200 km2 lac saint jean catchment located in the province of quebec canada the climate of this region is characterized by hard winters with significant snow accumulation from november to april leading to a snowmelt driven hydrological regime with the freshet occurring during the spring several reservoir hydropower plants on the catchments are managed by the aluminum division of rio tinto which also operates the hydrometric stations used in this study the snowmelt dominated hydrological regime makes reservoir management more complicated by the fact that large volumes of water enter the reservoirs during the spring freshet forcing managers to estimate the optimal amount of water to be discharged depending on their forecasts arsenault et al 2013 short term forecasts are nonetheless necessary to estimate the spillway opening timing during the freshet as well as for the rest of the year this is because the reservoir head plays a major role in the hydropower generating station efficiency and the reservoir level must be kept as high as possible while preventing any spills or worse overtopping therefore the proposed methodology developed in this study could be used by managers to improve their decision making process through the use of a gesp on a forecast horizon typically spanning 1 10 days the lac saint jean catchment is divided into five sub catchments in the present study referred to as catchments hereafter in order to allow considering the position of the retaining structures at their outlet where mass balance computations were conducted to reconstruct observed streamflow from reservoir levels and flow drawdowns the five catchment sample also allows assessing the impact of the surface area on the techniques analyzed in this study table 1 presents the hydrological characteristics of each catchment while fig 1 gives their locations and ground elevations the statistics are also presented over four individual seasons corresponding to the seasonality of the streamflow on the study catchments december to march djfm winter low flows april and may am spring freshet june to august jja summer low flows and convective storms and september to november son fall synoptic storms 3 methodology this section details the different steps of the proposed methodology the source of meteorological and hydrometric data employed as well as the techniques used to perform calibration data assimilation hydrological modeling data post processing and multi model clustering are discussed finally several performance metrics are introduced to evaluate the performance of the methodology at each step 3 1 overview ensemble forecasting systems efss include all prediction systems that can be designed in different ways one of them the gesp is formed by feeding an nwpe into more than one hydrological model velázquez et al 2011 a gesp is also formed when two or more nwpes are fed into at least one hydrological model bourdin and stull 2013 however the methodology described in this paper is based on the former gesp type to integrate a gesp into the decision making process many steps must be performed to transform weather forecasts into representative streamflow forecasts fig 2 shows the proposed methodology used in this paper the steps are summarized next and are further described in the following sub sections first and foremost forecast data from an nwpe must be obtained in order to feed the hydrological models to generate the esps in this study a total of eight different hydrological models are calibrated using historical climate data data assimilation is then performed with these models using the enkf method to generate 25 perturbed initial states the nwpe in this study provides 50 members leading to the hydrological modeling of a 1250 member ensemble 50 nwpe members 25 enkf perturbed initial states for each day of forecast a post processing bias correction technique is then performed followed by a multi model technique to combine the resulting esps within a gesp to tackle hydrological period regime variability referred to as seasons hereafter the last steps are repeated to separate the forecasts into four distinct seasons in order to compare each step of the methodology to the same reference the 50 member nwpe used as input in the hydrological models before performing data assimilation post processing and the multi model gesp is considered as the open loop ol simulation and serves as a baseline for the analyses the hydrological prediction laboratory hoopla toolbox thiboult et al 2019 is a software application developed at the department of civil and water engineering of université laval quebec canada it was created to perform multiple integrated manipulations such as potential evapotranspiration pet and snow accounting routine sar computations and data assimilation and hydrological modeling on a large set of hydrological models in this study hoopla is used to perform the hydrological model calibration data assimilation and simulation steps as shown in fig 2 3 2 forecast data the nwpe forecasting data used in this study was extracted from the european centre for medium range weather forecasts ecmwf database for the five study catchments a total of 50 simulations also known as members were available at an 18 km resolution and covered the january 2015 to june 2019 time period the 50 member nwpe was generated for each day with a forecast lead time of 9 days this means that the january 1 2015 forecast provides information until january 9 2015 the precipitation and minimum and maximum temperature variables were extracted from the forecast at a 6 hour time step however considering that the hydrological models used in this study only perform at the daily time step the 6 hour time step was converted to a daily one by aggregating the precipitations and taking the maximum and minimum air temperature values over the period 3 3 hydrological model calibration the hoopla toolbox thiboult et al 2019 was used to perform the calibration and simulations using eight different hydrological conceptual lumped models table 2 lists all eight hydrological models along with details of their structure namely the number of parameters and conceptual reservoirs the pet was calculated with the oudin formula oudin et al 2005 and the cemaneige valéry et al 2014 sar computation having previously shown good performance over similar catchments in the same region poissant et al 2017 was selected for all hydrological models the shuffled complex evolution university of arizona sce ua duan et al 1992 optimization algorithm was chosen for the calibration as it had previously performed very highly with simple hydrological models similar to the ones used in this study arsenault et al 2014 the kling gupta efficiency kge gupta et al 2009 was selected as the performance metric for the calibration process and is defined following eq 1 1 kge 1 r 1 2 α 1 2 β 1 2 where r is the correlation coefficient α is a measure of variability and β is the bias between observed and simulated streamflows a kge score of 1 indicates a perfect fit between observations and simulations and a score greater than 0 41 means that the simulation is better than the average observed streamflow as shown by knoben et al 2019 the calibration of the eight hydrological models was performed over the 1953 2019 period using hydrometeorological observations provided by rio tinto for the five catchments since the observed streamflows were reconstituted by water mass balance some pre processing was required negative and zero streamflow rates were not considered in the calibration it should be noted that the forecast period 2015 2019 was included in the calibration following the recommendations of arsenault et al 2018 to obtain more robust parameters in all cases the 4 5 years of validation weigh very little over the entire period 1953 2019 tested but not shown and even if there was a significant increase in performance over the forecast period all subsequent tests would use the same model and would gain the same advantage leaving the conclusions unchanged 3 4 data assimilation data assimilation da aims mainly to modify the hydrological model initial states to better represent the prevailing hydrological conditions on the catchment allowing simulations to better approximate the true observed streamflow accounting for uncertainties and negating the effects of model drift seo et al 2014 in a streamflow forecasting context these optimal hydrological model initial states which provide the closest possible simulation of the true observed streamflow at the beginning of the forecast are used as starting model states in the present case the objective of da was to reduce the bias between each member of the eight esp forecasts and observations to this end the ensemble kalman filter enkf evensen 1994 was used as the da method and was implemented using the hoopla toolbox the enkf method and its interpretation are explained in detail in evensen 2003 but summarized as follows for each hydrological model all initial states that represent water storage e g subsurface routing and underground reservoirs snowpack etc were updated depending on the model s structure the rainfall and temperature uncertainty were introduced by sampling from a normal temperature and gamma precipitation distribution whose parameters are those that were modified during the implementation observation errors in streamflow rainfall and temperature were modelled using a gaussian noise approach one of the challenges of the enkf method is the need to quantify the uncertainty related to hydrometric and meteorological measurements considering that the study catchments observed streamflows are derived from mass balance estimations at the hydropower locations they are expected to be further affected by some level of bias as compared to real natural streamflow in addition to other sources of uncertainty such as precision errors in measurements even if evaluating the flow drawdowns from the hydropower locations or spillways and reservoir level fluctuations over longer times is still quite precise with respect to meteorological variables such as precipitation it is also difficult to obtain perfect representations over the catchment due to the spatial distribution of weather stations which inevitably leads to errors in real observations given the uncertainties in the reconstitution of inflows considered to be within 10 15 in this study and in meteorological measurements considered to be between 10 and 50 for precipitation 1 and 2 c for temperature in this study the enkf makes it possible to sample the uncertainty of these variables and to then create an optimal set of initial states closer to the true observed streamflow noh et al 2019 in many studies the enkf method has proven very effective in reducing the bias between simulations and observations bergeron et al 2016 jiménez et al 2019 maxwell et al 2018 abaza et al 2014 showed that using the enkf also increased the reliability of hydrological simulations for any period of the year except for the freshet season which was not assessed in their study moreover they found that while using an ensemble of 1000 members with the enkf algorithm provided optimal results a number between 20 and 50 members was sufficient when forecasts are post processed in this study an ensemble of 25 initial states derived from the enkf method combined with the 50 member nwpe allowed creating an ensemble of 1250 members for each forecast it should be noted that the results that will be presented in section 4 of the manuscript were obtained with a standard deviation equal to 15 30 and 2 c of the streamflow precipitation and temperature observations respectively 3 5 hydrological modeling hydrological modeling is performed using the eight hydrological models and their previously calibrated parameters the 25 daily initial states of each hydrological model obtained at the da stage are used to initialize the forecast the 50 nwpe forecast members are then provided to the hydrological models to obtain eight individual esps thus each esp containing 1250 members 25 initial states combined with the 50 nwpe members was simulated for each of the nine day forecast lead times during the january 2015 to june 2019 period these esps are then post processed and grouped into a gesp to complete the methodology 3 6 post processing while da allows reducing the error of the initial states residual biases and other sources of errors from the various processes are present in final streamflow forecasts performing some post processing to bias correct simulated streamflow is one of the preferred ways to improve the forecast reliability bias and accuracy wetterhall and smith 2019 a quantile mapping qm post processing was thus performed on streamflow forecasts distributions over the four individual seasons corresponding to the seasonality of the streamflow on the study catchments previously defined djfm am jja and son this post processing method corrects the streamflow percentiles of the simulated distributions with those of the observed distributions a unique set of 100 correction factors correcting each percentile of the forecasts distribution was established for each season as well as each forecast lead day 9 in total to ensure temporal independence as suggested by hamill 2001 a time delay between each forecast was kept the time delay was fixed at three days as suggested by pappenberger et al 2011 for instance starting on january 1st the next forecast release used would be january 4th discarding both days in between and so on hashino et al 2007 concluded that the qm method is simple efficient in reducing bias and more effective for low flows than other methods such as qr other studies muhammad et al 2018 wood and schaake 2008 demonstrated that the qm improves the reliability and the performance of esp forecasts in most cases when used for post processing streamflow simulations in order to perform bias correction on esps the qm method must be performed after the da is completed otherwise the qm method would attempt unsuccessfully to correct the spread of wider distributions obtained from the biased initial states of the hydrological models these inefficiently corrected esps would not be able to achieve the objectives of the proposed methodology for this reason the qm method is not independently compared to the da method to ensure the robustness of the bias correction a split sample validation using 80 of the data selected through a systematic sampling to calculate the correction coefficients to be applied to all the individual esp distributions of a given season was selected the remaining 20 of data of every fifth forecast was used to validate the robustness of the correction all post processed results shown hereafter pertain uniquely to the validation dataset 3 7 hydrological multi model approach a simple multi model approach was preferred in order to evaluate the compromise between simplicity and performance needed in an operational context the selected method consisted in grouping the eight esps together effectively generating a gesp to better sample the overall uncertainty thus the eight esps each containing 1250 members were combined into a single gesp containing 10 000 members without any distinction from the individual hydrological models 3 8 performance metrics different quality attributes can be evaluated based on different metrics and in turn be used to assess the quality of a forecast in this study three of these attributes are used and are defined as follows according to anctil and ramos 2019 accuracy average difference between individual forecasts and observations bias difference between average forecast and average observation reliability agreement of forecast with observation conditioned on the forecast issued cloke and pappenberger 2008 suggest using several performance metrics to ensure the reliability of forecasts obtained thus different performance metrics are used to compare the results of each additional step da qm post processing henceforth referred to simply as qm and gesp with those of the ol simulations to confirm their added value hereafter the term manipulation will be used to refer to the da qm and gesp steps it is important to note that the qm manipulation includes da and the gesp manipulation includes both da and qm anctil and ramos 2019 reviewed several verification metrics including the talagrand diagram the continuous ranked probability score crps and the continuous ranked probability skill score crpss talagrand diagrams are commonly used to illustrate the ensemble dispersion versus observed data in the context of hydrological forecasting fan et al 2014 olsson and lindström 2008 voisin et al 2011 although well suited to assess the reliability of esps zappa et al 2013 their visual aspect may be misinterpreted and it is preferable to combine them with a complementary statistical test for validation hamill 2001 the shape of the talagrand diagram is essential in order to assess the dispersion of an esp a shape diagram indicates that the esp is under dispersed and is not wide enough to include observations observations are then found at the extreme limits of the esp either in the first or last percentiles hence the shape inversely a shape diagram points to an esp that is over dispersed and therefore too wide a or shape indicates a positive or a negative systematic bias respectively these shapes which are completely outside the left or right side of the diagram are obtained when the esp does not represent the observations at all finally a flat diagram is the desired shape indicating a uniform distribution of observations in the esp and providing the right amount of variability without any biases the kolmogorov smirnov test k s test was chosen to reject or not the hypothesis of uniformity α 5 if the hypothesis of uniformity is not rejected it means that the esp forecast is likely to provide the right amount of variability represented by a flat talagrand diagram which allows a better evaluation of the overall uncertainty the average bin distance to uniformity abdu score was also added to quantitatively measure the deviation from uniformity previously used by arsenault et al 2016 on the lsj catchment and is defined following eq 2 2 abdu 1 n k 1 n s k m n where sk is the number of occurrences in bin k m is the number of y values and n is the number of histogram bins an abdu score is equal to zero when there is no deviation from uniformity the abdu is an empirical measurement to quantify the evaluation of the rank histogram and does not follow any particular distribution in this study this metric cannot compare seasons with each other since it is directly affected by the total number of values n forming the talagrand diagram and the lengths of the seasons used are not equal instead it will serve as a quantitative metric to compare the distribution between two ensembles and determine which is closer to uniformity over a given season finally the crps and crpss are calculated to evaluate the overall accuracy of the forecasts these two metrics are commonly used in hydrological forecasting muhammad et al 2018 pagano et al 2013 schaake et al 2007 the crps is defined following eq 3 3 c r p s k f k x f k o 2 d x where f k x is the predictive cumulative distribution function between a given esp forecast and the observed streamflow k x is the predicted variable and f k o is the corresponding observed cumulative distribution function anctil and ramos 2019 the crps score will not be analyzed directly and is only used to calculate the crpss score which allows a direct comparison of the ol simulation with other simulations obtained after da qm and gesp manipulations the crpss is defined following eq 4 4 crpss 1 crps b k crps ref k where crpsb is the score calculated from the modified forecast and crpsref is the score of the ol simulation the crpss was used in this framework to evaluate incremental gains in performance relative to previous steps rather than using the classical climatology esp this is done to contextualize the changes in performance at each step a crpss score greater than zero indicates an improvement in the forecast ensemble accuracy as compared to the ol ensemble the crpss values range varies from to 1 with 1 being the best possible score and a score below zero indicates a decrease in performance thus results under 1 will be ignored and simply considered as pointing to very poor performance similar to the post processing a time delay must be kept between the forecasts used to calculate these verification metrics to ensure their temporal independence hamill 2001 a three day delay was kept between each data point of the metrics as suggested by pappenberger et al 2011 4 results this section details the results of the different manipulations of the proposed methodology different topics are investigated such as the hydrological model calibrations the respective performances of the da and da followed by qm methods a comparison between esp and gesp performance the impacts of the catchments area the parameterization of the da and an evaluation of the short term forecast performance 4 1 calibration of the hydrological models the kge scores obtained following the calibration of the hydrological models on the five catchments are presented in table 3 the highest kge scores are obtained on the largest catchment lsj and the lowest kge scores by a relatively small margin are seen on the smallest catchments cs overall all the hydrological models evaluated show good skills over the study catchments however some models such as mohyse simhyd and topmodel exhibited poorer performances on smaller catchments cs and lm while other models such as gr4j and hbv performed very well on them when hydrological models are used on the larger catchments cd pd and lsj their kge scores are similar of the eight hydrological models tested the gr4j provided the best performance or was among the best in terms of kge scores after calibration for the five catchments for the sake of simplicity the results shown hereafter are focused on the gr4j hydrological model and the lsj catchment the conclusions obtained with gr4j and lsj are consistent with those obtained for the other hydrological models and catchments 4 2 impact of data assimilation and bias correction on individual esp performance the talagrand diagrams for the ol simulations fig 3 indicate that the observed streamflow is almost always outside of the forecast ensemble envelope for all four seasons djfm am jja and son while systematic biases are obtained for djfm negative jja and son positive am exhibits a shape pattern indicating under dispersion of the ensemble other studies boucher et al 2019 hemri et al 2013 arsenault et al 2016 have reported similar issues with the ol simulations with other hydrological models for different periods of the year these observations prove the relevance of using the da and post processing methods on streamflows fig 3 also indicates that performing da with the enkf algorithm provides additional variability to the ensemble for each season allowing the forecast to better encompass the observed streamflow and leading to a decrease in the abdu score finally when data assimilation enkf is combined with bias correction qm the additional variability obtained further increases the dispersion of the esps and reduces the abdu score over all seasons except for am the k s test rejected the hypothesis of uniformity α 0 05 for all ensembles except for the f h k and l ensembles in fig 3 4 3 comparison between individual esps and the gesp performances the objective of the multi model gesp manipulation was to add enough variability to the individual esps after da and qm by grouping them together into a gesp the same manipulations were performed with the other seven hydrological models as displayed in fig 4 the results of the gesp multi model set are also presented in fig 4 for ease of comparison even after performing da and qm all individual esps remain under dispersed for at least one or two seasons all esps created by the eight individual hydrological models in the am season corresponding to the spring freshet present shapes indicating under dispersion relative to streamflow observations fig 4 also shows that the k s test rejected the hypothesis of uniformity for the majority 14 16 of the ensembles during the djmf and am seasons but failed to reject the same hypothesis for more than half 11 16 of the ensembles during the other two seasons jja and son overall no single esp or hydrological model outperformed all other esps and their performance varied strongly from season to season as well as from catchment to catchment this also indicates that each esp is likely to contribute to additional variability to the forecast in a gesp allowing to better encompass variabilities in the observed streamflow this can best be observed in the last row of fig 4 which shows the results with the gesp while the abdu values from different single esps still outperform the gesp in some specific cases cequeau and ihacres for djfm hymod and topmodel for jja the gesp provided the lowest abdu values for the am and son seasons with the largest improvements seen over the am season furthermore the k s test failed to reject the hypothesis of uniformity over all seasons most notably over the am season for which the k s test rejected the hypothesis for every single esp it should be noted that very similar results were obtained over the other catchments the main difference is that the k s test rejected the hypothesis of uniformity for the gesp over two seasons over the cd catchment and one season over the cs catchment as shown in fig 5 however the gesp still outperforms almost all individual esps in terms of the abdu score furthermore the k s test failed to reject the hypothesis of uniformity over all seasons for the geps most notably over the am season for which the k s test rejected the hypothesis for every single esp however a visual inspection of the am season talagrand diagram suggests that the gesp has indeed improved but still remains under dispersed this is likely due to the fact that the k s test is not very powerful on its own but when combined with the talagrand diagram it still provides valuable information in terms of improvement when comparing the gesp to the individual esps 4 4 impact of catchment characteristics as discussed in the previous section when comparing individual esps with each other no single esp or hydrological model outperformed all other models however results suggest that this behavior is also dependent on the catchment surface area since the models that performed better than the others over a given season vary from catchment to catchment fig 5 presents the gesp forecast distribution for all five catchments in most cases a more uniform distribution of the forecast members shown with flatter talagrand diagrams indicates that the use of the gesp has brought the ensemble closer to uniformity compared to individual esps fig 4 for lsj catchment and online supplementary materials figs s1 s4 for the other four catchments indeed the k s test failed to reject the hypothesis of uniformity for all ensembles except for three of them j l and n it can be seen that these three cases occurred on two of the smallest catchments cd and cs suggesting that the catchment size could have an impact on potential forecast improvements furthermore some ensembles remain under dispersed e g g j n and r or even over dispersed e g q 4 5 impact of data assimilation parameterization different data assimilation parameters were tested to add different levels of uncertainty to the hydrological model calibration data i e observed precipitation temperature and streamflow the standard deviation of the uncertainty distribution for each observation was set between 10 and 50 of precipitation 1 and 2 c for temperature and 10 and 15 for streamflow fig 6 presents the impact of different da parameters on the gesp using talagrand diagrams the ol performances for the gesp using the q σ15 and p σ30 da parameters are shown in supplementary materials fig s9 to allow for a comparison with the results obtained for the different parameter sets the results indicate that changes in standard deviation of both streamflow and precipitation have only a marginal impact on ensemble dispersion and no clear pattern can be observed in terms of abdu score estimated temperature uncertainty ranged from 1 to 2 c and provided very marginal impact not shown 4 6 evaluation of the short term forecast performance in order to compare the added value of each methodological manipulation da post processing with qm and combination of esps with the gesp to the forecast accuracy their crpss value was computed against ol simulations furthermore the crpss values were also computed over the nine forecasting days for each manipulation to assess their skill in the short term these results are presented with fig 7 boxplots for the lsj catchment it can be seen that the median crpss value of each boxplot is above 0 for all cases indicating that the short term forecast accuracy is improved with each data manipulation performed as expected the forecast accuracy is gradually decreasing over time in most cases bias correction and the use of the gesp improve the crpss score as compared to using da only however combining all esps into a gesp does not always increase the accuracy of the forecast when compared with the gr4j bias corrected simulations 4 7 impact of the hydrological season by analyzing the different performance metrics after each manipulation da qm and gesp it is possible to confirm that the results depend on the forecast season fig 3 shows that the da reduces abdu scores over all seasons while the qm does not seem to perform as well in reducing the abdu score during the freshet season am when the hydrological ensembles are grouped in a gesp figs 4 and 5 the distribution of this larger ensemble is similarly improved during the djfm jja and son seasons the distribution of gesp ensembles during the am season still shows under dispersion over most of the catchments 3 5 the crpss score results fig 7 also allow to observe the impact of the different hydrological seasons while the three methods used da qm gesp lead to a significant improvement of the crpss during the djfm season they seem to have a lesser impact on the results of the am season on the lm and cs catchments e g figs s5 and s7 for the cs catchment with the gr4j and ihacres models respectively crpss scores even drop below 0 on the last forecast day and are close to 0 by the fifth day this indicates that the proposed methodology is unable to improve ensemble accuracy over the two smallest catchments during the am season beyond a few days despite these difficulties during the am season in the lm and cs catchments the methodology effectively corrects for bias in the majority of forecasts fig 8 shows an example of a 9 day hydrological forecast to better visualize the performance of the methodology over the lsj catchment during the am season for the other two seasons jja and son the crpss scores are improved to a lesser extent than those of the djfm season but still remain above 0 for all nine forecasted days indicating an improvement in the accuracy over the ol simulation 5 discussion this section assesses the performance of different manipulations performed on esp forecasts in order to meet the main objective of this study which was to develop a methodology to correct the problems of bias and under dispersion in forecast ensembles the effectiveness of each streamflow manipulation method da qm and gesp is discussed first followed by a discussion of the impact of the hydrological season the performance of the overall methodology and their limitations 5 1 performance of data assimilation using the enkf the use of enkf at the data assimilation stage is intended to reduce the bias between the members of the esp forecasts and the observations this is achieved by sampling the uncertainties in hydrometeorological i e streamflow precipitation and temperature measurements to correct the hydrological models initial states as shown in fig 3 the enkf method is able to reduce the abdu scores between esps and observations for all seasons over the lsj catchment overall there is an improvement in the spread of the esps as exhibited in the talagrand diagrams for all seasons while these improvements were significant for both the am and son seasons resulting in a failure to reject the hypothesis of uniformity based on the k s test the under dispersion displayed as a shape in the talagrand diagram remains problematic in the case of the other seasons djfm and jja fig 3 suggests that da has been unable to correct the systematic biases both positive and negative in the esp forecasts this could be due to the fact that the method is effective in reducing errors in the initial conditions that improve simulated streamflow but does not allow full consideration of the uncertainty of the observations and may compromise the reliability of the predictions by adding random uncertainty as maxwell et al 2018 had warned there is also no guarantee that the post assimilation initial states would generate a streamflow that is more dispersed it can be seen in fig 6 that there is no optimal value in the hydrometeorological estimation provided to the enkf method and that this estimate is strongly dependent on the season and the catchment analyzed not shown thiboult and anctil 2015 also observed that both the catchment and the hydrological model had an impact of the enkf performance however what is most notable in the results in fig 6 is that no matter the value used as an estimate of the uncertainty in the hydrometeorological measurements data assimilation always improves the forecast performance when compared to the ol simulation these findings are also supported by abaza et al 2014 who used an ensemble of 1000 members different initial states using the enkf method over a forecast period of 10 days as shown in fig 7 the gradual decrease in the forecast performance as the lead time increases with a gradual decrease in the crpss median value indicates that the da tends to be more efficient in the shorter term up to 2 3 days bergeron et al 2016 obtained similar conclusions where data assimilation of streamflow data using enkf was notably more efficient over only a few days of hydrological forecasts however the crpss median value remained above 0 for the nine forecast days indicating an improvement brought about by data assimilation over the baseline ol simulations it is worth mentioning that there is a paradox in the data assimilation process in applying uncertainty to observed streamflow data and considering the very same observations as perfect when computing the performance metrics such as the crpss while this remains outside the scope of this paper different approaches to verify ensemble forecasts against non perfect observations have been suggested by some authors e g pappenberger et al 2009 santos and ghelli 2012 ferro 2017 5 2 post processing performance with qm bias correction fig 3 shows that for the lsj catchment and the gr4j hydrological model the post processing of esp forecasts using the qm method allows solving some of the under dispersion over all seasons with the exception of the freshet season am this is also supported by a decrease in the abdu score and a failure to reject the hypothesis of uniformity with the k s test for both the jja and son seasons as noted by li et al 2017 the decrease in performance obtained during the freshet versus the da can be explained by the fact that the correction does not preserve the temporal connection in the snowmelt process overall the results shown in fig 4 for all eight individual esps indicate that the qm post processing is not able to correct the under dispersion problem fig 7 shows the boxplots of the daily crpss obtained by the forecasts over the lsj catchment simulated by the gr4j model over a nine day lead time the median crpss of the boxplots computed from the post processed qm forecasts are always above zero showing better performance than for the ol simulations and are almost always higher than the median values obtained for the da similar results were obtained for the other hydrological models and catchments e g the ihacres model figs s6 and s8 on the lsj and lm catchments respectively with the exception of the smaller cs catchment for which the median crpss values for da are often higher than those for qm depending on the season e g figs s5 and s7 with the gr4j and ihacres models respectively this suggests that for most cases the post processing of esps further improves the forecast accuracy versus both the ol and da ensembles overall the results show that post processing using the qm bias correction technique allows reducing the biases in the esps in most cases but shows little skill when it comes to improving the under dispersion problem this finding is also supported by hashino et al 2007 who showed that qm was effective in reducing the biases of monthly streamflows while the present study investigated daily streamflows the relatively short temporal period considered in this study i e 4 5 years some sort of overfitting may sound like a potential issue it should be reminded that the goal of this study was to demonstrate that the combination of multiple esps can significantly improve the under dispersed and biased forecasts even if data assimilation and post processing have been conducted previously in the eventuality that the bias corrected forecast is overfitted and that the validation correction is better than it should be this is only strengthening the conclusions of this study indeed as demonstrated previously such post processing remains insufficient to properly correct the forecast and significant improvement is still obtained from the combination of multiple post processed esps into a gesp 5 3 multi model performance analysis the final methodological manipulation brought together the different esp forecasts of the eight hydrological models into a single gesp the goal here was to aggregate the strengths and weaknesses from each individual hydrological model and to then obtain a larger ensemble that best encompasses the overall uncertainty it can be seen that this additional manipulation is indeed capable of reducing the abdu score as well as the under dispersion problem shown with shaped talagrand diagrams for all seasons as compared to each individual esp fig 4 by combining the strengths and the weaknesses of the different esps the gesp significantly improved the forecast distribution and failed to reject the hypothesis of uniformity for all seasons the largest improvement was seen over the am season in which all individual esps were strongly under dispersed fig 4 these results were found to be consistent from one catchment to the next as shown in fig 5 when comparing the crpss obtained from the gesp to the esps fig 7 gr4j hydrological model over the lsj catchment results indicate that the forecast accuracy of gesp is strongly improved when compared to the ol simulation but does not improve beyond what is achieved with the qm post processing this was fairly consistent over the nine day forecast lead time while the gesp is not able to outperform the qm in this case analyses of the other seven individual hydrological models e g figs s6 s8 for the ihacres model indicate that the gesp forecast accuracy is usually greater than or equal to the one from the post processing furthermore on the last day of the forecast the median crpss of the gesp is almost always greater than or equal to the ones from individual esps after da and qm overall these results indicate that there is an advantage in grouping together esps from different hydrological models into a gesp especially as the lead time increases these findings are supported by velázquez et al 2011 who conducted a similar analysis using 16 hydrological models their study unsurprisingly found that the accuracy of gesp forecasts decreases as the lead time increases as also shown in fig 7 however it should be noted that the methodology in velázquez et al 2011 was much simpler as it did not include any post processing and the data assimilation technique used only consisted of an average streamflow error correction which is known to potentially lead to less accurate medium to long term forecasts mai et al 2020 ercolani and castelli 2017 the present study was carried out by grouping together the forecast ensembles of eight hydrological models but the results obtained could be altered by using a larger or smaller number of models the dispersion level should further improve if the number of hydrological models used is increased however there would probably be diminishing returns at the cost of increased computing expenses velázquez et al 2011 obtained promising improvements using 16 hydrological models in their gesp similarly using fewer than eight models would likely still provide significant improvements as compared to individual esps however there is probably no optimal number of hydrological models that can be used since results have been shown to vary from catchment to catchment and from season to season however considering that all eight hydrological models used in this study have shown relatively good and similar levels of performance in validation see table 3 it remains unclear if including a poorly performing hydrological model in the gesp would be useful or not there is also an obvious drawback from using additional hydrological models in an operational context which is the additional burden in terms of calibration documentation training and maintenance 5 4 impact of the hydrological season on the forecast looking at the results in fig 7 it can be seen that there is little to no drop in accuracy for the djfm over the nine forecasted days this is likely due to the winter hydrological regime of the djfm season which is characterized by low flows and almost no liquid precipitation which makes it easy to estimate short term flow for the other seasons the accuracy of the ensembles drops progressively as the lead time increases in contrast to the djfm season the hydrological regime of the other seasons can vary greatly and involves more variable processes e g snowmelt rainfall runoff etc that are harder to forecast which could in turn explain the progressive decrease in ensemble accuracy over the 9 forecast days this finding is supported by the larger inter quartile range of the boxplots for the am jja and son versus the djfm season it can be observed that the variability following qm and gesp manipulations is larger than that from da mainly during the am season the snowmelt process which is highly active during the am season is mostly affected by the temperature for which forecasts are less variable than for precipitations the relative ease of forecasting temperature versus precipitation could explain the smaller inter quartile range in the da boxplots as compared to the summer seasons seen in fig 7 as mentioned previously the median crpss scores reach below 0 after the sixth day of forecasting during the am season e g cs and lm catchments with gr4j model and gesp fig s5 for the cs catchment this suggests that the different manipulations face difficulties correcting the variable streamflow of the snowmelt season these difficulties are also supported by the talagrand diagrams figs 3 5 for the am season which rarely exhibits a uniform distribution even after all the manipulations have been performed 5 5 overall methodology performance analysis as previously demonstrated the use of enkf as a data assimilation method combined with the post processing of data with the qm significantly reduced deviations from uniformity reduction of the abdu score and more likely to fail to reject the hypothesis of uniformity with the k s test and the bias in esps resulting in an increase in the crpss when compared to the ol simulation the grouping together of the individual hydrological model esps into a gesp allowed reducing the under dispersion problem leading to the best overall results these findings were observed over all catchments and for all hydrological seasons analyzed in addition while the talagrand diagrams showed systematically biased esp forecasts in the ol simulation the complete methodology resulted in distributions closer to uniformity however the shape could not be prevented in all cases and notably so during the spring freshet over the months of april and may the different surface areas of the five catchments do not seem to have significant impacts on the distribution of the gesp forecasts however the smallest catchment which is 1297 km2 is arguably still quite large and catchments smaller than 500 km2 for example could see different conclusions 5 6 limitations some limitations to this study must be mentioned and are listed hereafter number and length of nwpes in this project a total of four and a half years of the ecmwf nwpe were available which was considered sufficient to meet the study objectives ideally the nwpe used to feed the hydrological models should be extended over a period of several years to allow a better assessment of the robustness of the proposed methodology however it was not possible to extend beyond four and a half years due to major updates in the forecast model that would have led to vastly different statistics furthermore more than one nwpe could be used to test whether the results are consistent with other models individually or combined into a multi nwpe multi hydrological model gesp forecast lead time a lead time of nine days was used for all forecasts in this study this means that the findings are limited to this lead time and different conclusions could be obtained for forecasts beyond nine days it should be noted that this choice corresponds to the forecast lead time needed in the operational context number of hydrological models it is important to note that some of the methodological choices made in this study could have more or fewer impacts in other similar studies one such choice is the use of eight lumped hydrological models it is possible that using more or fewer models could improve or reduce the overall performance depending on the characteristics of each model indeed if all models are very similar and do not provide an adequate sampling of the hydrological models structural uncertainty then it is quite likely that there would not be any significant gain in using multi model forecasts however using fewer models that explore a larger part of the model structural uncertainty could provide the necessary flexibility for the multi model implementation to perform better moreover using semi distributed or distributed hydrological models could provide additional information not available within lumped models number of catchments only five catchments were analyzed in the study moreover these large catchments from 1297 km2 to 46 747 km2 are clustered in the same region in quebec canada evaluating the methodology on smaller catchments less than say 500 km2 and on catchments located in other climatic regions could bring different conclusions different ensemble sizes comparing individual esps to the gesp in this study inevitably led to different ensemble sizes 1250 members for each esp and 10 000 for the gesp while performance metrics like the talagrand diagram are not sensitive to ensemble size at these scales a metric like the crpss can lead to biased results if not corrected as suggested by ferro et al 2008 unbiased crpss can be obtained through a simple correction based on the ensemble sizes in the case of this study the ensemble sizes used have no significant impact on the results obtained limited resources completion of all the steps in the proposed methodology could be a limitation for some users with limited resources in this study we have implemented the main forecasting steps i e data assimilation ensemble hydrological forecasting post processing and multi model combination however some of these steps can be considered more critical than others namely the data assimilation which cannot be skipped as that would lead to very different initial states for the various models over time also the gesp step seemed to provide more benefits than the hydrological post processing of the ensemble as for the use of ensemble forecasts rather than deterministic ones this aspect was not evaluated here and thus we prefer not to comment on its importance however the literature on this subject seems clear that using ensemble forecasts provides a significant benefit for forecasting reliability 6 conclusion and recommendations this study presented a new methodology aimed at addressing the problems of bias and under dispersion of ensemble forecasts esp through the use of a multi model approach to combine individual hydrological model esps into a gesp to assess the performance and robustness of the proposed methodology it was compared with each preceding manipulation against an ol simulation baseline in order the three main manipulations that were evaluated are data assimilation da using the ensemble kalman filter enkf method post processing using quantile mapping qm and lastly an aggregation of eight individual hydrological model esps into a gesp the comparison was performed using several graphs and performance criteria typically used to evaluate forecasts namely the talagrand diagram the abdu score the k s test and the crpss the da with the enkf initially improved the individual esp dispersion abdu score and accuracy crpss value as compared to the ol ensemble but was still mostly under dispersed or systematically biased the qm did solve the systematic bias issue but further reduced the abdu scores and increased the crpss value over most individual esps despite the improvements brought about by the da and the qm most of the esps remained under dispersed over all catchments and most notably during the freshet season am using a multi model clustering of individual esp forecasts into gesp forecasts was found to be effective in further reducing ensemble bias and under dispersion when compared to the results of the majority of individual esps that underwent da and qm some individual hydrological models performed better on a specific catchment and hydrological season but overall the gesp forecasts had lower abdu scores higher crpss values and failed to reject the hypothesis of uniformity using the k s test more often than the individual esps the gesp was also found to perform similarly to or better than the best individual esp for any of the catchments or seasons tested the results obtained in this study support the proposed methodology in reducing bias and ensemble under dispersion the methods used are simple and could easily be integrated in an operational context the use of gesp forecasts can represent a powerful tool to add the variability to the ensembles needed to reach uniformity while remaining as accurate as or better than the best individual esp it should be noted that in all cases using any or a combination of da post processing and multi model approaches will significantly improve forecasts by reducing bias and correcting typical ensemble under dispersion however it is important to remember that different data processing methods can add uncertainty to esp forecasts which can vary from season to season and from catchment to catchment and ultimately may be misinterpreted in a forecasting context future research could attempt to test different uncertainty estimations for driving the da process depending on the seasons or try to introduce a probabilistic multi model method with density forecasting to the proposed methodology a modification to the methodology by applying post processing to the gesp after the grouping of esps into gesp rather than on each individual esp could also be an interesting simplification to analyze in a future research credit authorship contribution statement patrice dion conceptualization methodology software validation writing original draft visualization jean luc martel validation writing review editing supervision richard arsenault conceptualization methodology resources supervision funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this work was supported by the natural sciences and engineering research council of canada grant number crdpj 522126 17 the authors would like to thank rio tinto for providing hydrometeorological and hydrological data of their catchments we are also grateful to the european centre for medium range weather forecasts ecmwf for providing access to the nwep forecast data from their computing and archiving facilities finally we would like to acknowledge the anonymous reviewers whose insightful comments and suggestions helped improve the paper and shape it into its current form appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2021 126537 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
4386,ensemble streamflow predictions esp from a single hydrological model tend to under sample the variability needed to provide a good representation of streamflow observations esps typically end up being biased and under dispersed making them imprecise and less valuable in an operational context in this study a proposed methodology based on a multi hydrological model approach is applied to address these issues the forecast methodology includes eight lumped hydrological models whose states were updated through data assimilation using an ensemble kalman filter enkf to provide initial states to the models allowing them to better sample uncertainty in the hydrometeorological observations and reduce initial condition errors esp forecasts are then driven by numerical weather prediction ensemble forecasts of the european centre for medium range weather forecasts ecmwf for a nine day lead time on five snowmelt dominated catchments in quebec canada these eight assimilated individual esps are then post processed using a quantile mapping bias correction method after which they are combined in a larger ensemble known as a grand ensemble streamflow prediction gesp using a multi model approach results indicate that the proposed methodology allowed reducing both forecast biases and under dispersion problems for all catchments and four periods corresponding to the seasonality of the streamflow on their own the data assimilation da and post processing manipulations allowed shifting the hydrological ensembles to better encompass the observed streamflow the multi model approach further improved the forecasts by increasing their reliability talagrand diagrams supported by the kolmogorov smirnov test for uniformity as well as the average bin distance to uniformity abdu and the continuous ranked probability skill score crpss were chosen as performance metrics to evaluate the robustness of the methodology these findings suggest that it is possible to improve hydrological short term forecast reliability through a multi model approach in an operational forecasting context keywords hydrological ensemble forecasting hydrological modelling data assimilation streamflow post processing multi model 1 introduction streamflow forecasts play a crucial role in the operational contexts of hydropower generation flood forecasting and water resource management for hydropower and water resource management the goal is to exploit the water resource as efficiently as possible for flood forecasting the objective is to protect and possibly evacuate affected zones as quickly and as safely as possible streamflow forecasts are available in the form of deterministic forecasts or ensemble streamflow forecasts better known as ensemble streamflow predictions esp a deterministic forecast provides a single estimation of incoming streamflow while an ensemble forecast provides a set of several equiprobable streamflow scenarios the term esp is used in this study in the context of numerical weather prediction ensemble nwpe forecasting and should not be confused with extended streamflow prediction performed using past climate observations although a deterministic streamflow forecast requires less computing time and typically has a higher resolution than an esp it can have the perverse effect of giving the impression of certainty by providing a single forecasted value krzysztofowicz 2001 this interpretation can be especially dangerous in an operational context resulting in an overestimation or worse an underestimation of reality on the other hand esp makes it possible to include part of the uncertainty associated with the overall hydrological forecasting processes to assist in rational decision making reducing economic risk krzysztofowicz 2001 for instance including well calibrated uncertainty allows for a better representation of extreme events which can result in decisions that ultimately lead to less economic loss thus esps are an important tool for water resource system managers the nwpe demargne et al 2014 and the hydrological model bennett et al 2014 are two of the different sources of uncertainty included in esps the latter has been found to be usually predominant in the context of short term forecasts bennett et al 2014 krzysztofowicz and maranzano 2004 however several studies arsenault et al 2016 boucher et al 2019 hemri et al 2013 have reported two recurring problems related to the use of esps the forecasts are generally biased and under dispersed when forecasts are biased and under dispersed the realization i e observations when working in hindcast is more likely to fall outside or near the extremities of the forecast envelope one of the elements that contributes to these scenarios is the predominant uncertainty associated with hydrological models hemri et al 2013 it may be due to the hydrological model structure the parameters used the initial states the system calibration and even the observed streamflow used during the model calibration ajami et al 2008 several data manipulation techniques are available to address these issues specifically first and foremost automatic data assimilation cloke and pappenberger 2009 cuo et al 2011 can be used to realign the hydrological model s initial states to reproduce the best estimate of the true observed streamflow this manipulation is typically done at the beginning of each hydrological forecast using in situ information i e streamflow and snow water equivalent measurements as well as observed meteorological and evapotranspiration data data assimilation of deterministic forecasts is often done manually but the process is laborious and unsuitable for esps seo et al 2014 studies have shown that automatic data assimilation methods such as the particle filters pf dechant and moradkhani 2011 and ensemble kalman filters enkf liu et al 2012 methods as well as the bayesian forecasting system bfs reggiani and weerts 2008 are able to improve the streamflow forecast distribution i e a forecast envelope that better encompasses reality performing bias correction i e pre processing on nwpes or post processing on esps is another way to improve the distribution and accuracy of esps since it allows producing forecasts that are statistically inseparable from past observations hopson et al 2019 nwpes pre processing reduces the bias in weather simulations by removing systematic errors georgakakos et al 2014 however in order to be usable in a hydrological modeling framework this pre processing must be carried out while maintaining consistency and correlation between the meteorological variables e g precipitation and temperature that will be fed to the hydrological model wetterhall and smith 2019 alternatively a simpler post processing of the esps can be used to correct the hydrological forecast distribution with the one obtained from the observed streamflow muhammad et al 2018 when only one technique is used some studies have shown that post processing is more efficient than pre processing arheimer et al 2011 wetterhall and smith 2019 several streamflow post processing methods have proven to be effective and are used in different studies such as those involving ensemble model output statistics emos hemri and klein 2017 quantile regression qr muthusamy et al 2016 and quantile mapping qm wood and schaake 2008 the variability of esps can also be improved by addressing the uncertainty of hydrological models which can be different from one model to another in order to exploit the strengths of several different hydrological models and compensate for certain weaknesses the multi hydrological model approach may represent a promising solution arsenault et al 2015 several algorithms are available to average multiple esps these include the maximum likelihood bayesian model averaging mlbma neuman 2003 and the ensemble model output statistics emos hemri 2019 esps from various hydrological models can also be combined to create a larger ensemble called the grand ensemble streamflow prediction gesp resulting in a better representation of uncertainty brochero et al 2011 velázquez et al 2011 the studies referenced above obtained promising results by showing that the overall reliability of the ensemble forecasts increased the main objective of this study is to develop a methodology that allows combining methods that have proven to be successful in the literature in a bid to correct the biases and the under dispersion issues in esp forecasts to this end esps from eight different hydrological models were combined by a multi model framework which was then evaluated on four hydrological period regimes over five catchments in canada the study area and methodology are presented in sect 2 and 3 respectively followed by the results in sect 4 and a discussion in sect 5 the conclusion and recommendations of this paper are presented in sect 6 2 study area the study area is comprised of five sub catchments of the 74 200 km2 lac saint jean catchment located in the province of quebec canada the climate of this region is characterized by hard winters with significant snow accumulation from november to april leading to a snowmelt driven hydrological regime with the freshet occurring during the spring several reservoir hydropower plants on the catchments are managed by the aluminum division of rio tinto which also operates the hydrometric stations used in this study the snowmelt dominated hydrological regime makes reservoir management more complicated by the fact that large volumes of water enter the reservoirs during the spring freshet forcing managers to estimate the optimal amount of water to be discharged depending on their forecasts arsenault et al 2013 short term forecasts are nonetheless necessary to estimate the spillway opening timing during the freshet as well as for the rest of the year this is because the reservoir head plays a major role in the hydropower generating station efficiency and the reservoir level must be kept as high as possible while preventing any spills or worse overtopping therefore the proposed methodology developed in this study could be used by managers to improve their decision making process through the use of a gesp on a forecast horizon typically spanning 1 10 days the lac saint jean catchment is divided into five sub catchments in the present study referred to as catchments hereafter in order to allow considering the position of the retaining structures at their outlet where mass balance computations were conducted to reconstruct observed streamflow from reservoir levels and flow drawdowns the five catchment sample also allows assessing the impact of the surface area on the techniques analyzed in this study table 1 presents the hydrological characteristics of each catchment while fig 1 gives their locations and ground elevations the statistics are also presented over four individual seasons corresponding to the seasonality of the streamflow on the study catchments december to march djfm winter low flows april and may am spring freshet june to august jja summer low flows and convective storms and september to november son fall synoptic storms 3 methodology this section details the different steps of the proposed methodology the source of meteorological and hydrometric data employed as well as the techniques used to perform calibration data assimilation hydrological modeling data post processing and multi model clustering are discussed finally several performance metrics are introduced to evaluate the performance of the methodology at each step 3 1 overview ensemble forecasting systems efss include all prediction systems that can be designed in different ways one of them the gesp is formed by feeding an nwpe into more than one hydrological model velázquez et al 2011 a gesp is also formed when two or more nwpes are fed into at least one hydrological model bourdin and stull 2013 however the methodology described in this paper is based on the former gesp type to integrate a gesp into the decision making process many steps must be performed to transform weather forecasts into representative streamflow forecasts fig 2 shows the proposed methodology used in this paper the steps are summarized next and are further described in the following sub sections first and foremost forecast data from an nwpe must be obtained in order to feed the hydrological models to generate the esps in this study a total of eight different hydrological models are calibrated using historical climate data data assimilation is then performed with these models using the enkf method to generate 25 perturbed initial states the nwpe in this study provides 50 members leading to the hydrological modeling of a 1250 member ensemble 50 nwpe members 25 enkf perturbed initial states for each day of forecast a post processing bias correction technique is then performed followed by a multi model technique to combine the resulting esps within a gesp to tackle hydrological period regime variability referred to as seasons hereafter the last steps are repeated to separate the forecasts into four distinct seasons in order to compare each step of the methodology to the same reference the 50 member nwpe used as input in the hydrological models before performing data assimilation post processing and the multi model gesp is considered as the open loop ol simulation and serves as a baseline for the analyses the hydrological prediction laboratory hoopla toolbox thiboult et al 2019 is a software application developed at the department of civil and water engineering of université laval quebec canada it was created to perform multiple integrated manipulations such as potential evapotranspiration pet and snow accounting routine sar computations and data assimilation and hydrological modeling on a large set of hydrological models in this study hoopla is used to perform the hydrological model calibration data assimilation and simulation steps as shown in fig 2 3 2 forecast data the nwpe forecasting data used in this study was extracted from the european centre for medium range weather forecasts ecmwf database for the five study catchments a total of 50 simulations also known as members were available at an 18 km resolution and covered the january 2015 to june 2019 time period the 50 member nwpe was generated for each day with a forecast lead time of 9 days this means that the january 1 2015 forecast provides information until january 9 2015 the precipitation and minimum and maximum temperature variables were extracted from the forecast at a 6 hour time step however considering that the hydrological models used in this study only perform at the daily time step the 6 hour time step was converted to a daily one by aggregating the precipitations and taking the maximum and minimum air temperature values over the period 3 3 hydrological model calibration the hoopla toolbox thiboult et al 2019 was used to perform the calibration and simulations using eight different hydrological conceptual lumped models table 2 lists all eight hydrological models along with details of their structure namely the number of parameters and conceptual reservoirs the pet was calculated with the oudin formula oudin et al 2005 and the cemaneige valéry et al 2014 sar computation having previously shown good performance over similar catchments in the same region poissant et al 2017 was selected for all hydrological models the shuffled complex evolution university of arizona sce ua duan et al 1992 optimization algorithm was chosen for the calibration as it had previously performed very highly with simple hydrological models similar to the ones used in this study arsenault et al 2014 the kling gupta efficiency kge gupta et al 2009 was selected as the performance metric for the calibration process and is defined following eq 1 1 kge 1 r 1 2 α 1 2 β 1 2 where r is the correlation coefficient α is a measure of variability and β is the bias between observed and simulated streamflows a kge score of 1 indicates a perfect fit between observations and simulations and a score greater than 0 41 means that the simulation is better than the average observed streamflow as shown by knoben et al 2019 the calibration of the eight hydrological models was performed over the 1953 2019 period using hydrometeorological observations provided by rio tinto for the five catchments since the observed streamflows were reconstituted by water mass balance some pre processing was required negative and zero streamflow rates were not considered in the calibration it should be noted that the forecast period 2015 2019 was included in the calibration following the recommendations of arsenault et al 2018 to obtain more robust parameters in all cases the 4 5 years of validation weigh very little over the entire period 1953 2019 tested but not shown and even if there was a significant increase in performance over the forecast period all subsequent tests would use the same model and would gain the same advantage leaving the conclusions unchanged 3 4 data assimilation data assimilation da aims mainly to modify the hydrological model initial states to better represent the prevailing hydrological conditions on the catchment allowing simulations to better approximate the true observed streamflow accounting for uncertainties and negating the effects of model drift seo et al 2014 in a streamflow forecasting context these optimal hydrological model initial states which provide the closest possible simulation of the true observed streamflow at the beginning of the forecast are used as starting model states in the present case the objective of da was to reduce the bias between each member of the eight esp forecasts and observations to this end the ensemble kalman filter enkf evensen 1994 was used as the da method and was implemented using the hoopla toolbox the enkf method and its interpretation are explained in detail in evensen 2003 but summarized as follows for each hydrological model all initial states that represent water storage e g subsurface routing and underground reservoirs snowpack etc were updated depending on the model s structure the rainfall and temperature uncertainty were introduced by sampling from a normal temperature and gamma precipitation distribution whose parameters are those that were modified during the implementation observation errors in streamflow rainfall and temperature were modelled using a gaussian noise approach one of the challenges of the enkf method is the need to quantify the uncertainty related to hydrometric and meteorological measurements considering that the study catchments observed streamflows are derived from mass balance estimations at the hydropower locations they are expected to be further affected by some level of bias as compared to real natural streamflow in addition to other sources of uncertainty such as precision errors in measurements even if evaluating the flow drawdowns from the hydropower locations or spillways and reservoir level fluctuations over longer times is still quite precise with respect to meteorological variables such as precipitation it is also difficult to obtain perfect representations over the catchment due to the spatial distribution of weather stations which inevitably leads to errors in real observations given the uncertainties in the reconstitution of inflows considered to be within 10 15 in this study and in meteorological measurements considered to be between 10 and 50 for precipitation 1 and 2 c for temperature in this study the enkf makes it possible to sample the uncertainty of these variables and to then create an optimal set of initial states closer to the true observed streamflow noh et al 2019 in many studies the enkf method has proven very effective in reducing the bias between simulations and observations bergeron et al 2016 jiménez et al 2019 maxwell et al 2018 abaza et al 2014 showed that using the enkf also increased the reliability of hydrological simulations for any period of the year except for the freshet season which was not assessed in their study moreover they found that while using an ensemble of 1000 members with the enkf algorithm provided optimal results a number between 20 and 50 members was sufficient when forecasts are post processed in this study an ensemble of 25 initial states derived from the enkf method combined with the 50 member nwpe allowed creating an ensemble of 1250 members for each forecast it should be noted that the results that will be presented in section 4 of the manuscript were obtained with a standard deviation equal to 15 30 and 2 c of the streamflow precipitation and temperature observations respectively 3 5 hydrological modeling hydrological modeling is performed using the eight hydrological models and their previously calibrated parameters the 25 daily initial states of each hydrological model obtained at the da stage are used to initialize the forecast the 50 nwpe forecast members are then provided to the hydrological models to obtain eight individual esps thus each esp containing 1250 members 25 initial states combined with the 50 nwpe members was simulated for each of the nine day forecast lead times during the january 2015 to june 2019 period these esps are then post processed and grouped into a gesp to complete the methodology 3 6 post processing while da allows reducing the error of the initial states residual biases and other sources of errors from the various processes are present in final streamflow forecasts performing some post processing to bias correct simulated streamflow is one of the preferred ways to improve the forecast reliability bias and accuracy wetterhall and smith 2019 a quantile mapping qm post processing was thus performed on streamflow forecasts distributions over the four individual seasons corresponding to the seasonality of the streamflow on the study catchments previously defined djfm am jja and son this post processing method corrects the streamflow percentiles of the simulated distributions with those of the observed distributions a unique set of 100 correction factors correcting each percentile of the forecasts distribution was established for each season as well as each forecast lead day 9 in total to ensure temporal independence as suggested by hamill 2001 a time delay between each forecast was kept the time delay was fixed at three days as suggested by pappenberger et al 2011 for instance starting on january 1st the next forecast release used would be january 4th discarding both days in between and so on hashino et al 2007 concluded that the qm method is simple efficient in reducing bias and more effective for low flows than other methods such as qr other studies muhammad et al 2018 wood and schaake 2008 demonstrated that the qm improves the reliability and the performance of esp forecasts in most cases when used for post processing streamflow simulations in order to perform bias correction on esps the qm method must be performed after the da is completed otherwise the qm method would attempt unsuccessfully to correct the spread of wider distributions obtained from the biased initial states of the hydrological models these inefficiently corrected esps would not be able to achieve the objectives of the proposed methodology for this reason the qm method is not independently compared to the da method to ensure the robustness of the bias correction a split sample validation using 80 of the data selected through a systematic sampling to calculate the correction coefficients to be applied to all the individual esp distributions of a given season was selected the remaining 20 of data of every fifth forecast was used to validate the robustness of the correction all post processed results shown hereafter pertain uniquely to the validation dataset 3 7 hydrological multi model approach a simple multi model approach was preferred in order to evaluate the compromise between simplicity and performance needed in an operational context the selected method consisted in grouping the eight esps together effectively generating a gesp to better sample the overall uncertainty thus the eight esps each containing 1250 members were combined into a single gesp containing 10 000 members without any distinction from the individual hydrological models 3 8 performance metrics different quality attributes can be evaluated based on different metrics and in turn be used to assess the quality of a forecast in this study three of these attributes are used and are defined as follows according to anctil and ramos 2019 accuracy average difference between individual forecasts and observations bias difference between average forecast and average observation reliability agreement of forecast with observation conditioned on the forecast issued cloke and pappenberger 2008 suggest using several performance metrics to ensure the reliability of forecasts obtained thus different performance metrics are used to compare the results of each additional step da qm post processing henceforth referred to simply as qm and gesp with those of the ol simulations to confirm their added value hereafter the term manipulation will be used to refer to the da qm and gesp steps it is important to note that the qm manipulation includes da and the gesp manipulation includes both da and qm anctil and ramos 2019 reviewed several verification metrics including the talagrand diagram the continuous ranked probability score crps and the continuous ranked probability skill score crpss talagrand diagrams are commonly used to illustrate the ensemble dispersion versus observed data in the context of hydrological forecasting fan et al 2014 olsson and lindström 2008 voisin et al 2011 although well suited to assess the reliability of esps zappa et al 2013 their visual aspect may be misinterpreted and it is preferable to combine them with a complementary statistical test for validation hamill 2001 the shape of the talagrand diagram is essential in order to assess the dispersion of an esp a shape diagram indicates that the esp is under dispersed and is not wide enough to include observations observations are then found at the extreme limits of the esp either in the first or last percentiles hence the shape inversely a shape diagram points to an esp that is over dispersed and therefore too wide a or shape indicates a positive or a negative systematic bias respectively these shapes which are completely outside the left or right side of the diagram are obtained when the esp does not represent the observations at all finally a flat diagram is the desired shape indicating a uniform distribution of observations in the esp and providing the right amount of variability without any biases the kolmogorov smirnov test k s test was chosen to reject or not the hypothesis of uniformity α 5 if the hypothesis of uniformity is not rejected it means that the esp forecast is likely to provide the right amount of variability represented by a flat talagrand diagram which allows a better evaluation of the overall uncertainty the average bin distance to uniformity abdu score was also added to quantitatively measure the deviation from uniformity previously used by arsenault et al 2016 on the lsj catchment and is defined following eq 2 2 abdu 1 n k 1 n s k m n where sk is the number of occurrences in bin k m is the number of y values and n is the number of histogram bins an abdu score is equal to zero when there is no deviation from uniformity the abdu is an empirical measurement to quantify the evaluation of the rank histogram and does not follow any particular distribution in this study this metric cannot compare seasons with each other since it is directly affected by the total number of values n forming the talagrand diagram and the lengths of the seasons used are not equal instead it will serve as a quantitative metric to compare the distribution between two ensembles and determine which is closer to uniformity over a given season finally the crps and crpss are calculated to evaluate the overall accuracy of the forecasts these two metrics are commonly used in hydrological forecasting muhammad et al 2018 pagano et al 2013 schaake et al 2007 the crps is defined following eq 3 3 c r p s k f k x f k o 2 d x where f k x is the predictive cumulative distribution function between a given esp forecast and the observed streamflow k x is the predicted variable and f k o is the corresponding observed cumulative distribution function anctil and ramos 2019 the crps score will not be analyzed directly and is only used to calculate the crpss score which allows a direct comparison of the ol simulation with other simulations obtained after da qm and gesp manipulations the crpss is defined following eq 4 4 crpss 1 crps b k crps ref k where crpsb is the score calculated from the modified forecast and crpsref is the score of the ol simulation the crpss was used in this framework to evaluate incremental gains in performance relative to previous steps rather than using the classical climatology esp this is done to contextualize the changes in performance at each step a crpss score greater than zero indicates an improvement in the forecast ensemble accuracy as compared to the ol ensemble the crpss values range varies from to 1 with 1 being the best possible score and a score below zero indicates a decrease in performance thus results under 1 will be ignored and simply considered as pointing to very poor performance similar to the post processing a time delay must be kept between the forecasts used to calculate these verification metrics to ensure their temporal independence hamill 2001 a three day delay was kept between each data point of the metrics as suggested by pappenberger et al 2011 4 results this section details the results of the different manipulations of the proposed methodology different topics are investigated such as the hydrological model calibrations the respective performances of the da and da followed by qm methods a comparison between esp and gesp performance the impacts of the catchments area the parameterization of the da and an evaluation of the short term forecast performance 4 1 calibration of the hydrological models the kge scores obtained following the calibration of the hydrological models on the five catchments are presented in table 3 the highest kge scores are obtained on the largest catchment lsj and the lowest kge scores by a relatively small margin are seen on the smallest catchments cs overall all the hydrological models evaluated show good skills over the study catchments however some models such as mohyse simhyd and topmodel exhibited poorer performances on smaller catchments cs and lm while other models such as gr4j and hbv performed very well on them when hydrological models are used on the larger catchments cd pd and lsj their kge scores are similar of the eight hydrological models tested the gr4j provided the best performance or was among the best in terms of kge scores after calibration for the five catchments for the sake of simplicity the results shown hereafter are focused on the gr4j hydrological model and the lsj catchment the conclusions obtained with gr4j and lsj are consistent with those obtained for the other hydrological models and catchments 4 2 impact of data assimilation and bias correction on individual esp performance the talagrand diagrams for the ol simulations fig 3 indicate that the observed streamflow is almost always outside of the forecast ensemble envelope for all four seasons djfm am jja and son while systematic biases are obtained for djfm negative jja and son positive am exhibits a shape pattern indicating under dispersion of the ensemble other studies boucher et al 2019 hemri et al 2013 arsenault et al 2016 have reported similar issues with the ol simulations with other hydrological models for different periods of the year these observations prove the relevance of using the da and post processing methods on streamflows fig 3 also indicates that performing da with the enkf algorithm provides additional variability to the ensemble for each season allowing the forecast to better encompass the observed streamflow and leading to a decrease in the abdu score finally when data assimilation enkf is combined with bias correction qm the additional variability obtained further increases the dispersion of the esps and reduces the abdu score over all seasons except for am the k s test rejected the hypothesis of uniformity α 0 05 for all ensembles except for the f h k and l ensembles in fig 3 4 3 comparison between individual esps and the gesp performances the objective of the multi model gesp manipulation was to add enough variability to the individual esps after da and qm by grouping them together into a gesp the same manipulations were performed with the other seven hydrological models as displayed in fig 4 the results of the gesp multi model set are also presented in fig 4 for ease of comparison even after performing da and qm all individual esps remain under dispersed for at least one or two seasons all esps created by the eight individual hydrological models in the am season corresponding to the spring freshet present shapes indicating under dispersion relative to streamflow observations fig 4 also shows that the k s test rejected the hypothesis of uniformity for the majority 14 16 of the ensembles during the djmf and am seasons but failed to reject the same hypothesis for more than half 11 16 of the ensembles during the other two seasons jja and son overall no single esp or hydrological model outperformed all other esps and their performance varied strongly from season to season as well as from catchment to catchment this also indicates that each esp is likely to contribute to additional variability to the forecast in a gesp allowing to better encompass variabilities in the observed streamflow this can best be observed in the last row of fig 4 which shows the results with the gesp while the abdu values from different single esps still outperform the gesp in some specific cases cequeau and ihacres for djfm hymod and topmodel for jja the gesp provided the lowest abdu values for the am and son seasons with the largest improvements seen over the am season furthermore the k s test failed to reject the hypothesis of uniformity over all seasons most notably over the am season for which the k s test rejected the hypothesis for every single esp it should be noted that very similar results were obtained over the other catchments the main difference is that the k s test rejected the hypothesis of uniformity for the gesp over two seasons over the cd catchment and one season over the cs catchment as shown in fig 5 however the gesp still outperforms almost all individual esps in terms of the abdu score furthermore the k s test failed to reject the hypothesis of uniformity over all seasons for the geps most notably over the am season for which the k s test rejected the hypothesis for every single esp however a visual inspection of the am season talagrand diagram suggests that the gesp has indeed improved but still remains under dispersed this is likely due to the fact that the k s test is not very powerful on its own but when combined with the talagrand diagram it still provides valuable information in terms of improvement when comparing the gesp to the individual esps 4 4 impact of catchment characteristics as discussed in the previous section when comparing individual esps with each other no single esp or hydrological model outperformed all other models however results suggest that this behavior is also dependent on the catchment surface area since the models that performed better than the others over a given season vary from catchment to catchment fig 5 presents the gesp forecast distribution for all five catchments in most cases a more uniform distribution of the forecast members shown with flatter talagrand diagrams indicates that the use of the gesp has brought the ensemble closer to uniformity compared to individual esps fig 4 for lsj catchment and online supplementary materials figs s1 s4 for the other four catchments indeed the k s test failed to reject the hypothesis of uniformity for all ensembles except for three of them j l and n it can be seen that these three cases occurred on two of the smallest catchments cd and cs suggesting that the catchment size could have an impact on potential forecast improvements furthermore some ensembles remain under dispersed e g g j n and r or even over dispersed e g q 4 5 impact of data assimilation parameterization different data assimilation parameters were tested to add different levels of uncertainty to the hydrological model calibration data i e observed precipitation temperature and streamflow the standard deviation of the uncertainty distribution for each observation was set between 10 and 50 of precipitation 1 and 2 c for temperature and 10 and 15 for streamflow fig 6 presents the impact of different da parameters on the gesp using talagrand diagrams the ol performances for the gesp using the q σ15 and p σ30 da parameters are shown in supplementary materials fig s9 to allow for a comparison with the results obtained for the different parameter sets the results indicate that changes in standard deviation of both streamflow and precipitation have only a marginal impact on ensemble dispersion and no clear pattern can be observed in terms of abdu score estimated temperature uncertainty ranged from 1 to 2 c and provided very marginal impact not shown 4 6 evaluation of the short term forecast performance in order to compare the added value of each methodological manipulation da post processing with qm and combination of esps with the gesp to the forecast accuracy their crpss value was computed against ol simulations furthermore the crpss values were also computed over the nine forecasting days for each manipulation to assess their skill in the short term these results are presented with fig 7 boxplots for the lsj catchment it can be seen that the median crpss value of each boxplot is above 0 for all cases indicating that the short term forecast accuracy is improved with each data manipulation performed as expected the forecast accuracy is gradually decreasing over time in most cases bias correction and the use of the gesp improve the crpss score as compared to using da only however combining all esps into a gesp does not always increase the accuracy of the forecast when compared with the gr4j bias corrected simulations 4 7 impact of the hydrological season by analyzing the different performance metrics after each manipulation da qm and gesp it is possible to confirm that the results depend on the forecast season fig 3 shows that the da reduces abdu scores over all seasons while the qm does not seem to perform as well in reducing the abdu score during the freshet season am when the hydrological ensembles are grouped in a gesp figs 4 and 5 the distribution of this larger ensemble is similarly improved during the djfm jja and son seasons the distribution of gesp ensembles during the am season still shows under dispersion over most of the catchments 3 5 the crpss score results fig 7 also allow to observe the impact of the different hydrological seasons while the three methods used da qm gesp lead to a significant improvement of the crpss during the djfm season they seem to have a lesser impact on the results of the am season on the lm and cs catchments e g figs s5 and s7 for the cs catchment with the gr4j and ihacres models respectively crpss scores even drop below 0 on the last forecast day and are close to 0 by the fifth day this indicates that the proposed methodology is unable to improve ensemble accuracy over the two smallest catchments during the am season beyond a few days despite these difficulties during the am season in the lm and cs catchments the methodology effectively corrects for bias in the majority of forecasts fig 8 shows an example of a 9 day hydrological forecast to better visualize the performance of the methodology over the lsj catchment during the am season for the other two seasons jja and son the crpss scores are improved to a lesser extent than those of the djfm season but still remain above 0 for all nine forecasted days indicating an improvement in the accuracy over the ol simulation 5 discussion this section assesses the performance of different manipulations performed on esp forecasts in order to meet the main objective of this study which was to develop a methodology to correct the problems of bias and under dispersion in forecast ensembles the effectiveness of each streamflow manipulation method da qm and gesp is discussed first followed by a discussion of the impact of the hydrological season the performance of the overall methodology and their limitations 5 1 performance of data assimilation using the enkf the use of enkf at the data assimilation stage is intended to reduce the bias between the members of the esp forecasts and the observations this is achieved by sampling the uncertainties in hydrometeorological i e streamflow precipitation and temperature measurements to correct the hydrological models initial states as shown in fig 3 the enkf method is able to reduce the abdu scores between esps and observations for all seasons over the lsj catchment overall there is an improvement in the spread of the esps as exhibited in the talagrand diagrams for all seasons while these improvements were significant for both the am and son seasons resulting in a failure to reject the hypothesis of uniformity based on the k s test the under dispersion displayed as a shape in the talagrand diagram remains problematic in the case of the other seasons djfm and jja fig 3 suggests that da has been unable to correct the systematic biases both positive and negative in the esp forecasts this could be due to the fact that the method is effective in reducing errors in the initial conditions that improve simulated streamflow but does not allow full consideration of the uncertainty of the observations and may compromise the reliability of the predictions by adding random uncertainty as maxwell et al 2018 had warned there is also no guarantee that the post assimilation initial states would generate a streamflow that is more dispersed it can be seen in fig 6 that there is no optimal value in the hydrometeorological estimation provided to the enkf method and that this estimate is strongly dependent on the season and the catchment analyzed not shown thiboult and anctil 2015 also observed that both the catchment and the hydrological model had an impact of the enkf performance however what is most notable in the results in fig 6 is that no matter the value used as an estimate of the uncertainty in the hydrometeorological measurements data assimilation always improves the forecast performance when compared to the ol simulation these findings are also supported by abaza et al 2014 who used an ensemble of 1000 members different initial states using the enkf method over a forecast period of 10 days as shown in fig 7 the gradual decrease in the forecast performance as the lead time increases with a gradual decrease in the crpss median value indicates that the da tends to be more efficient in the shorter term up to 2 3 days bergeron et al 2016 obtained similar conclusions where data assimilation of streamflow data using enkf was notably more efficient over only a few days of hydrological forecasts however the crpss median value remained above 0 for the nine forecast days indicating an improvement brought about by data assimilation over the baseline ol simulations it is worth mentioning that there is a paradox in the data assimilation process in applying uncertainty to observed streamflow data and considering the very same observations as perfect when computing the performance metrics such as the crpss while this remains outside the scope of this paper different approaches to verify ensemble forecasts against non perfect observations have been suggested by some authors e g pappenberger et al 2009 santos and ghelli 2012 ferro 2017 5 2 post processing performance with qm bias correction fig 3 shows that for the lsj catchment and the gr4j hydrological model the post processing of esp forecasts using the qm method allows solving some of the under dispersion over all seasons with the exception of the freshet season am this is also supported by a decrease in the abdu score and a failure to reject the hypothesis of uniformity with the k s test for both the jja and son seasons as noted by li et al 2017 the decrease in performance obtained during the freshet versus the da can be explained by the fact that the correction does not preserve the temporal connection in the snowmelt process overall the results shown in fig 4 for all eight individual esps indicate that the qm post processing is not able to correct the under dispersion problem fig 7 shows the boxplots of the daily crpss obtained by the forecasts over the lsj catchment simulated by the gr4j model over a nine day lead time the median crpss of the boxplots computed from the post processed qm forecasts are always above zero showing better performance than for the ol simulations and are almost always higher than the median values obtained for the da similar results were obtained for the other hydrological models and catchments e g the ihacres model figs s6 and s8 on the lsj and lm catchments respectively with the exception of the smaller cs catchment for which the median crpss values for da are often higher than those for qm depending on the season e g figs s5 and s7 with the gr4j and ihacres models respectively this suggests that for most cases the post processing of esps further improves the forecast accuracy versus both the ol and da ensembles overall the results show that post processing using the qm bias correction technique allows reducing the biases in the esps in most cases but shows little skill when it comes to improving the under dispersion problem this finding is also supported by hashino et al 2007 who showed that qm was effective in reducing the biases of monthly streamflows while the present study investigated daily streamflows the relatively short temporal period considered in this study i e 4 5 years some sort of overfitting may sound like a potential issue it should be reminded that the goal of this study was to demonstrate that the combination of multiple esps can significantly improve the under dispersed and biased forecasts even if data assimilation and post processing have been conducted previously in the eventuality that the bias corrected forecast is overfitted and that the validation correction is better than it should be this is only strengthening the conclusions of this study indeed as demonstrated previously such post processing remains insufficient to properly correct the forecast and significant improvement is still obtained from the combination of multiple post processed esps into a gesp 5 3 multi model performance analysis the final methodological manipulation brought together the different esp forecasts of the eight hydrological models into a single gesp the goal here was to aggregate the strengths and weaknesses from each individual hydrological model and to then obtain a larger ensemble that best encompasses the overall uncertainty it can be seen that this additional manipulation is indeed capable of reducing the abdu score as well as the under dispersion problem shown with shaped talagrand diagrams for all seasons as compared to each individual esp fig 4 by combining the strengths and the weaknesses of the different esps the gesp significantly improved the forecast distribution and failed to reject the hypothesis of uniformity for all seasons the largest improvement was seen over the am season in which all individual esps were strongly under dispersed fig 4 these results were found to be consistent from one catchment to the next as shown in fig 5 when comparing the crpss obtained from the gesp to the esps fig 7 gr4j hydrological model over the lsj catchment results indicate that the forecast accuracy of gesp is strongly improved when compared to the ol simulation but does not improve beyond what is achieved with the qm post processing this was fairly consistent over the nine day forecast lead time while the gesp is not able to outperform the qm in this case analyses of the other seven individual hydrological models e g figs s6 s8 for the ihacres model indicate that the gesp forecast accuracy is usually greater than or equal to the one from the post processing furthermore on the last day of the forecast the median crpss of the gesp is almost always greater than or equal to the ones from individual esps after da and qm overall these results indicate that there is an advantage in grouping together esps from different hydrological models into a gesp especially as the lead time increases these findings are supported by velázquez et al 2011 who conducted a similar analysis using 16 hydrological models their study unsurprisingly found that the accuracy of gesp forecasts decreases as the lead time increases as also shown in fig 7 however it should be noted that the methodology in velázquez et al 2011 was much simpler as it did not include any post processing and the data assimilation technique used only consisted of an average streamflow error correction which is known to potentially lead to less accurate medium to long term forecasts mai et al 2020 ercolani and castelli 2017 the present study was carried out by grouping together the forecast ensembles of eight hydrological models but the results obtained could be altered by using a larger or smaller number of models the dispersion level should further improve if the number of hydrological models used is increased however there would probably be diminishing returns at the cost of increased computing expenses velázquez et al 2011 obtained promising improvements using 16 hydrological models in their gesp similarly using fewer than eight models would likely still provide significant improvements as compared to individual esps however there is probably no optimal number of hydrological models that can be used since results have been shown to vary from catchment to catchment and from season to season however considering that all eight hydrological models used in this study have shown relatively good and similar levels of performance in validation see table 3 it remains unclear if including a poorly performing hydrological model in the gesp would be useful or not there is also an obvious drawback from using additional hydrological models in an operational context which is the additional burden in terms of calibration documentation training and maintenance 5 4 impact of the hydrological season on the forecast looking at the results in fig 7 it can be seen that there is little to no drop in accuracy for the djfm over the nine forecasted days this is likely due to the winter hydrological regime of the djfm season which is characterized by low flows and almost no liquid precipitation which makes it easy to estimate short term flow for the other seasons the accuracy of the ensembles drops progressively as the lead time increases in contrast to the djfm season the hydrological regime of the other seasons can vary greatly and involves more variable processes e g snowmelt rainfall runoff etc that are harder to forecast which could in turn explain the progressive decrease in ensemble accuracy over the 9 forecast days this finding is supported by the larger inter quartile range of the boxplots for the am jja and son versus the djfm season it can be observed that the variability following qm and gesp manipulations is larger than that from da mainly during the am season the snowmelt process which is highly active during the am season is mostly affected by the temperature for which forecasts are less variable than for precipitations the relative ease of forecasting temperature versus precipitation could explain the smaller inter quartile range in the da boxplots as compared to the summer seasons seen in fig 7 as mentioned previously the median crpss scores reach below 0 after the sixth day of forecasting during the am season e g cs and lm catchments with gr4j model and gesp fig s5 for the cs catchment this suggests that the different manipulations face difficulties correcting the variable streamflow of the snowmelt season these difficulties are also supported by the talagrand diagrams figs 3 5 for the am season which rarely exhibits a uniform distribution even after all the manipulations have been performed 5 5 overall methodology performance analysis as previously demonstrated the use of enkf as a data assimilation method combined with the post processing of data with the qm significantly reduced deviations from uniformity reduction of the abdu score and more likely to fail to reject the hypothesis of uniformity with the k s test and the bias in esps resulting in an increase in the crpss when compared to the ol simulation the grouping together of the individual hydrological model esps into a gesp allowed reducing the under dispersion problem leading to the best overall results these findings were observed over all catchments and for all hydrological seasons analyzed in addition while the talagrand diagrams showed systematically biased esp forecasts in the ol simulation the complete methodology resulted in distributions closer to uniformity however the shape could not be prevented in all cases and notably so during the spring freshet over the months of april and may the different surface areas of the five catchments do not seem to have significant impacts on the distribution of the gesp forecasts however the smallest catchment which is 1297 km2 is arguably still quite large and catchments smaller than 500 km2 for example could see different conclusions 5 6 limitations some limitations to this study must be mentioned and are listed hereafter number and length of nwpes in this project a total of four and a half years of the ecmwf nwpe were available which was considered sufficient to meet the study objectives ideally the nwpe used to feed the hydrological models should be extended over a period of several years to allow a better assessment of the robustness of the proposed methodology however it was not possible to extend beyond four and a half years due to major updates in the forecast model that would have led to vastly different statistics furthermore more than one nwpe could be used to test whether the results are consistent with other models individually or combined into a multi nwpe multi hydrological model gesp forecast lead time a lead time of nine days was used for all forecasts in this study this means that the findings are limited to this lead time and different conclusions could be obtained for forecasts beyond nine days it should be noted that this choice corresponds to the forecast lead time needed in the operational context number of hydrological models it is important to note that some of the methodological choices made in this study could have more or fewer impacts in other similar studies one such choice is the use of eight lumped hydrological models it is possible that using more or fewer models could improve or reduce the overall performance depending on the characteristics of each model indeed if all models are very similar and do not provide an adequate sampling of the hydrological models structural uncertainty then it is quite likely that there would not be any significant gain in using multi model forecasts however using fewer models that explore a larger part of the model structural uncertainty could provide the necessary flexibility for the multi model implementation to perform better moreover using semi distributed or distributed hydrological models could provide additional information not available within lumped models number of catchments only five catchments were analyzed in the study moreover these large catchments from 1297 km2 to 46 747 km2 are clustered in the same region in quebec canada evaluating the methodology on smaller catchments less than say 500 km2 and on catchments located in other climatic regions could bring different conclusions different ensemble sizes comparing individual esps to the gesp in this study inevitably led to different ensemble sizes 1250 members for each esp and 10 000 for the gesp while performance metrics like the talagrand diagram are not sensitive to ensemble size at these scales a metric like the crpss can lead to biased results if not corrected as suggested by ferro et al 2008 unbiased crpss can be obtained through a simple correction based on the ensemble sizes in the case of this study the ensemble sizes used have no significant impact on the results obtained limited resources completion of all the steps in the proposed methodology could be a limitation for some users with limited resources in this study we have implemented the main forecasting steps i e data assimilation ensemble hydrological forecasting post processing and multi model combination however some of these steps can be considered more critical than others namely the data assimilation which cannot be skipped as that would lead to very different initial states for the various models over time also the gesp step seemed to provide more benefits than the hydrological post processing of the ensemble as for the use of ensemble forecasts rather than deterministic ones this aspect was not evaluated here and thus we prefer not to comment on its importance however the literature on this subject seems clear that using ensemble forecasts provides a significant benefit for forecasting reliability 6 conclusion and recommendations this study presented a new methodology aimed at addressing the problems of bias and under dispersion of ensemble forecasts esp through the use of a multi model approach to combine individual hydrological model esps into a gesp to assess the performance and robustness of the proposed methodology it was compared with each preceding manipulation against an ol simulation baseline in order the three main manipulations that were evaluated are data assimilation da using the ensemble kalman filter enkf method post processing using quantile mapping qm and lastly an aggregation of eight individual hydrological model esps into a gesp the comparison was performed using several graphs and performance criteria typically used to evaluate forecasts namely the talagrand diagram the abdu score the k s test and the crpss the da with the enkf initially improved the individual esp dispersion abdu score and accuracy crpss value as compared to the ol ensemble but was still mostly under dispersed or systematically biased the qm did solve the systematic bias issue but further reduced the abdu scores and increased the crpss value over most individual esps despite the improvements brought about by the da and the qm most of the esps remained under dispersed over all catchments and most notably during the freshet season am using a multi model clustering of individual esp forecasts into gesp forecasts was found to be effective in further reducing ensemble bias and under dispersion when compared to the results of the majority of individual esps that underwent da and qm some individual hydrological models performed better on a specific catchment and hydrological season but overall the gesp forecasts had lower abdu scores higher crpss values and failed to reject the hypothesis of uniformity using the k s test more often than the individual esps the gesp was also found to perform similarly to or better than the best individual esp for any of the catchments or seasons tested the results obtained in this study support the proposed methodology in reducing bias and ensemble under dispersion the methods used are simple and could easily be integrated in an operational context the use of gesp forecasts can represent a powerful tool to add the variability to the ensembles needed to reach uniformity while remaining as accurate as or better than the best individual esp it should be noted that in all cases using any or a combination of da post processing and multi model approaches will significantly improve forecasts by reducing bias and correcting typical ensemble under dispersion however it is important to remember that different data processing methods can add uncertainty to esp forecasts which can vary from season to season and from catchment to catchment and ultimately may be misinterpreted in a forecasting context future research could attempt to test different uncertainty estimations for driving the da process depending on the seasons or try to introduce a probabilistic multi model method with density forecasting to the proposed methodology a modification to the methodology by applying post processing to the gesp after the grouping of esps into gesp rather than on each individual esp could also be an interesting simplification to analyze in a future research credit authorship contribution statement patrice dion conceptualization methodology software validation writing original draft visualization jean luc martel validation writing review editing supervision richard arsenault conceptualization methodology resources supervision funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this work was supported by the natural sciences and engineering research council of canada grant number crdpj 522126 17 the authors would like to thank rio tinto for providing hydrometeorological and hydrological data of their catchments we are also grateful to the european centre for medium range weather forecasts ecmwf for providing access to the nwep forecast data from their computing and archiving facilities finally we would like to acknowledge the anonymous reviewers whose insightful comments and suggestions helped improve the paper and shape it into its current form appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2021 126537 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
4387,we present a semi bayesian hierarchical modeling framework for conducting space time frequency analysis of precipitation extremes over a large domain in this framework the data layer the precipitation extreme i e seasonal maximum precipitation at each station in each year is modeled using a generalized extreme value gev distribution with temporally varying parameters which are decomposed as linear functions of covariates the coefficients of the covariates are estimated via maximum likelihood ml in the process layer the estimated ml coefficients of each of the covariates across the stations are spatially modeled with a gaussian multivariate process which enables capturing the spatial structure and correlation between the spatial model parameters suitable priors are used for the spatial model hyperparameters to complete the bayesian formulation since the bayesian formulation is only at the second level our model is semi bayesian and thus the posteriors are conditional posterior distributions with the conditional posterior distribution of spatial fields of the gev parameters for each time conditional posterior distribution of the nonstationary space time return levels of the precipitation extremes are obtained we demonstrate this framework by application to summer precipitation extreme at 73 stations covering a large domain of southwest us consisting of arizona new mexico colorado and utah the results from fitting and cross validation indicate that our model captures the historical variability at the stations very well conditional posterior distributions of return levels are simulated on a grid over the domain which will be of immense utility in management of natural resources and infrastructure keywords spatial extremes semi bayesian hierarchical modeling nonstationary model of extremes southwest us summer precipitation extremes 1 introduction extreme precipitation leads to extreme flow i e flood events leading to loss of lives and severe damage to infrastructure thus it is crucial for the engineering design of infrastructure such as flood protection dams and management of water supply and flood control to understand and model the variability of extreme precipitation in both space and time a common practice is to perform frequency analysis on block i e seasonal or annual precipitation extreme using statistical distributions a single set of distribution parameters are estimated assuming stationarity in that the precipitation variability in the future will be similar to that of the past jakob 2013 the fitted distributions are used to estimate occurrence probabilities i e return period of rare events of desired magnitudes and return levels of desired risks all useful in infrastructure design coles 2001 although for modeling extreme precipitation some studies have used log normal and gumbel distributions hershfield 1961 wilks 1993 the generalized extreme value gev distribution which is theoretically more appropriate is widely used e g dupuis and field 1998 gellens 2002 wilks 1993 due to its ability to capture a wide range of tail behaviors and also it is consistent with extreme value theory evt coles 2001 there are two main problems related to this single site stationary frequency analysis approach the stationarity assumption may not be valid since diverse modeling and empirical studies have shown that the frequency and intensity of extreme climatic events are increasing and will continue to do in the foreseeable future due to climate variability and change barnett et al 2006 frich et al 2002 ipcc 2007 milly et al 2008 schmidli and frei 2005 and the need for estimating extreme precipitation at several locations where data is not available for designing of infrastructure or hazard mitigation these motivate the need for modeling approaches that capture the variability of extremes in space and time temporal variability of extremes is modeled by varying the parameters of the statistical distribution as a function of covariates by a generalized linear modeling mccullagh and nelder 1989 approach an early approach for modeling the temporal variability of parameters of gev as functions of time was proposed in katz et al 2002 this led to plethora of studies that applied this approach at individual sites with time varying covariates besides time trend to modeling the temporal nonstationarity of precipitation extremes around the world as mentioned linear time trend to model the time varying gev parameters is the simplest nonstationary model fowler et al 2010 van haren et al 2013 katz et al 2002 other time varying covariates have been used to model precipitation extremes in asia agilan and umamahesh 2017 gao et al 2016 north america el adlouni et al 2007 um et al 2017 europe vasiliades et al 2015 australia agilan and umamahesh 2016 and elsewhere extensions of this in a bayesian approach have been developed cannon 2010 cheng and aghakouchak 2014 ouarda and el adlouni 2011 which captures the uncertainties in the parameters and consequently in the return levels robustly via their posterior distributions however most of these studies are single site analyses or assume spatial independence thus cannot provide estimates at any arbitrary ungauged location to address this studies have extend extreme value analysis and other methods to model inter site dependency these include regional frequency analysis such as the index flood method wazneh et al 2013 max stable processes coles 1993 coles and tawn 1996 davison et al 2012 stephenson et al 2016 spatial modeling of marginal gev parameters by univariate spatial gaussian processes dyrrdal et al 2015 yan and moradkhani 2015 yan and moradkhani 2016 reza najafi and moradkhani 2013 capturing the spatial dependency by both gaussian copulas and spatial modeling of marginal gev parameters and quantifying uncertainties of variables by hierarchical bayesian processes of the latent parameters bracken et al 2016 renard 2011 despite these advances limited studies have offered models for spatial and temporal nonstationarity of climate extremes especially precipitation extremes hanel et al 2009 modeled the nonstationarity in extreme precipitation over the rhine basin using a spatial extreme value model based on the index flow method that divided the domain into homogeneous regions where the gev coefficients are assumed to be constant lima et al 2016 used a hierarchical bayesian gev model for flood quantile estimates in which spatial dependency is captured by scaling the gev parameters independently according to their drainage area i e independent normal prior distributions are considered for the gev parameters other authors have used the same approach to model extreme precipitation apputhurai and stephenson 2013 steinschneider and lall 2015 ahn et al 2017 introduced a hierarchical bayesian model for regionalized seasonal forecasts where the spatial dependency is captured by modeling the probability distribution parameters with a multivariate gaussian field bracken et al 2018 and sun et al 2014 implemented a multivariate nonstationary bayesian hierarchical model for hydrologic frequency analysis in which the dependence between variables was captured by a gaussian elliptical copula in the data layer while these are very good approaches some general issues remain such as limited ability to capture spatial dependencies over the entire domain if gev parameters are kept constant over homogeneous regions estimation issues with copulas as the domain size increases inability to capture relationships between the parameters as each parameter is modeled separately in space these work well for smaller spatial domains or fewer variables but become computationally intensive and have convergence issues as the domain increases to name a few our research in this paper is motivated by the need to address these issues and have the ability to obtain estimates of return levels and their uncertainties at ungauged locations to this end we propose a semi bayesian hierarchical framework to model multi site spatio temporal variability of precipitation extremes we demonstrate this framework by its application to extreme summer precipitation at 73 stations from the southwest us arizona new mexico colorado and utah the paper is organized as follows in section 2 the framework in general is described the application set up for the southwest us extreme precipitation is then described followed by the specific form of the model structure and fitting method in section 3 the results are described in section 4 and section 5 presents a sumamry and discussion of the results 2 proposed framework the proposed spatial temporal multivariate semi bayesian hierarchical framework is comprised of three components the model structure the estimation strategy and estimation of nonstationary return levels 2 1 general model structure in general we wish to conduct a nonstationary frequency analysis of extreme precipitation at m locations over k years and then use a spatial model that allows us to estimate return levels and their uncertainty over a grid or at stations with missing data in this context it is assumed that extreme precipitation series at each station follows a gev distribution coles 2001 katz 2013 the spatial dependence is captured through a spatial multivariate gaussian process on the gev parameters the first layer of the hierarchical model structure also known as the data layer corresponds to the gev distribution assumed at each location s i and time point t which is 1 y s i t gev μ s i t σ s i t ξ s i t i 1 m where μ is the location parameter σ 0 is the scale parameter and ξ is the shape parameter under the nonstationary assumption distribution parameters can vary in space and time thus the three gev parameters could be modeled as functions of time dependent large scale climate variables and regional mean covariates 2 μ s i t α μ 0 s i j 1 n α μ j s i z j t i 1 m 3 log σ s i t α σ 0 s i j 1 n α σ j s i z j t i 1 m 4 ξ s i t α ξ 0 s i j 1 n α ξ j s i z j t i 1 m where α μ α σ and α ξ are the regression coefficients and z j t is covariate j at the time t log σ is modeled to ensure positive scale parameters the regression coefficients are estimated using maximum likelihood ml approach katz et al 2002 specific choices for covariates in our data analysis will be discussed in section 3 2 while in many studies ξ is modeled as a single value per study area or per region within the study area apputhurai and stephenson 2013 atyeo and walshaw 2012 cooley et al 2007 renard 2011 others consider that this parameter varies spatially along with the other gev parameters but considering a specific range of variation for it bracken et al 2016 cooley and sain 2010 here because we are interested in capturing the correlation between gev parameters no a priori restriction on its domain is imposed the bayesian formulation starts in the process layer which is the second layer of the hierarchy assumes a multivariate spatial gaussian process for the gev regression coefficients obtained via ml as mentioned above compared to a univariate spatial gaussian process e g yan and moradkhani 2015 sun et al 2014 this process can account for cross correlation in the regression coefficients the covariates selected for modeling the gev parameters in the first level exhibit spatial correlation thus the gev regression coefficients are likely to be correlated therefore the multivariate spatial gaussian process formulation is appropriate and general regardless of the strength of the spatial correlation thus the gev regression coefficients at the location s i are modeled as 5 α s i β t x s i w s i s i where α s i α μ s i α σ s i α ξ s i is a vector of 3 n 1 1 gev regression coefficients at the location s i β β μ β σ β ξ is a matrix of 4 3 n 1 spatial regression coefficients which are constant in space and time x s i is a 4 1 vector of regressors with the elements corresponding to the unity coordinates and elevation at the location s i and w s i and s i are vectors of 3 n 1 1 spatial and uncorrelated residuals at location s i respectively we assume the parameters can be defined through a latent multivariate process comprised of two components a spatial term w that follows a mean 0 stationary anisotropic gaussian process specification with a covariance function c and independent white noise process considering m locations we have that spatial and uncorrelated residuals are 6 w w s 1 w s 2 w s m t 7 s 1 s 2 s m t the spatial residuals vector w follows a mvn 0 σ s where σ s is the mp mp covariance matrix and p 3 n 1 the covariance matrix is defined as 8 σ s c 11 c 1 p c p 1 c pp where c kl is a m m cross covariance matrix when k l it corresponds to a covariance matrix we consider an exponential covariance function with parameters δ kl 2 the partial sill or marginal variance ϕ kl the spatial decay parameter the parametric form of the covariance and cross covariance functions is 9 c kl s i s j δ kl 2 exp ϕ kl s i s j this specification is a particular type of multivariate matérn gneiting et al 2010 there are some restrictions on parameters that result in a valid i e nonnegative definite covariance matrix see gneiting et al 2010 or apanasovich et al 2012 for details for the uncorrelated residuals we have mvn 0 σ ns where σ ns is mp mp diagonal covariance matrix 10 σ ns τ 1 2 i 0 0 0 τ 2 2 i 0 0 0 τ p 2 i where τ k 2 is the nugget effect related to the kth gev regression coefficient and i is a m m identity matrix a conceptual sketch of the spatial temporal multivariate semi bayesian hierarchical framework is shown in fig 1 which shows the data layer maximum likelihood estimation of the gev regression coefficients and the process layer multivariate spatial gaussian process for the gev regression coefficients obtained in the data layer 2 2 estimation strategy first gev regression coefficients of the data layer are estimated from eqs 1 4 using maximum likelihood then the conditional posterior distribution of the spatial regression coefficients β and residuals parameters δ 2 ϕ τ 2 given maximum likelihood estimates mles of the gev regression coefficients α which are assumed as the true values of the gev regression coefficients and spatial regressors x are obtained using the multivariate bayesian model by bayes rule the posterior distribution is 11 p β w δ 2 ϕ τ 2 α x p α β w δ 2 ϕ τ 2 x p β w δ 2 ϕ τ 2 x p α β w τ 2 x p w δ 2 ϕ p τ 2 p β p α β w τ 2 x p w δ 2 ϕ p δ 2 p ϕ p τ 2 p β here term p w δ 2 ϕ f mvn w 0 σ s f mvn w 0 σ s represents the probability density of a multivariate normal distribution with mean 0 and covariance σ s see eq 8 p β f mvn β μ β σ β μ β and σ β are the spatial regression coefficient estimates and their covariance matrix obtained from a linear model fitting eq 5 using maximum likelihood p δ 2 p ϕ and p τ 2 are the priors of the other parameters which based on finley et al 2015 are assumed to be independent and follow the following distributions 12 δ 2 invwishart ν s ϕ unif l l u l τ 2 invgamma κ γ where ν and s are the degrees of freedom and scale matrix of the inverse wishart distribution l l and u l are the lower and upper limits vectors of the uniform distribution κ and γ are the shape and scale hyper parameters vectors of the inverse gamma distribution the term p α β w τ 2 x is the likelihood of mles of the gev regression coefficients α conditional on the dependence of the uncorrelated residuals the regression coefficients β β μ β σ β ξ and spatial residuals the likelihood of α is defined as a multivariate normal 13 p α β w τ 2 x f mvn α x t β w σ ns where x is a known m p matrix of spatial regressors 2 3 nonstationary return levels according to read and vogel 2015 it is important to be clear when discussing nonstationary return levels and return periods since there are several definitions cheng et al 2014 salas and obeysekera 2014 katz 2013 for a stationary gev distribution the return level t is defined as the p 1 1 t th quantile 14 q p μ σ ξ log p ξ 1 here we use the definition for nonstationary return levels provided by cheng et al 2014 which states that in a nonstationary setting when the gev parameters may be time varying the return level can be computed at each year which is known as the effective return level 15 q p t μ t σ t ξ t log p ξ t 1 3 application the southwest us region comprising of the four states arizona new mexico colorado and utah is the hottest and driest region of the united states most of the precipitation arrives during the winter season but the summer precipitation makes a significant contribution to the reliability of water resources and the health of ecology however summer precipitation and its extremes over this region exhibit a high degree of spatial and temporal variability sheppard et al 2002 we demonstrate the utility of our proposed framework presented in the previous section by its application to summer precipitation extremes at 73 stations from this region 3 1 precipitation data daily summer june through september precipitation data were obtained from the global historical climatology network ghcn menne et al 2012 we selected stations with a full record of data for the period 1964 to 2018 or those with no more than 10 of data missing or no more than three years of missing data in a row this resulted in 73 stations for which climatology of the extreme seasonal precipitation is shown in fig 2 along with an elevation grid summer season 3 day maximum precipitation was computed for each year at each station for a station with missing year values these values were substituted with the median value of the station 3 2 covariates some studies higgins et al 1999 mamalakis et al 2018 mccabe et al 2004 have shown that there is a weak statistical relationship between southwest us summer precipitation and large scale climate indices capturing drivers in tropical pacific el nino southern oscillation enso northern pacific pacific decadal oscillation pdo and atlantic atlantic multidecadal oscillation amo since our objective is to demonstrate our framework we rely on these prior researches and considered these large scale climate indices as potential covariates albeit with a somewhat weaker association for the nonstationary gev distribution in the framework however users can develop tailored covariates for their specific data to enhance model performance for modeling the temporal nonstationarity of the gev parameters see eqs 2 4 first we considered summer season average enso and pdo indices and the standardized spatial average of summer seasonal precipitation sasp over the entire region as potential covariates we obtained values of the multivariate enso index mei wolter and timlin 1993 wolter and timlin 1998 wolter and timlin 2011 from http www esrl noaa gov psd enso mei the pdo values zhang et al 1997 were obtained from http research jisao washington edu pdo the average summer season precipitation sasp was computed from the ghcn menne et al 2012 we assess the strength of the relationship between the covariates and the summer precipitation extreme by computing the spearman s rank correlations shown in fig 3 it can be seen that sasp exhibits significant correlation with summer precipitation extreme across at almost all the locations over the domain however enso and pdo indices present a weaker correlation with precipitation extremes and significant at only few locations previous studies mentioned earlier in this section investigated relationship between these indices and seasonal total precipitation in this region and found them to stronger but from our analysis the indices ride a weaker signature on the precipitation extremes we selected the best nonstationary gev model using total akaike information criteria aic akaike 1974 and total bayesian information criterion bic schwarz 1978 in this the nonstationary model is fitted to the precipitation extreme at each location and the aic and bic values of all the individual location models are added to obtain the total aic and bic values these are computed for a suite of candidate models with various combinations of the covariates and the model with the minimum total aic or bic is selected for modeling the gev regression coefficients spatially we included covariates of latitude longitude and elevation covariates were obtained at station locations and a 0 5 degree grid throughout the study area we obtained the elevation data from the nasa land data assimilation systems nldas xia et al 2012 https ldas gsfc nasa gov nldas elevation 3 3 model structure for the southwest us for the structure of the model for the southwest us we incorporated the above covariates for spatial and temporal modeling we model the location and scale parameters of the gev at each location nonstationary shape parameters are generally more variable leading to convergence issues in ml estimation thus most studies in literature generally keep this stationary following this the shape parameter was keep stationary at each location based on both the total aic and bic values shown in table 1 the best model selected uses only sasp as covariate to model the location and scale parameters the next best model though includes enso the priors on the spatial regression coefficients and residuals parameters used are 16 β mvn μ β σ β δ 2 invwishart ν s ϕ unif l l u l τ 2 invgamma κ γ where β s i β μ β σ β ξ μ β and σ β are the spatial regression coefficient estimates and their covariance matrix obtained from a linear model fitting eq 5 on the maximum likelihood estimates of α for each gev regression coefficient separately based on the recommendations from banerjee et al 2004 and cooley et al 2007 informative priors were considered for the spatial residuals parameters ϕ δ 2 and noninformative priors were considered for the uncorrelated residuals parameters τ 2 we set hyperparameter values of ϕ as l l 0 2 6 1 u l 14 6 1 which corresponds to the range of distances for the domain considered here for δ 2 we set the priors based on sample variograms from the predicted residuals obtained from the linear model fitting on the maximum likelihood estimates of α along with a exponential model which is consistent with the covariance and cross covariance functions considered here for more details see cressie 1993 sample variograms are shown in fig 4 thus based on the exponential models fitted to the variograms we considered the diagonal of the matrix s which is 5 5 matrix equal to 36 5 0 06 0 05 0 3 and ν 6 number of rows of s plus 1 finally we set the hyperpameter values of τ 2 as κ 1 6 1 and γ 0 01 6 1 note that the priors of both spatial regression coefficients and spatial residuals are assumed to be independent we expect the model capture the correlation in these parameters if it exists in the posterior this would not be possible with univariate spatial gaussian process since the bayesian formulation is only at the second level with the spatial model of the ml estimates our model is semi bayesian and thus the posteriors are conditional posterior distributions with the conditional posterior distribution of spatial fields of the gev parameters for each time conditional posterior distribution of the nonstationary space time return levels of the precipitation extremes are obtained 3 4 implementation and model fitting the model was implemented in r using the extremes package gilleland and katz 2016 for the data layer and the spbayes package finley et al 2015 for the process layer the parameters of the nonstationary gev parameters at each location were estimated via maximum likelihood the spatial bayesian multivariate model was fit using a markov chain monte carlo mcmc method specifically gibbs sampling and random walk metropolis steps robert and casella 2004 one chain of length 120 000 was run with the first 60 000 iterations discarded as warmup and a sample thinning factor of 12 resulting in 5000 samples for each parameter to assess convergence trace plots were visually inspected and also a metropolis sampling acceptance percent above 80 was checked 3 5 computation of return levels with the model fitted from the steps above posterior distributions of each gev parameter for each year are obtained at station locations or on the 0 5 degree grid by evaluating eqs 2 5 thus generated parameter values are used to compute nonstationary return levels at each station or grid point using eq 15 the steps for this procedure are as follows 1 select a single conditional posterior sample of all model parameters β δ 2 ϕ τ 2 2 simulate spatial and nonspatial residuals w and 3 compute regression coefficients for gev parameters eq 5 4 compute gev parameters at each location i and year t eqs 2 4 5 compute nonstationary return levels at each location i and year t eq 15 6 repeat steps 1 5 for each posterior sample 3 6 model comparison to highlight the advantages of our framework we compare it with another model the models are as follows 1 semi bayesian univariate a univariate nonstationary gev distribution is fit to each location using mle where the location parameter is allowed to vary over time according to covariates specified in section 3 2 then the spatial dependence is captured through a spatial univariate gaussian process on each gev parameter 2 semi bayesian multivariate the spatial temporal semi bayesian multivariate hierarchical framework described in this study 4 results 4 1 model fits fig 5 shows the q q plot the empirical probability density function pdf and the pdf of the nonstationary gev distribution fitted and time series of nonstationary of the mle return levels for different return periods for the extreme summer precipitation at pasamonte station in new mexico see fig 2 the empirical pdf in fig 5b is obtained by a kernel density estimator which smooths the histogram e g bowman and azzalini 1997 it can be seen that in general model and sample quantiles fall close to the 1 1 line fig 5a and the fitted gev distribution captures the shape of the empirical pdf very well fig 5b however there is an overestimation of the upper tail i e high values in fig 5c it can be seen that the nonstationary return levels capture the inter annual variability of the observed precipitation extremes very well in that the return levels shift up and down in concert with the historical values a similar or even better performance showed in fig 5 was seen at all the other stations fig 6 shows the conditional posterior median of the regression coefficients corresponding to the covariates for the location shape and scale parameters of gev over the 0 5 degree grid from the 5000 simulations the median of the intercept of the location parameter fig 6a shows higher values in the eastern part of the region and lower in the western this is consistent with the climatology of the seasonal extreme precipitation see fig 2 in that the western parts are arid and semi arid and hence lower precipitation the conditional posterior median of sasp coefficients of the location fig 6b is higher in the east and it is positive over most of the region with small negative regions in the middle of the domain this can be explained by the orographic effect due to the presence of the mountain ranges the conditional posterior median for the intercept of log of the scale parameter fig 6c also shows similar spatial variability as the intercept of the location indicating that regions with higher extreme rainfall have higher variability the conditional posterior median of sasp coefficients of log of the scale parameter fig 6d shows similar spatial variability as the sasp coefficients of the location i e higher values in the east and regions with negative values in the middle of the domain the conditional posterior median of the shape parameter fig 6e indicates heavy tail distribution i e positive shape parameter in the arid and semi arid regions in the west part however its range of variation is small fig 7 shows the scatter plots of the conditional posterior spatial regression coefficients β 0 α 1 intercept of α 1 vs β 0 α 0 longitude slope of α 1 for the semi bayesian univariate model fig 7a and semi bayesian multivariate model fig 7b it is seen that contrary to semi bayesian univariate model semi bayesian multivariate model can capture the cross correlation between spatial regression coefficients for different gev regression coefficients even when we set up uncorrelated priors for them the same feature was observed for other spatial regression coefficients the same feature is observed for the residuals this is shown in fig 8 that displays sample cross variograms for more details see ver hoef and cressie 1993 of α μ 0 α μ 1 from the predicted residuals obtained from the linear model fitting on the maximum likelihood estimates mle of the gev regression coefficients fig 8a the conditional posterior residuals obtained from the semi bayesian univariate model fig 8b and the conditional posterior residuals obtained from the semi bayesian multivariate model fig 8c solid lines represent the least squares estimation of the exponential model of cross variogram it is seen that for semi bayesian multivariate case posterior residuals can capture the spatial cross correlation between the residuals observed for the mle case the observed residuals in our case this feature is not captured by the semi bayesian univariate model again the same was observed for α μ 0 α σ 0 and α μ 1 α σ 0 thus by capturing cross correlation between spatial coefficients and residuals with our framework is possible to obtain more consistent simulations of the gev regression coefficients and consequently reduce the uncertainty of the extreme precipitation return levels estimates 4 2 spatial variability of return levels to assess the ability of the model to capture the spatial patterns of the summer precipitation extremes we present results of 2 year return levels along with the associated observations fig 9 shows the spatial map of the conditional posterior median of the 2 year return level of summer precipitation extremes along with the median of the observed extremes at the station locations and also for representative wet and dry years fig 9a shows the conditional posterior median of the 2 year return level over all the years and the corresponding 95 credible interval width in fig 9b the median of historical precipitation extremes at the stations comparable to the posterior median of the 2 year return level are shown in fig 9a as colored circles it can be seen that the median values are lower in the arid and semi arid western regions of the domain and higher in the eastern parts which are consistent with the historical median values at the stations the colors in the circles are consistent with that of the background from the simulations the credible intervals widths do not show any spatial pattern we selected a wet year 1997 in the record and show the conditional posterior median of the 2 year return level in fig 9c and the historical observed values at the stations are consistent with the simulations more so in the western part of the domain however in the eastern part of the domain with high precipitation the simulations are slightly lower than the observations the spatial pattern of the credible interval width fig 9d is similar to that in fig 9b for a representative dry year 2001 the conditional posterior median of the 2 year return level and observed correspond very well fig 9e with a similar spatial pattern of credible interval width fig 9f to that of the simulations over the entire time domain fig 9b fig 10 shows the conditional posterior median of the 100 year return level of summer precipitation extreme and its 95 confidence interval width in fig 10a can be seen that this too shows a similar spatial pattern to that of the 2 year return level i e higher precipitation in the east and lower in the west this is consistent with the spatial pattern of the intercepts of the location and log of the scale parameters see fig 6 as in the case of 2 year return levels the credible intervals widths do not show any spatial pattern fig 10b 4 3 temporal variability of return levels to assess the performance of the temporal variability of the nonstationary framework we compared them semi bayesian multivariate model to the return levels from the mle estimates of the gev coefficientes which are consider as the true values in this case and to those return levels from the semi bayesian univariate model in fig 11 we show the boxplots of the nonstationary 100 year return level for each year at pasamonte station nm from the semi bayesian univariate model fig 11a and the framework proposed here semi bayesian multivariate fig 11b along with those from the mle estimates of the gev coefficients red line the whiskers show the 95 credible intervals the boxes the interquartile range and the horizontal lines inside the boxes the median the nonstationary framework proposed here shows a significant reduction in the uncertainty compared to the semi bayesian univariate model this can be explained by the ability of the framework proposed here to capture the cross correlation between the spatial regression coefficients and between the spatial residuals see figs 7 and 8 so this allow to preserve the cross correlation at site of mle estimates of the gev regression coefficients for each simulation of the coefficients 4 4 cross validation to test the out of sample predictability of the model cross validation was carried out by dropping 10 of the total stations i e 7 out of 73 stations and the model was fit on the remaining 66 stations stations dropped are shown in fig 12 red circles and were chosen to represent distinct climatological behaviors as well as geographical sampling to quantify the skill in a prediction mode we made two different predictions at the dropped stations and spatial validations first we predict the distributions at the dropped stations and randomly generated 5000 samples of extreme precipitation values at the dropped locations for each year in this case we created boxplots for the 7 stations dropped for the validation model dropping 10 of the data subset data model and observed data next we generated predictive posterior distributions over the 0 5 degreed grid using this model based on subset data 66 stations and subsequently generated 5000 samples of 100 year returns level over the same grid according to the section 3 5 we computed the difference between the median return level from the full data model fig 10 and this subset data model fig 13 shows predicted summer precipitation extremes for the period 1964 2018 at stations dropped for the validation model dropping 10 of the data for the semi bayesian univariate model light gray boxes semi bayesian multivariate model gray boxes and the observed data yellow boxes the distribution from the semi bayesian multivariate model captures the historical distribution quite well as the box and whiskers are comparable between the two indicating acceptable predictability offering prospects for this approach to be used in a predictive mode also it shows a better performance in capturing the historical distribution than the semi bayesian univariate model and a lower uncertainty overall the same feature is seen for dry 2001 and wet 1997 year cases fig 14 station 5 shows the worst performance but in general the performance is acceptable for almost all the station yellow circles fall into the boxes fig 15 shows the difference between the conditional posterior median 100 year return levels from the full data model and the subset data model over the 0 5 degree grid in general the difference map does not show spatial patterns except for a bias in the south of arizona this bias can be caused by poor data in this region and that two of the stations dropped stations 3 and 6 are located in this region however the differences are not high compared to the magnitude of 100 year return levels fig 10 so the performance of the model could be considered well 5 summary and discussion in this study we presented a spatial temporal multivariate semi bayesian hierarchical framework for conducting nonstationary frequency analysis of precipitation extremes at ungauged locations the framework assumes the marginal distribution of each location is a generalized extreme value gev distribution where the distribution parameters can vary in time as a function of covariates whose coefficients are estimated via maximum likelihood to get estimates at ungauged locations or over a grid the spatial dependence is captured by modeling spatially the coefficients of the covariates at each station using spatial gaussian multivariate processes we applied this framework to conduct nonstationary frequency analysis of extreme summer precipitation at 73 stations from the southwest us this application incorporated large scale climate indexes such as enso and pdo and the standardized spatial average of summer seasonal precipitation sasp over the region as potential covariates based on the lowest total aic and bic we selected the best model which only considers sasp as covariate for the location and scale paremeters and stationary shape parameter we found that the multivariate semi bayesian approach can capture the cross correlation between the spatial regression coefficients and the residuals provided a robust estimation of uncertainties of the return levels due to the spatial interpolation compared to univariate semi bayesian model and capture the spatial patterns of the observed data in the application presented here we only considered three potential covariates and the shape parameter was assumed to be stationary for simplicity however additional skillful covariates can further improve the estimates of space time variability in the case of that the framework can be applied to a local scale and local covariates can be included to capture well local patterns the spatial modeling of the process level parameters by incorporating correlation among the parameters makes a new contribution besides this correlation enables to reduce the parameter uncertainty related to the spatial interpolation we recognize that the uncertainty captured by our model does not represent the total uncertainty as we are employing the bayesian framework on the ml estimates of the gev coefficients the uncertainty in the ml estimates is not captured explicitly of course one could include this estimation in the first layer inside of the bayesian framework to capture this additional uncertainty however over a large spatial domain such as the southwest u s this makes the model computationally intensive and with no guarantees of convergence the semi bayesian model presented here makes this tradeoff to enable an efficient model capture most of the uncertainties a fully bayesian framework with efficient computational methods will be a natural extension the model performance skill will be dependent on the strength of the temporal covariates in their association with the variability of the extremes field in the application here we were motivated by our ongoing research on the summer precipitation over southwest us it is generally known that the summer precipitation and the extremes in this region exhibits high degree of variability and weaker connection with large scale forcings compared to their winter counterpart however the user can develop tailored covariates to their application if the covariates are lagged in time say a season head this modeling framework can be used to provide projections of seasonal extremes that will be of help in operational planning and management of natural resources ahead of the active season of extremes furthermore with multi decadal projections of the covariates say under a global warming scenarios projections of climate extremes for these scenarios can be made for use by policy makers extensions of this framework to other fields of extremes such as streamflow temperature pollution concentrations in space etc and to threshold exceedances can be easily enabled credit authorship contribution statement álvaro ossandón conceptualization methodology software validation formal analysis investigation resources writing original draft visualization funding acquisition balaji rajagopalan conceptualization methodology investigation writing review editing supervision project administration funding acquisition william kleiber methodology writing review editing supervision funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this project was funded by the national science foundation grant 1243270 we also acknowledge the support from a fulbright fellowship and the national agency for research and development anid scholarship program doctorado becas chile 2015 56150013 for the first author partial support from the monsoon mission project of the ministry of earth sciences india for second author is thankfully acknowledged the third author was supported by nsf dms 1811294 and dms 1923062 analysis was conducted using the r language r core team 2017 precipitation data were downloaded from the global historical climatology network https www1 ncdc noaa gov pub data ghcn daily the mei index is downloaded from the national oceanic and atmospheric administration noaa earth systems research laboratory esrl physical sciences division http www esrl noaa gov psd enso mei the pdo index is available from the university of washington http research jisao washington edu pdo the elevation data were downloaded from the nasa land data assimilation systems https ldas gsfc nasa gov nldas elevation appendix a abbreviations and acronyms pdf probability density function gev generalized extreme value ml maximum likelihood mle maximum likelihood estimates aic akaike information criteria bic bayesian information criterion mcmc markov chain monte carlo ghcn global historical climatology network enso el nino southern oscillation pdo pacific decadal oscillation amo atlantic multidecadal oscillation sasp standardized spatial average of summer seasonal precipitation mei multivariate enso index nldas nasa land data assimilation systems 
4387,we present a semi bayesian hierarchical modeling framework for conducting space time frequency analysis of precipitation extremes over a large domain in this framework the data layer the precipitation extreme i e seasonal maximum precipitation at each station in each year is modeled using a generalized extreme value gev distribution with temporally varying parameters which are decomposed as linear functions of covariates the coefficients of the covariates are estimated via maximum likelihood ml in the process layer the estimated ml coefficients of each of the covariates across the stations are spatially modeled with a gaussian multivariate process which enables capturing the spatial structure and correlation between the spatial model parameters suitable priors are used for the spatial model hyperparameters to complete the bayesian formulation since the bayesian formulation is only at the second level our model is semi bayesian and thus the posteriors are conditional posterior distributions with the conditional posterior distribution of spatial fields of the gev parameters for each time conditional posterior distribution of the nonstationary space time return levels of the precipitation extremes are obtained we demonstrate this framework by application to summer precipitation extreme at 73 stations covering a large domain of southwest us consisting of arizona new mexico colorado and utah the results from fitting and cross validation indicate that our model captures the historical variability at the stations very well conditional posterior distributions of return levels are simulated on a grid over the domain which will be of immense utility in management of natural resources and infrastructure keywords spatial extremes semi bayesian hierarchical modeling nonstationary model of extremes southwest us summer precipitation extremes 1 introduction extreme precipitation leads to extreme flow i e flood events leading to loss of lives and severe damage to infrastructure thus it is crucial for the engineering design of infrastructure such as flood protection dams and management of water supply and flood control to understand and model the variability of extreme precipitation in both space and time a common practice is to perform frequency analysis on block i e seasonal or annual precipitation extreme using statistical distributions a single set of distribution parameters are estimated assuming stationarity in that the precipitation variability in the future will be similar to that of the past jakob 2013 the fitted distributions are used to estimate occurrence probabilities i e return period of rare events of desired magnitudes and return levels of desired risks all useful in infrastructure design coles 2001 although for modeling extreme precipitation some studies have used log normal and gumbel distributions hershfield 1961 wilks 1993 the generalized extreme value gev distribution which is theoretically more appropriate is widely used e g dupuis and field 1998 gellens 2002 wilks 1993 due to its ability to capture a wide range of tail behaviors and also it is consistent with extreme value theory evt coles 2001 there are two main problems related to this single site stationary frequency analysis approach the stationarity assumption may not be valid since diverse modeling and empirical studies have shown that the frequency and intensity of extreme climatic events are increasing and will continue to do in the foreseeable future due to climate variability and change barnett et al 2006 frich et al 2002 ipcc 2007 milly et al 2008 schmidli and frei 2005 and the need for estimating extreme precipitation at several locations where data is not available for designing of infrastructure or hazard mitigation these motivate the need for modeling approaches that capture the variability of extremes in space and time temporal variability of extremes is modeled by varying the parameters of the statistical distribution as a function of covariates by a generalized linear modeling mccullagh and nelder 1989 approach an early approach for modeling the temporal variability of parameters of gev as functions of time was proposed in katz et al 2002 this led to plethora of studies that applied this approach at individual sites with time varying covariates besides time trend to modeling the temporal nonstationarity of precipitation extremes around the world as mentioned linear time trend to model the time varying gev parameters is the simplest nonstationary model fowler et al 2010 van haren et al 2013 katz et al 2002 other time varying covariates have been used to model precipitation extremes in asia agilan and umamahesh 2017 gao et al 2016 north america el adlouni et al 2007 um et al 2017 europe vasiliades et al 2015 australia agilan and umamahesh 2016 and elsewhere extensions of this in a bayesian approach have been developed cannon 2010 cheng and aghakouchak 2014 ouarda and el adlouni 2011 which captures the uncertainties in the parameters and consequently in the return levels robustly via their posterior distributions however most of these studies are single site analyses or assume spatial independence thus cannot provide estimates at any arbitrary ungauged location to address this studies have extend extreme value analysis and other methods to model inter site dependency these include regional frequency analysis such as the index flood method wazneh et al 2013 max stable processes coles 1993 coles and tawn 1996 davison et al 2012 stephenson et al 2016 spatial modeling of marginal gev parameters by univariate spatial gaussian processes dyrrdal et al 2015 yan and moradkhani 2015 yan and moradkhani 2016 reza najafi and moradkhani 2013 capturing the spatial dependency by both gaussian copulas and spatial modeling of marginal gev parameters and quantifying uncertainties of variables by hierarchical bayesian processes of the latent parameters bracken et al 2016 renard 2011 despite these advances limited studies have offered models for spatial and temporal nonstationarity of climate extremes especially precipitation extremes hanel et al 2009 modeled the nonstationarity in extreme precipitation over the rhine basin using a spatial extreme value model based on the index flow method that divided the domain into homogeneous regions where the gev coefficients are assumed to be constant lima et al 2016 used a hierarchical bayesian gev model for flood quantile estimates in which spatial dependency is captured by scaling the gev parameters independently according to their drainage area i e independent normal prior distributions are considered for the gev parameters other authors have used the same approach to model extreme precipitation apputhurai and stephenson 2013 steinschneider and lall 2015 ahn et al 2017 introduced a hierarchical bayesian model for regionalized seasonal forecasts where the spatial dependency is captured by modeling the probability distribution parameters with a multivariate gaussian field bracken et al 2018 and sun et al 2014 implemented a multivariate nonstationary bayesian hierarchical model for hydrologic frequency analysis in which the dependence between variables was captured by a gaussian elliptical copula in the data layer while these are very good approaches some general issues remain such as limited ability to capture spatial dependencies over the entire domain if gev parameters are kept constant over homogeneous regions estimation issues with copulas as the domain size increases inability to capture relationships between the parameters as each parameter is modeled separately in space these work well for smaller spatial domains or fewer variables but become computationally intensive and have convergence issues as the domain increases to name a few our research in this paper is motivated by the need to address these issues and have the ability to obtain estimates of return levels and their uncertainties at ungauged locations to this end we propose a semi bayesian hierarchical framework to model multi site spatio temporal variability of precipitation extremes we demonstrate this framework by its application to extreme summer precipitation at 73 stations from the southwest us arizona new mexico colorado and utah the paper is organized as follows in section 2 the framework in general is described the application set up for the southwest us extreme precipitation is then described followed by the specific form of the model structure and fitting method in section 3 the results are described in section 4 and section 5 presents a sumamry and discussion of the results 2 proposed framework the proposed spatial temporal multivariate semi bayesian hierarchical framework is comprised of three components the model structure the estimation strategy and estimation of nonstationary return levels 2 1 general model structure in general we wish to conduct a nonstationary frequency analysis of extreme precipitation at m locations over k years and then use a spatial model that allows us to estimate return levels and their uncertainty over a grid or at stations with missing data in this context it is assumed that extreme precipitation series at each station follows a gev distribution coles 2001 katz 2013 the spatial dependence is captured through a spatial multivariate gaussian process on the gev parameters the first layer of the hierarchical model structure also known as the data layer corresponds to the gev distribution assumed at each location s i and time point t which is 1 y s i t gev μ s i t σ s i t ξ s i t i 1 m where μ is the location parameter σ 0 is the scale parameter and ξ is the shape parameter under the nonstationary assumption distribution parameters can vary in space and time thus the three gev parameters could be modeled as functions of time dependent large scale climate variables and regional mean covariates 2 μ s i t α μ 0 s i j 1 n α μ j s i z j t i 1 m 3 log σ s i t α σ 0 s i j 1 n α σ j s i z j t i 1 m 4 ξ s i t α ξ 0 s i j 1 n α ξ j s i z j t i 1 m where α μ α σ and α ξ are the regression coefficients and z j t is covariate j at the time t log σ is modeled to ensure positive scale parameters the regression coefficients are estimated using maximum likelihood ml approach katz et al 2002 specific choices for covariates in our data analysis will be discussed in section 3 2 while in many studies ξ is modeled as a single value per study area or per region within the study area apputhurai and stephenson 2013 atyeo and walshaw 2012 cooley et al 2007 renard 2011 others consider that this parameter varies spatially along with the other gev parameters but considering a specific range of variation for it bracken et al 2016 cooley and sain 2010 here because we are interested in capturing the correlation between gev parameters no a priori restriction on its domain is imposed the bayesian formulation starts in the process layer which is the second layer of the hierarchy assumes a multivariate spatial gaussian process for the gev regression coefficients obtained via ml as mentioned above compared to a univariate spatial gaussian process e g yan and moradkhani 2015 sun et al 2014 this process can account for cross correlation in the regression coefficients the covariates selected for modeling the gev parameters in the first level exhibit spatial correlation thus the gev regression coefficients are likely to be correlated therefore the multivariate spatial gaussian process formulation is appropriate and general regardless of the strength of the spatial correlation thus the gev regression coefficients at the location s i are modeled as 5 α s i β t x s i w s i s i where α s i α μ s i α σ s i α ξ s i is a vector of 3 n 1 1 gev regression coefficients at the location s i β β μ β σ β ξ is a matrix of 4 3 n 1 spatial regression coefficients which are constant in space and time x s i is a 4 1 vector of regressors with the elements corresponding to the unity coordinates and elevation at the location s i and w s i and s i are vectors of 3 n 1 1 spatial and uncorrelated residuals at location s i respectively we assume the parameters can be defined through a latent multivariate process comprised of two components a spatial term w that follows a mean 0 stationary anisotropic gaussian process specification with a covariance function c and independent white noise process considering m locations we have that spatial and uncorrelated residuals are 6 w w s 1 w s 2 w s m t 7 s 1 s 2 s m t the spatial residuals vector w follows a mvn 0 σ s where σ s is the mp mp covariance matrix and p 3 n 1 the covariance matrix is defined as 8 σ s c 11 c 1 p c p 1 c pp where c kl is a m m cross covariance matrix when k l it corresponds to a covariance matrix we consider an exponential covariance function with parameters δ kl 2 the partial sill or marginal variance ϕ kl the spatial decay parameter the parametric form of the covariance and cross covariance functions is 9 c kl s i s j δ kl 2 exp ϕ kl s i s j this specification is a particular type of multivariate matérn gneiting et al 2010 there are some restrictions on parameters that result in a valid i e nonnegative definite covariance matrix see gneiting et al 2010 or apanasovich et al 2012 for details for the uncorrelated residuals we have mvn 0 σ ns where σ ns is mp mp diagonal covariance matrix 10 σ ns τ 1 2 i 0 0 0 τ 2 2 i 0 0 0 τ p 2 i where τ k 2 is the nugget effect related to the kth gev regression coefficient and i is a m m identity matrix a conceptual sketch of the spatial temporal multivariate semi bayesian hierarchical framework is shown in fig 1 which shows the data layer maximum likelihood estimation of the gev regression coefficients and the process layer multivariate spatial gaussian process for the gev regression coefficients obtained in the data layer 2 2 estimation strategy first gev regression coefficients of the data layer are estimated from eqs 1 4 using maximum likelihood then the conditional posterior distribution of the spatial regression coefficients β and residuals parameters δ 2 ϕ τ 2 given maximum likelihood estimates mles of the gev regression coefficients α which are assumed as the true values of the gev regression coefficients and spatial regressors x are obtained using the multivariate bayesian model by bayes rule the posterior distribution is 11 p β w δ 2 ϕ τ 2 α x p α β w δ 2 ϕ τ 2 x p β w δ 2 ϕ τ 2 x p α β w τ 2 x p w δ 2 ϕ p τ 2 p β p α β w τ 2 x p w δ 2 ϕ p δ 2 p ϕ p τ 2 p β here term p w δ 2 ϕ f mvn w 0 σ s f mvn w 0 σ s represents the probability density of a multivariate normal distribution with mean 0 and covariance σ s see eq 8 p β f mvn β μ β σ β μ β and σ β are the spatial regression coefficient estimates and their covariance matrix obtained from a linear model fitting eq 5 using maximum likelihood p δ 2 p ϕ and p τ 2 are the priors of the other parameters which based on finley et al 2015 are assumed to be independent and follow the following distributions 12 δ 2 invwishart ν s ϕ unif l l u l τ 2 invgamma κ γ where ν and s are the degrees of freedom and scale matrix of the inverse wishart distribution l l and u l are the lower and upper limits vectors of the uniform distribution κ and γ are the shape and scale hyper parameters vectors of the inverse gamma distribution the term p α β w τ 2 x is the likelihood of mles of the gev regression coefficients α conditional on the dependence of the uncorrelated residuals the regression coefficients β β μ β σ β ξ and spatial residuals the likelihood of α is defined as a multivariate normal 13 p α β w τ 2 x f mvn α x t β w σ ns where x is a known m p matrix of spatial regressors 2 3 nonstationary return levels according to read and vogel 2015 it is important to be clear when discussing nonstationary return levels and return periods since there are several definitions cheng et al 2014 salas and obeysekera 2014 katz 2013 for a stationary gev distribution the return level t is defined as the p 1 1 t th quantile 14 q p μ σ ξ log p ξ 1 here we use the definition for nonstationary return levels provided by cheng et al 2014 which states that in a nonstationary setting when the gev parameters may be time varying the return level can be computed at each year which is known as the effective return level 15 q p t μ t σ t ξ t log p ξ t 1 3 application the southwest us region comprising of the four states arizona new mexico colorado and utah is the hottest and driest region of the united states most of the precipitation arrives during the winter season but the summer precipitation makes a significant contribution to the reliability of water resources and the health of ecology however summer precipitation and its extremes over this region exhibit a high degree of spatial and temporal variability sheppard et al 2002 we demonstrate the utility of our proposed framework presented in the previous section by its application to summer precipitation extremes at 73 stations from this region 3 1 precipitation data daily summer june through september precipitation data were obtained from the global historical climatology network ghcn menne et al 2012 we selected stations with a full record of data for the period 1964 to 2018 or those with no more than 10 of data missing or no more than three years of missing data in a row this resulted in 73 stations for which climatology of the extreme seasonal precipitation is shown in fig 2 along with an elevation grid summer season 3 day maximum precipitation was computed for each year at each station for a station with missing year values these values were substituted with the median value of the station 3 2 covariates some studies higgins et al 1999 mamalakis et al 2018 mccabe et al 2004 have shown that there is a weak statistical relationship between southwest us summer precipitation and large scale climate indices capturing drivers in tropical pacific el nino southern oscillation enso northern pacific pacific decadal oscillation pdo and atlantic atlantic multidecadal oscillation amo since our objective is to demonstrate our framework we rely on these prior researches and considered these large scale climate indices as potential covariates albeit with a somewhat weaker association for the nonstationary gev distribution in the framework however users can develop tailored covariates for their specific data to enhance model performance for modeling the temporal nonstationarity of the gev parameters see eqs 2 4 first we considered summer season average enso and pdo indices and the standardized spatial average of summer seasonal precipitation sasp over the entire region as potential covariates we obtained values of the multivariate enso index mei wolter and timlin 1993 wolter and timlin 1998 wolter and timlin 2011 from http www esrl noaa gov psd enso mei the pdo values zhang et al 1997 were obtained from http research jisao washington edu pdo the average summer season precipitation sasp was computed from the ghcn menne et al 2012 we assess the strength of the relationship between the covariates and the summer precipitation extreme by computing the spearman s rank correlations shown in fig 3 it can be seen that sasp exhibits significant correlation with summer precipitation extreme across at almost all the locations over the domain however enso and pdo indices present a weaker correlation with precipitation extremes and significant at only few locations previous studies mentioned earlier in this section investigated relationship between these indices and seasonal total precipitation in this region and found them to stronger but from our analysis the indices ride a weaker signature on the precipitation extremes we selected the best nonstationary gev model using total akaike information criteria aic akaike 1974 and total bayesian information criterion bic schwarz 1978 in this the nonstationary model is fitted to the precipitation extreme at each location and the aic and bic values of all the individual location models are added to obtain the total aic and bic values these are computed for a suite of candidate models with various combinations of the covariates and the model with the minimum total aic or bic is selected for modeling the gev regression coefficients spatially we included covariates of latitude longitude and elevation covariates were obtained at station locations and a 0 5 degree grid throughout the study area we obtained the elevation data from the nasa land data assimilation systems nldas xia et al 2012 https ldas gsfc nasa gov nldas elevation 3 3 model structure for the southwest us for the structure of the model for the southwest us we incorporated the above covariates for spatial and temporal modeling we model the location and scale parameters of the gev at each location nonstationary shape parameters are generally more variable leading to convergence issues in ml estimation thus most studies in literature generally keep this stationary following this the shape parameter was keep stationary at each location based on both the total aic and bic values shown in table 1 the best model selected uses only sasp as covariate to model the location and scale parameters the next best model though includes enso the priors on the spatial regression coefficients and residuals parameters used are 16 β mvn μ β σ β δ 2 invwishart ν s ϕ unif l l u l τ 2 invgamma κ γ where β s i β μ β σ β ξ μ β and σ β are the spatial regression coefficient estimates and their covariance matrix obtained from a linear model fitting eq 5 on the maximum likelihood estimates of α for each gev regression coefficient separately based on the recommendations from banerjee et al 2004 and cooley et al 2007 informative priors were considered for the spatial residuals parameters ϕ δ 2 and noninformative priors were considered for the uncorrelated residuals parameters τ 2 we set hyperparameter values of ϕ as l l 0 2 6 1 u l 14 6 1 which corresponds to the range of distances for the domain considered here for δ 2 we set the priors based on sample variograms from the predicted residuals obtained from the linear model fitting on the maximum likelihood estimates of α along with a exponential model which is consistent with the covariance and cross covariance functions considered here for more details see cressie 1993 sample variograms are shown in fig 4 thus based on the exponential models fitted to the variograms we considered the diagonal of the matrix s which is 5 5 matrix equal to 36 5 0 06 0 05 0 3 and ν 6 number of rows of s plus 1 finally we set the hyperpameter values of τ 2 as κ 1 6 1 and γ 0 01 6 1 note that the priors of both spatial regression coefficients and spatial residuals are assumed to be independent we expect the model capture the correlation in these parameters if it exists in the posterior this would not be possible with univariate spatial gaussian process since the bayesian formulation is only at the second level with the spatial model of the ml estimates our model is semi bayesian and thus the posteriors are conditional posterior distributions with the conditional posterior distribution of spatial fields of the gev parameters for each time conditional posterior distribution of the nonstationary space time return levels of the precipitation extremes are obtained 3 4 implementation and model fitting the model was implemented in r using the extremes package gilleland and katz 2016 for the data layer and the spbayes package finley et al 2015 for the process layer the parameters of the nonstationary gev parameters at each location were estimated via maximum likelihood the spatial bayesian multivariate model was fit using a markov chain monte carlo mcmc method specifically gibbs sampling and random walk metropolis steps robert and casella 2004 one chain of length 120 000 was run with the first 60 000 iterations discarded as warmup and a sample thinning factor of 12 resulting in 5000 samples for each parameter to assess convergence trace plots were visually inspected and also a metropolis sampling acceptance percent above 80 was checked 3 5 computation of return levels with the model fitted from the steps above posterior distributions of each gev parameter for each year are obtained at station locations or on the 0 5 degree grid by evaluating eqs 2 5 thus generated parameter values are used to compute nonstationary return levels at each station or grid point using eq 15 the steps for this procedure are as follows 1 select a single conditional posterior sample of all model parameters β δ 2 ϕ τ 2 2 simulate spatial and nonspatial residuals w and 3 compute regression coefficients for gev parameters eq 5 4 compute gev parameters at each location i and year t eqs 2 4 5 compute nonstationary return levels at each location i and year t eq 15 6 repeat steps 1 5 for each posterior sample 3 6 model comparison to highlight the advantages of our framework we compare it with another model the models are as follows 1 semi bayesian univariate a univariate nonstationary gev distribution is fit to each location using mle where the location parameter is allowed to vary over time according to covariates specified in section 3 2 then the spatial dependence is captured through a spatial univariate gaussian process on each gev parameter 2 semi bayesian multivariate the spatial temporal semi bayesian multivariate hierarchical framework described in this study 4 results 4 1 model fits fig 5 shows the q q plot the empirical probability density function pdf and the pdf of the nonstationary gev distribution fitted and time series of nonstationary of the mle return levels for different return periods for the extreme summer precipitation at pasamonte station in new mexico see fig 2 the empirical pdf in fig 5b is obtained by a kernel density estimator which smooths the histogram e g bowman and azzalini 1997 it can be seen that in general model and sample quantiles fall close to the 1 1 line fig 5a and the fitted gev distribution captures the shape of the empirical pdf very well fig 5b however there is an overestimation of the upper tail i e high values in fig 5c it can be seen that the nonstationary return levels capture the inter annual variability of the observed precipitation extremes very well in that the return levels shift up and down in concert with the historical values a similar or even better performance showed in fig 5 was seen at all the other stations fig 6 shows the conditional posterior median of the regression coefficients corresponding to the covariates for the location shape and scale parameters of gev over the 0 5 degree grid from the 5000 simulations the median of the intercept of the location parameter fig 6a shows higher values in the eastern part of the region and lower in the western this is consistent with the climatology of the seasonal extreme precipitation see fig 2 in that the western parts are arid and semi arid and hence lower precipitation the conditional posterior median of sasp coefficients of the location fig 6b is higher in the east and it is positive over most of the region with small negative regions in the middle of the domain this can be explained by the orographic effect due to the presence of the mountain ranges the conditional posterior median for the intercept of log of the scale parameter fig 6c also shows similar spatial variability as the intercept of the location indicating that regions with higher extreme rainfall have higher variability the conditional posterior median of sasp coefficients of log of the scale parameter fig 6d shows similar spatial variability as the sasp coefficients of the location i e higher values in the east and regions with negative values in the middle of the domain the conditional posterior median of the shape parameter fig 6e indicates heavy tail distribution i e positive shape parameter in the arid and semi arid regions in the west part however its range of variation is small fig 7 shows the scatter plots of the conditional posterior spatial regression coefficients β 0 α 1 intercept of α 1 vs β 0 α 0 longitude slope of α 1 for the semi bayesian univariate model fig 7a and semi bayesian multivariate model fig 7b it is seen that contrary to semi bayesian univariate model semi bayesian multivariate model can capture the cross correlation between spatial regression coefficients for different gev regression coefficients even when we set up uncorrelated priors for them the same feature was observed for other spatial regression coefficients the same feature is observed for the residuals this is shown in fig 8 that displays sample cross variograms for more details see ver hoef and cressie 1993 of α μ 0 α μ 1 from the predicted residuals obtained from the linear model fitting on the maximum likelihood estimates mle of the gev regression coefficients fig 8a the conditional posterior residuals obtained from the semi bayesian univariate model fig 8b and the conditional posterior residuals obtained from the semi bayesian multivariate model fig 8c solid lines represent the least squares estimation of the exponential model of cross variogram it is seen that for semi bayesian multivariate case posterior residuals can capture the spatial cross correlation between the residuals observed for the mle case the observed residuals in our case this feature is not captured by the semi bayesian univariate model again the same was observed for α μ 0 α σ 0 and α μ 1 α σ 0 thus by capturing cross correlation between spatial coefficients and residuals with our framework is possible to obtain more consistent simulations of the gev regression coefficients and consequently reduce the uncertainty of the extreme precipitation return levels estimates 4 2 spatial variability of return levels to assess the ability of the model to capture the spatial patterns of the summer precipitation extremes we present results of 2 year return levels along with the associated observations fig 9 shows the spatial map of the conditional posterior median of the 2 year return level of summer precipitation extremes along with the median of the observed extremes at the station locations and also for representative wet and dry years fig 9a shows the conditional posterior median of the 2 year return level over all the years and the corresponding 95 credible interval width in fig 9b the median of historical precipitation extremes at the stations comparable to the posterior median of the 2 year return level are shown in fig 9a as colored circles it can be seen that the median values are lower in the arid and semi arid western regions of the domain and higher in the eastern parts which are consistent with the historical median values at the stations the colors in the circles are consistent with that of the background from the simulations the credible intervals widths do not show any spatial pattern we selected a wet year 1997 in the record and show the conditional posterior median of the 2 year return level in fig 9c and the historical observed values at the stations are consistent with the simulations more so in the western part of the domain however in the eastern part of the domain with high precipitation the simulations are slightly lower than the observations the spatial pattern of the credible interval width fig 9d is similar to that in fig 9b for a representative dry year 2001 the conditional posterior median of the 2 year return level and observed correspond very well fig 9e with a similar spatial pattern of credible interval width fig 9f to that of the simulations over the entire time domain fig 9b fig 10 shows the conditional posterior median of the 100 year return level of summer precipitation extreme and its 95 confidence interval width in fig 10a can be seen that this too shows a similar spatial pattern to that of the 2 year return level i e higher precipitation in the east and lower in the west this is consistent with the spatial pattern of the intercepts of the location and log of the scale parameters see fig 6 as in the case of 2 year return levels the credible intervals widths do not show any spatial pattern fig 10b 4 3 temporal variability of return levels to assess the performance of the temporal variability of the nonstationary framework we compared them semi bayesian multivariate model to the return levels from the mle estimates of the gev coefficientes which are consider as the true values in this case and to those return levels from the semi bayesian univariate model in fig 11 we show the boxplots of the nonstationary 100 year return level for each year at pasamonte station nm from the semi bayesian univariate model fig 11a and the framework proposed here semi bayesian multivariate fig 11b along with those from the mle estimates of the gev coefficients red line the whiskers show the 95 credible intervals the boxes the interquartile range and the horizontal lines inside the boxes the median the nonstationary framework proposed here shows a significant reduction in the uncertainty compared to the semi bayesian univariate model this can be explained by the ability of the framework proposed here to capture the cross correlation between the spatial regression coefficients and between the spatial residuals see figs 7 and 8 so this allow to preserve the cross correlation at site of mle estimates of the gev regression coefficients for each simulation of the coefficients 4 4 cross validation to test the out of sample predictability of the model cross validation was carried out by dropping 10 of the total stations i e 7 out of 73 stations and the model was fit on the remaining 66 stations stations dropped are shown in fig 12 red circles and were chosen to represent distinct climatological behaviors as well as geographical sampling to quantify the skill in a prediction mode we made two different predictions at the dropped stations and spatial validations first we predict the distributions at the dropped stations and randomly generated 5000 samples of extreme precipitation values at the dropped locations for each year in this case we created boxplots for the 7 stations dropped for the validation model dropping 10 of the data subset data model and observed data next we generated predictive posterior distributions over the 0 5 degreed grid using this model based on subset data 66 stations and subsequently generated 5000 samples of 100 year returns level over the same grid according to the section 3 5 we computed the difference between the median return level from the full data model fig 10 and this subset data model fig 13 shows predicted summer precipitation extremes for the period 1964 2018 at stations dropped for the validation model dropping 10 of the data for the semi bayesian univariate model light gray boxes semi bayesian multivariate model gray boxes and the observed data yellow boxes the distribution from the semi bayesian multivariate model captures the historical distribution quite well as the box and whiskers are comparable between the two indicating acceptable predictability offering prospects for this approach to be used in a predictive mode also it shows a better performance in capturing the historical distribution than the semi bayesian univariate model and a lower uncertainty overall the same feature is seen for dry 2001 and wet 1997 year cases fig 14 station 5 shows the worst performance but in general the performance is acceptable for almost all the station yellow circles fall into the boxes fig 15 shows the difference between the conditional posterior median 100 year return levels from the full data model and the subset data model over the 0 5 degree grid in general the difference map does not show spatial patterns except for a bias in the south of arizona this bias can be caused by poor data in this region and that two of the stations dropped stations 3 and 6 are located in this region however the differences are not high compared to the magnitude of 100 year return levels fig 10 so the performance of the model could be considered well 5 summary and discussion in this study we presented a spatial temporal multivariate semi bayesian hierarchical framework for conducting nonstationary frequency analysis of precipitation extremes at ungauged locations the framework assumes the marginal distribution of each location is a generalized extreme value gev distribution where the distribution parameters can vary in time as a function of covariates whose coefficients are estimated via maximum likelihood to get estimates at ungauged locations or over a grid the spatial dependence is captured by modeling spatially the coefficients of the covariates at each station using spatial gaussian multivariate processes we applied this framework to conduct nonstationary frequency analysis of extreme summer precipitation at 73 stations from the southwest us this application incorporated large scale climate indexes such as enso and pdo and the standardized spatial average of summer seasonal precipitation sasp over the region as potential covariates based on the lowest total aic and bic we selected the best model which only considers sasp as covariate for the location and scale paremeters and stationary shape parameter we found that the multivariate semi bayesian approach can capture the cross correlation between the spatial regression coefficients and the residuals provided a robust estimation of uncertainties of the return levels due to the spatial interpolation compared to univariate semi bayesian model and capture the spatial patterns of the observed data in the application presented here we only considered three potential covariates and the shape parameter was assumed to be stationary for simplicity however additional skillful covariates can further improve the estimates of space time variability in the case of that the framework can be applied to a local scale and local covariates can be included to capture well local patterns the spatial modeling of the process level parameters by incorporating correlation among the parameters makes a new contribution besides this correlation enables to reduce the parameter uncertainty related to the spatial interpolation we recognize that the uncertainty captured by our model does not represent the total uncertainty as we are employing the bayesian framework on the ml estimates of the gev coefficients the uncertainty in the ml estimates is not captured explicitly of course one could include this estimation in the first layer inside of the bayesian framework to capture this additional uncertainty however over a large spatial domain such as the southwest u s this makes the model computationally intensive and with no guarantees of convergence the semi bayesian model presented here makes this tradeoff to enable an efficient model capture most of the uncertainties a fully bayesian framework with efficient computational methods will be a natural extension the model performance skill will be dependent on the strength of the temporal covariates in their association with the variability of the extremes field in the application here we were motivated by our ongoing research on the summer precipitation over southwest us it is generally known that the summer precipitation and the extremes in this region exhibits high degree of variability and weaker connection with large scale forcings compared to their winter counterpart however the user can develop tailored covariates to their application if the covariates are lagged in time say a season head this modeling framework can be used to provide projections of seasonal extremes that will be of help in operational planning and management of natural resources ahead of the active season of extremes furthermore with multi decadal projections of the covariates say under a global warming scenarios projections of climate extremes for these scenarios can be made for use by policy makers extensions of this framework to other fields of extremes such as streamflow temperature pollution concentrations in space etc and to threshold exceedances can be easily enabled credit authorship contribution statement álvaro ossandón conceptualization methodology software validation formal analysis investigation resources writing original draft visualization funding acquisition balaji rajagopalan conceptualization methodology investigation writing review editing supervision project administration funding acquisition william kleiber methodology writing review editing supervision funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this project was funded by the national science foundation grant 1243270 we also acknowledge the support from a fulbright fellowship and the national agency for research and development anid scholarship program doctorado becas chile 2015 56150013 for the first author partial support from the monsoon mission project of the ministry of earth sciences india for second author is thankfully acknowledged the third author was supported by nsf dms 1811294 and dms 1923062 analysis was conducted using the r language r core team 2017 precipitation data were downloaded from the global historical climatology network https www1 ncdc noaa gov pub data ghcn daily the mei index is downloaded from the national oceanic and atmospheric administration noaa earth systems research laboratory esrl physical sciences division http www esrl noaa gov psd enso mei the pdo index is available from the university of washington http research jisao washington edu pdo the elevation data were downloaded from the nasa land data assimilation systems https ldas gsfc nasa gov nldas elevation appendix a abbreviations and acronyms pdf probability density function gev generalized extreme value ml maximum likelihood mle maximum likelihood estimates aic akaike information criteria bic bayesian information criterion mcmc markov chain monte carlo ghcn global historical climatology network enso el nino southern oscillation pdo pacific decadal oscillation amo atlantic multidecadal oscillation sasp standardized spatial average of summer seasonal precipitation mei multivariate enso index nldas nasa land data assimilation systems 
4388,a comprehensive climatology of fog events at perth airport was developed with the aim of improving the forecasting of fog through an enhanced understanding of its nature from 2002 to 2019 inclusive the airport experienced 8 9 3 0 fog events per year with 96 of all events occurring in the cool season from april to october inclusive the fog events were ordered into different fog types following a hierarchical classification method radiation fog were found to be the most prevalent in this region a k means clustering method was applied to 2300 utc 0700 lst observations at perth airport to divide the dataset into 5 different weather regimes the majority of fog events occurred in a post frontal trough system with a high pressure system to the west bringing in moisture from the indian ocean perth airport is located on a coastal plain with an escarpment 10 km to the east of the airport roughly parallel to the coast and rising to about 300 m in the 2002 2019 cool season period 41 of fog events had northerly to easterly 10 m winds at 2300 utc 0700 lst while the 925 hpa winds were southerly to westerly this compares with 15 of days with north to east winds at 10 m across all cool season days in the same period these results support the current theory that fog often forms when nocturnal cooling on the coastal plain leads to increased stability in the near surface layer and a decoupling between the moist environmental westerlies and the surface flow at perth airport this allows the development of local circulations forced by the local topography keywords fog climatology classification physical processes 1 introduction fog has a significant impact on the aviation industry with regards to both safety and economics and there is considerable interest in having accurate forecasts fog events that are not forecast can raise safety concerns if an aircraft is unable to land and has limited fuel reserves to reach a suitable alternate unscheduled diversions can cause considerable disruption to flight schedules across the network can take many hours to clear and inconvenience passengers the unnecessary carriage of additional fuel will result in increased fuel burn and a possible reduction in the payload of passengers and cargo with resulting economic impacts the fog forecasts for the perth airport are of particular interest as it is relatively remote with a large distance to suitable alternates for large aircraft an early study of a perth fog event golding 1993 noted the significance of the local terrain in the formation of fog he found that fog forms near a stagnation point between a cold drainage flow off the darling escarpment to the east 300 m elevation and moist onshore flow from the west he also remarked that the drainage flow is perturbed by the complexity of the orography which can lead to local variations in the development of fog across the area this work remains a major contributor towards our understanding of the local fog processes even though it was based on a single case of radiation fog golding s findings were supported in recent high resolution nwp case studies by roux 2017 where the combination of flow blocked by the darling escarpment and cold drainage flow from more localised valleys in the foothills of the escarpment were found to have a possible influence on fog at perth airport local blocked flow occurs when the moist westerlies are being blocked by the darling escarpment often resulting in light northerly wind near the surface at perth airport tepper watson 1990 gave a detailed description of a blocked flow over adelaide airport which has a similar landscape to perth airport in terms of ocean to the west a coastal plain and semi parallel mountain range orientation they found however that the north easterly surface flows across the adelaide plains on winter nights are a result of upstream airmass blocking of a stably stratified flow rather than katabatic winds as previously believed another fog case study barras and miao 2011 for perth airport was used in the formation of a single column model scm testbed for access the australian community climate and earth system simulator puri et al 2013 large scale forcing for the scm was derived from the regional numerical weather prediction model analysis to take the orographic influences into account they found that the scm simulated similar processes of fog formation as its parent three dimensional model making it useful as a tool to study the model parametrizations miao et al 2012 processed nwp output using fuzzy logic to account for model inaccuracy as well as uncertainties between fog predictors and occurrence the fuzzy fog guidance was found useful and is still used in the forecasting process but the guidance is only valid for a specific location while studies on fog at perth airport have been conducted over many years little has been published on the fog climatology explicitly based on the analysis of fog events observed over one year huang et al 1990 described four types of fog mechanisms observed in perth post frontal advection radiation and rain fog their classification metrics however have been found to be ambiguous and one year of fog events in perth is not enough for a robust climatology operationally rob taggart from the bureau of meteorology used metar meteorological aerodrome report data together with low level winds from the ecmwf reanalysis to produce a graphical climatology of fog across australia for forecasting guidance r taggart 2016 personal communication while this has proven to be an extremely useful and popular tool for local forecasters it does not distinguish between fog types other than the presence or absence of precipitation since 9am on the day and offers only limited insight into the mechanisms for the local fog formation gultepe et al 2007 gave an overview of the variety of research done in the past on fog throughout the world they stated that the main aims of a fog climatology are to better understand the nature of fog and to utilise this knowledge to improve the forecasting of fog which is in line with the purpose of this paper a detailed climatology provides an important basis to understand fog processes in a region and ultimately improve the forecasting of fog climatologies can be constructed utilising a number of observations and tools fog climatologies are often point based due to the local nature of fog and the availability of relatively long records of quality observations including visibility often being constrained to airports for example tardif and rasmussen 2007 used hourly observations from 1977 to 1996 of 17 stations around new york city in their fog climatology of the region using these observations they derived an objective algorithm to classify fog types their methods were adopted with some modifications to suit the local conditions by van schalkwyk and dyson 2013 in their study of the climatological characteristics of fog at cape town international airport in south africa using hourly surface observations from 1997 2010 belorid et al 2014 used a similar approach in their study of the distribution and long term trends in fog types over south korea using 3 hourly observations from 24 stations over 25 years the algorithm of tardif and rasmussen 2007 were also employed in a slightly simplified version to understand the characteristics of fog in japan using hourly surface observations of 60 stations over a 5 year period from 2004 2008 akimoto and kusaka 2015 a combination of observations and era 40 reanalysis data was used to create a climatology for fog to support forecasting at three airports in finland with varying climatological conditions hyvärinen et al 2007 in this study we employ observations from the 18 year period 2002 to 2019 inclusive to develop a comprehensive climatology of fog events at the perth airport this period is chosen because of the more consistent availability of both sub hourly and upper air observations the sub hourly observations are deemed important because fog in the region often does not last more than a couple of hours one hundred and sixty one fog events were identified in the 18 year period the local environment and observations are described in section 2 with the methodology on the classification of fog types and weather regimes presented in section 3 the results including the fog climatology are presented in section 4 with a discussion and conclusions in section 5 2 local environment and observations 2 1 local geography and synoptic meteorology perth airport is in south western western australia swwa on a coastal plain the indian ocean is about 20 km to the west and the darling escarpment about 10 km to the east of the airport rising sharply to around 350 m and running parallel to the coast fig 1 in the cooler months the weather at perth is largely influenced by the passage of frontal systems and troughs moving eastwards across the southern parts of the country hope et al 2006 wright 1974 wright 1974 found that the early season may to july rainfall is dominated by north westerly winds and continuous rains associated with a widespread uplift in the mid troposphere while late season august to october rains are more showery and related to airstream instability with west to south westerly winds in an analysis of the april to october rainfall over the period of 1965 2009 pook et al 2012 found that 58 of the rainfall at perth airport is as a result of frontal rain while 25 comes from cut off lows in general the 10 m winds at the airport are predominantly south westerly in the early evening 1900 lst which tends to north easterly by 0700 lst at speeds typically less than 2 5 m s 1 this north easterly surface flow is thought to result from a drainage flow off the escarpment in the warmer months nov mar the perth area is typically under the influence of warm to hot dry easterlies with south westerly sea breezes in the afternoon small dewpoint depressions are commonly used in forecasting fog for example the dewpoint depression is used to evaluate the available moisture in the fog forecast decision support system as described in boneh et al 2015 a significant challenge in forecasting fog at perth airport is the high incidence of nights with a small dewpoint depression without fog forming typically due to stronger wind speeds too much cloud or a combination of these in the 17 year period of 2002 2018 inclusive the perth airport automatic weather station aws recorded 967 days with a dewpoint depression of less than 0 6 degrees at 0600 lst with a visibility below 1 km on only 42 days 4 3 for comparison over the same period melbourne airport recorded a dewpoint depression below 0 6 degrees at 0600 lst on 440 days with a visibility below 1 km on 47 days 10 7 2 2 observations for the fog climatology at perth airport 10 minute observations are taken from the automatic weather station aws at the airport which includes a visibility meter and ceilometer for visibility and cloud observations the automatic visibility measurements were routinely available from late july 2001 so the period used for the climatology is 2002 2019 inclusive a fog event day is defined as fog occurring in the 24 hour period from 0600 utc 1400 lst to account for the fact the fog has always been observed overnight and in the early morning hours a day is considered a fog day if the average 10 minute visibility was below 1 km for at least 30 min throughout the day and any coincident precipitation was 0 2 mm or less the lowest unit recorded by the tipping bucket rain gauge used for the automated observations of precipitation at perth airport is 0 2 mm this can occasionally be triggered by the formation of dew on the instrument especially during cool nights in a stable atmosphere when favourable conditions for fog may be present based on these criteria 161 fog events were observed in the 18 year period the near surface observations from perth airport aws were used in conjunction with upper air observations from perth airport radiosondes at 1100 utc 1900 lst and 2300 utc 0700 lst to characterise the weather during the afternoon before the fog and in the morning around the time of the fog clearance 3 methodology 3 1 classification of fog types tardif rasmussen 2007 derived an objective algorithm to classify fog events into various types according to fog formation processes several other papers e g van schalkwyk dyson 2013 belorid et al 2014 akimoto kusaka 2015 presented a similar approach with some variations to the fog types and actual thresholds as deemed appropriate due to local differences in fog in line with this a simple hierarchical classification system fig 2 has been devised utilising the 10 min observational dataset to establish the types of fog that occur at perth airport the classification including relevant thresholds was guided by the early work of tardif and rasmussen 2007 and more recent studies by van schalkwyk and dyson 2013 belorid et al 2014 and akimoto and kusaka 2015 after careful consideration of the observations only the three main mechanisms of radiation advection and cloud base lowering were deemed appropriate for the classification of fog at perth airport tardif rasmussen 2007 included precipitation and morning evaporation fog types but investigations of observations at perth airport suggest that it would not be pertinent to have these additional types analysis of the rainfall prior to fog onset indicated that although precipitation is not the main mechanism for fog formation it can be important to precondition the environment more than 0 2 mm of precipitation in the six hours prior to fog formation was reported for 69 43 of the events though the six hour accumulation was never more than 9 mm the six longest duration fog events all had some precipitation in the six hours prior to fog onset it must also be acknowledged the thresholds applied in the classification are somewhat subjective as evidenced by the variations across the previous studies the thresholds presented in fig 2 are considered reasonable for perth airport and indeed for most airports across australia radiation fog the main criterion for radiation fog rad is a cloud coverage of less than 2 octas average wind speed in the hour before fog onset less than 2 5 m s and cooling in the 6 h prior to the fog calculated by the difference between the temperature 6 h prior to the fog onset and the temperature at fog onset the fog type is also classed as a radiation fog if the cloud coverage is 2 octas or more but the cloud base is lifting and there is cooling in the 6 h prior to the onset radiation fog was by far the most prevalent fog type at perth airport with 98 events 61 classified as this type fog with advection a fog event is classified as advection fog adv if the average 10 min wind speed at fog onset is at least 2 5 m s note that in this instance advection fog simply means fog where advection was the major contributor the distinction has not been made whether the fog was advected over the airport from elsewhere or the more traditional advection fog fog forming when relatively warm moist air moves over colder surfaces fifty one events 32 were typed as advection fog cloud base lowering fog if the cloud cover at fog onset is 2 octas or more and the cloud base was less than 1000 m and has been lowering in the three hours prior to fog onset the fog type is identified as cloud base lowering fog cbl eleven fog events 7 have been classed as cbl fog cloud heights were obtained from airport ceilometer observations there was a total of 161 fog events in this 18 year period with one event labelled as other this event was unique in that both the temperature and humidity increased during the night prior to fog formation which occurred before sunrise with little wind and clouds analysis of the synoptic situation revealed a trough along the west coast of wa that moved inland through the night 3 2 classification of weather regimes to classify the fog events according to weather regimes a k means clustering algorithm macqueen 1967 has been applied to observations of the 2300 utc radiosondes at perth airport from 2002 to 2019 the k means algorithm aims to divide a set of observations into a number of classes in an iterative process such that the variance within each class is minimized the k means clustering method has been used with success in other applications of weather regime clustering in australia pope et al 2009 used wind and thermodynamic data from 2300 utc radiosondes at darwin to classify weather regimes of the north australian wet season wilson et al 2013 used a similar technique with radiosonde data from brisbane airport to study the relationship between rainfall and weather regimes in south eastern queensland for the classification of weather regimes pertaining to fog at perth airport observations of mean sea level pressure mslp together with the temperature dewpoint temperature zonal and meridional wind components on the 925 hpa and 850 hpa pressure levels from the perth airport radiosondes at 2300 utc throughout the year were used these variables were picked to represent the synoptic conditions at the airport near the time that fog usually occurs earlier classification attempts with data from just the 925 hpa pressure level and mslp yielded similar results but the 850 hpa level was included to better encapsulate the depth of the moisture layer a variety of other variable combinations were also attempted but it did not improve on the classification the k means clustering of the mslp and radiosonde observations at the 925 hpa and 850 hpa pressure levels were selected as a simple method focussing on the environmental flow and moisture at the airport which might affect fog formation five classes were selected because that provided a relative high frequency of fog events more than 6 in a single class while also giving sensible groupings in the seasonality and environmental flow of the classes hope et al 2006 used a self organising map to classify mslp data from ncep ncar reanalysis kalnay et al 1996 into 20 synoptic types describing the winter circulation in south west western australia swwa the goal of their classification was to investigate how long term shifts in the synoptic patterns influence shifts in rainfall in the region they found that the frequency of troughs associated with wet weather over swwa has decreased since 1975 while the dryer synoptic types with a high pressure system over australia have increased it is not clear how or even if these trends relate to the fog at perth airport conceptually a higher frequency of synoptic systems leading to dryer conditions over the region might lead to a reduction of fog but the absence of both precipitation and stronger winds might be conducive to increased radiation fog if there is sufficient moisture there is no clear long term trend evident in the annual fog events at the airport even looking at the longer time series of manual observations of fog since 1988 it is likely that the local effects and dynamics have a stronger contribution to fog formation than the large scale synoptic situation pook et al 2012 developed a synoptic climatology of cool season rainfall for the central wheatbelt in swwa to the east of the escarpment they used the mslp 500 hpa geopotential height and the 1000 500 hpa atmospheric thickness and anomaly derived from ncep ncar reanalysis data kalnay et al 1996 together with daily mslp and frontal analysis charts produced routinely by the australian bureau of meteorology to classify four broad synoptic categories cold frontal systems cold cored cut off lows warm cored lows associated with thermal ridges and a catch all fourth category for the remaining systems they found that half of the rainfall in the central wheatbelt can be attributed to frontal systems and about a third to cut off lows due to the distance from the coast onshore airstreams were not found to be major contributors to rainfall in the system pook et al 2012 however since perth airport is located on the coastal plain to the west of the escarpment it is expected that onshore airstreams will play a significant role in the moisture availability there and the possible development of fog 4 results and discussion 4 1 fog climatology at perth airport perth airport gets an average of 8 9 with a standard deviation of 3 0 fog events per year the duration of a fog event was calculated as the total time period of visibility reported below 1 km in the absence of co incident precipitation since 0600 utc 1400 lst the average duration of fog events for this period was 2 h most fog events 96 occur during the cool season which we define as april to october inclusive while there were only 7 events a yearly average of 0 4 0 6 during the warm season november to march in the 18 year period the average monthly distribution of fog events and associated type is shown in fig 3 the hourly frequency of visibility less than 1 km at perth airport is calculated using 10 minute observations from the perth airport aws for the 18 year period from 2002 to 2019 inclusive fig 4 low visibility associated with fog is most frequent in the morning hours in the cool season apr oct with the highest frequency a few hours before sunrise no fog has been reported in the late morning and early afternoon 4 2 dynamics while the wind at 925 hpa is often southerly to westerly at 2300 utc 0700 wst on fog days the 10 m winds at 2300 utc for more than half of the events are light north easterly supporting the concept that fog often forms when nocturnal cooling on the coastal plain leads to increased stability in the near surface layer and a decoupling between the environmental south westerlies and the surface flow at perth airport fig 5 this allows the development of local circulations forced by the local topography shear induced turbulent mixing and differential advection with moisture trapped in the surface layer and drying above the inversion can then increase the probability of fog developing note there are a number of fog days 24 of events where the 10 m wind at fog onset has a southerly component and a further 23 where the winds are calm 4 3 fog types wind roses for the 10 m winds at fog onset and 2300 utc at 925 hpa for the different fog types are given in fig 6 for radiation fog events the winds at 10 m were mainly northerly to north westerly whereas the 925 hpa winds were predominantly southerly to south westerly the advection fog events had the highest frequency of north westerly winds at the 925 hpa level while the 10 m winds were largely split between north to north easterly 75 and southerly 20 there were only 11 events classified as cloud based lowering fog and the 10 m winds all had northerly or easterly components while the majority of 925 hpa winds were divided between westerly and south westerly with both directions having more than 25 each 4 4 weather regimes using the k means clustering five weather regimes were identified with two occurring mainly in the warm season and three with peaks in the cool season fig 7 the relationship between the fog type and regime class is shown in table 1 note that the total number of fog events only adds up to 156 as opposed to 161 in the classification of fog type this is due to missing upper air observations resulting in 4 events not being classified in the regime clustering these events were also omitted from the fog types in the following discussion class 1 is predominantly a warm season class the 10 m winds at 2300 utc are largely ranging between easterly and southerly with easterly 925 hpa winds this pattern is often associated with a trough well inland over wa south australia fig 8 the fog events in this class have a peak in april with the 10 m winds at 2300 utc mainly divided between southerly or north easterly on fog days although the 925 hpa winds were mainly from the east for this class overall the majority of fog days had south westerly winds at 925 hpa and there were no fog events with east to north easterly winds at that pressure level class 2 occurs mainly in the cool season and although there were only a moderate number of fog events in this class they all occurred in the cool season with a peak in september the 925 hpa winds at 2300 utc are largely east to northeast for this class but for fog events they were again more southwest for fog events the 10 m wind is mostly from the northeast indicating a decoupling between the surface and environmental flow on fog days the majority of fog events in this class were identified as radiation fog the synoptic pattern often has a high pressure ridge extending along the south coast of western australia fig 9 class 3 has its peak in the cool season with 29 fog events in this class and a fairly even spread of fog types table 1 the 925 hpa winds at 2300 utc have a west to north westerly component for both the class overall and the subset of fog days while the 10 m winds are mainly north easterly this is the only class where the 925 hpa winds on fog days were confined more to the east with no winds in the south westerly to southerly range an example of the typical synoptic pattern for this class is given in fig 10 class 4 is a predominant warm season pattern with only six fog events occurring in the shoulder periods the 10 m winds at 2300 utc are generally east north easterly while the 925 hpa winds are more north to northeast the associated synoptic pattern results in generally dry northerly to north easterly winds over swwa fog events in this class were all associated with a trough down the west coast of wa with the axis a little inland when the fog occurs fig 11 more than half of the total fog events fall into class 5 with the 925 hpa winds at 2300 utc mainly south west to southerly there is a strong contingent of north easterly winds near the surface on fog event days while the 925 hpa winds are more south west to southerly pointing to the decoupling between the surface and environmental flow however there are a number of fog days where the 10 m wind at 2300 utc have a southerly component mainly following the passage of a trough the surface wind shifts to south to south easterly as a ridge develops to the south the typical synoptic pattern for this class indicates the passage of a frontal system trough over swwa with a high pressure system situated to the west of wa bringing moist air from the indian ocean fig 12 5 discussion and conclusions meteorological observations at perth airport for the 18 year period from 2002 to 2019 inclusive were used to describe the climatology of fog at the airport a fog day was classified as a day starting from 0600 utc 1400 lst where the average 10 minute visibility was less than 1 km for at least 30 min during the day and co incident precipitation was 0 2 mm or less perth airport gets 8 9 3 0 fog events per year with the vast majority occurring in the cool season from april to october inclusive fog can occur under a variety of synoptic situations such as post frontal conditions cut off lows and developing high pressure ridges often with preceding precipitation preconditioning the environment fog events virtually never occur when there are strong surface winds with only a single case of fog with a 10 m wind reaching 5 m s even the winds at 925 hpa are typically not that intense with the winds at that level never reaching 20 m s at 2300 utc on fog days fog is not common at perth airport during the warm season nov mar but when it does occur it is usually associated with the passage of a trough line from the west that brings a cooler airmass across the coast with an increase in the relative humidity the fog events were ordered into different fog types following a hierarchical classification method similar to tardif rasmussen 2007 radiation fog was found to be the most prevalent in this region the six longest duration fog events all had precipitation in the 6 h prior to fog onset a k means clustering method was applied to 2300 utc 0700 lst observations at perth airport of the 925 hpa and 850 hpa temperature dewpoint temperature meridional and zonal winds as well as mean sea level pressure to divide the dataset into 5 different weather regimes the majority of fog events occurred in class 5 which is a post frontal trough system with a high pressure system to the west of wa bringing in moisture from the indian ocean the 10 m winds were often northerly to north easterly at fog onset time the leading hypotheses are that the north easterly winds can be a result of airmass blocking by the escarpment similar to the dynamics over adelaide tepper watson 1990 nocturnal katabatic drainage flows as suggested by golding 1993 or a combination of the two mechanisms considering the limited time availability of upper air observations 2300 utc 0700 lst is taken to represent the environment near the time of the fog a wind rose of the 10 m winds at the time of fog onset at perth airport fig 5 indicates that the winds tends to be more northerly at fog onset supporting the theory that airmass blocking is probably the main reason for the near surface flow when fog forms since the orientation of the escarpment to the east would result in a more easterly winds if it were katabatic however neither hypothesis can be confirmed without studying the dynamics thoroughly though not in scope for the current paper this will be investigated further with modelling studies which include back trajectories a better understanding of the dynamics involved of the fog formation at perth airport will assist forecasters to make better decisions it will also be useful to examine how well the numerical weather prediction models are able to simulate these dynamic processes to increase the confidence in using the model guidance credit authorship contribution statement belinda roux conceptualization formal analysis writing original draft writing review editing visualization rodney potts conceptualization investigation writing review editing supervision steven siems conceptualization writing review editing supervision michael manton conceptualization writing review editing supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the authors would like to thank dr chris lucas and the two anonymous reviewers for their valuable input observations were obtained from the australian bureau of meteorology this research was undertaken with the assistance of resources and services from the national computational infrastructure nci which is supported by the australian government the authors would also like to thank the aviation weather services at the bureau of meteorology for covering the publication costs of the article 
4388,a comprehensive climatology of fog events at perth airport was developed with the aim of improving the forecasting of fog through an enhanced understanding of its nature from 2002 to 2019 inclusive the airport experienced 8 9 3 0 fog events per year with 96 of all events occurring in the cool season from april to october inclusive the fog events were ordered into different fog types following a hierarchical classification method radiation fog were found to be the most prevalent in this region a k means clustering method was applied to 2300 utc 0700 lst observations at perth airport to divide the dataset into 5 different weather regimes the majority of fog events occurred in a post frontal trough system with a high pressure system to the west bringing in moisture from the indian ocean perth airport is located on a coastal plain with an escarpment 10 km to the east of the airport roughly parallel to the coast and rising to about 300 m in the 2002 2019 cool season period 41 of fog events had northerly to easterly 10 m winds at 2300 utc 0700 lst while the 925 hpa winds were southerly to westerly this compares with 15 of days with north to east winds at 10 m across all cool season days in the same period these results support the current theory that fog often forms when nocturnal cooling on the coastal plain leads to increased stability in the near surface layer and a decoupling between the moist environmental westerlies and the surface flow at perth airport this allows the development of local circulations forced by the local topography keywords fog climatology classification physical processes 1 introduction fog has a significant impact on the aviation industry with regards to both safety and economics and there is considerable interest in having accurate forecasts fog events that are not forecast can raise safety concerns if an aircraft is unable to land and has limited fuel reserves to reach a suitable alternate unscheduled diversions can cause considerable disruption to flight schedules across the network can take many hours to clear and inconvenience passengers the unnecessary carriage of additional fuel will result in increased fuel burn and a possible reduction in the payload of passengers and cargo with resulting economic impacts the fog forecasts for the perth airport are of particular interest as it is relatively remote with a large distance to suitable alternates for large aircraft an early study of a perth fog event golding 1993 noted the significance of the local terrain in the formation of fog he found that fog forms near a stagnation point between a cold drainage flow off the darling escarpment to the east 300 m elevation and moist onshore flow from the west he also remarked that the drainage flow is perturbed by the complexity of the orography which can lead to local variations in the development of fog across the area this work remains a major contributor towards our understanding of the local fog processes even though it was based on a single case of radiation fog golding s findings were supported in recent high resolution nwp case studies by roux 2017 where the combination of flow blocked by the darling escarpment and cold drainage flow from more localised valleys in the foothills of the escarpment were found to have a possible influence on fog at perth airport local blocked flow occurs when the moist westerlies are being blocked by the darling escarpment often resulting in light northerly wind near the surface at perth airport tepper watson 1990 gave a detailed description of a blocked flow over adelaide airport which has a similar landscape to perth airport in terms of ocean to the west a coastal plain and semi parallel mountain range orientation they found however that the north easterly surface flows across the adelaide plains on winter nights are a result of upstream airmass blocking of a stably stratified flow rather than katabatic winds as previously believed another fog case study barras and miao 2011 for perth airport was used in the formation of a single column model scm testbed for access the australian community climate and earth system simulator puri et al 2013 large scale forcing for the scm was derived from the regional numerical weather prediction model analysis to take the orographic influences into account they found that the scm simulated similar processes of fog formation as its parent three dimensional model making it useful as a tool to study the model parametrizations miao et al 2012 processed nwp output using fuzzy logic to account for model inaccuracy as well as uncertainties between fog predictors and occurrence the fuzzy fog guidance was found useful and is still used in the forecasting process but the guidance is only valid for a specific location while studies on fog at perth airport have been conducted over many years little has been published on the fog climatology explicitly based on the analysis of fog events observed over one year huang et al 1990 described four types of fog mechanisms observed in perth post frontal advection radiation and rain fog their classification metrics however have been found to be ambiguous and one year of fog events in perth is not enough for a robust climatology operationally rob taggart from the bureau of meteorology used metar meteorological aerodrome report data together with low level winds from the ecmwf reanalysis to produce a graphical climatology of fog across australia for forecasting guidance r taggart 2016 personal communication while this has proven to be an extremely useful and popular tool for local forecasters it does not distinguish between fog types other than the presence or absence of precipitation since 9am on the day and offers only limited insight into the mechanisms for the local fog formation gultepe et al 2007 gave an overview of the variety of research done in the past on fog throughout the world they stated that the main aims of a fog climatology are to better understand the nature of fog and to utilise this knowledge to improve the forecasting of fog which is in line with the purpose of this paper a detailed climatology provides an important basis to understand fog processes in a region and ultimately improve the forecasting of fog climatologies can be constructed utilising a number of observations and tools fog climatologies are often point based due to the local nature of fog and the availability of relatively long records of quality observations including visibility often being constrained to airports for example tardif and rasmussen 2007 used hourly observations from 1977 to 1996 of 17 stations around new york city in their fog climatology of the region using these observations they derived an objective algorithm to classify fog types their methods were adopted with some modifications to suit the local conditions by van schalkwyk and dyson 2013 in their study of the climatological characteristics of fog at cape town international airport in south africa using hourly surface observations from 1997 2010 belorid et al 2014 used a similar approach in their study of the distribution and long term trends in fog types over south korea using 3 hourly observations from 24 stations over 25 years the algorithm of tardif and rasmussen 2007 were also employed in a slightly simplified version to understand the characteristics of fog in japan using hourly surface observations of 60 stations over a 5 year period from 2004 2008 akimoto and kusaka 2015 a combination of observations and era 40 reanalysis data was used to create a climatology for fog to support forecasting at three airports in finland with varying climatological conditions hyvärinen et al 2007 in this study we employ observations from the 18 year period 2002 to 2019 inclusive to develop a comprehensive climatology of fog events at the perth airport this period is chosen because of the more consistent availability of both sub hourly and upper air observations the sub hourly observations are deemed important because fog in the region often does not last more than a couple of hours one hundred and sixty one fog events were identified in the 18 year period the local environment and observations are described in section 2 with the methodology on the classification of fog types and weather regimes presented in section 3 the results including the fog climatology are presented in section 4 with a discussion and conclusions in section 5 2 local environment and observations 2 1 local geography and synoptic meteorology perth airport is in south western western australia swwa on a coastal plain the indian ocean is about 20 km to the west and the darling escarpment about 10 km to the east of the airport rising sharply to around 350 m and running parallel to the coast fig 1 in the cooler months the weather at perth is largely influenced by the passage of frontal systems and troughs moving eastwards across the southern parts of the country hope et al 2006 wright 1974 wright 1974 found that the early season may to july rainfall is dominated by north westerly winds and continuous rains associated with a widespread uplift in the mid troposphere while late season august to october rains are more showery and related to airstream instability with west to south westerly winds in an analysis of the april to october rainfall over the period of 1965 2009 pook et al 2012 found that 58 of the rainfall at perth airport is as a result of frontal rain while 25 comes from cut off lows in general the 10 m winds at the airport are predominantly south westerly in the early evening 1900 lst which tends to north easterly by 0700 lst at speeds typically less than 2 5 m s 1 this north easterly surface flow is thought to result from a drainage flow off the escarpment in the warmer months nov mar the perth area is typically under the influence of warm to hot dry easterlies with south westerly sea breezes in the afternoon small dewpoint depressions are commonly used in forecasting fog for example the dewpoint depression is used to evaluate the available moisture in the fog forecast decision support system as described in boneh et al 2015 a significant challenge in forecasting fog at perth airport is the high incidence of nights with a small dewpoint depression without fog forming typically due to stronger wind speeds too much cloud or a combination of these in the 17 year period of 2002 2018 inclusive the perth airport automatic weather station aws recorded 967 days with a dewpoint depression of less than 0 6 degrees at 0600 lst with a visibility below 1 km on only 42 days 4 3 for comparison over the same period melbourne airport recorded a dewpoint depression below 0 6 degrees at 0600 lst on 440 days with a visibility below 1 km on 47 days 10 7 2 2 observations for the fog climatology at perth airport 10 minute observations are taken from the automatic weather station aws at the airport which includes a visibility meter and ceilometer for visibility and cloud observations the automatic visibility measurements were routinely available from late july 2001 so the period used for the climatology is 2002 2019 inclusive a fog event day is defined as fog occurring in the 24 hour period from 0600 utc 1400 lst to account for the fact the fog has always been observed overnight and in the early morning hours a day is considered a fog day if the average 10 minute visibility was below 1 km for at least 30 min throughout the day and any coincident precipitation was 0 2 mm or less the lowest unit recorded by the tipping bucket rain gauge used for the automated observations of precipitation at perth airport is 0 2 mm this can occasionally be triggered by the formation of dew on the instrument especially during cool nights in a stable atmosphere when favourable conditions for fog may be present based on these criteria 161 fog events were observed in the 18 year period the near surface observations from perth airport aws were used in conjunction with upper air observations from perth airport radiosondes at 1100 utc 1900 lst and 2300 utc 0700 lst to characterise the weather during the afternoon before the fog and in the morning around the time of the fog clearance 3 methodology 3 1 classification of fog types tardif rasmussen 2007 derived an objective algorithm to classify fog events into various types according to fog formation processes several other papers e g van schalkwyk dyson 2013 belorid et al 2014 akimoto kusaka 2015 presented a similar approach with some variations to the fog types and actual thresholds as deemed appropriate due to local differences in fog in line with this a simple hierarchical classification system fig 2 has been devised utilising the 10 min observational dataset to establish the types of fog that occur at perth airport the classification including relevant thresholds was guided by the early work of tardif and rasmussen 2007 and more recent studies by van schalkwyk and dyson 2013 belorid et al 2014 and akimoto and kusaka 2015 after careful consideration of the observations only the three main mechanisms of radiation advection and cloud base lowering were deemed appropriate for the classification of fog at perth airport tardif rasmussen 2007 included precipitation and morning evaporation fog types but investigations of observations at perth airport suggest that it would not be pertinent to have these additional types analysis of the rainfall prior to fog onset indicated that although precipitation is not the main mechanism for fog formation it can be important to precondition the environment more than 0 2 mm of precipitation in the six hours prior to fog formation was reported for 69 43 of the events though the six hour accumulation was never more than 9 mm the six longest duration fog events all had some precipitation in the six hours prior to fog onset it must also be acknowledged the thresholds applied in the classification are somewhat subjective as evidenced by the variations across the previous studies the thresholds presented in fig 2 are considered reasonable for perth airport and indeed for most airports across australia radiation fog the main criterion for radiation fog rad is a cloud coverage of less than 2 octas average wind speed in the hour before fog onset less than 2 5 m s and cooling in the 6 h prior to the fog calculated by the difference between the temperature 6 h prior to the fog onset and the temperature at fog onset the fog type is also classed as a radiation fog if the cloud coverage is 2 octas or more but the cloud base is lifting and there is cooling in the 6 h prior to the onset radiation fog was by far the most prevalent fog type at perth airport with 98 events 61 classified as this type fog with advection a fog event is classified as advection fog adv if the average 10 min wind speed at fog onset is at least 2 5 m s note that in this instance advection fog simply means fog where advection was the major contributor the distinction has not been made whether the fog was advected over the airport from elsewhere or the more traditional advection fog fog forming when relatively warm moist air moves over colder surfaces fifty one events 32 were typed as advection fog cloud base lowering fog if the cloud cover at fog onset is 2 octas or more and the cloud base was less than 1000 m and has been lowering in the three hours prior to fog onset the fog type is identified as cloud base lowering fog cbl eleven fog events 7 have been classed as cbl fog cloud heights were obtained from airport ceilometer observations there was a total of 161 fog events in this 18 year period with one event labelled as other this event was unique in that both the temperature and humidity increased during the night prior to fog formation which occurred before sunrise with little wind and clouds analysis of the synoptic situation revealed a trough along the west coast of wa that moved inland through the night 3 2 classification of weather regimes to classify the fog events according to weather regimes a k means clustering algorithm macqueen 1967 has been applied to observations of the 2300 utc radiosondes at perth airport from 2002 to 2019 the k means algorithm aims to divide a set of observations into a number of classes in an iterative process such that the variance within each class is minimized the k means clustering method has been used with success in other applications of weather regime clustering in australia pope et al 2009 used wind and thermodynamic data from 2300 utc radiosondes at darwin to classify weather regimes of the north australian wet season wilson et al 2013 used a similar technique with radiosonde data from brisbane airport to study the relationship between rainfall and weather regimes in south eastern queensland for the classification of weather regimes pertaining to fog at perth airport observations of mean sea level pressure mslp together with the temperature dewpoint temperature zonal and meridional wind components on the 925 hpa and 850 hpa pressure levels from the perth airport radiosondes at 2300 utc throughout the year were used these variables were picked to represent the synoptic conditions at the airport near the time that fog usually occurs earlier classification attempts with data from just the 925 hpa pressure level and mslp yielded similar results but the 850 hpa level was included to better encapsulate the depth of the moisture layer a variety of other variable combinations were also attempted but it did not improve on the classification the k means clustering of the mslp and radiosonde observations at the 925 hpa and 850 hpa pressure levels were selected as a simple method focussing on the environmental flow and moisture at the airport which might affect fog formation five classes were selected because that provided a relative high frequency of fog events more than 6 in a single class while also giving sensible groupings in the seasonality and environmental flow of the classes hope et al 2006 used a self organising map to classify mslp data from ncep ncar reanalysis kalnay et al 1996 into 20 synoptic types describing the winter circulation in south west western australia swwa the goal of their classification was to investigate how long term shifts in the synoptic patterns influence shifts in rainfall in the region they found that the frequency of troughs associated with wet weather over swwa has decreased since 1975 while the dryer synoptic types with a high pressure system over australia have increased it is not clear how or even if these trends relate to the fog at perth airport conceptually a higher frequency of synoptic systems leading to dryer conditions over the region might lead to a reduction of fog but the absence of both precipitation and stronger winds might be conducive to increased radiation fog if there is sufficient moisture there is no clear long term trend evident in the annual fog events at the airport even looking at the longer time series of manual observations of fog since 1988 it is likely that the local effects and dynamics have a stronger contribution to fog formation than the large scale synoptic situation pook et al 2012 developed a synoptic climatology of cool season rainfall for the central wheatbelt in swwa to the east of the escarpment they used the mslp 500 hpa geopotential height and the 1000 500 hpa atmospheric thickness and anomaly derived from ncep ncar reanalysis data kalnay et al 1996 together with daily mslp and frontal analysis charts produced routinely by the australian bureau of meteorology to classify four broad synoptic categories cold frontal systems cold cored cut off lows warm cored lows associated with thermal ridges and a catch all fourth category for the remaining systems they found that half of the rainfall in the central wheatbelt can be attributed to frontal systems and about a third to cut off lows due to the distance from the coast onshore airstreams were not found to be major contributors to rainfall in the system pook et al 2012 however since perth airport is located on the coastal plain to the west of the escarpment it is expected that onshore airstreams will play a significant role in the moisture availability there and the possible development of fog 4 results and discussion 4 1 fog climatology at perth airport perth airport gets an average of 8 9 with a standard deviation of 3 0 fog events per year the duration of a fog event was calculated as the total time period of visibility reported below 1 km in the absence of co incident precipitation since 0600 utc 1400 lst the average duration of fog events for this period was 2 h most fog events 96 occur during the cool season which we define as april to october inclusive while there were only 7 events a yearly average of 0 4 0 6 during the warm season november to march in the 18 year period the average monthly distribution of fog events and associated type is shown in fig 3 the hourly frequency of visibility less than 1 km at perth airport is calculated using 10 minute observations from the perth airport aws for the 18 year period from 2002 to 2019 inclusive fig 4 low visibility associated with fog is most frequent in the morning hours in the cool season apr oct with the highest frequency a few hours before sunrise no fog has been reported in the late morning and early afternoon 4 2 dynamics while the wind at 925 hpa is often southerly to westerly at 2300 utc 0700 wst on fog days the 10 m winds at 2300 utc for more than half of the events are light north easterly supporting the concept that fog often forms when nocturnal cooling on the coastal plain leads to increased stability in the near surface layer and a decoupling between the environmental south westerlies and the surface flow at perth airport fig 5 this allows the development of local circulations forced by the local topography shear induced turbulent mixing and differential advection with moisture trapped in the surface layer and drying above the inversion can then increase the probability of fog developing note there are a number of fog days 24 of events where the 10 m wind at fog onset has a southerly component and a further 23 where the winds are calm 4 3 fog types wind roses for the 10 m winds at fog onset and 2300 utc at 925 hpa for the different fog types are given in fig 6 for radiation fog events the winds at 10 m were mainly northerly to north westerly whereas the 925 hpa winds were predominantly southerly to south westerly the advection fog events had the highest frequency of north westerly winds at the 925 hpa level while the 10 m winds were largely split between north to north easterly 75 and southerly 20 there were only 11 events classified as cloud based lowering fog and the 10 m winds all had northerly or easterly components while the majority of 925 hpa winds were divided between westerly and south westerly with both directions having more than 25 each 4 4 weather regimes using the k means clustering five weather regimes were identified with two occurring mainly in the warm season and three with peaks in the cool season fig 7 the relationship between the fog type and regime class is shown in table 1 note that the total number of fog events only adds up to 156 as opposed to 161 in the classification of fog type this is due to missing upper air observations resulting in 4 events not being classified in the regime clustering these events were also omitted from the fog types in the following discussion class 1 is predominantly a warm season class the 10 m winds at 2300 utc are largely ranging between easterly and southerly with easterly 925 hpa winds this pattern is often associated with a trough well inland over wa south australia fig 8 the fog events in this class have a peak in april with the 10 m winds at 2300 utc mainly divided between southerly or north easterly on fog days although the 925 hpa winds were mainly from the east for this class overall the majority of fog days had south westerly winds at 925 hpa and there were no fog events with east to north easterly winds at that pressure level class 2 occurs mainly in the cool season and although there were only a moderate number of fog events in this class they all occurred in the cool season with a peak in september the 925 hpa winds at 2300 utc are largely east to northeast for this class but for fog events they were again more southwest for fog events the 10 m wind is mostly from the northeast indicating a decoupling between the surface and environmental flow on fog days the majority of fog events in this class were identified as radiation fog the synoptic pattern often has a high pressure ridge extending along the south coast of western australia fig 9 class 3 has its peak in the cool season with 29 fog events in this class and a fairly even spread of fog types table 1 the 925 hpa winds at 2300 utc have a west to north westerly component for both the class overall and the subset of fog days while the 10 m winds are mainly north easterly this is the only class where the 925 hpa winds on fog days were confined more to the east with no winds in the south westerly to southerly range an example of the typical synoptic pattern for this class is given in fig 10 class 4 is a predominant warm season pattern with only six fog events occurring in the shoulder periods the 10 m winds at 2300 utc are generally east north easterly while the 925 hpa winds are more north to northeast the associated synoptic pattern results in generally dry northerly to north easterly winds over swwa fog events in this class were all associated with a trough down the west coast of wa with the axis a little inland when the fog occurs fig 11 more than half of the total fog events fall into class 5 with the 925 hpa winds at 2300 utc mainly south west to southerly there is a strong contingent of north easterly winds near the surface on fog event days while the 925 hpa winds are more south west to southerly pointing to the decoupling between the surface and environmental flow however there are a number of fog days where the 10 m wind at 2300 utc have a southerly component mainly following the passage of a trough the surface wind shifts to south to south easterly as a ridge develops to the south the typical synoptic pattern for this class indicates the passage of a frontal system trough over swwa with a high pressure system situated to the west of wa bringing moist air from the indian ocean fig 12 5 discussion and conclusions meteorological observations at perth airport for the 18 year period from 2002 to 2019 inclusive were used to describe the climatology of fog at the airport a fog day was classified as a day starting from 0600 utc 1400 lst where the average 10 minute visibility was less than 1 km for at least 30 min during the day and co incident precipitation was 0 2 mm or less perth airport gets 8 9 3 0 fog events per year with the vast majority occurring in the cool season from april to october inclusive fog can occur under a variety of synoptic situations such as post frontal conditions cut off lows and developing high pressure ridges often with preceding precipitation preconditioning the environment fog events virtually never occur when there are strong surface winds with only a single case of fog with a 10 m wind reaching 5 m s even the winds at 925 hpa are typically not that intense with the winds at that level never reaching 20 m s at 2300 utc on fog days fog is not common at perth airport during the warm season nov mar but when it does occur it is usually associated with the passage of a trough line from the west that brings a cooler airmass across the coast with an increase in the relative humidity the fog events were ordered into different fog types following a hierarchical classification method similar to tardif rasmussen 2007 radiation fog was found to be the most prevalent in this region the six longest duration fog events all had precipitation in the 6 h prior to fog onset a k means clustering method was applied to 2300 utc 0700 lst observations at perth airport of the 925 hpa and 850 hpa temperature dewpoint temperature meridional and zonal winds as well as mean sea level pressure to divide the dataset into 5 different weather regimes the majority of fog events occurred in class 5 which is a post frontal trough system with a high pressure system to the west of wa bringing in moisture from the indian ocean the 10 m winds were often northerly to north easterly at fog onset time the leading hypotheses are that the north easterly winds can be a result of airmass blocking by the escarpment similar to the dynamics over adelaide tepper watson 1990 nocturnal katabatic drainage flows as suggested by golding 1993 or a combination of the two mechanisms considering the limited time availability of upper air observations 2300 utc 0700 lst is taken to represent the environment near the time of the fog a wind rose of the 10 m winds at the time of fog onset at perth airport fig 5 indicates that the winds tends to be more northerly at fog onset supporting the theory that airmass blocking is probably the main reason for the near surface flow when fog forms since the orientation of the escarpment to the east would result in a more easterly winds if it were katabatic however neither hypothesis can be confirmed without studying the dynamics thoroughly though not in scope for the current paper this will be investigated further with modelling studies which include back trajectories a better understanding of the dynamics involved of the fog formation at perth airport will assist forecasters to make better decisions it will also be useful to examine how well the numerical weather prediction models are able to simulate these dynamic processes to increase the confidence in using the model guidance credit authorship contribution statement belinda roux conceptualization formal analysis writing original draft writing review editing visualization rodney potts conceptualization investigation writing review editing supervision steven siems conceptualization writing review editing supervision michael manton conceptualization writing review editing supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the authors would like to thank dr chris lucas and the two anonymous reviewers for their valuable input observations were obtained from the australian bureau of meteorology this research was undertaken with the assistance of resources and services from the national computational infrastructure nci which is supported by the australian government the authors would also like to thank the aviation weather services at the bureau of meteorology for covering the publication costs of the article 
4389,development and use of global continental and country scale hydrological models has attracted an increasing attention over the last two decades though developed countries are a head in development and assessment of these models most developing countries if not all even do not have their own models therefore an appropriate model selection process is necessary for these regions to improve the skill in hydrological modelling and prediction at the local to global scales therefore a framework for model selection is provided to help hydrological modelers from various skills keeping the framework in view this paper reviews 70 representative models to provide a lucid pathway of selecting models at global continental and country scales over catchment scale models in the process strengths and weaknesses of models designed for each spatial extension are examined depending on their spatio temporal resolutions the model parameterization schemes for representing multiple hydrological processes and the number of parameters we summarize testing schemes to assess models to decide among multiple similar models finally we summarize the remaining challenges and discuss future research directions keywords hydrological model selection developing countries spatio temporal scales hydrological signatures testing scheme 1 introduction fresh water availability is getting stressed around the globe because of continuously increasing population and accelerated socio economic growth webb et al 2017 wang and yan 2017 in particular such stress has led to a wide range of impacts on regional and or global climate because of the changes in soil moisture and terrestrial evapotranspiration seneviratne et al 2010 dirmeyer 2011 for this reason the altered river discharge from contentinents to oceans results in changes in the sea levels milly et al 2010 besides land use changes in upstream affect the hydrology and water quality in the downstream freeman et al 2007 which leads to the notion of the global water system alcamo 2009 this system is further complicated by the interference from humans through water storage and withdrawals rost et al 2008 therefore it requires a thorough understanding of hydrological condition for efficient dealing with the stress via effective water resources management strategy while intensive observations pertaining to hydrological processes are pre requisite for achieving the goal they are often particularly scarce for varying eco climatic conditions which is especially true for the developing countries in the world in this context hydrological modelling becomes one of the powerful tools to develop required scenarios for sustainable management of water resources singh and frevert 2006 beven 2012 beven and young 2013 therefore a wide range of hydrological models are developed and used for broad range of environmental processes and spatio temporal scales beven and kirkby 1979 refsgaard and storm 1990 irannejad and henderson sellers 2007 tang et al 2006 zhang et al 2008 2016a 2016b 2020 zhang and chiew 2009 schoener 2010 de graaf et al 2014 bai et al 2020 paul et al 2020 nagdeve et al 2021 it is not surprised that the developed countries usually have their own hydrologic models however majority of developing countries have limited hydrologic modelling capabilities due primarily to the relatively poor ability in the model maintenance computational costs and technical capacity for model simulation fortunately developing countries has dedicated into the development of certain country scale models such as the satellite based hydrological model shm paul et al 2018 2019a therefore proper selection of a hydrological model from representative hydrological models developed for other areas could facilitate an improved skill in hydrological modelling which would be of help for decreasing vulnerabilities in water resources management in developing countries nevertheless every modeler has their own perception of natural conditions such as landscape variability and the components of hydrological cycle in this context the selection of an appropriate model should depend on the adequacy for the research questions including the study purpose the landscape of the region and the spatio temporal scales however previous studies focusing on hydrological model selection are often chosen according to the legacy practicality convenience experience and habit table 1 furthermore these studies only focus on a few models which are not able to represent comprehensive selection scenarios for global requirements having recognized above needs the aim of this paper is to represent a pathway of model selection for application in developing countries by comprehensively reviewing the representative hydrological models in the process a framework for model selection is provided to help hydrological modelers from various skills besides we keep in mind the perspective of global continental and country scale models over catchment scale models in the process strengths and weaknesses of each model are examined depending on their spatio temporal scales the way they represent the complex hydrological processes and the number of parameters we summarize a series of model testing schemes to determine the most suitable one from multiple similar models in case there is a dilemma in selection finally the remaining challenges are summarized and future research directions are discussed thus this paper may serve as a comprehensive tool for hydrologists all over the world to have quick and detailed information about 70 representative models prior to select an appropriate one 2 selection strategy of hydrological models for appropriate selection of hydrological model at first the purpose of the study should be very clear addor and melsen 2018 for example planning design and engineering operation for the control and use of water study of hydrological cycle interaction between organisms and the hydrological cycle presence and movement of groundwater adaptation of information technology to hydrology study of the transfer of water and energy snow melt analysis along with cryosphere modelling hydrologic processes that operate at or near earth s surface water storage in the form of reservoir and flood protection biosphere modelling and chemical characteristics of water in rivers and lakes both of pollutants and natural solutes if the purpose is clear then we should go for identifying the appropriate model depending on the representation of the processes fluxes and credibility for different climatic conditions and physiographic settings then we should focus on availability of model codes requirements of data and spatio temporal resolution of the model however we should have model credibility testing to identify the better model among a few similar ones to be precise if situation comes when we have every data and requirements of a few models and they also serve our objectives we need to select only one then we must go for a credibility testing of the models to determine the best one to use 2 1 representations of the hydrological processes and fluxes ideally a complete hydrological model would represent the following water balance components and fluxes total precipitation including both snow and rain interception storage evaporation throughfall transpiration snowmelt surface storage e g micro depressions lake and reservoir storage overland flow soil storage recharge to shallow aquifer capillary rise and intermediate flow trambauer et al 2013 it is to be noted that a more complex model may not necessarily lead to better results orth et al 2015 for example inclusion of the snow water ice dynamics may not be useful for drought predictions but incorporating the groundwater process does so however snow water ice dynamics is an integrated part for cryospheric modelling khadka et al 2020 because water stored as snow and ice is a critical contributor to the world s available freshwater supply and is essential to the sustenance of natural ecosystems agriculture and human societies amanambu et al 2020 to be precise it models the distribution of water mass due to movement of water between and within the atmosphere hydrosphere cryosphere and ocean dobslaw et al 2010 moreover climate ecology the cryosphere and hydrology are interconnected in cold regions chen et al 2014 in this region glacier is one of the primary climate indicators radić and hock 2011 the mass change of glaciers alters the hydrologic regime in these areas besides the long term changes include thawing permafrost and altered hydrology related to permafrost dynamics and changes in snow regime that lead to landscape drying and plant water stress callaghan et al 2011 therefore clear understanding of connections between the climate cryosphere and streamflow is necessary to make informed decisions regarding water resources mosier et al 2016 so it requires implementation of cryosphere hydrology models that are robust across geographic domains and climatic conditions woolway et al 2020 so cryosphere modelling becomes complex in comparison to usual hydrological modelling azmat et al 2016 due to relative balance of heat fluxes changes over time and locations energy balance i e physically based cryosphere models are theoretically more robust under altered climate and geographic settings kustas et al 1994 sicart et al 2008 huss et al 2009 on the other hand conceptual cryosphere models require fewer input data than energy balance models therefore these are often considered good enough to implement for data sparse regions e g hagg et al 2007 jung and chang 2011 lutz et al 2014 however several of the energy balance inputs are even more sparsely measured in certain areas like mountain environments than precipitation and temperature and often vary significantly over short spatio temporal scales for example wind speed linearly scales each convective heat flux i e sensible and latent and is therefore necessary for energy balance models the spatial distribution of wind speed is however difficult to characterize even if there are measurements of wind speed within the region marks et al 1992 marks and winstral 2001 therefore it allows consideration of whether including variables such as wind speed improves or reduces model performance in a given application moreover for model performance to be robust the means by which a model calculates output must be representative of the entire range of physical conditions being modeled both climatic regimes and geographies however there can be a compromise addition between model complexity and efficiency as per objective it is therefore important to consider the purpose of the modelling at first when choosing an appropriate model 2 2 availability of codes data requirements spatio temporal resolution and parameters the first criterion deals with the represented processes and fluxes of the models as discussed in previous sub section meanwhile we have to check the availability of codes of the appropriate models before advancing toward next steps kauffeldt et al 2016 because if a model is appropriate but with unavailable code then there is no point to go further with that model for obvious reason besides including all the possible processes does not necessarily lead to a better performance of the model if the necessary data are not available soil elevation land use and land cover rainfall temperature which may vary model to model in fact this may result in a worse performance when comparing with a simpler model orth et al 2015 for example a detailed representation of groundwater flows and tables would be very relevant for applications all over the world however the lack of information on the hydrogeology and groundwater tables in any region makes this detail representation pointless thus a simpler representation may be preferred similar concern is also true for models input since certain input data can be scarce in many regions of the globe brocca et al 2020 for above reasons it is suggested that there should be a trade off between the data availability and process representation jehn et al 2019 it should be worthwhile to highlight that the spatial resolution of most of the input data for current hydrological models are typically coarse reinecke et al 2020 however grid cell resolution is dependent on computation time simulation cost and machine capability paul et al 2018 while downscaling the input to finer scales to run the model with finer grid size may lead to extra effort they may still not yield a better performance sen and tarboton 2016 at this point the users should choose a suitable grid cell size for model simulation maintaining the trade off with computation time simulation cost and machine capability the same may be the case with the temporal resolution some models may have an hourly temporal resolution but if the required input meteorological data is available only at a daily resolution then the use of the finer temporal resolution may only take extra computation time without leading to meaningful usable results therefore user should pay focus on this point as well moreover user should consider parameters in number into account in the process also because a model consists of various parameters that define the watershed characteristics and hydrological processes devia et al 2015 the lower the number of parameters will be the easier the model will be to calibrate as the process will be less complex 2 3 model credibility keeping linkage with the previous two criteria the processes and spatio temporal resolution that are the most meaningful for simulating the objective wise conditions in respective climatic and physiographic situations must be regarded in spite of considering these criteria we can have two or more models in hand simultaneously which are appropriate for application however we need only one for a particular case in this context it is necessary to test all of them first for selecting a better one thus the testing results may ensure successful selection of a model from a few pre selected similar models meanwhile thorough testing is essential for different physiographic and climatic conditions to understand the detailed credibility of any model klemeš 1986 therefore at the time of development every developer should perform a credibility testing of the model to establish the developed model for a proper future usage in short we summarize a framework flowchart for optimum model selection fig 1 this may help the modeler to select model wisely 3 assessment of representative hydrological models for selection global continental and country scale models have been applied over varying spatio temporal scales it is therefore reliable to use one of these models as per objective and related signatures in developing countries however we can select other models also if their previous applications do match the spatio temporal scale of the selected study area nevertheless the availability of data and code number of parameters and spatio temporal scale will be the final criteria to select the model therefore we need to at first go through a robust classification scheme 3 1 classification of hydrological models there are many hydrological models with unique and common characteristics that are being developed day by day wang et al 1996 danish hydraulic institute dhi 2004 in this case the unique and common characteristics of many models make classifications of hydrological models an important issue which would be vital for an accurate identification of the capabilities and limitations of each model proper classification can be helpful for engineers experts and researchers to understand the characteristics of models before deciding to use them for their purposes however the categorizations of hydrological models can be hammered by considerable overlapping characteristics among various classes of models ma and gourbesville 2020 as a result even the classification of hydrological models may vary depending on justification wheater et al 1993 singh 1995 singh and frevert 2006 thus classification of hydrological models highly effects the selection of the appropriate one in this circumstance the classification scheme inspired by wheater et al 1993 is presented in fig 2 following the space scale based classification scheme shown in fig 2 70 representative hydrological models are classified for different spatial classes in stacked venn diagram fig 3 this comprehensive figure will help a hydrologic modeler as a catalogue to identify different hydrological models depending on spatial scale the models other than of country continental and global scales are usually applied at the catchment scale and have many parameters that need to be calibrated or estimated for a given region examples of such models include the soil and water assessment tool swat neitsch et al 2002 and the hydrologiska byråns vattenbalansavdelning hbv lindström et al 1997 however there is exception like gr4j model which has only four parameters to be used for catchment study although some of these models can in principle be applied at the country continental and global scales this happens rarely in practice due to severe information constraints however for distributed models fig 2 the number of parameters may be much more than those are usually listed the reason behind this is the consideration of spatial variation in the soil elevation data and the land use and land cover information the parameter values usually depend on these varied conditions the simple example is the value of scs cn which may be regarded as a single parameter however in practice we can see that it value varies over the area in different grid cells hydrological response unit hrus depending on the soil and the land use and land cover information however the nature of the parameter remains the same therefore we should consider these as a single entity therefore spatial discretization based classification must be considered during the selection of a model however spatially distributed parameters make the calibration process complex and time consuming in this circumstance fig 4 represents the spatial discretization based classification of the 70 representative models it can be seen that the development and use of global continental and country scale models have increased obviously in the past two decades fig 4 most of these models are semi distributed models in fact the development and use of distributed and semi distributed models have increased tremendously in comparison to the lumped ones fig 4 for semi distributed and distributed models the grid size selection is linked to the spatial scale at which the model will be applied for example for a continental scale model the grid cell resolution should be in the order of several to dozens of kilometres however for a river basin scale study the grid resolution could be in the order of a few hundred meters for coarser grid cells the processes that are only important at the local scale such as overland flow may not be fully considered in the model structure as a result some global models may not be easily downscaled to a river basin scale without making significant changes in the structure of the model in the same way it may not be possible to upscale a model that has been developed for a catchment scale to the continental or global scale however the selected model needs to be applied not only at country continental and global scales but also river basin scale without important modifications in its formulation among these models most of them are conceptual the number of physically based models and hybrid models are very low though the number of physically based cryosphere models is high actually physically based models can represent the detailed physical processes in a deterministic way by representations of mass momentum and energy conservation refsgaard 1996 singh and frevert 2006 however it is apparent that there are problems associated with the application of physically based models such as extensive data and computational requirements singh and woolhiser 2002 singh and frevert 2006 beven 2012 therefore future uses developments in hydrological modelling techniques face a dilemma this leads to the use of conceptual models which require comparably lesser data computational efforts and time singh and woolhiser 2002 singh and frevert 2006 this interpretation supports fig 4 although conceptual hydrological models are less data and time intensive global and country scale water resources planning and management requires relatively voluminous input information the collection and availability of spatially extensive data by using the traditional methods of data acquisition is a challenging task for a large territory therefore hybrid and metric models the latter were not shown in the present review may also be an option nevertheless we do not involve any empirical models because these models are region and or problem specific which are unable to meet the global requirements moreover these 70 representative models are capable of continuous simulation besides all models are deterministic except macro pdm which is stochastic in nature more importantly most of the global continental and country scale models are semi distributed only macro pdm lisflood crocus snowpack nsidc model sast oggm and glogem models are distributed whether hbv is lumped so it is to be noted that most of the global continental and country scale cryosphere models are of distributed structure also models are becoming more complex and resolute as more functionality is added to these besides finer global spatial datasets are becoming available in this manner issues of the sensitivity of models to varying spatial and temporal scales of input data have become prominent döll et al 2008 in addition calibration processes has also become more and more challenging because of the spatially distributed parameters to solve the problem different automatic calibration schemes are being used however clear knowledge of the auto calibration processes computational facility and cost do play a big role in the process however global continental and country scale models may provide valuable spatial and temporal estimates of worldwide water resources at least of considerable parts which is conducive to analyze the possible projections scenarios of changes of those estimates in addition these multi scale estimates of water resources obtained through the models may be an improvement over those data which are simply based on the statistical analysis of ground based observed data the latter remains limited and hence contains a lot of uncertainty at a large scale rodda 1995 3 2 summary of the signatures of selected hydrological models the complexities of the models vary based on the objectives structural issues such as the number of soil layers the number of land use classifications irrigation water applications and reservoir storage are dealt differently in different models sood and smakhtin 2015 the structural differences are also related to inclusion of vegetation growth models different types of bucket model such as leaky bucket non leaky bucket snow water ice dynamics i e water phases liquid treatment physical equations snow density layering and permafrost glacier treatment calibration process and number of parameters sood and smakhtin 2015 therefore their technical features such as simulation capability of reservoirs snow dynamics irrigation crop vegetation setup groundwater have been summarized in fig 5 and more details are provided in table s1 in the supplementary document with the information of technical features a user will be able to select a model he she wants to use however it needs to be noted that the tank model does not pass any requirements for the selection therefore it becomes an easy choice to avoid at the time of model selection along with these regular features a few unique features water phases liquid treatment physical equations snow density layering and permafrost glacier treatment of ten selected cryosphere models are summarized in table 2 in this circumstance details of code availability are summarized in table 3 it is evident that only 30 models have open source codes among the 70 selected models besides gwava g2g marius lisflood only provide the executable programs meanwhile matsiro and swim codes are available upon request on the other hand pcr globwb code is under preparation for being available among the models with available codes variable infiltration capacity vic and swat models have not only their codes available for the user but also with good documentation and discussion forum of users thus the number of users of vic and swat has been greatly increasing over last few years in comparison to other models which is especially evident in developing countries wi et al 2017 however use of hec hms and mike she is much limited this is because the user needs to purchase the codes in addition most of country scale models codes are not freely available which is a major restriction in the way of their usage due to unavailability of codes 31 models table 3 are comparably limitedly used 3 3 comparison of spatio temporal scales and the number of parameters generally distributed hydrologic models comprise of large number of unknown parameters and model s efficacy in simulating the hydrological processes depends heavily on the accurate estimation of these parameters through calibration krishna and sudheer 2020 the parameters in any distributed hydrological models exist at different spatial scales in fact some parameters are at watershed level while some are at sub basin level or at hru level her et al 2015 on the other hand when we consider them we only identify them as a single parameter because depending on spatial heterogeneity the values of that particular parameter changes not the nature of the parameter ideally all of them are to be calibrated but it increases the complexity of the optimization during calibration her et al 2015 krishna and sudheer 2020 therefore a generic procedure is to uniformly perturb the parameters across the watershed at different spatial scales from their default values to maintain the spatial heterogeneity her et al 2015 so we should be careful at the time of calibration of those parameters in this condition we compare the number of parameters and temporal scales of global continental and country scale models comparison of all global scale models against the number of parameters and temporal scales clearly helps in decision making on their usage fig 6 in particular all models simulate at a daily scale except for h08 h07 and oggm models which simulate at 3 h and monthly scale respectively on the other hand their parameter numbers vary from 3 mpi hm and oggm to 42 noah mp depending on the information users may choose the optimum models for application thus the analysis proves to be truth for the increased use of swat and vic models comparison of all country scale models against the number of parameters and temporal scales shows that all models simulate in the daily scale except for g2g marius 0 25 h 15 min nwm 6 h jules 1 h and sntherm 0 01 h 900 s fig 7 on the other hand their numbers of parameters vary from 5 g2g marius and nwm to 35 crocus fig 7 depending on the information user may select the optimum models for application in this case however the compatibility of the database and available data over the countries may play an important role in the model selection the comparison of all continental scale models other than the global and country scale models in figs 6 and 7 are performed in fig 8 against the number of parameters and temporal scale the figure depicts that all the models simulate in the daily scale on the other hand their numbers of parameters vary from 4 wbmplus to 80 swim depending on the information user may choose optimum models for application we further compare the spatial scales of all global continental and country scale models in table 4 it shows that global scale models simulate in coarser resolutions than the country scale models though the cryosphere models namely oggm and glogem are the exceptions in comparison to their country and continental scale counter parts however the database compatibility in different regions may be an issue to use a country scale model over a global scale model for regional studies moreover the explosion of global data availability from satellites in the last two decades has an influence on the development of global hydrological model tang et al 2009 although some global models are applied at different range of scales they have been developed for global scale studies beck et al 2016 meanwhile they would not be the preferred choice in basin scale applications due to their coarser resolution and poor local applicability 3 4 testing of hydrological models any model should be tested against observations to check its applicability capacity and capability in different spatio temporal scales klemeš 1986 it may help in selecting the best model for a specific purpose from multiple eligible models with increasing number of newly developed models several contradictions have emerged regarding the various claims of model applicability and lack of documentation for these claims for example a developer or an institute always tries to highlight their model and represent it as the best therefore their credibility is often questionable for valid reasons generalized terminology regarding credibility is given by schlesinger et al 1979 the credibility of a site specific model is the capability to make predictions about reality and the model must be evaluated against independent data refsgaard and henriksen 2004 testing of model is synonymous with model verification verification is an assertion or establishment of truth i e verify a model means to demonstrate its truth oreskes et al 1994 the model is proved to be validated if its accuracy and predictive capability in the validation period have been shown to lie within acceptable limits refsgaard 1997 hence generalized validation methodologies which are widely accepted in hydrology have been extensively studied klemeš 1986 andréassian et al 2009 krause et al 2005 schaefli and gupta 2007 gupta et al 2009 along with that important guidelines for the validation process are given by strengths weaknesses opportunities and threats swot analysis hill and westbrook 1997 a tool for strategic planning that can be used to evaluate these four aspects associated with a model and its application however klemeš 1986 represented a scheme for the credibility of any model over different spatial and temporal conditions i e for stationary and transient conditions depending on these studies and inspired by the testing scheme of klemeš 1986 credibility testing of the multiple global continental and country scale hydrological models is summarized in fig 9 the previous studies using hierarchical operational testing and comparison of a model with other well established models have been summarized in tables 5 and 6 respectively to represent the validity of the summarized classification scheme the two tables also show the path on how to identify a single model from multiple similar models besides it is clear that there are very rear applications of all the steps of hierarchical operational testing altogether in theory it is highly important to apply all the steps altogether but in practice most of the steps are separately applied in different studies since current hydrological model applications often consist of split sample test refsgaard and knudsen 1996 loague and freeze 1985 paul et al 2019a then only the real credibility of a model will be identified for data available condition consequently table 6 shows that in most of the cases swat is considered as the widely used model when comparing with other models mannschatz et al 2016 however there is no available study which has performed hierarchical operational testing and comparison with other established models for a complete model testing therefore application of this testing scheme may be helpful for selecting an appropriate hydrological model from multiple similar models 4 challenges and future research directions 4 1 challenges a comprehensive review of 70 representative hydrological models has been conducted in this study surrounding year of development objectives and different signatures along with spatial and temporal resolutions of the models to compare with each other to underpin a selection way out for developing countries keeping global continental country and catchment scale models in view it shows that there is a breadth of issues to consider when undertaking a model selection process no model is error free and is subject to update this is due to compromise in model structures to balance with computation capability and objective mcmillan et al 2011 nevertheless a newly updated developed model for a specific area can improve upon the previous models therefore if required and if possible it may be better to develop a new model for a new study in a particular country or region rather than selecting a model which has been developed for other places in that case balancing of complexities of model inputs model structure and the number of parameters is a challenge refsgaard and knudsen 1996 model selection is difficult due to unavailability of model input model structure complexity and complicated parameterization xie and lian 2013 moreover a complex model does not mean it could provide better results orth et al 2015 for this reason a simpler model is still preferable if the study purpose does not require detailed representation of the complex hydrological processes such as irrigation and groundwater dynamics however the data availability in particular format and resolution is of utmost importance and challenging to deal with it is challenging yet necessary to balance user skills for selecting a suitable model as there are different levels of hydrological modelers and their skills also vary from beginner to experienced model selection process gets biased the beginners first of all may not have sufficient knowledge to understand the capability of a model for a particular study on the other hand experienced modelers will have surely that idea besides the beginners may be interested in using graphical user interface based models meanwhile experienced modelers will focus on the modelling processes and parameterization thus a popularity index may help to solve the issue which is a challenging task for the researchers mannschatz et al 2016 all models are not available in a single platform with listed advantages disadvantages and other details moreover certain model manuals are also not available the manuals are written sometimes in local languages other than english therefore the best solution may be to organize all the models and related information in a single platform preferably web inventory which will facilitate the inter comparisons of global continental and country scale models before applying them for a specific purpose mannschatz et al 2016 this remains one of the major challenges in hydrological modelling it is challenging to identify optimum spatial resolution for a particular study identification of spatial resolution is a vital issue and remains one of the key research gaps in the current model selection studies a coarser resolution may provide acceptable results in the global scale but may be not adequate for studies at the regional scales as the latter typically requires a finer resolution it should be noted that however different spatial resolution would lead to different model simulation time computational capability and costs therefore identification of the optimum resolution always remains a great challenge 4 2 future research directions keeping the challenges in mind following future directions are discussed for helping hydrologists particularly those coming from developing countries to make choice of appropriate models the scientist from developing countries should think about projects for development of hydrological models for their own countries souffront alcantara et al 2019 it can have different versions as per different objectives they may need help from scientists who have developed hydrological models earlier in developed countries they can imply their own learning and capabilities also to develop a model with own technology a well prepared database platform for various input information is required to simulate hydrological models full of copious information spreading across various spatio temporal scale because detailed input information lead to meaningful model simulation depending on modelling objective and model characteristics however there are different techniques for hydrological simulation in data scarce conditions but a well prepared and comprehensive database platform containing different input information will make hydrological model selection and hence hydrological modelling easier as different model needs different spatio temporal input information devia et al 2015 the platform can be online so that user from various level and institute can access it easily therefore this will be a great field for future research and improving confidence on several models to be applied in developing countries model selection should be keeping balance with the thinking of both beginners and experienced researchers so that global hydrology gains the most therefore it should be taken seriously as a future research direction for example webinar and conferences can be organized to know each other s view as done by swat model developers regularly we may focus on developing a popularity index to compare the view of all sides numerically mannschatz et al 2016 preparation of a single web inventory for all hydrological models and their related detailed information should be taken as a future research direction very seriously mannschatz et al 2016 since it can be an easier way to find all models together before selection from a lot all scientists from all over the world should contribute in this platform to make it as easy to understand as possible it is interesting to test the transferability of lumped catchment model to gridded hydrological model meng et al 2018 lumped models are used for simple and focused modelling purpose liu et al 2021 however a lumped model may provide better results in complex scenario and suit a study area well if it is transferred to gridded structure meng et al 2018 therefore interchange of lumped models into gridded structure may be an option for future research in the process we may know the capability of model in different resolution and area testing of a model with different resolution is of utmost importance in future paul et al 2020 this test should be done from regional to global scale valentina et al 2020 most importantly this is a must for country scale model because every model has its own structure and performance may vary depending on different grid cell resolutions paul et al 2018 coarser grid cell resolution may ignore details in land use and land cover overland flow networks but finer grid cell resolution may increase model simulation time paul et al 2018 depending on the purpose of study model structure and model simulation time the final spatial resolution of model should be decided 5 concluding remarks this study scrutinize 70 representative hydrological models to explore the selection procedure keeping focus on global continental and country scale models in view here we discuss the advantages and limitations of the models to be used for different spatial extensions following a general framework of model selection we summarize model testing schemes to determine the most suitable one among multiple similar ones though testing finally the challenges and future research directions are summarized thus this paper may serve as a comprehensive inventory of representative models for hydrologists all over the world to have quick and detailed information however this study should be carried on further by considering other models and focusing on the discussed challenges and future perspectives 6 acronyms used in the paper parflow a parallel watershed flow model topmodel a topography based hydrological model artificial neural networks ann australian water balance model awbm biosphere energy transfer hydrology model bethy cascade two dimensional casc2d commonwealth scientific and industrial research organization csiro community land model clm danish hydraulic institute dhi distributed biosphere hydrological model dbhm distributed hydrological soil vegetation model dhsvm dynamic watershed simulation model dwsm european hydrological predictions for the environment e hype flash flood event based spatially distributed rainfall runoff transformation water balance fest wb glacier and snowmelt soil contribution gsm socont global glacier evolution model glogem global hydrological routing algorithm hydra global water availability assessment model gwava gravity recovery and climate experiment grace gridded surface subsurface hydrologic analysis gssha grid to grid g2g managing the risks impacts and uncertainties of drought and water scarcity marius model great britain groundwater and surface water flow gsflow hydrodynamic model hdtm 1 0 water balance model wbm plus water balance model water transport model wbm wtm hydrologic engineering centre hydrological modeling system hec hms hydrologic simulation model hysim hydrological simulation program fortran hspf hydrologiska byråns vattenavdelning hbv hydrology tiled ecmwf scheme of surface exchanges over land htessel identification of unit hydrographs and component flows from rainfall evaporation and stream ihacres interactions between soil biosphere and atmosphere total runoff integrating pathways isba trip lund postdam jena managed land model lpjml macro scale probability distributed moisture model macro pdm max planck institute hydrology model mpi hm mesoscale hydrologic model mhm mike systeme hydrologique europeen she minimal advanced treatments of surface interaction and runoff matsiro modèle du génie rural à 4 paramètres journalier gr4j modélisation couplée modcou moderate resolution imaging spectroradiometer modis national center for atmospheric research noah national snow and ice data center nsidc model national water model nwm national water resources model for denmark dk model nedbør afstrømnings model nam danish hydraulic institute dhi nam noah land surface model multi physics noah mp open global glacier model oggm parameter solution parasol pcraster global water balance model pcr globwb penman monteith p m penn state integrated hydrologic model pihm pennsylvania state university psu potsdam institute for climate impact research pik precipitation runoff modeling system prms precipitation runoff evapotranspiration hru model prevah processes of radiation mass and energy transfer promet river transfer hydrological model rithm sacramento sac model satellite based hydrological model shm simplified hydrolog simhyd snow thermal model sntherm snow atmosphere soil transfer sast soil and water assessment tool swat soil and water integrated model swim soil conservation service curve number scs cn soil moisture active passive smap spatial processes in hydrology sphy state hydrological institute shi model surface water area model swam swedish meteorological and hydrological institute smhi the atmosphere and ocean research institute aori university of tokyo the australian water resource assessment landscape awra l the bureau of meteorology bom australia the centre for ecology and hydrology ceh the commonwealth scientific and industrial research organization csiro the engineer research and development center of the united states army corps of engineers erdc usae the institute of hydrology ih uk the joint uk land environment simulator jules the national institute of environmental studies nies the soil conservation service scs the topmodelbased land atmosphere transfer scheme toplats the united states department of agriculture usda topographic kinematic approximation and integration topkapi united state department of agriculture agriculture research service usda ars united states geological survey usgs university of alaska fairbanks geophysical laboratory uaf gipl 2 0 variable infiltration capacity vic washington state university wsu wasim eth water balance simulation model water and energy budget based distributed hydrological model web dhm water and snow balance modeling system wasmod m water global analysis and prognosis watergap weather research and forecasting model wrf hydro world wide water resources assessment w3ra xinanjiang xaj credit authorship contribution statement pranesh kumar paul conceptualization data curation formal analysis investigation methodology software validation visualization writing original draft writing review editing yongqiang zhang conceptualization funding acquisition investigation methodology project administration resources supervision writing review editing ning ma validation visualization writing review editing ashok mishra writing review editing niranjan panigrahy writing review editing rajendra singh writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this study is supported by cas talents program the national natural science foundation of china grant no 41971032 the second tibetan plateau scientific expedition and research program 2019qzkk0208 the science for a better development of inner mongolia program of the bureau of science and technology of the inner mongolia province and cas csiro drought propagation collaboration project the authors thank anonymous reviewers and editors for their critical and constructive reviews for improving the paper quality appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2021 126561 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
4389,development and use of global continental and country scale hydrological models has attracted an increasing attention over the last two decades though developed countries are a head in development and assessment of these models most developing countries if not all even do not have their own models therefore an appropriate model selection process is necessary for these regions to improve the skill in hydrological modelling and prediction at the local to global scales therefore a framework for model selection is provided to help hydrological modelers from various skills keeping the framework in view this paper reviews 70 representative models to provide a lucid pathway of selecting models at global continental and country scales over catchment scale models in the process strengths and weaknesses of models designed for each spatial extension are examined depending on their spatio temporal resolutions the model parameterization schemes for representing multiple hydrological processes and the number of parameters we summarize testing schemes to assess models to decide among multiple similar models finally we summarize the remaining challenges and discuss future research directions keywords hydrological model selection developing countries spatio temporal scales hydrological signatures testing scheme 1 introduction fresh water availability is getting stressed around the globe because of continuously increasing population and accelerated socio economic growth webb et al 2017 wang and yan 2017 in particular such stress has led to a wide range of impacts on regional and or global climate because of the changes in soil moisture and terrestrial evapotranspiration seneviratne et al 2010 dirmeyer 2011 for this reason the altered river discharge from contentinents to oceans results in changes in the sea levels milly et al 2010 besides land use changes in upstream affect the hydrology and water quality in the downstream freeman et al 2007 which leads to the notion of the global water system alcamo 2009 this system is further complicated by the interference from humans through water storage and withdrawals rost et al 2008 therefore it requires a thorough understanding of hydrological condition for efficient dealing with the stress via effective water resources management strategy while intensive observations pertaining to hydrological processes are pre requisite for achieving the goal they are often particularly scarce for varying eco climatic conditions which is especially true for the developing countries in the world in this context hydrological modelling becomes one of the powerful tools to develop required scenarios for sustainable management of water resources singh and frevert 2006 beven 2012 beven and young 2013 therefore a wide range of hydrological models are developed and used for broad range of environmental processes and spatio temporal scales beven and kirkby 1979 refsgaard and storm 1990 irannejad and henderson sellers 2007 tang et al 2006 zhang et al 2008 2016a 2016b 2020 zhang and chiew 2009 schoener 2010 de graaf et al 2014 bai et al 2020 paul et al 2020 nagdeve et al 2021 it is not surprised that the developed countries usually have their own hydrologic models however majority of developing countries have limited hydrologic modelling capabilities due primarily to the relatively poor ability in the model maintenance computational costs and technical capacity for model simulation fortunately developing countries has dedicated into the development of certain country scale models such as the satellite based hydrological model shm paul et al 2018 2019a therefore proper selection of a hydrological model from representative hydrological models developed for other areas could facilitate an improved skill in hydrological modelling which would be of help for decreasing vulnerabilities in water resources management in developing countries nevertheless every modeler has their own perception of natural conditions such as landscape variability and the components of hydrological cycle in this context the selection of an appropriate model should depend on the adequacy for the research questions including the study purpose the landscape of the region and the spatio temporal scales however previous studies focusing on hydrological model selection are often chosen according to the legacy practicality convenience experience and habit table 1 furthermore these studies only focus on a few models which are not able to represent comprehensive selection scenarios for global requirements having recognized above needs the aim of this paper is to represent a pathway of model selection for application in developing countries by comprehensively reviewing the representative hydrological models in the process a framework for model selection is provided to help hydrological modelers from various skills besides we keep in mind the perspective of global continental and country scale models over catchment scale models in the process strengths and weaknesses of each model are examined depending on their spatio temporal scales the way they represent the complex hydrological processes and the number of parameters we summarize a series of model testing schemes to determine the most suitable one from multiple similar models in case there is a dilemma in selection finally the remaining challenges are summarized and future research directions are discussed thus this paper may serve as a comprehensive tool for hydrologists all over the world to have quick and detailed information about 70 representative models prior to select an appropriate one 2 selection strategy of hydrological models for appropriate selection of hydrological model at first the purpose of the study should be very clear addor and melsen 2018 for example planning design and engineering operation for the control and use of water study of hydrological cycle interaction between organisms and the hydrological cycle presence and movement of groundwater adaptation of information technology to hydrology study of the transfer of water and energy snow melt analysis along with cryosphere modelling hydrologic processes that operate at or near earth s surface water storage in the form of reservoir and flood protection biosphere modelling and chemical characteristics of water in rivers and lakes both of pollutants and natural solutes if the purpose is clear then we should go for identifying the appropriate model depending on the representation of the processes fluxes and credibility for different climatic conditions and physiographic settings then we should focus on availability of model codes requirements of data and spatio temporal resolution of the model however we should have model credibility testing to identify the better model among a few similar ones to be precise if situation comes when we have every data and requirements of a few models and they also serve our objectives we need to select only one then we must go for a credibility testing of the models to determine the best one to use 2 1 representations of the hydrological processes and fluxes ideally a complete hydrological model would represent the following water balance components and fluxes total precipitation including both snow and rain interception storage evaporation throughfall transpiration snowmelt surface storage e g micro depressions lake and reservoir storage overland flow soil storage recharge to shallow aquifer capillary rise and intermediate flow trambauer et al 2013 it is to be noted that a more complex model may not necessarily lead to better results orth et al 2015 for example inclusion of the snow water ice dynamics may not be useful for drought predictions but incorporating the groundwater process does so however snow water ice dynamics is an integrated part for cryospheric modelling khadka et al 2020 because water stored as snow and ice is a critical contributor to the world s available freshwater supply and is essential to the sustenance of natural ecosystems agriculture and human societies amanambu et al 2020 to be precise it models the distribution of water mass due to movement of water between and within the atmosphere hydrosphere cryosphere and ocean dobslaw et al 2010 moreover climate ecology the cryosphere and hydrology are interconnected in cold regions chen et al 2014 in this region glacier is one of the primary climate indicators radić and hock 2011 the mass change of glaciers alters the hydrologic regime in these areas besides the long term changes include thawing permafrost and altered hydrology related to permafrost dynamics and changes in snow regime that lead to landscape drying and plant water stress callaghan et al 2011 therefore clear understanding of connections between the climate cryosphere and streamflow is necessary to make informed decisions regarding water resources mosier et al 2016 so it requires implementation of cryosphere hydrology models that are robust across geographic domains and climatic conditions woolway et al 2020 so cryosphere modelling becomes complex in comparison to usual hydrological modelling azmat et al 2016 due to relative balance of heat fluxes changes over time and locations energy balance i e physically based cryosphere models are theoretically more robust under altered climate and geographic settings kustas et al 1994 sicart et al 2008 huss et al 2009 on the other hand conceptual cryosphere models require fewer input data than energy balance models therefore these are often considered good enough to implement for data sparse regions e g hagg et al 2007 jung and chang 2011 lutz et al 2014 however several of the energy balance inputs are even more sparsely measured in certain areas like mountain environments than precipitation and temperature and often vary significantly over short spatio temporal scales for example wind speed linearly scales each convective heat flux i e sensible and latent and is therefore necessary for energy balance models the spatial distribution of wind speed is however difficult to characterize even if there are measurements of wind speed within the region marks et al 1992 marks and winstral 2001 therefore it allows consideration of whether including variables such as wind speed improves or reduces model performance in a given application moreover for model performance to be robust the means by which a model calculates output must be representative of the entire range of physical conditions being modeled both climatic regimes and geographies however there can be a compromise addition between model complexity and efficiency as per objective it is therefore important to consider the purpose of the modelling at first when choosing an appropriate model 2 2 availability of codes data requirements spatio temporal resolution and parameters the first criterion deals with the represented processes and fluxes of the models as discussed in previous sub section meanwhile we have to check the availability of codes of the appropriate models before advancing toward next steps kauffeldt et al 2016 because if a model is appropriate but with unavailable code then there is no point to go further with that model for obvious reason besides including all the possible processes does not necessarily lead to a better performance of the model if the necessary data are not available soil elevation land use and land cover rainfall temperature which may vary model to model in fact this may result in a worse performance when comparing with a simpler model orth et al 2015 for example a detailed representation of groundwater flows and tables would be very relevant for applications all over the world however the lack of information on the hydrogeology and groundwater tables in any region makes this detail representation pointless thus a simpler representation may be preferred similar concern is also true for models input since certain input data can be scarce in many regions of the globe brocca et al 2020 for above reasons it is suggested that there should be a trade off between the data availability and process representation jehn et al 2019 it should be worthwhile to highlight that the spatial resolution of most of the input data for current hydrological models are typically coarse reinecke et al 2020 however grid cell resolution is dependent on computation time simulation cost and machine capability paul et al 2018 while downscaling the input to finer scales to run the model with finer grid size may lead to extra effort they may still not yield a better performance sen and tarboton 2016 at this point the users should choose a suitable grid cell size for model simulation maintaining the trade off with computation time simulation cost and machine capability the same may be the case with the temporal resolution some models may have an hourly temporal resolution but if the required input meteorological data is available only at a daily resolution then the use of the finer temporal resolution may only take extra computation time without leading to meaningful usable results therefore user should pay focus on this point as well moreover user should consider parameters in number into account in the process also because a model consists of various parameters that define the watershed characteristics and hydrological processes devia et al 2015 the lower the number of parameters will be the easier the model will be to calibrate as the process will be less complex 2 3 model credibility keeping linkage with the previous two criteria the processes and spatio temporal resolution that are the most meaningful for simulating the objective wise conditions in respective climatic and physiographic situations must be regarded in spite of considering these criteria we can have two or more models in hand simultaneously which are appropriate for application however we need only one for a particular case in this context it is necessary to test all of them first for selecting a better one thus the testing results may ensure successful selection of a model from a few pre selected similar models meanwhile thorough testing is essential for different physiographic and climatic conditions to understand the detailed credibility of any model klemeš 1986 therefore at the time of development every developer should perform a credibility testing of the model to establish the developed model for a proper future usage in short we summarize a framework flowchart for optimum model selection fig 1 this may help the modeler to select model wisely 3 assessment of representative hydrological models for selection global continental and country scale models have been applied over varying spatio temporal scales it is therefore reliable to use one of these models as per objective and related signatures in developing countries however we can select other models also if their previous applications do match the spatio temporal scale of the selected study area nevertheless the availability of data and code number of parameters and spatio temporal scale will be the final criteria to select the model therefore we need to at first go through a robust classification scheme 3 1 classification of hydrological models there are many hydrological models with unique and common characteristics that are being developed day by day wang et al 1996 danish hydraulic institute dhi 2004 in this case the unique and common characteristics of many models make classifications of hydrological models an important issue which would be vital for an accurate identification of the capabilities and limitations of each model proper classification can be helpful for engineers experts and researchers to understand the characteristics of models before deciding to use them for their purposes however the categorizations of hydrological models can be hammered by considerable overlapping characteristics among various classes of models ma and gourbesville 2020 as a result even the classification of hydrological models may vary depending on justification wheater et al 1993 singh 1995 singh and frevert 2006 thus classification of hydrological models highly effects the selection of the appropriate one in this circumstance the classification scheme inspired by wheater et al 1993 is presented in fig 2 following the space scale based classification scheme shown in fig 2 70 representative hydrological models are classified for different spatial classes in stacked venn diagram fig 3 this comprehensive figure will help a hydrologic modeler as a catalogue to identify different hydrological models depending on spatial scale the models other than of country continental and global scales are usually applied at the catchment scale and have many parameters that need to be calibrated or estimated for a given region examples of such models include the soil and water assessment tool swat neitsch et al 2002 and the hydrologiska byråns vattenbalansavdelning hbv lindström et al 1997 however there is exception like gr4j model which has only four parameters to be used for catchment study although some of these models can in principle be applied at the country continental and global scales this happens rarely in practice due to severe information constraints however for distributed models fig 2 the number of parameters may be much more than those are usually listed the reason behind this is the consideration of spatial variation in the soil elevation data and the land use and land cover information the parameter values usually depend on these varied conditions the simple example is the value of scs cn which may be regarded as a single parameter however in practice we can see that it value varies over the area in different grid cells hydrological response unit hrus depending on the soil and the land use and land cover information however the nature of the parameter remains the same therefore we should consider these as a single entity therefore spatial discretization based classification must be considered during the selection of a model however spatially distributed parameters make the calibration process complex and time consuming in this circumstance fig 4 represents the spatial discretization based classification of the 70 representative models it can be seen that the development and use of global continental and country scale models have increased obviously in the past two decades fig 4 most of these models are semi distributed models in fact the development and use of distributed and semi distributed models have increased tremendously in comparison to the lumped ones fig 4 for semi distributed and distributed models the grid size selection is linked to the spatial scale at which the model will be applied for example for a continental scale model the grid cell resolution should be in the order of several to dozens of kilometres however for a river basin scale study the grid resolution could be in the order of a few hundred meters for coarser grid cells the processes that are only important at the local scale such as overland flow may not be fully considered in the model structure as a result some global models may not be easily downscaled to a river basin scale without making significant changes in the structure of the model in the same way it may not be possible to upscale a model that has been developed for a catchment scale to the continental or global scale however the selected model needs to be applied not only at country continental and global scales but also river basin scale without important modifications in its formulation among these models most of them are conceptual the number of physically based models and hybrid models are very low though the number of physically based cryosphere models is high actually physically based models can represent the detailed physical processes in a deterministic way by representations of mass momentum and energy conservation refsgaard 1996 singh and frevert 2006 however it is apparent that there are problems associated with the application of physically based models such as extensive data and computational requirements singh and woolhiser 2002 singh and frevert 2006 beven 2012 therefore future uses developments in hydrological modelling techniques face a dilemma this leads to the use of conceptual models which require comparably lesser data computational efforts and time singh and woolhiser 2002 singh and frevert 2006 this interpretation supports fig 4 although conceptual hydrological models are less data and time intensive global and country scale water resources planning and management requires relatively voluminous input information the collection and availability of spatially extensive data by using the traditional methods of data acquisition is a challenging task for a large territory therefore hybrid and metric models the latter were not shown in the present review may also be an option nevertheless we do not involve any empirical models because these models are region and or problem specific which are unable to meet the global requirements moreover these 70 representative models are capable of continuous simulation besides all models are deterministic except macro pdm which is stochastic in nature more importantly most of the global continental and country scale models are semi distributed only macro pdm lisflood crocus snowpack nsidc model sast oggm and glogem models are distributed whether hbv is lumped so it is to be noted that most of the global continental and country scale cryosphere models are of distributed structure also models are becoming more complex and resolute as more functionality is added to these besides finer global spatial datasets are becoming available in this manner issues of the sensitivity of models to varying spatial and temporal scales of input data have become prominent döll et al 2008 in addition calibration processes has also become more and more challenging because of the spatially distributed parameters to solve the problem different automatic calibration schemes are being used however clear knowledge of the auto calibration processes computational facility and cost do play a big role in the process however global continental and country scale models may provide valuable spatial and temporal estimates of worldwide water resources at least of considerable parts which is conducive to analyze the possible projections scenarios of changes of those estimates in addition these multi scale estimates of water resources obtained through the models may be an improvement over those data which are simply based on the statistical analysis of ground based observed data the latter remains limited and hence contains a lot of uncertainty at a large scale rodda 1995 3 2 summary of the signatures of selected hydrological models the complexities of the models vary based on the objectives structural issues such as the number of soil layers the number of land use classifications irrigation water applications and reservoir storage are dealt differently in different models sood and smakhtin 2015 the structural differences are also related to inclusion of vegetation growth models different types of bucket model such as leaky bucket non leaky bucket snow water ice dynamics i e water phases liquid treatment physical equations snow density layering and permafrost glacier treatment calibration process and number of parameters sood and smakhtin 2015 therefore their technical features such as simulation capability of reservoirs snow dynamics irrigation crop vegetation setup groundwater have been summarized in fig 5 and more details are provided in table s1 in the supplementary document with the information of technical features a user will be able to select a model he she wants to use however it needs to be noted that the tank model does not pass any requirements for the selection therefore it becomes an easy choice to avoid at the time of model selection along with these regular features a few unique features water phases liquid treatment physical equations snow density layering and permafrost glacier treatment of ten selected cryosphere models are summarized in table 2 in this circumstance details of code availability are summarized in table 3 it is evident that only 30 models have open source codes among the 70 selected models besides gwava g2g marius lisflood only provide the executable programs meanwhile matsiro and swim codes are available upon request on the other hand pcr globwb code is under preparation for being available among the models with available codes variable infiltration capacity vic and swat models have not only their codes available for the user but also with good documentation and discussion forum of users thus the number of users of vic and swat has been greatly increasing over last few years in comparison to other models which is especially evident in developing countries wi et al 2017 however use of hec hms and mike she is much limited this is because the user needs to purchase the codes in addition most of country scale models codes are not freely available which is a major restriction in the way of their usage due to unavailability of codes 31 models table 3 are comparably limitedly used 3 3 comparison of spatio temporal scales and the number of parameters generally distributed hydrologic models comprise of large number of unknown parameters and model s efficacy in simulating the hydrological processes depends heavily on the accurate estimation of these parameters through calibration krishna and sudheer 2020 the parameters in any distributed hydrological models exist at different spatial scales in fact some parameters are at watershed level while some are at sub basin level or at hru level her et al 2015 on the other hand when we consider them we only identify them as a single parameter because depending on spatial heterogeneity the values of that particular parameter changes not the nature of the parameter ideally all of them are to be calibrated but it increases the complexity of the optimization during calibration her et al 2015 krishna and sudheer 2020 therefore a generic procedure is to uniformly perturb the parameters across the watershed at different spatial scales from their default values to maintain the spatial heterogeneity her et al 2015 so we should be careful at the time of calibration of those parameters in this condition we compare the number of parameters and temporal scales of global continental and country scale models comparison of all global scale models against the number of parameters and temporal scales clearly helps in decision making on their usage fig 6 in particular all models simulate at a daily scale except for h08 h07 and oggm models which simulate at 3 h and monthly scale respectively on the other hand their parameter numbers vary from 3 mpi hm and oggm to 42 noah mp depending on the information users may choose the optimum models for application thus the analysis proves to be truth for the increased use of swat and vic models comparison of all country scale models against the number of parameters and temporal scales shows that all models simulate in the daily scale except for g2g marius 0 25 h 15 min nwm 6 h jules 1 h and sntherm 0 01 h 900 s fig 7 on the other hand their numbers of parameters vary from 5 g2g marius and nwm to 35 crocus fig 7 depending on the information user may select the optimum models for application in this case however the compatibility of the database and available data over the countries may play an important role in the model selection the comparison of all continental scale models other than the global and country scale models in figs 6 and 7 are performed in fig 8 against the number of parameters and temporal scale the figure depicts that all the models simulate in the daily scale on the other hand their numbers of parameters vary from 4 wbmplus to 80 swim depending on the information user may choose optimum models for application we further compare the spatial scales of all global continental and country scale models in table 4 it shows that global scale models simulate in coarser resolutions than the country scale models though the cryosphere models namely oggm and glogem are the exceptions in comparison to their country and continental scale counter parts however the database compatibility in different regions may be an issue to use a country scale model over a global scale model for regional studies moreover the explosion of global data availability from satellites in the last two decades has an influence on the development of global hydrological model tang et al 2009 although some global models are applied at different range of scales they have been developed for global scale studies beck et al 2016 meanwhile they would not be the preferred choice in basin scale applications due to their coarser resolution and poor local applicability 3 4 testing of hydrological models any model should be tested against observations to check its applicability capacity and capability in different spatio temporal scales klemeš 1986 it may help in selecting the best model for a specific purpose from multiple eligible models with increasing number of newly developed models several contradictions have emerged regarding the various claims of model applicability and lack of documentation for these claims for example a developer or an institute always tries to highlight their model and represent it as the best therefore their credibility is often questionable for valid reasons generalized terminology regarding credibility is given by schlesinger et al 1979 the credibility of a site specific model is the capability to make predictions about reality and the model must be evaluated against independent data refsgaard and henriksen 2004 testing of model is synonymous with model verification verification is an assertion or establishment of truth i e verify a model means to demonstrate its truth oreskes et al 1994 the model is proved to be validated if its accuracy and predictive capability in the validation period have been shown to lie within acceptable limits refsgaard 1997 hence generalized validation methodologies which are widely accepted in hydrology have been extensively studied klemeš 1986 andréassian et al 2009 krause et al 2005 schaefli and gupta 2007 gupta et al 2009 along with that important guidelines for the validation process are given by strengths weaknesses opportunities and threats swot analysis hill and westbrook 1997 a tool for strategic planning that can be used to evaluate these four aspects associated with a model and its application however klemeš 1986 represented a scheme for the credibility of any model over different spatial and temporal conditions i e for stationary and transient conditions depending on these studies and inspired by the testing scheme of klemeš 1986 credibility testing of the multiple global continental and country scale hydrological models is summarized in fig 9 the previous studies using hierarchical operational testing and comparison of a model with other well established models have been summarized in tables 5 and 6 respectively to represent the validity of the summarized classification scheme the two tables also show the path on how to identify a single model from multiple similar models besides it is clear that there are very rear applications of all the steps of hierarchical operational testing altogether in theory it is highly important to apply all the steps altogether but in practice most of the steps are separately applied in different studies since current hydrological model applications often consist of split sample test refsgaard and knudsen 1996 loague and freeze 1985 paul et al 2019a then only the real credibility of a model will be identified for data available condition consequently table 6 shows that in most of the cases swat is considered as the widely used model when comparing with other models mannschatz et al 2016 however there is no available study which has performed hierarchical operational testing and comparison with other established models for a complete model testing therefore application of this testing scheme may be helpful for selecting an appropriate hydrological model from multiple similar models 4 challenges and future research directions 4 1 challenges a comprehensive review of 70 representative hydrological models has been conducted in this study surrounding year of development objectives and different signatures along with spatial and temporal resolutions of the models to compare with each other to underpin a selection way out for developing countries keeping global continental country and catchment scale models in view it shows that there is a breadth of issues to consider when undertaking a model selection process no model is error free and is subject to update this is due to compromise in model structures to balance with computation capability and objective mcmillan et al 2011 nevertheless a newly updated developed model for a specific area can improve upon the previous models therefore if required and if possible it may be better to develop a new model for a new study in a particular country or region rather than selecting a model which has been developed for other places in that case balancing of complexities of model inputs model structure and the number of parameters is a challenge refsgaard and knudsen 1996 model selection is difficult due to unavailability of model input model structure complexity and complicated parameterization xie and lian 2013 moreover a complex model does not mean it could provide better results orth et al 2015 for this reason a simpler model is still preferable if the study purpose does not require detailed representation of the complex hydrological processes such as irrigation and groundwater dynamics however the data availability in particular format and resolution is of utmost importance and challenging to deal with it is challenging yet necessary to balance user skills for selecting a suitable model as there are different levels of hydrological modelers and their skills also vary from beginner to experienced model selection process gets biased the beginners first of all may not have sufficient knowledge to understand the capability of a model for a particular study on the other hand experienced modelers will have surely that idea besides the beginners may be interested in using graphical user interface based models meanwhile experienced modelers will focus on the modelling processes and parameterization thus a popularity index may help to solve the issue which is a challenging task for the researchers mannschatz et al 2016 all models are not available in a single platform with listed advantages disadvantages and other details moreover certain model manuals are also not available the manuals are written sometimes in local languages other than english therefore the best solution may be to organize all the models and related information in a single platform preferably web inventory which will facilitate the inter comparisons of global continental and country scale models before applying them for a specific purpose mannschatz et al 2016 this remains one of the major challenges in hydrological modelling it is challenging to identify optimum spatial resolution for a particular study identification of spatial resolution is a vital issue and remains one of the key research gaps in the current model selection studies a coarser resolution may provide acceptable results in the global scale but may be not adequate for studies at the regional scales as the latter typically requires a finer resolution it should be noted that however different spatial resolution would lead to different model simulation time computational capability and costs therefore identification of the optimum resolution always remains a great challenge 4 2 future research directions keeping the challenges in mind following future directions are discussed for helping hydrologists particularly those coming from developing countries to make choice of appropriate models the scientist from developing countries should think about projects for development of hydrological models for their own countries souffront alcantara et al 2019 it can have different versions as per different objectives they may need help from scientists who have developed hydrological models earlier in developed countries they can imply their own learning and capabilities also to develop a model with own technology a well prepared database platform for various input information is required to simulate hydrological models full of copious information spreading across various spatio temporal scale because detailed input information lead to meaningful model simulation depending on modelling objective and model characteristics however there are different techniques for hydrological simulation in data scarce conditions but a well prepared and comprehensive database platform containing different input information will make hydrological model selection and hence hydrological modelling easier as different model needs different spatio temporal input information devia et al 2015 the platform can be online so that user from various level and institute can access it easily therefore this will be a great field for future research and improving confidence on several models to be applied in developing countries model selection should be keeping balance with the thinking of both beginners and experienced researchers so that global hydrology gains the most therefore it should be taken seriously as a future research direction for example webinar and conferences can be organized to know each other s view as done by swat model developers regularly we may focus on developing a popularity index to compare the view of all sides numerically mannschatz et al 2016 preparation of a single web inventory for all hydrological models and their related detailed information should be taken as a future research direction very seriously mannschatz et al 2016 since it can be an easier way to find all models together before selection from a lot all scientists from all over the world should contribute in this platform to make it as easy to understand as possible it is interesting to test the transferability of lumped catchment model to gridded hydrological model meng et al 2018 lumped models are used for simple and focused modelling purpose liu et al 2021 however a lumped model may provide better results in complex scenario and suit a study area well if it is transferred to gridded structure meng et al 2018 therefore interchange of lumped models into gridded structure may be an option for future research in the process we may know the capability of model in different resolution and area testing of a model with different resolution is of utmost importance in future paul et al 2020 this test should be done from regional to global scale valentina et al 2020 most importantly this is a must for country scale model because every model has its own structure and performance may vary depending on different grid cell resolutions paul et al 2018 coarser grid cell resolution may ignore details in land use and land cover overland flow networks but finer grid cell resolution may increase model simulation time paul et al 2018 depending on the purpose of study model structure and model simulation time the final spatial resolution of model should be decided 5 concluding remarks this study scrutinize 70 representative hydrological models to explore the selection procedure keeping focus on global continental and country scale models in view here we discuss the advantages and limitations of the models to be used for different spatial extensions following a general framework of model selection we summarize model testing schemes to determine the most suitable one among multiple similar ones though testing finally the challenges and future research directions are summarized thus this paper may serve as a comprehensive inventory of representative models for hydrologists all over the world to have quick and detailed information however this study should be carried on further by considering other models and focusing on the discussed challenges and future perspectives 6 acronyms used in the paper parflow a parallel watershed flow model topmodel a topography based hydrological model artificial neural networks ann australian water balance model awbm biosphere energy transfer hydrology model bethy cascade two dimensional casc2d commonwealth scientific and industrial research organization csiro community land model clm danish hydraulic institute dhi distributed biosphere hydrological model dbhm distributed hydrological soil vegetation model dhsvm dynamic watershed simulation model dwsm european hydrological predictions for the environment e hype flash flood event based spatially distributed rainfall runoff transformation water balance fest wb glacier and snowmelt soil contribution gsm socont global glacier evolution model glogem global hydrological routing algorithm hydra global water availability assessment model gwava gravity recovery and climate experiment grace gridded surface subsurface hydrologic analysis gssha grid to grid g2g managing the risks impacts and uncertainties of drought and water scarcity marius model great britain groundwater and surface water flow gsflow hydrodynamic model hdtm 1 0 water balance model wbm plus water balance model water transport model wbm wtm hydrologic engineering centre hydrological modeling system hec hms hydrologic simulation model hysim hydrological simulation program fortran hspf hydrologiska byråns vattenavdelning hbv hydrology tiled ecmwf scheme of surface exchanges over land htessel identification of unit hydrographs and component flows from rainfall evaporation and stream ihacres interactions between soil biosphere and atmosphere total runoff integrating pathways isba trip lund postdam jena managed land model lpjml macro scale probability distributed moisture model macro pdm max planck institute hydrology model mpi hm mesoscale hydrologic model mhm mike systeme hydrologique europeen she minimal advanced treatments of surface interaction and runoff matsiro modèle du génie rural à 4 paramètres journalier gr4j modélisation couplée modcou moderate resolution imaging spectroradiometer modis national center for atmospheric research noah national snow and ice data center nsidc model national water model nwm national water resources model for denmark dk model nedbør afstrømnings model nam danish hydraulic institute dhi nam noah land surface model multi physics noah mp open global glacier model oggm parameter solution parasol pcraster global water balance model pcr globwb penman monteith p m penn state integrated hydrologic model pihm pennsylvania state university psu potsdam institute for climate impact research pik precipitation runoff modeling system prms precipitation runoff evapotranspiration hru model prevah processes of radiation mass and energy transfer promet river transfer hydrological model rithm sacramento sac model satellite based hydrological model shm simplified hydrolog simhyd snow thermal model sntherm snow atmosphere soil transfer sast soil and water assessment tool swat soil and water integrated model swim soil conservation service curve number scs cn soil moisture active passive smap spatial processes in hydrology sphy state hydrological institute shi model surface water area model swam swedish meteorological and hydrological institute smhi the atmosphere and ocean research institute aori university of tokyo the australian water resource assessment landscape awra l the bureau of meteorology bom australia the centre for ecology and hydrology ceh the commonwealth scientific and industrial research organization csiro the engineer research and development center of the united states army corps of engineers erdc usae the institute of hydrology ih uk the joint uk land environment simulator jules the national institute of environmental studies nies the soil conservation service scs the topmodelbased land atmosphere transfer scheme toplats the united states department of agriculture usda topographic kinematic approximation and integration topkapi united state department of agriculture agriculture research service usda ars united states geological survey usgs university of alaska fairbanks geophysical laboratory uaf gipl 2 0 variable infiltration capacity vic washington state university wsu wasim eth water balance simulation model water and energy budget based distributed hydrological model web dhm water and snow balance modeling system wasmod m water global analysis and prognosis watergap weather research and forecasting model wrf hydro world wide water resources assessment w3ra xinanjiang xaj credit authorship contribution statement pranesh kumar paul conceptualization data curation formal analysis investigation methodology software validation visualization writing original draft writing review editing yongqiang zhang conceptualization funding acquisition investigation methodology project administration resources supervision writing review editing ning ma validation visualization writing review editing ashok mishra writing review editing niranjan panigrahy writing review editing rajendra singh writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this study is supported by cas talents program the national natural science foundation of china grant no 41971032 the second tibetan plateau scientific expedition and research program 2019qzkk0208 the science for a better development of inner mongolia program of the bureau of science and technology of the inner mongolia province and cas csiro drought propagation collaboration project the authors thank anonymous reviewers and editors for their critical and constructive reviews for improving the paper quality appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2021 126561 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
