index,text
2880,optimal operation of multi purpose multi reservoir dams is a challenging problem for dams stakeholders and decision makers optimization algorithms are able to present reliable solutions for such complex problems this study compared the capability of 20 state of the art robust meta heuristic algorithms for determining the optimal operating policy of halilrood multi reservoir system under the three competing operational objectives of water supply flood control and hydropower generation before that the performance of the algorithms in solving two benchmark problems the schaffer problem and the mmf1 problem from the cec suite was evaluated four metrics of generational distance gd spacing s spread δ and maximum spread ms were used to compare the algorithms performance in solving the benchmark problems in addition four reservoirs performance evaluation indicators of reliability rel resiliency res vulnerability vul and sustainability index si were used to ass the algorithms performance in solving the real case halilrood problem the results showed that although the solving capability of each algorithm depends on the nature of the problem some algorithms were always superior in solving all three problems 2 benchmark problems and one real case for the schaffer benchmark problem the moaha algorithm with the performance metrics of gd 0 00095 s 0 58155 δ 0 20375 ms 4 0002 had the best pareto front in terms of coverage and diversity and so it was placed at the first rank in this problem the mocrystal algorithm with gd 0 00141 s 0 48395 δ 1 49467 ms 3 94799 placed at the lowest rank for the mmf1 problem the moma gd 0 00751 s 0 07516 δ 0 29519 ms 0 99826 followed by the moaha gd 0 00833 s 0 07660 δ 0 17832 ms 1 00 had the best performance respectively and the mofa algorithms was the worst for the halilrood real case problem the mogwo algorithm with rel 83 41 res 67 57 vul 22 07 and si 76 01 followed by the moaha algorithm rel 84 57 res 64 71 vul 33 60 and si 71 41 and the moma algorithm rel 79 82 res 66 67 vul 21 65 and si 74 70 obtained the best ranks in terms of reservoir s performance evaluation indicators they could successfully minimize all three objectives of the total deficit the flood control and electricity generation indicating the highest performance of these algorithms in the optimization problem the pareto front obtained by these algorithms had better distribution and was closer to the origin of coordinates compared to the other utilized algorithms they could favorably supply the total water demand in the halilrood basin while increasing the hydropower energy generation up to the power plant capacity at the jiroft dam the results of this study can be applied to the optimal operation of any other multi reservoir system with conflict in water demands keywords nature inspired algorithm water supply parallel reservoirs cascade reservoirs operation policy data availability data will be made available on request 1 introduction deriving optimal operational policies for multi purpose multi reservoir systems is very complicated because of the large dimension of the problem the conflicts among the different objectives and the stochastic nature of the effective parameters such complexity has created a tendency among the researchers toward developing efficient methods for optimization of multi reservoirs operation traditional optimization techniques due to their several limitations are not reliable tools for such complex problems in contrast the meta heuristic methods because of their many proven advantages have become very popular in solving complex optimization problems yıldız et al 2020 yıldız and erdaş 2021 yıldız et al 2021a b they have many respective merits such as ease of use high accuracy gradient free mechanism broad applicability local optima avoidance and satisfying results yıldız et al 2021c d accordingly in the course of recent years the meta heuristics have been acknowledged as promising tools to support decision making in various hydrology and water resources engineering problems akbarifard et al 2021 sharifi et al 2022a b here some most recently published works published in the last five years on the use of meta heuristic algorithms focusing on the multi objective algorithms in the optimization of reservoirs operation are reviewed qaderi et al 2018 used the water cycle algorithm wca for the optimal operation of gorganrood multi reservoir system the results showed the superiority of the wca to the other investigated algorithms such as the genetic algorithm ga and the particle swarm optimization pso algorithm ehteram et al 2018 proposed an improved weed algorithm iwa for aswan high dam operation with the aim of decreasing the irrigation deficits the proposed algorithm demonstrated superior performance to the weed algorithm wa the bat algorithm ba the improved particle swarm optimization algorithm ipsoa and the ga in terms of the objective function the computational time and the reliability index liu et al 2020 used the lion pride algorithm lpa to optimize the operation of a dual objective reservoir and reported the appreciated performance of this algorithm sharifi et al 2021b improved the moth swarm algorithm msa with the fitness distance balance fdb selection method to achieve promoted fdb msa for optimizing hydropower generation of a multi reservoir system along the karun river in iran the results showed that the fdb msa could successfully increase the hydropower generation in the optimization model sharifazari et al 2021 used the nash bargaining solution and the evolutionary algorithms genetic and ant colony optimization algorithms to achieve the optimal solutions of a real case reservoir operation problem the results showed that the utilized method led to a successful water supply for all stakeholders goharian et al 2021 used the cellular automata approach to optimize the daily hydropower reservoir operation of the folsom dam in california they evaluated the performance of the mentioned approach under two extreme climate conditions and compared the results with the operation during normal conditions the results showed that the utilized approach provides more efficient solutions compared to the commonly used ga yaghoubzadeh bavandpour et al 2022 applied four optimization algorithms including pso teaching learning based optimization algorithm tlbo cultural algorithm and ga to determine the optimal operation of the aydoghmoush reservoir in iran the results indicated the acceptable performance of all algorithms in finding the optimal solutions for reservoir operation as well as the superior performance of the swarm intelligence algorithms to the evolutionary algorithms in terms of accuracy of solutions convergence rate and run time to reach global optima yang et al 2020 combined a radial basis function rbf network with an evolutionary algorithm to produce a heuristic input variable selection his method that extracts hanjiang reservoirs operating rules based on the feature selection the results demonstrated that the his combined with the rbf could accurately extract the reservoir operating rules afshar and hajiabadi 2019 used a weighted cellular automaton to optimize the dez reservoir operation considering two objectives of water supply and hydropower generation the results indicated that the utilized method was highly efficient compared to the nsga ii sun et al 2018 applied the multi objective evolutionary algorithm based on decomposition with adaptive weight vector adjustment moea d awa to solve the huangjinxia reservoir operation problem the results showed that the proposed model was effective and could provide decision support for reservoir operation zhang et al 2018 used the deep learning algorithm in comparison with the artificial neural network ann and support vector regression svr to simulate the reservoir operation the results showed that deep learning models are useful tools to assist for decision making in reservoir operation yaseen et al 2019 proposed a hybrid optimization algorithm based on the ba and pso algorithms called the hybrid bat swarm algorithm hb sa to optimize the operation of golestan and voshmgir multi reservoir system in iran the results showed that the proposed hb sa algorithm outperformed the other optimization algorithms in terms of the water supply and the computational time for the convergence procedure niu et al 2018 proposed a parallel multi objective particle swarm optimization pmopso for cascade hydropower reservoir operation in southwest china the results showed that pmopso could provide satisfying scheduling results in different cases kumar and yadav 2022 proposed the self adaptive multi population multi objective jaya algorithm samp moja to extract multi purpose reservoir operation policies the results were compared with those of the multi objective jaya algorithm moja and the multi objective pso algorithm the results indicated that the samp ja was better than the ja the pso and the iwo in terms of maximum hydropower generation and the algorithm convergence rate zhong et al 2022 used the chaos optimization algorithm coa to optimize the reservoir operation of cascade hydropower stations the results showed that the mentioned algorithm could solve the reservoir operation problem with high accuracy and fast convergence speed mansouri et al 2022 employed an improved version of the fuzzy multi objective pso algorithm f mopso for optimization of reservoir operation under climate change the results indicated the superior performance of f mopso to the nsga ii in meeting the water demands and holding the reservoir storage sustainable there are many other publications on the application of meta heuristic algorithms for optimization of various engineering problems as well however there is no optimization method capable of solving all optimization problems as stated by the no free lunch theorem wolpert and macready 1997 that means a given optimization algorithm may perform very well in solving a specific optimization problem but it may not be capable of reasonably solving another optimization problem therefore for each particular problem the most appropriate optimization algorithms should be chosen from the list of candidate algorithms this encourages the researchers to evaluate the capability of various optimization algorithms for different categories of problems in the study field 2 materials and methods the operation of multi objective multi reservoir systems is a complex engineering problem that needs the application of robust multi objective meta heuristic algorithms to solve as stated earlier the purpose of this study was to evaluate the capability of 20 state of the art meta heuristic algorithms for the optimization of halilroud multi purpose multi reservoir system operation table 1 listed the 20 meta heuristic algorithms investigated in this study all these algorithms have been proven as very powerful meta heuristic algorithms in solving different multi objective optimization problems 13 out of 20 of these algorithms have been developed in the last two years due to the page limits of the paper the details of each algorithm are referred to the primary reference of each article as presented in table 1 2 1 mathematical model of multi objective problems eq 1 indicates the mathematical form of the objective function of a multi objective optimization problem 1 f x f 1 x f 2 x f m x t in which x x 1 x 2 x 3 x d is the vector of variables and d and m refer to the number of variables and objectives respectively the common solution for multi objective optimization problems is to keep a set of the best solutions in an archive and update it per iteration in this approach the best solutions are defined as non dominant solutions or pareto optimal solutions in other word for multi objective problems there are a set of optimal solutions instead of a single solution they are known as pareto optimal solutions for a solution to be a non dominant solution the following conditions should be met coello 2000 i pareto dominance u u 1 u 2 u 3 u n v v 1 v 2 v 3 v n if and only if u is slightly lower than v in the objective space which means 2 f i u f i v i f i u f i v i i 1 2 3 m ii pareto optimal solution u vector is an optimal solution if and only if none of the other solutions can dominate u a set of pareto optimal solutions is called pareto optimal front pfoptimal fig 1 shows that among the three solutions of a b and c the solution c has the highest values for f1 and f2 therefore it is considered the dominant solution solutions of a and b are considered the non dominant solutions 2 2 schaffer benchmark problem schaffer 1984 presented a benchmark problem for evaluating the capability of multi objective optimization models this convex problem is a single variable problem with two objectives to be minimized eq 3 this benchmark has been a strong point of reference up to now almost every multi objective ea has been tested on this problem 3 m i n i m i z e f x f 1 x f 2 x s u b j e c t t o f 1 x x 2 f 2 x x 2 2 the goal is to minimize f1 and f2 simultaneously as demonstrated in fig 2 the pareto optimal points are located in the range where x 0 2 outside this interval f1 and f2 are increasing while within the interval there is a trade off between the two functions one is increasing while the other is decreasing 2 3 mmf1 benchmark problem mmf1 is a problem from the benchmark problems of the completions on evolutionary computation cec 2020 the cec 2020 is known as the most up to date and prestigious multimodal multi objective benchmark suite there are four different types of benchmark problems in the cec 2020 benchmark suite according to the forms of the objective and decision spaces including convex linear convex nonlinear concave linear and concave for the mmf1 the equations and figures of pareto optimal set ps and pareto front pf are as follows 4 f 1 x 1 2 f 2 1 x 1 2 2 x 2 sin 6 π x 1 2 π 2 where the search space is x 1 1 3 x 2 1 1 the global pareto sets pss are 5 x 1 x 1 x 2 sin 6 π x 1 2 π where 1 x 1 3 the global pareto front pf are 6 f 2 1 f 1 where 0 f 1 1 its true pss and pf are illustrated in fig 3 more information on the other characteristics of the problems in the cec benchmark suite can be found in liang et al 2019 in this study two above mentioned benchmark problems were used to test and verify the performance of the utilized multi objective algorithms 2 4 performance metrics to evaluate the performance of the utilized algorithms four performance metrics of i generational distance gd van veldhuizen and lamont 1998 ii spacing s schott 1995 iii spread δ deb 2001 and iv maximum spread ms zitzler et al 2000 were used in this study eqs 7 to 10 7 gd 1 npf i 1 npf d i 2 1 2 8 s 1 npf 1 i 1 npf d i d 2 9 δ d f d l i 1 npf d i d d f d l n p f 1 d 10 ms 1 m i 1 m min f i max f i max m a x f i min f i min f i max f i min 2 1 2 where npf is the number of members derived from the pareto front pf d is euclidean distance between ith member in pfg and the closest member in pfoptimal d i min j f 1 i x f 1 j x f 2 i x f 2 j x i j 1 2 npf d is the mean of all di s df and dl are the distance between the extreme solutions starting and ending points in pfoptimal and pfg di refers to the distance between each point in pfg and the closest point in pfoptimal f i max and f i min are the maximum and minimum values of the ith objective in pfg respectively and f i max and f i min are the maximum and minimum values of the ith objective in pfoptimal respectively 2 5 case study halilrood with a length of 390 km is the largest river in terms of discharge in south east of iran halilrood basin with an area of 7224 km2 is one of the main basins of the country its elevation varies from 4359 m a s l at the upstream to 1391 m s a l at the downstream halilrood river flows into jazmurian wetland at its end point halilrood basin located between 56 51 to 61 30 east longitude and 26 18 to 29 30 north latitude there are three dams on the main channel and upstream tributaries of the halilrood river i baft earth dam with the purposes of agricultural drinking and industrial water supply ii jiroft concrete dam with the purposes of drinking industrial and agricultural water supply electricity generation and flood control and iii safa rood dam under construction with the purposes of agricultural drinking and industrial water supply these dams are in parallel and in series pairwise which have created a complex multi purpose multi reservoir system fig 4 shows the location of these dams in the halilrood basin the mentioned dams are of key importance in several aspects first the population density in this area is high so providing drinking water is one of the important priorities second halilrood basin is considered as one of the most important agricultural hubs of iran so the optimal water supply for agriculture is vital third this area is considered as one of the main flood prone areas and many destructive floods have occurred in the past which indicates the role of existing dams on the flood control fourth the jazmurian wetland is located at the endpoint of this basin which needs the environmental flow to be regularly supplied through the upstream dams fifth due to the hot climate of the region and as a result the high consumption of electricity by the residents for cooling equipment the jiroft dam hydropower station plays a key role in providing the electricity needed by the region it has an installed electricity generating capability of 85 mwh in the course of recent years there have been several water conflicts between the stakeholders therefore it is necessary to optimize the operation of this multi purpose multi reservoir system to determine its optimal operation policies in such a way that all the stakeholders are satisfied as much as possible 2 6 halilrood optimization model for the optimization of halilrood multi purpose multi reservoir system three objective functions were considered i minimization of the total deficiency in downstream demand ii minimization of the total difference between the volume of reservoirs and the volume required for flood control and iii maximization of the total potential of electricity generation of hydropower plants i e minimizing the total difference between the potential of electricity generation and the installation capacity of the power plant the decision variables in the optimization model include monthly releases from the reservoirs the study period was 223 months october 2000 april 2019 hence the studied algorithms had 892 decision variables 223 4 in the system meanwhile the volume of storage and the input to the reservoirs per period were considered as the state variables in the optimization problem data inputs to the model include the river flow rate the evaporation height the precipitation height and the volume of the demands on a monthly scale equations 11 13 express the objective functions of the downstream demand supply flood control and hydropower energy generation respectively 11 o f 1 m i n i 1 2 t 1 t de i t re i t de max i 2 t 1 t re 3 t power re 3 t de de 3 t de max 3 2 p e n a l t y 12 o f 2 m i n i 1 3 t 1 t s i t s i t target s max i 2 p e n a l t y 13 o f 3 m i n t 1 t 1 p 3 t ppc 3 p e n a l t y where de max i is the maximum monthly demand of reservoir i 106 m3 and de i t is the downstream demands of the ith reservoir during period t 106 m3 i is the reservoir index that i 1 is the reservoir of baft dam i 2 is the reservoir of safarood dam and i 3 is the reservoir of jiroft dam re i t is the volume of release from the ith reservoir during period t 106 m3 it should be noted that in the jiroft dam re 3 t is between the zero and the total maximum outputs from the reservoirs outlets and re 3 t power and re 3 t de refer to the amount of release from the hydropower outlet and downstream demand supply outlet in each period t per million m3 respectively penalty is penalty function that is applied to the objective function if the reservoir i storage is not satisfied in month t s i t is the storages of the ith reservoir at the beginning of period t 106 m3 s max i is the maximum storage in the ith reservoir during period t 106 m3 s i t target is the storage of flood control of the ith reservoir in the period t 106 m3 in the flood control objective function the purpose is to keep the storage constant about s i t target during all the operational periods in fact if the reservoir storage exceeds the desired storage the flood control purpose is not met and if it is lower the downstream demand supply purpose may not be met p 3 t refers to the energy generated by jiroft reservoir in the period t per mw and ppc 3 refers to the power plant capacity of jiroft reservoir per mw the constraints of the multi reservoir system studied are given in eqs 14 to 21 the constraints on the overflow volume and the evaporation loss were applied as follows 14 sp i t s i t s max i s min i i f s i t s max i s min i 0 i f s i t s max i s min i 15 loss i t a i t ev i t 16 a i t a i b i s i t c i s i t 2 where spi t is the water overflow from the ith reservoir during the period t 106 m3 si t is the storage of the ith reservoir at the beginning of the period t 106 m3 smax i is the maximum storage in the ith reservoir during the period t 106 m3 smin i is the minimum storage in the ith reservoir during the period t 106 m3 lossi t is the loss from the ith reservoir surface during the period t 106 m3 as the evaporation considering the area storage height functions of the reservoir calculated based on the equation 16 that ai t is area of the ith reservoir during period t km2 evi t is net evaporation evaporation minus precipitation from the ith reservoir during the period t m and ai bi and ci are coefficients of storage area relation for reservoir i dimensionless mass balance equations at all stages of the optimization of reservoir operation a mass balance should be established between the input and output values and the storage volume of the reservoir 17 s 1 t 1 s 1 t q 1 t re 1 t sp 1 t loss 1 t 18 s 2 t 1 s 2 t q 2 t re 2 t sp 2 t loss 2 t 19 s 3 t 1 s 3 t q 3 t sp 1 t sp 2 t re m i n 1 t re m i n 2 t re 3 t power re 3 t de sp 3 t loss 3 t where si t 1 is the storage of the ith reservoir at the end of period t 106 m3 and qi t is the volume of water inflow into the ith reservoir during the period t 106 m3 constraints of decision variables the constraint on the reservoir release can be expressed as 20 re min i t re i t re max i t where remin i t is the minimum allowable release from the ith reservoir during the period t 106 m3 remin i t is equal to the environmental demand and remax i t is the maximum allowable release from the ith reservoir during the period t 106 m3 remax i t is equal to the total demand penalty function related to the storage of reservoirs the reservoir storage should not be less than the minimum storage smin i and more than the maximum storage smax i for this purpose a penalty function was defined in equation 21 since the algorithms try to minimize the objective functions the penalty function is added if the constraint of reservoir storage is not met 21 penalty t 1 t i 1 3 s i t s min i 2 i f s i t s min i t 1 t i 1 3 s i t s max i 2 i f s i t s max i 0 i f s i t s min i a n d s i t s max i 2 7 jiroft dam hydropower energy generation formulations the other terms and conditions which were considered for optimizing the hydropower energy generation are expressed as eqs 22 through 27 bozorg haddad et al 2017 22 p 3 t g e 3 t rp 3 t pf 3 mul t h 3 t tw 3 t 1000 23 h 3 t h 3 t h 3 t 1 2 24 h 3 t a 0 a 1 s 3 t a 2 s 3 t 2 a 3 s 3 t 3 25 tw 3 t b 0 b 1 re 3 t power b 2 re 3 t power 2 b 3 re 3 t power 3 26 rps 3 t re 3 t power rp 3 t 27 0 p 3 t ppc 3 where g refers to the gravity acceleration 9 81 m s2 e 3 t refers to the jiroft power plant efficiency assumed to be constant for all periods pf 3 refers to the operating coefficient of jiroft power plant mul t refers to the conversion factor of million m3 per second in period t h 3 t refers to the average water level of jiroft reservoir in the period t per m h 3 t refers to water level of jiroft reservoir at the beginning of the t period per m h 3 t 1 refers to the water level of jiroft reservoir at the end of period t per m tw 3 t refers to the tail water level of jiroft reservoir in the period t per m a 0 a 1 a 2 and a 3 are constant coefficients of conversion of reservoir volume into the corresponding height in jiroft reservoir b 0 b 1 b 2 and b 3 are constant coefficients of conversion of water outflow from the power plant into the tail water level in jiroft reservoir rp 3 t refers to the release rate of hydropower outlet to generate the electricity in jiroft reservoir in the period t 106 m3 rps 3 t refers to the overflow from the hydropower outlet of the jiroft reservoir in the period t 106 m3 to have a reliable and fair comparison the values of the algorithms parameters were considered to be the same for all the utilized algorithms accordingly the number of iterations the population size and the pareto front archive size for all the utilized algorithms were considered equal to 1000 300 and 200 for the schaffer and cec 2020 mmf1 problem and 1000 500 and 300 for halilrood problem respectively the tuning parameters of each algorithm were determined by the sensitivity analysis in such a way that the optimal value of each parameter was obtained by varying a parameter in its assigned range while keeping the other parameters fixed 2 8 reservoir s performance evaluation indicators in this study four indicators of reliability rel vulnerability vul resiliency res and sustainability index si were used eqs 28 30 to evaluate the performance of the system as introduced by hashimoto et al 1982 and sandoval solis et al 2011 28 re l 1 nd e f t n d ef n u m b e r i f d e t re t 29 v a l m a x d e t r e t d e t 100 t 1 2 t 30 r e s t n t 1 d e f t 1 0 d e f t 0 t n t 1 d e f t 0 100 t 1 2 t 31 si re l re s 1 v u l 1 3 where ndef refers to the total number of failures that occurred during the operation period det refers to the demand in the period t ret is the release in the period t rel indicates the reliability of the system during the operation period val refers to the system vulnerability t indicates the total number of operating periods t n t 1 refers to the number of periods in which the condition in the parentheses has occurred and deft refers to the deficiency in period t 3 results and discussion the purpose of this study was to assess the capability of 20 robust recently introduced meta heuristics algorithms in the optimal operation of halilrood multi reservoir system as mentioned earlier before the modeling of the real case system the performance of these algorithms on the two benchmark problems of schaffer and mmf1 was investigated here the results of the study for the benchmark problems and the real case multi reservoir system are presented in respect 3 1 comparison of the utilized algorithms in solving the benchmark problems fig 5 shows the performance of the utilized algorithms in solving the schaffer problem as seen the pareto front obtained by the moaha the nswoa and the nsgwo algorithms was better than the others in terms of coverage and diversity in return some of the utilized algorithms the mssa the mobo and the mocrystal algorithms had poor diversity or poor coverage with the optimal pareto front for example the mssa and the mobo algorithms had poor diversity despite their good coverage quantitatively table 2 provided the values of performance metrics of the utilized algorithms in the solution of the schaffer problem in this table the rank of each algorithm was obtained by the ranking system proposed by shahr babak et al 2016 to get the overall rank of an algorithm first the rank of that algorithm was determined for each of the performance metrics separately then the sum of the ranks of that algorithm for all metrics was calculated then the algorithm whose sum of ranks was the lowest is considered as the algorithm with rank 1 and the algorithm that has the largest value of the sum of ranks is placed in the last rank the rest fall in between these two descending an algorithm is more robust when its rank is lower it is observed that the moaha algorithm with the performance metrics of gd 0 00095 s 0 58155 δ 0 20375 and ms 4 00020 obtained the best rank among the utilized algorithms followed by the nstlbo algorithm rank 2 and the nswoa algorithm rank 3 the worst performance was devoted to the mocrystal algorithm with gd 0 00141 s 0 48395 δ 1 49467 and ms 3 94799 nevertheless it can be found from fig 5 and table 2 that the performance of all the utilized algorithms was satisfactory most of the algorithms produced good pareto fronts in terms of coverage and diversity this may be because of the simplicity of the schaffer problem fig 6 illustrates the results of the utilized algorithms in solving the cec2020 mmf1 problem as seen the moma moaha mola moteo and momsa algorithms had a significant performance in solving the mmf1 problem the pareto front obtained by these algorithms has a remarkable coverage and diversity with the optimal pareto front on the other side the two algorithms of mofa and nstlbo had the worst performance the non dominated solutions produced by them had the least overlap by the optimal pareto front and the solution points are completely scattered or concentrated in only a certain region a number of algorithms e g the mofpa the moda the mssa and the mocrystal algorithms although they had a good coverage with the optimal pareto front but did not have a proper distribution some algorithms the moagde the mofpa and the mospo algorithms created a surplus coverage on the optimal pareto front despite their satisfactory diversity these visual results are consistent with the quantitative values presented in table 3 as seen the moma algorithm with the performance metrics of gd 0 00751 s 0 07516 δ 0 29519 ms 0 99826 placed at the first rank and the algorithms of moaha mola moteo and momsa took the second to the fifth rank on the other side the mofa algorithm was the worst algorithm followed by the nstlbo and the mofpa algorithms 3 2 comparison of the utilized algorithms in solving the halilrood multi reservoir problem table 4 shows the reservoir s performance evaluation indicators for the optimization model of the halilrood multi reservoir system in this real case the mogwo 2015 algorithm with the sustainability index of 76 01 obtained the first rank among the applied algorithms the values of the reliability resiliency and vulnerability for this algorithm were 83 41 rel 67 57 res and 22 07 vul respectively after that the moaha algorithm rel 84 57 res 64 71 and vul 33 60 followed by the moma algorithm rel 79 82 res 66 67 and vul 21 65 and the nswoa algorithm rel 83 41 res 56 76 and vol 27 07 placed at the rank 2 to the rank 4 respectively in the optimization of halilrood multi reservoir system the mosma algorithm demonstrated the worst performance and consequently was placed at rank 20 among the 20 algorithms by comparing the results of the benchmark problems with those of the halilrood problem it was found that some algorithms that performed better in solving the benchmark problems showed poor results in solving the real halilrood problem and vice versa in fact as the dimensions of the problem became large those algorithms were no longer able to solve the problem albeit for both the benchmarks and real case problems the moaha algorithm presented significant results table 5 represents the rank of utilized algorithms based on the values of objective functions in this case three algorithms of moaha with td 25 86 fc 74 85 and te 5007 37 and the mogwo with td 29 48 fc 70 36 and te 4905 69 and the mobo with td 123 76 fc 53 32 and te 6128 70 were superior to the other algorithms they could successfully achieve the minimum values for the total deficit and the flood control objectives while generating the maximum hydropower energy the next rank rank 4 belongs to the moma and the nswoa algorithms the nstlbo and the mosma algorithms failed to produce reasonable solutions therefore they were placed at rank of 20 and 19 out of 20 respectively table 6 indicates the optimized values of three objective functions by the utilized algorithms column 4 of this table shows the sum of objectives produced by each algorithm the smaller the values in this column indicates the better performance of the corresponding algorithm as seen the sum of objectives for three algorithms of the mogwo with the sum of objectives 205 21 the moma with the sum of objectives 207 95 and the moaha with the sum of objectives 208 87 were less than the other algorithms indicating their higher performance in optimizing the halilrood problem in this problem the nstlbo algorithm with the sum of objectives of 441 59 had the poorest performance among the utilized algorithms as mentioned earlier in multi objective problems the objective functions are often conflicting therefore a solution which is simultaneously optimal for all the objective functions may not exist instead there would be a series of optimal solutions called pareto front the multi objective optimization algorithms produce a set of non dominated solutions which are near the optimal solutions for any combination of objectives with an appropriate diversity for the halilrood multi reservoir problem each point on the pareto curve represents an optimal operation policy fig 7 illustrates the three dimensional view of the pareto front obtained by the utilized meta heuristic algorithms in this figure the two dimensional view of the pareto front is also displayed along the axes of the three dimensional diagram here the closer the solution points to the origin of the coordinates the lower the pareto front level the more appropriate they are as seen while the pareto front for some algorithms e g the mogwo algorithm the moma algorithm the imomrfo algorithm the momsa algorithm the moaha algorithm and the mola algorithm had an appropriate distribution of solutions around the pareto front had an outstanding quality in terms of coverage and diversity for some other algorithms e g the mofa algorithm the mofpa algorithm the nstlbo algorithm the mojaya algorithm and the mospo algorithm poor results were obtained as seen in both 3d and 2d views the pareto front obtained by the momsa algorithm has good diversity and good coverage which means all the non dominated solutions were distributed uniformly along the pareto front this proves the high capability of this algorithm in the simultaneous optimization of all the three objective functions of1 of2 of3 of the halilrood problem but on the contrary the solutions obtained by the mofa algorithm for example did not form a clear pareto front and the obtained solution points were quite scattered this indicates the poor performance of this algorithm in solving the halilrood problem fig 8 illustrates the optimized power generation by the utilized algorithms compared to the nominal capacity of the power plant ppc of the jiroft dam as well as the actual power generation during the study period as seen the mobo algorithm has been able to optimize the operation of the jiroft dam in such a way that the maximum electricity 6128 70 mwh was generated in most months of the year so that in several months june to august the amount of electricity production was very close to the ppc indicating the energy generation up to 100 of the ppc capacity it was found that although most of the meta heuristic algorithms have been able to significantly increase hydropower generation some algorithms were superior fig 9 shows the results of the meta heuristic algorithms in the optimization of halilrood multi reservoir system operation in terms of allocating the total water demands of the system as seen most of the utilized algorithms could supply the total water demand in the halilrood system in detail the moaha algorithm was able to supply about 100 of the total demand from october to march and july also in the remained months april june and august september this algorithm could approximately supply the major part of the total demands in this case the mosma algorithm was the weakest algorithm and had the worst performance in allocating the total water demands 4 conclusion deriving operating rules for multi objective multi reservoir systems is an important challenge in water resources management meta heuristic algorithms are promising tools to derive the operating policy for such reservoir systems this study investigated the capability of 20 multi objective meta heuristics in solving two well known benchmark problems schaffer and mmf1 in cec suite and one real case multi reservoir system halilrood system a series of performance evaluation criteria were employed to compare the algorithms efficiency in each problem for the schaffer benchmark problem it was found that the moaha and mocrystal algorithms had the best and the worst performance respectively for the mmf1 benchmark problem the highest rank was devoted to the moma algorithm while the mofa algorithm got the lowest rank for both the benchmark problems most of the utilized algorithms produced good solutions compared to the optimal pareto front in terms of coverage and diversity however for the halilrood problem because of the high complexity of the problem the performance of most of the algorithms dramatically decreased it was observed that three algorithms of mogwo moaha and mobo were efficiently able to minimize all the objective functions in the halilrood problem that means that they have been able to optimize the operation of the halilrood multi reservoir system in such a way that the hydropower generation was increased while the downstream water demands and the flood damage were decreased this was consistent with the pareto front produced by these algorithms the results of this study can be used for the optimal operation of other complex systems of reservoirs over the world credit authorship contribution statement mohammad reza sharifi conceptualization data curation formal analysis visualization saeid akbarifard software methodology validation writing original draft mohamad reza madadi methodology writing original draft writing review editing hossein akbarifard conceptualization visualization formal analysis kourosh qaderi visualization conceptualization declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper 
2880,optimal operation of multi purpose multi reservoir dams is a challenging problem for dams stakeholders and decision makers optimization algorithms are able to present reliable solutions for such complex problems this study compared the capability of 20 state of the art robust meta heuristic algorithms for determining the optimal operating policy of halilrood multi reservoir system under the three competing operational objectives of water supply flood control and hydropower generation before that the performance of the algorithms in solving two benchmark problems the schaffer problem and the mmf1 problem from the cec suite was evaluated four metrics of generational distance gd spacing s spread δ and maximum spread ms were used to compare the algorithms performance in solving the benchmark problems in addition four reservoirs performance evaluation indicators of reliability rel resiliency res vulnerability vul and sustainability index si were used to ass the algorithms performance in solving the real case halilrood problem the results showed that although the solving capability of each algorithm depends on the nature of the problem some algorithms were always superior in solving all three problems 2 benchmark problems and one real case for the schaffer benchmark problem the moaha algorithm with the performance metrics of gd 0 00095 s 0 58155 δ 0 20375 ms 4 0002 had the best pareto front in terms of coverage and diversity and so it was placed at the first rank in this problem the mocrystal algorithm with gd 0 00141 s 0 48395 δ 1 49467 ms 3 94799 placed at the lowest rank for the mmf1 problem the moma gd 0 00751 s 0 07516 δ 0 29519 ms 0 99826 followed by the moaha gd 0 00833 s 0 07660 δ 0 17832 ms 1 00 had the best performance respectively and the mofa algorithms was the worst for the halilrood real case problem the mogwo algorithm with rel 83 41 res 67 57 vul 22 07 and si 76 01 followed by the moaha algorithm rel 84 57 res 64 71 vul 33 60 and si 71 41 and the moma algorithm rel 79 82 res 66 67 vul 21 65 and si 74 70 obtained the best ranks in terms of reservoir s performance evaluation indicators they could successfully minimize all three objectives of the total deficit the flood control and electricity generation indicating the highest performance of these algorithms in the optimization problem the pareto front obtained by these algorithms had better distribution and was closer to the origin of coordinates compared to the other utilized algorithms they could favorably supply the total water demand in the halilrood basin while increasing the hydropower energy generation up to the power plant capacity at the jiroft dam the results of this study can be applied to the optimal operation of any other multi reservoir system with conflict in water demands keywords nature inspired algorithm water supply parallel reservoirs cascade reservoirs operation policy data availability data will be made available on request 1 introduction deriving optimal operational policies for multi purpose multi reservoir systems is very complicated because of the large dimension of the problem the conflicts among the different objectives and the stochastic nature of the effective parameters such complexity has created a tendency among the researchers toward developing efficient methods for optimization of multi reservoirs operation traditional optimization techniques due to their several limitations are not reliable tools for such complex problems in contrast the meta heuristic methods because of their many proven advantages have become very popular in solving complex optimization problems yıldız et al 2020 yıldız and erdaş 2021 yıldız et al 2021a b they have many respective merits such as ease of use high accuracy gradient free mechanism broad applicability local optima avoidance and satisfying results yıldız et al 2021c d accordingly in the course of recent years the meta heuristics have been acknowledged as promising tools to support decision making in various hydrology and water resources engineering problems akbarifard et al 2021 sharifi et al 2022a b here some most recently published works published in the last five years on the use of meta heuristic algorithms focusing on the multi objective algorithms in the optimization of reservoirs operation are reviewed qaderi et al 2018 used the water cycle algorithm wca for the optimal operation of gorganrood multi reservoir system the results showed the superiority of the wca to the other investigated algorithms such as the genetic algorithm ga and the particle swarm optimization pso algorithm ehteram et al 2018 proposed an improved weed algorithm iwa for aswan high dam operation with the aim of decreasing the irrigation deficits the proposed algorithm demonstrated superior performance to the weed algorithm wa the bat algorithm ba the improved particle swarm optimization algorithm ipsoa and the ga in terms of the objective function the computational time and the reliability index liu et al 2020 used the lion pride algorithm lpa to optimize the operation of a dual objective reservoir and reported the appreciated performance of this algorithm sharifi et al 2021b improved the moth swarm algorithm msa with the fitness distance balance fdb selection method to achieve promoted fdb msa for optimizing hydropower generation of a multi reservoir system along the karun river in iran the results showed that the fdb msa could successfully increase the hydropower generation in the optimization model sharifazari et al 2021 used the nash bargaining solution and the evolutionary algorithms genetic and ant colony optimization algorithms to achieve the optimal solutions of a real case reservoir operation problem the results showed that the utilized method led to a successful water supply for all stakeholders goharian et al 2021 used the cellular automata approach to optimize the daily hydropower reservoir operation of the folsom dam in california they evaluated the performance of the mentioned approach under two extreme climate conditions and compared the results with the operation during normal conditions the results showed that the utilized approach provides more efficient solutions compared to the commonly used ga yaghoubzadeh bavandpour et al 2022 applied four optimization algorithms including pso teaching learning based optimization algorithm tlbo cultural algorithm and ga to determine the optimal operation of the aydoghmoush reservoir in iran the results indicated the acceptable performance of all algorithms in finding the optimal solutions for reservoir operation as well as the superior performance of the swarm intelligence algorithms to the evolutionary algorithms in terms of accuracy of solutions convergence rate and run time to reach global optima yang et al 2020 combined a radial basis function rbf network with an evolutionary algorithm to produce a heuristic input variable selection his method that extracts hanjiang reservoirs operating rules based on the feature selection the results demonstrated that the his combined with the rbf could accurately extract the reservoir operating rules afshar and hajiabadi 2019 used a weighted cellular automaton to optimize the dez reservoir operation considering two objectives of water supply and hydropower generation the results indicated that the utilized method was highly efficient compared to the nsga ii sun et al 2018 applied the multi objective evolutionary algorithm based on decomposition with adaptive weight vector adjustment moea d awa to solve the huangjinxia reservoir operation problem the results showed that the proposed model was effective and could provide decision support for reservoir operation zhang et al 2018 used the deep learning algorithm in comparison with the artificial neural network ann and support vector regression svr to simulate the reservoir operation the results showed that deep learning models are useful tools to assist for decision making in reservoir operation yaseen et al 2019 proposed a hybrid optimization algorithm based on the ba and pso algorithms called the hybrid bat swarm algorithm hb sa to optimize the operation of golestan and voshmgir multi reservoir system in iran the results showed that the proposed hb sa algorithm outperformed the other optimization algorithms in terms of the water supply and the computational time for the convergence procedure niu et al 2018 proposed a parallel multi objective particle swarm optimization pmopso for cascade hydropower reservoir operation in southwest china the results showed that pmopso could provide satisfying scheduling results in different cases kumar and yadav 2022 proposed the self adaptive multi population multi objective jaya algorithm samp moja to extract multi purpose reservoir operation policies the results were compared with those of the multi objective jaya algorithm moja and the multi objective pso algorithm the results indicated that the samp ja was better than the ja the pso and the iwo in terms of maximum hydropower generation and the algorithm convergence rate zhong et al 2022 used the chaos optimization algorithm coa to optimize the reservoir operation of cascade hydropower stations the results showed that the mentioned algorithm could solve the reservoir operation problem with high accuracy and fast convergence speed mansouri et al 2022 employed an improved version of the fuzzy multi objective pso algorithm f mopso for optimization of reservoir operation under climate change the results indicated the superior performance of f mopso to the nsga ii in meeting the water demands and holding the reservoir storage sustainable there are many other publications on the application of meta heuristic algorithms for optimization of various engineering problems as well however there is no optimization method capable of solving all optimization problems as stated by the no free lunch theorem wolpert and macready 1997 that means a given optimization algorithm may perform very well in solving a specific optimization problem but it may not be capable of reasonably solving another optimization problem therefore for each particular problem the most appropriate optimization algorithms should be chosen from the list of candidate algorithms this encourages the researchers to evaluate the capability of various optimization algorithms for different categories of problems in the study field 2 materials and methods the operation of multi objective multi reservoir systems is a complex engineering problem that needs the application of robust multi objective meta heuristic algorithms to solve as stated earlier the purpose of this study was to evaluate the capability of 20 state of the art meta heuristic algorithms for the optimization of halilroud multi purpose multi reservoir system operation table 1 listed the 20 meta heuristic algorithms investigated in this study all these algorithms have been proven as very powerful meta heuristic algorithms in solving different multi objective optimization problems 13 out of 20 of these algorithms have been developed in the last two years due to the page limits of the paper the details of each algorithm are referred to the primary reference of each article as presented in table 1 2 1 mathematical model of multi objective problems eq 1 indicates the mathematical form of the objective function of a multi objective optimization problem 1 f x f 1 x f 2 x f m x t in which x x 1 x 2 x 3 x d is the vector of variables and d and m refer to the number of variables and objectives respectively the common solution for multi objective optimization problems is to keep a set of the best solutions in an archive and update it per iteration in this approach the best solutions are defined as non dominant solutions or pareto optimal solutions in other word for multi objective problems there are a set of optimal solutions instead of a single solution they are known as pareto optimal solutions for a solution to be a non dominant solution the following conditions should be met coello 2000 i pareto dominance u u 1 u 2 u 3 u n v v 1 v 2 v 3 v n if and only if u is slightly lower than v in the objective space which means 2 f i u f i v i f i u f i v i i 1 2 3 m ii pareto optimal solution u vector is an optimal solution if and only if none of the other solutions can dominate u a set of pareto optimal solutions is called pareto optimal front pfoptimal fig 1 shows that among the three solutions of a b and c the solution c has the highest values for f1 and f2 therefore it is considered the dominant solution solutions of a and b are considered the non dominant solutions 2 2 schaffer benchmark problem schaffer 1984 presented a benchmark problem for evaluating the capability of multi objective optimization models this convex problem is a single variable problem with two objectives to be minimized eq 3 this benchmark has been a strong point of reference up to now almost every multi objective ea has been tested on this problem 3 m i n i m i z e f x f 1 x f 2 x s u b j e c t t o f 1 x x 2 f 2 x x 2 2 the goal is to minimize f1 and f2 simultaneously as demonstrated in fig 2 the pareto optimal points are located in the range where x 0 2 outside this interval f1 and f2 are increasing while within the interval there is a trade off between the two functions one is increasing while the other is decreasing 2 3 mmf1 benchmark problem mmf1 is a problem from the benchmark problems of the completions on evolutionary computation cec 2020 the cec 2020 is known as the most up to date and prestigious multimodal multi objective benchmark suite there are four different types of benchmark problems in the cec 2020 benchmark suite according to the forms of the objective and decision spaces including convex linear convex nonlinear concave linear and concave for the mmf1 the equations and figures of pareto optimal set ps and pareto front pf are as follows 4 f 1 x 1 2 f 2 1 x 1 2 2 x 2 sin 6 π x 1 2 π 2 where the search space is x 1 1 3 x 2 1 1 the global pareto sets pss are 5 x 1 x 1 x 2 sin 6 π x 1 2 π where 1 x 1 3 the global pareto front pf are 6 f 2 1 f 1 where 0 f 1 1 its true pss and pf are illustrated in fig 3 more information on the other characteristics of the problems in the cec benchmark suite can be found in liang et al 2019 in this study two above mentioned benchmark problems were used to test and verify the performance of the utilized multi objective algorithms 2 4 performance metrics to evaluate the performance of the utilized algorithms four performance metrics of i generational distance gd van veldhuizen and lamont 1998 ii spacing s schott 1995 iii spread δ deb 2001 and iv maximum spread ms zitzler et al 2000 were used in this study eqs 7 to 10 7 gd 1 npf i 1 npf d i 2 1 2 8 s 1 npf 1 i 1 npf d i d 2 9 δ d f d l i 1 npf d i d d f d l n p f 1 d 10 ms 1 m i 1 m min f i max f i max m a x f i min f i min f i max f i min 2 1 2 where npf is the number of members derived from the pareto front pf d is euclidean distance between ith member in pfg and the closest member in pfoptimal d i min j f 1 i x f 1 j x f 2 i x f 2 j x i j 1 2 npf d is the mean of all di s df and dl are the distance between the extreme solutions starting and ending points in pfoptimal and pfg di refers to the distance between each point in pfg and the closest point in pfoptimal f i max and f i min are the maximum and minimum values of the ith objective in pfg respectively and f i max and f i min are the maximum and minimum values of the ith objective in pfoptimal respectively 2 5 case study halilrood with a length of 390 km is the largest river in terms of discharge in south east of iran halilrood basin with an area of 7224 km2 is one of the main basins of the country its elevation varies from 4359 m a s l at the upstream to 1391 m s a l at the downstream halilrood river flows into jazmurian wetland at its end point halilrood basin located between 56 51 to 61 30 east longitude and 26 18 to 29 30 north latitude there are three dams on the main channel and upstream tributaries of the halilrood river i baft earth dam with the purposes of agricultural drinking and industrial water supply ii jiroft concrete dam with the purposes of drinking industrial and agricultural water supply electricity generation and flood control and iii safa rood dam under construction with the purposes of agricultural drinking and industrial water supply these dams are in parallel and in series pairwise which have created a complex multi purpose multi reservoir system fig 4 shows the location of these dams in the halilrood basin the mentioned dams are of key importance in several aspects first the population density in this area is high so providing drinking water is one of the important priorities second halilrood basin is considered as one of the most important agricultural hubs of iran so the optimal water supply for agriculture is vital third this area is considered as one of the main flood prone areas and many destructive floods have occurred in the past which indicates the role of existing dams on the flood control fourth the jazmurian wetland is located at the endpoint of this basin which needs the environmental flow to be regularly supplied through the upstream dams fifth due to the hot climate of the region and as a result the high consumption of electricity by the residents for cooling equipment the jiroft dam hydropower station plays a key role in providing the electricity needed by the region it has an installed electricity generating capability of 85 mwh in the course of recent years there have been several water conflicts between the stakeholders therefore it is necessary to optimize the operation of this multi purpose multi reservoir system to determine its optimal operation policies in such a way that all the stakeholders are satisfied as much as possible 2 6 halilrood optimization model for the optimization of halilrood multi purpose multi reservoir system three objective functions were considered i minimization of the total deficiency in downstream demand ii minimization of the total difference between the volume of reservoirs and the volume required for flood control and iii maximization of the total potential of electricity generation of hydropower plants i e minimizing the total difference between the potential of electricity generation and the installation capacity of the power plant the decision variables in the optimization model include monthly releases from the reservoirs the study period was 223 months october 2000 april 2019 hence the studied algorithms had 892 decision variables 223 4 in the system meanwhile the volume of storage and the input to the reservoirs per period were considered as the state variables in the optimization problem data inputs to the model include the river flow rate the evaporation height the precipitation height and the volume of the demands on a monthly scale equations 11 13 express the objective functions of the downstream demand supply flood control and hydropower energy generation respectively 11 o f 1 m i n i 1 2 t 1 t de i t re i t de max i 2 t 1 t re 3 t power re 3 t de de 3 t de max 3 2 p e n a l t y 12 o f 2 m i n i 1 3 t 1 t s i t s i t target s max i 2 p e n a l t y 13 o f 3 m i n t 1 t 1 p 3 t ppc 3 p e n a l t y where de max i is the maximum monthly demand of reservoir i 106 m3 and de i t is the downstream demands of the ith reservoir during period t 106 m3 i is the reservoir index that i 1 is the reservoir of baft dam i 2 is the reservoir of safarood dam and i 3 is the reservoir of jiroft dam re i t is the volume of release from the ith reservoir during period t 106 m3 it should be noted that in the jiroft dam re 3 t is between the zero and the total maximum outputs from the reservoirs outlets and re 3 t power and re 3 t de refer to the amount of release from the hydropower outlet and downstream demand supply outlet in each period t per million m3 respectively penalty is penalty function that is applied to the objective function if the reservoir i storage is not satisfied in month t s i t is the storages of the ith reservoir at the beginning of period t 106 m3 s max i is the maximum storage in the ith reservoir during period t 106 m3 s i t target is the storage of flood control of the ith reservoir in the period t 106 m3 in the flood control objective function the purpose is to keep the storage constant about s i t target during all the operational periods in fact if the reservoir storage exceeds the desired storage the flood control purpose is not met and if it is lower the downstream demand supply purpose may not be met p 3 t refers to the energy generated by jiroft reservoir in the period t per mw and ppc 3 refers to the power plant capacity of jiroft reservoir per mw the constraints of the multi reservoir system studied are given in eqs 14 to 21 the constraints on the overflow volume and the evaporation loss were applied as follows 14 sp i t s i t s max i s min i i f s i t s max i s min i 0 i f s i t s max i s min i 15 loss i t a i t ev i t 16 a i t a i b i s i t c i s i t 2 where spi t is the water overflow from the ith reservoir during the period t 106 m3 si t is the storage of the ith reservoir at the beginning of the period t 106 m3 smax i is the maximum storage in the ith reservoir during the period t 106 m3 smin i is the minimum storage in the ith reservoir during the period t 106 m3 lossi t is the loss from the ith reservoir surface during the period t 106 m3 as the evaporation considering the area storage height functions of the reservoir calculated based on the equation 16 that ai t is area of the ith reservoir during period t km2 evi t is net evaporation evaporation minus precipitation from the ith reservoir during the period t m and ai bi and ci are coefficients of storage area relation for reservoir i dimensionless mass balance equations at all stages of the optimization of reservoir operation a mass balance should be established between the input and output values and the storage volume of the reservoir 17 s 1 t 1 s 1 t q 1 t re 1 t sp 1 t loss 1 t 18 s 2 t 1 s 2 t q 2 t re 2 t sp 2 t loss 2 t 19 s 3 t 1 s 3 t q 3 t sp 1 t sp 2 t re m i n 1 t re m i n 2 t re 3 t power re 3 t de sp 3 t loss 3 t where si t 1 is the storage of the ith reservoir at the end of period t 106 m3 and qi t is the volume of water inflow into the ith reservoir during the period t 106 m3 constraints of decision variables the constraint on the reservoir release can be expressed as 20 re min i t re i t re max i t where remin i t is the minimum allowable release from the ith reservoir during the period t 106 m3 remin i t is equal to the environmental demand and remax i t is the maximum allowable release from the ith reservoir during the period t 106 m3 remax i t is equal to the total demand penalty function related to the storage of reservoirs the reservoir storage should not be less than the minimum storage smin i and more than the maximum storage smax i for this purpose a penalty function was defined in equation 21 since the algorithms try to minimize the objective functions the penalty function is added if the constraint of reservoir storage is not met 21 penalty t 1 t i 1 3 s i t s min i 2 i f s i t s min i t 1 t i 1 3 s i t s max i 2 i f s i t s max i 0 i f s i t s min i a n d s i t s max i 2 7 jiroft dam hydropower energy generation formulations the other terms and conditions which were considered for optimizing the hydropower energy generation are expressed as eqs 22 through 27 bozorg haddad et al 2017 22 p 3 t g e 3 t rp 3 t pf 3 mul t h 3 t tw 3 t 1000 23 h 3 t h 3 t h 3 t 1 2 24 h 3 t a 0 a 1 s 3 t a 2 s 3 t 2 a 3 s 3 t 3 25 tw 3 t b 0 b 1 re 3 t power b 2 re 3 t power 2 b 3 re 3 t power 3 26 rps 3 t re 3 t power rp 3 t 27 0 p 3 t ppc 3 where g refers to the gravity acceleration 9 81 m s2 e 3 t refers to the jiroft power plant efficiency assumed to be constant for all periods pf 3 refers to the operating coefficient of jiroft power plant mul t refers to the conversion factor of million m3 per second in period t h 3 t refers to the average water level of jiroft reservoir in the period t per m h 3 t refers to water level of jiroft reservoir at the beginning of the t period per m h 3 t 1 refers to the water level of jiroft reservoir at the end of period t per m tw 3 t refers to the tail water level of jiroft reservoir in the period t per m a 0 a 1 a 2 and a 3 are constant coefficients of conversion of reservoir volume into the corresponding height in jiroft reservoir b 0 b 1 b 2 and b 3 are constant coefficients of conversion of water outflow from the power plant into the tail water level in jiroft reservoir rp 3 t refers to the release rate of hydropower outlet to generate the electricity in jiroft reservoir in the period t 106 m3 rps 3 t refers to the overflow from the hydropower outlet of the jiroft reservoir in the period t 106 m3 to have a reliable and fair comparison the values of the algorithms parameters were considered to be the same for all the utilized algorithms accordingly the number of iterations the population size and the pareto front archive size for all the utilized algorithms were considered equal to 1000 300 and 200 for the schaffer and cec 2020 mmf1 problem and 1000 500 and 300 for halilrood problem respectively the tuning parameters of each algorithm were determined by the sensitivity analysis in such a way that the optimal value of each parameter was obtained by varying a parameter in its assigned range while keeping the other parameters fixed 2 8 reservoir s performance evaluation indicators in this study four indicators of reliability rel vulnerability vul resiliency res and sustainability index si were used eqs 28 30 to evaluate the performance of the system as introduced by hashimoto et al 1982 and sandoval solis et al 2011 28 re l 1 nd e f t n d ef n u m b e r i f d e t re t 29 v a l m a x d e t r e t d e t 100 t 1 2 t 30 r e s t n t 1 d e f t 1 0 d e f t 0 t n t 1 d e f t 0 100 t 1 2 t 31 si re l re s 1 v u l 1 3 where ndef refers to the total number of failures that occurred during the operation period det refers to the demand in the period t ret is the release in the period t rel indicates the reliability of the system during the operation period val refers to the system vulnerability t indicates the total number of operating periods t n t 1 refers to the number of periods in which the condition in the parentheses has occurred and deft refers to the deficiency in period t 3 results and discussion the purpose of this study was to assess the capability of 20 robust recently introduced meta heuristics algorithms in the optimal operation of halilrood multi reservoir system as mentioned earlier before the modeling of the real case system the performance of these algorithms on the two benchmark problems of schaffer and mmf1 was investigated here the results of the study for the benchmark problems and the real case multi reservoir system are presented in respect 3 1 comparison of the utilized algorithms in solving the benchmark problems fig 5 shows the performance of the utilized algorithms in solving the schaffer problem as seen the pareto front obtained by the moaha the nswoa and the nsgwo algorithms was better than the others in terms of coverage and diversity in return some of the utilized algorithms the mssa the mobo and the mocrystal algorithms had poor diversity or poor coverage with the optimal pareto front for example the mssa and the mobo algorithms had poor diversity despite their good coverage quantitatively table 2 provided the values of performance metrics of the utilized algorithms in the solution of the schaffer problem in this table the rank of each algorithm was obtained by the ranking system proposed by shahr babak et al 2016 to get the overall rank of an algorithm first the rank of that algorithm was determined for each of the performance metrics separately then the sum of the ranks of that algorithm for all metrics was calculated then the algorithm whose sum of ranks was the lowest is considered as the algorithm with rank 1 and the algorithm that has the largest value of the sum of ranks is placed in the last rank the rest fall in between these two descending an algorithm is more robust when its rank is lower it is observed that the moaha algorithm with the performance metrics of gd 0 00095 s 0 58155 δ 0 20375 and ms 4 00020 obtained the best rank among the utilized algorithms followed by the nstlbo algorithm rank 2 and the nswoa algorithm rank 3 the worst performance was devoted to the mocrystal algorithm with gd 0 00141 s 0 48395 δ 1 49467 and ms 3 94799 nevertheless it can be found from fig 5 and table 2 that the performance of all the utilized algorithms was satisfactory most of the algorithms produced good pareto fronts in terms of coverage and diversity this may be because of the simplicity of the schaffer problem fig 6 illustrates the results of the utilized algorithms in solving the cec2020 mmf1 problem as seen the moma moaha mola moteo and momsa algorithms had a significant performance in solving the mmf1 problem the pareto front obtained by these algorithms has a remarkable coverage and diversity with the optimal pareto front on the other side the two algorithms of mofa and nstlbo had the worst performance the non dominated solutions produced by them had the least overlap by the optimal pareto front and the solution points are completely scattered or concentrated in only a certain region a number of algorithms e g the mofpa the moda the mssa and the mocrystal algorithms although they had a good coverage with the optimal pareto front but did not have a proper distribution some algorithms the moagde the mofpa and the mospo algorithms created a surplus coverage on the optimal pareto front despite their satisfactory diversity these visual results are consistent with the quantitative values presented in table 3 as seen the moma algorithm with the performance metrics of gd 0 00751 s 0 07516 δ 0 29519 ms 0 99826 placed at the first rank and the algorithms of moaha mola moteo and momsa took the second to the fifth rank on the other side the mofa algorithm was the worst algorithm followed by the nstlbo and the mofpa algorithms 3 2 comparison of the utilized algorithms in solving the halilrood multi reservoir problem table 4 shows the reservoir s performance evaluation indicators for the optimization model of the halilrood multi reservoir system in this real case the mogwo 2015 algorithm with the sustainability index of 76 01 obtained the first rank among the applied algorithms the values of the reliability resiliency and vulnerability for this algorithm were 83 41 rel 67 57 res and 22 07 vul respectively after that the moaha algorithm rel 84 57 res 64 71 and vul 33 60 followed by the moma algorithm rel 79 82 res 66 67 and vul 21 65 and the nswoa algorithm rel 83 41 res 56 76 and vol 27 07 placed at the rank 2 to the rank 4 respectively in the optimization of halilrood multi reservoir system the mosma algorithm demonstrated the worst performance and consequently was placed at rank 20 among the 20 algorithms by comparing the results of the benchmark problems with those of the halilrood problem it was found that some algorithms that performed better in solving the benchmark problems showed poor results in solving the real halilrood problem and vice versa in fact as the dimensions of the problem became large those algorithms were no longer able to solve the problem albeit for both the benchmarks and real case problems the moaha algorithm presented significant results table 5 represents the rank of utilized algorithms based on the values of objective functions in this case three algorithms of moaha with td 25 86 fc 74 85 and te 5007 37 and the mogwo with td 29 48 fc 70 36 and te 4905 69 and the mobo with td 123 76 fc 53 32 and te 6128 70 were superior to the other algorithms they could successfully achieve the minimum values for the total deficit and the flood control objectives while generating the maximum hydropower energy the next rank rank 4 belongs to the moma and the nswoa algorithms the nstlbo and the mosma algorithms failed to produce reasonable solutions therefore they were placed at rank of 20 and 19 out of 20 respectively table 6 indicates the optimized values of three objective functions by the utilized algorithms column 4 of this table shows the sum of objectives produced by each algorithm the smaller the values in this column indicates the better performance of the corresponding algorithm as seen the sum of objectives for three algorithms of the mogwo with the sum of objectives 205 21 the moma with the sum of objectives 207 95 and the moaha with the sum of objectives 208 87 were less than the other algorithms indicating their higher performance in optimizing the halilrood problem in this problem the nstlbo algorithm with the sum of objectives of 441 59 had the poorest performance among the utilized algorithms as mentioned earlier in multi objective problems the objective functions are often conflicting therefore a solution which is simultaneously optimal for all the objective functions may not exist instead there would be a series of optimal solutions called pareto front the multi objective optimization algorithms produce a set of non dominated solutions which are near the optimal solutions for any combination of objectives with an appropriate diversity for the halilrood multi reservoir problem each point on the pareto curve represents an optimal operation policy fig 7 illustrates the three dimensional view of the pareto front obtained by the utilized meta heuristic algorithms in this figure the two dimensional view of the pareto front is also displayed along the axes of the three dimensional diagram here the closer the solution points to the origin of the coordinates the lower the pareto front level the more appropriate they are as seen while the pareto front for some algorithms e g the mogwo algorithm the moma algorithm the imomrfo algorithm the momsa algorithm the moaha algorithm and the mola algorithm had an appropriate distribution of solutions around the pareto front had an outstanding quality in terms of coverage and diversity for some other algorithms e g the mofa algorithm the mofpa algorithm the nstlbo algorithm the mojaya algorithm and the mospo algorithm poor results were obtained as seen in both 3d and 2d views the pareto front obtained by the momsa algorithm has good diversity and good coverage which means all the non dominated solutions were distributed uniformly along the pareto front this proves the high capability of this algorithm in the simultaneous optimization of all the three objective functions of1 of2 of3 of the halilrood problem but on the contrary the solutions obtained by the mofa algorithm for example did not form a clear pareto front and the obtained solution points were quite scattered this indicates the poor performance of this algorithm in solving the halilrood problem fig 8 illustrates the optimized power generation by the utilized algorithms compared to the nominal capacity of the power plant ppc of the jiroft dam as well as the actual power generation during the study period as seen the mobo algorithm has been able to optimize the operation of the jiroft dam in such a way that the maximum electricity 6128 70 mwh was generated in most months of the year so that in several months june to august the amount of electricity production was very close to the ppc indicating the energy generation up to 100 of the ppc capacity it was found that although most of the meta heuristic algorithms have been able to significantly increase hydropower generation some algorithms were superior fig 9 shows the results of the meta heuristic algorithms in the optimization of halilrood multi reservoir system operation in terms of allocating the total water demands of the system as seen most of the utilized algorithms could supply the total water demand in the halilrood system in detail the moaha algorithm was able to supply about 100 of the total demand from october to march and july also in the remained months april june and august september this algorithm could approximately supply the major part of the total demands in this case the mosma algorithm was the weakest algorithm and had the worst performance in allocating the total water demands 4 conclusion deriving operating rules for multi objective multi reservoir systems is an important challenge in water resources management meta heuristic algorithms are promising tools to derive the operating policy for such reservoir systems this study investigated the capability of 20 multi objective meta heuristics in solving two well known benchmark problems schaffer and mmf1 in cec suite and one real case multi reservoir system halilrood system a series of performance evaluation criteria were employed to compare the algorithms efficiency in each problem for the schaffer benchmark problem it was found that the moaha and mocrystal algorithms had the best and the worst performance respectively for the mmf1 benchmark problem the highest rank was devoted to the moma algorithm while the mofa algorithm got the lowest rank for both the benchmark problems most of the utilized algorithms produced good solutions compared to the optimal pareto front in terms of coverage and diversity however for the halilrood problem because of the high complexity of the problem the performance of most of the algorithms dramatically decreased it was observed that three algorithms of mogwo moaha and mobo were efficiently able to minimize all the objective functions in the halilrood problem that means that they have been able to optimize the operation of the halilrood multi reservoir system in such a way that the hydropower generation was increased while the downstream water demands and the flood damage were decreased this was consistent with the pareto front produced by these algorithms the results of this study can be used for the optimal operation of other complex systems of reservoirs over the world credit authorship contribution statement mohammad reza sharifi conceptualization data curation formal analysis visualization saeid akbarifard software methodology validation writing original draft mohamad reza madadi methodology writing original draft writing review editing hossein akbarifard conceptualization visualization formal analysis kourosh qaderi visualization conceptualization declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper 
2881,remote sensing has become a data source long ago for estimating evapotranspiration et but often with a dilemma between temporal and spatial resolution the recent ecosystem spaceborne thermal radiometer experiment on space station ecostress reaches a satisfactory compromise it provides 70 m spatial resolution and an average 4 day revisit cycle at different times of a day making granular analysis of et in diurnal changes and field scale a reality in this study we assessed one instantaneous et and two daily ecostress et products eco3etptjpl eco3etalexi at site scale using 31 ameriflux towers in six regions spanning the continental us during the period from july 2018 to september 2021 assuming that eddy covariance sites within a region share similar climate features we evaluated the capacity of ecotsress to quantify the et over heterogeneous landscapes generally disalexi jpl daily et r2 0 45 have stronger correlations with in situ et than both pt jpl instantaneous et r2 0 23 and daily et r2 0 11 while they all tend to overestimate et in most regions the diurnal cycles of pt jpl instantaneous et and seasonal cycles of two daily et were visualized site by site all can show temporal variations of et comparing ecostress et across and within the six regions we found that ecostress et accuracy varies by region regardless of their biomes understanding the mechanisms controlling et and how different data sets are able to capture et is essential for assessing how land cover changes and human induced disturbances influence plant water use and stress in this regard our study provides a deep evaluation of ecostress et paving the ground for future studies aiming to describe et across heterogeneous landscapes at a finer scale keywords evapotranspiration ecostress heterogeneous landscapes evaluation pt jpl disalexi jpl data availability data will be made available on request 1 introduction evapotranspiration et a process in which water absorbs heat and undergoes a phase change represents paramount importance in hydrological and climate systems saadi et al 2018 under climate change scenarios monitoring et with high spatiotemporal resolution and accuracy brings many benefits including a better understanding of water balance globally and efficient use of water resources regionally fisher et al 2017 especially for agriculture which accounts for approximately 70 of global groundwater withdrawals united nations 2022 high resolution et can provide direct insight into crop water use and assist management practices ground based techniques such as the eddy covariance system are widely considered the most reliable way to measure et but only at point scale to estimate et at the regional and global scales different theories and corresponding models sprung up with specific data requirements and accuracies zhang et al 2016 one type is related to empirical models that estimate et from statistical relationships with temperature wind speed and vegetation indices despite some of these models combining physical models to facilitate calculating et the quality of the output largely depends on that of the samples resulting in limitations for applications at different spatiotemporal scales jung et al 2010 kalma et al 2008 the other type is physical models that require a series of meteorological data and environmental variables and has the advantage of simulating global et for instance the pt jpl model proposed by fisher et al 2008 is process driven and tries to mimic the evaporation and transpiration processes during calculations and the two source energy balance tseb model gives et based on energy balance theory kustas and humes 1995 yamazaki et al 1992 nevertheless the models display different accuracies mainly depending on the model structure parameters uncertainties may also come from variables needed by the model including vegetation indices and meteorological data for models combining remote sensing data the quality of satellite images determines the accuracy and spatiotemporal resolution of the product chen et al 2020 zhang et al 2020 for example the widely used moderate resolution imaging spectroradiometer modis et datasets with a daily update but coarse spatial resolution 500 m and landsat series at a satisfactory spatial resolution thermal bands 100 m but 16 day temporal resolution show distinctive pros and cons in terms of applications therefore many attempts have been made to solve the constraints of the spatiotemporal resolution of remote sensing images one solution is based on constellations of small satellite systems aragon et al 2018 worden et al 2021 another practical attempt has been the deployment of the ecosystem spaceborne thermal radiometer experiment on space station ecostress on june 29 2018 the mission was set to answer several science questions related to plant water use and stress focusing on et estimation hulley et al 2017 the ecostress sensor collects terrestrial radiation in five bands from 8 to 12 μm with 38 m 69 m spatial resolution at nadir given the fact that ecostress is installed aboard the international space station iss it allows the collection of images at different temporal resolutions in 1 5 days collecting data across the diurnal cycle these observations will shed light on assessing ecosystem productivity carbon water cycling et cetera xiao et al 2021 recent studies have performed applications centering around the two features of ecostress products its rather fine resolution and diurnal samples for example chang et al 2022 mapped diurnal variations of surface urban heat island with ecostress and geos r land surface temperature data highlighting ecostress potentiality for diel suhi studies at a subdistrict scale pascolini campbell et al 2022 revealed pre fire vegetation impacts on burn severity in the california wildfires using water stress extracted from ecostress they also point out that the ecostress acquisition at different times of day has various predictability of burn severity now the jet propulsion laboratory provides two ecostress et products at 70 m spatial resolution eco3etptjpl and eco3tealexi based on the pt jpl algorithm and disalexi jpl algorithm respectively several evaluations have been carried out fisher et al 2020 conducted a preliminary validation work of eco3etptjpl comparing the estimates with 82 eddy covariance sites worldwide showing a good fit of r2 reaching 0 88 for clear sky instantaneous et liu et al 2021 examined ecostress et in a temperate montane humid forest and found the overestimation of ecostress et in another study kohli et al 2020 used 5 cimis sites to evaluate the potential and reference et of ecostress in a riverside county and ecostress et showed strong correlations with site observations the mentioned validation work is often carried out site by site or in a specific environment there remains a need to assess the ecostress et within and among different geographic regions given its fine resolution and potential applications also understanding how ecostress et behaves under a complex environment is of great significance to further deepen our comprehension of the et process over different land cover types considering data availability and accuracy we used in situ et from eddy covariance towers as well described in the literature fisher et al 2020 fisher et al 2008 velpuri et al 2013 to validate the satellite et products in this study two ecostress et products were assessed against ameriflux measurements from july 2018 to september 2021 in the continental us assuming that the sites selected within regions have similar climate conditions we compared ecostress et for different biome types in multiple regions 2 materials and methods 2 1 in situ et measurements the study included 31 ameriflux sites in six different regions obtained from the ameriflux network https ameriflux lbl gov the location and biome type of each site is shown in fig 1 the six geographic regions are far from each other but sites within a region are close the distance between towers in the same region is within 5 km and the maximum in wi does not exceed 20 km also each region has at least two biome types according to the international geosphere biosphere programme igbp classification which will serve as the basis for heterogeneous landscapes of our analysis since eddy covariance towers usually have a high data loss rate zhang et al 2020 data at several sites used in this study have the variable latent heat le the energy form of et gap filled by the data providers for those that were not gap filled reddyprocweb online tool https www bgc jena mpg de bgi index php services reddyprocweb was applied wutzler et al 2018 in addition there is an energy balance closure problem in the flux energy measurements with le usually underestimated zhou and li 2018 to minimize the impacts of the underestimation we corrected the le when all other components of energy balance i e net radiation netrad sensible heat flux h and soil heat flux g are available following the method in jiang et al 2021 distributing the energy difference in proportion to the sensible heat flux and the latent heat flux for outliers of ec data considering the solar constant is 1370 w m2 le greater than 1000 w m2 or lower than 50 w m2 were removed we note that data at the selected site do not always cover the period from july 2018 to september 2021 for instance sites of wi fig 1 b have data from january 2019 to october 2019 while in mi fig 1 c sites cover a more extended period from september 2018 to december 2020 detailed information about each site is shown in table 1 2 2 satellite et data ecostress is a thermal radiometer equipped on the iss with the primary goal of understanding et it now provides 2 et products eco3etptjplv001 and eco3etalexiv001 both products are level 3 l3 generated from lower level ecostress products like land surface temperature product and other meteorology data from various sources for instance atmospheric data from modis and land cover from modis and landsat fisher et al 2020 eco3etptjpl is computed by priestly taylor jet propulsion laboratory pt jpl algorithm the pt jpl algorithm is based on the priestley taylor equation priestley and taylor 1972 a simple version of the penman monteith equation penman 1948 that gives et without water limiting 1 pet α δ δ γ r n where α is a constant set at 1 26 δ represents the slope of the saturation to vapor pressure curve determined by the near surface air temperature and water vapor pressure γ is a constant relative to humidity and r n stands for net radiation to calculate the actual et fisher et al 2008 introduced environmental factors and partitioned et into three main parts 2 aet e t s e t c e t i 3 e t s f wet f sm 1 f wet α δ δ γ r ns g 4 e t c 1 f wet f g f t f m α δ δ γ r nc 5 e t i f wet α δ δ γ r nc where e t s e t c and e t i respectively represent soil evaporation canopy transpiration and evaporation from intercepted water f with various subscripts are constraints by relative surface wetness f wet green canopy fraction f g plant temperature f t plant moisture f m and soil moisture f sm and g is ground heat flux the above equations are the general form of pt jpl et algorithm detailed descriptions are available in the product s algorithm theoretical basis document from nasa land process distribution active archive center lpdaac fisher 2018 six layers are provided in eco3etptjpl i e instantaneous latent heat flux etinst daily latent heat flux etdaily canopy evaporation etcanopy soil evaporation etsoil interception evaporation etinterception and etinst uncertainty etinstuncertainty in this study etdaily etinst and etinstuncertainty were analyzed the unit of which is w m2 and compared to in situ et within the valid range 0 1000 w m2 0 and 1000 not included other layers such as etcanopy and etsoil were not discussed due to the object of study being the total evapotranspiration the other et product used in the study eco3etalexi is computed by the multi scale alexi disalexi modeling system which is based on two source energy balance tseb model that partitions land surface energy as sensible heat and latent heat kustas and humes 1995 6 r n g h λ e s λ e c where r n is net radiation g is the soil heat flux h is sensible heat and λ e represents latent heat s for soil c for canopy alexi is the regional application of tseb and estimates fluxes at coarse spatial resolution in the disalexi disaggregation scheme the implementation of tseb uses the air temperature field at a certain time provided by alexi as initial upper boundary condition along with higher resolution land surface temperature lst and leaf area index lai data from ecostress and landsat respectively generally et can be derived as a residual from the energy balance equation in addition since ecostress provides lst at an instantaneous scale the solar radiation curve is used to upscale the results to a daily scale cawse nicholson et al 2021 more descriptions about the disalexi jpl algorithm can be found on the algorithm theoretical basis document from lpdaac anderson 2018 eco3etalexi provides three layers that are evapotranspiration daily etdaily evapotranspiration daily uncertainty etdailyuncertainty and quality flag qualityflag unlike the site measurements and eco3etptjpl that give et with the energy format w m2 eco3etalexi gives etdaily as evapotranspiration per day 24 h i e in the unit of mm day the qualityflag is stored as bit flags at a pixel level according to the user guide cawse nicholson and anderson 2021 pixels of quality flag bits 0 suggest et calculated from high quality clear sky land surface temperature and surface reflectance etc in this study the etdaily was analyzed within the data valid range 0 30 mm day boundaries not included the qualityflag is only used for quality control comparison in the discussion section 2 3 matching rules of in situ et and ecostress et as in the first stage of ecostress evaluation where local et was calculated by averaging 3 3 or 5 5 pixels centered on the site fisher et al 2020 this study followed the method spatially the average of 5 5 pixels represents local et temporally latent heat observed within half an hour around the overpass time was adopted as ground truth for instantaneous et of eco3etptjpl given that pt jpl daily et is actually daytime et the average of in situ daytime records i e 24 records from 06 00 to 18 00 pairs with daily et meanwhile to be able to compare with the pt jpl etdaily disalexi jpl daily et was preprocessed converting the unit mm day the amount of et per 24 h to half day w m2 by multiplying 56 7 the converting coefficient when the temperature is 20 c and the latent heat of vaporization is 2 4536 mj kg there are 995 992 and 700 data pairs of tower et with pt jpl etinst pt jpl etdaily and disalexi jpl etdaily found respectively spanning from july 2018 to september 2021 2 4 evaluation methods as this study presumes the sites within a geographic region share the same climate conditions we first examined the consistency of climate variables of ec towers by computing the pairwise linear correlation coefficient for every two sites and used right tailed t test to verify that climate variables within a region had higher correlations considering the time range sites with the air temperature ta relative humidity rh and net radiation netrad from july to october 2019 were selected for verification us srs in az was not involved in the verification because it could not meet the time range and other 30 sites all have ta and rh while four sites us hb1 us km1 us km2 and us km3 have the variable netrad missing for ta with the exception of co the correlation coefficients within one region were significantly higher at 95 confidence than those in other regions table s1 for rh all six geographic regions gave significant results table s2 as for netrad only sites in wi showed a significantly higher correlation although the coefficients of sites within nm az and sc were also higher than those in other regions respectively table s3 based on the results we believed that the assumption basically holds and conducted the follow up ecostress et evaluation instantaneous et and daily et from ecostress were separately examined for etinst the flux data were aggregated by sets of sites and biome types the diurnal changes of etinst were plotted against in situ data to qualitatively evaluate how etinst performs during different times of the day regarding daily et from 3 sources ec towers pt jpl and disalexi jpl we calculated the coefficient of determination r2 and root mean square error rmse the seasonal patterns of daily et were also plotted in addition the boxplot of each biome type at six geographic regions was plotted and cross compared to reveal ecostress et performance on diverse landscapes 3 results 3 1 instantaneous et performance based on our assessment the overall r2 of pt jpl instantaneous et against in situ et is 0 23 the scattered points fig 2 of et illustrate an elusive relationship between ecostress etinst and tower et in wi r2 has a minimum of less than 0 01 at the site us pfj n 12 and a maximum of 0 51 at us pfp n 12 as the fitting lines reflected in fig 2 despite some prominent exceptions ecostress tends to overestimate instantaneous et when in situ et is lower than 150 w m2 whereas underestimates instantaneous et when in situ et is at a high level the linear regression results in mi co nm sc and az are shown in fig 3 generally the overall r2 outperforms that of wi r2 varies from 0 03 to 0 90 with 6 out of 14 sites exceeding 0 4 etinst in sc and az display a moderately strong correlation with in situ et which is significantly different from wi mi and nm two sample t test at 95 confidence it can be concluded that the performance of etinst varies by region using the image acquisition time of etinst we then examined the diurnal cycles of instantaneous et fig 4 illustrates the variations of etinst to visually evaluate etinst against in situ et at different times of the day with points falling within the ground measured et interval it may indicate that etinst agrees with in situ et in diurnal variability however the shaded area can incorporate seasonal variations when etinst covers rather long time period e g fig 4 c5 e4 e5 f3 f5 hindering the figure as an accurate benchmark to evaluate etinst corresponding to the phenomenon described above that etinst tends to be overestimated when et is at a low level in wi diel patterns of sites in wi further demonstrate the phenomenon from a time perspective overestimating in the early morning in fig 4 a1 c4 regarding the quality of etinst varies by region as aforementioned the arguments still hold in fig 4 for example enf in sc fig 4 d5 shows a significant positive bias during the day the same as how etinst responds to wet from sc in fig 4 d1 d2 additionally in areas where biome types are gra cro wsa and osh the et peaks observed by ecostress are mostly between 10 am and 12 am in the morning about an hour earlier than in situ et this may indicate that there is greater uncertainty for morning etinst future studies are encouraged to provide more rigorous proof 3 2 daily et analysis there are two ecostress daily et products from eco3etptjpl and eco3etalexi hereinafter referred to as pt jpl etdaily and disalexi jpl etdaily of which the overall r2 are 0 11 and 0 45 respectively taking in situ et as the basis the validation result is presented in fig 5 ordered by biome types compared with instantaneous et product there are fewer data samples obtained from daily et products due to daily et itself being the upscaling of instant et and strict matching rules with in situ et in general disalexi jpl etdaily slightly outperforms pt jpl etdaily with 16 out of 31 sites showing higher r2 and smaller rmse than pt jpl etdaily and in regions co sc and az pt jpl etdaily performed better notably the two daily et products display a similar feature as instantaneous et in that sites of one region show similar scatter patterns regardless of their vegetation types e g the scatter patterns of 4 sites in mi as shown in fig 5 e1 e2 f1 f2 r2 also shows a regional difference e g the r2 of disalexi jpl in mi is significantly different from that of other regions except for az at 95 confidence two sample t test so is the r2 of pt jpl etdaily in sc fig 5 d1 d2 d5 considering that most sites have sample sizes of around 10 limited data pairs found from image et and in situ et may introduce uncertainties in the results e g the negative slopes of pt jpl etdaily the seasonal patterns of two daily et products are shown in fig 6 although there are lots of gaps at some sites with discontinuous data that make the seasonal cycles of in situ et hard to tell fig 6 b3 b5 d4 e3 from the sites with a continuous time series the two daily products basically reflect intra annual and inter annual changes of local et in most sites in situ et and ecostress et reach their maximum values near june and july with the increasing decreasing trend captured the distinctions of et from one biome type among geographic regions explicitly show that gra in fig 6 e1 e5 shows a marked difference in magnitude indicating that climate has an impact on vegetation which further controls the evapotranspiration and both et products are able to follow the in situ et generally although pt jpl etdaily will over or under estimate et by region it provides a better estimate of the et trends across geographic regions and biome types while disalexi jpl etdaily gives more underestimated values around zero that blur the seasonal variability fig 6 e4 e5 f3 f5 3 3 ecostress et performance on different biome types integrating site data of the same biome type within a geographic region we evaluated the instantaneous et and two daily et products across and within different geographic regions regarding the instantaneous et i e pt jpl etinst we found that biome types tend to have the same distribution of scatters and accuracy according to their regions as shown in fig 7 a b d f statistically r2 in sc and az are different from r2 in wi mi and nm at 95 confidence two sample t test and r2 in nm from that of wi however in co where sites air temperature and net radiation didn t show consistency refer to section 2 3 etinst at two biome types enf and gra exhibit different scattered patterns and quality 0 64 vs 0 03 other than co gra composes mi nm and az as well and each has a scattered feature consistent with the other biome type of the set of sites indicating etinst is more influenced by local climate specificities than biome types the performance of the two daily et products over regions and biome types are shown in fig 8 in wi disalexi jpl etdaily underestimates et in a water body but overestimates et at dbf enf and wet while pt jpl etdaily underestimates et regardless of the biome types the average values of in situ et within wi follow the order wat dbf enf wet although the differences as in situ et indicates are small the two daily et products mix the order in regions other than wi and mi the two products exhibit varying degrees of overestimated et overall disalexi jpl etdaily is closer to the ground measured et however in terms of the comparison of et across and within regions pt jpl etdaily shows higher consistency with in situ et which suggests pt jpl etdaily is more likely to capture the difference in heterogeneous landscapes under diverse climate conditions from the latter two rows in fig 8 we found the accuracy of both daily et products varies with geographic regions in wi and mi disalexi jpl shows higher r2 and lower rmse and the results reversed in the other four regions indicating it is the geographic regions instead of the vegetation types that determine the quality of ecostress et products as a result the et is usually over or under estimated by region as a whole for instance the disalexi jpl etdaily for enf in wi co and sc separately give over and under estimated results which are consistent with other biome types in the same area so does pt jpl etdaily next we plotted ndvi and ecostress daily et for one day in mi and co to facilitate the visual comparison of et and ndvi in different geographic regions and to provide a glimpse of the spatial distribution of daily et of the two products in mi fig 9 a c the ndvi and disalexi jpl etdaily are higher in the east and lower in the west while the spatial distribution of pt jpl etdaily shows the opposite in co fig 9 d f the ndvi and the two products show a much more similar pattern comparing the figures of mi and co the ability of ecostress to quantify et over heterogenous landscapes varies in different regions possibly due to multiple factors in the complex surfaces of which this article speculates that ecostress et is more affected by the climate based on the consistent results of climate conditions in the same region seen in section 2 3 4 discussion this study evaluated two ecostress et products against sites in six geographic regions across the continental us the results are rather unsatisfactory especially the pt jpl et when compared to previous studies in which r2 surpassed 0 8 fisher et al 2020 one possible explanation is that the sites in wi are over represented when conducting an overall assessment another reason is likely related to the fact that quality flags were not used during the processes to conserve the most data pairs as possible to understand the role of quality flags for data quality here we compare the results of disalexi jpl etdaily with and without quality control unlike eco3etptjpl whose quality flags for cloud and ancillary datasets were provided as another product eco3ancqa v001 eco3etalexi has a quality flag layer in addition to etdaily here we selected disalexi jpl et with the highest quality that bits of the quality flag all equal 0 refer to section 2 2 the effect of the filtering is demonstrated in fig 10 r2 increasing from 0 45 to 0 47 with the original data size from 700 reduced to 611 in a similar approach cawse nicholson et al 2021 further filtered ecostress disalexi jpl et samples by removing matchups of high view zenith and high aerosol optical depth and r2 increased from 0 53 to 0 8 while data pairs dropped from 409 to 90 gorokhovich et al 2022 also proposed that quality control and temporal constraints are in need for the successful use of ecostress yet it is quite a dilemma between accuracy and data size commonly many researchers aggregated data from eddy covariance towers of different biome types as the benchmark for testing et models in heterogeneous landscapes fisher et al 2011 once used 10 fluxnet sites of 10 igbp classes to test pet models ershadi et al 2014 selected 20 sites of 5 various biome types globally 4 sites each type to test et models in the studies similar to the above data usually was aggregated according to the biome types or climate zones it is understandable given that the evaluation work is on a global scale on a regional scale the validation work is often carried out site by site in a specific environment such as in the study liu et al 2021 and kohli et al 2020 as aforementioned they examined ecostress et in a temperate montane humid forest and a riverside county respectively kohli et al 2020 also found site specific differences in et products and attributed the partial reason to spatial heterogeneity it should be noted that the spatial heterogeneity here refers to the inhomogeneity of the land surface near the site e g surrounding 1 km 1 km which is different from the interpretation in this paper there is no doubt that uncertainties could accumulate from heterogeneous surroundings of the station site fisher et al 2020 fisher et al 2011 along with tower instrumentation errors khan et al 2018 scale differences mccabe and wood 2006 and energy closure problem etc from which the uncertainties exist in the results presented in this study as well since this study focuses on the comparison of et in different geographic regions besides individual evaluation of each site rather than site specific differences region specific differences were more pronounced we think this may be the result of their different local climatic conditions based on the assumption nevertheless a more detailed investigation of the features that ecostress et exhibited in different regions should be considered in future research to better characterize et of various surfaces a finer timescale analysis e g hourly et or long term time series focusing on seasonal cycles may help to understand the variability of these fluxes the study of zhang et al 2020 displayed monthly et cycles over four vegetation types of which grasslands showed obvious distinction from the others with relatively low et in june and july the time series of et was plotted in this study take wi as an example fig 6 e1 e2 f1 f2 the in situ et of cro in fig 6 f2 has higher peaks than the gra if looking carefully the in situ et of the four sites has different shapes which are clues for the measured et to distinguish vegetation types in a region we used the average to represent and for comparison between ecostress et and in situ et as illustrated in fig 7 with the distinctions between biome types partially shown instead of the average knipper et al 2020 used monthly accumulated et to characterize water consumption in target areas for applications of et at finer scales such as precision agriculture high spatiotemporal resolution and accuracy have always been the subject of ongoing studies while extracting more information from limited observations available is also of great importance the et mapping has been one of the advantages of ecostress however the maps of pt jpl etdaily and disalexi jpl etdaily as shown in fig 9 indicate that there are many missing or invalid values in the image probably due to the complex surface in the selected areas in fact previous studies on ecostress et on relatively homogeneous surfaces such as farmland have demonstrated its mapping capacity and potential ecostress et can respond to crop water stress at a field scale differentiating irrigation needed and irrigation free areas thus providing guidance for agricultural production aragon et al 2018 wu et al 2022 5 conclusions this study evaluated two ecostress et products with eddy covariance sites in six regions across the continental us postulating that the climate conditions are the same in one region to determine whether ecostress could capture the et from different biomes combining the in situ et and eco3etptjpl etinst spatially and temporally we observed an overestimation trend across the sites which was more pronounced in the morning there is one specific region co where the climate variables air temperature and net radiation exhibited relatively low correlations instantaneous et showed distinctions in accuracy and scattered patterns according to the biomes but the others give indistinguishable results the two daily et products namely pt jpl etdaily and disalexi jpl etdaily tend to overestimate local et notwithstanding giving underestimated results at few regions additionally it was found that the geographic regions of site stations determine their scatter pattern more than their vegetation types for which we argue that the climate of each region plays an important role a better understanding of the mechanisms controlling et is essential for assessing how land cover changes and disturbances such as fires and droughts influence plant water use and stress our current understanding is limited by a lack of theoretical understanding of the mechanisms how different data sets are able to capture these interactions and the sensitive degree of current et models to these changes in this regard our study provides a deep evaluation of ecostress et paving the ground for future studies aiming to describe et across heterogeneous landscapes at a finer scale credit authorship contribution statement lili liang formal analysis visualization writing original draft yu feng writing review editing methodology jie wu writing review editing xinyue he writing review editing shijing liang writing review editing xin jiang writing review editing gabriel de oliveira writing review editing jianxiu qiu writing review editing zhenzhong zeng conceptualization supervision funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this study was supported by the national natural science foundation of china 42071022 and the startup fund provided by the southern university of science and technology 29 y01296122 we thank all the principal researchers and teams for all the datasets and data processing tools used in this study and we thank the reviewers for their careful work and suggestions that helped improve this paper substantially appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 128470 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
2881,remote sensing has become a data source long ago for estimating evapotranspiration et but often with a dilemma between temporal and spatial resolution the recent ecosystem spaceborne thermal radiometer experiment on space station ecostress reaches a satisfactory compromise it provides 70 m spatial resolution and an average 4 day revisit cycle at different times of a day making granular analysis of et in diurnal changes and field scale a reality in this study we assessed one instantaneous et and two daily ecostress et products eco3etptjpl eco3etalexi at site scale using 31 ameriflux towers in six regions spanning the continental us during the period from july 2018 to september 2021 assuming that eddy covariance sites within a region share similar climate features we evaluated the capacity of ecotsress to quantify the et over heterogeneous landscapes generally disalexi jpl daily et r2 0 45 have stronger correlations with in situ et than both pt jpl instantaneous et r2 0 23 and daily et r2 0 11 while they all tend to overestimate et in most regions the diurnal cycles of pt jpl instantaneous et and seasonal cycles of two daily et were visualized site by site all can show temporal variations of et comparing ecostress et across and within the six regions we found that ecostress et accuracy varies by region regardless of their biomes understanding the mechanisms controlling et and how different data sets are able to capture et is essential for assessing how land cover changes and human induced disturbances influence plant water use and stress in this regard our study provides a deep evaluation of ecostress et paving the ground for future studies aiming to describe et across heterogeneous landscapes at a finer scale keywords evapotranspiration ecostress heterogeneous landscapes evaluation pt jpl disalexi jpl data availability data will be made available on request 1 introduction evapotranspiration et a process in which water absorbs heat and undergoes a phase change represents paramount importance in hydrological and climate systems saadi et al 2018 under climate change scenarios monitoring et with high spatiotemporal resolution and accuracy brings many benefits including a better understanding of water balance globally and efficient use of water resources regionally fisher et al 2017 especially for agriculture which accounts for approximately 70 of global groundwater withdrawals united nations 2022 high resolution et can provide direct insight into crop water use and assist management practices ground based techniques such as the eddy covariance system are widely considered the most reliable way to measure et but only at point scale to estimate et at the regional and global scales different theories and corresponding models sprung up with specific data requirements and accuracies zhang et al 2016 one type is related to empirical models that estimate et from statistical relationships with temperature wind speed and vegetation indices despite some of these models combining physical models to facilitate calculating et the quality of the output largely depends on that of the samples resulting in limitations for applications at different spatiotemporal scales jung et al 2010 kalma et al 2008 the other type is physical models that require a series of meteorological data and environmental variables and has the advantage of simulating global et for instance the pt jpl model proposed by fisher et al 2008 is process driven and tries to mimic the evaporation and transpiration processes during calculations and the two source energy balance tseb model gives et based on energy balance theory kustas and humes 1995 yamazaki et al 1992 nevertheless the models display different accuracies mainly depending on the model structure parameters uncertainties may also come from variables needed by the model including vegetation indices and meteorological data for models combining remote sensing data the quality of satellite images determines the accuracy and spatiotemporal resolution of the product chen et al 2020 zhang et al 2020 for example the widely used moderate resolution imaging spectroradiometer modis et datasets with a daily update but coarse spatial resolution 500 m and landsat series at a satisfactory spatial resolution thermal bands 100 m but 16 day temporal resolution show distinctive pros and cons in terms of applications therefore many attempts have been made to solve the constraints of the spatiotemporal resolution of remote sensing images one solution is based on constellations of small satellite systems aragon et al 2018 worden et al 2021 another practical attempt has been the deployment of the ecosystem spaceborne thermal radiometer experiment on space station ecostress on june 29 2018 the mission was set to answer several science questions related to plant water use and stress focusing on et estimation hulley et al 2017 the ecostress sensor collects terrestrial radiation in five bands from 8 to 12 μm with 38 m 69 m spatial resolution at nadir given the fact that ecostress is installed aboard the international space station iss it allows the collection of images at different temporal resolutions in 1 5 days collecting data across the diurnal cycle these observations will shed light on assessing ecosystem productivity carbon water cycling et cetera xiao et al 2021 recent studies have performed applications centering around the two features of ecostress products its rather fine resolution and diurnal samples for example chang et al 2022 mapped diurnal variations of surface urban heat island with ecostress and geos r land surface temperature data highlighting ecostress potentiality for diel suhi studies at a subdistrict scale pascolini campbell et al 2022 revealed pre fire vegetation impacts on burn severity in the california wildfires using water stress extracted from ecostress they also point out that the ecostress acquisition at different times of day has various predictability of burn severity now the jet propulsion laboratory provides two ecostress et products at 70 m spatial resolution eco3etptjpl and eco3tealexi based on the pt jpl algorithm and disalexi jpl algorithm respectively several evaluations have been carried out fisher et al 2020 conducted a preliminary validation work of eco3etptjpl comparing the estimates with 82 eddy covariance sites worldwide showing a good fit of r2 reaching 0 88 for clear sky instantaneous et liu et al 2021 examined ecostress et in a temperate montane humid forest and found the overestimation of ecostress et in another study kohli et al 2020 used 5 cimis sites to evaluate the potential and reference et of ecostress in a riverside county and ecostress et showed strong correlations with site observations the mentioned validation work is often carried out site by site or in a specific environment there remains a need to assess the ecostress et within and among different geographic regions given its fine resolution and potential applications also understanding how ecostress et behaves under a complex environment is of great significance to further deepen our comprehension of the et process over different land cover types considering data availability and accuracy we used in situ et from eddy covariance towers as well described in the literature fisher et al 2020 fisher et al 2008 velpuri et al 2013 to validate the satellite et products in this study two ecostress et products were assessed against ameriflux measurements from july 2018 to september 2021 in the continental us assuming that the sites selected within regions have similar climate conditions we compared ecostress et for different biome types in multiple regions 2 materials and methods 2 1 in situ et measurements the study included 31 ameriflux sites in six different regions obtained from the ameriflux network https ameriflux lbl gov the location and biome type of each site is shown in fig 1 the six geographic regions are far from each other but sites within a region are close the distance between towers in the same region is within 5 km and the maximum in wi does not exceed 20 km also each region has at least two biome types according to the international geosphere biosphere programme igbp classification which will serve as the basis for heterogeneous landscapes of our analysis since eddy covariance towers usually have a high data loss rate zhang et al 2020 data at several sites used in this study have the variable latent heat le the energy form of et gap filled by the data providers for those that were not gap filled reddyprocweb online tool https www bgc jena mpg de bgi index php services reddyprocweb was applied wutzler et al 2018 in addition there is an energy balance closure problem in the flux energy measurements with le usually underestimated zhou and li 2018 to minimize the impacts of the underestimation we corrected the le when all other components of energy balance i e net radiation netrad sensible heat flux h and soil heat flux g are available following the method in jiang et al 2021 distributing the energy difference in proportion to the sensible heat flux and the latent heat flux for outliers of ec data considering the solar constant is 1370 w m2 le greater than 1000 w m2 or lower than 50 w m2 were removed we note that data at the selected site do not always cover the period from july 2018 to september 2021 for instance sites of wi fig 1 b have data from january 2019 to october 2019 while in mi fig 1 c sites cover a more extended period from september 2018 to december 2020 detailed information about each site is shown in table 1 2 2 satellite et data ecostress is a thermal radiometer equipped on the iss with the primary goal of understanding et it now provides 2 et products eco3etptjplv001 and eco3etalexiv001 both products are level 3 l3 generated from lower level ecostress products like land surface temperature product and other meteorology data from various sources for instance atmospheric data from modis and land cover from modis and landsat fisher et al 2020 eco3etptjpl is computed by priestly taylor jet propulsion laboratory pt jpl algorithm the pt jpl algorithm is based on the priestley taylor equation priestley and taylor 1972 a simple version of the penman monteith equation penman 1948 that gives et without water limiting 1 pet α δ δ γ r n where α is a constant set at 1 26 δ represents the slope of the saturation to vapor pressure curve determined by the near surface air temperature and water vapor pressure γ is a constant relative to humidity and r n stands for net radiation to calculate the actual et fisher et al 2008 introduced environmental factors and partitioned et into three main parts 2 aet e t s e t c e t i 3 e t s f wet f sm 1 f wet α δ δ γ r ns g 4 e t c 1 f wet f g f t f m α δ δ γ r nc 5 e t i f wet α δ δ γ r nc where e t s e t c and e t i respectively represent soil evaporation canopy transpiration and evaporation from intercepted water f with various subscripts are constraints by relative surface wetness f wet green canopy fraction f g plant temperature f t plant moisture f m and soil moisture f sm and g is ground heat flux the above equations are the general form of pt jpl et algorithm detailed descriptions are available in the product s algorithm theoretical basis document from nasa land process distribution active archive center lpdaac fisher 2018 six layers are provided in eco3etptjpl i e instantaneous latent heat flux etinst daily latent heat flux etdaily canopy evaporation etcanopy soil evaporation etsoil interception evaporation etinterception and etinst uncertainty etinstuncertainty in this study etdaily etinst and etinstuncertainty were analyzed the unit of which is w m2 and compared to in situ et within the valid range 0 1000 w m2 0 and 1000 not included other layers such as etcanopy and etsoil were not discussed due to the object of study being the total evapotranspiration the other et product used in the study eco3etalexi is computed by the multi scale alexi disalexi modeling system which is based on two source energy balance tseb model that partitions land surface energy as sensible heat and latent heat kustas and humes 1995 6 r n g h λ e s λ e c where r n is net radiation g is the soil heat flux h is sensible heat and λ e represents latent heat s for soil c for canopy alexi is the regional application of tseb and estimates fluxes at coarse spatial resolution in the disalexi disaggregation scheme the implementation of tseb uses the air temperature field at a certain time provided by alexi as initial upper boundary condition along with higher resolution land surface temperature lst and leaf area index lai data from ecostress and landsat respectively generally et can be derived as a residual from the energy balance equation in addition since ecostress provides lst at an instantaneous scale the solar radiation curve is used to upscale the results to a daily scale cawse nicholson et al 2021 more descriptions about the disalexi jpl algorithm can be found on the algorithm theoretical basis document from lpdaac anderson 2018 eco3etalexi provides three layers that are evapotranspiration daily etdaily evapotranspiration daily uncertainty etdailyuncertainty and quality flag qualityflag unlike the site measurements and eco3etptjpl that give et with the energy format w m2 eco3etalexi gives etdaily as evapotranspiration per day 24 h i e in the unit of mm day the qualityflag is stored as bit flags at a pixel level according to the user guide cawse nicholson and anderson 2021 pixels of quality flag bits 0 suggest et calculated from high quality clear sky land surface temperature and surface reflectance etc in this study the etdaily was analyzed within the data valid range 0 30 mm day boundaries not included the qualityflag is only used for quality control comparison in the discussion section 2 3 matching rules of in situ et and ecostress et as in the first stage of ecostress evaluation where local et was calculated by averaging 3 3 or 5 5 pixels centered on the site fisher et al 2020 this study followed the method spatially the average of 5 5 pixels represents local et temporally latent heat observed within half an hour around the overpass time was adopted as ground truth for instantaneous et of eco3etptjpl given that pt jpl daily et is actually daytime et the average of in situ daytime records i e 24 records from 06 00 to 18 00 pairs with daily et meanwhile to be able to compare with the pt jpl etdaily disalexi jpl daily et was preprocessed converting the unit mm day the amount of et per 24 h to half day w m2 by multiplying 56 7 the converting coefficient when the temperature is 20 c and the latent heat of vaporization is 2 4536 mj kg there are 995 992 and 700 data pairs of tower et with pt jpl etinst pt jpl etdaily and disalexi jpl etdaily found respectively spanning from july 2018 to september 2021 2 4 evaluation methods as this study presumes the sites within a geographic region share the same climate conditions we first examined the consistency of climate variables of ec towers by computing the pairwise linear correlation coefficient for every two sites and used right tailed t test to verify that climate variables within a region had higher correlations considering the time range sites with the air temperature ta relative humidity rh and net radiation netrad from july to october 2019 were selected for verification us srs in az was not involved in the verification because it could not meet the time range and other 30 sites all have ta and rh while four sites us hb1 us km1 us km2 and us km3 have the variable netrad missing for ta with the exception of co the correlation coefficients within one region were significantly higher at 95 confidence than those in other regions table s1 for rh all six geographic regions gave significant results table s2 as for netrad only sites in wi showed a significantly higher correlation although the coefficients of sites within nm az and sc were also higher than those in other regions respectively table s3 based on the results we believed that the assumption basically holds and conducted the follow up ecostress et evaluation instantaneous et and daily et from ecostress were separately examined for etinst the flux data were aggregated by sets of sites and biome types the diurnal changes of etinst were plotted against in situ data to qualitatively evaluate how etinst performs during different times of the day regarding daily et from 3 sources ec towers pt jpl and disalexi jpl we calculated the coefficient of determination r2 and root mean square error rmse the seasonal patterns of daily et were also plotted in addition the boxplot of each biome type at six geographic regions was plotted and cross compared to reveal ecostress et performance on diverse landscapes 3 results 3 1 instantaneous et performance based on our assessment the overall r2 of pt jpl instantaneous et against in situ et is 0 23 the scattered points fig 2 of et illustrate an elusive relationship between ecostress etinst and tower et in wi r2 has a minimum of less than 0 01 at the site us pfj n 12 and a maximum of 0 51 at us pfp n 12 as the fitting lines reflected in fig 2 despite some prominent exceptions ecostress tends to overestimate instantaneous et when in situ et is lower than 150 w m2 whereas underestimates instantaneous et when in situ et is at a high level the linear regression results in mi co nm sc and az are shown in fig 3 generally the overall r2 outperforms that of wi r2 varies from 0 03 to 0 90 with 6 out of 14 sites exceeding 0 4 etinst in sc and az display a moderately strong correlation with in situ et which is significantly different from wi mi and nm two sample t test at 95 confidence it can be concluded that the performance of etinst varies by region using the image acquisition time of etinst we then examined the diurnal cycles of instantaneous et fig 4 illustrates the variations of etinst to visually evaluate etinst against in situ et at different times of the day with points falling within the ground measured et interval it may indicate that etinst agrees with in situ et in diurnal variability however the shaded area can incorporate seasonal variations when etinst covers rather long time period e g fig 4 c5 e4 e5 f3 f5 hindering the figure as an accurate benchmark to evaluate etinst corresponding to the phenomenon described above that etinst tends to be overestimated when et is at a low level in wi diel patterns of sites in wi further demonstrate the phenomenon from a time perspective overestimating in the early morning in fig 4 a1 c4 regarding the quality of etinst varies by region as aforementioned the arguments still hold in fig 4 for example enf in sc fig 4 d5 shows a significant positive bias during the day the same as how etinst responds to wet from sc in fig 4 d1 d2 additionally in areas where biome types are gra cro wsa and osh the et peaks observed by ecostress are mostly between 10 am and 12 am in the morning about an hour earlier than in situ et this may indicate that there is greater uncertainty for morning etinst future studies are encouraged to provide more rigorous proof 3 2 daily et analysis there are two ecostress daily et products from eco3etptjpl and eco3etalexi hereinafter referred to as pt jpl etdaily and disalexi jpl etdaily of which the overall r2 are 0 11 and 0 45 respectively taking in situ et as the basis the validation result is presented in fig 5 ordered by biome types compared with instantaneous et product there are fewer data samples obtained from daily et products due to daily et itself being the upscaling of instant et and strict matching rules with in situ et in general disalexi jpl etdaily slightly outperforms pt jpl etdaily with 16 out of 31 sites showing higher r2 and smaller rmse than pt jpl etdaily and in regions co sc and az pt jpl etdaily performed better notably the two daily et products display a similar feature as instantaneous et in that sites of one region show similar scatter patterns regardless of their vegetation types e g the scatter patterns of 4 sites in mi as shown in fig 5 e1 e2 f1 f2 r2 also shows a regional difference e g the r2 of disalexi jpl in mi is significantly different from that of other regions except for az at 95 confidence two sample t test so is the r2 of pt jpl etdaily in sc fig 5 d1 d2 d5 considering that most sites have sample sizes of around 10 limited data pairs found from image et and in situ et may introduce uncertainties in the results e g the negative slopes of pt jpl etdaily the seasonal patterns of two daily et products are shown in fig 6 although there are lots of gaps at some sites with discontinuous data that make the seasonal cycles of in situ et hard to tell fig 6 b3 b5 d4 e3 from the sites with a continuous time series the two daily products basically reflect intra annual and inter annual changes of local et in most sites in situ et and ecostress et reach their maximum values near june and july with the increasing decreasing trend captured the distinctions of et from one biome type among geographic regions explicitly show that gra in fig 6 e1 e5 shows a marked difference in magnitude indicating that climate has an impact on vegetation which further controls the evapotranspiration and both et products are able to follow the in situ et generally although pt jpl etdaily will over or under estimate et by region it provides a better estimate of the et trends across geographic regions and biome types while disalexi jpl etdaily gives more underestimated values around zero that blur the seasonal variability fig 6 e4 e5 f3 f5 3 3 ecostress et performance on different biome types integrating site data of the same biome type within a geographic region we evaluated the instantaneous et and two daily et products across and within different geographic regions regarding the instantaneous et i e pt jpl etinst we found that biome types tend to have the same distribution of scatters and accuracy according to their regions as shown in fig 7 a b d f statistically r2 in sc and az are different from r2 in wi mi and nm at 95 confidence two sample t test and r2 in nm from that of wi however in co where sites air temperature and net radiation didn t show consistency refer to section 2 3 etinst at two biome types enf and gra exhibit different scattered patterns and quality 0 64 vs 0 03 other than co gra composes mi nm and az as well and each has a scattered feature consistent with the other biome type of the set of sites indicating etinst is more influenced by local climate specificities than biome types the performance of the two daily et products over regions and biome types are shown in fig 8 in wi disalexi jpl etdaily underestimates et in a water body but overestimates et at dbf enf and wet while pt jpl etdaily underestimates et regardless of the biome types the average values of in situ et within wi follow the order wat dbf enf wet although the differences as in situ et indicates are small the two daily et products mix the order in regions other than wi and mi the two products exhibit varying degrees of overestimated et overall disalexi jpl etdaily is closer to the ground measured et however in terms of the comparison of et across and within regions pt jpl etdaily shows higher consistency with in situ et which suggests pt jpl etdaily is more likely to capture the difference in heterogeneous landscapes under diverse climate conditions from the latter two rows in fig 8 we found the accuracy of both daily et products varies with geographic regions in wi and mi disalexi jpl shows higher r2 and lower rmse and the results reversed in the other four regions indicating it is the geographic regions instead of the vegetation types that determine the quality of ecostress et products as a result the et is usually over or under estimated by region as a whole for instance the disalexi jpl etdaily for enf in wi co and sc separately give over and under estimated results which are consistent with other biome types in the same area so does pt jpl etdaily next we plotted ndvi and ecostress daily et for one day in mi and co to facilitate the visual comparison of et and ndvi in different geographic regions and to provide a glimpse of the spatial distribution of daily et of the two products in mi fig 9 a c the ndvi and disalexi jpl etdaily are higher in the east and lower in the west while the spatial distribution of pt jpl etdaily shows the opposite in co fig 9 d f the ndvi and the two products show a much more similar pattern comparing the figures of mi and co the ability of ecostress to quantify et over heterogenous landscapes varies in different regions possibly due to multiple factors in the complex surfaces of which this article speculates that ecostress et is more affected by the climate based on the consistent results of climate conditions in the same region seen in section 2 3 4 discussion this study evaluated two ecostress et products against sites in six geographic regions across the continental us the results are rather unsatisfactory especially the pt jpl et when compared to previous studies in which r2 surpassed 0 8 fisher et al 2020 one possible explanation is that the sites in wi are over represented when conducting an overall assessment another reason is likely related to the fact that quality flags were not used during the processes to conserve the most data pairs as possible to understand the role of quality flags for data quality here we compare the results of disalexi jpl etdaily with and without quality control unlike eco3etptjpl whose quality flags for cloud and ancillary datasets were provided as another product eco3ancqa v001 eco3etalexi has a quality flag layer in addition to etdaily here we selected disalexi jpl et with the highest quality that bits of the quality flag all equal 0 refer to section 2 2 the effect of the filtering is demonstrated in fig 10 r2 increasing from 0 45 to 0 47 with the original data size from 700 reduced to 611 in a similar approach cawse nicholson et al 2021 further filtered ecostress disalexi jpl et samples by removing matchups of high view zenith and high aerosol optical depth and r2 increased from 0 53 to 0 8 while data pairs dropped from 409 to 90 gorokhovich et al 2022 also proposed that quality control and temporal constraints are in need for the successful use of ecostress yet it is quite a dilemma between accuracy and data size commonly many researchers aggregated data from eddy covariance towers of different biome types as the benchmark for testing et models in heterogeneous landscapes fisher et al 2011 once used 10 fluxnet sites of 10 igbp classes to test pet models ershadi et al 2014 selected 20 sites of 5 various biome types globally 4 sites each type to test et models in the studies similar to the above data usually was aggregated according to the biome types or climate zones it is understandable given that the evaluation work is on a global scale on a regional scale the validation work is often carried out site by site in a specific environment such as in the study liu et al 2021 and kohli et al 2020 as aforementioned they examined ecostress et in a temperate montane humid forest and a riverside county respectively kohli et al 2020 also found site specific differences in et products and attributed the partial reason to spatial heterogeneity it should be noted that the spatial heterogeneity here refers to the inhomogeneity of the land surface near the site e g surrounding 1 km 1 km which is different from the interpretation in this paper there is no doubt that uncertainties could accumulate from heterogeneous surroundings of the station site fisher et al 2020 fisher et al 2011 along with tower instrumentation errors khan et al 2018 scale differences mccabe and wood 2006 and energy closure problem etc from which the uncertainties exist in the results presented in this study as well since this study focuses on the comparison of et in different geographic regions besides individual evaluation of each site rather than site specific differences region specific differences were more pronounced we think this may be the result of their different local climatic conditions based on the assumption nevertheless a more detailed investigation of the features that ecostress et exhibited in different regions should be considered in future research to better characterize et of various surfaces a finer timescale analysis e g hourly et or long term time series focusing on seasonal cycles may help to understand the variability of these fluxes the study of zhang et al 2020 displayed monthly et cycles over four vegetation types of which grasslands showed obvious distinction from the others with relatively low et in june and july the time series of et was plotted in this study take wi as an example fig 6 e1 e2 f1 f2 the in situ et of cro in fig 6 f2 has higher peaks than the gra if looking carefully the in situ et of the four sites has different shapes which are clues for the measured et to distinguish vegetation types in a region we used the average to represent and for comparison between ecostress et and in situ et as illustrated in fig 7 with the distinctions between biome types partially shown instead of the average knipper et al 2020 used monthly accumulated et to characterize water consumption in target areas for applications of et at finer scales such as precision agriculture high spatiotemporal resolution and accuracy have always been the subject of ongoing studies while extracting more information from limited observations available is also of great importance the et mapping has been one of the advantages of ecostress however the maps of pt jpl etdaily and disalexi jpl etdaily as shown in fig 9 indicate that there are many missing or invalid values in the image probably due to the complex surface in the selected areas in fact previous studies on ecostress et on relatively homogeneous surfaces such as farmland have demonstrated its mapping capacity and potential ecostress et can respond to crop water stress at a field scale differentiating irrigation needed and irrigation free areas thus providing guidance for agricultural production aragon et al 2018 wu et al 2022 5 conclusions this study evaluated two ecostress et products with eddy covariance sites in six regions across the continental us postulating that the climate conditions are the same in one region to determine whether ecostress could capture the et from different biomes combining the in situ et and eco3etptjpl etinst spatially and temporally we observed an overestimation trend across the sites which was more pronounced in the morning there is one specific region co where the climate variables air temperature and net radiation exhibited relatively low correlations instantaneous et showed distinctions in accuracy and scattered patterns according to the biomes but the others give indistinguishable results the two daily et products namely pt jpl etdaily and disalexi jpl etdaily tend to overestimate local et notwithstanding giving underestimated results at few regions additionally it was found that the geographic regions of site stations determine their scatter pattern more than their vegetation types for which we argue that the climate of each region plays an important role a better understanding of the mechanisms controlling et is essential for assessing how land cover changes and disturbances such as fires and droughts influence plant water use and stress our current understanding is limited by a lack of theoretical understanding of the mechanisms how different data sets are able to capture these interactions and the sensitive degree of current et models to these changes in this regard our study provides a deep evaluation of ecostress et paving the ground for future studies aiming to describe et across heterogeneous landscapes at a finer scale credit authorship contribution statement lili liang formal analysis visualization writing original draft yu feng writing review editing methodology jie wu writing review editing xinyue he writing review editing shijing liang writing review editing xin jiang writing review editing gabriel de oliveira writing review editing jianxiu qiu writing review editing zhenzhong zeng conceptualization supervision funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this study was supported by the national natural science foundation of china 42071022 and the startup fund provided by the southern university of science and technology 29 y01296122 we thank all the principal researchers and teams for all the datasets and data processing tools used in this study and we thank the reviewers for their careful work and suggestions that helped improve this paper substantially appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 128470 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
2882,anthropogenic activity degrades stream water quality especially in urban areas quantified connections between pollution sources degree of water quality degradation and the disproportionate impact of degradation on underserved communities are not yet fully explored here the anthropogenic effects on water quality and the heterogeneous distribution of degraded streams were examined in the urban watershed of the rouge river in metropolitan detroit michigan we used benthic macroinvertebrate data collected by volunteer scientists and aggregated into a stream quality index sqi to define long term water quality patterns spatial dependence of the data was assessed with spatial stream network models incorporating socio economic and environmental predictors the best model included poverty as an explanatory variable with a negative relationship with stream quality sqi predictions under true watershed conditions revealed a 1 decrease in sqi with 1 increase in poverty this work demonstrated the benefits of volunteer science and spatial modeling methods for urban stream modeling our finding of inequitably distributed water quality impairment in urban streams underscores the importance of focused restoration in economically oppressed urban areas keywords volunteer science spatial stream network socio hydrology urban hydrology macroinvertebrates poverty data availability data will be made available on request 1 introduction human activity and environmental systems are interconnected over one third of earth s surface is impacted by anthropogenic landcover alterations vitousek et al 1997 and these landcover changes are connected to water quality and river ecosystem health allan 2004 landcover change is a particularly important driver of water quality in urban areas the term urban stream syndrome broadly defines this relationship between dense anthropogenic activity and the negative effect on stream quality and diminished ecosystem services booth et al 2016 walsh et al 2005 withers jarvie 2008 urban streams have higher nutrient loading grimm et al 2005 meyer et al 2005 wahl et al 1997 withers jarvie 2008 biochemical oxygen demand bod loading mallin et al 2006 highly variable flows blaszczak et al 2019 and highly variable temperature profiles walsh et al 2005 contributing to hypoxia and other damaging impacts causes and in stream effects of urban stream syndrome have been broadly assessed but less is known about how this water quality degradation is distributed within an urban watershed understanding disproportionate water quality degradation is essential to understand the extent and impact of urban stream syndrome in the united states the environmental protection agency u s epa monitors spatial connections between environmental indicators and demographic indicators through the ejscreen platform united states environmnetal protecion agency 2021 previous studies identified relationships between communities of racial minorities and economically oppressed people and environmental burdens like poor air quality anderson et al 2018 miranda et al 2011 harmful chemical exposures bevc et al 2007 inequitable land use zoning environmental regulation protections and environmental law enforcement bullard 1996 past studies of the intersections between water and environmental justice investigated inequity in flood risk and sought to inform just flooding infrastructure and management decisions maantay maroko 2009 meenar et al 2018 recent work expanded this study between environmental justice and water to include quantitative assessments of the spatial distribution of socioeconomic status and stream water quality daneshvar et al 2018 daneshvar et al 2016 sanchez et al 2015 sanchez et al 2014 existing models demonstrate weak correlations or inconsistent correlation directions between stream health and socioeconomic parameters daneshvar et al 2018 2016 sanchez et al 2015 sanchez et al 2014 limitations in data availability and the need to address the complex longitudinal patterns in stream quality data present challenges towards exploring these relationships between stream quality and socioeconomic distribution of stream degradation the first challenge the paucity of water quality data is an issue because both spatially and temporally robust data are necessary to accurately represent prevailing water quality trends this challenge was addressed in the present study with volunteer science i e citizen science data volunteer science programs are a widely used method to overcome the data shortage challenge taylor et al 2022 involving community members in water quality research enables more spatially and temporally robust data collection spanning large physical distances and long time periods while promoting community engagement and education buytaert et al 2014 jollymore et al 2017 krabbenhoft kashian 2020 njue et al 2019 however volunteer science resources are limited for example safety conditions or lack of volunteers prevent uniform and ubiquitous distribution of sampling effort for this reason a combination of modeling and volunteer science data are necessary to achieve full spatial coverage of water quality data the second challenge stream connectivity refers to the interdependency between water quality observations on streams both in stream and out of stream relationships may exist between data points and this prevents the application of analysis methods requiring independence between points to overcome this challenge the spatial correlations from upstream downstream and near stream relationships must be considered spatial stream network ssn models appropriately address stream connectivity by encompassing spatial correlations that exist both on flow paths and outside of flow paths into model predictions isaak et al 2014 peterson ver hoef 2014 peterson et al 2013 ver hoef et al 2014 when used in conjunction volunteer science data and ssn modeling overcome challenges in data paucity and stream connectivity this research is a collaboration with friends of the rouge fotr a non profit organization that leads volunteer science data collection events in metropolitan detroit fotr and their volunteer scientists voiced an interest in better understanding the relationships between socioeconomic environmental and water quality patterns in the rouge river our goal is to address this community interest and address the prevailing lack of understanding of the distribution of water quality impairment in urban watersheds the large area and urban setting of the rouge river provides a range of environmental conditions and diverse communities towards addressing this question we address the challenges of data paucity and stream connectivity analysis with volunteer science and spatial modeling our hypothesis is that water quality degradation in metropolitan detroit is not distributed uniformly across communities of varying poverty levels to test this hypothesis benthic macroinvertebrate observations from fotr volunteer scientists were modeled with environmental and socio economic variables in an ssn model additionally this model was used to predict water quality under varying manipulated watershed conditions to evaluate the relationship between poverty and predicted water quality 2 methods 2 1 study area the study area was the rouge river watershed which contains parts of metropolitan detroit mi the watershed is approximately 1200 km2 and includes 204 km of stream segments fig 1 the watershed drains into the detroit river which within the context of the laurentian great lakes connects lake st clair and lake erie the rouge river watershed is highly urbanized with 85 developed 4 agricultural and 6 forested landcover nlcd 2019 these landcover types are spatially heterogeneous across the watershed with a general trend of increasing urbanization towards the outlet in the southeast from 2001 to 2019 imperviousness increased across the watershed but the magnitude of this increase was 1 within 97 of catchments the rouge river twenty year mean annual discharge is 147 million m3 year 1 us geological survey 2016 landcover and hydrologic conditions within the various tributaries are diverse the relatively undeveloped and rural headwaters contain the least impacted streams the rouge river stream segments span all levels of anthropogenic alteration from groundwater fed pristine segments to segments encased in concrete channels the u s epa identified the lower rouge river as an area of concern under the great lakes water quality agreement of 1987 and cited nine beneficial use impairments in the watershed selzer 2008 2 2 volunteer science stream quality index data benthic macroinvertebrates are bioindicators of stream health and quality and they are relevant in environmental impact studies near the rouge river burlakova et al 2018 and globally bae et al 2005 del arco et al 2012 graham taylor 2018 patang et al 2018 macroinvertebrate populations are affected by environmental degradation and their use as sentinels of water quality impact from urbanization is well documented del arco et al 2012 kenney et al 2010 vitousek et al 1997 walsh et al 2005 walsh et al 2001 benthic macroinvertebrates are particularly good bioindicators of stream conditions as the presence or absence of sensitive taxa reflects long term stream conditions rather than the snapshot conditions shown by grab samples and chemical analysis infante et al 2009 lenat 1988 this relevance as a water quality proxy as well as cheap and simple collection methods make benthic macroinvertebrates a feasible water quality indicator for volunteer science groups graham taylor 2018 here we use volunteer science collected benthic macroinvertebrate data as a bioindicator of water quality macroinvertebrate species and frequencies were collected by fotr volunteers fotr collected benthic macroinvertebrate data with volunteer scientists participating in biannual spring and fall bug hunts fotr started collecting benthic macroinvertebrate data in 2001 and data collection is ongoing prior to collection and identification events volunteers were trained as bug hunt team leaders in workshops led by both fotr and a local biologist samples were collected from a rotating subset of 122 sampling locations fig 1 trained volunteer scientist leaders surveyed instream habitats for benthic macroinvertebrates riffle cobble pool overhanging vegetation undercut banks with d frame nets brua et al 2011 macroinvertebrates were preliminarily identified in the field to order four to five specimens of all but clams mussels snails and crayfish were preserved in ethanol and later identified in the lab by fotr staff and the local biologist to check field identifications and identify to family the sensitivity of benthic macroinvertebrates and their frequencies were converted to a stream quality index sqi using the micorps macroinvertebrate datasheet supplemental fig 1 sqi categorizes macroinvertebrates mainly by order into three levels sensitive somewhat sensitive and tolerant based on pollution sensitivity and rates them as rare 1 10 individuals or common 11 or more common sensitive organisms like mayflies are scored higher than common tolerant organisms a higher sqi score reflects higher numbers of sensitive species like stonefly nymphs plecoptera and hellgrammites megaloptera indicating higher water quality this study considers biannual sqi observations from 2001 to 2021 n 1 655 site visits all fotr volunteer science sqi collection was completed using a quality assurance project plan reviewed by the michigan department of environment great lakes and energy egle the michigan department of natural resources the michigan clean water corps micorps the wayne county department of public services and fotr petrella 2020 fotr checked sqi scores year to year and flagged data points that differed from past observations yearly observations of sqi were also checked against local knowledge and reported biannually a validation study found that sqi calculated in the rouge river and nearby clinton river by volunteer scientists produced comparable but more conservative estimates of stream quality than quantitative data collected by professional scientists krabbenhoft kashian 2020 the sqi is a water quality index used by monitoring groups in michigan developed by the michigan department of environmental quality now michigan egle through their grant funded program to engage volunteer science groups in benthic macroinvertebrate monitoring around the state micorps is a statewide network that took oversight of the state backed volunteer science monitoring program in 2003 michigan clean water corps about n d the establishment of the sqi metric in michigan follows the popularization of bioindicators for water quality monitoring at the state and federal level in the late 1980s due in part to guiding programs like epa s rapid bioassessment protocol barbour et al 1999 barbour et al 2006 indices of biological integrity similar to sqi are historically prevalent in volunteer based water quality monitoring firehock and west 1995 and accepted as reliable indicators of aquatic conditions engel voshell 2002 further there is a precedent for bioindicator index application in in foundational environmental justice water quality models daneshvar et al 2018 2016 sanchez et al 2015 sanchez et al 2014 2 3 stream spatial network to test our hypothesis we built an ssn model for sqi as a function of environmental and social variables this modeling step was performed to expand the spatial coverage of sqi data environmental data included landcover and stream characteristics and socio economic data was represented by poverty distributions landcover is a strong driver of in stream conditions where anthropogenic land uses whether urban or agricultural degrade stream quality brabec et al 2002 carlisle et al 2009 chen et al 2016 epps hathaway 2021 tong chen 2002 degraded stream quality effects population size and diversity of benthic macroinvertebrate communities which are sensitive to degraded stream conditions carlisle et al 2009 walsh et al 2001 wang et al 2018 thus we used sediment regulation lack of degradation from sedimentation and percent imperviousness of watershed area as landcover characteristics to predict invertebrate population derived sqi these parameters were obtained from the u s epa streamcat database and were available for each individual stream segment hill et al 2016 three different poverty metrics were weakly but positively correlated with another water quality index in the neighboring watershed of the saginaw bay basin sanchez et al 2014 poverty was obtained from the u s census bureau s 2016 american community survey data imperviousness is a measured value indicating the mean percent of landcover that is classified as an anthropogenic surface such as pavement roads and buildings fig 2 b our imperviousness variable is an average of the mean percent of impervious landcover within a stream segment s immediate and upstream drainage area as reported for 2001 2004 2006 2008 2011 2013 2016 and 2019 in the national land cover database nlcd dewitz u s geological survey 2021 sediment regulation is a modeled parameter on a scale of 0 to 1 that was developed to summarize sedimentation using instream and out of stream parameters in the streamcat database hill et al 2016 thornbrugh et al 2018 fig 2a sedimentation describes inorganic particle retention and size alteration due to transport to and within streams flotemersch et al 2016 thornbrugh et al 2018 the sediment regulation parameter was calculated considering observed values of stressors relative to maximum stress level for 5 major stressors 1 presence and volume of reservoirs 2 stream channelization and levee construction 3 alteration and changes to riparian vegetation 4 frequency of mines frequency of forest cover loss and density of roads and 5 agriculture presence weighted by soil erodibility flotemersch et al 2016 hill et al 2016 thornbrugh et al 2018 poverty associated with each stream segment reflects census tract level percentages of households living below the poverty line an annual household income of 31 661 fig 2c u s census bureau us census 2020 poverty information was obtained as census tract based and converted to the average poverty in the topographical boundary catchment of each stream segment these catchment level values were then averaged with upstream catchments to express the percentage of households below the poverty line in the entire upstream drainage area of each stream segment poverty as census tract based measurements ranged from 0 to 91 and when converted to upstream watershed based ranged from 0 2 to 24 5 of households in the catchment and upstream watershed residing below the poverty line in addition to multiple explanatory variables the ssn also considers spatial relationships between sites in models spatial relationships are categorized into either flow connected or flow unconnected relationships based on whether there is a direct flow path connecting two sites these relationships consider three autocovariance functions tail up tail down and euclidean distance tail up autocovariance exists only between flow connected sites and they represent a weighted moving average function in the upstream direction tail down autocovariance may exist under either flow connected or flow unconnected conditions and they represent a weighted moving average function in the downstream direction euclidean distance may be considered in flow unconnected relationships when autocovariance isn t restricted to in channel distances between sites garreta et al 2010 isaak et al 2014 ver hoef erin 2010 the weighting model for these tail up and tail down autocovariances can be calculated with linear exponential spherical mariah and epanech weights garreta et al 2010 ver hoef erin 2010 euclidean autocovariance weighting included standard spatial covariance models spherical exponential gaussian and cauchy the suitability of these various spatial autocovariances differs depending on the nature of the stream metric for example chemical data would be most likely to follow flow connected tail down autocovariance because chemical transport in a stream network is driven by transport in the channel and in the downstream direction however macroinvertebrate derived data may be represented with both flow connected and flow unconnected relationships since benthic macroinvertebrates have preferential travel along stream channels but they can travel in both in upstream and downstream directions and can also move outside of the confinement of stream channels isaak et al 2014 our ssn was implemented by using the spatial tools for the analysis of river systems stars and ssn tools in arcmap 10 8 1 r version 3 6 1 and rstudio version 1 2 5019 respectively peterson ver hoef 2014 ver hoef et al 2014 ssn models were made with sediment regulation imperviousness and poverty as independent variables the dependent variable was log mean sqi mean sqi was calculated as the mean sqi observation at a site through time means were taken to simplify temporally diverse data because only 9 of sites observed a linear change p 0 05 in sqi over time and this change was mixed with 7 sites increasing and 4 sites decreasing sqi mean sqis were logged to ensure normal distribution all explanatory variables were normalized using min max normalization to redistribute values from 0 to 1 based on the ranges of these variables measured at observation sites this was done to standardize model covariates to the same scale ssn models were constructed with multiple combinations of tail up tail down and euclidean distance autocovariances to encompass the three possible spatial relationships between observation sites isaak et al 2014 ver hoef et al 2014 a final ssn model was then selected by comparing models with the evaluators akaike information criterion aic coefficient of determination r2 and root mean square error rmse calculated from leave one out cross validation loocv the best performing ssn of sqi as a function of the environmental variables and socio economic variables was further evaluated by comparing it to two simpler models the first simple model omitted the spatial component of the ssn and the second simple model omitted the socio economic variable additionally sqi could decrease downstream along flowlines as a result of physical stream attributes associated with high flows and greater depth to account for this the best performing model was reparametrized with a random effect for stream order again models with and without the stream order random effect were compared via aic r2 and rmse 2 4 water quality across potential scenarios to explore potential conditions within the rouge river we predicted sqi with the best performing model at points every 800 m of all stream segments in the rouge river watershed sqi predictions were made under 4 conditions true observed conditions and three levels of hypothetical watershed conditions good standard and poor conditions fig 3 each hypothetical watershed condition used manipulated values of imperviousness and sediment regulation and observed values of poverty the values of imperviousness and sediment regulation conditions assigned to the good standard and poor labels were selected to represent a range of values that are realistic for the watershed good conditions were defined as imperviousness at 25 of the range of imperviousness observations 18 imperviousness and 75 of the range of sediment regulation 0 96 standard conditions were defined as imperviousness at 50 of the range of imperviousness observations 35 imperviousness and 50 of the range of sediment regulation 0 94 poor conditions were defined as imperviousness at 75 of the range of imperviousness 53 imperviousness and 25 of the range of sediment regulation 0 92 imperviousness and sediment regulation intervals were opposite one another because increasing imperviousness is associated with poor environmental conditions while increasing sediment regulation indicates higher integrity or lack of impact from sedimentation and is thus associated with better environmental conditions these intervals were made to demonstrate the impact of poverty on sqi under different environmental conditions that were reasonable in the context of the ranges of imperviousness and sediment regulation observed in the watershed linear models of predicted sqi and poverty were generated based on the 4 conditions above the slopes of these linear models were then compared 3 results 3 1 sqi observations average sqi observations ranged from 14 to 48 fig 4 a stream quality was generally worse on the main branch and near the watershed outlet however poor quality was also observed in some headwater streams the highest quality was observed on streams on the western edge of the watershed 3 2 spatial model performance the best performing ssn model based on our model comparison metrics used sediment regulation imperviousness and poverty in a multivariate spatial regression model with a linear sill tail down autocovariance and no random effect on stream order supplementary table 1 the r2 value indicates that about 1 3 of the variability in sqi is captured in the model the rmse indicates that prediction error is about 3 sqi points or about 10 of the range of observed sqi values the explanatory variables are correlated with one another however variance inflation factors vif helsel hirsch 1992 for sedimentation imperviousness and poverty were low 1 23 1 23 and 1 16 respectively these are close to the ideal value vif 1 helsel hirsch 1992 and below the cutoff value applicable for ssn models vif 5 isaak et al 2017 thus suitable for our hypothesis testing imperviousness and poverty had negative relationships with sqi with model coefficients 0 28 p 0 01 and 0 23 p 0 05 respectively sediment regulation had a positive relationship model coefficient 0 30 p 0 07 this is interpreted as less impact from sedimentation related to higher sqi the linear sill tail down autocovariance indicates that both flow connected and flow unconnected relationships exist in the sqi data and that these relationships are linear and point downstream this means that between two sqi observations the downstream point is influenced by the upstream point and that relationship decreases linearly with increasing distance between the points this spatial socio economic environmental model outperformed the non spatial model and spatial model fit with only environmental predictors the simple model had a higher r2 value supplementary table 1 but lower aic and rmse fig 5 the spatial environmental only model had a slightly higher aic lower r2 and higher rmse compared to the best model supplementary table 1 the rmse value especially highlights the value of modeling sqi with ssn models as the rmse for the non spatial model was about one sqi index point higher than the rmse for either of the spatial models indicating a worse ability of the non spatial model to capture the true variability in sqi data fig 5 poverty adds predictive power to the model as demonstrated by the improvement in all model evaluators when poverty is included in the spatial model adding stream order as a random effect did not improve model performance the stream order random effect model had a higher aic and rmse and a comparable r2 as the best performing model this showed that the relationship between sqi and explanatory variables did not vary based on the stream order in other words small streams should not be modeled differently than larger branches this provides support that stream order and associated downstream trends do not explain water quality in the watershed better than sediment regulation imperviousness and poverty without stream positioning information 3 3 predictions under potential scenarios the ssn model was used to predict sqi every 800 m of stream segment in the rouge river watershed under true conditions in the watershed sqi predictions ranged from 15 76 poor to 44 83 good fig 4b the average prediction standard error was 1 17 the slope between poverty and predicted sqi was negative and indicated that a stream segment with 10 higher poverty in its upstream watershed drainage area would have a 3 62 lower sqi this 3 62 change in sqi is equivalent to a 10 change in the range of water quality or about a 1 decrease in water quality for every 1 increase in poverty under manipulated watershed conditions poverty and predicted sqi also had negative relationships fig 6 the magnitude of this negative relationship increased with increasingly positive watershed conditions under poor watershed conditions 53 imperviousness 0 92 sediment regulation a 10 increase in poverty would result in a decrease in sqi by 2 87 under standard watershed conditions 35 imperviousness 0 94 sediment regulation a 10 increase in poverty would decrease sqi by 3 61 finally under good watershed conditions 18 imperviousness sediment regulation 0 96 a 10 increase in poverty would decrease sqi by 4 53 4 discussion 4 1 degraded water quality in higher poverty areas the identified negative relationship between water quality and poverty provides information about spatial distribution of water quality degradation our ssn s negative coefficient between stream quality and poverty provides statistical evidence that stream quality is associated with socioeconomic factors in addition to known relationships between stream quality and environmental factors like sediment regulation and imperviousness the observed decrease of stream quality in high poverty areas provides support that urban stream degradation is inequitably distributed it is important to emphasize that the negative relationship does not prove a causal relationship it provides statistical support that environmental degradation of water quality disproportionately affects impoverished communities explicitly it is incorrect to interpret that high poverty causes poor water quality while a latent cause effect relationship may exist our analysis does not articulate an underlying causal structure previous research provides support for potential casual structures for example inequity in access and proximity to parks has been shown for poor communities rigolon et al 2018 and park land is one tool used to impede stormwater runoff from polluting streams cettner et al 2013 local knowledge and spatial setting further contextualize the relationship between poverty and water quality the highest poverty area in the watershed is in the southeast region of the watershed observations of sqi in this area included 23 sites with an average sqi of 24 a fair rating while this sqi score is relatively low it fails to express other water quality issues in this area the segment of the rouge river bordering the highest density poverty area contains 21 uncontrolled combined sewer overflow cso outfalls making this area subject to flashy water levels and at risk to acute degradation events post rainfall as is true in cities with similar drainage systems like philadelphia pa and chicago il miskewitz uchrin 2013 quijano et al 2017 further tributary streams in this area are sparse having been removed from their historical locations fig 7 the lack of tributary streams in this area is an example of water inequality as this high poverty area is deprived of natural surface waters entirely this lack of naturally formed stream channels is also a limit of our analysis lack of natural drainage boundaries in high poverty areas as well as highly urbanized areas compromise the catchment level units of analysis in these areas our measurements of sediment regulation and imperviousness may not properly represent the land being drained to stream segments since stormwater infrastructure in a combined sewer system would carry stormwater to a wastewater treatment plant or in an overflow event may convey water to stream segments that wouldn t have naturally received that water to estimate water quality more accurately in the high poverty area of the rouge river future work would need to consider conversion of naturally delineated drainage areas to those defined by stormwater infrastructure achleitner et al 2007 house et al 1993 tscheikner gratl et al 2019 other limits of our poverty analysis are the quality of u s census data and the assumptions made in converting poverty data from census tract to catchment based units a limitation of environmental justice datasets is low survey responses and lack of internal community involvement in surveying lee 2020 mah 2017 increased involvement of local community members in environmental justice data collection is necessary for increased understanding of the disproportionate water quality burdens across socioeconomic groups a second layer of potential error in u s census data was introduced when we converted data from census tracts to drainage area this conversion was made by assuming that poverty was distributed homogenously in census tracts this assumption is an over generalization that could lead to inaccuracy in calculating poverty rates in units of catchments scales of socioeconomic data resolution are influential in improving stream health modeling performance daneshvar et al 2016 so future modeling efforts would benefit from a more realistic conversion of socioeconomic data from census area to area units more conducive to water quality modeling 4 2 volunteer science data applicability volunteer science collected water quality data was key to executing this work the term volunteer science was selected intentionally over similar titles citizen science community science community based monitoring because volunteers collected data and volunteerism was entirely unrelated to citizen status contrary to the implication of the term citizen science and the community was not involved in all stages of the research as is common in community science cooper et al 2021 our work serves as an example of a mutually beneficial partnership between formal research and volunteer science labor cost time and local knowledge would have prevented this research without volunteer science collaboration which provided a temporally and spatially robust dataset for the volunteer science data collecting group fotr technical and resource hurdles stand in the way of the spatial model building and analysis needed to fully understand river data this mutually beneficial partnership between scientists and the local community offers the exchange of knowledge and perspective from interested parties who come from diverse backgrounds and motivations taylor et al 2022 and is one reason why volunteer science has recently become more prevalent in aquatic science and hydrology research kielstra et al 2019 krabbenhoft kashian 2020 maguire mundle 2020 an additional co benefit of fotr volunteer science is that data collection events are used to engage volunteer scientists in the watershed raise awareness about river conditions and advocate for the need to clean up the rouge river despite the benefits offered to both scientists and volunteer science groups there are obstacles that prevent the widespread use of volunteer science data these obstacles include scientific community acceptance data validity and governance research problem definition and in the case of water quality observation tool expense and access buytaert et al 2016 buytaert et al 2014 the most common critique of volunteer science is data validity jollymore et al 2017 means to overcome this obstacle include volunteer scientist training and understanding of volunteer science volunteerism motivation which increases the reliability alender 2016 buytaert et al 2014 jollymore et al 2017 in volunteer science organized by fotr volunteer training and internal quality assurance checks are the primary means of data quality assurance the team leaders who collect data attend training in the classroom and field to learn sampling techniques and identification volunteers who want to become team leaders must first attend a sampling day as a regular volunteer following training trainees are paired with an experienced team leader for their first few events and the experienced leader works with them to make sure they are sampling thoroughly and following procedures team leaders repeat the training every few years to stay updated on sampling days team leaders conduct all sample collection and untrained volunteers assist in picking through the samples team leaders collect voucher specimens which are identified in the lab quality assurance is performed with internal checks against historical sqi observations where any results for sites that vary greatly from past sampling are examined to determine the cause a reliability study on fotr volunteer science data concluded the sqi data used here is a conservative estimate of water quality as traditionally measured numerically by scientists krabbenhoft kashian 2020 the macroinvertebrate preservation method used by fotr may be one potential source of this discrepancy as only 4 5 representative specimens are preserved for post hoc identification rather than preserving all samples as recommended by other benthic macroinvertebrate sampling barbour et al 1999 4 2 1 lessons from friends of the rouge the long term operation of volunteer science at fotr has resulted in many learned experiences that can benefit other communities including the scientific community initially fotr provided training and equipment and expected trainees to monitor sites on their own this model failed to engage volunteers and consequently fotr altered their sampling events to group sampling days with the trainees leading untrained volunteers this structure allows for wide community participation with over 100 volunteers attending monitoring days success of this method is measured through volunteer retention and influence of volunteering experience on community members many volunteers return year after year some for as long as 20 years volunteers learn about stream ecology and urban rivers through their experience at sampling events children participate with their parents and many reported going on to pursue a degree in the sciences because of the experience fotr also attributes their success to their commitment to ensure that the data is useful and made available to stakeholders following each monitoring event a report is made available to all volunteers and state and local agencies including the communities who are now providing some of the funding to support monitoring fotr makes the data freely available to academic institutions for research use which has resulted in journal publications krabbenhoft kashian 2020 maguire mundle 2020 and several master s students theses volunteer science events conducted by fotr have also resulted in unsuspected co benefits inspired by questions from volunteers about pipes while sampling team leaders are now trained in illicit discharge elimination and have been responsible for reporting spills sewage leaks erosion issues and more that might have never been noticed otherwise volunteers have also observed other species while working on macroinvertebrate study events notably new native species have been documented including one new to the state and multiple invasive species were tracked 4 3 spatial modeling the ssn and stars tools were useful in modeling stream water quality in the rouge river from volunteer science water quality data and spatial relationships in stream systems stars and ssn tools have been applied to a range of stream modeling applications like surface water isotope variations mcgill et al 2020 fish genetic diversity in southern france paz vinas et al 2018 and fecal contamination in streams in northeast scotland neill et al 2018 and central north carolina holcomb et al 2018 ssn methods have been previously applied with volunteer science data kielstra et al 2019 and macroinvertebrates in streams frieden et al 2014 pond et al 2017 this project uniquely combines volunteer science collected macroinvertebrate data into a spatial model which together were able to overcome challenges in data paucity and stream connectivity water quality in the rouge river was modeled with imperviousness and sediment regulation both of which reflect some degree of anthropogenic activity and together they show that human behavior affects stream quality through different avenues imperviousness is directly related to human populations and densities where high imperviousness is associated with high human density and is known to cause increased flashiness temperatures and bod and cause streamlined pollution conveyance via stormwater blaszczak et al 2019 grabowski et al 2016 mallin et al 2009 the negative imperviousness coefficient modeled here aligns with the emphasis placed on impervious sources as a key driver of water resources impacts in previous research arnold gibbons 1996 mcgrane 2016 salerno et al 2018 sediment regulation is estimated through factors directly or indirectly driven by humans like reservoir presence and volume stream channelization riparian vegetation and agriculture weighted by soil erodibility thornbrugh et al 2018 the positive coefficient associated with sediment regulation indicates an increase in sensitive benthic macroinvertebrate species associated with high sediment regulation this relationship was expected as benthic macroinvertebrates thrive in well oxygenated water with low proportions of fine substrate kaller hartman 2004 von bertrab et al 2013 the use of imperviousness and sediment regulation helped to build the stream quality ssn model our methodology using an ssn model builds upon existing analyses of the socioeconomic influence of stream quality previous analyses explored regression relationships and spatial clustering between stream environment indicators and variables describing historically disadvantaged populations these studies found mixed correlation results revealing negative trends between a stream health index and both household size and poverty daneshvar et al 2016 sanchez et al 2014 the strength of correlations between socioeconomic and stream health indices was improved by applying spatial clustering sanchez et al 2015 and tailoring the resolution of spatial analysis daneshvar et al 2016 in general higher resolution data produced higher correlations daneshvar et al 2016 sanchez et al 2015 the method of parameter estimation for environmental justice modeling has also been performed with many explanatory variables categorized as ecological socioeconomic and physiological daneshvar et al 2018 this work s methodology avoided the ambiguousness associated with correlation calculations and complexity of clustering methods by using both socioeconomic and environmental variables and a spatial model designed for stream networks the spatial modeling framework applied in past models was conditional autoregressive modeling which considers spatial influence of neighboring points daneshvar et al 2016 sanchez et al 2015 sanchez et al 2014 our modeling approach with ssn expands on this consideration of neighboring points by including relationships that exist on stream flow paths while our model identifies weaker statistical relationships than those observed in past models sanchez et al 2015 sanchez et al 2014 the simplicity and interpretability of our ssn model provides a straightforward means of expressing the complex relationship between socioeconomic parameters and urban stream quality ultimately our work aligns with previous environmental justice models all finding negative relationships between historically underserved groups and water quality via stream health indices 5 conclusion urban stream syndrome remains a prevalent environmental concern and this work shows how degraded stream water quality disproportionately burdens higher poverty areas our results show that under similar environmental conditions streams with higher poverty have lower stream quality volunteer science collected data provided a robust understanding of stream quality in the rouge river and spatial modeling methods enabled the incorporation of stream interdependencies in stream quality modeling in further analyses of the socioeconomic distribution of water quality degradation we encourage the partnership of volunteer science groups who may have parallel interests in understanding the water quality story in their community credit authorship contribution statement isabelle r horvath formal analysis investigation visualization anthony j parolari supervision writing review editing sally petrella conceptualization resources data curation writing review editing craig a stow writing review editing supervision project administration funding acquisition casey m godwin writing review editing supervision project administration funding acquisition timothy j maguire conceptualization methodology software formal analysis investigation data curation visualization supervision funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the authors would like to thank the cooperative institute for great lakes research ciglr in partnership with the national oceanic and air administration great lakes environmental research laboratory noaa glerl for partial funding of this project through the summer fellows program ih funding was awarded to ciglr through the noaa cooperative agreement with the university of michigan na17oar4320152 this ciglr contribution number is 1199 and noaa glerl contribution number is 2011 additional thanks to friends of the rouge and their volunteers for data collection without whom this project would not have been possible appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 128475 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
2882,anthropogenic activity degrades stream water quality especially in urban areas quantified connections between pollution sources degree of water quality degradation and the disproportionate impact of degradation on underserved communities are not yet fully explored here the anthropogenic effects on water quality and the heterogeneous distribution of degraded streams were examined in the urban watershed of the rouge river in metropolitan detroit michigan we used benthic macroinvertebrate data collected by volunteer scientists and aggregated into a stream quality index sqi to define long term water quality patterns spatial dependence of the data was assessed with spatial stream network models incorporating socio economic and environmental predictors the best model included poverty as an explanatory variable with a negative relationship with stream quality sqi predictions under true watershed conditions revealed a 1 decrease in sqi with 1 increase in poverty this work demonstrated the benefits of volunteer science and spatial modeling methods for urban stream modeling our finding of inequitably distributed water quality impairment in urban streams underscores the importance of focused restoration in economically oppressed urban areas keywords volunteer science spatial stream network socio hydrology urban hydrology macroinvertebrates poverty data availability data will be made available on request 1 introduction human activity and environmental systems are interconnected over one third of earth s surface is impacted by anthropogenic landcover alterations vitousek et al 1997 and these landcover changes are connected to water quality and river ecosystem health allan 2004 landcover change is a particularly important driver of water quality in urban areas the term urban stream syndrome broadly defines this relationship between dense anthropogenic activity and the negative effect on stream quality and diminished ecosystem services booth et al 2016 walsh et al 2005 withers jarvie 2008 urban streams have higher nutrient loading grimm et al 2005 meyer et al 2005 wahl et al 1997 withers jarvie 2008 biochemical oxygen demand bod loading mallin et al 2006 highly variable flows blaszczak et al 2019 and highly variable temperature profiles walsh et al 2005 contributing to hypoxia and other damaging impacts causes and in stream effects of urban stream syndrome have been broadly assessed but less is known about how this water quality degradation is distributed within an urban watershed understanding disproportionate water quality degradation is essential to understand the extent and impact of urban stream syndrome in the united states the environmental protection agency u s epa monitors spatial connections between environmental indicators and demographic indicators through the ejscreen platform united states environmnetal protecion agency 2021 previous studies identified relationships between communities of racial minorities and economically oppressed people and environmental burdens like poor air quality anderson et al 2018 miranda et al 2011 harmful chemical exposures bevc et al 2007 inequitable land use zoning environmental regulation protections and environmental law enforcement bullard 1996 past studies of the intersections between water and environmental justice investigated inequity in flood risk and sought to inform just flooding infrastructure and management decisions maantay maroko 2009 meenar et al 2018 recent work expanded this study between environmental justice and water to include quantitative assessments of the spatial distribution of socioeconomic status and stream water quality daneshvar et al 2018 daneshvar et al 2016 sanchez et al 2015 sanchez et al 2014 existing models demonstrate weak correlations or inconsistent correlation directions between stream health and socioeconomic parameters daneshvar et al 2018 2016 sanchez et al 2015 sanchez et al 2014 limitations in data availability and the need to address the complex longitudinal patterns in stream quality data present challenges towards exploring these relationships between stream quality and socioeconomic distribution of stream degradation the first challenge the paucity of water quality data is an issue because both spatially and temporally robust data are necessary to accurately represent prevailing water quality trends this challenge was addressed in the present study with volunteer science i e citizen science data volunteer science programs are a widely used method to overcome the data shortage challenge taylor et al 2022 involving community members in water quality research enables more spatially and temporally robust data collection spanning large physical distances and long time periods while promoting community engagement and education buytaert et al 2014 jollymore et al 2017 krabbenhoft kashian 2020 njue et al 2019 however volunteer science resources are limited for example safety conditions or lack of volunteers prevent uniform and ubiquitous distribution of sampling effort for this reason a combination of modeling and volunteer science data are necessary to achieve full spatial coverage of water quality data the second challenge stream connectivity refers to the interdependency between water quality observations on streams both in stream and out of stream relationships may exist between data points and this prevents the application of analysis methods requiring independence between points to overcome this challenge the spatial correlations from upstream downstream and near stream relationships must be considered spatial stream network ssn models appropriately address stream connectivity by encompassing spatial correlations that exist both on flow paths and outside of flow paths into model predictions isaak et al 2014 peterson ver hoef 2014 peterson et al 2013 ver hoef et al 2014 when used in conjunction volunteer science data and ssn modeling overcome challenges in data paucity and stream connectivity this research is a collaboration with friends of the rouge fotr a non profit organization that leads volunteer science data collection events in metropolitan detroit fotr and their volunteer scientists voiced an interest in better understanding the relationships between socioeconomic environmental and water quality patterns in the rouge river our goal is to address this community interest and address the prevailing lack of understanding of the distribution of water quality impairment in urban watersheds the large area and urban setting of the rouge river provides a range of environmental conditions and diverse communities towards addressing this question we address the challenges of data paucity and stream connectivity analysis with volunteer science and spatial modeling our hypothesis is that water quality degradation in metropolitan detroit is not distributed uniformly across communities of varying poverty levels to test this hypothesis benthic macroinvertebrate observations from fotr volunteer scientists were modeled with environmental and socio economic variables in an ssn model additionally this model was used to predict water quality under varying manipulated watershed conditions to evaluate the relationship between poverty and predicted water quality 2 methods 2 1 study area the study area was the rouge river watershed which contains parts of metropolitan detroit mi the watershed is approximately 1200 km2 and includes 204 km of stream segments fig 1 the watershed drains into the detroit river which within the context of the laurentian great lakes connects lake st clair and lake erie the rouge river watershed is highly urbanized with 85 developed 4 agricultural and 6 forested landcover nlcd 2019 these landcover types are spatially heterogeneous across the watershed with a general trend of increasing urbanization towards the outlet in the southeast from 2001 to 2019 imperviousness increased across the watershed but the magnitude of this increase was 1 within 97 of catchments the rouge river twenty year mean annual discharge is 147 million m3 year 1 us geological survey 2016 landcover and hydrologic conditions within the various tributaries are diverse the relatively undeveloped and rural headwaters contain the least impacted streams the rouge river stream segments span all levels of anthropogenic alteration from groundwater fed pristine segments to segments encased in concrete channels the u s epa identified the lower rouge river as an area of concern under the great lakes water quality agreement of 1987 and cited nine beneficial use impairments in the watershed selzer 2008 2 2 volunteer science stream quality index data benthic macroinvertebrates are bioindicators of stream health and quality and they are relevant in environmental impact studies near the rouge river burlakova et al 2018 and globally bae et al 2005 del arco et al 2012 graham taylor 2018 patang et al 2018 macroinvertebrate populations are affected by environmental degradation and their use as sentinels of water quality impact from urbanization is well documented del arco et al 2012 kenney et al 2010 vitousek et al 1997 walsh et al 2005 walsh et al 2001 benthic macroinvertebrates are particularly good bioindicators of stream conditions as the presence or absence of sensitive taxa reflects long term stream conditions rather than the snapshot conditions shown by grab samples and chemical analysis infante et al 2009 lenat 1988 this relevance as a water quality proxy as well as cheap and simple collection methods make benthic macroinvertebrates a feasible water quality indicator for volunteer science groups graham taylor 2018 here we use volunteer science collected benthic macroinvertebrate data as a bioindicator of water quality macroinvertebrate species and frequencies were collected by fotr volunteers fotr collected benthic macroinvertebrate data with volunteer scientists participating in biannual spring and fall bug hunts fotr started collecting benthic macroinvertebrate data in 2001 and data collection is ongoing prior to collection and identification events volunteers were trained as bug hunt team leaders in workshops led by both fotr and a local biologist samples were collected from a rotating subset of 122 sampling locations fig 1 trained volunteer scientist leaders surveyed instream habitats for benthic macroinvertebrates riffle cobble pool overhanging vegetation undercut banks with d frame nets brua et al 2011 macroinvertebrates were preliminarily identified in the field to order four to five specimens of all but clams mussels snails and crayfish were preserved in ethanol and later identified in the lab by fotr staff and the local biologist to check field identifications and identify to family the sensitivity of benthic macroinvertebrates and their frequencies were converted to a stream quality index sqi using the micorps macroinvertebrate datasheet supplemental fig 1 sqi categorizes macroinvertebrates mainly by order into three levels sensitive somewhat sensitive and tolerant based on pollution sensitivity and rates them as rare 1 10 individuals or common 11 or more common sensitive organisms like mayflies are scored higher than common tolerant organisms a higher sqi score reflects higher numbers of sensitive species like stonefly nymphs plecoptera and hellgrammites megaloptera indicating higher water quality this study considers biannual sqi observations from 2001 to 2021 n 1 655 site visits all fotr volunteer science sqi collection was completed using a quality assurance project plan reviewed by the michigan department of environment great lakes and energy egle the michigan department of natural resources the michigan clean water corps micorps the wayne county department of public services and fotr petrella 2020 fotr checked sqi scores year to year and flagged data points that differed from past observations yearly observations of sqi were also checked against local knowledge and reported biannually a validation study found that sqi calculated in the rouge river and nearby clinton river by volunteer scientists produced comparable but more conservative estimates of stream quality than quantitative data collected by professional scientists krabbenhoft kashian 2020 the sqi is a water quality index used by monitoring groups in michigan developed by the michigan department of environmental quality now michigan egle through their grant funded program to engage volunteer science groups in benthic macroinvertebrate monitoring around the state micorps is a statewide network that took oversight of the state backed volunteer science monitoring program in 2003 michigan clean water corps about n d the establishment of the sqi metric in michigan follows the popularization of bioindicators for water quality monitoring at the state and federal level in the late 1980s due in part to guiding programs like epa s rapid bioassessment protocol barbour et al 1999 barbour et al 2006 indices of biological integrity similar to sqi are historically prevalent in volunteer based water quality monitoring firehock and west 1995 and accepted as reliable indicators of aquatic conditions engel voshell 2002 further there is a precedent for bioindicator index application in in foundational environmental justice water quality models daneshvar et al 2018 2016 sanchez et al 2015 sanchez et al 2014 2 3 stream spatial network to test our hypothesis we built an ssn model for sqi as a function of environmental and social variables this modeling step was performed to expand the spatial coverage of sqi data environmental data included landcover and stream characteristics and socio economic data was represented by poverty distributions landcover is a strong driver of in stream conditions where anthropogenic land uses whether urban or agricultural degrade stream quality brabec et al 2002 carlisle et al 2009 chen et al 2016 epps hathaway 2021 tong chen 2002 degraded stream quality effects population size and diversity of benthic macroinvertebrate communities which are sensitive to degraded stream conditions carlisle et al 2009 walsh et al 2001 wang et al 2018 thus we used sediment regulation lack of degradation from sedimentation and percent imperviousness of watershed area as landcover characteristics to predict invertebrate population derived sqi these parameters were obtained from the u s epa streamcat database and were available for each individual stream segment hill et al 2016 three different poverty metrics were weakly but positively correlated with another water quality index in the neighboring watershed of the saginaw bay basin sanchez et al 2014 poverty was obtained from the u s census bureau s 2016 american community survey data imperviousness is a measured value indicating the mean percent of landcover that is classified as an anthropogenic surface such as pavement roads and buildings fig 2 b our imperviousness variable is an average of the mean percent of impervious landcover within a stream segment s immediate and upstream drainage area as reported for 2001 2004 2006 2008 2011 2013 2016 and 2019 in the national land cover database nlcd dewitz u s geological survey 2021 sediment regulation is a modeled parameter on a scale of 0 to 1 that was developed to summarize sedimentation using instream and out of stream parameters in the streamcat database hill et al 2016 thornbrugh et al 2018 fig 2a sedimentation describes inorganic particle retention and size alteration due to transport to and within streams flotemersch et al 2016 thornbrugh et al 2018 the sediment regulation parameter was calculated considering observed values of stressors relative to maximum stress level for 5 major stressors 1 presence and volume of reservoirs 2 stream channelization and levee construction 3 alteration and changes to riparian vegetation 4 frequency of mines frequency of forest cover loss and density of roads and 5 agriculture presence weighted by soil erodibility flotemersch et al 2016 hill et al 2016 thornbrugh et al 2018 poverty associated with each stream segment reflects census tract level percentages of households living below the poverty line an annual household income of 31 661 fig 2c u s census bureau us census 2020 poverty information was obtained as census tract based and converted to the average poverty in the topographical boundary catchment of each stream segment these catchment level values were then averaged with upstream catchments to express the percentage of households below the poverty line in the entire upstream drainage area of each stream segment poverty as census tract based measurements ranged from 0 to 91 and when converted to upstream watershed based ranged from 0 2 to 24 5 of households in the catchment and upstream watershed residing below the poverty line in addition to multiple explanatory variables the ssn also considers spatial relationships between sites in models spatial relationships are categorized into either flow connected or flow unconnected relationships based on whether there is a direct flow path connecting two sites these relationships consider three autocovariance functions tail up tail down and euclidean distance tail up autocovariance exists only between flow connected sites and they represent a weighted moving average function in the upstream direction tail down autocovariance may exist under either flow connected or flow unconnected conditions and they represent a weighted moving average function in the downstream direction euclidean distance may be considered in flow unconnected relationships when autocovariance isn t restricted to in channel distances between sites garreta et al 2010 isaak et al 2014 ver hoef erin 2010 the weighting model for these tail up and tail down autocovariances can be calculated with linear exponential spherical mariah and epanech weights garreta et al 2010 ver hoef erin 2010 euclidean autocovariance weighting included standard spatial covariance models spherical exponential gaussian and cauchy the suitability of these various spatial autocovariances differs depending on the nature of the stream metric for example chemical data would be most likely to follow flow connected tail down autocovariance because chemical transport in a stream network is driven by transport in the channel and in the downstream direction however macroinvertebrate derived data may be represented with both flow connected and flow unconnected relationships since benthic macroinvertebrates have preferential travel along stream channels but they can travel in both in upstream and downstream directions and can also move outside of the confinement of stream channels isaak et al 2014 our ssn was implemented by using the spatial tools for the analysis of river systems stars and ssn tools in arcmap 10 8 1 r version 3 6 1 and rstudio version 1 2 5019 respectively peterson ver hoef 2014 ver hoef et al 2014 ssn models were made with sediment regulation imperviousness and poverty as independent variables the dependent variable was log mean sqi mean sqi was calculated as the mean sqi observation at a site through time means were taken to simplify temporally diverse data because only 9 of sites observed a linear change p 0 05 in sqi over time and this change was mixed with 7 sites increasing and 4 sites decreasing sqi mean sqis were logged to ensure normal distribution all explanatory variables were normalized using min max normalization to redistribute values from 0 to 1 based on the ranges of these variables measured at observation sites this was done to standardize model covariates to the same scale ssn models were constructed with multiple combinations of tail up tail down and euclidean distance autocovariances to encompass the three possible spatial relationships between observation sites isaak et al 2014 ver hoef et al 2014 a final ssn model was then selected by comparing models with the evaluators akaike information criterion aic coefficient of determination r2 and root mean square error rmse calculated from leave one out cross validation loocv the best performing ssn of sqi as a function of the environmental variables and socio economic variables was further evaluated by comparing it to two simpler models the first simple model omitted the spatial component of the ssn and the second simple model omitted the socio economic variable additionally sqi could decrease downstream along flowlines as a result of physical stream attributes associated with high flows and greater depth to account for this the best performing model was reparametrized with a random effect for stream order again models with and without the stream order random effect were compared via aic r2 and rmse 2 4 water quality across potential scenarios to explore potential conditions within the rouge river we predicted sqi with the best performing model at points every 800 m of all stream segments in the rouge river watershed sqi predictions were made under 4 conditions true observed conditions and three levels of hypothetical watershed conditions good standard and poor conditions fig 3 each hypothetical watershed condition used manipulated values of imperviousness and sediment regulation and observed values of poverty the values of imperviousness and sediment regulation conditions assigned to the good standard and poor labels were selected to represent a range of values that are realistic for the watershed good conditions were defined as imperviousness at 25 of the range of imperviousness observations 18 imperviousness and 75 of the range of sediment regulation 0 96 standard conditions were defined as imperviousness at 50 of the range of imperviousness observations 35 imperviousness and 50 of the range of sediment regulation 0 94 poor conditions were defined as imperviousness at 75 of the range of imperviousness 53 imperviousness and 25 of the range of sediment regulation 0 92 imperviousness and sediment regulation intervals were opposite one another because increasing imperviousness is associated with poor environmental conditions while increasing sediment regulation indicates higher integrity or lack of impact from sedimentation and is thus associated with better environmental conditions these intervals were made to demonstrate the impact of poverty on sqi under different environmental conditions that were reasonable in the context of the ranges of imperviousness and sediment regulation observed in the watershed linear models of predicted sqi and poverty were generated based on the 4 conditions above the slopes of these linear models were then compared 3 results 3 1 sqi observations average sqi observations ranged from 14 to 48 fig 4 a stream quality was generally worse on the main branch and near the watershed outlet however poor quality was also observed in some headwater streams the highest quality was observed on streams on the western edge of the watershed 3 2 spatial model performance the best performing ssn model based on our model comparison metrics used sediment regulation imperviousness and poverty in a multivariate spatial regression model with a linear sill tail down autocovariance and no random effect on stream order supplementary table 1 the r2 value indicates that about 1 3 of the variability in sqi is captured in the model the rmse indicates that prediction error is about 3 sqi points or about 10 of the range of observed sqi values the explanatory variables are correlated with one another however variance inflation factors vif helsel hirsch 1992 for sedimentation imperviousness and poverty were low 1 23 1 23 and 1 16 respectively these are close to the ideal value vif 1 helsel hirsch 1992 and below the cutoff value applicable for ssn models vif 5 isaak et al 2017 thus suitable for our hypothesis testing imperviousness and poverty had negative relationships with sqi with model coefficients 0 28 p 0 01 and 0 23 p 0 05 respectively sediment regulation had a positive relationship model coefficient 0 30 p 0 07 this is interpreted as less impact from sedimentation related to higher sqi the linear sill tail down autocovariance indicates that both flow connected and flow unconnected relationships exist in the sqi data and that these relationships are linear and point downstream this means that between two sqi observations the downstream point is influenced by the upstream point and that relationship decreases linearly with increasing distance between the points this spatial socio economic environmental model outperformed the non spatial model and spatial model fit with only environmental predictors the simple model had a higher r2 value supplementary table 1 but lower aic and rmse fig 5 the spatial environmental only model had a slightly higher aic lower r2 and higher rmse compared to the best model supplementary table 1 the rmse value especially highlights the value of modeling sqi with ssn models as the rmse for the non spatial model was about one sqi index point higher than the rmse for either of the spatial models indicating a worse ability of the non spatial model to capture the true variability in sqi data fig 5 poverty adds predictive power to the model as demonstrated by the improvement in all model evaluators when poverty is included in the spatial model adding stream order as a random effect did not improve model performance the stream order random effect model had a higher aic and rmse and a comparable r2 as the best performing model this showed that the relationship between sqi and explanatory variables did not vary based on the stream order in other words small streams should not be modeled differently than larger branches this provides support that stream order and associated downstream trends do not explain water quality in the watershed better than sediment regulation imperviousness and poverty without stream positioning information 3 3 predictions under potential scenarios the ssn model was used to predict sqi every 800 m of stream segment in the rouge river watershed under true conditions in the watershed sqi predictions ranged from 15 76 poor to 44 83 good fig 4b the average prediction standard error was 1 17 the slope between poverty and predicted sqi was negative and indicated that a stream segment with 10 higher poverty in its upstream watershed drainage area would have a 3 62 lower sqi this 3 62 change in sqi is equivalent to a 10 change in the range of water quality or about a 1 decrease in water quality for every 1 increase in poverty under manipulated watershed conditions poverty and predicted sqi also had negative relationships fig 6 the magnitude of this negative relationship increased with increasingly positive watershed conditions under poor watershed conditions 53 imperviousness 0 92 sediment regulation a 10 increase in poverty would result in a decrease in sqi by 2 87 under standard watershed conditions 35 imperviousness 0 94 sediment regulation a 10 increase in poverty would decrease sqi by 3 61 finally under good watershed conditions 18 imperviousness sediment regulation 0 96 a 10 increase in poverty would decrease sqi by 4 53 4 discussion 4 1 degraded water quality in higher poverty areas the identified negative relationship between water quality and poverty provides information about spatial distribution of water quality degradation our ssn s negative coefficient between stream quality and poverty provides statistical evidence that stream quality is associated with socioeconomic factors in addition to known relationships between stream quality and environmental factors like sediment regulation and imperviousness the observed decrease of stream quality in high poverty areas provides support that urban stream degradation is inequitably distributed it is important to emphasize that the negative relationship does not prove a causal relationship it provides statistical support that environmental degradation of water quality disproportionately affects impoverished communities explicitly it is incorrect to interpret that high poverty causes poor water quality while a latent cause effect relationship may exist our analysis does not articulate an underlying causal structure previous research provides support for potential casual structures for example inequity in access and proximity to parks has been shown for poor communities rigolon et al 2018 and park land is one tool used to impede stormwater runoff from polluting streams cettner et al 2013 local knowledge and spatial setting further contextualize the relationship between poverty and water quality the highest poverty area in the watershed is in the southeast region of the watershed observations of sqi in this area included 23 sites with an average sqi of 24 a fair rating while this sqi score is relatively low it fails to express other water quality issues in this area the segment of the rouge river bordering the highest density poverty area contains 21 uncontrolled combined sewer overflow cso outfalls making this area subject to flashy water levels and at risk to acute degradation events post rainfall as is true in cities with similar drainage systems like philadelphia pa and chicago il miskewitz uchrin 2013 quijano et al 2017 further tributary streams in this area are sparse having been removed from their historical locations fig 7 the lack of tributary streams in this area is an example of water inequality as this high poverty area is deprived of natural surface waters entirely this lack of naturally formed stream channels is also a limit of our analysis lack of natural drainage boundaries in high poverty areas as well as highly urbanized areas compromise the catchment level units of analysis in these areas our measurements of sediment regulation and imperviousness may not properly represent the land being drained to stream segments since stormwater infrastructure in a combined sewer system would carry stormwater to a wastewater treatment plant or in an overflow event may convey water to stream segments that wouldn t have naturally received that water to estimate water quality more accurately in the high poverty area of the rouge river future work would need to consider conversion of naturally delineated drainage areas to those defined by stormwater infrastructure achleitner et al 2007 house et al 1993 tscheikner gratl et al 2019 other limits of our poverty analysis are the quality of u s census data and the assumptions made in converting poverty data from census tract to catchment based units a limitation of environmental justice datasets is low survey responses and lack of internal community involvement in surveying lee 2020 mah 2017 increased involvement of local community members in environmental justice data collection is necessary for increased understanding of the disproportionate water quality burdens across socioeconomic groups a second layer of potential error in u s census data was introduced when we converted data from census tracts to drainage area this conversion was made by assuming that poverty was distributed homogenously in census tracts this assumption is an over generalization that could lead to inaccuracy in calculating poverty rates in units of catchments scales of socioeconomic data resolution are influential in improving stream health modeling performance daneshvar et al 2016 so future modeling efforts would benefit from a more realistic conversion of socioeconomic data from census area to area units more conducive to water quality modeling 4 2 volunteer science data applicability volunteer science collected water quality data was key to executing this work the term volunteer science was selected intentionally over similar titles citizen science community science community based monitoring because volunteers collected data and volunteerism was entirely unrelated to citizen status contrary to the implication of the term citizen science and the community was not involved in all stages of the research as is common in community science cooper et al 2021 our work serves as an example of a mutually beneficial partnership between formal research and volunteer science labor cost time and local knowledge would have prevented this research without volunteer science collaboration which provided a temporally and spatially robust dataset for the volunteer science data collecting group fotr technical and resource hurdles stand in the way of the spatial model building and analysis needed to fully understand river data this mutually beneficial partnership between scientists and the local community offers the exchange of knowledge and perspective from interested parties who come from diverse backgrounds and motivations taylor et al 2022 and is one reason why volunteer science has recently become more prevalent in aquatic science and hydrology research kielstra et al 2019 krabbenhoft kashian 2020 maguire mundle 2020 an additional co benefit of fotr volunteer science is that data collection events are used to engage volunteer scientists in the watershed raise awareness about river conditions and advocate for the need to clean up the rouge river despite the benefits offered to both scientists and volunteer science groups there are obstacles that prevent the widespread use of volunteer science data these obstacles include scientific community acceptance data validity and governance research problem definition and in the case of water quality observation tool expense and access buytaert et al 2016 buytaert et al 2014 the most common critique of volunteer science is data validity jollymore et al 2017 means to overcome this obstacle include volunteer scientist training and understanding of volunteer science volunteerism motivation which increases the reliability alender 2016 buytaert et al 2014 jollymore et al 2017 in volunteer science organized by fotr volunteer training and internal quality assurance checks are the primary means of data quality assurance the team leaders who collect data attend training in the classroom and field to learn sampling techniques and identification volunteers who want to become team leaders must first attend a sampling day as a regular volunteer following training trainees are paired with an experienced team leader for their first few events and the experienced leader works with them to make sure they are sampling thoroughly and following procedures team leaders repeat the training every few years to stay updated on sampling days team leaders conduct all sample collection and untrained volunteers assist in picking through the samples team leaders collect voucher specimens which are identified in the lab quality assurance is performed with internal checks against historical sqi observations where any results for sites that vary greatly from past sampling are examined to determine the cause a reliability study on fotr volunteer science data concluded the sqi data used here is a conservative estimate of water quality as traditionally measured numerically by scientists krabbenhoft kashian 2020 the macroinvertebrate preservation method used by fotr may be one potential source of this discrepancy as only 4 5 representative specimens are preserved for post hoc identification rather than preserving all samples as recommended by other benthic macroinvertebrate sampling barbour et al 1999 4 2 1 lessons from friends of the rouge the long term operation of volunteer science at fotr has resulted in many learned experiences that can benefit other communities including the scientific community initially fotr provided training and equipment and expected trainees to monitor sites on their own this model failed to engage volunteers and consequently fotr altered their sampling events to group sampling days with the trainees leading untrained volunteers this structure allows for wide community participation with over 100 volunteers attending monitoring days success of this method is measured through volunteer retention and influence of volunteering experience on community members many volunteers return year after year some for as long as 20 years volunteers learn about stream ecology and urban rivers through their experience at sampling events children participate with their parents and many reported going on to pursue a degree in the sciences because of the experience fotr also attributes their success to their commitment to ensure that the data is useful and made available to stakeholders following each monitoring event a report is made available to all volunteers and state and local agencies including the communities who are now providing some of the funding to support monitoring fotr makes the data freely available to academic institutions for research use which has resulted in journal publications krabbenhoft kashian 2020 maguire mundle 2020 and several master s students theses volunteer science events conducted by fotr have also resulted in unsuspected co benefits inspired by questions from volunteers about pipes while sampling team leaders are now trained in illicit discharge elimination and have been responsible for reporting spills sewage leaks erosion issues and more that might have never been noticed otherwise volunteers have also observed other species while working on macroinvertebrate study events notably new native species have been documented including one new to the state and multiple invasive species were tracked 4 3 spatial modeling the ssn and stars tools were useful in modeling stream water quality in the rouge river from volunteer science water quality data and spatial relationships in stream systems stars and ssn tools have been applied to a range of stream modeling applications like surface water isotope variations mcgill et al 2020 fish genetic diversity in southern france paz vinas et al 2018 and fecal contamination in streams in northeast scotland neill et al 2018 and central north carolina holcomb et al 2018 ssn methods have been previously applied with volunteer science data kielstra et al 2019 and macroinvertebrates in streams frieden et al 2014 pond et al 2017 this project uniquely combines volunteer science collected macroinvertebrate data into a spatial model which together were able to overcome challenges in data paucity and stream connectivity water quality in the rouge river was modeled with imperviousness and sediment regulation both of which reflect some degree of anthropogenic activity and together they show that human behavior affects stream quality through different avenues imperviousness is directly related to human populations and densities where high imperviousness is associated with high human density and is known to cause increased flashiness temperatures and bod and cause streamlined pollution conveyance via stormwater blaszczak et al 2019 grabowski et al 2016 mallin et al 2009 the negative imperviousness coefficient modeled here aligns with the emphasis placed on impervious sources as a key driver of water resources impacts in previous research arnold gibbons 1996 mcgrane 2016 salerno et al 2018 sediment regulation is estimated through factors directly or indirectly driven by humans like reservoir presence and volume stream channelization riparian vegetation and agriculture weighted by soil erodibility thornbrugh et al 2018 the positive coefficient associated with sediment regulation indicates an increase in sensitive benthic macroinvertebrate species associated with high sediment regulation this relationship was expected as benthic macroinvertebrates thrive in well oxygenated water with low proportions of fine substrate kaller hartman 2004 von bertrab et al 2013 the use of imperviousness and sediment regulation helped to build the stream quality ssn model our methodology using an ssn model builds upon existing analyses of the socioeconomic influence of stream quality previous analyses explored regression relationships and spatial clustering between stream environment indicators and variables describing historically disadvantaged populations these studies found mixed correlation results revealing negative trends between a stream health index and both household size and poverty daneshvar et al 2016 sanchez et al 2014 the strength of correlations between socioeconomic and stream health indices was improved by applying spatial clustering sanchez et al 2015 and tailoring the resolution of spatial analysis daneshvar et al 2016 in general higher resolution data produced higher correlations daneshvar et al 2016 sanchez et al 2015 the method of parameter estimation for environmental justice modeling has also been performed with many explanatory variables categorized as ecological socioeconomic and physiological daneshvar et al 2018 this work s methodology avoided the ambiguousness associated with correlation calculations and complexity of clustering methods by using both socioeconomic and environmental variables and a spatial model designed for stream networks the spatial modeling framework applied in past models was conditional autoregressive modeling which considers spatial influence of neighboring points daneshvar et al 2016 sanchez et al 2015 sanchez et al 2014 our modeling approach with ssn expands on this consideration of neighboring points by including relationships that exist on stream flow paths while our model identifies weaker statistical relationships than those observed in past models sanchez et al 2015 sanchez et al 2014 the simplicity and interpretability of our ssn model provides a straightforward means of expressing the complex relationship between socioeconomic parameters and urban stream quality ultimately our work aligns with previous environmental justice models all finding negative relationships between historically underserved groups and water quality via stream health indices 5 conclusion urban stream syndrome remains a prevalent environmental concern and this work shows how degraded stream water quality disproportionately burdens higher poverty areas our results show that under similar environmental conditions streams with higher poverty have lower stream quality volunteer science collected data provided a robust understanding of stream quality in the rouge river and spatial modeling methods enabled the incorporation of stream interdependencies in stream quality modeling in further analyses of the socioeconomic distribution of water quality degradation we encourage the partnership of volunteer science groups who may have parallel interests in understanding the water quality story in their community credit authorship contribution statement isabelle r horvath formal analysis investigation visualization anthony j parolari supervision writing review editing sally petrella conceptualization resources data curation writing review editing craig a stow writing review editing supervision project administration funding acquisition casey m godwin writing review editing supervision project administration funding acquisition timothy j maguire conceptualization methodology software formal analysis investigation data curation visualization supervision funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the authors would like to thank the cooperative institute for great lakes research ciglr in partnership with the national oceanic and air administration great lakes environmental research laboratory noaa glerl for partial funding of this project through the summer fellows program ih funding was awarded to ciglr through the noaa cooperative agreement with the university of michigan na17oar4320152 this ciglr contribution number is 1199 and noaa glerl contribution number is 2011 additional thanks to friends of the rouge and their volunteers for data collection without whom this project would not have been possible appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 128475 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
2883,changes in hydrological processes caused by rapid urbanization lead to the growing incidence of urban flooding which is a major challenge to urban sustainability urban floods have seriously threatened the natural environment and human life understanding the spatial patterns and influencing factors of urban flooding has important implications for mitigating urban flood hazards previous studies have demonstrated the impact of natural and human factors on urban flooding but a comprehensive understanding of the mechanisms of urban flooding requires appropriate scales and evidence from multiple cities in this study 1201 flood records from 2015 to 2020 in 9 megacities including beijing tianjin shanghai xi an nanjing wuhan guangzhou shenzhen shenyang in china were used to investigate the spatial characteristics and driving factors of urban flooding a combination of multiple stepwise regression and boosted regression tree brt models was used to reveal the flood driving mechanism in megacities the results indicated that flood events in 9 cities presented an aggregation effect but the spatial characteristics and kernel density were different between coastal and inland cities at all scales 1 km 3 km 5 km physical geomorphic features 2d and 3d landscapes have a high contribution to urban flooding especially patch density density of buildings and building shape coefficients the relative contributions of the 2d and 3d landscape pattern factors increased by 43 8 and 36 2 as the grid scale increased from 1 km to 5 km respectively however the relative contributions of topography meteorology and drainage capacity factors decreased by 47 6 39 0 and 33 2 respectively at a large scale 5 km the correlation of driving factors for urban flooding was stronger and the dominant factors were more obvious at a small scale 1 km the contribution of driving factors is relatively average the scale effect significantly affects urban flooding which suggests that an appropriate scale can more accurately capture the dominant drivers of urban flooding therefore a novel method that integrates the stepwise regression model and brt model were presented to quantify the complex relationship between urban flooding and driving factors under various analysis scales the methods and results proposed by our study provided important insights and perspectives for urban flood risk mitigation and urban planning through multiscale analysis of flood driving mechanisms keywords urban flooding 3 dimensional expansion spatial pattern multiple scales data availability no data was used for the research described in the article 1 introduction in recent decades china s rapid urbanization has led to drastic changes in land use cover in urban areas with the expansion of the urban area the height of internal buildings also increases the evolution of two dimensional 2d and three dimensional 3d urban landscape patterns make their interaction with the surrounding ecological environment more complex liu et al 2017 liu et al 2021 during the process of rapid urbanization a series of urban ecological and environmental issues have been suffered in many cities among them urban flooding is one of the most important problems in urban development and a comprehensive embodiment of urban hydrological cycle function obstruction chen et al 2015 feng et al 2021 yin et al 2015 urban flooding is primarily caused by short term or continuous rainfall that exceeds the capacity of the drainage system liu et al 2020 man et al 2020 urban floods are frequent worldwide especially in developing countries which could cause serious economic damage and personnel casualties and increase the risk to cities andrew et al 2019 cao et al 2022 lin et al 2018 muis et al 2015 yang et al 2018 in terms of the frequency of global flood disasters china is a high risk flood prone area barbara et al 2015 among the 351 cities investigated in china 62 suffered from varying degrees of urban floods from 2008 to 2010 zhang et al 2018b in addition 137 cities suffered from heavy floods frequent flood events or flood events that threaten to human life more than three times a year jha et al 2012 the risks of flooding are particularly severe in megacities such as beijing shanghai guangzhou and shenzhen for example the torrential rainstorm in beijing that occurred on july 21 2012 caused the collapse of 10 660 houses and economic losses of 1 83 billion dollars meng and yao 2014 severe urban flooding is expected to occur more frequently in cities in the future due to ongoing global climate change and accelerated urbanization therefore exploring the dominant influencing factors of urban floods to effectively reduce or eliminate the effects of flooding is the primary target of urban flood management birkholz et al 2014 samuel and wouter 2022 wang et al 2015 flood disasters are the result of the combined action of natural and human factors berndtsson et al 2019 miller and hutchins 2017 o donnell and thorne 2020 many previous studies have revealed that natural factors such as rainfall rainstorm intensity and topography play an important role in urban flooding smith et al 2013 veldhuis et al 2018 for example chao and costache found that flooding is related to the spatial and temporal distribution of rainfall and topography costache et al 2020 lijun et al 2021 wen and xia indicated that the significant increases in temperature and precipitation were the dominant factors for the increase in runoff in the yangtze river basin jun et al 2021 wen et al 2020 in recent years studies on impervious surfaces 2d and 3d landscape patterns and drainage systems have shown that socioeconomic factors are highly correlated with urban flooding berndtsson et al 2019 jinyao et al 2020 miller and brewer 2018 zhang et al 2018a the composition and configuration of impervious surfaces on urban floods vary with changes in scale zhang et al 2018a and building layout and coverage have an important impact on surface water flow and water depth bruwier et al 2020 furthermore there is a significant correlation between urban flood events and underground drainage systems cheng et al 2020 however under different rainfall characteristics and urbanization conditions there are uncertainties and heterogeneity in the urban flooding characteristics zhang et al 2020 revealed that imperviousness and green space were the main driving factors in guangzhou zhang et al 2020a while chen et al 2021 believed that rainfall factors have a significant impact on the flooding events in tianjin chen et al 2021 the reasons for the complexity of urban flooding were mainly due to two aspects 1 different natural and social conditions flood disasters are prone to be seasonal and regional günter et al 2019 previous studies have mainly focused on flooding in coastal areas without considering the differences caused by the geographical location and urbanization level of the study area xian et al 2018 2 different analysis scales scale effects originate from landscape ecology and represent the behavior of phenomena or processes on different spatial and temporal scales which play an important role in measuring and understanding spatial heterogeneity wu 2004 therefore considering the scale effect can help us fully understand the driving factors of urban flooding and reveal the complex relationship between flooding and driving factors however previous studies were mainly based on a single scale and did not consider the scale effect which may result in dynamic outcomes under different analysis scales therefore how to understand the influencing factors of urban flooding comprehensively and systematically has become an urgent problem this study aims to achieve the following goals 1 to illustrate the spatial distribution characteristics of floods in different cities 2 to explore the dominant factors affecting urban flooding and 3 to reveal the impact of different scales on urban flood events through the comprehensive quantitatively analysis of the driving factors of urban flooding at different scales this study is expected to reveal the main influencing factors and provide scientific basis for the identification and early warning of urban flooding 2 materials and methods 2 1 study area and data in this study 9 megacities beijing tianjin shanghai xi an nanjing wuhan guangzhou shenzhen and shenyang located in the monsoon region of central and eastern china were selected as the study area fig 1 the rainfall is mainly concentrated during the summer accounting for 50 85 of the average annual rainfall ranging from 370 mm to 1900 mm and both short term heavy rainfall and continuous heavy rainfall were recorded these cities are highly urbanized areas in china with an urbanization rate of over 75 and a population ranging from 9 million to 25 million in 2021 the total population of the 9 cities was approximately 143 million accounting for 10 1 of china s population with a gdp of approximately us 3 300 billion accounting for approximately 18 37 of china s total gdp the total area of urban built up area of 9 cities has increased from 5538 km2 to 9362 km2 since 2006 an increase of approximately 70 in the past 20 years the built up areas of these cities have expanded dramatically and the building height has increased a total of 1201 urban flood records from 2015 to 2020 in 9 cities were obtained from amap https www amap com a leading provider of digital map content navigation and location services solutions in china including beijing 112 tianjin 152 shanghai 264 xi an 169 nanjing 68 wuhan 136 guangzhou 109 shenzhen 136 and shenyang 55 the flood points of amap were mainly obtained through traffic police reporting user reporting and field monitoring data in order to avoid the repeated reporting of the same flooding event by users multiple reports from adjacent locations within the same rainfall date will only be recorded once the flooding points only had location information and no specific flooding occurrence time li et al 2022 wang et al 2015 digital elevation model dem data were obtained from the center for earth observation https yceo yale edu aster gdem global elevation data the land cover data of the study area were calculated based on the google earth engine gee platform land cover was divided into four categories including green space water buildings and other impervious surfaces gee was used to extract ndvi as green space based on the threshold classification method li et al 2021c and water body data came from global surface water data https global surface water appspot com the polygon feature dataset of individual buildings in these cities in 2017 was collected which included the floor information of each building in the urban built up area liu et al 2021 in addition other data were collected including precipitation data national tibetan plateau data center http data tpdc ac cn ding and peng 2020 peng et al 2019 peng et al 2017 peng et al 2018 shouzhang 2020 soil information national cryosphere desert data center http www ncdc ac cn and road and river national catalog service for geographic information https www webmap cn data the details of all the data used in this study are shown in table 1 2 2 analysis scale and driving factors referring to previous studies 3 grid scales 1 km 3 km and 5 km were selected as the scale of analysis using shanghai as an example the spatial distributions of flooding points in different scale grids are presented in fig 2 eighteen independent variables were selected as driving factors and divided into five categories topography 2d landscape pattern 3d landscape pattern drainage capacity and meteorology table 2 topographic factors include topographic wetness index twi terrain surface texture index tsi and relative elevation re twi tsi and re are important indicators of topographic changes which could significantly changes the regional hydrological processes through affecting runoff production and transmission brown et al 2004 iwahashi and pike 2007 they have been widely used for flood prone area identification and flood risk mapping parsian et al 2021 risi et al 2015 2d landscape pattern factors include patch density pd aggregation index ai patch richness pr green space ratio gsr impervious surface ratio isr 3d landscape pattern factors include building shape coefficient bsc mean building height mbh mean building volume mbv building congestion degree bcd density of building db landscape pattern analysis is of great significance to explore the complexity and heterogeneity of landscape elements the landscape pattern index which can highly condense the landscape pattern information is most widely used in landscape pattern analysis he et al 2000 li and wu 2004 drainage capacity factors include distance from water dw soil infiltration capacity sic density of roads dr urban drainage infrastructure data in most cities is confidential data and difficult to obtain drainage network is mainly distributed along the road and many researches revealed that an average of 50 of the street network length was associated with 80 85 of the total water sewer network mair et al 2017a therefore dr was taken as an important factor of drainage capacity urban water bodies could not only receive the runoff in the rainwater drainage network but also may cause the river to overflow resulting in flooding in the surrounding areas the pervious area represented by urban green space has an important hydrological regulation function the runoff storage capacity of green space canopy storage capacity and soil infiltration capacity is an effective way to reduce urban flooding in addition to drainage capacity li et al 2021a meteorological factors include annual rainfall ar and maximum monthly rainfall mr continuous rainstorms have a certain effect on urban flooding however the number of fixed weather stations in the city is too small to meet the needs of this study and the downscaled precipitation data with 1 km resolution was used in this study mr means the maximum value of rainfall in each grid in 12 months of a year in this study dem was used to calculate terrain factors including relative elevation terrain surface texture and terrain wetness by saga gis the landscape pattern indices were calculated by fragstats4 2 software the building information data were used to calculate 3d driving factors including the building shape coefficient mean building height mean building volume building coverage ratio and building density all factors were calculated under different grid scales 2 3 methodology 2 3 1 spatial pattern analysis the spatial distribution characteristics of urban flooding points were evaluated through kernel density estimation kde and global moran s i kde is one of the most popular methods for analyzing the first order properties of a point event distribution bailey and gatrell 1995 silverman 2018 the purpose of kde is to produce a smooth density surface of point events over space by computing event intensity as density estimation the formula for kde is given by 1 λ s i 1 n 1 π r 2 k d is r where λ s represents the density of the point at location s r represents the search radius band width of the kde only points within r were used to estimate λ s and k represents the weight of distance d is between points i and s in kde k is an important parameter the kernel density estimation method uses a model function gaussian function quartic function quadratic function etc that considers the distance decay effect in this research a quadratic function is used to calculate the kernel density jenks natural breaks classification method was used to divide the kde value into three levels including high density flooding area medium density flooding area and low density flooding area the high density flooding area hdfa is the region with high density flooding events and the equation 2 was used to calculate the hdfa ratio hdfr which is defined as the hdfa divided by the built up area of each city 2 hdfr hdfa a j 100 where hdfr represents the proportion of hdfa in the built up area hdfa represents the high density flooding area a j represents the built up area the global moran s i index was proposed by moran moran 1948 in 1948 it is used to analyze the overall distribution of spatial variables and determine whether the variables have clustering characteristics the calculation formula is as follows 3 i n i 1 n j 1 n w ij x i x x j x i 1 n j 1 n w ij i n x i x 2 where i represents the global moran s i index n represents the number of space units and x i and x j represent the variable values of units i and j respectively x is the average value of all units w i j is the spatial weight matrix of elements i and j the value range of i is generally between 1 and 1 a value greater than 0 indicates that the variable distribution is positively spatially autocorrelated and the larger the value is the stronger the spatial aggregation 0 means that the distribution of spatial variables is negatively correlated and the smaller the value is the stronger the spatial discreteness of variables 2 3 2 driving factor analysis in this study a total of 1201 flood records from 9 chinese megacities were used to analyze the spatial distribution patterns and driving factors of flooding on the 1 km 3 km and 5 km scales the number of flood points in each grid was defined as the dependent variable and 18 driving factors were defined as independent variables a combined approach of pearson correlation analysis multiple stepwise regression analysis and brt was adopted to analyze the linear relationship degree of impact and relative contributions between drivers and flood points and explore their complex relationships first pearson correlation analysis was adopted to analyze the correlation between urban flood points and driving factors at multiple scales the aim was to find drivers that were significantly associated with flood points then through multiple stepwise regression analysis the multicollinearity problem is avoided and the bidirectional elimination stepwise regression can gain a comprehensive explanation rate of the variables entering the model thereby further revealing the laws between variables at multiple scales finally the relative contributions of drivers to urban flooding were revealed through the brt model at different scales brt is an integrated approach that utilizes statistics and machine learning it combines the advantages of regression trees and boosting algorithms to fit statistical models improving model stability and prediction accuracy elith et al 2008 glenn 2007 brt uses a hierarchical binary segmentation program development model to estimate a single best predictor variable which maximizes differences between groups and homogeneity within groups brt has been shown to be effective in solving complex nonlinear relationships and explaining the relationship between each predictive variable and response variable li et al 2014 3 results 3 1 spatial pattern of urban flood points the kernel density distribution map of urban flood points indicated that the distribution patterns of the 9 cities were different fig 3 the floods in nanjing wuhan xi an and shenyang showed obvious single core and multilevel spatial aggregation patterns however shanghai guangzhou shenzhen and tianjin presented a multicore and multilevel spatial aggregation pattern which is characterized by multicore aggregation and multipoint occurrence hdfa and hdfr were calculated and are presented in fig 4 and there were major differences in flooding characteristics among the 9 cities in terms of hdfa shanghai has the largest area 272 3 km2 followed by xi an 209 32 km2 and beijing and nanjing have the smallest 20 56 km2 and 15 36 km2 respectively in terms of hdfr the largest proportions of cities were xi an and wuhan with 16 3 and 11 8 respectively which may be a potential exposure to the residents and property of the city in contrast hdfa and hdfr in beijing and nanjing were small indicating that these cities have low levels of flooding exposure the global moran s i index of 9 cities calculated by arcgis spatial autocorrelation analysis tool is shown in table 3 the results revealed that the occurrence of urban flooding was not random but showed spatial agglomeration the higher moran s i indices belong to xi an and tianjin 0 57 p 0 0007 and 0 50 p 0 0002 respectively the moran s i indices for beijing nanjing shenzhen wuhan and shenyang ranged from 0 29 to 0 44 while guangzhou and shenyang had the lower moran s i indices 0 24 p 0 0449 and 0 16 p 0 0655 respectively therefore different degrees of spatial agglomeration were presented in all cities 3 2 relationships between flooding and driving factors at multiple scales 3 2 1 pearson correlation analysis the results of pearson correlation analysis illustrated that flooding in most cities were significantly negatively correlated with the ai and gsr p 0 01 but significantly positively correlated with pd pr isr supplementary table s1 the correlation analysis results revealed that the higher the connectivity between patches ai and the more green space coverage gsr the lower the flooding occurrence in contrast the higher the patch density and richness were the higher the flooding occurrence meanwhile 3d building factors was found to play a crucial role in urban flooding in particular db has more relevant to flooding than other building factors and bcd also has a strong correlation in some cities these results showed that the density and height of buildings could affect urban flooding 3 2 2 multiple stepwise regression analysis to explore the explanatory power of the drivers multiple stepwise regression analysis was employed in 9 cities and the results could indicate the total explanatory power of the aggregated 9 cities fig 5 presents the determination coefficients of multiple stepwise regression analysis p 0 01 indicates that the results of the regression analysis model is significant for the whole study area the explanatory power of the multiple stepwise regression model at the 5 km scale was the best determination coefficient r2 0 55 and as the scale decreased the determination coefficient gradually decreased for each city the explanatory power of the model continues to decrease as the scale shrinks and the order of r2 from large to small is 5 km 3 km and 1 km when the scale is 1 km the average r2 is 0 1 range from 0 04 to 0 18 this is mainly because the driving mechanism of flood events may be more complex at a small scale and there may be more factors to be considered moreover the explanatory power of the models revealed some regional differences the r2 values of wuhan xi an and shenyang were generally larger than those of guangzhou shanghai and shenzhen on multiple scales which may be because the flooding driving factors of coastal cities were more complex than those of inland cities 3 3 relative contributions of driving factors in this study driving factors were divided into 5 categories and the relative contributions of each category at 3 scales in 9 cities were explored by brt fig 6 as shown in fig 6 the 2d and 3d landscape patterns were the dominant factors in all flooding events and the relative contributions were all greater than 50 at the three scales which indicates that the process of urbanization has a profound impact on flooding in addition drainage capacity represented by dw sic and dr in this study also played a key role in urban flooding while the relative contributions of topography and meteorological factors were small fig 6 d the relative contribution heatmap was plotted to further investigate the complex relationships between flooding and each factor fig 7 the color of the cell in the column indicates the relative contribution size red represents a high relative contribution blue represents a low relative contribution and the sum of the contributions of all the factors of each city was 100 pd and db played dominant roles in influencing flooding in 9 cities in the whole study area the top 3 key driving factors at the 5 km scale were pd 22 0 db 17 9 and bcd 9 3 those at the 3 km scale were db 20 4 pd 10 4 and gsi 10 2 and those at the 1 km scale were dr 12 3 pd 11 5 and db 10 5 the order and importance of key factors for the 3 scales were different as the scale increases from 1 km to 5 km the relative contribution of the primary driving factor increases for example at the 5 km scale the primary influencing factors in beijing and shenyang were pd 34 2 and mbh 38 9 respectively at the 3 km scale the primary influencing factors in wuhan and xi an were db 38 2 and ai 30 8 at the 1 km scale the contribution rate of all influencing factors was relatively average and there was no primary influencing factor 4 discussion 4 1 spatial pattern and exposure of urban flooding the urban floods of the 9 cities all presented spatial aggregation effects table 3 but the flooding patterns and exposure were different fig 3 which may be related to the underlying surfaces and rainfall characteristics zhao et al 2014 specifically urban expansion in china is highly uneven wei et al 2017 the expansion of urban areas in inland cities is relatively slow mainly in the form of infill expansion liu et al 2016 in addition most of the old residential areas in the urban center have a low proportion of pervious surfaces and combined drainage networks which may lead to the characteristics of a single core aggregation mode and high hdfr in contrast relying on the advantages of geographical location and reform and policies chen et al 2016 wei et al 2017 coastal cities have experienced rapid economic development strong expansion of built up areas and concentrated population and infrastructure under short term heavy rain conditions the characteristics of multiple outbursts and low hdfr will be present therefore researchers and governments need to pay more attention to flooding events in inland cities in addition managers should focus on the spatial distribution of flooding in the urban planning process by increasing drainage facilities and green infrastructure decreasing impervious surfaces reducing population density in high flooding areas 4 2 driving factors previous studies have focused on 2d land cover changes and few have analyzed the driving mechanism of flooding from a 3d urban expansion perspective we revealed that 3d landscape pattern factors were also key drivers of urban flooding in terms of relative contributions fig 6 and the results extended previous studies of landscape patterns on flooding alexakis et al 2014 miller et al 2014 yanyan et al 2016 however the driving mechanism of urban flooding is complex and the driving factors are not independent but interrelated stephens et al 2021 under the effect of scale and heterogeneity these mechanisms are more complex the 2d landscape pattern and composition were the dominant factors of urban flooding at all scales among which pd ai and gsr had significant effects this indicated that these configuration variables impact urban flooding the higher the degree of patch aggregation pd is the lower the connectivity ai of the urban green landscape gsr qifei et al 2021 which will reduce the storage capacity of the green space li et al 2021b zhang et al 2015 therefore urban managers should pay more attention to the distribution of pervious and impervious spaces on a large scale and urban flooding could be mitigated by appropriate adjustment of the pattern wu et al 2020 3d landscape pattern factors were also another important factor affecting urban flooding among which the relative contributions of building density db and building congestion degree bcd were better than those of the other indicators this is mainly because the higher the building density and height the bigger the ratio of impervious surface which leads to the increase of runoff volume therefore appropriately reducing the compactness and height of buildings can reduce the occurrence of urban flooding woong and brown 2022 the results of this study showed the relative contribution of drainage capacity was not primary mainly because flood events in this study were only recorded the location of floods and don t include the frequency and severity of floods more importantly urban drainage infrastructure has a significant impact on flooding in small areas petersson et al 2020 yin et al 2020 and when deal with large scale and serious storm flood events the existing urban drainage infrastructure may be fully loaded and cannot enhance its function zhang et al 2020b in addition affected by the impervious surface the water body inside the city is constantly decreasing and the infiltration capacity is weakened which makes the urban blue gray infrastructures unable to fully play its role in floods this means that the drainage capacity within the city may not be able to effectively alleviate the urban flooding problem therefore blue green gray infrastructures sponge cities and low impact developments were employed to mitigate urban flooding problems dong et al 2017 nguyen et al 2019 song et al 2019 wenjie et al 2021 the influence of topographical factors is far less than that of other factors which may be because the terrain inside most of the cities is flat when the research scale increased to 5 km the relative coefficient of topographic factors decreased gradually therefore the relative contributions of re twi and tsi are smaller than other factors which mainly because of the small impact of flat urban terrain on hydrological processes on a large scale wu et al 2021 4 3 scale effects a large number of studies have confirmed that the patterns and processes temporal and spatial distribution and mutual coupling of geographical and ecological research objects are all scale dependent li and cai 2005 in this study the scale effects significantly affected the relationship between driving factors and urban flooding events as the scale increases the correlation between drivers and flooding becomes stronger the explanatory power r2 increases and the relative contribution becomes more explicit this is mainly because large scales can provide overall characteristic information and can show the collective effects of different landscape types and land cover amaguchi et al 2012 koga and amaguchi 2016 however the driving mechanism is more complex and there are episodic events at small scales finaud guyot et al 2019 finaud guyot et al 2019 for example at the neighborhood and street scale roads intersections squares pedestrians obstacles bus stops parked cars etc could affect the distribution of runoff and may lead to different flooding patterns diakakis et al 2017 finaud guyot et al 2019 gabriele et al 2021 mignot et al 2013 finaud guyot et al 2019 wang et al 2017 moreover the explanatory power of the driving factors is better in inland areas than in coastal areas this is mainly because china s coastal areas are affected by monsoon storms and persistent rainfall from june to october in addition to natural disasters such as sea level rise storm surges and compound natural hazards under global climate change scenarios which tend to lead to more complex flooding mechanisms in coastal cities fang et al 2020 marsooli et al 2019 nicholls et al 2021 peter sheng et al 2022 while elevating the risk of flooding in coastal cities making the risk of flooding in coastal and inland areas unequal nicholls et al 2021 wing et al 2022 the driving mechanism change is a dynamic result under the scale effect and spatial heterogeneity rather than an inherent property and different research scales will bring different results daskalova et al 2020 more attention should be given to spatial heterogeneity and scale effects to find the best scale suitable for different cities and only by examining and analyzing it on a specific scale can we grasp its inherent laws stephens et al 2021 4 4 uncertainty and limitations there are several limitations that need to be considered first the flood points were collected from 2015 to 2020 and the data do not indicate the specific occurrence time it is impossible to analyze the temporal variation characteristics of flooding secondly the flood inundation depth duration and risk degree of flood points were not considered which may cause differences in flood hazard exposure and resilience darabi et al 2018 koks et al 2015 wang et al 2015 thirdly up to date and accurate urban drainage network data are the key to assessing drainage capacity however such data are often absent outdated or incomplete dominik et al 2019 although the literature supports that the density of the road network can be used to reflect the size of the drainage capacity it still inaccurately assesses the impact of the drainage network on flooding mair et al 2017b finally the spatial and temporal resolution of meteorological data also affect the expression of urban flood drivers meteorological stations in cities are characterized by low density and uneven distribution if the spatial and temporal resolution of rainfall data is improved accurate results can be obtained prat and nelson 2013 therefore we have planned to conduct additional real time meteorological monitoring by increasing the resolution of automatic meteorological stations in urban areas the enhancement of data will improve the outcomes of future research 4 5 contributions and implications the methods and results proposed by our study provided important insights and perspectives for urban flood risk mitigation and urban planning first the combination of multiple stepwise regression and brt model we used to explore urban flood characteristics and drivers provided a paradigm for urban flood studies in other megacities of china and the world second the configuration of urban 2d and 3d landscape patterns may be designed to mitigate urban flooding therefore optimizing the urban 2d and 3d landscape patterns configuration may alleviate urban flooding however we still need to pay attention to the urban stormwater management technology and frame and effectively reduce stormwater runoff through low impact development measures such as bio retention green roofs permeable pavements ahmed et al 2017 pour et al 2020 son et al 2017 the methods and data we used could also be extended to comprehensively urban flooding risk studies including flood hazards exposure and vulnerability which may enhance urban resilience and improve urban flood control by assessing urban flooding risks in coastal and inland areas furthermore it can also combine multisource data to assess similarities and differences in the loss and resilience of coastal and inland urban flooding more importantly we tried to explore the general laws of urban flooding influencing factors at different scales through scale analysis so as to provide suggestions for urban storm flood management at a small scale managers should carry out community flood diagnosis maintenance and diversion of drainage networks and temporary flood hazard migration zhong et al 2020 at a large scale combined with the big data platform real time risk assessment system dynamic population flow traffic flow static buildings transportation infrastructure can be built to achieve timely early warning and response to reduce the loss of people and property pollard et al 2018 sun and scanlon 2019 5 conclusion urban flooding is an important problem in the process of urban development in this study 9 megacities in central and eastern china were selected as the study area and the spatial distribution characteristics and dominant drivers of urban flooding were analyzed at multiple scales using a combination of a multiple stepwise regression model and a brt regression model three findings were obtained from this study 1 urban flooding in coastal areas showed a multicore and multilevel spatial aggregation pattern and that in inland areas showed a single core and multilevel spatial aggregation pattern inland cities may have a higher probability of flooding than coastal cities which provides new insight into urban flooding patterns 2 the results of pearson correlation analysis and multiple stepwise regression analysis varied with scale changes at a larger scale the correlations were stronger and the regression analysis had better explanatory power therefore we should pay more attention to the spatial heterogeneity and scale effects of urban flooding our research is expected to provide references for the identification and early warning of urban flooding problems through a multidimensional multiscale and multicity perspective credit authorship contribution statement yongheng wang conceptualization methodology investigation data curation formal analysis writing original draft chunlin li conceptualization methodology investigation writing original draft writing review editing miao liu conceptualization methodology investigation writing review editing funding acquisition qian cui writing review editing hao wang writing original draft jianshu lv writing original draft binglun li data curation formal analysis zaiping xiong data curation formal analysis yuanman hu writing review editing funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement funding for this project was provided by the national natural science foundation of china nos 41871192 41730647 and 32071580 and the youth innovation promotion association of cas 2021194 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 128464 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
2883,changes in hydrological processes caused by rapid urbanization lead to the growing incidence of urban flooding which is a major challenge to urban sustainability urban floods have seriously threatened the natural environment and human life understanding the spatial patterns and influencing factors of urban flooding has important implications for mitigating urban flood hazards previous studies have demonstrated the impact of natural and human factors on urban flooding but a comprehensive understanding of the mechanisms of urban flooding requires appropriate scales and evidence from multiple cities in this study 1201 flood records from 2015 to 2020 in 9 megacities including beijing tianjin shanghai xi an nanjing wuhan guangzhou shenzhen shenyang in china were used to investigate the spatial characteristics and driving factors of urban flooding a combination of multiple stepwise regression and boosted regression tree brt models was used to reveal the flood driving mechanism in megacities the results indicated that flood events in 9 cities presented an aggregation effect but the spatial characteristics and kernel density were different between coastal and inland cities at all scales 1 km 3 km 5 km physical geomorphic features 2d and 3d landscapes have a high contribution to urban flooding especially patch density density of buildings and building shape coefficients the relative contributions of the 2d and 3d landscape pattern factors increased by 43 8 and 36 2 as the grid scale increased from 1 km to 5 km respectively however the relative contributions of topography meteorology and drainage capacity factors decreased by 47 6 39 0 and 33 2 respectively at a large scale 5 km the correlation of driving factors for urban flooding was stronger and the dominant factors were more obvious at a small scale 1 km the contribution of driving factors is relatively average the scale effect significantly affects urban flooding which suggests that an appropriate scale can more accurately capture the dominant drivers of urban flooding therefore a novel method that integrates the stepwise regression model and brt model were presented to quantify the complex relationship between urban flooding and driving factors under various analysis scales the methods and results proposed by our study provided important insights and perspectives for urban flood risk mitigation and urban planning through multiscale analysis of flood driving mechanisms keywords urban flooding 3 dimensional expansion spatial pattern multiple scales data availability no data was used for the research described in the article 1 introduction in recent decades china s rapid urbanization has led to drastic changes in land use cover in urban areas with the expansion of the urban area the height of internal buildings also increases the evolution of two dimensional 2d and three dimensional 3d urban landscape patterns make their interaction with the surrounding ecological environment more complex liu et al 2017 liu et al 2021 during the process of rapid urbanization a series of urban ecological and environmental issues have been suffered in many cities among them urban flooding is one of the most important problems in urban development and a comprehensive embodiment of urban hydrological cycle function obstruction chen et al 2015 feng et al 2021 yin et al 2015 urban flooding is primarily caused by short term or continuous rainfall that exceeds the capacity of the drainage system liu et al 2020 man et al 2020 urban floods are frequent worldwide especially in developing countries which could cause serious economic damage and personnel casualties and increase the risk to cities andrew et al 2019 cao et al 2022 lin et al 2018 muis et al 2015 yang et al 2018 in terms of the frequency of global flood disasters china is a high risk flood prone area barbara et al 2015 among the 351 cities investigated in china 62 suffered from varying degrees of urban floods from 2008 to 2010 zhang et al 2018b in addition 137 cities suffered from heavy floods frequent flood events or flood events that threaten to human life more than three times a year jha et al 2012 the risks of flooding are particularly severe in megacities such as beijing shanghai guangzhou and shenzhen for example the torrential rainstorm in beijing that occurred on july 21 2012 caused the collapse of 10 660 houses and economic losses of 1 83 billion dollars meng and yao 2014 severe urban flooding is expected to occur more frequently in cities in the future due to ongoing global climate change and accelerated urbanization therefore exploring the dominant influencing factors of urban floods to effectively reduce or eliminate the effects of flooding is the primary target of urban flood management birkholz et al 2014 samuel and wouter 2022 wang et al 2015 flood disasters are the result of the combined action of natural and human factors berndtsson et al 2019 miller and hutchins 2017 o donnell and thorne 2020 many previous studies have revealed that natural factors such as rainfall rainstorm intensity and topography play an important role in urban flooding smith et al 2013 veldhuis et al 2018 for example chao and costache found that flooding is related to the spatial and temporal distribution of rainfall and topography costache et al 2020 lijun et al 2021 wen and xia indicated that the significant increases in temperature and precipitation were the dominant factors for the increase in runoff in the yangtze river basin jun et al 2021 wen et al 2020 in recent years studies on impervious surfaces 2d and 3d landscape patterns and drainage systems have shown that socioeconomic factors are highly correlated with urban flooding berndtsson et al 2019 jinyao et al 2020 miller and brewer 2018 zhang et al 2018a the composition and configuration of impervious surfaces on urban floods vary with changes in scale zhang et al 2018a and building layout and coverage have an important impact on surface water flow and water depth bruwier et al 2020 furthermore there is a significant correlation between urban flood events and underground drainage systems cheng et al 2020 however under different rainfall characteristics and urbanization conditions there are uncertainties and heterogeneity in the urban flooding characteristics zhang et al 2020 revealed that imperviousness and green space were the main driving factors in guangzhou zhang et al 2020a while chen et al 2021 believed that rainfall factors have a significant impact on the flooding events in tianjin chen et al 2021 the reasons for the complexity of urban flooding were mainly due to two aspects 1 different natural and social conditions flood disasters are prone to be seasonal and regional günter et al 2019 previous studies have mainly focused on flooding in coastal areas without considering the differences caused by the geographical location and urbanization level of the study area xian et al 2018 2 different analysis scales scale effects originate from landscape ecology and represent the behavior of phenomena or processes on different spatial and temporal scales which play an important role in measuring and understanding spatial heterogeneity wu 2004 therefore considering the scale effect can help us fully understand the driving factors of urban flooding and reveal the complex relationship between flooding and driving factors however previous studies were mainly based on a single scale and did not consider the scale effect which may result in dynamic outcomes under different analysis scales therefore how to understand the influencing factors of urban flooding comprehensively and systematically has become an urgent problem this study aims to achieve the following goals 1 to illustrate the spatial distribution characteristics of floods in different cities 2 to explore the dominant factors affecting urban flooding and 3 to reveal the impact of different scales on urban flood events through the comprehensive quantitatively analysis of the driving factors of urban flooding at different scales this study is expected to reveal the main influencing factors and provide scientific basis for the identification and early warning of urban flooding 2 materials and methods 2 1 study area and data in this study 9 megacities beijing tianjin shanghai xi an nanjing wuhan guangzhou shenzhen and shenyang located in the monsoon region of central and eastern china were selected as the study area fig 1 the rainfall is mainly concentrated during the summer accounting for 50 85 of the average annual rainfall ranging from 370 mm to 1900 mm and both short term heavy rainfall and continuous heavy rainfall were recorded these cities are highly urbanized areas in china with an urbanization rate of over 75 and a population ranging from 9 million to 25 million in 2021 the total population of the 9 cities was approximately 143 million accounting for 10 1 of china s population with a gdp of approximately us 3 300 billion accounting for approximately 18 37 of china s total gdp the total area of urban built up area of 9 cities has increased from 5538 km2 to 9362 km2 since 2006 an increase of approximately 70 in the past 20 years the built up areas of these cities have expanded dramatically and the building height has increased a total of 1201 urban flood records from 2015 to 2020 in 9 cities were obtained from amap https www amap com a leading provider of digital map content navigation and location services solutions in china including beijing 112 tianjin 152 shanghai 264 xi an 169 nanjing 68 wuhan 136 guangzhou 109 shenzhen 136 and shenyang 55 the flood points of amap were mainly obtained through traffic police reporting user reporting and field monitoring data in order to avoid the repeated reporting of the same flooding event by users multiple reports from adjacent locations within the same rainfall date will only be recorded once the flooding points only had location information and no specific flooding occurrence time li et al 2022 wang et al 2015 digital elevation model dem data were obtained from the center for earth observation https yceo yale edu aster gdem global elevation data the land cover data of the study area were calculated based on the google earth engine gee platform land cover was divided into four categories including green space water buildings and other impervious surfaces gee was used to extract ndvi as green space based on the threshold classification method li et al 2021c and water body data came from global surface water data https global surface water appspot com the polygon feature dataset of individual buildings in these cities in 2017 was collected which included the floor information of each building in the urban built up area liu et al 2021 in addition other data were collected including precipitation data national tibetan plateau data center http data tpdc ac cn ding and peng 2020 peng et al 2019 peng et al 2017 peng et al 2018 shouzhang 2020 soil information national cryosphere desert data center http www ncdc ac cn and road and river national catalog service for geographic information https www webmap cn data the details of all the data used in this study are shown in table 1 2 2 analysis scale and driving factors referring to previous studies 3 grid scales 1 km 3 km and 5 km were selected as the scale of analysis using shanghai as an example the spatial distributions of flooding points in different scale grids are presented in fig 2 eighteen independent variables were selected as driving factors and divided into five categories topography 2d landscape pattern 3d landscape pattern drainage capacity and meteorology table 2 topographic factors include topographic wetness index twi terrain surface texture index tsi and relative elevation re twi tsi and re are important indicators of topographic changes which could significantly changes the regional hydrological processes through affecting runoff production and transmission brown et al 2004 iwahashi and pike 2007 they have been widely used for flood prone area identification and flood risk mapping parsian et al 2021 risi et al 2015 2d landscape pattern factors include patch density pd aggregation index ai patch richness pr green space ratio gsr impervious surface ratio isr 3d landscape pattern factors include building shape coefficient bsc mean building height mbh mean building volume mbv building congestion degree bcd density of building db landscape pattern analysis is of great significance to explore the complexity and heterogeneity of landscape elements the landscape pattern index which can highly condense the landscape pattern information is most widely used in landscape pattern analysis he et al 2000 li and wu 2004 drainage capacity factors include distance from water dw soil infiltration capacity sic density of roads dr urban drainage infrastructure data in most cities is confidential data and difficult to obtain drainage network is mainly distributed along the road and many researches revealed that an average of 50 of the street network length was associated with 80 85 of the total water sewer network mair et al 2017a therefore dr was taken as an important factor of drainage capacity urban water bodies could not only receive the runoff in the rainwater drainage network but also may cause the river to overflow resulting in flooding in the surrounding areas the pervious area represented by urban green space has an important hydrological regulation function the runoff storage capacity of green space canopy storage capacity and soil infiltration capacity is an effective way to reduce urban flooding in addition to drainage capacity li et al 2021a meteorological factors include annual rainfall ar and maximum monthly rainfall mr continuous rainstorms have a certain effect on urban flooding however the number of fixed weather stations in the city is too small to meet the needs of this study and the downscaled precipitation data with 1 km resolution was used in this study mr means the maximum value of rainfall in each grid in 12 months of a year in this study dem was used to calculate terrain factors including relative elevation terrain surface texture and terrain wetness by saga gis the landscape pattern indices were calculated by fragstats4 2 software the building information data were used to calculate 3d driving factors including the building shape coefficient mean building height mean building volume building coverage ratio and building density all factors were calculated under different grid scales 2 3 methodology 2 3 1 spatial pattern analysis the spatial distribution characteristics of urban flooding points were evaluated through kernel density estimation kde and global moran s i kde is one of the most popular methods for analyzing the first order properties of a point event distribution bailey and gatrell 1995 silverman 2018 the purpose of kde is to produce a smooth density surface of point events over space by computing event intensity as density estimation the formula for kde is given by 1 λ s i 1 n 1 π r 2 k d is r where λ s represents the density of the point at location s r represents the search radius band width of the kde only points within r were used to estimate λ s and k represents the weight of distance d is between points i and s in kde k is an important parameter the kernel density estimation method uses a model function gaussian function quartic function quadratic function etc that considers the distance decay effect in this research a quadratic function is used to calculate the kernel density jenks natural breaks classification method was used to divide the kde value into three levels including high density flooding area medium density flooding area and low density flooding area the high density flooding area hdfa is the region with high density flooding events and the equation 2 was used to calculate the hdfa ratio hdfr which is defined as the hdfa divided by the built up area of each city 2 hdfr hdfa a j 100 where hdfr represents the proportion of hdfa in the built up area hdfa represents the high density flooding area a j represents the built up area the global moran s i index was proposed by moran moran 1948 in 1948 it is used to analyze the overall distribution of spatial variables and determine whether the variables have clustering characteristics the calculation formula is as follows 3 i n i 1 n j 1 n w ij x i x x j x i 1 n j 1 n w ij i n x i x 2 where i represents the global moran s i index n represents the number of space units and x i and x j represent the variable values of units i and j respectively x is the average value of all units w i j is the spatial weight matrix of elements i and j the value range of i is generally between 1 and 1 a value greater than 0 indicates that the variable distribution is positively spatially autocorrelated and the larger the value is the stronger the spatial aggregation 0 means that the distribution of spatial variables is negatively correlated and the smaller the value is the stronger the spatial discreteness of variables 2 3 2 driving factor analysis in this study a total of 1201 flood records from 9 chinese megacities were used to analyze the spatial distribution patterns and driving factors of flooding on the 1 km 3 km and 5 km scales the number of flood points in each grid was defined as the dependent variable and 18 driving factors were defined as independent variables a combined approach of pearson correlation analysis multiple stepwise regression analysis and brt was adopted to analyze the linear relationship degree of impact and relative contributions between drivers and flood points and explore their complex relationships first pearson correlation analysis was adopted to analyze the correlation between urban flood points and driving factors at multiple scales the aim was to find drivers that were significantly associated with flood points then through multiple stepwise regression analysis the multicollinearity problem is avoided and the bidirectional elimination stepwise regression can gain a comprehensive explanation rate of the variables entering the model thereby further revealing the laws between variables at multiple scales finally the relative contributions of drivers to urban flooding were revealed through the brt model at different scales brt is an integrated approach that utilizes statistics and machine learning it combines the advantages of regression trees and boosting algorithms to fit statistical models improving model stability and prediction accuracy elith et al 2008 glenn 2007 brt uses a hierarchical binary segmentation program development model to estimate a single best predictor variable which maximizes differences between groups and homogeneity within groups brt has been shown to be effective in solving complex nonlinear relationships and explaining the relationship between each predictive variable and response variable li et al 2014 3 results 3 1 spatial pattern of urban flood points the kernel density distribution map of urban flood points indicated that the distribution patterns of the 9 cities were different fig 3 the floods in nanjing wuhan xi an and shenyang showed obvious single core and multilevel spatial aggregation patterns however shanghai guangzhou shenzhen and tianjin presented a multicore and multilevel spatial aggregation pattern which is characterized by multicore aggregation and multipoint occurrence hdfa and hdfr were calculated and are presented in fig 4 and there were major differences in flooding characteristics among the 9 cities in terms of hdfa shanghai has the largest area 272 3 km2 followed by xi an 209 32 km2 and beijing and nanjing have the smallest 20 56 km2 and 15 36 km2 respectively in terms of hdfr the largest proportions of cities were xi an and wuhan with 16 3 and 11 8 respectively which may be a potential exposure to the residents and property of the city in contrast hdfa and hdfr in beijing and nanjing were small indicating that these cities have low levels of flooding exposure the global moran s i index of 9 cities calculated by arcgis spatial autocorrelation analysis tool is shown in table 3 the results revealed that the occurrence of urban flooding was not random but showed spatial agglomeration the higher moran s i indices belong to xi an and tianjin 0 57 p 0 0007 and 0 50 p 0 0002 respectively the moran s i indices for beijing nanjing shenzhen wuhan and shenyang ranged from 0 29 to 0 44 while guangzhou and shenyang had the lower moran s i indices 0 24 p 0 0449 and 0 16 p 0 0655 respectively therefore different degrees of spatial agglomeration were presented in all cities 3 2 relationships between flooding and driving factors at multiple scales 3 2 1 pearson correlation analysis the results of pearson correlation analysis illustrated that flooding in most cities were significantly negatively correlated with the ai and gsr p 0 01 but significantly positively correlated with pd pr isr supplementary table s1 the correlation analysis results revealed that the higher the connectivity between patches ai and the more green space coverage gsr the lower the flooding occurrence in contrast the higher the patch density and richness were the higher the flooding occurrence meanwhile 3d building factors was found to play a crucial role in urban flooding in particular db has more relevant to flooding than other building factors and bcd also has a strong correlation in some cities these results showed that the density and height of buildings could affect urban flooding 3 2 2 multiple stepwise regression analysis to explore the explanatory power of the drivers multiple stepwise regression analysis was employed in 9 cities and the results could indicate the total explanatory power of the aggregated 9 cities fig 5 presents the determination coefficients of multiple stepwise regression analysis p 0 01 indicates that the results of the regression analysis model is significant for the whole study area the explanatory power of the multiple stepwise regression model at the 5 km scale was the best determination coefficient r2 0 55 and as the scale decreased the determination coefficient gradually decreased for each city the explanatory power of the model continues to decrease as the scale shrinks and the order of r2 from large to small is 5 km 3 km and 1 km when the scale is 1 km the average r2 is 0 1 range from 0 04 to 0 18 this is mainly because the driving mechanism of flood events may be more complex at a small scale and there may be more factors to be considered moreover the explanatory power of the models revealed some regional differences the r2 values of wuhan xi an and shenyang were generally larger than those of guangzhou shanghai and shenzhen on multiple scales which may be because the flooding driving factors of coastal cities were more complex than those of inland cities 3 3 relative contributions of driving factors in this study driving factors were divided into 5 categories and the relative contributions of each category at 3 scales in 9 cities were explored by brt fig 6 as shown in fig 6 the 2d and 3d landscape patterns were the dominant factors in all flooding events and the relative contributions were all greater than 50 at the three scales which indicates that the process of urbanization has a profound impact on flooding in addition drainage capacity represented by dw sic and dr in this study also played a key role in urban flooding while the relative contributions of topography and meteorological factors were small fig 6 d the relative contribution heatmap was plotted to further investigate the complex relationships between flooding and each factor fig 7 the color of the cell in the column indicates the relative contribution size red represents a high relative contribution blue represents a low relative contribution and the sum of the contributions of all the factors of each city was 100 pd and db played dominant roles in influencing flooding in 9 cities in the whole study area the top 3 key driving factors at the 5 km scale were pd 22 0 db 17 9 and bcd 9 3 those at the 3 km scale were db 20 4 pd 10 4 and gsi 10 2 and those at the 1 km scale were dr 12 3 pd 11 5 and db 10 5 the order and importance of key factors for the 3 scales were different as the scale increases from 1 km to 5 km the relative contribution of the primary driving factor increases for example at the 5 km scale the primary influencing factors in beijing and shenyang were pd 34 2 and mbh 38 9 respectively at the 3 km scale the primary influencing factors in wuhan and xi an were db 38 2 and ai 30 8 at the 1 km scale the contribution rate of all influencing factors was relatively average and there was no primary influencing factor 4 discussion 4 1 spatial pattern and exposure of urban flooding the urban floods of the 9 cities all presented spatial aggregation effects table 3 but the flooding patterns and exposure were different fig 3 which may be related to the underlying surfaces and rainfall characteristics zhao et al 2014 specifically urban expansion in china is highly uneven wei et al 2017 the expansion of urban areas in inland cities is relatively slow mainly in the form of infill expansion liu et al 2016 in addition most of the old residential areas in the urban center have a low proportion of pervious surfaces and combined drainage networks which may lead to the characteristics of a single core aggregation mode and high hdfr in contrast relying on the advantages of geographical location and reform and policies chen et al 2016 wei et al 2017 coastal cities have experienced rapid economic development strong expansion of built up areas and concentrated population and infrastructure under short term heavy rain conditions the characteristics of multiple outbursts and low hdfr will be present therefore researchers and governments need to pay more attention to flooding events in inland cities in addition managers should focus on the spatial distribution of flooding in the urban planning process by increasing drainage facilities and green infrastructure decreasing impervious surfaces reducing population density in high flooding areas 4 2 driving factors previous studies have focused on 2d land cover changes and few have analyzed the driving mechanism of flooding from a 3d urban expansion perspective we revealed that 3d landscape pattern factors were also key drivers of urban flooding in terms of relative contributions fig 6 and the results extended previous studies of landscape patterns on flooding alexakis et al 2014 miller et al 2014 yanyan et al 2016 however the driving mechanism of urban flooding is complex and the driving factors are not independent but interrelated stephens et al 2021 under the effect of scale and heterogeneity these mechanisms are more complex the 2d landscape pattern and composition were the dominant factors of urban flooding at all scales among which pd ai and gsr had significant effects this indicated that these configuration variables impact urban flooding the higher the degree of patch aggregation pd is the lower the connectivity ai of the urban green landscape gsr qifei et al 2021 which will reduce the storage capacity of the green space li et al 2021b zhang et al 2015 therefore urban managers should pay more attention to the distribution of pervious and impervious spaces on a large scale and urban flooding could be mitigated by appropriate adjustment of the pattern wu et al 2020 3d landscape pattern factors were also another important factor affecting urban flooding among which the relative contributions of building density db and building congestion degree bcd were better than those of the other indicators this is mainly because the higher the building density and height the bigger the ratio of impervious surface which leads to the increase of runoff volume therefore appropriately reducing the compactness and height of buildings can reduce the occurrence of urban flooding woong and brown 2022 the results of this study showed the relative contribution of drainage capacity was not primary mainly because flood events in this study were only recorded the location of floods and don t include the frequency and severity of floods more importantly urban drainage infrastructure has a significant impact on flooding in small areas petersson et al 2020 yin et al 2020 and when deal with large scale and serious storm flood events the existing urban drainage infrastructure may be fully loaded and cannot enhance its function zhang et al 2020b in addition affected by the impervious surface the water body inside the city is constantly decreasing and the infiltration capacity is weakened which makes the urban blue gray infrastructures unable to fully play its role in floods this means that the drainage capacity within the city may not be able to effectively alleviate the urban flooding problem therefore blue green gray infrastructures sponge cities and low impact developments were employed to mitigate urban flooding problems dong et al 2017 nguyen et al 2019 song et al 2019 wenjie et al 2021 the influence of topographical factors is far less than that of other factors which may be because the terrain inside most of the cities is flat when the research scale increased to 5 km the relative coefficient of topographic factors decreased gradually therefore the relative contributions of re twi and tsi are smaller than other factors which mainly because of the small impact of flat urban terrain on hydrological processes on a large scale wu et al 2021 4 3 scale effects a large number of studies have confirmed that the patterns and processes temporal and spatial distribution and mutual coupling of geographical and ecological research objects are all scale dependent li and cai 2005 in this study the scale effects significantly affected the relationship between driving factors and urban flooding events as the scale increases the correlation between drivers and flooding becomes stronger the explanatory power r2 increases and the relative contribution becomes more explicit this is mainly because large scales can provide overall characteristic information and can show the collective effects of different landscape types and land cover amaguchi et al 2012 koga and amaguchi 2016 however the driving mechanism is more complex and there are episodic events at small scales finaud guyot et al 2019 finaud guyot et al 2019 for example at the neighborhood and street scale roads intersections squares pedestrians obstacles bus stops parked cars etc could affect the distribution of runoff and may lead to different flooding patterns diakakis et al 2017 finaud guyot et al 2019 gabriele et al 2021 mignot et al 2013 finaud guyot et al 2019 wang et al 2017 moreover the explanatory power of the driving factors is better in inland areas than in coastal areas this is mainly because china s coastal areas are affected by monsoon storms and persistent rainfall from june to october in addition to natural disasters such as sea level rise storm surges and compound natural hazards under global climate change scenarios which tend to lead to more complex flooding mechanisms in coastal cities fang et al 2020 marsooli et al 2019 nicholls et al 2021 peter sheng et al 2022 while elevating the risk of flooding in coastal cities making the risk of flooding in coastal and inland areas unequal nicholls et al 2021 wing et al 2022 the driving mechanism change is a dynamic result under the scale effect and spatial heterogeneity rather than an inherent property and different research scales will bring different results daskalova et al 2020 more attention should be given to spatial heterogeneity and scale effects to find the best scale suitable for different cities and only by examining and analyzing it on a specific scale can we grasp its inherent laws stephens et al 2021 4 4 uncertainty and limitations there are several limitations that need to be considered first the flood points were collected from 2015 to 2020 and the data do not indicate the specific occurrence time it is impossible to analyze the temporal variation characteristics of flooding secondly the flood inundation depth duration and risk degree of flood points were not considered which may cause differences in flood hazard exposure and resilience darabi et al 2018 koks et al 2015 wang et al 2015 thirdly up to date and accurate urban drainage network data are the key to assessing drainage capacity however such data are often absent outdated or incomplete dominik et al 2019 although the literature supports that the density of the road network can be used to reflect the size of the drainage capacity it still inaccurately assesses the impact of the drainage network on flooding mair et al 2017b finally the spatial and temporal resolution of meteorological data also affect the expression of urban flood drivers meteorological stations in cities are characterized by low density and uneven distribution if the spatial and temporal resolution of rainfall data is improved accurate results can be obtained prat and nelson 2013 therefore we have planned to conduct additional real time meteorological monitoring by increasing the resolution of automatic meteorological stations in urban areas the enhancement of data will improve the outcomes of future research 4 5 contributions and implications the methods and results proposed by our study provided important insights and perspectives for urban flood risk mitigation and urban planning first the combination of multiple stepwise regression and brt model we used to explore urban flood characteristics and drivers provided a paradigm for urban flood studies in other megacities of china and the world second the configuration of urban 2d and 3d landscape patterns may be designed to mitigate urban flooding therefore optimizing the urban 2d and 3d landscape patterns configuration may alleviate urban flooding however we still need to pay attention to the urban stormwater management technology and frame and effectively reduce stormwater runoff through low impact development measures such as bio retention green roofs permeable pavements ahmed et al 2017 pour et al 2020 son et al 2017 the methods and data we used could also be extended to comprehensively urban flooding risk studies including flood hazards exposure and vulnerability which may enhance urban resilience and improve urban flood control by assessing urban flooding risks in coastal and inland areas furthermore it can also combine multisource data to assess similarities and differences in the loss and resilience of coastal and inland urban flooding more importantly we tried to explore the general laws of urban flooding influencing factors at different scales through scale analysis so as to provide suggestions for urban storm flood management at a small scale managers should carry out community flood diagnosis maintenance and diversion of drainage networks and temporary flood hazard migration zhong et al 2020 at a large scale combined with the big data platform real time risk assessment system dynamic population flow traffic flow static buildings transportation infrastructure can be built to achieve timely early warning and response to reduce the loss of people and property pollard et al 2018 sun and scanlon 2019 5 conclusion urban flooding is an important problem in the process of urban development in this study 9 megacities in central and eastern china were selected as the study area and the spatial distribution characteristics and dominant drivers of urban flooding were analyzed at multiple scales using a combination of a multiple stepwise regression model and a brt regression model three findings were obtained from this study 1 urban flooding in coastal areas showed a multicore and multilevel spatial aggregation pattern and that in inland areas showed a single core and multilevel spatial aggregation pattern inland cities may have a higher probability of flooding than coastal cities which provides new insight into urban flooding patterns 2 the results of pearson correlation analysis and multiple stepwise regression analysis varied with scale changes at a larger scale the correlations were stronger and the regression analysis had better explanatory power therefore we should pay more attention to the spatial heterogeneity and scale effects of urban flooding our research is expected to provide references for the identification and early warning of urban flooding problems through a multidimensional multiscale and multicity perspective credit authorship contribution statement yongheng wang conceptualization methodology investigation data curation formal analysis writing original draft chunlin li conceptualization methodology investigation writing original draft writing review editing miao liu conceptualization methodology investigation writing review editing funding acquisition qian cui writing review editing hao wang writing original draft jianshu lv writing original draft binglun li data curation formal analysis zaiping xiong data curation formal analysis yuanman hu writing review editing funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement funding for this project was provided by the national natural science foundation of china nos 41871192 41730647 and 32071580 and the youth innovation promotion association of cas 2021194 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 128464 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
2884,model development in groundwater simulation and physics informed deep learning dl has been advancing separately with limited integration this study develops a general hybrid model for groundwater level gwl simulations wherein water balance based groundwater processes are embedded as physics constrained recurrent neural layers into prevalent dl architectures because of the automatic parameterizing process physics informed deep learning algorithm dla equips the hybrid model with enhanced abilities of inferring geological structures of catchment and unobserved groundwater related processes implicitly the main purposes of this study are 1 to explore an optimized data driven method as alternative to complicated groundwater models 2 to improve the awareness of hydrological knowledge of dl model for lumped gwl simulation and 3 to explore the lumped data driven groundwater models for cross region applications the 91 illustrative cases of gwl modeling across the middle eastern continental united states conus demonstrate that the hybrid model outperforms the pure dl models in terms of prediction accuracy generality and robustness more specifically the hybrid model outperforms the pure dl models in 78 of catchments with the improved δ nse 0 129 meanwhile the hybrid model simulates more stably with different input strategies this study reveals the superiority and powerful simulation ability of the dl model with physical constraints which increases trust in data driven approaches on groundwater modellings keywords groundwater level predictions water balance mechanism deep learning catchment scale data availability data will be made available on request 1 introduction groundwater plays an important role in geophysical and hydrological simulation cuthbert et al 2019 li et al 2017 zipper et al 2018 two major focuses related to groundwater simulation are 1 exploring the essence of hydrological cycle and its potential influences on geophysical dynamic system such as climate change ma et al 2021a fan et al 2013 mohan et al 2018 and drought propagation ma et al 2021b sadeghfam et al 2018 zhou et al 2020 and 2 exploring rational strategies including management utilization and protection of groundwater resources under the impacts of human activities such as pumping zipper et al 2018 and pollutant transport ossai et al 2020 tian et al 2015 for groundwater related simulations seeking accurate prediction of groundwater level gwl is an inevitable task due to the deepening understanding about the essence of geophysical dynamic system many efforts have been devoted into process based hydrological models feng et al 2020 in general the successes of traditional groundwater related hydrological models relied heavily on detailed geological attributes and meteorological data more specifically referring to collected local hydrogeological information such as boundary conditions land covers and so on a catchment is divided into several hydrological units and water interaction between adjacent hydrological units is simulated numerically mohan et al 2018 furthermore strong mathematical derivation ability is required for establishing groundwater related models since the relevant governing equations are almost two or three dimensional partial differential equations pdes in general process based models are the most suitable simulation strategies for catchments where the knowledge of flow path geological characteristics and boundary conditions are vital and extensively clear sahoo et al 2017 despite there are many successful cases of applying traditional process based models to simulate gwl in specific regions it has been criticized as too complex parametric difficult and regional limited to use beven and cloke 2012 clark et al 2015a simone fatichi et al 2016 tran et al 2021 moreover it is still extremely difficult for process based models to perfectly describe the water flow with nonlinear interactions spatial heterogeneity and time lags in real groundwater systems clark et al 2015b with the continuous development of computer science and deep learning algorithms dlas data driven hydrological models seem to be reliable alternatives for traditional process based hydrological models in general the main data sources for hydrological modeling originate from observations surveys and lab experiments over years of systematic research chadalawada et al 2020 multiple variables sources and resolutions in space and time doom the complex and big data nature of hydrological data with the aiming of exploring extracting and simulating the information from the raw data different types of dlas emerged as times required among the dl strategies artificial neural networks anns and their optimized forms have become the mainstream methods for establishing data driven hydrological models during the past decades applications of data driven dl models have burgeoned in different fields of hydrology and their performances have been widely recognized reichstein et al 2019 for examples commonly recognized dlas for hydrological timeseries modeling such as streamflow and gwl forecasting include recurrent neural network rnn based models for instance long short term memory lstm feng et al 2020 gao et al 2020 kratzert et al 2019 jiang et al 2021 and gate recurrent unit gru cai et al 2021 zhang et al 2021 convolutional neural networks cnn jiang et al 2018 jiang et al 2019 genetic programming gp babovic 2009 babovic and keijzer 2002 chadalawada et al 2017 liu and shi 2019 chadalawada et al 2020 and etc admittedly benefited from the outstanding computational efficiency with diverse algorithm types dl models present excellent adaptability and versatility when serving as alternatives to traditional models comparing to the process based models dl models have advantages in terms of easy construction computing speed and data requirements reichstein et al 2019 however criticizes on dl models focus on the black box essence which means that dl models are more like computing tests without any physical meanings as a result dl models have not been psychologically accepted by hydrologists because such models cannot improve our understanding the essence of natural hydrogeological processes at present in recent years application of artificial intelligence methods on hydrological modeling has developed into a new and critical stage which integrating dlas with dynamic geophysical processes is expected to enhance the performance and generality of data driven models simultaneously frame et al 2022 jiang et al 2020 hoedt et al 2021 reichstein et al 2019 zhao et al 2019 recent studies have demonstrated two strategies of integrating physical constraints and dlas 1 using interpretation methods to demonstrate the prevalent dl architectures for gaining scientific insights for example jiang et al 2022 explored the flood inducing factors by analyzing inner works of the lstm models 2 embedding physical processes into dl models to improve their awareness to systematic dynamic processes among these research works one strategy is adding physical informed equations into loss functions of deep learning models raissi et al 2019 for example wang et al 2020 proposed a theory guided neural network tgnn which considered groundwater related factors including governing equations boundary conditions initial conditions engineering controls and expert experience as residual terms for loss function of the neural networks this type of strategy is mostly suitable for specific spatial problems as it could be considered as a powerful approximator for the pdes another strategy is adding physical constraints into the inner neural networks for forward propagation this type of strategy is majorly based on recurrent neural networks rnn for timeseries simulations for example kratzert et al 2019 optimized the lstm models with regional entity awareness for streamflow simulation zhao et al 2019 integrated penman monteith equations into ann models for simulation of evapotranspiration significantly niu et al 2019 demonstrated the relationship between the network architecture of rnn family and numerical method and theoretically supported the use of rnn to solve problems involving system dynamics jiang et al 2020 successfully embedded snowmelt process into dl models for streamflow simulations in general most previous studies only focused on streamflow related tasks applications of physically constrained dl models on the gwl simulation remains to be explored with the purpose of improving the performance of lumped dl model for gwl simulation at catchment scale with limited geological observations this study proposed a hybrid hydrological model with water balance as physical constraints and dla as cornerstone the embedding of water balance equations is theoretically supported by the algorithm of solving ordinary differential equations odes with rnn jiang et al 2020 the groundwater related water balance equations are summarized from gsflow model markstrom et al 2008 exp hydro model patil stieglitz 2014 and topmodel kirkby 1975 two prevalent dlas for timeseries simulations i e one dimensional convolutional neural network 1d cnn and gate recurrent unit gru are established for comparisons of simulating performance specifically the hybrid model consists of a self designed rnn model wb model with wrapped water balance equations and a prevalent dl model two layer 1d cnn model self designed parameters of water balance equations with physical meanings in wb model are determined during the iterative training process of dla which strengthens the model s understanding of physical process and hydrogeological characteristics of target catchments for hybrid model gwl simulated form wb model serves as an input for a 2 layer 1d cnn model to give the final output as a result enhanced simulation accuracy robust generalization ability and intelligence for inferring characteristics of catchments are expected from the proposed hybrid model overall this study demonstrates that the novel hybrid model can garner the gwl related physical knowledge in a catchment vision if integrated with physical constraints properly which makes the physical constrained dl model be more accurate interpretable feasible advanced and promising in terms of gwl simulations for cross region and less ungauged catchments 2 data and methods 2 1 study area and multisource data continental united states conus as shown in subplot a of fig 1 is divided into 18 major watersheds by u s geological survey https www usgs gov and each watershed contains either drainage area of a major river or the combined drainage area of several rivers experimental data collected in this study consist of two datasets from 10 major watersheds new england region 01 mid atlantic region 02 south atlantic gulf region 03 great lakes region 04 ohio region 05 tennessee region 06 upper mississippi region 07 lower mississippi region 08 missouri region 10 and arkansas white red region 11 the first dataset is from publicly available catchment attributes and meteorology for large sample studies camels which contains two types of data to describe a specific catchment with minimal human disturbance 1 seven types of basin averaged daily hydrometeorological timeseries data mostly recorded from 1980 to 2014 at hydrometeorological observation stations precipitation p surface downward solar radiation srad snow water equivalent swe maximum temperature t max minimum temperature t min near surface daily average vapor pressure v p and streamflow observations at catchment outlet sf and 2 six types of averaged catchment attributes i e topography and location climate indices hydrological signatures land cover characteristics soil characteristics and geological characteristics addor et al 2017 newman et al 2015 each catchment in the camels dataset is represented by a hydrological unique code huc the second dataset is the freely available daily gwl data corresponding to catchments in the camels dataset which was collected and compiled by u s geological survey in this study we selected the gwl data following three principles simultaneously first the selected groundwater wells must provide daily gwl data with 25 to 30 consecutive years between 1980 and 2014 lower limit of 25 years was set to ensure both enough monitoring wells that could meet the standard and a satisfying amount of data for the need of dl model meanwhile upper limit of 30 years was set to control the difference of data volume for dl model to ensure the simulation results were comparable second as shown in fig 1 gwl data must be collected from the monitoring wells closest to the streamflow observation stations from the same catchment this principle was set to make sure that the hydrological factors in the camels dataset were major driving forces of the gwl changes despite we recognized that the boundaries of groundwater and streamflow catchments are not always perfectly overlapped among the dataset we collected compared with the average catchment area of 812 km 2 we believed that the average distance of 20 km between groundwater monitoring wells and streamflow stations was small enough to ensure their potential interactions third since the camels dataset contained only catchments with minimal human impacts and human impacts were not considered in this study the groundwater data we collected should also avoid urban and agricultural areas with frequent human activities however most of the wells we collected in the western conus especially in california region presented obvious traces of human activities such as pumping the number of eligible wells in those regions is negligible as a result 91 catchments from 10 major watersheds located in the central eastern conus were used for this study fig 1 2 2 deep learning methods for hydrological timeseries simulation 2 2 1 gate recurrent unit a general concept of rnns refers to a class of anns with recurrent cells which works on the principle of storing the output of a particular layer and feeding it back to the input in order to predict the optimate output of the layer during the past decades a variety of rnn based dl models including gru and lstm were proposed following different strategies of designing the recurrent cell to better introduce gru model we will firstly introduce the basic model of rnn family i e simple rnn model as shown in fig 2 a a simple rnn rumelhart et al 1986 recurses in the evolution direction of the sequence and all nodes are connected in a chain the key point of a simple rnn model is the concept of hidden state s t which stores information from previous time steps and delivers the previous features to predict the output y t the specific algorithms are listed as follows 1 s t σ s u s x t w s s t 1 b s 2 y t σ y w y s t b y where σ is an activation function strategy u and w are weight matrices and b is a bias vector theoretically rnn can make use of all the information from former sequence which makes it a preferred strategy for timeseries analysis however due to the gradient vanishing and explosion problems a simple rnn would perform poorly when it comes to long sequence analysis because outputs are likely to be only determined by several former steps in order to solve these problems lstm was firstly brought up for language processing with three gating controllers and two hidden states hochreiter and schmidhuber 1997 to simplify the lstm structure gru neural networks as shown in fig 2 b were proposed by cho et al 2014 gru neural networks share a similar chain structure with that of a simple rnn but the internal operations inside the recurrent cell are optimized for long short term sequence simulation the core algorithm of gru is the two gate controller reset gate and update gate the reset gate determines how to combine the new input information with the previous memory which information will be stored or deleted and the update gate defines the amount of previous memory saved to the current state which data will be output from the current state computational workflow of gru can be summarized as follows 3 z t σ w z x t h t 1 b z 4 r t σ w r x t h t 1 b r 5 h t tanh w h x t u h r t h t 1 b h 6 h t 1 z t h t 1 z t h t where w and b are weight matrices and bias vectors z t and r t are update and rese gates activation vectors h t is potential update vector σ and tanh are sigmoid and hyperbolic tangent functions recently several studies have shown that gru presents similar if not better simulation performance with lstm but a better computational efficiency due to a reduction of structural complexity ayzel and heistermann 2021 gao et al 2020 therefore we applied gru networks as one scenario of gwl simulation as shown in fig 2 d referring to the modelling strategy introduced by cai et al 2021 we adopted two gru layers with a full connection layer and a dropout layer for the catchment scale gwl simulation 2 2 2 one dimensional convolutional neural network 1d cnn convolutional neural network was firstly proposed by lecun et al 1989 who integrated the back propagation algorithm and shared weights into convolutional neural layer normally the basic structure of cnn consists of input layer convolutional layer pooling layer full connection layer and output layer as shown in fig 2 c 1d cnn structure applied in this study adopts convolution layer and pooling layer alternately a convolution operation involves two steps 1 multiple learnable convolutional kernels also known as filters read the former layer such as input layer by sliding on sequence matrix and 2 the output features of the upper layer are convoluted with the convolution kernel that is the dot product operation is performed between the input term and the convolution kernel and then the results are sent to the activation function to obtain the output features the essence of convolutional layer is similar to rnn based dla which is extracting the most relevant features of input sequence for output sequence predicting comparing with a fully connected layer the 1d cnn layers do not require the manipulation of lags concatenation and decrease the memory resources allocated accordingly jiang et al 2020 comparing with the rnn based dl model the algorithm of 1d cnn is more concise which may make its simulation performance not be as good as that of rnn based model but its calculation speed will be much faster jiang et al 2020 to this point 1d cnn layers are chosen as one section of the hybrid model for efficient testing 2 2 3 dla for solving odes in general the simplest form of rnn based model is that the input vector sequence x 1 x 2 x t and output vector sequence y 1 y 2 y t should satisfy the following recursive relationship 7 y t f y t 1 x t t as shown in fig 2 state s t stores and propagates the information from last time step s t 1 which leads to the simplest rnn model is in fact a recursive computation model as follows 8 y t t a n h w 1 y t 1 w 2 x t b where w and b are weight matrices and bias vectors research concerned with dynamics and dynamical systems is usually closely related to the solution of odes jiang et al 2020 general odes have the following form 9 y t f y t t only a few odes can be solved analytically in most cases numerical method is regarded as the first choice for solving odes euler method is a basic numerical method for solving initial value problems of the first order odes butcher 2000 implicit euler method uses the first order backward difference quotient instead of differentiation that is 10 y y k y k 1 t k t k 1 y k y k 1 h where h is time step in this case the differential equation becomes an implicit difference equation 11 y k y k 1 h f t k y k y 0 y 0 in the k th iteration y k 1 and t k are known values y k is the unknown value to be obtained and f t k y k is a function of the unknown value y k to be solved normally y k can be solved by iterative solution of nonlinear equations such as newton s iterative method calculating the values of y 1 y 2 y 3 y 4 y n in turns and the discrete sequence is the numerical solution of the differential equation however comparing eq 7 with eq 11 it can be concluded that the euler solution of ode is theoretically a special case of rnn the forward propagation of rnn corresponds to the euler solution of ode meanwhile the backpropagation process of rnn for determining the parameters brings out the advantage of applying rnn to solve ode tan et al 2018 to be more specific in actual problems there is a type of problem called model inference which is based on the known experimental data the ultimate goal is to guess the model mechanism inference that this batch of data conforms to the approach to solve this type of problem is roughly divided into two steps the first step is to guess the form of the model and the second step is to determine the parameters of the model viana et al 2021 in our case assuming that this batch of data can be described by an ode whose form is already known what needs to be focused on is the estimation of the inner parameters from the perspective of rnn the process of parameter determination corresponds to how the propagation mechanism of rnn model is designed forward propagation is to solve ode rnn prediction process and backpropagation is to infer ode parameters naturally rnn training process an interesting fact is that inferencing ode parameters is a well studied subject but it is just one of the most basic applications of rnn model as shown in fig 3 general idea of inserting physical constrained odes into the general concept of rnn structure is to replace the step function of simple rnn model with differentiable physical constrained equations in our case the proposed wb model is designed to encode geosystem dynamics as a neural network architecture with rnn backend within the self designed rnn architecture the connections eq 1 and eq 2 between neurons in simple rnn structure inputs states and outputs are specified with the state space representation in an explicit discrete form of governing functions which in our case are the water balance equations specifically we replaced the algorithms and the activation functions for calculating the states s t in hidden layer and output y t by water balance odes with self designed state variables self designed flux variables and self learnable parameters see equations in fig 3 a and b respectively to make it clearer fig 3 c presents the structure and unfolded network schematic graph of the wb model layer unlike simple rnn model which possesses one state variable for each hidden layer wb model is equipped with five states variables s 0 s 1 s 4 for each of the so called hidden layer each state variable represents a specific groundwater related hydrological reservoir to calculate and update the state variables nine flux variables are introduced each flux variable represents a flow process flux variables are like the bridges connecting the state variables in order to make the flux variable accurate and meaningful 16 self learnable parameters θ p consisting of θ p f and θ p g with physical meanings are introduced each parameter is determined by the gradient descent algorithm wrapped in the ordinary rnn model relevant descriptions about the water balance equations self designed state variables self designed flux variables and self learnable parameters applied in this wb model are introduced in detail in subsection 2 3 in summary we redefined the step function of ordinary rnn to solve the target odes by introducing self designed state variables self designed flux variables and self learnable parameters with physical meanings 2 3 groundwater related water balance equations the essence principle for process based models is water balance a form of mass conservation law in terms of hydrological research herrmann et al 2016 with a generic equation as 12 ds dt i t o t where s is the water storage unit i t is the inflow to the unit at time t and o t is the outflow from the unit at time t traditional process based hydrological model usually divides the catchments into segments hydrological units and calculates the flow between adjacent segments based on water balance equations and hydrogeological characters of segments in addition to spatial and temporal resolutions existing process based hydrological models majorly differ in mathematical algorithm of i t and o t jiang et al 2020 in this subsection we summarized water balance equations related to gwl from different process based models including gsflow model markstrom et al 2008 exp hydro model patil stieglitz 2014 and topmodel kirkby 1975 these processes were integrated into dl by replacing the states and learnable parameters with water balance equations for rnn model we named the model and equations wrapped in the rnn model as wb model and related processes and equations are listed below 2 3 1 canopy interception as shown in fig 4 interception of precipitation by plant canopy is computed during a time step as a function of plant cover density and the storage available on the predominant plant cover type the variability of the camels dataset makes it possible to demonstrate the plant canopy interception process since the landcover related data is included dunkerley and booth 1999 precipitation that reaches the ground is calculated by the sum of throughfall and precipitation on the catchment not covered by plants canopy interception is closely related to the vegetation type and local climate condition tao et al 2020 trinh and chui 2013 in this subsection we set a reservoir s 0 for the storage change of canopy interception two critical learnable parameters the maximum capacity of canopy interception sc max and canopy interception coefficient related to plant type k c were introduced for physical rnn model since conus locates in the northern hemisphere we determined the seasons according to the averaged day length if the day length is longer than 0 5 we set a range with higher mean value of k c and sc max because vegetation flourishes in autumn and summer conversely if day length is shorter than 0 5 we set a range with smaller mean value of k c and sc max for winter and spring the equations leavesley et al 1983 can be summarized as 13 p int k c d c a 0 s 0 sc max 0 s 0 0 p max s 0 sc max 14 ds 0 d t p int 15 k c k cs sc max sc smax w h e n d a y l 0 5 k c k cw sc max sc wmax w h e n d a y l 0 5 where d c is vegetation coverage which reflects the spatial coverage of vegetation a is catchment area values of d c and a are from the camels dataset 2 3 2 snow melt snow melt process a critical factor for hydrological simulation especially in cold regions has been proven to be a key point for streamflow simulations with dl methods broxton et al 2019 inspired by the methods of wrapping exp hydro model patil and stieglitz 2014 into p rnn model jiang et al 2020 the snow melt process is implanted into the hybrid model as follows first the precipitation reaches the ground will be divided into snowfall p s and rainfall p r which is controlled by daily temperature t and threshold temperature of snowfall t min 16 p r p p int p s 0 w h e n t t min p s p p int p r 0 w h e n t t min then water from snow melt was calculated as 17 m min s 1 d f t t max i f s 1 0 a n d t t max 0 o t h e r w i s e where d f is thermal degree day factor t max is temperature threshold of snowmelt and s 1 was the snow reservoir which can be expressed as 18 d s 1 d t p s m 2 3 3 soil retention and groundwater flow describing the dynamic system of water movement in soil has always been a complex but critical object for groundwater simulation banwart et al 2019 cai et al 2021 indeed soil structure affects the all round local hydrological response fatichi et al 2020 what we focused on was the water distribution in soil that meets the catchment scale water balance requirements again this part is referred to the soil structures introduced in gsflow model specifically we only considered the downward vertical flow process between preferential reservoir capillary reservoir and gravity reservoir with the aim of meeting the catchment scale water balance 2 3 3 1 preferential reservoir when precipitation and snow melt reach the ground a fraction of infiltration is apportioned to the preferential flow reservoir to account for fast interflow through large openings in the soil zone near land surface while the rest of the water which is generated when the precipitation rate exceeds the infiltration rate of the soil that may not be saturated will be classified as hortonian flow horton 1933 eventually both hortonian flow and preferential flow contribute to the streamflow of catchment outlet referring to the topmodel and p rnn model water flow in the preferential flow bucket can be calculated as 19 q hor p r m 1 r in 20 q pref 0 s 2 0 p r m r in r pr e f s pmax s 2 q pmax s 2 s pmax 0 s 2 s pmax where r in is the infiltration rate r pr is the coefficient of fast interflow f is decay factor s 2 is preferential reservoir s pmax is the storage capacity of preferential bucket and q pmax is the maximum preferential flow the values of the parameters are learned during iterative process of self designed rnn model which can be expressed as 21 d s 2 d t p r m r i n r p r 2 3 3 2 capillary reservoir the capillary reservoir represents water held in the soil by capillary forces between the wilting and field capacity thresholds water is removed from the reservoir by evapotranspiration markstrom et al 2008 referred to the exp hydro model and p rnn model the pet potential evapotranspiration is estimated by hamon s formulation therefore the calculation can be concluded as follows 22 q cap p r m r in 1 r pr 23 ds 3 dt q cap e t 24 et 0 s 3 s cmin p e t s 3 s cmax p e t s 3 s cmax 0 s 3 s cmax 25 pet 29 8 l day 0 611 e 17 3 t t 237 3 t 237 3 where q cap is the waterflow into capillary reservoir s 3 is capillary reservoir s cmin and s cmax are the minimum and maximum storage capacities of capillary reservoir l day is day length and t is local temperature the main function of capillary reservoir is to calculate the amount of evapotranspiration the maximum storage capacity represents the field capacity and the minimum storage capacity represents the minimum storage capacity held by vegetation 2 3 3 3 gravity reservoir the gravity reservoir represents water in the soil zone between field capacity and saturation thresholds this reservoir was developed to provide gravity drainage from the soil zone to the unsaturated zone which will eventually discharge to the groundwater according to gsflow model slow interflow from the gravity reservoirs represents the perching of water in the soil zone above the water table that can occur because of mineralization near the bottom of the soil zone or when soil develops over fine grained material slow interflow can occur when the water content in the soil zone exceeds the field capacity threshold slow interflow is developed from continuity and an empirical equation leavesley et al 1983 for the lumped hydrological model we added a decay process for slow interflow referring to topmodel which can be written as 26 q slow 0 s 4 0 q gra k l q gra 2 k n q gmax s 4 s gmax e f s gmax s 4 0 s 4 s gmax 27 q gra q cap e t 28 ds 4 d t q slow where q gra is the water flows into gravity reservoir s 4 is gravity reservoir s gmax is maximum storage capacity of gravity reservoir k l is linear coefficient of slow interflow k n is non linear coefficient of slow interflow and q gmax is the maximum slow interflow finally the outputs of the water balance model are expressed as 29 q stream q hor q pref q slow 30 q gw q gra q slow where q stream is the water flowing into stream at catchment outlet and q gw is the proportion of water that flows into groundwater at the catchment scale to better illustrate the way of wrapping above equations into wb model we use snow melt process in subsection 2 3 2 as an example the precipitation that reaches the ground flux from canopy interception reservoir and temperature in input x t will be used for initial input for this section the snow reservoir firstly we set a temperature threshold t min ranging from 3 to 0 to determine whether precipitation reaching the ground is in form of rainfall or snow eq 16 secondly we set a temperature threshold t max ranging from 0 to 3 to determine when the snow starts to melt a thermal degree day factor d f ranging from 0 to 5 mm day was set to calculate the snow melt eq 17 the state variable s 1 t which represent the snow storage is updated by eq 18 as s 1 t s 1 t 1 p s t m t in this case t min t max and d f will be determined through the training process above process is inserted into the neural network by defining s 1 rainfall snow and melt with eq 16 to eq 18 further the flux out of snow reservoir s 1 which is the rainfall and snow melt will serve as the input for preferential reservoir in subsection 2 3 3 1 to further update s 2 and calculate other fluxes with similar process state variables will be updated in order from s 0 to s 4 indicating water flows from precipitation to groundwater as a result after updating the five states and nine flux variables the preliminary groundwater fluctuation would be calculated as eq 30 pseudocode of the ode rnn layer for gwl simulation is presented in table 1 overall the process based groundwater model involves three input daily variables from the camels dataset precipitation averaged temperature and day length five states variables s0 s1 s2 s3 and s4 nine flux variables p fall p s p r m q cap q pref q hor q gra a n d q slow and 16 learnable parameters which controls the hydrological behaviors sc max k c t min t max d f r in r pr s pmax q pmax f s cmax s min k l k n s gmax q gmax again the proposed wb model is a spatially lumped dl model with physical constrains which adheres strictly to the law of water balance 2 4 integrated hybrid framework for gwl simulation inspired by the outstanding work of p rnn integrated hybrid streamflow simulation model jiang et al 2020 and previous work of exploring the usage of dl model for large scale gwl simulation cai et al 2021 this study proposed a hydrology aware dl architecture for gwl simulation as presented in fig 5 there were two pipelines for the hybrid model the first pipeline was the water balance based rnn model wb model which wrapped catchments attributes and water balance equations into dla the forcing variables for this pipeline were precipitation day length and temperature the parameters within wb model were trained separately to present a preliminary gwl which was furtherly served as one of the input variables for the second pipeline the second pipeline was a sequence to sequence dl model which maps the meteorological sequences to gwl sequence the input variables of the second pipeline included the preliminary gwl simulated by wb model and the other six dynamic forcings provided by the camels dataset the objective of wb model was to identify geo hydrological information from observations of the external world and reorganize them in form of providing simulated preliminary gwl in other words wb model was used to facilitate the prevalent dl model the core function of wb model was to combine water balance equations and dl algorithm to capture the fluctuation characteristics of gwl that response to driven factors as a result the preliminary gwl simulated by wb model was served as an important input forcing to strengthen the training process of hybrid model considering the ability of handling lagged effect from hydrological signals feng et al 2020 and a faster computing speed than rnn based model jiang et al 2020 a two layer 1d cnn model was chosen as the main dla for simulating the gwl after a large number of preliminary experiments considering the trade off between increasing modelling accuracy and reducing the complexity of the model structure the first layer applied 8 kernel filters each with a length of 15 the length of 15 symbolized that the influence on the current hydrological response could be traced back to 15 days ago from a hydrological viewpoint tracing the influences on the current hydrological response back to 10 days ago is a common strategy in data driven hydrological models and has been proven to be successful for streamflow simulation with similar method jiang et al 2020 since our simulation target is gwl for phreatic aquifer the hydrological response time will be a little longer than that of streamflow simulation the set of 15 day hydrological response time was based on a large number of preliminary experiments nevertheless we cannot ensure that 15 day hydrological response time is the most accurate setting for each specific catchment however this setting is overall feasible for gwl simulations of these 91 catchments and is in line with common strategy in data driven hydrological models the second layer used 1 convolution kernel filter for analyzing the output of the first layer and providing the final results zero padding strategy was adopted for ensuring the output had the same sequence length as the input sequence after filtering by kernel filters the performance of the model was evaluated with nash sutcliffe coefficient of efficiency nse value nash and sutcliffe 1970 as follows 31 nse 1 i 1 n q s q o 2 i 1 n q o q o 2 where q s q o and q o are the simulated observed and mean observed gwl nse is widely used for model assessment which ranges from to 1 the closer nse is to 1 the better the simulation result is the nse value was also set as loss function for all the dl models in this study 80 of each timeseries was divided as training set while the rest 20 of the data was used as testing set the epochs number was set as 400 and the learning rate was 0 01 the number of parameters in hybrid model is 593 including 16 self designed parameters in wb model 568 parameters in first 1 d cnn layer and 9 parameters in the second 1 d cnn layer all the models and equations introduced in this study were coded with python 3 6 with keras as coding api and tensorflow 1 4 as the dl backend with no gpu requirement generation ability ga is an important evaluation criterion for data driven model chen et al 2020 it reflects the ability of dl model which is well trained to digest new data and make accurate predictions the calculation method is as follows 32 rmse 1 n i 1 n o s o o 2 33 ga rmse pred rmse train where o s and o o are the simulated and observed gwl rmse refers to root mean square error which measures the average magnitude of the error between model simulations and observations and ga is calculated as the ratio of the rmse values between predicting process and training process yoon et al 2011 if the data driven model simulates gwl perfectly the ga values will be unity otherwise if the model is over trained or overfitting the ga values will exceed unity in this case the model would not give accurate predictions even though it is able to provide accurate fittings for the training data the ga values will be less than unity if the model is under trained which is also called as underfitting 3 results and discussion 3 1 comparisons of gwl simulation results 3 1 1 comparisons of model performances in specific catchments as representatives of the 91 catchments three catchments huc 04216418 huc 03 015 500 and huc 03026500 were chosen for presenting describing and analyzing the simulations in detail fig 6 presented the gwl forecasting performances with four independent dl strategies from top to bottom of the subplots are hybrid model 1d cnn model wb model the self designed rnn model and gru model wb model integrated water balance constrains into rnn which served as a major optimization for hybrid dl model while the 1d cnn model and gru model are pure dl model consequently what concerned us the most was how much the simulation performance of hybrid model was improved compared with the 1d cnn model and gru model the reason why we chose these three catchments as representatives was that the simulation performances of the 91 catchments could be roughly divided into three categories which corresponded to the three catchments shown in fig 6 the simulation results of huc 04216418 represented the catchments that with an overall simulation improvement when combining water balance constrains into common dl models as shown in the first column of fig 6 the pure dl strategies 1d cnn nse 0 238 and gru nse 0 278 model had similar simulations effect while the hybrid model nse 0 553 outperformed significantly than the pure dl models such improvement was majorly benefit from the accuracy of simulating the gwl fluctuance pattern by the wb model nse 0 377 admittedly based on the evaluation criteria of hydrological model the performance of wb model itself were not satisfied enough for an alternative of traditional process based model however although there were certain differences in specific values the variation trend and fluctuation patterns of the simulation results were consistent with the observations as a result the preliminary result from wb model served as an important input forcing strengthened the training process of hybrid model which lead to a higher accuracy than pure dl models more specifically in plain language common dlas possessed the ability to filter out critical information that mostly related to the simulation target by adjusting the intrinsic parameters such as weights and bias in this case comparing to the other two representatives preliminary gwl simulated by wb model provided the most useful sequence for mapping the observations because the fluctuance pattern simulated by wb model was most similar to that of the observed gwl the second column of fig 6 huc 03015500 presented the representative of catchments with another type of simulation performance in general despite the nse improvements may not be as obvious as the catchments in the first category hybrid models nse 0 606 outperformed the pure dl models nse cnn 0 391 and nse gru 0 374 in these catchments for better simulating the gwl fluctuance under extreme conditions comparing to the first category the overall simulation performances of wb model in this category were slightly inferior which led to a less obvious promotions of nse values as the simulation of catchment huc 03015500 illustrated there was an obvious increasement of gwl during 2011 to 2012 which was resulted from a large amount of snow melting and rainfall as precipitation as shown in the 1d cnn model and gru model the pure dl models failed to capture such precipitation pattern because precipitation characteristics especially the extreme precipitation conditions had certain probability of being diluted in a variety of input variables during the training process dl model would consider the extreme precipitation events as outliers especially when the other inputs were sufficient to establish a good liner or nonlinear mapping relationship with the object this could be inferred from the fact that pure dl models had already presented good overall simulation performances under these circumstances wb model captured the pattern of extreme precipitation events when providing the preliminary gwl which emphasized the importance of the extreme points and reinforced the hybrid model to learn such patterns consequently the simulation results of hybrid model were intuitively improved because of better matchings of extreme gwl the last column of fig 6 huc 03026500 was presented as a representative of catchments with negative effects when integrating wb model intuitively preliminary gwl simulated by wb model failed to match the fluctuance of observed gwl nse 6 759 conversely the pure dl models showed satisfying simulation results nse cnn 0 626 and nse gru 0 686 the reduction of hybrid model performance nse 0 542 resulted from the failure of wb model specifically for catchment huc 03026500 the gwl simulated by hybrid model showed a larger fluctuation range than observed gwl which was consistent with simulation from wb model there were three potential reasons 1 the groundwater observation well and the corresponding streamflow observation station located in different drainage areas as mentioned in subsection 2 1 although the groundwater data we collected were from the observation well that was closest to the streamflow observation station at the catchment outlet we cannot guarantee that the gwl was driven by the precipitation from the streamflow catchment because the catchments of groundwater and surface flow might not be geographically coincident in this case the wb model driven by the precipitation from the camels dataset would inevitably lead to failed gwl simulation results because the fluctuation of gwl was driven by a different precipitation input 2 the water balance algorithm was not applicable for local gwl simulation the essences of the wb model and hybrid model were physical constrained dl models for lumped gwl simulation which meant the detailed geological information related to groundwater flux were not collected or considered in these models this would lead to simulation mismatches if discharge and recharge of local groundwater were not majorly from the precipitation but from other sources such as confined aquifer or lakes nearby in this case the wb model would not provide a rather precise simulation result even if the precipitation was one of the driven forces for the local groundwater fluctuance 3 the ranges of learnable parameters were not set properly this was also resulted from the lack of geophysical information to determine the range of self designed parameters especially the soil related parameters overall the influence from the third problem could be minimized by multiple tests while the first and second problems might be the most likely causes of the failures of wb model and hybrid model for gwl simulations in several catchments 3 1 2 comparisons of overall accuracy between hybrid model and pure dl models as shown in table 2 1d cnn gru and water balance constrained hybrid model were applied to simulate gwl of 91 catchments located in 10 major watersheds of the middle eastern conus more specifically the median nse values of the simulation results by using gru model was 0 313 while the average nse was 0 278 which was consistent with the nse range of former simulations in similar areas by applying gru algorithm cai et al 2021 as an advanced dla focused on timeseries simulation gru model served as a group of controlled experiments in this study for physical constrained hybrid model in the meanwhile the median nse value of simulation by using 1d cnn model was 0 297 and the average nse was 0 253 in views of the nse values the simulation performance of the two pure dl models were not much different but due to the complexity of model structure and the difference in emphasis of simulation gru model focuses on timeseries simulation and cnn model focuses on image processing the overall result of 1d cnn model simulation would be slightly inferior to that of gru model for gwl simulations benefited from the wb model the overall simulation performance was significantly better than that of 1d cnn and gru model the median nse was 0 408 and the average value was 0 401 the nse distribution was shown in fig 7 b since the final algorithm of hybrid model was a two layers 1d cnn model comparing to the pure 1d cnn model the preliminary gwl simulated by the wb model was the key factor for improving the performances of hybrid model with the aim of testing the adaptability of hybrid model we counted the number of catchments where the hybrid model outperformed the 1d cnn model for gwl simulation as shown in the last two columns of table 2 comparing with the 1d cnn model 71 out of 91 catchments presented simulation improvement when applying the hybrid model furthermore for the 10 major watersheds comparing to the 1d cnn model average nse improvements while using hybrid model were positive except for the new england and lower mississippi regions however the number of catchments used for experiments was so small that the average nse improvement would be seriously affected by a single catchment with a major failure of hybrid model moreover more than half of the catchments in new england and lower mississippi region presented positive improvement when using hybrid model than using 1d cnn model optimizing effect of hybrid model was more intuitively explained in fig 7 a and c distribution of catchments where hybrid model outperformed the 1d cnn model were shown in fig 7 d lumped hybrid dl model for streamflow simulation based on snow melting processes had been tested to be successful for catchments in high latitudes jiang et al 2020 in this study in addition to the snow melting process groundwater related soil water flow processes were also properly embedded into the wb model as a result the hybrid model outperformed the pure dl model not only in the snow domain areas but also basins in middle and low latitudes preliminary gwl simulated by wb model improved the noise tolerance of hybrid model to groundwater irrelevant input features and strengthens the learning ability of the hybrid model to gwl changes therefore comparing to the pure dl models hybrid model possessed better adaptability and understanding of different hydrometeorological and geophysical conditions with the constrains of water balance equations in conclusion comparing to prevalent pure dl models hybrid model exhibited significantly higher overall accuracy for gwl simulations 3 2 comparisons of model generalization ability the generalization ability was evaluated by eq 33 if the model focused on the training process rather than a general system the ga value would be higher this meant the model will have overfitting problems the higher the ga values were the weaker the generalization ability the model processed fig 8 presented the distributions of the ga values for the four dl models in form of boxplot the average ga values of hybrid wb model cnn and gru model were 1 269 1 124 1 431 and 1 396 respectively this indicated the developed hybrid model presented a better generalization ability than that of cnn and gru model and wb model presented the best overall generalization ability among the four dl models it should be noted that wb model was a group of ode equations coded with the language used in recurrent neural networks this meant that wb model was essentially a physic guiding model for wb model the water balance equations served as a backbone of training and predicting stages were universal theorems this was the main reason why wb model presented the best generalization ability furthermore the result was consistent with conclusions of the previous study which proved that physic based numerical models tended to present better generalization abilities than that of pure machine learning models chen et al 2020 in conclusion benefited from wb model hybrid model presented superiority than pure dl models in terms of generalization ability 3 3 robustness of the proposed model in general in addition to the advanced core algorithms an important factor affecting the effect of dl model was the amount of sample data as well as the potential relationship between input data and target data an excellent dl models should be equipped with the ability to ensure its own stability while satisfying the accurate simulation performance while reducing the effect from the interference information as much as possible su et al 2018 to demonstrate the reliability and stability of the proposed model we chose the catchment huc 03182500 for scenario tests we evaluated the gwl simulation results of hybrid model with six combinations of input features more input features signified a larger amount of input data which could be either useful information or noisy for simulations of targets in this study since the wb model needed three inputs precipitation temperature and day length for the self designed rnn model these three variables were the minimum input requirement as shown in fig 9 with the increasing number of input features nse values of the hybrid model also presented an increasing trend from 0 564 to 0 650 it was worth mentioning that although the nse values of the three inputs strategy was the smallest the value of nse 0 564 was a fine result for gwl simulations meanwhile in perspective of the nse values the difference of simulation performances between the six scenarios was relatively small which proved that the hybrid model processing a good stability furthermore it could be inferred that comparing to srad and vapor applying streamflow data as one of the input features could better improve the accuracy of the hybrid model which implied that the feature of an important hydrological phenomenon flow exchange between streamflow and groundwater through baseflow was captured from the perspective of hybrid dl model this reflected that dl models which had always been criticized as black box models without any physical meanings could also express some natural processed implicitly jiang et al 2022 fig 10 presented the comparisons of the stability of physical constrained hybrid model and 1d cnn model as representative of pure dl model through the nse values we adopted the data from catchment huc 03182500 for testing experiments to compare the performance of the model under same input feature strategies the result showed that hybrid model outperformed the pure dl model for every input strategy and the nse value of hybrid model presented a smaller fluctuation range from 0 564 to 0 651 than that of pure dl model from 0 417 to 0 517 which implied the hybrid model performed more stably than pure dl model the reason for this phenomenon was that the wb model in the hybrid model could adjust the values of the internal learnable parameters according to the regional characteristics so that the preliminarily simulated gwl could reach a certain accuracy then as an input the preliminarily simulated gwl could help the dl model better understand the change characteristics of the gwl to be simulated so that the performance the hybrid model was obviously better than that of the pure dl model in conclusion the physical constrained mechanism made the stability of the hybrid model better than the pure dl model which was another outstanding advantage in addition to the higher accuracy of the simulation results of the hybrid model 3 4 a rethink of relationships between simple rnn wb model and gru it is worth clarifying that simple rnn wb model and gru are based on a general concept of rnn which is a family of neural networks with recurrent cells in general simple rnn model does not possesses the long term memory ability because of the potential gradient vanishing and explosion problem when updating the hidden states during the training process the main difference between simple rnns and grus or lstms is the latter introduces a so called gating mechanism into the recurrent cell to control the information flow to address the gradient vanishing and explosion problem likewise in our wb model we also modified the recurrent cells of the general rnn models where the nodes were connected using physical equations rather than the usual perceptions more specifically gru introduces reset gate and update gate to determine whether the previous information involved in the cell states is added or discarded in comparison in the wb model the information flow is controlled using the thresholds as in hydrological models for example if the temperature is larger than a threshold the rainfall information will become a part of the soil state otherwise it will be added to the snow state further although the specific values of these parameters are determined during the training process of dl model the essence of the wb model is a group of ode equations presented by tomodel gsflow and other hydrological models coded with the language used in neural networks which makes the wb model naturally have long term memory in the form of hydrological states e g snowpack and preferential flow pack in conclusion the gru and wb model model have taken distinct ways to reform the recurrent cells of general rnn models which could be considered as two optimizing strategies of simple rnn model 3 5 limitations and potential improvements comparing with pure dl models the proposed hybrid model for cross region gwl simulations at catchment scale is significantly improved in terms of the accuracy generality robustness and physical meaning of models but there are some obvious limitations and potential improvements for the hybrid model the first limitation is that the process of adjusting self designed parameters could be cumbersome as introduced in former subsections there are 16 learnable parameters designed in the wb model that control the hydrological behaviors the ranges of these parameters need to be adjusted manually until the hybrid model produces the most accurate results for example the ranges of hydrometeorological parameters that introduced from former models jiang et al 2020 patil and stieglitz 2014 such as t min t max f etc were set for all catchments while other parameters especially the geological related and storage related parameters introduced in this study such as s pmax q pmax s cmax s min etc should be adjust for specific catchments to reach to best simulation performance consequently the parameters calibration process of hybrid model for some catchments could cost lots of time to achieve the best simulation results the second limitation is that due to the lack of detailed geographic information the lumped gwl model cannot be applicable to all basins supporting by the universality of water balance constrains and the powerful computing ability of dla our expectation of this hybrid model is that the model can simulate gwl at any point in the basin accurately if the hydrometeorological data is sufficient and the historical gwl observation is provided this is because we believe the hybrid model can perceive the geological information to give accurate gwl simulations by adjusting learnable parameters set of wb model however in this study the hybrid model failed to improve the simulation performances for 20 out of 91 catchments this is because the lack of detailed geographic information makes some groundwater recharge and discharge processes such as groundwater recharge from surrounding confined aquifers impossible to be reflected through single water balance constrains therefore the proposed hybrid model cannot be applied to the simulation of gwl in all catchments especially in those with complex groundwater recharge and discharge process this is also reflected in the simulation performance of wb model although wb model can simulate the fluctuation state of gwl most of the simulation results are not accurate and accurate simulation results are obtained by embedding the preliminary result into another dl structure the third limitation is the black box nature of proposed hybrid model remains unrevealed the main merit of adding water balance odes into the dl architecture lies in improving the awareness of hydrological knowledge of hybrid model by guiding wb model to capture the fluctuation patterns of gwl however adding physics is not enough to reduce the black box nature of dl model barredo arrieta et al 2020 despite we have successfully combined dl with physical constrains making the hybrid model present extremely powerful forecasting ability we have not found further interpretable physical meaning from the proposed hybrid model especially for the two layer 1d cnn model in the hybrid model which only provides the outstand non linear fitting ability the fitting process remains uninterpreted from hydrological perspective in this study the fourth limitation is that the two or three dimensional processes of groundwater flow are not considered in this study in general the study of groundwater simulations is always related with two or three dimensional groundwater flow with specific boundary conditions and governing equations moreover detailed groundwater simulation is usually focusing on find numerical or analytical solutions of two or three dimensional pdes related to groundwater by numerical method or analytical method liang et al 2018 the hybrid model we proposed is based on the combination of dla and vertical one dimensional water balance equation in catchment scale although it is a breakthrough to the traditional research methods it cannot describe the two and three dimensional groundwater flow processes which might make it not delicate or convincing enough from the perspective of traditional groundwater flow simulation community in other words we embedded physical constraints to improve the simulation performance of dl model but the physical constraints are not detailed enough compared with traditional methods more specifically although water balance constraints with 16 self learnable parameters are well implanted into wb model this number is far less than prevalent dl model such as 1d cnn model which in our case has 568 parameters in first 1d cnn layer and 9 parameters in the second 1d cnn layer parsimonious dl model does not ensure a learned model will capture all important information in the data sensed about the external world ma et al 2022 as a result lacking complexity is a main reason why wb model cannot outperform the gru model in terms of the accuracy of gwl simulation based on the limitations mentioned above we believe that this study has potential for further improvements firstly more detailed groundwater related processes such as human activities could be implanted into wb model the proposed hybrid model could be more flexible if multiple potential processes were wrapped into wb model for options in that case the hybrid model would decide which processes are suitable to be considered for specific catchments by adjusting the parameters and super parameters of wb model this would improve the adaptability of hybrid model greatly if the groundwater related processes could be considered comprehensively secondly cutting edge dl interpretive methods such as expected gradients eg erion et al 2021 could be applied to decipher the machine captured patterns and inner workings of the hybrid model the main purpose of such study will be revealing the black box process of the proposed hybrid model so that the hydrological cognition from the perspective of machine learning models under physical constraints could be obtained to facilitate our improving our understanding for specific hydrological processes thirdly the threshold mechanism of hydrological models in our wb model framework might be further improved by the idea of gating mechanism from gru or lstm model lastly to optimize the physical constrains from one dimensional odes to higher dimensional pdes the difficulty of groundwater simulation is much higher than that of surface water simulation because of its complex two and three dimensional flow characteristics wang et al 2021 limited by the lack of geophysical data the lumped hybrid model based on water balance mechanism has not maximized the power of integrating dlas and physical constrains therefore the combination of pdes governed distributed groundwater flow processes and dl model will be an important research direction in the future regardless the proposed hybrid model is already the most novel model in terms of predicting gwl with time series hydrometeorological inputs 4 conclusions in this study a lumped hybrid groundwater model with water balance equations as physical constraint and dl methods as core algorithm is proposed to simulate the fluctuation of gwl in the hybrid model water balance guided oeds were wrapped into a wb model by self designing the specific algorithms of rnn model we tested the model with the camels dataset from 91 catchments located in the middle eastern conus and two pure dl models 1d cnn and gru were established for comparison of simulation performance the main findings of this study are summarized as follows first the hybrid model presented high accuracy of simulating the fluctuation of gwl without using detailed hydrogeological information of the catchments the preliminary gwl simulated from the wb model enhances the learning ability of hybrid model consequently the physics constrained dl model outperformed the pure dl models significantly in 71 out of 91 catchments in this study moreover comparing with traditional distributed gwl simulation models dla reduces the cost of data as well as the difficulty of model setup while still provides accurate simulation results in perspective of traditional standards which makes the hybrid model more suitable for gwl predictions in less gauged or ungauged basins second the self designed rnn model with water balance constraints proposed in this study embeds the main groundwater related water balance formulas which are referred to the traditional distributed hydrological models into the recurrent neutral networks the specific values of the parameters in water balance related formula and water storages in designed reservoirs are determined by the hybrid model through iterative algorithms activation functions and loss functions of dlas consequently this equips our hybrid model with the ability to learn the groundwater related water allocation processes at the catchment scale in conclusion the physical constrained hybrid model presents better adaptability and generalization ability comparing with the pure dl models last compared with the pure dl model the hybrid dl model proposed has better robustness this is reflected from the fact that the hybrid models outperformed pure dl model with different strategies of input features more specifically the nse values of simulations from hybrid model have higher values and lower fluctuation range the reason is that the preliminary simulation results provided by the physically constrained wb model strengthen the learning ability of dla for groundwater fluctuation characteristics so that the hybrid model can be affected by potential noise data as little as possible this study shows the superiority and powerful simulation ability of dl model based on physical constraints we have abandoned the general idea of building traditional groundwater models solving two dimensional or three dimensional groundwater flow problems through the iterative method of distributed models or finding analytical solutions instead we embedded water balance equations into dla for regional gwl simulation as a result this hybrid model presented great accuracy adaptability generalization ability and robustness even without detailed geological data of catchments which demonstrated the possibility of application of proposed model for gwl simulation in ungauged or lack of gauged catchments although there are many limitations and potential improvements for the proposed model we believe that the general performance of the proposed model would increase trust in data driven approaches on hydrological modellings especially when physical constraints related to hydrological sciences are integrated with dlas credit authorship contribution statement hejiang cai conceptualization methodology validation software writing original draft writing review editing suning liu supervision writing review editing haiyun shi methodology conceptualization funding acquisition supervision writing review editing zhaoqiang zhou validation software shijie jiang validation writing review editing vladan babovic supervision writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this study was supported by the national natural science foundation of china 51909117 and natural science foundation of shenzhen jcyj20210324105014039 data availability and coding statement the groundwater level data are openly available at https waterdata usgs gov nwis gw and the camels dataset is freely available at https ncar ucar edu we gratefully acknowledge the use of the dataset publicly provided by addor et al 2017 and newman et al 2015 and the codes of p rnn model publicly provided by jiang et al 2020 
2884,model development in groundwater simulation and physics informed deep learning dl has been advancing separately with limited integration this study develops a general hybrid model for groundwater level gwl simulations wherein water balance based groundwater processes are embedded as physics constrained recurrent neural layers into prevalent dl architectures because of the automatic parameterizing process physics informed deep learning algorithm dla equips the hybrid model with enhanced abilities of inferring geological structures of catchment and unobserved groundwater related processes implicitly the main purposes of this study are 1 to explore an optimized data driven method as alternative to complicated groundwater models 2 to improve the awareness of hydrological knowledge of dl model for lumped gwl simulation and 3 to explore the lumped data driven groundwater models for cross region applications the 91 illustrative cases of gwl modeling across the middle eastern continental united states conus demonstrate that the hybrid model outperforms the pure dl models in terms of prediction accuracy generality and robustness more specifically the hybrid model outperforms the pure dl models in 78 of catchments with the improved δ nse 0 129 meanwhile the hybrid model simulates more stably with different input strategies this study reveals the superiority and powerful simulation ability of the dl model with physical constraints which increases trust in data driven approaches on groundwater modellings keywords groundwater level predictions water balance mechanism deep learning catchment scale data availability data will be made available on request 1 introduction groundwater plays an important role in geophysical and hydrological simulation cuthbert et al 2019 li et al 2017 zipper et al 2018 two major focuses related to groundwater simulation are 1 exploring the essence of hydrological cycle and its potential influences on geophysical dynamic system such as climate change ma et al 2021a fan et al 2013 mohan et al 2018 and drought propagation ma et al 2021b sadeghfam et al 2018 zhou et al 2020 and 2 exploring rational strategies including management utilization and protection of groundwater resources under the impacts of human activities such as pumping zipper et al 2018 and pollutant transport ossai et al 2020 tian et al 2015 for groundwater related simulations seeking accurate prediction of groundwater level gwl is an inevitable task due to the deepening understanding about the essence of geophysical dynamic system many efforts have been devoted into process based hydrological models feng et al 2020 in general the successes of traditional groundwater related hydrological models relied heavily on detailed geological attributes and meteorological data more specifically referring to collected local hydrogeological information such as boundary conditions land covers and so on a catchment is divided into several hydrological units and water interaction between adjacent hydrological units is simulated numerically mohan et al 2018 furthermore strong mathematical derivation ability is required for establishing groundwater related models since the relevant governing equations are almost two or three dimensional partial differential equations pdes in general process based models are the most suitable simulation strategies for catchments where the knowledge of flow path geological characteristics and boundary conditions are vital and extensively clear sahoo et al 2017 despite there are many successful cases of applying traditional process based models to simulate gwl in specific regions it has been criticized as too complex parametric difficult and regional limited to use beven and cloke 2012 clark et al 2015a simone fatichi et al 2016 tran et al 2021 moreover it is still extremely difficult for process based models to perfectly describe the water flow with nonlinear interactions spatial heterogeneity and time lags in real groundwater systems clark et al 2015b with the continuous development of computer science and deep learning algorithms dlas data driven hydrological models seem to be reliable alternatives for traditional process based hydrological models in general the main data sources for hydrological modeling originate from observations surveys and lab experiments over years of systematic research chadalawada et al 2020 multiple variables sources and resolutions in space and time doom the complex and big data nature of hydrological data with the aiming of exploring extracting and simulating the information from the raw data different types of dlas emerged as times required among the dl strategies artificial neural networks anns and their optimized forms have become the mainstream methods for establishing data driven hydrological models during the past decades applications of data driven dl models have burgeoned in different fields of hydrology and their performances have been widely recognized reichstein et al 2019 for examples commonly recognized dlas for hydrological timeseries modeling such as streamflow and gwl forecasting include recurrent neural network rnn based models for instance long short term memory lstm feng et al 2020 gao et al 2020 kratzert et al 2019 jiang et al 2021 and gate recurrent unit gru cai et al 2021 zhang et al 2021 convolutional neural networks cnn jiang et al 2018 jiang et al 2019 genetic programming gp babovic 2009 babovic and keijzer 2002 chadalawada et al 2017 liu and shi 2019 chadalawada et al 2020 and etc admittedly benefited from the outstanding computational efficiency with diverse algorithm types dl models present excellent adaptability and versatility when serving as alternatives to traditional models comparing to the process based models dl models have advantages in terms of easy construction computing speed and data requirements reichstein et al 2019 however criticizes on dl models focus on the black box essence which means that dl models are more like computing tests without any physical meanings as a result dl models have not been psychologically accepted by hydrologists because such models cannot improve our understanding the essence of natural hydrogeological processes at present in recent years application of artificial intelligence methods on hydrological modeling has developed into a new and critical stage which integrating dlas with dynamic geophysical processes is expected to enhance the performance and generality of data driven models simultaneously frame et al 2022 jiang et al 2020 hoedt et al 2021 reichstein et al 2019 zhao et al 2019 recent studies have demonstrated two strategies of integrating physical constraints and dlas 1 using interpretation methods to demonstrate the prevalent dl architectures for gaining scientific insights for example jiang et al 2022 explored the flood inducing factors by analyzing inner works of the lstm models 2 embedding physical processes into dl models to improve their awareness to systematic dynamic processes among these research works one strategy is adding physical informed equations into loss functions of deep learning models raissi et al 2019 for example wang et al 2020 proposed a theory guided neural network tgnn which considered groundwater related factors including governing equations boundary conditions initial conditions engineering controls and expert experience as residual terms for loss function of the neural networks this type of strategy is mostly suitable for specific spatial problems as it could be considered as a powerful approximator for the pdes another strategy is adding physical constraints into the inner neural networks for forward propagation this type of strategy is majorly based on recurrent neural networks rnn for timeseries simulations for example kratzert et al 2019 optimized the lstm models with regional entity awareness for streamflow simulation zhao et al 2019 integrated penman monteith equations into ann models for simulation of evapotranspiration significantly niu et al 2019 demonstrated the relationship between the network architecture of rnn family and numerical method and theoretically supported the use of rnn to solve problems involving system dynamics jiang et al 2020 successfully embedded snowmelt process into dl models for streamflow simulations in general most previous studies only focused on streamflow related tasks applications of physically constrained dl models on the gwl simulation remains to be explored with the purpose of improving the performance of lumped dl model for gwl simulation at catchment scale with limited geological observations this study proposed a hybrid hydrological model with water balance as physical constraints and dla as cornerstone the embedding of water balance equations is theoretically supported by the algorithm of solving ordinary differential equations odes with rnn jiang et al 2020 the groundwater related water balance equations are summarized from gsflow model markstrom et al 2008 exp hydro model patil stieglitz 2014 and topmodel kirkby 1975 two prevalent dlas for timeseries simulations i e one dimensional convolutional neural network 1d cnn and gate recurrent unit gru are established for comparisons of simulating performance specifically the hybrid model consists of a self designed rnn model wb model with wrapped water balance equations and a prevalent dl model two layer 1d cnn model self designed parameters of water balance equations with physical meanings in wb model are determined during the iterative training process of dla which strengthens the model s understanding of physical process and hydrogeological characteristics of target catchments for hybrid model gwl simulated form wb model serves as an input for a 2 layer 1d cnn model to give the final output as a result enhanced simulation accuracy robust generalization ability and intelligence for inferring characteristics of catchments are expected from the proposed hybrid model overall this study demonstrates that the novel hybrid model can garner the gwl related physical knowledge in a catchment vision if integrated with physical constraints properly which makes the physical constrained dl model be more accurate interpretable feasible advanced and promising in terms of gwl simulations for cross region and less ungauged catchments 2 data and methods 2 1 study area and multisource data continental united states conus as shown in subplot a of fig 1 is divided into 18 major watersheds by u s geological survey https www usgs gov and each watershed contains either drainage area of a major river or the combined drainage area of several rivers experimental data collected in this study consist of two datasets from 10 major watersheds new england region 01 mid atlantic region 02 south atlantic gulf region 03 great lakes region 04 ohio region 05 tennessee region 06 upper mississippi region 07 lower mississippi region 08 missouri region 10 and arkansas white red region 11 the first dataset is from publicly available catchment attributes and meteorology for large sample studies camels which contains two types of data to describe a specific catchment with minimal human disturbance 1 seven types of basin averaged daily hydrometeorological timeseries data mostly recorded from 1980 to 2014 at hydrometeorological observation stations precipitation p surface downward solar radiation srad snow water equivalent swe maximum temperature t max minimum temperature t min near surface daily average vapor pressure v p and streamflow observations at catchment outlet sf and 2 six types of averaged catchment attributes i e topography and location climate indices hydrological signatures land cover characteristics soil characteristics and geological characteristics addor et al 2017 newman et al 2015 each catchment in the camels dataset is represented by a hydrological unique code huc the second dataset is the freely available daily gwl data corresponding to catchments in the camels dataset which was collected and compiled by u s geological survey in this study we selected the gwl data following three principles simultaneously first the selected groundwater wells must provide daily gwl data with 25 to 30 consecutive years between 1980 and 2014 lower limit of 25 years was set to ensure both enough monitoring wells that could meet the standard and a satisfying amount of data for the need of dl model meanwhile upper limit of 30 years was set to control the difference of data volume for dl model to ensure the simulation results were comparable second as shown in fig 1 gwl data must be collected from the monitoring wells closest to the streamflow observation stations from the same catchment this principle was set to make sure that the hydrological factors in the camels dataset were major driving forces of the gwl changes despite we recognized that the boundaries of groundwater and streamflow catchments are not always perfectly overlapped among the dataset we collected compared with the average catchment area of 812 km 2 we believed that the average distance of 20 km between groundwater monitoring wells and streamflow stations was small enough to ensure their potential interactions third since the camels dataset contained only catchments with minimal human impacts and human impacts were not considered in this study the groundwater data we collected should also avoid urban and agricultural areas with frequent human activities however most of the wells we collected in the western conus especially in california region presented obvious traces of human activities such as pumping the number of eligible wells in those regions is negligible as a result 91 catchments from 10 major watersheds located in the central eastern conus were used for this study fig 1 2 2 deep learning methods for hydrological timeseries simulation 2 2 1 gate recurrent unit a general concept of rnns refers to a class of anns with recurrent cells which works on the principle of storing the output of a particular layer and feeding it back to the input in order to predict the optimate output of the layer during the past decades a variety of rnn based dl models including gru and lstm were proposed following different strategies of designing the recurrent cell to better introduce gru model we will firstly introduce the basic model of rnn family i e simple rnn model as shown in fig 2 a a simple rnn rumelhart et al 1986 recurses in the evolution direction of the sequence and all nodes are connected in a chain the key point of a simple rnn model is the concept of hidden state s t which stores information from previous time steps and delivers the previous features to predict the output y t the specific algorithms are listed as follows 1 s t σ s u s x t w s s t 1 b s 2 y t σ y w y s t b y where σ is an activation function strategy u and w are weight matrices and b is a bias vector theoretically rnn can make use of all the information from former sequence which makes it a preferred strategy for timeseries analysis however due to the gradient vanishing and explosion problems a simple rnn would perform poorly when it comes to long sequence analysis because outputs are likely to be only determined by several former steps in order to solve these problems lstm was firstly brought up for language processing with three gating controllers and two hidden states hochreiter and schmidhuber 1997 to simplify the lstm structure gru neural networks as shown in fig 2 b were proposed by cho et al 2014 gru neural networks share a similar chain structure with that of a simple rnn but the internal operations inside the recurrent cell are optimized for long short term sequence simulation the core algorithm of gru is the two gate controller reset gate and update gate the reset gate determines how to combine the new input information with the previous memory which information will be stored or deleted and the update gate defines the amount of previous memory saved to the current state which data will be output from the current state computational workflow of gru can be summarized as follows 3 z t σ w z x t h t 1 b z 4 r t σ w r x t h t 1 b r 5 h t tanh w h x t u h r t h t 1 b h 6 h t 1 z t h t 1 z t h t where w and b are weight matrices and bias vectors z t and r t are update and rese gates activation vectors h t is potential update vector σ and tanh are sigmoid and hyperbolic tangent functions recently several studies have shown that gru presents similar if not better simulation performance with lstm but a better computational efficiency due to a reduction of structural complexity ayzel and heistermann 2021 gao et al 2020 therefore we applied gru networks as one scenario of gwl simulation as shown in fig 2 d referring to the modelling strategy introduced by cai et al 2021 we adopted two gru layers with a full connection layer and a dropout layer for the catchment scale gwl simulation 2 2 2 one dimensional convolutional neural network 1d cnn convolutional neural network was firstly proposed by lecun et al 1989 who integrated the back propagation algorithm and shared weights into convolutional neural layer normally the basic structure of cnn consists of input layer convolutional layer pooling layer full connection layer and output layer as shown in fig 2 c 1d cnn structure applied in this study adopts convolution layer and pooling layer alternately a convolution operation involves two steps 1 multiple learnable convolutional kernels also known as filters read the former layer such as input layer by sliding on sequence matrix and 2 the output features of the upper layer are convoluted with the convolution kernel that is the dot product operation is performed between the input term and the convolution kernel and then the results are sent to the activation function to obtain the output features the essence of convolutional layer is similar to rnn based dla which is extracting the most relevant features of input sequence for output sequence predicting comparing with a fully connected layer the 1d cnn layers do not require the manipulation of lags concatenation and decrease the memory resources allocated accordingly jiang et al 2020 comparing with the rnn based dl model the algorithm of 1d cnn is more concise which may make its simulation performance not be as good as that of rnn based model but its calculation speed will be much faster jiang et al 2020 to this point 1d cnn layers are chosen as one section of the hybrid model for efficient testing 2 2 3 dla for solving odes in general the simplest form of rnn based model is that the input vector sequence x 1 x 2 x t and output vector sequence y 1 y 2 y t should satisfy the following recursive relationship 7 y t f y t 1 x t t as shown in fig 2 state s t stores and propagates the information from last time step s t 1 which leads to the simplest rnn model is in fact a recursive computation model as follows 8 y t t a n h w 1 y t 1 w 2 x t b where w and b are weight matrices and bias vectors research concerned with dynamics and dynamical systems is usually closely related to the solution of odes jiang et al 2020 general odes have the following form 9 y t f y t t only a few odes can be solved analytically in most cases numerical method is regarded as the first choice for solving odes euler method is a basic numerical method for solving initial value problems of the first order odes butcher 2000 implicit euler method uses the first order backward difference quotient instead of differentiation that is 10 y y k y k 1 t k t k 1 y k y k 1 h where h is time step in this case the differential equation becomes an implicit difference equation 11 y k y k 1 h f t k y k y 0 y 0 in the k th iteration y k 1 and t k are known values y k is the unknown value to be obtained and f t k y k is a function of the unknown value y k to be solved normally y k can be solved by iterative solution of nonlinear equations such as newton s iterative method calculating the values of y 1 y 2 y 3 y 4 y n in turns and the discrete sequence is the numerical solution of the differential equation however comparing eq 7 with eq 11 it can be concluded that the euler solution of ode is theoretically a special case of rnn the forward propagation of rnn corresponds to the euler solution of ode meanwhile the backpropagation process of rnn for determining the parameters brings out the advantage of applying rnn to solve ode tan et al 2018 to be more specific in actual problems there is a type of problem called model inference which is based on the known experimental data the ultimate goal is to guess the model mechanism inference that this batch of data conforms to the approach to solve this type of problem is roughly divided into two steps the first step is to guess the form of the model and the second step is to determine the parameters of the model viana et al 2021 in our case assuming that this batch of data can be described by an ode whose form is already known what needs to be focused on is the estimation of the inner parameters from the perspective of rnn the process of parameter determination corresponds to how the propagation mechanism of rnn model is designed forward propagation is to solve ode rnn prediction process and backpropagation is to infer ode parameters naturally rnn training process an interesting fact is that inferencing ode parameters is a well studied subject but it is just one of the most basic applications of rnn model as shown in fig 3 general idea of inserting physical constrained odes into the general concept of rnn structure is to replace the step function of simple rnn model with differentiable physical constrained equations in our case the proposed wb model is designed to encode geosystem dynamics as a neural network architecture with rnn backend within the self designed rnn architecture the connections eq 1 and eq 2 between neurons in simple rnn structure inputs states and outputs are specified with the state space representation in an explicit discrete form of governing functions which in our case are the water balance equations specifically we replaced the algorithms and the activation functions for calculating the states s t in hidden layer and output y t by water balance odes with self designed state variables self designed flux variables and self learnable parameters see equations in fig 3 a and b respectively to make it clearer fig 3 c presents the structure and unfolded network schematic graph of the wb model layer unlike simple rnn model which possesses one state variable for each hidden layer wb model is equipped with five states variables s 0 s 1 s 4 for each of the so called hidden layer each state variable represents a specific groundwater related hydrological reservoir to calculate and update the state variables nine flux variables are introduced each flux variable represents a flow process flux variables are like the bridges connecting the state variables in order to make the flux variable accurate and meaningful 16 self learnable parameters θ p consisting of θ p f and θ p g with physical meanings are introduced each parameter is determined by the gradient descent algorithm wrapped in the ordinary rnn model relevant descriptions about the water balance equations self designed state variables self designed flux variables and self learnable parameters applied in this wb model are introduced in detail in subsection 2 3 in summary we redefined the step function of ordinary rnn to solve the target odes by introducing self designed state variables self designed flux variables and self learnable parameters with physical meanings 2 3 groundwater related water balance equations the essence principle for process based models is water balance a form of mass conservation law in terms of hydrological research herrmann et al 2016 with a generic equation as 12 ds dt i t o t where s is the water storage unit i t is the inflow to the unit at time t and o t is the outflow from the unit at time t traditional process based hydrological model usually divides the catchments into segments hydrological units and calculates the flow between adjacent segments based on water balance equations and hydrogeological characters of segments in addition to spatial and temporal resolutions existing process based hydrological models majorly differ in mathematical algorithm of i t and o t jiang et al 2020 in this subsection we summarized water balance equations related to gwl from different process based models including gsflow model markstrom et al 2008 exp hydro model patil stieglitz 2014 and topmodel kirkby 1975 these processes were integrated into dl by replacing the states and learnable parameters with water balance equations for rnn model we named the model and equations wrapped in the rnn model as wb model and related processes and equations are listed below 2 3 1 canopy interception as shown in fig 4 interception of precipitation by plant canopy is computed during a time step as a function of plant cover density and the storage available on the predominant plant cover type the variability of the camels dataset makes it possible to demonstrate the plant canopy interception process since the landcover related data is included dunkerley and booth 1999 precipitation that reaches the ground is calculated by the sum of throughfall and precipitation on the catchment not covered by plants canopy interception is closely related to the vegetation type and local climate condition tao et al 2020 trinh and chui 2013 in this subsection we set a reservoir s 0 for the storage change of canopy interception two critical learnable parameters the maximum capacity of canopy interception sc max and canopy interception coefficient related to plant type k c were introduced for physical rnn model since conus locates in the northern hemisphere we determined the seasons according to the averaged day length if the day length is longer than 0 5 we set a range with higher mean value of k c and sc max because vegetation flourishes in autumn and summer conversely if day length is shorter than 0 5 we set a range with smaller mean value of k c and sc max for winter and spring the equations leavesley et al 1983 can be summarized as 13 p int k c d c a 0 s 0 sc max 0 s 0 0 p max s 0 sc max 14 ds 0 d t p int 15 k c k cs sc max sc smax w h e n d a y l 0 5 k c k cw sc max sc wmax w h e n d a y l 0 5 where d c is vegetation coverage which reflects the spatial coverage of vegetation a is catchment area values of d c and a are from the camels dataset 2 3 2 snow melt snow melt process a critical factor for hydrological simulation especially in cold regions has been proven to be a key point for streamflow simulations with dl methods broxton et al 2019 inspired by the methods of wrapping exp hydro model patil and stieglitz 2014 into p rnn model jiang et al 2020 the snow melt process is implanted into the hybrid model as follows first the precipitation reaches the ground will be divided into snowfall p s and rainfall p r which is controlled by daily temperature t and threshold temperature of snowfall t min 16 p r p p int p s 0 w h e n t t min p s p p int p r 0 w h e n t t min then water from snow melt was calculated as 17 m min s 1 d f t t max i f s 1 0 a n d t t max 0 o t h e r w i s e where d f is thermal degree day factor t max is temperature threshold of snowmelt and s 1 was the snow reservoir which can be expressed as 18 d s 1 d t p s m 2 3 3 soil retention and groundwater flow describing the dynamic system of water movement in soil has always been a complex but critical object for groundwater simulation banwart et al 2019 cai et al 2021 indeed soil structure affects the all round local hydrological response fatichi et al 2020 what we focused on was the water distribution in soil that meets the catchment scale water balance requirements again this part is referred to the soil structures introduced in gsflow model specifically we only considered the downward vertical flow process between preferential reservoir capillary reservoir and gravity reservoir with the aim of meeting the catchment scale water balance 2 3 3 1 preferential reservoir when precipitation and snow melt reach the ground a fraction of infiltration is apportioned to the preferential flow reservoir to account for fast interflow through large openings in the soil zone near land surface while the rest of the water which is generated when the precipitation rate exceeds the infiltration rate of the soil that may not be saturated will be classified as hortonian flow horton 1933 eventually both hortonian flow and preferential flow contribute to the streamflow of catchment outlet referring to the topmodel and p rnn model water flow in the preferential flow bucket can be calculated as 19 q hor p r m 1 r in 20 q pref 0 s 2 0 p r m r in r pr e f s pmax s 2 q pmax s 2 s pmax 0 s 2 s pmax where r in is the infiltration rate r pr is the coefficient of fast interflow f is decay factor s 2 is preferential reservoir s pmax is the storage capacity of preferential bucket and q pmax is the maximum preferential flow the values of the parameters are learned during iterative process of self designed rnn model which can be expressed as 21 d s 2 d t p r m r i n r p r 2 3 3 2 capillary reservoir the capillary reservoir represents water held in the soil by capillary forces between the wilting and field capacity thresholds water is removed from the reservoir by evapotranspiration markstrom et al 2008 referred to the exp hydro model and p rnn model the pet potential evapotranspiration is estimated by hamon s formulation therefore the calculation can be concluded as follows 22 q cap p r m r in 1 r pr 23 ds 3 dt q cap e t 24 et 0 s 3 s cmin p e t s 3 s cmax p e t s 3 s cmax 0 s 3 s cmax 25 pet 29 8 l day 0 611 e 17 3 t t 237 3 t 237 3 where q cap is the waterflow into capillary reservoir s 3 is capillary reservoir s cmin and s cmax are the minimum and maximum storage capacities of capillary reservoir l day is day length and t is local temperature the main function of capillary reservoir is to calculate the amount of evapotranspiration the maximum storage capacity represents the field capacity and the minimum storage capacity represents the minimum storage capacity held by vegetation 2 3 3 3 gravity reservoir the gravity reservoir represents water in the soil zone between field capacity and saturation thresholds this reservoir was developed to provide gravity drainage from the soil zone to the unsaturated zone which will eventually discharge to the groundwater according to gsflow model slow interflow from the gravity reservoirs represents the perching of water in the soil zone above the water table that can occur because of mineralization near the bottom of the soil zone or when soil develops over fine grained material slow interflow can occur when the water content in the soil zone exceeds the field capacity threshold slow interflow is developed from continuity and an empirical equation leavesley et al 1983 for the lumped hydrological model we added a decay process for slow interflow referring to topmodel which can be written as 26 q slow 0 s 4 0 q gra k l q gra 2 k n q gmax s 4 s gmax e f s gmax s 4 0 s 4 s gmax 27 q gra q cap e t 28 ds 4 d t q slow where q gra is the water flows into gravity reservoir s 4 is gravity reservoir s gmax is maximum storage capacity of gravity reservoir k l is linear coefficient of slow interflow k n is non linear coefficient of slow interflow and q gmax is the maximum slow interflow finally the outputs of the water balance model are expressed as 29 q stream q hor q pref q slow 30 q gw q gra q slow where q stream is the water flowing into stream at catchment outlet and q gw is the proportion of water that flows into groundwater at the catchment scale to better illustrate the way of wrapping above equations into wb model we use snow melt process in subsection 2 3 2 as an example the precipitation that reaches the ground flux from canopy interception reservoir and temperature in input x t will be used for initial input for this section the snow reservoir firstly we set a temperature threshold t min ranging from 3 to 0 to determine whether precipitation reaching the ground is in form of rainfall or snow eq 16 secondly we set a temperature threshold t max ranging from 0 to 3 to determine when the snow starts to melt a thermal degree day factor d f ranging from 0 to 5 mm day was set to calculate the snow melt eq 17 the state variable s 1 t which represent the snow storage is updated by eq 18 as s 1 t s 1 t 1 p s t m t in this case t min t max and d f will be determined through the training process above process is inserted into the neural network by defining s 1 rainfall snow and melt with eq 16 to eq 18 further the flux out of snow reservoir s 1 which is the rainfall and snow melt will serve as the input for preferential reservoir in subsection 2 3 3 1 to further update s 2 and calculate other fluxes with similar process state variables will be updated in order from s 0 to s 4 indicating water flows from precipitation to groundwater as a result after updating the five states and nine flux variables the preliminary groundwater fluctuation would be calculated as eq 30 pseudocode of the ode rnn layer for gwl simulation is presented in table 1 overall the process based groundwater model involves three input daily variables from the camels dataset precipitation averaged temperature and day length five states variables s0 s1 s2 s3 and s4 nine flux variables p fall p s p r m q cap q pref q hor q gra a n d q slow and 16 learnable parameters which controls the hydrological behaviors sc max k c t min t max d f r in r pr s pmax q pmax f s cmax s min k l k n s gmax q gmax again the proposed wb model is a spatially lumped dl model with physical constrains which adheres strictly to the law of water balance 2 4 integrated hybrid framework for gwl simulation inspired by the outstanding work of p rnn integrated hybrid streamflow simulation model jiang et al 2020 and previous work of exploring the usage of dl model for large scale gwl simulation cai et al 2021 this study proposed a hydrology aware dl architecture for gwl simulation as presented in fig 5 there were two pipelines for the hybrid model the first pipeline was the water balance based rnn model wb model which wrapped catchments attributes and water balance equations into dla the forcing variables for this pipeline were precipitation day length and temperature the parameters within wb model were trained separately to present a preliminary gwl which was furtherly served as one of the input variables for the second pipeline the second pipeline was a sequence to sequence dl model which maps the meteorological sequences to gwl sequence the input variables of the second pipeline included the preliminary gwl simulated by wb model and the other six dynamic forcings provided by the camels dataset the objective of wb model was to identify geo hydrological information from observations of the external world and reorganize them in form of providing simulated preliminary gwl in other words wb model was used to facilitate the prevalent dl model the core function of wb model was to combine water balance equations and dl algorithm to capture the fluctuation characteristics of gwl that response to driven factors as a result the preliminary gwl simulated by wb model was served as an important input forcing to strengthen the training process of hybrid model considering the ability of handling lagged effect from hydrological signals feng et al 2020 and a faster computing speed than rnn based model jiang et al 2020 a two layer 1d cnn model was chosen as the main dla for simulating the gwl after a large number of preliminary experiments considering the trade off between increasing modelling accuracy and reducing the complexity of the model structure the first layer applied 8 kernel filters each with a length of 15 the length of 15 symbolized that the influence on the current hydrological response could be traced back to 15 days ago from a hydrological viewpoint tracing the influences on the current hydrological response back to 10 days ago is a common strategy in data driven hydrological models and has been proven to be successful for streamflow simulation with similar method jiang et al 2020 since our simulation target is gwl for phreatic aquifer the hydrological response time will be a little longer than that of streamflow simulation the set of 15 day hydrological response time was based on a large number of preliminary experiments nevertheless we cannot ensure that 15 day hydrological response time is the most accurate setting for each specific catchment however this setting is overall feasible for gwl simulations of these 91 catchments and is in line with common strategy in data driven hydrological models the second layer used 1 convolution kernel filter for analyzing the output of the first layer and providing the final results zero padding strategy was adopted for ensuring the output had the same sequence length as the input sequence after filtering by kernel filters the performance of the model was evaluated with nash sutcliffe coefficient of efficiency nse value nash and sutcliffe 1970 as follows 31 nse 1 i 1 n q s q o 2 i 1 n q o q o 2 where q s q o and q o are the simulated observed and mean observed gwl nse is widely used for model assessment which ranges from to 1 the closer nse is to 1 the better the simulation result is the nse value was also set as loss function for all the dl models in this study 80 of each timeseries was divided as training set while the rest 20 of the data was used as testing set the epochs number was set as 400 and the learning rate was 0 01 the number of parameters in hybrid model is 593 including 16 self designed parameters in wb model 568 parameters in first 1 d cnn layer and 9 parameters in the second 1 d cnn layer all the models and equations introduced in this study were coded with python 3 6 with keras as coding api and tensorflow 1 4 as the dl backend with no gpu requirement generation ability ga is an important evaluation criterion for data driven model chen et al 2020 it reflects the ability of dl model which is well trained to digest new data and make accurate predictions the calculation method is as follows 32 rmse 1 n i 1 n o s o o 2 33 ga rmse pred rmse train where o s and o o are the simulated and observed gwl rmse refers to root mean square error which measures the average magnitude of the error between model simulations and observations and ga is calculated as the ratio of the rmse values between predicting process and training process yoon et al 2011 if the data driven model simulates gwl perfectly the ga values will be unity otherwise if the model is over trained or overfitting the ga values will exceed unity in this case the model would not give accurate predictions even though it is able to provide accurate fittings for the training data the ga values will be less than unity if the model is under trained which is also called as underfitting 3 results and discussion 3 1 comparisons of gwl simulation results 3 1 1 comparisons of model performances in specific catchments as representatives of the 91 catchments three catchments huc 04216418 huc 03 015 500 and huc 03026500 were chosen for presenting describing and analyzing the simulations in detail fig 6 presented the gwl forecasting performances with four independent dl strategies from top to bottom of the subplots are hybrid model 1d cnn model wb model the self designed rnn model and gru model wb model integrated water balance constrains into rnn which served as a major optimization for hybrid dl model while the 1d cnn model and gru model are pure dl model consequently what concerned us the most was how much the simulation performance of hybrid model was improved compared with the 1d cnn model and gru model the reason why we chose these three catchments as representatives was that the simulation performances of the 91 catchments could be roughly divided into three categories which corresponded to the three catchments shown in fig 6 the simulation results of huc 04216418 represented the catchments that with an overall simulation improvement when combining water balance constrains into common dl models as shown in the first column of fig 6 the pure dl strategies 1d cnn nse 0 238 and gru nse 0 278 model had similar simulations effect while the hybrid model nse 0 553 outperformed significantly than the pure dl models such improvement was majorly benefit from the accuracy of simulating the gwl fluctuance pattern by the wb model nse 0 377 admittedly based on the evaluation criteria of hydrological model the performance of wb model itself were not satisfied enough for an alternative of traditional process based model however although there were certain differences in specific values the variation trend and fluctuation patterns of the simulation results were consistent with the observations as a result the preliminary result from wb model served as an important input forcing strengthened the training process of hybrid model which lead to a higher accuracy than pure dl models more specifically in plain language common dlas possessed the ability to filter out critical information that mostly related to the simulation target by adjusting the intrinsic parameters such as weights and bias in this case comparing to the other two representatives preliminary gwl simulated by wb model provided the most useful sequence for mapping the observations because the fluctuance pattern simulated by wb model was most similar to that of the observed gwl the second column of fig 6 huc 03015500 presented the representative of catchments with another type of simulation performance in general despite the nse improvements may not be as obvious as the catchments in the first category hybrid models nse 0 606 outperformed the pure dl models nse cnn 0 391 and nse gru 0 374 in these catchments for better simulating the gwl fluctuance under extreme conditions comparing to the first category the overall simulation performances of wb model in this category were slightly inferior which led to a less obvious promotions of nse values as the simulation of catchment huc 03015500 illustrated there was an obvious increasement of gwl during 2011 to 2012 which was resulted from a large amount of snow melting and rainfall as precipitation as shown in the 1d cnn model and gru model the pure dl models failed to capture such precipitation pattern because precipitation characteristics especially the extreme precipitation conditions had certain probability of being diluted in a variety of input variables during the training process dl model would consider the extreme precipitation events as outliers especially when the other inputs were sufficient to establish a good liner or nonlinear mapping relationship with the object this could be inferred from the fact that pure dl models had already presented good overall simulation performances under these circumstances wb model captured the pattern of extreme precipitation events when providing the preliminary gwl which emphasized the importance of the extreme points and reinforced the hybrid model to learn such patterns consequently the simulation results of hybrid model were intuitively improved because of better matchings of extreme gwl the last column of fig 6 huc 03026500 was presented as a representative of catchments with negative effects when integrating wb model intuitively preliminary gwl simulated by wb model failed to match the fluctuance of observed gwl nse 6 759 conversely the pure dl models showed satisfying simulation results nse cnn 0 626 and nse gru 0 686 the reduction of hybrid model performance nse 0 542 resulted from the failure of wb model specifically for catchment huc 03026500 the gwl simulated by hybrid model showed a larger fluctuation range than observed gwl which was consistent with simulation from wb model there were three potential reasons 1 the groundwater observation well and the corresponding streamflow observation station located in different drainage areas as mentioned in subsection 2 1 although the groundwater data we collected were from the observation well that was closest to the streamflow observation station at the catchment outlet we cannot guarantee that the gwl was driven by the precipitation from the streamflow catchment because the catchments of groundwater and surface flow might not be geographically coincident in this case the wb model driven by the precipitation from the camels dataset would inevitably lead to failed gwl simulation results because the fluctuation of gwl was driven by a different precipitation input 2 the water balance algorithm was not applicable for local gwl simulation the essences of the wb model and hybrid model were physical constrained dl models for lumped gwl simulation which meant the detailed geological information related to groundwater flux were not collected or considered in these models this would lead to simulation mismatches if discharge and recharge of local groundwater were not majorly from the precipitation but from other sources such as confined aquifer or lakes nearby in this case the wb model would not provide a rather precise simulation result even if the precipitation was one of the driven forces for the local groundwater fluctuance 3 the ranges of learnable parameters were not set properly this was also resulted from the lack of geophysical information to determine the range of self designed parameters especially the soil related parameters overall the influence from the third problem could be minimized by multiple tests while the first and second problems might be the most likely causes of the failures of wb model and hybrid model for gwl simulations in several catchments 3 1 2 comparisons of overall accuracy between hybrid model and pure dl models as shown in table 2 1d cnn gru and water balance constrained hybrid model were applied to simulate gwl of 91 catchments located in 10 major watersheds of the middle eastern conus more specifically the median nse values of the simulation results by using gru model was 0 313 while the average nse was 0 278 which was consistent with the nse range of former simulations in similar areas by applying gru algorithm cai et al 2021 as an advanced dla focused on timeseries simulation gru model served as a group of controlled experiments in this study for physical constrained hybrid model in the meanwhile the median nse value of simulation by using 1d cnn model was 0 297 and the average nse was 0 253 in views of the nse values the simulation performance of the two pure dl models were not much different but due to the complexity of model structure and the difference in emphasis of simulation gru model focuses on timeseries simulation and cnn model focuses on image processing the overall result of 1d cnn model simulation would be slightly inferior to that of gru model for gwl simulations benefited from the wb model the overall simulation performance was significantly better than that of 1d cnn and gru model the median nse was 0 408 and the average value was 0 401 the nse distribution was shown in fig 7 b since the final algorithm of hybrid model was a two layers 1d cnn model comparing to the pure 1d cnn model the preliminary gwl simulated by the wb model was the key factor for improving the performances of hybrid model with the aim of testing the adaptability of hybrid model we counted the number of catchments where the hybrid model outperformed the 1d cnn model for gwl simulation as shown in the last two columns of table 2 comparing with the 1d cnn model 71 out of 91 catchments presented simulation improvement when applying the hybrid model furthermore for the 10 major watersheds comparing to the 1d cnn model average nse improvements while using hybrid model were positive except for the new england and lower mississippi regions however the number of catchments used for experiments was so small that the average nse improvement would be seriously affected by a single catchment with a major failure of hybrid model moreover more than half of the catchments in new england and lower mississippi region presented positive improvement when using hybrid model than using 1d cnn model optimizing effect of hybrid model was more intuitively explained in fig 7 a and c distribution of catchments where hybrid model outperformed the 1d cnn model were shown in fig 7 d lumped hybrid dl model for streamflow simulation based on snow melting processes had been tested to be successful for catchments in high latitudes jiang et al 2020 in this study in addition to the snow melting process groundwater related soil water flow processes were also properly embedded into the wb model as a result the hybrid model outperformed the pure dl model not only in the snow domain areas but also basins in middle and low latitudes preliminary gwl simulated by wb model improved the noise tolerance of hybrid model to groundwater irrelevant input features and strengthens the learning ability of the hybrid model to gwl changes therefore comparing to the pure dl models hybrid model possessed better adaptability and understanding of different hydrometeorological and geophysical conditions with the constrains of water balance equations in conclusion comparing to prevalent pure dl models hybrid model exhibited significantly higher overall accuracy for gwl simulations 3 2 comparisons of model generalization ability the generalization ability was evaluated by eq 33 if the model focused on the training process rather than a general system the ga value would be higher this meant the model will have overfitting problems the higher the ga values were the weaker the generalization ability the model processed fig 8 presented the distributions of the ga values for the four dl models in form of boxplot the average ga values of hybrid wb model cnn and gru model were 1 269 1 124 1 431 and 1 396 respectively this indicated the developed hybrid model presented a better generalization ability than that of cnn and gru model and wb model presented the best overall generalization ability among the four dl models it should be noted that wb model was a group of ode equations coded with the language used in recurrent neural networks this meant that wb model was essentially a physic guiding model for wb model the water balance equations served as a backbone of training and predicting stages were universal theorems this was the main reason why wb model presented the best generalization ability furthermore the result was consistent with conclusions of the previous study which proved that physic based numerical models tended to present better generalization abilities than that of pure machine learning models chen et al 2020 in conclusion benefited from wb model hybrid model presented superiority than pure dl models in terms of generalization ability 3 3 robustness of the proposed model in general in addition to the advanced core algorithms an important factor affecting the effect of dl model was the amount of sample data as well as the potential relationship between input data and target data an excellent dl models should be equipped with the ability to ensure its own stability while satisfying the accurate simulation performance while reducing the effect from the interference information as much as possible su et al 2018 to demonstrate the reliability and stability of the proposed model we chose the catchment huc 03182500 for scenario tests we evaluated the gwl simulation results of hybrid model with six combinations of input features more input features signified a larger amount of input data which could be either useful information or noisy for simulations of targets in this study since the wb model needed three inputs precipitation temperature and day length for the self designed rnn model these three variables were the minimum input requirement as shown in fig 9 with the increasing number of input features nse values of the hybrid model also presented an increasing trend from 0 564 to 0 650 it was worth mentioning that although the nse values of the three inputs strategy was the smallest the value of nse 0 564 was a fine result for gwl simulations meanwhile in perspective of the nse values the difference of simulation performances between the six scenarios was relatively small which proved that the hybrid model processing a good stability furthermore it could be inferred that comparing to srad and vapor applying streamflow data as one of the input features could better improve the accuracy of the hybrid model which implied that the feature of an important hydrological phenomenon flow exchange between streamflow and groundwater through baseflow was captured from the perspective of hybrid dl model this reflected that dl models which had always been criticized as black box models without any physical meanings could also express some natural processed implicitly jiang et al 2022 fig 10 presented the comparisons of the stability of physical constrained hybrid model and 1d cnn model as representative of pure dl model through the nse values we adopted the data from catchment huc 03182500 for testing experiments to compare the performance of the model under same input feature strategies the result showed that hybrid model outperformed the pure dl model for every input strategy and the nse value of hybrid model presented a smaller fluctuation range from 0 564 to 0 651 than that of pure dl model from 0 417 to 0 517 which implied the hybrid model performed more stably than pure dl model the reason for this phenomenon was that the wb model in the hybrid model could adjust the values of the internal learnable parameters according to the regional characteristics so that the preliminarily simulated gwl could reach a certain accuracy then as an input the preliminarily simulated gwl could help the dl model better understand the change characteristics of the gwl to be simulated so that the performance the hybrid model was obviously better than that of the pure dl model in conclusion the physical constrained mechanism made the stability of the hybrid model better than the pure dl model which was another outstanding advantage in addition to the higher accuracy of the simulation results of the hybrid model 3 4 a rethink of relationships between simple rnn wb model and gru it is worth clarifying that simple rnn wb model and gru are based on a general concept of rnn which is a family of neural networks with recurrent cells in general simple rnn model does not possesses the long term memory ability because of the potential gradient vanishing and explosion problem when updating the hidden states during the training process the main difference between simple rnns and grus or lstms is the latter introduces a so called gating mechanism into the recurrent cell to control the information flow to address the gradient vanishing and explosion problem likewise in our wb model we also modified the recurrent cells of the general rnn models where the nodes were connected using physical equations rather than the usual perceptions more specifically gru introduces reset gate and update gate to determine whether the previous information involved in the cell states is added or discarded in comparison in the wb model the information flow is controlled using the thresholds as in hydrological models for example if the temperature is larger than a threshold the rainfall information will become a part of the soil state otherwise it will be added to the snow state further although the specific values of these parameters are determined during the training process of dl model the essence of the wb model is a group of ode equations presented by tomodel gsflow and other hydrological models coded with the language used in neural networks which makes the wb model naturally have long term memory in the form of hydrological states e g snowpack and preferential flow pack in conclusion the gru and wb model model have taken distinct ways to reform the recurrent cells of general rnn models which could be considered as two optimizing strategies of simple rnn model 3 5 limitations and potential improvements comparing with pure dl models the proposed hybrid model for cross region gwl simulations at catchment scale is significantly improved in terms of the accuracy generality robustness and physical meaning of models but there are some obvious limitations and potential improvements for the hybrid model the first limitation is that the process of adjusting self designed parameters could be cumbersome as introduced in former subsections there are 16 learnable parameters designed in the wb model that control the hydrological behaviors the ranges of these parameters need to be adjusted manually until the hybrid model produces the most accurate results for example the ranges of hydrometeorological parameters that introduced from former models jiang et al 2020 patil and stieglitz 2014 such as t min t max f etc were set for all catchments while other parameters especially the geological related and storage related parameters introduced in this study such as s pmax q pmax s cmax s min etc should be adjust for specific catchments to reach to best simulation performance consequently the parameters calibration process of hybrid model for some catchments could cost lots of time to achieve the best simulation results the second limitation is that due to the lack of detailed geographic information the lumped gwl model cannot be applicable to all basins supporting by the universality of water balance constrains and the powerful computing ability of dla our expectation of this hybrid model is that the model can simulate gwl at any point in the basin accurately if the hydrometeorological data is sufficient and the historical gwl observation is provided this is because we believe the hybrid model can perceive the geological information to give accurate gwl simulations by adjusting learnable parameters set of wb model however in this study the hybrid model failed to improve the simulation performances for 20 out of 91 catchments this is because the lack of detailed geographic information makes some groundwater recharge and discharge processes such as groundwater recharge from surrounding confined aquifers impossible to be reflected through single water balance constrains therefore the proposed hybrid model cannot be applied to the simulation of gwl in all catchments especially in those with complex groundwater recharge and discharge process this is also reflected in the simulation performance of wb model although wb model can simulate the fluctuation state of gwl most of the simulation results are not accurate and accurate simulation results are obtained by embedding the preliminary result into another dl structure the third limitation is the black box nature of proposed hybrid model remains unrevealed the main merit of adding water balance odes into the dl architecture lies in improving the awareness of hydrological knowledge of hybrid model by guiding wb model to capture the fluctuation patterns of gwl however adding physics is not enough to reduce the black box nature of dl model barredo arrieta et al 2020 despite we have successfully combined dl with physical constrains making the hybrid model present extremely powerful forecasting ability we have not found further interpretable physical meaning from the proposed hybrid model especially for the two layer 1d cnn model in the hybrid model which only provides the outstand non linear fitting ability the fitting process remains uninterpreted from hydrological perspective in this study the fourth limitation is that the two or three dimensional processes of groundwater flow are not considered in this study in general the study of groundwater simulations is always related with two or three dimensional groundwater flow with specific boundary conditions and governing equations moreover detailed groundwater simulation is usually focusing on find numerical or analytical solutions of two or three dimensional pdes related to groundwater by numerical method or analytical method liang et al 2018 the hybrid model we proposed is based on the combination of dla and vertical one dimensional water balance equation in catchment scale although it is a breakthrough to the traditional research methods it cannot describe the two and three dimensional groundwater flow processes which might make it not delicate or convincing enough from the perspective of traditional groundwater flow simulation community in other words we embedded physical constraints to improve the simulation performance of dl model but the physical constraints are not detailed enough compared with traditional methods more specifically although water balance constraints with 16 self learnable parameters are well implanted into wb model this number is far less than prevalent dl model such as 1d cnn model which in our case has 568 parameters in first 1d cnn layer and 9 parameters in the second 1d cnn layer parsimonious dl model does not ensure a learned model will capture all important information in the data sensed about the external world ma et al 2022 as a result lacking complexity is a main reason why wb model cannot outperform the gru model in terms of the accuracy of gwl simulation based on the limitations mentioned above we believe that this study has potential for further improvements firstly more detailed groundwater related processes such as human activities could be implanted into wb model the proposed hybrid model could be more flexible if multiple potential processes were wrapped into wb model for options in that case the hybrid model would decide which processes are suitable to be considered for specific catchments by adjusting the parameters and super parameters of wb model this would improve the adaptability of hybrid model greatly if the groundwater related processes could be considered comprehensively secondly cutting edge dl interpretive methods such as expected gradients eg erion et al 2021 could be applied to decipher the machine captured patterns and inner workings of the hybrid model the main purpose of such study will be revealing the black box process of the proposed hybrid model so that the hydrological cognition from the perspective of machine learning models under physical constraints could be obtained to facilitate our improving our understanding for specific hydrological processes thirdly the threshold mechanism of hydrological models in our wb model framework might be further improved by the idea of gating mechanism from gru or lstm model lastly to optimize the physical constrains from one dimensional odes to higher dimensional pdes the difficulty of groundwater simulation is much higher than that of surface water simulation because of its complex two and three dimensional flow characteristics wang et al 2021 limited by the lack of geophysical data the lumped hybrid model based on water balance mechanism has not maximized the power of integrating dlas and physical constrains therefore the combination of pdes governed distributed groundwater flow processes and dl model will be an important research direction in the future regardless the proposed hybrid model is already the most novel model in terms of predicting gwl with time series hydrometeorological inputs 4 conclusions in this study a lumped hybrid groundwater model with water balance equations as physical constraint and dl methods as core algorithm is proposed to simulate the fluctuation of gwl in the hybrid model water balance guided oeds were wrapped into a wb model by self designing the specific algorithms of rnn model we tested the model with the camels dataset from 91 catchments located in the middle eastern conus and two pure dl models 1d cnn and gru were established for comparison of simulation performance the main findings of this study are summarized as follows first the hybrid model presented high accuracy of simulating the fluctuation of gwl without using detailed hydrogeological information of the catchments the preliminary gwl simulated from the wb model enhances the learning ability of hybrid model consequently the physics constrained dl model outperformed the pure dl models significantly in 71 out of 91 catchments in this study moreover comparing with traditional distributed gwl simulation models dla reduces the cost of data as well as the difficulty of model setup while still provides accurate simulation results in perspective of traditional standards which makes the hybrid model more suitable for gwl predictions in less gauged or ungauged basins second the self designed rnn model with water balance constraints proposed in this study embeds the main groundwater related water balance formulas which are referred to the traditional distributed hydrological models into the recurrent neutral networks the specific values of the parameters in water balance related formula and water storages in designed reservoirs are determined by the hybrid model through iterative algorithms activation functions and loss functions of dlas consequently this equips our hybrid model with the ability to learn the groundwater related water allocation processes at the catchment scale in conclusion the physical constrained hybrid model presents better adaptability and generalization ability comparing with the pure dl models last compared with the pure dl model the hybrid dl model proposed has better robustness this is reflected from the fact that the hybrid models outperformed pure dl model with different strategies of input features more specifically the nse values of simulations from hybrid model have higher values and lower fluctuation range the reason is that the preliminary simulation results provided by the physically constrained wb model strengthen the learning ability of dla for groundwater fluctuation characteristics so that the hybrid model can be affected by potential noise data as little as possible this study shows the superiority and powerful simulation ability of dl model based on physical constraints we have abandoned the general idea of building traditional groundwater models solving two dimensional or three dimensional groundwater flow problems through the iterative method of distributed models or finding analytical solutions instead we embedded water balance equations into dla for regional gwl simulation as a result this hybrid model presented great accuracy adaptability generalization ability and robustness even without detailed geological data of catchments which demonstrated the possibility of application of proposed model for gwl simulation in ungauged or lack of gauged catchments although there are many limitations and potential improvements for the proposed model we believe that the general performance of the proposed model would increase trust in data driven approaches on hydrological modellings especially when physical constraints related to hydrological sciences are integrated with dlas credit authorship contribution statement hejiang cai conceptualization methodology validation software writing original draft writing review editing suning liu supervision writing review editing haiyun shi methodology conceptualization funding acquisition supervision writing review editing zhaoqiang zhou validation software shijie jiang validation writing review editing vladan babovic supervision writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this study was supported by the national natural science foundation of china 51909117 and natural science foundation of shenzhen jcyj20210324105014039 data availability and coding statement the groundwater level data are openly available at https waterdata usgs gov nwis gw and the camels dataset is freely available at https ncar ucar edu we gratefully acknowledge the use of the dataset publicly provided by addor et al 2017 and newman et al 2015 and the codes of p rnn model publicly provided by jiang et al 2020 
