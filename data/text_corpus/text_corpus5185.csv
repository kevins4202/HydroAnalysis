index,text
25925,integrated water system modeling is increasingly used to study the complex relationships between ecohydrological processes and the water related social economic systems however most of the traditional hydrological models are programmed in monolithic approach which makes the model improvements or couplings for integrated simulation inconvenient for the inexperienced modelers in this paper we develop an interface oriented add in modeling framework iamf to enable the water system models to be more reusable extensible and flexible the framework is designed using the interface oriented add in programming paradigm to provide a plug and play fashion meanwhile parallel computing is supported easily of the framework based on water system network we also develop a basic water system model consists of ecohydrological and water resources allocation regulation modules to show how to develop model components using the framework then the model is used to simulate the natural artificial water cycles in a case study irrigated area to evaluate its applicability as a modeling tool keywords interface oriented add in modeling framework water system model parallel computing water system network 1 introduction in the context of the impacts of intense human activities on water cycle it has been widely recognized that the natural hydrological processes are closely related to the social economic and ecological systems hydrological models are considered as an important and necessary tool for water and environment resource management gayathri et al 2015 however it is almost difficult to capture all the processes by a single model due to the complicated interactions among physical chemical and ecological components of terrestrial or aquatic ecosystems kindler 2000 paola et al 2006 to better understand the mechanism of the interactions and feedbacks between water cycle economy and ecosystem an integrated water system model which could describe the hydrological and the complex water related processes is needed the water system model is a kind of model that could be used to analyze the complex water related interactions between natural and human components and their feedbacks the main components are physical hydrological processes water related human activities and the water cycle related ecological processes so far many models have been developed to study the hydrological processes and the related processes since the past decades liang et al 1994 arnold et al 1998 ye et al 2010 however owing to the complexity of the integrated water system and the scale conflicts between different processes most existing models focus on one or two major water related processes zhang et al 2016 for example the macroscale hydrologic variable infiltration capacity vic model which is successfully used around the world mainly focuses on the water and energy balances but without the social economy component meanwhile some modules of the models are only applicable under a given set of circumstances for the simplified representation of real world the soil and water assessment tool swat model another useful model that could simulate more water related processes while some of the processes are simplified captured such as regulation rules of dam in regulated basins zhang et al 2013 when a single model cannot meet the needs of a modeling study modelers usually couple multiple models together to form a more holistic or accurate representation of a water system buahin and horsburgh 2018 yet many models have inconsistent time steps and they are often programmed in different languages such as fortran c c c and java which leads to more difficulties and even failures in the model coupling and more programming skills are required for modelers furthermore from the perspective of model application modelers often suffer that not all the calculation unit in the study region have the same complete dataset and not all the unit requires the same outputs a possible idea is proposing a flexible model framework that could satisfy the data available precision and application requirement at different subareas at present in order to make the programming more efficient the solid design pattern has been put forward including the single responsibility principle srp open closed principle ocp liskov substitution principle lsp interface segregation principle isp dependency inversion principle dip martin 2002 programming paradigm has been developed from procedural programming object oriented including interface oriented programming the interface oriented programming is developed according with the above principles and has been widely used in program design nowadays interface oriented component based software design pattern has been increasingly popular in software engineering and programming which makes the modules lower coupling and higher cohesion and the codes can be more reusable extensible maintainable and highly flexible so far in the field of water system modeling there are only a small number of models that based on interface oriented programming most of the models developed by hydrologists are still designed by the procedural programming paradigm programmed in monolithic approach where models are compiled into a single code especially the models written in early fortran language which limit the extensibility of the models some modelers have developed several component based modeling frameworks by interface oriented programming paradigm such as the dynamic integration architecture dias sydelko et al 1999 the object modeling system oms david et al 2002 the earth system modeling framework esmf hill et al 2004 the european open modeling interface and environment openmi moore and tindall 2005 community surface dynamics modeling system csdms peckham et al 2013 the component based modeling framework for agricultural water resources management comfarm kang et al 2016 among these existing frameworks the openmi standard is a software component interface definition originally conceived to facilitate the simulation of interacting processes and has been promoted in several studies especially for hydraulic numerical models buahin and horsburgh 2018 harpham et al 2019 the comfarm is a newly developed framework for watershed management planning allowing quick development of case oriented analysis tools and scenarios evaluation by contrast to the monolithic models these models could improve the flexibility in the selection of the best available modules fröhlich and franz 1999 szyperski 2002 nevertheless since the complexity of the real water system and the lack of generic framework for all the integrated water system modeling existing frameworks are still in progress it is still needed to develop new interface oriented component based frameworks by designing appropriate interfaces that could provide a useful tool for the modelers and users for their own studies kang et al 2016 in this study the main objective is to develop an interface oriented add in modeling framework iamf for the integrated water system modeling mainly considering the water cycle and the related social economy and ecosystems then a water system model mainly composed of distributed ecohydrological and water resources allocation modules is developed explicitly implement the framework and the model is used to simulate the natural and artificial water cycle in an irrigated area as a case study the paper is arranged as follows section 2 introduces the modeling framework and describes the details of the structure interfaces designed parallel computing support and the gis based graphical user interface a water system model implementing the framework is developed and the application is present in section 3 discussions and conclusions are made in section 4 and section 5 2 interface oriented add in modeling framework 2 1 iamf design the iamf is designed using the interface oriented add in programming paradigm to provide an effective way so that different model components can be removed and added to the simulator in a plug and play fashion in this study the modeling framework is developed with the visual studio ide using the c programming languages the schematic diagram of the simulator architecture is shown in fig 1 the core of the iamf is made up of a simulator and several processors for different modeling modules data is transferred between different processors components by a standard data exchange interface the simulator consists of six major architectural components water system network wsn processors manager model configurator model initializer results manager and database manager the wsn a typical network structure made up of several water system objects that represent the hydrologic features like catchments rivers reservoirs water users etc the processors manager manages all the processors that used to simulate the hydrological and water related processes for each of the hydrologic features in the wsn in order to realize the requirement of flexibility reusability extensibility the processors implement the interfaces iprocessor are loaded in the processors manager by the reflection mechanisms in the form of dynamic link library dll the dynamic loading mechanism is as following 1 the processors encapsulating the modules such as runoff model are packed into dynamic link library dll 2 using the reflection class supported in c net to read the dll to find assemblies and get the types defined in the processor from the modules 3 creating instances of the types such as the runoff class for runoff calculation 4 invoking the methods properties or static variables of the type for calculation the processors manager also defines the chosen and combination of the modules for the water system modeling within this approach modelers could develop processors involving more accurate sub modules for their own research purposes by implementing the iprocessor interface without modifying the host program the model configurator defines the modeling settings processor settings model input and results output settings etc the model initializer initializes the variables parameters properties of the simulation at each time step the results manager defines the simulation output variables and the formats the database manager allows the modeler read and write the database data exchange workflow between different components is rather important for the integrated simulation several different data exchange frameworks have been suggested in the previous study such as using the appdriver collins et al 2005 external file david et al 2013 pull based pipe gregersen 2007 in this study the data exchange workflow is based on the topological sorting of the wsn the water system modeling always follows the upstream to downstream i e the simulation in the upper stream node should be processed prior to the downstream node as a matter of fact the wsn is a kind of activity on vertex network aov which follows sequential constraint and then we can construct a task sequence by the topological sorting algorithm when a water system object is worked then the output will transfer to the object that request data from this object by the data exchange interface with this method the data can be exchanged memory based without an external data exchange workflow in addition we can also use the external file for data exchange when the old model packaged in executable file used in the framework 2 2 water system network the integrated water system model proposed in this study characterize the natural and artificial water cycle in the real world by simulating the water fluxes in canopy interception evapotranspiration runoff subsurface flow river routing reservoir regulation water intake for urban and rural domestic usages irrigation and other processes in different hydrologic features such as catchments reservoirs and irrigated areas these hydrological features can be represented using a water system network wsn composing of nodes and directed routes the wsn is the basic component that organize the simulated elements in a river basin in the wsn a node can indicate a physical component such as runoff aquifer river node including water intake and return flow node reservoir lake water user irrigated area etc a directed route can indicate river canal overland flow recharge diversion etc the wsn delineation follows three steps 1 watershed delineation the first step is to delineate watershed using the digital elevation model dem raster dataset for the reason that original dem showing a large number of sinks or depressions which are critical problems interrupting continuous flow therefore the original dem is filled firstly to remove the sinks then the flow direction matrix is calculated using d8 algorithm to define the flowing target cells and the flow accumulation map is calculated using the flow direction output after that the natural digital river network and watersheds can be obtained by a certain given threshold value 2 defining the topology relationship between water supply and demand node the water conservancy facilities such as reservoir pumping water intake are added in the natural river network as well as the water usage node such as power plant urban and rural domestic user industrial user and irrigated region then the linkage between the water sources and demand nodes are established via artificial canals the demand nodes are often defined by the unification of the subbasin and administrative divisions in three ways when the area of administrative divisions where water consumption occurs is much smaller than the subbasin or out of the subbasin the administrative division is represented as one water user node if the area of administrative divisions accounts for a certain proportion of the subbasin which often happens in irrigated areas the intersecting area of the administrative divisions and the subbasin are represented as an irrigated node in which runoff and water consumption are both calculated while in macroscopic water resources allocation researches the water use nodes can be defined by the intersection of subbasins and administrative divisions 3 adding virtual directed route it s necessary to define the computation sequences of the nodes after establishing the water system network the first way is to follow the hydraulic connections from upstream to downstream using the actual direct routes which representing rivers channels and pipes however we should also define the computation sequences of some vertexes without hydraulic relationships for example when a water source supplies several demand nodes or a demand node intakes water from different water sources the nodes with higher priorities should be computed prior to the other nodes in order to describe these computation sequences virtual direct route is defined between two supply nodes or demand nodes i e a virtual directed route is added from the node with higher priority to the node with lower priority 2 3 design of the simulator interfaces the main interface definition of the iamf is shown in fig 2 the basic interface definition is the isimulator interface this interface contains the computational engine and manages other model interfaces the iinputreader interface is applied to manage the current dataset including climate forcing boundary conditions initial status variables for driving models the iconfigurator interface is used to configure the simulator such as the calculating periods time step iterative computing network information etc the iinitializer interface is applied to read model inputs initialize the simulator configurate the processors etc the ioutputwriter interface allows the model users to control the model output the ilicensemanager interface ensure the model developers to protect the sub models the iprocessmanager interface is provided to manage the add in processors including create processors instance from the dll files registering processors in the simulator and sending processors for different hydrologic features simulation the iprocessor interface defines the core functions for hydrologic feature calculations including feature initialization status reset model execute data exchange and result report all the processors should implement the functions above the inetwork interface defines the node route water system network including the inode and iroute assembles representing hydrologic features all the hydrologic features should implement the inode or iroute interfaces the inetwork interface is also used to determine the topology relationship between the nodes and routes the inodewatervariable iroutewatervariable and iwaterqualityvariable interfaces included in the node and routes are used to store the common water fluxes variable which transfers from one hydrologic feature to another 2 4 parallel simulations support as the requirement of higher resolution simulation there will be much more hydrologic features in the water system network and it would need a great number of computations which is limited by the sequential computing parallel computing has been developed and become growing popular since the last decades as the development of computer hardware and software several parallel computing frameworks like message passing interface mpi open multi processing openmp compute unified device architecture cuda open computing language opencl has been developed for improving the development efficiency for model developers rauber and rünger 2010 the key point of parallel computing is to decompose a problem into several sub tasks which can be run at the same time so as to achieve the purpose of parallelism the water system modeling divides the river basin into many calculation units from the perspective of spatial parallelism the independent units can be assigned to multiple computing units for parallel computation that is to say the parallel computation can be carried out when there is no hydraulic connection among the units in contrast sequential computing is required when the downstream units depending on the upstream units in this study the parallel computing is easily supported based on the activity on vertex network aov which follows sequential constraint here an example is presented to illustrate the parallel computing fig 3 the water system network consists of nine nodes the node 0 1 and 2 have the same indegree indegree 0 the indegrees of node 3 4 and 5 are the same indegree 1 the indegree of node 6 and 7 is 2 and that is 3 for node 8 i e the nodes for example node 0 1 and 2 holding the same indegree have no hydraulic connections and the simulations for these nodes can be parallel conducted in programming the algorithm parallelization can be easily processed as follows firstly the water system network is topological sorted and then the nodes are grouped by the same indegrees after that the parallel simulations can be carried out within the same group until simulations in all the groups finished it should be mentioned that there will be congestion due to the competition for resources when two or more nodes transfer variables to the same node for example node 3 and node 4 transfer variables to node 6 at the same time to solve this problem we should use the lock function block of the c net during the variables transferring additionally the functions in the code block under the lock function should as little as possible so as to improve the efficiency of parallel computing in this easy example the pseudocode is as following image 1 where q represents the transferring variables q3 or q4 2 5 gis based graphical user interface so as to make the modeling easier we also develop a gis based graphical user interface gui to provide a visual environment for the model users to build their simulator the gui is a windows form application developed based on the c net using the visual studio ide the application is in the form of add in development with the menu and toolbars loaded dynamically the main interfaces including iapplication iaddin imenu itool icommand all the menus tools commands that need to load in the application should implicate the interfaces iaddin and imenu itool icommand respectively the metro ui is based on the dotnetbar for windows forms trial version the gis interface is currently built based on the open source dotspatial 1 9 details can be found at https github com dotspatial dotspatial as shown in fig 4 the basic version of the application provides tools for project management map navigation shapefile editor water system network delineation and model running besides professional users could develop their own tools implicating the interfaces and load them in the application the gui allows the users build their model in a user friendly manner by drag and drop operation based on the gis components i e users could add the water system modeling components by dragging and dropping them onto a gis based graphical palette the processors for each of the hydrologic features is binding with the component in the interface model users can initialize the simulator by setting the parameters and input data and then run the model using the gui to establish the water system network 1 the natural river network should be defined by dragging the dropping the river node tool and connecting the river nodes using river tool in the gis panel 2 adding the catchment nodes and jointing them with the river nodes using discharge tool 3 then adding the water conservancy facilities such as reservoir pumping as well as the water user node using the corresponding tools and link them via the channel tool 4 the water supply and intake priorities should be defined in the linking processes 3 development of a water system model and its application 3 1 general water system modeling processors as mentioned above in section 2 2 the hydrologic features are represented as water system objects in the network the simulations are conducted for each of the objects the design of the processors is according with the principle that there should be a one to one correspondence between the modeling component and the hydrologic feature in other words each hydrologic feature is simulated by a certain processor to realize the water system modeling several commonly used processors are introduced as shown in table 1 the basic processors are developed for the simulation of runoff evapotranspiration soil moisture baseflow routing vegetation dynamics including photosynthesis respiration plant growth in the terrestrial ecosystem water resources allocation reservoir regulation crop management including sowing harvest irrigation water consumption etc 3 2 model development for the purpose of illustrating how the water system modeling framework works a basic water system model called the water evaluation allocation and regulation model wear composed of ecohydrological processes and water resources allocation is developed in this study the basic water system model is developed to illustrate how to develop components from the legacy codes and develop new components for water system modeling the ecohydrological model component is developed using the distributed time variant gain model dtvgm xia et al 2005 while the water allocation component is developed in this study meanwhile some original components of the dtvgm are improved for better understanding the mechanism of the natural and artificial water cycles the dtvgm has been developed and applied to many basins in china wang et al 2009 li et al 2010 it is composed of many hydrological modules including runoff evapotranspiration flow routing and other modules zhan et al 2013 zeng et al 2020 the main functions of the model are shown in appendix a and more descriptions of the model can be found in xia et al 2005 the source code of dtvgm original version is written in c language in our study we develop the model by employ the legacy codes by recompiling the core function for the hydrological simulations in unmanaged dll and then invoked in the c net using the dllimport attribute taking the runoff processor component as an example which is shown in fig 5 a the catchment class inherit from the node class implementing the inode and icatchment interfaces is defined which contains different properties and variables reflecting the catchment characteristics and the conditions then the catchmentprocessor class implementing the iprocessor is defined with the methods by importing the unmanaged dll from the legacy c codes to do simulation works which could minimize the costs of developing models and maximize the use of existing codes the water allocation and regulation model a simulation based model is developed to solve the water allocation and reservoir regulation for integrated water resources planning and management by simulating the water supply of surface ground water to different social economic and environmental water demand in a river basin details of the main functions of the model is shown in appendix b in developing the water allocation model we develop the interfaces and class definitions directly in the framework using c net without invoke legacy codes for example the reservoir class is developed inherit from the node class implementing the ireservoir and inode interfaces fig 5 b the reservoir parameters and information are defined in the class besides the reservoir class implements the inodex interface defining the water allocation rules for water supply nodes the reservoirprocessor class is developed implementing the iprocessor for the reservoir regulation simulation directly written in c methods for different types of reservoirs attention only needs to be focused on the regulation algorithm that invoked by the reservoirprocessor the two models are coupled via the framework proposed in this paper firstly the ecohydrological processes including evapotranspiration runoff soil water movement etc are simulated in the catchment nodes then the water fluxes are transferred to the river nodes or reservoir nodes via the discharge routes and the overland routing is simulated the water demands are calculated in the water user nodes including the general domestic and industrial user and the irrigated area then the water resources from the sources including water intakes reservoirs groundwater are allocated to the users via water intake channels according to the water allocate and intake rules the non consumptive water is returned to the natural water bodies after the water use processes via the return channels it should be mentioned that the water resources allocation is related with the ecohydrological processes the first is that the agricultural water requirement is associate with the crop plant phenology and growth and the irrigation in the water resources allocation is according to agricultural water requirement and the water available of the water sources another is that the river ecological environmental water requirement supporting the river ecosystem is also considered in the water resources allocation by the reservoir regulation 3 3 study area in the following section the water system model is applied to simulate the natural artificial water cycle in an irrigated area the dongfengqu irrigation district dfq the dfq is located in the southeast of yichang hubei china which is adjacent to the huangbo river in the west and the yangtze river in the south the irrigated area is 643 km2 the main water source of the dfq is the shangjiahe reservoir sjh along with the huangbo river the huangbo river basin is a tributary of the left bank of the yangtze river in the middle reach it covers an area of 1923 km2 water is delivered from the sjh by the dongfeng canal and then combined with 10 medium sized reservoirs including guangzhuang gz baihe bh quanhe qh huoshankou hsk shanxichong sxc hujiafan hjf paoma pm lujianggang ljg shiziling szl guandaohe gdh and other local water sources which forms a complex irrigation system as shown in fig 6 the study region is in the subtropical monsoon climate zone with mild climate abundant rainfall which provides favorable conditions for agriculture the average annual precipitation is 1063 mm but unevenly distributed within a year precipitation in the wet season from may to september accounts for about 71 of the year the average temperature is 16 6 c and the maximum and minimum are 41 4 c and 15 6 c the average annual total sunshine hour wind speed and relative humidity are 1716 h 2 0 m s and 76 7 respectively the dfq is an important grain production area in yichang city the main crops planted in this region are rice wheat corn vegetable melons and fruits the cropping system is cole rice farming model which is a high efficiency farming mode that transplanting rice at the same cropland after cole reaped besides several reservoirs in the dfq are also the water sources for nearly 2 million residents in the yichang city urban area for domestic industrial and public living usages recently as the development of the socio economic and urbanization water usage for domestic industrial in the urban area continues growing which compress the water usage in the rural area and ecological water requirement 3 4 water system network delineation in order to build the water system model to simulate the natural artificial water cycles in the study area the first step is to establish the water system network wsn the srtm digital elevation model dem at 90 m resolution land use and land cover raster dataset at 1 km resolution provided by data center for resources and environmental sciences chinese academy of sciences resdc and harmonized world soil database are used to process watershed delineation the river basin and the irrigation area are divided into 50 sub basins and 158 hydrological response units by the dem land cover and soil type data then the irrigation system canals and the linkage between water sources and demand nodes are added to the river network which forms a water system network as shown in fig 7 the wsn in the study area contains 169 nodes and 180 routes the nodes consist of 50 catchment nodes 11 reservoirs 4 local reservoirs 21 irrigated subarea 4 urban area water users 12 rural area water users in the irrigation region and the left river nodes and water intake nodes the routes consist of 38 diversions 37 channels and the left river routes the watershed and river characteristics can be obtained by the watershed delineation process the reservoirs canals and irrigated area information are obtained from the yichang water resources bureau 3 5 simulation of the natural artificial water cycle the observed meteorological datasets including daily precipitation maximum and minimum temperature wind speed relative humidity and sunshine duration during 2006 2014 in 5 meteorological stations and 15 rainfall stations are used to drive the model streamflow data in the same period are applied to validate the model in addition the social economic datasets from the statistical yearbooks of yichang city are used to calculate the domestic industrial and agricultural water demands 3 5 1 model calibration and validation the model should be calibrated and validated to verify the simulation accuracy prior to the use of water allocation scenario analysis streamflow simulation which plays an important role in reflecting the model performance are validated at the reservoirs water supply nodes to evaluate the modeling results the nash sutcliffe efficiency coefficient nse nash and sutcliffe 1970 water balance error wbe in percentage between simulated and observed streamflow from 2006 to 2014 are selected as the model performance indicators the values of nse and wbe are between 0 and 1 0 the higher the values near to 1 0 the better the model performs the nse is defined as 1 n s e 1 i 1 n q o b s i q s i m i 2 i 1 n q o b s i q o b s 2 the wbe is defined as 2 w b e i 1 n q s i m i i 1 n q o b s i i 1 n q o b s i 100 where q obs i and q sim i are the observed and simulated streamflow respectively the first 6 years 2006 2011 are used to calibrate model and the left 3 years 2012 2014 are used to validate the model fig 8 shows the comparison of the observed and simulated streamflow in calibration and validation periods in the water source of the dfq shangjiahe reservoir sjh the nse wbe are 0 92 and 11 7 in the calibration period respectively and they are 0 91 and 12 2 in the validation period respectively from the simulation results the model could perform well in the study area 3 5 2 water allocation analysis under different scenarios in the planning horizon 3 5 2 1 water allocation scenarios in order to analyze the competition amongst the water usages in different sectors such as urban usage rural usage and river environmental water requirement and the water balance in the planning horizon year of 2030 six scenarios are developed considering different priorities for river environmental flow water demand in irrigation area and water usage of domestic and industrial in the urban area by discussing with the stakeholders as shown in table 2 3 5 2 2 water demand of different sectors in the planning horizon 2030 in this study river environmental water requirement is considered through the reservoir release the environmental flow is calculated by the combination of the tennant 7q10 and texas methods details see appendix b and then the environmental flows are taken into account in the reservoir regulation based on these methods the environmental water requirements downstream the 11 reservoirs are about 0 14 billion m3 demonstrated in table 3 social economic related water demand including domestic industrial and agricultural water demand are calculated in the 21 irrigated subarea and 16 urban and rural users according to appendix b the total social economic water demands in different sectors are 1 12 billion m3 and the domestic industrial water demand in the urban area and water demand in the irrigation area are 0 79 billion m3 and 0 33 billion m3 respectively and the water demand in different regions are shown in fig 9 3 5 2 3 water supply of the dfq analysis under different scenarios the water supply of the dfq water source under six different scenarios in the planning horizon is shown in table 4 results show that the water supply for social economic usage including urban and irrigation are higher under scenarios 1 2 and 3 without considering the river environmental water requirement and the river environmental water cannot be satisfied while the water supply for social economic usage are reduced when the river environmental water is considered with higher priority under scenarios 4 5 and 6 and the water guarantee is higher than 91 among the social economic water supply for urban and irrigation usages water will be allocated more if the priority of the water user is higher the average water supply in each month of the main water source sjh of the dfq is shown in fig 10 when the environmental flow is considered firstly the water release downstream of the sjh is much higher to match the water requirement in each month while the water release downstream is much lower when the environmental flow is not considered and the water release occurs only in the flood season for reservoir flood control since the main object of this study is to develop and test the model the more extensive discussions of the water allocation in the case study are not conducted in this paper 3 6 performance of parallel simulations the water system model is also parallelly executed on a personal computer with an intel xeon cpu e3 1505 m quad core processor 2 8 ghz cpu frequency a memory of 32 gb and windows 10 64 bit operating system to evaluate the performance of parallel simulations fig 11 shows the results of experiment comparing the relative speed up as the maximum number of parallel tasks increases the relative speed up increases as the number of parallel tasks increases while the increasing trend decreases and the maximum speed up get a value of 2 5 around the number of parallel tasks of 4 due to the quad core processor besides the other reason is that the parallelization is subject to the water system network structure generally the computational efficiency can be improved by the parallel simulation 4 discussion in our search of the literature related to the frameworks for hydrological and environmental modeling some frameworks such as the csdms openmi comfarm have been developed these frameworks have been successfully used for their development purposes for the complex of the water system the existing frameworks are still in progress in recent studies and it is still need to develop more flexible frameworks for different applications in our study the iamf is developed based on the interface oriented add ins programming within this framework different sub model components can be easily removed and added to the simulator in a plug and play fashion by dynamic link libraries dll sub model components also can be easily developed from the legacy codes from the perspective of the water system the framework developed in this study is different from the previous studies which mainly focus on the integrated simulation of hydrological processes and the related ecological social economic water allocation and consumption processes providing a fully coupled framework which could be used to study the whole natural artificial water cycle and the related processes the interactions between the natural and artificial water cycle especially for the water system control between natural and social water consumptions it s worth noting that the simulation based on the framework developed in this study relies on the activity on vertex network which makes the simulation for the hydrologic features should be sequential executed i e the hydrologic features in the upstream should be strictly calculated prior to the downstream this is generally feasible for the water system simulation at region or basin scale however the application of this framework for the hydrodynamics modeling are still need further development for the purpose of improving the computational efficiency the framework is also developed for parallel simulation support in this study the parallel computing is easily supported based on the water system network which represent the hydrologic features through different nodes and routes the objects can be parallel conducted when they have the same indegrees from the performance of the parallel simulations the relative speed up increases with the parallel tasks number increases but it will converge to certain value the main factors that influence the relative speed up are as follows 1 the first factor is hardware performance of the computer the speed up will increase with increase of the cpu frequency 2 the second factor is the structure of the water system network the critical path of the network as mentioned in the manuscript the water system network is a kind of activity on vertex network aov the parallel simulations are carried out in the same group with the same indegrees the division of the groups are mainly decided by the critical path of the aov that is to say the number of groups equals the length of the critical path the longer of the critical path the fewer of the nodes in the same group and the less of the model can be parallelized 3 the third factor is that the use degree of the cpu cores available the higher of the utilization of the cpus the more efficient of the calculation the use degree is determined both by the hardware and the distribution of the nodes in the divided different groups of the aov the more evenly distributed of the nodes in the groups the higher of the use degree of the cpus increasingly modelers embark on running their models using distributed computing techniques on hpc infrastructure the framework developed in our study decomposing the simulations into several calculation units makes it possible to run the model on hpc infrastructure and in the near future we will test the model on hpc to improve the computational efficiency as an example a water system model is developed containing several ecohydrological and water allocation and regulation processes implement the framework the runoff routing evapotranspiration modules of dtvgm and the water demand water allocation reservoir regulation modules are developed and modularized to simulate the ecohydrological and water allocation and regulation in an irrigated area besides the framework allows the modelers to construct customized sub models for their own purposes in the research which makes the models more flexible and extensible for the sake of making the model more useable we will develop more components including biogeochemical processes soil erosion water quality simulation etc we also would like to invite other researchers to develop additional modules in the future 5 conclusions in this study an interface oriented add in modeling framework iamf is developed for integrated water system modeling this framework allows the modelers to customize their own processor components in a plug and play fashion moreover the framework can be easily parallelized based on the water system network and it is effective in a way from the results of the performance of parallel simulations meanwhile a gis based graphical user interface is developed to provide a visual environment to make the modeling more accessible furthermore a basic water system model consists of ecohydrological processes and water resources allocation and regulation is developed to illustrate how to develop processor components and the model is applied in an irrigated area to validate the model generally the framework is feasible while it does not address the fully achieve of reusability in different kinds of models further development to improve the framework is still needed in our future works declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this study was supported by the strategic priority research program of the chinese academy of sciences grant no xda23040500 the national natural science foundation of china no 51809008 the fundamental research funds for the central universities south centtral university for nationalities czy18042 and hubei provincial natural science foundation of china 2018cfb123 appendix c supplementary data the following is the supplementary data to this article multimedia component 1 multimedia component 1 appendix c supplementary data supplementary data to this article can be found online at https doi org 10 1016 j envsoft 2020 104840 appendix a ecohydrological processes 1 runoff model in the recent version the runoff r consists of three components the surface runoff rs on the land surface the interflow runoff ri from the surface soil layer and the baseflow rg from the deep soil layer surface runoff is calculated by a nonlinear method as follows a 1 r s i g 1 a w u i w m g 2 p e i where g 1 and g 2 are the time variant gain coefficients g 1 is the runoff coefficient when the soil moisture is equal to the saturated soil moisture g 2 is the impact coefficient of the soil moisture p e is the effective rainfall arriving at the ground surface mm aw u is the average soil water content in the surface soil layer mm wm is the saturated soil water content mm the subscript i represent time step the interflow runoff is calculated with by a linear storage outflow relationship and the base flow is calculated by a groundwater runoff coefficient as follows a 2 r i i a w u i a w u i 1 2 k r a 3 r g i a w d i k r g where k r and k rg are the flow coefficient of the surface soil and deep soil layers aw d is the average soil water content in the deep soil layer mm 2 evapotranspiration model the evapotranspiration et a in the model is calculated by the reference evapotranspiration and the soil moisture stress the major equations for estimating the evapotranspiration are as follows a 4 e t p 0 408 δ r n g γ 900 t a 273 u 2 e s e a δ γ 1 0 34 u 2 a 5 e t a e t p 1 k a w k e t b a g r o v k a w a w w m where et p is daily reference evapotranspiration mm r n is the net radiation at crop surface mjm 2day 1 g is the soil heat flux density mjm 2day 1 t a is the mean daily temperature at 2 m height c u 2 is the wind speed at 2 m height ms 1 e s and e a is the saturation and actual vapor pressure kpa δ is the slope of vapor pressure kpa c 1 and γ is the psychrometer constant kpa c 1 kaw is the evapotranspiration parameter 3 routing model the river routing is calculated by the kinematic wave method with the assumption that the friction slope is equal to slope and the river flow is unsteady open channel gradual change flow the equation is as follows a 6 a t q x q where a is the cross section area m2 t is the time q is the water flow m3 s x is the flow path m and q is lateral flow m2 s 4 land surface ecological processes model the carbon cycles are mainly considered in the ecological processes including the plant photosynthesis respiration plant growth models and the carbon cycle in the soil and litter nine carbon pools consist of three plant pools leaf root and wood three litter pools structural metabolic and coarse woody and three soil organic pools microbial biomass slow and passive pools are included the daily photosynthesis is simulated based on chen et al 1999 and then the gross and net primary productivity are obtained and then allocated to leaf root and wood for the simulation of plant growth then the carbon is transferred from plant pools to litter pools and from litter pools to soil pools meanwhile carbon is also turnover among different pools in litter and soil pools individually the net photosynthesis rate can be derived by the following equations a 7 a min a c a j r d where a c and a j are the rubiso limited and light limited gross photosynthesis r d is the daytime leaf dark respiration the plant autotrophic respiration is separated into maintenance respiration r m and growth respiration r g a 8 r r m r g i r m i r g i where i is an index for different plant pools including leaf wood and root appendix b water resources allocation 1 social economic related water demand water demand analysis is a vital part of the water system modeling because it determines the economic value of the whole process george et al 2011 the water demand estimation is based on social economic and agricultural activities in this study the water demand estimation including the consumptive demand like urban and rural domestic industrial agricultural and the non consumptive demand like hydropower demand river environmental demand the urban and rural domestic water demand are estimated by the quota method based on the population and per capita water demand the population is predicted by the current population and the average population growth rate which can be obtained from the urban development planning the per capita water demand reflects the water conservation level of cities the industrial water demand is estimated based on the industrial gross domestic product gdp and the per gdp water demand the gdp prediction can be obtained from the national economic development planning b 1 w p o p 1 r p o p i p o p c u r r e n t q p o p b 2 w i n d 1 r i n d i g d p i n d c u r r e n t q i n d where w pop and w ind are the domestic and industrial water demand r pop and r ind are average growth rate pop current and gdp ind current are the current population and industrial gdp q pop and q ind are the per capita and per gdp water demand the agricultural water demand is calculated in each of the irrigated area according to the crop growth water requirement the climate and soil moisture conditions crop water requirement is estimated according to crop phenology and growth and then the irrigation water demand is calculated by the water balance of current soil water content for dryland or the water depth for paddy the effective precipitation and the crop water requirement the agricultural water demand in an irrigated area is summarized based on the crop patterns b 3 w i r r 0 p e w i e t c w min w max e t c p e w i p e w i e t c w min where w irr are the irrigation water demand et c p e w i are the crop water requirement effective precipitation soil water content or water depth w max and w min are the soil water content or water depth upper and lower threshold values which are suitable for crop growth 2 environmental flow demand there are several methods for calculating the ecological flow requirement such as hydrological methods hydraulic rating methods habitat simulation methods holistic methods karakoyun et al 2018 for the lack of the detailed cross section and other habitat data hydrological methods are the easiest and cheapest method using hydrological dataset in the classification of hydrological methods the tennant 1976 texas matthewsr 1991 and 7q10 singh and stall 1974 flow methods are the most common ones and have been widely used in the related studies including reservoir operation to fill the downstream ecological water requirement yin et al 2011 yan et al 2018 the environmental flow is calculated as the percentages of the annual mean streamflow based on the tennant method the values are often range from 10 to 40 the environmental flow based on 7q10 method is the annual minimum 7 day average streamflow with a 90 reliability the texas method considers the variations for different seasons and the environmental flow is the percentages of the streamflow with 50 reliability at each month to make the results of the ecological flow more reasonable and maximize the protection of the river ecosystem we use the above hydrological methods to calculate the ecological flow and the maximum values at each month are used in this study then the environmental flow requirement for a certain river node are prepared as input variables 3 water supply of different sources the water supply sources consist of surface water sources like reservoirs rivers ponds ground water sources and other sources like treated water reservoirs are the most important water supply source for their advantages of storing more water for the usage during the dry season in this study reservoirs are divided into two categories one is the online reservoir which is along with rivers the other one is the offline reservoir which is a local reservoir managed independently and drawing water from the rivers or online reservoir the water allocated by reservoirs based on the water availability and the water demand the key equation for reservoir is the water balance equation as follows b 4 v i 1 v i q r i n i δ t q r o u t i q a l l o c q l o s s δ t where v i and v i 1 is the reservoir volume at the time step i and i 1 q rin q rout q alloc q loss are the reservoir inflow outflow allocated water and water loss including evaporation and leakage for the lack of storage capacity the available water from river sources are mainly determined by the streamflow the water supply by river sources are calculated by the minimum of streamflow water demand and the flow capacity of pipes or channels water supply from groundwater sources depend on the water storage and the maximum flow of the pump station the water balance equation of groundwater is as following b 5 w i 1 w i q r e c h a g e i δ t q g i q a l l o c δ t where w i and w i 1 is the groundwater storage at the time step i and i 1 q recharge q g q alloc are the groundwater recharge baseflow and allocated water 4 priorities for water allocation in same with most of the simulation based water allocation models the water allocation in this study is based on mass balance and user defined priorities to allocate water resources in this model the priorities system consists of two subsystems used to determine the allocations from different water sources like reservoir groundwater river to different water demands like social economic related usage environmental flow requirement the competitive allocation from one supply source to different water user demand is according to the users priorities and significances that is to say the water users with higher priorities will be satisfied as fully as possible before lower priorities are considered additionally if two or more demands share the same priority different from the equal allocation in previous study the water allocation is according to their predefined significances range between 0 0 and 1 0 generally the domestic water use usually has the highest priority the priorities of the other water demand should be determined according the actual situations or local laws and regulations another priority system is used to simulate the water users preferences i e if a water user intake water from more than one water supply sources the intake priority determines that which source will be adopt firstly similarly if more than one sources share the same preference the withdraw water from different sources will be defined by a predefined ratios range between 0 0 and 1 0 the priorities usually follow the water resources management department meanwhile the priorities can be optimized in the water allocation researches within the supply and intake priorities system the model determines a water allocation sequence which is used to intake and allocate water in the water system 5 water supply rules of reservoirs the water supply operating rules of reservoirs are usually used to make the decision about the water supply for different water users water storage and water release which will directly affect the streamflow previous studies introduce several rules such as standard operation policy sop maass et al 1962 hedging rule hr tu et al 2003 space rule sr bower et al 1962 new york city rules nyc clark 1956 etc the sop rule is widely used in the reservoir operation while it will cause severe damage for water supply in the later period for the reason that it only considers the water demand in the current period hr rule is designed to for rationing water supply in appropriate preparation for potential low inflows in the near future you and cai 2008 which could avoid severe water deficit of a few periods in the dry season in this study a water supply limit factor is used to determine the water storage and the water supply at a certain period 
25925,integrated water system modeling is increasingly used to study the complex relationships between ecohydrological processes and the water related social economic systems however most of the traditional hydrological models are programmed in monolithic approach which makes the model improvements or couplings for integrated simulation inconvenient for the inexperienced modelers in this paper we develop an interface oriented add in modeling framework iamf to enable the water system models to be more reusable extensible and flexible the framework is designed using the interface oriented add in programming paradigm to provide a plug and play fashion meanwhile parallel computing is supported easily of the framework based on water system network we also develop a basic water system model consists of ecohydrological and water resources allocation regulation modules to show how to develop model components using the framework then the model is used to simulate the natural artificial water cycles in a case study irrigated area to evaluate its applicability as a modeling tool keywords interface oriented add in modeling framework water system model parallel computing water system network 1 introduction in the context of the impacts of intense human activities on water cycle it has been widely recognized that the natural hydrological processes are closely related to the social economic and ecological systems hydrological models are considered as an important and necessary tool for water and environment resource management gayathri et al 2015 however it is almost difficult to capture all the processes by a single model due to the complicated interactions among physical chemical and ecological components of terrestrial or aquatic ecosystems kindler 2000 paola et al 2006 to better understand the mechanism of the interactions and feedbacks between water cycle economy and ecosystem an integrated water system model which could describe the hydrological and the complex water related processes is needed the water system model is a kind of model that could be used to analyze the complex water related interactions between natural and human components and their feedbacks the main components are physical hydrological processes water related human activities and the water cycle related ecological processes so far many models have been developed to study the hydrological processes and the related processes since the past decades liang et al 1994 arnold et al 1998 ye et al 2010 however owing to the complexity of the integrated water system and the scale conflicts between different processes most existing models focus on one or two major water related processes zhang et al 2016 for example the macroscale hydrologic variable infiltration capacity vic model which is successfully used around the world mainly focuses on the water and energy balances but without the social economy component meanwhile some modules of the models are only applicable under a given set of circumstances for the simplified representation of real world the soil and water assessment tool swat model another useful model that could simulate more water related processes while some of the processes are simplified captured such as regulation rules of dam in regulated basins zhang et al 2013 when a single model cannot meet the needs of a modeling study modelers usually couple multiple models together to form a more holistic or accurate representation of a water system buahin and horsburgh 2018 yet many models have inconsistent time steps and they are often programmed in different languages such as fortran c c c and java which leads to more difficulties and even failures in the model coupling and more programming skills are required for modelers furthermore from the perspective of model application modelers often suffer that not all the calculation unit in the study region have the same complete dataset and not all the unit requires the same outputs a possible idea is proposing a flexible model framework that could satisfy the data available precision and application requirement at different subareas at present in order to make the programming more efficient the solid design pattern has been put forward including the single responsibility principle srp open closed principle ocp liskov substitution principle lsp interface segregation principle isp dependency inversion principle dip martin 2002 programming paradigm has been developed from procedural programming object oriented including interface oriented programming the interface oriented programming is developed according with the above principles and has been widely used in program design nowadays interface oriented component based software design pattern has been increasingly popular in software engineering and programming which makes the modules lower coupling and higher cohesion and the codes can be more reusable extensible maintainable and highly flexible so far in the field of water system modeling there are only a small number of models that based on interface oriented programming most of the models developed by hydrologists are still designed by the procedural programming paradigm programmed in monolithic approach where models are compiled into a single code especially the models written in early fortran language which limit the extensibility of the models some modelers have developed several component based modeling frameworks by interface oriented programming paradigm such as the dynamic integration architecture dias sydelko et al 1999 the object modeling system oms david et al 2002 the earth system modeling framework esmf hill et al 2004 the european open modeling interface and environment openmi moore and tindall 2005 community surface dynamics modeling system csdms peckham et al 2013 the component based modeling framework for agricultural water resources management comfarm kang et al 2016 among these existing frameworks the openmi standard is a software component interface definition originally conceived to facilitate the simulation of interacting processes and has been promoted in several studies especially for hydraulic numerical models buahin and horsburgh 2018 harpham et al 2019 the comfarm is a newly developed framework for watershed management planning allowing quick development of case oriented analysis tools and scenarios evaluation by contrast to the monolithic models these models could improve the flexibility in the selection of the best available modules fröhlich and franz 1999 szyperski 2002 nevertheless since the complexity of the real water system and the lack of generic framework for all the integrated water system modeling existing frameworks are still in progress it is still needed to develop new interface oriented component based frameworks by designing appropriate interfaces that could provide a useful tool for the modelers and users for their own studies kang et al 2016 in this study the main objective is to develop an interface oriented add in modeling framework iamf for the integrated water system modeling mainly considering the water cycle and the related social economy and ecosystems then a water system model mainly composed of distributed ecohydrological and water resources allocation modules is developed explicitly implement the framework and the model is used to simulate the natural and artificial water cycle in an irrigated area as a case study the paper is arranged as follows section 2 introduces the modeling framework and describes the details of the structure interfaces designed parallel computing support and the gis based graphical user interface a water system model implementing the framework is developed and the application is present in section 3 discussions and conclusions are made in section 4 and section 5 2 interface oriented add in modeling framework 2 1 iamf design the iamf is designed using the interface oriented add in programming paradigm to provide an effective way so that different model components can be removed and added to the simulator in a plug and play fashion in this study the modeling framework is developed with the visual studio ide using the c programming languages the schematic diagram of the simulator architecture is shown in fig 1 the core of the iamf is made up of a simulator and several processors for different modeling modules data is transferred between different processors components by a standard data exchange interface the simulator consists of six major architectural components water system network wsn processors manager model configurator model initializer results manager and database manager the wsn a typical network structure made up of several water system objects that represent the hydrologic features like catchments rivers reservoirs water users etc the processors manager manages all the processors that used to simulate the hydrological and water related processes for each of the hydrologic features in the wsn in order to realize the requirement of flexibility reusability extensibility the processors implement the interfaces iprocessor are loaded in the processors manager by the reflection mechanisms in the form of dynamic link library dll the dynamic loading mechanism is as following 1 the processors encapsulating the modules such as runoff model are packed into dynamic link library dll 2 using the reflection class supported in c net to read the dll to find assemblies and get the types defined in the processor from the modules 3 creating instances of the types such as the runoff class for runoff calculation 4 invoking the methods properties or static variables of the type for calculation the processors manager also defines the chosen and combination of the modules for the water system modeling within this approach modelers could develop processors involving more accurate sub modules for their own research purposes by implementing the iprocessor interface without modifying the host program the model configurator defines the modeling settings processor settings model input and results output settings etc the model initializer initializes the variables parameters properties of the simulation at each time step the results manager defines the simulation output variables and the formats the database manager allows the modeler read and write the database data exchange workflow between different components is rather important for the integrated simulation several different data exchange frameworks have been suggested in the previous study such as using the appdriver collins et al 2005 external file david et al 2013 pull based pipe gregersen 2007 in this study the data exchange workflow is based on the topological sorting of the wsn the water system modeling always follows the upstream to downstream i e the simulation in the upper stream node should be processed prior to the downstream node as a matter of fact the wsn is a kind of activity on vertex network aov which follows sequential constraint and then we can construct a task sequence by the topological sorting algorithm when a water system object is worked then the output will transfer to the object that request data from this object by the data exchange interface with this method the data can be exchanged memory based without an external data exchange workflow in addition we can also use the external file for data exchange when the old model packaged in executable file used in the framework 2 2 water system network the integrated water system model proposed in this study characterize the natural and artificial water cycle in the real world by simulating the water fluxes in canopy interception evapotranspiration runoff subsurface flow river routing reservoir regulation water intake for urban and rural domestic usages irrigation and other processes in different hydrologic features such as catchments reservoirs and irrigated areas these hydrological features can be represented using a water system network wsn composing of nodes and directed routes the wsn is the basic component that organize the simulated elements in a river basin in the wsn a node can indicate a physical component such as runoff aquifer river node including water intake and return flow node reservoir lake water user irrigated area etc a directed route can indicate river canal overland flow recharge diversion etc the wsn delineation follows three steps 1 watershed delineation the first step is to delineate watershed using the digital elevation model dem raster dataset for the reason that original dem showing a large number of sinks or depressions which are critical problems interrupting continuous flow therefore the original dem is filled firstly to remove the sinks then the flow direction matrix is calculated using d8 algorithm to define the flowing target cells and the flow accumulation map is calculated using the flow direction output after that the natural digital river network and watersheds can be obtained by a certain given threshold value 2 defining the topology relationship between water supply and demand node the water conservancy facilities such as reservoir pumping water intake are added in the natural river network as well as the water usage node such as power plant urban and rural domestic user industrial user and irrigated region then the linkage between the water sources and demand nodes are established via artificial canals the demand nodes are often defined by the unification of the subbasin and administrative divisions in three ways when the area of administrative divisions where water consumption occurs is much smaller than the subbasin or out of the subbasin the administrative division is represented as one water user node if the area of administrative divisions accounts for a certain proportion of the subbasin which often happens in irrigated areas the intersecting area of the administrative divisions and the subbasin are represented as an irrigated node in which runoff and water consumption are both calculated while in macroscopic water resources allocation researches the water use nodes can be defined by the intersection of subbasins and administrative divisions 3 adding virtual directed route it s necessary to define the computation sequences of the nodes after establishing the water system network the first way is to follow the hydraulic connections from upstream to downstream using the actual direct routes which representing rivers channels and pipes however we should also define the computation sequences of some vertexes without hydraulic relationships for example when a water source supplies several demand nodes or a demand node intakes water from different water sources the nodes with higher priorities should be computed prior to the other nodes in order to describe these computation sequences virtual direct route is defined between two supply nodes or demand nodes i e a virtual directed route is added from the node with higher priority to the node with lower priority 2 3 design of the simulator interfaces the main interface definition of the iamf is shown in fig 2 the basic interface definition is the isimulator interface this interface contains the computational engine and manages other model interfaces the iinputreader interface is applied to manage the current dataset including climate forcing boundary conditions initial status variables for driving models the iconfigurator interface is used to configure the simulator such as the calculating periods time step iterative computing network information etc the iinitializer interface is applied to read model inputs initialize the simulator configurate the processors etc the ioutputwriter interface allows the model users to control the model output the ilicensemanager interface ensure the model developers to protect the sub models the iprocessmanager interface is provided to manage the add in processors including create processors instance from the dll files registering processors in the simulator and sending processors for different hydrologic features simulation the iprocessor interface defines the core functions for hydrologic feature calculations including feature initialization status reset model execute data exchange and result report all the processors should implement the functions above the inetwork interface defines the node route water system network including the inode and iroute assembles representing hydrologic features all the hydrologic features should implement the inode or iroute interfaces the inetwork interface is also used to determine the topology relationship between the nodes and routes the inodewatervariable iroutewatervariable and iwaterqualityvariable interfaces included in the node and routes are used to store the common water fluxes variable which transfers from one hydrologic feature to another 2 4 parallel simulations support as the requirement of higher resolution simulation there will be much more hydrologic features in the water system network and it would need a great number of computations which is limited by the sequential computing parallel computing has been developed and become growing popular since the last decades as the development of computer hardware and software several parallel computing frameworks like message passing interface mpi open multi processing openmp compute unified device architecture cuda open computing language opencl has been developed for improving the development efficiency for model developers rauber and rünger 2010 the key point of parallel computing is to decompose a problem into several sub tasks which can be run at the same time so as to achieve the purpose of parallelism the water system modeling divides the river basin into many calculation units from the perspective of spatial parallelism the independent units can be assigned to multiple computing units for parallel computation that is to say the parallel computation can be carried out when there is no hydraulic connection among the units in contrast sequential computing is required when the downstream units depending on the upstream units in this study the parallel computing is easily supported based on the activity on vertex network aov which follows sequential constraint here an example is presented to illustrate the parallel computing fig 3 the water system network consists of nine nodes the node 0 1 and 2 have the same indegree indegree 0 the indegrees of node 3 4 and 5 are the same indegree 1 the indegree of node 6 and 7 is 2 and that is 3 for node 8 i e the nodes for example node 0 1 and 2 holding the same indegree have no hydraulic connections and the simulations for these nodes can be parallel conducted in programming the algorithm parallelization can be easily processed as follows firstly the water system network is topological sorted and then the nodes are grouped by the same indegrees after that the parallel simulations can be carried out within the same group until simulations in all the groups finished it should be mentioned that there will be congestion due to the competition for resources when two or more nodes transfer variables to the same node for example node 3 and node 4 transfer variables to node 6 at the same time to solve this problem we should use the lock function block of the c net during the variables transferring additionally the functions in the code block under the lock function should as little as possible so as to improve the efficiency of parallel computing in this easy example the pseudocode is as following image 1 where q represents the transferring variables q3 or q4 2 5 gis based graphical user interface so as to make the modeling easier we also develop a gis based graphical user interface gui to provide a visual environment for the model users to build their simulator the gui is a windows form application developed based on the c net using the visual studio ide the application is in the form of add in development with the menu and toolbars loaded dynamically the main interfaces including iapplication iaddin imenu itool icommand all the menus tools commands that need to load in the application should implicate the interfaces iaddin and imenu itool icommand respectively the metro ui is based on the dotnetbar for windows forms trial version the gis interface is currently built based on the open source dotspatial 1 9 details can be found at https github com dotspatial dotspatial as shown in fig 4 the basic version of the application provides tools for project management map navigation shapefile editor water system network delineation and model running besides professional users could develop their own tools implicating the interfaces and load them in the application the gui allows the users build their model in a user friendly manner by drag and drop operation based on the gis components i e users could add the water system modeling components by dragging and dropping them onto a gis based graphical palette the processors for each of the hydrologic features is binding with the component in the interface model users can initialize the simulator by setting the parameters and input data and then run the model using the gui to establish the water system network 1 the natural river network should be defined by dragging the dropping the river node tool and connecting the river nodes using river tool in the gis panel 2 adding the catchment nodes and jointing them with the river nodes using discharge tool 3 then adding the water conservancy facilities such as reservoir pumping as well as the water user node using the corresponding tools and link them via the channel tool 4 the water supply and intake priorities should be defined in the linking processes 3 development of a water system model and its application 3 1 general water system modeling processors as mentioned above in section 2 2 the hydrologic features are represented as water system objects in the network the simulations are conducted for each of the objects the design of the processors is according with the principle that there should be a one to one correspondence between the modeling component and the hydrologic feature in other words each hydrologic feature is simulated by a certain processor to realize the water system modeling several commonly used processors are introduced as shown in table 1 the basic processors are developed for the simulation of runoff evapotranspiration soil moisture baseflow routing vegetation dynamics including photosynthesis respiration plant growth in the terrestrial ecosystem water resources allocation reservoir regulation crop management including sowing harvest irrigation water consumption etc 3 2 model development for the purpose of illustrating how the water system modeling framework works a basic water system model called the water evaluation allocation and regulation model wear composed of ecohydrological processes and water resources allocation is developed in this study the basic water system model is developed to illustrate how to develop components from the legacy codes and develop new components for water system modeling the ecohydrological model component is developed using the distributed time variant gain model dtvgm xia et al 2005 while the water allocation component is developed in this study meanwhile some original components of the dtvgm are improved for better understanding the mechanism of the natural and artificial water cycles the dtvgm has been developed and applied to many basins in china wang et al 2009 li et al 2010 it is composed of many hydrological modules including runoff evapotranspiration flow routing and other modules zhan et al 2013 zeng et al 2020 the main functions of the model are shown in appendix a and more descriptions of the model can be found in xia et al 2005 the source code of dtvgm original version is written in c language in our study we develop the model by employ the legacy codes by recompiling the core function for the hydrological simulations in unmanaged dll and then invoked in the c net using the dllimport attribute taking the runoff processor component as an example which is shown in fig 5 a the catchment class inherit from the node class implementing the inode and icatchment interfaces is defined which contains different properties and variables reflecting the catchment characteristics and the conditions then the catchmentprocessor class implementing the iprocessor is defined with the methods by importing the unmanaged dll from the legacy c codes to do simulation works which could minimize the costs of developing models and maximize the use of existing codes the water allocation and regulation model a simulation based model is developed to solve the water allocation and reservoir regulation for integrated water resources planning and management by simulating the water supply of surface ground water to different social economic and environmental water demand in a river basin details of the main functions of the model is shown in appendix b in developing the water allocation model we develop the interfaces and class definitions directly in the framework using c net without invoke legacy codes for example the reservoir class is developed inherit from the node class implementing the ireservoir and inode interfaces fig 5 b the reservoir parameters and information are defined in the class besides the reservoir class implements the inodex interface defining the water allocation rules for water supply nodes the reservoirprocessor class is developed implementing the iprocessor for the reservoir regulation simulation directly written in c methods for different types of reservoirs attention only needs to be focused on the regulation algorithm that invoked by the reservoirprocessor the two models are coupled via the framework proposed in this paper firstly the ecohydrological processes including evapotranspiration runoff soil water movement etc are simulated in the catchment nodes then the water fluxes are transferred to the river nodes or reservoir nodes via the discharge routes and the overland routing is simulated the water demands are calculated in the water user nodes including the general domestic and industrial user and the irrigated area then the water resources from the sources including water intakes reservoirs groundwater are allocated to the users via water intake channels according to the water allocate and intake rules the non consumptive water is returned to the natural water bodies after the water use processes via the return channels it should be mentioned that the water resources allocation is related with the ecohydrological processes the first is that the agricultural water requirement is associate with the crop plant phenology and growth and the irrigation in the water resources allocation is according to agricultural water requirement and the water available of the water sources another is that the river ecological environmental water requirement supporting the river ecosystem is also considered in the water resources allocation by the reservoir regulation 3 3 study area in the following section the water system model is applied to simulate the natural artificial water cycle in an irrigated area the dongfengqu irrigation district dfq the dfq is located in the southeast of yichang hubei china which is adjacent to the huangbo river in the west and the yangtze river in the south the irrigated area is 643 km2 the main water source of the dfq is the shangjiahe reservoir sjh along with the huangbo river the huangbo river basin is a tributary of the left bank of the yangtze river in the middle reach it covers an area of 1923 km2 water is delivered from the sjh by the dongfeng canal and then combined with 10 medium sized reservoirs including guangzhuang gz baihe bh quanhe qh huoshankou hsk shanxichong sxc hujiafan hjf paoma pm lujianggang ljg shiziling szl guandaohe gdh and other local water sources which forms a complex irrigation system as shown in fig 6 the study region is in the subtropical monsoon climate zone with mild climate abundant rainfall which provides favorable conditions for agriculture the average annual precipitation is 1063 mm but unevenly distributed within a year precipitation in the wet season from may to september accounts for about 71 of the year the average temperature is 16 6 c and the maximum and minimum are 41 4 c and 15 6 c the average annual total sunshine hour wind speed and relative humidity are 1716 h 2 0 m s and 76 7 respectively the dfq is an important grain production area in yichang city the main crops planted in this region are rice wheat corn vegetable melons and fruits the cropping system is cole rice farming model which is a high efficiency farming mode that transplanting rice at the same cropland after cole reaped besides several reservoirs in the dfq are also the water sources for nearly 2 million residents in the yichang city urban area for domestic industrial and public living usages recently as the development of the socio economic and urbanization water usage for domestic industrial in the urban area continues growing which compress the water usage in the rural area and ecological water requirement 3 4 water system network delineation in order to build the water system model to simulate the natural artificial water cycles in the study area the first step is to establish the water system network wsn the srtm digital elevation model dem at 90 m resolution land use and land cover raster dataset at 1 km resolution provided by data center for resources and environmental sciences chinese academy of sciences resdc and harmonized world soil database are used to process watershed delineation the river basin and the irrigation area are divided into 50 sub basins and 158 hydrological response units by the dem land cover and soil type data then the irrigation system canals and the linkage between water sources and demand nodes are added to the river network which forms a water system network as shown in fig 7 the wsn in the study area contains 169 nodes and 180 routes the nodes consist of 50 catchment nodes 11 reservoirs 4 local reservoirs 21 irrigated subarea 4 urban area water users 12 rural area water users in the irrigation region and the left river nodes and water intake nodes the routes consist of 38 diversions 37 channels and the left river routes the watershed and river characteristics can be obtained by the watershed delineation process the reservoirs canals and irrigated area information are obtained from the yichang water resources bureau 3 5 simulation of the natural artificial water cycle the observed meteorological datasets including daily precipitation maximum and minimum temperature wind speed relative humidity and sunshine duration during 2006 2014 in 5 meteorological stations and 15 rainfall stations are used to drive the model streamflow data in the same period are applied to validate the model in addition the social economic datasets from the statistical yearbooks of yichang city are used to calculate the domestic industrial and agricultural water demands 3 5 1 model calibration and validation the model should be calibrated and validated to verify the simulation accuracy prior to the use of water allocation scenario analysis streamflow simulation which plays an important role in reflecting the model performance are validated at the reservoirs water supply nodes to evaluate the modeling results the nash sutcliffe efficiency coefficient nse nash and sutcliffe 1970 water balance error wbe in percentage between simulated and observed streamflow from 2006 to 2014 are selected as the model performance indicators the values of nse and wbe are between 0 and 1 0 the higher the values near to 1 0 the better the model performs the nse is defined as 1 n s e 1 i 1 n q o b s i q s i m i 2 i 1 n q o b s i q o b s 2 the wbe is defined as 2 w b e i 1 n q s i m i i 1 n q o b s i i 1 n q o b s i 100 where q obs i and q sim i are the observed and simulated streamflow respectively the first 6 years 2006 2011 are used to calibrate model and the left 3 years 2012 2014 are used to validate the model fig 8 shows the comparison of the observed and simulated streamflow in calibration and validation periods in the water source of the dfq shangjiahe reservoir sjh the nse wbe are 0 92 and 11 7 in the calibration period respectively and they are 0 91 and 12 2 in the validation period respectively from the simulation results the model could perform well in the study area 3 5 2 water allocation analysis under different scenarios in the planning horizon 3 5 2 1 water allocation scenarios in order to analyze the competition amongst the water usages in different sectors such as urban usage rural usage and river environmental water requirement and the water balance in the planning horizon year of 2030 six scenarios are developed considering different priorities for river environmental flow water demand in irrigation area and water usage of domestic and industrial in the urban area by discussing with the stakeholders as shown in table 2 3 5 2 2 water demand of different sectors in the planning horizon 2030 in this study river environmental water requirement is considered through the reservoir release the environmental flow is calculated by the combination of the tennant 7q10 and texas methods details see appendix b and then the environmental flows are taken into account in the reservoir regulation based on these methods the environmental water requirements downstream the 11 reservoirs are about 0 14 billion m3 demonstrated in table 3 social economic related water demand including domestic industrial and agricultural water demand are calculated in the 21 irrigated subarea and 16 urban and rural users according to appendix b the total social economic water demands in different sectors are 1 12 billion m3 and the domestic industrial water demand in the urban area and water demand in the irrigation area are 0 79 billion m3 and 0 33 billion m3 respectively and the water demand in different regions are shown in fig 9 3 5 2 3 water supply of the dfq analysis under different scenarios the water supply of the dfq water source under six different scenarios in the planning horizon is shown in table 4 results show that the water supply for social economic usage including urban and irrigation are higher under scenarios 1 2 and 3 without considering the river environmental water requirement and the river environmental water cannot be satisfied while the water supply for social economic usage are reduced when the river environmental water is considered with higher priority under scenarios 4 5 and 6 and the water guarantee is higher than 91 among the social economic water supply for urban and irrigation usages water will be allocated more if the priority of the water user is higher the average water supply in each month of the main water source sjh of the dfq is shown in fig 10 when the environmental flow is considered firstly the water release downstream of the sjh is much higher to match the water requirement in each month while the water release downstream is much lower when the environmental flow is not considered and the water release occurs only in the flood season for reservoir flood control since the main object of this study is to develop and test the model the more extensive discussions of the water allocation in the case study are not conducted in this paper 3 6 performance of parallel simulations the water system model is also parallelly executed on a personal computer with an intel xeon cpu e3 1505 m quad core processor 2 8 ghz cpu frequency a memory of 32 gb and windows 10 64 bit operating system to evaluate the performance of parallel simulations fig 11 shows the results of experiment comparing the relative speed up as the maximum number of parallel tasks increases the relative speed up increases as the number of parallel tasks increases while the increasing trend decreases and the maximum speed up get a value of 2 5 around the number of parallel tasks of 4 due to the quad core processor besides the other reason is that the parallelization is subject to the water system network structure generally the computational efficiency can be improved by the parallel simulation 4 discussion in our search of the literature related to the frameworks for hydrological and environmental modeling some frameworks such as the csdms openmi comfarm have been developed these frameworks have been successfully used for their development purposes for the complex of the water system the existing frameworks are still in progress in recent studies and it is still need to develop more flexible frameworks for different applications in our study the iamf is developed based on the interface oriented add ins programming within this framework different sub model components can be easily removed and added to the simulator in a plug and play fashion by dynamic link libraries dll sub model components also can be easily developed from the legacy codes from the perspective of the water system the framework developed in this study is different from the previous studies which mainly focus on the integrated simulation of hydrological processes and the related ecological social economic water allocation and consumption processes providing a fully coupled framework which could be used to study the whole natural artificial water cycle and the related processes the interactions between the natural and artificial water cycle especially for the water system control between natural and social water consumptions it s worth noting that the simulation based on the framework developed in this study relies on the activity on vertex network which makes the simulation for the hydrologic features should be sequential executed i e the hydrologic features in the upstream should be strictly calculated prior to the downstream this is generally feasible for the water system simulation at region or basin scale however the application of this framework for the hydrodynamics modeling are still need further development for the purpose of improving the computational efficiency the framework is also developed for parallel simulation support in this study the parallel computing is easily supported based on the water system network which represent the hydrologic features through different nodes and routes the objects can be parallel conducted when they have the same indegrees from the performance of the parallel simulations the relative speed up increases with the parallel tasks number increases but it will converge to certain value the main factors that influence the relative speed up are as follows 1 the first factor is hardware performance of the computer the speed up will increase with increase of the cpu frequency 2 the second factor is the structure of the water system network the critical path of the network as mentioned in the manuscript the water system network is a kind of activity on vertex network aov the parallel simulations are carried out in the same group with the same indegrees the division of the groups are mainly decided by the critical path of the aov that is to say the number of groups equals the length of the critical path the longer of the critical path the fewer of the nodes in the same group and the less of the model can be parallelized 3 the third factor is that the use degree of the cpu cores available the higher of the utilization of the cpus the more efficient of the calculation the use degree is determined both by the hardware and the distribution of the nodes in the divided different groups of the aov the more evenly distributed of the nodes in the groups the higher of the use degree of the cpus increasingly modelers embark on running their models using distributed computing techniques on hpc infrastructure the framework developed in our study decomposing the simulations into several calculation units makes it possible to run the model on hpc infrastructure and in the near future we will test the model on hpc to improve the computational efficiency as an example a water system model is developed containing several ecohydrological and water allocation and regulation processes implement the framework the runoff routing evapotranspiration modules of dtvgm and the water demand water allocation reservoir regulation modules are developed and modularized to simulate the ecohydrological and water allocation and regulation in an irrigated area besides the framework allows the modelers to construct customized sub models for their own purposes in the research which makes the models more flexible and extensible for the sake of making the model more useable we will develop more components including biogeochemical processes soil erosion water quality simulation etc we also would like to invite other researchers to develop additional modules in the future 5 conclusions in this study an interface oriented add in modeling framework iamf is developed for integrated water system modeling this framework allows the modelers to customize their own processor components in a plug and play fashion moreover the framework can be easily parallelized based on the water system network and it is effective in a way from the results of the performance of parallel simulations meanwhile a gis based graphical user interface is developed to provide a visual environment to make the modeling more accessible furthermore a basic water system model consists of ecohydrological processes and water resources allocation and regulation is developed to illustrate how to develop processor components and the model is applied in an irrigated area to validate the model generally the framework is feasible while it does not address the fully achieve of reusability in different kinds of models further development to improve the framework is still needed in our future works declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this study was supported by the strategic priority research program of the chinese academy of sciences grant no xda23040500 the national natural science foundation of china no 51809008 the fundamental research funds for the central universities south centtral university for nationalities czy18042 and hubei provincial natural science foundation of china 2018cfb123 appendix c supplementary data the following is the supplementary data to this article multimedia component 1 multimedia component 1 appendix c supplementary data supplementary data to this article can be found online at https doi org 10 1016 j envsoft 2020 104840 appendix a ecohydrological processes 1 runoff model in the recent version the runoff r consists of three components the surface runoff rs on the land surface the interflow runoff ri from the surface soil layer and the baseflow rg from the deep soil layer surface runoff is calculated by a nonlinear method as follows a 1 r s i g 1 a w u i w m g 2 p e i where g 1 and g 2 are the time variant gain coefficients g 1 is the runoff coefficient when the soil moisture is equal to the saturated soil moisture g 2 is the impact coefficient of the soil moisture p e is the effective rainfall arriving at the ground surface mm aw u is the average soil water content in the surface soil layer mm wm is the saturated soil water content mm the subscript i represent time step the interflow runoff is calculated with by a linear storage outflow relationship and the base flow is calculated by a groundwater runoff coefficient as follows a 2 r i i a w u i a w u i 1 2 k r a 3 r g i a w d i k r g where k r and k rg are the flow coefficient of the surface soil and deep soil layers aw d is the average soil water content in the deep soil layer mm 2 evapotranspiration model the evapotranspiration et a in the model is calculated by the reference evapotranspiration and the soil moisture stress the major equations for estimating the evapotranspiration are as follows a 4 e t p 0 408 δ r n g γ 900 t a 273 u 2 e s e a δ γ 1 0 34 u 2 a 5 e t a e t p 1 k a w k e t b a g r o v k a w a w w m where et p is daily reference evapotranspiration mm r n is the net radiation at crop surface mjm 2day 1 g is the soil heat flux density mjm 2day 1 t a is the mean daily temperature at 2 m height c u 2 is the wind speed at 2 m height ms 1 e s and e a is the saturation and actual vapor pressure kpa δ is the slope of vapor pressure kpa c 1 and γ is the psychrometer constant kpa c 1 kaw is the evapotranspiration parameter 3 routing model the river routing is calculated by the kinematic wave method with the assumption that the friction slope is equal to slope and the river flow is unsteady open channel gradual change flow the equation is as follows a 6 a t q x q where a is the cross section area m2 t is the time q is the water flow m3 s x is the flow path m and q is lateral flow m2 s 4 land surface ecological processes model the carbon cycles are mainly considered in the ecological processes including the plant photosynthesis respiration plant growth models and the carbon cycle in the soil and litter nine carbon pools consist of three plant pools leaf root and wood three litter pools structural metabolic and coarse woody and three soil organic pools microbial biomass slow and passive pools are included the daily photosynthesis is simulated based on chen et al 1999 and then the gross and net primary productivity are obtained and then allocated to leaf root and wood for the simulation of plant growth then the carbon is transferred from plant pools to litter pools and from litter pools to soil pools meanwhile carbon is also turnover among different pools in litter and soil pools individually the net photosynthesis rate can be derived by the following equations a 7 a min a c a j r d where a c and a j are the rubiso limited and light limited gross photosynthesis r d is the daytime leaf dark respiration the plant autotrophic respiration is separated into maintenance respiration r m and growth respiration r g a 8 r r m r g i r m i r g i where i is an index for different plant pools including leaf wood and root appendix b water resources allocation 1 social economic related water demand water demand analysis is a vital part of the water system modeling because it determines the economic value of the whole process george et al 2011 the water demand estimation is based on social economic and agricultural activities in this study the water demand estimation including the consumptive demand like urban and rural domestic industrial agricultural and the non consumptive demand like hydropower demand river environmental demand the urban and rural domestic water demand are estimated by the quota method based on the population and per capita water demand the population is predicted by the current population and the average population growth rate which can be obtained from the urban development planning the per capita water demand reflects the water conservation level of cities the industrial water demand is estimated based on the industrial gross domestic product gdp and the per gdp water demand the gdp prediction can be obtained from the national economic development planning b 1 w p o p 1 r p o p i p o p c u r r e n t q p o p b 2 w i n d 1 r i n d i g d p i n d c u r r e n t q i n d where w pop and w ind are the domestic and industrial water demand r pop and r ind are average growth rate pop current and gdp ind current are the current population and industrial gdp q pop and q ind are the per capita and per gdp water demand the agricultural water demand is calculated in each of the irrigated area according to the crop growth water requirement the climate and soil moisture conditions crop water requirement is estimated according to crop phenology and growth and then the irrigation water demand is calculated by the water balance of current soil water content for dryland or the water depth for paddy the effective precipitation and the crop water requirement the agricultural water demand in an irrigated area is summarized based on the crop patterns b 3 w i r r 0 p e w i e t c w min w max e t c p e w i p e w i e t c w min where w irr are the irrigation water demand et c p e w i are the crop water requirement effective precipitation soil water content or water depth w max and w min are the soil water content or water depth upper and lower threshold values which are suitable for crop growth 2 environmental flow demand there are several methods for calculating the ecological flow requirement such as hydrological methods hydraulic rating methods habitat simulation methods holistic methods karakoyun et al 2018 for the lack of the detailed cross section and other habitat data hydrological methods are the easiest and cheapest method using hydrological dataset in the classification of hydrological methods the tennant 1976 texas matthewsr 1991 and 7q10 singh and stall 1974 flow methods are the most common ones and have been widely used in the related studies including reservoir operation to fill the downstream ecological water requirement yin et al 2011 yan et al 2018 the environmental flow is calculated as the percentages of the annual mean streamflow based on the tennant method the values are often range from 10 to 40 the environmental flow based on 7q10 method is the annual minimum 7 day average streamflow with a 90 reliability the texas method considers the variations for different seasons and the environmental flow is the percentages of the streamflow with 50 reliability at each month to make the results of the ecological flow more reasonable and maximize the protection of the river ecosystem we use the above hydrological methods to calculate the ecological flow and the maximum values at each month are used in this study then the environmental flow requirement for a certain river node are prepared as input variables 3 water supply of different sources the water supply sources consist of surface water sources like reservoirs rivers ponds ground water sources and other sources like treated water reservoirs are the most important water supply source for their advantages of storing more water for the usage during the dry season in this study reservoirs are divided into two categories one is the online reservoir which is along with rivers the other one is the offline reservoir which is a local reservoir managed independently and drawing water from the rivers or online reservoir the water allocated by reservoirs based on the water availability and the water demand the key equation for reservoir is the water balance equation as follows b 4 v i 1 v i q r i n i δ t q r o u t i q a l l o c q l o s s δ t where v i and v i 1 is the reservoir volume at the time step i and i 1 q rin q rout q alloc q loss are the reservoir inflow outflow allocated water and water loss including evaporation and leakage for the lack of storage capacity the available water from river sources are mainly determined by the streamflow the water supply by river sources are calculated by the minimum of streamflow water demand and the flow capacity of pipes or channels water supply from groundwater sources depend on the water storage and the maximum flow of the pump station the water balance equation of groundwater is as following b 5 w i 1 w i q r e c h a g e i δ t q g i q a l l o c δ t where w i and w i 1 is the groundwater storage at the time step i and i 1 q recharge q g q alloc are the groundwater recharge baseflow and allocated water 4 priorities for water allocation in same with most of the simulation based water allocation models the water allocation in this study is based on mass balance and user defined priorities to allocate water resources in this model the priorities system consists of two subsystems used to determine the allocations from different water sources like reservoir groundwater river to different water demands like social economic related usage environmental flow requirement the competitive allocation from one supply source to different water user demand is according to the users priorities and significances that is to say the water users with higher priorities will be satisfied as fully as possible before lower priorities are considered additionally if two or more demands share the same priority different from the equal allocation in previous study the water allocation is according to their predefined significances range between 0 0 and 1 0 generally the domestic water use usually has the highest priority the priorities of the other water demand should be determined according the actual situations or local laws and regulations another priority system is used to simulate the water users preferences i e if a water user intake water from more than one water supply sources the intake priority determines that which source will be adopt firstly similarly if more than one sources share the same preference the withdraw water from different sources will be defined by a predefined ratios range between 0 0 and 1 0 the priorities usually follow the water resources management department meanwhile the priorities can be optimized in the water allocation researches within the supply and intake priorities system the model determines a water allocation sequence which is used to intake and allocate water in the water system 5 water supply rules of reservoirs the water supply operating rules of reservoirs are usually used to make the decision about the water supply for different water users water storage and water release which will directly affect the streamflow previous studies introduce several rules such as standard operation policy sop maass et al 1962 hedging rule hr tu et al 2003 space rule sr bower et al 1962 new york city rules nyc clark 1956 etc the sop rule is widely used in the reservoir operation while it will cause severe damage for water supply in the later period for the reason that it only considers the water demand in the current period hr rule is designed to for rationing water supply in appropriate preparation for potential low inflows in the near future you and cai 2008 which could avoid severe water deficit of a few periods in the dry season in this study a water supply limit factor is used to determine the water storage and the water supply at a certain period 
25926,a major challenge in landscape modeling is to effectively visualize and analyze a massive amount of simulation outputs which usually are in various raster and vector geospatial data formats because the task is often time consuming and costly available handy data viewers are limited yet it is a useful tool for land managers to prepare and deploy their management plan in a landscape scale here we upgraded our previous landisview version 1 0 to significantly enhance both visualizing and analyzing four major raster and vector geospatial data formats erdas gis ascii raster gis asc erdas imagine img and tagged image tiff which are the images formats widely used in remote sensing and landscape models e g landis in addition the version 2 0 software can serve as a converter for linking spatial data to other widely used landscape spatial analysis tools including fragstats using this updated version 2 0 we were able to effectively assess a wildfire effect on forest structure and predict forest growth dynamics in responses to future wildfire and drought in northeastern california keywords landscape modeling landisview spatially explicit models open source tool software availability software name landisview 2 0 contact dr weimin xi weimin xi tamuk edu year first available 2019 hardware required ibm compatible pc operation system required windows 10 program languages c net framework 4 6 availability downloadable from https sourceforge net projects landisview 2 0 1 introduction among the landscape disturbance and succession models ldsms landis landscape disturbance and succession is a raster based spatially explicit computer model designed to simulate forest succession and disturbances wildfire wind insect outbreak drought land use harvest and climate change across broad spatial and temporal scales mladenoff 2004 xi et al 2008 2009a b 2016 larocque et al 2016 since introduced in 1996 landis has been widely used for evaluating forest dynamics wildfire effects and outcomes of various forest harvest scenarios e g he et al 2002 scheller et al 2007 xi et al 2009 shang et al 2012 dai et al 2016 based on the need of evaluating forest dynamics and restoration strategies we developed a software tool landisview 1 0 to visualize the large number of output files from landis model in late 2000 s birt et al 2009 over a 10 year period computer performance coding language and visualization methods have further improved increasing the need for an upgrade therefore an upgraded version of landisview version 2 0 is now available with better performance and expanded functions for both visualization and analysis of various raster and vector geospatial data there are several existing software with the function of processing raster and vector geospatial data formats in addition to r and qgis some widely used software include arcmap the main component of esri s arcgis suite of geospatial processing programs commercial software arcgis desktop which is used primarily to view edit create and analyze geospatial data environmental systems research institute 2020 erdas er viewer a free desktop image viewer application and microsoft office plugin offered within the producer suite of the power portfolio by hexagon it displays popular geospatial file types hexagon geospatial 2014 landviz an intuitive browser based tool that allows stakeholders to easily visualize and analyze model output it is developed by portland state university and northern research station usda forest service to visualize the landis ii output via web links gustafson et al 2016 compared to other available geospatial data visualizing software we developed landisview as an open sourced geospatial image viewer designed to provide the most common functions of a landis output viewer and geospatial data converter to integrate key software features and to enhance the data processing ability table 1 in the previous version of landisview version 1 0 notable features include the ability to view animate and export a series of time series data files in a customized sequence a color palette for visualization and convert erdas gis files into fragstats supported format mcgarigal et al 2012 in the new version of landisview 2 0 these basic features have been enhanced and a set of new features are introduced including supporting more data formats erdas imagine img format geotiff format tiff and esri ascii raster format asc one major improvement is that we developed a multiple window mode to compare multiple images and multiple scenario outputs simultaneously new features include zoom control highlight cell customized color palette system supporting xml preset and map statistic table 2 structural and architectural design landisview 2 0 is designed as an open source software which are free available to download the source code and documentation are also available https sourceforge net projects landisview 2 0 to the public this is consistent with our belief from when we first developed landisview in the late 2000 s that open code encourages open collaboration while model simulations normally produce massive amounts output landisview 2 0 is designed specifically for spatially explicit landscape modeling we made particular effort in focusing on an intuitive user friendly image visualization experience the basic workflow of landisview is shown in fig 1 landisview 2 0 is written in c program language landisview 1 0 is written in c for visualizing and animating 8 bit 16 bit erdas gis raster gis and erdas imagine img files from landis simulation and other ldsms the software used the gdal geospatial data abstraction library developed by warmerdam 2000 as an open source project for handling raster files 2 1 data classification in the new version of landisview there are three types of input data supported pure value data which includes values for each map cell pure image data which includes color for each image pixel and raster data which mixes color and value for each type of input data a display strategy is defined for high performance as shown in fig 2 in the display design detailed palettes are used for pure value data which can set variety and flexible palette sets and have better functionality for statistics quick palette is used for mixed type data which can set simplified color combinations and basic function pixel control is used for pure image data which can conduct color transformation at the pixel level this strategy enables the quick response of different display processes kastuari et al 2016 2 2 data structure in forest disturbance and succession studies it is essential to compare different periods in time for one disturbance or different disturbances occurring at the similar periods in time across a landscape the ability to show multiple data in one window is essential and a corresponding display strategy mode should be designed for this the input data file is defined as a map data series mds the map data series mds class is defined as a series of map data including a map data list with several map data a statistics table and an information table of over all map data a palette for imaging and the corresponding legend in the map data list there are several map data each of which includes map data map image a statistics table and an information table the map data series in landisview 2 0 are defined in fig 3 a data series class includes several map data which can be organized by adding removing or sorting after adding or removing a data file a value dictionary is created for each of the map data and the overall data series palette and map image is updated 2 3 palette for visualizing a data series we have enabled users the ability to assign specified colors for different values this allows for the direct comparison between each cell for pure value data further enhanced with supporting xml configuration the window of palette system is shown as fig 4 in the xml file the syntax of the palette definition is shown as following xml version 1 0 encoding utf 8 palettes classifiedpalette d6a090 fe3b1e a12c32 fa2f7a fb9fda e61cf7 992f7c 47011f 051155 4f02ec 2d69cb 00a6 ee 6febff 08a29a 2a666a 063619 000000 4a4957 8e7ba4 b7c0ff fffff acbe9c 827c70 5a3b1c ae6507 f7aa 30 f4ea5c 9b9500 566204 11963b 51e113 08fdcc classifiedpalette uniquepalette fffff ffd19d aeb5bd 4d80c9 e93841 100820 511e43 054494 f1892d 823e2c ffa9a9 5ae150 ffe947 7d3ebf eb6c82 1e8a4c uniquepalette palettes the palette system options include stretched classified and unique in the xml configuration the palette elements are defined as stretchedpalette classifiedpalette or uniquepalette in which the color combination is defined as a group of hex values rgb separated by a comma by this syntax pattern users can modify the xml file to define new palettes we developed a corresponding editor to support the palette system 2 4 display the multiple data view mode is designed for displaying multiple data inputs fig 5 under this function four data maps are displayed in one window in the same coordinates and location in this mode the same cell can be highlighted in each map display and views can be scaled and moved simultaneously to realize a quick response of user interface map data class creates a snapshot when the palette is determined which is saved as a map image the logical relationship between single mode multiple mode and comparison mode is shown in fig 5 2 5 data process the format of gis is the only output format by landis but for further analysis and study other format should be processed and converted especially like fbt fragstats and asc esriascii on the other hand the animation of ecosystem evolution will enhance the effect of research of forest succession in the new version of landiview map data can be exported or converted to three visualization formats and two data formats image png animation gif and video avi ascii grids for compatibility with fragstats fbt and esri ascii raster format asc fragstats is a spatial pattern analysis program for quantifying the structure of landscapes mcgarigal et al 2012 this program simply quantifies the spatial heterogeneity of the landscape as represented in either a categorical map or continuous surface the esri ascii raster format is an arcgis supported format for cell based or raster systems which is a widely used for grid data these functions are enhanced by optimizing the ui and supporting multiple view mode fig 6 all the selected files and formats can be exported by one click and the data structure is determined by the data information table from the map data series landisview fragstats also has different features from esri spatial analyst shown as following table 2 3 software implications visualization and analytical functions for landscape modeling 3 1 a case study assessing the effects of wildfire on forest structure in northern california 3 1 1 project overview we provide here some examples of using landisview 2 0 in our on going project to illustrate the key functions of the updated tool the objective of our research project was to determine the forest structure that strikes an optimal balance of the forest ecosystems between resiliency to wildfire and other biotic disturbances maintaining wildlife habitat and maintaining or increasing detrital carbon storage in the ponderosa pine true fir and mixed coniferous forests in the lassen and plumas national forests in northeastern california fig 7 lassen national forest was established in 1905 with an area of 4331 53 km2 covering a transition of cascade range in the north and sierra nevada in the south while plumas national forest was established in 1907 with an area of 4640 km 2 in the northern sierra nevada range of california the united states forest service manages both national forests the climate is a typical mediterranean with hot dry summers and cold wet winters we quantify the effects of wildfire on forest structure using a combined analysis of field survey based forest stand data and geospatial analysis in geographic information system gis forest stand conditions and wildfire severity were mapped based on fitted landsat imagery and aerial images in particular we incorporate satellite imagery from multiple landsat missions and national forest inventory and analysis fia forest plot data to understand the patterns causes of and consequences of biomass stock status and change related to wildfires and drought we integrate landis ii model climate and drought data to assess forest resilience and scale up these surveyed plot level data into a gis into the entire area to predict forest dynamics under varied restoration projects for all forests we investigate how forest resilience may offer new contributions to forest management in particular by identifying how it differs from earlier guiding paradigms we study effects of wildfire and fuel reduction treatments on forest structure and carbon dynamics and to evaluate using forest structure as a management tool in forest restoration projects 3 1 2 input maps for landis ii simulations we used the ecological subregions of the united states by usda forest service ecological classification and mapping task team bailey 1995 fig 8 landisview 2 0 can easily display the ecoregions map ecoregions img which includes 19 ecoregions in the study area the view properties shows the basic information about the ecoregions including raster information e g columns and rows cell size and image format extent spatial reference and statistics the vegetation in the area was a typical mixed conifer forest we used the r5 calveg existing vegetation calveg 2004 https www fs usda gov detail r5 landmanagement resourcemanagement cid stelprdb5347192 classification system by the pacific southwest region r5 information management staff to create initial communities map including 94 vegetation types fig 9 in total 26 tree species were selected in the landis ii simulation based on tree composition ranking in the fia plots in the two national forests landisview 2 0 provides a user friendly interface to present geospatial information of the initial communities e g vegetation types including raster information e g columns and rows cell size and image format extent spatial reference and statistics fig 9 the multiple windows in landisview 2 0 allow users to view major input images simultaneously fig 10 for example fig 10 shows the ecoregions map initial communities map the initial drought and initial wildfire maps 3 1 3 visualization of multiple biomass output maps from landis ii simulations we developed four scenarios to examine the biomass changes for the future 50 years 1 no wildfire and no drought 2 wildfire without drought 3 drought without wildfire and 4 both drought and wildfire the multiple scenario display and animation allows us to simultaneously compare and view landis ii biomass output maps side by side this is especially useful when simulations from multiple scenarios are conducted and need to be visually compared fig 11 these simulations support collaboration between scientists and managers in achieving optimum forest structures this understanding is essential for forest managers to achieve their management goals 3 2 broader implications in addition to our applications landisview 2 0 has been used for landis ii training workshops organized by the institute for applied ecosystem studies iaes northern research station usda forest service this tool was tested and used in several research projects in usa canada and china the landisview 2 0 software has been highlighted and linked by the following websites landis ii model http www landis ii org tools landisview and nasa s global change master directory https cmr earthdata nasa gov search concepts c1214586381 sciops 3 3 limitations and further improvement a few current limitations and features could be enhanced in future versions of landisview which includes 1 slower response time when handling extremely large data files 2 the analytical and statistical functions that could be further enhanced to meet users needs and 3 improved data editing function we will continue to improve the functions 3d visualization support additional geospatial data formats higher performance and analytical functions of this software continuous user surveys are planned for better understanding and meeting user needs 4 concluding remarks the work presented here is part of a larger effort to investigate the utility of landscape models as a decision making tool for pre disturbance impact analysis and post disturbance restoration of forest landscapes threatened by various biotic and abiotic disturbances xi et al 2008 this upgraded version of landisview has added a new set of functions multiple window animations etc for handling large quantities of erdas gis raster gis asc and erdas imagine img tiff spatial image files and has been shown as an effective processing tool for ecologists geographers foresters and modelers declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper the authors declare the following financial interests personal relationships which may be considered as potential competing interests acknowledgements this research was supported through usda forest service pacific southwest research station cooperative agreement fs 19 11272139 025 we appreciate four reviewers provided valuable comments and feedback improve the quality of the manuscript we greatly appreciate help and feedback from brian miranda and eric gustafson forest service northern research station institute for applied ecosystem studies in the process of upgrading this software and kaelyn finley forest service pacific southwest research station to improve this paper landisview 2 0 uses a third party library gdal for opening erdas gis raster gis and erdas imagine img image files we thank the gdal team especially frank warmerdam for developing this open source library appendix a supplementary data the following is the supplementary data to this article multimedia component 1 multimedia component 1 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j envsoft 2020 104849 
25926,a major challenge in landscape modeling is to effectively visualize and analyze a massive amount of simulation outputs which usually are in various raster and vector geospatial data formats because the task is often time consuming and costly available handy data viewers are limited yet it is a useful tool for land managers to prepare and deploy their management plan in a landscape scale here we upgraded our previous landisview version 1 0 to significantly enhance both visualizing and analyzing four major raster and vector geospatial data formats erdas gis ascii raster gis asc erdas imagine img and tagged image tiff which are the images formats widely used in remote sensing and landscape models e g landis in addition the version 2 0 software can serve as a converter for linking spatial data to other widely used landscape spatial analysis tools including fragstats using this updated version 2 0 we were able to effectively assess a wildfire effect on forest structure and predict forest growth dynamics in responses to future wildfire and drought in northeastern california keywords landscape modeling landisview spatially explicit models open source tool software availability software name landisview 2 0 contact dr weimin xi weimin xi tamuk edu year first available 2019 hardware required ibm compatible pc operation system required windows 10 program languages c net framework 4 6 availability downloadable from https sourceforge net projects landisview 2 0 1 introduction among the landscape disturbance and succession models ldsms landis landscape disturbance and succession is a raster based spatially explicit computer model designed to simulate forest succession and disturbances wildfire wind insect outbreak drought land use harvest and climate change across broad spatial and temporal scales mladenoff 2004 xi et al 2008 2009a b 2016 larocque et al 2016 since introduced in 1996 landis has been widely used for evaluating forest dynamics wildfire effects and outcomes of various forest harvest scenarios e g he et al 2002 scheller et al 2007 xi et al 2009 shang et al 2012 dai et al 2016 based on the need of evaluating forest dynamics and restoration strategies we developed a software tool landisview 1 0 to visualize the large number of output files from landis model in late 2000 s birt et al 2009 over a 10 year period computer performance coding language and visualization methods have further improved increasing the need for an upgrade therefore an upgraded version of landisview version 2 0 is now available with better performance and expanded functions for both visualization and analysis of various raster and vector geospatial data there are several existing software with the function of processing raster and vector geospatial data formats in addition to r and qgis some widely used software include arcmap the main component of esri s arcgis suite of geospatial processing programs commercial software arcgis desktop which is used primarily to view edit create and analyze geospatial data environmental systems research institute 2020 erdas er viewer a free desktop image viewer application and microsoft office plugin offered within the producer suite of the power portfolio by hexagon it displays popular geospatial file types hexagon geospatial 2014 landviz an intuitive browser based tool that allows stakeholders to easily visualize and analyze model output it is developed by portland state university and northern research station usda forest service to visualize the landis ii output via web links gustafson et al 2016 compared to other available geospatial data visualizing software we developed landisview as an open sourced geospatial image viewer designed to provide the most common functions of a landis output viewer and geospatial data converter to integrate key software features and to enhance the data processing ability table 1 in the previous version of landisview version 1 0 notable features include the ability to view animate and export a series of time series data files in a customized sequence a color palette for visualization and convert erdas gis files into fragstats supported format mcgarigal et al 2012 in the new version of landisview 2 0 these basic features have been enhanced and a set of new features are introduced including supporting more data formats erdas imagine img format geotiff format tiff and esri ascii raster format asc one major improvement is that we developed a multiple window mode to compare multiple images and multiple scenario outputs simultaneously new features include zoom control highlight cell customized color palette system supporting xml preset and map statistic table 2 structural and architectural design landisview 2 0 is designed as an open source software which are free available to download the source code and documentation are also available https sourceforge net projects landisview 2 0 to the public this is consistent with our belief from when we first developed landisview in the late 2000 s that open code encourages open collaboration while model simulations normally produce massive amounts output landisview 2 0 is designed specifically for spatially explicit landscape modeling we made particular effort in focusing on an intuitive user friendly image visualization experience the basic workflow of landisview is shown in fig 1 landisview 2 0 is written in c program language landisview 1 0 is written in c for visualizing and animating 8 bit 16 bit erdas gis raster gis and erdas imagine img files from landis simulation and other ldsms the software used the gdal geospatial data abstraction library developed by warmerdam 2000 as an open source project for handling raster files 2 1 data classification in the new version of landisview there are three types of input data supported pure value data which includes values for each map cell pure image data which includes color for each image pixel and raster data which mixes color and value for each type of input data a display strategy is defined for high performance as shown in fig 2 in the display design detailed palettes are used for pure value data which can set variety and flexible palette sets and have better functionality for statistics quick palette is used for mixed type data which can set simplified color combinations and basic function pixel control is used for pure image data which can conduct color transformation at the pixel level this strategy enables the quick response of different display processes kastuari et al 2016 2 2 data structure in forest disturbance and succession studies it is essential to compare different periods in time for one disturbance or different disturbances occurring at the similar periods in time across a landscape the ability to show multiple data in one window is essential and a corresponding display strategy mode should be designed for this the input data file is defined as a map data series mds the map data series mds class is defined as a series of map data including a map data list with several map data a statistics table and an information table of over all map data a palette for imaging and the corresponding legend in the map data list there are several map data each of which includes map data map image a statistics table and an information table the map data series in landisview 2 0 are defined in fig 3 a data series class includes several map data which can be organized by adding removing or sorting after adding or removing a data file a value dictionary is created for each of the map data and the overall data series palette and map image is updated 2 3 palette for visualizing a data series we have enabled users the ability to assign specified colors for different values this allows for the direct comparison between each cell for pure value data further enhanced with supporting xml configuration the window of palette system is shown as fig 4 in the xml file the syntax of the palette definition is shown as following xml version 1 0 encoding utf 8 palettes classifiedpalette d6a090 fe3b1e a12c32 fa2f7a fb9fda e61cf7 992f7c 47011f 051155 4f02ec 2d69cb 00a6 ee 6febff 08a29a 2a666a 063619 000000 4a4957 8e7ba4 b7c0ff fffff acbe9c 827c70 5a3b1c ae6507 f7aa 30 f4ea5c 9b9500 566204 11963b 51e113 08fdcc classifiedpalette uniquepalette fffff ffd19d aeb5bd 4d80c9 e93841 100820 511e43 054494 f1892d 823e2c ffa9a9 5ae150 ffe947 7d3ebf eb6c82 1e8a4c uniquepalette palettes the palette system options include stretched classified and unique in the xml configuration the palette elements are defined as stretchedpalette classifiedpalette or uniquepalette in which the color combination is defined as a group of hex values rgb separated by a comma by this syntax pattern users can modify the xml file to define new palettes we developed a corresponding editor to support the palette system 2 4 display the multiple data view mode is designed for displaying multiple data inputs fig 5 under this function four data maps are displayed in one window in the same coordinates and location in this mode the same cell can be highlighted in each map display and views can be scaled and moved simultaneously to realize a quick response of user interface map data class creates a snapshot when the palette is determined which is saved as a map image the logical relationship between single mode multiple mode and comparison mode is shown in fig 5 2 5 data process the format of gis is the only output format by landis but for further analysis and study other format should be processed and converted especially like fbt fragstats and asc esriascii on the other hand the animation of ecosystem evolution will enhance the effect of research of forest succession in the new version of landiview map data can be exported or converted to three visualization formats and two data formats image png animation gif and video avi ascii grids for compatibility with fragstats fbt and esri ascii raster format asc fragstats is a spatial pattern analysis program for quantifying the structure of landscapes mcgarigal et al 2012 this program simply quantifies the spatial heterogeneity of the landscape as represented in either a categorical map or continuous surface the esri ascii raster format is an arcgis supported format for cell based or raster systems which is a widely used for grid data these functions are enhanced by optimizing the ui and supporting multiple view mode fig 6 all the selected files and formats can be exported by one click and the data structure is determined by the data information table from the map data series landisview fragstats also has different features from esri spatial analyst shown as following table 2 3 software implications visualization and analytical functions for landscape modeling 3 1 a case study assessing the effects of wildfire on forest structure in northern california 3 1 1 project overview we provide here some examples of using landisview 2 0 in our on going project to illustrate the key functions of the updated tool the objective of our research project was to determine the forest structure that strikes an optimal balance of the forest ecosystems between resiliency to wildfire and other biotic disturbances maintaining wildlife habitat and maintaining or increasing detrital carbon storage in the ponderosa pine true fir and mixed coniferous forests in the lassen and plumas national forests in northeastern california fig 7 lassen national forest was established in 1905 with an area of 4331 53 km2 covering a transition of cascade range in the north and sierra nevada in the south while plumas national forest was established in 1907 with an area of 4640 km 2 in the northern sierra nevada range of california the united states forest service manages both national forests the climate is a typical mediterranean with hot dry summers and cold wet winters we quantify the effects of wildfire on forest structure using a combined analysis of field survey based forest stand data and geospatial analysis in geographic information system gis forest stand conditions and wildfire severity were mapped based on fitted landsat imagery and aerial images in particular we incorporate satellite imagery from multiple landsat missions and national forest inventory and analysis fia forest plot data to understand the patterns causes of and consequences of biomass stock status and change related to wildfires and drought we integrate landis ii model climate and drought data to assess forest resilience and scale up these surveyed plot level data into a gis into the entire area to predict forest dynamics under varied restoration projects for all forests we investigate how forest resilience may offer new contributions to forest management in particular by identifying how it differs from earlier guiding paradigms we study effects of wildfire and fuel reduction treatments on forest structure and carbon dynamics and to evaluate using forest structure as a management tool in forest restoration projects 3 1 2 input maps for landis ii simulations we used the ecological subregions of the united states by usda forest service ecological classification and mapping task team bailey 1995 fig 8 landisview 2 0 can easily display the ecoregions map ecoregions img which includes 19 ecoregions in the study area the view properties shows the basic information about the ecoregions including raster information e g columns and rows cell size and image format extent spatial reference and statistics the vegetation in the area was a typical mixed conifer forest we used the r5 calveg existing vegetation calveg 2004 https www fs usda gov detail r5 landmanagement resourcemanagement cid stelprdb5347192 classification system by the pacific southwest region r5 information management staff to create initial communities map including 94 vegetation types fig 9 in total 26 tree species were selected in the landis ii simulation based on tree composition ranking in the fia plots in the two national forests landisview 2 0 provides a user friendly interface to present geospatial information of the initial communities e g vegetation types including raster information e g columns and rows cell size and image format extent spatial reference and statistics fig 9 the multiple windows in landisview 2 0 allow users to view major input images simultaneously fig 10 for example fig 10 shows the ecoregions map initial communities map the initial drought and initial wildfire maps 3 1 3 visualization of multiple biomass output maps from landis ii simulations we developed four scenarios to examine the biomass changes for the future 50 years 1 no wildfire and no drought 2 wildfire without drought 3 drought without wildfire and 4 both drought and wildfire the multiple scenario display and animation allows us to simultaneously compare and view landis ii biomass output maps side by side this is especially useful when simulations from multiple scenarios are conducted and need to be visually compared fig 11 these simulations support collaboration between scientists and managers in achieving optimum forest structures this understanding is essential for forest managers to achieve their management goals 3 2 broader implications in addition to our applications landisview 2 0 has been used for landis ii training workshops organized by the institute for applied ecosystem studies iaes northern research station usda forest service this tool was tested and used in several research projects in usa canada and china the landisview 2 0 software has been highlighted and linked by the following websites landis ii model http www landis ii org tools landisview and nasa s global change master directory https cmr earthdata nasa gov search concepts c1214586381 sciops 3 3 limitations and further improvement a few current limitations and features could be enhanced in future versions of landisview which includes 1 slower response time when handling extremely large data files 2 the analytical and statistical functions that could be further enhanced to meet users needs and 3 improved data editing function we will continue to improve the functions 3d visualization support additional geospatial data formats higher performance and analytical functions of this software continuous user surveys are planned for better understanding and meeting user needs 4 concluding remarks the work presented here is part of a larger effort to investigate the utility of landscape models as a decision making tool for pre disturbance impact analysis and post disturbance restoration of forest landscapes threatened by various biotic and abiotic disturbances xi et al 2008 this upgraded version of landisview has added a new set of functions multiple window animations etc for handling large quantities of erdas gis raster gis asc and erdas imagine img tiff spatial image files and has been shown as an effective processing tool for ecologists geographers foresters and modelers declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper the authors declare the following financial interests personal relationships which may be considered as potential competing interests acknowledgements this research was supported through usda forest service pacific southwest research station cooperative agreement fs 19 11272139 025 we appreciate four reviewers provided valuable comments and feedback improve the quality of the manuscript we greatly appreciate help and feedback from brian miranda and eric gustafson forest service northern research station institute for applied ecosystem studies in the process of upgrading this software and kaelyn finley forest service pacific southwest research station to improve this paper landisview 2 0 uses a third party library gdal for opening erdas gis raster gis and erdas imagine img image files we thank the gdal team especially frank warmerdam for developing this open source library appendix a supplementary data the following is the supplementary data to this article multimedia component 1 multimedia component 1 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j envsoft 2020 104849 
25927,reliable near real time precipitation estimates are essential for monitoring and managing of natural disasters such as floods quality of inputs and capability of the retrieval algorithm are two important aspects for developing satellite based precipitation datasets most retrieval algorithms utilize infrared ir information as their input due to its fine spatiotemporal resolution and near instantaneous availability however their sole reliance on ir information limits their capability to learn different mechanisms of precipitation during training resulting in less accurate estimates moreover recent advances in the field of machine learning offer attractive opportunities to improve the precipitation retrieval algorithms this study investigates the effectiveness of adding geographical information i e latitude and longitude to ir information and the application of a u net based convolutional neural network for improving the accuracy of retrieval algorithms this research suggests that applying an appropriate cnn architecture on geographical and ir information provides an opportunity to improve the satellite based precipitation products graphical abstract image 1 keywords infrared information precipitation estimation deep learning convolutional neural networks 1 introduction and background precipitation is one of the major driving components for the global hydrological cycle and is a key component for regulating the climate system kidd and levizzani 2011 trenberth et al 2003 oki and kanae 2006 reliable estimation of precipitation at fine spatial and temporal resolutions is vital for many hydro meteorological applications including developing early warning systems and disaster management strategies as well as conducting climatological studies on both global and regional scales hou and coauthors 2014 mehran and aghakouchak 2014 nguyen et al 2018b 2015 sadeghi et al 2019c there are various methods of precipitation measurements including rain gauges radar networks and satellite instruments ground based rain gauge networks which directly measure precipitation at the earth s surface are the most widely used methods for providing long term precipitation records yilmaz et al 2005 sadeghi 2018 however the spatial distribution of ground based gauge networks is uneven and sparse over the world especially over oceanic and remote regions xie and arkin 1997 sun et al 2018 maggioni et al 2016 awange et al 2019 furthermore extending point measurements to gridded precipitation is a common source of uncertainty which limits the development of high resolution precipitation datasets villarini et al 2008 xu et al 2017b wood et al 2000 radar networks which can provide real time measurements at high spatiotemporal resolution are another alternative to ground based rain gauges kitzmiller et al 2013 price et al 2014 sivasubramaniam et al 2019 however the high installation and maintenance costs along with the difficulties in accessibility over remote regions have limited the establishment of a global radar network habib et al 2012 westrick et al 1999 scofield and kuligowski 2003 with development of advanced infrared ir and microwave mw instruments satellite observations make up for these deficiencies by providing high spatial and temporal resolutions with homogeneous global coverage kidd and levizzani 2011 xie et al 2003 satellite based precipitation products have been developed based on utilizing passive microwave pmw sensors on low earth orbiting leo satellites and or visible ir vis ir sensors on geosynchronous earth orbiting geo satellites behrangi et al 2009 michaelides et al 2009 sorooshian et al 2000 geo satellites provide ir imageries with a rapid temporal cycle 30 min or less and high resolutions 4 km or less for the 24 h over the globe therefore the ir based products have the advantage of offering precipitation estimates at fine temporal and spatial resolutions over the globe vis ir precipitation estimation algorithms link the ir cloud top temperature brightness to the probability and intensity of rainfall zeng 1999 the lower the cloud top temperature the brighter clouds the higher the probability and the amount of precipitation these algorithms expect to fall arkin and meisner 1987 adler and negri 1988 this assumption results in poor performance since the relation between surface rainfall rate and cloud top temperature is indirect on the other hand pmw radiometers offer more direct methods for precipitation measurements as they can probe through most of the clouds and measure the vertical hydrometeor distribution and surface rainfall sun et al 2018 joyce et al 2004 however pmw information have lower spatial and temporal sampling two observations per day per satellite marzano et al 2004 karbalaee et al 2017 in order to take advantage of the strengths that each sensor offers some precipitation estimation algorithms combine high frequency information from geo satellites and sparsely sampled data from leo satellites these algorithms mostly serve vis ir information as fundamental sources for precipitation estimation and utilize pmw for post processing behrangi et al 2009 joyce et al 2004 turk et al 2000 miller et al 2001 sorooshian et al 2000 hsu et al 1997 levizzani et al 1996 kummerow and giglio 1995 bellerby et al 2000 for example precipitation estimation from remotely sensed information using artificial neural networks persiann utilizes ir information as the primary inputs for the artificial neural network ann model and then employs pmw information for continuously adapting the parameters of the model hsu et al 1997 sorooshian et al 2000 persiann provides hourly precipitation estimates at 0 25 spatial resolution from march 2000 to the present and is accessible at a time lag of 2 days at the center for hydrometeorology and remote sensing chrs data portal http chrsdata eng uci edu nguyen et al 2018 nguyen et al 2019 in order to increase the spatial resolution and decrease the lag time of persiann hong et al 2007 introduced a cloud patch based algorithm which is called persiann cloud classification system persiann ccs this algorithm extracts pre defined local and regional features from ir satellite imagery under specified temperature thresholds in order to estimate rainfall in four steps first ir imagery is separated into distinctive cloud patches based on different temperature thresholds using an incremental temperature threshold algorithm second cloud features including coldness texture and geometry are extracted from segmented images in the third step a self organizing feature map sofm approach is utilized in order to classify the cloud patches into well organized categories fourth historical matching is employed to develop a relationship between rain rates and cloud top temperature and then exponential regression is utilized for rain rate estimation in each pixel hong et al 2007 persiann ccs s dataset at 0 04 spatial resolution with a lag time of around an hour has been available since january 2003 in hourly time steps at the chrs data portal http chrsdata eng uci edu nguyen et al 2018a both persiann and persiann ccs extract cloud information based on manually defined features including minimum mean temperature of a cloud patch mean and standard deviation of cloud patch temperature cloud patch area and shape index and gradient of cloud top brightness temperature manual feature extraction is always biased toward the most relevant and physically obvious features that have direct impacts on precipitation occurrence due to the complexity of the precipitation phenomena there may be some other unknown factors that play crucial roles in the accuracy of the model s simulations sadeghi et al 2019 improvement of the persiann systems has been an ongoing project at chrs at university of california irvine during the last two decades sadeghi et al 2019a 2019b 2019c furthermore recent developments of machine learning ml techniques offer an exciting direction to improve the accuracy of precipitation estimation among the different ml techniques the deep neural network dnn methods have been reported to achieve high accuracy robustness efficiency and overall model performance in the field of hydrology ardabili et al 2019 sadeghi et al 2019 shen 2018 hu et al 2019 shen et al 2019 shilon et al 2019 matsuoka et al 2018 akbari asanjan et al 2018 bui et al 2020 wen et al 2019 tao et al 2016 hayatbini et al 2019 ye et al 2019 xu et al 2017a o neil et al 2020 one of the most promising features of dnn techniques is that they allow automatic feature extraction from raw data which is different from non deep methods where the useful input features must be constructed by human expertise the first attempt for applying a dnn technique to improve the performance of persiann systems is the research conducted by tao et al 2016 they employed stacked denoising autoencoders sdae to automatically extract features from the infrared ir images to estimate the amount of precipitation referred to as persiann sdae they achieved 34 and 43 corrections on false alarm pixels and 78 and 98 reductions in bias of precipitation estimates compared to persiann ccs over the validation periods of the summer and winter seasons over the central united states 30 45 n 90 105 w although the sdae algorithm like other dnn algorithms can automatically extract the features its inefficient structure limits their capability to efficiently use the neighborhood information for retrieving the rain rate since sdae layers are fully connected each output pixel is estimated based on the information from the corresponding pixel of the input datasets rather than using the information of the neighboring pixels in the same image however spatial variations in ir images can provide useful information for estimating the rain rate especially for frontal rainfall convolutional neural networks cnn are mainly designed to efficiently and automatically extract features from images cnn architectures mostly consist of convolutional layers pooling layers and fully connected layers xiao et al 2019 convolutional layers extract local features feature maps from input images pooling layers allow the model to learn spatial invariant features by reducing the size of feature maps and fully connected layers determine the most correlated features to a particular class sadeghi et al 2019 shen 2018 gu and coauthors 2018 yu and harbor 2019 the key feature of cnns is weight sharing which is achieved by sharing the same learnable filters kernels across all the image positions yamashita et al 2018 weight sharing creates the following promising characteristics of cnns 1 local features extracting while sdae layers are fully connected the convolutional and pooling layers in cnn architectures only work on a local neighborhood 2 spatial pattern learning learning spatial hierarchies of feature patterns by down sampling using the pooling operation in conjunction with convolutional operation enable the model to learn a larger field of view 3 increasing model efficiency sharing the same weight dramatically reduces the number of learning parameters compared to fully connected neural networks such as the sdae network recently sadeghi et al 2019 investigated the application of cnn in detecting and estimating the precipitation from bispectral satellite imagery ir and water vapor channels referred to as persiann cnn over the central united states 30 45 n 90 105 w their results indicated that persiann cnn outperforms persiann ccs and persiann sdae by 54 and 23 in the critical success index csi with respect to the national centers for environmental prediction ncep stage iv gauge radar data illustrating the detection skills of the cnn based model furthermore the root mean square error rmse rain rate estimates of persiann cnn against to the ncep stage iv dataset was lower than that of persiann ccs and persiann sdae by 37 and 14 demonstrating the estimation accuracy of the cnn based model for precipitation estimation in that work both persiann sdae and persiann cnn models were trained over the central united states and then compared with persiann ccs over that same region during the summer however it is unclear how the models would perform across other regions or seasons where the mechanisms of precipitation may vary therefore the first question to address is can a cnn based model outperform persiann ccs over the contiguous united states conus secondly both proposed sdae and cnn models leverage the water vapor wv information in conjunction with ir images however persiann ccs only estimates the rainfall based on ir information the next question is can a cnn based model outperform the current persiann ccs using the same input ir information the last question to investigate is how can we improve the proposed cnn based model by sadeghi et al 2019 based on the characteristics of rainfall and the features of the cnn architectures to answer this question we explore performance of cnn architectures by adding geographical information as inputs in order to answer the aforementioned questions four different cnn architectures are designed and tested the first model employs a similar architecture that was proposed by sadeghi et al 2019 on ir images the second model applies the same architecture as the first model but includes latitude and longitude information in addition to ir images our hypothesis is that importing location information through latitude and longitude inputs into a cnn model can facilitate learning the different mechanisms of precipitation over different regions of the conus for the third model the architecture utilized in model 1 and also 2 is modified with a bypass connection that transfers information from encoding downsampling layers to the decoding upsampling layers this architecture is called u net and proposed by ronneberger et al 2015 for biomedical image segmentation here we apply u net architecture on ir information to investigate the capability of this architecture for retrieving rainfall estimates our hypothesis is that some information in inputs can be lost through downsampling the images in model 1 and 2 therefore adding a bypass connection can help the model to recover that information during upsampling the fourth model applies the same u net architecture as model 3 on ir images as well as latitude and longitude information the remainder of this paper is organized as follows section 2 presents a brief description of datasets which are employed in this study section 3 explains more details regarding the different models and methodology the assessments of the proposed models are discussed in section 4 finally section 5 summarizes the main conclusions 2 data 2 1 model inputs 2 1 1 noaa goes infrared imagery the noaa climate prediction center cpc globally merged ir product was developed to provide near real time data for monitoring global precipitation janowiak et al 2001 this dataset offers near global 60 n 60 s ir data with a 4 km spatial and an hourly temporal resolution from the international constellation of operational geostationary meteorological satellites for the period from 2000 to the present the cpc ir product comprises all channel observations from several international geo satellites including meteosat 5 and meteosat 7 half hourly ir images himawari 8 hourly ir images bessho et al 2016 and goes 3 hourly ir images this dataset is accessible for public use through the climate prediction center webpage https www cpc ncep noaa gov products global precip html wpage full res html 2 1 2 combined passive microwave precipitation dataset mwcomb combined passive microwave precipitation dataset mwcomb was developed by the noaa climate prediction center this product provides precipitation estimates with an 8 km spatial and 30 min temporal resolution by averaging the calibrated pmw rain rates from individual leo satellites mwcomb combines precipitation information from multiple sensors such as dmsp ssm i noaa amsu b and trmm microwave imager weng et al 2003 joyce et al 2004 joyce and xie 2011 the mwcomb dataset can be obtained from the climate prediction center through ftp ftp cpc ncep noaa gov precip global mwcomb 30min 8km in this study we use mwcomp dataset for training the model due to the following reasons first we do not have well distributed gauge observations over some regions and oceans however the goal of the proposed model is to be implemented over both land and oceans in the future second pmw observations have the advantage of being retrieved through measuring direct microphysical information including liquid and frozen hydrometeors within the clouds however ir information is limited to indirect cloud top information since the pmw sensors are direct means of measuring precipitation utilizing less frequent pmw data to train model would help the retrieval algorithms to extend continuously over time third mwcomp is one of the most rliable satellite based dataset which have been used for training many real time sattellite precipitation estimation models nguyen et al 2018a 2 2 observation and baseline datasets 2 2 1 ncep stage iv qpe product national centers for environmental prediction ncep stage iv is a national multi sensor real time gauge and wsr 88d radar product covering the conus this product merges data from 140 radars and around 5500 rain gauges over the conus lin and mitchell 2005 stage iv was produced as a 4 km 4 km gridded product available over the hydrologic rainfall analysis project hrap national grid system at hourly 6 hourly and 24 hourly intervals precipitation estimates derived from the a variety of sensors at the 12 regional national weather service nws river forecast centers rfcs are subject to manual quality control and then mosaicked under the supervision of ncep lin and mitchell 2005 continued efforts are made to investigate the development processing and improvement of stage iv concerning moderate to heavy rainfall events prat and nelson 2015 the ncep stage iv is widely considered as the best gridded precipitation dataset over the conus due to its extensive quality control procedures smalley et al 2014 mehran and aghakouchak 2014 due to its long history and consistency of data production over conus stage iv has been widely used in many previous satellite qpe quantitative precipitation estimation comparisons such as trmm cmorph and persiann chen et al 2013 mehran and aghakouchak 2014 beck et al 2019 aghakouchak et al 2011 stage iv data is available at https www emc ncep noaa gov mmb ylin pcpanl stage4 in this study the daily temporal resolution of ncep stage iv data are used as benchmarks for evaluating the performance of persiann ccs and cnn based models 2 2 2 baseline model persiann ccs the persiann ccs product provides the near real time global precipitation estimates at 0 04 spatial resolution and half hourly temporal resolution hong et al 2004 this operational precipitation product has been developed at chrs and implemented as a part of nasa global precipitation measurement gpm integrated multi satellite retrievals for gpm imerg huffman et al 2015 the persiann ccs dataset is accessible through the chrs data portal http chrsdata eng uci edu 3 methodology 3 1 convolutional neural network 3 1 1 building blocks of a cnn architecture a typical cnn network is generally comprised of three types of layers namely the convolution layers the pooling layers and one or more fully connected layers at the end the arrangement of cnn components plays a vital role in achieving the sustained high performance model 1 convolutional layers convolution layers are the most important components of a cnn that extract features from input images or feature maps from previous layers through filters in the image domain filters are an array of numbers which are called learnable weights that determine the type of information to be extracted each of those filters is independently convolved followed by a nonlinear transformation activation function to generate the feature maps which serve as inputs for the next layer 2 pooling layers a convolutional layer is mostly followed by a pooling layer also called subsampling layer the pooling layers reduce the dimensions of the input layer through some local non linear operations such as average pooling and max pooling which are the most common operations the average pooling calculates the average of the elements within the window to form the feature maps while max pooling uses the maximum element within the window to form the output layer the pooling operations result in the resolution of the feature maps becoming coarser this can help the next convolution layer to extract high level representations of the input data in a cnn model furthermore the pooling layers reduce the number of subsequent learnable parameters to decrease the computation time and to control the over fitting in the network 3 fully connected layers the fully connected layers are typically used as the last few layers of a cnn model these layers summarize the information from all hidden units in the previous layer to make the final decision 3 1 2 training a cnn training a network is the process of finding learnable parameters i e kernels and weights by minimizing the difference between the model prediction and given a truth dataset in the first step the input data under initial kernels and weights are transformed into the final output through the discussed layers in a cnn architecture then the model is trained by updating the learnable parameters with a backpropagation algorithm where the loss function and gradient descent algorithm play vital roles the loss function measures the differences between model output and truth observation while a gradient descent optimization algorithm is used to iteratively update the learnable parameters to minimize the loss yamashita et al 2018 3 2 four different cnn architectures for precipitation estimation 3 2 1 overview of layers fig 1 a depicts a convolutional encoder decoder architecture that was used by sadeghi et al 2019 for near real time precipitation estimation over the central united states 30 45 n 90 105 w using ir and water vapor images this convolutional encoder decoder architecture consists of an encoder contracting section on the left side a bottleneck section in the middle and a decoder expansive section on the right side the encoder section follows the typical architecture of a cnn network it consists of applying two 5 5 padded convolutions with a rectified linear unit relu as activation function and a 2 2 max pooling operation for downsampling the number of feature maps doubles at each downsampling step so that the architecture can learn the complex structures effectively the bottleneck section mediates between contraction and expansion sections and is made of two 5 5 padded convolutions followed by a relu activation function the decoder section consists of several expansion blocks for upsamling the feature maps each expansion block passes the feature maps to two 5 5 padded convolutions followed by a 2x2 convolution transpose function up convolution in each block the number of feature maps of the first convolution layer is reduced by half through the second convolution to maintain symmetry at the final layer a convolution is used to map each 32 component feature vector to the final output which is rainfall estimates with the same size as input s in this work we train and test the proposed encoder decoder architecture using ir images model 1 as well as using ir and latitude and longitude information model 2 the water vapor information that was used in sadeghi et al 2019 model is not included in these models due to two reasons first the water vapor information unlike ir information is not available globally here we want to investigate capabilities of a cnn based model for reliably estimating the rain rate based on only ir images for its future global implementation second the operational persiann ccs algorithm utilizes only ir information for its rain rate estimation for a fair comparison we train and test a cnn based model that leverage only ir images as input in the second model we input location information through adding latitude and longitude inputs to the same architecture used in model 1 to investigate whether it can improve the performance of the model s estimations the hypothesis is that importing location information as inputs can facilitate training a cnn based model to learn the various mechanisms of precipitation over the study area fig 1 b illustrates a u net convolutional architecture similar to that proposed by ronneberger et al 2015 for biomedical image segmentation the u net architecture that we use for training model 3 with ir input and model 4 with ir latitude and longitude inputs has the same layers to the convolutional encoder decoder architecture shown in fig 1 a the only difference in these two architectures can be seen in the decoder section of u net architecture where the outputs of the upsampling layer are appended by feature maps of the corresponding encoder layer copy and concatenate the neurons in the first two hidden layers view only a small image window to learn low level detailed features then the size of the input information is reduced gradually in the encoder side in order to help a cnn based model to view a larger portion of the image to extract high level features context and to efficiently leverage the neighborhood information however some of the information is lost during this process in an encoder decoder architecture the u net architecture overcomes this problem by transferring the information from each encoding layer and concatenating it to a corresponding decoding layer to recover the features that are lost in the encoder side this action helps a u net model to learn more expressive features by combing the low level and high level features in an efficient manner we explore the performance of a u net convolutional architecture against a convolutional encoder decoder architecture that was used by sadeghi et al 2019 for near real time precipitation estimation 3 2 2 parameter tuning the inputs and target datasets are divided into the training validation and test periods the four proposed models are trained and validated separately for summer june august of 2013 2014 and 2015 using the mwcomb dataset as the target during the training and validating procedures of the cnn models we used 80 of the samples to learn the weights and biases of neurons in each model training procedure the remaining 20 of the samples was used for validating procedure to find the hyperparameters and the proper architecture the training and validating procedures are vital to optimize the model parameters and also prevent overfitting chen et al 2016 then the summer of 2017 is used for testing the proposed models to choose the best model through comparing all the proposed models with the ncep stage iv radar observation as a reference then the performance of the best model referred to as persiann cnn is compared with persiann ccs against the ncep stage iv radar dataset during both summer and winter october december of 2017 and for an extreme event hurricane harvey 2017 the proposed models were implemented in tensorflow python platform abadi et al 2016 to speed up the training process the models were run on a graphics processing units gpu and a compute unified device architecture cuda the training process starts with selecting initial parameter values then applies the backpropagation algorithm to adjust the parameters in order to minimize the loss function using a gradient descent algorithm erhan et al 2010 in the current study the initial values were randomly chosen from a normal distribution then the adam gradient based optimizer was utilized for minimizing the loss function which was determined by calculating the mean square error mse between the simulated and observed precipitation hyperparameters are the variables which determine the structure of a cnn model e g number of hidden units neuron size and the variables which determine how the cnn network is trained e g learning rate batch size epoch size in the current study we tested different combinations of the hyperparameters for each of the proposed models to optimize their learning parameters also an early stopping criterion was implemented that halted the training if the mse values did not improve after 10 epochs in addition to further reduce overfitting problems the dropout method with varies ratio for different layers is adapted in this study we found that the learning rate of 0 001 the minibatch size of 32 and epoch size of 75 leads the best performance for the proposed models 3 3 performance measurements 3 3 1 categorical evaluation metrics to evaluate the ability of persiann ccs and cnn based models in detecting rain no rain pixels categorical evaluation metrics are utilized statistics metrics in this category include the probability of detection also called hit rate pod false alarm ratio far and the critical success index csi which are calculated by the following equations equations 1 3 1 pod tp tp fn range from 0 to 1 perfect value 1 2 far fp tp fn range from 0 to 1 perfect value 0 3 csi tp tp fp fn range from 0 to 1 perfect value 1 where tp number of true positive events number of pixels correctly classified as rain fp number of false positive events number of pixels incorrectly classified as rain fn number of false negative events number of pixels incorrectly classified as no rain 3 3 2 continuous evaluation metrics to evaluate the performance of persiann ccs and cnn based models against ncep stage iv in estimating the rainfall intensity continuous evaluation metrics are calculated these statistical metrics include root mean square error rmse correlation coefficient cc and mean absolute error mae which are given below equations 4 6 4 rmse 1 n i 1 n s i m i r e f i 2 5 cc 1 n i 1 n s i m i s i m i r e f i r e f i σ s i m σ r e f 6 mae 1 n i 1 n s i m i r e f i where sim simulation persiann ccs cnn based models ref reference observation ncep stage iv n number of observations σ standard deviation 4 results and discussion 4 1 evaluating the performance of the 4 designed models at an hourly scale in this section the performance of the designed models described in the methodology section fig 1 is evaluated over the continental united states conus fig 2 indicates the spatial distribution of each model with reference to the ncep stage iv radar observation over summer 2017 in general model 4 which applies the u net architecture on ir information along with latitude and longitude has performed substantially better compared to other models according to all performance metrics in addition comparing model 1 without leveraging latitude and longitude as inputs and model 2 with leveraging latitude and longitude as inputs which both apply an identical cnn architecture indicates that adding geographical information can improve the performance of a cnn based model for estimating the near real time precipitation in terms of pod and csi model 2 outperformed model 1 by 25 and 13 respectively however model 2 performed poorer than model 1 by 38 in terms of far despite the lower performance of model 2 for far compared to model 1 model 2 has performed more homogeneously and consistently over the conus this highlights that a cnn based model can learn the different mechanisms of rainfall occurring in different regions over the conus by adding latitude and longitude as inputs for rmse and mae model 2 was more accurate than model 1 by 1 and 19 respectively comparing model 3 and 4 which both apply an identical u net architecture on different inputs also supports the previous finding that adding geographical inputs can improve the accuracy of a cnn based model for precipitation estimation furthermore model 4 outperformed in all representative evaluations including far comparing model 1 architecture a in fig 1 with model 3 architecture b in fig 1 which use different architectures on the same inputs reveals that the u net architecture can significantly improve the performance of cnn models compared to the architecture employed by sadeghi et al 2019 more specifically model 3 outperformed model 1 by 16 12 and 19 in terms of pod far and csi demonstrating the detection skill of the u net architecture furthermore rmse and mae of model 3 were lower than model 1 by 8 and 10 demonstrating the estimation accuracy of the u net model comparing model 2 and 4 which also utilize two different architectures discussed in fig 1 also supports the outperformance of the u net architecture for estimating precipitation it could be concluded that adding bypass connections between encoding layer and decoder layers in u net can recover the lost information during the execution of the upsampling layers this feature of u net makes it to more efficient and effective in both detecting the rain no rain pixels and estimating the rain rate fig 2 shows that all of the designed models have a similar performance pattern for evaluation metrics but model 4 achieved better agreement with that of ncep stage iv as the reference having the same cc for all models and the similarity in distribution pattern of evaluating metrics could be due to correlation between cloud top temperature and rainfall in different regions over the conus 4 2 performance evaluation of persiann cnn and persiann ccs against ncep stage iv at an hourly scale in this section the performance of the best performing cnn model model 4 persiann cnn and persiann ccs are evaluated against ncep stage iv at an hourly scale fig 3 shows the ir cloud top temperature and the rainfall estimates from the persiann cnn and the persiann ccs models for the extreme rainfall occurred at 0700 utc august 22 2017 as shown in fig 3 persiann cnn provides a more accurate representation of the pattern and intensity of the rainfall as compared to persiann ccs in addition persiann ccs only captures a small portion of the extreme rain rate where the ir cloud top temperature was the lowest assigning more rain rates to clouds with lower temperature is considered as the main drawback of most ir based precipitation retrieval algorithms such as persiann ccs in the persiann ccs algorithm the clouds are segmented based on ir cloud top temperature into distinctive cloud patches with an incremental temperature threshold itt method then all segmented cloud patches are classified into 400 category clusters based on similarity of cloud features using self organizing feature maps sofms finally a fully connected layer is utilized to find the relationship of ir cloud top temperature and rainfall rates for each classified cloud cluster the essence of the discussed shortcoming can be due to two reasons first using temperature thresholds for cloud segmentation in the persiann ccs algorithm can result in associating more rain rates to the clouds with lower temperature second using a fully connected network in the persiann ccs algorithm makes it hard to efficiently and effectively learn the rain structure to estimate the correct pattern and intensity of the rainfall due to complexity level of fully connected networks and fuzzy nature of rainfall a fully connected algorithm ends up learning to one on one pixels in most cases meaning that it trains the parameters of each pixel separately this limits a fully connected model to efficiently use the neighborhood information in most cases resulting in colder clouds showing more intense precipitation on the other hand a cnn based model such as persiann cnn can effectively leverage the local neighborhood information to estimate the rain rate for each pixel this feature is mainly due to cnn structure which allows sharing the same filter in a single layer fig 4 presents the spatial distribution of categorical pod far and csi and continuous mae rmse and cc metrics of persiann ccs and persiann cnn against ncep stage iv at an hourly scale throughout the verification period including summer and winter 2017 the verification metrics were calculated for each pixel and at an hourly temporal scale over the conus for summer and winter separately in general the results indicate that persiann cnn outperforms persiann ccs in terms of all categorical indices almost over all the conus during both summer and winter 2017 in terms of pod far and csi persiann cnn outperformed persiann ccs during summer winter by 16 10 48 68 and 73 50 respectively additionally the persiann cnn model showed the best overall performance in estimation accuracy over the verification period for rmse and cc persiann cnn was more accurate than persiann ccs during summer winter by 21 18 and 85 59 respectively in terms of mae persiann cnn performed better than persiann ccs by 47 during the summer however it performed poorer than persiann ccs by 32 during winter furthermore fig 4 suggests that the performance metrics of persiann cnn are more homogeneous and consistent compared to persiann ccs across space over the conus this spatial homogeneity which is more noticeable in spatial patterns of pod and csi can be related to the use of geographical information in the cnn based model the use of latitude and longitude as inputs in persiann cnn enables the model to learn different mechanisms of precipitations occurring over the conus resulting in showing more homogeneity and consistency in the performance metrics 4 3 performance evaluation of persiann cnn and persiann ccs against ncep stage iv at daily scale to demonstrate how a cnn based model can substantially improve the daily estimates of precipitation events an intense event is randomly selected from noticeable precipitation events within the validation period fig 5 presents the daily estimates of persiann ccs and persiann cnn against ncep stage iv for the extreme precipitation event that occurred on 25 september 2017 as observable from fig 5 persiann cnn provides more accurate estimates of the rainfall intensity while persiann ccs underestimates the intense precipitation for this event to evaluate the daily performance of persiann cnn and persiann ccs against ncep stage iv throughout summer and winter the spatial distribution of categorical and continuous metrics is plotted in fig 6 the pod of the persiann cnn showed distribution patterns similar to those of the persiann ccs but the persiann cnn achieved better agreement with radar observations and with higher pods almost over the whole conus for both summer and winter this can be related to the different correlations between cloud top temperature and rainfall occurrence for different regions over the conus in terms of far persiann cnn estimated the rainfall with significantly lower far compared to persiann ccs specifically the far decreased by 69 and 58 during the summer and winter the higher values of csi also indicate that persiann cnn has a higher capability to detect rainfall compared to persiann ccs during both summer and winter in term of continuous metrics rmse of the daily rainfall estimates for persiann cnn with respect to ncep stage iv were lower than that of persiann ccs by 20 and 15 during summer and winter respectively in terms of mae persiann cnn and persiann ccs estimates have similar distributions to rmse index also the cc of persiann cnn is significantly higher by 140 and 38 than that of persiann ccs over summer and winter showing the higher estimation accuracy of persiann cnn compared to persiann ccs for daily precipitation estimation 4 4 case study hurricane harvey to further evaluate the performance of persiann cnn and persiann ccs with respect to radar observations in capturing extreme precipitation hurricane harvey was studied in august 2017 hurricane harvey hit the southeastern regions of the united states mostly southeast texas and louisiana hurricane harvey is classified as a category 4 hurricane that caused catastrophic damages and is considered as one of the costliest extreme precipitation events that struck in the united states history the total damage is estimated to be more than 125 billion and it is confirmed that there were more than 68 deaths national weather service www weather gov the daily estimates of ncep stage iv persiann ccs and persiann cnn for the extreme precipitation that occurred between august 26 to 30 2017 are presented in fig 7 as shown in fig 7 persiann ccs severely underestimated the rain rate particularly during august 26 29 specifically persiann ccs failed to capture most of the intense rainfalls occurred over louisiana that are observed in the reference product ncep stage iv in contrast persiann cnn estimated both spatial patterns and amounts of rainfall with a great resemblance to ncep stage iv to explore the daily performance of persiann ccs against persiann cnn at various spatial resolutions during hurricane harvey scatterplots of their daily precipitation estimates versus the radar observations are presented fig 8 these graphs demonstrate the pixel by pixel association between the simulated estimates persiann ccs or persiann cnn and the radar observations ncep stage iv for 0 04 a c and 0 25 b d spatial resolutions and at a daily time scale one can see that persiann ccs severely underestimated heavier rainfalls as evidenced by the cluster of points located below the 45 perfect correlation line in both 0 04 and 0 25 spatial resolutions during this hurricane during the described extreme event persiann cnn showed higher correlations and relatively lower rmse with respect to radar observations at both spatial resolutions this finding also highlights the better performance of persiann cnn compared to persiann ccs for accurately estimate the amount of intense extreme events 5 conclusions this study explored the application of a cnn based architecture which utilizes geographical and ir information for detecting and estimating near real time precipitation specifically this study was designed to investigate whether adding latitude and longitude information to ir information can improve the near real time precipitation estimates also we explored two different cnn based architectures to show the effectiveness of applying a u net architecture compared to the precipitation retrieval algorithm introduced by sadeghi et al 2019 for this purpose four different cnn based models were trained at hourly temporal and 0 04 0 04 spatial resolution over the conus using a combined pmw precipitation dataset then these models were evaluated against ncep stage iv radar observation to investigate the effectiveness of adding geographical information and using u net architecture for precipitation estimation the higher performance of models leveraging geographical information highlights that this additional information can help cnn based models to learn the different mechanisms of rainfall occurring in different regions over the conus during the training process in addition a u net architecture can significantly improve the accuracy of estimates compared to the cnn based model developed by sadeghi et al 2019b in particular we concluded that adding bypass connections between downscaling and upscaling layers in u net architecture helps to recover the lost information during upscaling parts of a cnn model lacking those connections the performance of the model which applies u net architecture on ir and geographical information referred to as persiann cnn was tested against persiann ccs at hourly and daily scales over summer and winter model evaluation procedures indicated that persiann cnn outperforms persiann ccs in capturing the pattern of precipitation detecting rain no rain and estimating the intensity of rainfall throughout the whole verification period at an hourly scale persiann cnn outperformed persiann ccs by 73 and 50 in the csi during summer and winter showing the detection skills of the proposed model in addition the rmse of the rainfall estimates with respect to the ncep stage iv radar observation for persiann cnn was lower than that of persiann ccs by 21 18 demonstrating the estimation accuracy of the persiann cnn daily evaluations indicated that persiann cnn outperformed persiann ccs in terms of pod far and csi during summer winter by 23 4 69 58 and 64 11 respectively for rmse mae and cc persiann cnn was more accurate than persiann ccs during summer winter by 20 10 21 16 and 140 38 respectively the performance of persiann cnn and persiann ccs in estimating the extreme precipitation was assessed for hurricane harvey 2017 the results showed that persiann cnn estimates rainfall intensity with a great resemblance to ncep stage iv while persiann ccs underestimates the intensity occurred over the louisiana state during the hurricane these results highlight that the proposed model has the potential to be used in early warning systems to mitigate natural disasters related to intense storm events such as hurricanes this study creates a promising opportunity for improving the near real time satellite based precipitation estimation datasets furthermore due to availability of global ir information back to approximately 1983 there is a great potential for developing a high spatial resolution climate data record using the proposed model expanding on the research presented here researchers at the center for hydrometeorology and remote sensing chrs are working on global implementation of the proposed model one of the challenges for global implementing of the proposed model is training over the regions with little pmw information addressing this challenge requires further investigation author contributions conceptualization m s p n k h and s s methodology m s software m s validation m s formal analysis m s investigation m s resources m s p n data curation m s writing original draft preparation m s visualization m s supervision s s k h and p n project administration m s software and data availability programming languages matlab r2019a version 9 6 0 for data processing and keras version 2 2 5 as an open source neural network library written in python version 3 7 3 all codes are uploaded on github and are publicly available through https github com mojtabasadeghi77 ems codes data availability the following datasets are used in this manuscript 1 noaa goes infrared imagery this dataset is accessible for public use through the climate prediction center webpage https www cpc ncep noaa gov products global precip html wpage full res html 2 combined passive microwave precipitation dataset mwcomb the mwcomb dataset can be obtained from the climate prediction center through ftp ftp cpc ncep noaa gov precip global mwcomb 30min 8km 3 ncep stage iv qpe product stage iv data is available at national oceanic and atmospheric administration website https www emc ncep noaa gov mmb ylin pcpanl stage4 4 precipitation estimation from remotely sensed information using artificial neural networks cloud classification system persiann ccs the persiann ccs dataset is accessible through the chrs data portal http chrsdata eng uci edu declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the financial support of this research is from the u s department of energy doe prime award de ia0000018 the california energy commission cec award 300 15 005 university of california 4600010378 to15 am 22 maseeh fellowship noaa nesdis ncdc prime award na09nes4400006 and ncsu cics and subaward 2009 1380 01 and the national oceanic and atmospheric administration st133017cq0058 with riverside technology inc also supports from office vice chancellor for research of graduate students is acknowledged appendix a supplementary data the following is the supplementary data to this article multimedia component 1 multimedia component 1 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j envsoft 2020 104856 
25927,reliable near real time precipitation estimates are essential for monitoring and managing of natural disasters such as floods quality of inputs and capability of the retrieval algorithm are two important aspects for developing satellite based precipitation datasets most retrieval algorithms utilize infrared ir information as their input due to its fine spatiotemporal resolution and near instantaneous availability however their sole reliance on ir information limits their capability to learn different mechanisms of precipitation during training resulting in less accurate estimates moreover recent advances in the field of machine learning offer attractive opportunities to improve the precipitation retrieval algorithms this study investigates the effectiveness of adding geographical information i e latitude and longitude to ir information and the application of a u net based convolutional neural network for improving the accuracy of retrieval algorithms this research suggests that applying an appropriate cnn architecture on geographical and ir information provides an opportunity to improve the satellite based precipitation products graphical abstract image 1 keywords infrared information precipitation estimation deep learning convolutional neural networks 1 introduction and background precipitation is one of the major driving components for the global hydrological cycle and is a key component for regulating the climate system kidd and levizzani 2011 trenberth et al 2003 oki and kanae 2006 reliable estimation of precipitation at fine spatial and temporal resolutions is vital for many hydro meteorological applications including developing early warning systems and disaster management strategies as well as conducting climatological studies on both global and regional scales hou and coauthors 2014 mehran and aghakouchak 2014 nguyen et al 2018b 2015 sadeghi et al 2019c there are various methods of precipitation measurements including rain gauges radar networks and satellite instruments ground based rain gauge networks which directly measure precipitation at the earth s surface are the most widely used methods for providing long term precipitation records yilmaz et al 2005 sadeghi 2018 however the spatial distribution of ground based gauge networks is uneven and sparse over the world especially over oceanic and remote regions xie and arkin 1997 sun et al 2018 maggioni et al 2016 awange et al 2019 furthermore extending point measurements to gridded precipitation is a common source of uncertainty which limits the development of high resolution precipitation datasets villarini et al 2008 xu et al 2017b wood et al 2000 radar networks which can provide real time measurements at high spatiotemporal resolution are another alternative to ground based rain gauges kitzmiller et al 2013 price et al 2014 sivasubramaniam et al 2019 however the high installation and maintenance costs along with the difficulties in accessibility over remote regions have limited the establishment of a global radar network habib et al 2012 westrick et al 1999 scofield and kuligowski 2003 with development of advanced infrared ir and microwave mw instruments satellite observations make up for these deficiencies by providing high spatial and temporal resolutions with homogeneous global coverage kidd and levizzani 2011 xie et al 2003 satellite based precipitation products have been developed based on utilizing passive microwave pmw sensors on low earth orbiting leo satellites and or visible ir vis ir sensors on geosynchronous earth orbiting geo satellites behrangi et al 2009 michaelides et al 2009 sorooshian et al 2000 geo satellites provide ir imageries with a rapid temporal cycle 30 min or less and high resolutions 4 km or less for the 24 h over the globe therefore the ir based products have the advantage of offering precipitation estimates at fine temporal and spatial resolutions over the globe vis ir precipitation estimation algorithms link the ir cloud top temperature brightness to the probability and intensity of rainfall zeng 1999 the lower the cloud top temperature the brighter clouds the higher the probability and the amount of precipitation these algorithms expect to fall arkin and meisner 1987 adler and negri 1988 this assumption results in poor performance since the relation between surface rainfall rate and cloud top temperature is indirect on the other hand pmw radiometers offer more direct methods for precipitation measurements as they can probe through most of the clouds and measure the vertical hydrometeor distribution and surface rainfall sun et al 2018 joyce et al 2004 however pmw information have lower spatial and temporal sampling two observations per day per satellite marzano et al 2004 karbalaee et al 2017 in order to take advantage of the strengths that each sensor offers some precipitation estimation algorithms combine high frequency information from geo satellites and sparsely sampled data from leo satellites these algorithms mostly serve vis ir information as fundamental sources for precipitation estimation and utilize pmw for post processing behrangi et al 2009 joyce et al 2004 turk et al 2000 miller et al 2001 sorooshian et al 2000 hsu et al 1997 levizzani et al 1996 kummerow and giglio 1995 bellerby et al 2000 for example precipitation estimation from remotely sensed information using artificial neural networks persiann utilizes ir information as the primary inputs for the artificial neural network ann model and then employs pmw information for continuously adapting the parameters of the model hsu et al 1997 sorooshian et al 2000 persiann provides hourly precipitation estimates at 0 25 spatial resolution from march 2000 to the present and is accessible at a time lag of 2 days at the center for hydrometeorology and remote sensing chrs data portal http chrsdata eng uci edu nguyen et al 2018 nguyen et al 2019 in order to increase the spatial resolution and decrease the lag time of persiann hong et al 2007 introduced a cloud patch based algorithm which is called persiann cloud classification system persiann ccs this algorithm extracts pre defined local and regional features from ir satellite imagery under specified temperature thresholds in order to estimate rainfall in four steps first ir imagery is separated into distinctive cloud patches based on different temperature thresholds using an incremental temperature threshold algorithm second cloud features including coldness texture and geometry are extracted from segmented images in the third step a self organizing feature map sofm approach is utilized in order to classify the cloud patches into well organized categories fourth historical matching is employed to develop a relationship between rain rates and cloud top temperature and then exponential regression is utilized for rain rate estimation in each pixel hong et al 2007 persiann ccs s dataset at 0 04 spatial resolution with a lag time of around an hour has been available since january 2003 in hourly time steps at the chrs data portal http chrsdata eng uci edu nguyen et al 2018a both persiann and persiann ccs extract cloud information based on manually defined features including minimum mean temperature of a cloud patch mean and standard deviation of cloud patch temperature cloud patch area and shape index and gradient of cloud top brightness temperature manual feature extraction is always biased toward the most relevant and physically obvious features that have direct impacts on precipitation occurrence due to the complexity of the precipitation phenomena there may be some other unknown factors that play crucial roles in the accuracy of the model s simulations sadeghi et al 2019 improvement of the persiann systems has been an ongoing project at chrs at university of california irvine during the last two decades sadeghi et al 2019a 2019b 2019c furthermore recent developments of machine learning ml techniques offer an exciting direction to improve the accuracy of precipitation estimation among the different ml techniques the deep neural network dnn methods have been reported to achieve high accuracy robustness efficiency and overall model performance in the field of hydrology ardabili et al 2019 sadeghi et al 2019 shen 2018 hu et al 2019 shen et al 2019 shilon et al 2019 matsuoka et al 2018 akbari asanjan et al 2018 bui et al 2020 wen et al 2019 tao et al 2016 hayatbini et al 2019 ye et al 2019 xu et al 2017a o neil et al 2020 one of the most promising features of dnn techniques is that they allow automatic feature extraction from raw data which is different from non deep methods where the useful input features must be constructed by human expertise the first attempt for applying a dnn technique to improve the performance of persiann systems is the research conducted by tao et al 2016 they employed stacked denoising autoencoders sdae to automatically extract features from the infrared ir images to estimate the amount of precipitation referred to as persiann sdae they achieved 34 and 43 corrections on false alarm pixels and 78 and 98 reductions in bias of precipitation estimates compared to persiann ccs over the validation periods of the summer and winter seasons over the central united states 30 45 n 90 105 w although the sdae algorithm like other dnn algorithms can automatically extract the features its inefficient structure limits their capability to efficiently use the neighborhood information for retrieving the rain rate since sdae layers are fully connected each output pixel is estimated based on the information from the corresponding pixel of the input datasets rather than using the information of the neighboring pixels in the same image however spatial variations in ir images can provide useful information for estimating the rain rate especially for frontal rainfall convolutional neural networks cnn are mainly designed to efficiently and automatically extract features from images cnn architectures mostly consist of convolutional layers pooling layers and fully connected layers xiao et al 2019 convolutional layers extract local features feature maps from input images pooling layers allow the model to learn spatial invariant features by reducing the size of feature maps and fully connected layers determine the most correlated features to a particular class sadeghi et al 2019 shen 2018 gu and coauthors 2018 yu and harbor 2019 the key feature of cnns is weight sharing which is achieved by sharing the same learnable filters kernels across all the image positions yamashita et al 2018 weight sharing creates the following promising characteristics of cnns 1 local features extracting while sdae layers are fully connected the convolutional and pooling layers in cnn architectures only work on a local neighborhood 2 spatial pattern learning learning spatial hierarchies of feature patterns by down sampling using the pooling operation in conjunction with convolutional operation enable the model to learn a larger field of view 3 increasing model efficiency sharing the same weight dramatically reduces the number of learning parameters compared to fully connected neural networks such as the sdae network recently sadeghi et al 2019 investigated the application of cnn in detecting and estimating the precipitation from bispectral satellite imagery ir and water vapor channels referred to as persiann cnn over the central united states 30 45 n 90 105 w their results indicated that persiann cnn outperforms persiann ccs and persiann sdae by 54 and 23 in the critical success index csi with respect to the national centers for environmental prediction ncep stage iv gauge radar data illustrating the detection skills of the cnn based model furthermore the root mean square error rmse rain rate estimates of persiann cnn against to the ncep stage iv dataset was lower than that of persiann ccs and persiann sdae by 37 and 14 demonstrating the estimation accuracy of the cnn based model for precipitation estimation in that work both persiann sdae and persiann cnn models were trained over the central united states and then compared with persiann ccs over that same region during the summer however it is unclear how the models would perform across other regions or seasons where the mechanisms of precipitation may vary therefore the first question to address is can a cnn based model outperform persiann ccs over the contiguous united states conus secondly both proposed sdae and cnn models leverage the water vapor wv information in conjunction with ir images however persiann ccs only estimates the rainfall based on ir information the next question is can a cnn based model outperform the current persiann ccs using the same input ir information the last question to investigate is how can we improve the proposed cnn based model by sadeghi et al 2019 based on the characteristics of rainfall and the features of the cnn architectures to answer this question we explore performance of cnn architectures by adding geographical information as inputs in order to answer the aforementioned questions four different cnn architectures are designed and tested the first model employs a similar architecture that was proposed by sadeghi et al 2019 on ir images the second model applies the same architecture as the first model but includes latitude and longitude information in addition to ir images our hypothesis is that importing location information through latitude and longitude inputs into a cnn model can facilitate learning the different mechanisms of precipitation over different regions of the conus for the third model the architecture utilized in model 1 and also 2 is modified with a bypass connection that transfers information from encoding downsampling layers to the decoding upsampling layers this architecture is called u net and proposed by ronneberger et al 2015 for biomedical image segmentation here we apply u net architecture on ir information to investigate the capability of this architecture for retrieving rainfall estimates our hypothesis is that some information in inputs can be lost through downsampling the images in model 1 and 2 therefore adding a bypass connection can help the model to recover that information during upsampling the fourth model applies the same u net architecture as model 3 on ir images as well as latitude and longitude information the remainder of this paper is organized as follows section 2 presents a brief description of datasets which are employed in this study section 3 explains more details regarding the different models and methodology the assessments of the proposed models are discussed in section 4 finally section 5 summarizes the main conclusions 2 data 2 1 model inputs 2 1 1 noaa goes infrared imagery the noaa climate prediction center cpc globally merged ir product was developed to provide near real time data for monitoring global precipitation janowiak et al 2001 this dataset offers near global 60 n 60 s ir data with a 4 km spatial and an hourly temporal resolution from the international constellation of operational geostationary meteorological satellites for the period from 2000 to the present the cpc ir product comprises all channel observations from several international geo satellites including meteosat 5 and meteosat 7 half hourly ir images himawari 8 hourly ir images bessho et al 2016 and goes 3 hourly ir images this dataset is accessible for public use through the climate prediction center webpage https www cpc ncep noaa gov products global precip html wpage full res html 2 1 2 combined passive microwave precipitation dataset mwcomb combined passive microwave precipitation dataset mwcomb was developed by the noaa climate prediction center this product provides precipitation estimates with an 8 km spatial and 30 min temporal resolution by averaging the calibrated pmw rain rates from individual leo satellites mwcomb combines precipitation information from multiple sensors such as dmsp ssm i noaa amsu b and trmm microwave imager weng et al 2003 joyce et al 2004 joyce and xie 2011 the mwcomb dataset can be obtained from the climate prediction center through ftp ftp cpc ncep noaa gov precip global mwcomb 30min 8km in this study we use mwcomp dataset for training the model due to the following reasons first we do not have well distributed gauge observations over some regions and oceans however the goal of the proposed model is to be implemented over both land and oceans in the future second pmw observations have the advantage of being retrieved through measuring direct microphysical information including liquid and frozen hydrometeors within the clouds however ir information is limited to indirect cloud top information since the pmw sensors are direct means of measuring precipitation utilizing less frequent pmw data to train model would help the retrieval algorithms to extend continuously over time third mwcomp is one of the most rliable satellite based dataset which have been used for training many real time sattellite precipitation estimation models nguyen et al 2018a 2 2 observation and baseline datasets 2 2 1 ncep stage iv qpe product national centers for environmental prediction ncep stage iv is a national multi sensor real time gauge and wsr 88d radar product covering the conus this product merges data from 140 radars and around 5500 rain gauges over the conus lin and mitchell 2005 stage iv was produced as a 4 km 4 km gridded product available over the hydrologic rainfall analysis project hrap national grid system at hourly 6 hourly and 24 hourly intervals precipitation estimates derived from the a variety of sensors at the 12 regional national weather service nws river forecast centers rfcs are subject to manual quality control and then mosaicked under the supervision of ncep lin and mitchell 2005 continued efforts are made to investigate the development processing and improvement of stage iv concerning moderate to heavy rainfall events prat and nelson 2015 the ncep stage iv is widely considered as the best gridded precipitation dataset over the conus due to its extensive quality control procedures smalley et al 2014 mehran and aghakouchak 2014 due to its long history and consistency of data production over conus stage iv has been widely used in many previous satellite qpe quantitative precipitation estimation comparisons such as trmm cmorph and persiann chen et al 2013 mehran and aghakouchak 2014 beck et al 2019 aghakouchak et al 2011 stage iv data is available at https www emc ncep noaa gov mmb ylin pcpanl stage4 in this study the daily temporal resolution of ncep stage iv data are used as benchmarks for evaluating the performance of persiann ccs and cnn based models 2 2 2 baseline model persiann ccs the persiann ccs product provides the near real time global precipitation estimates at 0 04 spatial resolution and half hourly temporal resolution hong et al 2004 this operational precipitation product has been developed at chrs and implemented as a part of nasa global precipitation measurement gpm integrated multi satellite retrievals for gpm imerg huffman et al 2015 the persiann ccs dataset is accessible through the chrs data portal http chrsdata eng uci edu 3 methodology 3 1 convolutional neural network 3 1 1 building blocks of a cnn architecture a typical cnn network is generally comprised of three types of layers namely the convolution layers the pooling layers and one or more fully connected layers at the end the arrangement of cnn components plays a vital role in achieving the sustained high performance model 1 convolutional layers convolution layers are the most important components of a cnn that extract features from input images or feature maps from previous layers through filters in the image domain filters are an array of numbers which are called learnable weights that determine the type of information to be extracted each of those filters is independently convolved followed by a nonlinear transformation activation function to generate the feature maps which serve as inputs for the next layer 2 pooling layers a convolutional layer is mostly followed by a pooling layer also called subsampling layer the pooling layers reduce the dimensions of the input layer through some local non linear operations such as average pooling and max pooling which are the most common operations the average pooling calculates the average of the elements within the window to form the feature maps while max pooling uses the maximum element within the window to form the output layer the pooling operations result in the resolution of the feature maps becoming coarser this can help the next convolution layer to extract high level representations of the input data in a cnn model furthermore the pooling layers reduce the number of subsequent learnable parameters to decrease the computation time and to control the over fitting in the network 3 fully connected layers the fully connected layers are typically used as the last few layers of a cnn model these layers summarize the information from all hidden units in the previous layer to make the final decision 3 1 2 training a cnn training a network is the process of finding learnable parameters i e kernels and weights by minimizing the difference between the model prediction and given a truth dataset in the first step the input data under initial kernels and weights are transformed into the final output through the discussed layers in a cnn architecture then the model is trained by updating the learnable parameters with a backpropagation algorithm where the loss function and gradient descent algorithm play vital roles the loss function measures the differences between model output and truth observation while a gradient descent optimization algorithm is used to iteratively update the learnable parameters to minimize the loss yamashita et al 2018 3 2 four different cnn architectures for precipitation estimation 3 2 1 overview of layers fig 1 a depicts a convolutional encoder decoder architecture that was used by sadeghi et al 2019 for near real time precipitation estimation over the central united states 30 45 n 90 105 w using ir and water vapor images this convolutional encoder decoder architecture consists of an encoder contracting section on the left side a bottleneck section in the middle and a decoder expansive section on the right side the encoder section follows the typical architecture of a cnn network it consists of applying two 5 5 padded convolutions with a rectified linear unit relu as activation function and a 2 2 max pooling operation for downsampling the number of feature maps doubles at each downsampling step so that the architecture can learn the complex structures effectively the bottleneck section mediates between contraction and expansion sections and is made of two 5 5 padded convolutions followed by a relu activation function the decoder section consists of several expansion blocks for upsamling the feature maps each expansion block passes the feature maps to two 5 5 padded convolutions followed by a 2x2 convolution transpose function up convolution in each block the number of feature maps of the first convolution layer is reduced by half through the second convolution to maintain symmetry at the final layer a convolution is used to map each 32 component feature vector to the final output which is rainfall estimates with the same size as input s in this work we train and test the proposed encoder decoder architecture using ir images model 1 as well as using ir and latitude and longitude information model 2 the water vapor information that was used in sadeghi et al 2019 model is not included in these models due to two reasons first the water vapor information unlike ir information is not available globally here we want to investigate capabilities of a cnn based model for reliably estimating the rain rate based on only ir images for its future global implementation second the operational persiann ccs algorithm utilizes only ir information for its rain rate estimation for a fair comparison we train and test a cnn based model that leverage only ir images as input in the second model we input location information through adding latitude and longitude inputs to the same architecture used in model 1 to investigate whether it can improve the performance of the model s estimations the hypothesis is that importing location information as inputs can facilitate training a cnn based model to learn the various mechanisms of precipitation over the study area fig 1 b illustrates a u net convolutional architecture similar to that proposed by ronneberger et al 2015 for biomedical image segmentation the u net architecture that we use for training model 3 with ir input and model 4 with ir latitude and longitude inputs has the same layers to the convolutional encoder decoder architecture shown in fig 1 a the only difference in these two architectures can be seen in the decoder section of u net architecture where the outputs of the upsampling layer are appended by feature maps of the corresponding encoder layer copy and concatenate the neurons in the first two hidden layers view only a small image window to learn low level detailed features then the size of the input information is reduced gradually in the encoder side in order to help a cnn based model to view a larger portion of the image to extract high level features context and to efficiently leverage the neighborhood information however some of the information is lost during this process in an encoder decoder architecture the u net architecture overcomes this problem by transferring the information from each encoding layer and concatenating it to a corresponding decoding layer to recover the features that are lost in the encoder side this action helps a u net model to learn more expressive features by combing the low level and high level features in an efficient manner we explore the performance of a u net convolutional architecture against a convolutional encoder decoder architecture that was used by sadeghi et al 2019 for near real time precipitation estimation 3 2 2 parameter tuning the inputs and target datasets are divided into the training validation and test periods the four proposed models are trained and validated separately for summer june august of 2013 2014 and 2015 using the mwcomb dataset as the target during the training and validating procedures of the cnn models we used 80 of the samples to learn the weights and biases of neurons in each model training procedure the remaining 20 of the samples was used for validating procedure to find the hyperparameters and the proper architecture the training and validating procedures are vital to optimize the model parameters and also prevent overfitting chen et al 2016 then the summer of 2017 is used for testing the proposed models to choose the best model through comparing all the proposed models with the ncep stage iv radar observation as a reference then the performance of the best model referred to as persiann cnn is compared with persiann ccs against the ncep stage iv radar dataset during both summer and winter october december of 2017 and for an extreme event hurricane harvey 2017 the proposed models were implemented in tensorflow python platform abadi et al 2016 to speed up the training process the models were run on a graphics processing units gpu and a compute unified device architecture cuda the training process starts with selecting initial parameter values then applies the backpropagation algorithm to adjust the parameters in order to minimize the loss function using a gradient descent algorithm erhan et al 2010 in the current study the initial values were randomly chosen from a normal distribution then the adam gradient based optimizer was utilized for minimizing the loss function which was determined by calculating the mean square error mse between the simulated and observed precipitation hyperparameters are the variables which determine the structure of a cnn model e g number of hidden units neuron size and the variables which determine how the cnn network is trained e g learning rate batch size epoch size in the current study we tested different combinations of the hyperparameters for each of the proposed models to optimize their learning parameters also an early stopping criterion was implemented that halted the training if the mse values did not improve after 10 epochs in addition to further reduce overfitting problems the dropout method with varies ratio for different layers is adapted in this study we found that the learning rate of 0 001 the minibatch size of 32 and epoch size of 75 leads the best performance for the proposed models 3 3 performance measurements 3 3 1 categorical evaluation metrics to evaluate the ability of persiann ccs and cnn based models in detecting rain no rain pixels categorical evaluation metrics are utilized statistics metrics in this category include the probability of detection also called hit rate pod false alarm ratio far and the critical success index csi which are calculated by the following equations equations 1 3 1 pod tp tp fn range from 0 to 1 perfect value 1 2 far fp tp fn range from 0 to 1 perfect value 0 3 csi tp tp fp fn range from 0 to 1 perfect value 1 where tp number of true positive events number of pixels correctly classified as rain fp number of false positive events number of pixels incorrectly classified as rain fn number of false negative events number of pixels incorrectly classified as no rain 3 3 2 continuous evaluation metrics to evaluate the performance of persiann ccs and cnn based models against ncep stage iv in estimating the rainfall intensity continuous evaluation metrics are calculated these statistical metrics include root mean square error rmse correlation coefficient cc and mean absolute error mae which are given below equations 4 6 4 rmse 1 n i 1 n s i m i r e f i 2 5 cc 1 n i 1 n s i m i s i m i r e f i r e f i σ s i m σ r e f 6 mae 1 n i 1 n s i m i r e f i where sim simulation persiann ccs cnn based models ref reference observation ncep stage iv n number of observations σ standard deviation 4 results and discussion 4 1 evaluating the performance of the 4 designed models at an hourly scale in this section the performance of the designed models described in the methodology section fig 1 is evaluated over the continental united states conus fig 2 indicates the spatial distribution of each model with reference to the ncep stage iv radar observation over summer 2017 in general model 4 which applies the u net architecture on ir information along with latitude and longitude has performed substantially better compared to other models according to all performance metrics in addition comparing model 1 without leveraging latitude and longitude as inputs and model 2 with leveraging latitude and longitude as inputs which both apply an identical cnn architecture indicates that adding geographical information can improve the performance of a cnn based model for estimating the near real time precipitation in terms of pod and csi model 2 outperformed model 1 by 25 and 13 respectively however model 2 performed poorer than model 1 by 38 in terms of far despite the lower performance of model 2 for far compared to model 1 model 2 has performed more homogeneously and consistently over the conus this highlights that a cnn based model can learn the different mechanisms of rainfall occurring in different regions over the conus by adding latitude and longitude as inputs for rmse and mae model 2 was more accurate than model 1 by 1 and 19 respectively comparing model 3 and 4 which both apply an identical u net architecture on different inputs also supports the previous finding that adding geographical inputs can improve the accuracy of a cnn based model for precipitation estimation furthermore model 4 outperformed in all representative evaluations including far comparing model 1 architecture a in fig 1 with model 3 architecture b in fig 1 which use different architectures on the same inputs reveals that the u net architecture can significantly improve the performance of cnn models compared to the architecture employed by sadeghi et al 2019 more specifically model 3 outperformed model 1 by 16 12 and 19 in terms of pod far and csi demonstrating the detection skill of the u net architecture furthermore rmse and mae of model 3 were lower than model 1 by 8 and 10 demonstrating the estimation accuracy of the u net model comparing model 2 and 4 which also utilize two different architectures discussed in fig 1 also supports the outperformance of the u net architecture for estimating precipitation it could be concluded that adding bypass connections between encoding layer and decoder layers in u net can recover the lost information during the execution of the upsampling layers this feature of u net makes it to more efficient and effective in both detecting the rain no rain pixels and estimating the rain rate fig 2 shows that all of the designed models have a similar performance pattern for evaluation metrics but model 4 achieved better agreement with that of ncep stage iv as the reference having the same cc for all models and the similarity in distribution pattern of evaluating metrics could be due to correlation between cloud top temperature and rainfall in different regions over the conus 4 2 performance evaluation of persiann cnn and persiann ccs against ncep stage iv at an hourly scale in this section the performance of the best performing cnn model model 4 persiann cnn and persiann ccs are evaluated against ncep stage iv at an hourly scale fig 3 shows the ir cloud top temperature and the rainfall estimates from the persiann cnn and the persiann ccs models for the extreme rainfall occurred at 0700 utc august 22 2017 as shown in fig 3 persiann cnn provides a more accurate representation of the pattern and intensity of the rainfall as compared to persiann ccs in addition persiann ccs only captures a small portion of the extreme rain rate where the ir cloud top temperature was the lowest assigning more rain rates to clouds with lower temperature is considered as the main drawback of most ir based precipitation retrieval algorithms such as persiann ccs in the persiann ccs algorithm the clouds are segmented based on ir cloud top temperature into distinctive cloud patches with an incremental temperature threshold itt method then all segmented cloud patches are classified into 400 category clusters based on similarity of cloud features using self organizing feature maps sofms finally a fully connected layer is utilized to find the relationship of ir cloud top temperature and rainfall rates for each classified cloud cluster the essence of the discussed shortcoming can be due to two reasons first using temperature thresholds for cloud segmentation in the persiann ccs algorithm can result in associating more rain rates to the clouds with lower temperature second using a fully connected network in the persiann ccs algorithm makes it hard to efficiently and effectively learn the rain structure to estimate the correct pattern and intensity of the rainfall due to complexity level of fully connected networks and fuzzy nature of rainfall a fully connected algorithm ends up learning to one on one pixels in most cases meaning that it trains the parameters of each pixel separately this limits a fully connected model to efficiently use the neighborhood information in most cases resulting in colder clouds showing more intense precipitation on the other hand a cnn based model such as persiann cnn can effectively leverage the local neighborhood information to estimate the rain rate for each pixel this feature is mainly due to cnn structure which allows sharing the same filter in a single layer fig 4 presents the spatial distribution of categorical pod far and csi and continuous mae rmse and cc metrics of persiann ccs and persiann cnn against ncep stage iv at an hourly scale throughout the verification period including summer and winter 2017 the verification metrics were calculated for each pixel and at an hourly temporal scale over the conus for summer and winter separately in general the results indicate that persiann cnn outperforms persiann ccs in terms of all categorical indices almost over all the conus during both summer and winter 2017 in terms of pod far and csi persiann cnn outperformed persiann ccs during summer winter by 16 10 48 68 and 73 50 respectively additionally the persiann cnn model showed the best overall performance in estimation accuracy over the verification period for rmse and cc persiann cnn was more accurate than persiann ccs during summer winter by 21 18 and 85 59 respectively in terms of mae persiann cnn performed better than persiann ccs by 47 during the summer however it performed poorer than persiann ccs by 32 during winter furthermore fig 4 suggests that the performance metrics of persiann cnn are more homogeneous and consistent compared to persiann ccs across space over the conus this spatial homogeneity which is more noticeable in spatial patterns of pod and csi can be related to the use of geographical information in the cnn based model the use of latitude and longitude as inputs in persiann cnn enables the model to learn different mechanisms of precipitations occurring over the conus resulting in showing more homogeneity and consistency in the performance metrics 4 3 performance evaluation of persiann cnn and persiann ccs against ncep stage iv at daily scale to demonstrate how a cnn based model can substantially improve the daily estimates of precipitation events an intense event is randomly selected from noticeable precipitation events within the validation period fig 5 presents the daily estimates of persiann ccs and persiann cnn against ncep stage iv for the extreme precipitation event that occurred on 25 september 2017 as observable from fig 5 persiann cnn provides more accurate estimates of the rainfall intensity while persiann ccs underestimates the intense precipitation for this event to evaluate the daily performance of persiann cnn and persiann ccs against ncep stage iv throughout summer and winter the spatial distribution of categorical and continuous metrics is plotted in fig 6 the pod of the persiann cnn showed distribution patterns similar to those of the persiann ccs but the persiann cnn achieved better agreement with radar observations and with higher pods almost over the whole conus for both summer and winter this can be related to the different correlations between cloud top temperature and rainfall occurrence for different regions over the conus in terms of far persiann cnn estimated the rainfall with significantly lower far compared to persiann ccs specifically the far decreased by 69 and 58 during the summer and winter the higher values of csi also indicate that persiann cnn has a higher capability to detect rainfall compared to persiann ccs during both summer and winter in term of continuous metrics rmse of the daily rainfall estimates for persiann cnn with respect to ncep stage iv were lower than that of persiann ccs by 20 and 15 during summer and winter respectively in terms of mae persiann cnn and persiann ccs estimates have similar distributions to rmse index also the cc of persiann cnn is significantly higher by 140 and 38 than that of persiann ccs over summer and winter showing the higher estimation accuracy of persiann cnn compared to persiann ccs for daily precipitation estimation 4 4 case study hurricane harvey to further evaluate the performance of persiann cnn and persiann ccs with respect to radar observations in capturing extreme precipitation hurricane harvey was studied in august 2017 hurricane harvey hit the southeastern regions of the united states mostly southeast texas and louisiana hurricane harvey is classified as a category 4 hurricane that caused catastrophic damages and is considered as one of the costliest extreme precipitation events that struck in the united states history the total damage is estimated to be more than 125 billion and it is confirmed that there were more than 68 deaths national weather service www weather gov the daily estimates of ncep stage iv persiann ccs and persiann cnn for the extreme precipitation that occurred between august 26 to 30 2017 are presented in fig 7 as shown in fig 7 persiann ccs severely underestimated the rain rate particularly during august 26 29 specifically persiann ccs failed to capture most of the intense rainfalls occurred over louisiana that are observed in the reference product ncep stage iv in contrast persiann cnn estimated both spatial patterns and amounts of rainfall with a great resemblance to ncep stage iv to explore the daily performance of persiann ccs against persiann cnn at various spatial resolutions during hurricane harvey scatterplots of their daily precipitation estimates versus the radar observations are presented fig 8 these graphs demonstrate the pixel by pixel association between the simulated estimates persiann ccs or persiann cnn and the radar observations ncep stage iv for 0 04 a c and 0 25 b d spatial resolutions and at a daily time scale one can see that persiann ccs severely underestimated heavier rainfalls as evidenced by the cluster of points located below the 45 perfect correlation line in both 0 04 and 0 25 spatial resolutions during this hurricane during the described extreme event persiann cnn showed higher correlations and relatively lower rmse with respect to radar observations at both spatial resolutions this finding also highlights the better performance of persiann cnn compared to persiann ccs for accurately estimate the amount of intense extreme events 5 conclusions this study explored the application of a cnn based architecture which utilizes geographical and ir information for detecting and estimating near real time precipitation specifically this study was designed to investigate whether adding latitude and longitude information to ir information can improve the near real time precipitation estimates also we explored two different cnn based architectures to show the effectiveness of applying a u net architecture compared to the precipitation retrieval algorithm introduced by sadeghi et al 2019 for this purpose four different cnn based models were trained at hourly temporal and 0 04 0 04 spatial resolution over the conus using a combined pmw precipitation dataset then these models were evaluated against ncep stage iv radar observation to investigate the effectiveness of adding geographical information and using u net architecture for precipitation estimation the higher performance of models leveraging geographical information highlights that this additional information can help cnn based models to learn the different mechanisms of rainfall occurring in different regions over the conus during the training process in addition a u net architecture can significantly improve the accuracy of estimates compared to the cnn based model developed by sadeghi et al 2019b in particular we concluded that adding bypass connections between downscaling and upscaling layers in u net architecture helps to recover the lost information during upscaling parts of a cnn model lacking those connections the performance of the model which applies u net architecture on ir and geographical information referred to as persiann cnn was tested against persiann ccs at hourly and daily scales over summer and winter model evaluation procedures indicated that persiann cnn outperforms persiann ccs in capturing the pattern of precipitation detecting rain no rain and estimating the intensity of rainfall throughout the whole verification period at an hourly scale persiann cnn outperformed persiann ccs by 73 and 50 in the csi during summer and winter showing the detection skills of the proposed model in addition the rmse of the rainfall estimates with respect to the ncep stage iv radar observation for persiann cnn was lower than that of persiann ccs by 21 18 demonstrating the estimation accuracy of the persiann cnn daily evaluations indicated that persiann cnn outperformed persiann ccs in terms of pod far and csi during summer winter by 23 4 69 58 and 64 11 respectively for rmse mae and cc persiann cnn was more accurate than persiann ccs during summer winter by 20 10 21 16 and 140 38 respectively the performance of persiann cnn and persiann ccs in estimating the extreme precipitation was assessed for hurricane harvey 2017 the results showed that persiann cnn estimates rainfall intensity with a great resemblance to ncep stage iv while persiann ccs underestimates the intensity occurred over the louisiana state during the hurricane these results highlight that the proposed model has the potential to be used in early warning systems to mitigate natural disasters related to intense storm events such as hurricanes this study creates a promising opportunity for improving the near real time satellite based precipitation estimation datasets furthermore due to availability of global ir information back to approximately 1983 there is a great potential for developing a high spatial resolution climate data record using the proposed model expanding on the research presented here researchers at the center for hydrometeorology and remote sensing chrs are working on global implementation of the proposed model one of the challenges for global implementing of the proposed model is training over the regions with little pmw information addressing this challenge requires further investigation author contributions conceptualization m s p n k h and s s methodology m s software m s validation m s formal analysis m s investigation m s resources m s p n data curation m s writing original draft preparation m s visualization m s supervision s s k h and p n project administration m s software and data availability programming languages matlab r2019a version 9 6 0 for data processing and keras version 2 2 5 as an open source neural network library written in python version 3 7 3 all codes are uploaded on github and are publicly available through https github com mojtabasadeghi77 ems codes data availability the following datasets are used in this manuscript 1 noaa goes infrared imagery this dataset is accessible for public use through the climate prediction center webpage https www cpc ncep noaa gov products global precip html wpage full res html 2 combined passive microwave precipitation dataset mwcomb the mwcomb dataset can be obtained from the climate prediction center through ftp ftp cpc ncep noaa gov precip global mwcomb 30min 8km 3 ncep stage iv qpe product stage iv data is available at national oceanic and atmospheric administration website https www emc ncep noaa gov mmb ylin pcpanl stage4 4 precipitation estimation from remotely sensed information using artificial neural networks cloud classification system persiann ccs the persiann ccs dataset is accessible through the chrs data portal http chrsdata eng uci edu declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the financial support of this research is from the u s department of energy doe prime award de ia0000018 the california energy commission cec award 300 15 005 university of california 4600010378 to15 am 22 maseeh fellowship noaa nesdis ncdc prime award na09nes4400006 and ncsu cics and subaward 2009 1380 01 and the national oceanic and atmospheric administration st133017cq0058 with riverside technology inc also supports from office vice chancellor for research of graduate students is acknowledged appendix a supplementary data the following is the supplementary data to this article multimedia component 1 multimedia component 1 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j envsoft 2020 104856 
25928,projections of landscape dynamics are uncertain partly due to uncertainties in model formulations however quantitative comparative analyses of forest landscape models are lacking we conducted a systematic comparison of all forest landscape models currently applied in temperate european forests landclim treemig landis ii iland we examined the uncertainty of model projections under several future climate disturbance and dispersal scenarios and quantified uncertainties by variance partitioning while projections under past climate conditions were in good agreement with observations uncertainty under future climate conditions was high with between model biomass differences of up to 200 t ha 1 disturbances strongly influenced landscape dynamics and contributed substantially to uncertainty in model projections 25 40 of observed variance overall model differences were the main source of uncertainty explaining at least 50 of observed variance we advocate a more rigorous and systematic model evaluation and calibration and a broader use of ensemble projections to quantify uncertainties in future landscape dynamics keywords forest landscape models model comparison variance partitioning disturbances dispersal future projections 1 introduction forest landscape models flms are used to simulate the dynamics of forest ecosystems at the landscape level 102 106 ha in extent over decades to centuries he et al 2008 shifley et al 2017 climatic and edaphic conditions within landscapes can vary widely in space and time and a hallmark of flms is that they explicitly represent this variation flms typically represent climatic and edaphic variation by dividing the landscape into smaller grid cells in which regeneration growth and mortality of either height structured populations cohorts or individual trees are modelled over time as a function of both local abiotic conditions and biotic interactions e g lischke et al 2006 seidl et al 2012 in addition to local demographic processes flms explicitly simulate spatial interactions among grid cells such as seed dispersal or dynamically spreading disturbances like forest fires or insect attacks e g temperli et al 2015 the combined simulation of relatively detailed demographic processes and spatially explicit interactions is a unique characteristic of flms that distinguishes them from other model types such as forest stand models succession models or global vegetation models over the past decades several flms were developed for the simulation of temperate forest landscape dynamics these models have been successfully applied in a number of studies for instance projecting the impacts of climate change on landscape dynamics elkin et al 2013 thom et al 2017a evaluating the effects of disturbance interactions on forest structure temperli et al 2013a assessing the effects of migrational lags along latitudinal and elevation gradients epstein et al 2007 scherrer et al 2020 and analyzing the consequences of adaptive forest management at the landscape level mairota et al 2014 rammer and seidl 2015 however considerable uncertainties in the projection of forest landscape dynamics remain the scarcity of input data with high spatial resolution is one source of uncertainty as flms are spatially explicit they require input data representing the heterogeneity in environmental conditions some environmental conditions such as soil properties or the microclimate can vary considerably over short distances particularly in topographically complex landscapes and the available data often do not capture this variation in addition environmental drivers of forest dynamics also vary over time but time series data covering the extended periods that are of interest in forest landscape dynamics are often not available furthermore empirical time series of spatial data of forest composition and structure covering an entire landscape are rare it is hence common that flms are evaluated based on data at a single point in time he et al 2011 in some model applications vegetation data are also used during initialization e g to reflect past management or disturbance history and particularly shorter term simulation 150 years can be sensitive to initialization uncertainty temperli et al 2013b finally further uncertainty stems from differences in model formulations although flms are based on similar general principles their model structures vary substantially for instance regarding their spatial and temporal resolution whether individuals or cohorts are simulated at which level of detail trees are represented how mortality growth dispersal and regeneration are simulated whether specific processes such as co2 fertilization effects are considered or which and how disturbances are simulated e g lischke et al 2006 scheller et al 2007 seidl et al 2012 together these uncertainties raise questions about the robustness of the projections made with flms here we use the term robustness to indicate the similarity of the projections of different models i e the larger the differences the lower the robustness multi model comparisons can help to understand and quantify uncertainties underlying a particular model type shifley et al 2017 in some scientific fields such as climate modeling it is common to apply several models under unified conditions in ensemble simulations representing the range of possible futures and helping to quantify average trends and confidence intervals ipcc 2014 ensemble simulations can also be used to partition the observed variance among different factors diniz filho et al 2009 yip et al 2011 for example the uncertainty due to differences between models parameters and or structure can be compared to uncertainty from different scenarios simulated e g climate scenarios while such analyses have recently been carried out for other types of vegetation models e g global vegetation models nishina et al 2015 species distribution models thuiller et al 2019 they are lacking for flms here we present the first systematic comparison of all flms that are currently applied in the temperate forests of europe i e landclim schumacher et al 2004 treemig lischke et al 2006 landis ii scheller et al 2007 and iland seidl et al 2012 the aim of this comparison is twofold first we examine the robustness of model projections under several future climate disturbance and dispersal scenarios second we assess and discuss the contribution of different scenarios and model structures to overall uncertainty using variance partitioning 2 methods 2 1 study landscape the dischma valley near davos in switzerland is a subalpine valley located between 1560 and 3146 m a s l appendix a fig a 1 and characterized by steep topographic gradients mean annual temperature in davos 1560 m a s l was 3 5 c during the period 1981 2010 with an average annual precipitation sum of 1020 mm meteoswiss fig a2 soils are mainly loamy sands and sandy loams fig a3 norway spruce picea abies l karst european larch larix decidua mill and swiss stone pine pinus cembra l are the most abundant tree species in the landscape the elevation of the upper treeline is partly influenced by cattle grazing and is currently located at 2100 2200 m a s l avalanches are common and cause considerable damage to forests particularly on the northeast facing slopes of the valley fig a4 we chose the dischma valley as study landscape based on the availability of robust drivers climate substrate and disturbances by avalanches and evaluation data forest composition and structure additionally three of the four models presented here have already been applied in this or similar mountain landscapes which expedited the model set up and testing process 2 2 models and parameterizations the main characteristics of the four flms used are summarized in table 1 detailed descriptions of all models are provided in appendix b following the overview design concepts and details odd protocol grimm et al 2010 2006 appendix b also contains a detailed comparison of model characteristics table b1 the list of species parameterized in each model table b2 as well as the species parameters and state variables used in the models table b3 b10 2 3 model input data we assembled a common input data set for all models to ensure consistency and minimize differences due to contrasting driver data this input data set contained the following environmental attributes elevation m a s l slope aspect daily maximum minimum and mean temperature c daily precipitation sums mm daily radiation w m 1 effective soil depth cm soil texture class total soil water holding capacity whc cm avalanche occurrence ha 1 year 1 and annual co2 concentration ppm note that not all models require all data see attributes of grid cells in table 1 for model specific input data all attributes were spatially explicit at a resolution of 100 100 m except for co2 concentration which was spatially invariant the full dataset covered both cells that are currently forested and areas that can potentially be colonized by trees in the future e g above the current treeline all areas currently under management settlements pastures were considered to remain under the same management regime and were excluded from the simulations the total simulated area comprised 923 cells of 1 ha size fig a1 for all models that internally use a resolution finer than 1 ha the environmental attributes of each 1 ha cell were assigned to all cells contained in it this was always possible as the internal cell sizes that are being used for modeling the different ecological processes were 2 2 m 10 10 m 20 20 m 25 25 m and 100 100 m cf table 1 historic co2 concentrations from 1765 to 2010 as well as future concentrations from 2011 to 2100 for four representative concentration pathway rcp scenarios rcp2 6 rcp4 5 rcp6 0 rcp8 5 were taken from meinshausen et al 2011 topographic and soil data were time invariant topographic data were provided by swisstopo 2018 whc data i e the difference between soil water content at field capacity and permanent wilting point were taken from remund and augustin 2015 with soil texture data derived from wildi and ewald 1986 using the volumetric whc estimates for different soil textures from blume et al 2010 effective soil depth was estimated from whc and texture data fig a3 climate and avalanche data varied in space and time historic climate data grids for the years 1930 2010 were generated by spatially interpolating measurements of surrounding weather stations meteoswiss using the daymet algorithm thornton et al 1997 projected climate data grids for the years 2011 2100 were produced by downscaling climate projections of the general circulation model hadgem2 es https esg pik potsdam de projects isimip2a for all four rcps rcp2 6 rcp4 5 rcp6 0 and rcp8 5 van vuuren et al 2011 figs a5 and a6 we used the delta change method with a reference period of 1961 1990 and applied the anomalies of the projected data to the historic data increases in annual mean temperatures until 2100 ranged from 1 5 c rcp2 6 to 6 c rcp8 5 whereas annual precipitation in all climate scenarios slightly decreased by 10 fig a5 the differences between scenarios were more pronounced in summer with summer temperatures in the rcp8 5 scenario increasing by up to 10 c by 2100 and summer precipitation being noticeably lower than in the other scenarios fig a6 the spatial and temporal distribution of avalanches was estimated based on the avalanche database of the swiss avalanche institute slf which recorded avalanches with a resolution of 1 m from 1960 to 2016 for the target landscape fig a4 for this study every 1 ha cell of which at least 25 was hit by an avalanche in one year was considered disturbed avalanche data were identical for all models i e the same cells were disturbed in the same years 2 4 simulation design 2 4 1 past to present simulations in past to present simulations forest dynamics in the study landscape were simulated from ad 1100 2010 10 replicates per model climate data were used as model input from 1930 to 2010 data for the period from 1100 to 1929 were generated by randomly sampling from the period 1930 to 1950 for each replicate run co2 data were used from 1765 to 2010 with the concentration fixed to the pre industrial level of 278 ppm for years prior to 1765 we assumed that the simulated forests were not influenced by management but were disturbed by avalanches the available spatio temporal avalanche data for 1960 to 2010 were implemented as observed for the pre 1960 period we generated a randomized avalanche data set based on the location and frequency of observed avalanches hence mimicking the avalanche disturbance regime of the recent past we assumed that in cells disturbed by avalanches all trees were killed in the corresponding year we chose this approach to ensure the same implementation of avalanches in all models however this might have led to an overestimation of avalanche induced mortality in the simulations in the initial period from 1100 to 1400 a regular supply of seeds of all species table b2 to all cells was simulated to allow potential establishment of all suitable species from 1401 on only seed dispersal by established mature trees was allowed in combination with a regular seed supply to a small area at the valley entrance to allow potential immigration of species that are not present in the landscape landclim treemig and iland were initialized from bare ground meaning that the landscape was initially empty and was successively colonized by trees via the model specific dispersal and regeneration processes in landis ii each cell in the landscape was instead initialized with one year old tree cohorts of every species because the model version used in this study cannot be initialized from bare ground 2 4 2 future projections to assess and compare the climate sensitivity of the flms we simulated future forest dynamics under four climate scenarios rcp2 6 rcp4 5 rcp6 0 and rcp8 5 from 2001 to 2100 10 replicates per model all flms were initialized with the forest state the models simulated for the end of the year 2000 in the past to present runs we used the observed co2 and climate data from 2001 to 2010 and the climate scenario data from 2011 onwards as drivers figs a5 and a6 we assumed no changes in avalanche disturbance patterns in the future and generated an avalanche disturbance sequence from 2001 to 2100 by randomly drawing from the observation data from 1960 to 2016 see below for the entire simulation period seeds dispersed exclusively from established mature trees and an additional regular seed supply of all species to a restricted area at the valley entrance was simulated 2 4 3 disturbance and dispersal scenarios to compare the response of flms to different assumptions regarding dispersal and disturbance four disturbance scenarios and three dispersal scenarios were simulated for these runs we first carried out past to present simulations from 1100 to 2000 which were identical to those described above with the exception that no disturbances by avalanches were simulated to start from undisturbed conditions in all models initialized with the forest state at the end of the year 2000 each flm simulated future forest dynamics from 2001 to 2100 under all combinations of climate scenarios rcp2 6 rcp4 5 rcp6 0 rcp8 5 and disturbance scenarios dist0 no dist1 low dist2 medium dist3 high in a full factorial design the disturbance scenarios were randomly generated based on avalanche observation data from 1960 to 2016 the medium disturbance scenario mimics the observed avalanche patterns while in the low and high disturbance scenario the frequency of avalanche occurrence was altered to 10 and 200 relative to the observations respectively furthermore to elucidate the role of dispersal simulations from 2001 to 2100 were run under all combinations of four climate scenarios and three dispersal scenarios disp1 global dispersal disp2 local dispersal disp3 local dispersal with additional restricted seed supply in the global dispersal scenario corresponding to no dispersal limitations seeds of all species table b2 were supplied to all simulated cells regardless of the location of mature trees in the landscape in the local dispersal scenario only seed dispersal by established mature trees was simulated thus effectively excluding the establishment of tree species that were not present on the landscape in the beginning of the simulations in the local dispersal with additional seed supply scenario this restriction was relaxed by additionally allowing external seed supply to a small area at the valley bottom this scenario allowed for the immigration of new species that are likely to occur under climate change but it considers that tree migration is a slow process particularly in the presence of topographic barriers such as mountain ranges 2 5 analyses 2 5 1 model comparison to evaluate flms against observations we used total biomass and dominant species maps based on remote sensing data as well as plot biomass data derived from the swiss national forest inventory tanase et al 2019 furthermore estimates of species composition along the elevation gradient based on forest inventory maps of the canton of graubünden awn 2014 as well as local expert knowledge p bebi were consulted to evaluate model performance for all forested cells the total biomass of each species was recorded first in 50 year time steps 1100 1900 and subsequently in 10 year time steps 1900 2100 these results allowed the comparisons among models or between models and observations to be based on 1 the total biomass per cell 2 the biomass per species per cell 3 the temporal biomass dynamics of each species averaged over the entire landscape and 4 the species specific biomass per unit area along the elevation gradient 100 m elevation steps all analyses were based on simulation results averaged over 10 replicate runs 2 5 2 variance partitioning for all future simulations we quantified how much of the variance across all flm runs was explained by different sources of uncertainty i e model differences climate scenarios disturbance or dispersal scenarios and stochasticity as represented by replicated runs for this purpose we first estimated simulated total biomass and biomass based gamma diversity across the landscape expressed by the shannon index shannon and weaver 1976 at decadal time steps for 2000 to 2100 for each model run future projections 4 models 4 climate scenarios 10 replicates 160 runs disturbance scenarios 4 models 4 climate scenarios 4 disturbance scenarios 10 replicates 640 runs dispersal scenarios 4 models 4 climate scenarios 3 dispersal scenarios 10 replicates 480 runs subsequently we estimated average change rates for biomass and shannon diversity for the first half 2010 2050 and the second half of the century 2060 2100 based on these values we estimated the variance components as the proportions of the sum of squares that could be attributed to the different sources of uncertainty using the package vca variance component analysis version 1 3 4 within the r language and environment for statistical computing r core team 2018 in addition we tested if the variation between models generally changed over time and with intensifying climate forcing for this purpose we used the results of the future projections and calculated the coefficient of variation cv of the total biomass and the biomass of the four most important species in each decadal time step based on the results of all replicates of all models for each climate scenario separately we fitted linear regressions using cv over time as response variable and estimated slopes and p values this allowed us to assess whether cv generally changed with time and whether the trend slope differed between climate scenarios 3 results 3 1 past to present simulations the most abundant species observed in the dischma valley norway spruce european larch swiss stone pine were present in simulations by all flms with the exception of european larch being absent in landis ii fig 1 all models simulated a general shift from a dominance of spruce to a dominance of larch or swiss stone pine with increasing elevation however while there was general agreement in the simulated species composition among the models notable differences emerged with regard to both the abundance and spatial distribution of species fig 1 furthermore some of the simulated landscapes featured tree species not currently observed in the dischma valley in landclim for instance the lowest elevation areas were co dominated by european silver fir abies alba mill while treemig and landis ii simulated a number of other species particularly in the frequently disturbed avalanche tracks the observed total aboveground biomass along the elevation gradient decreased slightly from 210 t ha to 170 t ha between 1600 and 2100 m and then dropped to zero at 2300 m all models were generally able to reproduce decreasing biomass levels with increasing elevation and the location of the treeline was simulated relatively accurately in three out of the four models the patterns simulated by iland and landclim were fairly congruent with an average biomass of 200 t ha at lower elevations and linearly decreasing biomass above 1800 m with the simulated treeline located between 2200 m and 2400 m in both models fig 1 landis ii behaved similarly up to an elevation of 2300 m but no clear treeline emerged from the simulations treemig generally predicted a lower biomass of 120 t ha at elevations below 2100 m and a linear decrease up to the treeline simulated at 2300 m 3 2 future projections projections of future changes in total biomass and species composition differed strongly between the models fig 2 three models iland landclim landis ii projected a strong increase in total biomass with increasing temperatures whereas in treemig biomass increased slightly under the rcp2 6 rcp6 0 scenarios and decreased under the rcp8 5 scenario projected biomass changes for norway spruce picea abies showed a similar pattern fig 2 while all models projected a decline in swiss stone pine pinus cembra under climate change the trend for european larch larix decidua varied among models and ranged from a slight decrease in landclim to a substantial increase in iland with increasing temperatures the biomass of the drought tolerant scots pine pinus sylvestris l increased in iland and treemig whereas other species increased in abundance in landclim and landis ii overall uncertainty in future biomass projections increased with increasing severity of climate change with scenario rcp8 5 showing the strongest disagreement between model projections both increases in biomass in existing forests and the colonization of areas above the current treeline contributed to the simulated increase in total biomass at the landscape level fig 3 iland and landclim simulated comparable changes in treeline location with a slow upward shift within the first 50 years of the simulation and an accelerated shift in the following 50 years particularly under severe climate change rcp8 5 fig 3 in contrast treemig simulated a faster upward shift of the upper treeline already in the first decades of the 21st century even under moderate warming in this model a remarkable decrease in norway spruce biomass at lower elevations was simulated under the rcp8 5 scenario induced by frequent hot dry summers particularly at the end of the simulation period fig a6 the cv of the simulated total biomass increased significantly p 0 05 with time regardless of the climate scenario fig 4 table c1 with the exception of norway spruce under rcp2 6 significant positive trends of cv with simulation time were observed for all major species table c1 the slopes of linear regressions were consistently higher under rcp8 5 than under rcp2 6 indicating an increase in predictive uncertainty with an intensification of climate change 3 3 disturbance and dispersal scenarios avalanche disturbances strongly influenced future biomass dynamics fig 5 and c1 and species composition fig c2 in all models compared to no disturbance simulations average total biomass decreased by 8 20 t ha in the low disturbance scenario 36 84 t ha in the medium disturbance scenario and 44 90 t ha in the high disturbance scenario fig 5 corresponding to a relative biomass loss of 5 7 20 30 and 18 32 respectively fig c1 in iland treemig and landclim the amount of biomass lost increased with increasing disturbance frequency while in landis ii biomass loss was highest in the medium disturbance scenario within the disturbance scenarios climate influenced disturbance mediated biomass dynamics but the effects varied among models particularly in the medium and high disturbance scenarios biomass loss was intensified with increasing temperature in iland and landclim whereas in treemig and landis ii higher temperature reduced the disturbance mediated loss of biomass differences among models were pronounced at the species level fig c2 whereas the biomass of the main species decreased consistently in all models as a result of disturbance the biomass of previously rare species increased in comparison to the no disturbance scenario particularly in landis ii and landclim different dispersal scenarios had a minor impact on total biomass compared to unrestricted dispersal dispersal limitation resulted in a biomass reduction between 0 and 10 t ha corresponding to a relative loss between 0 and 3 fig 6 and c3 climate change did not significantly influence these results at the species level the effects of dispersal limitation were more pronounced fig c4 in landis ii norway spruce experienced a strong decrease in biomass while swiss stone pine and other previously rare species increased when considering dispersal limitation positive effects of dispersal limitation on biomass of individual species were also observed in iland swiss stone pine scots pine treemig norway spruce and landclim other species but they were much less pronounced than in landis ii 3 4 variance partitioning differences between models contributed more strongly to changes in total biomass and species diversity in future projections than differences between climate scenarios fig 7 the uncertainty introduced by different climate scenarios increased in the second half of the century yet climate scenario differences never explained more that 15 of the total variance in the simulations climate scenario uncertainty also contributed only marginally to the overall variance in all disturbance and dispersal scenarios fig 7 in the disturbance scenarios disturbance frequency was the most important factor explaining 40 of the total variance in the second half of the century in contrast different assumptions regarding dispersal contributed little to the overall variance in the results in all simulations the uncertainty due to replicate runs was negligible 4 discussion in this first systematic flm comparison we found fair agreement between four state of the art forest landscape models when simulating vegetation dynamics under past to present climatic conditions simulated current forests were generally in agreement with current observations however under future climate conditions the agreement among projections was low and differences among the models were substantial furthermore different assumptions about disturbance and dispersal had a strong influence on simulated landscape dynamics with disturbance effects being stronger than climate and dispersal effects these results indicate that the uncertainty in simulated future landscape trajectories remains high not only because of climate scenario uncertainty but also because of model uncertainty 4 1 past to present simulations past to present simulations i e where forest dynamics are simulated over a long time period until quasi equilibrium and compared with observations are a common approach in forest landscape modeling he et al 2011 such simulations are frequently applied for fine tuning of model parameters and for model evaluation e g temperli et al 2015 here three of the four models iland treemig landclim reproduced the observed species composition and location of the treeline fairly well this is not surprising as these models have been used and evaluated in the current landclim or similar treemig iland mountain landscapes indicating that their structures are appropriate to reproduce forest dynamics under these environmental conditions furthermore fine tuning for some species parameters was applied for treemig to increase consistency between data and simulations the discrepancy between simulations and observations was larger for landis ii fig 1 this does not per se indicate an inappropriate model structure for long term simulations until quasi equilibrium although the models of the landis family were rather developed with a focus on non equilibrium successional dynamics and realistic short term projections over decades to a few centuries mladenoff 2004 the discrepancy is likely to be the combined result of i the specifications imposed on the model to ensure the same initial conditions as the other models i e initialization with even aged one year cohorts instead of age structured cohorts and stand types this may have enhanced the simulated age dependent mortality effect when a single species i e norway spruce gains dominance over the stands and the landscape fig c5 ii the choice of maintaining the typical ecoregion approach defined by classified elevation aspect and slope with the area above the current treeline binned into a single ecoregion this resulted in a less gradual treeline change in the simulations compared to the other models in which each cell had its own environmental and climatic conditions fig 1 iii the choice due to resource constraints of not performing a formal model calibration cf scheller and mladenoff 2004 for the european alps in contrast to the other models only earlier versions of the core landis ii model in combination with different extensions have so far been applied and calibrated for different biogeographical regions in europe e g atlantic cantarello et al 2017 continental kruhlov et al 2018 mediterranean mairota et al 2013 with regard to the detailed patterns emerging from the simulations e g when comparing individual grid cells the detailed species composition along the elevation gradient or the species composition in the avalanche tracks considerable deviations between the simulations of all flms and observations were discernible fig 1 performing a formal model calibration with all models could have reduced these deviations but whether such a fitting of process based models to landscape level data increases the robustness of future projections is questionable in this context it is important to keep in mind that both the observational data and the model input data are uncertain uncertain or unknown processes that were not considered in the simulations e g land use and historical management practices elkin et al 2013 may have strongly influenced the observed species pool or structure of the forests furthermore single or averaged stochastic realizations of model simulations i e forest landscapes are compared to observations that are also only one single realization of stochastic processes in the real landscape performing a formal model calibration and achieving a better correspondence with observations would hence not guarantee that a model faithfully simulates forest dynamics as the risk of making the right predictions for the wrong reasons remains consequently past to present simulations with flms must often be regarded as test of plausibility rather than a validation in a strict sense which remains a major challenge for landscape modeling studies 4 2 future projections we observed substantial uncertainty in future model projections over the next 100 years it was high for all analyzed indicators i e biomass trajectories species composition and species distribution along the elevation gradient of the study landscape uncertainty increased over time and with more extreme climatic conditions figs 2 and 4 such an increase in uncertainty over time is expected for process based vegetation models as their complex structures with many different processes and parameters generally facilitate the propagation of errors over time nishina et al 2015 in addition it should be noted that although we generally refer to flms as process based or mechanistic models they necessarily combine mechanistic and phenomenological components like almost any ecological model gustafson 2013 this implies that the more extreme climatic conditions become the more likely the models will operate outside the ecological state space for which they were parameterized often leading to larger uncertainty in ensemble model simulations e g ito et al 2016 we found the amount of variance in simulation results that was explained by model differences to be high indicating that the selection of any given model had a larger impact on future projections than differences between climate scenarios this is in line with studies based on different global vegetation models and species distribution models that showed that model differences were the main source of uncertainty for projected future changes in vegetation nishina et al 2015 thuiller et al 2019 the simulated positive biomass development at the landscape level when averaged over all models fig 2 agrees with expert and observation based trends in mountain areas lindner et al 2014 2010 high elevation forests like those in the dischma valley are currently mostly temperature limited and warming is expected to increase their productivity and biomass accumulation elkin et al 2013 in addition an upward shift of the treeline is expected because of climate change bolli et al 2007 jochner et al 2018 both processes were captured in our simulations however their importance differed between flms while the positive biomass development in treemig rcp2 6 rcp6 0 was mainly driven by the fast upward movement of treeline biomass increase in already established forests contributed most to the positive trends in the other models figs 1 and 3 the differences in forest dynamics resulted mainly from different implementations of the main demographic processes i e dispersal establishment growth and mortality in the four flms among others this relates to the choice of environmental factors that are considered as external forcing and how the models are parameterized and calibrated with respect to dispersal and seedling establishment for instance the models use different parameterizations determining the effective and maximum dispersal distance as well as the age when a tree starts producing propagules and different approaches determining the number of new recruits also we used a finer grid for dispersal for iland and landclim 20 and 25 m respectively than treemig and landis ii 100 m which may further limit the speed at which the area above treeline can be colonized in these models this is because of the implicit assumption that trees are uniformly distributed within grid cells and species with short dispersal distances can always disperse to an adjacent cell therefore the dispersal rate when using a coarser grid can be higher compared to using a finer grid in addition treemig is the only model in our ensemble that simulates a seed bank explicitly which besides different parametrization of the dispersal functions contributes to the fast treeline shift in this model as seeds are assumed to be available above the treeline and can germinate once conditions become favorable in the other models the dispersal of some species into previously unsuitable habitat above treeline may be slower than the rate at which new suitable habitat becomes available growth is also implemented quite differently in the models two models incorporate tree growth directly as a function of environmental conditions treemig landclim whereas the other two incorporate the carbon budget more mechanistically iland landis ii moreover iland and landis ii also included the co2 fertilization effect i e the stimulation of photosynthesis by increased atmospheric co2 concentrations it is thus not surprising that these were the models with the highest overall increase in biomass mortality is probably the least understood process bigler and bugmann 2004 and it remains a major uncertainty in vegetation modeling bugmann et al 2019 due to the lack of mechanistic understanding it remains challenging to develop and parameterize robust mortality algorithms hülsmann et al 2018 sala et al 2010 the mortality algorithms of all models used in this study are based on the principle that severe limitations in resource supply or other suboptimal growing conditions will increase mortality rates but this principle is implemented in different ways in iland and landis ii where the carbon balance is simulated explicitly including pools of non structural carbohydrate reserves mortality increases strongly when these reserves are low or depleted the reserve pools serve as a buffer preventing mortality from drastically increasing when conditions are unfavorable only over a limited period of time likewise in landclim mortality rates increase when growth is lower than a defined threshold for at least three consecutive years in contrast mortality in treemig can increase already after one year of unfavorable conditions frequent but non consecutive extreme years such as the projected hot and dry summers under rcp8 5 towards the end of the 21st century are hence sufficient to induce severe landscape wide mortality in this model this shows that the choice of mortality algorithms can have a large impact on forest projections with the effects of different algorithms becoming particularly evident when comparing models under extreme conditions large scale mortality events due to drought are likely to have increased globally in recent decades allen et al 2010 but they remained restricted mainly to dry valleys at lower elevations in the alps bigler et al 2006 etzold et al 2019 nevertheless when considering the commonly shallow soils and cold adapted provenances in high mountain landscapes and the tendency to underestimate the risk of drought induced forest die offs allen et al 2015 significantly increased mortality rates under extreme climate conditions cannot be ruled out it is not trivial to identify the main causes of differences in model behavior because the mechanisms within each model interact in complex ways this would require systematic tests in which mechanisms or model properties are modified one by one e g changed spatial resolution implementation of alternative algorithms for growth establishment morality switching specific processes such as co2 fertilization on or off cf huber et al 2020 to quantify effects on simulation results such an analysis was however beyond the scope of this study nonetheless we can derive cues about the main causes from our data and experiences with the models the most obvious difference was the diverging biomass development with increasing temperature when comparing treemig and the other models fig 2 for the latter total biomass was clearly temperature limited and increasing temperatures resulted in biomass increases in grid cells below and above the current treeline figs 1 and 3 in treemig biomass was generally lower than in the other models due to a different dbh stem volume allometry that was introduced to better match the allometric functions applied in the swiss national forest inventory below the treeline the biomass simulated in treemig remained largely unchanged probably because increased interspecific competition cancelled out the positive temperature effects and the higher sensitivity of the mortality algorithm to high temperatures even led to a biomass decrease in the rcp8 5 scenario see above a temperature effect was clearly seen in the area above the treeline which was colonized faster than in the other models due to the seedbank dynamics see above and the generally fast biomass accumulation during early succession fig c5 the distinctly different model behavior during early succession also caused the different species composition above the current treeline and in avalanche tracks both the model behavior during early succession and under extreme environmental conditions are particularly important for future projections under environmental change but were not explicitly considered in the evaluation of our models against observations during the flm development process the plausibility of simulation results under such conditions might be tested in one or few landscapes but this does not guarantee a consistently plausible behavior in general consequently evaluation efforts need to be intensified when applying models in new landscapes or under novel environmental conditions 4 3 disturbance and dispersal scenarios the study landscape is regularly disturbed by avalanches and our simulations showed that disturbances were of particular importance for future forest dynamics fig 7 the avalanche disturbance regime of the study landscape is unlikely to be representative of landscapes at lower elevations however disturbances in general are expected to increase strongly due to climate change in most european landscapes seidl et al 2017 a meaningful integration of disturbance processes in flms is thus of paramount importance our comparative study focused on how models respond to prescribed disturbances finding substantial differences among models on the one hand because each model simulated a unique species distribution spatially fixed disturbances affected the total biomass and the species composition differently on the other hand model behaviors with respect to the rate of colonization of disturbed areas and the emerging early forest succession were also important for the dynamics in avalanche tracks fig c5 these model specific behaviors may explain why the relative biomass loss was smallest in landis ii and previously rare species even increased in biomass with increasing disturbance intensity while total biomass loss was highest in iland taken together the interpretation of changes in forest structure and composition under different disturbance regimes would differ substantially across models to improve the simulation of disturbances in flms modelers should focus not only on the effects of disturbances on forests but also on the response of forests to disturbances and possible feedback effects between forests and disturbances e g zurbriggen et al 2014 within each disturbance scenario the model specific responses to climate forcing fig 5 were comparable to the responses in the future projection scenarios fig 2 i e the biomass in three models increased from rcp2 6 to rcp8 5 while it decreased in treemig this is because the a priori defined avalanche disturbances were independent of the effect of climate change in reality increasing climate forcing is likely to affect the frequency and distribution of both snow precipitation and avalanches but the climate sensitivity of avalanches remains uncertain in some studies no significant impact of climate on avalanche regimes in the alps was observed eckert et al 2010 schneebeli et al 1997 in another study a general decrease in avalanche activity of up to 30 in the next century was projected castebrunet et al 2014 the consideration of such a relationship between climate and avalanche activity and the feedback between forest and avalanche release zurbriggen et al 2014 could have strongly changed the simulated patterns in our study in addition we did not consider additional disturbances like windthrow or insect and pathogen outbreaks whose effects on forest ecosystems are likely to increase with climate change seidl et al 2011b 2017 dispersal is a further crucial process for forest landscape dynamics under climate change at the continental scale along latitudinal climate gradients dispersal determines whether species will be able to keep track with a changing climate epstein et al 2007 meier et al 2012 thuiller et al 2019 in mountain landscapes with their steep gradients dispersal especially affects treeline dynamics the colonization after disturbances and the speed of species turnover when applying flms implicit assumptions have to be made about the external seed input to the landscape as landscapes are usually not closed systems and receive an unknown amount of seeds from the outside the effect of different dispersal assumptions was rather low for the total biomass development in our current simulations but more pronounced at the species level where the relative share of species was influenced by dispersal limitation particularly in landis ii this shows that assumptions about dispersal limitations can alter the species composition even if the effect may seem small in our scenarios furthermore it must be kept in mind that we have only analyzed landscape dynamics over the next 100 years which represent a short time for tree migration over longer time spans dispersal limitation effects could amplify and change the species composition scherrer et al 2020 albrich et al 2020 this indicates that the decision about how dispersal should be simulated should be considered carefully in landscape modeling studies 4 4 implications and outlook we have shown that differences in model structure are the main source of uncertainty in future forest landscape simulations at least in our case study this finding highlights several important issues in the context of projecting the future of forest landscapes first the fact that flm simulations agree under current environmental conditions does not guarantee that their projections remain consistent under climate change one way towards robust projections for non analog futures may be to integrate more mechanism based on appropriately scaled first principles of ecology into flms cf gustafson 2013 in fact the available flms like almost all other ecosystem models are not purely mechanistic models but rather hybrid models that contain mechanistic but also phenomenological components purely mechanistic models are hard to parameterize and not tractable purely phenomenological models are not robust under novel conditions we need to find the right balance between these extremes other model types such as global vegetation or gap models tend to be based more on processes than flms which might thus also benefit from a shift towards a better and more widespread incorporation of processes gustafson 2013 simultaneously a more rigorous and systematic model evaluation parameterization and calibration is needed for instance by applying pattern oriented modeling grimm et al 2005 cf huber et al 2020 based on the increasing availability of large forest data streams e g remote sensing second model uncertainty increases with simulation time and severity of environmental change this is a particular concern in landscape modeling as flms are rarely used to make short term projections under a continuation of past conditions but are frequently employed to study ecosystem trajectories over centuries to millennia under changing environmental conditions henne et al 2015 thom et al 2017b third being able to simulate future disturbance regimes more accurately is of paramount importance disturbance scenarios contributed at least as much variance to our results as differences between the models which underlines the importance of improving disturbance projections in flms and of considering disturbance processes also in other model types fisher et al 2018 seidl et al 2011a fourth although all flms are based on similar principles they have been developed for different purposes e g short term dynamics vs equilibrium simulations use different spatial and temporal scales represent trees at different levels of detail implement the main processes dispersal growth mortality in different ways and are calibrated for different species and regions consequently when using a flm the model characteristics should be carefully matched to the study question in order to minimize uncertainty the comparative model description provided in appendix b provides a good basis for such an endeavor lastly by conducting the first flm comparison study we showed that ensemble projections with flms are possible and advocate for a wider use of multiple models in future studies the observed differences among models are at least partly due to differing assumptions about processes that are not fully understood leading to competing equally plausible model formulations hence ensemble simulations with ecosystem models reflect a range of potential futures moreover ensemble projections allow for the quantification of model uncertainty but they also help us to scrutinize the potential causes for the simulated differences e g mortality formulation drought effects reproduction or regeneration feedback and stimulate important discussions among the modeling community 5 software availability landclim is developed by the forest ecology group at eth zürich switzerland it is available online at https ites fe ethz ch openaccess and can freely be used under the terms of the gnu general public license v3 landis ii is developed by the landis ii foundation a registered non profit in the usa it is open source apache license 2 0 and available online at http www landis ii org iland is developed and maintained at the ecosystem dynamics and forest management group technical university of munich source code executable and model documentation are available at http iland boku ac at the model is open source under the gnu general public license treemig is developed by the dynamic macroecology group wsl switzerland it is available upon request from heike lischke wsl ch and can freely be used under the terms of the gnu general public license v3 declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this article is based on work from cost action fp1304 profound towards robust projections of european forests under climate change supported by cost european cooperation in science and technology ah acknowledges funding through the anr alien project anr 14 ce36 0001 01 gp acknowledges funding by the swiss national science foundation snf 163250 pm acknowledges that half of the computational work for the landis ii model was executed on the it resources of the recas bari data center which were made available by two projects financed by the miur italian ministry for education university and research in the pon ricerca e competitività 2007 2013 program recas azione i interventi di rafforzamento strutturale pona3 00052 avviso 254 ric and prisma asse ii sostegno all innovazione pon04a2 a rs and ka acknowledge funding from the austrian science fund through start grant y895 b25 jb acknowledges support from czech ministry of education youth and sports project number ld15158 and by the long term research development project no rvo 67985939 from the czech academy of sciences author contributions hl and pm had the initial idea of the work all co authors contributed to the definition of the research protocol in several profound workshops gp prepared parts of the model input data and carried out simulations with iland with contributions from ka and rs hl carried out treemig simulations ah carried out landclim simulations with contributions from gp jb gv and pm carried out landis ii simulations within input from rs gp analyzed the results and led the writing all co authors discussed the analysis of the results reviewed commented on the manuscript and gave final approval for publication appendix a supplementary data the following are the supplementary data to this article multimedia component 1 multimedia component 1 multimedia component 2 multimedia component 2 multimedia component 3 multimedia component 3 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j envsoft 2020 104844 
25928,projections of landscape dynamics are uncertain partly due to uncertainties in model formulations however quantitative comparative analyses of forest landscape models are lacking we conducted a systematic comparison of all forest landscape models currently applied in temperate european forests landclim treemig landis ii iland we examined the uncertainty of model projections under several future climate disturbance and dispersal scenarios and quantified uncertainties by variance partitioning while projections under past climate conditions were in good agreement with observations uncertainty under future climate conditions was high with between model biomass differences of up to 200 t ha 1 disturbances strongly influenced landscape dynamics and contributed substantially to uncertainty in model projections 25 40 of observed variance overall model differences were the main source of uncertainty explaining at least 50 of observed variance we advocate a more rigorous and systematic model evaluation and calibration and a broader use of ensemble projections to quantify uncertainties in future landscape dynamics keywords forest landscape models model comparison variance partitioning disturbances dispersal future projections 1 introduction forest landscape models flms are used to simulate the dynamics of forest ecosystems at the landscape level 102 106 ha in extent over decades to centuries he et al 2008 shifley et al 2017 climatic and edaphic conditions within landscapes can vary widely in space and time and a hallmark of flms is that they explicitly represent this variation flms typically represent climatic and edaphic variation by dividing the landscape into smaller grid cells in which regeneration growth and mortality of either height structured populations cohorts or individual trees are modelled over time as a function of both local abiotic conditions and biotic interactions e g lischke et al 2006 seidl et al 2012 in addition to local demographic processes flms explicitly simulate spatial interactions among grid cells such as seed dispersal or dynamically spreading disturbances like forest fires or insect attacks e g temperli et al 2015 the combined simulation of relatively detailed demographic processes and spatially explicit interactions is a unique characteristic of flms that distinguishes them from other model types such as forest stand models succession models or global vegetation models over the past decades several flms were developed for the simulation of temperate forest landscape dynamics these models have been successfully applied in a number of studies for instance projecting the impacts of climate change on landscape dynamics elkin et al 2013 thom et al 2017a evaluating the effects of disturbance interactions on forest structure temperli et al 2013a assessing the effects of migrational lags along latitudinal and elevation gradients epstein et al 2007 scherrer et al 2020 and analyzing the consequences of adaptive forest management at the landscape level mairota et al 2014 rammer and seidl 2015 however considerable uncertainties in the projection of forest landscape dynamics remain the scarcity of input data with high spatial resolution is one source of uncertainty as flms are spatially explicit they require input data representing the heterogeneity in environmental conditions some environmental conditions such as soil properties or the microclimate can vary considerably over short distances particularly in topographically complex landscapes and the available data often do not capture this variation in addition environmental drivers of forest dynamics also vary over time but time series data covering the extended periods that are of interest in forest landscape dynamics are often not available furthermore empirical time series of spatial data of forest composition and structure covering an entire landscape are rare it is hence common that flms are evaluated based on data at a single point in time he et al 2011 in some model applications vegetation data are also used during initialization e g to reflect past management or disturbance history and particularly shorter term simulation 150 years can be sensitive to initialization uncertainty temperli et al 2013b finally further uncertainty stems from differences in model formulations although flms are based on similar general principles their model structures vary substantially for instance regarding their spatial and temporal resolution whether individuals or cohorts are simulated at which level of detail trees are represented how mortality growth dispersal and regeneration are simulated whether specific processes such as co2 fertilization effects are considered or which and how disturbances are simulated e g lischke et al 2006 scheller et al 2007 seidl et al 2012 together these uncertainties raise questions about the robustness of the projections made with flms here we use the term robustness to indicate the similarity of the projections of different models i e the larger the differences the lower the robustness multi model comparisons can help to understand and quantify uncertainties underlying a particular model type shifley et al 2017 in some scientific fields such as climate modeling it is common to apply several models under unified conditions in ensemble simulations representing the range of possible futures and helping to quantify average trends and confidence intervals ipcc 2014 ensemble simulations can also be used to partition the observed variance among different factors diniz filho et al 2009 yip et al 2011 for example the uncertainty due to differences between models parameters and or structure can be compared to uncertainty from different scenarios simulated e g climate scenarios while such analyses have recently been carried out for other types of vegetation models e g global vegetation models nishina et al 2015 species distribution models thuiller et al 2019 they are lacking for flms here we present the first systematic comparison of all flms that are currently applied in the temperate forests of europe i e landclim schumacher et al 2004 treemig lischke et al 2006 landis ii scheller et al 2007 and iland seidl et al 2012 the aim of this comparison is twofold first we examine the robustness of model projections under several future climate disturbance and dispersal scenarios second we assess and discuss the contribution of different scenarios and model structures to overall uncertainty using variance partitioning 2 methods 2 1 study landscape the dischma valley near davos in switzerland is a subalpine valley located between 1560 and 3146 m a s l appendix a fig a 1 and characterized by steep topographic gradients mean annual temperature in davos 1560 m a s l was 3 5 c during the period 1981 2010 with an average annual precipitation sum of 1020 mm meteoswiss fig a2 soils are mainly loamy sands and sandy loams fig a3 norway spruce picea abies l karst european larch larix decidua mill and swiss stone pine pinus cembra l are the most abundant tree species in the landscape the elevation of the upper treeline is partly influenced by cattle grazing and is currently located at 2100 2200 m a s l avalanches are common and cause considerable damage to forests particularly on the northeast facing slopes of the valley fig a4 we chose the dischma valley as study landscape based on the availability of robust drivers climate substrate and disturbances by avalanches and evaluation data forest composition and structure additionally three of the four models presented here have already been applied in this or similar mountain landscapes which expedited the model set up and testing process 2 2 models and parameterizations the main characteristics of the four flms used are summarized in table 1 detailed descriptions of all models are provided in appendix b following the overview design concepts and details odd protocol grimm et al 2010 2006 appendix b also contains a detailed comparison of model characteristics table b1 the list of species parameterized in each model table b2 as well as the species parameters and state variables used in the models table b3 b10 2 3 model input data we assembled a common input data set for all models to ensure consistency and minimize differences due to contrasting driver data this input data set contained the following environmental attributes elevation m a s l slope aspect daily maximum minimum and mean temperature c daily precipitation sums mm daily radiation w m 1 effective soil depth cm soil texture class total soil water holding capacity whc cm avalanche occurrence ha 1 year 1 and annual co2 concentration ppm note that not all models require all data see attributes of grid cells in table 1 for model specific input data all attributes were spatially explicit at a resolution of 100 100 m except for co2 concentration which was spatially invariant the full dataset covered both cells that are currently forested and areas that can potentially be colonized by trees in the future e g above the current treeline all areas currently under management settlements pastures were considered to remain under the same management regime and were excluded from the simulations the total simulated area comprised 923 cells of 1 ha size fig a1 for all models that internally use a resolution finer than 1 ha the environmental attributes of each 1 ha cell were assigned to all cells contained in it this was always possible as the internal cell sizes that are being used for modeling the different ecological processes were 2 2 m 10 10 m 20 20 m 25 25 m and 100 100 m cf table 1 historic co2 concentrations from 1765 to 2010 as well as future concentrations from 2011 to 2100 for four representative concentration pathway rcp scenarios rcp2 6 rcp4 5 rcp6 0 rcp8 5 were taken from meinshausen et al 2011 topographic and soil data were time invariant topographic data were provided by swisstopo 2018 whc data i e the difference between soil water content at field capacity and permanent wilting point were taken from remund and augustin 2015 with soil texture data derived from wildi and ewald 1986 using the volumetric whc estimates for different soil textures from blume et al 2010 effective soil depth was estimated from whc and texture data fig a3 climate and avalanche data varied in space and time historic climate data grids for the years 1930 2010 were generated by spatially interpolating measurements of surrounding weather stations meteoswiss using the daymet algorithm thornton et al 1997 projected climate data grids for the years 2011 2100 were produced by downscaling climate projections of the general circulation model hadgem2 es https esg pik potsdam de projects isimip2a for all four rcps rcp2 6 rcp4 5 rcp6 0 and rcp8 5 van vuuren et al 2011 figs a5 and a6 we used the delta change method with a reference period of 1961 1990 and applied the anomalies of the projected data to the historic data increases in annual mean temperatures until 2100 ranged from 1 5 c rcp2 6 to 6 c rcp8 5 whereas annual precipitation in all climate scenarios slightly decreased by 10 fig a5 the differences between scenarios were more pronounced in summer with summer temperatures in the rcp8 5 scenario increasing by up to 10 c by 2100 and summer precipitation being noticeably lower than in the other scenarios fig a6 the spatial and temporal distribution of avalanches was estimated based on the avalanche database of the swiss avalanche institute slf which recorded avalanches with a resolution of 1 m from 1960 to 2016 for the target landscape fig a4 for this study every 1 ha cell of which at least 25 was hit by an avalanche in one year was considered disturbed avalanche data were identical for all models i e the same cells were disturbed in the same years 2 4 simulation design 2 4 1 past to present simulations in past to present simulations forest dynamics in the study landscape were simulated from ad 1100 2010 10 replicates per model climate data were used as model input from 1930 to 2010 data for the period from 1100 to 1929 were generated by randomly sampling from the period 1930 to 1950 for each replicate run co2 data were used from 1765 to 2010 with the concentration fixed to the pre industrial level of 278 ppm for years prior to 1765 we assumed that the simulated forests were not influenced by management but were disturbed by avalanches the available spatio temporal avalanche data for 1960 to 2010 were implemented as observed for the pre 1960 period we generated a randomized avalanche data set based on the location and frequency of observed avalanches hence mimicking the avalanche disturbance regime of the recent past we assumed that in cells disturbed by avalanches all trees were killed in the corresponding year we chose this approach to ensure the same implementation of avalanches in all models however this might have led to an overestimation of avalanche induced mortality in the simulations in the initial period from 1100 to 1400 a regular supply of seeds of all species table b2 to all cells was simulated to allow potential establishment of all suitable species from 1401 on only seed dispersal by established mature trees was allowed in combination with a regular seed supply to a small area at the valley entrance to allow potential immigration of species that are not present in the landscape landclim treemig and iland were initialized from bare ground meaning that the landscape was initially empty and was successively colonized by trees via the model specific dispersal and regeneration processes in landis ii each cell in the landscape was instead initialized with one year old tree cohorts of every species because the model version used in this study cannot be initialized from bare ground 2 4 2 future projections to assess and compare the climate sensitivity of the flms we simulated future forest dynamics under four climate scenarios rcp2 6 rcp4 5 rcp6 0 and rcp8 5 from 2001 to 2100 10 replicates per model all flms were initialized with the forest state the models simulated for the end of the year 2000 in the past to present runs we used the observed co2 and climate data from 2001 to 2010 and the climate scenario data from 2011 onwards as drivers figs a5 and a6 we assumed no changes in avalanche disturbance patterns in the future and generated an avalanche disturbance sequence from 2001 to 2100 by randomly drawing from the observation data from 1960 to 2016 see below for the entire simulation period seeds dispersed exclusively from established mature trees and an additional regular seed supply of all species to a restricted area at the valley entrance was simulated 2 4 3 disturbance and dispersal scenarios to compare the response of flms to different assumptions regarding dispersal and disturbance four disturbance scenarios and three dispersal scenarios were simulated for these runs we first carried out past to present simulations from 1100 to 2000 which were identical to those described above with the exception that no disturbances by avalanches were simulated to start from undisturbed conditions in all models initialized with the forest state at the end of the year 2000 each flm simulated future forest dynamics from 2001 to 2100 under all combinations of climate scenarios rcp2 6 rcp4 5 rcp6 0 rcp8 5 and disturbance scenarios dist0 no dist1 low dist2 medium dist3 high in a full factorial design the disturbance scenarios were randomly generated based on avalanche observation data from 1960 to 2016 the medium disturbance scenario mimics the observed avalanche patterns while in the low and high disturbance scenario the frequency of avalanche occurrence was altered to 10 and 200 relative to the observations respectively furthermore to elucidate the role of dispersal simulations from 2001 to 2100 were run under all combinations of four climate scenarios and three dispersal scenarios disp1 global dispersal disp2 local dispersal disp3 local dispersal with additional restricted seed supply in the global dispersal scenario corresponding to no dispersal limitations seeds of all species table b2 were supplied to all simulated cells regardless of the location of mature trees in the landscape in the local dispersal scenario only seed dispersal by established mature trees was simulated thus effectively excluding the establishment of tree species that were not present on the landscape in the beginning of the simulations in the local dispersal with additional seed supply scenario this restriction was relaxed by additionally allowing external seed supply to a small area at the valley bottom this scenario allowed for the immigration of new species that are likely to occur under climate change but it considers that tree migration is a slow process particularly in the presence of topographic barriers such as mountain ranges 2 5 analyses 2 5 1 model comparison to evaluate flms against observations we used total biomass and dominant species maps based on remote sensing data as well as plot biomass data derived from the swiss national forest inventory tanase et al 2019 furthermore estimates of species composition along the elevation gradient based on forest inventory maps of the canton of graubünden awn 2014 as well as local expert knowledge p bebi were consulted to evaluate model performance for all forested cells the total biomass of each species was recorded first in 50 year time steps 1100 1900 and subsequently in 10 year time steps 1900 2100 these results allowed the comparisons among models or between models and observations to be based on 1 the total biomass per cell 2 the biomass per species per cell 3 the temporal biomass dynamics of each species averaged over the entire landscape and 4 the species specific biomass per unit area along the elevation gradient 100 m elevation steps all analyses were based on simulation results averaged over 10 replicate runs 2 5 2 variance partitioning for all future simulations we quantified how much of the variance across all flm runs was explained by different sources of uncertainty i e model differences climate scenarios disturbance or dispersal scenarios and stochasticity as represented by replicated runs for this purpose we first estimated simulated total biomass and biomass based gamma diversity across the landscape expressed by the shannon index shannon and weaver 1976 at decadal time steps for 2000 to 2100 for each model run future projections 4 models 4 climate scenarios 10 replicates 160 runs disturbance scenarios 4 models 4 climate scenarios 4 disturbance scenarios 10 replicates 640 runs dispersal scenarios 4 models 4 climate scenarios 3 dispersal scenarios 10 replicates 480 runs subsequently we estimated average change rates for biomass and shannon diversity for the first half 2010 2050 and the second half of the century 2060 2100 based on these values we estimated the variance components as the proportions of the sum of squares that could be attributed to the different sources of uncertainty using the package vca variance component analysis version 1 3 4 within the r language and environment for statistical computing r core team 2018 in addition we tested if the variation between models generally changed over time and with intensifying climate forcing for this purpose we used the results of the future projections and calculated the coefficient of variation cv of the total biomass and the biomass of the four most important species in each decadal time step based on the results of all replicates of all models for each climate scenario separately we fitted linear regressions using cv over time as response variable and estimated slopes and p values this allowed us to assess whether cv generally changed with time and whether the trend slope differed between climate scenarios 3 results 3 1 past to present simulations the most abundant species observed in the dischma valley norway spruce european larch swiss stone pine were present in simulations by all flms with the exception of european larch being absent in landis ii fig 1 all models simulated a general shift from a dominance of spruce to a dominance of larch or swiss stone pine with increasing elevation however while there was general agreement in the simulated species composition among the models notable differences emerged with regard to both the abundance and spatial distribution of species fig 1 furthermore some of the simulated landscapes featured tree species not currently observed in the dischma valley in landclim for instance the lowest elevation areas were co dominated by european silver fir abies alba mill while treemig and landis ii simulated a number of other species particularly in the frequently disturbed avalanche tracks the observed total aboveground biomass along the elevation gradient decreased slightly from 210 t ha to 170 t ha between 1600 and 2100 m and then dropped to zero at 2300 m all models were generally able to reproduce decreasing biomass levels with increasing elevation and the location of the treeline was simulated relatively accurately in three out of the four models the patterns simulated by iland and landclim were fairly congruent with an average biomass of 200 t ha at lower elevations and linearly decreasing biomass above 1800 m with the simulated treeline located between 2200 m and 2400 m in both models fig 1 landis ii behaved similarly up to an elevation of 2300 m but no clear treeline emerged from the simulations treemig generally predicted a lower biomass of 120 t ha at elevations below 2100 m and a linear decrease up to the treeline simulated at 2300 m 3 2 future projections projections of future changes in total biomass and species composition differed strongly between the models fig 2 three models iland landclim landis ii projected a strong increase in total biomass with increasing temperatures whereas in treemig biomass increased slightly under the rcp2 6 rcp6 0 scenarios and decreased under the rcp8 5 scenario projected biomass changes for norway spruce picea abies showed a similar pattern fig 2 while all models projected a decline in swiss stone pine pinus cembra under climate change the trend for european larch larix decidua varied among models and ranged from a slight decrease in landclim to a substantial increase in iland with increasing temperatures the biomass of the drought tolerant scots pine pinus sylvestris l increased in iland and treemig whereas other species increased in abundance in landclim and landis ii overall uncertainty in future biomass projections increased with increasing severity of climate change with scenario rcp8 5 showing the strongest disagreement between model projections both increases in biomass in existing forests and the colonization of areas above the current treeline contributed to the simulated increase in total biomass at the landscape level fig 3 iland and landclim simulated comparable changes in treeline location with a slow upward shift within the first 50 years of the simulation and an accelerated shift in the following 50 years particularly under severe climate change rcp8 5 fig 3 in contrast treemig simulated a faster upward shift of the upper treeline already in the first decades of the 21st century even under moderate warming in this model a remarkable decrease in norway spruce biomass at lower elevations was simulated under the rcp8 5 scenario induced by frequent hot dry summers particularly at the end of the simulation period fig a6 the cv of the simulated total biomass increased significantly p 0 05 with time regardless of the climate scenario fig 4 table c1 with the exception of norway spruce under rcp2 6 significant positive trends of cv with simulation time were observed for all major species table c1 the slopes of linear regressions were consistently higher under rcp8 5 than under rcp2 6 indicating an increase in predictive uncertainty with an intensification of climate change 3 3 disturbance and dispersal scenarios avalanche disturbances strongly influenced future biomass dynamics fig 5 and c1 and species composition fig c2 in all models compared to no disturbance simulations average total biomass decreased by 8 20 t ha in the low disturbance scenario 36 84 t ha in the medium disturbance scenario and 44 90 t ha in the high disturbance scenario fig 5 corresponding to a relative biomass loss of 5 7 20 30 and 18 32 respectively fig c1 in iland treemig and landclim the amount of biomass lost increased with increasing disturbance frequency while in landis ii biomass loss was highest in the medium disturbance scenario within the disturbance scenarios climate influenced disturbance mediated biomass dynamics but the effects varied among models particularly in the medium and high disturbance scenarios biomass loss was intensified with increasing temperature in iland and landclim whereas in treemig and landis ii higher temperature reduced the disturbance mediated loss of biomass differences among models were pronounced at the species level fig c2 whereas the biomass of the main species decreased consistently in all models as a result of disturbance the biomass of previously rare species increased in comparison to the no disturbance scenario particularly in landis ii and landclim different dispersal scenarios had a minor impact on total biomass compared to unrestricted dispersal dispersal limitation resulted in a biomass reduction between 0 and 10 t ha corresponding to a relative loss between 0 and 3 fig 6 and c3 climate change did not significantly influence these results at the species level the effects of dispersal limitation were more pronounced fig c4 in landis ii norway spruce experienced a strong decrease in biomass while swiss stone pine and other previously rare species increased when considering dispersal limitation positive effects of dispersal limitation on biomass of individual species were also observed in iland swiss stone pine scots pine treemig norway spruce and landclim other species but they were much less pronounced than in landis ii 3 4 variance partitioning differences between models contributed more strongly to changes in total biomass and species diversity in future projections than differences between climate scenarios fig 7 the uncertainty introduced by different climate scenarios increased in the second half of the century yet climate scenario differences never explained more that 15 of the total variance in the simulations climate scenario uncertainty also contributed only marginally to the overall variance in all disturbance and dispersal scenarios fig 7 in the disturbance scenarios disturbance frequency was the most important factor explaining 40 of the total variance in the second half of the century in contrast different assumptions regarding dispersal contributed little to the overall variance in the results in all simulations the uncertainty due to replicate runs was negligible 4 discussion in this first systematic flm comparison we found fair agreement between four state of the art forest landscape models when simulating vegetation dynamics under past to present climatic conditions simulated current forests were generally in agreement with current observations however under future climate conditions the agreement among projections was low and differences among the models were substantial furthermore different assumptions about disturbance and dispersal had a strong influence on simulated landscape dynamics with disturbance effects being stronger than climate and dispersal effects these results indicate that the uncertainty in simulated future landscape trajectories remains high not only because of climate scenario uncertainty but also because of model uncertainty 4 1 past to present simulations past to present simulations i e where forest dynamics are simulated over a long time period until quasi equilibrium and compared with observations are a common approach in forest landscape modeling he et al 2011 such simulations are frequently applied for fine tuning of model parameters and for model evaluation e g temperli et al 2015 here three of the four models iland treemig landclim reproduced the observed species composition and location of the treeline fairly well this is not surprising as these models have been used and evaluated in the current landclim or similar treemig iland mountain landscapes indicating that their structures are appropriate to reproduce forest dynamics under these environmental conditions furthermore fine tuning for some species parameters was applied for treemig to increase consistency between data and simulations the discrepancy between simulations and observations was larger for landis ii fig 1 this does not per se indicate an inappropriate model structure for long term simulations until quasi equilibrium although the models of the landis family were rather developed with a focus on non equilibrium successional dynamics and realistic short term projections over decades to a few centuries mladenoff 2004 the discrepancy is likely to be the combined result of i the specifications imposed on the model to ensure the same initial conditions as the other models i e initialization with even aged one year cohorts instead of age structured cohorts and stand types this may have enhanced the simulated age dependent mortality effect when a single species i e norway spruce gains dominance over the stands and the landscape fig c5 ii the choice of maintaining the typical ecoregion approach defined by classified elevation aspect and slope with the area above the current treeline binned into a single ecoregion this resulted in a less gradual treeline change in the simulations compared to the other models in which each cell had its own environmental and climatic conditions fig 1 iii the choice due to resource constraints of not performing a formal model calibration cf scheller and mladenoff 2004 for the european alps in contrast to the other models only earlier versions of the core landis ii model in combination with different extensions have so far been applied and calibrated for different biogeographical regions in europe e g atlantic cantarello et al 2017 continental kruhlov et al 2018 mediterranean mairota et al 2013 with regard to the detailed patterns emerging from the simulations e g when comparing individual grid cells the detailed species composition along the elevation gradient or the species composition in the avalanche tracks considerable deviations between the simulations of all flms and observations were discernible fig 1 performing a formal model calibration with all models could have reduced these deviations but whether such a fitting of process based models to landscape level data increases the robustness of future projections is questionable in this context it is important to keep in mind that both the observational data and the model input data are uncertain uncertain or unknown processes that were not considered in the simulations e g land use and historical management practices elkin et al 2013 may have strongly influenced the observed species pool or structure of the forests furthermore single or averaged stochastic realizations of model simulations i e forest landscapes are compared to observations that are also only one single realization of stochastic processes in the real landscape performing a formal model calibration and achieving a better correspondence with observations would hence not guarantee that a model faithfully simulates forest dynamics as the risk of making the right predictions for the wrong reasons remains consequently past to present simulations with flms must often be regarded as test of plausibility rather than a validation in a strict sense which remains a major challenge for landscape modeling studies 4 2 future projections we observed substantial uncertainty in future model projections over the next 100 years it was high for all analyzed indicators i e biomass trajectories species composition and species distribution along the elevation gradient of the study landscape uncertainty increased over time and with more extreme climatic conditions figs 2 and 4 such an increase in uncertainty over time is expected for process based vegetation models as their complex structures with many different processes and parameters generally facilitate the propagation of errors over time nishina et al 2015 in addition it should be noted that although we generally refer to flms as process based or mechanistic models they necessarily combine mechanistic and phenomenological components like almost any ecological model gustafson 2013 this implies that the more extreme climatic conditions become the more likely the models will operate outside the ecological state space for which they were parameterized often leading to larger uncertainty in ensemble model simulations e g ito et al 2016 we found the amount of variance in simulation results that was explained by model differences to be high indicating that the selection of any given model had a larger impact on future projections than differences between climate scenarios this is in line with studies based on different global vegetation models and species distribution models that showed that model differences were the main source of uncertainty for projected future changes in vegetation nishina et al 2015 thuiller et al 2019 the simulated positive biomass development at the landscape level when averaged over all models fig 2 agrees with expert and observation based trends in mountain areas lindner et al 2014 2010 high elevation forests like those in the dischma valley are currently mostly temperature limited and warming is expected to increase their productivity and biomass accumulation elkin et al 2013 in addition an upward shift of the treeline is expected because of climate change bolli et al 2007 jochner et al 2018 both processes were captured in our simulations however their importance differed between flms while the positive biomass development in treemig rcp2 6 rcp6 0 was mainly driven by the fast upward movement of treeline biomass increase in already established forests contributed most to the positive trends in the other models figs 1 and 3 the differences in forest dynamics resulted mainly from different implementations of the main demographic processes i e dispersal establishment growth and mortality in the four flms among others this relates to the choice of environmental factors that are considered as external forcing and how the models are parameterized and calibrated with respect to dispersal and seedling establishment for instance the models use different parameterizations determining the effective and maximum dispersal distance as well as the age when a tree starts producing propagules and different approaches determining the number of new recruits also we used a finer grid for dispersal for iland and landclim 20 and 25 m respectively than treemig and landis ii 100 m which may further limit the speed at which the area above treeline can be colonized in these models this is because of the implicit assumption that trees are uniformly distributed within grid cells and species with short dispersal distances can always disperse to an adjacent cell therefore the dispersal rate when using a coarser grid can be higher compared to using a finer grid in addition treemig is the only model in our ensemble that simulates a seed bank explicitly which besides different parametrization of the dispersal functions contributes to the fast treeline shift in this model as seeds are assumed to be available above the treeline and can germinate once conditions become favorable in the other models the dispersal of some species into previously unsuitable habitat above treeline may be slower than the rate at which new suitable habitat becomes available growth is also implemented quite differently in the models two models incorporate tree growth directly as a function of environmental conditions treemig landclim whereas the other two incorporate the carbon budget more mechanistically iland landis ii moreover iland and landis ii also included the co2 fertilization effect i e the stimulation of photosynthesis by increased atmospheric co2 concentrations it is thus not surprising that these were the models with the highest overall increase in biomass mortality is probably the least understood process bigler and bugmann 2004 and it remains a major uncertainty in vegetation modeling bugmann et al 2019 due to the lack of mechanistic understanding it remains challenging to develop and parameterize robust mortality algorithms hülsmann et al 2018 sala et al 2010 the mortality algorithms of all models used in this study are based on the principle that severe limitations in resource supply or other suboptimal growing conditions will increase mortality rates but this principle is implemented in different ways in iland and landis ii where the carbon balance is simulated explicitly including pools of non structural carbohydrate reserves mortality increases strongly when these reserves are low or depleted the reserve pools serve as a buffer preventing mortality from drastically increasing when conditions are unfavorable only over a limited period of time likewise in landclim mortality rates increase when growth is lower than a defined threshold for at least three consecutive years in contrast mortality in treemig can increase already after one year of unfavorable conditions frequent but non consecutive extreme years such as the projected hot and dry summers under rcp8 5 towards the end of the 21st century are hence sufficient to induce severe landscape wide mortality in this model this shows that the choice of mortality algorithms can have a large impact on forest projections with the effects of different algorithms becoming particularly evident when comparing models under extreme conditions large scale mortality events due to drought are likely to have increased globally in recent decades allen et al 2010 but they remained restricted mainly to dry valleys at lower elevations in the alps bigler et al 2006 etzold et al 2019 nevertheless when considering the commonly shallow soils and cold adapted provenances in high mountain landscapes and the tendency to underestimate the risk of drought induced forest die offs allen et al 2015 significantly increased mortality rates under extreme climate conditions cannot be ruled out it is not trivial to identify the main causes of differences in model behavior because the mechanisms within each model interact in complex ways this would require systematic tests in which mechanisms or model properties are modified one by one e g changed spatial resolution implementation of alternative algorithms for growth establishment morality switching specific processes such as co2 fertilization on or off cf huber et al 2020 to quantify effects on simulation results such an analysis was however beyond the scope of this study nonetheless we can derive cues about the main causes from our data and experiences with the models the most obvious difference was the diverging biomass development with increasing temperature when comparing treemig and the other models fig 2 for the latter total biomass was clearly temperature limited and increasing temperatures resulted in biomass increases in grid cells below and above the current treeline figs 1 and 3 in treemig biomass was generally lower than in the other models due to a different dbh stem volume allometry that was introduced to better match the allometric functions applied in the swiss national forest inventory below the treeline the biomass simulated in treemig remained largely unchanged probably because increased interspecific competition cancelled out the positive temperature effects and the higher sensitivity of the mortality algorithm to high temperatures even led to a biomass decrease in the rcp8 5 scenario see above a temperature effect was clearly seen in the area above the treeline which was colonized faster than in the other models due to the seedbank dynamics see above and the generally fast biomass accumulation during early succession fig c5 the distinctly different model behavior during early succession also caused the different species composition above the current treeline and in avalanche tracks both the model behavior during early succession and under extreme environmental conditions are particularly important for future projections under environmental change but were not explicitly considered in the evaluation of our models against observations during the flm development process the plausibility of simulation results under such conditions might be tested in one or few landscapes but this does not guarantee a consistently plausible behavior in general consequently evaluation efforts need to be intensified when applying models in new landscapes or under novel environmental conditions 4 3 disturbance and dispersal scenarios the study landscape is regularly disturbed by avalanches and our simulations showed that disturbances were of particular importance for future forest dynamics fig 7 the avalanche disturbance regime of the study landscape is unlikely to be representative of landscapes at lower elevations however disturbances in general are expected to increase strongly due to climate change in most european landscapes seidl et al 2017 a meaningful integration of disturbance processes in flms is thus of paramount importance our comparative study focused on how models respond to prescribed disturbances finding substantial differences among models on the one hand because each model simulated a unique species distribution spatially fixed disturbances affected the total biomass and the species composition differently on the other hand model behaviors with respect to the rate of colonization of disturbed areas and the emerging early forest succession were also important for the dynamics in avalanche tracks fig c5 these model specific behaviors may explain why the relative biomass loss was smallest in landis ii and previously rare species even increased in biomass with increasing disturbance intensity while total biomass loss was highest in iland taken together the interpretation of changes in forest structure and composition under different disturbance regimes would differ substantially across models to improve the simulation of disturbances in flms modelers should focus not only on the effects of disturbances on forests but also on the response of forests to disturbances and possible feedback effects between forests and disturbances e g zurbriggen et al 2014 within each disturbance scenario the model specific responses to climate forcing fig 5 were comparable to the responses in the future projection scenarios fig 2 i e the biomass in three models increased from rcp2 6 to rcp8 5 while it decreased in treemig this is because the a priori defined avalanche disturbances were independent of the effect of climate change in reality increasing climate forcing is likely to affect the frequency and distribution of both snow precipitation and avalanches but the climate sensitivity of avalanches remains uncertain in some studies no significant impact of climate on avalanche regimes in the alps was observed eckert et al 2010 schneebeli et al 1997 in another study a general decrease in avalanche activity of up to 30 in the next century was projected castebrunet et al 2014 the consideration of such a relationship between climate and avalanche activity and the feedback between forest and avalanche release zurbriggen et al 2014 could have strongly changed the simulated patterns in our study in addition we did not consider additional disturbances like windthrow or insect and pathogen outbreaks whose effects on forest ecosystems are likely to increase with climate change seidl et al 2011b 2017 dispersal is a further crucial process for forest landscape dynamics under climate change at the continental scale along latitudinal climate gradients dispersal determines whether species will be able to keep track with a changing climate epstein et al 2007 meier et al 2012 thuiller et al 2019 in mountain landscapes with their steep gradients dispersal especially affects treeline dynamics the colonization after disturbances and the speed of species turnover when applying flms implicit assumptions have to be made about the external seed input to the landscape as landscapes are usually not closed systems and receive an unknown amount of seeds from the outside the effect of different dispersal assumptions was rather low for the total biomass development in our current simulations but more pronounced at the species level where the relative share of species was influenced by dispersal limitation particularly in landis ii this shows that assumptions about dispersal limitations can alter the species composition even if the effect may seem small in our scenarios furthermore it must be kept in mind that we have only analyzed landscape dynamics over the next 100 years which represent a short time for tree migration over longer time spans dispersal limitation effects could amplify and change the species composition scherrer et al 2020 albrich et al 2020 this indicates that the decision about how dispersal should be simulated should be considered carefully in landscape modeling studies 4 4 implications and outlook we have shown that differences in model structure are the main source of uncertainty in future forest landscape simulations at least in our case study this finding highlights several important issues in the context of projecting the future of forest landscapes first the fact that flm simulations agree under current environmental conditions does not guarantee that their projections remain consistent under climate change one way towards robust projections for non analog futures may be to integrate more mechanism based on appropriately scaled first principles of ecology into flms cf gustafson 2013 in fact the available flms like almost all other ecosystem models are not purely mechanistic models but rather hybrid models that contain mechanistic but also phenomenological components purely mechanistic models are hard to parameterize and not tractable purely phenomenological models are not robust under novel conditions we need to find the right balance between these extremes other model types such as global vegetation or gap models tend to be based more on processes than flms which might thus also benefit from a shift towards a better and more widespread incorporation of processes gustafson 2013 simultaneously a more rigorous and systematic model evaluation parameterization and calibration is needed for instance by applying pattern oriented modeling grimm et al 2005 cf huber et al 2020 based on the increasing availability of large forest data streams e g remote sensing second model uncertainty increases with simulation time and severity of environmental change this is a particular concern in landscape modeling as flms are rarely used to make short term projections under a continuation of past conditions but are frequently employed to study ecosystem trajectories over centuries to millennia under changing environmental conditions henne et al 2015 thom et al 2017b third being able to simulate future disturbance regimes more accurately is of paramount importance disturbance scenarios contributed at least as much variance to our results as differences between the models which underlines the importance of improving disturbance projections in flms and of considering disturbance processes also in other model types fisher et al 2018 seidl et al 2011a fourth although all flms are based on similar principles they have been developed for different purposes e g short term dynamics vs equilibrium simulations use different spatial and temporal scales represent trees at different levels of detail implement the main processes dispersal growth mortality in different ways and are calibrated for different species and regions consequently when using a flm the model characteristics should be carefully matched to the study question in order to minimize uncertainty the comparative model description provided in appendix b provides a good basis for such an endeavor lastly by conducting the first flm comparison study we showed that ensemble projections with flms are possible and advocate for a wider use of multiple models in future studies the observed differences among models are at least partly due to differing assumptions about processes that are not fully understood leading to competing equally plausible model formulations hence ensemble simulations with ecosystem models reflect a range of potential futures moreover ensemble projections allow for the quantification of model uncertainty but they also help us to scrutinize the potential causes for the simulated differences e g mortality formulation drought effects reproduction or regeneration feedback and stimulate important discussions among the modeling community 5 software availability landclim is developed by the forest ecology group at eth zürich switzerland it is available online at https ites fe ethz ch openaccess and can freely be used under the terms of the gnu general public license v3 landis ii is developed by the landis ii foundation a registered non profit in the usa it is open source apache license 2 0 and available online at http www landis ii org iland is developed and maintained at the ecosystem dynamics and forest management group technical university of munich source code executable and model documentation are available at http iland boku ac at the model is open source under the gnu general public license treemig is developed by the dynamic macroecology group wsl switzerland it is available upon request from heike lischke wsl ch and can freely be used under the terms of the gnu general public license v3 declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this article is based on work from cost action fp1304 profound towards robust projections of european forests under climate change supported by cost european cooperation in science and technology ah acknowledges funding through the anr alien project anr 14 ce36 0001 01 gp acknowledges funding by the swiss national science foundation snf 163250 pm acknowledges that half of the computational work for the landis ii model was executed on the it resources of the recas bari data center which were made available by two projects financed by the miur italian ministry for education university and research in the pon ricerca e competitività 2007 2013 program recas azione i interventi di rafforzamento strutturale pona3 00052 avviso 254 ric and prisma asse ii sostegno all innovazione pon04a2 a rs and ka acknowledge funding from the austrian science fund through start grant y895 b25 jb acknowledges support from czech ministry of education youth and sports project number ld15158 and by the long term research development project no rvo 67985939 from the czech academy of sciences author contributions hl and pm had the initial idea of the work all co authors contributed to the definition of the research protocol in several profound workshops gp prepared parts of the model input data and carried out simulations with iland with contributions from ka and rs hl carried out treemig simulations ah carried out landclim simulations with contributions from gp jb gv and pm carried out landis ii simulations within input from rs gp analyzed the results and led the writing all co authors discussed the analysis of the results reviewed commented on the manuscript and gave final approval for publication appendix a supplementary data the following are the supplementary data to this article multimedia component 1 multimedia component 1 multimedia component 2 multimedia component 2 multimedia component 3 multimedia component 3 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j envsoft 2020 104844 
25929,the effect of changing environmental conditions on the operation of ecosystem based pond aquaculture has been analyzed with long term dynamic simulations the applied non conventional framework of programmable process structures supports the implementation of the trans disciplinary functionalities in a transparent structure the developed model of medium complexity encompasses the interacting physical chemical biological ecological managerial and environmental processes in a unified prototyped dynamic framework this makes possible to study the effects of climate change on fishpond ecosystem and on carp growth using 50 years long dynamic simulations we have concluded that regardless to the limited amount of data the approximately validated but causally established well structured dynamic balance model may support the planning and operation of pond farming systems under temperate climate keywords process modeling fishpond ecosystem fish farming dynamic simulation climate change 1 introduction 1 1 pond aquaculture in the world aquaculture plays an important role in achieving food and nutrition security according to fao statistics 46 of the 179 million t total fish production came from aquaculture in 2018 and this number is expected to grow to 54 by 2030 fao 2018 fao 2020 more than half of the global output originates from pond farms as the production of major pond reared species carps tilapia pangasius and shrimps reached 47 million t in 2018 fao 2020 however taking into account the scarcity of land and freshwater resources complex model based understanding planning and management of these systems has an increasing importance avnimelech et al 2008 especially if adaptation to climate change is considered fao 2011 the term land based aquaculture covers the three typical production systems of flow through pond and recirculating systems heller 2017 as semi intensive ponds associate with relatively low environmental risks they come to the fore serpa et al 2013 our present work focuses on the dynamic model based analysis of semi intensively managed levee type fishponds under temperate climate conditions carps which are mainly farmed in ponds accounted for 35 of global aquaculture production in 2018 fao 2020 major carp species used in aquaculture are the herbivorous grass carp planktivorous silver carp and bighead carp and omnivorous common carp contributing to 7 6 4 and 5 of world fish production respectively typically these species are produced in polyculture in order to utilize the different niches of the pond food web efficiently among these asian carps silver carp bighead carp and grass carp are predominately dependent on the natural food sources rana et al 2009 as feeds are likely to be the main sources of greenhouse gases ghg in the aquaculture sector further development of non fed culture technologies of these species can be important in climate change mitigation hasan and soto 2017 in european pond culture common carp is the main target species other supplementary species such as asian carps account for less than 20 of the output in hungary which is one of the major carp producers in europe the ongoing recovery of pond aquaculture sector is highly based on common carp specziar and eros 2016 with a share around 78 80 aki 2018 farmers apply manuring to enhance plankton production and cereal feed is added to nutritionally supplement the natural food sources therefore fish culture is embedded in the artificially manipulated pond ecosystem which must be fully understood for the optimization of input management effective production assumes the proper management of the controllable factors in terms of feeding manuring aeration stocking density and pond level control full understanding of food web interactions and environmental impacts requires dynamic modeling and simulation based analysis of pond farming processes model based analysis has to consider all of the underlying biological chemical and physical processes e g oxygen production and utilization of phytoplankton under various solar radiation the prey predator relations amongst the food web elements etc many of which are regulated by environmental and climatic conditions in our study the modeled fish farm is a bi culture of common carp cyprinus carpio and bighead carp hypophthalmichthys nobilis where these species are farmed under semi intensive conditions meaning that both external feed and natural food contribute to the growth of fish 1 2 aquaculture production models regarding the determining elementary processes of fishpond models like growth food consumption mortality photosynthesis nitrogen and phosphorus dynamics etc we can rely on significant precedents from literature especially in the period of 1970 80 huge efforts were made to describe the behavior of the ecological communities mathematically development of knowledge for the particular sub fields and sub processes has been continuous since then considering growth models several approaches can be found in the literature for the main species the thermal growth coefficient tgc models assume that food is not limited and the key factor of growth is the water temperature jobling 2003 the simplified tgc formula was widely applied previously because of its easy usability and flexible adaptation for various specific cases e g huiwen et al 2016 jauralde et al 2013 the biomass based models do not calculate the weight of the individual fish but express the growth of the fish biomass as a function of available food feed these models can handle situations where more than one nutrient source contribute to biomass growth e g the pioneering model of svirezhev et al 1984 for ponds containing various fish and biomass components the dynamic energy budget deb theory is a formal metabolic theory which describes the aspects of metabolism energy and mass budgets of all living organisms the theory specifies that an organism is made up of two main compartments energy reserve and structure once mobilized the energy is split into two branches a fixed proportion is allocated to growth increase of structural mass and to maintenance of structure while the remaining proportion is allocated to processes of maturation and maintaining the level of attained maturity kooijman 2010 this distribution rule states that the processes of growth and maturation do not directly compete maintenance needs to be paid before allocating energy to other processes individual based models usually calculate the daily growth of fish as the function of the actual individual body mass the von bertalanffy formula is frequently used as a functionality to model the growth of individuals limiting factors of growth such as nutrient availability temperature and environmental conditions etc are typically involved into these models as multiplicative coefficients functional forms for these limiting factors are usually transformed into standardized formulas taking a maximum value of 1 kapetsky and nath 1997 lu 2003 poot lópez et al 2014 etc there are generally accepted relationships for the description of environmental conditions including but not limited to the lehmann function for the consideration of the temperature in the growth of various organisms jorgensen 1980 the relationship between growth and the actual concentration of dissolved oxygen in the water svirezhev et al 1984 or the beer lambert formula describing the effect of light on phytoplankton etc 1 3 complex modeling frameworks regarding the modeling of large ecosystems systemic thinking i e systems ecology is still a rapidly developing area borrett et al 2014 because understanding of complex interactions within ecosystems is an important issue considering the increasing environmental pressure on the overexploited resources at global level ecopath with ecosym ewe is a continuously developing tool for the mass balance based analysis of aquatic ecosystems with a dynamic simulation capability at ecosystem level christensen and pauly 1992 christensen and walters 2004 christensen et al 2005 considering the artificially managed pond ecosystems many attempts appeared relatively early wolfe et al 1986 hagiwara and mitsch 1994 to build complex simulation models perhaps svirezhev et al 1984 developed first a fishpond model where plankton benthos detritus and oxygen concentration were represented besides the farmed species as state variables conventional approaches focused on the changes of state elements of the process structures and the models were described by a set of differential equations because of the efforts of pond farmers to intensify production and to increase yields earthen pond ecosystems are manipulated by various managerial interventions that highly affect the natural interactions proper consideration of these effects has a keynote importance in modeling and simulation the comprehensive aquatic systems model casm is a generalized and flexible mass balance based aquatic food web modeling platform that addresses the solution of theoretical and practical problems for a variety of freshwater and coastal aquatic ecosystems bartell et al 1999 casm model 2013 many works build on casm approach e g schmolke et al 2019 model based decision support systems are also in the forefront of development for various fish farming systems halide et al 2009 azadivar et al 2009 cobo et al 2019 for sea cages etc predicting system response under various climatic conditions is one of the most important aspects of decision support fragoso et al 2011 apply the iphtrim3d pclake a complex 3d ecological model for the estimation of climate change effects trolle et al 2014 developed a multi model approach to enhance the accuracy of phytoplankton projections under various climatic scenarios atlantis ecosystem modeling framework fulton et al 2011 originally was developed for the consideration of various aspects biophysical economic and social of marine ecosystems now it is widely used to describe complex non linear ecosystem response to climate change both for marine e g smith et al 2015 and for lake ecosystems e g nyamweya et al 2016 2 challenge and objective nowadays planning and operation of the land water and solar energy utilization based complex agro environmental systems are supported by new generations of sensors and data acquisition methodologies of information technology however the long term integrated development of these complex systems needs to rely on causally transparent dynamic balance models this requires the application of first principles based predictive models describing the conservation laws determined nonlinear interactions pond aquaculture being a system of moderate complexity is a good example for interactions of coexisting physical chemical biological ecological environmental and managerial processes the objective of our work was to develop and to implement a unified modeling and simulation method for the broad diversified set of these multidisciplinary processes as model specific data are not always available right at the start of model building it is important to apply a flexible method that allows stepwise development of sub models in turn model based understanding and stepwise discovery of the underlying system might guide reasonable data collection based on data from a hungarian semi extensive pond farm from past 10 years present work aims to implement and to validate an extensible and reusable programmable process structure for long term dynamic simulation of pond aquaculture having validated the model the dynamic simulation based integrated analysis aims to provide long term predictions for various climate scenarios final goal of the work is to evaluate the impact of climate change on carp farming as well as to establish a comprehensive background for a complex decision support system under development within climefish project https climefish eu in addition the studied system helps to explain the applicability of the easily modifiable and extensible modeling framework developed for the unified representation of functional and structural features 3 data relationships and method 3 1 data from the fishpond used as a case study model development and validation are based on the datasets from the period of 2010 2016 of a production fishpond szegedfish ltd located at the southern great plain in hungary the studied fishpond is a 139 ha pond with a depth of 1 1 1 m stocked with common carp and bighead carp local weather conditions permit a 7 month long growing season accordingly production season from april 1 to october 31 in each year is assumed in our model pond water management in the farm is in line with the principles of typical levee type water level control accordingly ponds are filled up before the time of stocking afterwards this water level is primarily regulated by evaporation and precipitation and if it dropped below a critical threshold 0 6 0 9 m depending on season then intentional water supply is initiated monks with overflow structures provide an upper control of water level 1 1 m in case of intensive precipitation ponds are completely drained at harvest time considering the characteristics of the pond bed seepage of water as a factor can be omitted in our model it is assumed that the starting level of water on april 1 is 1 m corresponding to an initial water inlet of 10000 m3ha 1 the maximally allowed overflow level is 1 1 m the required minimal water level is 0 95 m between april 1 and august 15 and 0 6 m between august 16 and october 31 if the water level drops below this level due to evaporative losses then supplementary water use is initiated and the pond is filled from 0 9 m to a level of 1 05 m between april 1 and august 15 or from 0 6 m to 0 9 m between august 16 and october 31 after harvest the fishpond is drained at the end of the production season stratification of the various components is not considered for these shallow lakes therefore vertically homogenous water quality is assumed in the model for model validation the following data were available from the pond registry book stocking and harvesting of the main species common carp in the fishpond with occasional individual weight sampling monthly feeding monthly manuring occasional water supply from three sources own reservoir nearby river excess water occasional water level data between 2006 and 2016 occasional water temperature ph ammonium nitrite nitrate and phosphate measurements as well as occasional sampling of zooplankton with a plankton net 3 2 relationships implemented in the model the developed dynamic process model considering the actual or hypothetical meteorological parameters comprises of the prey predator fluxes between the elements of the pond food web considering their competitive consumption the anabolic catabolic growth model for the main species common carp and bighead carp including their specified feed consumption growth respiration excretion and mortality the life related processes formation respiration degradation of other food web elements the oxygen production of phytoplankton the meteorological and hydrological processes of the levee type fishponds evaporation air water oxygen transport etc the managerial interventions stocking feeding manuring water management as well as the related physical and chemical processes e g decomposition of feed and manure etc in the model we assume a simplified food web according to fig 1 in the following parts we introduce an overview of the model while the detailed explanation of the implemented relationships is described in the supplementary material 3 2 1 anabolic catabolic growth model of product fish main target species of the fishpond studied is common carp which is co cultured with planktivorous bighead carp for the calculation of the individual weight of the fish we applied a bertalanffy kinetic von bertalanffy 1938 based model accordingly there is a declining specific growth rate of fish resulting from the superposed weight dependent anabolic and catabolic processes the fish weight dependent feed intake being a sum of natural food and supplemented forage is determined by a fish specific consumption coefficient and the relative food availability moreover it also depends on environmental conditions e g winberg 1960 ursin 1967 the digestible fraction of feed intake is used partly for catabolism and partly for anabolism the relative food availability bolte et al 1995 kapetsky and nath 1997 jamu and piedrahita 1995 lu 2003 expresses two quite different effects namely the limited amount of the available feed and the possible choice between the various simultaneously available alternative nutrient sources natural food regulated by food web processes and artificial feed there are various modeling approaches to describe formally the fish s preference between the alternative natural and artificial nutrient sources as follows demand driven clear preference the less preferred food is consumed only when the more preferred one is missing e g kapetsky and nath 1997 supply driven preference controlled by the ratio of the available alternative feeds e g varga and csukas 2017b preference weighted supply driven distribution controlled by the weighted ratio of the available alternative feeds a possible more sophisticated solution with more data demand w s tan via svirezhev et al 1984 application of probabilistic switching functions e g svirezhev et al 1984 with additional data demand in our model implementation we utilize a simplified availability driven heuristics instead of taking into consideration the preference of various food web elements we use a formula for the consideration of the availability of the given food source assuming that the given species does not select but consumes the food sources in the proportion of their availability the effects of environmental conditions on feed intake are usually modeled with the use of dimensionless coefficients from the 0 1 interval expressing the impact of the actual temperature considering a minimal maximal and an optimal value brett 1979 bolte et al 1995 the dissolved oxygen concentration with respect to a critical and a minimal value bolte et al 1995 the ammonia level considering a critical and a maximally allowed level cuenco et al 1985 bolte et al 1995 while the unionized ammonia concentration can be calculated from the total ammonia nitrogen concentration and the ph as well as the actual biological oxygen demand with respect to its critical and maximal levels the coefficient of catabolism increases with temperature within the tolerance limits for a given species ursin 1967 cuenco et al 1985 in our model we assume an exponential relationship between catabolic coefficient and temperature following nath 1996 the utilized relationships are described in the supplementary material in detail while all of the applied parameters for common carp together with the source of origin are listed in the param input output variables xlsx file of supporting mendeley data varga et al 2020b 3 2 2 calculation of biomass for the other elements of food web in the biomass calculation of other food web elements zooplankton phytoplankton benthos and detritus we consider the structure of the food web the consumption related biomass growth anabolic growth energy production catabolism and decrease of biomass mortality and decomposition of various species in the description of these processes we rely on various early works e g svirezhev et al 1984 the food consumption and the respective weight increase of predators biomass is calculated by a michaelis menten like saturation kinetics for each preys considering a specific maximal uptake rate coefficient a half saturation coefficient and the availability factor of the given prey assuming a simple supply driven preference the effects of temperature and dissolved oxygen are taken into consideration by the appropriate efficiency factors the decrease in biomass consists of the optional catabolized portion of consumed biomass the fecal loss and the mortality the decomposition of food web elements increases the pool of detritus in contrary we also take into consideration the consumption related decrease of detritus according to the food web see fig 1 e g in case of bighead carp zooplankton and benthos finally the decomposition of detritus produces dissolved phosphorus and nitrogen for phytoplankton 3 2 3 photosynthesis and respiration of phytoplankton functioning of the food web and the natural oxygen supply of fishponds highly depend on the production of phytoplankton the growth of phytoplankton biomass is calculated in a michaelis menten like kinetics from the rate determining nitrogen or phosphorus level considering a maximum growth rate coefficient multiplied by a light coefficient and by a temperature factor the light coefficient is expressed by a lambert beer law based formula where the illumination is determined from the actual solar radiation a light extinction coefficient and the characteristic water depth of the photosynthesis svirezhev et al 1984 with reference to steele 1962 the extinction coefficient is modified also by the phytoplankton concentration self shading and by the suspended fraction of detritus shading decrease of nitrogen and phosphorus is determined from the phytoplankton growth applying the typical redfield ratio perdue 2009 of atoms c n p the phytoplankton related oxygen balance is calculated from the assimilation of the new phytoplankton biomass with an assimilation coefficient and from the respiration of the actually existing biomass with a respiration coefficient 3 2 4 environmental relationships high precision models for calculation of evaporation are available in the literature e g saloranta and andersen 2007 however they are designed for the precise modeling of deep water lakes with a large input data requirement considering the limited availability of measured fishpond related and forecasted climate data we use an approximate model the calculation of evaporation is implemented by the generally accepted empirical expression of antal and tóth 1976 developed and validated for the shallow lakes e g lake balaton in hungary the applied formula estimates evaporation with less input data requirement utilizing the water temperature dependent equilibrium vapor pressure the actual vapor pressure and the wind speed the modified version of the original formula is corrected with a seasonal coefficient vituki 1986 in the model development we use historical meteorological data for two geographic areas of the southern and northern great plain of hungary based on the validated model the noresm rcp 4 5 and rcp 8 5 climate scenarios are used to determine predictions for the same two geographic locations however using this climate model that provides only daily air temperature and precipitation data we have to make some simplifying assumptions one of these simplifying assumptions is to approximate the daily average water temperature with daily average air temperature it is to be noted that in principle the surface water temperature should be used for calculation of equilibrium vapor pressure this surface temperature is the convex combination of air and water temperatures however the analysis of data from the period of 2009 2014 confirmed that use of average water temperature is applicable for the fishpond production period april october for the calculation of the actual vapor pressure the relative humidity is also required as the relative humidity data are not available in the climate scenarios we utilized 60 as an average value for the production period estimated also from the above mentioned 6 year long data series regarding wind speed our simplifying assumption was to use the average daily value coming again from the recorded historical data 3 2 5 consideration of the managerial interventions of feeding and fertilizing data for feeding and fertilizing came from the monthly aggregated records of the investigated fishpond in case of feeding we divided the gross monthly amount into daily portions regarding fertilization in line with the practice we considered that the organic manure is dispensed in the first three days of every month in the season a given part of the forage characterized by a heuristic coefficient decomposes spontaneously and it decreases the available artificial feed pool as well as increases the amount of detritus similarly we took into consideration the decomposition of the supplied organic fertilizer with another factor organic manure decomposition supplies utilizable dissolved phosphorus and nitrogen according to the respective destruction coefficient that also depends on the temperature and on the concentration of dissolved oxygen non linearly on the other hand a given part of dissolved phosphorus mineralizes and settles in the sediment with a rate that is a nonlinear function of oxygen concentration 3 3 process modeling by programmable process structures programmable process structures pps is a non conventional process modeling and simulation method it has developed from the former direct computer mapping dcm csukas 1998 csukas et al 2011 in the past years dcm originally was applied for the solution of various chemical engineering problems e g csukas et al 1999 temesvari et al 2004 csukas et al 2013 the basic characteristic of the method is that the natural building blocks of the process systems can be mapped onto an executable computer code directly the field of application broadened toward the model based understanding of biosystems as well as model based analysis and planning of agricultural and environmental process systems in the past years in these fields we recognized the increasing demand for a flexible and easily extensible modeling framework that is able to generate and visualize the process model automatically accordingly the original dcm has developed toward programmable process structures comprising the automatic structure and model generation from the unified description of underlying process systems varga et al 2017 it has been applied for the modeling and simulation of a wide range of process systems in the past years varga et al 2016 2017 2020a varga and csukas 2017b the main components of the framework are general kernel of the model generator and simulator written in platform independent gnu prolog a declarative logical language of artificial intelligence graphml based representation of process structure with locally editable description of case specific functionalities connected databases of case specific actual and hypothetical meteorological as well as hydrological data the scheme of model generating procedure can be seen in fig 2 starting from a conceptual model of the investigated problem an empty process structure without the functionalities is generated from two one state and one transition meta prototypes that are the general building blocks of the framework the standardized description of the investigated system s process network and the associated set of initial data and parameters after the generation of the structure the next step is the definition of functionalities that means the formulation of the relationships in form of local programs actually declared in gnu prolog syntax gnu prolog as a declarative logical language of artificial intelligence applies unification based data flows that are useful for knowledge representation additional advantages come with the locally executable reusable brief program code prototypes this is especially useful for the description of large multi scale systems consisting of many stereotypical parts it is also important to highlight that the majority of the variables is local that supports re usability of program code in similar cases as well as the easy use of variable names because the consistency of variable names must be ensured only within the individual local programs detailed explanation of the building elements i e the architecture of states transitions and the connections between them the generalized description describing the process network as well as the execution scheme of the simulation model can be found in our former works varga and csukas 2017a 2017b varga et al 2017 4 results of model development by implementing programmable process structures 4 1 generation of the parameterized fishpond model involving a food web the conceptual model of the fishpond ecosystem highlighting the interconnected environmental and managerial effects is shown in fig 3 in line with the principles of pps model building is based on this conceptual model starting from this we have to define the state and transition elements of the underlying processes the actual state and transition elements are summarized in table s1 of the supplementary material the state elements refer to those entities components signals that must be considered in the model the transition elements represent the underlying physical chemical biological ecological environmental and managerial processes to be taken into consideration in the calculations general description of model building procedure is described in former publications varga and csukas 2017a 2017b varga et al 2017 however some important details are highlighted here in the context of fishpond ecosystems the process network is declared as follows states coordlist statelist dcode stateid dnamelist dcodesign stateid dnamelist transitions coordlist transitionlist trans transitionid inpintlist inpsignlist outextlist outsignlist where coordlist coord a list of coordinates and coord atomic statelist stateid a list consisting of the underlying state elements and stateid symbol dnamelist dname a list consisting the names of underlying d triplets of the state elements and dname symbol transitionlist transitionid a list consisting of the underlying transition elements and transitionid symbol inpintlist inpsignlist outextlist outsignlist connection connection n coordlist statelist while statelist determines the connected intensive properties and signals in the input side as well as the extensive measures and signals in the output side of the transition elements accordingly the trans predicates describe the structure with the connections between the involved states and transitions this declaration of the process network is conform with state and transition meta prototypes which are the two general templates of the method containing slots with empty lists for the above interpreted inputs outputs and parameters as well as a place for local program code or for its identifier in the state and transition elements in accordance with table s1 of the supplementary material the lowest level data structures are the d dname value dimension triplets containing the value of the actual input parameter and output data the general kernel program generates the empty programmable process structure from the two general meta prototypes and from the above introduced standardized description of the case specific process network also the initial data and parameters can be imported from a database into pps during the generation procedure the most important initial values of the state elements are summarized in table 1 the parameters of the state and transition elements must be consistent with the symbolic parameters of the local programs accordingly they can be finalized in the knowledge of the program prototypes see later the actually applied parameters are presented in the supporting mendeley data varga et al 2020b the generated programmable process structure is shown in fig 4 technically it is in graphml format that supports visualization and flexible editing of prototypes including also the calculation determining local program codes 4 2 programming of the locally interpretable functional prototypes of the model as a next step the parameterized and initialized structure of fig 4 has to be extended with the prototype elements these prototypes contain the calculation formulas in form of local program codes the necessary prototype elements are summarized in table s1 supplementary material technically it means making copies from the meta prototypes next the executable program code of calculation can be formulated by using the variables in the input parameter and output slots of these prototype elements each actual element within the network have to be associated with one prototype program as listed in table s1 in the supplementary material in accordance with their own initial data and parameters it is to be emphasized that usually many general state and transition elements in the network utilize the same prototype program during the execution of the simulation all the actual state and transition elements are calculated by the respective prototype program by unifying binding the variables with its own actual data and parameters the programming of prototypes is illustrated with the example of the life related processes of common carp in table s2 in the supplementary material in parallel with the programming of prototypes the actual initial data and parameters of these general prototypes have to be assigned to the actual state and transition elements of process network the explanation of the utilized global variables inputs parameters and outputs are summarized in the supporting mendeley data varga et al 2020b 4 3 validation of the model by the measured data stocking and harvesting data for the main commercialized species common carp occasional individual weight measurements as well as occasional water level measurements are utilized to validate the model to evaluate the accuracy of the model the normalized root mean square error nrmse values are calculated by the following expression nrmse i 1 n c i m i 2 n m 100 where ci is the ith calculated value mi is the ith measured value n is the number of observations m is the mean of measured values the nrmse values of 6 3 for pond level and 15 for carp biomass show an acceptable prediction ability of the model at the present state of developments it is to be noted that in the continuing work there are additional ongoing measurements regarding phytoplankton and zooplankton to improve the model the comparison of measured and calculated data can be seen in fig 5 the 110 cm upper limit of pond level comes from the applied practice of the fishpond management that has been added to the model in form of rules for the years of 2014 and 2016 water supply was not recorded accordingly it was not taken into consideration in the model causing a significant difference between measured and calculated data regarding carp biomass there is a remarkable difference between measured and calculated data for the year 2015 measured data in the pond register book showed 468 kg ha stocking at the beginning of season while harvesting data was 593 kg ha at the end of october it would not be economically viable to produce such a low net yield accordingly we assume that an extraordinary event outside the model boundaries e g high mortality due to bird predation or disease caused the extremely low biomass gain fig 6 shows another representation of comparing pond level and biomass data to illustrate the matching of measured and calculated values fig 7 illustrates the comparison between measurements occasional sampling harvest and model predictions for individual weight of carp here mismatch is noticeable because the calculated values correspond to average individual weights while random sampling does not always reflect these average data the available measurements do not allow the parameter identification for the other food web elements and dissolved components in the fishpond accordingly we applied those parameters that were suggested in the literature sources in the continuing work a series of experiments is planned for the validation of the model in relation to phytoplankton zooplankton and dissolved components more accurately 5 results and discussion of process simulations 5 1 overview of possible modes of model execution one of the final goals of present development is to embed the model into a decision support tool which is under development by climefish project team https climefish eu accordingly to allow a faster application the general kernel of simulator is prepared for the following modes of execution simulation of single or multiple past production seasons from april 1 to october 31 with factual meteorological and managerial data simulation with single and multiple production seasons from april 1 to october 31 with factual meteorology but with various hypothetical sets of pond management scenarios detailed run for various management and climate scenarios with daily output reporting simplified run for various management and climate scenarios with end of season reporting for each simulated year these modes of simulation are developed as extensions of the general kernel program accordingly single or multiple years started with various sets of parameters are initiated and executed automatically controlled by a configuration file the simulated outputs are displayed in csv file format for flexible further processing for demonstration of the model an executable process simulator with the necessary auxiliary files and with a detailed guide is available in the fishpond simulator folder of the mendeley database varga et al 2020b in the next sections some illustrative results from the various simulations will be discussed 5 2 simulation results for the 2010 2016 period having applied the simulation mode of multiple runs for the past production seasons we can have a deeper insight to the causal relations amongst the various elements in the pond a detailed simulation result can be seen in the supporting mendeley data varga et al 2020b fig 8 shows the changes of fertilizer and feed concentration in the fishpond having started from the factual data of fertilizer and forage supply the curves reflect the actual concentration along time taking into account the temperature and oxygen dependent decomposition of fertilizer see eqs 33 40 in supplementary material and forage as well as the actual consumption of common carp fig 9 shows the biomass of the common carp and bighead carp dynamic behavior of other food web elements can be seen in fig 10 it is to be noted that calculations are based on the parameters from the literature and further validation with detailed experimental background will follow in the ongoing work however it is worth analyzing the trends of the dynamic changes as the amount of common carp and bighead carp starts to increase in each season fig 9 the biomass of zooplankton being part of the diet of both fish species decreases accordingly fig 10 hectic changes of phytoplankton biomass described by eqs 25 28 in supplementary material are determined by dynamics of predation pressure function of bighead carp zooplankton and benthos biomass availability of nitrogen and phosphorus as well as exposure to light the latter factor is regulated by solar radiation and the turbidity of water which depends on the actual detritus biomass because of its shading effect the catabolized and decomposed biomass of living organisms also contribute to the detritus mass in fig 11 we can follow the dynamic change of dissolved oxygen concentration during the production seasons the diagram shows the summarized effects of the consumption by various species the oxygen produced by the phytoplankton biomass as well as the temperature dependent air water oxygen transfer aerators were not applied in the investigated fishpond dynamic behavior of the nitrogen and phosphorus concentration see fig 12 show the cumulated effect of the nutrient utilization by phytoplankton biomass eqs 29 and 30 of the monthly supply of organic fertilizer as well as the continuous degradation of food web elements 5 3 analysis of various pond management scenarios the previous analysis focused on simulation results for the studied fishpond in szegedfish ltd the respective fish farming data are summarized in table 2 for the period of 2010 2016 in the following part we apply the simulation model for studying a hypothetic fishpond using parameters reflecting the typical hungarian conditions and technological settings the feeding intensity and stocking density applied in the year 2011 are very close to respective industry level averages aki 2018 for this reason we selected the technological settings of 2011 as a baseline management scenario and based on these values we compiled a design space of the initial data and parameters for the model see table 3 to develop a hypothetical typical fishpond for the further investigations starting from these initial conditions model calculations were performed for 80 different pond management scenarios a pond management scenario is defined as a certain combination of feeding strategy and stocking density 10 different stocking densities see rows in table 4 and 8 different feeding options see columns in table 4 were considered bold italic number in table 4 refers to the baseline management scenario historical meteorological data for the period of 2006 2016 for two different locations szeged and debrecen hungary were used in the simulations output results can be studied in the supporting mendeley data varga et al 2020b in detail the values in table 4 refer to the carp biomass at the end of the season simulation results show the average data for the period of 2006 2016 fig 13 illustrates the tendencies of data in table 4 it is worth paying attention to the fact that having fixed stocking densities at lower values increasing feeding intensity would lead to lower biomass yield because the degradation of uneaten feed causes oxygen deficient environment this situation occurs when the relatively low carp biomass is not able to uptake the large amount of feed present in the pond summarizing the results ecosystem based pond aquaculture proved to be a good example where the analysis of the various managerial scenarios needs causally transparent dynamic balance models in the present work we implemented the trans disciplinary model of fishpond aquaculture in the unified generic framework of programmable process structures based on the data from a hungarian semi extensive pond farm operating bi culture technology an integrated reusable dynamic simulation model of levee type fishponds has been developed considering also the human management activities at the present state of the modeling the calculated nrmse values show acceptable match between measured and calculated data for common carp biomass and water level in the knowledge of the validated model the dynamic simulation provides appropriate analysis of the complex system with the consideration of the interactions amongst the elements of the food web the physical chemical and biological processes in the present and forecasted meteorological environment the managerial interventions of the farmer stocking density feeding fertilization aeration pond level control the applied non conventional method of programmable process structures supports the integrated implementation of the trans disciplinary functionalities in a unified transparent structure 5 4 simulations for noresmrcp 4 5 and 8 5 climate scenarios finally predictions for future climate scenarios were performed with the model in this case regional climate model of noresm was applied for the period of 2017 2065 while for the retrospective period of 2006 2016 the factual meteorological data were used representative concentration pathway rcp 4 5 and 8 5 scenarios were utilized downscaled to a resolution of 0 25 0 25 for two locations of szeged and debrecen hungary downloaded from opennex repository http opennex planetos com gddp forecasted data for precipitation mm day and average air temperature c were utilized as input data for the simulations it is to be noted that according to previous investigations air temperature can be utilized because it is in high correlation with water temperature for shallow 1 1 m depth fishponds during the farming season we obtained air and water temperature data in the period of april october between 2006 and 2016 in the given region szeged hungary based on the normality tests we ran parametric two tailed pearson correlations the result of the test was highly significant r 167 0 807 p 001 we concluded that approximating water temperature with air temperature is acceptable at this location and time period this is in line with the data content of climate scenarios too the simulations were executed for the period of 2006 2065 with the pond management scenarios presented in table 4 the simulation mode of simplified run for various climate scenarios see in section 5 1 was used accordingly 10x8 simulations were made each of them from 2006 to 2065 the computational time for this amount of calculations was around 6 h using an average capacity notebook to fasten simulation output recording can be restricted for the last day of season october 31st in each simulation some examples illustrating the capabilities of the detailed simulation can be seen in figs 14 17 fig 14 shows the dynamic changes of dissolved oxygen concentration in the fishpond along the production seasons at the szeged location for the rcp 4 5 climate scenario fig 15 shows the dynamics of phytoplankton biomass for the same simulation period and location under rcp4 5 climate scenario it can be seen that climate change induces increased occurrence of extreme values of oxygen levels and phytoplankton biomass over the next decades fig 16a and b shows a prediction for the average individual weight of the main target species common carp at the end of the seasons a very slowly increasing trend can be observed in the individual weight that can be resulted by the increased anabolic activity in fig 17 we show a zoomed period about the same simulation recorded with daily time step between 2023 and 2027 where the effect of various stocking feeding densities can be studied it is worth paying attention to the calculation results under zero feeding conditions with solid line in fig 17 here the initial weight gain of fish is constrained by the total depletion of natural food after several weeks and loss in average weight occurs due to starvation output results can be studied in the supporting mendeley data varga et al 2020b in detail in the following some complex causal relationships will be illustrated fig 18 illustrates the predicted difference in average common carp yields in the periods of 2006 2016 and 2045 2055 the calculations were made for szeged location utilizing the rcp4 5 climate scenario it is worth mentioning that significant differences appear for those management strategies that are characterized by lower 100 250 kg ha stocking density and intensive feeding rate 3000 kg ha however these input combinations are outside the range of economically optimal pond management strategies as feed utilization efficiency is very low see fig 13 the reason for the large increase in predicted yields over the decades is that anabolic activity and appetite of carp will increase with higher temperatures in the period of 2045 55 and for this reason feed utilization will be more efficient this implies that there would be less waste of forage see fig 19 and this will decrease the frequency of oxygen deficient periods we summarize that the process model of medium complexity makes it possible to study the effects of climate change on the ecosystem based fish farming using 50 years long detailed dynamic simulations it is to be emphasized that present model does not take into account the effects of climate change on fish diseases risk of diseases is generally expected to increase with climate change specifically due to the increase in water temperature and extreme weather events similarly outbreaks of koi herpesvirus in carp fisheries are likely to occur over longer periods on the other hand susceptibility for exotic pathogens like the spring viremia of carp virus is expected to decline as infections generally establish in colder 17 c waters marcos lopez et al 2010 although the model described here does not encompass expressions for dependency of survival rates on climatic factors sensitivity of production performance to disease outbreak events can be tested by running simulations with alternative mortality parameters for carp 6 conclusions and outlook we concluded that regardless to the actually limited amount of training data the approximately validated but causally established well structured and balance based dynamic model may support the planning and operation of the investigated system the simulation results give a deeper insight into the causal relations amongst the various elements in the pond dynamic simulation based case studies help to understand and to analyze the complex interacting mechanisms in the fishpond as an example this is demonstrated by the impact of climate change on dissolved oxygen balance as follows the rate of oxygen component transfer between air and water is determined by the temperature dependent equilibrium oxygen concentration global warming decreases this equilibrium concentration and oxygen absorption accordingly also the greater anabolic activity of heterotrophic organisms increases oxygen consumption further deteriorating the oxygen balance on the other hand warmer water increases phytoplankton biomass and the related photosynthesis triggering a higher rate of oxygen production by autotrophic organisms in the pond accordingly the positive impacts of climate change may compensate the negative ones on oxygen concentration in carp ponds simulations show that these influences altogether might result in some possible positive side effect of climate change the simulation model proved to support the managerial decisions in terms of feeding and stocking technologies the analysis of systematic simulations for several managerial options and climate scenarios can help to adapt farming technology to altered climatic conditions by identifying those feeding and stocking strategies that are most beneficially impacted by climate change the method allows to easily modify and extend the temporarily applied structure and functionalities moreover starting from the input files of the state and transition prototypes and elements it is possible to build new models for other case studies the method supported the analysis of climate change effects on modeled pond aquaculture technologies for this daily air temperature and precipitation forecasts under rcp 4 5 and 8 5 scenarios of noresm climate model were utilized and aquaculture operation was simulated for a 50 years period 80 managerial scenarios for feeding rates and stocking densities were considered by simulations the prediction for the average individual weight of common carp showed a very slowly increasing trend that may be resulted from the increased anabolic activity in line with the slowly increasing temperature from a methodological viewpoint the studied example demonstrated the applicability of the modeling framework developed for the unified representation of functional and structural features there is a complex network of influences among the interacting natural processes and human activities the environmentally benign and profitable cooperation of the natural and human controlled processes may be studied by simulations for instance we can search for a compromise between manuring technology which mobilizes availability of plankton for target species and feeding technology in a good solution cost efficient nutrition of carps can be satisfied with a feasible water quality it is a general lesson that besides the sensors and data acquisition based methods the long term decisions about the integrated development of complex agro environmental systems may and must be supported also by the predictive first principles based dynamic balance modeling the main point of the following work is to evaluate the economic viability of the applied managerial scenarios based on the validated model the model will be embedded in a decision support tool that is under development in climefish project https climefish eu this dss aims to provide detailed model based predictions for shallow ponds in central europe under various climatic scenarios in the ongoing work a series of experiments is planned for the better understanding of phytoplankton zooplankton and dissolved component related processes this research focuses on the identification and validation of a more precise model that comprises more plankton pseudo groups availability of demonstration model executable and necessary auxiliary files for a test example are available http dx doi org 10 17632 p3bwbphj6x 1 year first available 2020 hardware and software required basic pc 2 5 ghz cpu 8 gb ram windows10 64bit program language executable demonstration simulator and auxiliary test example files gnu prolog 1 4 4 contact address varga monika ke hu declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement model development was supported by the horizon 2020 european research project climefish grant no 677039 data collection was supported by ginop 2 3 2 15 2016 00025 project of european regional development fund and the naik h15210 project of ministry of agriculture hungary authors would like to thank szegedfish ltd for allowing access to pond registry books appendix a supplementary data the following are the supplementary data to this article multimedia component 1 multimedia component 1 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j envsoft 2020 104755 
25929,the effect of changing environmental conditions on the operation of ecosystem based pond aquaculture has been analyzed with long term dynamic simulations the applied non conventional framework of programmable process structures supports the implementation of the trans disciplinary functionalities in a transparent structure the developed model of medium complexity encompasses the interacting physical chemical biological ecological managerial and environmental processes in a unified prototyped dynamic framework this makes possible to study the effects of climate change on fishpond ecosystem and on carp growth using 50 years long dynamic simulations we have concluded that regardless to the limited amount of data the approximately validated but causally established well structured dynamic balance model may support the planning and operation of pond farming systems under temperate climate keywords process modeling fishpond ecosystem fish farming dynamic simulation climate change 1 introduction 1 1 pond aquaculture in the world aquaculture plays an important role in achieving food and nutrition security according to fao statistics 46 of the 179 million t total fish production came from aquaculture in 2018 and this number is expected to grow to 54 by 2030 fao 2018 fao 2020 more than half of the global output originates from pond farms as the production of major pond reared species carps tilapia pangasius and shrimps reached 47 million t in 2018 fao 2020 however taking into account the scarcity of land and freshwater resources complex model based understanding planning and management of these systems has an increasing importance avnimelech et al 2008 especially if adaptation to climate change is considered fao 2011 the term land based aquaculture covers the three typical production systems of flow through pond and recirculating systems heller 2017 as semi intensive ponds associate with relatively low environmental risks they come to the fore serpa et al 2013 our present work focuses on the dynamic model based analysis of semi intensively managed levee type fishponds under temperate climate conditions carps which are mainly farmed in ponds accounted for 35 of global aquaculture production in 2018 fao 2020 major carp species used in aquaculture are the herbivorous grass carp planktivorous silver carp and bighead carp and omnivorous common carp contributing to 7 6 4 and 5 of world fish production respectively typically these species are produced in polyculture in order to utilize the different niches of the pond food web efficiently among these asian carps silver carp bighead carp and grass carp are predominately dependent on the natural food sources rana et al 2009 as feeds are likely to be the main sources of greenhouse gases ghg in the aquaculture sector further development of non fed culture technologies of these species can be important in climate change mitigation hasan and soto 2017 in european pond culture common carp is the main target species other supplementary species such as asian carps account for less than 20 of the output in hungary which is one of the major carp producers in europe the ongoing recovery of pond aquaculture sector is highly based on common carp specziar and eros 2016 with a share around 78 80 aki 2018 farmers apply manuring to enhance plankton production and cereal feed is added to nutritionally supplement the natural food sources therefore fish culture is embedded in the artificially manipulated pond ecosystem which must be fully understood for the optimization of input management effective production assumes the proper management of the controllable factors in terms of feeding manuring aeration stocking density and pond level control full understanding of food web interactions and environmental impacts requires dynamic modeling and simulation based analysis of pond farming processes model based analysis has to consider all of the underlying biological chemical and physical processes e g oxygen production and utilization of phytoplankton under various solar radiation the prey predator relations amongst the food web elements etc many of which are regulated by environmental and climatic conditions in our study the modeled fish farm is a bi culture of common carp cyprinus carpio and bighead carp hypophthalmichthys nobilis where these species are farmed under semi intensive conditions meaning that both external feed and natural food contribute to the growth of fish 1 2 aquaculture production models regarding the determining elementary processes of fishpond models like growth food consumption mortality photosynthesis nitrogen and phosphorus dynamics etc we can rely on significant precedents from literature especially in the period of 1970 80 huge efforts were made to describe the behavior of the ecological communities mathematically development of knowledge for the particular sub fields and sub processes has been continuous since then considering growth models several approaches can be found in the literature for the main species the thermal growth coefficient tgc models assume that food is not limited and the key factor of growth is the water temperature jobling 2003 the simplified tgc formula was widely applied previously because of its easy usability and flexible adaptation for various specific cases e g huiwen et al 2016 jauralde et al 2013 the biomass based models do not calculate the weight of the individual fish but express the growth of the fish biomass as a function of available food feed these models can handle situations where more than one nutrient source contribute to biomass growth e g the pioneering model of svirezhev et al 1984 for ponds containing various fish and biomass components the dynamic energy budget deb theory is a formal metabolic theory which describes the aspects of metabolism energy and mass budgets of all living organisms the theory specifies that an organism is made up of two main compartments energy reserve and structure once mobilized the energy is split into two branches a fixed proportion is allocated to growth increase of structural mass and to maintenance of structure while the remaining proportion is allocated to processes of maturation and maintaining the level of attained maturity kooijman 2010 this distribution rule states that the processes of growth and maturation do not directly compete maintenance needs to be paid before allocating energy to other processes individual based models usually calculate the daily growth of fish as the function of the actual individual body mass the von bertalanffy formula is frequently used as a functionality to model the growth of individuals limiting factors of growth such as nutrient availability temperature and environmental conditions etc are typically involved into these models as multiplicative coefficients functional forms for these limiting factors are usually transformed into standardized formulas taking a maximum value of 1 kapetsky and nath 1997 lu 2003 poot lópez et al 2014 etc there are generally accepted relationships for the description of environmental conditions including but not limited to the lehmann function for the consideration of the temperature in the growth of various organisms jorgensen 1980 the relationship between growth and the actual concentration of dissolved oxygen in the water svirezhev et al 1984 or the beer lambert formula describing the effect of light on phytoplankton etc 1 3 complex modeling frameworks regarding the modeling of large ecosystems systemic thinking i e systems ecology is still a rapidly developing area borrett et al 2014 because understanding of complex interactions within ecosystems is an important issue considering the increasing environmental pressure on the overexploited resources at global level ecopath with ecosym ewe is a continuously developing tool for the mass balance based analysis of aquatic ecosystems with a dynamic simulation capability at ecosystem level christensen and pauly 1992 christensen and walters 2004 christensen et al 2005 considering the artificially managed pond ecosystems many attempts appeared relatively early wolfe et al 1986 hagiwara and mitsch 1994 to build complex simulation models perhaps svirezhev et al 1984 developed first a fishpond model where plankton benthos detritus and oxygen concentration were represented besides the farmed species as state variables conventional approaches focused on the changes of state elements of the process structures and the models were described by a set of differential equations because of the efforts of pond farmers to intensify production and to increase yields earthen pond ecosystems are manipulated by various managerial interventions that highly affect the natural interactions proper consideration of these effects has a keynote importance in modeling and simulation the comprehensive aquatic systems model casm is a generalized and flexible mass balance based aquatic food web modeling platform that addresses the solution of theoretical and practical problems for a variety of freshwater and coastal aquatic ecosystems bartell et al 1999 casm model 2013 many works build on casm approach e g schmolke et al 2019 model based decision support systems are also in the forefront of development for various fish farming systems halide et al 2009 azadivar et al 2009 cobo et al 2019 for sea cages etc predicting system response under various climatic conditions is one of the most important aspects of decision support fragoso et al 2011 apply the iphtrim3d pclake a complex 3d ecological model for the estimation of climate change effects trolle et al 2014 developed a multi model approach to enhance the accuracy of phytoplankton projections under various climatic scenarios atlantis ecosystem modeling framework fulton et al 2011 originally was developed for the consideration of various aspects biophysical economic and social of marine ecosystems now it is widely used to describe complex non linear ecosystem response to climate change both for marine e g smith et al 2015 and for lake ecosystems e g nyamweya et al 2016 2 challenge and objective nowadays planning and operation of the land water and solar energy utilization based complex agro environmental systems are supported by new generations of sensors and data acquisition methodologies of information technology however the long term integrated development of these complex systems needs to rely on causally transparent dynamic balance models this requires the application of first principles based predictive models describing the conservation laws determined nonlinear interactions pond aquaculture being a system of moderate complexity is a good example for interactions of coexisting physical chemical biological ecological environmental and managerial processes the objective of our work was to develop and to implement a unified modeling and simulation method for the broad diversified set of these multidisciplinary processes as model specific data are not always available right at the start of model building it is important to apply a flexible method that allows stepwise development of sub models in turn model based understanding and stepwise discovery of the underlying system might guide reasonable data collection based on data from a hungarian semi extensive pond farm from past 10 years present work aims to implement and to validate an extensible and reusable programmable process structure for long term dynamic simulation of pond aquaculture having validated the model the dynamic simulation based integrated analysis aims to provide long term predictions for various climate scenarios final goal of the work is to evaluate the impact of climate change on carp farming as well as to establish a comprehensive background for a complex decision support system under development within climefish project https climefish eu in addition the studied system helps to explain the applicability of the easily modifiable and extensible modeling framework developed for the unified representation of functional and structural features 3 data relationships and method 3 1 data from the fishpond used as a case study model development and validation are based on the datasets from the period of 2010 2016 of a production fishpond szegedfish ltd located at the southern great plain in hungary the studied fishpond is a 139 ha pond with a depth of 1 1 1 m stocked with common carp and bighead carp local weather conditions permit a 7 month long growing season accordingly production season from april 1 to october 31 in each year is assumed in our model pond water management in the farm is in line with the principles of typical levee type water level control accordingly ponds are filled up before the time of stocking afterwards this water level is primarily regulated by evaporation and precipitation and if it dropped below a critical threshold 0 6 0 9 m depending on season then intentional water supply is initiated monks with overflow structures provide an upper control of water level 1 1 m in case of intensive precipitation ponds are completely drained at harvest time considering the characteristics of the pond bed seepage of water as a factor can be omitted in our model it is assumed that the starting level of water on april 1 is 1 m corresponding to an initial water inlet of 10000 m3ha 1 the maximally allowed overflow level is 1 1 m the required minimal water level is 0 95 m between april 1 and august 15 and 0 6 m between august 16 and october 31 if the water level drops below this level due to evaporative losses then supplementary water use is initiated and the pond is filled from 0 9 m to a level of 1 05 m between april 1 and august 15 or from 0 6 m to 0 9 m between august 16 and october 31 after harvest the fishpond is drained at the end of the production season stratification of the various components is not considered for these shallow lakes therefore vertically homogenous water quality is assumed in the model for model validation the following data were available from the pond registry book stocking and harvesting of the main species common carp in the fishpond with occasional individual weight sampling monthly feeding monthly manuring occasional water supply from three sources own reservoir nearby river excess water occasional water level data between 2006 and 2016 occasional water temperature ph ammonium nitrite nitrate and phosphate measurements as well as occasional sampling of zooplankton with a plankton net 3 2 relationships implemented in the model the developed dynamic process model considering the actual or hypothetical meteorological parameters comprises of the prey predator fluxes between the elements of the pond food web considering their competitive consumption the anabolic catabolic growth model for the main species common carp and bighead carp including their specified feed consumption growth respiration excretion and mortality the life related processes formation respiration degradation of other food web elements the oxygen production of phytoplankton the meteorological and hydrological processes of the levee type fishponds evaporation air water oxygen transport etc the managerial interventions stocking feeding manuring water management as well as the related physical and chemical processes e g decomposition of feed and manure etc in the model we assume a simplified food web according to fig 1 in the following parts we introduce an overview of the model while the detailed explanation of the implemented relationships is described in the supplementary material 3 2 1 anabolic catabolic growth model of product fish main target species of the fishpond studied is common carp which is co cultured with planktivorous bighead carp for the calculation of the individual weight of the fish we applied a bertalanffy kinetic von bertalanffy 1938 based model accordingly there is a declining specific growth rate of fish resulting from the superposed weight dependent anabolic and catabolic processes the fish weight dependent feed intake being a sum of natural food and supplemented forage is determined by a fish specific consumption coefficient and the relative food availability moreover it also depends on environmental conditions e g winberg 1960 ursin 1967 the digestible fraction of feed intake is used partly for catabolism and partly for anabolism the relative food availability bolte et al 1995 kapetsky and nath 1997 jamu and piedrahita 1995 lu 2003 expresses two quite different effects namely the limited amount of the available feed and the possible choice between the various simultaneously available alternative nutrient sources natural food regulated by food web processes and artificial feed there are various modeling approaches to describe formally the fish s preference between the alternative natural and artificial nutrient sources as follows demand driven clear preference the less preferred food is consumed only when the more preferred one is missing e g kapetsky and nath 1997 supply driven preference controlled by the ratio of the available alternative feeds e g varga and csukas 2017b preference weighted supply driven distribution controlled by the weighted ratio of the available alternative feeds a possible more sophisticated solution with more data demand w s tan via svirezhev et al 1984 application of probabilistic switching functions e g svirezhev et al 1984 with additional data demand in our model implementation we utilize a simplified availability driven heuristics instead of taking into consideration the preference of various food web elements we use a formula for the consideration of the availability of the given food source assuming that the given species does not select but consumes the food sources in the proportion of their availability the effects of environmental conditions on feed intake are usually modeled with the use of dimensionless coefficients from the 0 1 interval expressing the impact of the actual temperature considering a minimal maximal and an optimal value brett 1979 bolte et al 1995 the dissolved oxygen concentration with respect to a critical and a minimal value bolte et al 1995 the ammonia level considering a critical and a maximally allowed level cuenco et al 1985 bolte et al 1995 while the unionized ammonia concentration can be calculated from the total ammonia nitrogen concentration and the ph as well as the actual biological oxygen demand with respect to its critical and maximal levels the coefficient of catabolism increases with temperature within the tolerance limits for a given species ursin 1967 cuenco et al 1985 in our model we assume an exponential relationship between catabolic coefficient and temperature following nath 1996 the utilized relationships are described in the supplementary material in detail while all of the applied parameters for common carp together with the source of origin are listed in the param input output variables xlsx file of supporting mendeley data varga et al 2020b 3 2 2 calculation of biomass for the other elements of food web in the biomass calculation of other food web elements zooplankton phytoplankton benthos and detritus we consider the structure of the food web the consumption related biomass growth anabolic growth energy production catabolism and decrease of biomass mortality and decomposition of various species in the description of these processes we rely on various early works e g svirezhev et al 1984 the food consumption and the respective weight increase of predators biomass is calculated by a michaelis menten like saturation kinetics for each preys considering a specific maximal uptake rate coefficient a half saturation coefficient and the availability factor of the given prey assuming a simple supply driven preference the effects of temperature and dissolved oxygen are taken into consideration by the appropriate efficiency factors the decrease in biomass consists of the optional catabolized portion of consumed biomass the fecal loss and the mortality the decomposition of food web elements increases the pool of detritus in contrary we also take into consideration the consumption related decrease of detritus according to the food web see fig 1 e g in case of bighead carp zooplankton and benthos finally the decomposition of detritus produces dissolved phosphorus and nitrogen for phytoplankton 3 2 3 photosynthesis and respiration of phytoplankton functioning of the food web and the natural oxygen supply of fishponds highly depend on the production of phytoplankton the growth of phytoplankton biomass is calculated in a michaelis menten like kinetics from the rate determining nitrogen or phosphorus level considering a maximum growth rate coefficient multiplied by a light coefficient and by a temperature factor the light coefficient is expressed by a lambert beer law based formula where the illumination is determined from the actual solar radiation a light extinction coefficient and the characteristic water depth of the photosynthesis svirezhev et al 1984 with reference to steele 1962 the extinction coefficient is modified also by the phytoplankton concentration self shading and by the suspended fraction of detritus shading decrease of nitrogen and phosphorus is determined from the phytoplankton growth applying the typical redfield ratio perdue 2009 of atoms c n p the phytoplankton related oxygen balance is calculated from the assimilation of the new phytoplankton biomass with an assimilation coefficient and from the respiration of the actually existing biomass with a respiration coefficient 3 2 4 environmental relationships high precision models for calculation of evaporation are available in the literature e g saloranta and andersen 2007 however they are designed for the precise modeling of deep water lakes with a large input data requirement considering the limited availability of measured fishpond related and forecasted climate data we use an approximate model the calculation of evaporation is implemented by the generally accepted empirical expression of antal and tóth 1976 developed and validated for the shallow lakes e g lake balaton in hungary the applied formula estimates evaporation with less input data requirement utilizing the water temperature dependent equilibrium vapor pressure the actual vapor pressure and the wind speed the modified version of the original formula is corrected with a seasonal coefficient vituki 1986 in the model development we use historical meteorological data for two geographic areas of the southern and northern great plain of hungary based on the validated model the noresm rcp 4 5 and rcp 8 5 climate scenarios are used to determine predictions for the same two geographic locations however using this climate model that provides only daily air temperature and precipitation data we have to make some simplifying assumptions one of these simplifying assumptions is to approximate the daily average water temperature with daily average air temperature it is to be noted that in principle the surface water temperature should be used for calculation of equilibrium vapor pressure this surface temperature is the convex combination of air and water temperatures however the analysis of data from the period of 2009 2014 confirmed that use of average water temperature is applicable for the fishpond production period april october for the calculation of the actual vapor pressure the relative humidity is also required as the relative humidity data are not available in the climate scenarios we utilized 60 as an average value for the production period estimated also from the above mentioned 6 year long data series regarding wind speed our simplifying assumption was to use the average daily value coming again from the recorded historical data 3 2 5 consideration of the managerial interventions of feeding and fertilizing data for feeding and fertilizing came from the monthly aggregated records of the investigated fishpond in case of feeding we divided the gross monthly amount into daily portions regarding fertilization in line with the practice we considered that the organic manure is dispensed in the first three days of every month in the season a given part of the forage characterized by a heuristic coefficient decomposes spontaneously and it decreases the available artificial feed pool as well as increases the amount of detritus similarly we took into consideration the decomposition of the supplied organic fertilizer with another factor organic manure decomposition supplies utilizable dissolved phosphorus and nitrogen according to the respective destruction coefficient that also depends on the temperature and on the concentration of dissolved oxygen non linearly on the other hand a given part of dissolved phosphorus mineralizes and settles in the sediment with a rate that is a nonlinear function of oxygen concentration 3 3 process modeling by programmable process structures programmable process structures pps is a non conventional process modeling and simulation method it has developed from the former direct computer mapping dcm csukas 1998 csukas et al 2011 in the past years dcm originally was applied for the solution of various chemical engineering problems e g csukas et al 1999 temesvari et al 2004 csukas et al 2013 the basic characteristic of the method is that the natural building blocks of the process systems can be mapped onto an executable computer code directly the field of application broadened toward the model based understanding of biosystems as well as model based analysis and planning of agricultural and environmental process systems in the past years in these fields we recognized the increasing demand for a flexible and easily extensible modeling framework that is able to generate and visualize the process model automatically accordingly the original dcm has developed toward programmable process structures comprising the automatic structure and model generation from the unified description of underlying process systems varga et al 2017 it has been applied for the modeling and simulation of a wide range of process systems in the past years varga et al 2016 2017 2020a varga and csukas 2017b the main components of the framework are general kernel of the model generator and simulator written in platform independent gnu prolog a declarative logical language of artificial intelligence graphml based representation of process structure with locally editable description of case specific functionalities connected databases of case specific actual and hypothetical meteorological as well as hydrological data the scheme of model generating procedure can be seen in fig 2 starting from a conceptual model of the investigated problem an empty process structure without the functionalities is generated from two one state and one transition meta prototypes that are the general building blocks of the framework the standardized description of the investigated system s process network and the associated set of initial data and parameters after the generation of the structure the next step is the definition of functionalities that means the formulation of the relationships in form of local programs actually declared in gnu prolog syntax gnu prolog as a declarative logical language of artificial intelligence applies unification based data flows that are useful for knowledge representation additional advantages come with the locally executable reusable brief program code prototypes this is especially useful for the description of large multi scale systems consisting of many stereotypical parts it is also important to highlight that the majority of the variables is local that supports re usability of program code in similar cases as well as the easy use of variable names because the consistency of variable names must be ensured only within the individual local programs detailed explanation of the building elements i e the architecture of states transitions and the connections between them the generalized description describing the process network as well as the execution scheme of the simulation model can be found in our former works varga and csukas 2017a 2017b varga et al 2017 4 results of model development by implementing programmable process structures 4 1 generation of the parameterized fishpond model involving a food web the conceptual model of the fishpond ecosystem highlighting the interconnected environmental and managerial effects is shown in fig 3 in line with the principles of pps model building is based on this conceptual model starting from this we have to define the state and transition elements of the underlying processes the actual state and transition elements are summarized in table s1 of the supplementary material the state elements refer to those entities components signals that must be considered in the model the transition elements represent the underlying physical chemical biological ecological environmental and managerial processes to be taken into consideration in the calculations general description of model building procedure is described in former publications varga and csukas 2017a 2017b varga et al 2017 however some important details are highlighted here in the context of fishpond ecosystems the process network is declared as follows states coordlist statelist dcode stateid dnamelist dcodesign stateid dnamelist transitions coordlist transitionlist trans transitionid inpintlist inpsignlist outextlist outsignlist where coordlist coord a list of coordinates and coord atomic statelist stateid a list consisting of the underlying state elements and stateid symbol dnamelist dname a list consisting the names of underlying d triplets of the state elements and dname symbol transitionlist transitionid a list consisting of the underlying transition elements and transitionid symbol inpintlist inpsignlist outextlist outsignlist connection connection n coordlist statelist while statelist determines the connected intensive properties and signals in the input side as well as the extensive measures and signals in the output side of the transition elements accordingly the trans predicates describe the structure with the connections between the involved states and transitions this declaration of the process network is conform with state and transition meta prototypes which are the two general templates of the method containing slots with empty lists for the above interpreted inputs outputs and parameters as well as a place for local program code or for its identifier in the state and transition elements in accordance with table s1 of the supplementary material the lowest level data structures are the d dname value dimension triplets containing the value of the actual input parameter and output data the general kernel program generates the empty programmable process structure from the two general meta prototypes and from the above introduced standardized description of the case specific process network also the initial data and parameters can be imported from a database into pps during the generation procedure the most important initial values of the state elements are summarized in table 1 the parameters of the state and transition elements must be consistent with the symbolic parameters of the local programs accordingly they can be finalized in the knowledge of the program prototypes see later the actually applied parameters are presented in the supporting mendeley data varga et al 2020b the generated programmable process structure is shown in fig 4 technically it is in graphml format that supports visualization and flexible editing of prototypes including also the calculation determining local program codes 4 2 programming of the locally interpretable functional prototypes of the model as a next step the parameterized and initialized structure of fig 4 has to be extended with the prototype elements these prototypes contain the calculation formulas in form of local program codes the necessary prototype elements are summarized in table s1 supplementary material technically it means making copies from the meta prototypes next the executable program code of calculation can be formulated by using the variables in the input parameter and output slots of these prototype elements each actual element within the network have to be associated with one prototype program as listed in table s1 in the supplementary material in accordance with their own initial data and parameters it is to be emphasized that usually many general state and transition elements in the network utilize the same prototype program during the execution of the simulation all the actual state and transition elements are calculated by the respective prototype program by unifying binding the variables with its own actual data and parameters the programming of prototypes is illustrated with the example of the life related processes of common carp in table s2 in the supplementary material in parallel with the programming of prototypes the actual initial data and parameters of these general prototypes have to be assigned to the actual state and transition elements of process network the explanation of the utilized global variables inputs parameters and outputs are summarized in the supporting mendeley data varga et al 2020b 4 3 validation of the model by the measured data stocking and harvesting data for the main commercialized species common carp occasional individual weight measurements as well as occasional water level measurements are utilized to validate the model to evaluate the accuracy of the model the normalized root mean square error nrmse values are calculated by the following expression nrmse i 1 n c i m i 2 n m 100 where ci is the ith calculated value mi is the ith measured value n is the number of observations m is the mean of measured values the nrmse values of 6 3 for pond level and 15 for carp biomass show an acceptable prediction ability of the model at the present state of developments it is to be noted that in the continuing work there are additional ongoing measurements regarding phytoplankton and zooplankton to improve the model the comparison of measured and calculated data can be seen in fig 5 the 110 cm upper limit of pond level comes from the applied practice of the fishpond management that has been added to the model in form of rules for the years of 2014 and 2016 water supply was not recorded accordingly it was not taken into consideration in the model causing a significant difference between measured and calculated data regarding carp biomass there is a remarkable difference between measured and calculated data for the year 2015 measured data in the pond register book showed 468 kg ha stocking at the beginning of season while harvesting data was 593 kg ha at the end of october it would not be economically viable to produce such a low net yield accordingly we assume that an extraordinary event outside the model boundaries e g high mortality due to bird predation or disease caused the extremely low biomass gain fig 6 shows another representation of comparing pond level and biomass data to illustrate the matching of measured and calculated values fig 7 illustrates the comparison between measurements occasional sampling harvest and model predictions for individual weight of carp here mismatch is noticeable because the calculated values correspond to average individual weights while random sampling does not always reflect these average data the available measurements do not allow the parameter identification for the other food web elements and dissolved components in the fishpond accordingly we applied those parameters that were suggested in the literature sources in the continuing work a series of experiments is planned for the validation of the model in relation to phytoplankton zooplankton and dissolved components more accurately 5 results and discussion of process simulations 5 1 overview of possible modes of model execution one of the final goals of present development is to embed the model into a decision support tool which is under development by climefish project team https climefish eu accordingly to allow a faster application the general kernel of simulator is prepared for the following modes of execution simulation of single or multiple past production seasons from april 1 to october 31 with factual meteorological and managerial data simulation with single and multiple production seasons from april 1 to october 31 with factual meteorology but with various hypothetical sets of pond management scenarios detailed run for various management and climate scenarios with daily output reporting simplified run for various management and climate scenarios with end of season reporting for each simulated year these modes of simulation are developed as extensions of the general kernel program accordingly single or multiple years started with various sets of parameters are initiated and executed automatically controlled by a configuration file the simulated outputs are displayed in csv file format for flexible further processing for demonstration of the model an executable process simulator with the necessary auxiliary files and with a detailed guide is available in the fishpond simulator folder of the mendeley database varga et al 2020b in the next sections some illustrative results from the various simulations will be discussed 5 2 simulation results for the 2010 2016 period having applied the simulation mode of multiple runs for the past production seasons we can have a deeper insight to the causal relations amongst the various elements in the pond a detailed simulation result can be seen in the supporting mendeley data varga et al 2020b fig 8 shows the changes of fertilizer and feed concentration in the fishpond having started from the factual data of fertilizer and forage supply the curves reflect the actual concentration along time taking into account the temperature and oxygen dependent decomposition of fertilizer see eqs 33 40 in supplementary material and forage as well as the actual consumption of common carp fig 9 shows the biomass of the common carp and bighead carp dynamic behavior of other food web elements can be seen in fig 10 it is to be noted that calculations are based on the parameters from the literature and further validation with detailed experimental background will follow in the ongoing work however it is worth analyzing the trends of the dynamic changes as the amount of common carp and bighead carp starts to increase in each season fig 9 the biomass of zooplankton being part of the diet of both fish species decreases accordingly fig 10 hectic changes of phytoplankton biomass described by eqs 25 28 in supplementary material are determined by dynamics of predation pressure function of bighead carp zooplankton and benthos biomass availability of nitrogen and phosphorus as well as exposure to light the latter factor is regulated by solar radiation and the turbidity of water which depends on the actual detritus biomass because of its shading effect the catabolized and decomposed biomass of living organisms also contribute to the detritus mass in fig 11 we can follow the dynamic change of dissolved oxygen concentration during the production seasons the diagram shows the summarized effects of the consumption by various species the oxygen produced by the phytoplankton biomass as well as the temperature dependent air water oxygen transfer aerators were not applied in the investigated fishpond dynamic behavior of the nitrogen and phosphorus concentration see fig 12 show the cumulated effect of the nutrient utilization by phytoplankton biomass eqs 29 and 30 of the monthly supply of organic fertilizer as well as the continuous degradation of food web elements 5 3 analysis of various pond management scenarios the previous analysis focused on simulation results for the studied fishpond in szegedfish ltd the respective fish farming data are summarized in table 2 for the period of 2010 2016 in the following part we apply the simulation model for studying a hypothetic fishpond using parameters reflecting the typical hungarian conditions and technological settings the feeding intensity and stocking density applied in the year 2011 are very close to respective industry level averages aki 2018 for this reason we selected the technological settings of 2011 as a baseline management scenario and based on these values we compiled a design space of the initial data and parameters for the model see table 3 to develop a hypothetical typical fishpond for the further investigations starting from these initial conditions model calculations were performed for 80 different pond management scenarios a pond management scenario is defined as a certain combination of feeding strategy and stocking density 10 different stocking densities see rows in table 4 and 8 different feeding options see columns in table 4 were considered bold italic number in table 4 refers to the baseline management scenario historical meteorological data for the period of 2006 2016 for two different locations szeged and debrecen hungary were used in the simulations output results can be studied in the supporting mendeley data varga et al 2020b in detail the values in table 4 refer to the carp biomass at the end of the season simulation results show the average data for the period of 2006 2016 fig 13 illustrates the tendencies of data in table 4 it is worth paying attention to the fact that having fixed stocking densities at lower values increasing feeding intensity would lead to lower biomass yield because the degradation of uneaten feed causes oxygen deficient environment this situation occurs when the relatively low carp biomass is not able to uptake the large amount of feed present in the pond summarizing the results ecosystem based pond aquaculture proved to be a good example where the analysis of the various managerial scenarios needs causally transparent dynamic balance models in the present work we implemented the trans disciplinary model of fishpond aquaculture in the unified generic framework of programmable process structures based on the data from a hungarian semi extensive pond farm operating bi culture technology an integrated reusable dynamic simulation model of levee type fishponds has been developed considering also the human management activities at the present state of the modeling the calculated nrmse values show acceptable match between measured and calculated data for common carp biomass and water level in the knowledge of the validated model the dynamic simulation provides appropriate analysis of the complex system with the consideration of the interactions amongst the elements of the food web the physical chemical and biological processes in the present and forecasted meteorological environment the managerial interventions of the farmer stocking density feeding fertilization aeration pond level control the applied non conventional method of programmable process structures supports the integrated implementation of the trans disciplinary functionalities in a unified transparent structure 5 4 simulations for noresmrcp 4 5 and 8 5 climate scenarios finally predictions for future climate scenarios were performed with the model in this case regional climate model of noresm was applied for the period of 2017 2065 while for the retrospective period of 2006 2016 the factual meteorological data were used representative concentration pathway rcp 4 5 and 8 5 scenarios were utilized downscaled to a resolution of 0 25 0 25 for two locations of szeged and debrecen hungary downloaded from opennex repository http opennex planetos com gddp forecasted data for precipitation mm day and average air temperature c were utilized as input data for the simulations it is to be noted that according to previous investigations air temperature can be utilized because it is in high correlation with water temperature for shallow 1 1 m depth fishponds during the farming season we obtained air and water temperature data in the period of april october between 2006 and 2016 in the given region szeged hungary based on the normality tests we ran parametric two tailed pearson correlations the result of the test was highly significant r 167 0 807 p 001 we concluded that approximating water temperature with air temperature is acceptable at this location and time period this is in line with the data content of climate scenarios too the simulations were executed for the period of 2006 2065 with the pond management scenarios presented in table 4 the simulation mode of simplified run for various climate scenarios see in section 5 1 was used accordingly 10x8 simulations were made each of them from 2006 to 2065 the computational time for this amount of calculations was around 6 h using an average capacity notebook to fasten simulation output recording can be restricted for the last day of season october 31st in each simulation some examples illustrating the capabilities of the detailed simulation can be seen in figs 14 17 fig 14 shows the dynamic changes of dissolved oxygen concentration in the fishpond along the production seasons at the szeged location for the rcp 4 5 climate scenario fig 15 shows the dynamics of phytoplankton biomass for the same simulation period and location under rcp4 5 climate scenario it can be seen that climate change induces increased occurrence of extreme values of oxygen levels and phytoplankton biomass over the next decades fig 16a and b shows a prediction for the average individual weight of the main target species common carp at the end of the seasons a very slowly increasing trend can be observed in the individual weight that can be resulted by the increased anabolic activity in fig 17 we show a zoomed period about the same simulation recorded with daily time step between 2023 and 2027 where the effect of various stocking feeding densities can be studied it is worth paying attention to the calculation results under zero feeding conditions with solid line in fig 17 here the initial weight gain of fish is constrained by the total depletion of natural food after several weeks and loss in average weight occurs due to starvation output results can be studied in the supporting mendeley data varga et al 2020b in detail in the following some complex causal relationships will be illustrated fig 18 illustrates the predicted difference in average common carp yields in the periods of 2006 2016 and 2045 2055 the calculations were made for szeged location utilizing the rcp4 5 climate scenario it is worth mentioning that significant differences appear for those management strategies that are characterized by lower 100 250 kg ha stocking density and intensive feeding rate 3000 kg ha however these input combinations are outside the range of economically optimal pond management strategies as feed utilization efficiency is very low see fig 13 the reason for the large increase in predicted yields over the decades is that anabolic activity and appetite of carp will increase with higher temperatures in the period of 2045 55 and for this reason feed utilization will be more efficient this implies that there would be less waste of forage see fig 19 and this will decrease the frequency of oxygen deficient periods we summarize that the process model of medium complexity makes it possible to study the effects of climate change on the ecosystem based fish farming using 50 years long detailed dynamic simulations it is to be emphasized that present model does not take into account the effects of climate change on fish diseases risk of diseases is generally expected to increase with climate change specifically due to the increase in water temperature and extreme weather events similarly outbreaks of koi herpesvirus in carp fisheries are likely to occur over longer periods on the other hand susceptibility for exotic pathogens like the spring viremia of carp virus is expected to decline as infections generally establish in colder 17 c waters marcos lopez et al 2010 although the model described here does not encompass expressions for dependency of survival rates on climatic factors sensitivity of production performance to disease outbreak events can be tested by running simulations with alternative mortality parameters for carp 6 conclusions and outlook we concluded that regardless to the actually limited amount of training data the approximately validated but causally established well structured and balance based dynamic model may support the planning and operation of the investigated system the simulation results give a deeper insight into the causal relations amongst the various elements in the pond dynamic simulation based case studies help to understand and to analyze the complex interacting mechanisms in the fishpond as an example this is demonstrated by the impact of climate change on dissolved oxygen balance as follows the rate of oxygen component transfer between air and water is determined by the temperature dependent equilibrium oxygen concentration global warming decreases this equilibrium concentration and oxygen absorption accordingly also the greater anabolic activity of heterotrophic organisms increases oxygen consumption further deteriorating the oxygen balance on the other hand warmer water increases phytoplankton biomass and the related photosynthesis triggering a higher rate of oxygen production by autotrophic organisms in the pond accordingly the positive impacts of climate change may compensate the negative ones on oxygen concentration in carp ponds simulations show that these influences altogether might result in some possible positive side effect of climate change the simulation model proved to support the managerial decisions in terms of feeding and stocking technologies the analysis of systematic simulations for several managerial options and climate scenarios can help to adapt farming technology to altered climatic conditions by identifying those feeding and stocking strategies that are most beneficially impacted by climate change the method allows to easily modify and extend the temporarily applied structure and functionalities moreover starting from the input files of the state and transition prototypes and elements it is possible to build new models for other case studies the method supported the analysis of climate change effects on modeled pond aquaculture technologies for this daily air temperature and precipitation forecasts under rcp 4 5 and 8 5 scenarios of noresm climate model were utilized and aquaculture operation was simulated for a 50 years period 80 managerial scenarios for feeding rates and stocking densities were considered by simulations the prediction for the average individual weight of common carp showed a very slowly increasing trend that may be resulted from the increased anabolic activity in line with the slowly increasing temperature from a methodological viewpoint the studied example demonstrated the applicability of the modeling framework developed for the unified representation of functional and structural features there is a complex network of influences among the interacting natural processes and human activities the environmentally benign and profitable cooperation of the natural and human controlled processes may be studied by simulations for instance we can search for a compromise between manuring technology which mobilizes availability of plankton for target species and feeding technology in a good solution cost efficient nutrition of carps can be satisfied with a feasible water quality it is a general lesson that besides the sensors and data acquisition based methods the long term decisions about the integrated development of complex agro environmental systems may and must be supported also by the predictive first principles based dynamic balance modeling the main point of the following work is to evaluate the economic viability of the applied managerial scenarios based on the validated model the model will be embedded in a decision support tool that is under development in climefish project https climefish eu this dss aims to provide detailed model based predictions for shallow ponds in central europe under various climatic scenarios in the ongoing work a series of experiments is planned for the better understanding of phytoplankton zooplankton and dissolved component related processes this research focuses on the identification and validation of a more precise model that comprises more plankton pseudo groups availability of demonstration model executable and necessary auxiliary files for a test example are available http dx doi org 10 17632 p3bwbphj6x 1 year first available 2020 hardware and software required basic pc 2 5 ghz cpu 8 gb ram windows10 64bit program language executable demonstration simulator and auxiliary test example files gnu prolog 1 4 4 contact address varga monika ke hu declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement model development was supported by the horizon 2020 european research project climefish grant no 677039 data collection was supported by ginop 2 3 2 15 2016 00025 project of european regional development fund and the naik h15210 project of ministry of agriculture hungary authors would like to thank szegedfish ltd for allowing access to pond registry books appendix a supplementary data the following are the supplementary data to this article multimedia component 1 multimedia component 1 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j envsoft 2020 104755 
