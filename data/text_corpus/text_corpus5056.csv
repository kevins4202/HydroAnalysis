index,text
25280,climate smart interventions in agriculture have varying costs and environmental and economic impacts their implementation requires appropriate investment decisions by policy makers that are relevant for current as well as future scenarios of agro ecology climate and economic development decision support tools are therefore needed to assist different stakeholders to prioritize and hence implement appropriate strategic interventions these interventions transform agriculture ecosystems to climate resilient adaptive and efficient this paper outlines the mathematical modelling framework of one such the climate smart agricultural prioritization csap toolkit this toolkit employs a dynamic spatially explicit multi objective optimization model to explore a range of agricultural growth pathways coupled with climate adaptation strategies to meet agricultural development and environmental goals the toolkit consists of three major components i land evaluation including assessment of resource availability land suitability yield and input output estimation for all promising crop production practices and technologies for key agro ecological units ii formulation of scenarios based on policy views and development plans and iii land use optimization in the form of linear programming models climate change and socio economic drivers condition the land evaluation technological input output relations and specification of optimization objectives that define modelled scenarios by integrating detailed bottom up biophysical climate impact and agricultural emissions models csap is capable of supporting multi objective analysis of agricultural production goals in relation to food self sufficiency incomes employment and mitigation targets thus supporting a wide range of analyses ranging from food security assessment to environmental impact assessment to preparation of climate smart development plans keywords climate smart agriculture optimization adaptation mitigation prioritization climate change 1 introduction the climate smart agriculture csa is an integrative approach to address the interlinked challenges of food security climate change impact and ecological sustainability lipper and zilberman et al 2018 steenwerth et al 2014 to achieve these three objectives are defined i sustainably increasing agricultural productivity to support equitable increase in farm incomes food security and development ii adapting and building resilience of agricultural and food security systems to climate change iii and reducing greenhouse gas emissions from agriculture fao 2013 a range of technological institutional and policy options has been proposed to help agriculture become climate smart including weather insurance spatial weather forecasts agricultural diversification stress tolerant crop varieties community management of soil and water resources and policies related to water and carbon management thornton et al 2017 shirsath et al 2017 khatri chhetri et al 2017 long et al 2016 lipper et al 2014 vermeulen et al 2012 these interventions have varying costs and economic impacts moreover the effectiveness of these interventions depends on agro ecological condition of a region and their adoption is highly influenced by the socio economic characteristics of the agrarian society of that region khatri chhetri et al 2017 sapkota et al 2017 therefore the implementation of csa requires appropriate investment decisions in both on farm capital and wider agricultural outreach programmes furthermore climate smart investment can have a wide range of scales ranging from the single field up to the national level it is unlikely that investment in any single intervention will provide optimal benefits but rather an integrated portfolio of interventions is required to best support adaptation to climate change in agriculture across a range of scales this spatial complexity is compounded by the long timeframes associated with climate change requiring further consideration of when as well as where to prioritize investment in any set of intervention options if climate smart technologies provide net benefits to farmers irrespective of climate change so termed no regrets options thornton and lipper 2014 willows and connell 2003 then the investment is preferred as soon as possible however given the costs of investment in the short term under constrained budgets and with the benefits of adaptation increasing with the progressive impacts of climate change it may be preferable to delay investment until full benefits can be realised decision support tools are therefore needed that can assist different stakeholders to prioritize appropriate and timely strategic interventions to transform agricultural practice to become climate resilient efficient and adaptive tanure et al 2013 given the competing social economic and environmental dimensions of adaptation decisions multi criteria analysis mca is becoming increasingly popular in supporting the development of adaptation strategies mca differs from traditional risk management tools it can retain competing objectives separately rather than aggregating them into a single weighted decision metric willows and connell 2003 mca prabhakar 2014 feltmate and thistlethwaite 2012 lobell et al 2008 and tools based on mca such as adaptation decision matrix adm mizina et al 1999 have been used widely in prioritizing technology options in agriculture several other tools such as fuzzy analytical hierarchical process sanneh et al 2014 and crop simulation model based adaptation decision tools webber et al 2014 have also been used several other tools and methodologies including participatory methods arshad et al 2017 khatri chhetri et al 2017 mwongera et al 2017 taneja et al 2014 have been reported for adaptation prioritization e g willows and connell 2003 lobell et al 2008 cross et al 2012 sanneh et al 2014 webber et al 2014 ilori and prabhakar 2015 brandt et al 2017 however there is a lack of dynamic and spatially explicit optimization tool to explore a range of agricultural growth pathways under different climate change scenarios this study presented here builds over work done by shirsath et al 2017 where prioritization of the climate smart agricultural land use options at a regional scale were showcased using the databases generated through a spreadsheet based methodology in this methodology however the pillars of climate smart agriculture were treated separately and finally integrated through climate smartness index the climate smart agriculture has a wide range of objectives including food security increase in farmers net income improvement in resource use efficiency climate resilience and ghg mitigation the single objective models cannot take into account the trade offs or synergies between economic efficiency and environmental efficiency which was not addressed in the earlier work using detailed bottom up biophysical and socio economic databases as described by shirsath et al 2017 therefore a multi objective modelling framework with detail consideration of spatial heterogeneity in terms of bio physical characteristics and resource endowments is necessary to make csa adoption decisions for a range of stakeholders given this motivation we have taken into consideration multiple objectives for optimization purpose in addition the trade offs among the various competitive optimal solutions corresponding to different objective function has been considered to estimate the decision space which will minimize the trade offs among the competitive objectives so that climate smart technologies can be prioritized in more sustainable manner hence this paper outlines a multi objective prioritization toolkit based on a spatially explicit bottom up biophysical framework and demonstrates a case study for prioritization of csa technologies in bihar state india the toolkit supports analysis of trade offs between objectives and identification of efficient solutions results shows that the toolkit is capable in optimizing different adaptation options based on bio physical conditions of a particular location 2 materials and methods 2 1 model description in its current formulation the climate smart agricultural prioritization csap toolkit is flexible in its capability to model agricultural production at a wide range of spatial and temporal scales a typical analysis with the csap toolkit starts with the identification of land units which define the spatial resolution of the study and then proceeds with preparation of biophysical and socio economic datasets for the multi objective analysis although database development and multi objective analysis can be developed separately we recognise that they are highly interdependent in view of the nature of the explicit assumptions made during development of both the database and the toolkit application of the csap toolkit therefore encompasses all stages of data processing assumption setting e g land unit season and crop suitability and mathematical model formulation a simple flow chart outlining this process is shown in fig 1 2 1 1 spatial land units the effectiveness of technological interventions is strongly determined by local bio physical conditions climate change impacts adaptive capacity and resource endowments both in space and size of production unit as a result no single intervention can be assumed to be generally applicable or a best bet at the landscape regional and national scales each location here represents a homogeneous production area which whilst still clearly much larger than any single farm provides a reasonably accurate model of local production conditions and resulting crop technology performance csap toolkit uses homogeneous parcels of land designated as land units within each location we can further differentiate representative farm sizes which may exhibit different levels of resource constraints and costs e g labour water access working capital and or constrained access to particular technologies this land unit approach has also been used by agrell et al 2004 and aggarwal et al 2001 2 1 2 dynamic agricultural development pathways the csap toolkit is disaggregated over a number of discrete time steps forming a sequence of future system states at each future time a detailed crop technology specific land use pattern is identified and a range of performance metrics derived covering production levels emissions and employment for example the result is a pathway linking sequential system states that transitions from the current to some future system that optimises the specified objective over the total time horizon 2 1 3 uncertainties in future climate and socio economic scenarios the performance of any adaptation intervention will be conditional on future climatic conditions and the biophysical response of agricultural systems to those conditions both of which are subject to high levels of uncertainty in addition to this climate centric set of uncertainties we must also recognise an entwined set of uncertainties associated with wider socio economic development most relevant to the agricultural sector in developing countries such as constraints of institutions infrastructure and knowledge interventions should therefore be analysed and prioritised when they perform best across a potential spectrum of future climate and socio economic scenarios i e are robust in order to take into account this uncertainty we implement a scenario specific disaggregation of the model a demonstration of the segmentation of the dynamic and stochastic model horizon is provided in fig 2 the toolkit identifies decisions that are robust against future uncertainty i e no regret options whilst identify the option to delay sensitive decisions until better information regarding climate outturn is available in this context the information of value to the decision maker is the set of priorities defined by options taken in the short term that are robust to future climate change we recommend the application of a model formulation representing multiple climate scenarios including such constraints if climate uncertainty is to be the focus of scenario analysis in a particular practical application given computational limitations in examples presented in sections 3 and 4 we focus our analysis on multi objective optimization under various land use constraints e g uncertainty in policy objectives and socio economic conditions rather than an explicit analysis of climate uncertainty 2 1 4 multiple objective analysis for analysis of trade offs between objectives and identification of efficient solutions we first identify extreme values for the competing objectives by optimising each in isolation based on these extreme values a decision space can be identified within which all further trade off solutions will be located being bounded by observed upper and lower extremes in the respective objectives bio physical economic and environmental constraints on the maximum or minimum level of objectives within this decision space are then formulated and applied in a second round of model solutions trials in order to generate a set of trials that provide good coverage of the decision space we used latin hypercube sampling mckay et al 1979 we first identify a sample increment for each objective based on even segmentation of the observed objective range a set of constraint levels is generated by sampling from the uniform distribution within each increment starting from the minimum objective level each trial identifies an optimal performance in each objective achievable under varying levels of constraint in other objectives a random allocation variable is then assigned to each constraint level these levels are then combined into a set of trials by matching based on the allocation variable finally we screen the resulting set of model solutions to identify only efficient solutions the resulting efficient frontier provides valuable information regarding the trade offs between the two objectives and highlights where the marginal cost of achieving one objective in favour of the other is minimised i e efficient frontier is characterised by a set of solutions from which no single objective can be improved without deteriorating another in the context of agricultural adaptation a set of efficient options could be identified through trade off among the key objectives of employment climate mitigation and food security options in this context are not defined at the outset by their constituent policy action but identified and characterised by their relative cost benefit trade offs across a range of competing objectives the analysis constrains the adaptation options to a limited set of viable alternatives and provides the critical trade off information required to support if not explicitly make the prioritization decision niang diop and bosch 2004 for this purpose the information provided by the efficient frontier is invaluable 2 2 mathematical formulation the dynamic land use allocation in the toolkit is based on the minimum cost pathways to meet future demand targets under a range of agricultural growth scenarios from these modelled growth pathways we can determine priorities for investment in each period both in delivering baseline growth and in adapting to the additional burden of climate change modelled investment decisions constrain the optimised land use patterns in each period these land use patterns comprise crop technology combinations allocated to defined land unit conditional on area labour and water constraints this dynamic allocation is further constrained by scenario specific constraints on i the rate of land use change ii the scale of reallocation of existing production and iii the suitability of crops and technologies to particular land units specifically the limited application of high technology on small and marginal farms here we present a condensed formulation for mathematical clarity on this basis the toolkit is developed around a primary activity variable x i j t s that represents the area allocated to a particular crop technology i within a particular land unit j at a given time t for each climate scenario s from the variable x we can determine two further variables specifying the total increase in area under each crop and technology y i j t s and the associated investment in increasing the working capital within each land unit z j t s the relationship between these variables is defined as 1 y i j t s x i j t s x i j t 1 s i j t s 2 z j t s i x i j t s c i j t s i x i j t 1 s c i j t 1 s j t s 3 x i j t s y i j t s z j t s 0 i j t s importantly when measuring investment areas and associated costs we only measure the increase in cropping area under technological intervention or associated cost in eq 2 we sum over crop and technology combinations allowing existing working capital to mobilise freely among new production activities within each land unit however any additional costs of production at a given time step above that required in the previous time step are recorded as investment costs production costs for each activity c i j t s are variable over time in order to model the impact of climate change on crop production as a result even if cropping activities are held constant the impact of climate change can be observed where investment is required to maintain productive area we recognise that our representation of investment costs is limited to only changes in the total production cost between time steps we do not account for costs of outreach and extension effort required in order to facilitate the adoption of new technologies or the cost and inefficiency of delivering the increase in working capital e g via public or private credit the toolkit is constrained at a biophysical level by the availability of land water and labour resources eq 4 represents this block of resource constraints in the standard linear programming lp formulation activity coefficients a e g seasonal irrigation water requirement monthly labour requirement etc and resource limits b e g land area labour availability etc are exogenously varying with time and for specific climate scenarios within this set of constraints a range of spatial and temporal disaggregations can be applied for example in our case study presented below activities are defined and parameterised at a biophysical land unit level n 194 whilst water and labour constraints are applied at an aggregate district level n 38 land units are mapped to districts on a one to one basis within the constraints implied by eq 4 in the temporal domain labour constraints are applied on a monthly or single peak month basis whilst land is constrained on a seasonal basis a single unit of land being available for cropping in three seasons within any single year 4 a t s x b t s t s in addition to the classical set of resource limits a number of additional constraints are formulated to model the dynamics of the system under a range of growth scenarios 5 x i j t s x i j 0 i j s t 1 6 i x i j t s i x i j 0 j s t 1 7 i j x i j t s y i j t s t t t s 8 i j y i j t s r t s t s following calibration the land use pattern for the first position of the dynamic model is fixed via eq 5 to calibrated levels x i j 0 under particular growth strategies we can then apply eq 6 to constrain the total area under production for each land unit at latter time period to be at least that observed at the base period in the absence of this constraint the model can freely reallocate production in the spatial domain in the analysis presented below we term these scenarios local and global respectively eq 7 ensures that the growth pathway achieves the target level production at each future time period t t technically the level of production is specified as the product of the cropped area and the scenario and period specific yield of the selected crop technology at each location y i j t s in practice this target level may be adjusted downwards to a feasible maximum level of production if target production levels are not achievable further the toolkit is actually expressed over indices representing crop and technology separately similarly the location index j is spliced into separate indices for biophysical land unit land type i e rain fed irrigated and farm size e g marginal medium large etc in the absence of additional constraint the model will shift rapidly from the calibrated initial time period t 1 to optimal configurations driven by those objectives outlined below we therefore implement eq 8 to constrain the increase in area under new crop and technology combinations to a specified upper bound r t s for each period to time t the upper bound r is calculated assuming a specified maximum annual rate of land use change in each year of the period prior to time t this assumes a fixed rate of technology adoption across the aggregate of all crop technology combinations combining increased expansion in current technologies with intensification and climate smart options as in the case of production targets a more refined analysis could specify adoption rates and associated constraints specific to each crop technology combination given the set of constraints outlined above we consider two key objectives applied in the analysis algorithm outlined below maximising production and minimising net present cost 9 max x y s p s t i j x i j t s y i j t s 10 min x y z s p s t γ t n t i j x i j t s p i y i j t s c i j t s δ t j z j t s in the case of multiple future climate scenarios being specified eq 9 maximises expected production as the product of total production over the model horizon for each scenario weighted by the likelihood of each scenario p s this objective is applied in a model with eqs 1 4 and 8 to identify whether specified target levels are achievable eq 10 is applied in a model containing eqs 1 8 in order to identify growth pathways that maximizes the expected net present value of the farm margin over the model horizon given exogenously specified prices p we assume that investment occurs at a constant rate within each period so that discount factors applied to investment costs δ represent the average factor for the period prior to position t the activity variable x relates to the operating point at each model position e g snapshot year we linearly interpolate between subsequent time periods to calculate representative discount rates γ and time weights n to be applied to each operating point the further technical detail about the mathematical formulation of this model can be obtained as a supplementary material with this article 2 3 data specification a wide range of data is required to apply the csap toolkit in a practical decision making context a summary of data requirements of the toolkit is provided below table 1 for a typical csa prioritization exercise shirsath et al 2017 also describes approaches for developing the database component of the csap toolkit in an applied context the database includes biophysical e g soil water temperature precipitation and production economic e g input costs market prices for output and discount rate and social e g adoption rate farm typology and budget allowance for intervention datasets 2 4 analysis algorithm in carrying out our analyses we undertake a series of sequential optimization runs that can be considered to constitute a general model algorithm for the analysis of i agricultural growth pathways ii the impact of forecast climate change on these pathways and iii adaptation actions to mitigate climate impacts a high level overview of this algorithm is provided below 1 base year system calibration run the toolkit comprising only the base year i e t 1 with the objective to maximise production up to but not exceeding the level observed in base year data for each crop within each land unit run the toolkit again with the objective to minimise the sum absolute errors in cropping area relative to base year data for each crop within each land unit from the resulting base year land use pattern specify parameter x i j 0 2 baseline growth scenario setup the toolkit with baseline climate data e g current climate fixed over model horizon and specify a local or global growth scenario i e include or exclude eqn 6 run the toolkit to maximise net present value of the farm margin the resulting growth pathway is referred to as the baseline scenario 3 climate change impact and adaptation scenarios setup the toolkit with climate change scenario data and specify the growth scenario to be consistent with that applied in the baseline scenario above run the toolkit with constraint fixing activity variables x i j t s at levels in baseline scenario calculated in step 2 2 the resulting growth pathway is referred to as the impact scenario remove constraint on activity levels run the toolkit to maximise net present value of the farm margin the resulting growth pathway is referred to as the adaptation scenario the result of the above algorithm is a set of three growth scenarios termed i baseline ii impact and iii adaptation whilst these can be analysed as stand alone scenarios further information can be derived from analysing the variation between them principally the variation between optimised investment and activity variables in baseline and adaptation scenarios explicitly identifies priorities for climate adaptation as distinct from underlying agricultural sector development in practice the development of growth pathways that explicitly account for forecast climate change in their design constitutes a key role in planned climate adaptation these pathways implicitly minimise the impact of climate change on the growth pathways in that they are optimised under conditions for the specified climate scenario s in practice therefore we choose to focus on developing climate robust growth scenarios through step 3 3 however by comparing growth scenarios developed with and without climate change i e steps 3 2 2 2 and 3 3 we can measure the cost of planned adaptation as additional to growth in a benign climate this analysis is presented below providing a valuable bottom up estimate of climate adaptation costs to compare against top down estimates of investment and financial flows required to climate proof future agricultural development parry et al 2009 2 5 application of csap toolkit a case study application of the csap toolkit has been developed for the indian state of bihar bihar is one of the most vulnerable states in india to climate change incidence of frequent floods and drought extreme heat stresses and other climate related risks are posing threats to agricultural production in bihar this study considered major crops rice and maize in rainy season kharif pulses lentil gram and lathyrus wheat maize and mustard in winter rabi season and maize and mung bean in summer season currently these crops together occupy more than 85 of gross cropped area in bihar table 2 shows a list of interventions in different technology portfolios used in the study the selected technologies represent current technologies intensification technologies and climate smart technologies current technologies have two levels current rainfed t1 and current irrigated t2 an improved rainfed technology t3 is also considered which is also an intensification technology categorised separately to mark its distinction from the irrigated technologies intensification technologies applied to irrigated areas and these have three levels t4 t6 the climate smart technologies for irrigated areas with four levels t7 to t10 are considered in this analysis the crop technology index i represents 10 crop and 10 technologies the crop yields area and technology characteristics were also included in the csap toolkit in this study we demarcated bihar into 34 homogenous spatial units and superimposing it with the district boundaries resulted in 194 land units the smallest units of assessment in this study each land unit within an administrative block differs from another by at least one biophysical attribute the land unit index j is further split into 3 constituent indices representing i biophysical land units each mapped uniquely to the set of districts ii land type distinguishing rainfed from irrigated land areas and iii farm size categories this analysis refers four model setups comprising alternative sets of constraints on growth pathways these constraints were developed along two axes first the degree to which the level of baseline production at each land unit type and farm size e g marginal rainfed farms in a given land unit are preserved in future land use patterns preventing free reallocation of production to more cost efficient locations the inclusion or exclusion of the constraint distinguishes these local and global allocation second a binary constraint on the suitability of particular technologies for given farm sizes specifically small and marginal farms can be included this distinguishes so termed marginal or consolidated technology allocation in the consolidated case technologies can be freely allocated to any land unit e g there is no limit on the application of climate smart technologies we refer to the resulting set of constrained systems as local marginal lm local consolidated lc global marginal gm and global consolidated gc local marginal refers to the scenario when climate smart technologies are not feasible to the marginal farmers to a particular land unit because of its size of farm and other constraints associated with it such as capital financial mechanisation scalability etc besides maintaining baseline crop mix this is the most practical scenario where cropping patterns are relatively stable whereas under local consolidated scenario we assume that all size groups are free to choose efficient technology and baseline crop mix is maintained this scenario can be seen as manifestation of land pulling type of policies over local marginal scenario when we assume that technology is constraint for the marginal farmers but total production of the state will be obtained from the most cost effective land unit without any minimum production target to each land unit this scenario is called global marginal the global marginal scenario considers that advance technologies are not feasible to the marginal farmers but they can change their cropping pattern to adapt with the climate change impacts and the choice of crop can be driven by the market opportunity for a particular crop thus motivation behind this scenario is that crop specific market infrastructure will be created in the region where production of that crop is cost effective finally the gc scenario is an optimistic scenario where farmers will be efficient enough to choose either crop or technology or both according to the agro ecological condition of the region and the state planner will be able to institutionalize their policy interventions and effective institutional mechanism to achieve climate smart agriculture in the state current agriculture production systems in south asia are operating near to local marginal scenario under stable cropping systems whereas the global consolidation probably is the least likely scenario here we primarily focus on the contrasting lm and gc scenarios 3 results 3 1 baseline validation prior to analysis of growth pathways the toolkit was first evaluated in order to test whether it is able to reproduce the reported production of each crop at a district level for the base year 2009 10 please see appendix iii fig s1 in supplementary files the solution proceeds by first identifying a land use pattern that matches reported production kt and area kha levels by crop and by district in the representative baseline year a second calibration was then carried out to minimise the absolute deviation to reported production area whilst achieving the best fit production schema the baseline validation ensures that the input data and constraints were realistic and allow to develop a modelled land use pattern that matches with the observed pattern to a good degree of accuracy residual errors observed during these calibrations were largely due the constraints on water availability and assumptions regarding crop suitability in the given land units the ratio between irrigated and rain fed production was largely controlled in the area calibration given the target production level relative yields of the two technologies current irrigated and rain fed technology and availability of rain fed and irrigated land in each district 3 2 scenarios baseline impact and adaptation scenarios were determined in accordance with the algorithm outlined in section 2 4 for all scenarios and constraint setups the toolkit targeted food self sufficiency based on forecast demand over the model horizon the local marginal and global consolidated constraints formed the respective upper and lower bounds on the total production envelope sets of scenarios for these constraints are illustrated in fig 3 the total crop demand scenario was derived from a combination of published statistics and measured elasticities kumar et al 2011 where incomplete data has been adjusted to best model those specific crop categories applied in this case study demand for each crop commodity over the horizon 2015 2025 was translated into a trend in per capita demand projected forward on trend to 2030 and fixed to constant at that level from 2030 to the end of the model horizon total demand kt in each future year was calculated by multiplying projected per capita demand to total population projections based on bihar specific projection population projections for india and states 2001 2026 may 2006 to 2026 indexed to total india population projection for remainder of horizon world population prospectus 2016 https esa un org unpd wpp fig 3 shows that the targeted self sufficiency in the crop demand is not achievable under the constrained growth pathway local marginal lm as well as under the most relaxed growth pathway global consolidation gc the gap in the total production and demand is more and remains same with the time as compared with the global consolidation pathway where it becomes narrower with time total population in the study area bihar is already high and is projected to continue to grow in future only after 2050 food demand will not increase significantly because of low expected population growth in the state disaggregated analysis of individual crop showed that maize and pulses production can satisfy their demand under lm and gc scenarios however major crops like rice wheat and mustard production cannot fulfil their total demand of the study area for more information please see appendix iii table s1 in the supplementary file the profile of each set of pathways is largely dictated by the constraint on the rate of land use change set at 250 kha yr 1 over the horizon coupled with the allowance of higher yielding high level climate smart technologies in the gc case impact scenarios measure the effect of forecast climate change on the baseline pathways if the land use pattern was fixed at baseline levels in each period in this case the level of impact largely reflects the forecast impact on yields dominated by forecast reductions in wheat and rice yields by approximately 3 in 2020 6 in 2080 across all the scenarios table 2 shirsath et al 2017 relative to this impact scenario adaptation takes place through shifts to more climate tolerant rice wheat and maize crops an interesting result of the analysis presented in fig 3 is that the gap between impact and baseline scenario for the gc is significantly greater than for the lm scenario both in absolute and proportional terms though there is an absolute lower production to meet crop demand under climate change of the global consolidated scenario this suggests some inherent resilience of farm margin to climate change in the local marginal configuration of production under baseline technologies flexibility in technology adoption and economy of scale under gc scenario leads to high agricultural growth compared to lm scenario we recognise the sensitivity of these results and onward analysis of adaption costs shown below on the climate scenario applied the default scenario reported throughout is rcp 8 5 however we have explored other scenarios for their impact on modelled total production cropping area and aggregate yields across the range of scenarios rcp 2 6 rcp 4 5 rcp 6 0 and rcp 8 5 the total production kt will be 99 828 21 9817 60 9817 10 and 15 211 97 respectively in 2020s in 2050s it will be 9463 92 9162 18 9521 26 and 21 696 72 and 9079 16 9277 80 9421 73 and 21 652 26 in 2080s respectively across the range of climate scenarios 3 3 marginal cost of adaptation table 3 presents marginal cost of adaptation to climate change measured as the additional cost relative to baseline growth for the lm constrained system this omits the residual differences in production relative to baseline which represents additional costs and benefits through income and consumption under the adaptation scenario increase of 14 5 total kt production in 2020 21 3 in 2050 and 31 8 in 2080 were observed over the climate change impact scenario fig 3 results show that investment requirement for adaptation to climate change is rapidly increasing over the time for instance investment in adaptation activities has increased from 33 0 in 2050 to 46 2 in 2080 compared to baseline table 3 the change in total production in adaptation scenario over baseline in 2050 is about 11 2 and same change in 2080 is 12 4 leading to marginal change of 1 2 here we must note that these results were not robust across configurations table 3 given the magnitude of underlying growth targets irrespective of additional climate change impacts we consider adaptation only in the context of incorporating climate change scenarios explicitly when developing wider growth strategies not as a separate climate margin subsequent discussion of prioritization refers only to adaptation scenarios in their absolute highlighting promising crops and technologies to support climate proofed growth in agricultural output 3 4 crop and technology prioritization fig 4 a and b demonstrates the progressive shift in technology composition throughout the adaptation growth pathway for the lm and gc scenarios respectively fully consolidated growth gc allows the allocation of high level climate smart technologies t7 to t10 to all land units irrespective of farm size constraints cost efficiency is not a factor in these scenarios given that all targets were well above the technical potential of production as a result the system prioritizes investment based only on marginal yield gains per unit land change and hence the gc system in fig 4b proposes investment only in high level climate smart technology t10 in the period to 2020 by comparison the lm system employs a much more diverse portfolio of technologies including input intensification t3 t5 on medium sized farms low level climate smart technology on marginal farms and an early breakthrough of improved rainfed production in both the cases 2080 represents a maximum feasible production configuration given the respective constraints on technology application marginal changes in fig 4 over the period 2050 80 correlate with the flat profiles observed in fig 3 over the same period land and seasonal water constraints are largely binding by 2050 at the allowed rate of expansion crop selection decisions are much more closely aligned between the lm and gc configurations being driven largely by common yield and sensitivity to yield growth in wheat and rice dominates due to significant gap to demand targets however when the crop demand constraints are not applied maize remains the best choice in many land units because of its higher productivity than rice or wheat under the crop demand constrained scenario the self sufficiency in maize is achieved early because of limited growth in its demand and selection of high yielding technology options by the model the self sufficiency achieved through a reduction in maize production compared to previous scenario demand unconstrained scenario under falling growth rate of crop demand of the cereals the most significant difference is the delayed onset of expansion in pulses and oil crops under the gc configuration as pathways focuses on developing concentrated high level climate smart rice and wheat production for more information please see appendix iii table s2 in the supplementary file it must be noted that in the fig 4 the increase in the crop area under both the configurations indicates increased cropping intensity in the bihar in addition to new technologies increase in aggregate production requires surplus land water and labour resources in the system in fig 4a and b we observe a significant increase in gross cropping area of 2010 levels by 2080 water constraints form a primary limit on production in particular for rice with kharif season water resource being the binding constraint on production in 2080 for 36 out of 38 districts in the model however technology portfolio t10 can help to minimize water related constraints by introducing water efficient technologies thereby increase gross cropped areas therefore these location specific surpluses and resource constraints drive the place specific priorities for the adaptation growth pathway however the decrease in cropping area under global consolidation scenario in 2020 are attributed the fact that crop demand targets are being achieved through the most efficient technologies under the most productive land units which otherwise was constrained in the marginal scenarios table 4 highlights the potential agricultural growth across the 38 districts of bihar for each period for the lm system this table is sorted on 2010 20 production growth to highlight priority districts for investment in the short term results show both spatial and temporal distribution of land area that can be allocated under various crops in different time periods the state level aggregated crop production shortfall and area under crops in both the scenarios is given in tables s1 and s2 of supplementary file crop wise disaggregated analysis not presented here shows that five districts supaul aurangabad west champaran bhabua and araria can significantly increase in the wheat production with exception of aurangabad whilst west champaran currently the second largest mustard producer is identified as a location for significant increase in the output of wheat and rabi maize production aurangabad bhabua and supaul are projected to be producing 20 more rice compared with the baseline production levels in general for the top five districts gram and lathyrus are identified as priority crops in 2080s the changes in the total crop area allocation across districts of bihar results in change in the effective returns to unit land use change under climate impacts marginal yield changes are 28 7 and 10 for the period 2010 2020 2020 2050 and 2050 2080 respectively over the previous time yield gains diminish towards the end of the century under the current available technologies 3 5 trade off analysis we conducted trade off analysis under the local marginal lm scenario between i minimizing emissions min emissions ii maximizing the total production max prod and iii maximizing the total npv of farm margin max npv fig 5 presents trade off between production and emission intensity in the different time periods results shows that there is a large trade off between production and emissions co2 eq across the time period the production gaps between max production and min emissions are about 7 19 and 21 million tons in 2020s 2050s and 2080s respectively the gap in emission intensities of maximization of production and npv of farm margin against minimization of emission is large in 2020s the gap in emission intensities of maximization of production and minimization of emission is minimum in 2080s however the gap still remains appreciable between maximization of npv of farm margin and minimization of emission there is yield penalty for minimizing emissions however emission intensity co2 eq kt 1 can significantly decrease with increase in total production overtime the widening gap in production and narrowing gap in emission intensity over time indicates the selection of more high yielding but emission efficient technologies by the model with changed landuse crop technology combination the production and emission changes are not proportional the change in crop area becomes appreciable only after the 2020s table 5 although max prod and max npv scenarios show distinct shifts in their technology portfolio fig 6 the min emissions scenario remains dominated by the current level of the technologies however it should be noted that this scenario still targets minimum production levels specified in the model the emission intensity at 2010 baseline is about 0 82 kg co2eq kt 1 which can be reduced to 0 63 kg co2eq kt 1 under the min emissions scenario it remains highest at 0 74 kg co2eq kt 1 in the max npv scenario fig 5 the max prod scenario has a slightly higher emission intensity 0 65 kg co2eq kt 1 than the min emissions scenario fig 5 in general maize all seasons and pulses showed highest gains in crop area and production over the baseline the max prod and the max npv scenario are resulting in the same level of emission intensities fig 6 until 2050s however the production gap for these scenarios is 0 5 mt and 5 7 mt at the 2020s and the 2050s respectively this shows that for attaining food security at the state level while keeping emission intensity same the crop technology portfolio of the max prod is the best suited emission intensities after 2050s increase slightly as a result of stabilized production profiles fig 5 the trade off analysis shows several possibilities of the crop technology portfolios depending on the system level objectives distinct variation was observed in the crop and technology portfolios at the land unit scale 3 6 sensitivity to rate of land use change a limited sensitivity analysis was carried out looking at variations in production growth crop technology configurations and costs with the maximum annual rate of area undergoing land use change in each year this was implemented by applying scalar multipliers to eq 8 rates of annual land use change were varied in the range 50 300 kha yr 1 around the baseline assumption of 250 kha yr 1 as the rate of land use change is increased from an initial low level we can identify priorities by the stage at which they enter the portfolio sensitivity to the rate can be considered an approximate sensitivity to the level of investment fig 7 demonstrates sensitivity of technology investment for the period 2010 20 as a function of the allowed rate of land use change for the local marginal configuration priorities can be inferred both from the absolute level and gradient of investment observed at each rate moderate intensification is a clear priority at lower rates whilst improved rainfed technologies become increasingly important as the rate of land use change increases 4 discussion 4 1 spatial and temporal prioritization of csa technologies the csap toolkit tested and evaluated here can identify location specific technological options and prioritize them for climate change adaptation in agriculture a range of csa technologies are prioritized based on crop and cropping systems resource availability and current future climatic conditions the csap toolkit s potential of identifying adaptation domains and establishment of out scaling potential for a range of technological options serves multiple objectives of climate change adaptation and mitigation in agriculture location and time period specific technological options provided by this toolkit can help development actors to decide which options to promote where and when results show that this toolkit can conduct an ex ante impact assessment of with without adaptation under current and future climate scenarios which is very important to avoid maladaptation of any csa technology by coupling with future scenario the toolkit can identify suitable options that can avoid maladaptation potentially leading to decisions that are informed by csap outputs this csap contributes to growing literature on climate change adaptation and mitigation planning through data based modelling approach 4 2 investment prioritization on csa a combination of biophysical social and economic indicators used for prioritization of csa options allow key stakeholders to assess technologies against various end users goals andrieu et al 2017 campbell et al 2016 national adaptation plan nap and intended nationally determined contributions indc of developing countries emphasise the importance of decision support tools in targeting adaptation investments identifying which interventions to choose from a portfolio that includes weather insurance groundwater management inter cropping and community managed seed banks among many others requires time and careful analysis by policymakers the csap toolkit can generate this information for policymakers that substantially can increase their ability to make better decisions under existing and future uncertainties our test and evaluation of csap in bihar india show that this toolkit provides enough information such as type and level of technology use in different crops and total food production under various portfolios of csa options in different time period this information can be used for prioritizing csa investment for particular location and crop cropping system e g shirsath et al 2017 we estimated technology input and output values based on available price information and discount factor for different period of time the resulting analysis provides information about investment requirement on particular portfolio of csa options to achieve target level of production under baseline and future scenarios the toolkit provides enough information to prioritize investment for the short term 2020 while locating those priorities within a medium 2050 and long term 2080 agricultural growth pathway results show that investment requirement for adaptation to climate change is rapidly increasing over the time for instance investment in adaptation activities has increased from 33 0 in 2050 to 46 2 in 2080 compared to baseline however change in total production is marginal between 2050 and 2080 this change in total production for adaptation scenario over baseline in 2050 is about 11 2 and same change in 2080 is 12 4 4 3 adaptation benefits this toolkit incorporates dynamic investment constraints to assess the impact of particular crop technology activities at different farm size and rate of land use change the accessibility of various farm size categories to specific technologies is determined by their investment capacity results indicate that economy of scale in csa technology implementation can be achieved when farm size no longer plays a role in limiting technology adoption similarly land use change applied in the toolkit accounts large transaction cost for shifting in crop production with new technologies the changes in the total crop area allocation results in change in the effective returns to unit land use change under climate impacts period on period yield changes under climate scenario rcp 8 5 are 28 7 and 10 for the periods 2010 2020 vs baseline 2020 2050 and 2050 2080 respectively over the previous time however there are less significant impacts for some other scenarios explored rcp 6 0 reporting only 1 3 and 1 for the same period to period shifts yield gains diminish towards the end of the century under the current available technologies with surplus production potential exhausted and the onset of significant climate change returns to the final stage of investment on remaining rainfed land fail to maintain yield levels the system has a deficit of adaptive capacity in terms of resources and technologies available to it this indicates that a transformational adaptation is required over time to achieve more benefits from csa this toolkit has also provided results of trade off analysis between investment requirement for different crop technology portfolios and return to investment high level of technology intervention i e more climate smart technologies for adaptation to climate change require more investment however net return increases at high level of csa intervention due to a significant improvement in production both in current and future climate 4 4 scope and limitations of the csap toolkit the development of dynamic models such as that demonstrated here provide valuable tools by integrating climate change forecasts socio economic datasets and biophysical models into the design of wider sectoral growth pathways the toolkit presented here can also be used to design growth pathways with due emphasis on ecological services the toolkit has capabilities understand the effects of agricultural production systems on environment through analysis of ghg emissions from agriculture and resources use efficiencies of inputs applied on the other hand it also factors in the effects of the changes in the environmental systems on the agricultural production through detailed bio physical modelling for example the toolkit can be used to understand the water energy emissions and food nexus in agro ecological systems wherein these components are fully interconnected and cannot be treated separately which will otherwise lead to undesired effects on the other application of one such modelling framework for agricultural production in arizona is demonstrated using similar modelling framework by berardy and chester 2017 the toolkit presented here treats the agro ecological systems in holistic manner wherein we can maximize the synergies and minimize the trade offs through multi objective optimization the analysis using csap toolkit considers biophysical socio economic and climatic factors and scenarios as it s a bottom up approach the analysis often starts from smallest homogeneous parcels called land units getting the datasets at land unit scale remains the most critical issue the methods techniques and analysis using csap toolkit poses challenges in data scarce conditions the csap modular framework and database creation methodology currently works in decoupled fashion this means the location specific peculiarities can be addressed but the changes need to be translated manually in model indexing and databases further our analysis of adaptation was also constrained by our model of climate change impacts we only considered crop specific impacts on average yields we did not consider i technology specific climate impacts wherein technologies could be differentiated based on the sensitivity of their yields to the forecast climate change or ii crop and technology specific yield variability in the short term as a function of underlying drought and flood year likelihood the modelling framework outlined here is however capable of handling both these forms of crop and technology differentiation 5 conclusions the objective of developing this toolkit was to provide a relatively simple and quantitative framework for prioritization of climate smart interventions using detailed biophysical and socioeconomic datasets at subnational and local level in its current formulation csap is flexible in its capability to model agricultural production at a wide range of spatial and temporal scales this work develops a dynamic spatially explicit optimization model to explore a range of agricultural growth pathways coupled with climate adaptation strategies integrating detailed bottom up biophysical climate impact and agricultural emissions models this tool is capable of supporting multi objective analysis of agricultural production in relation to food self sufficiency incomes and mitigation targets csap supports climate proof agricultural development by providing a means for carrying out detailed scenario analysis in the context of climate adaptation providing valuable bottom up evidence to support top down estimates of the costs of climate change adaptation the csap toolkit allows the user to identify robust decisions under a set of uncertain circumstances it is then possible to carry out trade off analysis of alternative climate smart agriculture development pathways based on the dynamic pathways the toolkit can support decisions on which crops to cultivate which climate smart agricultural technologies and practices to invest in where to target that investment and when those investments should be made the toolkit prioritises investment decisions for the short term e g to 2020 while locating those priorities within a medium 2050 and long term 2080 agricultural growth pathway the trade off analysis showed several possibilities for the crop technology portfolios depending on the system level objective the tool constrains the adaptation options to a limited set of viable alternatives and provides the critical trade off information required to support the prioritization decision for bihar the csap results show that investment requirement for adaptation to climate change is rapidly increasing over the time for instance investment in adaptation activities has increased from 33 0 in 2050 to 46 2 in 2080 compared to baseline most importantly csap can bring analytical rigor in the planning process and in solving developmental problems in particular supporting developing countries in their preparation of national adaptation programmes of action napa and nationally appropriate mitigation actions namas under the unfccc framework the csap toolkit has the capability to generate information for policymakers which may help them to make better decisions even under existing and future uncertainties the methods techniques and analysis using csap toolkit poses challenges in data scarce conditions besides the csap modular framework and database creation methodology currently works in decoupled fashion the development of generic software with dynamic feedback loops to the databases and scenario analysis within a single framework is a goal of future research acknowledgments we acknowledge the cgiar fund council australia aciar irish aid european union international fund for agricultural development ifad netherlands new zealand switzerland uk usaid and thailand for funding to the cgiar research program on climate change agriculture and food security ccafs appendix a supplementary data supplementary material related to this article can be found in the online version at doi https doi org 10 1016 j ecolmodel 2018 04 008 appendix a supplementary data the following is supplementary data to this article 
25280,climate smart interventions in agriculture have varying costs and environmental and economic impacts their implementation requires appropriate investment decisions by policy makers that are relevant for current as well as future scenarios of agro ecology climate and economic development decision support tools are therefore needed to assist different stakeholders to prioritize and hence implement appropriate strategic interventions these interventions transform agriculture ecosystems to climate resilient adaptive and efficient this paper outlines the mathematical modelling framework of one such the climate smart agricultural prioritization csap toolkit this toolkit employs a dynamic spatially explicit multi objective optimization model to explore a range of agricultural growth pathways coupled with climate adaptation strategies to meet agricultural development and environmental goals the toolkit consists of three major components i land evaluation including assessment of resource availability land suitability yield and input output estimation for all promising crop production practices and technologies for key agro ecological units ii formulation of scenarios based on policy views and development plans and iii land use optimization in the form of linear programming models climate change and socio economic drivers condition the land evaluation technological input output relations and specification of optimization objectives that define modelled scenarios by integrating detailed bottom up biophysical climate impact and agricultural emissions models csap is capable of supporting multi objective analysis of agricultural production goals in relation to food self sufficiency incomes employment and mitigation targets thus supporting a wide range of analyses ranging from food security assessment to environmental impact assessment to preparation of climate smart development plans keywords climate smart agriculture optimization adaptation mitigation prioritization climate change 1 introduction the climate smart agriculture csa is an integrative approach to address the interlinked challenges of food security climate change impact and ecological sustainability lipper and zilberman et al 2018 steenwerth et al 2014 to achieve these three objectives are defined i sustainably increasing agricultural productivity to support equitable increase in farm incomes food security and development ii adapting and building resilience of agricultural and food security systems to climate change iii and reducing greenhouse gas emissions from agriculture fao 2013 a range of technological institutional and policy options has been proposed to help agriculture become climate smart including weather insurance spatial weather forecasts agricultural diversification stress tolerant crop varieties community management of soil and water resources and policies related to water and carbon management thornton et al 2017 shirsath et al 2017 khatri chhetri et al 2017 long et al 2016 lipper et al 2014 vermeulen et al 2012 these interventions have varying costs and economic impacts moreover the effectiveness of these interventions depends on agro ecological condition of a region and their adoption is highly influenced by the socio economic characteristics of the agrarian society of that region khatri chhetri et al 2017 sapkota et al 2017 therefore the implementation of csa requires appropriate investment decisions in both on farm capital and wider agricultural outreach programmes furthermore climate smart investment can have a wide range of scales ranging from the single field up to the national level it is unlikely that investment in any single intervention will provide optimal benefits but rather an integrated portfolio of interventions is required to best support adaptation to climate change in agriculture across a range of scales this spatial complexity is compounded by the long timeframes associated with climate change requiring further consideration of when as well as where to prioritize investment in any set of intervention options if climate smart technologies provide net benefits to farmers irrespective of climate change so termed no regrets options thornton and lipper 2014 willows and connell 2003 then the investment is preferred as soon as possible however given the costs of investment in the short term under constrained budgets and with the benefits of adaptation increasing with the progressive impacts of climate change it may be preferable to delay investment until full benefits can be realised decision support tools are therefore needed that can assist different stakeholders to prioritize appropriate and timely strategic interventions to transform agricultural practice to become climate resilient efficient and adaptive tanure et al 2013 given the competing social economic and environmental dimensions of adaptation decisions multi criteria analysis mca is becoming increasingly popular in supporting the development of adaptation strategies mca differs from traditional risk management tools it can retain competing objectives separately rather than aggregating them into a single weighted decision metric willows and connell 2003 mca prabhakar 2014 feltmate and thistlethwaite 2012 lobell et al 2008 and tools based on mca such as adaptation decision matrix adm mizina et al 1999 have been used widely in prioritizing technology options in agriculture several other tools such as fuzzy analytical hierarchical process sanneh et al 2014 and crop simulation model based adaptation decision tools webber et al 2014 have also been used several other tools and methodologies including participatory methods arshad et al 2017 khatri chhetri et al 2017 mwongera et al 2017 taneja et al 2014 have been reported for adaptation prioritization e g willows and connell 2003 lobell et al 2008 cross et al 2012 sanneh et al 2014 webber et al 2014 ilori and prabhakar 2015 brandt et al 2017 however there is a lack of dynamic and spatially explicit optimization tool to explore a range of agricultural growth pathways under different climate change scenarios this study presented here builds over work done by shirsath et al 2017 where prioritization of the climate smart agricultural land use options at a regional scale were showcased using the databases generated through a spreadsheet based methodology in this methodology however the pillars of climate smart agriculture were treated separately and finally integrated through climate smartness index the climate smart agriculture has a wide range of objectives including food security increase in farmers net income improvement in resource use efficiency climate resilience and ghg mitigation the single objective models cannot take into account the trade offs or synergies between economic efficiency and environmental efficiency which was not addressed in the earlier work using detailed bottom up biophysical and socio economic databases as described by shirsath et al 2017 therefore a multi objective modelling framework with detail consideration of spatial heterogeneity in terms of bio physical characteristics and resource endowments is necessary to make csa adoption decisions for a range of stakeholders given this motivation we have taken into consideration multiple objectives for optimization purpose in addition the trade offs among the various competitive optimal solutions corresponding to different objective function has been considered to estimate the decision space which will minimize the trade offs among the competitive objectives so that climate smart technologies can be prioritized in more sustainable manner hence this paper outlines a multi objective prioritization toolkit based on a spatially explicit bottom up biophysical framework and demonstrates a case study for prioritization of csa technologies in bihar state india the toolkit supports analysis of trade offs between objectives and identification of efficient solutions results shows that the toolkit is capable in optimizing different adaptation options based on bio physical conditions of a particular location 2 materials and methods 2 1 model description in its current formulation the climate smart agricultural prioritization csap toolkit is flexible in its capability to model agricultural production at a wide range of spatial and temporal scales a typical analysis with the csap toolkit starts with the identification of land units which define the spatial resolution of the study and then proceeds with preparation of biophysical and socio economic datasets for the multi objective analysis although database development and multi objective analysis can be developed separately we recognise that they are highly interdependent in view of the nature of the explicit assumptions made during development of both the database and the toolkit application of the csap toolkit therefore encompasses all stages of data processing assumption setting e g land unit season and crop suitability and mathematical model formulation a simple flow chart outlining this process is shown in fig 1 2 1 1 spatial land units the effectiveness of technological interventions is strongly determined by local bio physical conditions climate change impacts adaptive capacity and resource endowments both in space and size of production unit as a result no single intervention can be assumed to be generally applicable or a best bet at the landscape regional and national scales each location here represents a homogeneous production area which whilst still clearly much larger than any single farm provides a reasonably accurate model of local production conditions and resulting crop technology performance csap toolkit uses homogeneous parcels of land designated as land units within each location we can further differentiate representative farm sizes which may exhibit different levels of resource constraints and costs e g labour water access working capital and or constrained access to particular technologies this land unit approach has also been used by agrell et al 2004 and aggarwal et al 2001 2 1 2 dynamic agricultural development pathways the csap toolkit is disaggregated over a number of discrete time steps forming a sequence of future system states at each future time a detailed crop technology specific land use pattern is identified and a range of performance metrics derived covering production levels emissions and employment for example the result is a pathway linking sequential system states that transitions from the current to some future system that optimises the specified objective over the total time horizon 2 1 3 uncertainties in future climate and socio economic scenarios the performance of any adaptation intervention will be conditional on future climatic conditions and the biophysical response of agricultural systems to those conditions both of which are subject to high levels of uncertainty in addition to this climate centric set of uncertainties we must also recognise an entwined set of uncertainties associated with wider socio economic development most relevant to the agricultural sector in developing countries such as constraints of institutions infrastructure and knowledge interventions should therefore be analysed and prioritised when they perform best across a potential spectrum of future climate and socio economic scenarios i e are robust in order to take into account this uncertainty we implement a scenario specific disaggregation of the model a demonstration of the segmentation of the dynamic and stochastic model horizon is provided in fig 2 the toolkit identifies decisions that are robust against future uncertainty i e no regret options whilst identify the option to delay sensitive decisions until better information regarding climate outturn is available in this context the information of value to the decision maker is the set of priorities defined by options taken in the short term that are robust to future climate change we recommend the application of a model formulation representing multiple climate scenarios including such constraints if climate uncertainty is to be the focus of scenario analysis in a particular practical application given computational limitations in examples presented in sections 3 and 4 we focus our analysis on multi objective optimization under various land use constraints e g uncertainty in policy objectives and socio economic conditions rather than an explicit analysis of climate uncertainty 2 1 4 multiple objective analysis for analysis of trade offs between objectives and identification of efficient solutions we first identify extreme values for the competing objectives by optimising each in isolation based on these extreme values a decision space can be identified within which all further trade off solutions will be located being bounded by observed upper and lower extremes in the respective objectives bio physical economic and environmental constraints on the maximum or minimum level of objectives within this decision space are then formulated and applied in a second round of model solutions trials in order to generate a set of trials that provide good coverage of the decision space we used latin hypercube sampling mckay et al 1979 we first identify a sample increment for each objective based on even segmentation of the observed objective range a set of constraint levels is generated by sampling from the uniform distribution within each increment starting from the minimum objective level each trial identifies an optimal performance in each objective achievable under varying levels of constraint in other objectives a random allocation variable is then assigned to each constraint level these levels are then combined into a set of trials by matching based on the allocation variable finally we screen the resulting set of model solutions to identify only efficient solutions the resulting efficient frontier provides valuable information regarding the trade offs between the two objectives and highlights where the marginal cost of achieving one objective in favour of the other is minimised i e efficient frontier is characterised by a set of solutions from which no single objective can be improved without deteriorating another in the context of agricultural adaptation a set of efficient options could be identified through trade off among the key objectives of employment climate mitigation and food security options in this context are not defined at the outset by their constituent policy action but identified and characterised by their relative cost benefit trade offs across a range of competing objectives the analysis constrains the adaptation options to a limited set of viable alternatives and provides the critical trade off information required to support if not explicitly make the prioritization decision niang diop and bosch 2004 for this purpose the information provided by the efficient frontier is invaluable 2 2 mathematical formulation the dynamic land use allocation in the toolkit is based on the minimum cost pathways to meet future demand targets under a range of agricultural growth scenarios from these modelled growth pathways we can determine priorities for investment in each period both in delivering baseline growth and in adapting to the additional burden of climate change modelled investment decisions constrain the optimised land use patterns in each period these land use patterns comprise crop technology combinations allocated to defined land unit conditional on area labour and water constraints this dynamic allocation is further constrained by scenario specific constraints on i the rate of land use change ii the scale of reallocation of existing production and iii the suitability of crops and technologies to particular land units specifically the limited application of high technology on small and marginal farms here we present a condensed formulation for mathematical clarity on this basis the toolkit is developed around a primary activity variable x i j t s that represents the area allocated to a particular crop technology i within a particular land unit j at a given time t for each climate scenario s from the variable x we can determine two further variables specifying the total increase in area under each crop and technology y i j t s and the associated investment in increasing the working capital within each land unit z j t s the relationship between these variables is defined as 1 y i j t s x i j t s x i j t 1 s i j t s 2 z j t s i x i j t s c i j t s i x i j t 1 s c i j t 1 s j t s 3 x i j t s y i j t s z j t s 0 i j t s importantly when measuring investment areas and associated costs we only measure the increase in cropping area under technological intervention or associated cost in eq 2 we sum over crop and technology combinations allowing existing working capital to mobilise freely among new production activities within each land unit however any additional costs of production at a given time step above that required in the previous time step are recorded as investment costs production costs for each activity c i j t s are variable over time in order to model the impact of climate change on crop production as a result even if cropping activities are held constant the impact of climate change can be observed where investment is required to maintain productive area we recognise that our representation of investment costs is limited to only changes in the total production cost between time steps we do not account for costs of outreach and extension effort required in order to facilitate the adoption of new technologies or the cost and inefficiency of delivering the increase in working capital e g via public or private credit the toolkit is constrained at a biophysical level by the availability of land water and labour resources eq 4 represents this block of resource constraints in the standard linear programming lp formulation activity coefficients a e g seasonal irrigation water requirement monthly labour requirement etc and resource limits b e g land area labour availability etc are exogenously varying with time and for specific climate scenarios within this set of constraints a range of spatial and temporal disaggregations can be applied for example in our case study presented below activities are defined and parameterised at a biophysical land unit level n 194 whilst water and labour constraints are applied at an aggregate district level n 38 land units are mapped to districts on a one to one basis within the constraints implied by eq 4 in the temporal domain labour constraints are applied on a monthly or single peak month basis whilst land is constrained on a seasonal basis a single unit of land being available for cropping in three seasons within any single year 4 a t s x b t s t s in addition to the classical set of resource limits a number of additional constraints are formulated to model the dynamics of the system under a range of growth scenarios 5 x i j t s x i j 0 i j s t 1 6 i x i j t s i x i j 0 j s t 1 7 i j x i j t s y i j t s t t t s 8 i j y i j t s r t s t s following calibration the land use pattern for the first position of the dynamic model is fixed via eq 5 to calibrated levels x i j 0 under particular growth strategies we can then apply eq 6 to constrain the total area under production for each land unit at latter time period to be at least that observed at the base period in the absence of this constraint the model can freely reallocate production in the spatial domain in the analysis presented below we term these scenarios local and global respectively eq 7 ensures that the growth pathway achieves the target level production at each future time period t t technically the level of production is specified as the product of the cropped area and the scenario and period specific yield of the selected crop technology at each location y i j t s in practice this target level may be adjusted downwards to a feasible maximum level of production if target production levels are not achievable further the toolkit is actually expressed over indices representing crop and technology separately similarly the location index j is spliced into separate indices for biophysical land unit land type i e rain fed irrigated and farm size e g marginal medium large etc in the absence of additional constraint the model will shift rapidly from the calibrated initial time period t 1 to optimal configurations driven by those objectives outlined below we therefore implement eq 8 to constrain the increase in area under new crop and technology combinations to a specified upper bound r t s for each period to time t the upper bound r is calculated assuming a specified maximum annual rate of land use change in each year of the period prior to time t this assumes a fixed rate of technology adoption across the aggregate of all crop technology combinations combining increased expansion in current technologies with intensification and climate smart options as in the case of production targets a more refined analysis could specify adoption rates and associated constraints specific to each crop technology combination given the set of constraints outlined above we consider two key objectives applied in the analysis algorithm outlined below maximising production and minimising net present cost 9 max x y s p s t i j x i j t s y i j t s 10 min x y z s p s t γ t n t i j x i j t s p i y i j t s c i j t s δ t j z j t s in the case of multiple future climate scenarios being specified eq 9 maximises expected production as the product of total production over the model horizon for each scenario weighted by the likelihood of each scenario p s this objective is applied in a model with eqs 1 4 and 8 to identify whether specified target levels are achievable eq 10 is applied in a model containing eqs 1 8 in order to identify growth pathways that maximizes the expected net present value of the farm margin over the model horizon given exogenously specified prices p we assume that investment occurs at a constant rate within each period so that discount factors applied to investment costs δ represent the average factor for the period prior to position t the activity variable x relates to the operating point at each model position e g snapshot year we linearly interpolate between subsequent time periods to calculate representative discount rates γ and time weights n to be applied to each operating point the further technical detail about the mathematical formulation of this model can be obtained as a supplementary material with this article 2 3 data specification a wide range of data is required to apply the csap toolkit in a practical decision making context a summary of data requirements of the toolkit is provided below table 1 for a typical csa prioritization exercise shirsath et al 2017 also describes approaches for developing the database component of the csap toolkit in an applied context the database includes biophysical e g soil water temperature precipitation and production economic e g input costs market prices for output and discount rate and social e g adoption rate farm typology and budget allowance for intervention datasets 2 4 analysis algorithm in carrying out our analyses we undertake a series of sequential optimization runs that can be considered to constitute a general model algorithm for the analysis of i agricultural growth pathways ii the impact of forecast climate change on these pathways and iii adaptation actions to mitigate climate impacts a high level overview of this algorithm is provided below 1 base year system calibration run the toolkit comprising only the base year i e t 1 with the objective to maximise production up to but not exceeding the level observed in base year data for each crop within each land unit run the toolkit again with the objective to minimise the sum absolute errors in cropping area relative to base year data for each crop within each land unit from the resulting base year land use pattern specify parameter x i j 0 2 baseline growth scenario setup the toolkit with baseline climate data e g current climate fixed over model horizon and specify a local or global growth scenario i e include or exclude eqn 6 run the toolkit to maximise net present value of the farm margin the resulting growth pathway is referred to as the baseline scenario 3 climate change impact and adaptation scenarios setup the toolkit with climate change scenario data and specify the growth scenario to be consistent with that applied in the baseline scenario above run the toolkit with constraint fixing activity variables x i j t s at levels in baseline scenario calculated in step 2 2 the resulting growth pathway is referred to as the impact scenario remove constraint on activity levels run the toolkit to maximise net present value of the farm margin the resulting growth pathway is referred to as the adaptation scenario the result of the above algorithm is a set of three growth scenarios termed i baseline ii impact and iii adaptation whilst these can be analysed as stand alone scenarios further information can be derived from analysing the variation between them principally the variation between optimised investment and activity variables in baseline and adaptation scenarios explicitly identifies priorities for climate adaptation as distinct from underlying agricultural sector development in practice the development of growth pathways that explicitly account for forecast climate change in their design constitutes a key role in planned climate adaptation these pathways implicitly minimise the impact of climate change on the growth pathways in that they are optimised under conditions for the specified climate scenario s in practice therefore we choose to focus on developing climate robust growth scenarios through step 3 3 however by comparing growth scenarios developed with and without climate change i e steps 3 2 2 2 and 3 3 we can measure the cost of planned adaptation as additional to growth in a benign climate this analysis is presented below providing a valuable bottom up estimate of climate adaptation costs to compare against top down estimates of investment and financial flows required to climate proof future agricultural development parry et al 2009 2 5 application of csap toolkit a case study application of the csap toolkit has been developed for the indian state of bihar bihar is one of the most vulnerable states in india to climate change incidence of frequent floods and drought extreme heat stresses and other climate related risks are posing threats to agricultural production in bihar this study considered major crops rice and maize in rainy season kharif pulses lentil gram and lathyrus wheat maize and mustard in winter rabi season and maize and mung bean in summer season currently these crops together occupy more than 85 of gross cropped area in bihar table 2 shows a list of interventions in different technology portfolios used in the study the selected technologies represent current technologies intensification technologies and climate smart technologies current technologies have two levels current rainfed t1 and current irrigated t2 an improved rainfed technology t3 is also considered which is also an intensification technology categorised separately to mark its distinction from the irrigated technologies intensification technologies applied to irrigated areas and these have three levels t4 t6 the climate smart technologies for irrigated areas with four levels t7 to t10 are considered in this analysis the crop technology index i represents 10 crop and 10 technologies the crop yields area and technology characteristics were also included in the csap toolkit in this study we demarcated bihar into 34 homogenous spatial units and superimposing it with the district boundaries resulted in 194 land units the smallest units of assessment in this study each land unit within an administrative block differs from another by at least one biophysical attribute the land unit index j is further split into 3 constituent indices representing i biophysical land units each mapped uniquely to the set of districts ii land type distinguishing rainfed from irrigated land areas and iii farm size categories this analysis refers four model setups comprising alternative sets of constraints on growth pathways these constraints were developed along two axes first the degree to which the level of baseline production at each land unit type and farm size e g marginal rainfed farms in a given land unit are preserved in future land use patterns preventing free reallocation of production to more cost efficient locations the inclusion or exclusion of the constraint distinguishes these local and global allocation second a binary constraint on the suitability of particular technologies for given farm sizes specifically small and marginal farms can be included this distinguishes so termed marginal or consolidated technology allocation in the consolidated case technologies can be freely allocated to any land unit e g there is no limit on the application of climate smart technologies we refer to the resulting set of constrained systems as local marginal lm local consolidated lc global marginal gm and global consolidated gc local marginal refers to the scenario when climate smart technologies are not feasible to the marginal farmers to a particular land unit because of its size of farm and other constraints associated with it such as capital financial mechanisation scalability etc besides maintaining baseline crop mix this is the most practical scenario where cropping patterns are relatively stable whereas under local consolidated scenario we assume that all size groups are free to choose efficient technology and baseline crop mix is maintained this scenario can be seen as manifestation of land pulling type of policies over local marginal scenario when we assume that technology is constraint for the marginal farmers but total production of the state will be obtained from the most cost effective land unit without any minimum production target to each land unit this scenario is called global marginal the global marginal scenario considers that advance technologies are not feasible to the marginal farmers but they can change their cropping pattern to adapt with the climate change impacts and the choice of crop can be driven by the market opportunity for a particular crop thus motivation behind this scenario is that crop specific market infrastructure will be created in the region where production of that crop is cost effective finally the gc scenario is an optimistic scenario where farmers will be efficient enough to choose either crop or technology or both according to the agro ecological condition of the region and the state planner will be able to institutionalize their policy interventions and effective institutional mechanism to achieve climate smart agriculture in the state current agriculture production systems in south asia are operating near to local marginal scenario under stable cropping systems whereas the global consolidation probably is the least likely scenario here we primarily focus on the contrasting lm and gc scenarios 3 results 3 1 baseline validation prior to analysis of growth pathways the toolkit was first evaluated in order to test whether it is able to reproduce the reported production of each crop at a district level for the base year 2009 10 please see appendix iii fig s1 in supplementary files the solution proceeds by first identifying a land use pattern that matches reported production kt and area kha levels by crop and by district in the representative baseline year a second calibration was then carried out to minimise the absolute deviation to reported production area whilst achieving the best fit production schema the baseline validation ensures that the input data and constraints were realistic and allow to develop a modelled land use pattern that matches with the observed pattern to a good degree of accuracy residual errors observed during these calibrations were largely due the constraints on water availability and assumptions regarding crop suitability in the given land units the ratio between irrigated and rain fed production was largely controlled in the area calibration given the target production level relative yields of the two technologies current irrigated and rain fed technology and availability of rain fed and irrigated land in each district 3 2 scenarios baseline impact and adaptation scenarios were determined in accordance with the algorithm outlined in section 2 4 for all scenarios and constraint setups the toolkit targeted food self sufficiency based on forecast demand over the model horizon the local marginal and global consolidated constraints formed the respective upper and lower bounds on the total production envelope sets of scenarios for these constraints are illustrated in fig 3 the total crop demand scenario was derived from a combination of published statistics and measured elasticities kumar et al 2011 where incomplete data has been adjusted to best model those specific crop categories applied in this case study demand for each crop commodity over the horizon 2015 2025 was translated into a trend in per capita demand projected forward on trend to 2030 and fixed to constant at that level from 2030 to the end of the model horizon total demand kt in each future year was calculated by multiplying projected per capita demand to total population projections based on bihar specific projection population projections for india and states 2001 2026 may 2006 to 2026 indexed to total india population projection for remainder of horizon world population prospectus 2016 https esa un org unpd wpp fig 3 shows that the targeted self sufficiency in the crop demand is not achievable under the constrained growth pathway local marginal lm as well as under the most relaxed growth pathway global consolidation gc the gap in the total production and demand is more and remains same with the time as compared with the global consolidation pathway where it becomes narrower with time total population in the study area bihar is already high and is projected to continue to grow in future only after 2050 food demand will not increase significantly because of low expected population growth in the state disaggregated analysis of individual crop showed that maize and pulses production can satisfy their demand under lm and gc scenarios however major crops like rice wheat and mustard production cannot fulfil their total demand of the study area for more information please see appendix iii table s1 in the supplementary file the profile of each set of pathways is largely dictated by the constraint on the rate of land use change set at 250 kha yr 1 over the horizon coupled with the allowance of higher yielding high level climate smart technologies in the gc case impact scenarios measure the effect of forecast climate change on the baseline pathways if the land use pattern was fixed at baseline levels in each period in this case the level of impact largely reflects the forecast impact on yields dominated by forecast reductions in wheat and rice yields by approximately 3 in 2020 6 in 2080 across all the scenarios table 2 shirsath et al 2017 relative to this impact scenario adaptation takes place through shifts to more climate tolerant rice wheat and maize crops an interesting result of the analysis presented in fig 3 is that the gap between impact and baseline scenario for the gc is significantly greater than for the lm scenario both in absolute and proportional terms though there is an absolute lower production to meet crop demand under climate change of the global consolidated scenario this suggests some inherent resilience of farm margin to climate change in the local marginal configuration of production under baseline technologies flexibility in technology adoption and economy of scale under gc scenario leads to high agricultural growth compared to lm scenario we recognise the sensitivity of these results and onward analysis of adaption costs shown below on the climate scenario applied the default scenario reported throughout is rcp 8 5 however we have explored other scenarios for their impact on modelled total production cropping area and aggregate yields across the range of scenarios rcp 2 6 rcp 4 5 rcp 6 0 and rcp 8 5 the total production kt will be 99 828 21 9817 60 9817 10 and 15 211 97 respectively in 2020s in 2050s it will be 9463 92 9162 18 9521 26 and 21 696 72 and 9079 16 9277 80 9421 73 and 21 652 26 in 2080s respectively across the range of climate scenarios 3 3 marginal cost of adaptation table 3 presents marginal cost of adaptation to climate change measured as the additional cost relative to baseline growth for the lm constrained system this omits the residual differences in production relative to baseline which represents additional costs and benefits through income and consumption under the adaptation scenario increase of 14 5 total kt production in 2020 21 3 in 2050 and 31 8 in 2080 were observed over the climate change impact scenario fig 3 results show that investment requirement for adaptation to climate change is rapidly increasing over the time for instance investment in adaptation activities has increased from 33 0 in 2050 to 46 2 in 2080 compared to baseline table 3 the change in total production in adaptation scenario over baseline in 2050 is about 11 2 and same change in 2080 is 12 4 leading to marginal change of 1 2 here we must note that these results were not robust across configurations table 3 given the magnitude of underlying growth targets irrespective of additional climate change impacts we consider adaptation only in the context of incorporating climate change scenarios explicitly when developing wider growth strategies not as a separate climate margin subsequent discussion of prioritization refers only to adaptation scenarios in their absolute highlighting promising crops and technologies to support climate proofed growth in agricultural output 3 4 crop and technology prioritization fig 4 a and b demonstrates the progressive shift in technology composition throughout the adaptation growth pathway for the lm and gc scenarios respectively fully consolidated growth gc allows the allocation of high level climate smart technologies t7 to t10 to all land units irrespective of farm size constraints cost efficiency is not a factor in these scenarios given that all targets were well above the technical potential of production as a result the system prioritizes investment based only on marginal yield gains per unit land change and hence the gc system in fig 4b proposes investment only in high level climate smart technology t10 in the period to 2020 by comparison the lm system employs a much more diverse portfolio of technologies including input intensification t3 t5 on medium sized farms low level climate smart technology on marginal farms and an early breakthrough of improved rainfed production in both the cases 2080 represents a maximum feasible production configuration given the respective constraints on technology application marginal changes in fig 4 over the period 2050 80 correlate with the flat profiles observed in fig 3 over the same period land and seasonal water constraints are largely binding by 2050 at the allowed rate of expansion crop selection decisions are much more closely aligned between the lm and gc configurations being driven largely by common yield and sensitivity to yield growth in wheat and rice dominates due to significant gap to demand targets however when the crop demand constraints are not applied maize remains the best choice in many land units because of its higher productivity than rice or wheat under the crop demand constrained scenario the self sufficiency in maize is achieved early because of limited growth in its demand and selection of high yielding technology options by the model the self sufficiency achieved through a reduction in maize production compared to previous scenario demand unconstrained scenario under falling growth rate of crop demand of the cereals the most significant difference is the delayed onset of expansion in pulses and oil crops under the gc configuration as pathways focuses on developing concentrated high level climate smart rice and wheat production for more information please see appendix iii table s2 in the supplementary file it must be noted that in the fig 4 the increase in the crop area under both the configurations indicates increased cropping intensity in the bihar in addition to new technologies increase in aggregate production requires surplus land water and labour resources in the system in fig 4a and b we observe a significant increase in gross cropping area of 2010 levels by 2080 water constraints form a primary limit on production in particular for rice with kharif season water resource being the binding constraint on production in 2080 for 36 out of 38 districts in the model however technology portfolio t10 can help to minimize water related constraints by introducing water efficient technologies thereby increase gross cropped areas therefore these location specific surpluses and resource constraints drive the place specific priorities for the adaptation growth pathway however the decrease in cropping area under global consolidation scenario in 2020 are attributed the fact that crop demand targets are being achieved through the most efficient technologies under the most productive land units which otherwise was constrained in the marginal scenarios table 4 highlights the potential agricultural growth across the 38 districts of bihar for each period for the lm system this table is sorted on 2010 20 production growth to highlight priority districts for investment in the short term results show both spatial and temporal distribution of land area that can be allocated under various crops in different time periods the state level aggregated crop production shortfall and area under crops in both the scenarios is given in tables s1 and s2 of supplementary file crop wise disaggregated analysis not presented here shows that five districts supaul aurangabad west champaran bhabua and araria can significantly increase in the wheat production with exception of aurangabad whilst west champaran currently the second largest mustard producer is identified as a location for significant increase in the output of wheat and rabi maize production aurangabad bhabua and supaul are projected to be producing 20 more rice compared with the baseline production levels in general for the top five districts gram and lathyrus are identified as priority crops in 2080s the changes in the total crop area allocation across districts of bihar results in change in the effective returns to unit land use change under climate impacts marginal yield changes are 28 7 and 10 for the period 2010 2020 2020 2050 and 2050 2080 respectively over the previous time yield gains diminish towards the end of the century under the current available technologies 3 5 trade off analysis we conducted trade off analysis under the local marginal lm scenario between i minimizing emissions min emissions ii maximizing the total production max prod and iii maximizing the total npv of farm margin max npv fig 5 presents trade off between production and emission intensity in the different time periods results shows that there is a large trade off between production and emissions co2 eq across the time period the production gaps between max production and min emissions are about 7 19 and 21 million tons in 2020s 2050s and 2080s respectively the gap in emission intensities of maximization of production and npv of farm margin against minimization of emission is large in 2020s the gap in emission intensities of maximization of production and minimization of emission is minimum in 2080s however the gap still remains appreciable between maximization of npv of farm margin and minimization of emission there is yield penalty for minimizing emissions however emission intensity co2 eq kt 1 can significantly decrease with increase in total production overtime the widening gap in production and narrowing gap in emission intensity over time indicates the selection of more high yielding but emission efficient technologies by the model with changed landuse crop technology combination the production and emission changes are not proportional the change in crop area becomes appreciable only after the 2020s table 5 although max prod and max npv scenarios show distinct shifts in their technology portfolio fig 6 the min emissions scenario remains dominated by the current level of the technologies however it should be noted that this scenario still targets minimum production levels specified in the model the emission intensity at 2010 baseline is about 0 82 kg co2eq kt 1 which can be reduced to 0 63 kg co2eq kt 1 under the min emissions scenario it remains highest at 0 74 kg co2eq kt 1 in the max npv scenario fig 5 the max prod scenario has a slightly higher emission intensity 0 65 kg co2eq kt 1 than the min emissions scenario fig 5 in general maize all seasons and pulses showed highest gains in crop area and production over the baseline the max prod and the max npv scenario are resulting in the same level of emission intensities fig 6 until 2050s however the production gap for these scenarios is 0 5 mt and 5 7 mt at the 2020s and the 2050s respectively this shows that for attaining food security at the state level while keeping emission intensity same the crop technology portfolio of the max prod is the best suited emission intensities after 2050s increase slightly as a result of stabilized production profiles fig 5 the trade off analysis shows several possibilities of the crop technology portfolios depending on the system level objectives distinct variation was observed in the crop and technology portfolios at the land unit scale 3 6 sensitivity to rate of land use change a limited sensitivity analysis was carried out looking at variations in production growth crop technology configurations and costs with the maximum annual rate of area undergoing land use change in each year this was implemented by applying scalar multipliers to eq 8 rates of annual land use change were varied in the range 50 300 kha yr 1 around the baseline assumption of 250 kha yr 1 as the rate of land use change is increased from an initial low level we can identify priorities by the stage at which they enter the portfolio sensitivity to the rate can be considered an approximate sensitivity to the level of investment fig 7 demonstrates sensitivity of technology investment for the period 2010 20 as a function of the allowed rate of land use change for the local marginal configuration priorities can be inferred both from the absolute level and gradient of investment observed at each rate moderate intensification is a clear priority at lower rates whilst improved rainfed technologies become increasingly important as the rate of land use change increases 4 discussion 4 1 spatial and temporal prioritization of csa technologies the csap toolkit tested and evaluated here can identify location specific technological options and prioritize them for climate change adaptation in agriculture a range of csa technologies are prioritized based on crop and cropping systems resource availability and current future climatic conditions the csap toolkit s potential of identifying adaptation domains and establishment of out scaling potential for a range of technological options serves multiple objectives of climate change adaptation and mitigation in agriculture location and time period specific technological options provided by this toolkit can help development actors to decide which options to promote where and when results show that this toolkit can conduct an ex ante impact assessment of with without adaptation under current and future climate scenarios which is very important to avoid maladaptation of any csa technology by coupling with future scenario the toolkit can identify suitable options that can avoid maladaptation potentially leading to decisions that are informed by csap outputs this csap contributes to growing literature on climate change adaptation and mitigation planning through data based modelling approach 4 2 investment prioritization on csa a combination of biophysical social and economic indicators used for prioritization of csa options allow key stakeholders to assess technologies against various end users goals andrieu et al 2017 campbell et al 2016 national adaptation plan nap and intended nationally determined contributions indc of developing countries emphasise the importance of decision support tools in targeting adaptation investments identifying which interventions to choose from a portfolio that includes weather insurance groundwater management inter cropping and community managed seed banks among many others requires time and careful analysis by policymakers the csap toolkit can generate this information for policymakers that substantially can increase their ability to make better decisions under existing and future uncertainties our test and evaluation of csap in bihar india show that this toolkit provides enough information such as type and level of technology use in different crops and total food production under various portfolios of csa options in different time period this information can be used for prioritizing csa investment for particular location and crop cropping system e g shirsath et al 2017 we estimated technology input and output values based on available price information and discount factor for different period of time the resulting analysis provides information about investment requirement on particular portfolio of csa options to achieve target level of production under baseline and future scenarios the toolkit provides enough information to prioritize investment for the short term 2020 while locating those priorities within a medium 2050 and long term 2080 agricultural growth pathway results show that investment requirement for adaptation to climate change is rapidly increasing over the time for instance investment in adaptation activities has increased from 33 0 in 2050 to 46 2 in 2080 compared to baseline however change in total production is marginal between 2050 and 2080 this change in total production for adaptation scenario over baseline in 2050 is about 11 2 and same change in 2080 is 12 4 4 3 adaptation benefits this toolkit incorporates dynamic investment constraints to assess the impact of particular crop technology activities at different farm size and rate of land use change the accessibility of various farm size categories to specific technologies is determined by their investment capacity results indicate that economy of scale in csa technology implementation can be achieved when farm size no longer plays a role in limiting technology adoption similarly land use change applied in the toolkit accounts large transaction cost for shifting in crop production with new technologies the changes in the total crop area allocation results in change in the effective returns to unit land use change under climate impacts period on period yield changes under climate scenario rcp 8 5 are 28 7 and 10 for the periods 2010 2020 vs baseline 2020 2050 and 2050 2080 respectively over the previous time however there are less significant impacts for some other scenarios explored rcp 6 0 reporting only 1 3 and 1 for the same period to period shifts yield gains diminish towards the end of the century under the current available technologies with surplus production potential exhausted and the onset of significant climate change returns to the final stage of investment on remaining rainfed land fail to maintain yield levels the system has a deficit of adaptive capacity in terms of resources and technologies available to it this indicates that a transformational adaptation is required over time to achieve more benefits from csa this toolkit has also provided results of trade off analysis between investment requirement for different crop technology portfolios and return to investment high level of technology intervention i e more climate smart technologies for adaptation to climate change require more investment however net return increases at high level of csa intervention due to a significant improvement in production both in current and future climate 4 4 scope and limitations of the csap toolkit the development of dynamic models such as that demonstrated here provide valuable tools by integrating climate change forecasts socio economic datasets and biophysical models into the design of wider sectoral growth pathways the toolkit presented here can also be used to design growth pathways with due emphasis on ecological services the toolkit has capabilities understand the effects of agricultural production systems on environment through analysis of ghg emissions from agriculture and resources use efficiencies of inputs applied on the other hand it also factors in the effects of the changes in the environmental systems on the agricultural production through detailed bio physical modelling for example the toolkit can be used to understand the water energy emissions and food nexus in agro ecological systems wherein these components are fully interconnected and cannot be treated separately which will otherwise lead to undesired effects on the other application of one such modelling framework for agricultural production in arizona is demonstrated using similar modelling framework by berardy and chester 2017 the toolkit presented here treats the agro ecological systems in holistic manner wherein we can maximize the synergies and minimize the trade offs through multi objective optimization the analysis using csap toolkit considers biophysical socio economic and climatic factors and scenarios as it s a bottom up approach the analysis often starts from smallest homogeneous parcels called land units getting the datasets at land unit scale remains the most critical issue the methods techniques and analysis using csap toolkit poses challenges in data scarce conditions the csap modular framework and database creation methodology currently works in decoupled fashion this means the location specific peculiarities can be addressed but the changes need to be translated manually in model indexing and databases further our analysis of adaptation was also constrained by our model of climate change impacts we only considered crop specific impacts on average yields we did not consider i technology specific climate impacts wherein technologies could be differentiated based on the sensitivity of their yields to the forecast climate change or ii crop and technology specific yield variability in the short term as a function of underlying drought and flood year likelihood the modelling framework outlined here is however capable of handling both these forms of crop and technology differentiation 5 conclusions the objective of developing this toolkit was to provide a relatively simple and quantitative framework for prioritization of climate smart interventions using detailed biophysical and socioeconomic datasets at subnational and local level in its current formulation csap is flexible in its capability to model agricultural production at a wide range of spatial and temporal scales this work develops a dynamic spatially explicit optimization model to explore a range of agricultural growth pathways coupled with climate adaptation strategies integrating detailed bottom up biophysical climate impact and agricultural emissions models this tool is capable of supporting multi objective analysis of agricultural production in relation to food self sufficiency incomes and mitigation targets csap supports climate proof agricultural development by providing a means for carrying out detailed scenario analysis in the context of climate adaptation providing valuable bottom up evidence to support top down estimates of the costs of climate change adaptation the csap toolkit allows the user to identify robust decisions under a set of uncertain circumstances it is then possible to carry out trade off analysis of alternative climate smart agriculture development pathways based on the dynamic pathways the toolkit can support decisions on which crops to cultivate which climate smart agricultural technologies and practices to invest in where to target that investment and when those investments should be made the toolkit prioritises investment decisions for the short term e g to 2020 while locating those priorities within a medium 2050 and long term 2080 agricultural growth pathway the trade off analysis showed several possibilities for the crop technology portfolios depending on the system level objective the tool constrains the adaptation options to a limited set of viable alternatives and provides the critical trade off information required to support the prioritization decision for bihar the csap results show that investment requirement for adaptation to climate change is rapidly increasing over the time for instance investment in adaptation activities has increased from 33 0 in 2050 to 46 2 in 2080 compared to baseline most importantly csap can bring analytical rigor in the planning process and in solving developmental problems in particular supporting developing countries in their preparation of national adaptation programmes of action napa and nationally appropriate mitigation actions namas under the unfccc framework the csap toolkit has the capability to generate information for policymakers which may help them to make better decisions even under existing and future uncertainties the methods techniques and analysis using csap toolkit poses challenges in data scarce conditions besides the csap modular framework and database creation methodology currently works in decoupled fashion the development of generic software with dynamic feedback loops to the databases and scenario analysis within a single framework is a goal of future research acknowledgments we acknowledge the cgiar fund council australia aciar irish aid european union international fund for agricultural development ifad netherlands new zealand switzerland uk usaid and thailand for funding to the cgiar research program on climate change agriculture and food security ccafs appendix a supplementary data supplementary material related to this article can be found in the online version at doi https doi org 10 1016 j ecolmodel 2018 04 008 appendix a supplementary data the following is supplementary data to this article 
25281,we discuss the use of optimal control theory to determine the most cost effective management strategies for insect pests we use a stage structured linear population projection model where the modeled control action increases the mortality in one of the stage classes we illustrate the method by using a published model for the root weevil diaprepes abbreviatus an invasive insect species having a substantial negative impact on citrus trees in regions such as florida and california in the united states here control corresponds to the application of inundative biological control agents entomopathogenic nematodes as biopesticides which increases the mortality of the larval stage our approach determines levels and timing of control to minimize the economic loss caused by d abbreviatus we use two numerical methods to approximate the optimal control and compare their effectiveness keywords population management optimal control invasive species discrete time system diaprepes abbreviatus 1 introduction insect pests cause considerable economic loss to agriculture worldwide this economic loss consists of reduced harvest and the cost of applying pesticide or biological control the costs of pest control has been steadily increasing for instance from 2008 2012 the insecticide expenditure for producers increased worldwide from 12 5 to 16 billion us dollars and in the usa from 22 to 25 million us dollars atwood and paisley jones 2017 further pesticide usage incurs indirect environmental and economic costs associated with the recommended application of pesticides these indirect costs include pesticide poisonings and illnesses of humans domestic animals and negative impact on beneficial animals pimentel and burgess 2014 in most cases the extensive use of pesticides also leads to the evolution of pesticide resistance which often necessitates an increase in insecticide application as a response to these challenges some producers turn to using biological control methods including the release of natural enemies of the pest insects such as predators parasitoids or pathogens ehler 1998 pell et al 2010 seastedt 2014 establishing a sufficiently high population of natural enemies can be challenging because of negative effects of disturbances caused by agronomic interventions such as tilling and the general low quality and diversity of agricultural landscapes however natural enemies can still be effective if they temporarily reach high numbers via augmentations in this case they function more like a pesticide that persists in the environment for a limited amount of time without any of the negative effects of chemical pesticides in this paper we present a mathematical framework for designing a management strategy that maximizes the profit for producers by using pest control strategies most effectively we apply our framework to the management of the economically important citrus fruit insect pest diaprepes abbreviates commonly referred to as diaprepes root weevils drw grafton cardwell 2004 drw is a long lived invasive insect species which is native to the caribbean it has been established in florida and california grafton cardwell 2004 jetter and godfrey 2009 jetter and godfrey 2009 this insect species has four distinct life history stages eggs larva pupae and adults of which the larvae are the by far most damaging stage one promising strategy for targeting the larva stage is the application of commercially available entomopathogenic nematodes for inundative biological control i e as biopesticides shapiro ilan et al 2002 bullock et al 1999 entomopathogenic nematodes are parasites of insects that kill the infected host usually within 24 48 h they can be applied with most horticultural equipment including pressurized sprayers mist blowers and electrostatic sprayers and are used as biopesticide for a range of different pest insects georgis et al 2006 while there has been research on drw grafton cardwell 2004 jetter and godfrey 2009 jetter and godfrey 2009 to the authors knowledge this is the first use of optimal control theory to consider management options for drw specifically we explore the use of optimal control theory for pest management continuing a line of inquiry into optimal control in biological applications optimal control theory broadly refers to the area of mathematics and engineering where a control action is determined to achieve some desired dynamic behavior and minimize a prescribed cost functional in the context of pest management the desired dynamic behavior is a reduction in pest abundance whilst the cost functional models the combined cost of the loss of crop to pest and application of control the reader is referred to macki and strauss 2012 and filippov 1962 for more background on optimal control theory and to lenhart and workman 2007 for optimal control and its biological applications the papers hastings et al 2006 blackwood et al 2010 and lampert et al 2014 outline general models for invasive species specifically considering the invasive grass species spartina alterniflora the paper hastings et al 2006 utilizes linear programming while blackwood et al 2010 implements linear quadratic control with a spatially explicit model using dynamic programming the paper lampert et al 2014 incorporates endangered species into the model along with the invasive species the papers dabbs 2010 and whittle et al 2008 2007 each model invasive species and use discrete optimal control theory to analyze the systems in dabbs 2010 part of the population has a nonlinear growth function and they compare the impact of different choices of growth functions on the optimal control the paper whittle et al 2008 formulates a discrete time optimal control problem for gypsy moths adding a control linearly into the system where the control they are adding is also already naturally in the environment lastly whittle et al 2007 considers discrete optimal control problems for invasive plant species including budgetary constraints we propose a linear stage structured population model in discrete time representing a generalized life cycle of an insect species caswell 2001 and consider a control action that reduces survival of a single stage class for our model the control is incorporated into the state equations through a nonlinear function this type of control could apply to biopesticides like entomopathogenic nematodes or chemical insecticide applications using products affecting a single stage class for instance for species where the larval stage lives in the soil toxins may be sprayed on the surface and kill newly hatched larvae while burying into the soil shapiro ilan et al 2002 we consider two different types of control first we assume that each control action affects the insects for a single time step only second we consider control which persists but decays exponentially over time post application we define a cost functional to describe loss in harvest income from the pest plus the cost of applying the control we say that a control strategy is optimal if it minimizes the cost functional subject to the dynamics of the controlled pest population the optimal amount and timing of control application should balance the cost of the control with the cost of allowing the pest to reduce the harvest the resulting optimal control is likely to be time dependent for instance it might be best to start applying control when pest density is low and keep applying control over the entire season frequent control at low intensity alternatively it might be better to carry out a small number of control actions with high intensity and allow pest densities to build up between control actions optimal control techniques can help decide between competing control schemes even if the optimal control is difficult to apply we compare two different numerical search algorithms using matlab to solve the optimal control problem since finding the optimal controls analytically is typically intractable the forward backward sweep is a very efficient method for approximating optimal controls and relies on the pontryagin maximum principle pontryagin et al 1962 via a dynamical system called the adjoint system lenhart and workman 2007 chp 4 23 however we will see that this method breaks down if the control decays slowly over time in our second method we implement a standard matlab function called multistart which does not rely on the adjoint system but is much more computationally intensive with enough computational runs multistart produces a reasonable solution but is less accurate than forward backward sweep this paper is organized as follows in section 2 we formulate the optimal control problem for a model for a general insect species with control specify a cost function and establish the existence of solutions to the optimal control problems we illustrate our method with a case study on diaprepes abbreviatus drw grafton cardwell 2004 in section 3 we give numerical simulations of our drw case study we discuss our results and their significance in section 4 2 methods 2 1 model formulation we start this section with a matrix model for the dynamics of an invasive insect pest we model the pest in four distinct stage classes denoted by p 1 t p 2 t p 3 t and p 4 t at time step t here the time variable t ℤ 0 1 2 denotes how many time steps have passed we denote the four dimensional vector with these stages by p t p 1 t p 2 t p 3 t p 4 t t ℤ where the superscript t denotes vector transposition all of the models we consider are local in the sense that there is no explicit spatial dependence or variation only temporal for the applications we have in mind the stage classes shall denote the abundance of the four distinct developmental stages eggs larvae pupae and adults the associated population projection matrix is the 4 4 matrix a γ 1 0 0 θ 1 γ 2 ζ 1 0 0 0 ζ 2 ν 1 0 0 0 ν 2 θ 2 where θ j γ j ν j and ζ j are nonnegative parameters for j 1 2 the descriptions for the matrix a parameters are in table 2 1 we assume that a scalar control denoted by n t is applied at each time step we consider the situation where the control is applied to only one stage class here we choose the second stage class p 2 but it can be applied to any stage to capture saturation effects reflecting diminishing returns for large control efforts we assume that the control efficacy is given by f n t for a given function f ℝ ℝ we typically assume that f is nonincreasing the dynamics of the pest with control are described by 2 1 p t 1 a n t p t p 0 p 0 t ℤ where a n t γ 1 0 f n t 0 θ 1 γ 2 ζ 1 f n t 0 0 0 ζ 2 f n t ν 1 0 0 0 f n t ν 2 θ 2 and p 0 ϕ 1 ϕ 2 ϕ 3 ϕ 4 denote the nonlinear projection matrix and initial population respectively note that the model counts the transitions from one population census to the next where we count immediately after birth hence the model assumes that the control does not impact the transition from p 1 to p 2 fig 2 1 depicts the model dynamics in eq 2 1 we comment that the model 2 1 and the approach we take generalizes to higher but finite numbers of stage classes specifically for n ℤ p can be replaced by p 1 t p 2 t p n t t ℤ and a can be replaced by the n n matrix γ 1 1 0 0 γ 1 n γ 2 1 γ 1 2 0 0 0 γ 1 n 2 γ 1 n 1 0 0 0 γ 2 n 1 γ 2 n where γ j i are nonnegative parameters for i 1 2 n and j 1 2 similarly the controlled dynamics a n t can be extended to the to n stage classes in the obvious way 2 2 cost functional in order to formulate an optimal control problem we construct a cost functional with two contributing terms for each time step the loss in profit owing to insect related crop damage and the cost of purchasing and applying control we use the quadratic term β 1 p 2 t 2 to model the cost of pest damage during time step t which is a commonly used term in optimal control problems see lenhart and workman 2007 chp 2 where β 1 weights the relative importance of the pest damage such a quadratic term heavily penalizes catastrophic loss for instance in a situation where farmers grow valuable perennial plants such as fruit trees and plant death caused by high pest density would add significant extra costs such as the cost of planting new plants and lost income due to a delay in harvest of several years we use the linear term β 2 n t to model the cost of purchasing and applying the control agent n t at time step t where β 2 is the price of a single control unit in the absence of other information about this cost such a linear term seems reasonable the total cost in the t th time step is then given by β 1 p 2 t 2 β 2 n t finally we fix t ℤ which denotes the time window over which the optimal control problems are solved given a sequence of t control actions n 0 n t 1 and resulting states p t given by 2 1 we define the cost functional j by 2 2 j n t 0 t 1 β 1 p 2 t 2 β 2 n t we are now in position to formulate two optimal control problems 2 3 optimal control problem model 1 control lasts one time step the first optimal control problem we consider in this paper which we call model 1 is to minimize j n given by 2 2 subject to 2 1 over all nonnegative control functions 2 3 n n n t 0 n t for t 0 1 t 1 2 4 optimal control problem model 2 control decays exponentially in model 1 the control n t j is assumed to be only active on t j t j 1 however biological control agents may persist for some time in the environment and will remain efficacious especially when the time step is short for instance a day or a week instead of a season to account for this decay we augment n with its own dynamics we let n n t denote the new control action at time step t and n o denote remains of control actions from previous time steps the second optimal control problem which we call model 2 is minimize j given by 2 2 now subject to the dynamics 2 4 n o t 1 n o t e μ n n t n o 0 0 p t 1 a n o t e μ n n t p t p 0 p 0 t ℤ and the cost constraint 2 3 for n n namely n n n in model 2 we assume that the biological control agents decay exponentially with rate μ leading to the first dynamic equation in 2 4 note that model 2 resembles model 1 for large μ meaning that the control agents persist for a short time the existence of optimal controls for models 1 and 2 is given in the following theorem a proof of uniqueness of these solutions is more complicated due to the nonlinearity in the control and is not addressed in this paper we will state and prove the theorem for model 2 since the proof for model 1 is identical theorem 1 for all initial conditions p 0 ℝ 4 there is a control n n which minimizes j subject to 2 4 proof there exists an n max such that β 2 n max j 0 if n t n max for any t j n j 0 where 0 denotes the function that is identically equal to zero hence the minimum of j over n is the same as the minimum of j over n max n t 0 n t n max let t n max ℝ t ℝ 4 t be defined by t n ij p i j for all i 1 2 3 4 and j 0 1 t 1 where p i j is the ith component of p j the solution of 2 4 at time step j then from 2 4 it follows that t is continuous with any choice of norms for n max and ℝ 4 t hence j is continuous from n max to ℝ since n max is a compact subset of ℝ t j takes on a global minimum at some n n max n 2 5 case study diaprepes abbreviatus as a motivating and potentially economically important example we consider the insect pest species d abbreviates commonly called diaprepes root weevils drw drw originated in the caribbean and was transported to the central and southern regions of florida around 1964 grafton cardwell 2004 the introduction of drw was not intentional and in the past 50 years drw has become a troublesome invasive species spreading throughout florida and eventually to california in 2005 grafton cardwell 2004 jetter and godfrey 2009 jetter and godfrey 2009 drw infests citrus groves along with other plants mccoy et al 2000 adult drw feed and lay eggs on plants upon hatching neonate larvae drop off the leaves and bury into the soil where they feed on plant roots for several months until they pupate the damage caused by the feeding activity of the larvae can be severe causing tree decline and death drw dynamics have been described in a matrix model in miller and tenhumberg miller and tenhumberg 2010 in the past halogenated hydrocarbon insecticides were applied to the soil to control drw populations this class of insecticide was deregistered in 1984 mundy et al 2010 and since then there has been a lack in pesticides that adequately manage the drw larva campos herrera et al 2015 an alternative to pesticides is the usage of inundative biological control agents such as entomopathogenic nematodes attacking drw larvae shapiro ilan et al 2002 bullock et al 1999 nematodes are utilized like pesticides requiring regular applications campos herrera et al 2015 we explore two different scenarios the first scenario assumes that nematodes cannot persist and their life expectancy is only approximately one week addis et al 2016 see model 1 in section 2 3 the second scenario assumes nematode populations decline exponentially see model 2 in section 2 4 we determine management plans for both scenarios specifying timing and amount of nematodes applications while also considering the cost of applying nematodes and the cost of drw damage to the farmer 2 5 1 drw parameter values to use the framework of models 1 and 2 we reduced the 6 6 population projection matrix from miller and tenhumberg 2010 for drw to a 4 4 matrix using hooley s algorithm salguero gomez and plotkin 2010 the four stage classes of the matrix denote eggs p 1 larva p 2 pupa p 3 and adults p 4 and the time steps denote weeks with parameter values in table 2 1 scaled accordingly the resulting projection matrix is given by a γ 1 0 0 θ 1 γ 2 ζ 1 0 0 0 ζ 2 ν 1 0 0 0 ν 2 θ 2 0 305 0 0 80 447 0 530 0 899 0 0 0 0 020 0 778 0 0 0 0 202 0 980 hooley s algorithm guarantees that the dominant eigenvalue 1 423 of the reduced matrix a is the same as that of the original matrix miller and tenhumberg 2010 since the dominant eigenvalue is greater than 1 the model predicts growth of the uncontrolled population interpretations of the above parameter values along with all other parameter values arising in the optimal control problems are presented in table 2 1 the choice of optimal control depends on the distribution of the initial population among stages classes and its size captured by some norm of the initial population p 0 we choose the stable stage distribution ssd as an initial distribution to minimize the effect of transient dynamics on our control the ssd is a multiple of the normalized eigenvector associated with the dominant eigenvalue of a population projection matrix we then scaled the ssd by different constants to explore the effect of different initial drw population sizes starting with the ssd is relevant to a situation where the pest species has persisted in an orchard for several years without adding any control because drw escaped detection founder populations are typically small and for several generations they may remain sufficiently small to cause no notable damage even if the population grows at a constant rate hence it is plausible that populations are at the ssd before farmers apply control measures although the methods we propose are applicable for any p 0 2 5 2 the saturation function f as mentioned above we will model the application of entomopathogenic nematodes where the amount of control at time t is denoted by n t and n n t in models 1 and 2 respectively the control is applied only to the second stage class p 2 and relies on control agent host interactions we assume that the control agent host encounters follow a poisson distribution so we use the saturation function f n e αn where α denotes the control search application efficiency which accounts for how likely a control agent is to encounter a pest larva we could not find an estimate of α in the literature therefore we made the assumption that the recommended number of nematodes per hectare n n s 22 108 per hectare shapiro ilan et al 2002 results in population stasis and iteratively searched for α values that produced a slightly increasing population density this would likely be an underestimation of α conservative estimate for the effacing of the nematodes so we explore the control strategies using a range of α values when α 1 655 10 8 and n n s the population projection matrix has a dominant eigenvalue of 1 000005 meaning the model 2 1 predicts that the drw population growth very slowly this choice of α predicts that the recommended dose according to the manufacture specifications is not sufficient to produce population decline hence we would expect that our model predicts higher than recommended nematode applications by using an α value that is slightly too low our management recommendation has a safety net built in since the control might still work if nematode efficiency is low owing to poor environmental conditions owing to the uncertainty in the choice of α we will vary the parameter to evaluate its effect on the total cost of the system in numerical simulations 2 5 3 parameter values for the cost function in the literature we could not find an estimate for β 1 which specifies how much damage a single drw larvae causes in terms of loss in harvest to ensure that our choice for β 1 is sensible we compare the first part of our cost functional with natural densities of drw larvae and the average income of farmers from selling citrus fruits shapiro ilan et al 2002 mccoy et al 2003 one study reported drw larvae densities in florida of 376 25 per m2 in non irrigated orchards and 945 51 per m2 in irrigated orchards mccoy et al 2003 but the study did not report on the associated harvest in fig 2 2 the vertical lines are these numbers scaled for drw larvae per hectare further in 1999 farmers made on average us 6000 per hectare for citrus shapiro ilan et al 2002 according to the federal reserve bank of minneapolis the annual average consumer price index was 166 6 in 1999 and is 244 3 in 2017 consumer price index 1913 indicating an inflation of 46 6 appelbaum 2004 hence in 2017 the expected weekly income of a citrus farmer in florida is us 170 us 6000 1 466 52 horizontal line in fig 2 2 our choice of β 1 implies that at a drw larvae population of 4 62381 106 produces zero income for the farmer in this paper we also varied β 1 up and down by 15 thick and thin solid lines in fig 2 2 all three values for β 1 are conservative estimates of the impact of drw larvae on citrus harvest applying our method to a real world management situation would require improved estimates for β 1 at the time of this writing a batch of nematodes that is recommended by industry to control drw can be purchased for 62 per hectare shapiro ilan et al 2002 additionally it is recommended to use 22 nematodes per cm2 shapiro ilan et al 2002 to find the value of β 2 we combined these values and scaled the value for a hectare and a single nematode note that while we have configured the cost to be per one nematode typically nematodes are purchased in bulk therefore we will again vary the value of β 2 in simulations for the optimal control problem all parameter values are shown in table 2 1 3 results in theorem 1 we established that optimal controls exist for models 1 and 2 to identify these optimal controls we use an the extension of pontryagin maximum principle sethi and thompson 2006 for the original principle see pontryagin et al 1962 suppose that n is an optimal control for model 1 let p 2 be the second component of the solution p of 2 1 when subject to the optimal control n the following is referred to as the adjoint system for 2 1 3 1 λ 1 t λ 1 t 1 γ 1 λ 2 t 1 γ 2 λ 2 t 2 β 1 p 2 t λ 2 t 1 ζ 1 e α n t λ 3 t 1 ζ 2 e α n t λ 3 t λ 3 t 1 ν 1 λ 4 t 1 ν 2 λ 4 t λ 1 t 1 θ 1 λ 4 t 1 θ 2 λ 1 t 0 λ 2 t 0 λ 3 t 0 λ 4 t 0 t 0 1 t 1 the adjoint variables λ 1 λ 2 λ 3 and λ 4 perform a function similar to that of lagrange multipliers a necessary condition for n to be a solution of the optimal control problem for model 1 see seierstad and sydsaeter 1986 chp 2 is that n t n t p t λ 1 t λ 2 t λ 3 t and λ 4 t solve 2 1 3 1 and 3 2 n t 0 if β 2 α ξ t 1 α ln α β 2 ξ t if β 2 α ξ t where ξ t ζ 1 λ 2 t 1 p 2 t ζ 2 λ 3 t 1 p 2 t if we can solve 2 1 3 1 and 3 2 then the solution will be an optimal control lenhart and workman 2007 chps 1 23 for model 2 we again use the extension of pontryagin maximum principle suppose that n n is an optimal control for model 2 let p 2 be the second component of the solution p and n o the solution n o of 2 4 when subject to the optimal control n n the following is referred to as the adjoint system for 2 4 3 3 λ 1 t λ 1 t 1 γ 1 λ 2 t 1 γ 2 λ 2 t 2 β 1 p 2 t λ 2 t 1 ζ 1 e α n o t e μ n n t λ 3 t 1 ζ 2 e α n o t e μ n n t λ 3 t λ 3 t 1 ν 1 λ 4 t 1 ν 2 λ 4 t λ 1 t 1 θ 1 λ 4 t 1 θ 2 λ o t α ζ 1 e μ λ 2 t 1 e α n o t e μ n n t p 2 t α ζ 2 e μ λ 3 t 1 e α n o t e μ n n t p 2 t λ o t 1 e μ λ 1 t 0 λ 2 t 0 λ 3 t 0 λ 4 t 0 λ o t 0 t 0 1 t 1 a necessary condition for n n to be a solution of the optimal control problem for model 2 is that n t n t p t λ 1 t λ 2 t λ 3 t and λ 4 t solve 2 4 3 3 and 3 4 n n t 0 if e α n o t e μ ξ n t 1 α ln ξ n t n o t e μ if e α n o t e μ ξ n t with ξ n t α p 2 t λ 2 t 1 ζ 1 λ 3 t 1 ζ 2 β 2 λ o t 1 if we can solve 2 4 3 3 and 3 4 then the solution will be an optimal control as mentioned above we have not established uniqueness however as we will see in the numerical results in section 3 1 there is no indication that the optimal controls are non unique 3 1 numerical simulations for drw we cannot explicitly solve the systems 2 1 3 1 3 2 or 2 4 3 3 3 4 analytically so we use numerical simulations with the drw parameter values from table 2 1 for the numerical simulations we used two different methods in matlab forward backward sweep fbs and multistart which will be described in sections 3 1 1 and 3 1 4 respectively 3 1 1 forward backward sweep fbs forward backward sweep fbs is an algorithm typically used to find an estimate for the solution to an optimal control problem lenhart and workman 2007 chp 4 23 the algorithm takes an estimate for the control and calculates the associated state system and adjoint system then with the new state and adjoint systems the algorithm calculates the control next the algorithm checks if the difference between the new values and the previous values are smaller than a chosen acceptable error value once the difference between estimates is acceptable the algorithm stops and outputs the last control values we will use the following process 1 let n 0 and use 2 1 or 2 4 to calculate p and n o from initial conditions 2 now calculate λ 1 λ 2 λ 3 λ 4 λ o using 3 1 or 3 3 3 using the calculations in 1 and 2 find n 4 check if the differences between the newly calculated p n o λ s and n for s 1 2 3 4 o are within an acceptable error if so stop since you have an acceptable estimate for the optimal control if not use the n in step 3 and repeat the process 3 1 2 model 1 we varied the initial population of drw in the fbs method for model 1 to see how the optimal application of nematodes and corresponding drw larvae population depend on this initial population see fig 3 1 as expected the larger the initial pest density the larger the number of nematodes in the optimal control but interestingly the resulting drw larval density obtained with the optimal control also increases in other words if initial pest density is high it is not optimal to get pest density as low as when initial pest density is low this is different from the automatic spray schedule used by farmers with the optimal control problem we are considering how to minimize the total combined cost possibly applying control for each time step in section 2 5 2 we gave a conservative value for search efficiency α since this parameter is highly uncertain we ran numerical simulations with a range of different α values we also explored the effect of varying the parameter values for β 1 and β 2 from section 2 5 3 we varied the three parameters assuming the initial population is 1 7 106 drw per hectare the results are displayed in fig 3 2 we fitted the simulation results to linear functions the least square regression lines explain 99 of the variation the results show that the total costs increase with increasing β 1 and β 2 and the total costs decrease with increasing α 3 1 3 model 2 while the fbs is a useful algorithm for many problems there are circumstances that cause the algorithm to not converge de araujo et al 2010 in our model 2 optimal control problem for many choices of μ fbs cannot be used to find the optimal number of nematodes to apply in fact in many simulations the algorithm gives a zero control which is not close to optimal this can be explained as follows looking at 3 4 for nematodes n n 3 5 n n t 0 if e α n o t e μ α p 2 t λ 2 t 1 ζ 1 λ 3 t 1 ζ 2 β 2 λ o t 1 1 α ln α p 2 t λ 2 t 1 ζ 1 λ 3 t 1 ζ 2 β 2 λ o t 1 n o t e μ if e α n o t e μ α p 2 t λ 2 t 1 ζ 1 λ 3 t 1 ζ 2 β 2 λ o t 1 in order for 3 5 to predict a non zero optimal control that is n n t 0 it is necessary that that 3 6 e α n o t e μ α p 2 t λ 2 t 1 ζ 1 λ 3 t 1 ζ 2 β 2 λ o t 1 the larger μ is the easier it is to satisfy 3 6 as the left hand side decreases with increasing μ we know that 1 e α n o t e μ since n o t e μ 0 so α p 2 t λ 2 t 1 ζ 1 λ 3 t 1 ζ 2 β 2 λ o t 1 will need to be positive we have that αp 2 t λ 2 t 1 ζ 1 λ 3 t 1 ζ 2 0 we also need to consider β 2 λ o t 1 recall that λ o t α ζ 1 e μ λ 2 t 1 e α n o t e μ n n t p 2 t α ζ 2 e μ λ 3 t 1 e α n o t e μ n n t p 2 t λ o t 1 e μ since λ o t 0 λ o t 0 for all t which means for β 2 λ o t 1 to be positive we need that β 2 λ o t 1 as β 2 is a positive constant in our case study β 2 2 8182 10 8 when 0 μ 1 it is not likely that β 2 λ o t 1 so the result of fbs is always n n t 0 or does not converge fig 3 3 shows the effect on the fbs solution of varying μ for an initial drw population of 1 1 106 per hectare note that for small values of μ the fbs produces a solution that is all zeros or starts with zeros when μ is small more of the nematodes survive a week but the fbs solution is instructing us to never apply nematodes or wait until much later into the application period meanwhile for larger values the optimal control is similar to that for model 1 from this we see that fbs is not a reliable method for solving the optimal control problem when μ is small we will see that we can often obtain a lower total cost with an estimate of the control that is based on a different numerical method 3 1 4 multistart the multistart ms algorithm is a standard matlab function which implements the fmincon function from matlab the fmincon function searches for a local minimum near a user defined starting value for the algorithm we input the dynamical system objective functional and parameter values unlike fbs this algorithm does not use the adjoint equations to find the global minimum multistart uses many randomly generated points as starting control values and picks the strategy associated with the lowest local minimum the results we display use 500 000 randomly chosen points we used matlab 2013b in fig 3 4 we compare multistart to fbs for μ ln 2 with model 2 a value which caused the fbs algorithm to no longer converge we can see the fbs algorithm nematode application is zero except for one large value and the resulting total cost in dollars is 3 55 1012 with a general exponential growth of drw larvae meanwhile multistart produces a more constant application management plan and has a total cost of 1 01 102 with far fewer drw larvae surviving to evaluate how accurately multistart can solve the optimal control problem we compared multistart to fbs for model 1 for two different initial drw densities see fig 3 5 for an initial drw population of 2 105 per hectare the total cost using fbs is 287 35 and 300 47 with multistart when we use an initial drw population of 1 7 106 per hectare the fbs total cost is 1012 16 and the multistart total cost is 1047 23 as we increased the number of runs with multistart the difference between the methods total costs decreased the comparison between multistart and fbs shows that the solution using multistart is satisfactory for many purposes we can also note that the multistart results have some fluctuation which is due to the algorithm searching a large number of values for a solution as we increase the number of runs the multistart results have fewer oscillations but the run time increases in the remainder of the paper we apply the multistart algorithm for model 2 and for brevity we refer to the result provided by multistart as optimal nematode application strategy even though the result is not truly optimal we explore the effect of changing the initial drw population for μ ln 2 see fig 3 6 note from about weeks 6 42 the simulations are seemingly converging to a constant amount of nematodes to apply each week with the larger initial drw population there are more erratic variations in the solution which reduce with more runs in multistart in fig 3 7 we plot the optimal number of nematodes to apply when varying values for μ with initial drw populations of 2 105 and 1 1 106 per hectare note that as expected the longer a released nematode population persists the fewer nematodes are needed for controlling drw also as in model 1 we need to apply more nematodes if the initial drw infestation is high we noted the apparent convergence of nematode application to a constant in fig 3 6 thus it seems plausible that a constant control application will be effective constant application amounts would be appealing for farming applications we choose a constant control which best fits in a least squares sense our estimate for the optimal control obtained using multistart additionally we ran the multistart algorithm for applying a constant amount of control n at each time step next we compared the effect of using the constant control fit constant control multistart and the original multistart estimate of the optimal control see fig 3 8 note that our original model 2 simulation produces the lowest total cost of 101 51 but there is not a drastic difference between the constant fit 107 21 and constant multistart of 105 82 in particular the percentage difference between the total cost of the original model 2 and constant fit is 5 62 and constant multistart is 4 25 4 discussion we have modeled the application of pesticide or biological control to regulate an insect pest as a mathematical optimal control problem in our discrete time model the uncontrolled pest population has linear dynamics and is stage structured the control acts on the second stage by reducing survival as a function of applied control effort and saturates at high density of the control agent because survival cannot be reduced below 0 the cost is quadratic in the pest abundance and linear in the control term we considered two cases first where the control is effective over only one time step model 1 and second where the effect of the control decays exponentially over time model 2 the solution of the optimal control problem balances the costs of management with the costs of loss of crops giving an amount of control to apply each time period in order to minimize the total cost for a specific example we manage d abbreviatus using entomopathogenic nematodes as biopesticides obtaining numerical estimates of an optimal control by using fbs and multistart algorithms fbs is more accurate but the method breaks down when the control decay is too slow there are some facets of our model and approach that can be easily generalized and some facets that cannot the formula for the optimal control in terms of the adjoint equations made explicit use of the underlying linear model however the specific form of the permitted control function is fairly general as long as it saturates at 1 all individuals in the targeted stage die the control needs to act on only one stage class for the modeling here to work but which stage class is targeted for control and the functional form of the control is arbitrary we chose a quadratic functional form for the cost associated with the pest both because it heavily penalizes catastrophic loss and because it is mathematically convenient the cost of purchasing and applying control is linear in the control variable which seems a reasonable assumption in the absence of other information the numerical algorithm fbs is efficient and accurate for model 1 but has the disadvantage that it did not produce sensible results for certain parameter values when applied to model 2 we explained in section 3 1 3 how and why the method breaks down as an alternative to fbs we used multistart to find the optimal management strategy for model 2 to evaluate the performance of multistart we used this algorithm for model 1 as well and compared the results with those of fsb we found that the total cost using multistart was higher compared to fbs but the difference was small for instance for initial drw population of 2 105 per hectare the percentage difference was 4 5 and for initial drw population of 1 7 106 per hectare the percentage difference was 3 4 another disadvantage of using multistart is that it gives an optimal control which fluctuates more than we would expect e g fig 3 6 the results get smoother with increasing number of starting values included in multistart but this increases the total running time to find a solution alternatively we used the multistart algorithm to obtain the best constant control and compare this control to the non constant optimal control the cost effective target pest population size depended on the infestation level at which control was initiated if control started at low initial pest infestation levels the application of small amounts of control was sufficient to reduce pest populations to very low densities over the entire growing season in contrast if control started at relatively high drw population size the required amount of nematodes to control drw populations was high and it was not cost effective to reduce infestation to the same low levels as when control started earlier when population size was still small our result highlights how beneficial early pest detection is for citrus growers we explored how μ affects the total cost as expected the longer nematode populations persist in the environment the lower is the cost associated with the control for instance if half of the nematode populations survive each time step μ ln 2 and the initial drw population is 2 105 per hectare then the total cost of controlling drw populations is 101 this cost increases by 183 to 287 if nematode populations survive only a single time step model 1 this suggests that citrus growers would largely benefit from research on improving nematode population persistence after inundative release using fbs in model 1 suggests weekly nematode applications that initially increase over time and then decrease this is a typical result for optimal control since we are minimizing the total cost for the given time period so control declines near the end since the model doesn t have a cost for time greater than t one way to avoid this would be to expand the time frame over which we optimize e g 10 years instead of one year but only use the control for the shorter time frame using multistart the nematode application scheme is relatively constant over most of the growing season fig 3 5 the difference in cost is small e g 287 versus 300 for initial drw population size of 2 105 per hectare we conclude by highlighting a future avenue of research recent research by the present authors guiver et al 2016 has considered theoretical approaches to pest management which appeal to and develop further tools from robust control theory briefly robust control seeks to achieve desired dynamic behavior such as reducing pest population in the presence of uncertainty or perturbation of the model facets not addressed here the downside of robust control tools is that they sacrifice optimality in general thus we plan to compare and contrast the optimal approach adopted here with that of guiver et al 2016 and seek to design methods which incorporate both elements of robust and optimal control acknowledgements this work was partially funded by a multidisciplinary seed grant from the university of nebraska cje and rr were partially funded by nsf grant dms 1412598 cg and st were supported by the uk s epsrc grant number ep i019456 1 yj was supported by nsf grant dms 1411703 bt was supported by nsf grant deb 655117 and usda nifa grant 2017 03807 we are grateful to stephanie lloyd jim powell and suzanne lenhart for helpful discussions during the writing of the manuscript we would like to thank the two anonymous reviewers for their helpful comments 
25281,we discuss the use of optimal control theory to determine the most cost effective management strategies for insect pests we use a stage structured linear population projection model where the modeled control action increases the mortality in one of the stage classes we illustrate the method by using a published model for the root weevil diaprepes abbreviatus an invasive insect species having a substantial negative impact on citrus trees in regions such as florida and california in the united states here control corresponds to the application of inundative biological control agents entomopathogenic nematodes as biopesticides which increases the mortality of the larval stage our approach determines levels and timing of control to minimize the economic loss caused by d abbreviatus we use two numerical methods to approximate the optimal control and compare their effectiveness keywords population management optimal control invasive species discrete time system diaprepes abbreviatus 1 introduction insect pests cause considerable economic loss to agriculture worldwide this economic loss consists of reduced harvest and the cost of applying pesticide or biological control the costs of pest control has been steadily increasing for instance from 2008 2012 the insecticide expenditure for producers increased worldwide from 12 5 to 16 billion us dollars and in the usa from 22 to 25 million us dollars atwood and paisley jones 2017 further pesticide usage incurs indirect environmental and economic costs associated with the recommended application of pesticides these indirect costs include pesticide poisonings and illnesses of humans domestic animals and negative impact on beneficial animals pimentel and burgess 2014 in most cases the extensive use of pesticides also leads to the evolution of pesticide resistance which often necessitates an increase in insecticide application as a response to these challenges some producers turn to using biological control methods including the release of natural enemies of the pest insects such as predators parasitoids or pathogens ehler 1998 pell et al 2010 seastedt 2014 establishing a sufficiently high population of natural enemies can be challenging because of negative effects of disturbances caused by agronomic interventions such as tilling and the general low quality and diversity of agricultural landscapes however natural enemies can still be effective if they temporarily reach high numbers via augmentations in this case they function more like a pesticide that persists in the environment for a limited amount of time without any of the negative effects of chemical pesticides in this paper we present a mathematical framework for designing a management strategy that maximizes the profit for producers by using pest control strategies most effectively we apply our framework to the management of the economically important citrus fruit insect pest diaprepes abbreviates commonly referred to as diaprepes root weevils drw grafton cardwell 2004 drw is a long lived invasive insect species which is native to the caribbean it has been established in florida and california grafton cardwell 2004 jetter and godfrey 2009 jetter and godfrey 2009 this insect species has four distinct life history stages eggs larva pupae and adults of which the larvae are the by far most damaging stage one promising strategy for targeting the larva stage is the application of commercially available entomopathogenic nematodes for inundative biological control i e as biopesticides shapiro ilan et al 2002 bullock et al 1999 entomopathogenic nematodes are parasites of insects that kill the infected host usually within 24 48 h they can be applied with most horticultural equipment including pressurized sprayers mist blowers and electrostatic sprayers and are used as biopesticide for a range of different pest insects georgis et al 2006 while there has been research on drw grafton cardwell 2004 jetter and godfrey 2009 jetter and godfrey 2009 to the authors knowledge this is the first use of optimal control theory to consider management options for drw specifically we explore the use of optimal control theory for pest management continuing a line of inquiry into optimal control in biological applications optimal control theory broadly refers to the area of mathematics and engineering where a control action is determined to achieve some desired dynamic behavior and minimize a prescribed cost functional in the context of pest management the desired dynamic behavior is a reduction in pest abundance whilst the cost functional models the combined cost of the loss of crop to pest and application of control the reader is referred to macki and strauss 2012 and filippov 1962 for more background on optimal control theory and to lenhart and workman 2007 for optimal control and its biological applications the papers hastings et al 2006 blackwood et al 2010 and lampert et al 2014 outline general models for invasive species specifically considering the invasive grass species spartina alterniflora the paper hastings et al 2006 utilizes linear programming while blackwood et al 2010 implements linear quadratic control with a spatially explicit model using dynamic programming the paper lampert et al 2014 incorporates endangered species into the model along with the invasive species the papers dabbs 2010 and whittle et al 2008 2007 each model invasive species and use discrete optimal control theory to analyze the systems in dabbs 2010 part of the population has a nonlinear growth function and they compare the impact of different choices of growth functions on the optimal control the paper whittle et al 2008 formulates a discrete time optimal control problem for gypsy moths adding a control linearly into the system where the control they are adding is also already naturally in the environment lastly whittle et al 2007 considers discrete optimal control problems for invasive plant species including budgetary constraints we propose a linear stage structured population model in discrete time representing a generalized life cycle of an insect species caswell 2001 and consider a control action that reduces survival of a single stage class for our model the control is incorporated into the state equations through a nonlinear function this type of control could apply to biopesticides like entomopathogenic nematodes or chemical insecticide applications using products affecting a single stage class for instance for species where the larval stage lives in the soil toxins may be sprayed on the surface and kill newly hatched larvae while burying into the soil shapiro ilan et al 2002 we consider two different types of control first we assume that each control action affects the insects for a single time step only second we consider control which persists but decays exponentially over time post application we define a cost functional to describe loss in harvest income from the pest plus the cost of applying the control we say that a control strategy is optimal if it minimizes the cost functional subject to the dynamics of the controlled pest population the optimal amount and timing of control application should balance the cost of the control with the cost of allowing the pest to reduce the harvest the resulting optimal control is likely to be time dependent for instance it might be best to start applying control when pest density is low and keep applying control over the entire season frequent control at low intensity alternatively it might be better to carry out a small number of control actions with high intensity and allow pest densities to build up between control actions optimal control techniques can help decide between competing control schemes even if the optimal control is difficult to apply we compare two different numerical search algorithms using matlab to solve the optimal control problem since finding the optimal controls analytically is typically intractable the forward backward sweep is a very efficient method for approximating optimal controls and relies on the pontryagin maximum principle pontryagin et al 1962 via a dynamical system called the adjoint system lenhart and workman 2007 chp 4 23 however we will see that this method breaks down if the control decays slowly over time in our second method we implement a standard matlab function called multistart which does not rely on the adjoint system but is much more computationally intensive with enough computational runs multistart produces a reasonable solution but is less accurate than forward backward sweep this paper is organized as follows in section 2 we formulate the optimal control problem for a model for a general insect species with control specify a cost function and establish the existence of solutions to the optimal control problems we illustrate our method with a case study on diaprepes abbreviatus drw grafton cardwell 2004 in section 3 we give numerical simulations of our drw case study we discuss our results and their significance in section 4 2 methods 2 1 model formulation we start this section with a matrix model for the dynamics of an invasive insect pest we model the pest in four distinct stage classes denoted by p 1 t p 2 t p 3 t and p 4 t at time step t here the time variable t ℤ 0 1 2 denotes how many time steps have passed we denote the four dimensional vector with these stages by p t p 1 t p 2 t p 3 t p 4 t t ℤ where the superscript t denotes vector transposition all of the models we consider are local in the sense that there is no explicit spatial dependence or variation only temporal for the applications we have in mind the stage classes shall denote the abundance of the four distinct developmental stages eggs larvae pupae and adults the associated population projection matrix is the 4 4 matrix a γ 1 0 0 θ 1 γ 2 ζ 1 0 0 0 ζ 2 ν 1 0 0 0 ν 2 θ 2 where θ j γ j ν j and ζ j are nonnegative parameters for j 1 2 the descriptions for the matrix a parameters are in table 2 1 we assume that a scalar control denoted by n t is applied at each time step we consider the situation where the control is applied to only one stage class here we choose the second stage class p 2 but it can be applied to any stage to capture saturation effects reflecting diminishing returns for large control efforts we assume that the control efficacy is given by f n t for a given function f ℝ ℝ we typically assume that f is nonincreasing the dynamics of the pest with control are described by 2 1 p t 1 a n t p t p 0 p 0 t ℤ where a n t γ 1 0 f n t 0 θ 1 γ 2 ζ 1 f n t 0 0 0 ζ 2 f n t ν 1 0 0 0 f n t ν 2 θ 2 and p 0 ϕ 1 ϕ 2 ϕ 3 ϕ 4 denote the nonlinear projection matrix and initial population respectively note that the model counts the transitions from one population census to the next where we count immediately after birth hence the model assumes that the control does not impact the transition from p 1 to p 2 fig 2 1 depicts the model dynamics in eq 2 1 we comment that the model 2 1 and the approach we take generalizes to higher but finite numbers of stage classes specifically for n ℤ p can be replaced by p 1 t p 2 t p n t t ℤ and a can be replaced by the n n matrix γ 1 1 0 0 γ 1 n γ 2 1 γ 1 2 0 0 0 γ 1 n 2 γ 1 n 1 0 0 0 γ 2 n 1 γ 2 n where γ j i are nonnegative parameters for i 1 2 n and j 1 2 similarly the controlled dynamics a n t can be extended to the to n stage classes in the obvious way 2 2 cost functional in order to formulate an optimal control problem we construct a cost functional with two contributing terms for each time step the loss in profit owing to insect related crop damage and the cost of purchasing and applying control we use the quadratic term β 1 p 2 t 2 to model the cost of pest damage during time step t which is a commonly used term in optimal control problems see lenhart and workman 2007 chp 2 where β 1 weights the relative importance of the pest damage such a quadratic term heavily penalizes catastrophic loss for instance in a situation where farmers grow valuable perennial plants such as fruit trees and plant death caused by high pest density would add significant extra costs such as the cost of planting new plants and lost income due to a delay in harvest of several years we use the linear term β 2 n t to model the cost of purchasing and applying the control agent n t at time step t where β 2 is the price of a single control unit in the absence of other information about this cost such a linear term seems reasonable the total cost in the t th time step is then given by β 1 p 2 t 2 β 2 n t finally we fix t ℤ which denotes the time window over which the optimal control problems are solved given a sequence of t control actions n 0 n t 1 and resulting states p t given by 2 1 we define the cost functional j by 2 2 j n t 0 t 1 β 1 p 2 t 2 β 2 n t we are now in position to formulate two optimal control problems 2 3 optimal control problem model 1 control lasts one time step the first optimal control problem we consider in this paper which we call model 1 is to minimize j n given by 2 2 subject to 2 1 over all nonnegative control functions 2 3 n n n t 0 n t for t 0 1 t 1 2 4 optimal control problem model 2 control decays exponentially in model 1 the control n t j is assumed to be only active on t j t j 1 however biological control agents may persist for some time in the environment and will remain efficacious especially when the time step is short for instance a day or a week instead of a season to account for this decay we augment n with its own dynamics we let n n t denote the new control action at time step t and n o denote remains of control actions from previous time steps the second optimal control problem which we call model 2 is minimize j given by 2 2 now subject to the dynamics 2 4 n o t 1 n o t e μ n n t n o 0 0 p t 1 a n o t e μ n n t p t p 0 p 0 t ℤ and the cost constraint 2 3 for n n namely n n n in model 2 we assume that the biological control agents decay exponentially with rate μ leading to the first dynamic equation in 2 4 note that model 2 resembles model 1 for large μ meaning that the control agents persist for a short time the existence of optimal controls for models 1 and 2 is given in the following theorem a proof of uniqueness of these solutions is more complicated due to the nonlinearity in the control and is not addressed in this paper we will state and prove the theorem for model 2 since the proof for model 1 is identical theorem 1 for all initial conditions p 0 ℝ 4 there is a control n n which minimizes j subject to 2 4 proof there exists an n max such that β 2 n max j 0 if n t n max for any t j n j 0 where 0 denotes the function that is identically equal to zero hence the minimum of j over n is the same as the minimum of j over n max n t 0 n t n max let t n max ℝ t ℝ 4 t be defined by t n ij p i j for all i 1 2 3 4 and j 0 1 t 1 where p i j is the ith component of p j the solution of 2 4 at time step j then from 2 4 it follows that t is continuous with any choice of norms for n max and ℝ 4 t hence j is continuous from n max to ℝ since n max is a compact subset of ℝ t j takes on a global minimum at some n n max n 2 5 case study diaprepes abbreviatus as a motivating and potentially economically important example we consider the insect pest species d abbreviates commonly called diaprepes root weevils drw drw originated in the caribbean and was transported to the central and southern regions of florida around 1964 grafton cardwell 2004 the introduction of drw was not intentional and in the past 50 years drw has become a troublesome invasive species spreading throughout florida and eventually to california in 2005 grafton cardwell 2004 jetter and godfrey 2009 jetter and godfrey 2009 drw infests citrus groves along with other plants mccoy et al 2000 adult drw feed and lay eggs on plants upon hatching neonate larvae drop off the leaves and bury into the soil where they feed on plant roots for several months until they pupate the damage caused by the feeding activity of the larvae can be severe causing tree decline and death drw dynamics have been described in a matrix model in miller and tenhumberg miller and tenhumberg 2010 in the past halogenated hydrocarbon insecticides were applied to the soil to control drw populations this class of insecticide was deregistered in 1984 mundy et al 2010 and since then there has been a lack in pesticides that adequately manage the drw larva campos herrera et al 2015 an alternative to pesticides is the usage of inundative biological control agents such as entomopathogenic nematodes attacking drw larvae shapiro ilan et al 2002 bullock et al 1999 nematodes are utilized like pesticides requiring regular applications campos herrera et al 2015 we explore two different scenarios the first scenario assumes that nematodes cannot persist and their life expectancy is only approximately one week addis et al 2016 see model 1 in section 2 3 the second scenario assumes nematode populations decline exponentially see model 2 in section 2 4 we determine management plans for both scenarios specifying timing and amount of nematodes applications while also considering the cost of applying nematodes and the cost of drw damage to the farmer 2 5 1 drw parameter values to use the framework of models 1 and 2 we reduced the 6 6 population projection matrix from miller and tenhumberg 2010 for drw to a 4 4 matrix using hooley s algorithm salguero gomez and plotkin 2010 the four stage classes of the matrix denote eggs p 1 larva p 2 pupa p 3 and adults p 4 and the time steps denote weeks with parameter values in table 2 1 scaled accordingly the resulting projection matrix is given by a γ 1 0 0 θ 1 γ 2 ζ 1 0 0 0 ζ 2 ν 1 0 0 0 ν 2 θ 2 0 305 0 0 80 447 0 530 0 899 0 0 0 0 020 0 778 0 0 0 0 202 0 980 hooley s algorithm guarantees that the dominant eigenvalue 1 423 of the reduced matrix a is the same as that of the original matrix miller and tenhumberg 2010 since the dominant eigenvalue is greater than 1 the model predicts growth of the uncontrolled population interpretations of the above parameter values along with all other parameter values arising in the optimal control problems are presented in table 2 1 the choice of optimal control depends on the distribution of the initial population among stages classes and its size captured by some norm of the initial population p 0 we choose the stable stage distribution ssd as an initial distribution to minimize the effect of transient dynamics on our control the ssd is a multiple of the normalized eigenvector associated with the dominant eigenvalue of a population projection matrix we then scaled the ssd by different constants to explore the effect of different initial drw population sizes starting with the ssd is relevant to a situation where the pest species has persisted in an orchard for several years without adding any control because drw escaped detection founder populations are typically small and for several generations they may remain sufficiently small to cause no notable damage even if the population grows at a constant rate hence it is plausible that populations are at the ssd before farmers apply control measures although the methods we propose are applicable for any p 0 2 5 2 the saturation function f as mentioned above we will model the application of entomopathogenic nematodes where the amount of control at time t is denoted by n t and n n t in models 1 and 2 respectively the control is applied only to the second stage class p 2 and relies on control agent host interactions we assume that the control agent host encounters follow a poisson distribution so we use the saturation function f n e αn where α denotes the control search application efficiency which accounts for how likely a control agent is to encounter a pest larva we could not find an estimate of α in the literature therefore we made the assumption that the recommended number of nematodes per hectare n n s 22 108 per hectare shapiro ilan et al 2002 results in population stasis and iteratively searched for α values that produced a slightly increasing population density this would likely be an underestimation of α conservative estimate for the effacing of the nematodes so we explore the control strategies using a range of α values when α 1 655 10 8 and n n s the population projection matrix has a dominant eigenvalue of 1 000005 meaning the model 2 1 predicts that the drw population growth very slowly this choice of α predicts that the recommended dose according to the manufacture specifications is not sufficient to produce population decline hence we would expect that our model predicts higher than recommended nematode applications by using an α value that is slightly too low our management recommendation has a safety net built in since the control might still work if nematode efficiency is low owing to poor environmental conditions owing to the uncertainty in the choice of α we will vary the parameter to evaluate its effect on the total cost of the system in numerical simulations 2 5 3 parameter values for the cost function in the literature we could not find an estimate for β 1 which specifies how much damage a single drw larvae causes in terms of loss in harvest to ensure that our choice for β 1 is sensible we compare the first part of our cost functional with natural densities of drw larvae and the average income of farmers from selling citrus fruits shapiro ilan et al 2002 mccoy et al 2003 one study reported drw larvae densities in florida of 376 25 per m2 in non irrigated orchards and 945 51 per m2 in irrigated orchards mccoy et al 2003 but the study did not report on the associated harvest in fig 2 2 the vertical lines are these numbers scaled for drw larvae per hectare further in 1999 farmers made on average us 6000 per hectare for citrus shapiro ilan et al 2002 according to the federal reserve bank of minneapolis the annual average consumer price index was 166 6 in 1999 and is 244 3 in 2017 consumer price index 1913 indicating an inflation of 46 6 appelbaum 2004 hence in 2017 the expected weekly income of a citrus farmer in florida is us 170 us 6000 1 466 52 horizontal line in fig 2 2 our choice of β 1 implies that at a drw larvae population of 4 62381 106 produces zero income for the farmer in this paper we also varied β 1 up and down by 15 thick and thin solid lines in fig 2 2 all three values for β 1 are conservative estimates of the impact of drw larvae on citrus harvest applying our method to a real world management situation would require improved estimates for β 1 at the time of this writing a batch of nematodes that is recommended by industry to control drw can be purchased for 62 per hectare shapiro ilan et al 2002 additionally it is recommended to use 22 nematodes per cm2 shapiro ilan et al 2002 to find the value of β 2 we combined these values and scaled the value for a hectare and a single nematode note that while we have configured the cost to be per one nematode typically nematodes are purchased in bulk therefore we will again vary the value of β 2 in simulations for the optimal control problem all parameter values are shown in table 2 1 3 results in theorem 1 we established that optimal controls exist for models 1 and 2 to identify these optimal controls we use an the extension of pontryagin maximum principle sethi and thompson 2006 for the original principle see pontryagin et al 1962 suppose that n is an optimal control for model 1 let p 2 be the second component of the solution p of 2 1 when subject to the optimal control n the following is referred to as the adjoint system for 2 1 3 1 λ 1 t λ 1 t 1 γ 1 λ 2 t 1 γ 2 λ 2 t 2 β 1 p 2 t λ 2 t 1 ζ 1 e α n t λ 3 t 1 ζ 2 e α n t λ 3 t λ 3 t 1 ν 1 λ 4 t 1 ν 2 λ 4 t λ 1 t 1 θ 1 λ 4 t 1 θ 2 λ 1 t 0 λ 2 t 0 λ 3 t 0 λ 4 t 0 t 0 1 t 1 the adjoint variables λ 1 λ 2 λ 3 and λ 4 perform a function similar to that of lagrange multipliers a necessary condition for n to be a solution of the optimal control problem for model 1 see seierstad and sydsaeter 1986 chp 2 is that n t n t p t λ 1 t λ 2 t λ 3 t and λ 4 t solve 2 1 3 1 and 3 2 n t 0 if β 2 α ξ t 1 α ln α β 2 ξ t if β 2 α ξ t where ξ t ζ 1 λ 2 t 1 p 2 t ζ 2 λ 3 t 1 p 2 t if we can solve 2 1 3 1 and 3 2 then the solution will be an optimal control lenhart and workman 2007 chps 1 23 for model 2 we again use the extension of pontryagin maximum principle suppose that n n is an optimal control for model 2 let p 2 be the second component of the solution p and n o the solution n o of 2 4 when subject to the optimal control n n the following is referred to as the adjoint system for 2 4 3 3 λ 1 t λ 1 t 1 γ 1 λ 2 t 1 γ 2 λ 2 t 2 β 1 p 2 t λ 2 t 1 ζ 1 e α n o t e μ n n t λ 3 t 1 ζ 2 e α n o t e μ n n t λ 3 t λ 3 t 1 ν 1 λ 4 t 1 ν 2 λ 4 t λ 1 t 1 θ 1 λ 4 t 1 θ 2 λ o t α ζ 1 e μ λ 2 t 1 e α n o t e μ n n t p 2 t α ζ 2 e μ λ 3 t 1 e α n o t e μ n n t p 2 t λ o t 1 e μ λ 1 t 0 λ 2 t 0 λ 3 t 0 λ 4 t 0 λ o t 0 t 0 1 t 1 a necessary condition for n n to be a solution of the optimal control problem for model 2 is that n t n t p t λ 1 t λ 2 t λ 3 t and λ 4 t solve 2 4 3 3 and 3 4 n n t 0 if e α n o t e μ ξ n t 1 α ln ξ n t n o t e μ if e α n o t e μ ξ n t with ξ n t α p 2 t λ 2 t 1 ζ 1 λ 3 t 1 ζ 2 β 2 λ o t 1 if we can solve 2 4 3 3 and 3 4 then the solution will be an optimal control as mentioned above we have not established uniqueness however as we will see in the numerical results in section 3 1 there is no indication that the optimal controls are non unique 3 1 numerical simulations for drw we cannot explicitly solve the systems 2 1 3 1 3 2 or 2 4 3 3 3 4 analytically so we use numerical simulations with the drw parameter values from table 2 1 for the numerical simulations we used two different methods in matlab forward backward sweep fbs and multistart which will be described in sections 3 1 1 and 3 1 4 respectively 3 1 1 forward backward sweep fbs forward backward sweep fbs is an algorithm typically used to find an estimate for the solution to an optimal control problem lenhart and workman 2007 chp 4 23 the algorithm takes an estimate for the control and calculates the associated state system and adjoint system then with the new state and adjoint systems the algorithm calculates the control next the algorithm checks if the difference between the new values and the previous values are smaller than a chosen acceptable error value once the difference between estimates is acceptable the algorithm stops and outputs the last control values we will use the following process 1 let n 0 and use 2 1 or 2 4 to calculate p and n o from initial conditions 2 now calculate λ 1 λ 2 λ 3 λ 4 λ o using 3 1 or 3 3 3 using the calculations in 1 and 2 find n 4 check if the differences between the newly calculated p n o λ s and n for s 1 2 3 4 o are within an acceptable error if so stop since you have an acceptable estimate for the optimal control if not use the n in step 3 and repeat the process 3 1 2 model 1 we varied the initial population of drw in the fbs method for model 1 to see how the optimal application of nematodes and corresponding drw larvae population depend on this initial population see fig 3 1 as expected the larger the initial pest density the larger the number of nematodes in the optimal control but interestingly the resulting drw larval density obtained with the optimal control also increases in other words if initial pest density is high it is not optimal to get pest density as low as when initial pest density is low this is different from the automatic spray schedule used by farmers with the optimal control problem we are considering how to minimize the total combined cost possibly applying control for each time step in section 2 5 2 we gave a conservative value for search efficiency α since this parameter is highly uncertain we ran numerical simulations with a range of different α values we also explored the effect of varying the parameter values for β 1 and β 2 from section 2 5 3 we varied the three parameters assuming the initial population is 1 7 106 drw per hectare the results are displayed in fig 3 2 we fitted the simulation results to linear functions the least square regression lines explain 99 of the variation the results show that the total costs increase with increasing β 1 and β 2 and the total costs decrease with increasing α 3 1 3 model 2 while the fbs is a useful algorithm for many problems there are circumstances that cause the algorithm to not converge de araujo et al 2010 in our model 2 optimal control problem for many choices of μ fbs cannot be used to find the optimal number of nematodes to apply in fact in many simulations the algorithm gives a zero control which is not close to optimal this can be explained as follows looking at 3 4 for nematodes n n 3 5 n n t 0 if e α n o t e μ α p 2 t λ 2 t 1 ζ 1 λ 3 t 1 ζ 2 β 2 λ o t 1 1 α ln α p 2 t λ 2 t 1 ζ 1 λ 3 t 1 ζ 2 β 2 λ o t 1 n o t e μ if e α n o t e μ α p 2 t λ 2 t 1 ζ 1 λ 3 t 1 ζ 2 β 2 λ o t 1 in order for 3 5 to predict a non zero optimal control that is n n t 0 it is necessary that that 3 6 e α n o t e μ α p 2 t λ 2 t 1 ζ 1 λ 3 t 1 ζ 2 β 2 λ o t 1 the larger μ is the easier it is to satisfy 3 6 as the left hand side decreases with increasing μ we know that 1 e α n o t e μ since n o t e μ 0 so α p 2 t λ 2 t 1 ζ 1 λ 3 t 1 ζ 2 β 2 λ o t 1 will need to be positive we have that αp 2 t λ 2 t 1 ζ 1 λ 3 t 1 ζ 2 0 we also need to consider β 2 λ o t 1 recall that λ o t α ζ 1 e μ λ 2 t 1 e α n o t e μ n n t p 2 t α ζ 2 e μ λ 3 t 1 e α n o t e μ n n t p 2 t λ o t 1 e μ since λ o t 0 λ o t 0 for all t which means for β 2 λ o t 1 to be positive we need that β 2 λ o t 1 as β 2 is a positive constant in our case study β 2 2 8182 10 8 when 0 μ 1 it is not likely that β 2 λ o t 1 so the result of fbs is always n n t 0 or does not converge fig 3 3 shows the effect on the fbs solution of varying μ for an initial drw population of 1 1 106 per hectare note that for small values of μ the fbs produces a solution that is all zeros or starts with zeros when μ is small more of the nematodes survive a week but the fbs solution is instructing us to never apply nematodes or wait until much later into the application period meanwhile for larger values the optimal control is similar to that for model 1 from this we see that fbs is not a reliable method for solving the optimal control problem when μ is small we will see that we can often obtain a lower total cost with an estimate of the control that is based on a different numerical method 3 1 4 multistart the multistart ms algorithm is a standard matlab function which implements the fmincon function from matlab the fmincon function searches for a local minimum near a user defined starting value for the algorithm we input the dynamical system objective functional and parameter values unlike fbs this algorithm does not use the adjoint equations to find the global minimum multistart uses many randomly generated points as starting control values and picks the strategy associated with the lowest local minimum the results we display use 500 000 randomly chosen points we used matlab 2013b in fig 3 4 we compare multistart to fbs for μ ln 2 with model 2 a value which caused the fbs algorithm to no longer converge we can see the fbs algorithm nematode application is zero except for one large value and the resulting total cost in dollars is 3 55 1012 with a general exponential growth of drw larvae meanwhile multistart produces a more constant application management plan and has a total cost of 1 01 102 with far fewer drw larvae surviving to evaluate how accurately multistart can solve the optimal control problem we compared multistart to fbs for model 1 for two different initial drw densities see fig 3 5 for an initial drw population of 2 105 per hectare the total cost using fbs is 287 35 and 300 47 with multistart when we use an initial drw population of 1 7 106 per hectare the fbs total cost is 1012 16 and the multistart total cost is 1047 23 as we increased the number of runs with multistart the difference between the methods total costs decreased the comparison between multistart and fbs shows that the solution using multistart is satisfactory for many purposes we can also note that the multistart results have some fluctuation which is due to the algorithm searching a large number of values for a solution as we increase the number of runs the multistart results have fewer oscillations but the run time increases in the remainder of the paper we apply the multistart algorithm for model 2 and for brevity we refer to the result provided by multistart as optimal nematode application strategy even though the result is not truly optimal we explore the effect of changing the initial drw population for μ ln 2 see fig 3 6 note from about weeks 6 42 the simulations are seemingly converging to a constant amount of nematodes to apply each week with the larger initial drw population there are more erratic variations in the solution which reduce with more runs in multistart in fig 3 7 we plot the optimal number of nematodes to apply when varying values for μ with initial drw populations of 2 105 and 1 1 106 per hectare note that as expected the longer a released nematode population persists the fewer nematodes are needed for controlling drw also as in model 1 we need to apply more nematodes if the initial drw infestation is high we noted the apparent convergence of nematode application to a constant in fig 3 6 thus it seems plausible that a constant control application will be effective constant application amounts would be appealing for farming applications we choose a constant control which best fits in a least squares sense our estimate for the optimal control obtained using multistart additionally we ran the multistart algorithm for applying a constant amount of control n at each time step next we compared the effect of using the constant control fit constant control multistart and the original multistart estimate of the optimal control see fig 3 8 note that our original model 2 simulation produces the lowest total cost of 101 51 but there is not a drastic difference between the constant fit 107 21 and constant multistart of 105 82 in particular the percentage difference between the total cost of the original model 2 and constant fit is 5 62 and constant multistart is 4 25 4 discussion we have modeled the application of pesticide or biological control to regulate an insect pest as a mathematical optimal control problem in our discrete time model the uncontrolled pest population has linear dynamics and is stage structured the control acts on the second stage by reducing survival as a function of applied control effort and saturates at high density of the control agent because survival cannot be reduced below 0 the cost is quadratic in the pest abundance and linear in the control term we considered two cases first where the control is effective over only one time step model 1 and second where the effect of the control decays exponentially over time model 2 the solution of the optimal control problem balances the costs of management with the costs of loss of crops giving an amount of control to apply each time period in order to minimize the total cost for a specific example we manage d abbreviatus using entomopathogenic nematodes as biopesticides obtaining numerical estimates of an optimal control by using fbs and multistart algorithms fbs is more accurate but the method breaks down when the control decay is too slow there are some facets of our model and approach that can be easily generalized and some facets that cannot the formula for the optimal control in terms of the adjoint equations made explicit use of the underlying linear model however the specific form of the permitted control function is fairly general as long as it saturates at 1 all individuals in the targeted stage die the control needs to act on only one stage class for the modeling here to work but which stage class is targeted for control and the functional form of the control is arbitrary we chose a quadratic functional form for the cost associated with the pest both because it heavily penalizes catastrophic loss and because it is mathematically convenient the cost of purchasing and applying control is linear in the control variable which seems a reasonable assumption in the absence of other information the numerical algorithm fbs is efficient and accurate for model 1 but has the disadvantage that it did not produce sensible results for certain parameter values when applied to model 2 we explained in section 3 1 3 how and why the method breaks down as an alternative to fbs we used multistart to find the optimal management strategy for model 2 to evaluate the performance of multistart we used this algorithm for model 1 as well and compared the results with those of fsb we found that the total cost using multistart was higher compared to fbs but the difference was small for instance for initial drw population of 2 105 per hectare the percentage difference was 4 5 and for initial drw population of 1 7 106 per hectare the percentage difference was 3 4 another disadvantage of using multistart is that it gives an optimal control which fluctuates more than we would expect e g fig 3 6 the results get smoother with increasing number of starting values included in multistart but this increases the total running time to find a solution alternatively we used the multistart algorithm to obtain the best constant control and compare this control to the non constant optimal control the cost effective target pest population size depended on the infestation level at which control was initiated if control started at low initial pest infestation levels the application of small amounts of control was sufficient to reduce pest populations to very low densities over the entire growing season in contrast if control started at relatively high drw population size the required amount of nematodes to control drw populations was high and it was not cost effective to reduce infestation to the same low levels as when control started earlier when population size was still small our result highlights how beneficial early pest detection is for citrus growers we explored how μ affects the total cost as expected the longer nematode populations persist in the environment the lower is the cost associated with the control for instance if half of the nematode populations survive each time step μ ln 2 and the initial drw population is 2 105 per hectare then the total cost of controlling drw populations is 101 this cost increases by 183 to 287 if nematode populations survive only a single time step model 1 this suggests that citrus growers would largely benefit from research on improving nematode population persistence after inundative release using fbs in model 1 suggests weekly nematode applications that initially increase over time and then decrease this is a typical result for optimal control since we are minimizing the total cost for the given time period so control declines near the end since the model doesn t have a cost for time greater than t one way to avoid this would be to expand the time frame over which we optimize e g 10 years instead of one year but only use the control for the shorter time frame using multistart the nematode application scheme is relatively constant over most of the growing season fig 3 5 the difference in cost is small e g 287 versus 300 for initial drw population size of 2 105 per hectare we conclude by highlighting a future avenue of research recent research by the present authors guiver et al 2016 has considered theoretical approaches to pest management which appeal to and develop further tools from robust control theory briefly robust control seeks to achieve desired dynamic behavior such as reducing pest population in the presence of uncertainty or perturbation of the model facets not addressed here the downside of robust control tools is that they sacrifice optimality in general thus we plan to compare and contrast the optimal approach adopted here with that of guiver et al 2016 and seek to design methods which incorporate both elements of robust and optimal control acknowledgements this work was partially funded by a multidisciplinary seed grant from the university of nebraska cje and rr were partially funded by nsf grant dms 1412598 cg and st were supported by the uk s epsrc grant number ep i019456 1 yj was supported by nsf grant dms 1411703 bt was supported by nsf grant deb 655117 and usda nifa grant 2017 03807 we are grateful to stephanie lloyd jim powell and suzanne lenhart for helpful discussions during the writing of the manuscript we would like to thank the two anonymous reviewers for their helpful comments 
25282,ecological communities are complex adaptive systems that exhibit remarkable feedbacks between their biomass and trait dynamics trait based aggregate models cope with this complexity by focusing on the temporal development of the community s aggregate properties such as its total biomass mean trait and trait variance they are based on particular assumptions about the shape of the underlying trait distribution which is commonly assumed to be normal however ecologically important traits are usually restricted to a finite range and empirical trait distributions are often skewed or multimodal as a result normal distribution based aggregate models may fail to adequately represent the biomass and trait dynamics of natural communities we resolve this mismatch by developing a new moment closure approach assuming the trait values to be beta distributed we show that the beta distribution captures important shape properties of both observed and simulated trait distributions which cannot be captured by a gaussian we further demonstrate that a beta distribution based moment closure can strongly enhance the reliability of trait based aggregate models we compare the biomass mean trait and variance dynamics of a full trait distribution fd model to the ones of beta ba and normal na distribution based aggregate models under different selection regimes this way we demonstrate under which general conditions stabilizing fluctuating or disruptive selection different aggregate models are reliable tools all three models predicted very similar biomass and trait dynamics under stabilizing selection yielding unimodal trait distributions with small standing trait variation we also obtained an almost perfect match between the results of the fd and ba models under fluctuating selection promoting skewed trait distributions and ongoing oscillations in the biomass and trait dynamics in contrast the na model showed unrealistic trait dynamics and exhibited different alternative stable states and thus a high sensitivity to initial conditions under fluctuating selection under disruptive selection both aggregate models failed to reproduce the results of the fd model with the mean trait values remaining within their ecologically feasible ranges in the ba model but not in the na model overall a beta distribution based moment closure strongly improved the realism of trait based aggregate models keywords moment closure normal and beta distribution skewed and peaked trait distributions fitness landscape and frequency dependent selection eco evolutionary dynamics modelling functional diversity 1 introduction ecological communities can respond to altered environmental conditions by adapting their trait composition which may in turn alter the strength of ecological interactions and thus the selection pressure of the environment a recently advocated approach to unravel such feedbacks between biomass and trait dynamics is to consider communities as complex adaptive systems norberg 2004 merico et al 2009 building on fundamental theory in evolutionary biology lande 1982 turelli and barton 1994 day and proulx 2004 and spatial ecology iwasa et al 1987 dieckmann and law 1996 bolker and pacala 1997 community ecologists developed trait based aggregate models in order to focus on key functional attributes of the communities wirtz and eckhardt 1996 norberg et al 2001 unlike discrete or full trait distribution models that consider the population dynamics of several or all functionally different species separately bruggeman and kooijman 2007 tirok and gaedke 2010 acevedo trejos et al 2016 aggregate models describe the temporal dynamics of the community s aggregate properties such as its total biomass mean trait and trait variance tirok et al 2011 merico et al 2014 the mean and variance correspond to the first and second central moments of the corresponding trait distribution and therefore represent the average strategy and functional diversity of a community the corresponding reduction in model complexity may enhance the computational efficiency and allow the achievement of analytical results which may increase the mechanistic understanding of biomass trait feedbacks in natural systems the derivation of an aggregate model from a full trait distribution model involves a moment expansion which determines how the rates of change of the aggregate properties depend on the shape of the trait distribution norberg et al 2001 coutinho et al 2016 in general the temporal development of lower moments such as the mean and variance depend on higher moments such as the skewness and kurtosis which quantify how skewed and peaked a distribution is in order to get self contained expressions of the aggregate model equations one has to conduct a moment closure where higher moments are expressed in terms of lower ones kuehn 2015 this is commonly done by assuming a particular shape of the underlying distribution in community ecology previous studies often used a normal distribution based moment closure approach and thus assumed the shape of the trait distribution to be a gaussian terseleer et al 2014 acevedo trejos et al 2015 smith et al 2016 this assumption implies that trait distributions should be unimodal and symmetric and that traits are defined on an infinite range without a lower or upper boundary the assumption of a unimodal trait distribution seems to be valid under stabilizing selection in which intermediate trait values are favored over extreme ones however recent empirical studies showed that trait distributions are often heavily skewed or multimodal havlicek and carpenter 2001 thibault et al 2011 downing et al 2014 gaedke and klauschies 2017 this is likely a result of fluctuating or disruptive selection and questions the strong assumption of normally distributed trait values coutinho et al 2016 under fluctuating selection trait distributions are expected to show skewness because different trait values are favored at different times whereas under disruptive selection extreme trait values are favored over intermediate ones promoting bimodal trait distributions in addition important traits such as body size reproduction rate or edibility are clearly restricted to a finite range for example a prey species cannot be more than entirely edible or inedible constraining the trait edibility to the range between zero and one klauschies et al 2016 in general this limited range of trait values will lead to specific correlations between lower and higher moments gaedke and klauschies 2017 a distribution whose mean x is close to the lower or upper limit will most probably be right s 0 or left skewed s 0 promoting a negative correlation between s and x furthermore when the trait range is limited distributions with high variances ν have to be rather flat or even bimodal leading to low values of kurtosis k conversely peaked distributions with pronounced tails resulting in high values of k must exhibit low values of v this results in a negative correlation between k and v in contrast a normal distribution presents no such correlations because both s and k are constant and thus independent of x and v hence a gaussian does not capture such properties of natural trait distributions inspired by recent developments in stochastic population biology krishnarajah et al 2005 clancy and mendy 2011 we explore in this study a novel moment closure approach for trait based aggregate models by assuming that the shape of the trait distribution follows a beta distribution in contrast to a normal distribution the beta distribution is defined only over a finite range with lower and upper limits and can be unimodal or bimodal symmetric or skewed depending on its mean and variance moreover the correlations between its higher and lower moments conform to the pattern described above we corroborate these qualitative relations by comparing the relationships between lower and higher moments of the beta distribution with those observed for phytoplankton size distributions of the baltic sea klais et al 2016a b and for simulated trait distributions of a full trait distribution fd model the fd model comprises the full trait distribution of a prey community that competes for a common carrying capacity and that is grazed upon by three different predator species that are specialized on different parts of the prey s trait spectrum hence the fd model entails key features of natural food webs and generates different selection regimes which determine the shape of the prey community s trait distribution see fig 1 finally we show how a beta distribution based moment closure approach improves trait based aggregate models by comparing the biomass and trait dynamics of the fd model to a beta distribution based aggregate ba model and a normal distribution based aggregate na model under different selection regimes 2 materials and methods to evaluate if the beta distribution represents a more suitable basis for a moment closure of trait based aggregate models than the normal distribution we compare the relationships between lower and higher central moments of observed phytoplankton size distributions simulated trait distributions of a full trait distribution fd model and the beta distribution subsequently we compare the dynamics of biomass and mean and variance of the trait distribution under the fd model to that of aggregate models based on a beta or normal distribution moment closure 2 1 analyzing the shape of observed phytoplankton size distributions we analyzed the correlations among lower and higher central moments of more than 7000 phytoplankton size distributions of the baltic sea klais et al 2016a b size i e cell volume is the most important trait influencing many eco physiological processes of phytoplankton species such as nutrient uptake maximum growth rates sedimentation rates and susceptibility to zooplankton grazing weithoff 2003 the classification of the different phytoplankton species was done according to their individual cell volume or colony size for details see klais et al 2016a b missing values of the size of a phytoplankton species at particular sampling dates or locations were replaced by the average value for that species over all sampling times and locations we log transformed the size values of the phytoplankton species to account for their large range covering about eleven orders of magnitude and for the inherent skewness in size distributions this is in line with the general assumption of normal distribution based aggregate models that size is log normally distributed terseleer et al 2014 acevedo trejos et al 2015 to reduce the sampling error we grouped the biovolume of the species into 85 equidistant size classes on a log2 scale to account for individual growth and variability within each species we assumed that the minimum and maximum size values of each species differed by a factor of 4 prior to log2 transformation gaedke 1992 assuming that the species specific size distribution is log normal see lande 1982 we allocated 50 of the biovolume to the class corresponding to the species measured mean size value x 20 to the two adjacent classes corresponding to the ranges within 21 2 and 2 1 2 of x and 5 to the classes corresponding to the ranges 2 and 2 1 away from x all subsequent calculations are based on the mean values of the classes ordered on a log2 scale 2 2 full trait distribution model fd model in order to achieve different selection regimes we consider a predator prey model with a set of prey species with continuous trait values grazed upon by three predators each feeding on a specific part of the prey s trait range the rate of change of the different prey r and predator c species are given by the following set of equations 1 r x t r 1 0 1 r x d x κ r x i 1 3 a i x r x c i 1 h 0 1 a i x r x d x i 2 d c i d t ε 0 1 a i x r x d x 1 h 0 1 a i x r x d x d c i the prey are structured by their trait value x bounded between 0 and 1 the parameters r and κ are respectively the intrinsic growth rate and carrying capacity of the prey hence the prey species are competing for a shared resource such as light the net growth rates of the three predators which are identified by i 1 2 3 depend on their common handling time h efficiency ε and death rate d and their species specific attack rates a i the parameter values used in the simulations are given in table 1 all parameters are independent of x except for a i these are functions of the prey phenotype x fig 1a c 3 a i x a m a x a m i n e x i 1 2 σ 2 a m i n with a m a x and a m i n being the maximum and minimum attack rates of the different predators the attack rates of the three different predators are maximal at their species specific optimal prey phenotypes with trait values of 0 0 5 or 1 the parameter σ determines the width of the predators feeding kernel in addition we added a small immigration rate i to eq 1 to prevent extinction of any particular trait value in the fd model and to promote short transients in its dynamics we compared the results of the fd model with those of the two different aggregate models by calculating the first three aggregate properties of the prey community s trait distribution i e its total biomass r t trait mean x and trait variance ν which are given for the fd model by 4 r t 0 1 r x d x 5 x 1 r t 0 1 x r x d x 6 ν 1 r t 0 1 x x 2 r x d x the fd model was numerically integrated using the method of lines where a system of coupled ordinary differential equations is obtained through a discretization along the trait axis hence we approximated the fd model by the following set of equations 7 d r j d t r 1 k 1 n r k κ r j i 1 3 a i x j r j c i 1 h k 1 n a i x k r k i n 8 d c i d t ε j 1 n a i x j r j 1 h j 1 n a i x j r j d c i with n 101 being the number of different prey species their corresponding trait values are distributed evenly along the trait axis of the entire prey community i e x j 0 0 01 0 02 1 accordingly the aggregate properties were estimated from the biomass values obtained for the different prey species 9 r t j 1 n r j 10 x 1 r t j 1 n x j r j 11 ν 1 r t j 1 n x j x 2 r j 2 3 aggregate models am instead of describing the temporal development of the biomasses of different species with particular trait values separately one can focus on a system of differential equations that describe the rate of change of the aggregate properties directly using moment approximation methods we derived the trait based aggregate models from the corresponding fd model as shown in appendix a consequently the temporal development of the aggregate properties is described by the following set of approximate equations 12 d r t d t f x ν 2 2 f x x 2 x x r t i 13 d x d t ν f x x x x s ν 3 2 2 2 f x x 2 x x i r t 1 2 x 14 d ν d t s ν 3 2 f x x x x k ν 2 ν 2 2 2 f x x 2 x x i r t 1 12 ν 1 2 x 2 15 d c i d t ε a i x ν 2 2 a i x x 2 x x r t 1 h a i x ν 2 2 a i x x 2 x x r t d c i with f being the per capita net growth rate fitness and s and k being the skewness and the kurtosis of the trait distribution of the prey community when conducting a moment closure based on the assumption of normally distributed trait values eqs 13 and 14 simplify to 16 d x d t ν f x x x x i r t 1 2 x 17 d ν d t ν 2 2 f x x 2 x x i r t 1 12 ν 1 2 x 2 because s equals zero and k equals 3 hence s and k are independent of the mean x and variance ν in contrast s and k of the beta distribution strongly vary with both x and ν for details see appendix a cf fig 1g i 18 s x ν 2 1 2 x ν 1 x x ν 19 k x ν 1 x x ν 4 ν 2 1 x x 1 s x ν 2 6 ν 2 ν 1 x x 3 in line with coutinho et al 2016 and eq 1 the second order approximation of f is given by 20 f x r 1 r t κ i 1 3 a i x c i 1 h a i x ν 2 2 a i x x 2 x x r t in accordance with the fd model the small immigration rate i in the aggregate model equations prevents a complete loss of the standing trait variation in the prey community 2 4 numerical simulations and selection regimes we conducted numerical simulations of our models to compare their biomass and trait dynamics under different selection regimes the type of selection pressure on the prey community was altered by choosing which of the three predators were present see fig 1 with only the two predators specialized on the two extreme trait values present the overall selection pressure was stabilizing towards the intermediate trait value of the prey in contrast with only one predator specialized on the intermediate trait values present the prey community exhibits disruptive selection finally if all three predators are present selection is on average rather neutral potentially leading to fluctuating and thus recurrent directional selection in which different trait values are favored at different times we initialized all simulations with equally abundant predators c i 1 n κ 10 with n being the number of predators and total biomass and trait variance of the prey community of κ 2 and 10 3 respectively to investigate the possibility of multi stability in our models we ran them for different initial values of the mean trait i e x 0 05 0 07 0 93 0 95 we assumed the initial trait distribution of the prey community in the fd model to follow the shape of a beta distribution though that was not relevant for the long term solutions obtained all simulations lasted for 104 time units simulations and analyses were performed in matlab version 7 13 using solver ode23 for odes the mathworks inc natick ma 2011 we increased the precision of the solver by reducing the absolute and relative tolerances to 10 9 and 10 7 and the maximum step size to 0 1 3 results 3 1 analyzing the shape of the empirical and simulated trait distributions the observed phytoplankton size distributions and the simulated trait distributions both revealed strong relationships between lower and higher moments the skewness s and the mean x were strongly negatively correlated fig 2 a r2 0 41 and 2c because the trait distribution tends to become skewed as x approaches one of the extreme trait values for a given value of ν we also found a strong negative correlation between the log of kurtosis l n k and the log of the variance l n ν fig 2b r2 0 42 and 2d in fact a trait distribution defined on a finite trait range can only exhibit very high variances when its shape is close to the one of a flat or even bimodal distribution corresponding to small values of k in contrast peaked trait distributions with pronounced tails i e distributions with high values of k will usually have rather low values of ν these relationships between lower and higher central moments are qualitatively well approximated by a beta distribution eqs 13 and 14 fig 2e and f 3 2 comparing the biomass and trait dynamics of the fd ba and na models our model comparison revealed further support for the suitability of a beta distribution based moment closure the presence or absence of distinct predator species imposed either stabilizing fluctuating or disruptive selection on the prey community fig 1 under stabilizing selection the predator biomasses and the three aggregate properties of the prey community i e its total biomass mean trait value and variance showed stasis in the full trait distribution fd model at the end of the simulation fig 3 a d and g the lack of oscillations is explained by the comparably low attack rates of the predators at equilibrium conditions in line with that the two aggregate models predicted very similar values of the predator biomasses and the aggregate properties of the prey community fig 3 because the symmetric unimodal trait distribution of the fd model exhibited a very small variance ν 2 10 6 that could be captured well by both the beta ba and the normal na distribution based approaches this result was independent of the initial conditions the biomass and trait dynamics of the fd ba and na models also agreed very well when the system exhibited predator prey oscillations e g for k 20 rather than k 10 this is in line with additional results from a chemostat model in which a trade off between the prey s nutrient uptake efficiency and its vulnerability to predation imposes stabilizing selection on the trait distribution of the prey community for details see appendix b as expected the numerical integration of both aggregate models was up to 4 times faster than that of the fd model table 2 interestingly there was no difference between the simulation times of the ba model and the na model we also observed an almost perfect match between the cyclic biomass and trait dynamics of the fd and ba models under fluctuating selection favoring different trait values of the prey community and different predators at different times fig 4 the pronounced predator prey oscillations were caused by the temporarily high attack rates of the predators this result was independent of the initial conditions fig 5 and robust to changes in the carrying capacity minimum attack rate and immigration rate appendix c the ba model could not reproduce the biomass and trait dynamics of the fd model when the immigration rate was very low fig c3 in contrast to the ba model the results of the na model deviated considerably from the ones of the fd model fig 4c f i additionally it exhibited several alternative states and thus a high sensitivity to initial conditions depending on the initial mean trait value of the prey community different equilibria for the biomass and trait dynamics were obtained fig 5c f and i when either one or two predators went extinct fig 4c extinctions of two predators occurred when the equilibrium value of x was outside the ecologically feasible range which occurred frequently depending on the strength of the predator prey interactions at equilibrium conditions the predator prey dynamics showed either stasis or oscillations these results were insensitive to deviations from the exact parameter values appendix c in the ba model x always remained within its ecologically feasible range this result was to be expected because the beta distribution is naturally defined on the finite range between 0 and 1 a more detailed analysis revealed that the boundedness of x is realized by a dynamical feedback between x and s in fact the absolute value of s strongly increased when x approached one of the extremes leading to a strong decline of ν as a result the rate of change of x strongly slowed down preventing any further change of x close to the extremes for details see appendix d this mechanism of self regulation is lacking in the na model in line with stabilizing selection the numerical integration of both aggregate models was about three times faster than that of the fd model under fluctuating selection whereas the simulation times of the ba model and the na model were similar table 2 the general features of our results that is the match between the fd and ba models but not with the na model as well as the gains in computation times do not depend on details of the model structure appendix b we demonstrate this with a species competition model in which the recurrent changes in an environmental factor impose fluctuating selection on the trait distribution of the community under disruptive selection both aggregate models failed to match the results of the fd model which predicted a symmetric bimodal trait distribution exhibiting maximum variance fig 6 the na model even failed to reproduce the predator and prey biomasses the disagreement between the results of the fd and na models was to be expected because a normal distribution cannot represent a bimodal trait distribution that is dominated by two very different strategies cf fig 1 in contrast the reason for the mismatch between the results of the ba and fd models is more intriguing since the beta distribution is in principle able to capture the shape of bimodal trait distributions see fig 1 given the symmetry of the feeding interactions in our model the ba model predicted only the biomasses of the prey and predator communities correctly but not x and ν of the prey community s trait distribution this mismatch is only explicable by the restrictions imposed by the second order approximation of the shape of the fitness landscape i e it is independent of the type of moment closure in fact an extended version of the ba model that accounted for higher derivatives of the fitness function was able to reproduce the mean and variance but not the biomass dynamics of the prey community of the fd model under disruptive selection for details see appendix e furthermore and in contrast to the fd model both aggregate models showed bistability where the prey community was dominated by a species possessing either a high or low x as expected the latter was still within the ecologically feasible range in the ba model fig 7 e but not in the na model making it fundamentally inconsistent fig 7f hence the inability of the aggregate models to represent bimodal trait distributions with large variances was compensated by the emergence of two alternative stable states in case of the ba model the average distribution of these alternative stable states captured the bimodal distribution of the fd model well the numerical integration of both aggregate models was about three times faster than that of the fd model table 2 the mismatch between the results of the fd and aggregate models under disruptive selection was independent of the exact model structure appendix b we show this with a modified version of the predator prey model used in the main text in which a trade off between the prey s vulnerability to predation by the two specialist predators imposes disruptive selection on the trait distribution of the prey community 4 discussion trait based aggregate models are a promising tool to incorporate the effects of functional diversity of natural communities into an efficient mathematical framework the corresponding equations directly inform about the properties of the fitness landscape and trait distribution that drive the temporal development of the aggregate properties and thus may enable a detailed understanding of the biomass trait feedback of complex adaptive systems cas under simplifying assumptions their derivation from a corresponding full trait distribution model demonstrates that the temporal development of the lower moments generally depends on higher moments for details see appendix a obtaining a closed system of differential equations requires a moment closure so that the higher moments are expressed in terms of the lower ones norberg et al 2001 coutinho et al 2016 a frequently made assumption is that the higher moments such as skewness s and kurtosis k of the trait distribution follow a normal distribution wirtz and eckhardt 1996 tirok et al 2011 smith et al 2016 in accordance with previous results coutinho et al 2016 we show that this assumption is likely to be valid under stabilizing or weakly fluctuating selection savage et al 2007 merico et al 2009 acevedo trejos et al 2015 promoting rather unimodal trait distributions with small variances however observed size distributions of phytoplankton communities in various habitats were often heavily skewed or flat likely caused by strongly fluctuating or disruptive selection skewed and bimodal size distributions were also frequently observed in other aquatic tackx et al 1994 downing et al 2014 and terrestrial maurer et al 2004 thibault et al 2011 communities therefore normal distribution based aggregate na models are likely to be inappropriate for many natural systems coutinho et al 2016 we aimed to overcome these limitations by investigating the behavior of a new trait based aggregate model based on the assumption that the trait values are beta distributed in contrast to the normal distribution the beta distribution is defined on a finite range as are presumably all ecologically relevant traits such as body size generation times or feeding rates as a result the beta distribution can be unimodal and symmetric heavily skewed or bimodal depending on its mean and variance additionally it exhibits strong negative correlations between the lower and higher moments in line with the observed phytoplankton size distributions 4 1 performance of trait based aggregate models under different selection regimes a comparison of the biomass and trait dynamics of a full trait distribution fd model with the ones of a beta distribution based aggregate ba model revealed that a corresponding moment closure can strongly improve the reliability of trait based aggregate models we also applied the method to other models found in the literature appendix b showing that our results are not specific to particular model choices under stabilizing and fluctuating selection we observed an almost perfect match between the biomass and trait dynamics of the fd and ba models this result was independent of the initial conditions and relies mainly on the fact that the skewness s of the trait distribution and the curvature of the fitness landscape at the mean trait value x 2 f x 2 x x jointly prevent x from getting locked at a local fitness maximum appendix e in contrast to previous results where the existence of convergent stable fitness minima or convergent unstable fitness maxima relies on frequency dependent selection e g abrams et al 1993b the mechanism described above can stabilize fitness minima or destabilize fitness maxima even in the absence of frequency dependent selection appendix e nevertheless a certain amount of standing trait variation ν and thus immigration was still needed to maintain ongoing changes in x under fluctuating selection for details see appendix c the close correspondence between the biomass and trait dynamics of the fd and ba models is in line with a statistical comparison of different aggregate models linked to empirical size distributions of phytoplankton communities gaedke and klauschies 2017 the best approximation of the rate of change of the aggregate properties of the corresponding fd model was obtained with a moment closure approach based on the observed negative correlations between the higher and lower central moments of the phytoplankton size distributions in contrast the na model predicted biomass and trait dynamics that differed strongly from the ones of the ba and fd models for example the changes in x did not cover the entire trait range but exhibited small amplitude oscillations consequently one or two of the three predators went extinct in addition the na model showed a high sensitivity to initial conditions under fluctuating selection in many cases x surpassed its natural limits because the na model lacks an inherent mechanism to prevent this in contrast the ba model entails a skewness mediated feedback between x and ν close to the extremes which arises from the upper and lower limits of the beta distribution keeping x within its ecologically feasible range when x approaches one of the extremes s will always increase in modulus and have the opposite sign of the fitness gradient see eq 18 and fig 2e leading to a strong decline of ν see eq 14 as a result the rate of change of x slows down quickly given that ν scales d x d t eventually stopping x at or close to one of the extremes for details see appendix d this shows that temporal changes in s are very important for restricting x to its ecologically feasible range by promoting a reduction of ν when x approaches one of the extremes investigating the moment closure equations of the beta distribution in more detail also reveals that a feedback between ν and k ensures ν to be bounded to its ecologically feasible range in the ba model for example assuming the trait distribution to be symmetric an increase of ν leads to a decline of k eq 19 and fig 2f because only rather flat distributions can accommodate large values of ν when ν approaches its maximum value of 0 25 k decreases towards one indicating a bernoulli distribution which is a special extreme case of a symmetric bimodal distribution where all biomass is allocated to the shoulders of the trait distribution and none to the tails or the mean hence the factor in front of the second term of the rate of change of ν becomes zero see eq 14 so ν cannot grow further in contrast the normal distribution does not exhibit lower and upper limits and in addition its kurtosis does not depend on ν allowing ν to surpass its natural limit in na models cf tirok et al 2011 the good approximation of the fd model by the ba model under fluctuating selection agrees with recent findings of a stochastic population model for endemic infections a moment closure based on the discrete beta binomial distribution improved the reliability of a corresponding aggregate model to adequately represent the temporal development of x and ν of the probability distribution of infected individuals of a susceptible infected si logistic model krishnarajah et al 2005 furthermore the beta binomial distribution based moment closure was found to clearly outperform other moment closure approaches based on e g the normal or binomial distribution in matching the overall shape properties of the quasi stationary distribution of a sis logistic model clancy and mendy 2011 under disruptive selection both aggregate models failed to reproduce the biomass and trait dynamics of the fd model exhibiting a bimodal distribution with maximum ν despite the fact that our model gives rise to frequency dependent selection and thus may enable the emergence of convergent stable fitness minima in aggregate models cf abrams et al 1993b our analysis presented in appendix e shows that such minima do not exist in na models with a single predator leading to the same stability conditions for x with or without frequency dependent selection essentially the normal distribution cannot represent a bimodal distribution where x is located at the fitness minimum and thus is no longer representative of the entire community consequently x always moves towards a local fitness maximum in the na model at least under frequency independent selection where 2 f x 2 x x is negative so ν tends to zero over time when no other source of standing trait variation exists appendix e this is very important because high functional diversity may reduce the overall performance of the community because of suboptimal phenotypes i e due to negative second derivatives at the optimal mean trait value but at the same time may enable the community to adapt to new fitness optima when the environment is changing norberg et al 2001 in general a strong reduction in the trait variance of aggregate models due to the fitness gradient approximation may lead to a mismatch between the timescales of the aggregate model and a corresponding fd model coutinho et al 2016 which likely hampers the application of aggregate models to natural systems but see terseleer et al 2014 for an example furthermore in the na model x cannot overcome a fitness minimum separating different peaks from each other which strongly contrasts with fd models coutinho et al 2016 and potentially also with ba models appendix e hence considering local fitness gradients instead of entire fitness landscapes necessarily assumes the absence of multiple concurrent peaks in the fitness landscape in contrast our results demonstrate that higher derivatives of the fitness function and higher moments of the trait distribution are required to drive changes of the aggregate properties into the right direction under disruptive selection as shown in appendix e the negative correlations between the lower and higher moments entailed in the beta distribution and observed in the size distributions of the phytoplankton communities may contribute to the maintenance of ν and thus functional diversity over time in fact ν exhibits a potential stable fixed point larger than zero if x is located at a fitness minimum where the curvature of the fitness function is positive see fig e1 since skewness can stabilize a fixed point of x at a fitness minimum a stable solution of a ba model can exist with ν 0 even without immigration for details see appendix e indeed when the skewness and the local fitness gradient exhibit the same sign an increase in the variance is promoted norberg et al 2001 however in our case the second order approximation of the fitness function entailed in the ba model was not sufficient to maintain ν 0 as a result additional processes like immigration or mutation may be required to ensure ν 0 over time merico et al 2014 coutinho et al 2016 various mechanisms have been used to maintain ν cf merico et al 2014 for example while mutation is often viewed to have overall small effects on d x d t and d ν d t day 2005 immigration strongly influences them at low densities appendix e furthermore in the absence of mutational bias mutation has little impact on d x d t while preventing ν from getting vanishingly small a feature which can be derived when modelling the mutation process as trait diffusion coutinho et al 2016 as a result na models are sensitive to the added source of standing trait variation and thus to the choice of mechanism used to maintain ν coutinho et al 2016 this holds also for ba models because the sum of a beta distribution and another trait distribution is not necessarily beta distributed that is the moment closure equations might interfere with the other mechanism used to maintain ν for example adding standing trait variation to d ν d t of a ba model may strongly interfere with d x d t when x is close to one of the extremes because the moment closure equations can no longer represent adequately the actual values of s and k under such conditions in fact ν has to become very small when x approaches one of the extremes hence accounting for a process that only leads to an increase in ν without pushing x towards intermediate values will generally not work within the framework of a ba model consequently we could not derive a ba model that incorporates mutation as diffusion with a reflecting boundary because the beta distribution is defined on an open interval more generally these results underline the need to understand more clearly the potential effects of immigration and mutation on biomass trait feedbacks in trait based aggregate models 4 2 relevance of our findings for evolutionary ecology the aggregate model approach used in this study to describe the temporal dynamics of the aggregate properties of the trait distribution of a community is akin to various mathematical descriptions of trait adaptation in evolutionary ecology in line with classical quantitative genetics qg models that describe rapid or short term evolution within a population slatkin 1979 taper and case 1992 day 2005 aggregate models do not assume a separation of ecological and evolutionary times scales rather they consider explicitly the dynamical feedback between trait and biomass dynamics within a community norberg et al 2001 merico et al 2009 in addition both model approaches explicitly allow for standing trait variation and often rely on the assumption that the trait distribution is and remains normally distributed thereby enhancing numerical or analytical tractability of the model taylor and day 1997 coutinho et al 2016 this assumption is valid at the population level when considering the evolution of a quantitative trait in which numerous loci determine the individual s phenotype with each locus having a small additive effect on the phenotype slatkin 1979 kirkpatrick and rousset 2005 essentially in case of random mating sexual reproduction and recombination the trait distribution of a population can often be well approximated by a normal distribution with a particular x and ν lande 1976 barton and turelli 1989 in contrast there exists hardly any theoretical or empirical foundation for the gaussian approximation at the community level where trait changes mainly rely on species sorting gaedke and klauschies 2017 furthermore at the population level also various mechanisms exist that may promote non normally distributed trait values including assortative mating in sexual populations or clonal sorting in asexual populations doebeli et al 2007 sasaki and dieckmann 2011 hence the shape of trait distributions may often strongly deviate from a gaussian including skewed or bimodal trait distributions our results show that corresponding changes in skewness and kurtosis may strongly influence the biomass and trait dynamics and therefore model predictions cf fig 4 in contrast to many aggregate models that allow for simultaneous changes in x and ν norberg et al 2001 coutinho et al 2016 but see merico et al 2014 qg models often focus on changes in mean trait values by assuming ν to be constant taper and case 1985 1992 day 2005 the latter seems to be valid under weak selection in which case the selective advantage of different phenotypes is vanishingly small meaning that the fitness landscape is rather flat and thus the fitness function and its first derivative do not change much over the bulk of the trait distribution lande 1976 taylor 1996 lion 2018 however keeping ν constant may neglect a potentially very important feedback between d x d t and d ν d t because temporal changes in ν and x are tightly coupled to each other through their combined effects on the entire fitness landscape appendix a in line with previous studies norberg et al 2001 smith et al 2016 our results show that the speed of trait adaptation through higher ν comes at a cost of reduced fitness at the community level when x is located around a fitness maximum appendix e in contrast to qg and aggregate models the approach of adaptive dynamics ad considers long term evolution to be a mutation limited process giving rise to a separation of ecological and evolutionary time scales parker and maynard smith 1990 day 2005 the key assumption of ad is that a new but rare mutant with a slightly different phenotype than the resident phenotype arises at a point where the monomorphic resident population has reached its demographic equilibrium geritz et al 1998 mcgill and brown 2007 if the phenotype of the rare mutant is mal adapted it will necessarily die out whereas it will spread when it is advantageous replacing the former phenotype of the resident population evolution of the resident phenotype is then driven by a sequence of rare mutation and strong selection day 2005 kirkpatrick and rousset 2005 ad focuses on finding the evolutionary endpoints i e evolutionary singular strategies which can be reached by gradual evolution starting from a strategy nearby mcgill and brown 2007 such convergent stable strategies css can be either resistant stable ess or vulnerable branching point to invasion by other nearby strategies geritz et al 1998 doebeli et al 2007 in the latter case traits evolve to a point where selection becomes disruptive giving rise to dimorphism rueffler et al 2006 mcgill and brown 2007 at this point it becomes necessary to follow the evolution of two distinct phenotypes this contrasts with our ba model which describes the temporal development of a continuous trait distribution that may become bimodal and thus exhibit two dominant but distinct phenotypes furthermore aggregate models explicitly consider biomass and trait dynamics that occur on similar time scales and therefore account for the fact that changes in x or ν may strongly affect the stability and shape of biomass dynamics abrams and matsuda 1997 coutinho et al 2016 cortez and patel 2017 4 3 future perspectives to overcome the overall weak performance of trait based aggregate models under disruptive selection one may use a hybrid model here the mean trait and variance dynamics of two or more different species or functional groups are modeled separately using an aggregate model formulation for each species norberg et al 2012 klauschies et al 2016 hence the community is subdivided into a limited number of species or functional groups whose mean trait values and trait variances can in turn adapt in response to selection cf norberg et al 2001 terseleer et al 2014 in the context of genetics a similar approach was developed and advocated by sasaki and dieckmann 2011 where the trait distribution is decomposed into a sum of unimodal trait distributions corresponding to the individual morphs of a population this is reasonable when the entire trait distribution is oligomorphic or multimodal meaning that it comprises a finite number of distinct peaks each peak is associated with a different morph that can be viewed as a quasi species characterized by its particular trait distribution in line with qg models lande 1976 abrams et al 1993b d x i d t of morph i follows the product of ν i and f i x i x i x i under the assumption that all ν i are small for all i sasaki and dieckmann 2011 although our derivation of an aggregate model is also based on the assumption that ν is sufficiently small cf appendix a our results show that this approximation may capture also more complex scenarios where ν is temporarily quite large when assuming the trait values to be beta distributed cf fig 4 hence a promising avenue for future research would be to combine our novel moment closure approximation based on the beta distribution with a hybrid or oligomorphic dynamics approach the alternative to model the temporal dynamics of higher moments or to extend the second order approximation appears less promising given that the corresponding equations and numerical simulations become very demanding we established that the choice of a suitable moment closure approach strongly depends on the prevailing selection regime hence it is important to develop reliable tools to characterize the selection pressure on the trait composition of natural communities in the approach of adaptive dynamics the predominant selection pressure on a convergent stable strategy x of a population is estimated based on the sign of the second derivative of the mutant s invasion fitness with respect to its own strategy x evaluated at the resident strategy x i e 2 f x 2 x x negative values indicate stabilizing selection and thus an evolutionary stable strategy ess whereas positive values indicate disruptive selection and thus an evolutionary branching point that may give rise to dimorphisms geritz et al 1998 mcgill and brown 2007 these constraints are valid when assuming weak selection which implies that the distribution is tightly clustered around x lion 2018 they also hold when selection is not weak but a separation of time scales between ecology and evolution under rare mutations is assumed day 2005 in this case advantageous novel phenotypes are strongly and positively selected so that a monomorphic resident community can be assumed at the time a new mutant arises geritz et al 1998 accordingly a recently proposed approach to distinguish between the prevalence of stabilizing or disruptive selection in na models is based on the sign of their 2 f x 2 x x acevedo trejos et al 2016 however using a normal distribution based moment closure relies on the assumption that the environment imposes stabilizing or weak directional selection on the trait considered hence a verification of stabilizing selection cannot be attained by considering actual properties of the resulting equations of a na model because the result will not be independent of the assumption of normality and thus a prevalence of stabilizing selection as detailed in appendix e the temporal changes of x and ν promote negative values of 2 f x 2 x x without necessarily implying stabilizing selection in general the sign of 2 f x 2 x x does only inform reliably about the prevalence of stabilizing or disruptive selection when the fitness landscape can be well described by a parabolic function for which higher derivatives vanish cf abrams et al 1993a in all other cases the view that 2 f x 2 x x 0 provides clear evidence for stabilizing selection and 2 f x 2 x x 0 for disruptive selection is oversimplified and potentially wrong this happens because concomitant changes in x also promote negative values of 2 f x 2 x x under clearly disruptive selection regimes where two distinct fitness maxima co occur hence approaches developed in population genetics cf nelson et al 2005 siepielski et al 2009 fox et al 2010 may deliver more reliable estimates of the prevailing selection pressure on the trait composition of natural communities finally in line with ad and optimality approaches parker and maynard smith 1990 we may further enhance our understanding of trait based aggregate models by considering quasi equilibrium approximations based on a separation of time scales of the ecological biomass and the evolutionary trait dynamics geritz et al 1998 cortez and patel 2017 for example when ν is sufficiently small we can assume the evolutionary dynamics to be much slower than the ecological dynamics in this case the ecological variables will reach a quasi equilibrium at the current changing trait values day 2005 lion 2018 in contrast when organisms are able to quickly adapt their traits in response to selection we can assume that the evolutionary dynamics occur on a much faster time scale than the ecological dynamics smith et al 2009 abrams 2010 pahlow and prowe 2010 analyzing such fast slow dynamics may allow for the derivation of general results under simplifying assumptions cortez 2016 cortez and patel 2017 4 4 final remarks the small number of state variables of trait based aggregate models may enable rigorous analyses of their equations appendix e norberg et al 2001 and significantly reduce their simulation times when compared to corresponding full trait distribution fd models table 2 acevedo trejos et al 2016 however as moment approximations do not come with an estimate of the approximation error one usually has to resort to numerical simulations of the fd model to judge when the approximation is good enough to replicate the behavior of the fd model in practice this may question the general applicability of trait based aggregate models even though an aggregate model usually does not need to be validated for the entire parameter space nor the whole simulation time our work improves this situation in three ways in line with coutinho et al 2016 we first present detailed evidence that a general agreement between fd models and their aggregate counterparts is closely linked to the predominant selection regime hence comparing fd and corresponding aggregate models under different but well defined environmental conditions revealed the structural components i e the shape properties of the fitness landscape and trait distribution that are responsible for the success or failure of the approximations and thus which underlie the dynamics of the fd model therefore knowledge about the shape of natural trait distributions or corresponding selection regimes may sufficiently inform about the behavior of trait based aggregate models compared to corresponding fd models and circumvent the need for a detailed model comparison based on numerical simulations second we show that the beta distribution captures important shape properties of natural and simulated trait distributions which cannot be reflected by a gaussian but which are important to restrict changes in the mean trait and variance values to their ecologically feasible ranges in contrast na models usually require additional functional terms to keep traits bounded hence conducting a moment closure based on the well defined relationships between the lower and higher moments of the beta distribution instead of the normal distribution greatly enhanced the reliability of aggregate models under fluctuating selection this increases the range of situations that can be treated successfully using moment approximation methods finally we obtained a more comprehensive understanding of the mechanisms that may promote the maintenance of functional diversity in trait based aggregate models by analyzing the aggregate model equations we explicitly provide the connection between higher moments of the trait distribution and higher derivatives of the fitness landscape and the preservation of the trait variance for a quite general class of models see appendix e to conclude our study shows that conducting a moment closure based on the beta distribution rather than the normal distribution may strongly improve the reliability of aggregate models when applied to natural communities e g with respect to the temporal average and variation of the communities biomass and trait composition this holds in particular when mean trait values change over time e g due to strong fluctuating selection caused by endogenous or environmental changes such as seasonal temperature variation acknowledgments we thank ruben ceulemans ellen van velzen alice boit and three anonymous reviewers for helpful comments and suggestions tk was funded by the german research foundation dfg ga 401 26 1 rmc was supported through grant 2014 23497 0 são paulo research foundation fapesp brazil appendix a derivation of an aggregate model temporal changes in the aggregate properties of a community i e its total biomass r t mean trait x and trait variance ν can be conveyed from the changes of the population biomasses of the individual species a1 r x t f x r x i where f x denotes the per capita net growth rate the fitness function of the species with trait value x ranging between 0 and 1 whose biomass is r x the species fitness function f x r t x ν generally depends on the entire trait distribution of the community such as r t x and ν however for the sake of brevity we stick to f x throughout the derivation the small but constant immigration rate i ensures long term persistence of all trait values i e species the aggregate properties of a community are calculated according to the following set of equations a2 r t 0 1 r x d x a3 x 1 r t 0 1 x r x d x a4 ν 1 r t 0 1 x x 2 r x d x instead of describing the dynamics of the community with differential equations defined at the population level one may focus directly on a system of differential equations that describes the rates of change of the community s aggregate properties thereby allowing insight into the properties of the fitness landscape and trait distribution that drive their dynamics in general such aggregate models approximate the temporal development of the aggregate properties by first truncating the taylor series of the fitness function developed around x after some low order e g second order terms afterwards the resulting set of equations has to be closed by expressing the higher central moments such as skewness s and kurtosis k in terms of the lower central moments modelled such as x and ν as all odd moments skewness quantifies some degree of asymmetry of a distribution left skewed distributions exhibit negative values of s whereas right skewed distributions exhibit positive values of s in contrast kurtosis quantifies the amount of dispersion of mass around the shoulders x ν of a distribution based on this high values of k are associated with distributions having high mass at their center x and tails x 2 ν compared to their shoulders a 1 second order approximations of the rates of change of the aggregate properties the rate of change of rt is given by the integral of the rate of change of r x with respect to x over the trait range 0 1 a5 d r t d t d d t 0 1 r x d x 0 1 r x t d x 0 1 r x f x i d x 0 1 r x f x d x i 0 1 d x noting that 0 1 d x 1 and expanding the fitness function f in a taylor series around x we get a6 d r t d t 0 1 r x k 0 x x k k k f x x k x x d x i we can rearrange the terms of eq a6 to express the rate of change of rt as an infinite sum of products of the k th derivative of the fitness function and the k th central moment m k of the trait distribution a7 d r t d t r t k 0 1 k k f x x k x x 1 r t 0 1 r x x x k d x m k i to highlight the interaction between the higher order central moments and the higher derivatives we can rewrite eq a7 in the following way a8 d r t d t r t f x x x ν 2 2 f x x 2 x x m 3 6 3 f x x 3 x x m 4 24 4 f x x 4 x x i given that m 0 1 m 1 0 and m 2 ν similarly the rate of change of x is given by the quotient rule of differential calculus using eq a3 a9 d x d t 1 r t 2 d d t 0 1 x r x d x r t 0 1 x r x d x d r t d t using the definition of x eq a9 can be expressed as a10 d x d t 1 r t 0 1 x r x t d x x d r t d t by extending the first term of eq a10 with x we can eliminate its second term a11 d x d t 1 r t 0 1 x x x r x t d x x d r t d t 1 r t 0 1 x x r x t d x x 0 1 r x t d x x d r t d t 1 r t 0 1 x x r x t d x 1 r t 0 1 x x r x f x i d x evaluating the effect of external immigration i leads to a12 1 r t 0 1 x x r x f x d x i r t 0 1 x x d x 1 r t 0 1 x x r x f x d x i r t x 2 2 x x 0 1 1 r t 0 1 x x r x f x d x i r t 1 2 x expanding again the fitness function f in a taylor series around x and rearranging the terms thereafter we get a13 d x d t 1 r t 0 1 r x k 0 x x k k k f x x k x x x x d x i r t 1 2 x k 0 1 k k f x x k x x 1 r t 0 1 r x x x k 1 d x m k 1 i r t 1 2 x with m k 1 denoting the k 1 th central moment of the trait distribution again we rewrite eq a13 to highlight the interaction between the higher central moments of the trait distribution and the higher derivatives of the fitness function a14 d x d t ν f x x x x m 3 2 2 f x x 2 x x m 4 6 3 f x x 3 x x i r t 1 2 x given that m 1 0 and m 2 ν finally the rate of change of ν is also given by the quotient rule of differential calculus a15 d ν d t 1 r t 2 d d t 0 1 x x 2 r x d x r t 0 1 x x 2 r x d x d r t d t now we use the product rule of differential calculus and the definition of the variance to display eq a15 as a16 d ν d t 1 r t 0 1 r x t x x 2 d x 0 1 r x d x x 2 d t d x ν d r t d t applying the chain rule of differential calculus we see that the second term of eq a16 is zero a17 1 r t 0 1 r x d x x 2 d t d x 1 r t 0 1 r x 2 x x d x x d t d x 2 1 r t 0 1 r x x x d x d t 0 d x 2 d x d t 1 r t 0 1 r x x x d x m 1 0 deploying this result into eq a16 leads to a18 d ν d t 1 r t 0 1 r x t x x 2 d x ν d r t d t 1 r t 0 1 f x r x i x x 2 d x ν d r t d t again evaluating the effect of external immigration i leads to a19 i r t 0 1 x x 2 d x i r t x 3 3 x x 2 x 2 x 0 1 i r t 1 12 1 2 x 2 leading to a20 d ν d t 1 r t 0 1 f x r x x x 2 d x ν r t d r t d t i r t 1 12 1 2 x 2 conducting a taylor expansion of the fitness function around x in the first term and applying the results from eq a7 to its second term d ν d t can be written as a21 d ν d t k 0 1 k k f x x k x x 0 1 r x r t x x k 2 d x m k 2 ν k 0 1 k k f x x k x x 0 1 r x r t x x k d x m k i r t 1 12 v 1 2 x 2 k 0 m k 2 ν m k 1 k k f x x k x x i r t 1 12 v 1 2 x 2 in analogy to eq a14 we rewrite eq a21 in the following way a22 d ν d t ν ν m 0 1 0 f x x x m 3 ν m 1 0 m 3 f x x x x m 4 ν 2 2 2 f x x 2 x x m 5 ν m 3 6 3 f x x 3 x x i r t 1 12 v 1 2 x 2 since skewness s and kurtosis k are defined as the standardized central moments of third m 3 s ν 3 2 and fourth m 4 k ν 2 orders of a trait distribution a second order approximation in f of d r t d t eq a8 d x d t eq a14 and d ν d t eq a22 leads to the aggregate model defined by the eqs 12 14 in the methods section this approximation is good when v is small or the non linearity of the fitness function f is weak abrams et al 1993a taylor and day 1997 gaedke and klauschies 2017 finally since the rates of change of the lower central moments depend on the higher central moments one has to close the system of differential equations this is usually achieved by expressing the higher moments in terms of the lower ones there are different moment closure techniques available each making distinct assumptions about the shape of the trait distributions wirtz and eckhardt 1996 norberg et al 2001 merico et al 2009 for simplicity a normal distribution based moment closure is often conducted tirok et al 2011 terseleer et al 2014 acevedo trejos et al 2015 where s 0 and k 3 are independent of x and ν this strongly reduces the complexity of the aggregate model defined by eqs 16 and 17 at the cost of assuming the trait to be defined on an infinite range and the trait distribution to be unimodal and symmetric however ecologically important traits such as body size or time spent for searching or handling prey items are restricted to a finite range in addition fluctuating or disruptive selection may promote trait distributions exhibiting skewness or bimodality coutinho et al 2016 gaedke and klauschies 2017 for this reason we will derive an alternative moment closure based on the assumption that the trait distribution follows the shape of a beta distribution which can accommodate such features cf fig 1 a 2 beta distribution based moment closure assuming the trait value x to be beta distributed r x can be written as a23 r x a b r t b a b x a 1 1 x b 1 with b 0 1 x a 1 1 x b 1 d x being the beta function and a 0 and b 0 being the shape parameters of the beta distribution the mean x variance ν skewness s and kurtosis k of the beta distribution are given by gupta and nadarajah 2004 a24 x a a b a25 ν a b a b 2 a b 1 a26 s 2 b a a b 1 1 2 a b 2 a b 1 2 a27 k 6 a b 2 a b 1 6 a b a b 2 a b a b 2 a b 3 since the beta distribution only depends on the two shape parameters a and b we can derive corresponding moment closure equations for an aggregate model in that s and k of the beta distribution are expressed in terms of x and ν only first we have to employ eqs a24 and a25 to express a and b as functions of x and ν substituting a b a x and b a 1 x x from eq a24 into eq a25 we get a28 ν a 2 1 x x a x 2 a x 1 x 1 x a x 1 rewriting eq a28 in terms of a as a function of x and ν leads to a29 a x 2 1 x x ν ν furthermore substituting eq a29 into an alternative form of eq a24 i e b a 1 x x leads to an expression of b as a function of x and ν a30 b x 1 x 2 1 x ν ν now we use eqs a24 a25 a26 a29 and a30 to express s as a function of x and ν rewriting eq a24 as a b a x or b a 1 x x and eq a25 as ν 1 2 a b 1 a b 1 1 2 a b 1 2 and substituting them sequentially into eq a26 leads to a31 s 2 b a a b 2 a b ν 1 2 2 b a a x 2 a x ν 1 2 2 a 1 x x 1 a x 2 a x ν 1 2 2 1 2 x x a x 2 1 x ν 1 2 2 1 2 x a x 2 ν 1 2 furthermore substituting eq a29 into eq a31 now allows to write s as a function of x and ν a32 s 2 1 2 x x 2 1 x x ν ν x 2 ν 1 2 2 1 2 x x 1 x ν 1 ν 1 2 2 1 2 x ν 1 2 x 1 x ν finally we use eqs a24 a27 a29 and a32 to express k as a function of x ν and s rewriting eq a27 leads to a33 k 6 a b 2 a b 1 a b a b 2 a b 3 6 a b 3 3 a b 2 2 a b 3 4 b a 2 a b 1 a b 2 2 a b 6 a b 3 now we can simplify the first term of eq a33 by rewriting the first factor and substituting the second factor by the square of s i e s 2 4 b a 2 a b 1 a b 2 2 a b leading to a34 k 2 a b 4 a b 12 4 a b 3 s 2 6 a b 3 a b 2 a b 3 1 s 2 6 a b 3 rewriting eq a24 as a b a x and substituting it into eq a34 leads to a35 k a x 2 a x 6 1 s 2 6 a x 3 using eq a29 we can express k as a function of x and ν leading to a36 k x 1 x ν ν 2 x 1 x ν ν 6 1 s 2 6 x 1 x ν ν 3 x 1 x ν 2 x 1 x 2 ν 6 ν 1 s 2 6 ν x 1 x ν 3 ν x 1 x ν 2 x 1 x 4 ν 1 s 2 6 ν x 1 x 2 ν finally rewriting eqs a32 and a36 in terms of the third and fourth central moments allows us to conduct a beta distribution based moment closure plugging the following set of equations into expressions a8 a14 and a22 a37 m 3 s ν 3 2 2 1 2 x ν 2 x 1 x ν a38 m 4 k ν 2 1 x x ν 4 ν 2 1 x x 1 s 2 6 ν 2 ν 1 x x 3 ν 2 hence trait distributions with smaller ν are unimodal but also often peaked high k and skewed high s depending on x in contrast trait distributions with larger ν tend to be flat or in its extreme bimodal low k and symmetric s 0 fig 1 appendix b sensitivity analysis i changes in model structure to test the robustness of our results with respect to changes in the model structure we conducted numerical simulations with three other ecological models partly used in recent studies demonstrating the suitability of aggregate model approaches first we investigated the predator prey model from merico et al 2009 in which the trade off between the nutrient uptake efficiency of the prey and its defense against predation imposes stabilizing selection on the trait distribution of the prey community second we explored the species competition model from norberg et al 2001 in which recurrent changes of an environmental factor such as temperature impose fluctuating selection on different species third we analyzed a modified version of our predator prey model from the main text in which a trade off between the vulnerability of the prey species with respect to grazing by the two specialist predators imposes disruptive selection on the trait distribution of the prey community in all three cases we first run numerical simulations of the full trait distribution fd model by discretizing the trait axes of the associated community n 101 afterwards we derived the equations of a corresponding aggregate model with a second order approximation and performed a moment closure either based on a beta distribution or a normal distribution subsequently we also conducted numerical simulations of the corresponding ba and na models and compared their results to the ones of the fd model b 1 full trait distribution model with stabilizing selection following merico et al 2009 we first consider a chemostat model with a set of prey species c that differ in their trait values influencing their uptake of nutrients n and vulnerability to predation by a single predator b the corresponding set of differential equations is given as follows b1 d n d t μ c κ 0 1 n n k n x c x d x m c κ c t δ n 0 n b2 c x t μ c n n k n x μ b ε φ x b 0 1 φ x c x d x k c m c δ c x b3 d b d t μ b κ 0 1 φ x c x d x 0 1 φ x c x d x k c m b δ b the nutrient replenishment in the chemostat depends on the nutrient concentration n0 that enters the chemostat vessel the dilution rate δ and the nutrient recycling through prey mortality m c cf merico et al 2009 in contrast the nutrient uptake of the prey follows a michaelis menten kinetic with the maximum uptake rate μ c and the effective half saturation constant k n x k n 1 κ φ x 1 which depends on the basal half saturation constant k n the fraction of energy invested in generic biomass κ and the prey s edibility φ x x 1 κ 1 which is a function of the prey s level of defense x given that φ x 1 κ can range from 1 to for details see merico et al 2009 it is impossible to develop a beta distribution based aggregate model that considers trait variation in the prey s edibility because the beta distribution is constrained to the open interval 0 1 hence in contrast to merico et al 2009 we considered trait variation in the prey s defense level x φ φ 1 κ 1 that actually varies between 0 and 1 the prey species are assumed to exhibit a trade off between their nutrient uptake efficiency k n x and defense level x φ which determines the vulnerability to grazing by the predator hence the partitioning of the remaining fraction of energy 1 κ between nutrient harvesting biomass and defense biomass is species specific for details see merico et al 2009 the corresponding shape of the trade off imposes stabilizing selection on the trait distribution of the prey community in addition foraging on the prey follows a type ii functional response with maximum growth rate μ b conversion efficiency ε and half saturation constant k c like the prey the predator experiences natural mortality m b and is washed out from the chemostat with the dilution rate δ in accordance with our previous results for stabilizing selection shown in the main text fig 3 both aggregate models perfectly captured the macroscopic properties of the fd model fig b1 the total biomass of the prey community and the predator biomass exhibited regular oscillations whereas the mean trait value reached an equilibrium after a short transient as a result of stabilizing selection the variance dropped towards zero which strongly reduced the adaptive capacity of the prey community cf merico et al 2009 the numerical integration of both aggregate models were up to 4 times faster than that of the fd model table b1 there was no significant difference between the simulation times of the ba model and the na model hence the results of both aggregate models are reliable under stabilizing selection and their numerical integration is computationally more efficient than running simulations of the fd model b 2 full trait distribution model with fluctuating selection in line with norberg et al 2001 we further consider a species competition model with a set of species c that compete for a shared resource and that exhibit differences in their trait values the corresponding equations to describe the temporal changes in the biomasses of the different species are b4 c x t p e x e σ 2 1 c t k d c x i the model extends logistic growth by including interspecific competition with k and c t being the joint carrying capacity and the sum of all population biomasses respectively the growth rate of a species further depends on its specific phenotype x varying between 0 and 1 the maximum growth rate p and the state of a time varying environmental factor e a sin ω t m which oscillates around a fixed value m with amplitude a and frequency ω to restrict e and thus the trait distribution to the ecologically feasible range 0 1 we chose m and a to equal 0 5 respectively the influence of the environmental changes on the species growth rates depends on the scaling parameter σ hence the recurrent changes in the environmental conditions e impose fluctuating selection on the underlying populations because different species are favored by the enviroment at different times furthermore the biomasses of the populations are declining at the mortality rate d to ensure the coexistence of all species a constant amount of biomass of each species was assumed to enter the system through immigration hence we added the immigration rate i to eq b4 in line with our previous results for fluctuating selection fig 4 the ba model captured the overall shape of the dynamics of the total biomass mean trait and trait variance of the fd model and their temporal averages quite well fig b2 in contrast the na model agreed with the fd model only with respect to the time averages of the aggregate properties and the shape of the mean trait dynamics generally the mean trait value of the community closely tracked the temporal changes of the optimal trait value currently selected by the environment fig b2d f however the sinusoidal shape of the environmental factor resulted in a time averaged bimodal distribution of the optimal trait values kremer and klausmeier 2017 consequently the community was generally better adapted during times when the sign of the rate of change of the environmental factor was changing this resulted in biomass dynamics where a larger peak in the total biomass at mean trait values close to the extremes followed a smaller peak in the total biomass at a mean trait value of 0 5 cf norberg et al 2001 this pattern was nicely encompassed in the results of the ba model but not in the ones of the na model fig b2a c in contrast to the fd and ba models the biomass dynamics of the na model exhibited a lower frequency and two differently sized peaks that were only associated with mean trait values close to the extremes furthermore when the environmental conditions changed towards more intermediate optimal trait values a larger range of trait values was favored promoting simultaneous growth of many different species consequently in the fd model we observed an overall increase in the trait variance that was interrupted by a short period when the variance declined again the latter resulted from a strong reduction in the biomasses of species exhibiting more extreme trait values hence the variance dynamics of the fd model showed a larger peak in the trait variance that preceded a smaller peak for details see fig 2 from norberg et al 2001 in contrast when the environmental conditions selected for extreme trait values we observed a strong reduction in the trait variance although the smaller peak of the trait variance was not well expressed in the ba model the general course of the temporal dynamics of the trait variance was still very similar to the fd model the ba model reflects the frequency and the amplitude of the dynamics as well as the presence of a pronounced peak in the trait variance at a particular moment in time in contrast the na model showed hardly any temporal variation in the trait variance hence the accuracy of our novel moment closure method based on the beta distribution strongly exceeded the one of a corresponding normal distribution based moment closure approach under fluctuating selection our result is further supported by the good performance of a data based aggregate predator prey model from norberg et al 2001 that accounted for important statistical relationships between lower and higher moments the numerical integration of both aggregate models was almost twice as fast as that of the fd model whereas the simulation times of the ba model and the na model were similar table b1 b 3 full trait distribution model with disruptive selection finally we consider a model with two different predators c that are grazing upon a set of prey species r with continuous trait values in contrast to our predator prey model from the main text we assumed the shape of the feeding functions to be sigmoidal instead of unimodal furthermore we assumed the strength of resource competition to differ between the different prey species the corresponding population biomasses thus change according to the following set of equations b5 r x t r 1 0 1 c x x r x d x κ r x i 1 2 a i x r x c i 1 h 0 1 a i x r x d x i b6 d c i d t ε 0 1 a i x r x d x 1 h 0 1 a i x r x d x d c i b7 c x x 1 σ 2 π e 1 2 x x σ 2 b8 a 1 x a m a x a m i n 1 e s x w 1 a m i n b9 a 2 x a m a x a m i n 1 1 e s x 1 w 1 a m i n in the absence of predation the prey species exhibit logistic growth with r and κ being the maximum growth rate and joint carrying capacity respectively given that trait differences may result in niche differences between species the strength of competition may depend on the species trait similarity hence we implemented the competition kernel c macarthur and levins 1967 and thus assumed that prey species with more similar trait values are competing more strongly with each other than species with very different trait values this is in line with the assumption that intraspecific competition of the prey is larger than interspecific competition which stabilizes species coexistence the width of the competition kernel is determined by the scaling parameter σ furthermore predation follows a type ii functional response with a common handling time h and the predator specific attack rates a 1 and a 2 with minimum and maximum values of a m i n and a m a x hence the predation rates of the two different predators depend on the phenotype x of the individual prey species in line with previous work from abrams 2006 and schreiber et al 2011 we assumed a trade off between the prey s vulnerability to predation by the two specialist predators the shape of which depend on the parameters s and w by using a value of w equal to 0 75 we generated a concave shaped trade off curve that imposes disruptive selection on the trait distribution of the prey community nevertheless we ensured the persistence of all prey by adding the immigration rate i to eq b5 in line with our previous results for disruptive selection displayed in the main text fig 6 both aggregate models failed to reproduce the dynamics of the aggregate properties of the fd model here the total biomasses of the prey and predator communities showed regular predator prey cycles because the population biomasses of the two predators were synchronized fig b3 a in addition the trait distribution of the prey community was symmetric around the mean trait value of 0 5 throughout time fig b3d depending on the respective strength of competition and predation the shape of the trait distribution of the prey community was either rather uniform or bimodal at low prey biomasses immigration strongly influenced the population dynamics promoting uniform trait distributions of the prey community with variance values down to 1 12 fig b3a and g in contrast a high predation pressure on the prey species with intermediate trait values at high prey biomasses selected for bimodal trait distributions with variance values up to 0 2 neither the ba model nor the na model was able to reproduce these patterns despite showing regular predator prey oscillations both aggregate models underestimated the amplitude of the total biomass of the prey community fig b3a c furthermore and in contrast to the fd model one of the predators went extinct however in line with our previous results e g fig 5 the values of the mean trait and trait variance stayed within the ecologically feasible ranges in the ba model fig b3e and h in contrast the aggregate properties surpassed their natural limits in the na model fig b3f and i the numerical integration of both aggregate models was about 30 times faster than that of the fd model but this strong reduction in simulation time comes at a too high cost given that the results of the aggregate models are not reliable unexpectedly the simulation time of the na model was somewhat longer than the one of the ba model table b1 while the gaussian based approximation is valid in a narrower parameter range than the beta approximation the na model may be more useful in practice if both model types are sufficiently accurate this may follow from the fact that the na model is far simpler than the ba model and so it should be both computationally faster to calculate and easier to work with analytically however the computation times depend not only on the complexity of the moment closure terms themselves but also on the stiffness of the resulting equations that strongly depends on the derivatives of the fitness landscape and this favors in general the beta distribution when the trait range is finite furthermore reliable trait based aggregate models should not only provide shorter simulation times but also be easier to fit to data cf fig 2 appendix c sensitivity analysis ii changes in parameter values to test the robustness of our results with respect to parameter changes we conducted numerical simulations with different carrying capacities κ 10 0 7 10 0 71 10 1 3 and minimum attack rates a m i n 2 1 2 1 1 2 3 thereby simulating changes in the bottom up regulation and top down control of the prey community under fluctuating selection in addition we tested for a potential dependency of the biomass and trait dynamics on immigration by running further simulations of the different models for very different immigration rates i 10 2 10 2 1 10 6 all other parameter values were the same as before see table 1 for a few simulations we had to increase the precision of the solver reducing the relative and absolute tolerances and maximum step size cf figs c2 and c3 grey shaded areas the corresponding results show that the temporal mean and variance of the biomass and trait dynamics are very similar across the range of parameter values evaluated for the three different parameters figs c1 c3 furthermore the exact shape of the trait and biomass dynamics of the beta distribution based aggregate ba and full trait distribution fd models also agreed very well for most of the three parameter ranges considered i e for 1 3 l o g 2 a m i n 2 7 for 20 κ 8 and for 2 l o g 10 i 5 2 for a representative example see fig 4 hence the general results described in the main text are fairly robust with respect to parameter changes however as with the results of the normal distribution based aggregate na model for the entire ranges of the three parameters the biomass and trait dynamics of the ba model were very different from the ones of the fd model in case of very low immigration rates and rather low carrying capacities the former result implies that a small amount of immigration and thus standing trait variation is necessary to ensure ongoing oscillations in the biomass and trait values of the ba model and thus a good match with the fd model this happens because the second order correction of d x d t is not strong enough to prevent x from becoming stuck at a local fitness maximum when immigration and thus standing trait variation as well as the third central moment are too low in addition reducing the carrying capacity to rather low values strongly stabilized the predator prey biomass dynamics fig c2 as a result changes in the fitness landscape were less pronounced so that it became more likely for x to get stuck at a persistent local fitness maximum despite the second order correction based on the previous results fig 5 we can expect that the na model comprises alternative stable states throughout the ranges of the different parameters in addition because the food web structure is symmetric we also expect that the ba model will exhibit an alternative state for lower values of the carrying capacity and low values of the immigration rate the numerical integration of the ba model was quite demanding or even not feasible in small regions of the parameter space of κ and i figs c2 and c3 grey shaded areas a possible explanation is that the assumed shape of a trait distribution generally imposes some constraints on the conditions including initial conditions and parameters under which a corresponding aggregate model can provide an adequate representation of the biomass and trait dynamics for example in the ba model the shape of the trait distribution of the immigrating community is assumed to follow a uniform distribution whereas the one of the resident community is assumed to follow a beta distribution however as is also the case with the normal distribution the sum of a beta and a uniform distribution does not necessarily have to be beta distributed in such a case the relationships between the lower and higher moments cannot be adequately described anymore by the moment closure equations of the beta distribution hence the beta distribution based moment closure may interfere with the mechanism assumed to maintain the trait variance as a potential result the ba model may not have a suitable solution or numerical integration may get very laborious due to stiffness appendix d skewness restricts mean trait values to the ecologically feasible range in contrast to the na model the mean trait value x of the ba model always stayed within its ecologically feasible range because the beta distribution is intrinsically bounded here we show that this feature may generally arise from a strong increase in skewness s when x approaches one of the extremes to focus on the effect of changes in s alone on the biomass and trait dynamics we derive here an aggregate model based on the assumption that the shape of the trait distribution follows a special case of the johnson sb distribution johnson 1949 and thus becomes skewed when x approaches one of the extremes for details see below nevertheless the initial approximations made in the derivation ensure that no other terms arise that may reflect accompanying changes in the kurtosis k of the trait distribution hence any effect that arises has to be attributed to s alone in accordance with the analysis performed for the model comparison presented in the main text we conducted numerical simulations of our johnson sb distribution based aggregate model ja model under different selection regimes all corresponding simulations lasted for 104 time units overall the simulation results of the ja model were very similar to the ones of the na model compare fig d1 to figs 3 5 and 7 of the main text however the mean trait value x of the ja model never exceeded its ecologically feasible range which contrasts with the results of the na model this feature was independent of the selection regime imposed compare fig d1 to figs 5 and 7 of the main text this is explained by the strong decline of ν due to increasingly large absolute values of s when x approaches one of the extremes quickly slowing down d x d t hence an increase in s limits the changes in x indirectly via changes in ν this feedback between d x d t and d ν d t suggests that the skewness and thus asymmetry of a trait distribution is very important for preventing the emergence of unrealistic values of the aggregate properties we acknowledge that in addition to the indirect effect of s x may also be more directly limited in the ba model via the second term of eq 13 for example in the simplest case of disruptive selection the fitness gradient drives x towards one of the extreme values cf fig e1b e however since the second derivative is positive the sign and value of s operate in the opposite direction to the fitness gradient cf fig e1e h slowing down d x d t and likely preventing x from overcoming its limits neither mechanism described can act in the na model to restrict mean trait values to their ecologically feasible ranges derivation of the johnson sb distribution based aggregate ja model in contrast to appendix a we now assume that the trait x is a function of another trait y whose values are assumed to be normally distributed following abrams 1999 we used a sigmoidal function to describe the transformation of the trait y defined on a continuous infinite range to the trait x defined on a continuous finite range between zero and one d1 x y e y 1 e y hence the distribution of x is a special case of the johnson sb distribution i e a logit normal distribution with parameters γ 0 δ 1 μ y and σ ν y johnson 1949 although the johnson sb distribution may in principle also be bimodal our derivation below does not give rise to terms that may reflect excess kurtosis and thus bimodal shape properties when conducting a moment closure based on the assumption of normally distributed trait values y i e y n y ν y a second order approximation of the equation describing the temporal dynamics of y is given by see eq 16 of the methods section d2 d y d t ν y f y y y where f is the per capita net growth rate fitness of the species as a function of y the mean trait x is given by d3 x n y x y d y a taylor expansion of x y around y yields d4 x n y k 0 y y k k k x y y k y y d y k 0 1 k k x y y k y y n y y y k d y m k for simplicity we will use a first order approximation of x d5 x x y y y ν y 2 2 x y y 2 y y m 3 6 3 x y y 3 y y m 4 24 4 x y y 4 y y x y applying twice the chain rule the temporal dynamics of x is described by d6 d x d t d x d y d y d t d x d y ν y f y y y d x d y ν y d x d y f x x x y y ν y d x d y 2 f x x x based on eq d5 the derivative of x with respect to y is given by d7 d x d y e y 1 e y e y e y 1 e y 2 e y 1 e y 1 e y e y 1 e y x 1 x inserting eq d7 into eq d6 yields d8 d x d t ν y x 1 x 2 f x x x in analogy to eq 16 or eq d2 the product in front of the first derivative of eq d8 is akin to the variance of the trait x hence defining ν x ν y x 1 x 2 eq d8 becomes d9 d x d t ν x f x x x proceeding as before a second order approximation of the equation describing the temporal dynamics of ν y is given by see eq 17 of the methods section d10 d ν y d t ν y 2 2 f y 2 y y applying first the chain rule and then using eqs d9 and d10 the equation describing the temporal dynamics of ν x is given by d11 d ν x d t ν x ν y d ν y d t ν x x d x d t ν x ν y ν y 2 2 f y 2 y y ν x x ν x f x x x given that ν y ν x x 1 x 2 we can express ν x x as d12 ν x x 2 ν y x 1 x 1 2 x ν x 2 1 2 x x 1 x inserting eq d12 ν x ν y x 1 x 2 and ν y 2 ν x 2 x 1 x 4 into eq d11 yields d13 d ν x d t ν x 2 x 1 x 2 2 f y 2 y y ν x 2 2 1 2 x x 1 x f x x x rewriting 2 f y 2 y y leads to d14 2 f y 2 y y f y y y y d x d y f x x x y y y 2 f x y x x y y d x d y f x x x d 2 x d y 2 2 f x 2 x x d x d y d x d y f x x x d 2 x d y 2 2 f x 2 x x d x d y 2 f x x x d 2 x d y 2 using eq d7 the second derivative of x with respect to y is given by d15 d 2 x d y 2 d d x d y d y d x 1 x d y d x d y 1 x x d x d y d x d y 1 2 x x 1 x 1 2 x inserting eq d7 and eq d15 into eq d14 yields d16 2 f y 2 y y 2 f x 2 x x x 1 x 2 f x x x x 1 x 1 2 x now substituting eq d16 into eq d13 and simplifying the resulting expression gives d17 d ν x d t ν x 2 2 f x 2 x x 3 1 2 x x 1 x f x x x in line with eq 14 of the methods section we can rewrite eq d17 as d18 d ν x d t s ν x 3 2 f x x x ν x 2 2 f x 2 x x with s 3 1 2 x ν x x 1 x representing the skewness of the trait distribution notice that s is symmetrical around 0 5 and tends to positive or negative infinity when x approaches the extremes of the trait range 0 and 1 finally we add the immigration terms of eqs 13 and 14 to eqs d9 and d18 leading to the following approximated equations of an aggregate model based on the assumption that x follows a unimodal but skewed trait distribution d19 d x d t ν x f x x x i r t 1 2 x d20 d ν x d t s ν x 3 2 f x x x ν x 2 2 f x 2 x x i r t 1 12 ν x 1 2 x 2 this johnson sb distribution based aggregate model ja model underlies the results presented in fig d1 appendix e skewness and kurtosis jointly promote the maintenance of functional diversity we found strong negative correlations between the skewness s and the mean x and between the kurtosis k and the variance ν of the observed phytoplankton size distributions that are well captured by the beta distribution fig 2 here we show that these relationships may provide a general and intrinsic mechanism to promote the maintenance of functional diversity i e strictly positive values of the trait variance in trait based aggregate models even in the absence of frequency dependent selection in order to do so we analyzed the stability of potential fixed points of the approximated aggregate model equations under simplifying assumptions for two different moment closure approaches and run additional simulations of an extended version of the ba model e 1 convergent stable fitness minima under frequency independent selection according to appendix a the equations describing the temporal dynamics of x and ν of a full trait distribution fd model which does not contain immigration are approximated up to the second order as e1 d x d t ν f x x x x s ν 3 2 2 2 f x x 2 x x e2 d ν d t s ν 3 2 f x x x x k ν 2 ν 2 2 2 f x x 2 x x for convenience we will first neglect frequency dependent natural selection which allows us to explore a novel mechanism that can stabilize a fixed point of the mean trait value at a fitness minimum hence we suppose the species fitness function f to depend only on the total biomass r t and its individual trait value x but not on the mean and variance of the entire frequency trait distribution cf abrams et al 1993b however our results may also apply to some special cases of frequency dependent selection as discussed in more detail below assuming a normal trait distribution enables a moment closure of the aggregate model based on s m 3 ν 3 2 0 and k m 4 ν 2 3 and thus allows a simplification of eqs e1 and e2 to e3 d x d t ν f x x x x e4 d ν d t ν 2 2 f x x 2 x x hence the mean trait x changes in the direction of the local fitness gradient and thus moves towards a local maximum of the ﬁtness landscape f x where it remains constant once reaches it because the local fitness gradient f x x x is zero at this point fig e1 at or near a local fitness maximum the second derivative of the fitness landscape evaluated at the mean trait value 2 f x 2 x x attains a negative value so that the trait variance ν vanishes and the system loses its adaptability since x can no longer change this demonstrates that the equations of a na model inherently promote the loss of functional diversity also under scenarios of disruptive selection fig e1a d g so that it has to be maintained by other ecological processes such as immigration mutation or more complex trade off structures tirok et al 2011 merico et al 2014 coutinho et al 2016 in contrast as shown below the relationships between lower and higher central moments entailed in the beta distribution based moment closure equations offer an alternative explanation and mechanism for the maintenance of functional diversity and thus for keeping ν above zero in order to achieve a basic understanding of how the different functional terms of eqs e1 and e2 may interact to shape the overall temporal dynamics of x and ν we first analyze the local stability of a potential fixed point x of eq e1 i e we consider a situation where d x d t x x 0 for simplicity we assume that the skewness depends only on the mean trait value s x while the kurtosis depends only on the trait variance k ν this seems to be reasonable given that x explains much of the variation in s and ν explains much of the variation in k both for natural and simulated trait distributions fig 2 we also assume that the trait distribution is symmetric at the equilibrium i e s x 0 which seems to be valid under rather balanced selection regimes where the fitness landscape is also symmetric around x fig e1 under these simplifying conditions the full jacobian of the two dimensional system of eqs e1 and e2 at the fixed point with positive ν becomes diagonal allowing us to perform the analysis of each equation separately hence in this case a potential fixed point x of eq e1 satisfies the following condition f x x x 0 therefore x is situated either at a local fitness maximum or at a local fitness minimum of the corresponding fitness landscape considering that 2 f x 2 x x 0 we disregard the possibility of an inflection point which would require very special assumptions about the fitness function f a negative value of the derivative of eq e1 with respect to x evaluated at x implies its local stability e5 d d x d t d x x x ν 2 f x x 2 x x s x x x ν 3 2 2 2 f x x 2 x x s ν 3 2 2 3 f x x 3 x x since the trait distribution is assumed to be symmetric at the equilibrium i e s x 0 this simplifies to e6 d d x d t d x x x ν 2 2 s x x x ν 1 2 2 f x x 2 x x in line with the general properties of eq 18 and the observed negative correlation between s and x of the phytoplankton size distributions fig 2 we expect that s x x x 0 given that 2 f x 2 x x is negative at a fitness maximum cf fig e1 x will be stable when s x x x ν 1 2 2 and unstable otherwise in contrast 2 f x 2 x x is positive at a fitness minimum cf fig e1 so x will be stable if 2 s x x x ν 1 2 and unstable otherwise remarkably this means that if a small perturbation of x from its equilibrium x leads to a substantial increase of s of the trait distribution and ν is large enough a fixed point at a fitness minimum will be stable the local fitness landscape around the fixed point x can be approximated by a parabolic function so a perturbation of x away from x leads to asymmetric growth skewing the trait distribution moreover since the fitness function decreases towards x fig e1e s x will have the opposite sign of x x so s x x x will be negative this change in s increases with the degree of curvature of the local fitness landscape 2 f x 2 x x hence a fixed point at a fitness minimum is likely to be stable when the local fitness landscape exhibits a pronounced valley cf fig e1 this contrasts with the results of a na model cf eqs e3 and e4 where the fixed point x of d x d t at a fitness maximum is always stable and at a fitness minimum always unstable with this insight at hand we will now consider eq e2 describing the temporal development of the trait variance ν i e functional diversity in response to selection since the mean trait value x x is at a fixed point at a fitness minimum or maximum the local fitness gradient f x x x x equals zero hence eq e2 simplifies to e7 d ν d t k ν 2 ν 2 2 2 f x x 2 x x this equation has at most two ﬁxed points once again disregarding an inflection point of the fitness function an ecologically trivial one ν 0 and a nontrivial one that is implicitly defined by the equation k ν 1 the local stability of the latter can be determined from the sign of the following equation e8 d d ν d t d ν ν ν 2 f x x 2 x x k ν ν 2 2 k 2 ν 2 2 ν 2 ν ν 2 f x x 2 x x k ν ν 2 2 ν k 1 ν ν hence setting k ν 1 into eq e8 leads to e9 d d ν d t d ν ν ν 2 f x x 2 x x k ν ν 2 2 ν ν in line with the general properties of eq 19 and the observed negative correlation between k and ν of the phytoplankton size distributions fig 2 we expect that k ν ν ν 0 hence the ecologically non trivial fixed point ν is stable when the fixed point x is at a fitness minimum and unstable when the fixed point x is at a fitness maximum taking the two results of the preceding linear stability analyses of x and ν together we found that the negative correlations between lower and higher central moments may jointly promote the maintenance of functional diversity i e ν 0 by keeping x at a fitness minimum where 2 f x 2 x x 0 again this is in direct contradiction to the conclusions of a na model where the stability condition of a fixed point x of d x d t at a fitness maximum cf eqs e3 and e4 implies ν equals zero losing all functional diversity in addition if the initial value of x is a fixed point x of d x d t at a fitness minimum of the na model ν will increase without bound instead of vanishing provided there is no feedback between the total biomass inﬂuenced by ν 2 2 f x 2 x x and f x itself in that case we would ﬁnd ourselves with the opposite issue of exploding trait variances this feature is known as runaway evolution of traits cf abrams and matsuda 1997 furthermore this reasoning implies that any moment closure approach for trait based aggregate models defined by eqs e1 and e2 based on the assumption of a trait distribution that exhibits constant values of s and k independent of x and ν will not be able to overcome the same pitfall of na models loss of functional diversity over time without frequency dependent selection however as discussed below in more detail frequency dependent selection may also stabilize a fitness minimum within a na model abrams et al 1993b in line with the observed correlations between lower and higher central moments fig 2 one of the simplest moment closures that can be conducted for an aggregate model defined by eqs e1 and e2 while adhering to the stability conditions outlined above is given by assuming s and l n k to be expressed as linear functions of x and l n ν respectively e10 s m 3 ν 3 2 b s x a s m 3 ν 3 2 b s x a s e11 k m 4 ν 2 a k ν b k ln k b k ln ν ln a k m 4 a k ν b k 2 with a k a s 0 and b k b s 0 cf gaedke and klauschies 2017 this enables a data based moment closure of trait based aggregate models that are defined by eqs e1 and e2 where the intercept a and slope b parameters of eqs e10 and e11 are estimated from actual empirical data see fig 2 finally we support our analytical results by showing numerical simulations of an extended ba model that does not need immigration or any other mechanism to maintain v i e ν 0 when considering the central moments up to the fourth rather than the second order the aggregate model with the highest accuracy with respect to the resolution of the entire fitness landscape is given by the following set of equations cf appendix a e12 d r t d t f x ν 2 2 f x x 2 x x s ν 3 2 6 3 f x x 3 x x k ν 2 24 4 f x x 4 x x i e13 d x d t ν f x x x x s ν 3 2 2 2 f x x 2 x x k ν 2 6 3 f x x 3 x x i r t 1 2 x e14 d ν d t s ν 3 2 f x x x x k ν 2 ν 2 2 2 f x x 2 x x i r t 1 12 ν 1 2 x 2 in line with eq 20 the fourth order approximation of the per capita net growth rate f is given by e15 f x r 1 r t κ k 1 3 a k x c k 1 h a k x i 2 4 m i i i a k x x i x x r t in accordance with the simulations presented in the results section we run numerical simulations of this extended ba model by keeping all parameters the same except for the immigration rate i which was set to zero depending on the initial conditions our model predicts either oscillations or stasis in the predator and prey biomasses fig e2 in the first case the mean of the trait distribution approached a stable equilibrium at an intermediate value that corresponded to a fitness minimum whereas the value of the trait variance was at its maximum indicating a bimodal distribution in the second case on the other hand the mean trait value approached one of the two extremes that corresponded to a fitness maximum while the trait variance collapsed towards zero these results illustrate how the beta distribution approach can keep high levels of standing trait variation in trait based aggregate models without additional mechanisms when adding immigration to the extended version of the ba model the resulting biomass and trait dynamics no longer depended on the initial conditions and showed very high levels of standing trait variation fig e3 in contrast to the results shown in fig e2 the value of ν was not constant and changed over time this pattern arose from an interplay between the predator prey oscillations and the density dependent impact of immigration interestingly the immigration term in d x d t ensured global stability of the fixed point x 0 5 at a fitness minimum and thus overall maintenance of ν however at the same time the immigration term in d ν d t promoted temporal reductions of ν because the trait variance of the immigrating community is smaller than the trait variance of the resident community at equilibrium despite the good match between the trait dynamics this model overestimated the grazing rate of the predators on the prey community which promoted ongoing predator prey cycles instead of stasis see fig 6 furthermore this model was unable to reproduce the biomass and trait dynamics of the prey and predator community under fluctuating selection as displayed in fig 4 this indicates that trait based aggregate models are quite sensitive to the choice of the moment closure approach and mechanism used to maintain ν hence besides showing more thoroughly the actual potential of a beta distribution based moment closure approach for trait based aggregate models these results also point towards potential limitations that may arise when accounting for higher derivatives of the fitness function i e higher order taylor expansions e 2 convergent stable fitness minima under frequency dependent selection the preceding discussion assumed that natural selection is independent of x and ν of the trait distribution hence we neglected the possibility for a convergent stable fitness minimum that may generally arise under frequency dependent selection in which the fitness and thus the invasion success of a mutant strongly depend on the phenotype of the monomorphic resident community christiansen 1991 abrams et al 1993b rueffler et al 2006 in general this frequency dependent mechanism can stabilize a fitness minimum also in a na model which assumes that the trait values are normally distributed and exhibit a small variance however we are going to show that such stable fitness minima do not exist in our na model with a single predator hence this mechanism cannot have stabilized the fitness minimum in our fd model under disruptive selection fig 6 instead the fitness minimum in our fd model was likely stable due to the mechanism discussed in the previous section when selection is frequency dependent the species fitness function f depends not only on the total biomass r t and its individual trait value x but also on the mean x and variance ν of the entire trait distribution cf eq 20 hence when considering a na model under frequency dependent selection the linear stability condition for x at its equilibrium x is given more generally by the sign of the following equation e16 d d x d t d x x x ν 2 f x x ν x 2 x x x 2 f x x ν x x x x x hence the fixed point x is locally stable if 2 f x 2 x x x 2 f x x x x x 0 and x is unstable otherwise abrams et al 1993b in contrast to frequency independent selection this can also happen under frequency dependent selection when x is located at a fitness minimum in such a case selection will drive x first towards a local fitness maximum by following the fitness gradient which then turns into a local fitness minimum when x reaches the corresponding extreme trait value of the fitness landscape at which point selection becomes disruptive rueffler et al 2006 as a potential result ν may exhibit stable growth in the absence of any other negative feedback however frequency dependent selection does not ensure that x at a fitness minimum becomes convergent stable abrams et al 1993b in fact the likelihood of fitness maxima to be unstable seems to be much higher than the likelihood of fitness minima to be stable abrams et al 1993b furthermore in line with the stability conditions for x under frequency independent selection 2 f x x x x x equals zero also for some cases of frequency dependent selection for example consider the predator prey model used in the main text eqs 1 2 with only a single predator in place cf fig 6 in this case we can express the first derivative of the fitness function of the prey with respect to x eq 20 as the product of a function f 1 x that only depends on x and a function f 2 x ν that only depends on x and v of the trait distribution i e f x x ν x f 1 x f 2 x ν given that the denominator of the functional response is positive i e f 2 x ν 0 for all x and sufficiently small ν the second derivative 2 f x x x x equals zero when f x x x f 1 x x x 0 and thus when x is located at a fitness maximum or minimum for the same reason 2 f x ν x x 0 at such an equilibrium and so the off diagonal terms of the jacobian matrix of the system given by eqs e3 e4 cancel allowing us to analyze each equation separately once again hence under such circumstances a convergent stable fitness minimum does not exist in our na model even with frequency dependent selection in contrast to frequency independent selection a potential equilibrium of v in the na model under frequency dependent selection is given either by ν 0 or by 2 f x x ν x 2 x x ν ν 0 the first case is the trivial one noted beforehand however also the realism of the second non trivial equilibrium of ν has to be questioned because it implies that x has to be located at an inflection point furthermore the stability of the non trivial ν is given by the sign of the following equation e17 d d ν d t d ν ν ν 2 ν 2 f x x ν x 2 x x ν ν ν 2 3 f x x ν x 2 ν x x ν ν ν 2 3 f x x ν x 2 ν x x ν ν since ν 0 the stability depends only on the sign of the third derivative although it is not immediately clear which ecological scenarios may correspond to this stability condition the third derivative in eq e17 is zero when considering once again our predator prey model with a single predator in place following the reasoning outlined above for eq e16 this suggests that frequency dependent selection is not able to promote non zero variances at equilibrium in na models however in general when considering ba models the stability condition based on the correlations between lower and higher central moments eqs e6 and e9 may interact in several ways with the stability condition based on frequency dependence eqs e16 and e17 jointly determining the overall stability of fitness minima and maxima 
25282,ecological communities are complex adaptive systems that exhibit remarkable feedbacks between their biomass and trait dynamics trait based aggregate models cope with this complexity by focusing on the temporal development of the community s aggregate properties such as its total biomass mean trait and trait variance they are based on particular assumptions about the shape of the underlying trait distribution which is commonly assumed to be normal however ecologically important traits are usually restricted to a finite range and empirical trait distributions are often skewed or multimodal as a result normal distribution based aggregate models may fail to adequately represent the biomass and trait dynamics of natural communities we resolve this mismatch by developing a new moment closure approach assuming the trait values to be beta distributed we show that the beta distribution captures important shape properties of both observed and simulated trait distributions which cannot be captured by a gaussian we further demonstrate that a beta distribution based moment closure can strongly enhance the reliability of trait based aggregate models we compare the biomass mean trait and variance dynamics of a full trait distribution fd model to the ones of beta ba and normal na distribution based aggregate models under different selection regimes this way we demonstrate under which general conditions stabilizing fluctuating or disruptive selection different aggregate models are reliable tools all three models predicted very similar biomass and trait dynamics under stabilizing selection yielding unimodal trait distributions with small standing trait variation we also obtained an almost perfect match between the results of the fd and ba models under fluctuating selection promoting skewed trait distributions and ongoing oscillations in the biomass and trait dynamics in contrast the na model showed unrealistic trait dynamics and exhibited different alternative stable states and thus a high sensitivity to initial conditions under fluctuating selection under disruptive selection both aggregate models failed to reproduce the results of the fd model with the mean trait values remaining within their ecologically feasible ranges in the ba model but not in the na model overall a beta distribution based moment closure strongly improved the realism of trait based aggregate models keywords moment closure normal and beta distribution skewed and peaked trait distributions fitness landscape and frequency dependent selection eco evolutionary dynamics modelling functional diversity 1 introduction ecological communities can respond to altered environmental conditions by adapting their trait composition which may in turn alter the strength of ecological interactions and thus the selection pressure of the environment a recently advocated approach to unravel such feedbacks between biomass and trait dynamics is to consider communities as complex adaptive systems norberg 2004 merico et al 2009 building on fundamental theory in evolutionary biology lande 1982 turelli and barton 1994 day and proulx 2004 and spatial ecology iwasa et al 1987 dieckmann and law 1996 bolker and pacala 1997 community ecologists developed trait based aggregate models in order to focus on key functional attributes of the communities wirtz and eckhardt 1996 norberg et al 2001 unlike discrete or full trait distribution models that consider the population dynamics of several or all functionally different species separately bruggeman and kooijman 2007 tirok and gaedke 2010 acevedo trejos et al 2016 aggregate models describe the temporal dynamics of the community s aggregate properties such as its total biomass mean trait and trait variance tirok et al 2011 merico et al 2014 the mean and variance correspond to the first and second central moments of the corresponding trait distribution and therefore represent the average strategy and functional diversity of a community the corresponding reduction in model complexity may enhance the computational efficiency and allow the achievement of analytical results which may increase the mechanistic understanding of biomass trait feedbacks in natural systems the derivation of an aggregate model from a full trait distribution model involves a moment expansion which determines how the rates of change of the aggregate properties depend on the shape of the trait distribution norberg et al 2001 coutinho et al 2016 in general the temporal development of lower moments such as the mean and variance depend on higher moments such as the skewness and kurtosis which quantify how skewed and peaked a distribution is in order to get self contained expressions of the aggregate model equations one has to conduct a moment closure where higher moments are expressed in terms of lower ones kuehn 2015 this is commonly done by assuming a particular shape of the underlying distribution in community ecology previous studies often used a normal distribution based moment closure approach and thus assumed the shape of the trait distribution to be a gaussian terseleer et al 2014 acevedo trejos et al 2015 smith et al 2016 this assumption implies that trait distributions should be unimodal and symmetric and that traits are defined on an infinite range without a lower or upper boundary the assumption of a unimodal trait distribution seems to be valid under stabilizing selection in which intermediate trait values are favored over extreme ones however recent empirical studies showed that trait distributions are often heavily skewed or multimodal havlicek and carpenter 2001 thibault et al 2011 downing et al 2014 gaedke and klauschies 2017 this is likely a result of fluctuating or disruptive selection and questions the strong assumption of normally distributed trait values coutinho et al 2016 under fluctuating selection trait distributions are expected to show skewness because different trait values are favored at different times whereas under disruptive selection extreme trait values are favored over intermediate ones promoting bimodal trait distributions in addition important traits such as body size reproduction rate or edibility are clearly restricted to a finite range for example a prey species cannot be more than entirely edible or inedible constraining the trait edibility to the range between zero and one klauschies et al 2016 in general this limited range of trait values will lead to specific correlations between lower and higher moments gaedke and klauschies 2017 a distribution whose mean x is close to the lower or upper limit will most probably be right s 0 or left skewed s 0 promoting a negative correlation between s and x furthermore when the trait range is limited distributions with high variances ν have to be rather flat or even bimodal leading to low values of kurtosis k conversely peaked distributions with pronounced tails resulting in high values of k must exhibit low values of v this results in a negative correlation between k and v in contrast a normal distribution presents no such correlations because both s and k are constant and thus independent of x and v hence a gaussian does not capture such properties of natural trait distributions inspired by recent developments in stochastic population biology krishnarajah et al 2005 clancy and mendy 2011 we explore in this study a novel moment closure approach for trait based aggregate models by assuming that the shape of the trait distribution follows a beta distribution in contrast to a normal distribution the beta distribution is defined only over a finite range with lower and upper limits and can be unimodal or bimodal symmetric or skewed depending on its mean and variance moreover the correlations between its higher and lower moments conform to the pattern described above we corroborate these qualitative relations by comparing the relationships between lower and higher moments of the beta distribution with those observed for phytoplankton size distributions of the baltic sea klais et al 2016a b and for simulated trait distributions of a full trait distribution fd model the fd model comprises the full trait distribution of a prey community that competes for a common carrying capacity and that is grazed upon by three different predator species that are specialized on different parts of the prey s trait spectrum hence the fd model entails key features of natural food webs and generates different selection regimes which determine the shape of the prey community s trait distribution see fig 1 finally we show how a beta distribution based moment closure approach improves trait based aggregate models by comparing the biomass and trait dynamics of the fd model to a beta distribution based aggregate ba model and a normal distribution based aggregate na model under different selection regimes 2 materials and methods to evaluate if the beta distribution represents a more suitable basis for a moment closure of trait based aggregate models than the normal distribution we compare the relationships between lower and higher central moments of observed phytoplankton size distributions simulated trait distributions of a full trait distribution fd model and the beta distribution subsequently we compare the dynamics of biomass and mean and variance of the trait distribution under the fd model to that of aggregate models based on a beta or normal distribution moment closure 2 1 analyzing the shape of observed phytoplankton size distributions we analyzed the correlations among lower and higher central moments of more than 7000 phytoplankton size distributions of the baltic sea klais et al 2016a b size i e cell volume is the most important trait influencing many eco physiological processes of phytoplankton species such as nutrient uptake maximum growth rates sedimentation rates and susceptibility to zooplankton grazing weithoff 2003 the classification of the different phytoplankton species was done according to their individual cell volume or colony size for details see klais et al 2016a b missing values of the size of a phytoplankton species at particular sampling dates or locations were replaced by the average value for that species over all sampling times and locations we log transformed the size values of the phytoplankton species to account for their large range covering about eleven orders of magnitude and for the inherent skewness in size distributions this is in line with the general assumption of normal distribution based aggregate models that size is log normally distributed terseleer et al 2014 acevedo trejos et al 2015 to reduce the sampling error we grouped the biovolume of the species into 85 equidistant size classes on a log2 scale to account for individual growth and variability within each species we assumed that the minimum and maximum size values of each species differed by a factor of 4 prior to log2 transformation gaedke 1992 assuming that the species specific size distribution is log normal see lande 1982 we allocated 50 of the biovolume to the class corresponding to the species measured mean size value x 20 to the two adjacent classes corresponding to the ranges within 21 2 and 2 1 2 of x and 5 to the classes corresponding to the ranges 2 and 2 1 away from x all subsequent calculations are based on the mean values of the classes ordered on a log2 scale 2 2 full trait distribution model fd model in order to achieve different selection regimes we consider a predator prey model with a set of prey species with continuous trait values grazed upon by three predators each feeding on a specific part of the prey s trait range the rate of change of the different prey r and predator c species are given by the following set of equations 1 r x t r 1 0 1 r x d x κ r x i 1 3 a i x r x c i 1 h 0 1 a i x r x d x i 2 d c i d t ε 0 1 a i x r x d x 1 h 0 1 a i x r x d x d c i the prey are structured by their trait value x bounded between 0 and 1 the parameters r and κ are respectively the intrinsic growth rate and carrying capacity of the prey hence the prey species are competing for a shared resource such as light the net growth rates of the three predators which are identified by i 1 2 3 depend on their common handling time h efficiency ε and death rate d and their species specific attack rates a i the parameter values used in the simulations are given in table 1 all parameters are independent of x except for a i these are functions of the prey phenotype x fig 1a c 3 a i x a m a x a m i n e x i 1 2 σ 2 a m i n with a m a x and a m i n being the maximum and minimum attack rates of the different predators the attack rates of the three different predators are maximal at their species specific optimal prey phenotypes with trait values of 0 0 5 or 1 the parameter σ determines the width of the predators feeding kernel in addition we added a small immigration rate i to eq 1 to prevent extinction of any particular trait value in the fd model and to promote short transients in its dynamics we compared the results of the fd model with those of the two different aggregate models by calculating the first three aggregate properties of the prey community s trait distribution i e its total biomass r t trait mean x and trait variance ν which are given for the fd model by 4 r t 0 1 r x d x 5 x 1 r t 0 1 x r x d x 6 ν 1 r t 0 1 x x 2 r x d x the fd model was numerically integrated using the method of lines where a system of coupled ordinary differential equations is obtained through a discretization along the trait axis hence we approximated the fd model by the following set of equations 7 d r j d t r 1 k 1 n r k κ r j i 1 3 a i x j r j c i 1 h k 1 n a i x k r k i n 8 d c i d t ε j 1 n a i x j r j 1 h j 1 n a i x j r j d c i with n 101 being the number of different prey species their corresponding trait values are distributed evenly along the trait axis of the entire prey community i e x j 0 0 01 0 02 1 accordingly the aggregate properties were estimated from the biomass values obtained for the different prey species 9 r t j 1 n r j 10 x 1 r t j 1 n x j r j 11 ν 1 r t j 1 n x j x 2 r j 2 3 aggregate models am instead of describing the temporal development of the biomasses of different species with particular trait values separately one can focus on a system of differential equations that describe the rate of change of the aggregate properties directly using moment approximation methods we derived the trait based aggregate models from the corresponding fd model as shown in appendix a consequently the temporal development of the aggregate properties is described by the following set of approximate equations 12 d r t d t f x ν 2 2 f x x 2 x x r t i 13 d x d t ν f x x x x s ν 3 2 2 2 f x x 2 x x i r t 1 2 x 14 d ν d t s ν 3 2 f x x x x k ν 2 ν 2 2 2 f x x 2 x x i r t 1 12 ν 1 2 x 2 15 d c i d t ε a i x ν 2 2 a i x x 2 x x r t 1 h a i x ν 2 2 a i x x 2 x x r t d c i with f being the per capita net growth rate fitness and s and k being the skewness and the kurtosis of the trait distribution of the prey community when conducting a moment closure based on the assumption of normally distributed trait values eqs 13 and 14 simplify to 16 d x d t ν f x x x x i r t 1 2 x 17 d ν d t ν 2 2 f x x 2 x x i r t 1 12 ν 1 2 x 2 because s equals zero and k equals 3 hence s and k are independent of the mean x and variance ν in contrast s and k of the beta distribution strongly vary with both x and ν for details see appendix a cf fig 1g i 18 s x ν 2 1 2 x ν 1 x x ν 19 k x ν 1 x x ν 4 ν 2 1 x x 1 s x ν 2 6 ν 2 ν 1 x x 3 in line with coutinho et al 2016 and eq 1 the second order approximation of f is given by 20 f x r 1 r t κ i 1 3 a i x c i 1 h a i x ν 2 2 a i x x 2 x x r t in accordance with the fd model the small immigration rate i in the aggregate model equations prevents a complete loss of the standing trait variation in the prey community 2 4 numerical simulations and selection regimes we conducted numerical simulations of our models to compare their biomass and trait dynamics under different selection regimes the type of selection pressure on the prey community was altered by choosing which of the three predators were present see fig 1 with only the two predators specialized on the two extreme trait values present the overall selection pressure was stabilizing towards the intermediate trait value of the prey in contrast with only one predator specialized on the intermediate trait values present the prey community exhibits disruptive selection finally if all three predators are present selection is on average rather neutral potentially leading to fluctuating and thus recurrent directional selection in which different trait values are favored at different times we initialized all simulations with equally abundant predators c i 1 n κ 10 with n being the number of predators and total biomass and trait variance of the prey community of κ 2 and 10 3 respectively to investigate the possibility of multi stability in our models we ran them for different initial values of the mean trait i e x 0 05 0 07 0 93 0 95 we assumed the initial trait distribution of the prey community in the fd model to follow the shape of a beta distribution though that was not relevant for the long term solutions obtained all simulations lasted for 104 time units simulations and analyses were performed in matlab version 7 13 using solver ode23 for odes the mathworks inc natick ma 2011 we increased the precision of the solver by reducing the absolute and relative tolerances to 10 9 and 10 7 and the maximum step size to 0 1 3 results 3 1 analyzing the shape of the empirical and simulated trait distributions the observed phytoplankton size distributions and the simulated trait distributions both revealed strong relationships between lower and higher moments the skewness s and the mean x were strongly negatively correlated fig 2 a r2 0 41 and 2c because the trait distribution tends to become skewed as x approaches one of the extreme trait values for a given value of ν we also found a strong negative correlation between the log of kurtosis l n k and the log of the variance l n ν fig 2b r2 0 42 and 2d in fact a trait distribution defined on a finite trait range can only exhibit very high variances when its shape is close to the one of a flat or even bimodal distribution corresponding to small values of k in contrast peaked trait distributions with pronounced tails i e distributions with high values of k will usually have rather low values of ν these relationships between lower and higher central moments are qualitatively well approximated by a beta distribution eqs 13 and 14 fig 2e and f 3 2 comparing the biomass and trait dynamics of the fd ba and na models our model comparison revealed further support for the suitability of a beta distribution based moment closure the presence or absence of distinct predator species imposed either stabilizing fluctuating or disruptive selection on the prey community fig 1 under stabilizing selection the predator biomasses and the three aggregate properties of the prey community i e its total biomass mean trait value and variance showed stasis in the full trait distribution fd model at the end of the simulation fig 3 a d and g the lack of oscillations is explained by the comparably low attack rates of the predators at equilibrium conditions in line with that the two aggregate models predicted very similar values of the predator biomasses and the aggregate properties of the prey community fig 3 because the symmetric unimodal trait distribution of the fd model exhibited a very small variance ν 2 10 6 that could be captured well by both the beta ba and the normal na distribution based approaches this result was independent of the initial conditions the biomass and trait dynamics of the fd ba and na models also agreed very well when the system exhibited predator prey oscillations e g for k 20 rather than k 10 this is in line with additional results from a chemostat model in which a trade off between the prey s nutrient uptake efficiency and its vulnerability to predation imposes stabilizing selection on the trait distribution of the prey community for details see appendix b as expected the numerical integration of both aggregate models was up to 4 times faster than that of the fd model table 2 interestingly there was no difference between the simulation times of the ba model and the na model we also observed an almost perfect match between the cyclic biomass and trait dynamics of the fd and ba models under fluctuating selection favoring different trait values of the prey community and different predators at different times fig 4 the pronounced predator prey oscillations were caused by the temporarily high attack rates of the predators this result was independent of the initial conditions fig 5 and robust to changes in the carrying capacity minimum attack rate and immigration rate appendix c the ba model could not reproduce the biomass and trait dynamics of the fd model when the immigration rate was very low fig c3 in contrast to the ba model the results of the na model deviated considerably from the ones of the fd model fig 4c f i additionally it exhibited several alternative states and thus a high sensitivity to initial conditions depending on the initial mean trait value of the prey community different equilibria for the biomass and trait dynamics were obtained fig 5c f and i when either one or two predators went extinct fig 4c extinctions of two predators occurred when the equilibrium value of x was outside the ecologically feasible range which occurred frequently depending on the strength of the predator prey interactions at equilibrium conditions the predator prey dynamics showed either stasis or oscillations these results were insensitive to deviations from the exact parameter values appendix c in the ba model x always remained within its ecologically feasible range this result was to be expected because the beta distribution is naturally defined on the finite range between 0 and 1 a more detailed analysis revealed that the boundedness of x is realized by a dynamical feedback between x and s in fact the absolute value of s strongly increased when x approached one of the extremes leading to a strong decline of ν as a result the rate of change of x strongly slowed down preventing any further change of x close to the extremes for details see appendix d this mechanism of self regulation is lacking in the na model in line with stabilizing selection the numerical integration of both aggregate models was about three times faster than that of the fd model under fluctuating selection whereas the simulation times of the ba model and the na model were similar table 2 the general features of our results that is the match between the fd and ba models but not with the na model as well as the gains in computation times do not depend on details of the model structure appendix b we demonstrate this with a species competition model in which the recurrent changes in an environmental factor impose fluctuating selection on the trait distribution of the community under disruptive selection both aggregate models failed to match the results of the fd model which predicted a symmetric bimodal trait distribution exhibiting maximum variance fig 6 the na model even failed to reproduce the predator and prey biomasses the disagreement between the results of the fd and na models was to be expected because a normal distribution cannot represent a bimodal trait distribution that is dominated by two very different strategies cf fig 1 in contrast the reason for the mismatch between the results of the ba and fd models is more intriguing since the beta distribution is in principle able to capture the shape of bimodal trait distributions see fig 1 given the symmetry of the feeding interactions in our model the ba model predicted only the biomasses of the prey and predator communities correctly but not x and ν of the prey community s trait distribution this mismatch is only explicable by the restrictions imposed by the second order approximation of the shape of the fitness landscape i e it is independent of the type of moment closure in fact an extended version of the ba model that accounted for higher derivatives of the fitness function was able to reproduce the mean and variance but not the biomass dynamics of the prey community of the fd model under disruptive selection for details see appendix e furthermore and in contrast to the fd model both aggregate models showed bistability where the prey community was dominated by a species possessing either a high or low x as expected the latter was still within the ecologically feasible range in the ba model fig 7 e but not in the na model making it fundamentally inconsistent fig 7f hence the inability of the aggregate models to represent bimodal trait distributions with large variances was compensated by the emergence of two alternative stable states in case of the ba model the average distribution of these alternative stable states captured the bimodal distribution of the fd model well the numerical integration of both aggregate models was about three times faster than that of the fd model table 2 the mismatch between the results of the fd and aggregate models under disruptive selection was independent of the exact model structure appendix b we show this with a modified version of the predator prey model used in the main text in which a trade off between the prey s vulnerability to predation by the two specialist predators imposes disruptive selection on the trait distribution of the prey community 4 discussion trait based aggregate models are a promising tool to incorporate the effects of functional diversity of natural communities into an efficient mathematical framework the corresponding equations directly inform about the properties of the fitness landscape and trait distribution that drive the temporal development of the aggregate properties and thus may enable a detailed understanding of the biomass trait feedback of complex adaptive systems cas under simplifying assumptions their derivation from a corresponding full trait distribution model demonstrates that the temporal development of the lower moments generally depends on higher moments for details see appendix a obtaining a closed system of differential equations requires a moment closure so that the higher moments are expressed in terms of the lower ones norberg et al 2001 coutinho et al 2016 a frequently made assumption is that the higher moments such as skewness s and kurtosis k of the trait distribution follow a normal distribution wirtz and eckhardt 1996 tirok et al 2011 smith et al 2016 in accordance with previous results coutinho et al 2016 we show that this assumption is likely to be valid under stabilizing or weakly fluctuating selection savage et al 2007 merico et al 2009 acevedo trejos et al 2015 promoting rather unimodal trait distributions with small variances however observed size distributions of phytoplankton communities in various habitats were often heavily skewed or flat likely caused by strongly fluctuating or disruptive selection skewed and bimodal size distributions were also frequently observed in other aquatic tackx et al 1994 downing et al 2014 and terrestrial maurer et al 2004 thibault et al 2011 communities therefore normal distribution based aggregate na models are likely to be inappropriate for many natural systems coutinho et al 2016 we aimed to overcome these limitations by investigating the behavior of a new trait based aggregate model based on the assumption that the trait values are beta distributed in contrast to the normal distribution the beta distribution is defined on a finite range as are presumably all ecologically relevant traits such as body size generation times or feeding rates as a result the beta distribution can be unimodal and symmetric heavily skewed or bimodal depending on its mean and variance additionally it exhibits strong negative correlations between the lower and higher moments in line with the observed phytoplankton size distributions 4 1 performance of trait based aggregate models under different selection regimes a comparison of the biomass and trait dynamics of a full trait distribution fd model with the ones of a beta distribution based aggregate ba model revealed that a corresponding moment closure can strongly improve the reliability of trait based aggregate models we also applied the method to other models found in the literature appendix b showing that our results are not specific to particular model choices under stabilizing and fluctuating selection we observed an almost perfect match between the biomass and trait dynamics of the fd and ba models this result was independent of the initial conditions and relies mainly on the fact that the skewness s of the trait distribution and the curvature of the fitness landscape at the mean trait value x 2 f x 2 x x jointly prevent x from getting locked at a local fitness maximum appendix e in contrast to previous results where the existence of convergent stable fitness minima or convergent unstable fitness maxima relies on frequency dependent selection e g abrams et al 1993b the mechanism described above can stabilize fitness minima or destabilize fitness maxima even in the absence of frequency dependent selection appendix e nevertheless a certain amount of standing trait variation ν and thus immigration was still needed to maintain ongoing changes in x under fluctuating selection for details see appendix c the close correspondence between the biomass and trait dynamics of the fd and ba models is in line with a statistical comparison of different aggregate models linked to empirical size distributions of phytoplankton communities gaedke and klauschies 2017 the best approximation of the rate of change of the aggregate properties of the corresponding fd model was obtained with a moment closure approach based on the observed negative correlations between the higher and lower central moments of the phytoplankton size distributions in contrast the na model predicted biomass and trait dynamics that differed strongly from the ones of the ba and fd models for example the changes in x did not cover the entire trait range but exhibited small amplitude oscillations consequently one or two of the three predators went extinct in addition the na model showed a high sensitivity to initial conditions under fluctuating selection in many cases x surpassed its natural limits because the na model lacks an inherent mechanism to prevent this in contrast the ba model entails a skewness mediated feedback between x and ν close to the extremes which arises from the upper and lower limits of the beta distribution keeping x within its ecologically feasible range when x approaches one of the extremes s will always increase in modulus and have the opposite sign of the fitness gradient see eq 18 and fig 2e leading to a strong decline of ν see eq 14 as a result the rate of change of x slows down quickly given that ν scales d x d t eventually stopping x at or close to one of the extremes for details see appendix d this shows that temporal changes in s are very important for restricting x to its ecologically feasible range by promoting a reduction of ν when x approaches one of the extremes investigating the moment closure equations of the beta distribution in more detail also reveals that a feedback between ν and k ensures ν to be bounded to its ecologically feasible range in the ba model for example assuming the trait distribution to be symmetric an increase of ν leads to a decline of k eq 19 and fig 2f because only rather flat distributions can accommodate large values of ν when ν approaches its maximum value of 0 25 k decreases towards one indicating a bernoulli distribution which is a special extreme case of a symmetric bimodal distribution where all biomass is allocated to the shoulders of the trait distribution and none to the tails or the mean hence the factor in front of the second term of the rate of change of ν becomes zero see eq 14 so ν cannot grow further in contrast the normal distribution does not exhibit lower and upper limits and in addition its kurtosis does not depend on ν allowing ν to surpass its natural limit in na models cf tirok et al 2011 the good approximation of the fd model by the ba model under fluctuating selection agrees with recent findings of a stochastic population model for endemic infections a moment closure based on the discrete beta binomial distribution improved the reliability of a corresponding aggregate model to adequately represent the temporal development of x and ν of the probability distribution of infected individuals of a susceptible infected si logistic model krishnarajah et al 2005 furthermore the beta binomial distribution based moment closure was found to clearly outperform other moment closure approaches based on e g the normal or binomial distribution in matching the overall shape properties of the quasi stationary distribution of a sis logistic model clancy and mendy 2011 under disruptive selection both aggregate models failed to reproduce the biomass and trait dynamics of the fd model exhibiting a bimodal distribution with maximum ν despite the fact that our model gives rise to frequency dependent selection and thus may enable the emergence of convergent stable fitness minima in aggregate models cf abrams et al 1993b our analysis presented in appendix e shows that such minima do not exist in na models with a single predator leading to the same stability conditions for x with or without frequency dependent selection essentially the normal distribution cannot represent a bimodal distribution where x is located at the fitness minimum and thus is no longer representative of the entire community consequently x always moves towards a local fitness maximum in the na model at least under frequency independent selection where 2 f x 2 x x is negative so ν tends to zero over time when no other source of standing trait variation exists appendix e this is very important because high functional diversity may reduce the overall performance of the community because of suboptimal phenotypes i e due to negative second derivatives at the optimal mean trait value but at the same time may enable the community to adapt to new fitness optima when the environment is changing norberg et al 2001 in general a strong reduction in the trait variance of aggregate models due to the fitness gradient approximation may lead to a mismatch between the timescales of the aggregate model and a corresponding fd model coutinho et al 2016 which likely hampers the application of aggregate models to natural systems but see terseleer et al 2014 for an example furthermore in the na model x cannot overcome a fitness minimum separating different peaks from each other which strongly contrasts with fd models coutinho et al 2016 and potentially also with ba models appendix e hence considering local fitness gradients instead of entire fitness landscapes necessarily assumes the absence of multiple concurrent peaks in the fitness landscape in contrast our results demonstrate that higher derivatives of the fitness function and higher moments of the trait distribution are required to drive changes of the aggregate properties into the right direction under disruptive selection as shown in appendix e the negative correlations between the lower and higher moments entailed in the beta distribution and observed in the size distributions of the phytoplankton communities may contribute to the maintenance of ν and thus functional diversity over time in fact ν exhibits a potential stable fixed point larger than zero if x is located at a fitness minimum where the curvature of the fitness function is positive see fig e1 since skewness can stabilize a fixed point of x at a fitness minimum a stable solution of a ba model can exist with ν 0 even without immigration for details see appendix e indeed when the skewness and the local fitness gradient exhibit the same sign an increase in the variance is promoted norberg et al 2001 however in our case the second order approximation of the fitness function entailed in the ba model was not sufficient to maintain ν 0 as a result additional processes like immigration or mutation may be required to ensure ν 0 over time merico et al 2014 coutinho et al 2016 various mechanisms have been used to maintain ν cf merico et al 2014 for example while mutation is often viewed to have overall small effects on d x d t and d ν d t day 2005 immigration strongly influences them at low densities appendix e furthermore in the absence of mutational bias mutation has little impact on d x d t while preventing ν from getting vanishingly small a feature which can be derived when modelling the mutation process as trait diffusion coutinho et al 2016 as a result na models are sensitive to the added source of standing trait variation and thus to the choice of mechanism used to maintain ν coutinho et al 2016 this holds also for ba models because the sum of a beta distribution and another trait distribution is not necessarily beta distributed that is the moment closure equations might interfere with the other mechanism used to maintain ν for example adding standing trait variation to d ν d t of a ba model may strongly interfere with d x d t when x is close to one of the extremes because the moment closure equations can no longer represent adequately the actual values of s and k under such conditions in fact ν has to become very small when x approaches one of the extremes hence accounting for a process that only leads to an increase in ν without pushing x towards intermediate values will generally not work within the framework of a ba model consequently we could not derive a ba model that incorporates mutation as diffusion with a reflecting boundary because the beta distribution is defined on an open interval more generally these results underline the need to understand more clearly the potential effects of immigration and mutation on biomass trait feedbacks in trait based aggregate models 4 2 relevance of our findings for evolutionary ecology the aggregate model approach used in this study to describe the temporal dynamics of the aggregate properties of the trait distribution of a community is akin to various mathematical descriptions of trait adaptation in evolutionary ecology in line with classical quantitative genetics qg models that describe rapid or short term evolution within a population slatkin 1979 taper and case 1992 day 2005 aggregate models do not assume a separation of ecological and evolutionary times scales rather they consider explicitly the dynamical feedback between trait and biomass dynamics within a community norberg et al 2001 merico et al 2009 in addition both model approaches explicitly allow for standing trait variation and often rely on the assumption that the trait distribution is and remains normally distributed thereby enhancing numerical or analytical tractability of the model taylor and day 1997 coutinho et al 2016 this assumption is valid at the population level when considering the evolution of a quantitative trait in which numerous loci determine the individual s phenotype with each locus having a small additive effect on the phenotype slatkin 1979 kirkpatrick and rousset 2005 essentially in case of random mating sexual reproduction and recombination the trait distribution of a population can often be well approximated by a normal distribution with a particular x and ν lande 1976 barton and turelli 1989 in contrast there exists hardly any theoretical or empirical foundation for the gaussian approximation at the community level where trait changes mainly rely on species sorting gaedke and klauschies 2017 furthermore at the population level also various mechanisms exist that may promote non normally distributed trait values including assortative mating in sexual populations or clonal sorting in asexual populations doebeli et al 2007 sasaki and dieckmann 2011 hence the shape of trait distributions may often strongly deviate from a gaussian including skewed or bimodal trait distributions our results show that corresponding changes in skewness and kurtosis may strongly influence the biomass and trait dynamics and therefore model predictions cf fig 4 in contrast to many aggregate models that allow for simultaneous changes in x and ν norberg et al 2001 coutinho et al 2016 but see merico et al 2014 qg models often focus on changes in mean trait values by assuming ν to be constant taper and case 1985 1992 day 2005 the latter seems to be valid under weak selection in which case the selective advantage of different phenotypes is vanishingly small meaning that the fitness landscape is rather flat and thus the fitness function and its first derivative do not change much over the bulk of the trait distribution lande 1976 taylor 1996 lion 2018 however keeping ν constant may neglect a potentially very important feedback between d x d t and d ν d t because temporal changes in ν and x are tightly coupled to each other through their combined effects on the entire fitness landscape appendix a in line with previous studies norberg et al 2001 smith et al 2016 our results show that the speed of trait adaptation through higher ν comes at a cost of reduced fitness at the community level when x is located around a fitness maximum appendix e in contrast to qg and aggregate models the approach of adaptive dynamics ad considers long term evolution to be a mutation limited process giving rise to a separation of ecological and evolutionary time scales parker and maynard smith 1990 day 2005 the key assumption of ad is that a new but rare mutant with a slightly different phenotype than the resident phenotype arises at a point where the monomorphic resident population has reached its demographic equilibrium geritz et al 1998 mcgill and brown 2007 if the phenotype of the rare mutant is mal adapted it will necessarily die out whereas it will spread when it is advantageous replacing the former phenotype of the resident population evolution of the resident phenotype is then driven by a sequence of rare mutation and strong selection day 2005 kirkpatrick and rousset 2005 ad focuses on finding the evolutionary endpoints i e evolutionary singular strategies which can be reached by gradual evolution starting from a strategy nearby mcgill and brown 2007 such convergent stable strategies css can be either resistant stable ess or vulnerable branching point to invasion by other nearby strategies geritz et al 1998 doebeli et al 2007 in the latter case traits evolve to a point where selection becomes disruptive giving rise to dimorphism rueffler et al 2006 mcgill and brown 2007 at this point it becomes necessary to follow the evolution of two distinct phenotypes this contrasts with our ba model which describes the temporal development of a continuous trait distribution that may become bimodal and thus exhibit two dominant but distinct phenotypes furthermore aggregate models explicitly consider biomass and trait dynamics that occur on similar time scales and therefore account for the fact that changes in x or ν may strongly affect the stability and shape of biomass dynamics abrams and matsuda 1997 coutinho et al 2016 cortez and patel 2017 4 3 future perspectives to overcome the overall weak performance of trait based aggregate models under disruptive selection one may use a hybrid model here the mean trait and variance dynamics of two or more different species or functional groups are modeled separately using an aggregate model formulation for each species norberg et al 2012 klauschies et al 2016 hence the community is subdivided into a limited number of species or functional groups whose mean trait values and trait variances can in turn adapt in response to selection cf norberg et al 2001 terseleer et al 2014 in the context of genetics a similar approach was developed and advocated by sasaki and dieckmann 2011 where the trait distribution is decomposed into a sum of unimodal trait distributions corresponding to the individual morphs of a population this is reasonable when the entire trait distribution is oligomorphic or multimodal meaning that it comprises a finite number of distinct peaks each peak is associated with a different morph that can be viewed as a quasi species characterized by its particular trait distribution in line with qg models lande 1976 abrams et al 1993b d x i d t of morph i follows the product of ν i and f i x i x i x i under the assumption that all ν i are small for all i sasaki and dieckmann 2011 although our derivation of an aggregate model is also based on the assumption that ν is sufficiently small cf appendix a our results show that this approximation may capture also more complex scenarios where ν is temporarily quite large when assuming the trait values to be beta distributed cf fig 4 hence a promising avenue for future research would be to combine our novel moment closure approximation based on the beta distribution with a hybrid or oligomorphic dynamics approach the alternative to model the temporal dynamics of higher moments or to extend the second order approximation appears less promising given that the corresponding equations and numerical simulations become very demanding we established that the choice of a suitable moment closure approach strongly depends on the prevailing selection regime hence it is important to develop reliable tools to characterize the selection pressure on the trait composition of natural communities in the approach of adaptive dynamics the predominant selection pressure on a convergent stable strategy x of a population is estimated based on the sign of the second derivative of the mutant s invasion fitness with respect to its own strategy x evaluated at the resident strategy x i e 2 f x 2 x x negative values indicate stabilizing selection and thus an evolutionary stable strategy ess whereas positive values indicate disruptive selection and thus an evolutionary branching point that may give rise to dimorphisms geritz et al 1998 mcgill and brown 2007 these constraints are valid when assuming weak selection which implies that the distribution is tightly clustered around x lion 2018 they also hold when selection is not weak but a separation of time scales between ecology and evolution under rare mutations is assumed day 2005 in this case advantageous novel phenotypes are strongly and positively selected so that a monomorphic resident community can be assumed at the time a new mutant arises geritz et al 1998 accordingly a recently proposed approach to distinguish between the prevalence of stabilizing or disruptive selection in na models is based on the sign of their 2 f x 2 x x acevedo trejos et al 2016 however using a normal distribution based moment closure relies on the assumption that the environment imposes stabilizing or weak directional selection on the trait considered hence a verification of stabilizing selection cannot be attained by considering actual properties of the resulting equations of a na model because the result will not be independent of the assumption of normality and thus a prevalence of stabilizing selection as detailed in appendix e the temporal changes of x and ν promote negative values of 2 f x 2 x x without necessarily implying stabilizing selection in general the sign of 2 f x 2 x x does only inform reliably about the prevalence of stabilizing or disruptive selection when the fitness landscape can be well described by a parabolic function for which higher derivatives vanish cf abrams et al 1993a in all other cases the view that 2 f x 2 x x 0 provides clear evidence for stabilizing selection and 2 f x 2 x x 0 for disruptive selection is oversimplified and potentially wrong this happens because concomitant changes in x also promote negative values of 2 f x 2 x x under clearly disruptive selection regimes where two distinct fitness maxima co occur hence approaches developed in population genetics cf nelson et al 2005 siepielski et al 2009 fox et al 2010 may deliver more reliable estimates of the prevailing selection pressure on the trait composition of natural communities finally in line with ad and optimality approaches parker and maynard smith 1990 we may further enhance our understanding of trait based aggregate models by considering quasi equilibrium approximations based on a separation of time scales of the ecological biomass and the evolutionary trait dynamics geritz et al 1998 cortez and patel 2017 for example when ν is sufficiently small we can assume the evolutionary dynamics to be much slower than the ecological dynamics in this case the ecological variables will reach a quasi equilibrium at the current changing trait values day 2005 lion 2018 in contrast when organisms are able to quickly adapt their traits in response to selection we can assume that the evolutionary dynamics occur on a much faster time scale than the ecological dynamics smith et al 2009 abrams 2010 pahlow and prowe 2010 analyzing such fast slow dynamics may allow for the derivation of general results under simplifying assumptions cortez 2016 cortez and patel 2017 4 4 final remarks the small number of state variables of trait based aggregate models may enable rigorous analyses of their equations appendix e norberg et al 2001 and significantly reduce their simulation times when compared to corresponding full trait distribution fd models table 2 acevedo trejos et al 2016 however as moment approximations do not come with an estimate of the approximation error one usually has to resort to numerical simulations of the fd model to judge when the approximation is good enough to replicate the behavior of the fd model in practice this may question the general applicability of trait based aggregate models even though an aggregate model usually does not need to be validated for the entire parameter space nor the whole simulation time our work improves this situation in three ways in line with coutinho et al 2016 we first present detailed evidence that a general agreement between fd models and their aggregate counterparts is closely linked to the predominant selection regime hence comparing fd and corresponding aggregate models under different but well defined environmental conditions revealed the structural components i e the shape properties of the fitness landscape and trait distribution that are responsible for the success or failure of the approximations and thus which underlie the dynamics of the fd model therefore knowledge about the shape of natural trait distributions or corresponding selection regimes may sufficiently inform about the behavior of trait based aggregate models compared to corresponding fd models and circumvent the need for a detailed model comparison based on numerical simulations second we show that the beta distribution captures important shape properties of natural and simulated trait distributions which cannot be reflected by a gaussian but which are important to restrict changes in the mean trait and variance values to their ecologically feasible ranges in contrast na models usually require additional functional terms to keep traits bounded hence conducting a moment closure based on the well defined relationships between the lower and higher moments of the beta distribution instead of the normal distribution greatly enhanced the reliability of aggregate models under fluctuating selection this increases the range of situations that can be treated successfully using moment approximation methods finally we obtained a more comprehensive understanding of the mechanisms that may promote the maintenance of functional diversity in trait based aggregate models by analyzing the aggregate model equations we explicitly provide the connection between higher moments of the trait distribution and higher derivatives of the fitness landscape and the preservation of the trait variance for a quite general class of models see appendix e to conclude our study shows that conducting a moment closure based on the beta distribution rather than the normal distribution may strongly improve the reliability of aggregate models when applied to natural communities e g with respect to the temporal average and variation of the communities biomass and trait composition this holds in particular when mean trait values change over time e g due to strong fluctuating selection caused by endogenous or environmental changes such as seasonal temperature variation acknowledgments we thank ruben ceulemans ellen van velzen alice boit and three anonymous reviewers for helpful comments and suggestions tk was funded by the german research foundation dfg ga 401 26 1 rmc was supported through grant 2014 23497 0 são paulo research foundation fapesp brazil appendix a derivation of an aggregate model temporal changes in the aggregate properties of a community i e its total biomass r t mean trait x and trait variance ν can be conveyed from the changes of the population biomasses of the individual species a1 r x t f x r x i where f x denotes the per capita net growth rate the fitness function of the species with trait value x ranging between 0 and 1 whose biomass is r x the species fitness function f x r t x ν generally depends on the entire trait distribution of the community such as r t x and ν however for the sake of brevity we stick to f x throughout the derivation the small but constant immigration rate i ensures long term persistence of all trait values i e species the aggregate properties of a community are calculated according to the following set of equations a2 r t 0 1 r x d x a3 x 1 r t 0 1 x r x d x a4 ν 1 r t 0 1 x x 2 r x d x instead of describing the dynamics of the community with differential equations defined at the population level one may focus directly on a system of differential equations that describes the rates of change of the community s aggregate properties thereby allowing insight into the properties of the fitness landscape and trait distribution that drive their dynamics in general such aggregate models approximate the temporal development of the aggregate properties by first truncating the taylor series of the fitness function developed around x after some low order e g second order terms afterwards the resulting set of equations has to be closed by expressing the higher central moments such as skewness s and kurtosis k in terms of the lower central moments modelled such as x and ν as all odd moments skewness quantifies some degree of asymmetry of a distribution left skewed distributions exhibit negative values of s whereas right skewed distributions exhibit positive values of s in contrast kurtosis quantifies the amount of dispersion of mass around the shoulders x ν of a distribution based on this high values of k are associated with distributions having high mass at their center x and tails x 2 ν compared to their shoulders a 1 second order approximations of the rates of change of the aggregate properties the rate of change of rt is given by the integral of the rate of change of r x with respect to x over the trait range 0 1 a5 d r t d t d d t 0 1 r x d x 0 1 r x t d x 0 1 r x f x i d x 0 1 r x f x d x i 0 1 d x noting that 0 1 d x 1 and expanding the fitness function f in a taylor series around x we get a6 d r t d t 0 1 r x k 0 x x k k k f x x k x x d x i we can rearrange the terms of eq a6 to express the rate of change of rt as an infinite sum of products of the k th derivative of the fitness function and the k th central moment m k of the trait distribution a7 d r t d t r t k 0 1 k k f x x k x x 1 r t 0 1 r x x x k d x m k i to highlight the interaction between the higher order central moments and the higher derivatives we can rewrite eq a7 in the following way a8 d r t d t r t f x x x ν 2 2 f x x 2 x x m 3 6 3 f x x 3 x x m 4 24 4 f x x 4 x x i given that m 0 1 m 1 0 and m 2 ν similarly the rate of change of x is given by the quotient rule of differential calculus using eq a3 a9 d x d t 1 r t 2 d d t 0 1 x r x d x r t 0 1 x r x d x d r t d t using the definition of x eq a9 can be expressed as a10 d x d t 1 r t 0 1 x r x t d x x d r t d t by extending the first term of eq a10 with x we can eliminate its second term a11 d x d t 1 r t 0 1 x x x r x t d x x d r t d t 1 r t 0 1 x x r x t d x x 0 1 r x t d x x d r t d t 1 r t 0 1 x x r x t d x 1 r t 0 1 x x r x f x i d x evaluating the effect of external immigration i leads to a12 1 r t 0 1 x x r x f x d x i r t 0 1 x x d x 1 r t 0 1 x x r x f x d x i r t x 2 2 x x 0 1 1 r t 0 1 x x r x f x d x i r t 1 2 x expanding again the fitness function f in a taylor series around x and rearranging the terms thereafter we get a13 d x d t 1 r t 0 1 r x k 0 x x k k k f x x k x x x x d x i r t 1 2 x k 0 1 k k f x x k x x 1 r t 0 1 r x x x k 1 d x m k 1 i r t 1 2 x with m k 1 denoting the k 1 th central moment of the trait distribution again we rewrite eq a13 to highlight the interaction between the higher central moments of the trait distribution and the higher derivatives of the fitness function a14 d x d t ν f x x x x m 3 2 2 f x x 2 x x m 4 6 3 f x x 3 x x i r t 1 2 x given that m 1 0 and m 2 ν finally the rate of change of ν is also given by the quotient rule of differential calculus a15 d ν d t 1 r t 2 d d t 0 1 x x 2 r x d x r t 0 1 x x 2 r x d x d r t d t now we use the product rule of differential calculus and the definition of the variance to display eq a15 as a16 d ν d t 1 r t 0 1 r x t x x 2 d x 0 1 r x d x x 2 d t d x ν d r t d t applying the chain rule of differential calculus we see that the second term of eq a16 is zero a17 1 r t 0 1 r x d x x 2 d t d x 1 r t 0 1 r x 2 x x d x x d t d x 2 1 r t 0 1 r x x x d x d t 0 d x 2 d x d t 1 r t 0 1 r x x x d x m 1 0 deploying this result into eq a16 leads to a18 d ν d t 1 r t 0 1 r x t x x 2 d x ν d r t d t 1 r t 0 1 f x r x i x x 2 d x ν d r t d t again evaluating the effect of external immigration i leads to a19 i r t 0 1 x x 2 d x i r t x 3 3 x x 2 x 2 x 0 1 i r t 1 12 1 2 x 2 leading to a20 d ν d t 1 r t 0 1 f x r x x x 2 d x ν r t d r t d t i r t 1 12 1 2 x 2 conducting a taylor expansion of the fitness function around x in the first term and applying the results from eq a7 to its second term d ν d t can be written as a21 d ν d t k 0 1 k k f x x k x x 0 1 r x r t x x k 2 d x m k 2 ν k 0 1 k k f x x k x x 0 1 r x r t x x k d x m k i r t 1 12 v 1 2 x 2 k 0 m k 2 ν m k 1 k k f x x k x x i r t 1 12 v 1 2 x 2 in analogy to eq a14 we rewrite eq a21 in the following way a22 d ν d t ν ν m 0 1 0 f x x x m 3 ν m 1 0 m 3 f x x x x m 4 ν 2 2 2 f x x 2 x x m 5 ν m 3 6 3 f x x 3 x x i r t 1 12 v 1 2 x 2 since skewness s and kurtosis k are defined as the standardized central moments of third m 3 s ν 3 2 and fourth m 4 k ν 2 orders of a trait distribution a second order approximation in f of d r t d t eq a8 d x d t eq a14 and d ν d t eq a22 leads to the aggregate model defined by the eqs 12 14 in the methods section this approximation is good when v is small or the non linearity of the fitness function f is weak abrams et al 1993a taylor and day 1997 gaedke and klauschies 2017 finally since the rates of change of the lower central moments depend on the higher central moments one has to close the system of differential equations this is usually achieved by expressing the higher moments in terms of the lower ones there are different moment closure techniques available each making distinct assumptions about the shape of the trait distributions wirtz and eckhardt 1996 norberg et al 2001 merico et al 2009 for simplicity a normal distribution based moment closure is often conducted tirok et al 2011 terseleer et al 2014 acevedo trejos et al 2015 where s 0 and k 3 are independent of x and ν this strongly reduces the complexity of the aggregate model defined by eqs 16 and 17 at the cost of assuming the trait to be defined on an infinite range and the trait distribution to be unimodal and symmetric however ecologically important traits such as body size or time spent for searching or handling prey items are restricted to a finite range in addition fluctuating or disruptive selection may promote trait distributions exhibiting skewness or bimodality coutinho et al 2016 gaedke and klauschies 2017 for this reason we will derive an alternative moment closure based on the assumption that the trait distribution follows the shape of a beta distribution which can accommodate such features cf fig 1 a 2 beta distribution based moment closure assuming the trait value x to be beta distributed r x can be written as a23 r x a b r t b a b x a 1 1 x b 1 with b 0 1 x a 1 1 x b 1 d x being the beta function and a 0 and b 0 being the shape parameters of the beta distribution the mean x variance ν skewness s and kurtosis k of the beta distribution are given by gupta and nadarajah 2004 a24 x a a b a25 ν a b a b 2 a b 1 a26 s 2 b a a b 1 1 2 a b 2 a b 1 2 a27 k 6 a b 2 a b 1 6 a b a b 2 a b a b 2 a b 3 since the beta distribution only depends on the two shape parameters a and b we can derive corresponding moment closure equations for an aggregate model in that s and k of the beta distribution are expressed in terms of x and ν only first we have to employ eqs a24 and a25 to express a and b as functions of x and ν substituting a b a x and b a 1 x x from eq a24 into eq a25 we get a28 ν a 2 1 x x a x 2 a x 1 x 1 x a x 1 rewriting eq a28 in terms of a as a function of x and ν leads to a29 a x 2 1 x x ν ν furthermore substituting eq a29 into an alternative form of eq a24 i e b a 1 x x leads to an expression of b as a function of x and ν a30 b x 1 x 2 1 x ν ν now we use eqs a24 a25 a26 a29 and a30 to express s as a function of x and ν rewriting eq a24 as a b a x or b a 1 x x and eq a25 as ν 1 2 a b 1 a b 1 1 2 a b 1 2 and substituting them sequentially into eq a26 leads to a31 s 2 b a a b 2 a b ν 1 2 2 b a a x 2 a x ν 1 2 2 a 1 x x 1 a x 2 a x ν 1 2 2 1 2 x x a x 2 1 x ν 1 2 2 1 2 x a x 2 ν 1 2 furthermore substituting eq a29 into eq a31 now allows to write s as a function of x and ν a32 s 2 1 2 x x 2 1 x x ν ν x 2 ν 1 2 2 1 2 x x 1 x ν 1 ν 1 2 2 1 2 x ν 1 2 x 1 x ν finally we use eqs a24 a27 a29 and a32 to express k as a function of x ν and s rewriting eq a27 leads to a33 k 6 a b 2 a b 1 a b a b 2 a b 3 6 a b 3 3 a b 2 2 a b 3 4 b a 2 a b 1 a b 2 2 a b 6 a b 3 now we can simplify the first term of eq a33 by rewriting the first factor and substituting the second factor by the square of s i e s 2 4 b a 2 a b 1 a b 2 2 a b leading to a34 k 2 a b 4 a b 12 4 a b 3 s 2 6 a b 3 a b 2 a b 3 1 s 2 6 a b 3 rewriting eq a24 as a b a x and substituting it into eq a34 leads to a35 k a x 2 a x 6 1 s 2 6 a x 3 using eq a29 we can express k as a function of x and ν leading to a36 k x 1 x ν ν 2 x 1 x ν ν 6 1 s 2 6 x 1 x ν ν 3 x 1 x ν 2 x 1 x 2 ν 6 ν 1 s 2 6 ν x 1 x ν 3 ν x 1 x ν 2 x 1 x 4 ν 1 s 2 6 ν x 1 x 2 ν finally rewriting eqs a32 and a36 in terms of the third and fourth central moments allows us to conduct a beta distribution based moment closure plugging the following set of equations into expressions a8 a14 and a22 a37 m 3 s ν 3 2 2 1 2 x ν 2 x 1 x ν a38 m 4 k ν 2 1 x x ν 4 ν 2 1 x x 1 s 2 6 ν 2 ν 1 x x 3 ν 2 hence trait distributions with smaller ν are unimodal but also often peaked high k and skewed high s depending on x in contrast trait distributions with larger ν tend to be flat or in its extreme bimodal low k and symmetric s 0 fig 1 appendix b sensitivity analysis i changes in model structure to test the robustness of our results with respect to changes in the model structure we conducted numerical simulations with three other ecological models partly used in recent studies demonstrating the suitability of aggregate model approaches first we investigated the predator prey model from merico et al 2009 in which the trade off between the nutrient uptake efficiency of the prey and its defense against predation imposes stabilizing selection on the trait distribution of the prey community second we explored the species competition model from norberg et al 2001 in which recurrent changes of an environmental factor such as temperature impose fluctuating selection on different species third we analyzed a modified version of our predator prey model from the main text in which a trade off between the vulnerability of the prey species with respect to grazing by the two specialist predators imposes disruptive selection on the trait distribution of the prey community in all three cases we first run numerical simulations of the full trait distribution fd model by discretizing the trait axes of the associated community n 101 afterwards we derived the equations of a corresponding aggregate model with a second order approximation and performed a moment closure either based on a beta distribution or a normal distribution subsequently we also conducted numerical simulations of the corresponding ba and na models and compared their results to the ones of the fd model b 1 full trait distribution model with stabilizing selection following merico et al 2009 we first consider a chemostat model with a set of prey species c that differ in their trait values influencing their uptake of nutrients n and vulnerability to predation by a single predator b the corresponding set of differential equations is given as follows b1 d n d t μ c κ 0 1 n n k n x c x d x m c κ c t δ n 0 n b2 c x t μ c n n k n x μ b ε φ x b 0 1 φ x c x d x k c m c δ c x b3 d b d t μ b κ 0 1 φ x c x d x 0 1 φ x c x d x k c m b δ b the nutrient replenishment in the chemostat depends on the nutrient concentration n0 that enters the chemostat vessel the dilution rate δ and the nutrient recycling through prey mortality m c cf merico et al 2009 in contrast the nutrient uptake of the prey follows a michaelis menten kinetic with the maximum uptake rate μ c and the effective half saturation constant k n x k n 1 κ φ x 1 which depends on the basal half saturation constant k n the fraction of energy invested in generic biomass κ and the prey s edibility φ x x 1 κ 1 which is a function of the prey s level of defense x given that φ x 1 κ can range from 1 to for details see merico et al 2009 it is impossible to develop a beta distribution based aggregate model that considers trait variation in the prey s edibility because the beta distribution is constrained to the open interval 0 1 hence in contrast to merico et al 2009 we considered trait variation in the prey s defense level x φ φ 1 κ 1 that actually varies between 0 and 1 the prey species are assumed to exhibit a trade off between their nutrient uptake efficiency k n x and defense level x φ which determines the vulnerability to grazing by the predator hence the partitioning of the remaining fraction of energy 1 κ between nutrient harvesting biomass and defense biomass is species specific for details see merico et al 2009 the corresponding shape of the trade off imposes stabilizing selection on the trait distribution of the prey community in addition foraging on the prey follows a type ii functional response with maximum growth rate μ b conversion efficiency ε and half saturation constant k c like the prey the predator experiences natural mortality m b and is washed out from the chemostat with the dilution rate δ in accordance with our previous results for stabilizing selection shown in the main text fig 3 both aggregate models perfectly captured the macroscopic properties of the fd model fig b1 the total biomass of the prey community and the predator biomass exhibited regular oscillations whereas the mean trait value reached an equilibrium after a short transient as a result of stabilizing selection the variance dropped towards zero which strongly reduced the adaptive capacity of the prey community cf merico et al 2009 the numerical integration of both aggregate models were up to 4 times faster than that of the fd model table b1 there was no significant difference between the simulation times of the ba model and the na model hence the results of both aggregate models are reliable under stabilizing selection and their numerical integration is computationally more efficient than running simulations of the fd model b 2 full trait distribution model with fluctuating selection in line with norberg et al 2001 we further consider a species competition model with a set of species c that compete for a shared resource and that exhibit differences in their trait values the corresponding equations to describe the temporal changes in the biomasses of the different species are b4 c x t p e x e σ 2 1 c t k d c x i the model extends logistic growth by including interspecific competition with k and c t being the joint carrying capacity and the sum of all population biomasses respectively the growth rate of a species further depends on its specific phenotype x varying between 0 and 1 the maximum growth rate p and the state of a time varying environmental factor e a sin ω t m which oscillates around a fixed value m with amplitude a and frequency ω to restrict e and thus the trait distribution to the ecologically feasible range 0 1 we chose m and a to equal 0 5 respectively the influence of the environmental changes on the species growth rates depends on the scaling parameter σ hence the recurrent changes in the environmental conditions e impose fluctuating selection on the underlying populations because different species are favored by the enviroment at different times furthermore the biomasses of the populations are declining at the mortality rate d to ensure the coexistence of all species a constant amount of biomass of each species was assumed to enter the system through immigration hence we added the immigration rate i to eq b4 in line with our previous results for fluctuating selection fig 4 the ba model captured the overall shape of the dynamics of the total biomass mean trait and trait variance of the fd model and their temporal averages quite well fig b2 in contrast the na model agreed with the fd model only with respect to the time averages of the aggregate properties and the shape of the mean trait dynamics generally the mean trait value of the community closely tracked the temporal changes of the optimal trait value currently selected by the environment fig b2d f however the sinusoidal shape of the environmental factor resulted in a time averaged bimodal distribution of the optimal trait values kremer and klausmeier 2017 consequently the community was generally better adapted during times when the sign of the rate of change of the environmental factor was changing this resulted in biomass dynamics where a larger peak in the total biomass at mean trait values close to the extremes followed a smaller peak in the total biomass at a mean trait value of 0 5 cf norberg et al 2001 this pattern was nicely encompassed in the results of the ba model but not in the ones of the na model fig b2a c in contrast to the fd and ba models the biomass dynamics of the na model exhibited a lower frequency and two differently sized peaks that were only associated with mean trait values close to the extremes furthermore when the environmental conditions changed towards more intermediate optimal trait values a larger range of trait values was favored promoting simultaneous growth of many different species consequently in the fd model we observed an overall increase in the trait variance that was interrupted by a short period when the variance declined again the latter resulted from a strong reduction in the biomasses of species exhibiting more extreme trait values hence the variance dynamics of the fd model showed a larger peak in the trait variance that preceded a smaller peak for details see fig 2 from norberg et al 2001 in contrast when the environmental conditions selected for extreme trait values we observed a strong reduction in the trait variance although the smaller peak of the trait variance was not well expressed in the ba model the general course of the temporal dynamics of the trait variance was still very similar to the fd model the ba model reflects the frequency and the amplitude of the dynamics as well as the presence of a pronounced peak in the trait variance at a particular moment in time in contrast the na model showed hardly any temporal variation in the trait variance hence the accuracy of our novel moment closure method based on the beta distribution strongly exceeded the one of a corresponding normal distribution based moment closure approach under fluctuating selection our result is further supported by the good performance of a data based aggregate predator prey model from norberg et al 2001 that accounted for important statistical relationships between lower and higher moments the numerical integration of both aggregate models was almost twice as fast as that of the fd model whereas the simulation times of the ba model and the na model were similar table b1 b 3 full trait distribution model with disruptive selection finally we consider a model with two different predators c that are grazing upon a set of prey species r with continuous trait values in contrast to our predator prey model from the main text we assumed the shape of the feeding functions to be sigmoidal instead of unimodal furthermore we assumed the strength of resource competition to differ between the different prey species the corresponding population biomasses thus change according to the following set of equations b5 r x t r 1 0 1 c x x r x d x κ r x i 1 2 a i x r x c i 1 h 0 1 a i x r x d x i b6 d c i d t ε 0 1 a i x r x d x 1 h 0 1 a i x r x d x d c i b7 c x x 1 σ 2 π e 1 2 x x σ 2 b8 a 1 x a m a x a m i n 1 e s x w 1 a m i n b9 a 2 x a m a x a m i n 1 1 e s x 1 w 1 a m i n in the absence of predation the prey species exhibit logistic growth with r and κ being the maximum growth rate and joint carrying capacity respectively given that trait differences may result in niche differences between species the strength of competition may depend on the species trait similarity hence we implemented the competition kernel c macarthur and levins 1967 and thus assumed that prey species with more similar trait values are competing more strongly with each other than species with very different trait values this is in line with the assumption that intraspecific competition of the prey is larger than interspecific competition which stabilizes species coexistence the width of the competition kernel is determined by the scaling parameter σ furthermore predation follows a type ii functional response with a common handling time h and the predator specific attack rates a 1 and a 2 with minimum and maximum values of a m i n and a m a x hence the predation rates of the two different predators depend on the phenotype x of the individual prey species in line with previous work from abrams 2006 and schreiber et al 2011 we assumed a trade off between the prey s vulnerability to predation by the two specialist predators the shape of which depend on the parameters s and w by using a value of w equal to 0 75 we generated a concave shaped trade off curve that imposes disruptive selection on the trait distribution of the prey community nevertheless we ensured the persistence of all prey by adding the immigration rate i to eq b5 in line with our previous results for disruptive selection displayed in the main text fig 6 both aggregate models failed to reproduce the dynamics of the aggregate properties of the fd model here the total biomasses of the prey and predator communities showed regular predator prey cycles because the population biomasses of the two predators were synchronized fig b3 a in addition the trait distribution of the prey community was symmetric around the mean trait value of 0 5 throughout time fig b3d depending on the respective strength of competition and predation the shape of the trait distribution of the prey community was either rather uniform or bimodal at low prey biomasses immigration strongly influenced the population dynamics promoting uniform trait distributions of the prey community with variance values down to 1 12 fig b3a and g in contrast a high predation pressure on the prey species with intermediate trait values at high prey biomasses selected for bimodal trait distributions with variance values up to 0 2 neither the ba model nor the na model was able to reproduce these patterns despite showing regular predator prey oscillations both aggregate models underestimated the amplitude of the total biomass of the prey community fig b3a c furthermore and in contrast to the fd model one of the predators went extinct however in line with our previous results e g fig 5 the values of the mean trait and trait variance stayed within the ecologically feasible ranges in the ba model fig b3e and h in contrast the aggregate properties surpassed their natural limits in the na model fig b3f and i the numerical integration of both aggregate models was about 30 times faster than that of the fd model but this strong reduction in simulation time comes at a too high cost given that the results of the aggregate models are not reliable unexpectedly the simulation time of the na model was somewhat longer than the one of the ba model table b1 while the gaussian based approximation is valid in a narrower parameter range than the beta approximation the na model may be more useful in practice if both model types are sufficiently accurate this may follow from the fact that the na model is far simpler than the ba model and so it should be both computationally faster to calculate and easier to work with analytically however the computation times depend not only on the complexity of the moment closure terms themselves but also on the stiffness of the resulting equations that strongly depends on the derivatives of the fitness landscape and this favors in general the beta distribution when the trait range is finite furthermore reliable trait based aggregate models should not only provide shorter simulation times but also be easier to fit to data cf fig 2 appendix c sensitivity analysis ii changes in parameter values to test the robustness of our results with respect to parameter changes we conducted numerical simulations with different carrying capacities κ 10 0 7 10 0 71 10 1 3 and minimum attack rates a m i n 2 1 2 1 1 2 3 thereby simulating changes in the bottom up regulation and top down control of the prey community under fluctuating selection in addition we tested for a potential dependency of the biomass and trait dynamics on immigration by running further simulations of the different models for very different immigration rates i 10 2 10 2 1 10 6 all other parameter values were the same as before see table 1 for a few simulations we had to increase the precision of the solver reducing the relative and absolute tolerances and maximum step size cf figs c2 and c3 grey shaded areas the corresponding results show that the temporal mean and variance of the biomass and trait dynamics are very similar across the range of parameter values evaluated for the three different parameters figs c1 c3 furthermore the exact shape of the trait and biomass dynamics of the beta distribution based aggregate ba and full trait distribution fd models also agreed very well for most of the three parameter ranges considered i e for 1 3 l o g 2 a m i n 2 7 for 20 κ 8 and for 2 l o g 10 i 5 2 for a representative example see fig 4 hence the general results described in the main text are fairly robust with respect to parameter changes however as with the results of the normal distribution based aggregate na model for the entire ranges of the three parameters the biomass and trait dynamics of the ba model were very different from the ones of the fd model in case of very low immigration rates and rather low carrying capacities the former result implies that a small amount of immigration and thus standing trait variation is necessary to ensure ongoing oscillations in the biomass and trait values of the ba model and thus a good match with the fd model this happens because the second order correction of d x d t is not strong enough to prevent x from becoming stuck at a local fitness maximum when immigration and thus standing trait variation as well as the third central moment are too low in addition reducing the carrying capacity to rather low values strongly stabilized the predator prey biomass dynamics fig c2 as a result changes in the fitness landscape were less pronounced so that it became more likely for x to get stuck at a persistent local fitness maximum despite the second order correction based on the previous results fig 5 we can expect that the na model comprises alternative stable states throughout the ranges of the different parameters in addition because the food web structure is symmetric we also expect that the ba model will exhibit an alternative state for lower values of the carrying capacity and low values of the immigration rate the numerical integration of the ba model was quite demanding or even not feasible in small regions of the parameter space of κ and i figs c2 and c3 grey shaded areas a possible explanation is that the assumed shape of a trait distribution generally imposes some constraints on the conditions including initial conditions and parameters under which a corresponding aggregate model can provide an adequate representation of the biomass and trait dynamics for example in the ba model the shape of the trait distribution of the immigrating community is assumed to follow a uniform distribution whereas the one of the resident community is assumed to follow a beta distribution however as is also the case with the normal distribution the sum of a beta and a uniform distribution does not necessarily have to be beta distributed in such a case the relationships between the lower and higher moments cannot be adequately described anymore by the moment closure equations of the beta distribution hence the beta distribution based moment closure may interfere with the mechanism assumed to maintain the trait variance as a potential result the ba model may not have a suitable solution or numerical integration may get very laborious due to stiffness appendix d skewness restricts mean trait values to the ecologically feasible range in contrast to the na model the mean trait value x of the ba model always stayed within its ecologically feasible range because the beta distribution is intrinsically bounded here we show that this feature may generally arise from a strong increase in skewness s when x approaches one of the extremes to focus on the effect of changes in s alone on the biomass and trait dynamics we derive here an aggregate model based on the assumption that the shape of the trait distribution follows a special case of the johnson sb distribution johnson 1949 and thus becomes skewed when x approaches one of the extremes for details see below nevertheless the initial approximations made in the derivation ensure that no other terms arise that may reflect accompanying changes in the kurtosis k of the trait distribution hence any effect that arises has to be attributed to s alone in accordance with the analysis performed for the model comparison presented in the main text we conducted numerical simulations of our johnson sb distribution based aggregate model ja model under different selection regimes all corresponding simulations lasted for 104 time units overall the simulation results of the ja model were very similar to the ones of the na model compare fig d1 to figs 3 5 and 7 of the main text however the mean trait value x of the ja model never exceeded its ecologically feasible range which contrasts with the results of the na model this feature was independent of the selection regime imposed compare fig d1 to figs 5 and 7 of the main text this is explained by the strong decline of ν due to increasingly large absolute values of s when x approaches one of the extremes quickly slowing down d x d t hence an increase in s limits the changes in x indirectly via changes in ν this feedback between d x d t and d ν d t suggests that the skewness and thus asymmetry of a trait distribution is very important for preventing the emergence of unrealistic values of the aggregate properties we acknowledge that in addition to the indirect effect of s x may also be more directly limited in the ba model via the second term of eq 13 for example in the simplest case of disruptive selection the fitness gradient drives x towards one of the extreme values cf fig e1b e however since the second derivative is positive the sign and value of s operate in the opposite direction to the fitness gradient cf fig e1e h slowing down d x d t and likely preventing x from overcoming its limits neither mechanism described can act in the na model to restrict mean trait values to their ecologically feasible ranges derivation of the johnson sb distribution based aggregate ja model in contrast to appendix a we now assume that the trait x is a function of another trait y whose values are assumed to be normally distributed following abrams 1999 we used a sigmoidal function to describe the transformation of the trait y defined on a continuous infinite range to the trait x defined on a continuous finite range between zero and one d1 x y e y 1 e y hence the distribution of x is a special case of the johnson sb distribution i e a logit normal distribution with parameters γ 0 δ 1 μ y and σ ν y johnson 1949 although the johnson sb distribution may in principle also be bimodal our derivation below does not give rise to terms that may reflect excess kurtosis and thus bimodal shape properties when conducting a moment closure based on the assumption of normally distributed trait values y i e y n y ν y a second order approximation of the equation describing the temporal dynamics of y is given by see eq 16 of the methods section d2 d y d t ν y f y y y where f is the per capita net growth rate fitness of the species as a function of y the mean trait x is given by d3 x n y x y d y a taylor expansion of x y around y yields d4 x n y k 0 y y k k k x y y k y y d y k 0 1 k k x y y k y y n y y y k d y m k for simplicity we will use a first order approximation of x d5 x x y y y ν y 2 2 x y y 2 y y m 3 6 3 x y y 3 y y m 4 24 4 x y y 4 y y x y applying twice the chain rule the temporal dynamics of x is described by d6 d x d t d x d y d y d t d x d y ν y f y y y d x d y ν y d x d y f x x x y y ν y d x d y 2 f x x x based on eq d5 the derivative of x with respect to y is given by d7 d x d y e y 1 e y e y e y 1 e y 2 e y 1 e y 1 e y e y 1 e y x 1 x inserting eq d7 into eq d6 yields d8 d x d t ν y x 1 x 2 f x x x in analogy to eq 16 or eq d2 the product in front of the first derivative of eq d8 is akin to the variance of the trait x hence defining ν x ν y x 1 x 2 eq d8 becomes d9 d x d t ν x f x x x proceeding as before a second order approximation of the equation describing the temporal dynamics of ν y is given by see eq 17 of the methods section d10 d ν y d t ν y 2 2 f y 2 y y applying first the chain rule and then using eqs d9 and d10 the equation describing the temporal dynamics of ν x is given by d11 d ν x d t ν x ν y d ν y d t ν x x d x d t ν x ν y ν y 2 2 f y 2 y y ν x x ν x f x x x given that ν y ν x x 1 x 2 we can express ν x x as d12 ν x x 2 ν y x 1 x 1 2 x ν x 2 1 2 x x 1 x inserting eq d12 ν x ν y x 1 x 2 and ν y 2 ν x 2 x 1 x 4 into eq d11 yields d13 d ν x d t ν x 2 x 1 x 2 2 f y 2 y y ν x 2 2 1 2 x x 1 x f x x x rewriting 2 f y 2 y y leads to d14 2 f y 2 y y f y y y y d x d y f x x x y y y 2 f x y x x y y d x d y f x x x d 2 x d y 2 2 f x 2 x x d x d y d x d y f x x x d 2 x d y 2 2 f x 2 x x d x d y 2 f x x x d 2 x d y 2 using eq d7 the second derivative of x with respect to y is given by d15 d 2 x d y 2 d d x d y d y d x 1 x d y d x d y 1 x x d x d y d x d y 1 2 x x 1 x 1 2 x inserting eq d7 and eq d15 into eq d14 yields d16 2 f y 2 y y 2 f x 2 x x x 1 x 2 f x x x x 1 x 1 2 x now substituting eq d16 into eq d13 and simplifying the resulting expression gives d17 d ν x d t ν x 2 2 f x 2 x x 3 1 2 x x 1 x f x x x in line with eq 14 of the methods section we can rewrite eq d17 as d18 d ν x d t s ν x 3 2 f x x x ν x 2 2 f x 2 x x with s 3 1 2 x ν x x 1 x representing the skewness of the trait distribution notice that s is symmetrical around 0 5 and tends to positive or negative infinity when x approaches the extremes of the trait range 0 and 1 finally we add the immigration terms of eqs 13 and 14 to eqs d9 and d18 leading to the following approximated equations of an aggregate model based on the assumption that x follows a unimodal but skewed trait distribution d19 d x d t ν x f x x x i r t 1 2 x d20 d ν x d t s ν x 3 2 f x x x ν x 2 2 f x 2 x x i r t 1 12 ν x 1 2 x 2 this johnson sb distribution based aggregate model ja model underlies the results presented in fig d1 appendix e skewness and kurtosis jointly promote the maintenance of functional diversity we found strong negative correlations between the skewness s and the mean x and between the kurtosis k and the variance ν of the observed phytoplankton size distributions that are well captured by the beta distribution fig 2 here we show that these relationships may provide a general and intrinsic mechanism to promote the maintenance of functional diversity i e strictly positive values of the trait variance in trait based aggregate models even in the absence of frequency dependent selection in order to do so we analyzed the stability of potential fixed points of the approximated aggregate model equations under simplifying assumptions for two different moment closure approaches and run additional simulations of an extended version of the ba model e 1 convergent stable fitness minima under frequency independent selection according to appendix a the equations describing the temporal dynamics of x and ν of a full trait distribution fd model which does not contain immigration are approximated up to the second order as e1 d x d t ν f x x x x s ν 3 2 2 2 f x x 2 x x e2 d ν d t s ν 3 2 f x x x x k ν 2 ν 2 2 2 f x x 2 x x for convenience we will first neglect frequency dependent natural selection which allows us to explore a novel mechanism that can stabilize a fixed point of the mean trait value at a fitness minimum hence we suppose the species fitness function f to depend only on the total biomass r t and its individual trait value x but not on the mean and variance of the entire frequency trait distribution cf abrams et al 1993b however our results may also apply to some special cases of frequency dependent selection as discussed in more detail below assuming a normal trait distribution enables a moment closure of the aggregate model based on s m 3 ν 3 2 0 and k m 4 ν 2 3 and thus allows a simplification of eqs e1 and e2 to e3 d x d t ν f x x x x e4 d ν d t ν 2 2 f x x 2 x x hence the mean trait x changes in the direction of the local fitness gradient and thus moves towards a local maximum of the ﬁtness landscape f x where it remains constant once reaches it because the local fitness gradient f x x x is zero at this point fig e1 at or near a local fitness maximum the second derivative of the fitness landscape evaluated at the mean trait value 2 f x 2 x x attains a negative value so that the trait variance ν vanishes and the system loses its adaptability since x can no longer change this demonstrates that the equations of a na model inherently promote the loss of functional diversity also under scenarios of disruptive selection fig e1a d g so that it has to be maintained by other ecological processes such as immigration mutation or more complex trade off structures tirok et al 2011 merico et al 2014 coutinho et al 2016 in contrast as shown below the relationships between lower and higher central moments entailed in the beta distribution based moment closure equations offer an alternative explanation and mechanism for the maintenance of functional diversity and thus for keeping ν above zero in order to achieve a basic understanding of how the different functional terms of eqs e1 and e2 may interact to shape the overall temporal dynamics of x and ν we first analyze the local stability of a potential fixed point x of eq e1 i e we consider a situation where d x d t x x 0 for simplicity we assume that the skewness depends only on the mean trait value s x while the kurtosis depends only on the trait variance k ν this seems to be reasonable given that x explains much of the variation in s and ν explains much of the variation in k both for natural and simulated trait distributions fig 2 we also assume that the trait distribution is symmetric at the equilibrium i e s x 0 which seems to be valid under rather balanced selection regimes where the fitness landscape is also symmetric around x fig e1 under these simplifying conditions the full jacobian of the two dimensional system of eqs e1 and e2 at the fixed point with positive ν becomes diagonal allowing us to perform the analysis of each equation separately hence in this case a potential fixed point x of eq e1 satisfies the following condition f x x x 0 therefore x is situated either at a local fitness maximum or at a local fitness minimum of the corresponding fitness landscape considering that 2 f x 2 x x 0 we disregard the possibility of an inflection point which would require very special assumptions about the fitness function f a negative value of the derivative of eq e1 with respect to x evaluated at x implies its local stability e5 d d x d t d x x x ν 2 f x x 2 x x s x x x ν 3 2 2 2 f x x 2 x x s ν 3 2 2 3 f x x 3 x x since the trait distribution is assumed to be symmetric at the equilibrium i e s x 0 this simplifies to e6 d d x d t d x x x ν 2 2 s x x x ν 1 2 2 f x x 2 x x in line with the general properties of eq 18 and the observed negative correlation between s and x of the phytoplankton size distributions fig 2 we expect that s x x x 0 given that 2 f x 2 x x is negative at a fitness maximum cf fig e1 x will be stable when s x x x ν 1 2 2 and unstable otherwise in contrast 2 f x 2 x x is positive at a fitness minimum cf fig e1 so x will be stable if 2 s x x x ν 1 2 and unstable otherwise remarkably this means that if a small perturbation of x from its equilibrium x leads to a substantial increase of s of the trait distribution and ν is large enough a fixed point at a fitness minimum will be stable the local fitness landscape around the fixed point x can be approximated by a parabolic function so a perturbation of x away from x leads to asymmetric growth skewing the trait distribution moreover since the fitness function decreases towards x fig e1e s x will have the opposite sign of x x so s x x x will be negative this change in s increases with the degree of curvature of the local fitness landscape 2 f x 2 x x hence a fixed point at a fitness minimum is likely to be stable when the local fitness landscape exhibits a pronounced valley cf fig e1 this contrasts with the results of a na model cf eqs e3 and e4 where the fixed point x of d x d t at a fitness maximum is always stable and at a fitness minimum always unstable with this insight at hand we will now consider eq e2 describing the temporal development of the trait variance ν i e functional diversity in response to selection since the mean trait value x x is at a fixed point at a fitness minimum or maximum the local fitness gradient f x x x x equals zero hence eq e2 simplifies to e7 d ν d t k ν 2 ν 2 2 2 f x x 2 x x this equation has at most two ﬁxed points once again disregarding an inflection point of the fitness function an ecologically trivial one ν 0 and a nontrivial one that is implicitly defined by the equation k ν 1 the local stability of the latter can be determined from the sign of the following equation e8 d d ν d t d ν ν ν 2 f x x 2 x x k ν ν 2 2 k 2 ν 2 2 ν 2 ν ν 2 f x x 2 x x k ν ν 2 2 ν k 1 ν ν hence setting k ν 1 into eq e8 leads to e9 d d ν d t d ν ν ν 2 f x x 2 x x k ν ν 2 2 ν ν in line with the general properties of eq 19 and the observed negative correlation between k and ν of the phytoplankton size distributions fig 2 we expect that k ν ν ν 0 hence the ecologically non trivial fixed point ν is stable when the fixed point x is at a fitness minimum and unstable when the fixed point x is at a fitness maximum taking the two results of the preceding linear stability analyses of x and ν together we found that the negative correlations between lower and higher central moments may jointly promote the maintenance of functional diversity i e ν 0 by keeping x at a fitness minimum where 2 f x 2 x x 0 again this is in direct contradiction to the conclusions of a na model where the stability condition of a fixed point x of d x d t at a fitness maximum cf eqs e3 and e4 implies ν equals zero losing all functional diversity in addition if the initial value of x is a fixed point x of d x d t at a fitness minimum of the na model ν will increase without bound instead of vanishing provided there is no feedback between the total biomass inﬂuenced by ν 2 2 f x 2 x x and f x itself in that case we would ﬁnd ourselves with the opposite issue of exploding trait variances this feature is known as runaway evolution of traits cf abrams and matsuda 1997 furthermore this reasoning implies that any moment closure approach for trait based aggregate models defined by eqs e1 and e2 based on the assumption of a trait distribution that exhibits constant values of s and k independent of x and ν will not be able to overcome the same pitfall of na models loss of functional diversity over time without frequency dependent selection however as discussed below in more detail frequency dependent selection may also stabilize a fitness minimum within a na model abrams et al 1993b in line with the observed correlations between lower and higher central moments fig 2 one of the simplest moment closures that can be conducted for an aggregate model defined by eqs e1 and e2 while adhering to the stability conditions outlined above is given by assuming s and l n k to be expressed as linear functions of x and l n ν respectively e10 s m 3 ν 3 2 b s x a s m 3 ν 3 2 b s x a s e11 k m 4 ν 2 a k ν b k ln k b k ln ν ln a k m 4 a k ν b k 2 with a k a s 0 and b k b s 0 cf gaedke and klauschies 2017 this enables a data based moment closure of trait based aggregate models that are defined by eqs e1 and e2 where the intercept a and slope b parameters of eqs e10 and e11 are estimated from actual empirical data see fig 2 finally we support our analytical results by showing numerical simulations of an extended ba model that does not need immigration or any other mechanism to maintain v i e ν 0 when considering the central moments up to the fourth rather than the second order the aggregate model with the highest accuracy with respect to the resolution of the entire fitness landscape is given by the following set of equations cf appendix a e12 d r t d t f x ν 2 2 f x x 2 x x s ν 3 2 6 3 f x x 3 x x k ν 2 24 4 f x x 4 x x i e13 d x d t ν f x x x x s ν 3 2 2 2 f x x 2 x x k ν 2 6 3 f x x 3 x x i r t 1 2 x e14 d ν d t s ν 3 2 f x x x x k ν 2 ν 2 2 2 f x x 2 x x i r t 1 12 ν 1 2 x 2 in line with eq 20 the fourth order approximation of the per capita net growth rate f is given by e15 f x r 1 r t κ k 1 3 a k x c k 1 h a k x i 2 4 m i i i a k x x i x x r t in accordance with the simulations presented in the results section we run numerical simulations of this extended ba model by keeping all parameters the same except for the immigration rate i which was set to zero depending on the initial conditions our model predicts either oscillations or stasis in the predator and prey biomasses fig e2 in the first case the mean of the trait distribution approached a stable equilibrium at an intermediate value that corresponded to a fitness minimum whereas the value of the trait variance was at its maximum indicating a bimodal distribution in the second case on the other hand the mean trait value approached one of the two extremes that corresponded to a fitness maximum while the trait variance collapsed towards zero these results illustrate how the beta distribution approach can keep high levels of standing trait variation in trait based aggregate models without additional mechanisms when adding immigration to the extended version of the ba model the resulting biomass and trait dynamics no longer depended on the initial conditions and showed very high levels of standing trait variation fig e3 in contrast to the results shown in fig e2 the value of ν was not constant and changed over time this pattern arose from an interplay between the predator prey oscillations and the density dependent impact of immigration interestingly the immigration term in d x d t ensured global stability of the fixed point x 0 5 at a fitness minimum and thus overall maintenance of ν however at the same time the immigration term in d ν d t promoted temporal reductions of ν because the trait variance of the immigrating community is smaller than the trait variance of the resident community at equilibrium despite the good match between the trait dynamics this model overestimated the grazing rate of the predators on the prey community which promoted ongoing predator prey cycles instead of stasis see fig 6 furthermore this model was unable to reproduce the biomass and trait dynamics of the prey and predator community under fluctuating selection as displayed in fig 4 this indicates that trait based aggregate models are quite sensitive to the choice of the moment closure approach and mechanism used to maintain ν hence besides showing more thoroughly the actual potential of a beta distribution based moment closure approach for trait based aggregate models these results also point towards potential limitations that may arise when accounting for higher derivatives of the fitness function i e higher order taylor expansions e 2 convergent stable fitness minima under frequency dependent selection the preceding discussion assumed that natural selection is independent of x and ν of the trait distribution hence we neglected the possibility for a convergent stable fitness minimum that may generally arise under frequency dependent selection in which the fitness and thus the invasion success of a mutant strongly depend on the phenotype of the monomorphic resident community christiansen 1991 abrams et al 1993b rueffler et al 2006 in general this frequency dependent mechanism can stabilize a fitness minimum also in a na model which assumes that the trait values are normally distributed and exhibit a small variance however we are going to show that such stable fitness minima do not exist in our na model with a single predator hence this mechanism cannot have stabilized the fitness minimum in our fd model under disruptive selection fig 6 instead the fitness minimum in our fd model was likely stable due to the mechanism discussed in the previous section when selection is frequency dependent the species fitness function f depends not only on the total biomass r t and its individual trait value x but also on the mean x and variance ν of the entire trait distribution cf eq 20 hence when considering a na model under frequency dependent selection the linear stability condition for x at its equilibrium x is given more generally by the sign of the following equation e16 d d x d t d x x x ν 2 f x x ν x 2 x x x 2 f x x ν x x x x x hence the fixed point x is locally stable if 2 f x 2 x x x 2 f x x x x x 0 and x is unstable otherwise abrams et al 1993b in contrast to frequency independent selection this can also happen under frequency dependent selection when x is located at a fitness minimum in such a case selection will drive x first towards a local fitness maximum by following the fitness gradient which then turns into a local fitness minimum when x reaches the corresponding extreme trait value of the fitness landscape at which point selection becomes disruptive rueffler et al 2006 as a potential result ν may exhibit stable growth in the absence of any other negative feedback however frequency dependent selection does not ensure that x at a fitness minimum becomes convergent stable abrams et al 1993b in fact the likelihood of fitness maxima to be unstable seems to be much higher than the likelihood of fitness minima to be stable abrams et al 1993b furthermore in line with the stability conditions for x under frequency independent selection 2 f x x x x x equals zero also for some cases of frequency dependent selection for example consider the predator prey model used in the main text eqs 1 2 with only a single predator in place cf fig 6 in this case we can express the first derivative of the fitness function of the prey with respect to x eq 20 as the product of a function f 1 x that only depends on x and a function f 2 x ν that only depends on x and v of the trait distribution i e f x x ν x f 1 x f 2 x ν given that the denominator of the functional response is positive i e f 2 x ν 0 for all x and sufficiently small ν the second derivative 2 f x x x x equals zero when f x x x f 1 x x x 0 and thus when x is located at a fitness maximum or minimum for the same reason 2 f x ν x x 0 at such an equilibrium and so the off diagonal terms of the jacobian matrix of the system given by eqs e3 e4 cancel allowing us to analyze each equation separately once again hence under such circumstances a convergent stable fitness minimum does not exist in our na model even with frequency dependent selection in contrast to frequency independent selection a potential equilibrium of v in the na model under frequency dependent selection is given either by ν 0 or by 2 f x x ν x 2 x x ν ν 0 the first case is the trivial one noted beforehand however also the realism of the second non trivial equilibrium of ν has to be questioned because it implies that x has to be located at an inflection point furthermore the stability of the non trivial ν is given by the sign of the following equation e17 d d ν d t d ν ν ν 2 ν 2 f x x ν x 2 x x ν ν ν 2 3 f x x ν x 2 ν x x ν ν ν 2 3 f x x ν x 2 ν x x ν ν since ν 0 the stability depends only on the sign of the third derivative although it is not immediately clear which ecological scenarios may correspond to this stability condition the third derivative in eq e17 is zero when considering once again our predator prey model with a single predator in place following the reasoning outlined above for eq e16 this suggests that frequency dependent selection is not able to promote non zero variances at equilibrium in na models however in general when considering ba models the stability condition based on the correlations between lower and higher central moments eqs e6 and e9 may interact in several ways with the stability condition based on frequency dependence eqs e16 and e17 jointly determining the overall stability of fitness minima and maxima 
25283,the environmental disturbances often negatively influence normal operation of closed artificial ecosystems cae in this paper a specific cae cultivating cabbage caecc was considered as a dissipative structure system dss its highly precise kinetic model was developed by system dynamics and experimental data based on ecological thermodynamics et and dss the optimal feedback control law of light intensity temperature and aerating rate was obtained from the stored energy function and odum s maximum power principle the digital simulation results showed that the closed loop caecc control system could be stabilized at a prescribed working point with desired dynamic response characteristics accompanied with conducting eco work and dissipation of the stored energy generated by environmental disturbances with different strengths this research will lay a theoretical and methodological basis for construction and operation of cae keywords closed artificial ecosystem system dynamics ecological thermodynamics dissipative structure system optimal feedback control 1 introduction closed artificial ecosystems cae is mainly composed of biological community dominated by higher plants and artificial environmental factors such as light temperature water air and fertilizer meeting the ecological requirements of biological community and realizing crops vegetables flowers and herb medicines cultivation with high quality and efficiency yanata et al 2015 becerril and rios 2016 in design and construction of cae the most crucial criterion is operational reliability and stability because the operating process of cae is susceptible to environmental disturbances which will result in plants yield decrease and ecological functions impairment and even system breakdown ives and carpenter 2007 hence it is indispensable to work out how to effectively control and regulate the artificial environmental factors for cae to robustly operate in the case of environmental disturbances occurrence currently the open loop and linear closed loop control are used extensively in cae the open loop control is only based on subjective experiences and working specification rather than on line feedback information on system operation hence open loop control is very sensitive to disturbances with low control precision and operating stability kozai 2013 the simple closed loop control is generally applied for linear systems derived usually by linearization of a nonlinear system at a specific working point and in its neighborhood and the linear feedback algorithm is obtained from classic cybernetics such as root locus bode diagram pole placement quadratic optimal control and so forth ogata 2012a hu et al 2013 nevertheless the cae is a highly nonlinear complicated system whose operating state often deviates more greatly from a certain working point under the effect of disturbances therefore linearization procedure and simple closed loop controls like pid proportional integral derivative and lqg linear quadratic gaussian control for mechanic electromagnetic and fluid systems are unsuitable for cae to achieve the desired dynamic performance and even cause serious control failure gitelson et al 2003 lotka s simple but cogent argument had already proposed that as a principle natural selection tends to make the energy flux through the system a maximum odum s maximum power principle elucidates that ecosystems prevail that develops designs that maximize the flow of useful energy for maintenance and growth odum 1983 from these viewpoints of ecological thermodynamics et therefore artificial ecosystem can also be considered as a dissipative structure system dss with natural tendency to move away from thermodynamic equilibrium to the largest extent and gradually acquire the ability to conduct maximum eco work jorgensen 2012 according to dissipative structure theory if a proper stored energy function so called lyapunov function of a dss can be found it is possible to obtain an optimal feedback control algorithm for robustly stabilizing the dss at a satisfied operation level with good dynamic response performances to control action ogata 2012a cuce et al 2016 therefore in this research optimal feedback control law derived from et and dss was applied for closed loop control of a specific cae cultivating cabbage caecc in addition to cabbage there also exits a common vegetable pest whitefly in the caecc and three tunable environmental factors i e light intensity temperature and aeration rate of air inlet pipe bergstrand et al 2016 firstly a highly valid kinetic model was developed to describe the internal structure and dynamic behaviors of caecc secondly a proper stored energy lyapunov function composed of kinetic energy and potential energy was formulated thirdly the optimal feedback control law of light intensity temperature and aeration rate was obtained based on stored energy lyapunov function and odum s maximum power principle finally the effect of robust control was sufficiently verified and tested through digital simulation under the different kinds of environmental disturbances 2 materials and methods 2 1 mathematical modeling of caecc the kinetic model of caecc was developed by system dynamics to express and simulate its internal structure and dynamic behaviors ogata 2012b it is worth mentioning that living activities such as cabbage and whitefly growth are regarded as the fundamentally dynamic mechanisms to drive caecc operation in other words the rates of living activities are taken as the benchmark to determine the rates of nonliving activities such as the rate of gases o2 and co2 concentration through coefficient calibration 2 2 stored energy and robust control of caecc based on et and dss supposed that the pseudo model of caecc can be expressed as following generic form 1 x f x p ε u where x is biomass or concentration p is parameter ε is response of x to environmental disturbances and u is control input the f x p ε u is rate equations representing the relationships between species and their biotic abiotic environmental factors hence it is not only the dynamic mechanisms to drive the caecc operation but also the dissipative paths to conduct eco work and release heat entropy to environment maintaining the system equilibrium and further moving it far from the thermodynamic equilibrium shieh and fan 1982 jorgensen 2012 hence it is crucial to formulate a proper stored energy lyapunov function for caecc dissipation based on this function and maximum power principle the optimal control law u could obtained correspondingly for closed loop regulation of caecc from the viewpoint of ode model if x f x p ε u is gradually stable the system s stored energy continuously decreases or the phase loci gradually converge to an attractor in other words caecc will automatically restore to the attractor from deviations as environmental disturbances occur which resembles the caess is exerted an imaginary stretch and friction force generated by a spring and damper combination fig 1 a proper stored energy lyapunov function for caecc dissipation could therefore be constructed based on insight on this ecological characteristic 2 3 model validation and optimal control law verification through digital simulation after derivation of kinetic model and optimal control law of the caecc the simulation model of closed loop caecc control system could be constructed through their feedback connection on the platform of matlab simulink a large number of digital simulations including monte carlo simulations were carried out for parameter identification model validation and optimal control law verification parameters in the model were identified based on time domain experimental data via nonlinear least square and genetic algorithm or specified by directly taking from documents jorgensen 1979 the total experimental data were divided into 2 parts one part two thirds of data applied for parameters identification and the rest for model validation 3 results and discussion 3 1 caecc prototype the caecc prototype was composed of three interrelated components the autotrophic unit was cabbage brassica oleracea the heterotrophic unit was whitefly trialeurodes vaporariorum and the artificial environment factors including light intensity temperature and aerating rate fig 2 the cabbage cultivation was illumined by led photo source whose total intensity ranged from 600 μmol m 2 s 1 and 2000 μmol m 2 s 1 the temperature and the aeration rate varying from 15 c to 22 c and 50 l h 1 to 200 l h 1 were adjusted by an air conditioner and a two way pump respectively qu et al 2009 hu et al 2013 3 2 model derivation of caecc 3 2 1 hypothesis of modeling caecc in order to thoroughly and profoundly investigate the complicated dynamic behaviors of caecc it was necessary to develop a grey box kinetic model based on related mechanisms and experimental data and the model was derived according to the following assumptions 1 caecc was considered as a nonlinear continuous and lumped parameter system 2 according to the practical operation of caecc the light intensity temperature o2 and co2 concentrations were limiting factors influencing organism growths and the caecc operated in relatively normal circumstances 3 the rates of non living processes were approximately proportional to those of living activities 3 2 2 model derivation of caecc 3 2 2 1 state variables the kinetic model of caecc included 4 state variables cabbage phytomass x1 kg wet weight whitefly biomass x2 kg o2 concentration x3 co2 concentration x4 rate equations were obtained from quantifying the relationships between organisms and their biotic abiotic environmental factors in the caecc 3 2 2 2 tunable parameters three environmental factors were used as tunable parameters in the kinetic model to control and regulate dynamic behaviors of caecc i e light intensity i μmol m 2 s 1 temperature t c and aerating rate of air inlet pipe w l h 1 which was equivalent to outflow rate of air outlet pipe keeping air pressure constant in caecc 3 2 2 3 rate equations 1 rate equations related to cabbage phytomass dynamics in caecc three process rates closely related to dynamics of cabbage phytomass x1 are cabbage growth rate v1b whitefly predation rate on cabbage v12 and the impact of environmental disturbances on cabbage growth rate v1n respectively they could be specified accordingly as follows 2 v 1 b μ 1 m η i i r 1 e δ x 1 x 4 k d x 4 λ t λ t m t σ where μ 1 m is the maximum specific growth rate of cabbage in optimal circumstances δ is the sensitivity coefficient of cabbage to specific light resource r and kd are half saturation constant of cabbage growth in dependence on light intensity and co2 concentration respectively tong et al 2014 wang et al 2016 and η λ σ are experimental constant tm is the maximum temperature of cabbage growth li et al 2012 poulet et al 2014 takanobu et al 2016 furthermore the eq 2 also takes the photo inhibition effect on cabbage growth into consideration and v12 and v1n could be written as follows 3 v 12 β v 2 b v 1 n ε 1 x 1 where v2b is the whitefly growth rate β is the predation coefficient of whitefly on cabbage and ε1 is the response of cabbage growth rate to environmental disturbances 2 rate equations related to whitefly biomass dynamics similarly three process rates closely related to dynamics of whitefly biomass x2 are whitefly growth rate v2b whitefly death rate v 2d and the impact of environmental disturbances on whitefly growth rate v2n respectively they could be specified accordingly 4 v 2 b μ 2 m x 2 x 1 k s x 1 x 3 k o x 3 where μ 2 m is the maximum specific growth rate of whitefly ks and ko are half saturation constant of whitefly growth dependent on cabbage phytomass and o2 concentration respectively and v2d and v2n could be specified as follows 5 v 2 d k x 2 v 2 n ε 2 x 2 where k is natural death coefficient and ε2 is the response of whitefly growth rate to environmental disturbances 3 rate equations related to o2 concentration dynamics five process rates closely related to dynamics of o2 concentration x3 are o2 production rate of cabbage v13 o2 consumption rate of whitefly v23 the impact of environmental disturbances on o2 concentration variation v3n and aerating rate vi3 of air inlet pipe and outflow rate vo3 of air outlet pipe respectively they could be specified as follows 6 v 13 α v 1 1 b v 23 α v 2 2 b v 3 n ε x 3 3 where α 1 α 2 and ε3 represent the o2 production coefficient of cabbage the o2 consumption coefficient of whitefly and the response of o2 concentration to environmental disturbances respectively 7 v i 3 p o w v o 3 x 3 w where po is the o2 partial volume in the air outside of caecc 4 rate equations related to co2 concentration dynamics based on o2 rate equations those rates related to co2 concentration x4 dynamics could be determined correspondingly as follows 8 v 14 r v 1 13 v 24 r v 2 23 v 4 n ε x 4 4 where v14 v24 and v4n are co2 consumption rate of cabbage with assimilatory quotient r1 co2 production rate of whitefly with respiratory quotient r2 and environmental disturbances on co2 concentration with the response coefficient ε4 likewise aerating rate vi4 of air inlet pipe and outflow rate vo4 of air outlet pipe could be written as 9 v i 3 p c w v o 4 x 4 w where pc is co2 partial volume in the air outside of caecc 3 2 2 4 total kinetic model of caecc based on the preceding analysis and modeling process the state space model of caecc could be formulated in top down manner as follows 1 dynamic of cabbage phytomass x1 10 x 1 v 1 b v 12 v 1 n v 1 b β v 2 b v 1 n μ 1 m η i i r 1 e δ x 1 x 4 k d x 4 λ t λ t m t σ β μ 2 m x 2 x 1 k s x 1 x 3 k o x 3 ε 1 x 1 2 dynamic of whitefly biomass x2 11 x 2 v 2 b v 2 d v 2 n μ 2 m x 2 x 1 k s x 1 x 3 k o x 3 k x 2 ε 2 x 2 3 dynamic of o2 concentration x3 12 x 3 v 13 v 23 v i 3 v o 3 v 3 n α v 1 1 b α v 2 2 b v i 3 v o 3 v 3 n α 1 μ 1 m η i i r 1 e δ x 1 x 4 k d x 4 λ t λ t m t σ α μ 2 2 m x 2 x 1 k s x 1 x 3 k o x 3 p o w x 3 w ε 3 x 3 4 dynamic of co2 concentration x4 13 x 4 v 24 v 14 v i 4 v o 4 v 4 n r 2 v 23 r 1 v 13 v i 4 v o 4 v 4 n r 2 α μ 2 2 m x 2 x 1 k s x 1 x 3 k o x 3 r 1 α 1 μ 1 m η i i r 1 e δ x 1 x 4 k d x 4 λ t λ t m t σ p c w x 4 w ε 4 x 4 based on the total kinetic model of the caecc and experimental data parameters identification table 1 and model validation fig 3 have been carried out through digital simulation mathworks 2016 it is important for options of parameters identification and digital simulation to be properly set according to the model complexity accuracy speed and the computational expense table 2 3 3 optimal feedback control law obtained from et and dss as the environmental disturbances occur the caecc operation will inevitably deviate from the prescribed working point in different degrees however if the closed loop caecc with a certain control law can have capability to absorb disturbances recovering original state through dissipative behavior caess could be metaphorically considered to be applied on a combination of imaginary stretch and friction force as follows 14 f k x ˆ d x where k and d respectively represent ecological elastic coefficient matrix and ecological enthalpy of dissipative processes and x x x a denotes the difference between current state x and the prescribed working point xa of caecc stored energy e x of caecc could be defined as the sum of ecological kinetic energy ek x and ecological potential energy ep x as follows 15 e k x 1 2 x 2 0 t x d x e p x 1 2 x t k x 0 t k x d x or 16 e x e k x e p x 1 2 x 2 1 2 x t k x according to work energy principle the derivative of kinetic energy ek x equals to the power consumed by the caecc that is the time derivative of eco work w x conducted by stored energy during the dissipative process so that 17 d d t 1 2 x 2 d w x d t w t x x t k x ˆ d x consequently 18 d e d t d d t 1 2 x 2 d d t 1 2 x t k x x t k x ˆ d x x t k x ˆ x t d x based on dissipative structure theory eq 18 indicates that caecc can continuously move from current state x to the prescribed working point xa through stored energy dissipation for convenience here x f x p ε u is still used to represent kinetic model eqs 10 13 for derivation of optimal feedback control law of caecc the power of stored energy dissipation 19 w x t k x ˆ d x f t x p ε u k x ˆ d f x p ε u can maximize eco work w x if and only if satisfy 20 u f t x p ε u k x ˆ d f x p ε u 0 solving for u analytically or numerically obtain the optimal feedback control law as follows 21 u u x p ε k d the et parameters k and d were also identified by experimental data table 3 hence the kinetic model x f x p ε u can be replaced by x f x p ε k d to realize caecc robust operation at a prescribed working point through dissipative behavior the effect of robust control of caecc was validated through a large number of digital simulations the successive environmental fluctuations ε1 ε4 were generated by signals of impulse white noise uniform random sinusoid and their combination since these disturbances frequently occurred in the course of caecc operation the results of digital simulation showed the caecc with optimal feedback control law could effectively resist different disturbances and robustly stabilize caecc at the prescribed working point with good dynamic transient and steady state response performances to control actions fig 4 therefore if the operating states of caecc deviate more greatly from a prescribed working point the optimal feedback control law could make this point become a powerful abstractor with a higher disturbance resistant capacity since the convergence rates of caecc stored energy to zero are very rapid under different intensities of disturbances fig 5 however pid and lqg usually fail to achieve these control effects ogata 2012a 3 4 discussions after the optimal feedback control law is obtained through et and dss and proven to be effective by digital simulation it could be embedded in a chip to be a prototype of optimal feedback controller in combination with other peripheral equipments such as o2 and co2 sensors cabbage phytomass and whitefly biomass predictor digital amplifier data acquisition board and physical actuators of photo source air conditioner and electromagnetic valve for real time control of caecc as follows once the environmental disturbances occur the operating state of caecc will deviate from the prescribed working point which could be instantaneously detected by the sensors and state estimator and transmitted to optimal feedback controller then control signals actuated by photo source air conditioner and electromagnetic valve were immediately generated to regulate light intensity temperature and aerating rate of air inlet pipe stimulating or inhibiting the growth of cabbage and whitefly and restoring the state of caecc to the prescribed working point we often use generic ode model x f x p ε u to express internal structure and dynamic behaviors of cae based on et the evolution of an ecosystem is the gradual complication of its internal structure or dynamical mechanism f x p ε u through utilization of free energy like solar energy and chemical energy until f x p ε u can make x f x p ε u have maximum power to do maximal eco work under the prevailing conditions hence an unsolved fundamental problem is what form of f x p ε u can give cae maximum power which means that cae will have maximum flexibility to deal with ecological information to take action for acclimation through dissipation of the stored energy in other word in order to resolve problems encountered in the process of survival and development how cae produce x to change its dynamic behaviors and functions by conducting eco work although some beneficial attempts have been made based on et and dss jorgensen 2012 fath et al 2001 2004 we deem a further theoretical framework should be established to solve this problem thoroughly in the future except for tunable parameters variation jørgensen and fath 2004 however we cannot directly change the analytic formula of f x p ε u to alter internal structure or dynamical mechanism of caecc for maximizing the power under prevailing conditions therefore we also do not work out this fundamental problem in this research 4 conclusions in this paper the highly valid kinetic model for describing and capturing the inner structure and dynamic characteristics of caecc has been developed by system dynamics and experimental data and the closed loop caecc control system with optimal feedback control law obtained from et and dss the digital simulation results show that the closed loop caecc with optimal feedback control law is insusceptible to environmental disturbances and has desired dynamic response performances to control actions this research can provide a new perspective and tool to design and build more advanced caecc and other caes acknowledgement the research was supported by the open funding project of state key laboratory of virtual reality technology and systems beihang university grant no buaa vr 14kf 07 
25283,the environmental disturbances often negatively influence normal operation of closed artificial ecosystems cae in this paper a specific cae cultivating cabbage caecc was considered as a dissipative structure system dss its highly precise kinetic model was developed by system dynamics and experimental data based on ecological thermodynamics et and dss the optimal feedback control law of light intensity temperature and aerating rate was obtained from the stored energy function and odum s maximum power principle the digital simulation results showed that the closed loop caecc control system could be stabilized at a prescribed working point with desired dynamic response characteristics accompanied with conducting eco work and dissipation of the stored energy generated by environmental disturbances with different strengths this research will lay a theoretical and methodological basis for construction and operation of cae keywords closed artificial ecosystem system dynamics ecological thermodynamics dissipative structure system optimal feedback control 1 introduction closed artificial ecosystems cae is mainly composed of biological community dominated by higher plants and artificial environmental factors such as light temperature water air and fertilizer meeting the ecological requirements of biological community and realizing crops vegetables flowers and herb medicines cultivation with high quality and efficiency yanata et al 2015 becerril and rios 2016 in design and construction of cae the most crucial criterion is operational reliability and stability because the operating process of cae is susceptible to environmental disturbances which will result in plants yield decrease and ecological functions impairment and even system breakdown ives and carpenter 2007 hence it is indispensable to work out how to effectively control and regulate the artificial environmental factors for cae to robustly operate in the case of environmental disturbances occurrence currently the open loop and linear closed loop control are used extensively in cae the open loop control is only based on subjective experiences and working specification rather than on line feedback information on system operation hence open loop control is very sensitive to disturbances with low control precision and operating stability kozai 2013 the simple closed loop control is generally applied for linear systems derived usually by linearization of a nonlinear system at a specific working point and in its neighborhood and the linear feedback algorithm is obtained from classic cybernetics such as root locus bode diagram pole placement quadratic optimal control and so forth ogata 2012a hu et al 2013 nevertheless the cae is a highly nonlinear complicated system whose operating state often deviates more greatly from a certain working point under the effect of disturbances therefore linearization procedure and simple closed loop controls like pid proportional integral derivative and lqg linear quadratic gaussian control for mechanic electromagnetic and fluid systems are unsuitable for cae to achieve the desired dynamic performance and even cause serious control failure gitelson et al 2003 lotka s simple but cogent argument had already proposed that as a principle natural selection tends to make the energy flux through the system a maximum odum s maximum power principle elucidates that ecosystems prevail that develops designs that maximize the flow of useful energy for maintenance and growth odum 1983 from these viewpoints of ecological thermodynamics et therefore artificial ecosystem can also be considered as a dissipative structure system dss with natural tendency to move away from thermodynamic equilibrium to the largest extent and gradually acquire the ability to conduct maximum eco work jorgensen 2012 according to dissipative structure theory if a proper stored energy function so called lyapunov function of a dss can be found it is possible to obtain an optimal feedback control algorithm for robustly stabilizing the dss at a satisfied operation level with good dynamic response performances to control action ogata 2012a cuce et al 2016 therefore in this research optimal feedback control law derived from et and dss was applied for closed loop control of a specific cae cultivating cabbage caecc in addition to cabbage there also exits a common vegetable pest whitefly in the caecc and three tunable environmental factors i e light intensity temperature and aeration rate of air inlet pipe bergstrand et al 2016 firstly a highly valid kinetic model was developed to describe the internal structure and dynamic behaviors of caecc secondly a proper stored energy lyapunov function composed of kinetic energy and potential energy was formulated thirdly the optimal feedback control law of light intensity temperature and aeration rate was obtained based on stored energy lyapunov function and odum s maximum power principle finally the effect of robust control was sufficiently verified and tested through digital simulation under the different kinds of environmental disturbances 2 materials and methods 2 1 mathematical modeling of caecc the kinetic model of caecc was developed by system dynamics to express and simulate its internal structure and dynamic behaviors ogata 2012b it is worth mentioning that living activities such as cabbage and whitefly growth are regarded as the fundamentally dynamic mechanisms to drive caecc operation in other words the rates of living activities are taken as the benchmark to determine the rates of nonliving activities such as the rate of gases o2 and co2 concentration through coefficient calibration 2 2 stored energy and robust control of caecc based on et and dss supposed that the pseudo model of caecc can be expressed as following generic form 1 x f x p ε u where x is biomass or concentration p is parameter ε is response of x to environmental disturbances and u is control input the f x p ε u is rate equations representing the relationships between species and their biotic abiotic environmental factors hence it is not only the dynamic mechanisms to drive the caecc operation but also the dissipative paths to conduct eco work and release heat entropy to environment maintaining the system equilibrium and further moving it far from the thermodynamic equilibrium shieh and fan 1982 jorgensen 2012 hence it is crucial to formulate a proper stored energy lyapunov function for caecc dissipation based on this function and maximum power principle the optimal control law u could obtained correspondingly for closed loop regulation of caecc from the viewpoint of ode model if x f x p ε u is gradually stable the system s stored energy continuously decreases or the phase loci gradually converge to an attractor in other words caecc will automatically restore to the attractor from deviations as environmental disturbances occur which resembles the caess is exerted an imaginary stretch and friction force generated by a spring and damper combination fig 1 a proper stored energy lyapunov function for caecc dissipation could therefore be constructed based on insight on this ecological characteristic 2 3 model validation and optimal control law verification through digital simulation after derivation of kinetic model and optimal control law of the caecc the simulation model of closed loop caecc control system could be constructed through their feedback connection on the platform of matlab simulink a large number of digital simulations including monte carlo simulations were carried out for parameter identification model validation and optimal control law verification parameters in the model were identified based on time domain experimental data via nonlinear least square and genetic algorithm or specified by directly taking from documents jorgensen 1979 the total experimental data were divided into 2 parts one part two thirds of data applied for parameters identification and the rest for model validation 3 results and discussion 3 1 caecc prototype the caecc prototype was composed of three interrelated components the autotrophic unit was cabbage brassica oleracea the heterotrophic unit was whitefly trialeurodes vaporariorum and the artificial environment factors including light intensity temperature and aerating rate fig 2 the cabbage cultivation was illumined by led photo source whose total intensity ranged from 600 μmol m 2 s 1 and 2000 μmol m 2 s 1 the temperature and the aeration rate varying from 15 c to 22 c and 50 l h 1 to 200 l h 1 were adjusted by an air conditioner and a two way pump respectively qu et al 2009 hu et al 2013 3 2 model derivation of caecc 3 2 1 hypothesis of modeling caecc in order to thoroughly and profoundly investigate the complicated dynamic behaviors of caecc it was necessary to develop a grey box kinetic model based on related mechanisms and experimental data and the model was derived according to the following assumptions 1 caecc was considered as a nonlinear continuous and lumped parameter system 2 according to the practical operation of caecc the light intensity temperature o2 and co2 concentrations were limiting factors influencing organism growths and the caecc operated in relatively normal circumstances 3 the rates of non living processes were approximately proportional to those of living activities 3 2 2 model derivation of caecc 3 2 2 1 state variables the kinetic model of caecc included 4 state variables cabbage phytomass x1 kg wet weight whitefly biomass x2 kg o2 concentration x3 co2 concentration x4 rate equations were obtained from quantifying the relationships between organisms and their biotic abiotic environmental factors in the caecc 3 2 2 2 tunable parameters three environmental factors were used as tunable parameters in the kinetic model to control and regulate dynamic behaviors of caecc i e light intensity i μmol m 2 s 1 temperature t c and aerating rate of air inlet pipe w l h 1 which was equivalent to outflow rate of air outlet pipe keeping air pressure constant in caecc 3 2 2 3 rate equations 1 rate equations related to cabbage phytomass dynamics in caecc three process rates closely related to dynamics of cabbage phytomass x1 are cabbage growth rate v1b whitefly predation rate on cabbage v12 and the impact of environmental disturbances on cabbage growth rate v1n respectively they could be specified accordingly as follows 2 v 1 b μ 1 m η i i r 1 e δ x 1 x 4 k d x 4 λ t λ t m t σ where μ 1 m is the maximum specific growth rate of cabbage in optimal circumstances δ is the sensitivity coefficient of cabbage to specific light resource r and kd are half saturation constant of cabbage growth in dependence on light intensity and co2 concentration respectively tong et al 2014 wang et al 2016 and η λ σ are experimental constant tm is the maximum temperature of cabbage growth li et al 2012 poulet et al 2014 takanobu et al 2016 furthermore the eq 2 also takes the photo inhibition effect on cabbage growth into consideration and v12 and v1n could be written as follows 3 v 12 β v 2 b v 1 n ε 1 x 1 where v2b is the whitefly growth rate β is the predation coefficient of whitefly on cabbage and ε1 is the response of cabbage growth rate to environmental disturbances 2 rate equations related to whitefly biomass dynamics similarly three process rates closely related to dynamics of whitefly biomass x2 are whitefly growth rate v2b whitefly death rate v 2d and the impact of environmental disturbances on whitefly growth rate v2n respectively they could be specified accordingly 4 v 2 b μ 2 m x 2 x 1 k s x 1 x 3 k o x 3 where μ 2 m is the maximum specific growth rate of whitefly ks and ko are half saturation constant of whitefly growth dependent on cabbage phytomass and o2 concentration respectively and v2d and v2n could be specified as follows 5 v 2 d k x 2 v 2 n ε 2 x 2 where k is natural death coefficient and ε2 is the response of whitefly growth rate to environmental disturbances 3 rate equations related to o2 concentration dynamics five process rates closely related to dynamics of o2 concentration x3 are o2 production rate of cabbage v13 o2 consumption rate of whitefly v23 the impact of environmental disturbances on o2 concentration variation v3n and aerating rate vi3 of air inlet pipe and outflow rate vo3 of air outlet pipe respectively they could be specified as follows 6 v 13 α v 1 1 b v 23 α v 2 2 b v 3 n ε x 3 3 where α 1 α 2 and ε3 represent the o2 production coefficient of cabbage the o2 consumption coefficient of whitefly and the response of o2 concentration to environmental disturbances respectively 7 v i 3 p o w v o 3 x 3 w where po is the o2 partial volume in the air outside of caecc 4 rate equations related to co2 concentration dynamics based on o2 rate equations those rates related to co2 concentration x4 dynamics could be determined correspondingly as follows 8 v 14 r v 1 13 v 24 r v 2 23 v 4 n ε x 4 4 where v14 v24 and v4n are co2 consumption rate of cabbage with assimilatory quotient r1 co2 production rate of whitefly with respiratory quotient r2 and environmental disturbances on co2 concentration with the response coefficient ε4 likewise aerating rate vi4 of air inlet pipe and outflow rate vo4 of air outlet pipe could be written as 9 v i 3 p c w v o 4 x 4 w where pc is co2 partial volume in the air outside of caecc 3 2 2 4 total kinetic model of caecc based on the preceding analysis and modeling process the state space model of caecc could be formulated in top down manner as follows 1 dynamic of cabbage phytomass x1 10 x 1 v 1 b v 12 v 1 n v 1 b β v 2 b v 1 n μ 1 m η i i r 1 e δ x 1 x 4 k d x 4 λ t λ t m t σ β μ 2 m x 2 x 1 k s x 1 x 3 k o x 3 ε 1 x 1 2 dynamic of whitefly biomass x2 11 x 2 v 2 b v 2 d v 2 n μ 2 m x 2 x 1 k s x 1 x 3 k o x 3 k x 2 ε 2 x 2 3 dynamic of o2 concentration x3 12 x 3 v 13 v 23 v i 3 v o 3 v 3 n α v 1 1 b α v 2 2 b v i 3 v o 3 v 3 n α 1 μ 1 m η i i r 1 e δ x 1 x 4 k d x 4 λ t λ t m t σ α μ 2 2 m x 2 x 1 k s x 1 x 3 k o x 3 p o w x 3 w ε 3 x 3 4 dynamic of co2 concentration x4 13 x 4 v 24 v 14 v i 4 v o 4 v 4 n r 2 v 23 r 1 v 13 v i 4 v o 4 v 4 n r 2 α μ 2 2 m x 2 x 1 k s x 1 x 3 k o x 3 r 1 α 1 μ 1 m η i i r 1 e δ x 1 x 4 k d x 4 λ t λ t m t σ p c w x 4 w ε 4 x 4 based on the total kinetic model of the caecc and experimental data parameters identification table 1 and model validation fig 3 have been carried out through digital simulation mathworks 2016 it is important for options of parameters identification and digital simulation to be properly set according to the model complexity accuracy speed and the computational expense table 2 3 3 optimal feedback control law obtained from et and dss as the environmental disturbances occur the caecc operation will inevitably deviate from the prescribed working point in different degrees however if the closed loop caecc with a certain control law can have capability to absorb disturbances recovering original state through dissipative behavior caess could be metaphorically considered to be applied on a combination of imaginary stretch and friction force as follows 14 f k x ˆ d x where k and d respectively represent ecological elastic coefficient matrix and ecological enthalpy of dissipative processes and x x x a denotes the difference between current state x and the prescribed working point xa of caecc stored energy e x of caecc could be defined as the sum of ecological kinetic energy ek x and ecological potential energy ep x as follows 15 e k x 1 2 x 2 0 t x d x e p x 1 2 x t k x 0 t k x d x or 16 e x e k x e p x 1 2 x 2 1 2 x t k x according to work energy principle the derivative of kinetic energy ek x equals to the power consumed by the caecc that is the time derivative of eco work w x conducted by stored energy during the dissipative process so that 17 d d t 1 2 x 2 d w x d t w t x x t k x ˆ d x consequently 18 d e d t d d t 1 2 x 2 d d t 1 2 x t k x x t k x ˆ d x x t k x ˆ x t d x based on dissipative structure theory eq 18 indicates that caecc can continuously move from current state x to the prescribed working point xa through stored energy dissipation for convenience here x f x p ε u is still used to represent kinetic model eqs 10 13 for derivation of optimal feedback control law of caecc the power of stored energy dissipation 19 w x t k x ˆ d x f t x p ε u k x ˆ d f x p ε u can maximize eco work w x if and only if satisfy 20 u f t x p ε u k x ˆ d f x p ε u 0 solving for u analytically or numerically obtain the optimal feedback control law as follows 21 u u x p ε k d the et parameters k and d were also identified by experimental data table 3 hence the kinetic model x f x p ε u can be replaced by x f x p ε k d to realize caecc robust operation at a prescribed working point through dissipative behavior the effect of robust control of caecc was validated through a large number of digital simulations the successive environmental fluctuations ε1 ε4 were generated by signals of impulse white noise uniform random sinusoid and their combination since these disturbances frequently occurred in the course of caecc operation the results of digital simulation showed the caecc with optimal feedback control law could effectively resist different disturbances and robustly stabilize caecc at the prescribed working point with good dynamic transient and steady state response performances to control actions fig 4 therefore if the operating states of caecc deviate more greatly from a prescribed working point the optimal feedback control law could make this point become a powerful abstractor with a higher disturbance resistant capacity since the convergence rates of caecc stored energy to zero are very rapid under different intensities of disturbances fig 5 however pid and lqg usually fail to achieve these control effects ogata 2012a 3 4 discussions after the optimal feedback control law is obtained through et and dss and proven to be effective by digital simulation it could be embedded in a chip to be a prototype of optimal feedback controller in combination with other peripheral equipments such as o2 and co2 sensors cabbage phytomass and whitefly biomass predictor digital amplifier data acquisition board and physical actuators of photo source air conditioner and electromagnetic valve for real time control of caecc as follows once the environmental disturbances occur the operating state of caecc will deviate from the prescribed working point which could be instantaneously detected by the sensors and state estimator and transmitted to optimal feedback controller then control signals actuated by photo source air conditioner and electromagnetic valve were immediately generated to regulate light intensity temperature and aerating rate of air inlet pipe stimulating or inhibiting the growth of cabbage and whitefly and restoring the state of caecc to the prescribed working point we often use generic ode model x f x p ε u to express internal structure and dynamic behaviors of cae based on et the evolution of an ecosystem is the gradual complication of its internal structure or dynamical mechanism f x p ε u through utilization of free energy like solar energy and chemical energy until f x p ε u can make x f x p ε u have maximum power to do maximal eco work under the prevailing conditions hence an unsolved fundamental problem is what form of f x p ε u can give cae maximum power which means that cae will have maximum flexibility to deal with ecological information to take action for acclimation through dissipation of the stored energy in other word in order to resolve problems encountered in the process of survival and development how cae produce x to change its dynamic behaviors and functions by conducting eco work although some beneficial attempts have been made based on et and dss jorgensen 2012 fath et al 2001 2004 we deem a further theoretical framework should be established to solve this problem thoroughly in the future except for tunable parameters variation jørgensen and fath 2004 however we cannot directly change the analytic formula of f x p ε u to alter internal structure or dynamical mechanism of caecc for maximizing the power under prevailing conditions therefore we also do not work out this fundamental problem in this research 4 conclusions in this paper the highly valid kinetic model for describing and capturing the inner structure and dynamic characteristics of caecc has been developed by system dynamics and experimental data and the closed loop caecc control system with optimal feedback control law obtained from et and dss the digital simulation results show that the closed loop caecc with optimal feedback control law is insusceptible to environmental disturbances and has desired dynamic response performances to control actions this research can provide a new perspective and tool to design and build more advanced caecc and other caes acknowledgement the research was supported by the open funding project of state key laboratory of virtual reality technology and systems beihang university grant no buaa vr 14kf 07 
25284,ecological niche models enms are tools that allow us to approximate the area of suitability for a species thereby allowing elaboration of conservation strategies the validation of these models in situ is not always possible due to costly access remote areas where conserved species are often found the goal of our study was to provide a new validation concept for enms by applying remote sensing sr techniques such as geographic object based image analysis geobia which enables mapping of large areas and provides detailed information on land use to assess the geobia validation technique we selected the species bertholletia excelsa brazil nut a tree that has great importance as a non timber forest product and is considered vulnerable by the international union for conservation of nature iucn models were built on the biomod2 package and evaluation was conducted using the area under the receiver operating characteristic curve auc and true skill statistics tss metrics images were obtained from the orbital operational land imager oli on board the landsat 8 satellite and the thematic maps were evaluated using kappa and overall accuracy statistics we calculated vegetation indices evi savi lai and ndvi and applied them to the geobia technique a total of 693 possible sites of b excelsa were detected of these 25 accessible sites were used for validation and 45 new records of b excelsa were added in the study area geobia was demonstrated to have high potential for validating enms as well as in the extraction of arboreal species from medium resolution spatial images keywords bertholletia excelsa vegetation index amazon geobia operational land imager 1 introduction a plethora of species will probably become extinct by the end of this century loreau et al 2006 tilman et al 2017 knowledge about species that still exist is important for the elaboration of conservation strategies willis et al 2007 aarts et al 2012 and there are several approaches in the literature that can be applied to explain and predict the distribution of endangered species kerr 1997 myers et al 2000 pearson et al 2002 peterson 2003 baillie et al 2004 maciel et al 2016 one of these approaches is ecological niche modeling enm sometimes referred to as species distribution modeling or habitat suitability modeling which is a tool that by can predict geographic species distribution based on environmental suitability e g pearson 2007 siqueira et al 2009 franklin 2010 the enm is based on the ecological niche theory and uses occurrence points along with the ecological requirements present at these points generally environmental variables as an approximation of the multidimensional niche elith et al 2006 subsequently these ecological requirements are extrapolated to areas of potential distribution franklin 2010 a fundamental issue in enm involves model validation which is still not well developed peterson et al 2008 jiménez valverde et al 2011 every model must be validated those which fail validation are simply discarded monte et al 1996 morrison et al 1998 ottaviani et al 2004 there are several techniques for model validation but a rather widespread idea in enm is that the best validation is realized in situ siqueira et al 2009 however this type of validation is not always possible due to the cost of expeditions or even difficulty in accessing areas where the species of interest is expected to find suitable conditions hertzog et al 2014 thus there is a need for highly accurate methods for selecting areas of easy access to obtain in situ occurrence records that can be used to validate models our study proposes a new approach for validating enms in which one can find new occurrence records for modeled species within suitable areas as indicated by projection maps such new avenues can be provided by remote sensing rs techniques which are the lowest cost solutions for mapping land use particularly the distribution of forest agricultural and urban areas due to their ability to provide detailed information on the soil coverage over extensive areas eberhardt et al 2016 bellón et al 2017 in addition they provide synoptic coverage and high temporal resolution capacity which allows for monitoring the phenology of regions with vegetal cover bellón et al 2017 yang et al 2017 specifically geographic object based image analysis geobia is a robust method for mapping treetops and differentiating them from the surrounding landscape thereby accommodating different types of data and levels of quality variables o neil dunne et al 2014 silva junior et al 2018 which could be applied to facilitate and improve the validation of enms we sought to reduce the area projected by the models in order to facilitate discovery of target species occurrences in the field with specific collection sites indicated based on the use of geobia within the enm scenario thus we aimed to assess whether enms can be validated by means of geobia we expected a positive answer because each species has a specific spectral signature and species that stand out of the canopy are likely to be detected by multi resolution geobia if this is true it would be possible to improve the occurrence records of a tree species using geobia if geobia is able to validate enms then we can assume that geobia is able to detect the extracted traits of the target species we tested geobia as an ecological niche model validation tool with the tree bertholletia excelsa brazil nut from the lecythidaceae family a tree protected by the brazilian government law decree nº 5 975 2006 that has great importance as a non timber product peres et al 2003 and is considered vulnerable by the international union for conservation of nature iucn 2017 2 material and methods 2 1 study area the study area was located in the state of mato grosso in the municipality of alta floresta in the midwest region of brazil at latitude 09 34 to 56 14 s and longitude 10 21 to 56 13 w encompassing an approximate area of 8 947 069 km2 fig 1 the altitude of the region varies substantially with 52 of the territory above 279 m altitude and only 3 below 300 m the predominant climate was characterized according to köppen geiger s classification as cwi rainy tropical álvares et al 2013 in addition the land use and cover of the region were determined using a classified database silva junior and lima 2018 2 2 occurrence records and environmental predictors we obtained the occurrence records of b excelsa from the specieslink http www splink org br and gbif http www gbif org databases we only included records that had an image or that were input by experts and we eliminated inconsistent data such as unreliable coordinates which lacked georeferenced information or repeated coordinates the bioclimatic variables obtained were solar radiation wind speed water vapor pressure twelve variables related to temperature and another nine related to precipitation totaling 22 environmental layers extracted from the worldclim database hijmans et al 2005 since this set of variables presents a high degree of collinearity and also to avoid subjectivity in their selection we retained the first seven axes determined by principal component analysis pca thus ensuring 95 of the data variation was captured we used the rasterpca function of the rstoolbox package in r 3 4 2 leutner and horning 2016 r core development team 2017 2 3 model building the enms were built evaluated and projected using the biomod2 package thuiller et al 2016 the algorithms used were classification tree analysis cta flexible discriminant analysis fda multiple adaptive regression splines mars artificial neural networks ann generalized boosting model gbm random forest rf maximum entropy maxent generalized additive models gam generalized linear models glm and surface range envelope sre the models were calibrated in a random sample of the data with 70 used for training and 30 for testing each algorithm was used for 10 runs which allowed a robust estimate of the performance to be obtained for each model pearce and ferrier 2000 franklin 2009 we used 10 sets of points as pseudo absences all of them outside the bioclimatic envelope of the species totaling 100 models 10 sets of pseudo absence x 10 runs for each algorithm from the continuous projection maps we prepared binary maps i e maps that indicate suitability or non suitability areas for b excelsa based on the threshold that maximizes the sum of the sensitivity plus the specificity liu et al 2013 this threshold equals finding the point on the receiver operating characteristic roc curve whose tangent slope is equal to 1 liu et al 2005 use of this threshold produces higher sensitivity in most cases and higher tss in many cases than is achieved by the other methods liu et al 2013 in preparation of the consensus models we obtained the mean of the individual models thus providing more reliable predictions with lower levels of uncertainty araújo and new 2007 2 4 model evaluation two methods were used to evaluate model performance the first was the area under the roc curve auc elith et al 2006 the auc values were classified as excellent at 0 90 1 00 good at 0 80 0 90 average at 0 70 0 80 poor at 0 60 0 70 or failure at 0 60 swets 1988 araujo et al 2005 thus auc 1 would be expected if the entire area of the model was under the curve or in other words in a model with 100 correct predictions in turn failure models would occupy a limited area 60 under the curve the second method used the true skill statistics tss which has values between 1 and 1 values less than 0 4 are indicative of low predictive power 0 4 0 8 of good predictive power and 0 8 to 1 of excellent predictive power values equal to or less than zero indicate performance no better than explained by chance allouche et al 2006 zhang et al 2015 the algorithm sre failed tss 0 4 and was thereby discarded 2 5 collection of orbital images to map all areas of b excelsa images from the operational land imager oli orbital sensor on board the landsat 8 satellite were used landsat 8 continues the landsat program while providing advances to sensor capability that include new bands in spectral regions that respond to aerosols and cirrus two thermal bands better signal to noise sensor performance and better radiometric resolution table 1 scenes 227 67 and 228 67 were obtained from the united states geological survey earth explorer usgs database for julian days 167 and 174 respectively in year 2017 glcf 2004 the oli monotemporal vegetation index rasters were processed into thematic maps of pasture areas whose accuracy was evaluated using the kappa κ and overall accuracy oa statistics details on κ are in landis and koch 1977 to determine the κ and oa values 170 randomly distributed sample points were used fig 1 based on prior knowledge of the area and their locations were determined by gps garmin etrex venture hc the free availability of the landsat series data provides opportunities for the analysis of terrestrial change at multiple time scales silva junior et al 2014 by means of the radiometric calibration process in envi 5 1 all bands of both scenes were transformed from digital numbers dn to spectral radiance measurements at the top of the atmosphere such a conversion is only possible for scenes that present metadata files mtl and is described in eq 1 exelis 2014 1 l λ g a i n d n d o p i x e l o f f s e t for the conversion of radiance at the top of the atmosphere lλ to planetary reflectance at the top of the atmosphere ρλ eq 2 was applied 2 ρ λ m ρ q c a l a ρ where ρλ is the planetary reflectance at the top of the atmosphere without sun angle correction mρ is the reflectance rescaling factor for the specific band qcal is the digital number for the pixel and aρ is the additive factor rescaled from the reflectance for that band the corrected planetary reflectance was obtained by eq 3 3 ρ λ ρ λ s e n θ s e ρ λ c o s θ s z where ρλ is the exoatmospheric reflectance θse is the local solar elevation angle equivalent to the esun value and θsz is the local zenith solar angle the oli image processing involved three main steps as described in novo 2008 and jensen 2009 first atmospheric correction was performed using the fast line of sight atmospheric analysis of spectral hypercubes flaash model with 70 km visibility a tropical atmosphere and the continental aerosol model adopted for the initial conditions flaash operates in the spectral range between 0 4 and 2 5 μm and processing is performed pixel by pixel the radiance image that arrives at the sensor is input to the model which then outputs a surface reflectance image the model adjusts the image using a variety of parameters including albedo surface altitude vapor column and water optical depth of aerosols and clouds surface temperature and atmospheric condition kruse 2004 dai and khorram 1998 in the second step highlight is applied to provide linear contrast for better target discrimination lastly a vegetation index was assigned 2 6 vegetation index calculations enhanced vegetation index evi eq 4 images from the oli sensor were used they corresponded to path row 227 67 and 228 68 collection 1 level 1 huete et al 1997 from the landsat 8 satellite had a spatial resolution of 30 m and were downloaded from usgs lp daac 4 e v i g ρ n i r ρ r ρ n i r c 1 ρ r c 2 ρ b 1 where ρnir ρr and ρb are the near infrared red and blue reflectance respectively g is the gain factor 2 5 c1 and c2 are the correction coefficients of atmospheric effects on red 6 and blue 7 5 respectively and 1 is the correction factor for soil interference the evi is an index that was developed to attenuate soil effects adjusted for through the soil adjusted vegetation index savi and atmospheric effects adjusted for through the atmospherically resistant vegetation index arvi in vegetation mapping in addition to the evi data images of ndvi normalized difference vegetation index were acquired which is calculated from blue red and near infrared reflectance as in eq 5 5 n d v i ρ n i r ρ r ρ n i r ρ r where ρnir and ρr are the near infrared and red reflectance respectively the soil adjusted vegetation index savi defined by eq 6 takes into account the effects of exposed soil in the analyzed images that is when the surface is not completely covered by vegetation to adjust ndvi 6 s a v i 1 l s ρ n i r ρ r e d l s ρ n i r ρ r e d where ls is a constant called the adjustment factor of savi and can assume values of 0 25 1 depending on the soil cover according to huete 1988 a value for ls of 0 25 is indicated for dense vegetation of 0 5 for intermediate density and of 1 for low density vegetation when ls is equal to 0 the assigned savi value is equal to the ndvi the most frequent ls value is therefore 0 5 the leaf area index lai eq 7 is a biophysical index defined by the ratio between the leaf area of a vegetation per unit area used by this vegetation being an indicator of the biomass of each image pixel as computed by the following empirical equation allen et al 2002 7 l a i l n 0 69 s a v i 0 59 0 91 2 7 geobia the sequence phases necessary for classifying the b excelsa areas are represented in fig 1 this kind of analysis uses geobia data mining and the integration of both when applied to the oli sensor the ecognition developer 8 0 is an object based image analysis software definiens 2006 that was developed by the company trimble geospatial hall et al 2009 the proposed approach included image segmentation and training set development through polygon selection we selected 50 samples fig 1 captured in situ for classification from this sample we obtained a set of sites that were used to guide the process of obtaining of new occurrences of b excelsa the proposed process refers to the knowledge discovery in databases as being interactive iterative cognitive and exploratory fayyad et al 1996 2 8 multi resolution segmentation the basic process units were the objects developed by the algorithm proposed by baatz and schäpe 2000 and they were incorporated into the ecognition computational program definiens 2006 multiresolution segmentation was performed using ecognition 8 0 in which the developed objects polygons were exposed to a heterogeneity decision which can be adjusted by selecting the scale parameter spectral band weights and shape and compactness factors the adjustment of a scale parameter may influence the size of the segments developed in multiresolution segmentation the similarity rule was established from the concept of heterogeneity for internal regions heterogeneity was established from the difference between the attribute of a likely region and the sum of the values for this attribute in the smaller regions that compose the likely region furthermore heterogeneity of the color and shape attributes which were adjusted according to object size was calculated during segmentation the weighted sum of these two heterogeneities formed the similarity criterion f as expressed by the following eq 8 8 f w h c o l o r 1 w h f o r m where w is the weight of the color attribute in the segmentation process 0 1 hcolor is the heterogeneity of color and hform is the heterogeneity of form the color is created from an estimated sum of the standard deviations from each band in a specific region each band weight 0 1 is set by the analyst and used in eq 9 to represent the color 9 c o l o r c w c σ c where wc is the attributed weight of each multispectral band σ is the standard deviation and c is the name of each band eq 10 represents the color heterogeneity 10 h c o l o r c w c n u n i o n σ c u n i o n n o b j 1 σ c o b j 1 n o b j 2 σ c o b j 2 where nunion is the possible number of pixels of the object to be formed σ c u n i o n is the standard deviation for the possible object to be formed in each c band n o b j 1 is the number of pixels of the first object σ c o b j 1 is the standard deviation of the first object in each c band n o b j 2 is the number of pixels of the second object and σ c o b j 2 is the standard deviation of the second object in each c band form is a compound attribute thus it is necessary to incorporate compactness as shown in eqs 11 and 12 smoothness described by eq 12 below is the ratio between the object perimeter and the bounding box i e a surrounding rectangle that is parallel to the borders of the image and has the smallest possible length 11 c p l n 12 s t l b in the equations above l is the object perimeter n is the object size described as the number of pixels and b is the bounding box perimeter the heterogeneity of form is the weighted sum of the compactness and smoothness heterogeneities where weights are set by the analyst eq 13 eq 14 expresses the heterogeneity of compactness while eq 15 expresses the heterogeneity of smoothness 13 h f o r m w c p h c p 1 w c p h s t 14 h c p n u n i o n c p u n i o n n o b j 1 c p o b j 1 n o b j 2 c p o b j 2 15 h s t n u n i o n s t u n i o n n o b j 1 s t o b j 1 n o b j 2 s t o b j 2 in the above equations wcp is the weight attributed to compactness 0 1 hcp and hst are the heterogeneities of compactness and smoothness respectively cpunion is the compactness of the possible object to be formed in each c band cpobj1 and cpobj2 are the compactness of the first and second objects in each c band stunion is the compactness of the possible object to be formed in each c band and stobj1 and stobj2 are the compactness of the first and second objects in each c band in comparison with pixel based methods the object based approach offered the possibility of evaluating areas by spectral textural contextual and hierarchical characteristics the object categories can be characterized into the following two groups table 2 i object spectral information based on mean values and standard deviation and ii textural spectral information based on the grey level co occurrence matrix glcm proposed by haralick et al 1973 and implemented by definiens 2006 to guarantee object homogeneity among the four indices that were used evi ndvi savi and lai and the spectral bands in the reflectance factor band 1 7 all of the images were processed at the same time during the segmentation process table 3 land use classes for b excelsa and others were used during the classification process to assess the validation of the classification technique used an analysis was conducted based on gps points taken in the field after developing the training set the ecognition 8 0 platform was used to extract the attributes table 4 according to the most representative characteristics of the classes of interest as described by blaschke 2010 the selected attributes were spectral spatial and textural the primary process results were inserted into the classification scheme using the classification algorithm in which rules were added for specific land use classes i e b excelsa and others after classification the merge region algorithm was incorporated thus the objects of each class were grouped into larger objects for this purpose we used the standard nearest neighbor classification algorithm for the object level domain in each image 3 results the average enms indicate climatic suitability for b excelsa in the amazonian domain being in agreement with the known distribution area of the species as provided by flora do brasil 2020 which is under construction 2017 fig 2 the enms generated by the algorithms presented auc mean values between 0 88 and 0 97 the tss mean values presented results from 0 757 to 0 862 thus both metrics indicated good or excellent predictive power with high accuracy in addition there were low standard deviations which suggests a high degree of concordance among individual models table 5 thus the enms of b excelsa present a better explanation than expected by chance in fig 3 and table 6 vegetation indices indicate that in the study area mean values for ndvi were high 0 873 0 0587 showing sites with high plant biomass such as the forests in the southeast se and northwest nw of the municipality the savi and evi values were not elevated maintaining the mean of 0 530 and 0 560 respectively with smaller deviations from the mean 0 0335 and 0 0418 indicating that the sites present an intermediate forest canopy huete 1988 the lower values of savi and evi also show that anthropic activities such as pastures are more pronounced in the central part of the municipality this same result is evidenced by the lai mean 4 396 0 472 which indicates heterogeneity of the sites and differentiates forests from areas modified by anthropic activities aragão et al 2005 quality of the classifier was assessed with κ of 0 71 and oa of 0 85 indicating the robustness of the classifier pax lenney woodcock 1997 from the 170 terrestrial truth points selected 100 were identified for the occurrence of b excelsa and 70 were identified for other uses obtaining high levels of accuracy oa 93 99 and κ index 0 87 this result indicates reliability of the classifier for medium resolution images vieira et al 2012 within the municipality of alta floresta mt a region of high environmental suitability predicted by the enms fig 2 the developed tool allowed detection of 693 sites with possible occurrence of b excelsa we simulated a situation in which it would not be possible to validate all 693 sites in the field medium spatial resolution images were thus used to select 25 accessible sites sampling at these 25 sites allowed the addition of 45 new occurrence records for b excelsa species fig 4 4 discussion we were successful in providing a new framework to validate enms with remote sensing we found great potential for extracting tree species occurrence in a multiresolution oli image 30 30 m a methodological proposal that is ideal for scholars and researchers who need a starting point in the validation of enms we confirmed both hypotheses and demonstrated high potential for using geobia for assessing the distribution of tree species first we found that geobia was able to validate the enms since it was able to match predicted b excelsa occurrences in the landscape second geobia guided the obtainment of new occurrence records of b excelsa in an area with high environmental suitability as predicted by projection maps through the geobia analysis it was possible to map the landscapes covering the entire geographical study area this tool made it possible to map the land use and occupation as well as classify and characterize forests with accuracy close to 90 the accuracy however depends on the resolution of the input image o neil dunne et al 2014 phiri and morgenroth 2017 this technique has been effectively used in agriculture with low spatial resolution images modis 250 m risso et al 2012 silva junior et al 2014 bellón et al 2017 since the crops exhibit homogeneity of reflectance since the forests present reflectance heterogeneity a high spatial resolution image is necessary with pixels significantly smaller than the canopy size of the trees ardila et al 2012 such a high resolution is not usually indicated for tree species kamal and johansen 2017 despite this fact we were successful in detecting the occurrence of b excelsa for a large spectrum of possible suitable areas indicated by enm projections validation of ecological models has been debated since the 1960s rykiel 1996 the traditional methods used for validation of areas with potential climatic suitability have several limitations see for instance giannini et al 2012 and guisan et al 2017 in general areas of climate suitability are extensive often even larger than entire biogeographical regions which makes it difficult to choose a site for in situ validation this is because enms which cover such large suitable areas have not been able to precisely identify the most appropriate places to invest time and resources for model validation approaches based on alternative methods were successfully performed by siqueira et al 2009 from a single point of known byrsonima subterranea they carried out field surveys at nine sites with high similarity to the point of occurrence and at five sites they found six additional populations alternative methods for indicating collection areas such as that proposed in our study will be useful for field validation of models with reduced risk of investing resources to investigate areas of difficult access or outside the species distribution we recognize that the technique has some limitations such as the need for a considerable number of known points for training the geobia many endangered tropical species present fewer than five known points making it difficult to calibrate the algorithm another possible limitation occurs in application of the technique to sub forest species due to being overlapped by the canopies of emergent trees which would make it difficult to obtain reflectance for these species however for b excelsa which emerges above the canopy the proposed approach was satisfactory and robust allowing an increase in the number of records and also facilitating field validations by means of specific indications of where the species would occur 5 conclusions this study was compelled by the urgency of performing critical evaluation on the adequacy of ecological models getz et al 2018 we thus emphasize the main novel modeling aspect brought by this study the facility of validating enms by remote sensing techniques thus avoiding financial and time expenses when searching for occurrence records in large areas of environmental suitability for a selected species the method can be applied for other species so long as there is sufficient input data to the classifier from known points followed by the veracity of these points such savings are key for considering enms as an essential tool during the decision making process to inform conservation actions e g villero et al 2017 acknowledgements lj s rcs and bml are indebted to capes coordenação para o aperfeiçoamento de pessoal de nível superior which provides them master scholarships 
25284,ecological niche models enms are tools that allow us to approximate the area of suitability for a species thereby allowing elaboration of conservation strategies the validation of these models in situ is not always possible due to costly access remote areas where conserved species are often found the goal of our study was to provide a new validation concept for enms by applying remote sensing sr techniques such as geographic object based image analysis geobia which enables mapping of large areas and provides detailed information on land use to assess the geobia validation technique we selected the species bertholletia excelsa brazil nut a tree that has great importance as a non timber forest product and is considered vulnerable by the international union for conservation of nature iucn models were built on the biomod2 package and evaluation was conducted using the area under the receiver operating characteristic curve auc and true skill statistics tss metrics images were obtained from the orbital operational land imager oli on board the landsat 8 satellite and the thematic maps were evaluated using kappa and overall accuracy statistics we calculated vegetation indices evi savi lai and ndvi and applied them to the geobia technique a total of 693 possible sites of b excelsa were detected of these 25 accessible sites were used for validation and 45 new records of b excelsa were added in the study area geobia was demonstrated to have high potential for validating enms as well as in the extraction of arboreal species from medium resolution spatial images keywords bertholletia excelsa vegetation index amazon geobia operational land imager 1 introduction a plethora of species will probably become extinct by the end of this century loreau et al 2006 tilman et al 2017 knowledge about species that still exist is important for the elaboration of conservation strategies willis et al 2007 aarts et al 2012 and there are several approaches in the literature that can be applied to explain and predict the distribution of endangered species kerr 1997 myers et al 2000 pearson et al 2002 peterson 2003 baillie et al 2004 maciel et al 2016 one of these approaches is ecological niche modeling enm sometimes referred to as species distribution modeling or habitat suitability modeling which is a tool that by can predict geographic species distribution based on environmental suitability e g pearson 2007 siqueira et al 2009 franklin 2010 the enm is based on the ecological niche theory and uses occurrence points along with the ecological requirements present at these points generally environmental variables as an approximation of the multidimensional niche elith et al 2006 subsequently these ecological requirements are extrapolated to areas of potential distribution franklin 2010 a fundamental issue in enm involves model validation which is still not well developed peterson et al 2008 jiménez valverde et al 2011 every model must be validated those which fail validation are simply discarded monte et al 1996 morrison et al 1998 ottaviani et al 2004 there are several techniques for model validation but a rather widespread idea in enm is that the best validation is realized in situ siqueira et al 2009 however this type of validation is not always possible due to the cost of expeditions or even difficulty in accessing areas where the species of interest is expected to find suitable conditions hertzog et al 2014 thus there is a need for highly accurate methods for selecting areas of easy access to obtain in situ occurrence records that can be used to validate models our study proposes a new approach for validating enms in which one can find new occurrence records for modeled species within suitable areas as indicated by projection maps such new avenues can be provided by remote sensing rs techniques which are the lowest cost solutions for mapping land use particularly the distribution of forest agricultural and urban areas due to their ability to provide detailed information on the soil coverage over extensive areas eberhardt et al 2016 bellón et al 2017 in addition they provide synoptic coverage and high temporal resolution capacity which allows for monitoring the phenology of regions with vegetal cover bellón et al 2017 yang et al 2017 specifically geographic object based image analysis geobia is a robust method for mapping treetops and differentiating them from the surrounding landscape thereby accommodating different types of data and levels of quality variables o neil dunne et al 2014 silva junior et al 2018 which could be applied to facilitate and improve the validation of enms we sought to reduce the area projected by the models in order to facilitate discovery of target species occurrences in the field with specific collection sites indicated based on the use of geobia within the enm scenario thus we aimed to assess whether enms can be validated by means of geobia we expected a positive answer because each species has a specific spectral signature and species that stand out of the canopy are likely to be detected by multi resolution geobia if this is true it would be possible to improve the occurrence records of a tree species using geobia if geobia is able to validate enms then we can assume that geobia is able to detect the extracted traits of the target species we tested geobia as an ecological niche model validation tool with the tree bertholletia excelsa brazil nut from the lecythidaceae family a tree protected by the brazilian government law decree nº 5 975 2006 that has great importance as a non timber product peres et al 2003 and is considered vulnerable by the international union for conservation of nature iucn 2017 2 material and methods 2 1 study area the study area was located in the state of mato grosso in the municipality of alta floresta in the midwest region of brazil at latitude 09 34 to 56 14 s and longitude 10 21 to 56 13 w encompassing an approximate area of 8 947 069 km2 fig 1 the altitude of the region varies substantially with 52 of the territory above 279 m altitude and only 3 below 300 m the predominant climate was characterized according to köppen geiger s classification as cwi rainy tropical álvares et al 2013 in addition the land use and cover of the region were determined using a classified database silva junior and lima 2018 2 2 occurrence records and environmental predictors we obtained the occurrence records of b excelsa from the specieslink http www splink org br and gbif http www gbif org databases we only included records that had an image or that were input by experts and we eliminated inconsistent data such as unreliable coordinates which lacked georeferenced information or repeated coordinates the bioclimatic variables obtained were solar radiation wind speed water vapor pressure twelve variables related to temperature and another nine related to precipitation totaling 22 environmental layers extracted from the worldclim database hijmans et al 2005 since this set of variables presents a high degree of collinearity and also to avoid subjectivity in their selection we retained the first seven axes determined by principal component analysis pca thus ensuring 95 of the data variation was captured we used the rasterpca function of the rstoolbox package in r 3 4 2 leutner and horning 2016 r core development team 2017 2 3 model building the enms were built evaluated and projected using the biomod2 package thuiller et al 2016 the algorithms used were classification tree analysis cta flexible discriminant analysis fda multiple adaptive regression splines mars artificial neural networks ann generalized boosting model gbm random forest rf maximum entropy maxent generalized additive models gam generalized linear models glm and surface range envelope sre the models were calibrated in a random sample of the data with 70 used for training and 30 for testing each algorithm was used for 10 runs which allowed a robust estimate of the performance to be obtained for each model pearce and ferrier 2000 franklin 2009 we used 10 sets of points as pseudo absences all of them outside the bioclimatic envelope of the species totaling 100 models 10 sets of pseudo absence x 10 runs for each algorithm from the continuous projection maps we prepared binary maps i e maps that indicate suitability or non suitability areas for b excelsa based on the threshold that maximizes the sum of the sensitivity plus the specificity liu et al 2013 this threshold equals finding the point on the receiver operating characteristic roc curve whose tangent slope is equal to 1 liu et al 2005 use of this threshold produces higher sensitivity in most cases and higher tss in many cases than is achieved by the other methods liu et al 2013 in preparation of the consensus models we obtained the mean of the individual models thus providing more reliable predictions with lower levels of uncertainty araújo and new 2007 2 4 model evaluation two methods were used to evaluate model performance the first was the area under the roc curve auc elith et al 2006 the auc values were classified as excellent at 0 90 1 00 good at 0 80 0 90 average at 0 70 0 80 poor at 0 60 0 70 or failure at 0 60 swets 1988 araujo et al 2005 thus auc 1 would be expected if the entire area of the model was under the curve or in other words in a model with 100 correct predictions in turn failure models would occupy a limited area 60 under the curve the second method used the true skill statistics tss which has values between 1 and 1 values less than 0 4 are indicative of low predictive power 0 4 0 8 of good predictive power and 0 8 to 1 of excellent predictive power values equal to or less than zero indicate performance no better than explained by chance allouche et al 2006 zhang et al 2015 the algorithm sre failed tss 0 4 and was thereby discarded 2 5 collection of orbital images to map all areas of b excelsa images from the operational land imager oli orbital sensor on board the landsat 8 satellite were used landsat 8 continues the landsat program while providing advances to sensor capability that include new bands in spectral regions that respond to aerosols and cirrus two thermal bands better signal to noise sensor performance and better radiometric resolution table 1 scenes 227 67 and 228 67 were obtained from the united states geological survey earth explorer usgs database for julian days 167 and 174 respectively in year 2017 glcf 2004 the oli monotemporal vegetation index rasters were processed into thematic maps of pasture areas whose accuracy was evaluated using the kappa κ and overall accuracy oa statistics details on κ are in landis and koch 1977 to determine the κ and oa values 170 randomly distributed sample points were used fig 1 based on prior knowledge of the area and their locations were determined by gps garmin etrex venture hc the free availability of the landsat series data provides opportunities for the analysis of terrestrial change at multiple time scales silva junior et al 2014 by means of the radiometric calibration process in envi 5 1 all bands of both scenes were transformed from digital numbers dn to spectral radiance measurements at the top of the atmosphere such a conversion is only possible for scenes that present metadata files mtl and is described in eq 1 exelis 2014 1 l λ g a i n d n d o p i x e l o f f s e t for the conversion of radiance at the top of the atmosphere lλ to planetary reflectance at the top of the atmosphere ρλ eq 2 was applied 2 ρ λ m ρ q c a l a ρ where ρλ is the planetary reflectance at the top of the atmosphere without sun angle correction mρ is the reflectance rescaling factor for the specific band qcal is the digital number for the pixel and aρ is the additive factor rescaled from the reflectance for that band the corrected planetary reflectance was obtained by eq 3 3 ρ λ ρ λ s e n θ s e ρ λ c o s θ s z where ρλ is the exoatmospheric reflectance θse is the local solar elevation angle equivalent to the esun value and θsz is the local zenith solar angle the oli image processing involved three main steps as described in novo 2008 and jensen 2009 first atmospheric correction was performed using the fast line of sight atmospheric analysis of spectral hypercubes flaash model with 70 km visibility a tropical atmosphere and the continental aerosol model adopted for the initial conditions flaash operates in the spectral range between 0 4 and 2 5 μm and processing is performed pixel by pixel the radiance image that arrives at the sensor is input to the model which then outputs a surface reflectance image the model adjusts the image using a variety of parameters including albedo surface altitude vapor column and water optical depth of aerosols and clouds surface temperature and atmospheric condition kruse 2004 dai and khorram 1998 in the second step highlight is applied to provide linear contrast for better target discrimination lastly a vegetation index was assigned 2 6 vegetation index calculations enhanced vegetation index evi eq 4 images from the oli sensor were used they corresponded to path row 227 67 and 228 68 collection 1 level 1 huete et al 1997 from the landsat 8 satellite had a spatial resolution of 30 m and were downloaded from usgs lp daac 4 e v i g ρ n i r ρ r ρ n i r c 1 ρ r c 2 ρ b 1 where ρnir ρr and ρb are the near infrared red and blue reflectance respectively g is the gain factor 2 5 c1 and c2 are the correction coefficients of atmospheric effects on red 6 and blue 7 5 respectively and 1 is the correction factor for soil interference the evi is an index that was developed to attenuate soil effects adjusted for through the soil adjusted vegetation index savi and atmospheric effects adjusted for through the atmospherically resistant vegetation index arvi in vegetation mapping in addition to the evi data images of ndvi normalized difference vegetation index were acquired which is calculated from blue red and near infrared reflectance as in eq 5 5 n d v i ρ n i r ρ r ρ n i r ρ r where ρnir and ρr are the near infrared and red reflectance respectively the soil adjusted vegetation index savi defined by eq 6 takes into account the effects of exposed soil in the analyzed images that is when the surface is not completely covered by vegetation to adjust ndvi 6 s a v i 1 l s ρ n i r ρ r e d l s ρ n i r ρ r e d where ls is a constant called the adjustment factor of savi and can assume values of 0 25 1 depending on the soil cover according to huete 1988 a value for ls of 0 25 is indicated for dense vegetation of 0 5 for intermediate density and of 1 for low density vegetation when ls is equal to 0 the assigned savi value is equal to the ndvi the most frequent ls value is therefore 0 5 the leaf area index lai eq 7 is a biophysical index defined by the ratio between the leaf area of a vegetation per unit area used by this vegetation being an indicator of the biomass of each image pixel as computed by the following empirical equation allen et al 2002 7 l a i l n 0 69 s a v i 0 59 0 91 2 7 geobia the sequence phases necessary for classifying the b excelsa areas are represented in fig 1 this kind of analysis uses geobia data mining and the integration of both when applied to the oli sensor the ecognition developer 8 0 is an object based image analysis software definiens 2006 that was developed by the company trimble geospatial hall et al 2009 the proposed approach included image segmentation and training set development through polygon selection we selected 50 samples fig 1 captured in situ for classification from this sample we obtained a set of sites that were used to guide the process of obtaining of new occurrences of b excelsa the proposed process refers to the knowledge discovery in databases as being interactive iterative cognitive and exploratory fayyad et al 1996 2 8 multi resolution segmentation the basic process units were the objects developed by the algorithm proposed by baatz and schäpe 2000 and they were incorporated into the ecognition computational program definiens 2006 multiresolution segmentation was performed using ecognition 8 0 in which the developed objects polygons were exposed to a heterogeneity decision which can be adjusted by selecting the scale parameter spectral band weights and shape and compactness factors the adjustment of a scale parameter may influence the size of the segments developed in multiresolution segmentation the similarity rule was established from the concept of heterogeneity for internal regions heterogeneity was established from the difference between the attribute of a likely region and the sum of the values for this attribute in the smaller regions that compose the likely region furthermore heterogeneity of the color and shape attributes which were adjusted according to object size was calculated during segmentation the weighted sum of these two heterogeneities formed the similarity criterion f as expressed by the following eq 8 8 f w h c o l o r 1 w h f o r m where w is the weight of the color attribute in the segmentation process 0 1 hcolor is the heterogeneity of color and hform is the heterogeneity of form the color is created from an estimated sum of the standard deviations from each band in a specific region each band weight 0 1 is set by the analyst and used in eq 9 to represent the color 9 c o l o r c w c σ c where wc is the attributed weight of each multispectral band σ is the standard deviation and c is the name of each band eq 10 represents the color heterogeneity 10 h c o l o r c w c n u n i o n σ c u n i o n n o b j 1 σ c o b j 1 n o b j 2 σ c o b j 2 where nunion is the possible number of pixels of the object to be formed σ c u n i o n is the standard deviation for the possible object to be formed in each c band n o b j 1 is the number of pixels of the first object σ c o b j 1 is the standard deviation of the first object in each c band n o b j 2 is the number of pixels of the second object and σ c o b j 2 is the standard deviation of the second object in each c band form is a compound attribute thus it is necessary to incorporate compactness as shown in eqs 11 and 12 smoothness described by eq 12 below is the ratio between the object perimeter and the bounding box i e a surrounding rectangle that is parallel to the borders of the image and has the smallest possible length 11 c p l n 12 s t l b in the equations above l is the object perimeter n is the object size described as the number of pixels and b is the bounding box perimeter the heterogeneity of form is the weighted sum of the compactness and smoothness heterogeneities where weights are set by the analyst eq 13 eq 14 expresses the heterogeneity of compactness while eq 15 expresses the heterogeneity of smoothness 13 h f o r m w c p h c p 1 w c p h s t 14 h c p n u n i o n c p u n i o n n o b j 1 c p o b j 1 n o b j 2 c p o b j 2 15 h s t n u n i o n s t u n i o n n o b j 1 s t o b j 1 n o b j 2 s t o b j 2 in the above equations wcp is the weight attributed to compactness 0 1 hcp and hst are the heterogeneities of compactness and smoothness respectively cpunion is the compactness of the possible object to be formed in each c band cpobj1 and cpobj2 are the compactness of the first and second objects in each c band stunion is the compactness of the possible object to be formed in each c band and stobj1 and stobj2 are the compactness of the first and second objects in each c band in comparison with pixel based methods the object based approach offered the possibility of evaluating areas by spectral textural contextual and hierarchical characteristics the object categories can be characterized into the following two groups table 2 i object spectral information based on mean values and standard deviation and ii textural spectral information based on the grey level co occurrence matrix glcm proposed by haralick et al 1973 and implemented by definiens 2006 to guarantee object homogeneity among the four indices that were used evi ndvi savi and lai and the spectral bands in the reflectance factor band 1 7 all of the images were processed at the same time during the segmentation process table 3 land use classes for b excelsa and others were used during the classification process to assess the validation of the classification technique used an analysis was conducted based on gps points taken in the field after developing the training set the ecognition 8 0 platform was used to extract the attributes table 4 according to the most representative characteristics of the classes of interest as described by blaschke 2010 the selected attributes were spectral spatial and textural the primary process results were inserted into the classification scheme using the classification algorithm in which rules were added for specific land use classes i e b excelsa and others after classification the merge region algorithm was incorporated thus the objects of each class were grouped into larger objects for this purpose we used the standard nearest neighbor classification algorithm for the object level domain in each image 3 results the average enms indicate climatic suitability for b excelsa in the amazonian domain being in agreement with the known distribution area of the species as provided by flora do brasil 2020 which is under construction 2017 fig 2 the enms generated by the algorithms presented auc mean values between 0 88 and 0 97 the tss mean values presented results from 0 757 to 0 862 thus both metrics indicated good or excellent predictive power with high accuracy in addition there were low standard deviations which suggests a high degree of concordance among individual models table 5 thus the enms of b excelsa present a better explanation than expected by chance in fig 3 and table 6 vegetation indices indicate that in the study area mean values for ndvi were high 0 873 0 0587 showing sites with high plant biomass such as the forests in the southeast se and northwest nw of the municipality the savi and evi values were not elevated maintaining the mean of 0 530 and 0 560 respectively with smaller deviations from the mean 0 0335 and 0 0418 indicating that the sites present an intermediate forest canopy huete 1988 the lower values of savi and evi also show that anthropic activities such as pastures are more pronounced in the central part of the municipality this same result is evidenced by the lai mean 4 396 0 472 which indicates heterogeneity of the sites and differentiates forests from areas modified by anthropic activities aragão et al 2005 quality of the classifier was assessed with κ of 0 71 and oa of 0 85 indicating the robustness of the classifier pax lenney woodcock 1997 from the 170 terrestrial truth points selected 100 were identified for the occurrence of b excelsa and 70 were identified for other uses obtaining high levels of accuracy oa 93 99 and κ index 0 87 this result indicates reliability of the classifier for medium resolution images vieira et al 2012 within the municipality of alta floresta mt a region of high environmental suitability predicted by the enms fig 2 the developed tool allowed detection of 693 sites with possible occurrence of b excelsa we simulated a situation in which it would not be possible to validate all 693 sites in the field medium spatial resolution images were thus used to select 25 accessible sites sampling at these 25 sites allowed the addition of 45 new occurrence records for b excelsa species fig 4 4 discussion we were successful in providing a new framework to validate enms with remote sensing we found great potential for extracting tree species occurrence in a multiresolution oli image 30 30 m a methodological proposal that is ideal for scholars and researchers who need a starting point in the validation of enms we confirmed both hypotheses and demonstrated high potential for using geobia for assessing the distribution of tree species first we found that geobia was able to validate the enms since it was able to match predicted b excelsa occurrences in the landscape second geobia guided the obtainment of new occurrence records of b excelsa in an area with high environmental suitability as predicted by projection maps through the geobia analysis it was possible to map the landscapes covering the entire geographical study area this tool made it possible to map the land use and occupation as well as classify and characterize forests with accuracy close to 90 the accuracy however depends on the resolution of the input image o neil dunne et al 2014 phiri and morgenroth 2017 this technique has been effectively used in agriculture with low spatial resolution images modis 250 m risso et al 2012 silva junior et al 2014 bellón et al 2017 since the crops exhibit homogeneity of reflectance since the forests present reflectance heterogeneity a high spatial resolution image is necessary with pixels significantly smaller than the canopy size of the trees ardila et al 2012 such a high resolution is not usually indicated for tree species kamal and johansen 2017 despite this fact we were successful in detecting the occurrence of b excelsa for a large spectrum of possible suitable areas indicated by enm projections validation of ecological models has been debated since the 1960s rykiel 1996 the traditional methods used for validation of areas with potential climatic suitability have several limitations see for instance giannini et al 2012 and guisan et al 2017 in general areas of climate suitability are extensive often even larger than entire biogeographical regions which makes it difficult to choose a site for in situ validation this is because enms which cover such large suitable areas have not been able to precisely identify the most appropriate places to invest time and resources for model validation approaches based on alternative methods were successfully performed by siqueira et al 2009 from a single point of known byrsonima subterranea they carried out field surveys at nine sites with high similarity to the point of occurrence and at five sites they found six additional populations alternative methods for indicating collection areas such as that proposed in our study will be useful for field validation of models with reduced risk of investing resources to investigate areas of difficult access or outside the species distribution we recognize that the technique has some limitations such as the need for a considerable number of known points for training the geobia many endangered tropical species present fewer than five known points making it difficult to calibrate the algorithm another possible limitation occurs in application of the technique to sub forest species due to being overlapped by the canopies of emergent trees which would make it difficult to obtain reflectance for these species however for b excelsa which emerges above the canopy the proposed approach was satisfactory and robust allowing an increase in the number of records and also facilitating field validations by means of specific indications of where the species would occur 5 conclusions this study was compelled by the urgency of performing critical evaluation on the adequacy of ecological models getz et al 2018 we thus emphasize the main novel modeling aspect brought by this study the facility of validating enms by remote sensing techniques thus avoiding financial and time expenses when searching for occurrence records in large areas of environmental suitability for a selected species the method can be applied for other species so long as there is sufficient input data to the classifier from known points followed by the veracity of these points such savings are key for considering enms as an essential tool during the decision making process to inform conservation actions e g villero et al 2017 acknowledgements lj s rcs and bml are indebted to capes coordenação para o aperfeiçoamento de pessoal de nível superior which provides them master scholarships 
